<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="../app/v2/analytics.js"></script><meta content="How to create a web application using Flask, SQlite database, SQLAlchemy, and Jinja templates." name="description" data-skip-index="skip"><link rel="canonical" href="creating-web-application-with-flask.html"><meta charset="UTF-8"><title>Creating Web Applications with Flask - Help | PyCharm</title><link rel="stylesheet" href="../app/v2/app.css"></head><body data-id="Creating_Web_Application_with_Flask"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search PyCharm Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="creating-web-application-with-flask.html#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>PyCharm 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="primary_default" selected>Windows/Linux Default</option><option data-group="primary" value="primary_default_for_gnome">GNOME</option><option data-group="primary" value="primary_default_for_kde">KDE</option><option data-group="primary" value="primary_default_for_xwin">XWin</option><option data-group="primary" value="primary_emacs">Emacs</option><option data-group="primary" value="primary_visual_studio">Visual Studio</option><option data-group="primary" value="primary_netbeans">NetBeans</option><option data-group="primary" value="primary_eclipse">Eclipse</option><option data-group="secondary" value="secondary_mac_os_x_10.5_">Default (Mac OS X 10.5+)</option><option data-group="secondary" value="secondary_mac_os_x">Mac OS X</option><option data-group="secondary" value="secondary_eclipse_mac_os_x">Eclipse (Mac OS X)</option><option data-group="secondary" value="secondary_intellij_idea_classic_os_x">IntelliJ IDEA Classic (Mac OS X)</option><option data-group="secondary" value="secondary_xcode">Xcode</option><option data-group="secondary" value="secondary_visual_studio">Visual Studio</option><option data-group="secondary" value="secondary_resharper">ReSharper</option><option data-group="secondary" value="secondary_resharper_osx">ReSharper (Mac OS X)</option><option data-group="secondary" value="secondary_emacs">Emacs (Mac OS X)</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="active"><h1 data-toc="Creating_Web_Application_with_Flask" id="Creating_Web_Application_with_Flask.xml">Creating Web Applications with Flask</h1>                         <aside class="warning " data-title="" rel="Creating_Web_Application_with_Flask.xml" id="7877690c"><p>        This feature is only supported in the <b id="9ae40ec0" origin="intellij-platform">Professional</b> edition.         This edition is commercial, and it provides an outstanding set of features:          see the <a href="https://www.jetbrains.com/pycharm/features/editions_comparison_matrix.html" data-bypass="yes" target="_blank"><span>comparison matrix</span></a> for more details.    </p></aside>    <p id="d31f0ce9">This tutorial explains how to develop a web-based application using the Flask web framework. Our MeteoMaster application processes meteo data stored in a database and    presents it in the form of the following charts:</p>    <ul class="list _ul"><li class="list__item" id="95b16fa8"><p id="e4c1d182">Scatter chart – a cumulative report of the average yearly temperature and humidity in Prague, St. Petersburg, San Francisco, Paris, and Singapore.</p>        </li><li class="list__item" id="e3a0a2fe">            <p id="fc78682b">Line charts – Average monthly temperature and humidity in each city.</p>        </li></ul>    <figure id="d1c5013e" width="600" height="518"><img class="js-gif" src="../img/idea/2019.1/py_flask_demo.png" data-gif-src="/help/img/idea/2019.1/py_flask_demo.animated.gif" width="600" style="width:600px;"></figure>    <div class="chapter"><h2 id="overview" data-toc="Creating_Web_Application_with_Flask#overview">Staying Above the Weather: Application Overview</h2>        <p id="e0568942">You will use various Web technologies to implement the following application functions:</p>        <div class="table-wrapper"><table class="                 " width="100%" id="c491c900"><thead><tr id="f4630a0a" class="ijRowHead"><th id="1145e346"><p>Function</p></th><th id="626494c3"><p>Technology</p></th></tr></thead><tbody><tr id="416df76d" class="ijRowOdd"><td id="67454cf8"><p>Meteo data operations</p></td><td id="9f3ce002"><p><a href="https://www.sqlite.org/index.html" data-bypass="yes" target="_blank"><span>SQLite</span></a> database to store data, <a href="https://www.sqlalchemy.org/" data-bypass="yes" target="_blank"><span>SQLAlchemy</span></a> package to perform operations with the database in Python code.</p></td></tr><tr id="70f50e41" class="ijRowEven"><td id="26a137dd"><p>Graphical representation</p></td><td id="e5b40d5e"><p><a href="https://matplotlib.org/" data-bypass="yes" target="_blank"><span>matplotlib</span></a> package to plot graphs.</p></td></tr><tr id="5410c8e5" class="ijRowOdd"><td id="8090954c"><p>Viewing and editing content</p></td><td id="757813a0"><p><a href="https://www.w3schools.com/html/" data-bypass="yes" target="_blank"><span>HTML</span></a> to create page views and <a href="http://jinja.pocoo.org/" data-bypass="yes" target="_blank"><span>Jinja</span></a> to create smart templates.</p></td></tr><tr id="ff6c84de" class="ijRowEven"><td id="65bc909b"><p>Managing content</p></td><td id="1a6e85f9"><p><a href="http://flask.pocoo.org/" data-bypass="yes" target="_blank"><span>Flask</span></a> to orchestrate the application content.</p></td></tr></tbody></table></div>        <p id="a77fb825">The MeteoMaster is a web application that comprises the following components:</p>        <figure><img alt="Key modules of the Flask Web application" title="Key modules of the Flask Web application" src="../img/idea/2019.1/py_flask_app_structure.png" id="04a44b09" width="600" height="440"></figure>        <dl><dt id="c571fa38">Main page</dt><dd>                <p id="7f941136">Application entry point that renders the scatter chart and provides links to the detailed summary of climate in a particular city.</p>            </dd><dt id="31601b0d">City</dt><dd>                <p id="62b4cf2c">A series of pages with the detailed information about climate in each city.</p>            </dd><dt id="31cd7e3c">Login</dt><dd>                <p id="ebc95636">Authentication page. One needs to enter the valid credentials to edit meteo data.</p>            </dd><dt id="16f8f951">Edit</dt><dd>                <p id="92a21966">A series of pages for editing city specific data.</p>            </dd></dl>        <p id="5af5ab0d">Each HTML page has a corresponding Flask view implemented in Python code.</p>    </div>    <div class="chapter"><h2 id="f836515c" data-toc="Creating_Web_Application_with_Flask#f836515c">Creating a Flask application in PyCharm</h2>        <p id="ae9b1247">Create a basic Flask project as described in <a href="creating-flask-project.html"><span>Creating a Flask Project</span></a> to start prototyping the application.</p>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="73aee2f3">                <p id="ef62c2a9">Select <span class="control">Flask</span> in the <span class="control">New Project</span> dialog.                <figure><img alt="Creating a new Flask project" title="Creating a new Flask project" src="../img/idea/2019.1/py_flask_create_meteo_project.png" id="ab0dd3e9" width="600" height="869"></figure>                </p>            </li><li class="list__item" id="b24c2f1c"><p id="7ced37e6">In the <span class="control">Location</span> field, provide the path to the project location and type the <span class="keyword">MeteoMaster</span> as the project name.                Leave the rest of the settings default and save the changes.</p>            </li><li class="list__item" id="38fdc871">                <p id="1462bacb">Click <kbd data-primary_default="Shift+F10" data-primary_default_for_gnome="Shift+F10" data-primary_default_for_kde="Shift+F10" data-primary_default_for_xwin="Shift+F10" data-primary_emacs="Shift+F10" data-primary_visual_studio="Ctrl+F5" data-primary_netbeans="F6" data-primary_eclipse="Shift+Alt+X" data-secondary_mac_os_x_10.5_="⌃R" data-secondary_mac_os_x="⇧F10" data-secondary_eclipse_mac_os_x="⇧⌘F11" data-secondary_intellij_idea_classic_os_x="N/A" data-secondary_xcode="N/A" data-secondary_visual_studio="⌃F5" data-secondary_resharper="N/A" data-secondary_resharper_osx="N/A" data-secondary_emacs="⇧F10">Shift+F10</kbd> to run the default application. In the <span class="control">Run</span> tool window,                click the hyperlink and preview the target page.                <figure><img alt="Preview the Hello World app" title="Preview the Hello World app" src="../img/idea/2019.1/py_flask_meteo_run_default.png" id="15aeffe1" width="700" height="366"></figure>                </p>            </li><li class="list__item" id="29bba864">                <p id="eb5d058a">Now install all the packages required for the MeteoMaster application. The easiest way to do that is to use project dependencies                    (see <a href="managing-dependencies.html"><span>Manage dependencies using requirements.txt</span></a>). Right-click the project root and select                    <span data-skip-index="skip" class="menupath">New | File</span>, then specify <span class="keyword">requirements.txt</span> as the file name and add the following list of the dependencies to it.                    <div class="code-block" data-lang="Plain Text"><code class="code-block__wrapper">Click==7.0
cycler==0.10.0
Flask==1.0.2
Jinja2==2.10
kiwisolver==1.0.1
MarkupSafe==1.1.0
matplotlib==3.0.2
numpy==1.15.4
pyparsing==2.3.0
python-dateutil==2.7.5
six==1.11.0
SQLAlchemy==1.2.14
Werkzeug==0.14.1</code></div>                </p>                <p id="63235955">Click the <span class="control">Install requirements</span> link to proceed with installation of the packages.                <figure><img alt="Installing packages required for the application" title="Installing packages required for the application" src="../img/idea/2019.1/py_flask_meteo_requirements.png" id="55060f36" width="700" height="189"></figure></p>            </li></ol></section>    </div>    <div class="chapter"><h2 id="database" data-toc="Creating_Web_Application_with_Flask#database">Setting up a Database</h2>        <p id="20c5cdf2">Now, set up a data source for your application. With PyCharm, it is quite straightforward.</p>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="b2850814">                <p id="a3fc732c">Download the predefined database with the meteo data for five cities from the following location:                </p>                <p id="073f87d1"><a href="https://github.com/allaredko/flask-tutorial-demo/blob/master/user_database" data-bypass="yes" target="_blank"><span>https://github.com/allaredko/flask-tutorial-demo/blob/master/user_database</span></a></p>                 <p id="e32e4a92">Save the <span class="filepath">user_database</span> file in the project root directory.</p></li><li class="list__item" id="0cc7d7d9"><p id="5941e4b5">Double-click the added file and open the <a href="database-tool-window.html"><span>Database Tool Window</span></a>.                <figure><img alt="Meteo database" title="Meteo database" src="../img/idea/2019.1/py_flask_meteo_database.png" id="a4e4bb15" width="700" height="724"></figure></p>                    <p id="7f26f2bd">You should see the following tables in the <code class="code">user_database</code> database: <code class="code">city</code>                        and <code class="code">meteo</code>. Double-click each table to preview the data. The <code class="code">city</code> table has three columns:                        <code class="code">city_id</code>, <code class="code">city_name</code>, and <code class="code">city_climate</code> (a brief text description of the city climate).                        The <code class="code">meteo</code> table has four columns: <code class="code">city_id</code>, <code class="code">month</code>, <code class="code">average_humidity</code>, and                        <code class="code">average_temperature</code>. A <span class="emphasis">foreign key</span> is defined for the <code class="code">city_id</code> column of the                        <code class="code">table</code> to set a relation between two tables.                    </p>                </li><li class="list__item" id="d44e8fea">                   <p id="f0fe4943">Optionally, right-click <span class="control">user_database</span> in the <span class="control">Database</span> tool window and select <span data-skip-index="skip" class="menupath">Properties</span>.                       In the <span class="control">Data Sources and Drivers</span> dialog, click                    <span class="control">Test connection</span> to ensure that the data source has been configured properly.</p>                <figure><img alt="Adding a data source" title="Adding a data source" src="../img/idea/2019.1/py_flask_meteo_datasource.png" id="08aa6778" width="600" height="756"></figure></li><li class="list__item" id="6956fbb8">                <p id="d7081acb"><a href="creating-and-running-your-first-python-project.html#create-file">Create a Python file</a>, <span class="filepath">user_database.py</span>,                    to work with the newly created database. Use <a href="https://docs.sqlalchemy.org/en/latest/orm/extensions/declarative/basic_use.html" data-bypass="yes" target="_blank"><span>SQLAlchemy declarative base</span></a> syntax to describe the database.                    <div class="code-block" data-lang="Python"><code class="code-block__wrapper"><span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">&#39;sqlite:///user_database&#39;</span><span class="p">,</span> <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;check_same_thread&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">},</span> <span class="n">echo</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>  <span class="c"># echo=False</span>
<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>
<span class="n">db_session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)()</span>


<span class="c"># Table city</span>
<span class="k">class</span> <span class="nc">City</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">&#39;city&#39;</span>
    <span class="n">city_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">city_name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="n">city_climate</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="n">city_meteo_data</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s">&quot;Meteo&quot;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s">&quot;city&quot;</span><span class="p">)</span>


<span class="c"># Table meteo</span>
<span class="k">class</span> <span class="nc">Meteo</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">&#39;meteo&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">city_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;city.city_id&#39;</span><span class="p">))</span>
    <span class="n">month</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="n">average_humidity</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>
    <span class="n">average_temperature</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Float</span><span class="p">)</span></code></div>                </p>                <p id="d896bdab">Instead of manually adding import statements for the code fragment, apply the suggested                <a href="intention-actions.html">quick fixes</a>: just click the bulb icon (or press <kbd data-primary_default="Alt+Enter" data-primary_default_for_gnome="Alt+Enter" data-primary_default_for_kde="Alt+Enter" data-primary_default_for_xwin="Alt+Enter" data-primary_emacs="Alt+Enter" data-primary_visual_studio="Alt+Enter" data-primary_netbeans="Alt+Enter" data-primary_eclipse="Alt+Enter" data-secondary_mac_os_x_10.5_="⌥⏎" data-secondary_mac_os_x="⌥⏎" data-secondary_eclipse_mac_os_x="⌘1" data-secondary_intellij_idea_classic_os_x="N/A" data-secondary_xcode="N/A" data-secondary_visual_studio="⌥⏎" data-secondary_resharper="N/A" data-secondary_resharper_osx="N/A" data-secondary_emacs="⌥⏎">Alt+Enter</kbd>).                <figure><img alt="Applying quick fixes for the missing import statements" title="Applying quick fixes for the missing import statements" src="../img/idea/2019.1/py_flask_meteo_import.png" id="1d5b7684" width="587" height="292"></figure></p>            </li><li class="list__item" id="6097fbd0">                <p id="39ae02e9">Now that you have defined the tables and their relationship, add the following functions to retrieve data from the database:                </p>                <div class="code-block" data-lang="Python"><code class="code-block__wrapper"><span class="c"># Retrieving data from the database</span>
<span class="k">def</span> <span class="nf">get_cities</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">db_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">City</span><span class="p">)</span>


<span class="c"># Generating the set of average temperature values for a particular city</span>
<span class="k">def</span> <span class="nf">get_city_temperature</span><span class="p">(</span><span class="n">city</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">month</span><span class="o">.</span><span class="n">average_temperature</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">city</span><span class="o">.</span><span class="n">city_meteo_data</span><span class="p">]</span>


<span class="c"># Generating the set of average humidity values for a particular city</span>
<span class="k">def</span> <span class="nf">get_city_humidity</span><span class="p">(</span><span class="n">city</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">month</span><span class="o">.</span><span class="n">average_humidity</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">city</span><span class="o">.</span><span class="n">city_meteo_data</span><span class="p">]</span>


<span class="n">data</span> <span class="o">=</span> <span class="n">get_cities</span><span class="p">()</span>
<span class="n">MONTHS</span> <span class="o">=</span> <span class="p">[</span><span class="n">record</span><span class="o">.</span><span class="n">month</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">city_meteo_data</span><span class="p">]</span>
<span class="n">CITIES</span> <span class="o">=</span> <span class="p">[</span><span class="n">city</span><span class="o">.</span><span class="n">city_name</span> <span class="k">for</span> <span class="n">city</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span></code></div>            </li></ol><aside class="note " data-title="" rel="6097fbd0" id="18106ec8"><p id="ced66fa1">See the complete code of the <a href="https://github.com/allaredko/flask-tutorial-demo/blob/master/user_database.py" data-bypass="yes" target="_blank"><span>user_database.py</span></a> file in the                project repository.</p></aside></section>    </div>    <div class="chapter"><h2 id="scatter_chart" data-toc="Creating_Web_Application_with_Flask#scatter_chart">Plotting the scatter chart</h2>        <p id="618eeef8">You are ready to retrieve data and build the first graph - the scatter chart with the yearly average temperature and humidity            in each city. Use the <a href="https://matplotlib.org/" data-bypass="yes" target="_blank"><span>matplotlib</span></a> library to set up the graph and assign the values.</p>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="94f3e34a">            <p id="5d1defe4"><a href="creating-and-running-your-first-python-project.html#create-file">Create yet another Python file</a>, <span class="filepath">charts.py</span>, and paste the            following code fragment:</p>            <div class="code-block" data-lang="Python"><code class="code-block__wrapper"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">user_database</span> <span class="kn">import</span> <span class="n">data</span><span class="p">,</span> <span class="n">get_city_temperature</span><span class="p">,</span> <span class="n">get_city_humidity</span><span class="p">,</span> <span class="n">CITIES</span>

<span class="n">yearly_temp</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">yearly_hum</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">city</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">yearly_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">get_city_temperature</span><span class="p">(</span><span class="n">city</span><span class="p">))</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">yearly_hum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">get_city_humidity</span><span class="p">(</span><span class="n">city</span><span class="p">))</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">yearly_hum</span><span class="p">,</span> <span class="n">yearly_temp</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Yearly Average Temperature/Humidity&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Yearly Average Temperature&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Yearly Average Relative Humidity&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">txt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">CITIES</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="p">(</span><span class="n">yearly_hum</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">yearly_temp</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></div>            </li><li class="list__item" id="867d221e"><p>The quickest way to preview the graph is to use the <kbd data-primary_default="Shift+F10" data-primary_default_for_gnome="Shift+F10" data-primary_default_for_kde="Shift+F10" data-primary_default_for_xwin="Shift+F10" data-primary_emacs="Shift+F10" data-primary_visual_studio="Ctrl+F5" data-primary_netbeans="F6" data-primary_eclipse="Shift+Alt+X" data-secondary_mac_os_x_10.5_="⌃R" data-secondary_mac_os_x="⇧F10" data-secondary_eclipse_mac_os_x="⇧⌘F11" data-secondary_intellij_idea_classic_os_x="N/A" data-secondary_xcode="N/A" data-secondary_visual_studio="⌃F5" data-secondary_resharper="N/A" data-secondary_resharper_osx="N/A" data-secondary_emacs="⇧F10">Shift+F10</kbd> shortcut. PyCharm renders the scatter chart            in the <span class="control">SciView</span> tool window. You can use the <span class="control">Plots</span> tab to            preview the generated graph.            <figure><img alt="Previewing a scatter chart" title="Previewing a scatter chart" src="../img/idea/2019.1/py_flask_meteo_scatter_chart.png" id="e74066c4" width="800" height="877"></figure>            </p></li><li class="list__item" id="374767a6">                <p id="601b8811">Now save the graph into an image so that you can add it to the main page of your application. Replace                <code class="code">plt.show()</code> with the fragment that utilizes the <code class="code">savefig(img)</code> function:</p>                <div class="code-block" data-lang="Python"><code class="code-block__wrapper"><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">user_database</span> <span class="kn">import</span> <span class="n">data</span><span class="p">,</span> <span class="n">MONTHS</span><span class="p">,</span> <span class="n">get_city_temperature</span><span class="p">,</span> <span class="n">get_city_humidity</span><span class="p">,</span> <span class="n">CITIES</span>


<span class="k">def</span> <span class="nf">get_main_image</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Rendering the scatter chart&quot;&quot;&quot;</span>
    <span class="n">yearly_temp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">yearly_hum</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">city</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">yearly_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">get_city_temperature</span><span class="p">(</span><span class="n">city</span><span class="p">))</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">yearly_hum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">get_city_humidity</span><span class="p">(</span><span class="n">city</span><span class="p">))</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">yearly_hum</span><span class="p">,</span> <span class="n">yearly_temp</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Yearly Average Temperature/Humidity&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Yearly Average Temperature&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Yearly Average Relative Humidity&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">txt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">CITIES</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="p">(</span><span class="n">yearly_hum</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">yearly_temp</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

    <span class="n">img</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">img</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span></code></div>            </li></ol></section>    </div>    <div class="chapter"><h2 id="main" data-toc="Creating_Web_Application_with_Flask#main">Creating the Main Page</h2>        <p id="e5adfe8d">Set up the main page of the application and create a view for the scatter chart.</p>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="a136871a">        <p id="04bc3f68">Replace the <code class="code">app.route()</code> code fragment in the <span class="filepath">app.py</span> file with the following code:</p>        <div class="code-block" data-lang="Python"><code class="code-block__wrapper"><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Entry point; the view for the main page&quot;&quot;&quot;</span>
    <span class="n">cities</span> <span class="o">=</span> <span class="p">[(</span><span class="n">record</span><span class="o">.</span><span class="n">city_id</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">city_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">&#39;main.html&#39;</span><span class="p">,</span> <span class="n">cities</span><span class="o">=</span><span class="n">cities</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/main.png&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">main_plot</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;The view for rendering the scatter chart&quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">get_main_image</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;image/png&#39;</span><span class="p">,</span> <span class="n">cache_timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code></div>        </li><li class="list__item" id="5354ee8e"><p id="af70ceb6">Apply the suggested quick fixes to add the missing import statements.</p>        </li><li class="list__item" id="038a352f">            <p id="ed0c4436">Note that PyCharm highlights <span class="filepath">main.html</span> because you have not created this file yet.            <figure><img alt="Code inspection" title="Code inspection" src="../img/idea/2019.1/py_flask_meteo_code_inspection.png" id="4706632e" width="489" height="245"></figure></p>            <p id="423d536b">With PyCharm intention action you can quickly create the missing template file.                Press <kbd data-primary_default="Alt+Enter" data-primary_default_for_gnome="Alt+Enter" data-primary_default_for_kde="Alt+Enter" data-primary_default_for_xwin="Alt+Enter" data-primary_emacs="Alt+Enter" data-primary_visual_studio="Alt+Enter" data-primary_netbeans="Alt+Enter" data-primary_eclipse="Alt+Enter" data-secondary_mac_os_x_10.5_="⌥⏎" data-secondary_mac_os_x="⌥⏎" data-secondary_eclipse_mac_os_x="⌘1" data-secondary_intellij_idea_classic_os_x="N/A" data-secondary_xcode="N/A" data-secondary_visual_studio="⌥⏎" data-secondary_resharper="N/A" data-secondary_resharper_osx="N/A" data-secondary_emacs="⌥⏎">Alt+Enter</kbd> and select <span class="control">Create template main.html</span> from the                context menu. Confirm the name and location of the template file and click <span class="control">OK</span>.                As the result, the <span class="filepath">main.html</span> will be added to the <span class="filepath">templates</span> directory.                Open the newly added file and paste the following code into it:</p>            <div class="code-block" data-lang="HTML"><code class="code-block__wrapper"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;../static/style.css&quot;</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>Typical Climate<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;element1&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">&quot;{{ url_for(&#39;main_plot&#39;) }}&quot;</span> <span class="na">alt=</span><span class="s">&quot;Image&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;element2&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;p&gt;</span>What city has the best climate?<span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;p&gt;</span>When planning your trip or vacation you often check weather data for
                humidity and temperature.<span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;p&gt;</span>Below is the collection of the yearly average values for the following cities: <span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;ul&gt;</span>
                {% for city_id, city_name in cities %}
                <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>{{ city_name }}<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                {% endfor %}
        <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></div>            <p id="c8c04c5f">Note that <code class="code">{{ city_name }}</code> in this fragment is a <a href="http://jinja.pocoo.org/" data-bypass="yes" target="_blank"><span>Jinja2</span></a> template variable used to pass the <code class="code">city_name</code> Python variable                to the HTML template.            </p>        </li><li class="list__item" id="ec016a8d">            <p id="e5887d58">Also create the stylesheet to set up font and layout settings for all HTML pages in your application.            Right-click the <span class="control">static</span> directory and select <span data-skip-index="skip" class="menupath">New | Stylesheet</span>, then                specify the name of the <code class="code">.css</code> file, <span class="filepath">style.css</span>, and paste the following style definitions:</p>            <div class="code-block" data-lang="CSS"><code class="code-block__wrapper"><span class="nt">body</span>
<span class="p">{</span>
    <span class="k">font-family</span><span class="o">:</span> <span class="s2">&quot;Helvetica Neue&quot;</span><span class="o">,</span> <span class="n">Helvetica</span><span class="o">,</span> <span class="n">Arial</span><span class="o">,</span> <span class="k">sans-serif</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#element1</span>
<span class="p">{</span>
    <span class="k">display</span><span class="o">:</span> <span class="k">inline</span><span class="o">-</span><span class="k">block</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">#element2</span>
<span class="p">{</span>
    <span class="k">display</span><span class="o">:</span> <span class="k">inline</span><span class="o">-</span><span class="k">block</span><span class="p">;</span>
    <span class="k">vertical-align</span><span class="o">:</span> <span class="k">top</span><span class="p">;</span>
    <span class="k">margin-top</span><span class="o">:</span> <span class="m">90px</span><span class="p">;</span>
    <span class="n">alignment</span><span class="o">:</span> <span class="k">left</span><span class="p">;</span>
    <span class="k">width</span><span class="o">:</span> <span class="m">25%</span><span class="p">;</span>
<span class="p">}</span></code></div>            <aside class="note " data-title="" rel="e98b100a" id="025374e5"><p id="0a7557d2">PyCharm will autocomplete identifiers such as <code class="code">#element1</code> from those used in the project HTML files.</p></aside>        </li><li class="list__item" id="838aebab">            <p id="0c5367ab">When you run the application for the very first time, PyCharm automatically generated the Run/Debug                configuration. You can use it to run the modified application any time you want to evaluate the result.                <figure><img alt="Run/Debug configuration" title="Run/Debug configuration" src="../img/idea/2019.1/py_flask_meteo_run_debug_configuration.png" id="0d44b3da" width="282" height="53"></figure>            </p>            <p id="bd3bf753">Click the <img class="inline-icon-16" src="../img/idea/2019.1/artwork.studio.icons.avd.run@2x.png" width="16" alt="the Run button"> and follow the                <span class="filepath">http://127.0.0.1:5000/</span> link in the <span class="control">Run</span> tool window. You should expect to see the            following page:            <figure><img alt="The main page of the MeteoMaster application" title="The main page of the MeteoMaster application" src="../img/idea/2019.1/py_flask_meteo_main_page.png" id="3f52dbbc" width="700" height="569"></figure>            </p>            <aside class="note " data-title="" rel="bd3bf753" id="edbb7b29"><p id="5f091972">You can continuously rerun your application on any code change.  Click the list of the available configurations and select <span class="control">Edit Configurations</span>.                In the <a href="run-debug-configuration-flask-server.html">Flask Run/Debug configuration</a> dialog, select the                <span class="control">FLASK_DEBUG</span> checkbox. With this mode enabled, PyCharm will restart the running application each time you save the                code changes (<kbd data-primary_default="Ctrl+S" data-primary_default_for_gnome="Ctrl+S" data-primary_default_for_kde="Ctrl+S" data-primary_default_for_xwin="Ctrl+S" data-primary_emacs="Ctrl+X, Ctrl+S" data-primary_visual_studio="Ctrl+S" data-primary_netbeans="Ctrl+S" data-primary_eclipse="Ctrl+S" data-secondary_mac_os_x_10.5_="⌘S" data-secondary_mac_os_x="⌘S" data-secondary_eclipse_mac_os_x="⌘S" data-secondary_intellij_idea_classic_os_x="N/A" data-secondary_xcode="N/A" data-secondary_visual_studio="⌃S" data-secondary_resharper="N/A" data-secondary_resharper_osx="N/A" data-secondary_emacs="⌃X, ⌃S">Ctrl+S</kbd>).</p>            </aside>        </li></ol></section>    </div>    <div class="chapter"><h2 id="line_charts" data-toc="Creating_Web_Application_with_Flask#line_charts">Plotting line charts</h2>        <p id="e7826bc6">To provide application users with the detailed information about climate of a particular city, render the line charts with the        relevant information.</p>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="ee102a4b"><p id="1d2eb881">Modify the charts.py file by adding the <code class="code">get_city_image</code> function:</p>            <div class="code-block" data-lang="Python"><code class="code-block__wrapper"><span class="k">def</span> <span class="nf">get_city_image</span><span class="p">(</span><span class="n">city_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Rendering line charts with city specific data&quot;&quot;&quot;</span>
    <span class="n">city</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">city_id</span><span class="p">)</span>
    <span class="n">city_temp</span> <span class="o">=</span> <span class="n">get_city_temperature</span><span class="p">(</span><span class="n">city</span><span class="p">)</span>
    <span class="n">city_hum</span> <span class="o">=</span> <span class="n">get_city_humidity</span><span class="p">(</span><span class="n">city</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MONTHS</span><span class="p">,</span> <span class="n">city_temp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Mean Daily Temperature&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MONTHS</span><span class="p">,</span> <span class="n">city_hum</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Average Relative Humidity&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">city</span><span class="o">.</span><span class="n">city_name</span><span class="p">)</span>

    <span class="n">img</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">img</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span></code></div>                <p id="e71cf14c">This function plots two linear charts: monthly <span class="keyword">Mean Daily Temperature</span> and <span class="keyword">Average Relative Humidity</span>                    for each city. Similarly to the <code class="code">get_main_image</code> function, it saves the chart in an image.</p>            </li><li class="list__item" id="d56297f7">                <p id="85b4232f">Create one more <code class="code">.html</code> file to show the line charts.</p>                <p id="71b15ffe">Right-click the <span class="control">templates</span> directory in the project root and select                <span data-skip-index="skip" class="menupath">New | HTML File</span>, then enter, <span class="filepath">city.html</span> as the file's name, and paste the                following code in the newly created file:</p>            </li><li class="list__item" id="9bd469d0"><p>                    <div class="code-block" data-lang="HTML"><code class="code-block__wrapper"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;../static/style.css&quot;</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>{{ city_name }}<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;element1&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">&quot;{{ url_for(&#39;city_plot&#39;, city_id=city_id) }}&quot;</span> <span class="na">alt=</span><span class="s">&quot;Image&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;element2&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;p&gt;</span>This graph shows mean daily temperature and average relative humidity in {{ city_name }}.<span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;p&gt;</span> {{ city_climate }}<span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;hr/&gt;</span>
        <span class="nt">&lt;p&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;/&quot;</span><span class="nt">&gt;</span>Back to the main page<span class="nt">&lt;/a&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></div>                </p></li><li class="list__item" id="8d48f305">                 <p id="05bad764">The remaining step is to create two more views using the <code class="code">Flask.route</code> function. Add the following code fragment to the                 <span class="filepath">app.py</span> file:</p>                 <div class="code-block" data-lang="Python"><code class="code-block__wrapper"><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/city/&lt;int:city_id&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">city</span><span class="p">(</span><span class="n">city_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Views for the city details&quot;&quot;&quot;</span>
    <span class="n">city_record</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">city_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">&#39;city.html&#39;</span><span class="p">,</span> <span class="n">city_name</span><span class="o">=</span><span class="n">city_record</span><span class="o">.</span><span class="n">city_name</span><span class="p">,</span> <span class="n">city_id</span><span class="o">=</span><span class="n">city_id</span><span class="p">,</span>
                           <span class="n">city_climate</span><span class="o">=</span><span class="n">city_record</span><span class="o">.</span><span class="n">city_climate</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/city&lt;int:city_id&gt;.png&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">city_plot</span><span class="p">(</span><span class="n">city_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Views for rendering city specific charts&quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">get_city_image</span><span class="p">(</span><span class="n">city_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;image/png&#39;</span><span class="p">,</span> <span class="n">cache_timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">,)</span></code></div>                 <p id="24e87149">Don't forget to use the quick fixes (<kbd data-primary_default="Alt+Enter" data-primary_default_for_gnome="Alt+Enter" data-primary_default_for_kde="Alt+Enter" data-primary_default_for_xwin="Alt+Enter" data-primary_emacs="Alt+Enter" data-primary_visual_studio="Alt+Enter" data-primary_netbeans="Alt+Enter" data-primary_eclipse="Alt+Enter" data-secondary_mac_os_x_10.5_="⌥⏎" data-secondary_mac_os_x="⌥⏎" data-secondary_eclipse_mac_os_x="⌘1" data-secondary_intellij_idea_classic_os_x="N/A" data-secondary_xcode="N/A" data-secondary_visual_studio="⌥⏎" data-secondary_resharper="N/A" data-secondary_resharper_osx="N/A" data-secondary_emacs="⌥⏎">Alt+Enter</kbd>) to add the missing import statements.</p>             </li><li class="list__item" id="13d0a2b5">                 <p id="9b939128">Now modify the <span class="filepath">main.html</span> file to populate the list of the cities with the links to the                 corresponding <span class="filepath">city/*</span> page. Replace <code class="code">&lt;li&gt;&lt;a href=""&gt;{{ city_name }}&lt;/a&gt;&lt;/li&gt;</code>                 with <code class="code">&lt;li&gt;&lt;a href="{{ url_for('city', city_id=city_id) }}"&gt;{{ city_name }}&lt;/a&gt;&lt;/li&gt;</code>.</p>             </li></ol><p id="dcfefde2">Rerun the Run/Debug configuration to restart the application and click the link that leads to Paris.                You should expect to get navigated to the <span class="filepath">city/2</span> page.</p><figure><img alt="Detailed weather information for Paris" title="Detailed weather information for Paris" src="../img/idea/2019.1/py_flask_meteo_line_chart.png" id="67fdaf1e" width="800" height="829"></figure></section>    </div>    <div class="chapter"><h2 id="login" data-toc="Creating_Web_Application_with_Flask#login">Creating a Login Form</h2>        <p id="4e8440e2">By this time, you have created a fully functional application that retrieves meteo data from the database and present them as charts.            However, in real life you typically want to edit the data. Reasonably, editing should only be permitted to authorized users, so, let's create a login form.</p>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="c5a321a4"><p id="dab85c6d">Right-click the <span class="control">templates</span> directory in the project root and select                <span data-skip-index="skip" class="menupath">New | HTML File</span>, then enter, <span class="filepath">login.html</span> as the file's name, and paste the                following code in the newly created file:</p>                <div class="code-block" data-lang="Python"><code class="code-block__wrapper"><span class="o">&lt;</span><span class="err">!</span><span class="n">DOCTYPE</span> <span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">html</span> <span class="n">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">meta</span> <span class="n">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">link</span> <span class="n">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s">&quot;../static/style.css&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Login</span> <span class="n">form</span> <span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">Login</span> <span class="n">to</span> <span class="n">edit</span> <span class="n">the</span> <span class="n">meteo</span> <span class="n">database</span><span class="p">:</span> <span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">form</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s">&quot;form-inline&quot;</span> <span class="n">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span> <span class="n">placeholder</span><span class="o">=</span><span class="s">&quot;Username&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;username&quot;</span>
                       <span class="n">value</span><span class="o">=</span><span class="s">&quot;{{ request.form.username }}&quot;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s">&quot;form-control&quot;</span> <span class="n">placeholder</span><span class="o">=</span><span class="s">&quot;Password&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;password&quot;</span>
                       <span class="n">value</span><span class="o">=</span><span class="s">&quot;{{ request.form.password }}&quot;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nb">input</span> <span class="n">class</span><span class="o">=</span><span class="s">&quot;btn btn-default&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;Login&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">error</span> <span class="p">}}</span> <span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span></code></div>                <p id="b42b16ff">This code implements a typical login form with the <span class="control">Username</span> and <span class="control">Password</span> fields.</p>            </li><li class="list__item" id="e5eb69a5">                <p id="321bb5b1">Add the following code to the <span class="filepath">app.py</span> file to create the Flask view for the login form and to control the login session.</p>                <div class="code-block" data-lang="Python"><code class="code-block__wrapper"><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/login/&lt;int:city_id&gt;&#39;</span><span class="p">,</span>  <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;GET&quot;</span><span class="p">,</span> <span class="s">&quot;POST&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">city_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The view for the login page&quot;&quot;&quot;</span>
    <span class="n">city_record</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">city_id</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">error</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;POST&quot;</span><span class="p">:</span>
            <span class="n">attempted_username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">]</span>
            <span class="n">attempted_password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">attempted_username</span> <span class="o">==</span> <span class="s">&#39;admin&#39;</span> <span class="ow">and</span> <span class="n">attempted_password</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;USER_PASSWORD&#39;</span><span class="p">]:</span>
                <span class="n">session</span><span class="p">[</span><span class="s">&#39;logged_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">session</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">&#39;edit_database&#39;</span><span class="p">,</span> <span class="n">city_id</span><span class="o">=</span><span class="n">city_id</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;invalid credentials&#39;</span><span class="p">)</span>
                <span class="n">error</span> <span class="o">=</span> <span class="s">&#39;Invalid credentials. Please, try again.&#39;</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">&#39;login.html&#39;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">city_name</span><span class="o">=</span><span class="n">city_record</span><span class="o">.</span><span class="n">city_name</span><span class="p">,</span> <span class="n">city_id</span><span class="o">=</span><span class="n">city_id</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">&#39;login.html&#39;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">city_name</span><span class="o">=</span><span class="n">city_record</span><span class="o">.</span><span class="n">city_name</span><span class="p">,</span> <span class="n">city_id</span><span class="o">=</span><span class="n">city_id</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">login_required</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;login session&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s">&#39;logged_in&#39;</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">&#39;login&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">wrap</span>


<span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;FLASK_WEB_APP_KEY&#39;</span><span class="p">]</span></code></div>                <p id="4e91402d">Use the <kbd data-primary_default="Alt+Enter" data-primary_default_for_gnome="Alt+Enter" data-primary_default_for_kde="Alt+Enter" data-primary_default_for_xwin="Alt+Enter" data-primary_emacs="Alt+Enter" data-primary_visual_studio="Alt+Enter" data-primary_netbeans="Alt+Enter" data-primary_eclipse="Alt+Enter" data-secondary_mac_os_x_10.5_="⌥⏎" data-secondary_mac_os_x="⌥⏎" data-secondary_eclipse_mac_os_x="⌘1" data-secondary_intellij_idea_classic_os_x="N/A" data-secondary_xcode="N/A" data-secondary_visual_studio="⌥⏎" data-secondary_resharper="N/A" data-secondary_resharper_osx="N/A" data-secondary_emacs="⌥⏎">Alt+Enter</kbd> shortcut to add the missing import statements. Note that this code fragment introduces two environmental variables: <code class="code">USER_PASSWORD</code>                    and <code class="code">FLASK_WEB_APP_KEY</code>.                    </p>            </li><li class="list__item" id="f1677ede">                <p id="0d92241e">You can record the values of the newly created environmental variables in the <span class="control">MeteoMaster</span> Run/Debug configuration as this is                    a safer way to store security sensitive information than hardcoding it in the <span class="filepath">app.py</span> file.</p>                <p id="8a52404d">Go to the Run/Debug configurations list on the top-right of the editor and select <span class="filepath">Edit configurations</span>.                Click the <img class="inline-icon-16" src="../img/idea/2019.1/icons.actions.menu-open_dark.svg@2x.png" width="16" alt="edit environmental variables"> icon in the <span class="control">Environmental variables</span> field and                add two variables.</p>                <figure><img alt="Adding environmental variables" title="Adding environmental variables" src="../img/idea/2019.1/py_flask_meteo_env_variables.png" id="d76cdbcd" width="700" height="877"></figure>            </li><li class="list__item" id="2fdba48e">                <p id="a43d79dd">Modify the <code class="code">&lt;div id="element2"&gt;</code> element in the <span class="filepath">city.html</span> file to accommodate login                facilities:</p>                <div class="code-block" data-lang="Python"><code class="code-block__wrapper"><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">This</span> <span class="n">graph</span> <span class="n">shows</span> <span class="n">mean</span> <span class="n">daily</span> <span class="n">temperature</span> <span class="ow">and</span> <span class="n">average</span> <span class="n">relative</span> <span class="n">humidity</span> <span class="ow">in</span> <span class="p">{{</span> <span class="n">city_name</span> <span class="p">}}</span><span class="o">.&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span> <span class="p">{{</span> <span class="n">city_climate</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s">&#39;logged_in&#39;</span><span class="p">]</span> <span class="o">%</span><span class="p">}</span>
<span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">Want</span> <span class="n">to</span> <span class="n">add</span> <span class="n">more</span> <span class="n">data</span><span class="err">?</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">Go</span> <span class="ow">and</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;edit_database&#39;, city_id=city_id) }}&quot;</span><span class="o">&gt;</span><span class="n">edit</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span> <span class="n">the</span> <span class="n">meteo</span> <span class="n">database</span><span class="o">.&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="k">else</span> <span class="o">%</span><span class="p">}</span>
<span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">Want</span> <span class="n">to</span> <span class="n">edit</span> <span class="n">meteo</span> <span class="n">data</span><span class="err">?</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">Please</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;login&#39;, city_id=city_id) }}&quot;</span><span class="o">&gt;</span><span class="n">login</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span> <span class="n">first</span><span class="o">.&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
<span class="o">&lt;</span><span class="n">hr</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="o">&gt;</span><span class="n">Back</span> <span class="n">to</span> <span class="n">the</span> <span class="n">main</span> <span class="n">page</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">p</span><span class="o">&gt;</span></code></div>            </li><li class="list__item" id="9f860e88"><p id="2a70fcc1">Restart the application and click any city link, then click the <span class="control">login</span> link in the "Please login first" sentence.                You should expect to see the login form.</p>            <figure><img alt="Login form" title="Login form" src="../img/idea/2019.1/py_flask_meteo_login_form.png" id="2f9d2506" width="438" height="277"></figure>            <p id="52b588d0">For time being, this form doesn't enable editing because you have not implemented the corresponding page. Meanwhile,            you can try to enter any incorrect password to check if it is processed with the message: "Invalid credentials. Please, try again."</p></li></ol></section>    </div>    <div class="chapter"><h2 id="edit" data-toc="Creating_Web_Application_with_Flask#edit">Editing the data</h2>        <p id="3d8f82ad">The last remaining step is to enable editing of the meteo data.</p>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="a4ff9037"><p id="2b361a9b">Right-click the <span class="control">templates</span> directory in the project root and select                <span data-skip-index="skip" class="menupath">New | HTML File</span>, then enter, <span class="filepath">edit.html</span> as the file's name, and paste the                following code in the newly created file:</p>                <div class="code-block" data-lang="HTML"><code class="code-block__wrapper"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">href=</span><span class="s">&quot;../static/style.css&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;title&gt;</span>Edit meteo data for {{ city_name }}<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;p&gt;</span>Edit the data for {{ city_name }} as appropriate:<span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;form</span> <span class="na">name=</span><span class="s">&quot;meteoInput&quot;</span> <span class="na">action=</span><span class="s">&quot;&quot;</span> <span class="na">class=</span><span class="s">&quot;form-inline&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;table&gt;</span>
                    <span class="nt">&lt;tr&gt;</span>
                        <span class="nt">&lt;td&gt;</span>Month<span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">&quot;2&quot;</span> <span class="na">align=</span><span class="s">&quot;center&quot;</span><span class="nt">&gt;</span>Average Temperature<span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">&quot;2&quot;</span> <span class="na">align=</span><span class="s">&quot;center&quot;</span><span class="nt">&gt;</span>Average Humidity<span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                    {% for month in months %}
                    <span class="nt">&lt;tr&gt;</span>
                        <span class="nt">&lt;td&gt;</span>{{ month }}<span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;input</span> <span class="na">placeholder=</span><span class="s">&quot;20&quot;</span> <span class="na">class=</span><span class="s">&quot;form-control&quot;</span> <span class="na">name=</span><span class="s">&quot;temperature{{ loop.index0 }}&quot;</span>
                                   <span class="na">value=</span><span class="s">&quot;{{ meteo[0][loop.index0]}}&quot;</span> <span class="na">type=</span><span class="s">&quot;range&quot;</span> <span class="na">min=</span><span class="s">&quot;-50.0&quot;</span> <span class="na">max=</span><span class="s">&quot;50.0&quot;</span> <span class="na">step=</span><span class="s">&quot;0.01&quot;</span>
                                   <span class="na">oninput=</span><span class="s">&quot;temp_output{{ loop.index0 }}.value=this.value&quot;</span> <span class="nt">&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">&quot;temp_output{{ loop.index0 }}&quot;</span><span class="nt">&gt;</span>{{ &#39;%0.2f&#39; % meteo[0][loop.index0]|float }}<span class="nt">&lt;/output&gt;</span>
                            <span class="nt">&lt;label&gt;</span> C<span class="nt">&lt;/label&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;input</span> <span class="na">placeholder=</span><span class="s">&quot;20&quot;</span> <span class="na">class=</span><span class="s">&quot;form-control&quot;</span> <span class="na">name=</span><span class="s">&quot;humidity{{ loop.index0 }}&quot;</span>
                                   <span class="na">value=</span><span class="s">&quot;{{ meteo[1][loop.index0]}}&quot;</span> <span class="na">type=</span><span class="s">&quot;range&quot;</span> <span class="na">min=</span><span class="s">&quot;0&quot;</span> <span class="na">max=</span><span class="s">&quot;100&quot;</span>
                                   <span class="na">oninput=</span><span class="s">&quot;hum_output{{ loop.index0 }}.value=this.value&quot;</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                        <span class="nt">&lt;td&gt;</span>
                            <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">&quot;hum_output{{ loop.index0 }}&quot;</span><span class="nt">&gt;</span>{{ meteo[1][loop.index0]}}<span class="nt">&lt;/output&gt;</span>
                            <span class="nt">&lt;label&gt;</span> %<span class="nt">&lt;/label&gt;</span>
                        <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;/tr&gt;</span>
                    {% endfor %}

                <span class="nt">&lt;/table&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">&quot;btn btn-default&quot;</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Save&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/form&gt;</span>
            <span class="nt">&lt;p&gt;</span>{{ error }}<span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></div>            <p id="75ae3b35">This fragment also utilizes a Jinjia2 template to process the input data and pass it to the Python code that            performs a commit to the database.</p>            </li><li class="list__item" id="77d0e583">                <p id="eb4bb6a3">Add one more code fragment to the <span class="filepath">app.py</span> file that creates a Flask view for the edit page, processes input data, and updates the database:</p>                <div class="code-block" data-lang="Python"><code class="code-block__wrapper"><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/edit/&lt;int:city_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;GET&quot;</span><span class="p">,</span> <span class="s">&quot;POST&quot;</span><span class="p">])</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">edit_database</span><span class="p">(</span><span class="n">city_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Views for editing city specific data&quot;&quot;&quot;</span>
    <span class="n">month_temperature</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">month_humidity</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">city_record</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">city_id</span><span class="p">)</span>
    <span class="n">meteo</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_city_temperature</span><span class="p">(</span><span class="n">city_record</span><span class="p">),</span> <span class="n">get_city_humidity</span><span class="p">(</span><span class="n">city_record</span><span class="p">)]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;POST&quot;</span><span class="p">:</span>
            <span class="c"># Get data from the form</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">):</span>
                <span class="c"># In a production application we ought to validate the input data</span>
                <span class="n">month_temperature</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="n">f</span><span class="s">&#39;temperature{i}&#39;</span><span class="p">]))</span>
                <span class="n">month_humidity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="n">f</span><span class="s">&#39;humidity{i}&#39;</span><span class="p">]))</span>

            <span class="c"># Database update</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">city_record</span><span class="o">.</span><span class="n">city_meteo_data</span><span class="p">):</span>
                <span class="n">month</span><span class="o">.</span><span class="n">average_temperature</span> <span class="o">=</span> <span class="n">month_temperature</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">month</span><span class="o">.</span><span class="n">average_humidity</span> <span class="o">=</span> <span class="n">month_humidity</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="n">db_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">&#39;main&#39;</span><span class="p">,</span> <span class="n">city_id</span><span class="o">=</span><span class="n">city_id</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">&#39;edit.html&#39;</span><span class="p">,</span> <span class="n">city_name</span><span class="o">=</span><span class="n">city_record</span><span class="o">.</span><span class="n">city_name</span><span class="p">,</span> <span class="n">city_id</span><span class="o">=</span><span class="n">city_id</span><span class="p">,</span> <span class="n">months</span><span class="o">=</span><span class="n">MONTHS</span><span class="p">,</span>
                                                          <span class="n">meteo</span><span class="o">=</span><span class="n">meteo</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">&#39;edit.html&#39;</span><span class="p">,</span> <span class="n">city_name</span><span class="o">=</span><span class="n">city_record</span><span class="o">.</span><span class="n">city_name</span><span class="p">,</span> <span class="n">city_id</span><span class="o">=</span><span class="n">city_id</span><span class="p">,</span> <span class="n">months</span><span class="o">=</span><span class="n">MONTHS</span><span class="p">,</span>
                      <span class="n">meteo</span><span class="o">=</span><span class="n">meteo</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span></code></div>                <p id="d7b52689">Don't forget to add the missing import statements. See the complete code of the  <a href="https://github.com/allaredko/flask-tutorial-demo/blob/master/app.py" data-bypass="yes" target="_blank"><span>app.py</span></a> file in the                    project repository.                </p>            </li></ol><p id="c76a28b8">With this step, you have completed the task of creating a Flask-based application that interacts with the database. Now you've got full power over the weather.            Go and modify meteo data for any of the cities, so that the changes be prominent on the charts. Then preview the changes.</p></section>    </div> --&gt;    <div class="last-modified" data-skip-index="skip">Last modified: 28 March 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="creating-flask-project.html">Creating a Flask Project</a><a class="navigation-links__next" href="pyramid.html">Pyramid</a></div><section class="seealso" data-skip-index="skip"><div class="seealso__header"><h2>See Also</h2></div><div class="seealso__content"><div class="seealso__col" data-skip-index="skip"><h3>Concepts:</h3><ul class="list"><li class="list__item"><a href="project.html"><span>Project</span></a></li></ul></div></div></section></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="../app/v2/app.js"></script></body></html>

























