<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>About Java Memory Usage</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Java Developer's Guide ">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Java Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="java-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-11T00:55:24-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="1999, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96468-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="Oracle-JVM-JIT.html" title="Previous" type="text/html">
      <link rel="next" href="database-Java-application-security.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Java Developer's Guide">
    <meta name="dcterms.isVersionOf" content="JJDEV">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="Oracle-JVM-JIT.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="database-Java-application-security.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Java Developer's Guide </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="Java-application-performance.html" property="item" typeof="WebPage"><span property="name"> Oracle Database Java Application Performance</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">About Java Memory Usage</li>
            </ol>
            <a id="GUID-D660F569-3654-4C5F-9D25-5D5A3E05E9AD" name="GUID-D660F569-3654-4C5F-9D25-5D5A3E05E9AD"></a><a id="JJDEV09200"></a>
            
            <h2 id="JJDEV-GUID-D660F569-3654-4C5F-9D25-5D5A3E05E9AD" class="sect2"><span class="enumeration_section">10.2 </span>About Java Memory Usage
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>The typical and custom database installation process furnishes a database that has <a id="d31438e87" class="indexterm-anchor"></a>been configured for reasonable Java usage during development. However, run-time use of Java should be determined by the usage of system resources for a given deployed application. Resources you use during development can vary widely, depending on your activity. <a id="d31438e92" class="indexterm-anchor"></a><a id="d31438e96" class="indexterm-anchor"></a>The following sections describe how you can configure memory, how to tell how much System Global Area (SGA) memory you are using, and what errors denote a Java memory issue:
               </p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="about-Java-memory-usage.html#GUID-0E6A9749-5505-4009-AEC6-47C84947DCFA">Configuring Memory Initialization Parameters</a></p>
                  </li>
                  <li>
                     <p><a href="about-Java-memory-usage.html#GUID-779A4ED1-5835-4D93-826A-EE812A2E04AA">About Java Pool Memory</a></p>
                  </li>
                  <li>
                     <p><a href="about-Java-memory-usage.html#GUID-C908F7F9-E272-406E-83CA-7776BF9636A7">Displaying Used Amounts of Java Pool Memory</a></p>
                  </li>
                  <li>
                     <p><a href="about-Java-memory-usage.html#GUID-9FFABC29-943A-4EE4-8ED4-640F6AB26E65">Correcting Out of Memory Errors</a></p>
                  </li>
                  <li>
                     <p><a href="about-Java-memory-usage.html#GUID-C1B28CC4-3107-4E41-B268-D19F81AA227F">Displaying Java Call and Session Heap Statistics</a></p>
                  </li>
               </ul>
            </div><a id="JJDEV13316"></a><div class="props_rev_3"><a id="GUID-0E6A9749-5505-4009-AEC6-47C84947DCFA" name="GUID-0E6A9749-5505-4009-AEC6-47C84947DCFA"></a><h3 id="JJDEV-GUID-0E6A9749-5505-4009-AEC6-47C84947DCFA" class="sect3"><span class="enumeration_section">10.2.1 </span>Configuring Memory Initialization Parameters
               </h3>
               <div>
                  <div class="section">
                     <p>You can modify the following database initialization parameters to tune your memory usage to reflect your application needs more accurately:</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a id="d31438e221" class="indexterm-anchor"></a><code class="codeph">SHARED_POOL_SIZE</code></p>
                           <p>Shared pool memory is used by the class loader within the JVM. The class loader, on an average, uses about 8 KB of memory for each loaded class. Shared pool memory is used when loading and resolving classes into the database. It is also used when compiling the source in the database or when using Java resource objects in the database.</p>
                           <p><a id="d31438e228" class="indexterm-anchor"></a>The memory specified in <code class="codeph">SHARED_POOL_SIZE</code> is consumed transiently when you use the <code class="codeph">loadjava</code> tool. The database initialization process requires <code class="codeph">SHARED_POOL_SIZE</code> to be set to 96 MB because it loads the Java binaries for approximately 8,000 classes and resolves them. The <code class="codeph">SHARED_POOL_SIZE</code> resource is also consumed when you create call specifications and as the system tracks dynamically loaded Java classes at run time.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">JAVA_POOL_SIZE</code></p>
                           <p>Oracle JVM memory manager uses <code class="codeph">JAVA_POOL_SIZE</code> mainly for in-memory representation of Java method and class definitions, and static Java states that are migrated to session space at end-of-call in shared server mode. In the first case, you will be sharing the memory cost with all Java users. In the second case, the value of <code class="codeph">JAVA_POOL_SIZE</code> varies according to the actual amount of state held in static variables for each session. But, Oracle recommends the minimum value as 50 MB.
                           </p>
                        </li>
                        <li>
                           <p><a id="d31438e259" class="indexterm-anchor"></a><code class="codeph">JAVA_SOFT_SESSIONSPACE_LIMIT</code></p>
                           <p>This parameter lets you specify a soft limit on Java memory usage in a session, which will warn you if you must increase your Java memory limits. Every time memory is allocated, the total memory allocated is checked against this limit.</p>
                           <p>When a user's session Java state exceeds this size, Oracle JVM generates a warning that is written into the trace files. Although this warning is an informational message and has no impact on your application, you should understand and manage the memory requirements of your deployed classes, especially as they relate to usage of session space.</p>
                           <div class="infoboxnote" id="GUID-0E6A9749-5505-4009-AEC6-47C84947DCFA__GUID-EA101A68-D342-46A2-A124-71ED6E4F7AC7">
                              <p class="notep1">Note:</p>
                              <p>This parameter is applicable only to a shared-server environment.</p>
                           </div>
                        </li>
                        <li>
                           <p><code class="codeph">JAVA_MAX_SESSIONSPACE_SIZE</code></p>
                           <p>If a Java program, which can be called by a user, running in the server can be used in a way that is not self-limiting in its memory usage, then this setting may be useful to place a hard limit on the amount of session space made available to it. The default is 4 GB. This limit is purposely set extremely high to be usually invisible.</p>
                           <p>When a user's session Java state attempts to exceeds this size, the application can receive an out-of-memory failure.</p>
                           <div class="infoboxnote" id="GUID-0E6A9749-5505-4009-AEC6-47C84947DCFA__GUID-EFF19A06-2295-4DC4-AB75-CFAE09D676FF">
                              <p class="notep1">Note:</p>
                              <p>This parameter is applicable only to a shared-server environment.</p>
                           </div>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="JJDEV13318"></a><a id="JJDEV13317"></a><div class="props_rev_3"><a id="GUID-585B3E77-1604-40AD-83D6-7FE450712A2A" name="GUID-585B3E77-1604-40AD-83D6-7FE450712A2A"></a><h4 id="JJDEV-GUID-585B3E77-1604-40AD-83D6-7FE450712A2A" class="sect4"><span class="enumeration_section">10.2.1.1 </span>Initializing Pool Sizes within Database Templates
                  </h4>
                  <div>
                     <div class="section">
                        <p>You can set the defaults for the following parameters in the database installation template:</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">JAVA_POOL_SIZE</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">SHARED_POOL_SIZE</code></p>
                           </li>
                        </ul>
                        <p><a href="about-Java-memory-usage.html#GUID-585B3E77-1604-40AD-83D6-7FE450712A2A__BABCECIC">Figure 10-1</a> illustrates how the Database Configuration Assistant enables you to modify these values in the Memory section.
                        </p>
                        <div class="figure" id="GUID-585B3E77-1604-40AD-83D6-7FE450712A2A__BABCECIC">
                           <p class="titleinfigure">Figure 10-1 Configuring Oracle JVM Memory Parameters</p><img width="507" src="img/dbca_poolnew.gif" alt="Description of Figure 10-1 follows" title="Description of Figure 10-1 follows" longdesc="img_text/dbca_poolnew.html"><br><a href="img_text/dbca_poolnew.html">Description of "Figure 10-1 Configuring Oracle JVM Memory Parameters"</a></div>
                        <!-- class="figure" -->
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="JJDEV13320"></a><a id="JJDEV13321"></a><a id="JJDEV13560"></a><a id="JJDEV13319"></a><div class="props_rev_3"><a id="GUID-779A4ED1-5835-4D93-826A-EE812A2E04AA" name="GUID-779A4ED1-5835-4D93-826A-EE812A2E04AA"></a><h3 id="JJDEV-GUID-779A4ED1-5835-4D93-826A-EE812A2E04AA" class="sect3"><span class="enumeration_section">10.2.2 </span>About Java Pool Memory
               </h3>
               <div>
                  <div class="section">
                     <p>Java pool memory is a subset of SGA, which is used exclusively by Java for memory that must be aligned pagewise. This includes the majority, but, not all of the memory used for the shared definitions of Java classes. Other uses of Java pool memory depend on the mode in which the Oracle Database server runs.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-779A4ED1-5835-4D93-826A-EE812A2E04AA__GUID-7A4C3F9C-707D-4CF2-974B-D6C799F01110">Java Pool Memory Used within a Dedicated Server</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>The following is what constitutes the Java pool memory used within a dedicated server:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Most of the shared part of each Java class in use.</p>
                           <p>This includes read-only memory, such as code vectors, and methods. In total, this can average about 4 KB to 8 KB for each class.</p>
                        </li>
                        <li>
                           <p>None of the per-session Java state of each session.</p>
                           <p>For a dedicated server, this is stored in the User Global Area (UGA) within the Program Global Area (PGA), and not within the SGA.</p>
                        </li>
                     </ul>
                     <p>Under dedicated servers, the total required Java pool memory depends on the applications running and usually ranges between 10 and 50 MB.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-779A4ED1-5835-4D93-826A-EE812A2E04AA__GUID-C2230E24-0099-4AAA-AAF9-49C1C905F2B4">Java Pool Memory Used within a Shared Server</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>The following constitutes the Java pool memory used within a shared server:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Most of the shared part of each Java class in use</p>
                           <p>This includes read-only memory, such as vectors and methods. In total, this memory usually averages to be about 4 KB to 8 KB for each class.</p>
                        </li>
                        <li>
                           <p>Some of the UGA for per session memory</p>
                           <p>In particular, the memory for objects that remain in use across Database calls is always allocated from Java pool.</p>
                           <p>Because the Java pool memory size is limited, you must estimate the total requirement for your applications and multiply by the number of concurrent sessions the applications want to create, to calculate the total amount of necessary Java pool memory. Each UGA grows and shrinks as necessary. However, all UGAs combined must be able to fit within the entire fixed Java pool space.</p>
                        </li>
                     </ul>
                     <p>Under shared servers, Java pool could be large. Java-intensive, multiuser applications could require more than 100 MB.</p>
                     <div class="infoboxnote" id="GUID-779A4ED1-5835-4D93-826A-EE812A2E04AA__GUID-578A0755-2B0E-4620-83E5-15EDFF9676BD">
                        <p class="notep1">Note:</p>
                        <p>If you are compiling code on the server, rather than compiling on the client and loading to the server, then you might need a bigger <code class="codeph">JAVA_POOL_SIZE</code> than the default 20 MB.
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-779A4ED1-5835-4D93-826A-EE812A2E04AA__GUID-24739C8A-AA56-4B6E-9823-99C4D1F79B1C">Reducing the Number of Java-Enabled Sessions</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>The top-level invocation of Java in the database is issued by a client-side application or utility. If each client has a dedicated server, then large-scale deployment involves significant consumption of resources on the database server and also leads to resource wastage. You can use Client-side connection pools or Database Resident Connection Pool (DRCP) to reduce the number of database processes and sessions.</p>
                     <div class="infoboxnotealso" id="GUID-779A4ED1-5835-4D93-826A-EE812A2E04AA__GUID-0A5A4CA6-6823-49D2-8F51-898199C42769">
                        <p class="notep1">See Also:</p>
                        <p><a href="../jjdbc/database-resident-connection-pooling.html#JJDBC29023" target="_blank"><span class="italic">Oracle Database JDBC Developer's Guide</span></a> for more information about DRCP
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDEV13322"></a><div class="props_rev_3"><a id="GUID-C908F7F9-E272-406E-83CA-7776BF9636A7" name="GUID-C908F7F9-E272-406E-83CA-7776BF9636A7"></a><h3 id="JJDEV-GUID-C908F7F9-E272-406E-83CA-7776BF9636A7" class="sect3"><span class="enumeration_section">10.2.3 </span>Displaying Used Amounts of Java Pool Memory
               </h3>
               <div>
                  <div class="section">
                     <p>You can find out how much of Java pool memory is being used by viewing the <a id="d31438e639" class="indexterm-anchor"></a><code class="codeph">V$SGASTAT</code> table. Its rows include pool, name, and bytes. Specifically, the last two rows show the amount of Java pool memory used and how much is free. The total of these two items equals the number of bytes that you configured in the database initialization file.
                     </p><pre class="oac_no_warn" dir="ltr">SVRMGR&gt; select * from v$sgastat;

POOL        NAME                            BYTES
----------- -------------------------- ----------
            fixed_sga                       69424
            db_block_buffers              2048000
            log_buffer                     524288
shared pool free memory                  22887532
shared pool miscellaneous                  559420
shared pool character set object            64080
shared pool State objects                   98504
shared pool message pool freequeue         231152
shared pool PL/SQL DIANA                  2275264
shared pool db_files                        72496
shared pool session heap                    59492
shared pool joxlod: init P                   7108
shared pool PLS non-lib hp                   2096
shared pool joxlod: in ehe                4367524
shared pool VIRTUAL CIRCUITS               162576
shared pool joxlod: in phe                2726452
shared pool long op statistics array        44000
shared pool table definiti                    160
shared pool KGK heap                         4372
shared pool table columns                  148336
shared pool db_block_hash_buckets           48792
shared pool dictionary cache              1948756
shared pool fixed allocation callback         320
shared pool SYSTEM PARAMETERS               63392
shared pool joxlod: init s                   7020
shared pool KQLS heap                     1570992
shared pool library cache                 6201988
shared pool trigger inform                  32876
shared pool sql area                      7015432
shared pool sessions                       211200
shared pool KGFF heap                        1320
shared pool joxs heap init                   4248
shared pool PL/SQL MPCODE                  405388
shared pool event statistics per sess      339200
shared pool db_block_buffers               136000
<span class="bold">java pool   free memory                  30261248</span>
<span class="bold">java pool   memory in use                19742720</span>
37 rows selected.
</pre></div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDEV13323"></a><div class="props_rev_3"><a id="GUID-9FFABC29-943A-4EE4-8ED4-640F6AB26E65" name="GUID-9FFABC29-943A-4EE4-8ED4-640F6AB26E65"></a><h3 id="JJDEV-GUID-9FFABC29-943A-4EE4-8ED4-640F6AB26E65" class="sect3"><span class="enumeration_section">10.2.4 </span>Correcting Out of Memory Errors
               </h3>
               <div>
                  <div class="section">
                     <p>If you run out of memory while loading classes, then it can fail silently, leaving invalid classes in the database. Later, if you try to call or resolve any invalid classes, then a <code class="codeph">ClassNotFoundException</code> or <code class="codeph">NoClassDefFoundException</code> instance will be thrown at run time. You would get the same exceptions if you were to load corrupted class files. You should perform the following:
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Verify that the class was actually included in the set you are loading to the server.</p>
                        </li>
                        <li>
                           <p><a id="d31438e755" class="indexterm-anchor"></a>Use the <code class="codeph">loadjava -force</code> option to force the new class being loaded to replace the class already resident in the server.
                           </p>
                        </li>
                        <li>
                           <p>Use the <code class="codeph">loadjava -resolve</code> option to attempt resolution of a class during the load process. This enables you to catch missing classes at load time, rather than at run time.
                           </p>
                        </li>
                        <li>
                           <p>Double check the status of the newly loaded class by connecting to the database in the schema containing the class, and run the following:</p><pre class="oac_no_warn" dir="ltr">SELECT * FROM user_objects WHERE object_name = dbms_java.shortname('');
</pre><p>The <code class="codeph">STATUS</code> field should be <code class="codeph">VALID</code>. If the <code class="codeph">loadjava</code> tool complains about memory problems or failures, such as lost connection, then increase <code class="codeph">SHARED_POOL_SIZE</code> and <code class="codeph">JAVA_POOL_SIZE</code>, and try again.
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDEV13324"></a><div class="props_rev_3"><a id="GUID-C1B28CC4-3107-4E41-B268-D19F81AA227F" name="GUID-C1B28CC4-3107-4E41-B268-D19F81AA227F"></a><h3 id="JJDEV-GUID-C1B28CC4-3107-4E41-B268-D19F81AA227F" class="sect3"><span class="enumeration_section">10.2.5 </span>Displaying Java Call and Session Heap Statistics
               </h3>
               <div>
                  <div class="section">
                     <p>Database performance view <code class="codeph">v$sesstat</code> records a number of Java memory usage statistics. These statistics are updated often during Java calls. The following example shows the Java call return and session heap statistics for the database session with SID=102.
                     </p><pre class="oac_no_warn" dir="ltr">SQL&gt; select s.sid, n.name p_name, st.value from v$session s, v$sesstat st, v$statname n where s.sid=102 
 and s.sid=st.sid and n.statistic# = st.statistic# and n.name like 'java%';

 SID P_NAME                                        VALUE
   ---------- ---------------------------------------- ----------
          102 java call heap total size                   6815744
          102 java call heap total size max               6815744
          102 java call heap used size                     668904
          102 java call heap used size max                 846920
          102 java call heap live size                     667112
          102 java call heap live size max                 704312
          102 java call heap object count                   13959
          102 java call heap object count max               17173
          102 java call heap live object count              13907
          102 java call heap live object count max          14916
          102 java call heap gc count                      432433
          102 java call heap collected count            123196423
          102 java call heap collected bytes           5425972216
          102 java session heap used size                  444416
          102 java session heap used size max              444416
          102 java session heap live size                  444416
          102 java session heap live size max              444416
          102 java session heap object count                    0
          102 java session heap object count max                0
          102 java session heap live object count               0
          102 java session heap live object count max           0
          102 java session heap gc count                        0
          102 java session heap collected count                 0
          102 java session heap collected bytes                 0
   
   24 rows selected.
</pre></div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>