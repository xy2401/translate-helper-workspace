<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="You can use Oracle XML&nbsp;DB Repository to store and access data of any kind, in the form of repository resources. You can access repository data from any application. Sometimes your application needs to perform certain actions whenever a particular repository operation occurs. You can do this using repository events.">
      <meta name="description" content="You can use Oracle XML&nbsp;DB Repository to store and access data of any kind, in the form of repository resources. You can access repository data from any application. Sometimes your application needs to perform certain actions whenever a particular repository operation occurs. You can do this using repository events.">
      <title>Oracle XML&nbsp;DB Repository Events</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Developer's Guide ">
      <meta property="og:description" content="You can use Oracle XML&nbsp;DB Repository to store and access data of any kind, in the form of repository resources. You can access repository data from any application. Sometimes your application needs to perform certain actions whenever a particular repository operation occurs. You can do this using repository events.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="xml-db-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-03-30T12:32:42-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="2002, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96222-03">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="user-defined-repository-metadata.html" title="Previous" type="text/html">
      <link rel="next" href="how-to-write-XML-DB-applications-in-Java.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="XML DB Developer's Guide">
    <meta name="dcterms.isVersionOf" content="ADXDB">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="user-defined-repository-metadata.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="how-to-write-XML-DB-applications-in-Java.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Developer's Guide </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="XML-DB-repository.html" property="item" typeof="WebPage"><span property="name"> Oracle XML&nbsp;DB Repository</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Oracle XML&nbsp;DB Repository Events</li>
            </ol>
            <a id="GUID-1A25D4D1-2353-41FC-9D86-9C35F9F95532" name="GUID-1A25D4D1-2353-41FC-9D86-9C35F9F95532"></a><a id="ADXDB2580"></a>
            
            <h2 id="ADXDB-GUID-1A25D4D1-2353-41FC-9D86-9C35F9F95532" class="sect2"><span class="enumeration_chapter">30 </span> Oracle XML&nbsp;DB Repository Events
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>You can use Oracle XML&nbsp;DB Repository to store and access data of any kind, in the form of repository resources. You can access repository data from any application. Sometimes your application needs to perform certain actions whenever a particular repository operation occurs. You can do this using repository events.</p>
               <div class="section"></div>
               <!-- class="section" -->
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-33531811-B433-4257-A176-88D7AAAD48EC">Overview of Repository Events</a><br>Your application can perform specific actions when events associated with repository operations occur. For example, you might want to perform a move-to-wastebasket or another backup action whenever a resource is deleted. 
                  </li>
                  <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-5F7D0772-848D-49EA-832B-AB1117B9E3F1">Possible Repository Events</a><br>Repository operations are associated with predefined events. Except for a rendering operation, events come in pre and post pairs.
                  </li>
                  <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-5821696E-5128-4221-9E9F-D36E2ACE5834">Repository Operations and Events</a><br>The same repository event can occur with different Oracle XML&nbsp;DB Repository operations, and a given repository operation can produce more than one repository event.
                  </li>
                  <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-C4139224-FF34-4B6D-9B68-481FA41E634C">Repository Event Handler Considerations</a><br>Some considerations are listed for defining handlers for Oracle XML&nbsp;DB Repository events.
                  </li>
                  <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-C7D110F1-CB15-475B-83E6-7C186DF0E119">Configuration of Repository Events</a><br>In a resource configuration file, you use element <code class="codeph">event-listeners</code>, child of element <code class="codeph">ResConfig</code>, to configure Oracle XML&nbsp;DB Repository event handling. 
                  </li>
               </ul>
               <div class="relinfo">
                  <p><strong>Related Topics</strong></p>
                  <ul>
                     <li><a href="configuration-of-XML-DB-repository.html#GUID-E44B59D4-7A7E-4303-ACE3-B801797B06AF" title="Overall configuration of Oracle XML&nbsp;DB Repository applies to all repository resources. It does not include configuring parameters for handling events or managing XLink and XInclude processing. You use resource configuration files to configure resources.">Configuration of Oracle XML&nbsp;DB Repository</a></li>
                  </ul>
               </div>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>Parent topic:</strong> <a href="XML-DB-repository.html#GUID-840EBE35-8FC8-4150-9FC8-78442FD1B12B" title="Oracle XML&nbsp;DB Repository lets you version your data, implement and manage security, and use APIs to access and manipulate repository resources.">Oracle XML&nbsp;DB Repository</a></p>
                  </div>
               </div>
            </div>
            <a id="ADXDB5591"></a><div class="props_rev_3"><a id="GUID-33531811-B433-4257-A176-88D7AAAD48EC" name="GUID-33531811-B433-4257-A176-88D7AAAD48EC"></a><h3 id="ADXDB-GUID-33531811-B433-4257-A176-88D7AAAD48EC" class="sect3"><span class="enumeration_section">30.1 </span>Overview of Repository Events
               </h3>
               <div>
                  <p>Your application can perform specific actions when events associated with repository operations occur. For example, you might want to perform a move-to-wastebasket or another backup action whenever a resource is deleted. </p>
                  <p>Repository resource operations include creating, deleting, locking, unlocking, rendering, linking, unlinking, placing under version control, checking in, checking out, unchecking out (reverting a checked out version), opening, and updating. </p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-8D76D959-A3B7-4401-9024-ADB29A703B36">Repository Events: Use Cases</a><br>Examples of cases where you can use repository events include moving a resource to a wastebasket and categorizing a resource based on its MIME type. 
                     </li>
                     <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-9CC45EFA-9CBF-415D-A150-911F0A64A087">Repository Events and Database Triggers</a><br>You cannot use a database trigger to let your application react to repository operations. A given repository operation can consist of multiple database operations on multiple underlying, internal tables. Because these underlying tables are internal to Oracle XML&nbsp;DB, you cannot easily map them to specific repository operations. 
                     </li>
                     <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-65551F91-CDC8-4053-A2F6-E949027BD604">Repository Event Listeners and Event Handlers</a><br>Each repository operation is associated with events. Your application can configure event listeners for particular resources or the entire repository. A listener can be restricted by a node-existence precondition. A listener is a set of PL/SQL or Java handlers, each of which processes a single event.
                     </li>
                     <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-AC610F25-FF1F-418E-8F92-515C219E9523">Repository Event Configuration</a><br>Repository event configuration involves defining resource configuration files and defining the order in which they are processed. The files define event listeners. Such configuration applies to events on individual resources and events for the repository as a whole.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="XML-DB-repository-events.html#GUID-1A25D4D1-2353-41FC-9D86-9C35F9F95532" title="You can use Oracle XML&nbsp;DB Repository to store and access data of any kind, in the form of repository resources. You can access repository data from any application. Sometimes your application needs to perform certain actions whenever a particular repository operation occurs. You can do this using repository events.">Oracle XML&nbsp;DB Repository Events</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADXDB5592"></a><div class="props_rev_3"><a id="GUID-8D76D959-A3B7-4401-9024-ADB29A703B36" name="GUID-8D76D959-A3B7-4401-9024-ADB29A703B36"></a><h4 id="ADXDB-GUID-8D76D959-A3B7-4401-9024-ADB29A703B36" class="sect4"><span class="enumeration_section">30.1.1 </span>Repository Events: Use Cases
                  </h4>
                  <div>
                     <p>Examples of cases where you can use repository events include moving a resource to a wastebasket and categorizing a resource based on its MIME type. </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><span class="italic">Wastebasket &#x2013;</span> You can use an <code class="codeph">UnLink</code> pre-event handler to effectively move a resource to a wastebasket instead of deleting it. Create a link in a wastebasket folder before removing the original link. The link in the wastebasket ensures that the resource is not removed. When you subsequently undelete a resource from the waste basket, the original link can be created again and the wastebasket link removed. The wastebasket link name can be different from the name of the link being removed because a resource at a certain path could be unlinked more than once from that path. The wastebasket would then have multiple links corresponding to that path, with different link properties and possibly pointing to different resources. 
                           </p>
                        </li>
                        <li>
                           <p><span class="italic">Categorization &#x2013;</span> An application might categorize the resources it manages based on MIME type or other properties. It might keep track of GIF, text, and XML files by maintaining links to them from repository folders <code class="codeph">/my-app/gif</code>, <code class="codeph">/my-app/txt</code>, and <code class="codeph">/my-app/xml</code>. Three post-event handlers could be used here: <code class="codeph">LinkIn</code>, <code class="codeph">UnlinkIn</code>, and <code class="codeph">Update</code>. The <code class="codeph">LinkIn</code> post-event handler would examine the resource and create a link in the appropriate category folder, if not already present. The <code class="codeph">UnlinkIn</code> post-event handler would remove the link from the category folder. The <code class="codeph">Update</code> post-event handler would effectively move the resource from one category folder to another if its category changes.
                           </p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="XML-DB-repository-events.html#GUID-33531811-B433-4257-A176-88D7AAAD48EC" title="Your application can perform specific actions when events associated with repository operations occur. For example, you might want to perform a move-to-wastebasket or another backup action whenever a resource is deleted.">Overview of Repository Events</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADXDB5593"></a><div class="props_rev_3"><a id="GUID-9CC45EFA-9CBF-415D-A150-911F0A64A087" name="GUID-9CC45EFA-9CBF-415D-A150-911F0A64A087"></a><h4 id="ADXDB-GUID-9CC45EFA-9CBF-415D-A150-911F0A64A087" class="sect4"><span class="enumeration_section">30.1.2 </span>Repository Events and Database Triggers
                  </h4>
                  <div>
                     <p>You cannot use a database trigger to let your application react to repository operations. A given repository operation can consist of multiple database operations on multiple underlying, internal tables. Because these underlying tables are internal to Oracle XML&nbsp;DB, you cannot easily map them to specific repository operations. </p>
                     <p>For example, internal table <code class="codeph">XDB$H_INDEX</code> might be updated by either a database update operation, if an ACL is changed, or a link operation. Even in cases where you might be able to accomplish the same thing using database triggers, you would not want to do that: A repository event is a higher-level abstraction than would be a set of database triggers on the underlying tables.
                     </p>
                     <p>When a repository event occurs, information associated with the operation, such as the resource path used, can be passed to the corresponding event handler. Such information is not readily available using database triggers.</p>
                     <p>Repository events and database triggers can both be applied to XML data. You can use triggers on <code class="codeph">XMLType</code> tables, for instance. However, if an <code class="codeph">XMLType</code> table is also a repository table (hierarchy-enabled), then do not duplicate in an event handler any trigger code that applies to the table. Otherwise, that code is executed twice.
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="XML-DB-repository-events.html#GUID-33531811-B433-4257-A176-88D7AAAD48EC" title="Your application can perform specific actions when events associated with repository operations occur. For example, you might want to perform a move-to-wastebasket or another backup action whenever a resource is deleted.">Overview of Repository Events</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADXDB5594"></a><div class="props_rev_3"><a id="GUID-65551F91-CDC8-4053-A2F6-E949027BD604" name="GUID-65551F91-CDC8-4053-A2F6-E949027BD604"></a><h4 id="ADXDB-GUID-65551F91-CDC8-4053-A2F6-E949027BD604" class="sect4"><span class="enumeration_section">30.1.3 </span>Repository Event Listeners and Event Handlers
                  </h4>
                  <div>
                     <p>Each repository operation is associated with events. Your application can configure event listeners for particular resources or the entire repository. A listener can be restricted by a node-existence precondition. A listener is a set of PL/SQL or Java handlers, each of which processes a single event.</p>
                     <p></p>
                     <p>A repository <strong class="term">event listener</strong> is a Java class or a PL/SQL package or object type. It comprises a set of PL/SQL procedures or Java methods, each of which is called an <strong class="term">event handler</strong>. 
                     </p>
                     <p>You associate a repository event listener with a resource by mapping a <strong class="term">resource configuration file</strong> to the resource. You use PL/SQL package <code class="codeph">DBMS_RESCONFIG</code> to manipulate resource configuration files, including associating them with the resources they configure. In particular, PL/SQL function <code class="codeph">DBMS_RESCONFIG.getListeners</code> lists all event listeners for a given resource. 
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="XML-DB-repository-events.html#GUID-33531811-B433-4257-A176-88D7AAAD48EC" title="Your application can perform specific actions when events associated with repository operations occur. For example, you might want to perform a move-to-wastebasket or another backup action whenever a resource is deleted.">Overview of Repository Events</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADXDB5595"></a><div class="props_rev_3"><a id="GUID-AC610F25-FF1F-418E-8F92-515C219E9523" name="GUID-AC610F25-FF1F-418E-8F92-515C219E9523"></a><h4 id="ADXDB-GUID-AC610F25-FF1F-418E-8F92-515C219E9523" class="sect4"><span class="enumeration_section">30.1.4 </span>Repository Event Configuration
                  </h4>
                  <div>
                     <p>Repository event configuration involves defining resource configuration files and defining the order in which they are processed. The files define event listeners. Such configuration applies to events on individual resources and events for the repository as a whole.</p>
                     <p>A given resource can be configured by multiple resource configuration files. These are stored in a <strong class="term">resource configuration list</strong>, and they are processed in list order. Events for the repository as a whole can also be configured by multiple resource configuration files. Similarly, the repository also has a resource configuration list. Event handling that is configured for the repository as a whole takes effect before any resource-specific event handling. All applicable repository-wide events are processed before any resource-specific events.
                     </p>
                     <p>A given resource configuration file can define multiple event listeners for the resources it configures, and each event listener can define multiple event handlers. </p>
                     <div class="section"></div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="XML-DB-repository-events.html#GUID-C7D110F1-CB15-475B-83E6-7C186DF0E119" title="In a resource configuration file, you use element event-listeners, child of element ResConfig, to configure Oracle XML&nbsp;DB Repository event handling.">Configuration of Repository Events</a></li>
                        </ul>
                     </div>
                     <div class="infoboxnotealso" id="GUID-AC610F25-FF1F-418E-8F92-515C219E9523__GUID-E13A1B35-9ADA-455A-9100-98BAF411026F">
                        <p class="notep1">See Also:</p>
                        <p><a href="configuration-of-XML-DB-repository.html#GUID-5ADEA709-733D-4E05-933A-AB1E7262D8AA" title="You configure an Oracle XML&nbsp;DB Repository resource for any purpose by associating it with a resource configuration file, which defines configurable parameters for the resource. A resource configuration file is itself a resource in Oracle XML&nbsp;DB Repository.">Resource Configuration Files</a> for general information about resource configuration and resource configuration lists
                        </p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="XML-DB-repository-events.html#GUID-33531811-B433-4257-A176-88D7AAAD48EC" title="Your application can perform specific actions when events associated with repository operations occur. For example, you might want to perform a move-to-wastebasket or another backup action whenever a resource is deleted.">Overview of Repository Events</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="ADXDB5597"></a><a id="ADXDB5596"></a><div class="props_rev_3"><a id="GUID-5F7D0772-848D-49EA-832B-AB1117B9E3F1" name="GUID-5F7D0772-848D-49EA-832B-AB1117B9E3F1"></a><h3 id="ADXDB-GUID-5F7D0772-848D-49EA-832B-AB1117B9E3F1" class="sect3"><span class="enumeration_section">30.2 </span>Possible Repository Events
               </h3>
               <div>
                  <p>Repository operations are associated with predefined events. Except for a rendering operation, events come in pre and post pairs.</p>
                  <p>A rendering operation is associated with a single repository event. Except for rendering, all repository operations are associated with one or more <span class="italic">pairs</span> of events. 
                  </p>
                  <p>For example, a resource creation is associated with three pairs of events, with the events occurring in this order:</p>
                  <ol>
                     <li>
                        <p>Pre-creation event</p>
                     </li>
                     <li>
                        <p>Post-creation event</p>
                     </li>
                     <li>
                        <p>Pre-link-in event</p>
                     </li>
                     <li>
                        <p>Pre-link-to event</p>
                     </li>
                     <li>
                        <p>Post-link-to event</p>
                     </li>
                     <li>
                        <p>Post-link-in event</p>
                     </li>
                  </ol>
                  <p><a href="XML-DB-repository-events.html#GUID-5F7D0772-848D-49EA-832B-AB1117B9E3F1__BABHJGBH" title="This table lists the events associated with each repository operation. Their order is indicated in the handler columns.">Table 30-1</a> lists the events associated with each repository operation. Their order is indicated in the handler columns. 
                  </p>
                  <div class="tblformalwide" id="GUID-5F7D0772-848D-49EA-832B-AB1117B9E3F1__BABHJGBH">
                     <p class="titleintable">Table 30-1 Predefined Repository Events</p>
                     <table cellpadding="4" cellspacing="0" class="FormalWide" title="Predefined Repository Events" summary="This table lists the events associated with each repository operation. Their order is indicated in the handler columns. " width="100%" frame="hsides" border="1" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="20%" id="d146411e511">Repository Event Type</th>
                              <th align="left" valign="bottom" width="36%" id="d146411e514">Description</th>
                              <th align="left" valign="bottom" width="23%" id="d146411e517">Pre Handler Execution</th>
                              <th align="left" valign="bottom" width="21%" id="d146411e520">Post Handler Execution</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e525" headers="d146411e511 ">
                                 <p><code class="codeph">Render</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e525 d146411e514 ">
                                 <p>A <code class="codeph">Render</code> event occurs only for <span class="italic">file</span> resources, never for folder resources.
                                 </p>
                                 <p>Occurs when resource contents are accessed using any of the following:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>Protocols</p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">XDBURIType</code> methods <code class="codeph">getCLOB()</code>, <code class="codeph">getBLOB()</code>, and <code class="codeph">getXML()</code></p>
                                    </li>
                                 </ul>
                                 <p>Does <span class="italic">not</span> occur when resource contents are accessed using any of the following:
                                 </p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p><code class="codeph">SELECT ... FROM RESOURCE_VIEW</code></p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">XDBURIType</code> method <code class="codeph">getResource()</code></p>
                                    </li>
                                 </ul>
                                 <p>Only one handler for a <code class="codeph">Render</code> event can set the rendered output. The first handler to call <code class="codeph">setRenderStream</code> or <code class="codeph">setRenderPath</code> controls the rendering.
                                 </p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e525 d146411e517 ">
                                 <p>N/A</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e525 d146411e520 ">
                                 <p>N/A</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e592" headers="d146411e511 ">
                                 <p><code class="codeph">Create</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e592 d146411e514 ">
                                 <p>Occurs when a resource is created. The pre and post handlers executed are those defined on the folder of the new resource.</p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e592 d146411e517 ">
                                 <p>After pre-parsing, after validating the parent resource ACL and locks, and before assigning default values to undefined properties.</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e592 d146411e520 ">
                                 <p>After inserting the resource into the system resource table.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e606" headers="d146411e511 ">
                                 <p><code class="codeph">Delete</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e606 d146411e514 ">
                                 <p>Occurs when the resource and its contents are removed from disk, that is, when the resource <code class="codeph">REF</code> count is zero (0).
                                 </p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e606 d146411e517 ">
                                 <p>After validating the resource ACL and locks and before removing the resource from disk.</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e606 d146411e520 ">
                                 <p>After removing the resource and its contents from disk and after touching the parent folder to update its last modifier and modification time.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e623" headers="d146411e511 ">
                                 <p><code class="codeph">Update</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e623 d146411e514 ">
                                 <p>Occurs when a resource is updated on disk.</p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e623 d146411e517 ">
                                 <p>After validating the resource ACL and locks and before updating the last modifier and modification time.</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e623 d146411e520 ">
                                 <p>After writing the resource to disk.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e637" headers="d146411e511 ">
                                 <p><code class="codeph">Lock</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e637 d146411e514 ">
                                 <p>Occurs during a lock-resource operation.</p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e637 d146411e517 ">
                                 <p>After validating the resource ACL and locks and before creating the new lock on the resource.</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e637 d146411e520 ">
                                 <p>After creating the new lock.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e651" headers="d146411e511 ">
                                 <p><code class="codeph">Unlock</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e651 d146411e514 ">
                                 <p>Occurs during an unlock-resource operation.</p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e651 d146411e517 ">
                                 <p>After validating the resource ACL and delete token.</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e651 d146411e520 ">
                                 <p>After removing the lock.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e665" headers="d146411e511 ">
                                 <p><code class="codeph">LinkIn</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e665 d146411e514 ">
                                 <p>Occurs before a <code class="codeph">LinkTo</code> event during a link operation. The event target is the folder in which the link is created. Always accompanied by a <code class="codeph">LinkTo</code> event.
                                 </p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e665 d146411e517 ">
                                 <p>After validating the resource ACL and locks and before creating the link.</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e665 d146411e520 ">
                                 <p>After executing <code class="codeph">LinkTo</code> post handler.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e688" headers="d146411e511 ">
                                 <p><code class="codeph">LinkTo</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e688 d146411e514 ">
                                 <p>Occurs after a <code class="codeph">LinkIn</code> event during a link operation. The event target is the resource that is the link destination. 
                                 </p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e688 d146411e517 ">
                                 <p>After executing <code class="codeph">LinkIn</code> pre handler and before creating the link.
                                 </p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e688 d146411e520 ">
                                 <p>After creating the link and after updating the last modifier and modification time of the parent folder.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e708" headers="d146411e511 ">
                                 <p><code class="codeph">UnLinkIn</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e708 d146411e514 ">
                                 <p>Occurs before an <code class="codeph">UnlinkFrom</code> event during an unlink operation. Always accompanied by an <code class="codeph">UnlinkFrom</code> event.
                                 </p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e708 d146411e517 ">
                                 <p>After validating the resource ACL and locks and before removing the link.</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e708 d146411e520 ">
                                 <p>After executing the <code class="codeph">UnlinkFrom</code> post handler.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e731" headers="d146411e511 ">
                                 <p><code class="codeph">UnlinkFrom</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e731 d146411e514 ">
                                 <p>Occurs after an <code class="codeph">UnlinkIn</code> event during an unlink operation.
                                 </p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e731 d146411e517 ">
                                 <p>After executing the <code class="codeph">UnlinkIn</code> pre handler.
                                 </p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e731 d146411e520 ">
                                 <p>After removing the link.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e751" headers="d146411e511 ">
                                 <p><code class="codeph">CheckIn</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e751 d146411e514 ">
                                 <p>Occurs during check-in of a resource.</p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e751 d146411e517 ">
                                 <p>After validating the resource ACL and locks and after verifying that the resource is version-controlled and has been checked out.</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e751 d146411e520 ">
                                 <p>After checking in the resource.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e766" headers="d146411e511 ">
                                 <p><code class="codeph">CheckOut</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e766 d146411e514 ">
                                 <p>Occurs during check-out of a resource.</p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e766 d146411e517 ">
                                 <p>After validating the resource ACL and locks and after verifying that the resource is version-controlled and is not already checked out.</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e766 d146411e520 ">
                                 <p>After checking out the resource.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e780" headers="d146411e511 ">
                                 <p><code class="codeph">UncheckOut</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e780 d146411e514 ">
                                 <p>Occurs during uncheck-out of a resource.</p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e780 d146411e517 ">
                                 <p>Before removing the record that the resource is checked out.</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e780 d146411e520 ">
                                 <p>After unchecking out the resource.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d146411e794" headers="d146411e511 ">
                                 <p><code class="codeph">VersionControl</code></p>
                              </td>
                              <td align="left" valign="top" width="36%" headers="d146411e794 d146411e514 ">
                                 <p>Occurs when a version history is created for a resource.</p>
                                 <p>Note: You can call <code class="codeph">DBMS_XDB_VERSION.MakeVersioned()</code> multiple times, but the version history is created only at the first call. Subsequent calls have no effect, so no <code class="codeph">VersionControl</code> event occurs.
                                 </p>
                              </td>
                              <td align="left" valign="top" width="23%" headers="d146411e794 d146411e517 ">
                                 <p>Before creating the version history for the resource.</p>
                              </td>
                              <td align="left" valign="top" width="21%" headers="d146411e794 d146411e520 ">
                                 <p>After creating the first version of the resource.</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <p>For simplicity, the documentation generally treats both members of a repository event pair together, referring, for example, to the <code class="codeph">LinkIn</code> event type as shorthand for the pre-link-in and post-link-in event types. For the same reason, the event-type names used here are derived from the Java interface <code class="codeph">XDBRepositoryEventListener</code> by dropping the prefixes <code class="codeph">handlePre</code> and <code class="codeph">handlePost</code>. 
                  </p>
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-5F7D0772-848D-49EA-832B-AB1117B9E3F1__GUID-B09E0E1F-45BC-4E97-841C-A913C5C661FB">
                     <p class="notep1">See Also:</p>
                     <p><a href="../arpls/DBMS_XEVENT.html#ARPLS210" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for the PL/SQL repository event types
                     </p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="XML-DB-repository-events.html#GUID-1A25D4D1-2353-41FC-9D86-9C35F9F95532" title="You can use Oracle XML&nbsp;DB Repository to store and access data of any kind, in the form of repository resources. You can access repository data from any application. Sometimes your application needs to perform certain actions whenever a particular repository operation occurs. You can do this using repository events.">Oracle XML&nbsp;DB Repository Events</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB5599"></a><a id="ADXDB5598"></a><div class="props_rev_3"><a id="GUID-5821696E-5128-4221-9E9F-D36E2ACE5834" name="GUID-5821696E-5128-4221-9E9F-D36E2ACE5834"></a><h3 id="ADXDB-GUID-5821696E-5128-4221-9E9F-D36E2ACE5834" class="sect3"><span class="enumeration_section">30.3 </span>Repository Operations and Events
               </h3>
               <div>
                  <p>The same repository event can occur with different Oracle XML&nbsp;DB Repository operations, and a given repository operation can produce more than one repository event.</p>
                  <p> <a href="XML-DB-repository-events.html#GUID-5821696E-5128-4221-9E9F-D36E2ACE5834__BABCCJGG" title="This table lists the events that are associated with each repository operation.">Table 30-2</a> lists the events that are associated with each repository operation. See <a href="XML-DB-repository-events.html#GUID-5F7D0772-848D-49EA-832B-AB1117B9E3F1__BABHJGBH" title="This table lists the events associated with each repository operation. Their order is indicated in the handler columns.">Table 30-1</a> for the event order when multiple repository events occur for the same operations.
                  </p>
                  <div class="tblformalwide" id="GUID-5821696E-5128-4221-9E9F-D36E2ACE5834__BABCCJGG">
                     <p class="titleintable">Table 30-2 Oracle XML&nbsp;DB Repository Operations and Events</p>
                     <table cellpadding="4" cellspacing="0" class="FormalWide" title="Oracle XML&nbsp;DB Repository Operations and Events" summary="This table lists the events that are associated with each repository operation." width="100%" frame="hsides" border="1" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="55%" id="d146411e893">Operation</th>
                              <th align="left" valign="bottom" width="45%" id="d146411e896">Repository Events Occurring</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e901" headers="d146411e893 ">
                                 <p>Get binary representation of resource contents by path name</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e901 d146411e896 ">
                                 <p><code class="codeph">Render</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e909" headers="d146411e893 ">
                                 <p>Get XML representation of resource contents by path name</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e909 d146411e896 ">
                                 <p><code class="codeph">Render</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e917" headers="d146411e893 ">
                                 <p>Create or update a resource</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e917 d146411e896 ">
                                 <p>If the resource already exists: <code class="codeph">Create</code>, <code class="codeph">LinkIn</code>, <code class="codeph">LinkTo</code></p>
                                 <p>If resource doe not yet exist (HTTP and FTP only): <code class="codeph">Update</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e936" headers="d146411e893 ">
                                 <p>Create a folder</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e936 d146411e896 ">
                                 <p><code class="codeph">Create</code>, <code class="codeph">LinkIn</code>, <code class="codeph">LinkTo</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e950" headers="d146411e893 ">
                                 <p>Create a link to an existing resource</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e950 d146411e896 ">
                                 <p><code class="codeph">LinkIn</code> on the folder containing the link target, <code class="codeph">LinkTo</code> on the target resource to be linked
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e962" headers="d146411e893 ">
                                 <p>Unlink a file resource or an empty folder resource. (Decrement <code class="codeph">RefCount</code>, and if it becomes zero then delete the resource from disk.)
                                 </p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e962 d146411e896 ">
                                 <p><code class="codeph">UnlinkIn</code>, <code class="codeph">UnlinkFrom</code>, and, if <code class="codeph">RefCount</code> is zero, <code class="codeph">Delete</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e982" headers="d146411e893 ">
                                 <p>Forcibly delete a folder and its contents</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e982 d146411e896 ">
                                 <p>Recursively produce events for unlinking a resource. Folder child resources are deleted recursively, then the folder is deleted.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e989" headers="d146411e893 ">
                                 <p>Forcibly remove all links to a resource</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e989 d146411e896 ">
                                 <p>Produce unlinking events for each link removed. </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e996" headers="d146411e893 ">
                                 <p>Update the contents, properties, or ACL of a resource by path name</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e996 d146411e896 ">
                                 <p><code class="codeph">Update</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e1004" headers="d146411e893 ">
                                 <p>Put a depth-zero WebDAV lock on a resource</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e1004 d146411e896 ">
                                 <p><code class="codeph">Lock</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e1012" headers="d146411e893 ">
                                 <p>Remove a depth-zero WebDAV lock from a resource</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e1012 d146411e896 ">
                                 <p><code class="codeph">Lock</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e1021" headers="d146411e893 ">
                                 <p>Rename (move) a resource</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e1021 d146411e896 ">
                                 <p><code class="codeph">LinkIn</code> and <code class="codeph">LinkTo</code> on the new location, <code class="codeph">UnlinkIn</code> and <code class="codeph">UnlinkFrom</code> on the old location
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e1039" headers="d146411e893 ">
                                 <p>Copy a resource</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e1039 d146411e896 ">
                                 <p><code class="codeph">Create</code>, <code class="codeph">LinkIn</code>, and <code class="codeph">LinkTo</code> on the new location
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e1054" headers="d146411e893 ">
                                 <p>Check out a resource</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e1054 d146411e896 ">
                                 <p><code class="codeph">CheckOut</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e1062" headers="d146411e893 ">
                                 <p>Check in a resource</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e1062 d146411e896 ">
                                 <p><code class="codeph">CheckIn</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e1070" headers="d146411e893 ">
                                 <p>Place a resource under version control</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e1070 d146411e896 ">
                                 <p><code class="codeph">VersionControl</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="55%" id="d146411e1078" headers="d146411e893 ">
                                 <p>Uncheck out a resource</p>
                              </td>
                              <td align="left" valign="top" width="45%" headers="d146411e1078 d146411e896 ">
                                 <p><code class="codeph">UncheckOut</code></p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <p>All operations listed in <a href="XML-DB-repository-events.html#GUID-5821696E-5128-4221-9E9F-D36E2ACE5834__BABCCJGG" title="This table lists the events that are associated with each repository operation.">Table 30-2</a> are atomic, except for these:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Forced deletion of a folder and its contents</p>
                     </li>
                     <li>
                        <p>Update of resource properties by path name using HTTP (only)</p>
                     </li>
                     <li>
                        <p>Copy of a folder using HTTP (only)</p>
                     </li>
                  </ul>
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-5821696E-5128-4221-9E9F-D36E2ACE5834__GUID-7FF30433-3489-441D-8DA6-439037134710">
                     <p class="notep1">See Also:</p>
                     <p><a href="accessing-XML-DB-repository-data.html#GUID-B162A199-F7F8-4E81-B2FD-919B90F7FE83__BABBJJDI" title="This table describes the API options for accessing Oracle XML DB Repository.">Table 21-3</a> for information on accessing resources using APIs and protocols
                     </p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="XML-DB-repository-events.html#GUID-1A25D4D1-2353-41FC-9D86-9C35F9F95532" title="You can use Oracle XML&nbsp;DB Repository to store and access data of any kind, in the form of repository resources. You can access repository data from any application. Sometimes your application needs to perform certain actions whenever a particular repository operation occurs. You can do this using repository events.">Oracle XML&nbsp;DB Repository Events</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB5600"></a><div class="props_rev_3"><a id="GUID-C4139224-FF34-4B6D-9B68-481FA41E634C" name="GUID-C4139224-FF34-4B6D-9B68-481FA41E634C"></a><h3 id="ADXDB-GUID-C4139224-FF34-4B6D-9B68-481FA41E634C" class="sect3"><span class="enumeration_section">30.4 </span>Repository Event Handler Considerations
               </h3>
               <div>
                  <p>Some considerations are listed for defining handlers for Oracle XML&nbsp;DB Repository events.</p>
                  <p></p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>In any handler: Do not use <code class="codeph">COMMIT</code>, <code class="codeph">ROLLBACK</code>, or data definition language (DDL) statements in a handler. Do not call PL/SQL functions or procedures, such as <code class="codeph">DBMS_XMLSCHEMA.registerSchema</code>, that behave similarly to DDL statements. In a <code class="codeph">Render</code> handler: Do not use data manipulation language (DML) statements.
                        </p>
                        <p>To work around these restrictions, a handler can use such statements inside an autonomous transaction, but it must ensure that lock conflicts cannot arise.</p>
                     </li>
                     <li>
                        <p>In a <code class="codeph">Render</code> handler, do not close an output stream. (You can append to a stream.)
                        </p>
                     </li>
                     <li>
                        <p>Do <span class="italic">not</span> use modifier methods from class <code class="codeph">XDBResource</code> in a handler, unless it is a <code class="codeph">Pre-Create</code> or <code class="codeph">Pre-Update</code> handler. Do <span class="italic">not</span> use method <code class="codeph">XDBResource.save()</code> in any handler.
                        </p>
                     </li>
                     <li>
                        <p>Oracle recommends that you develop only safe repository event handlers. In particular:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Write only resource properties that are in namespaces owned by your application, never in the <code class="codeph">xdb</code> namespace.
                              </p>
                           </li>
                           <li>
                              <p>Do not delete a resource while it is being created.</p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>A repository event handler is passed an <code class="codeph">XDBRepositoryEvent</code> object, which exists only during the current SQL statement or protocol operation. You can use PL/SQL procedures and Java methods on this object to obtain information about the resource, the event, and the associated event handlers.
                        </p>
                     </li>
                     <li>
                        <p>When an event handler performs operations that cause other repository events to occur, those cascading events occur immediately. They are not queued to occur after the handlers for the current event are finished. Each event thus occurs in the context of its corresponding operation.</p>
                     </li>
                     <li>
                        <p>Repository event handlers are called synchronously. They are executed in the process, session, and transaction context of the corresponding operation. However, handlers can use Oracle Database Advanced Queuing (AQ) to queue repository events that are then handled asynchronously by some other process.</p>
                     </li>
                     <li>
                        <p>Because a repository event handler is executed in the transaction context of its corresponding operation, any locks acquired by that operation, or by other operations run previously in the transaction, are still active. An event handler must not start a separate session or transaction that tries to acquire such a lock. Otherwise, the handler hangs.</p>
                     </li>
                     <li>
                        <p>Repository event handlers are called in the order that they appear in a resource configuration file. If preconditions are defined for a resource configuration, then only those handlers are called for which the precondition is satisfied.</p>
                     </li>
                     <li>
                        <p>Although handlers are called in the order they are defined in a configuration file, avoid letting your code depend upon this. If the user who is current when a handler is invoked has privilege <code class="codeph">write-config</code>, then the handler invocation order could be changed inside an executing handler.
                        </p>
                     </li>
                     <li>
                        <p>The entire list of handlers applicable to a given repository event occurrence is determined before any of the handlers is invoked. This means, in particular, that the precondition for each handler is evaluated before any handlers are invoked.</p>
                     </li>
                     <li>
                        <p>The following considerations apply to <span class="italic">error handling</span> for repository events:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>A pre-operation event handler is never invoked if access checks for the operation fail.</p>
                           </li>
                           <li>
                              <p>All handlers for a given event are checked before any of them are called. If any of them is not usable (for example, no longer exists), then <span class="italic">none</span> of them are called.
                              </p>
                           </li>
                           <li>
                              <p>If an error is raised during event handling, then other, subsequent event handlers are not invoked for the same SQL statement or protocol operation. The current statement or operation is canceled and all of its changes are rolled back.</p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>The following considerations apply to <span class="italic">resource security</span> for repository events:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>An event handler can have invoker's rights or definer rights. You specify the execution rights of a PL/SQL package when you create the package. You specify the execution rights of Java classes when you load them into the database using the <code class="codeph">loadjava</code> utility. If you specify invoker's rights, but a given handler is not configured for invoker's rights, then an insufficient-privilege error is raised.
                              </p>
                           </li>
                           <li>
                              <p>Within an event handler, the current user privileges, whether obtained by invoker or definer rights, are determined in detail for a given resource by its ACL. These privileges determine what the handler can do with the resource. For example, if the current user has privileges <code class="codeph">read-properties</code> and <code class="codeph">read-contents</code> for a particular resource, then an event handler can read that resource.
                              </p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>The following considerations apply to repository events for <span class="italic">linking</span> and <span class="italic">unlinking</span>:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>After creating a link to a resource, if you want any resource configuration files of the parent folder to also apply to the linked resource, then use procedure <code class="codeph">DBMS_RESCONFIG.appendResConfig</code> to add the configuration files to the linked resource. You can invoke this procedure from a <code class="codeph">Post-LinkTo</code> event handler for the linked resource. 
                              </p>
                           </li>
                           <li>
                              <p>After unlinking a resource, if you want to remove any such resource configuration files added when linking, then use procedure <code class="codeph">DBMS_RESCONFIG.deleteResConfig</code> to remove them from the unlinked resource. You can invoke this procedure from a <code class="codeph">Post-UnlinkFrom</code> event handler for the unlinked resource.
                              </p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>Do not define handlers for events on folder <code class="codeph">/sys/schemas</code> or on resources under this folder. Events do not occur for any such resources, so such event handlers are ignored. This implies that XML schema operations that affect the repository (registration, deletion, and so on) do not produce events.
                        </p>
                     </li>
                  </ul>
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-C4139224-FF34-4B6D-9B68-481FA41E634C__GUID-9974B3C1-2ED9-4C48-8823-85F0F8415501">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="../arpls/DBMS_XEVENT.html#ARPLS210" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for information about PL/SQL functions and procedures for manipulating repository events
                           </p>
                        </li>
                        <li>
                           <p><a href="../jaxml/index.html" target="_blank"><span><cite>Oracle Database XML Java API Reference</cite></span></a>, classes <code class="codeph">XDBRepositoryEvent</code> and <code class="codeph">XDBEvent</code> for information about Java methods for manipulating repository events
                           </p>
                        </li>
                        <li>
                           <p><a href="XML-DB-repository-events.html#GUID-C7D110F1-CB15-475B-83E6-7C186DF0E119" title="In a resource configuration file, you use element event-listeners, child of element ResConfig, to configure Oracle XML&nbsp;DB Repository event handling.">Configuration of Repository Events</a> for information about defining repository event handlers with invoker's rights
                           </p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="XML-DB-repository-events.html#GUID-1A25D4D1-2353-41FC-9D86-9C35F9F95532" title="You can use Oracle XML&nbsp;DB Repository to store and access data of any kind, in the form of repository resources. You can access repository data from any application. Sometimes your application needs to perform certain actions whenever a particular repository operation occurs. You can do this using repository events.">Oracle XML&nbsp;DB Repository Events</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB5601"></a><div class="props_rev_3"><a id="GUID-C7D110F1-CB15-475B-83E6-7C186DF0E119" name="GUID-C7D110F1-CB15-475B-83E6-7C186DF0E119"></a><h3 id="ADXDB-GUID-C7D110F1-CB15-475B-83E6-7C186DF0E119" class="sect3"><span class="enumeration_section">30.5 </span>Configuration of Repository Events
               </h3>
               <div>
                  <p>In a resource configuration file, you use element <code class="codeph">event-listeners</code>, child of element <code class="codeph">ResConfig</code>, to configure Oracle XML&nbsp;DB Repository event handling. 
                  </p>
                  <p>You configure event treatment for Oracle XML&nbsp;DB Repository resources as you would configure any other treatment of repository resources — see <span class="q">"<a href="configuration-of-XML-DB-repository.html#GUID-AB3B6205-AE7B-4A12-A6B9-C3CC0C1108D3" title="Configuring an Oracle XML&nbsp;DB Repository resource involves creating a configuration file, adding that file to the repository as a configuration resource, and mapping the configuration resource to the resources it configures or to the entire repository.">Configuring a Resource</a>"</span>. 
                  </p>
                  <p>By default, repository events are enabled, but you can disable them by setting parameter <code class="codeph">XML_DB_EVENTS</code> to <code class="codeph">DISABLE</code>. To disable repository events at the session level, use the following SQL*Plus command. You must have role <code class="codeph">XDBADMIN</code> to do this.
                  </p><pre class="oac_no_warn" dir="ltr">ALTER SESSION SET XML_DB_EVENTS = DISABLE;
</pre><p>To disable repository events at the system level, use the following SQL*Plus command, and then restart your database. Repository events are disabled for subsequent sessions. You must have privilege <code class="codeph">ALTER SYSTEM</code> to do this.
                  </p><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM SET XML_DB_EVENTS = DISABLE;
</pre><p>To enable repository events again, set the value of <code class="codeph">XML_DB_EVENTS</code> to <code class="codeph">ENABLE</code>.
                  </p>
                  <p>A resource configuration file is an XML file that conforms to the XML schema <code class="codeph">XDBResConfig.xsd</code>, which is accessible in Oracle XML&nbsp;DB Repository at path <code class="codeph">/sys/schemas/PUBLIC/xmlns.oracle.com/xdb/XDBResConfig.xsd</code>. You use element <code class="codeph">event-listeners</code>, child of element <code class="codeph">ResConfig</code>, to configure repository event handling.
                  </p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-FC91D1C8-A5BF-4FEB-B6C9-6953FA9F6279">Configuration Element event-listeners</a><br>Each resource configuration file can have one <code class="codeph">event-listeners</code> element, as a child of element <code class="codeph">ResConfig</code>. This configures all event handling for the target resource. If the resource configuration file applies to the entire repository, not to a particular resource, then it defines event handling for all resources in the repository.
                     </li>
                     <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-BA0619E8-B9F4-4824-BD6A-0C65A3C040C8">Configuration Element listener</a><br>Element <code class="codeph">listener</code> is a child of element <code class="codeph">event-listeners</code>, and it configures an individual repository event listener.
                     </li>
                     <li class="ulchildlink"><a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976">Repository Events Configuration Examples</a><br>Examples of configuring repository events are presented. Resource configuration files define Java and PL/SQL event listeners, with and without preconditions, respectively. An example categorizes resources according to MIME type. It includes PL/SQL code to create the resource configuration file. Examples implement listeners in Java and PL/SQL.
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-C7D110F1-CB15-475B-83E6-7C186DF0E119__GUID-1867B84E-ADA5-490B-98EE-4F8E680F4E6E">
                     <p class="notep1">See Also:</p>
                     <p><a href="configuration-of-XML-DB-repository.html#GUID-E44B59D4-7A7E-4303-ACE3-B801797B06AF" title="Overall configuration of Oracle XML&nbsp;DB Repository applies to all repository resources. It does not include configuring parameters for handling events or managing XLink and XInclude processing. You use resource configuration files to configure resources.">Configuration of Oracle XML&nbsp;DB Repository</a> for general information about configuring repository resources
                     </p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="XML-DB-repository-events.html#GUID-1A25D4D1-2353-41FC-9D86-9C35F9F95532" title="You can use Oracle XML&nbsp;DB Repository to store and access data of any kind, in the form of repository resources. You can access repository data from any application. Sometimes your application needs to perform certain actions whenever a particular repository operation occurs. You can do this using repository events.">Oracle XML&nbsp;DB Repository Events</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADXDB5602"></a><div class="props_rev_3"><a id="GUID-FC91D1C8-A5BF-4FEB-B6C9-6953FA9F6279" name="GUID-FC91D1C8-A5BF-4FEB-B6C9-6953FA9F6279"></a><h4 id="ADXDB-GUID-FC91D1C8-A5BF-4FEB-B6C9-6953FA9F6279" class="sect4"><span class="enumeration_section">30.5.1 </span>Configuration Element event-listeners
                  </h4>
                  <div>
                     <p>Each resource configuration file can have one <code class="codeph">event-listeners</code> element, as a child of element <code class="codeph">ResConfig</code>. This configures all event handling for the target resource. If the resource configuration file applies to the entire repository, not to a particular resource, then it defines event handling for all resources in the repository.
                     </p>
                     <p>Element <code class="codeph">event-listeners</code> has the following optional attributes:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><code class="codeph">set-invoker</code> &#x2013; Set this to <code class="codeph">true</code> to if the resource configuration defines one or more repository event handlers to have invoker's rights. The default value is <code class="codeph">false</code>, meaning that definer rights are used. 
                           </p>
                           <p>To define an invoker-rights repository event handler, you must have database role <code class="codeph">XDB_SET_INVOKER</code>. This role is granted to <code class="codeph">DBA</code>, but not to <code class="codeph">XDBADMIN</code>. Role <code class="codeph">XDB_SET_INVOKER</code> is checked only when a resource configuration file is created or updated. Only attribute <code class="codeph">set-invoker</code>, not role <code class="codeph">XDB_SET_INVOKER</code>, is checked at run time to ensure sufficient privilege.
                           </p>
                           <div class="infoboxnotealso" id="GUID-FC91D1C8-A5BF-4FEB-B6C9-6953FA9F6279__GUID-72EEDD2E-3937-4C70-8C6D-8D0C78091409">
                              <p class="notep1">See Also:</p>
                              <p><a href="XML-DB-repository-events.html#GUID-C4139224-FF34-4B6D-9B68-481FA41E634C" title="Some considerations are listed for defining handlers for Oracle XML&nbsp;DB Repository events.">Repository Event Handler Considerations</a> for information about insufficient-privilege errors
                              </p>
                           </div>
                        </li>
                        <li>
                           <p><code class="codeph">default-schema</code> &#x2013; The default schema value, used for listeners for which no <code class="codeph">schema</code> element is defined.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">default-language</code> &#x2013;The default language value, used for listeners for which no <code class="codeph">language</code> element is defined.
                           </p>
                        </li>
                     </ul>
                     <p>Element <code class="codeph">event-listeners</code> has a sequence of <code class="codeph">listener</code> elements as children. These configure individual repository event listeners. The listeners are processed at run time in the order of the <code class="codeph">listener</code> elements.
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="XML-DB-repository-events.html#GUID-C7D110F1-CB15-475B-83E6-7C186DF0E119" title="In a resource configuration file, you use element event-listeners, child of element ResConfig, to configure Oracle XML&nbsp;DB Repository event handling.">Configuration of Repository Events</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADXDB5603"></a><div class="props_rev_3"><a id="GUID-BA0619E8-B9F4-4824-BD6A-0C65A3C040C8" name="GUID-BA0619E8-B9F4-4824-BD6A-0C65A3C040C8"></a><h4 id="ADXDB-GUID-BA0619E8-B9F4-4824-BD6A-0C65A3C040C8" class="sect4"><span class="enumeration_section">30.5.2 </span>Configuration Element listener
                  </h4>
                  <div>
                     <p>Element <code class="codeph">listener</code> is a child of element <code class="codeph">event-listeners</code>, and it configures an individual repository event listener.
                     </p>
                     <div class="section">
                        <p>Each <code class="codeph">listener</code> element has the following child elements. All of these are optional except <code class="codeph">source</code>, and they can appear in any order (their order is irrelevant).
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">description</code> &#x2013; Description of the listener.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">schema</code> &#x2013; Database schema for the Java or PL/SQL implementation of the repository event handlers. If neither this nor <code class="codeph">default-schema</code> is defined, then an error is raised.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">source</code> (required) &#x2013; Name of the Java class, PL/SQL package, or object type that provides the handler methods. Java class names must be qualified with a package name. Use an empty <code class="codeph">source</code> element to indicate that the repository event handlers are standalone PL/SQL stored procedures.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">language</code> &#x2013; Implementation language of the listener class (Java) or package (PL/SQL). If neither this nor <code class="codeph">default-language</code> is defined, then an error is raised.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">pre-condition</code> &#x2013; Precondition to be met for any repository event handlers in this listener to be executed. This is identical to the <code class="codeph">pre-condition</code> child of general resource configuration element <code class="codeph">configuration</code> &#x2013; see <a href="configuration-of-XML-DB-repository.html#GUID-5010D4C5-38CA-4ABE-A559-C1D1001359D3" title="Configuration element defaultChildConfig applies to only folders. It holds configuration information to be applied to all child resources in the folder. Element defaultChildConfig has one or more configuration child elements, each of which defines a possible configuration for resources in the folder.">Configuration Elements defaultChildConfig and configuration</a>.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">events</code> &#x2013; Sequence of unique repository event type names: <code class="codeph">Render</code>, <code class="codeph">Pre-Create</code>, and so on. Only handlers for repository events of these types are enabled for the listener. See <a href="XML-DB-repository-events.html#GUID-5F7D0772-848D-49EA-832B-AB1117B9E3F1" title="Repository operations are associated with predefined events. Except for a rendering operation, events come in pre and post pairs.">Possible Repository Events</a> for the list of possible repository event types. If element <code class="codeph">events</code> is not present, then handlers of repository events of all types are enabled for the listener, which can be wasteful. Provide element <code class="codeph">events</code> to eliminate handler invocations for insignificant repository events.
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="XML-DB-repository-events.html#GUID-C7D110F1-CB15-475B-83E6-7C186DF0E119" title="In a resource configuration file, you use element event-listeners, child of element ResConfig, to configure Oracle XML&nbsp;DB Repository event handling.">Configuration of Repository Events</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADXDB5605"></a><a id="ADXDB5606"></a><a id="ADXDB5607"></a><a id="ADXDB5608"></a><a id="ADXDB5609"></a><a id="ADXDB5604"></a><div class="props_rev_3"><a id="GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976" name="GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976"></a><h4 id="ADXDB-GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976" class="sect4"><span class="enumeration_section">30.5.3 </span>Repository Events Configuration Examples
                  </h4>
                  <div>
                     <p>Examples of configuring repository events are presented. Resource configuration files define Java and PL/SQL event listeners, with and without preconditions, respectively. An example categorizes resources according to MIME type. It includes PL/SQL code to create the resource configuration file. Examples implement listeners in Java and PL/SQL.</p>
                     <div class="section">
                        <p><a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABDEGAA">Example 30-1</a> shows the content of a resource configuration file that defines two event listeners. Each listener defines handlers for repository events of types <code class="codeph">Post-LinkIn</code>, <code class="codeph">Post-UnlinkIn</code>, and <code class="codeph">Post-Update</code>. It defines preconditions, the default language (Java), and the default database schema.
                        </p>
                        <p>The implementation of the handlers of the first listener is in Java class <code class="codeph">oracle.cm.quota</code> defined in database schema <code class="codeph">CM</code>. These handlers are invoked only for events on resources of <code class="codeph">ContentType</code> <code class="codeph">image/gif</code>.
                        </p>
                        <p>The implementation of the handlers of the second listener is in Java class <code class="codeph">oracle.ifs.quota</code> defined in database schema <code class="codeph">IFS</code> (the default schema for this resource configuration file). These handlers are invoked only for events on resources of type <code class="codeph">ifs-file</code> in namespace <code class="codeph">http://foo.xsd</code>.
                        </p>
                        <div class="infoboxnotealso" id="GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__GUID-81D0675B-D3D5-4DD8-8ABE-0FC83C72E847">
                           <p class="notep1">See Also:</p>
                           <p><a href="configuration-of-XML-DB-repository.html#GUID-5010D4C5-38CA-4ABE-A559-C1D1001359D3" title="Configuration element defaultChildConfig applies to only folders. It holds configuration information to be applied to all child resources in the folder. Element defaultChildConfig has one or more configuration child elements, each of which defines a possible configuration for resources in the folder.">Configuration Elements defaultChildConfig and configuration</a> for a description of elements <code class="codeph">defaultChildConfig</code> and <code class="codeph">applicationData</code></p>
                        </div>
                        <p>As a simple end-to-end illustration, suppose that an application needs to categorize the resources in folder <code class="codeph">/public/res-app</code> according to their MIME types. It creates links to resources in folders <code class="codeph">/public/app/XML-TXT</code>, <code class="codeph">/public/app/IMG</code>, and <code class="codeph">/public/app/FOLDER</code>, depending on whether the resource MIME type is <code class="codeph">text/xml</code>, <code class="codeph">image/gif</code>, or <code class="codeph">application/octet-stream</code>, respectively. This is illustrated in <a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABBJGAC">Example 30-2</a>, <a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABCDJEH">Example 30-3</a>, and <a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABIHGGH">Example 30-5</a>.
                        </p>
                        <p><a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABBJGAC">Example 30-2</a> shows the PL/SQL code to create the configuration file for this categorization illustration. It defines a single listener that handles events of types <code class="codeph">Pre-UnlinkIn</code> and <code class="codeph">Post-LinkIn</code>. It explicitly defines the language (PL/SQL) and database schema. No preconditions are defined.
                        </p>
                        <p><a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABCDJEH">Example 30-3</a> shows the PL/SQL code that implements the event handlers that are configured in <a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABBJGAC">Example 30-2</a>. The <code class="codeph">Post-LinkIn</code> event handler creates a link to the <code class="codeph">eventObject</code> resource in one of the folders <code class="codeph">/public/app/XML-TXT</code>, <code class="codeph">/public/app/IMG</code>, and <code class="codeph">/public/app/FOLDER</code>, depending on the resource MIME type. The <code class="codeph">Pre-UnlinkIn</code> event handler deletes the links that are created by the   <code class="codeph">Post-LinkIn</code> event handler. 
                        </p>
                        <div class="infoboxnotealso" id="GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__GUID-34892E6E-8B01-423B-A170-E0504253AF45">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="../arpls/DBMS_XDBRESOURCE.html#ARPLS230" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for information about PL/SQL package <code class="codeph">DBMS_XDBRESOURCE</code></p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_XEVENT.html#ARPLS210" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for information about PL/SQL package <code class="codeph">DBMS_XEVENT</code></p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_XDB_REPOS.html#ARPLS74188" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for information about PL/SQL package <code class="codeph">DBMS_XDB_REPOS</code></p>
                              </li>
                           </ul>
                        </div>
                        <p>A Java example would be configured the same as in <a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABBJGAC">Example 30-2</a>, with the exception of these two lines, which would replace the elements with the same names in <a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABBJGAC">Example 30-2</a>:
                        </p><pre class="oac_no_warn" dir="ltr">                &lt;source&gt;<span class="bold">category</span>&lt;/source&gt;
                &lt;language&gt;<span class="bold">Java</span>&lt;/language&gt;
</pre><p><a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABCFCIH">Example 30-4</a> shows the Java code that implements the event handlers. The logic is identical to that in <a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABCDJEH">Example 30-3</a>.
                        </p>
                        <p><a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABIHGGH">Example 30-5</a> demonstrates the invocation of the event handlers that are implemented in <a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABCDJEH">Example 30-3</a> or <a href="XML-DB-repository-events.html#GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABCFCIH">Example 30-4</a>.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABDEGAA">
                        <p class="titleinexample">Example 30-1 Resource Configuration File for Java Event Listeners with Preconditions</p><pre class="oac_no_warn" dir="ltr">&lt;ResConfig xmlns="http://xmlns.oracle.com/xdb/XDBResConfig.xsd"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://xmlns.oracle.com/xdb/XDBResConfig.xsd
                               http://xmlns.oracle.com/xdb/XDBResConfig.xsd"&gt;
  &lt;event-listeners <span class="bold">default-language="Java" default-schema="IFS"</span>&gt;
    &lt;listener&gt;
      &lt;description&gt;Category application&lt;/description&gt;
      &lt;schema&gt;CM&lt;/schema&gt;
      &lt;source&gt;<span class="bold">oracle.cm.category</span>&lt;/source&gt;
      &lt;events&gt;
        <span class="bold">&lt;Post-LinkIn/&gt;</span>
        <span class="bold">&lt;Post-UnlinkIn/&gt;</span>
        <span class="bold">&lt;Post-Update/&gt;</span>
      &lt;/events&gt;
      &lt;pre-condition&gt;
        &lt;existsNode&gt;
          &lt;XPath&gt;/Resource<span class="bold">[ContentType="image/gif"]</span>&lt;/XPath&gt;
        &lt;/existsNode&gt;
      &lt;/pre-condition&gt;
    &lt;/listener&gt;
    &lt;listener&gt;
      &lt;description&gt;Check quota&lt;/description&gt;
      &lt;source&gt;<span class="bold">oracle.ifs.quota</span>&lt;/source&gt;
      &lt;events&gt;
        <span class="bold">&lt;Post-LinkIn/&gt;</span>
        <span class="bold">&lt;Post-UnlinkIn/&gt;</span>
        <span class="bold">&lt;Post-Update/&gt;</span>
      &lt;/events&gt;
      &lt;pre-condition&gt;
        &lt;existsNode&gt;
          &lt;XPath&gt;r:/Resource/<span class="bold">[ns:type="ifs-file"]</span>&lt;/XPath&gt;
          &lt;namespace&gt;xmlns:r="http://xmlns.oracle.com/xdb/XDBResource.xsd"
                     xmlns:<span class="bold">ns="http://foo.xsd</span>"
          &lt;/namespace&gt;
        &lt;/existsNode&gt;
      &lt;/pre-condition&gt;
    &lt;/listener&gt;
  &lt;/event-listeners&gt;
  &lt;defaultChildConfig&gt;
    &lt;configuration&gt;
      &lt;path&gt;/sys/xdb/resconfig/user_rc.xml&lt;/path&gt;
    &lt;/configuration&gt;
  &lt;/defaultChildConfig&gt;
  &lt;applicationData&gt;
    &lt;foo:data xmlns:foo="http://foo.xsd"&gt;
      &lt;foo:item1&gt;1234&lt;/foo:item1&gt;
    &lt;/foo:data&gt;
  &lt;/applicationData&gt;
&lt;/ResConfig&gt;
</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABBJGAC">
                        <p class="titleinexample">Example 30-2 Resource Configuration File for PL/SQL Event Listeners with No Preconditions</p><pre class="oac_no_warn" dir="ltr">DECLARE
  b BOOLEAN := FALSE;
BEGIN
  b := DBMS_XDB_REPOS.createFolder('/public/resconfig');
  b := DBMS_XDB_REPOS.createResource(
         '/public/resconfig/appcatg-rc1.xml',
         '&lt;ResConfig xmlns="http://xmlns.oracle.com/xdb/XDBResConfig.xsd"
                     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                     xsi:schemaLocation="http://xmlns.oracle.com/xdb/XDBResConfig.xsd
                                         http://xmlns.oracle.com/xdb/XDBResConfig.xsd"&gt;
            &lt;event-listeners&gt;
              &lt;listener&gt;
                &lt;description&gt;Category application&lt;/description&gt;
           <span class="bold">     &lt;schema&gt;APPCATGUSER1&lt;/schema&gt;</span>
                <span class="bold">&lt;source&gt;APPCATG_EVT_PKG1&lt;/source&gt;</span>
           <span class="bold">     &lt;language&gt;PL/SQL&lt;/language&gt;</span>
                &lt;events&gt;
             <span class="bold">     &lt;Pre-UnlinkIn/&gt;</span>
                  <span class="bold">&lt;Post-LinkIn/&gt;</span>
                &lt;/events&gt;
              &lt;/listener&gt;
            &lt;/event-listeners&gt;
            &lt;defaultChildConfig&gt;
              &lt;configuration&gt;
                &lt;path&gt;/public/resconfig/appcatg-rc1.xml&lt;/path&gt;
              &lt;/configuration&gt;
            &lt;/defaultChildConfig&gt;
          &lt;/ResConfig&gt;',
         'http://xmlns.oracle.com/xdb/XDBResConfig.xsd',
         'ResConfig');
END;
/
BEGIN
  DBMS_RESCONFIG.appendResConfig('/public/res-app', 
                                 '/public/resconfig/appcatg-rc1.xml',
                                 DBMS_RESCONFIG.APPEND_RECURSIVE);
END;
/
 </pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABCDJEH">
                        <p class="titleinexample">Example 30-3 PL/SQL Code Implementing Event Listeners</p><pre class="oac_no_warn" dir="ltr">CREATE OR REPLACE PACKAGE appcatg_evt_pkg1 AS
 
  PROCEDURE handlePreUnlinkIn (eventObject DBMS_XEVENT.XDBRepositoryEvent);
  PROCEDURE handlePostLinkIn (eventObject DBMS_XEVENT.XDBRepositoryEvent);
 
END;
/
CREATE OR REPLACE PACKAGE BODY appcatg_evt_pkg1 AS
 
  PROCEDURE <span class="bold">handlePreUnlinkIn</span> (eventObject DBMS_XEVENT.XDBRepositoryEvent) AS
      XDBResourceObj DBMS_XDBRESOURCE.XDBResource;
      ResDisplayName VARCHAR2(100);
      ResPath        VARCHAR2(1000);
      ResOwner       VARCHAR2(1000);
      ResDeletedBy   VARCHAR2(1000);
      XDBPathobj     DBMS_XEVENT.XDBPath;
      XDBEventobj    DBMS_XEVENT.XDBEvent;
      SeqChar        VARCHAR2(1000);
      LinkName       VARCHAR2(10000);
      ResType        VARCHAR2(100);
      LinkFolder     VARCHAR2(100);
    BEGIN
      XDBResourceObj := DBMS_XEVENT.getResource(eventObject);
      ResDisplayName := DBMS_XDBRESOURCE.getDisplayName(XDBResourceObj);
      ResOwner       := DBMS_XDBRESOURCE.getOwner(XDBResourceObj);
      XDBPathobj     := DBMS_XEVENT.getPath(eventObject);
      ResPath        := DBMS_XEVENT.getName(XDBPathObj);
      XDBEventobj    := DBMS_XEVENT.getXDBEvent(eventObject);
      ResDeletedBy   := DBMS_XEVENT.getCurrentUser(XDBEventobj);
      BEGIN
        SELECT XMLCast(
                 XMLQuery(
                   'declare namespace ns = "http://xmlns.oracle.com/xdb/XDBResource.xsd";
                    /ns:Resource/ns:ContentType'
                   PASSING r.RES RETURNING CONTENT) AS VARCHAR2(100))
          INTO ResType
          FROM PATH_VIEW r WHERE r.PATH=ResPath;
          EXCEPTION WHEN OTHERS THEN NULL;
      END;
      IF ResType = '<span class="bold">text/xml</span>' THEN LinkFolder := '<span class="bold">/public/app/XML-TXT/</span>';
      END IF;
      IF ResType = '<span class="bold">image/gif</span>' THEN LinkFolder := '<span class="bold">/public/app/IMG/</span>';
      END IF;
      IF ResType = '<span class="bold">application/octet-stream</span>' THEN LinkFolder := '/<span class="bold">public/app/FOLDER/</span>';
      END IF;
      DBMS_XDB_REPOS.<span class="bold">deleteResource</span>(LinkFolder || ResDisplayName);
  END;
 
  PROCEDURE <span class="bold">handlePostLinkIn</span> (eventObject DBMS_XEVENT.XDBRepositoryEvent) AS
      XDBResourceObj DBMS_XDBRESOURCE.XDBResource;
      ResDisplayName VARCHAR2(100);
      ResPath        VARCHAR2(1000);
      ResOwner       VARCHAR2(1000);
      ResDeletedBy   VARCHAR2(1000);
      XDBPathobj     DBMS_XEVENT.XDBPath;
      XDBEventobj    DBMS_XEVENT.XDBEvent;
      SeqChar        VARCHAR2(1000);
      LinkName       VARCHAR2(10000);
      ResType        VARCHAR2(100);
      LinkFolder     VARCHAR2(100);
    BEGIN
      XDBResourceObj := DBMS_XEVENT.getResource(eventObject);
      ResDisplayName := DBMS_XDBRESOURCE.getDisplayName(XDBResourceObj);
      ResOwner       := DBMS_XDBRESOURCE.getOwner(XDBResourceObj);
      XDBPathobj     := DBMS_XEVENT.getPath(eventObject);
      ResPath        := DBMS_XEVENT.getName(XDBPathObj);
      XDBEventobj    := DBMS_XEVENT.getXDBEvent(eventObject);
      ResDeletedBy   := DBMS_XEVENT.getCurrentUser(XDBEventobj);
      SELECT XMLCast(
               XMLQuery(
                 'declare namespace ns = "http://xmlns.oracle.com/xdb/XDBResource.xsd";
                  /ns:Resource/ns:ContentType'
                 PASSING r.RES RETURNING CONTENT) AS VARCHAR2(100))
        INTO ResType
        FROM PATH_VIEW r WHERE r.PATH=ResPath;
      IF ResType = '<span class="bold">text/xml</span>' THEN LinkFolder := '<span class="bold">/public/app/XML-TXT</span>';
      END IF;
      IF ResType = '<span class="bold">image/gif</span>' THEN LinkFolder := '<span class="bold">/public/app/IMG</span>';
      END IF;
      IF ResType = '<span class="bold">application/octet-stream</span>' THEN LinkFolder := '<span class="bold">/public/app/FOLDER</span>';
      END IF;
      DBMS_XDB_REPOS.<span class="bold">link</span>(ResPath, LinkFolder, ResDisplayName);
    END;
 END;
 /
</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABCFCIH">
                        <p class="titleinexample">Example 30-4 Java Code Implementing Event Listeners</p><pre class="oac_no_warn" dir="ltr">import oracle.xdb.event.*;
import oracle.xdb.spi.*;
import java.sql.*;
import java.io.*;
import java.net.*;
import oracle.jdbc.*;
import oracle.sql.*;
import oracle.xdb.XMLType;
import oracle.xdb.dom.*;
 
public class <span class="bold">category</span>
extends oracle.xdb.event.XDBBasicEventListener
{
  public Connection <span class="bold">connectToDB</span>() throws java.sql.SQLException
  {
    try
    {
      String strUrl="jdbc:oracle:kprb:";
      String strUname="appcatguser1";
      String strPwd="appcatguser1 ";
      Connection conn=null;
      OraclePreparedStatement stmt=null;
      DriverManager.registerDriver(new oracle.jdbc.OracleDriver());
      conn = DriverManager.getConnection(strUrl, strUname, strPwd);
      return conn;
    }
    catch(Exception e1)
    {
      System.out.println("Exception in connectToDB java function");
      System.out.println("e1:" + e1.toString());
      return null;
    }
  }
  public void <span class="bold">handlePostLinkIn</span> (XDBRepositoryEvent eventObject)
  {
    XDBPath objXDBPath = null;
    String strPathName="";
    objXDBPath = eventObject.getPath();
    strPathName = objXDBPath.getName();
    XDBResource objXDBResource1;
    objXDBResource1 = eventObject.getResource();
    String textResDisplayName = objXDBResource1.getDisplayName();
    String resType = objXDBResource1.getContentType();
    String linkFolder="";
    System.out.println("resType" + resType+"sumit");
    System.out.println("strPathName:" + strPathName);
    System.out.println("textResDisplayName:" + textResDisplayName);
    if (resType.equals("<span class="bold">text/xml</span>")) linkFolder = "<span class="bold">/public/app/XML-TXT/</span>";
    else if (resType.equals("<span class="bold">image/gif</span>")) linkFolder = "<span class="bold">/public/app/IMG/</span>";
    else if (resType.equals("<span class="bold">application/octet-stream</span>"))
            linkFolder = "<span class="bold">/public/app/FOLDER/</span>";
    System.out.println("linkFolder:" + linkFolder);
    try
    {
      Connection con1 = connectToDB();
      OraclePreparedStatement stmt=null;
      stmt = (OraclePreparedStatement)con1.prepareStatement(
               "CALL DBMS_XDB_REPOS.<span class="bold">link</span>(?,?,?)");
      stmt.setString(1,strPathName);
      stmt.setString(2,linkFolder);
      stmt.setString(3,textResDisplayName);
      stmt.execute();
      stmt.close();
      con1.close();
    }
    catch(java.sql.SQLException ej1)
    {
      System.out.println("ej1:" + ej1.toString());
    }
 
  /* Make sure the link is not in the category folders.
     Then check the target resource's mime type and create a link
     in the appropriate category folder. */
  }
  public void <span class="bold">handlePreUnlinkIn</span> (XDBRepositoryEvent eventObject)
  {
    XDBPath objXDBPath = null;
    String strPathName="";
    objXDBPath = eventObject.getPath();
    strPathName = objXDBPath.getName();
    XDBResource objXDBResource1;
    objXDBResource1 = eventObject.getResource();
    String textResDisplayName = objXDBResource1.getDisplayName();
    String resType = objXDBResource1.getContentType();
    String linkFolder="";
    if (resType.equals("<span class="bold">text/xml</span>")) linkFolder = "<span class="bold">/public/app/XML-TXT/</span>";
    else if (resType.equals("<span class="bold">image/gif</span>")) linkFolder = "<span class="bold">/public/app/IMG/</span>";
    else if (resType.equals("<span class="bold">application/octet-stream</span>"))
            linkFolder = "<span class="bold">/public/app/FOLDER/</span>";
    try
    {
      Connection con1 = connectToDB();
      OraclePreparedStatement stmt=null;
      stmt = (OraclePreparedStatement)con1.prepareStatement(
               "CALL DBMS_XDB_REPOS.<span class="bold">deleteResource</span>(?)");
      stmt.setString(1,linkFolder+textResDisplayName);
      stmt.execute();
      stmt.close();
      con1.close();
    }
    catch(java.sql.SQLException ej1)
    {
      System.out.println("ej1:" + ej1.toString());
    }
  }
}
</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-52AEF536-45B7-40B3-88FF-0B1DD0C56976__BABIHGGH">
                        <p class="titleinexample">Example 30-5 Invoking Event Handlers</p><pre class="oac_no_warn" dir="ltr">DECLARE
  ret BOOLEAN;
BEGIN
  ret := DBMS_XDB_REPOS.createResource('/public/<span class="bold">res-app/res1.xml</span>',
                                       '&lt;name&gt;TestForEventType-1&lt;/name&gt;');
END;
/
DECLARE
  b BOOLEAN := FALSE;
  dummy_data CLOB := 'AAA';
BEGIN
  b := DBMS_XDB_REPOS.createResource('/public/<span class="bold">res-app/res2.gif</span>', dummy_data);
END;
/
DECLARE
  b BOOLEAN := FALSE;
  dummy_data CLOB := 'AAA';
BEGIN
  b := DBMS_XDB_REPOS.createFolder('/public/<span class="bold">res-app/res-appfolder1</span>');
END;
 
SELECT PATH FROM PATH_VIEW WHERE PATH LIKE '/public/<span class="bold">app</span>/%' ORDER BY PATH;
 
PATH
---------------------------------
/public/app/FOLDER
/public/<span class="bold">app/FOLDER/res-appfolder1</span>
/public/app/IMG
/public/<span class="bold">app/IMG/res2.gif</span>
/public/app/XML-TXT
/public/<span class="bold">app/XML-TXT/res1.xml</span>
 
6 rows selected.
 
-- Delete the /res-app resources. The /app resources are deleted also.
EXEC DBMS_XDB_REPOS.deleteResource('/public/res-app/res2.gif');
EXEC DBMS_XDB_REPOS.deleteResource('/public/res-app/res1.xml');
EXEC DBMS_XDB_REPOS.deleteResource('/public/res-app/res-appfolder1');
 
SELECT PATH FROM PATH_VIEW WHERE PATH LIKE '/public/<span class="bold">app</span>/%' ORDER BY PATH;
 
PATH
-------------------
/public/app/FOLDER
/public/app/IMG
/public/app/XML-TXT
 
3 rows selected.</pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="XML-DB-repository-events.html#GUID-C7D110F1-CB15-475B-83E6-7C186DF0E119" title="In a resource configuration file, you use element event-listeners, child of element ResConfig, to configure Oracle XML&nbsp;DB Repository event handling.">Configuration of Repository Events</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>