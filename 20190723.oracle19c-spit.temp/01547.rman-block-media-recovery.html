<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Performing Block Media Recovery</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Backup and Recovery User's Guide">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Backup and Recovery User's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96241-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="rman-performing-flashback-dbpitr.html" title="Previous" type="text/html">
      <link rel="next" href="rman-recovery-advanced.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User's Guide">
    <meta name="dcterms.isVersionOf" content="BRADV">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="rman-performing-flashback-dbpitr.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="rman-recovery-advanced.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Backup and Recovery User's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-diagnosing-responding-failures.html" property="item" typeof="WebPage"><span property="name"> Diagnosing and Responding to Failures </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Performing Block Media Recovery</li>
            </ol>
            <a id="GUID-1E226393-17D0-4AB0-A05D-91210255D8FF" name="GUID-1E226393-17D0-4AB0-A05D-91210255D8FF"></a><a id="BRADV89781"></a>
            
            <h2 id="BRADV-GUID-1E226393-17D0-4AB0-A05D-91210255D8FF" class="sect2"><span class="enumeration_chapter">19 </span>Performing Block Media Recovery
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>This chapter explains how to restore and recover individual data blocks within a data file. This chapter contains the following topics:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="rman-block-media-recovery.html#GUID-B6CFA426-5B2D-401F-B8B3-58FCD9ED3216" title="Block media recovery recovers provides lower mean time to recover (MTTR) by recovering corrupt data blocks.">Overview of Block Media Recovery</a></p>
                  </li>
                  <li>
                     <p><a href="rman-block-media-recovery.html#GUID-C1164158-496C-4D8A-8A06-D343935FC3B9" title="Certain prerequisites must be met before you perform block media recovery by using the RECOVER ... BLOCK command.">Prerequisites for Block Media Recovery</a></p>
                  </li>
                  <li>
                     <p><a href="rman-block-media-recovery.html#GUID-21EFB177-2AC7-457C-80A0-63B11A80CD0B" title="Use the RECOVER...BLOCK command to recover individual corrupt blocks in a data file.">Recovering Individual Blocks</a></p>
                  </li>
                  <li>
                     <p><a href="rman-block-media-recovery.html#GUID-937FA44F-1556-4750-8E07-33A4D6FD64BB" title="RMAN can automatically recover all blocks listed in the V$DATABASE_BLOCK_CORRUPTION view.">Recovering All Blocks in V$DATABASE_BLOCK_CORRUPTION</a></p>
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-1E226393-17D0-4AB0-A05D-91210255D8FF__GUID-CF62875B-819F-4CE6-B87A-5A137FA6EFB1">
                  <p class="notep1">See Also:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF140" target="_blank"><span class="italic">Oracle Database Backup and Recovery Reference</span></a> for <code class="codeph">RECOVER</code> syntax
                        </p>
                     </li>
                     <li>
                        <p><a href="../refrn/V-DATABASE_BLOCK_CORRUPTION.html#REFRN30048" target="_blank"><span class="italic">Oracle Database Reference </span></a>for details about <a id="d87638e131" class="indexterm-anchor"></a>the <code class="codeph">V$DATABASE_BLOCK_CORRUPTION</code> view
                        </p>
                     </li>
                  </ul>
               </div>
            </div><a id="BRADV157"></a><div class="props_rev_3"><a id="GUID-B6CFA426-5B2D-401F-B8B3-58FCD9ED3216" name="GUID-B6CFA426-5B2D-401F-B8B3-58FCD9ED3216"></a><h3 id="BRADV-GUID-B6CFA426-5B2D-401F-B8B3-58FCD9ED3216" class="sect3"><span class="enumeration_section">19.1 </span>Overview of Block Media Recovery
               </h3>
               <div>
                  <p>Block media recovery recovers provides lower mean time to recover (MTTR) by recovering corrupt data blocks.</p>
                  <p>This section contains the following topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="rman-block-media-recovery.html#GUID-83CB3821-DCA8-459E-8038-CBD4D581A225" title="Use block media recovery to recover one or more corrupt data blocks within a data file.">Purpose of Block Media Recovery</a></p>
                     </li>
                     <li>
                        <p><a href="rman-block-media-recovery.html#GUID-69B1C218-A199-4993-AC71-C87FE0376E32" title="Usually, the database marks a block as media corrupt and then writes it to disk when the corruption is first encountered. No subsequent read of the block is successful until the block is recovered. You can perform block recovery only on blocks that are marked corrupt or that fail a corruption check.">Basic Concepts of Block Media Recovery</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89782"></a><div class="props_rev_3"><a id="GUID-83CB3821-DCA8-459E-8038-CBD4D581A225" name="GUID-83CB3821-DCA8-459E-8038-CBD4D581A225"></a><h4 id="BRADV-GUID-83CB3821-DCA8-459E-8038-CBD4D581A225" class="sect4"><span class="enumeration_section">19.1.1 </span>Purpose of Block Media Recovery
                  </h4>
                  <div>
                     <p>Use block media recovery to recover one or more corrupt data blocks within a data file. </p>
                     <p>Block media recovery provides the following advantages over <a href="glossary.html#GUID-01B3A956-DA97-4B47-9600-FA5549B7E868"><span class="xrefglossterm">data file media recovery</span></a>:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Lowers the <a href="glossary.html#GUID-93551250-2FC8-4C64-92EF-492C40F74D85"><span class="xrefglossterm">mean time to recover (MTTR)</span></a> because only blocks needing recovery are restored and recovered
                           </p>
                        </li>
                        <li>
                           <p>Enables affected data files to remain online during recovery</p>
                           <p>Without block media recovery, if even a single block is corrupt, then you must take the data file offline and restore a backup of the data file. You must apply all redo generated for the data file after the backup was created. The entire file is unavailable until media recovery completes. With block media recovery, only the blocks actually being recovered are unavailable during the recovery.</p>
                        </li>
                     </ul>
                     <p>Block media recovery is most useful for <a href="glossary.html#GUID-6035D1EA-C660-4F45-B1AC-FE6B15810C54"><span class="xrefglossterm">physical corruption</span></a> problems that involve a small, well-known number of blocks. Block-level data loss usually results from intermittent, random I/O errors that do not cause widespread data loss, and memory corruptions that are written to disk. Block media recovery is not intended for cases where the extent of data loss or corruption is unknown and the entire data file requires recovery. In such cases, data file media recovery is the best solution.
                     </p>
                  </div>
               </div><a id="BRADV118"></a><div class="props_rev_3"><a id="GUID-69B1C218-A199-4993-AC71-C87FE0376E32" name="GUID-69B1C218-A199-4993-AC71-C87FE0376E32"></a><h4 id="BRADV-GUID-69B1C218-A199-4993-AC71-C87FE0376E32" class="sect4"><span class="enumeration_section">19.1.2 </span>Basic Concepts of Block Media Recovery
                  </h4>
                  <div>
                     <p>Usually, the database marks a block as media corrupt and then writes it to disk when the corruption is first encountered. No subsequent read of the block is successful until the block is recovered. You can perform block recovery only on blocks that are marked corrupt or that fail a corruption check.</p>
                     <p>Typically, block corruption is reported in the following locations:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Results of the <code class="codeph">LIST FAILURE</code>, <code class="codeph">VALIDATE</code>, or <code class="codeph">BACKUP ... VALIDATE</code> command
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">V$DATABASE_BLOCK_CORRUPTION</code> view
                           </p>
                        </li>
                        <li>
                           <p>Error messages in standard output</p>
                        </li>
                        <li>
                           <p>The alert log</p>
                        </li>
                        <li>
                           <p>User trace files</p>
                        </li>
                        <li>
                           <p>Results of the SQL commands <code class="codeph">ANALYZE TABLE</code> and <code class="codeph">ANALYZE INDEX</code> 
                           </p>
                        </li>
                        <li>
                           <p>Results of the DBVERIFY utility</p>
                        </li>
                        <li>
                           <p>Third-party media management output</p>
                        </li>
                     </ul>
                     <p>For example, you may discover the following messages in a user trace file:</p><pre class="oac_no_warn" dir="ltr">ORA-01578: ORACLE data block corrupted (file # 7, block # 3)
ORA-01110: data file 7: '/oracle/oradata/trgt/tools01.dbf'
ORA-01578: ORACLE data block corrupted (file # 2, block # 235)
ORA-01110: data file 2: '/oracle/oradata/trgt/undotbs01.dbf'
</pre><div class="infoboxnotealso" id="GUID-69B1C218-A199-4993-AC71-C87FE0376E32__GUID-C2A8F1EE-61E4-4AE9-B7EC-B353ACCAF2B8">
                        <p class="notep1">See Also:</p>
                        <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF140" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> for <code class="codeph">RECOVER ... BLOCK</code> syntax
                        </p>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-9A704D4E-621E-4473-913F-DEA0D0D3D9AE" name="GUID-9A704D4E-621E-4473-913F-DEA0D0D3D9AE"></a><h5 id="BRADV-GUID-9A704D4E-621E-4473-913F-DEA0D0D3D9AE" class="sect5"><span class="enumeration_section">19.1.2.1 </span>About Block Recovery and Standby Databases
                     </h5>
                     <div>
                        <p>Block recovery behavior depends on whether the data block corruption was discovered on the primary database or the physical standby database.</p>
                        <p>If the database on which the corruption occurs is associated with a real-time query physical standby database, then the database <span class="italic">automatically</span> attempts to perform block media recovery. The primary database searches for good copies of blocks on the standby database and, if they are found, repairs the blocks with no impact to the query that encountered the corrupt block. The Oracle Database physical block corruption message (<code class="codeph">ORA-1578</code>) is displayed only if the database cannot repair the corruption.
                        </p>
                        <p>Whenever block corruption has been automatically detected, you can perform block media recovery manually with the <code class="codeph">RECOVER ... BLOCK</code> command. By default, RMAN first searches for good blocks in the real-time query physical standby database, then flashback logs and then blocks in full or level 0 incremental backups. 
                        </p>
                        <div class="infoboxnote" id="GUID-9A704D4E-621E-4473-913F-DEA0D0D3D9AE__GUID-B08FB1C2-D7EF-4516-8F6B-A15DC08BB1BC">
                           <p class="notep1">Note:</p>
                           <p>For block media recovery to work automatically, the physical standby database must be in real-time query mode. An Oracle Active Data Guard license is required.</p>
                        </div>
                        <p>If a corrupt data block is discovered on a real-time query physical standby database, the server attempts to repair the corruption by obtaining a copy of the block from the primary database. The repair is performed in the background, enabling subsequent queries to succeed if the repair is successful. Automatic block repair is attempted if the following database initialization parameters are configured on the standby database as described:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>The <code class="codeph">LOG_ARCHIVE_CONFIG</code> parameter is configured with a <code class="codeph">DG_CONFIG</code> list and a <code class="codeph">LOG_ARCHIVE_DEST_n</code> parameter is configured for the primary database with the <code class="codeph">DB_UNIQUE_NAME</code> attribute
                              </p>
                              <p><span class="bold">or</span></p>
                           </li>
                           <li>
                              <p>The <code class="codeph">FAL_SERVER</code> parameter is configured and its value contains an Oracle Net service name for the primary database
                              </p>
                           </li>
                        </ul>
                        <div class="infoboxnote" id="GUID-9A704D4E-621E-4473-913F-DEA0D0D3D9AE__GUID-8905AFFC-0DFF-4C4F-9541-2B46AFF4AA5F">
                           <p class="notep1">Note:</p>
                           <p>If a corrupt block is detected during validation, such as by the RMAN <code class="codeph">VALIDATE</code> command, then recovery is <span class="italic">not</span> initiated automatically. 
                           </p>
                        </div>
                        <div class="infoboxnotealso" id="GUID-9A704D4E-621E-4473-913F-DEA0D0D3D9AE__GUID-C12E2D4C-A61E-43B4-8CD6-B0DA08301076">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF140" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> for <code class="codeph">RECOVER ... BLOCK</code> syntax
                                 </p>
                              </li>
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=SBYDB00707" target="_blank"><span><cite>Oracle Data Guard Concepts and Administration</cite></span></a> to learn about the real-time query option for standby databases
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="BRADV89783"></a><div class="props_rev_3"><a id="GUID-BBD0093C-AC8D-490C-868C-FB5F83CB0870" name="GUID-BBD0093C-AC8D-490C-868C-FB5F83CB0870"></a><h5 id="BRADV-GUID-BBD0093C-AC8D-490C-868C-FB5F83CB0870" class="sect5"><span class="enumeration_section">19.1.2.2 </span>About Identifying Corrupt Blocks
                     </h5>
                     <div>
                        <p>The <code class="codeph">V$DATABASE_BLOCK_CORRUPTION</code> view displays blocks marked corrupt by database components such as RMAN, <code class="codeph">ANALYZE</code>, and SQL queries.
                        </p>
                        <p>The following types of corruption result in the addition of rows to this view:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Physical corruption (sometimes called media corruption)</p>
                              <p>The database does not recognize the block: the <a href="glossary.html#GUID-36837841-FB21-45C7-A99A-FFC35D04FB0B"><span class="xrefglossterm">checksum</span></a> is invalid, the block contains all zeros, or the block header is corrupt.
                              </p>
                              <p>Physical corruption checking is enabled by default. You can turn off checksum checking by specifying the <code class="codeph">NOCHECKSUM</code> option of the <code class="codeph">BACKUP</code> command, but other physical consistency checks, such as checks of the block headers and footers, cannot be disabled.
                              </p>
                           </li>
                           <li>
                              <p>Logical corruption</p>
                              <p>The block has a valid checksum, the header and footer match, and so on, but the contents are logically inconsistent. Block media recovery may not be able to repair all logical block corruptions. In these cases, alternate recovery methods, such as tablespace point-in-time recovery, or dropping and re-creating the affected objects, may repair the corruption.</p>
                              <p>Logical corruption checking is disabled by default. You can turn it on by specifying the <code class="codeph">CHECK</code> <code class="codeph">LOGICAL</code> option of the <code class="codeph">BACKUP</code>, <code class="codeph">RESTORE</code>, <code class="codeph">RECOVER</code>, and <code class="codeph">VALIDATE</code> commands.
                              </p>
                           </li>
                        </ul>
                        <p>The database can detect some corruptions by validating relationships between blocks and segments, but cannot detect them by a check of an individual block. The <code class="codeph">V$DATABASE_BLOCK_CORRUPTION</code> view does not record at this level of granularity.
                        </p>
                     </div>
                  </div><a id="BRADV359"></a><a id="BRADV89784"></a><div class="props_rev_3"><a id="GUID-EE0CBA84-C782-4DF1-981B-81003B040291" name="GUID-EE0CBA84-C782-4DF1-981B-81003B040291"></a><h5 id="BRADV-GUID-EE0CBA84-C782-4DF1-981B-81003B040291" class="sect5"><span class="enumeration_section">19.1.2.3 </span>About Missing Redo During Block Recovery
                     </h5>
                     <div>
                        <p>Block media recovery only requires an unbroken set of redo changes for the blocks being recovered. This is unlike data file recovery that requires an unbroken series of redo changes from the beginning of recovery to the end.</p>
                        <p>Like data file media recovery, block media recovery cannot generally survive a missing or inaccessible archived log, although it attempts restore failover when looking for usable copies of archived redo log files. Also, block media recovery cannot survive physical redo corruptions that result in checksum failure. However, block media recovery can survive gaps in the redo stream if the missing or corrupt redo records do not affect the blocks being recovered. </p>
                        <div class="infoboxnote" id="GUID-EE0CBA84-C782-4DF1-981B-81003B040291__GUID-7862473B-3D50-4203-8B2B-1689604A3489">
                           <p class="notep1">Note:</p>
                           <p>Each block is recovered independently during block media recovery, so recovery may be successful for a subset of blocks.</p>
                        </div>
                        <p>When RMAN first detects missing or corrupt redo records during block media recovery, it does not immediately signal an error because the block undergoing recovery may create one later in the redo stream. When a block is re-created, all previous redo for that block becomes irrelevant because the redo applies to an old incarnation of the block. For example, the database creates a new a block when users drop or truncate a table and then use the block for other data.</p>
                        <p>Assume that media recovery is performed on block 13 as depicted in <a href="rman-block-media-recovery.html#GUID-EE0CBA84-C782-4DF1-981B-81003B040291__CIHHCEFH">Figure 19-1</a>.
                        </p>
                        <div class="figure" id="GUID-EE0CBA84-C782-4DF1-981B-81003B040291__CIHHCEFH">
                           <p class="titleinfigure">Figure 19-1 Performing RMAN Media Recovery</p><img src="img/bradv007.gif" alt="Description of Figure 19-1 follows" title="Description of Figure 19-1 follows" longdesc="img_text/bradv007.html"><br><a href="img_text/bradv007.html">Description of "Figure 19-1 Performing RMAN Media Recovery"</a></div>
                        <!-- class="figure" -->
                        <p>After block recovery begins, RMAN discovers that change 120 is missing from the redo stream, either because the log block is corrupt or because the log cannot be found. RMAN continues recovery if block 13 is re-created later in the redo stream. Assume that in change 140 a user drops the table <code class="codeph">employees</code> stored in block 13, allocates a new table in this block, and inserts data into the new table. At this point, the database formats block 13 as a new block. Recovery can now proceed with this block even though some redo preceding the recreation operation was missing.
                        </p>
                        <div class="infoboxnotealso" id="GUID-EE0CBA84-C782-4DF1-981B-81003B040291__GUID-3D076235-92F1-4DAB-B734-F255F302C08D">
                           <p class="notep1">See Also:</p>
                           <p><a href="rman-data-repair-concepts.html#GUID-D76CD1E8-2B9E-40F6-A13F-3264D6BA2B8C" title="RMAN automatically uses restore failover to skip corrupted or inaccessible backups and look for usable backups. When a backup is not found, or contains corrupt data, RMAN automatically looks for another backup from which to restore the desired files.">About RMAN Restore Failover</a></p>
                        </div>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV89785"></a><div class="props_rev_3"><a id="GUID-C1164158-496C-4D8A-8A06-D343935FC3B9" name="GUID-C1164158-496C-4D8A-8A06-D343935FC3B9"></a><h3 id="BRADV-GUID-C1164158-496C-4D8A-8A06-D343935FC3B9" class="sect3"><span class="enumeration_section">19.2 </span>Prerequisites for Block Media Recovery
               </h3>
               <div>
                  <p>Certain prerequisites must be met before you perform block media recovery by using the <code class="codeph">RECOVER ... BLOCK</code> command.
                  </p>
                  <p>The prerequisites include the following:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>The target database must run in <code class="codeph">ARCHIVELOG</code> mode and be open or mounted with a current control file.
                        </p>
                     </li>
                     <li>
                        <p>If the target database is a standby database, then it must be in a consistent state, recovery cannot be in session, and the backup must be older than the corrupted file.</p>
                     </li>
                     <li>
                        <p>The backups of the data files containing the corrupt blocks must be full or level 0 backups. They cannot be proxy copies or incremental backups. </p>
                        <p>If only <a href="glossary.html#GUID-C4A7D804-0F77-4FA3-AA77-85D3C7E78E2B"><span class="xrefglossterm">proxy copy</span></a> backups exist, then you can restore them to a nondefault location on disk, in which case RMAN considers them data file copies and searches them for blocks during block media recovery.
                        </p>
                     </li>
                     <li>
                        <p>RMAN can use only archived redo logs for the recovery. </p>
                        <p>RMAN cannot use level 1 incremental backups. Block media recovery cannot survive a missing or inaccessible archived redo log, although it can sometimes survive missing redo records.</p>
                     </li>
                     <li>
                        <p>Flashback Database must be enabled on the target database for RMAN to search the flashback logs for good copies of corrupt blocks.</p>
                        <p>If flashback logging is enabled and contains older, uncorrupted versions of the corrupt blocks, then RMAN can use these blocks, possibly speeding up the recovery.</p>
                     </li>
                     <li>
                        <p>The target database must be associated with a real-time query physical standby database for RMAN to search the database for good copies of corrupt blocks.</p>
                     </li>
                  </ul>
               </div>
            </div><a id="BRADV89786"></a><div class="props_rev_3"><a id="GUID-21EFB177-2AC7-457C-80A0-63B11A80CD0B" name="GUID-21EFB177-2AC7-457C-80A0-63B11A80CD0B"></a><h3 id="BRADV-GUID-21EFB177-2AC7-457C-80A0-63B11A80CD0B" class="sect3"><span class="enumeration_section">19.3 </span>Recovering Individual Blocks
               </h3>
               <div>
                  <p>Use the <code class="codeph">RECOVER...BLOCK</code> command to recover individual corrupt blocks in a data file.
                  </p>
                  <p>This section contains the following topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="rman-block-media-recovery.html#GUID-B2CB58B5-C50E-41BC-8D4E-51C0F18D7D3F" title="You identify the blocks that require recovery and then use any available backup to restore and recover these blocks.">Recovering Individual Blocks Using the RECOVER...BLOCK Command</a></p>
                     </li>
                     <li>
                        <p><a href="rman-block-media-recovery.html#GUID-3471570C-A181-403D-A4DE-66F1E400D310" title="You can use the Data Recovery Advisor to diagnose and repair failures caused by data block corruptions. In this example, corrupt data blocks were discovered when the VALIDATE DATABASE command.">Example: Recovering Individual Blocks Using the Data Recovery Advisor</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV360"></a><a id="BRADV856"></a><div class="props_rev_3"><a id="GUID-B2CB58B5-C50E-41BC-8D4E-51C0F18D7D3F" name="GUID-B2CB58B5-C50E-41BC-8D4E-51C0F18D7D3F"></a><h4 id="BRADV-GUID-B2CB58B5-C50E-41BC-8D4E-51C0F18D7D3F" class="sect4"><span class="enumeration_section">19.3.1 </span>Recovering Individual Blocks Using the RECOVER...BLOCK Command
                  </h4>
                  <div>
                     <p>You identify the blocks that require recovery and then use any available backup to restore and recover these blocks.</p>
                     <div class="section">
                        <p><span class="bold">To recover specific data blocks using the RECOVER...BLOCK command:</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Obtain the data file numbers and block numbers of the corrupted blocks.</span><div>
                              <p>The easiest way to locate trace files and the alert log is to connect SQL*Plus to the target database and execute the following query:</p><pre class="oac_no_warn" dir="ltr">SELECT NAME, VALUE 
FROM   V$DIAG_INFO;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Start RMAN and connect to the target database, which must be mounted or open.</span></li>
                        <li class="stepexpand"><span>Run the <code class="codeph">SHOW ALL</code> command to confirm that the appropriate channels are preconfigured.</span></li>
                        <li class="stepexpand"><span>Run the <code class="codeph">RECOVER ... BLOCK</code> command at the RMAN prompt, specifying the file and block numbers for the corrupted blocks.</span><div>
                              <p>The following example recovers two blocks.</p><pre class="oac_no_warn" dir="ltr">RECOVER 
  DATAFILE 8 BLOCK 13 
  DATAFILE 2 BLOCK 19;
</pre><p>You can also specify various options to control RMAN behavior. The following example indicates that only backups with the tag <code class="codeph">mondayam</code> are used when searching for blocks. You could use the <code class="codeph">FROM BACKUPSET</code> option to restrict the type of backup that RMAN searches, or the <code class="codeph">EXCLUDE FLASHBACK LOG</code> option to restrict RMAN from searching the flashback logs.
                              </p><pre class="oac_no_warn" dir="ltr">RECOVER 
  DATAFILE 8 BLOCK 13 
  DATAFILE 2 BLOCK 199
  FROM TAG mondayam;</pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV857"></a><div class="props_rev_3"><a id="GUID-3471570C-A181-403D-A4DE-66F1E400D310" name="GUID-3471570C-A181-403D-A4DE-66F1E400D310"></a><h4 id="BRADV-GUID-3471570C-A181-403D-A4DE-66F1E400D310" class="sect4"><span class="enumeration_section">19.3.2 </span>Example: Recovering Individual Blocks Using the Data Recovery Advisor
                  </h4>
                  <div>
                     <p>You can use the Data Recovery Advisor to diagnose and repair failures caused by data block corruptions. In this example, corrupt data blocks were discovered when the <code class="codeph">VALIDATE DATABASE</code> command.
                     </p>
                     <div class="section">
                        <p><span class="bold">To generate automated repair options and repair the failure using the Data Recovery Advisor:</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Start RMAN and connect to the target database, as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>.</span></li>
                        <li class="stepexpand" id="GUID-3471570C-A181-403D-A4DE-66F1E400D310__CHDFJHAD"><span>List the failures recorded by the Data Recovery Advisor using the following command:</span><div><pre class="oac_no_warn" dir="ltr">LIST FAILURE;

Database Role: PRIMARY

List of Database Failures
=========================

Failure ID Priority Status    Time Detected Summary
---------- -------- --------- ------------- -------
5720       HIGH     OPEN      24-APR-14     Datafile 14:
 '/home1/oracle/dbs/tbs_32.f' contains one or more corrupt blocks
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Generate repair options for the failure listed Step <a href="rman-block-media-recovery.html#GUID-3471570C-A181-403D-A4DE-66F1E400D310__CHDFJHAD">2</a>.</span><div>
                              <p>The following command generates repair options and creates a repair script to perform the automated repair tasks.</p><pre class="oac_no_warn" dir="ltr">ADVISE FAILURE;

Database Role: PRIMARY

List of Database Failures
=========================

Failure ID Priority Status    Time Detected Summary
---------- -------- --------- ------------- -------
5720       HIGH     OPEN      24-APR-14     Datafile 14:
 '/home1/oracle/dbs/tbs_32.f' contains one or more corrupt blocks

analyzing automatic repair options; this may take some time
using channel ORA_DISK_1
analyzing automatic repair options complete

Mandatory Manual Actions
========================
no manual actions available

Optional Manual Actions
=======================
no manual actions available

Automated Repair Options
========================
Option Repair Description
------ ------------------
1      Perform block media recovery of block 20 in file 14  
  Strategy: The repair includes complete media recovery with no data loss
  Repair script: /home1/oracle/log/diag/rdbms/db12/hm/reco_287949467.hm

</pre></div>
                        </li>
                        <li class="stepexpand"><span>Perform the automated repairs recommended by Data Recovery Advisor.</span><div>
                              <p>RMAN uses the repair script generated by the <code class="codeph">ADVISE FAILURE</code> command to perform the required repairs.
                              </p><pre class="oac_no_warn" dir="ltr">REPAIR FAILURE;

Strategy: The repair includes complete media recovery with no data loss
Repair script: /home1/oracle/log/diag/rdbms/db12/hm/reco_287949467.hm
contents of repair script:   
# block media recovery   recover datafile 14 block 20;
Do you really want to execute the above repair (enter YES or NO)? 
yes
executing repair script
Starting recover at 24-APR-14
using channel ORA_DISK_1
channel ORA_DISK_1: restoring block(s)channel 
ORA_DISK_1: specifying block(s) to restore from backup setrestoring blocks of datafile 00014
channel ORA_DISK_1: reading from backup piece /backups/DB121/backupset/2014_04_24/o1_mf_nnndf_TAG20140424T213309_9omsd7vb_.bkp
channel ORA_DISK_1: piece handle=/backups/DB121/backupset/2014_04_24/o1_mf_nnndf_TAG20140424T213309_9omsd7vb_.bkp tag=TAG20140424T213309
channel ORA_DISK_1: restored block(s) from backup piece 1
channel ORA_DISK_1: block restore complete, elapsed time: 00:00:01
starting media recovery
media recovery complete, elapsed time: 00:00:03
Finished recover at 24-APR-14repair failure complete
</pre><p>When the <code class="codeph">LIST FAILURE</code> command displays more than one failures, you can perform repair actions only for a particular failure. Use the option number displayed in the Automated Repair Options section of the <code class="codeph">ADVISE FAILURE</code> command output to perform specific repair actions.
                              </p>
                              <p>The following command performs only the repair actions listed under Option 2 of the Automated Repair Options section.</p><pre class="oac_no_warn" dir="ltr">REPAIR FAILURE USING ADVISE OPTION 2;</pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-3471570C-A181-403D-A4DE-66F1E400D310__GUID-883EEEA6-6BB7-4607-ACA7-8367C8CFA3F3">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="diagnosing-repairing-failures-dra.html#GUID-8C219B50-1F7F-4F7A-95EE-5F029AE7EB2A" title="The Data Recovery Advisor is a tool that helps reduce database recovery time by determining the best automated repair option for database failures.Data Recovery Advisor is an Oracle Database tool that automatically diagnoses data failures, determines and presents appropriate repair options, and executes repairs at the user's request.You must familiarize yourself with a few concepts before using the Data Recovery Advisor.Data Recovery Advisor has both a command-line and GUI interface. The GUI interface is available in Oracle Enterprise Manager Cloud Control.A checker is a diagnostic operation or procedure registered with the Health Monitor to assess the health of the database or its components. A failure is a persistent data corruption that is detected by a data integrity check.Every failure has a failure status: OPEN or CLOSED. Every failure has a failure priority: CRITICAL, HIGH, or LOW. Data Recovery Advisor only assigns CRITICAL or HIGH priority to diagnosed failures.For clarity, Data Recovery Advisor groups related failures together. The ADVISE FAILURE command can present both manual and automatic repair options. Data Recovery Advisor categorizes manual actions as either mandatory or optional.When possible, Data Recovery Advisor consolidates repairs to fix multiple failures into a single repair. A consolidated repair may contain multiple steps.Whenever Data Recovery Advisor generates an automated repair option, it creates a script that explains which commands RMAN intends to use to repair the failure. Data Recovery Advisor prints the location of this script, which is a text file residing on the operating system. Data Recovery Advisor is supported only on some database configurations.Data Recovery Advisor only supports single-instance databases. Oracle Real Application Clusters (Oracle RAC) databases are not supported.There are some limitations with Data Recovery Advisor in an Oracle Data Guard environment.Data Recovery Advisor can only be used to diagnose and repair data corruptions in non-CDBs and the root of a multitenant container database (CDB). Data Recovery Advisor is not supported for pluggable databases (PDBs).The Data Recovery Advisor workflow begins when you either suspect or discover a failure. You can discover failures in many ways, including error messages, alerts, trace files, and failed data integrity checks.You can use the Data Recovery Advisor to automatically diagnose data failures, determine appropriate repair options, and execute repairs in a CDB. If you suspect or know that one or more database failures have occurred, then use LIST FAILURE to obtain information about them.The easiest way to determine problems that your database is encountering is to use the LIST FAILURE command. Besides providing more verbose output, LIST FAILURE also enables you to restrict output.The database invokes data integrity checks reactively when a user transaction is trying to access corrupted data. In some cases, latent failures can go undetected. Use the ADVISE FAILURE command to display repair options after running LIST FAILURE in an RMAN session. This command prints a summary of the failures and implicitly closes all open failures that are repaired.If one or more failures exist, then you typically use LIST FAILURE to show information about the failures and then ADVISE FAILURE in the same RMAN session to obtain a report of your repair options.You can also request repair options for specific failures. You can specify failures by status (CRITICAL, HIGH, or LOW) or by failure number. You can also use EXCLUDE FAILURE to exclude one or more failures from the report.You can use Data Recovery Advisor to repair failures automatically.If ADVISE FAILURE suggests manual repairs, then try these first. If manual repairs are not possible, or if they do not repair all failures, then you can use REPAIR FAILURE to automatically fix failures suggested in the most recent ADVISE FAILURE command in your current RMAN session.By default the script is displayed to standard output. You can use the SPOOL command to write the script to an editable file.In some situations, you may want to use the CHANGE FAILURE command to alter the status or priority of a failure.">Diagnosing and Repairing Failures with Data Recovery Advisor</a></p>
                              </li>
                              <li>
                                 <p><a href="diagnosing-repairing-failures-dra.html#GUID-D9D58DB7-05ED-4A21-9D1A-94D57D600271" title="The database invokes data integrity checks reactively when a user transaction is trying to access corrupted data. In some cases, latent failures can go undetected.">Checking for Block Corruptions by Validating the Database</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV361"></a><a id="BRADV200"></a><div class="props_rev_3"><a id="GUID-937FA44F-1556-4750-8E07-33A4D6FD64BB" name="GUID-937FA44F-1556-4750-8E07-33A4D6FD64BB"></a><h3 id="BRADV-GUID-937FA44F-1556-4750-8E07-33A4D6FD64BB" class="sect3"><span class="enumeration_section">19.4 </span>Recovering All Blocks in V$DATABASE_BLOCK_CORRUPTION
               </h3>
               <div>
                  <p>RMAN can automatically recover all blocks listed in the <code class="codeph">V$DATABASE_BLOCK_CORRUPTION</code> view.
                  </p>
                  <div class="section">
                     <p><span class="bold">To recover all blocks logged in V$DATABASE_BLOCK_CORRUPTION:</span></p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>Start SQL*Plus and connect to the target database.</span></li>
                     <li class="stepexpand"><span>Query <code class="codeph">V$DATABASE_BLOCK_CORRUPTION</code> to determine whether corrupt blocks exist. For example, execute the following statement:</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT * FROM V$DATABASE_BLOCK_CORRUPTION;
</pre></div>
                     </li>
                     <li class="stepexpand"><span>Start RMAN and connect to the target database, as descried in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>.</span></li>
                     <li class="stepexpand"><span>Recover all blocks marked corrupt in <code class="codeph">V$DATABASE_BLOCK_CORRUPTION</code>.</span><div>
                           <p>The following command repairs all physically corrupted blocks recorded in the view:</p><pre class="oac_no_warn" dir="ltr">RMAN&gt; RECOVER CORRUPTION LIST;
</pre><p>After the blocks are recovered, the database removes them from <code class="codeph">V$DATABASE_BLOCK_CORRUPTION</code>.
                           </p>
                        </div>
                     </li>
                  </ol>
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-937FA44F-1556-4750-8E07-33A4D6FD64BB__GUID-DCB86457-6A4A-4B82-BB2C-42030CE78FA0">
                        <p class="notep1">See Also:</p>
                        <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF140" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> to learn about the <code class="codeph">RECOVER ... BLOCK</code> command
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>