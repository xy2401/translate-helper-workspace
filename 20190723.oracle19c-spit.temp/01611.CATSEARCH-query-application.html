<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>CATSEARCH Query Application</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Application Developer's Guide ">
      <meta property="og:description" content>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Application Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="text-application-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-07T01:45:16-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2001, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96275-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="CONTEXT-query-application.html" title="Previous" type="text/html">
      <link rel="next" href="custom-index-preference-examples.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Text Application Developer's Guide">
    <meta name="dcterms.isVersionOf" content="CCAPP">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="CONTEXT-query-application.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="custom-index-preference-examples.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Application Developer's Guide </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> CATSEARCH Query Application </li>
            </ol>
            <a id="GUID-72F18A97-92D7-411D-871A-27AD749D6141" name="GUID-72F18A97-92D7-411D-871A-27AD749D6141"></a><a id="CCAPP3100"></a>
            
            <h2 id="CCAPP-GUID-72F18A97-92D7-411D-871A-27AD749D6141" class="sect2"><span class="enumeration_chapter">B </span> CATSEARCH Query Application 
            </h2>
         </header>
         <div class="ind">
            <div>
               <p><a id="d41409e61" class="indexterm-anchor"></a><a id="d41409e65" class="indexterm-anchor"></a><a id="d41409e67" class="indexterm-anchor"></a><a id="d41409e71" class="indexterm-anchor"></a>This appendix describes how to build a simple web search application by using the <code class="codeph">CATSEARCH</code> index type.
               </p>
               <p>This appendix contains the following topics:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="CATSEARCH-query-application.html#GUID-D7B36466-FD0E-49FB-9677-0342B6F9931C">CATSEARCH Web Query Application Overview</a></p>
                  </li>
                  <li>
                     <p><a href="CATSEARCH-query-application.html#GUID-24D14B20-AA64-4192-AABB-98CEA4744B82">The JSP Web Application</a></p>
                  </li>
               </ul>
            </div><a id="CCAPP9384"></a><div class="props_rev_3"><a id="GUID-D7B36466-FD0E-49FB-9677-0342B6F9931C" name="GUID-D7B36466-FD0E-49FB-9677-0342B6F9931C"></a><h3 id="CCAPP-GUID-D7B36466-FD0E-49FB-9677-0342B6F9931C" class="sect3"><span class="enumeration_section">B.1 </span>CATSEARCH Web Query Application Overview
               </h3>
               <div>
                  <p>The <code class="codeph">CTXCAT</code> index type is well suited for merchandise catalogs that have short, descriptive text fragments and associated structured data. This appendix describes how to build a browser-based bookstore catalog that users can search to find titles and prices.
                  </p>
                  <p>This application is written in JavaServer Pages (JSP). </p>
               </div>
            </div><a id="CCAPP9385"></a><div class="props_rev_3"><a id="GUID-24D14B20-AA64-4192-AABB-98CEA4744B82" name="GUID-24D14B20-AA64-4192-AABB-98CEA4744B82"></a><h3 id="CCAPP-GUID-24D14B20-AA64-4192-AABB-98CEA4744B82" class="sect3"><span class="enumeration_section">B.2 </span>The JSP Web Application
               </h3>
               <div>
                  <p>This application is based on JavaServer pages (JSP) and has the following requirements:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Your Oracle Database must be up and running.</p>
                     </li>
                     <li>
                        <p>A web server such as Apache Tomcat, which is can run JSP scripts that connect to the Oracle Database by using Java Database Connectivity (JDBC).</p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-24D14B20-AA64-4192-AABB-98CEA4744B82__GUID-604B2334-6E47-4A80-9464-482B3C599AFF">
                     <p class="notep1">See Also:</p>
                     <p><span class="italic">Oracle Database 2 Day + PHP Developer's Guide</span> for information about installing Apache HTTP Server
                     </p>
                  </div>
                  <p>This section contains the following topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="CATSEARCH-query-application.html#GUID-0545BB84-B851-4CCE-8A6A-51857384E071">Building the JSP Web Application</a></p>
                     </li>
                     <li>
                        <p><a href="CATSEARCH-query-application.html#GUID-C3986263-5739-43D4-B703-8805AE8CE142">JSP Web Application Sample Code</a></p>
                     </li>
                  </ul>
               </div><a id="CCAPP9531"></a><a id="CCAPP9386"></a><div class="props_rev_3"><a id="GUID-0545BB84-B851-4CCE-8A6A-51857384E071" name="GUID-0545BB84-B851-4CCE-8A6A-51857384E071"></a><h4 id="CCAPP-GUID-0545BB84-B851-4CCE-8A6A-51857384E071" class="sect4"><span class="enumeration_section">B.2.1 </span>Building the JSP Web Application
                  </h4>
                  <div>
                     <div class="section">
                        <p>This application models an online bookstore, where you can look up book titles and prices.</p>
                        <p>To create the JavaServer Pages (JSP) web application:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Create your table.</span><div>
                              <p>You must create the table to store such book information as title, publisher, and price. From SQL*Plus:</p><pre class="oac_no_warn" dir="ltr">sqlplus&gt;create table book_catalog (
          id        numeric,
          title     varchar2(80),
          publisher varchar2(25),
          price     numeric )
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Load data by using SQL*Loader.</span><div>
                              <p>Load the book data from the operating system command line with SQL*Loader:</p><pre class="oac_no_warn" dir="ltr">% sqlldr userid=ctxdemo/ctxdemo control=loader.ctl
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Create the index set.</span><div>
                              <p>You can create the index set from SQL*Plus:</p><pre class="oac_no_warn" dir="ltr">sqlplus&gt;begin
          ctx_ddl.create_index_set('bookset');
          ctx_ddl.add_index('bookset','price');
          ctx_ddl.add_index('bookset','publisher');
        end;
/
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Create the <code class="codeph">CTXCAT</code> index.</span><div>
                              <p>You can create the <code class="codeph">CTXCAT</code> index from SQL*Plus as follows:
                              </p><pre class="oac_no_warn" dir="ltr">sqlplus&gt;create index book_idx on book_catalog (title) 
        indextype is ctxsys.ctxcat
        parameters('index set bookset');
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Try a simple search by using <code class="codeph">CATSEARCH.</code></span><div>
                              <p>You can test the newly created index in SQL*Plus as follows:</p><pre class="oac_no_warn" dir="ltr">sqlplus&gt;select id, title from book_catalog 
        where catsearch(title,'Java','price &gt; 10 order by price') &gt; 0
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Copy the <code class="codeph">catalogSearch.jsp</code> file to your JSP directory.</span><div>
                              <p>When you do so, you can access the application from a browser. The URL is <code class="codeph">http://</code><span class="italic">localhost</span><code class="codeph">:</code><span class="italic">port</span><code class="codeph">/</code><span class="italic">path</span><code class="codeph">/catalogSearch.jsp.</code></p>
                              <p>The application displays a query field in your browser and returns the query results as a list of HTML links. See <a href="CATSEARCH-query-application.html#GUID-0545BB84-B851-4CCE-8A6A-51857384E071__I634494">Figure B-1</a>.
                              </p>
                           </div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="figure" id="GUID-0545BB84-B851-4CCE-8A6A-51857384E071__I634494">
                           <p class="titleinfigure">Figure B-1 Screenshot of the Web Query Application</p><img src="img/qcatwiz1_newb.gif" width="503" alt="Description of Figure B-1 follows" title="Description of Figure B-1 follows" longdesc="img_text/qcatwiz1_newb.html"><br><a href="img_text/qcatwiz1_newb.html">Description of "Figure B-1 Screenshot of the Web Query Application"</a></div>
                        <!-- class="figure" -->
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="CCAPP9387"></a><div class="props_rev_3"><a id="GUID-C3986263-5739-43D4-B703-8805AE8CE142" name="GUID-C3986263-5739-43D4-B703-8805AE8CE142"></a><h4 id="CCAPP-GUID-C3986263-5739-43D4-B703-8805AE8CE142" class="sect4"><span class="enumeration_section">B.2.2 </span>JSP Web Application Sample Code
                  </h4>
                  <div>
                     <p>This section lists the code used to build the example web application. It includes the following files:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="CATSEARCH-query-application.html#GUID-C0558949-0BE3-45FD-BD72-223118825581">loader.ctl</a></p>
                        </li>
                        <li>
                           <p><a href="CATSEARCH-query-application.html#GUID-3F66BB43-5E4C-4F76-B6B2-B91BAA40609F">loader.dat</a></p>
                        </li>
                        <li>
                           <p><a href="CATSEARCH-query-application.html#GUID-A72F070D-4A17-40A4-89F3-857B1560B570">catalogSearch.jsp</a></p>
                           <div class="infoboxnotealso" id="GUID-C3986263-5739-43D4-B703-8805AE8CE142__GUID-5FC4697F-EB50-4CDB-A91C-6DFD52CC15F1">
                              <p class="notep1">See Also:</p>
                              <p><a href="http://www.oracle.com/technetwork/indexes/downloads/index.html" target="_blank"><code class="codeph">http://www.oracle.com/technetwork/indexes/downloads/index.html</code></a></p>
                           </div>
                        </li>
                     </ul>
                  </div><a id="CCAPP9388"></a><div class="props_rev_3"><a id="GUID-C0558949-0BE3-45FD-BD72-223118825581" name="GUID-C0558949-0BE3-45FD-BD72-223118825581"></a><h5 id="CCAPP-GUID-C0558949-0BE3-45FD-BD72-223118825581" class="sect5"><span class="enumeration_section">B.2.2.1 </span>loader.ctl
                     </h5>
                     <div>
                        <div class="section"><pre class="oac_no_warn" dir="ltr">      LOAD DATA
        INFILE 'loader.dat'
        INTO TABLE book_catalog 
        REPLACE 
        FIELDS TERMINATED BY ';'
        (id, title, publisher, price)
</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="CCAPP9389"></a><div class="props_rev_3"><a id="GUID-3F66BB43-5E4C-4F76-B6B2-B91BAA40609F" name="GUID-3F66BB43-5E4C-4F76-B6B2-B91BAA40609F"></a><h5 id="CCAPP-GUID-3F66BB43-5E4C-4F76-B6B2-B91BAA40609F" class="sect5"><span class="enumeration_section">B.2.2.2 </span>loader.dat
                     </h5>
                     <div>
                        <div class="section"><pre class="oac_no_warn" dir="ltr">1; A History of Goats; SPINDRIFT BOOKS; 50
2; Robust Recipes Inspired by Eating Too Much; SPINDRIFT BOOKS; 28
3; Atlas of Greenland History; SPINDRIFT BOOKS; 35
4; Bed and Breakfast Guide to Greenland; SPINDRIFT BOOKS; 37
5; Quitting Your Job and Running Away; SPINDRIFT BOOKS; 25
6; Best Noodle Shops of Omaha; SPINDRIFT BOOKS; 28
7; Complete Book of Toes; SPINDRIFT BOOKS; 16
8; Complete Idiot's Guide to Nuclear Technology; SPINDRIFT BOOKS; 28
9; Java Programming for Woodland Animals; BIG LITTLE BOOKS; 10
10; Emergency Surgery Tips and Tricks; SPOT-ON PUBLISHING; 10
11; Programming with Your Eyes Shut; KLONDIKE BOOKS; 10
12; English in Twelve Minutes; WRENCH BOOKS 11
13; Spanish in Twelve Minutes; WRENCH BOOKS 11
14; C++ Programming for Woodland Animals; CALAMITY BOOKS; 12
15; Oracle Internet Application Server, Enterprise Edition; KANT BOOKS; 12
16; Oracle Internet Developer Suite; SPAMMUS BOOK CO;13
17; Telling the Truth to Your Pets; IBEX BOOKS INC; 13
18; Go Ask Alice's Restaurant; HUMMING BOOKS;    13
19; Life Begins at 93;  CALAMITY BOOKS;   17
20; Python Programming for Snakes;  BALLAST BOOKS;  14
21; The Second-to-Last Mohican; KLONDIKE BOOKS;  14
22; Eye of Horus; An Oracle of Ancient Egypt; BIG LITTLE BOOKS;     15
23; Introduction to Sitting Down; IBEX BOOKS INC;  15
</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="CCAPP9390"></a><div class="props_rev_3"><a id="GUID-A72F070D-4A17-40A4-89F3-857B1560B570" name="GUID-A72F070D-4A17-40A4-89F3-857B1560B570"></a><h5 id="CCAPP-GUID-A72F070D-4A17-40A4-89F3-857B1560B570" class="sect5"><span class="enumeration_section">B.2.2.3 </span>catalogSearch.jsp
                     </h5>
                     <div>
                        <div class="section"><pre class="oac_no_warn" dir="ltr">&lt;%@ page import="java.sql.* , oracle.jsp.dbutil.*" %&gt;
&lt;jsp:useBean id="name" class="oracle.jsp.jml.JmlString" scope="request" &gt;
&lt;jsp:setProperty name="name" property="value" param="v_query" /&gt;
&lt;/jsp:useBean&gt;

&lt;%
  String connStr="jdbc:oracle:thin:@machine-domain-name:1521:betadev";

  java.util.Properties info = new java.util.Properties();

  Connection conn = null;
  ResultSet  rset = null;
  Statement  stmt = null;


       if (name.isEmpty() ) { 

%&gt;
           &lt;html&gt;
             &lt;title&gt;Catalog Search&lt;/title&gt;
             &lt;body&gt;
             &lt;center&gt;
               &lt;form method=post&gt;
               Search for book title:
               &lt;input type=text name="v_query" size=10&gt;
               where publisher is
               &lt;select name="v_publisher"&gt;
                  &lt;option value="ADDISON WESLEY"&gt;ADDISON WESLEY
                  &lt;option value="HUMMING BOOKS"&gt;HUMMING BOOKS
                  &lt;option value="WRENCH BOOKS"&gt;WRENCH BOOKS
                  &lt;option value="SPOT-ON PUBLISHING"&gt;SPOT-ON PUBLISHING
                  &lt;option value="SPINDRIFT BOOKS"&gt;SPINDRIFT BOOKS
                  &lt;option value="KLONDIKE BOOKS"&gt;KLONDIKE BOOKS
                  &lt;option value="CALAMITY BOOKS"&gt;CALAMITY BOOKS
                  &lt;option value="IBEX BOOKS INC"&gt;IBEX BOOKS INC
                  &lt;option value="BIG LITTLE BOOKS"&gt;BIG LITTLE BOOKS
               &lt;/select&gt;
               and price is 
               &lt;select name="v_op"&gt;
                 &lt;option value="="&gt;=
                 &lt;option value="&amp;lt;"&gt;&amp;lt;
                 &lt;option value="&amp;gt;"&gt;&amp;gt;
               &lt;/select&gt;
               &lt;input type=text name="v_price" size=2&gt;
               &lt;input type=submit value="Search"&gt;
               &lt;/form&gt;
             &lt;/center&gt;
             &lt;hr&gt;
             &lt;/body&gt;
           &lt;/html&gt;

&lt;%
      }
      else {

         String v_query = request.getParameter("v_query");
	 String v_publisher = request.getParameter("v_publisher");
         String v_price = request.getParameter("v_price");
         String v_op    = request.getParameter("v_op");
%&gt;

         &lt;html&gt;
           &lt;title&gt;Catalog Search&lt;/title&gt;
           &lt;body&gt;
           &lt;center&gt;
            &lt;form method=post action="catalogSearch.jsp"&gt;
            Search for book title:
            &lt;input type=text name="v_query" value= 
            &lt;%= v_query %&gt;
            size=10&gt;
            where publisher is
            &lt;select name="v_publisher"&gt;
                  &lt;option value="ADDISON WESLEY"&gt;ADDISON WESLEY
                  &lt;option value="HUMMING BOOKS"&gt;HUMMING BOOKS
                  &lt;option value="WRENCH BOOKS"&gt;WRENCH BOOKS
                  &lt;option value="SPOT-ON PUBLISHING"&gt;SPOT-ON PUBLISHING
                  &lt;option value="SPINDRIFT BOOKS"&gt;SPINDRIFT BOOKS
                  &lt;option value="KLONDIKE BOOKS"&gt;KLONDIKE BOOKS
                  &lt;option value="CALAMITY BOOKS"&gt;CALAMITY BOOKS
                  &lt;option value="IBEX BOOKS INC"&gt;IBEX BOOKS INC
                  &lt;option value="BIG LITTLE BOOKS"&gt;BIG LITTLE BOOKS
            &lt;/select&gt;
            and price is 
            &lt;select name="v_op"&gt;
               &lt;option value="="&gt;=
               &lt;option value="&amp;lt;"&gt;&amp;lt;
               &lt;option value="&amp;gt;"&gt;&amp;gt;
            &lt;/select&gt;
            &lt;input type=text name="v_price" value=
            &lt;%= v_price %&gt; size=2&gt;
            &lt;input type=submit value="Search"&gt;
            &lt;/form&gt;
            &lt;/center&gt;
          
&lt;%
     try {

       DriverManager.registerDriver(new oracle.jdbc.driver.OracleDriver() );
       info.put ("user", "ctxdemo");
       info.put ("password","ctxdemo");
       conn = DriverManager.getConnection(connStr,info);

         stmt = conn.createStatement();
         String theQuery = request.getParameter("v_query");
         String thePrice = request.getParameter("v_price");

 // select id,title 
 // from book_catalog 
 // where catsearch (title,'Java','price &gt;10 order by price') &gt; 0

 // select title 
 // from book_catalog 
 // where catsearch(title,'Java','publisher = ''CALAMITY BOOKS'' 
          and price &lt; 40 order by price' )&gt;0

         String myQuery = "select title, publisher, price from book_catalog
             where catsearch(title, '"+theQuery+"', 
             'publisher = ''"+v_publisher+"'' and price "+v_op+thePrice+" 
             order by price' ) &gt; 0";
         rset = stmt.executeQuery(myQuery);

         String color = "ffffff";

         String myTitle = null;
         String myPublisher = null;
         int myPrice = 0;
         int items = 0;

         while (rset.next()) {
            myTitle     = (String)rset.getString(1);
	    myPublisher = (String)rset.getString(2);
            myPrice     = (int)rset.getInt(3);
            items++;

            if (items == 1) {
%&gt;
               &lt;center&gt;
                  &lt;table border="0"&gt;
                     &lt;tr bgcolor="#6699CC"&gt;
                       &lt;th&gt;Title&lt;/th&gt;
		       &lt;th&gt;Publisher&lt;/th&gt;
		       &lt;th&gt;Price&lt;/th&gt;
                     &lt;/tr&gt;
&lt;%
            }
%&gt; 
            &lt;tr bgcolor="#&lt;%= color %&gt;"&gt;
             &lt;td&gt; &lt;%= myTitle %&gt;&lt;/td&gt;
             &lt;td&gt; &lt;%= myPublisher %&gt;&lt;/td&gt;
	     &lt;td&gt; $&lt;%= myPrice %&gt;&lt;/td&gt;
            &lt;/tr&gt;
&lt;%
            if (color.compareTo("ffffff") == 0)
               color = "eeeeee";
             else
               color = "ffffff";

      }
      
   } catch (SQLException e) {

%&gt;

      &lt;b&gt;Error: &lt;/b&gt; &lt;%= e %&gt;&lt;p&gt;

&lt;%

  } finally {
       if (conn != null) conn.close();
       if (stmt != null) stmt.close();
       if (rset != null) rset.close();
   }
   
%&gt;
    &lt;/table&gt;
    &lt;/center&gt;
   &lt;/body&gt;
   &lt;/html&gt;
&lt;%
 }
%&gt;
</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>