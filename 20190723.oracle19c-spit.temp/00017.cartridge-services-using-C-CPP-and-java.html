<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Cartridge Services Using C, C++ and Java</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Data Cartridge Developer's Guide">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Data Cartridge Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="data-cartridge-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-10T07:34:53-08:00">
      <meta name="dcterms.title" content="Data Cartridge Developer's Guide">
      <meta name="dcterms.dateCopyrighted" content="1996, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96431-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="reference.html" title="Previous" type="text/html">
      <link rel="next" href="extensibility-constants-types-and-mappings.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="ADDCI">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="reference.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="extensibility-constants-types-and-mappings.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Data Cartridge Developer's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="reference.html" property="item" typeof="WebPage"><span property="name">Reference</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Cartridge Services Using C, C++ and Java</li>
            </ol>
            <a id="GUID-43B4F11B-33E4-4722-93E0-9D8F809CC745" name="GUID-43B4F11B-33E4-4722-93E0-9D8F809CC745"></a><a id="ADDCI4180"></a>
            
            <h2 id="ADDCI-GUID-43B4F11B-33E4-4722-93E0-9D8F809CC745" class="sect2"><span class="enumeration_chapter">18 </span>Cartridge Services Using C, C++ and Java
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>Cartridge services are available to programmers using C/C++ and Java.</p>
               <div class="infoboxnotealso" id="GUID-43B4F11B-33E4-4722-93E0-9D8F809CC745__GUID-BCFF4297-A6C2-4729-9D2B-E464CDBB0AB0">
                  <p class="notep1">See Also:</p>
                  <p><a href="../lnoci/oci-cartridge-functions.html#LNOCI190" target="_blank"><span class="italic">Oracle Call Interface Programmer's Guide</span></a> for more details on cartridge services using C
                  </p>
               </div>
            </div><a id="ADDCI4934"></a><div class="props_rev_3"><a id="GUID-EBFF7A7F-2826-4353-8973-238FF1D9F8AA" name="GUID-EBFF7A7F-2826-4353-8973-238FF1D9F8AA"></a><h3 id="ADDCI-GUID-EBFF7A7F-2826-4353-8973-238FF1D9F8AA" class="sect3"><span class="enumeration_section">18.1 </span>OCI Access Functions for External Procedures
               </h3>
               <div>
                  <p><span class="bold"></span>When called from an external procedure, a service routine can raise exceptions, allocate memory, and get OCI handles for callbacks to the server. To use the functions, you must specify the <code class="codeph">WITH</code> <code class="codeph">CONTEXT</code> clause, which lets you pass a context structure to the external procedure. The context structure is declared in header file <code class="codeph">ociextp.h</code> as follows:
                  </p><pre class="oac_no_warn" dir="ltr">typedef struct OCIExtProcContext OCIExtProcContext;
</pre><p>Consider how service routines use context information. For more information and examples of usage, see<a href="../adfns/external-procedures.html#ADFNS1412" target="_blank"><span class="italic"> Oracle Database Advanced Application Developer's Guide.</span></a></p>
               </div><a id="ADDCI4935"></a><div class="props_rev_3"><a id="GUID-F8CAA8B2-2B18-45D0-9D97-5BF545FEBB7D" name="GUID-F8CAA8B2-2B18-45D0-9D97-5BF545FEBB7D"></a><h4 id="ADDCI-GUID-F8CAA8B2-2B18-45D0-9D97-5BF545FEBB7D" class="sect4"><span class="enumeration_section">18.1.1 </span>OCIExtProcAllocCallMemory
                  </h4>
                  <div>
                     <div class="section">
                        <p><span class="bold"></span>This service routine allocates <span class="italic">n</span> bytes of memory for the duration of the external procedure call. Any memory allocated by the function is freed as soon as control returns to PL/SQL. 
                        </p>
                        <p>Do not use any other function to allocate or free memory.</p>
                        <p>The C prototype for this function follows: </p><pre class="oac_no_warn" dir="ltr">void *OCIExtProcAllocCallMemory(
   OCIExtProcContext *with_context, 
   size_t amount);
</pre><p>The parameters <span class="italic">with_context</span> and <span class="italic">amount</span> are the context pointer and number of bytes to allocate, respectively. The function returns an untyped pointer to the allocated memory. A return value of zero indicates failure. 
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADDCI4936"></a><div class="props_rev_3"><a id="GUID-DEFD4DC2-46D7-42B3-BF6E-92483887D2DB" name="GUID-DEFD4DC2-46D7-42B3-BF6E-92483887D2DB"></a><h4 id="ADDCI-GUID-DEFD4DC2-46D7-42B3-BF6E-92483887D2DB" class="sect4"><span class="enumeration_section">18.1.2 </span>OCIExtProcRaiseExcp
                  </h4>
                  <div>
                     <div class="section">
                        <p><a id="d58689e282" class="indexterm-anchor"></a><a id="d58689e284" class="indexterm-anchor"></a>This service routine raises a predefined exception, which must have a valid Oracle error number in the range <code class="codeph">1</code> to <code class="codeph">32767</code>. After doing any necessary cleanup, the external procedure must return immediately. (No values are assigned to <code class="codeph">OUT</code> or <code class="codeph">IN</code> <code class="codeph">OUT</code> parameters.) The C prototype for this function follows: 
                        </p><pre class="oac_no_warn" dir="ltr">int OCIExtProcRaiseExcp(
   OCIExtProcContext *with_context, 
   size_t error_number);
</pre><p>The parameters <span class="italic">with_context</span> and <span class="italic">error_number </span>are the context pointer and Oracle error number. The return values <code class="codeph">OCIEXTPROC_SUCCESS</code> and <code class="codeph">OCIEXTPROC_ERROR</code> indicate success or failure. 
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADDCI4937"></a><div class="props_rev_3"><a id="GUID-D9917140-D034-4F5F-99B2-556DB03AC837" name="GUID-D9917140-D034-4F5F-99B2-556DB03AC837"></a><h4 id="ADDCI-GUID-D9917140-D034-4F5F-99B2-556DB03AC837" class="sect4"><span class="enumeration_section">18.1.3 </span>OCIExtProcRaiseExcpWithMsg
                  </h4>
                  <div>
                     <div class="section">
                        <p><a id="d58689e377" class="indexterm-anchor"></a><a id="d58689e379" class="indexterm-anchor"></a>This service routine raises a user-defined exception and returns a user-defined error message. The C prototype for this function follows: 
                        </p><pre class="oac_no_warn" dir="ltr">int OCIExtProcRaiseExcpWithMsg(
   OCIExtProcContext *with_context, 
   size_t error_number,
   text   *error_message, 
   size_t  len);
</pre><p>The parameters <code class="codeph">with_context</code>, <code class="codeph">error_number</code>, and <code class="codeph">error_message</code> are the context pointer, Oracle error number, and error message text. The parameter <span class="italic">len</span> stores the length of the error message. If the message is a null-terminated string, <span class="italic">len</span> is zero. The return values <code class="codeph">OCIEXTPROC_SUCCESS</code> and <code class="codeph">OCIEXTPROC_ERROR</code> indicate success or failure. 
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADDCI4938"></a><div class="props_rev_3"><a id="GUID-5C3DBB35-F468-4FDE-B482-8616E5966EB9" name="GUID-5C3DBB35-F468-4FDE-B482-8616E5966EB9"></a><h4 id="ADDCI-GUID-5C3DBB35-F468-4FDE-B482-8616E5966EB9" class="sect4"><span class="enumeration_section">18.1.4 </span>OCIExtProcGetEnv
                  </h4>
                  <div>
                     <div class="section">
                        <p>This service routine enables OCI callbacks to the database during an external procedure call. Use the OCI handles obtained by this function only for callbacks. If you use them for standard OCI calls, the handles establish a new connection to the database and cannot be used for callbacks in the same transaction. In other words, during an external procedure call, you can use OCI handles for callbacks or a new connection but not for both. </p>
                        <p>The C prototype for this function follows: </p><pre class="oac_no_warn" dir="ltr">sword OCIExtProcGetEnv(
   OCIExtProcContext *with_context, 
   OCIEnv    **envh, 
   OCISvcCtx **svch, 
   OCIError  **errh);
</pre><p>The parameter <span class="italic">with_context</span> is the context pointer, and the parameters <span class="italic">envh</span>, <span class="italic">svch</span>, and <span class="italic">errh</span> are the OCI environment, service, and error handles, respectively. The return values <code class="codeph">OCIEXTPROC_SUCCESS</code> and <code class="codeph">OCIEXTPROC_ERROR</code> indicate success or failure. 
                        </p>
                        <p><span class="q">"<a href="implementing-data-cartridges-in-C-CPP-and-java.html#GUID-FE168081-19E5-4991-87C2-40E68995850D">Using Callbacks</a>"</span>  shows how <code class="codeph">OCIExtProcGetEnv</code> might be used in callbacks. For a working example, see the script extproc.sql in the PL/SQL demo directory.<a id="d58689e500" class="indexterm-anchor"></a><a id="d58689e504" class="indexterm-anchor"></a> (For the location of this directory, see your Oracle installation or user's guide.) This script demonstrates the calling of an external procedure. The companion file extproc.c contains the C source code for the external procedure. To run the demo, follow the instructions in <code class="codeph">extproc</code>.<code class="codeph">sql</code>. You must use an account that has <code class="codeph">CREATE</code> <code class="codeph">LIBRARY</code> privileges.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="ADDCI4940"></a><a id="ADDCI4939"></a><div class="props_rev_3"><a id="GUID-450FE138-7826-4ADD-AD4C-B9056FDA8A9A" name="GUID-450FE138-7826-4ADD-AD4C-B9056FDA8A9A"></a><h3 id="ADDCI-GUID-450FE138-7826-4ADD-AD4C-B9056FDA8A9A" class="sect3"><span class="enumeration_section">18.2 </span>Installing Java Cartridge Services Files
               </h3>
               <div>
                  <div class="section">
                     <p>The <code class="codeph">ODCI.jar</code> and <code class="codeph">CartridgeServices.jar</code> files must be installed into the <code class="codeph">SYS</code> schema to use the Java classes described here. 
                     </p>
                     <p>If you installed the Java option, then you must install the <code class="codeph">ODCI.jar</code> and <code class="codeph">CartridgeServices.jar</code> files. You do not have to perform this task if you did not install the Java option.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-450FE138-7826-4ADD-AD4C-B9056FDA8A9A__GUID-76347366-B714-486D-9F11-184D257F1C36">To install ODCI.jar and CartridgeServices.jar files </p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>Activate the SQL*Plus prompt.</span><div><pre class="oac_no_warn" dir="ltr">C:\sqlplus
</pre></div>
                     </li>
                     <li class="stepexpand"><span>When prompted, login using the <code class="codeph">system</code> account.</span><div><pre class="oac_no_warn" dir="ltr">Enter user-name: system
Enter password: <span class="italic">password</span>
</pre></div>
                     </li>
                     <li class="stepexpand"><span>Use the server-side loadjava command to install the classes and create the synonyms in the <code class="codeph">SYSTEM</code> schema.</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; call dbms_java.loadjava('-resolve -synonym -grant public 
     -verbose vobs/jilip/Cartridge Services.jar');
SQL&gt; call dbms_java.loadjava('-resolve -synonym -grant public
     -verbose vobs/jlib/ODCI.jar');
</pre></div>
                     </li>
                  </ol>
                  <div class="section">
                     <p> See <a href="../upgrd/intro-to-upgrading-oracle-database.html#UPGRD001" target="_blank"><span class="italic">Oracle Database Upgrade Guide</span></a> for further details on installing the <code class="codeph">jar</code> files.
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="ADDCI4941"></a><div class="props_rev_3"><a id="GUID-CF359033-3ED3-4601-8070-5DB01287D38B" name="GUID-CF359033-3ED3-4601-8070-5DB01287D38B"></a><h3 id="ADDCI-GUID-CF359033-3ED3-4601-8070-5DB01287D38B" class="sect3"><span class="enumeration_section">18.3 </span>Cartridge Services-Maintaining Context
               </h3>
               <div>
                  <p>The Java cartridge service is used for maintaining context. It is similar to the OCI context management service. This class is necessary when switching context between the server and the cartridge code. </p>
               </div><a id="ADDCI4943"></a><a id="ADDCI4944"></a><a id="ADDCI4945"></a><a id="ADDCI4946"></a><a id="ADDCI4942"></a><div class="props_rev_3"><a id="GUID-A2345CF6-8A32-48DE-A248-F913111ECADD" name="GUID-A2345CF6-8A32-48DE-A248-F913111ECADD"></a><h4 id="ADDCI-GUID-A2345CF6-8A32-48DE-A248-F913111ECADD" class="sect4"><span class="enumeration_section">18.3.1 </span>ContextManager 
                  </h4>
                  <div>
                     <div class="section">
                        <p>ContextManager is a Constructor in class Oracle that extends Object. </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-A2345CF6-8A32-48DE-A248-F913111ECADD__GUID-80D80BFF-37F4-4CD2-A05C-1634CDAF4A92"><span class="bold">Class Interface</span></p>
                     </div>
                     <!-- class="section" -->
                     <div class="section"><pre class="oac_no_warn" dir="ltr">public static Hashtable ctx extends Object</pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-A2345CF6-8A32-48DE-A248-F913111ECADD__GUID-D2224CC3-1F98-4165-BF46-7C0F3A796F90"><span class="bold">Variable</span></p>
                     </div>
                     <!-- class="section" -->
                     <div class="section"><pre class="oac_no_warn" dir="ltr">ctx public static Hashtable ctx</pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-A2345CF6-8A32-48DE-A248-F913111ECADD__GUID-56FA58D6-5478-4862-9B4D-1A90EB9D6948"><span class="bold">Constructors</span></p>
                     </div>
                     <!-- class="section" -->
                     <div class="section"><pre class="oac_no_warn" dir="ltr">ContextManager public ContextManager()</pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-A2345CF6-8A32-48DE-A248-F913111ECADD__GUID-E44D62F7-EC8B-4333-B415-97E99670160E"><span class="bold">Methods</span></p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>The following methods are available:</p><pre class="oac_no_warn" dir="ltr">setContext (static method in class oracle)
getContext (static method in class oracle)
clearContext (static method in class oracle)</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADDCI4947"></a><div class="props_rev_3"><a id="GUID-33645707-174E-47E4-AD6D-7D18572DC731" name="GUID-33645707-174E-47E4-AD6D-7D18572DC731"></a><h4 id="ADDCI-GUID-33645707-174E-47E4-AD6D-7D18572DC731" class="sect4"><span class="enumeration_section">18.3.2 </span>CountException()
                  </h4>
                  <div>
                     <div class="section">
                        <p>Constructor that extends <code class="codeph">Exception</code>.
                        </p><pre class="oac_no_warn" dir="ltr">Class oracle.CartridgeServices.CountException</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADDCI4948"></a><div class="props_rev_3"><a id="GUID-71AAF380-990D-4739-AF32-ABF668F7575D" name="GUID-71AAF380-990D-4739-AF32-ABF668F7575D"></a><h4 id="ADDCI-GUID-71AAF380-990D-4739-AF32-ABF668F7575D" class="sect4"><span class="enumeration_section">18.3.3 </span>CountException(String)
                  </h4>
                  <div>
                     <div class="section">
                        <p> Constructor that extends <code class="codeph">Exception</code>.
                        </p><pre class="oac_no_warn" dir="ltr">public CountException(String s)</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADDCI4949"></a><div class="props_rev_3"><a id="GUID-7DF37B3F-7E33-4473-BA2C-FD7B11C68084" name="GUID-7DF37B3F-7E33-4473-BA2C-FD7B11C68084"></a><h4 id="ADDCI-GUID-7DF37B3F-7E33-4473-BA2C-FD7B11C68084" class="sect4"><span class="enumeration_section">18.3.4 </span>InvalidKeyException()
                  </h4>
                  <div>
                     <div class="section">
                        <p>Constructor that extends <code class="codeph">Exception</code>.
                        </p><pre class="oac_no_warn" dir="ltr">public InvalidKeyException(String s)</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADDCI4950"></a><div class="props_rev_3"><a id="GUID-214828EF-461E-48C6-ABAA-3B3096D6B62F" name="GUID-214828EF-461E-48C6-ABAA-3B3096D6B62F"></a><h4 id="ADDCI-GUID-214828EF-461E-48C6-ABAA-3B3096D6B62F" class="sect4"><span class="enumeration_section">18.3.5 </span>InvalidKeyException(String)
                  </h4>
                  <div>
                     <div class="section">
                        <p>Constructor that extends <code class="codeph">Exception</code>.
                        </p><pre class="oac_no_warn" dir="ltr">public InvalidKeyException(String s)</pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>