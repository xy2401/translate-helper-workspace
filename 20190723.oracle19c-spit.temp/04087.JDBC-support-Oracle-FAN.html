<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Oracle JDBC Support for FAN Events</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="JDBC Developer's Guide">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="JDBC Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="jdbc-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-02-13T13:20:37-08:00">
      <meta name="dcterms.title" content="JDBC Developer's Guide">
      <meta name="dcterms.dateCopyrighted" content="1999, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96471-02">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="application-continuity.html" title="Previous" type="text/html">
      <link rel="next" href="transparent-application-failover.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="JJDBC">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="application-continuity.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="transparent-application-failover.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">JDBC Developer's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="high-availablility.html" property="item" typeof="WebPage"><span property="name"> High Availability</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Oracle JDBC Support for FAN Events</li>
            </ol>
            <a id="GUID-54252C2F-FFEE-4B9D-844B-0AAA3492D57C" name="GUID-54252C2F-FFEE-4B9D-844B-0AAA3492D57C"></a>
            
            <h2 id="JJDBC-GUID-54252C2F-FFEE-4B9D-844B-0AAA3492D57C" class="sect2"><span class="enumeration_chapter">30 </span>Oracle JDBC Support for FAN Events
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>Starting from Oracle Database 12<span class="italic">c</span> Release 2 (12.2.0.1), Oracle JDBC driver supports Oracle RAC Fast Application Notification (FAN) events, for planned and unplanned outages. This facilitates third-party connection pools to leverage Oracle RAC features for high availability. Java applications not using Oracle Universal Connection Pool (UCP) or WebLogic Server can now leverage on this support. For example, scenarios like rolling upgrades at the Oracle RAC server-side do not cause JDBC errors within applications.
               </p>
               <div class="infoboxnote" id="GUID-54252C2F-FFEE-4B9D-844B-0AAA3492D57C__GUID-43C44712-8C36-46F5-9782-62C13414D312">
                  <p class="notep1">Note:</p>
                  <p>Although the Oracle JDBC drivers now support the FAN events, Oracle UCP provides more comprehensive support for all FAN events.</p>
               </div>
               <div class="infoboxnotealso" id="GUID-54252C2F-FFEE-4B9D-844B-0AAA3492D57C__GUID-54013444-A9D6-4402-8D58-D843C78AB726">
                  <p class="notep1">See Also:</p>
                  <p><a href="../jjucp/fast-connection-failover.html#JJUCP-GUID-126F8C9B-C0B3-426B-B07D-4B127BBDD867" target="_blank"><span><cite>Oracle Universal Connection Pool Developerâ€™s Guide</cite></span></a></p>
               </div>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="JDBC-support-Oracle-FAN.html#GUID-FA7C92EE-6AA3-4F32-B60D-4558A6F27020">Overview of Oracle JDBC Support for FAN events</a></p>
                  </li>
                  <li>
                     <p><a href="JDBC-support-Oracle-FAN.html#GUID-5C6B8DF7-8542-4533-9D68-0D2E6D1ACDA9">Safe Draining APIs for Planned Maintenance</a></p>
                  </li>
                  <li>
                     <p><a href="JDBC-support-Oracle-FAN.html#GUID-069265AF-BBEE-4682-9906-98D8429BFC1C">Installation and Configuration of Oracle JDBC Driver for FAN Events Support</a></p>
                  </li>
               </ul>
            </div>
            <div class="sect2"><a id="GUID-FA7C92EE-6AA3-4F32-B60D-4558A6F27020" name="GUID-FA7C92EE-6AA3-4F32-B60D-4558A6F27020"></a><h3 id="JJDBC-GUID-FA7C92EE-6AA3-4F32-B60D-4558A6F27020" class="sect3"><span class="enumeration_section">30.1 </span>Overview of Oracle JDBC Support for FAN events
               </h3>
               <div>
                  <p></p>
                  <p>You must use an Oracle RAC Database or an Oracle Restart on a single instance database to use this feature. This feature supports:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Planned maintenance</p>
                        <p>This case deals with planned maintenance on Oracle RAC servers, where an Oracle RAC service can be gracefully shutdown. In this case, borrowed or in-use connections from a connection pool are not interrupted, and are closed only until any safe-draining API is invoked. For example, when an application completes work on such a connection and returns it to the connection pool.</p>
                     </li>
                     <li>
                        <p>Unplanned outages</p>
                        <p>In this case, dead connections are rapidly detected and aborted, which severs network connections to prevent hangs. In this case, borrowed and in-use connections are interrupted during unplanned outages. Applications are expected to handle any exception on affected connections and perform necessary recovery, either on their own, or using Oracle high-availability solutions such as Application Continuity.</p>
                     </li>
                  </ul>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="application-continuity.html#GUID-AAC6F9B7-9B4C-4098-B0D5-312BF9A13928">Application Continuity for Java</a></li>
                        <li><a href="JDBC-support-Oracle-FAN.html#GUID-5C6B8DF7-8542-4533-9D68-0D2E6D1ACDA9">Safe Draining APIs for Planned Maintenance</a></li>
                     </ul>
                  </div>
                  <div class="infoboxnotealso" id="GUID-FA7C92EE-6AA3-4F32-B60D-4558A6F27020__GUID-9CBF9B59-7C66-42FE-AAAC-BE765755E456">
                     <p class="notep1">See Also:</p>
                     <p><a href="../racad/converting-single-instance-oracle-databases-to-oracle-rac-and-oracle-rac-one-node.html#RACAD-GUID-CDCBB95C-59EA-4CA7-BDB6-11B3D114E397" target="_blank"><span><cite>Oracle Real Application Clusters Administration and Deployment Guide</cite></span></a>for server-side configuration about using Oracle RAC. This chapter describes only the client-side configuration steps that an application must perform when using Oracle JDBC driver support for FAN events.
                     </p>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-5C6B8DF7-8542-4533-9D68-0D2E6D1ACDA9" name="GUID-5C6B8DF7-8542-4533-9D68-0D2E6D1ACDA9"></a><h3 id="JJDBC-GUID-5C6B8DF7-8542-4533-9D68-0D2E6D1ACDA9" class="sect3"><span class="enumeration_section">30.2 </span>Safe Draining APIs for Planned Maintenance
               </h3>
               <div>
                  <p></p>
                  <div class="section">
                     <p>For planned Oracle RAC maintenance, the JDBC driver supports a list of safe-draining APIs, which  are required for additional handshake or integration work with a third-party Java connection pool. These APIs serve as the <span class="italic">draining-points</span>, where the driver can safely close any connection affected by a planned maintenance, without causing application-visible errors. Following is the list of safe-draining APIs that driver FAN supports:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><code class="codeph">java.sql.Connection.isValid(int timeout)</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">oracle.jdbc.OracleConnection.pingDatabase()</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">oracle.jdbc.OracleConnection.pingDatabase(int timeout)</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">oracle.jdbc.OracleConnection.endRequest()</code></p>
                        </li>
                        <li>
                           <p>All standard JDBC and Oracle JDBC extension <code class="codeph">EXECUTE***</code> calls on <code class="codeph">Statement</code>, <code class="codeph">PreparedStatement</code>, and <code class="codeph">CallableStatement</code> interfaces
                           </p>
                        </li>
                     </ul>
                     <p>For the standard JDBC and Oracle JDBC extension <code class="codeph">EXECUTE***</code> calls, the executed SQL command string must contain the following SQL hint as the first noncomment token within the SQL string:
                     </p><pre class="pre codeblock"><code>/*+ CLIENT_CONNECTION_VALIDATION */</code></pre><p>Qualified SQLs are treated as connection-validation SQLs. For example:</p><pre class="pre codeblock"><code>/*+ CLIENT_CONNECTION_VALIDATION */ SELECT 1 FROM DUAL</code></pre><p>Typically, a third-party connection pool places calls to these APIs. It is expected that on detection of any bad connection with such invocations, a third-party connection pool closes and removes the related connection from the pool, so that no errors are visible to applications. When the application itself calls these APIs, then it is expected that application is actively validating the underlying connection and will close and remove any bad connection detected.</p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-069265AF-BBEE-4682-9906-98D8429BFC1C" name="GUID-069265AF-BBEE-4682-9906-98D8429BFC1C"></a><h3 id="JJDBC-GUID-069265AF-BBEE-4682-9906-98D8429BFC1C" class="sect3"><span class="enumeration_section">30.3 </span>Installation and Configuration of Oracle JDBC Driver for FAN Events Support
               </h3>
               <div>
                  <p></p>
                  <div class="section">
                     <p>Oracle JDBC driver automatically determines whether to enable Oracle JDBC support for FAN events, by checking the database server that it connects to, and whether the following necessary JAR files are available in the application environment, in addition to the Oracle JDBC driver or not:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The <code class="codeph">simplefan.jar</code> and <code class="codeph">ons.jar</code> files
                           </p>
                           <p>You must install the 12.2.0.1 version of the <code class="codeph">simplefan.jar</code> and <code class="codeph">ons.jar</code> files from the following link and include them in the <code class="codeph">CLASSPATH</code>.
                           </p>
                           <p><a href="http://www.oracle.com/technetwork/database/application-development/jdbc/jdbc-ucp-122-3110062.html" target="_blank">http://www.oracle.com/technetwork/database/application-development/jdbc/jdbc-ucp-122-3110062.html</a></p>
                           <p>If either one is missing, or the driver is unable to load it, then this feature is disabled. When used with a third-party connection pool, these JAR files must be placed in the same location, where the connection pool retrieves and loads the driver JAR files.</p>
                        </li>
                        <li>
                           <p>Oracle JDBC data sources</p>
                           <p>You can use the same typical Oracle JDBC data sources, such as <code class="codeph">oracle.jdbc.pool.OracleDataSource</code> or <code class="codeph">oracle.jdbc.OracleDriver</code> for obtaining JDBC connections. When used together with a third-party connection pool, your application must specify these classes as connection factories for the connection pool.
                           </p>
                        </li>
                     </ul>
                     <p>Applications that want to explicitly disable this feature, can set the <code class="codeph">oracle.jdbc.fanEnabled</code> property to <code class="codeph">FALSE</code>. This property is available as both a system property and a connection property. For applications using Universal Connection Pool (UCP) or WebLogic Server Active GridLink (AGL), this property is set to <code class="codeph">FALSE</code> by default. Otherwise, the default value is <code class="codeph">TRUE</code>.
                     </p>
                     <div class="infoboxnote" id="GUID-069265AF-BBEE-4682-9906-98D8429BFC1C__GUID-D4AD0BBD-F2BE-48EB-A8DC-9932FD0B3615">
                        <p class="notep1">Note:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>When the JDBC driver automatically enables support for FAN events, with both the <code class="codeph">simplefan.jar</code> and the <code class="codeph">ons.jar</code> files present on the <code class="codeph">CLASSPATH</code>, then calling the <code class="codeph">getConnection</code> method may throw an exception, such as, <code class="codeph">java.lang.IllegalArgumentException</code>. To avoid this, you can perform either of the following:
                              </p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>Remove either <code class="codeph">simplefan.jar</code> or <code class="codeph">ons.jar</code> from the <code class="codeph">CLASSPATH</code>.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Set the <code class="codeph">oracle.jdbc.fanEnabled</code> property to <code class="codeph">FALSE</code> to disable this feature explicitly.
                                    </p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>Setting the <code class="codeph">oracle.jdbc.fanEnabled</code> property to <code class="codeph">TRUE</code> may not enable Oracle JDBC Support for FAN Events feature as the feature depends on other factors too.
                              </p>
                           </li>
                        </ul>
                     </div>
                     <p>The JDBC driver requires minimal configuration changes or code changes to a third-party connection pool for supporting Oracle FAN events. For a connection pool that does not need any configuration change or code change, it is assumed that it fulfils one of the following criteria:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The pool has a configuration option for validating JDBC connections at pool checkout time.</p>
                        </li>
                        <li>
                           <p>The pool uses <code class="codeph">javax.sql.PooledConnection</code> and has a configuration option for plugging in a <code class="codeph">javax.sql.ConnectionPoolDataSource</code> implementation. Such a connection pool is also assumed to be able to check for closed or bad physical connections at connection returns.
                           </p>
                        </li>
                     </ul>
                     <p>Following are a few connection validation options on some third-party Java connection pools. The majority of these options are based on SQL, and not on validation APIs:</p>
                     <div class="tblformal" id="GUID-069265AF-BBEE-4682-9906-98D8429BFC1C__GUID-B9E1FD8E-FF16-4269-B1F7-D32BF7E77AEA">
                        <table cellpadding="4" cellspacing="0" class="Formal" title="" summary="Example of connection validation options on other Java connection pools" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" id="d78717e340">Java Connection Pool</th>
                                 <th align="left" valign="bottom" id="d78717e343">Connection Validation Options</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d78717e348" headers="d78717e340 ">
                                    <p>Oracle WebLogic Generic and MDS data sources</p>
                                 </td>
                                 <td align="left" valign="top" headers="d78717e348 d78717e343 ">
                                    <p><code class="codeph">TestConnectionsOnReserve</code>, <code class="codeph">TestConnectionsOnRelease</code>, <code class="codeph">TestConnectionsOnCreate</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d78717e362" headers="d78717e340 ">
                                    <p>IBM WebSphere</p>
                                 </td>
                                 <td align="left" valign="top" headers="d78717e362 d78717e343 ">
                                    <p><code class="codeph">PreTest</code> Connection
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d78717e371" headers="d78717e340 ">
                                    <p>RedHat JBoss</p>
                                 </td>
                                 <td align="left" valign="top" headers="d78717e371 d78717e343 ">
                                    <p><code class="codeph">check-valid-connection-sql</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d78717e379" headers="d78717e340 ">
                                    <p>Apache TomCat</p>
                                 </td>
                                 <td align="left" valign="top" headers="d78717e379 d78717e343 ">
                                    <p><code class="codeph">TestonBorrow</code>, <code class="codeph">TestonRelease</code></p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>When you use Oracle JDBC support for FAN events feature with an Oracle RAC server Release 11<span class="italic">g</span>, then applications must explicitly set the remote ONS configuration string for Oracle RAC FAN through the <code class="codeph">oracle.jdbc.fanONSConfig</code> system property. The value and the format of the property are the same as for UCP Fast Connection Failover (FCF).
                     </p>
                     <div class="infoboxnotealso" id="GUID-069265AF-BBEE-4682-9906-98D8429BFC1C__GUID-132E6303-7A34-4648-8B9D-D010AFD1395B">
                        <p class="notep1">See Also:</p>
                        <p><a href="../jjucp/fast-connection-failover.html#JJUCP-GUID-C8D5FF91-6333-4E7F-BC81-CF7B93D56BEE" target="_blank">Universal Connection Pool Developerâ€™s Guide</a></p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-EA53B96C-5A3E-43DE-A427-D7517AB749E0" name="GUID-EA53B96C-5A3E-43DE-A427-D7517AB749E0"></a><h3 id="JJDBC-GUID-EA53B96C-5A3E-43DE-A427-D7517AB749E0" class="sect3"><span class="enumeration_section">30.4 </span>Example of Oracle JDBC Driver FAN support for Planned Maintenance
               </h3>
               <div>
                  <p></p>
                  <div class="section">
                     <p>The following example illustrates how you can typically enable and use JDBC Oracle FAN support with planned maintenance on Oracle RAC. Applications should not receive any exception during a planned maintenance after following these instructions:</p>
                     <ol>
                        <li>
                           <p>Upgrade Oracle JDBC driver to Release 12.2.0.1 to use the <code class="codeph">ojdbc8.jar</code> file.
                           </p>
                        </li>
                        <li>
                           <p>Install and use the 12.2.0.1 version of the <code class="codeph">ons.jar</code> and <code class="codeph">simplefan.jar</code> files.
                           </p>
                        </li>
                        <li>
                           <p>Use the <code class="codeph">oracle.jdbc.pool.OracleDataSource</code> class to obtain physical connections or configure this class as the connection factory on a third-party Java connection pool. In the latter case, you must set the specific pool property that enables connection validation.
                           </p>
                           <p>Optionally, when running against Oracle RAC Release 11<span class="italic">g</span>, specify the system property <code class="codeph">oracle.jdbc.fanONSConfig</code> to configure remote ONS.
                           </p>
                        </li>
                        <li>
                           <p>The application runs until you are ready to perform planned maintenance activities like a rolling upgrade on the Oracle RAC. During the planned maintenance, for each service based on usage patterns, a DBA will perform the following activities using the extended 12.2 <code class="codeph">srvctl</code> interface:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Relocate or stop the services on the next instance to upgrade, with no <code class="codeph">&#x2013;f</code> (force)
                                 </p>
                              </li>
                              <li>
                                 <p>Wait until all connections to this service are drained by driver FAN</p>
                              </li>
                              <li>
                                 <p>When the timeout is reached, disconnect the sessions with the defined stop mode (transactional is recommended)</p>
                              </li>
                              <li>
                                 <p>When all services are relocated or stopped, shutdown the instance and apply the upgrade or patch</p>
                              </li>
                              <li>
                                 <p>Restart the instance and restart the services if they were stopped</p>
                              </li>
                              <li>
                                 <p>Iterate until all instances are upgraded/patched</p>
                              </li>
                           </ul>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>