<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Real Application Security HR Demo Files</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Real Application Security Administrator's and Developer's Guide ">
      <meta property="og:description" content>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Real Application Security Administrator's and Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="real-application-security-administrators-and-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-11T05:21:48-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2012, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E95725-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="configuring-oci-and-jdbc-applications-for-column-authorization.html" title="Previous" type="text/html">
      <link rel="next" href="troubleshooting_real_application_security.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Real Application Security Administrator's and Developer's Guide">
    <meta name="dcterms.isVersionOf" content="DBFSG">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="configuring-oci-and-jdbc-applications-for-column-authorization.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="troubleshooting_real_application_security.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Real Application Security Administrator's and Developer's Guide </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Real Application Security HR Demo Files</li>
            </ol>
            <a id="GUID-9289D66D-6426-4CE5-9E5E-941A360B0E9C" name="GUID-9289D66D-6426-4CE5-9E5E-941A360B0E9C"></a><a id="DBFSG819"></a>
            
            <h2 id="DBFSG-GUID-9289D66D-6426-4CE5-9E5E-941A360B0E9C" class="sect2"><span class="enumeration_appendix">C </span>Real Application Security HR Demo Files
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>This appendix contains both the source files and log files. A detailed description of the HR Demo can be found in <a href="real-application-security-hr-demo.html#GUID-F38C8CA7-05B0-4939-AF59-741D8EF7FB87" title="Describes how to use RASADM to create Real Application Security data security policies using a graphical user interface.Describes how to run the RASADM application.In the design phase, you identify all the tasks an application performs that require application privileges to control data access.To develop data security policies using RASADM, you must follow some basic steps.Describes how to use RASADM to create the HR Demo application.Describes how to create application roles and specifically the database DB_EMP role.Describes how to create application roles using RASADM.Describes creating application users and granting them roles.Describes creating application users using RASADM.Describes the process flow for creating the data security policy.Describes entering data security policy information using the RASADM application.Describes creating the column authorization part of the data security policy.Describes the creating the data realm authorizations part of the data security policy.Describes applying the data security policy.">Real Application Security HR Demo</a>.
               </p>
               <div class="p">This appendix describes the following topics:
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="real-application-security-hr-demo-files.html#GUID-8DB26655-69C4-41C0-8C55-66415125BDB0">How to Run the Security HR Demo</a></p>
                     </li>
                     <li>
                        <p><a href="real-application-security-hr-demo-files.html#GUID-5953585D-D2F7-47E5-B27E-A81DCEC2CA52">Scripts for the Security HR Demo</a></p>
                     </li>
                     <li>
                        <p><a href="real-application-security-hr-demo-files.html#GUID-95FB6E3E-1119-47A6-9E82-C17AC5CC6850">Generated Log Files for Each Script</a></p>
                     </li>
                  </ul>
               </div>
            </div><a id="DBFSG820"></a><div class="props_rev_3"><a id="GUID-8DB26655-69C4-41C0-8C55-66415125BDB0" name="GUID-8DB26655-69C4-41C0-8C55-66415125BDB0"></a><h3 id="DBFSG-GUID-8DB26655-69C4-41C0-8C55-66415125BDB0" class="sect3">How to Run the Security HR Demo</h3>
               <div>
                  <div class="section">
                     <p>To run the Security HR demo, run the following scripts in the order shown:</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li><span>Run the setup script <code class="codeph">hrdemo_setup.sql</code>, which creates the log file: <code class="codeph">hrdemo_setup.log</code>.</span></li>
                     <li><span>Run the demo script <code class="codeph">hrdemo.sql</code> with direct logon, which creates the log file: <code class="codeph">hrdemo.log</code>.</span></li>
                     <li><span>Run the demo script to explicitly create and attach to the Real Application Security session <code class="codeph">hrdemo_session.sql</code>, which creates the log file: <code class="codeph">hrdemo_session.log</code>.</span></li>
                     <li><span>Run the Java demo <code class="codeph">hrdemo.java</code> file, which creates the log file: <code class="codeph">hrdemo.log</code>.</span></li>
                     <li><span>Run the clean up script <code class="codeph">hrdemo_clean.sql</code>, which creates the log file: <code class="codeph">hrdemo_clean.log</code>.</span></li>
                  </ol>
               </div>
            </div><a id="DBFSG822"></a><a id="DBFSG821"></a><div class="props_rev_3"><a id="GUID-5953585D-D2F7-47E5-B27E-A81DCEC2CA52" name="GUID-5953585D-D2F7-47E5-B27E-A81DCEC2CA52"></a><h3 id="DBFSG-GUID-5953585D-D2F7-47E5-B27E-A81DCEC2CA52" class="sect3">Scripts for the Security HR Demo</h3>
               <div>
                  <div class="section">
                     <p><a href="real-application-security-hr-demo-files.html#GUID-5953585D-D2F7-47E5-B27E-A81DCEC2CA52__CEGGEEAB" title="This table lists the source files and the generated log files for the HR demo scripts. This table has 2 columns. Column 1 is the script name and column 2 is the name of the log file that is generated when the script is run.">Table C-1</a> lists the scripts and generated log files with links to the content of each file.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="tblformal" id="GUID-5953585D-D2F7-47E5-B27E-A81DCEC2CA52__CEGGEEAB">
                     <p class="titleintable">Table C-1  HR Demo Scripts and Log Files</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title=" HR Demo Scripts and Log Files" summary="This table lists the source files and the generated log files for the HR demo scripts. This table has 2 columns. Column 1 is the script name and column 2 is the name of the log file that is generated when the script is run." width="100%" frame="hsides" border="1" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="31%" id="d134082e424">Scripts</th>
                              <th align="left" valign="bottom" width="69%" id="d134082e427">Log Files</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="31%" id="d134082e432" headers="d134082e424 ">
                                 <p><a href="real-application-security-hr-demo-files.html#GUID-E7974492-8418-4DAD-8497-530F3A669064">hrdemo_setup.sql</a></p>
                              </td>
                              <td align="left" valign="top" width="69%" headers="d134082e432 d134082e427 ">
                                 <p><a href="real-application-security-hr-demo-files.html#GUID-2EFC5D83-9586-4B06-93B7-190197A8821A">hrdemo_setup.log</a></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="31%" id="d134082e443" headers="d134082e424 ">
                                 <p><a href="real-application-security-hr-demo-files.html#GUID-37A422AF-7AAB-4CC0-9E49-0D4BD2ED5F0F">hrdemo.sql</a></p>
                              </td>
                              <td align="left" valign="top" width="69%" headers="d134082e443 d134082e427 ">
                                 <p><a href="real-application-security-hr-demo-files.html#GUID-65F8FD60-F26D-4E63-97CB-DC310B64C078">hrdemo.log</a></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="31%" id="d134082e454" headers="d134082e424 ">
                                 <p><a href="real-application-security-hr-demo-files.html#GUID-933185DA-9B2F-4530-9B3A-91A034818B0A">hrdemo_session.sql </a></p>
                              </td>
                              <td align="left" valign="top" width="69%" headers="d134082e454 d134082e427 ">
                                 <p><a href="real-application-security-hr-demo-files.html#GUID-9D131D01-1A54-4771-AD08-1FD36415E2AD">hrdemo_session.log</a></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="31%" id="d134082e465" headers="d134082e424 ">
                                 <p><a href="real-application-security-hr-demo-files.html#GUID-C19275DF-6D8C-4D3B-8B8F-A83766CB5F61">hrdemo.java </a></p>
                              </td>
                              <td align="left" valign="top" width="69%" headers="d134082e465 d134082e427 ">
                                 <p><a href="real-application-security-hr-demo-files.html#GUID-E041C7EE-68C9-4495-BC1F-F87A3B567A98">hrdemo.log</a></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="31%" id="d134082e476" headers="d134082e424 ">
                                 <p><a href="real-application-security-hr-demo-files.html#GUID-4BAA592E-CD45-4789-A371-96A3BC3668D0">hrdemo_clean.sql</a></p>
                              </td>
                              <td align="left" valign="top" width="69%" headers="d134082e476 d134082e427 ">
                                 <p><a href="real-application-security-hr-demo-files.html#GUID-027FBD01-2EFE-47C8-A84F-5E52B5469382">hrdemo_clean.log</a></p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <div class="section">
                     <p>This section includes the following script files:</p>
                  </div>
                  <!-- class="section" -->
               </div><a id="DBFSG823"></a><div class="props_rev_3"><a id="GUID-E7974492-8418-4DAD-8497-530F3A669064" name="GUID-E7974492-8418-4DAD-8497-530F3A669064"></a><h4 id="DBFSG-GUID-E7974492-8418-4DAD-8497-530F3A669064" class="sect4">hrdemo_setup.sql</h4>
                  <div>
                     <div class="section">
                        <p>The source file for the set up script <code class="codeph">hrdemo_setup.sql</code>.
                        </p><pre class="oac_no_warn" dir="ltr">SET ECHO OFF
SET FEEDBACK 1
SET NUMWIDTH 10
SET LINESIZE 80
SET TRIMSPOOL ON
SET TAB OFF
SET PAGESIZE 100
SET ECHO ON

define passwd=&amp;1
  
----------------------------------------------------------------------
--  Introduction
----------------------------------------------------------------------
-- The HR Demo shows how to use basic Real Application Security features.
-- The demo secures HR.EMPLOYEES table by creating a data security 
-- policy that grants the table access to:
-- Data Security Policy
--
--(1) An employee can view his/her own record including SALARY column.
--(2) An IT engineer can view all employee records in IT department, 
--    but cannot view employee's salaries.
--(3) An HR representative can view and update all employee records.
--
--
--Sample Users and Their Role Grants:
-- 1) DAUSTIN, an application user in IT department. He has role employee
--    and it_engineer. He can view employee records in IT department, but he
--    cannot view the salary column except for his own. 
-- 2) SMAVRIS, an application user in HR department. She has role employee
--    and hr_representative. She can view and update all the employee records.
 
----------------------------------------------------------------------
-- 1. SETUP - User and Roles
----------------------------------------------------------------------

connect sys/&amp;passwd as sysdba
-- Create an application role employee for common employees.
exec sys.xs_principal.create_role(name =&gt; 'employee', enabled =&gt; true);
 
-- Create an application role it_engineer for IT department.
exec sys.xs_principal.create_role(name =&gt; 'it_engineer', enabled =&gt; true);

-- Create an application role hr_representative for HR department.
exec sys.xs_principal.create_role(name =&gt; 'hr_representative', enabled =&gt; true);

-- create a database role for object privilege grants
create role db_emp;

-- Grant DB_EMP to the three application roles, so they have the required 
-- object privileges to access the table. 
grant db_emp to employee;
grant db_emp to it_engineer;
grant db_emp to hr_representative; 
  
-- Create two application users:
-- DAUSTIN (in IT department), granted employee and it_engineer.
exec  sys.xs_principal.create_user(name =&gt; 'daustin', schema =&gt; 'hr');
exec  sys.xs_principal.set_password('daustin', 'welcome1');
exec  sys.xs_principal.grant_roles('daustin', 'XSCONNECT');
exec  sys.xs_principal.grant_roles('daustin', 'employee');
exec  sys.xs_principal.grant_roles('daustin', 'it_engineer');
 
-- SMAVRIS (in HR department), granted employee and hr_representative.
exec  sys.xs_principal.create_user(name =&gt; 'smavris', schema =&gt; 'hr');
exec  sys.xs_principal.set_password('smavris', 'welcome1');
exec  sys.xs_principal.grant_roles('daustin', 'XSCONNECT');
exec  sys.xs_principal.grant_roles('smavris', 'employee');
exec  sys.xs_principal.grant_roles('smavris', 'hr_representative');

-- Grant HR user policy adminisration privilege
exec sys.xs_admin_util.grant_system_privilege('ADMIN_ANY_SEC_POLICY','HR'); 
 
----------------------------------------------------------------------
-- 2. SETUP - Security class and ACL
----------------------------------------------------------------------

-- Connect as HR
connect hr/hr;

-- Grant necessary object privileges to db_emp role
-- This role will be used to grant the required object privileges to
-- application users.

grant select, insert, update, delete on hr.employees to db_emp; 

-- Create a security class hr_privileges and include privileges from the predefined DML security class.
-- hr_privileges has a new privilege VIEW_SALARY, which is used to control the 
-- access to SALARY column.
declare
begin
  sys.xs_security_class.create_security_class(
    name        =&gt; 'hr_privileges', 
    parent_list =&gt; xs$name_list('sys.dml'),
    priv_list   =&gt; xs$privilege_list(xs$privilege('view_salary')));
end;
/
 
-- Create three ACLs to grant privileges for the policy defined later.
declare  
  aces xs$ace_list := xs$ace_list();  
begin 
  aces.extend(1);
 
  -- EMP_ACL: This ACL grants employee the privileges to view an employee's
  --          own record including SALARY column.
  aces(1) := xs$ace_type(privilege_list =&gt; xs$name_list('select','view_salary'),
                         principal_name =&gt; 'employee');
 
  sys.xs_acl.create_acl(name      =&gt; 'emp_acl',
                    ace_list  =&gt; aces,
                    sec_class =&gt; 'hr_privileges');
  
  -- IT_ACL:  This ACL grants it_engineer the privilege to view the employee
  --          records in IT department, but it does not grant the VIEW_SALARY
  --          privilege that is required for access to SALARY column.
  aces(1) := xs$ace_type(privilege_list =&gt; xs$name_list('select'),
                         principal_name =&gt; 'it_engineer');
 
  sys.xs_acl.create_acl(name      =&gt; 'it_acl',
                    ace_list  =&gt; aces,
                    sec_class =&gt; 'hr_privileges');
 
  -- HR_ACL:  This ACL grants hr_representative the privileges to view and update all
  --          employees' records including SALARY column.
  aces(1):= xs$ace_type(privilege_list =&gt; xs$name_list('select', 'insert',
                                        'update', 'delete', 'view_salary'),
                        principal_name =&gt; 'hr_representative');
 
  sys.xs_acl.create_acl(name      =&gt; 'hr_acl',
                    ace_list  =&gt; aces,
                    sec_class =&gt; 'hr_privileges');
end;
/
 
----------------------------------------------------------------------
-- 3. SETUP - Data security policy
----------------------------------------------------------------------
-- Create data security policy for EMPLOYEE table. The policy defines three
-- realm constraints and a column constraint that protects SALARY column.
declare
  realms   xs$realm_constraint_list := xs$realm_constraint_list();      
  cols     xs$column_constraint_list := xs$column_constraint_list();
begin  
  realms.extend(3);
 
  -- Realm #1: Only the employee's own record. 
  --           employee can view the realm including SALARY column.     
  realms(1) := xs$realm_constraint_type(
    realm    =&gt; 'email = xs_sys_context(''xs$session'',''username'')',
    acl_list =&gt; xs$name_list('emp_acl'));
 
  -- Realm #2: The records in the IT department.
  --           it_engineer can view the realm excluding SALARY column.
  realms(2) := xs$realm_constraint_type(
    realm    =&gt; 'department_id = 60',
    acl_list =&gt; xs$name_list('it_acl'));
 
  -- Realm #3: All the records.
  --           hr_representative can view and update the realm including SALARY column.
  realms(3) := xs$realm_constraint_type(
    realm    =&gt; '1 = 1',
    acl_list =&gt; xs$name_list('hr_acl'));
 
  -- Column constraint protects SALARY column by requiring VIEW_SALARY 
  -- privilege.
  cols.extend(1);
  cols(1) := xs$column_constraint_type(
    column_list =&gt; xs$list('salary'),
    privilege   =&gt; 'view_salary');
 
  sys.xs_data_security.create_policy(
    name                   =&gt; 'employees_ds',
    realm_constraint_list  =&gt; realms,
    column_constraint_list =&gt; cols);
end;
/
  
-- Apply the data security policy to the table.
begin
  sys.xs_data_security.apply_object_policy(
    policy =&gt; 'employees_ds', 
    schema =&gt; 'hr',
    object =&gt;'employees');
end;
/
  
----------------------------------------------------------------------
-- 4. SETUP - Validate the objects we have set up.
----------------------------------------------------------------------
set serveroutput on;
begin
  if (sys.xs_diag.validate_workspace()) then
    dbms_output.put_line('All configurations are correct.');
  else
    dbms_output.put_line('Some configurations are incorrect.');
  end if;
end;
/
-- XS$VALIDATION_TABLE contains validation errors if any.
-- Expect no rows selected.
select * from xs$validation_table order by 1, 2, 3, 4;
  
----------------------------------------------------------------------
-- 5. SETUP - Mid-Tier related configuration.
----------------------------------------------------------------------

connect sys/&amp;passwd as sysdba

-- create a session administrator who has only 
-- RAS session administration privilege (no data privilege), 
-- and is responsible to manage RAS session for each application user. 
grant xs_session_admin, create session to hr_session identified by hr_session;
grant create session to hr_common identified by hr_common;

-- craete a dispatcher user for java demo, to set up session for application user
exec sys.xs_principal.create_user(name=&gt;'dispatcher', schema=&gt;'HR');
exec sys.xs_principal.set_password('dispatcher', 'welcome1');
exec sys.xs_principal.grant_roles('dispatcher', 'XSCONNECT');
exec sys.xs_principal.grant_roles('dispatcher', 'xsdispatcher');
  
exit
</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="DBFSG824"></a><div class="props_rev_3"><a id="GUID-37A422AF-7AAB-4CC0-9E49-0D4BD2ED5F0F" name="GUID-37A422AF-7AAB-4CC0-9E49-0D4BD2ED5F0F"></a><h4 id="DBFSG-GUID-37A422AF-7AAB-4CC0-9E49-0D4BD2ED5F0F" class="sect4">hrdemo.sql</h4>
                  <div>
                     <div class="section">
                        <p>The source file for the <code class="codeph">hrdemo.sql</code> script. This script runs the demo with direct logon.
                        </p><pre class="oac_no_warn" dir="ltr">SET ECHO OFF
SET FEEDBACK 1
SET NUMWIDTH 10
SET LINESIZE 80
SET TRIMSPOOL ON
SET TAB OFF
SET PAGESIZE 100
COLUMN EMAIL FORMAT A10
COLUMN FIRST_NAME FORMAT A15
COLUMN LAST_NAME FORMAT A15
COLUMN DEPARTMENT_ID FORMAT 9999
COLUMN MANAGER_ID FORMAT 9999
COLUMN SALARY FORMAT 999999
SET ECHO ON


----------------------------------------------------------------------
--  HR Demo - PL/SQL with RAS direct logon user
----------------------------------------------------------------------
-- This demo shows RAS runtime, using RAS direct logon user. 
-- Each user directly connects to database and accesses employee table. 
-- RAS policy is automatically enforced.
---------------------------------------------------------------------
 
-- Connect as DAUSTIN, who has only employee and it_engineer role
conn daustin/welcome1;
 
SET SECUREDCOL ON UNAUTH *******
 
-- DAUSTIN can view the records in IT department, but can only view his own
-- SALARY column.
select email, first_name, last_name, department_id, manager_id, salary 
from employees order by email;
 
 
SET SECUREDCOL OFF 
 
-- DAUSTIN cannot update the record.
update employees set manager_id = 102 where email = 'DAUSTIN';
 
-- Record is not changed.
select email, first_name, last_name, department_id, manager_id, salary
from employees where email = 'DAUSTIN';
 
 
-- Connect as SMAVRIS, who has both employee and hr_representative role. 
conn smavris/welcome1;
 
-- SMAVRIS can view all the records including SALARY column.
select email, first_name, last_name, department_id, manager_id, salary 
from employees where department_id = 60 or department_id = 40
order by department_id, email;
 
-- EMPLOYEES table has 107 rows, we expect to see all of them.
select count(*) from employees;
  
-- SMAVRIS can update the record.
update employees set manager_id = 102 where email = 'DAUSTIN';
 
-- Record is changed.
select email, first_name, last_name, department_id, manager_id, salary
from employees where email = 'DAUSTIN';
 
-- change the record back to the original. 
update employees set manager_id = 103 where email = 'DAUSTIN';
 
exit
</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="DBFSG825"></a><div class="props_rev_3"><a id="GUID-933185DA-9B2F-4530-9B3A-91A034818B0A" name="GUID-933185DA-9B2F-4530-9B3A-91A034818B0A"></a><h4 id="DBFSG-GUID-933185DA-9B2F-4530-9B3A-91A034818B0A" class="sect4">hrdemo_session.sql </h4>
                  <div>
                     <div class="section">
                        <p>The source file for the <code class="codeph">hrdemo_session.sql</code> script. This script explicitly creates and attaches a Real Application Security session.
                        </p><pre class="oac_no_warn" dir="ltr">SET ECHO OFF
SET FEEDBACK 1
SET NUMWIDTH 10
SET LINESIZE 80
SET TRIMSPOOL ON
SET TAB OFF
SET PAGESIZE 100
COLUMN EMAIL FORMAT A10
COLUMN FIRST_NAME FORMAT A15
COLUMN LAST_NAME FORMAT A15
COLUMN DEPARTMENT_ID FORMAT 9999
COLUMN MANAGER_ID FORMAT 9999
COLUMN SALARY FORMAT 999999
SET ECHO ON

----------------------------------------------------------------------
--  HR Demo - PL/SQL with Session API
----------------------------------------------------------------------
-- This demo shows RAS runtime, using RAS user as application user.
-- The user does not logon to database, but a RAS session is created
-- and attached for each user before accessing employee table.
---------------------------------------------------------------------
 
-- Connect as RAS session administrator.
connect hr_session/hr_session;
 
-- Variable used to remember the session ID.
var gsessionid varchar2(32);
 
-- Create an application session for SMARVIS and attach to it.
declare
  sessionid raw(16);
begin
  sys.dbms_xs_sessions.create_session('SMAVRIS', sessionid);
  :gsessionid := rawtohex(sessionid);
  sys.dbms_xs_sessions.attach_session(sessionid, null);
end ;
/
  
-- Display the current user, it should be SMAVRIS now.
select xs_sys_context('xs$session','username') from dual;
 
-- Display the enabled application roles and database roles.
select role_name from v$xs_session_roles union
select role from session_roles order by 1;
  
-- SMAVRIS can view all the records including SALARY column.
select email, first_name, last_name, department_id, manager_id, salary 
from employees where department_id = 60 or department_id = 40
order by department_id, email;
 
-- EMPLOYEES table has 107 rows, we expect to see all of them.
select count(*) from employees;
  
-- Disable hr_representative role.
exec dbms_xs_sessions.disable_role('hr_representative');
 
-- SMAVRIS should only be able to see her own record.
select email, first_name, last_name, department_id, manager_id, salary 
from employees where department_id = 60 or department_id = 40
order by department_id, email;
  
-- Enable hr_representative role.
exec sys.dbms_xs_sessions.enable_role('hr_representative');
 
-- SMAVRIS can view all the records again.
select email, first_name, last_name, department_id, manager_id, salary 
from employees where department_id = 60 or department_id = 40
order by department_id, email;
 
-- EMPLOYEES table has 107 rows, we expect to see all of them.
select count(*) from employees;
  
-- Detach and destroy the application session.
declare
  sessionid raw(16);
begin
  sessionid := hextoraw(:gsessionid);
  sys.dbms_xs_sessions.detach_session;
  sys.dbms_xs_sessions.destroy_session(sessionid);
end;
/
 
exit
</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="DBFSG826"></a><div class="props_rev_3"><a id="GUID-C19275DF-6D8C-4D3B-8B8F-A83766CB5F61" name="GUID-C19275DF-6D8C-4D3B-8B8F-A83766CB5F61"></a><h4 id="DBFSG-GUID-C19275DF-6D8C-4D3B-8B8F-A83766CB5F61" class="sect4">hrdemo.java </h4>
                  <div>
                     <div class="section">
                        <p>The source file for the Java demo is <code class="codeph">hrdemo.java</code>.
                        </p><pre class="oac_no_warn" dir="ltr">import java.security.GeneralSecurityException;
import java.security.InvalidAlgorithmParameterException;
import java.security.InvalidKeyException;
import java.security.NoSuchAlgorithmException;
import java.security.spec.InvalidKeySpecException;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
 
import java.util.ArrayList;
import java.util.List;
import oracle.jdbc.OracleDriver;
import oracle.jdbc.OracleResultSet;
import oracle.jdbc.OracleResultSet.AuthorizationIndicator;
 
import oracle.security.xs.AccessDeniedException;
import oracle.security.xs.InvalidXSNamespaceException;
import oracle.security.xs.InvalidXSUserException;
import oracle.security.xs.Role;
import oracle.security.xs.Session;
import oracle.security.xs.XSAccessController;
import oracle.security.xs.XSException;
import oracle.security.xs.XSSessionManager;
 
/**
 * A simple java application implemented using RAS.
 * It shows:
 *  -  How to setup RAS session manager
 *  -  How to manage RAS sessions
 *  -  How to use Column authorization indicator
 *  -  How to check privileges using "checkAcl" function 
*/
public class hrdemo {

  // application connection, should be created with unprivileged user
  // in RAS case, the user only needs DB connection privilege
  private Connection appConnection = null;
  
  // RAS dispatcher's connection, should be create with a RAS dispatcher user
  private Connection mgrConnection = null;
  // RAS session manager, to manage session for application user
  // Must be instanciated with disptcher's connection
  private XSSessionManager manager = null;
 
  public static void main(String[] args)  {
 
    try {
      DriverManager.registerDriver(new OracleDriver());
 
 
      if (args.length != 1) {
        System.out.println("Usage hrdemo dbURL");
        System.exit(1);
      }
      hrdemo demo = new hrdemo();
      demo.setupConnection(args[0]);

      demo.queryAsUser("DAUSTIN");
      demo.queryAsUser("SMAVRIS");
      
      demo.cleanupConnection();

    } catch (Exception e) {
      // we don't handle exception for now
      e.printStackTrace();
    }
  }
  
  private void queryAsUser(String user) throws SQLException, XSException {
   
    System.out.println("\nQuery HR.EMPLOYEES table as user \"" + user + "\"");

      Session lws = manager.createSession(appConnection, user, null,null);
      manager.attachSession(appConnection, lws, null, null, null, null, null);

      queryEmployees(lws);
  
      manager.detachSession(lws);
      manager.destroySession(appConnection, lws);
    
  }
 
  public void setupConnection(String url) throws SQLException, XSException, GeneralSecurityException {
    // dispatcher's connection
    mgrConnection =
        DriverManager.getConnection(url, "dispatcher", "welcome1");
    
    // RAS session manager
    manager = XSSessionManager.getSessionManager(mgrConnection, 30, 2048000);
    
    // connection used for application query
    appConnection = DriverManager.getConnection(url, "hr_common", "hr_common");
  }

  public void cleanupConnection() throws SQLException {
    mgrConnection.close();
    appConnection.close();

  }
 
  public void queryEmployees(Session lws) throws SQLException, XSException  {
    // using DB connection that has been attached to a RAS session
    Connection conn = lws.getConnection();
    String query = " select email, first_name, last_name, department_id, salary, ora_get_aclids(emp) from hr.employees emp where department_id in (40, 60, 100) order by email";

    Statement stmt = null;
    ResultSet rs = null;

    System.out.printf("  EMAIL  | FIRST_NAME | LAST_NAME  | DEPT | SALARY | UPDATE | VIEW_SALARY\n");
   
    try {

      stmt = conn.createStatement();
      rs = stmt.executeQuery(query);
      
      while (rs.next()) {

        String email = rs.getString("EMAIL");
        String first_name = rs.getString("FIRST_NAME");
        String last_name = rs.getString("LAST_NAME");
        String department_id = rs.getString("DEPARTMENT_ID");
        String salary;
        
        if (((OracleResultSet)rs).getAuthorizationIndicator("SALARY") == AuthorizationIndicator.NONE) {
          salary = rs.getString("SALARY");
        }
        else {
          salary = "*****";
        }

        byte[] aclRaw = rs.getBytes(6);
        String update, viewSalary;
        

	// call checkAcl to determine whether can update the database record
	if (XSAccessController.checkAcl(lws, aclRaw, "UPDATE")) {
          update = "true";
        }
        else {
          update = "false";
        }
        
        if (XSAccessController.checkAcl(lws, aclRaw, "VIEW_SALARY")) {
          viewSalary = "true";
        }
        else {
          viewSalary = "false";
        }

        System.out.printf("%9s|%12s|%12s|%6s|%8s|%8s|%8s\n", email, 
                          first_name, last_name, department_id, 
                          salary, update, viewSalary);
       }
    } finally {
      try { if (rs != null) rs.close(); } catch (Exception e) {};
      try { if (stmt != null) stmt.close(); } catch (Exception e) {};
    }
  }
}
</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="DBFSG827"></a><div class="props_rev_3"><a id="GUID-4BAA592E-CD45-4789-A371-96A3BC3668D0" name="GUID-4BAA592E-CD45-4789-A371-96A3BC3668D0"></a><h4 id="DBFSG-GUID-4BAA592E-CD45-4789-A371-96A3BC3668D0" class="sect4">hrdemo_clean.sql</h4>
                  <div>
                     <div class="section">
                        <p>The source file for the cleanup script is <code class="codeph">hrdemo_clean.sql</code>.
                        </p><pre class="oac_no_warn" dir="ltr">SET ECHO OFF
SET FEEDBACK 1
SET NUMWIDTH 10
SET LINESIZE 80
SET TRIMSPOOL ON
SET TAB OFF
SET PAGESIZE 100
SET ECHO ON

define passwd=&amp;1

connect hr/hr;
  
-- Remove policy from the table. 
begin
  sys.xs_data_security.remove_object_policy(policy=&gt;'employees_ds', 
                                        schema=&gt;'hr', object=&gt;'employees');
end;
/
-- Delete security class and ACLs
exec sys.xs_security_class.delete_security_class('hr_privileges', xs_admin_util.cascade_option);
exec sys.xs_acl.delete_acl('emp_acl', xs_admin_util.cascade_option);
exec sys.xs_acl.delete_acl('it_acl', xs_admin_util.cascade_option);
exec sys.xs_acl.delete_acl('hr_acl', xs_admin_util.cascade_option);

-- Delete data security policy
exec sys.xs_data_security.delete_policy('employees_ds', xs_admin_util.cascade_option);

connect sys/&amp;passwd as sysdba  
-- Delete application users and roles
exec sys.xs_principal.delete_principal('employee', xs_admin_util.cascade_option);
exec sys.xs_principal.delete_principal('hr_representative', xs_admin_util.cascade_option);
exec sys.xs_principal.delete_principal('it_engineer', xs_admin_util.cascade_option);
exec sys.xs_principal.delete_principal('smavris', xs_admin_util.cascade_option);
exec sys.xs_principal.delete_principal('daustin', xs_admin_util.cascade_option);
 
 
-- Delete database role
drop role db_emp;

-- Delete session administrator
drop user hr_session;
-- Delete the common user used to connect to DB
drop user hr_common;
 
-- Delete dispatcher user used by mid-tier
exec sys.xs_principal.delete_principal('dispatcher', xs_admin_util.cascade_option);
 
exit
</pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="DBFSG828"></a><div class="props_rev_3"><a id="GUID-95FB6E3E-1119-47A6-9E82-C17AC5CC6850" name="GUID-95FB6E3E-1119-47A6-9E82-C17AC5CC6850"></a><h3 id="DBFSG-GUID-95FB6E3E-1119-47A6-9E82-C17AC5CC6850" class="sect3">Generated Log Files for Each Script</h3>
               <div>
                  <div class="section">
                     <div class="p">This section includes the following log files that are generated from running the scripts listed in <a href="real-application-security-hr-demo-files.html#GUID-5953585D-D2F7-47E5-B27E-A81DCEC2CA52__CEGGEEAB" title="This table lists the source files and the generated log files for the HR demo scripts. This table has 2 columns. Column 1 is the script name and column 2 is the name of the log file that is generated when the script is run.">Table C-1</a>:
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="real-application-security-hr-demo-files.html#GUID-2EFC5D83-9586-4B06-93B7-190197A8821A">hrdemo_setup.log</a></p>
                           </li>
                           <li>
                              <p><a href="real-application-security-hr-demo-files.html#GUID-65F8FD60-F26D-4E63-97CB-DC310B64C078">hrdemo.log</a></p>
                           </li>
                           <li>
                              <p><a href="real-application-security-hr-demo-files.html#GUID-9D131D01-1A54-4771-AD08-1FD36415E2AD">hrdemo_run_sess.log</a></p>
                           </li>
                           <li>
                              <p><a href="real-application-security-hr-demo-files.html#GUID-E041C7EE-68C9-4495-BC1F-F87A3B567A98">hrdemo.log</a></p>
                           </li>
                           <li>
                              <p><a href="real-application-security-hr-demo-files.html#GUID-027FBD01-2EFE-47C8-A84F-5E52B5469382">hrdemo_clean.log</a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div><a id="DBFSG829"></a><div class="props_rev_3"><a id="GUID-2EFC5D83-9586-4B06-93B7-190197A8821A" name="GUID-2EFC5D83-9586-4B06-93B7-190197A8821A"></a><h4 id="DBFSG-GUID-2EFC5D83-9586-4B06-93B7-190197A8821A" class="sect4">hrdemo_setup.log</h4>
                  <div>
                     <div class="section">
                        <p>The <code class="codeph">hrdemo_setup.log</code> file.
                        </p><pre class="pre codeblock"><code>SQL&gt; @hrdemo_setup
SQL&gt; 
SQL&gt; define passwd=&amp;1
Enter value for 1: sample
SQL&gt; 
SQL&gt; ----------------------------------------------------------------------
SQL&gt; --  Introduction
SQL&gt; ----------------------------------------------------------------------
SQL&gt; -- The HR Demo shows how to use basic Real Application Security features.
SQL&gt; -- The demo secures HR.EMPLOYEE table by creating a data security
SQL&gt; -- policy that grants the table access to.
SQL&gt; -- Data Security Policy
SQL&gt; --
SQL&gt; --(1) An employee can view his/her own record including SALARY column.
SQL&gt; --(2) An IT engineer can view all employee records in IT department,
SQL&gt; --    but cannot view employee's salaries.
SQL&gt; --(3) An HR representative can view and update all employee records.
SQL&gt; --
SQL&gt; --
SQL&gt; --Sample Users and Their Role Grants:
SQL&gt; --1) DAUSTIN, an application user in IT department. He has role employee
SQL&gt; --   and it_engineer. He can view employee records in IT department, but he
SQL&gt; --   cannot view the salary column except for his own.
SQL&gt; --2) SMAVRIS, an application user in HR department. She has role employee
SQL&gt; --   and hr_representative. She can view and update all the employee records
SQL&gt; --
SQL&gt; ----------------------------------------------------------------------
SQL&gt; -- 1. SETUP - User and Roles
SQL&gt; ----------------------------------------------------------------------
SQL&gt; 
SQL&gt; connect sys/&amp;passwd as sysdba
Connected.
SQL&gt; -- Create an application role employee for common employees.
SQL&gt; exec xs_principal.create_role(name =&gt; 'employee', enabled =&gt; true);

PL/SQL procedure successfully completed.

SQL&gt; 
SQL&gt; -- Create an application role it_engineer for IT department.
SQL&gt; exec xs_principal.create_role(name =&gt; 'it_engineer', enabled =&gt; true);

PL/SQL procedure successfully completed.

SQL&gt; 
SQL&gt; -- Create an application role hr_representative for HR department.
SQL&gt; exec xs_principal.create_role(name =&gt; 'hr_representative', enabled =&gt; true);

PL/SQL procedure successfully completed.

SQL&gt; 
SQL&gt; -- create a database role for object privilege grants
SQL&gt; create role db_emp;

Role created.

SQL&gt; 
SQL&gt; -- Grant DB_EMP to the three application roles, so they have the required
SQL&gt; -- object privileges to access the table.
SQL&gt; grant db_emp to employee;

Grant succeeded.

SQL&gt; grant db_emp to it_engineer;

Grant succeeded.

SQL&gt; grant db_emp to hr_representative;

Grant succeeded.

SQL&gt; 
SQL&gt; -- Create two application users:
SQL&gt; -- DAUSTIN (in IT department), granted employee and it_engineer.
SQL&gt; exec  xs_principal.create_user(name =&gt; 'daustin', schema =&gt; 'hr');

PL/SQL procedure successfully completed.

SQL&gt; exec  xs_principal.set_password('daustin', 'welcome1');

PL/SQL procedure successfully completed.

SQL&gt; exec  xs_principal.grant_roles('daustin', 'XSCONNECT');

PL/SQL procedure successfully completed.

SQL&gt; exec  xs_principal.grant_roles('daustin', 'employee');

PL/SQL procedure successfully completed.

SQL&gt; exec  xs_principal.grant_roles('daustin', 'it_engineer');

PL/SQL procedure successfully completed.

SQL&gt; 
SQL&gt; -- SMAVRIS (in HR department), granted employee and hr_representative.
SQL&gt; exec  xs_principal.create_user(name =&gt; 'smavris', schema =&gt; 'hr');

PL/SQL procedure successfully completed.

SQL&gt; exec  xs_principal.set_password('smavris', 'welcome1');

PL/SQL procedure successfully completed.

SQL&gt; exec  xs_principal.grant_roles('smavris', 'XSCONNECT');

PL/SQL procedure successfully completed.

SQL&gt; exec  xs_principal.grant_roles('smavris', 'employee');

PL/SQL procedure successfully completed.

SQL&gt; exec  xs_principal.grant_roles('smavris', 'hr_representative');

PL/SQL procedure successfully completed.

SQL&gt; 
SQL&gt; -- Grant HR user policy adminisration privilege
SQL&gt; exec xs_admin_util.grant_system_privilege('ADMIN_ANY_SEC_POLICY','HR');

PL/SQL procedure successfully completed.

SQL&gt; 
SQL&gt; ----------------------------------------------------------------------
SQL&gt; -- 2. SETUP - Security class and ACL
SQL&gt; ----------------------------------------------------------------------
SQL&gt; 
SQL&gt; 
SQL&gt; -- Connect as HR
SQL&gt; connect hr/hr;
Connected.
SQL&gt; 
SQL&gt; -- Grant necessary object privileges to db_emp role
SQL&gt; -- This role will be used to grant the required object privileges to
SQL&gt; -- application users.
SQL&gt; 
SQL&gt; grant select, insert, update, delete on hr.employees to db_emp;

Grant succeeded.

SQL&gt; 
SQL&gt; 
SQL&gt; -- Create a security class hr_privileges and include privileges from the predefined DML security class.
SQL&gt; -- hr_privileges has a new privilege VIEW_SALARY, which is used to control the
SQL&gt; -- access to SALARY column.
SQL&gt; declare
  2  begin
  3    xs_security_class.create_security_class(
  4      name        =&gt; 'hr_privileges',
  5      parent_list =&gt; xs$name_list('sys.dml'),
  6      priv_list   =&gt; xs$privilege_list(xs$privilege('view_salary')));
  7  end;
  8  /

PL/SQL procedure successfully completed.

SQL&gt; 
SQL&gt; 
SQL&gt; 
SQL&gt; -- Create three ACLs to grant privileges for the policy defined later.
SQL&gt; declare
  2    aces xs$ace_list := xs$ace_list();
  3  begin
  4    aces.extend(1);
  5  
  6    -- EMP_ACL: This ACL grants employee the privileges to view an employee's
  7    --          own record including SALARY column.
  8    aces(1) := xs$ace_type(privilege_list =&gt; xs$name_list('select','view_salary'),
  9                           principal_name =&gt; 'employee');
 10  
 11    xs_acl.create_acl(name      =&gt; 'emp_acl',
 12                      ace_list  =&gt; aces,
 13                      sec_class =&gt; 'hr_privileges');
 14  
 15    -- IT_ACL:  This ACL grants it_engineer the privilege to view the employee
 16    --          records in IT department, but it does not grant the VIEW_SALARY
 17    --          privilege that is required for access to SALARY column.
 18    aces(1) := xs$ace_type(privilege_list =&gt; xs$name_list('select'),
 19                           principal_name =&gt; 'it_engineer');
 20  
 21    xs_acl.create_acl(name      =&gt; 'it_acl',
 22                      ace_list  =&gt; aces,
 23                      sec_class =&gt; 'hr_privileges');
 24  
 25    -- HR_ACL:  This ACL grants hr_representative the privileges to view and update all
 26    --          employees' records including SALARY column.
 27    aces(1):= xs$ace_type(privilege_list =&gt; xs$name_list('select', 'insert',
 28                                            'update', 'delete', 'view_salary'),
 29                          principal_name =&gt; 'hr_representative');
 30  
 31    xs_acl.create_acl(name      =&gt; 'hr_acl',
 32                      ace_list  =&gt; aces,
 33                      sec_class =&gt; 'hr_privileges');
 34  end;
 35  /

PL/SQL procedure successfully completed.

SQL&gt; 
SQL&gt; 
SQL&gt; 
SQL&gt; ----------------------------------------------------------------------
SQL&gt; -- 3. SETUP - Data security policy
SQL&gt; ----------------------------------------------------------------------
SQL&gt; -- Create data security policy for EMPLOYEE table. The policy defines three
SQL&gt; -- realm constraints and a column constraint that protects SALARY column.
SQL&gt; declare
  2    realms   xs$realm_constraint_list := xs$realm_constraint_list();
  3    cols     xs$column_constraint_list := xs$column_constraint_list();
  4  begin
  5    realms.extend(3);
  6  
  7    -- Realm #1: Only the employee's own record.
  8    --           employee can view the realm including SALARY column.
  9    realms(1) := xs$realm_constraint_type(
 10      realm    =&gt; 'email = xs_sys_context(''xs$session'',''username'')',
 11      acl_list =&gt; xs$name_list('emp_acl'));
 12  
 13    -- Realm #2: The records in the IT department.
 14    --           it_engineer can view the realm excluding SALARY column.
 15    realms(2) := xs$realm_constraint_type(
 16      realm    =&gt; 'department_id = 60',
 17      acl_list =&gt; xs$name_list('it_acl'));
 18  
 19    -- Realm #3: All the records.
 20    --           hr_representative can view and update the realm including SALARY column.
 21    realms(3) := xs$realm_constraint_type(
 22      realm    =&gt; '1 = 1',
 23      acl_list =&gt; xs$name_list('hr_acl'));
 24  
 25    -- Column constraint protects SALARY column by requiring VIEW_SALARY
 26    -- privilege.
 27    cols.extend(1);
 28    cols(1) := xs$column_constraint_type(
 29      column_list =&gt; xs$list('salary'),
 30      privilege   =&gt; 'view_salary');
 31  
 32    xs_data_security.create_policy(
 33      name                   =&gt; 'employees_ds',
 34      realm_constraint_list  =&gt; realms,
 35      column_constraint_list =&gt; cols);
 36  end;
 37  /

PL/SQL procedure successfully completed.

SQL&gt; 
SQL&gt; 
SQL&gt; 
SQL&gt; -- Apply the data security policy to the table.
SQL&gt; begin
  2    xs_data_security.apply_object_policy(
  3      policy =&gt; 'employees_ds',
  4      schema =&gt; 'hr',
  5      object =&gt;'employees');
  6  end;
  7  /

PL/SQL procedure successfully completed.

SQL&gt; 
SQL&gt; 
SQL&gt; 
SQL&gt; ----------------------------------------------------------------------
SQL&gt; -- 4. SETUP - Validate the objects we have set up.
SQL&gt; ----------------------------------------------------------------------
SQL&gt; set serveroutput on;
SQL&gt; begin
  2    if (xs_diag.validate_workspace()) then
  3      dbms_output.put_line('All configurations are correct.');
  4    else
  5      dbms_output.put_line('Some configurations are incorrect.');
  6    end if;
  7  end;
  8  /
Some configurations are incorrect.

PL/SQL procedure successfully completed.

SQL&gt; -- XS$VALIDATION_TABLE contains validation errors if any.
SQL&gt; -- Expect no rows selected.
SQL&gt; select * from xs$validation_table order by 1, 2, 3, 4;

      CODE
----------
DESCRIPTION
--------------------------------------------------------------------------------
OBJECT
--------------------------------------------------------------------------------
NOTE
--------------------------------------------------------------------------------
     -1020
No ACE in the ACL
[ACL "SYS"."NETWORK_ACL_30D45882EF095A86E053B0AAE80AF5F8"]



1 row selected.

SQL&gt; 
SQL&gt; 
SQL&gt; ----------------------------------------------------------------------
SQL&gt; -- 5. SETUP - additional configuration for Java demo.
SQL&gt; ----------------------------------------------------------------------
SQL&gt; 
SQL&gt; connect sys/&amp;passwd as sysdba
Connected.
SQL&gt; 
SQL&gt; -- create a session administrator who has only
SQL&gt; -- RAS session administration privilege (no data privilege),
SQL&gt; -- and is responsible to manage RAS session for each application user.
SQL&gt; grant xs_session_admin, create session to hr_session identified by hr_session;

Grant succeeded.

SQL&gt; grant create session to hr_common identified by hr_common;

Grant succeeded.

SQL&gt; 
SQL&gt; -- craete a dispatcher user for java demo, to set up session for application user
SQL&gt; exec xs_principal.create_user(name=&gt;'dispatcher', schema=&gt;'HR');

PL/SQL procedure successfully completed.

SQL&gt; exec xs_principal.set_password('dispatcher', 'welcome1');

PL/SQL procedure successfully completed.

SQL&gt; exec xs_principal.grant_roles('dispatcher', 'XSCONNECT');

PL/SQL procedure successfully completed.

SQL&gt; exec xs_principal.grant_roles('dispatcher', 'xsdispatcher');

PL/SQL procedure successfully completed.

SQL&gt; 
SQL&gt; exit
</code></pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="DBFSG830"></a><div class="props_rev_3"><a id="GUID-65F8FD60-F26D-4E63-97CB-DC310B64C078" name="GUID-65F8FD60-F26D-4E63-97CB-DC310B64C078"></a><h4 id="DBFSG-GUID-65F8FD60-F26D-4E63-97CB-DC310B64C078" class="sect4">hrdemo.log</h4>
                  <div>
                     <div class="section">
                        <p>The <code class="codeph">hrdemo.log</code> file.
                        </p><pre class="pre codeblock"><code>SQL&gt; @hrdemo
SQL&gt; 
SQL&gt; 
SQL&gt; ----------------------------------------------------------------------
SQL&gt; --  HR Demo - PL/SQL with RAS direct logon user
SQL&gt; ----------------------------------------------------------------------
SQL&gt; -- This demo shows RAS runtime, using RAS direct logon user.
SQL&gt; -- Each user directly connects to database and accesses employee table.
SQL&gt; -- RAS policy is automaticlly enforced.
SQL&gt; ---------------------------------------------------------------------
SQL&gt; 
SQL&gt; -- Connect as DAUSTIN, who has only employee and it_engineer role
SQL&gt; conn daustin/welcome1;
Connected.
SQL&gt; 
SQL&gt; SET SECUREDCOL ON UNAUTH *******
SQL&gt; 
SQL&gt; -- DAUSTIN can view the records in IT department, but can only view his own
SQL&gt; -- SALARY column.
SQL&gt; select email, first_name, last_name, department_id, manager_id, salary
  2  from employees order by email;

EMAIL      FIRST_NAME      LAST_NAME       DEPARTMENT_ID MANAGER_ID  SALARY
---------- --------------- --------------- ------------- ---------- -------
AHUNOLD    Alexander       Hunold                     60        102 *******
BERNST     Bruce           Ernst                      60        103 *******
DAUSTIN    David           Austin                     60        103    4800
DLORENTZ   Diana           Lorentz                    60        103 *******
VPATABAL   Valli           Pataballa                  60        103 *******

5 rows selected.

SQL&gt; 
SQL&gt; 
SQL&gt; SET SECUREDCOL OFF
SQL&gt; 
SQL&gt; 
SQL&gt; -- DAUSTIN cannot update the record.
SQL&gt; update employees set manager_id = 102 where email = 'DAUSTIN';

0 rows updated.

SQL&gt; 
SQL&gt; -- Record is not changed.
SQL&gt; select email, first_name, last_name, department_id, manager_id, salary
  2  from employees where email = 'DAUSTIN';

EMAIL      FIRST_NAME      LAST_NAME       DEPARTMENT_ID MANAGER_ID  SALARY
---------- --------------- --------------- ------------- ---------- -------
DAUSTIN    David           Austin                     60        103    4800

1 row selected.

SQL&gt; 
SQL&gt; 
SQL&gt; 
SQL&gt; -- Connect as SMAVRIS, who has both employee and hr_representative role.
SQL&gt; conn smavris/welcome1;
Connected.
SQL&gt; 
SQL&gt; -- SMAVRIS can view all the records including SALARY column.
SQL&gt; select email, first_name, last_name, department_id, manager_id, salary
  2  from employees where department_id = 60 or department_id = 40
  3  order by department_id, email;

EMAIL      FIRST_NAME      LAST_NAME       DEPARTMENT_ID MANAGER_ID  SALARY
---------- --------------- --------------- ------------- ---------- -------
SMAVRIS    Susan           Mavris                     40        101    6500
AHUNOLD    Alexander       Hunold                     60        102    9000
BERNST     Bruce           Ernst                      60        103    6000
DAUSTIN    David           Austin                     60        103    4800
DLORENTZ   Diana           Lorentz                    60        103    4200
VPATABAL   Valli           Pataballa                  60        103    4800

6 rows selected.

SQL&gt; 
SQL&gt; -- EMPLOYEES table has 107 rows, we expect to see all of them.
SQL&gt; select count(*) from employees;

  COUNT(*)
----------
       107

1 row selected.

SQL&gt; 
SQL&gt; 
SQL&gt; 
SQL&gt; -- SMAVRIS can update the record.
SQL&gt; update employees set manager_id = 102 where email = 'DAUSTIN';

1 row updated.

SQL&gt; 
SQL&gt; -- Record is changed.
SQL&gt; select email, first_name, last_name, department_id, manager_id, salary
  2  from employees where email = 'DAUSTIN';

EMAIL      FIRST_NAME      LAST_NAME       DEPARTMENT_ID MANAGER_ID  SALARY
---------- --------------- --------------- ------------- ---------- -------
DAUSTIN    David           Austin                     60        102    4800

1 row selected.

SQL&gt; 
SQL&gt; -- change the record back to the original.
SQL&gt; update employees set manager_id = 103 where email = 'DAUSTIN';

1 row updated.

SQL&gt; 
SQL&gt; exit
</code></pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="DBFSG831"></a><div class="props_rev_3"><a id="GUID-9D131D01-1A54-4771-AD08-1FD36415E2AD" name="GUID-9D131D01-1A54-4771-AD08-1FD36415E2AD"></a><h4 id="DBFSG-GUID-9D131D01-1A54-4771-AD08-1FD36415E2AD" class="sect4">hrdemo_run_sess.log</h4>
                  <div>
                     <div class="section">
                        <p>The <code class="codeph">hrdemo_run_sess.log</code> file.
                        </p><pre class="pre codeblock"><code>SQL&gt; @hrdemo_session
SQL&gt; 
SQL&gt; 
SQL&gt; ----------------------------------------------------------------------
SQL&gt; --  HR Demo - PL/SQL with Session API
SQL&gt; ----------------------------------------------------------------------
SQL&gt; -- This demo shows RAS runtime, using RAS user as application user.
SQL&gt; -- The user does not logon to database, but a RAS session is created
SQL&gt; -- and attached for each user before accessing employee table.
SQL&gt; ---------------------------------------------------------------------
SQL&gt; 
SQL&gt; -- Connect as RAS session administrator
SQL&gt; connect hr_session/hr_session;
Connected.
SQL&gt; 
SQL&gt; -- Variable used to remember the session ID;
SQL&gt; var gsessionid varchar2(32);
SQL&gt; 
SQL&gt; -- Create an application session for SMARVIS and attach to it.
SQL&gt; declare
  2    sessionid raw(16);
  3  begin
  4    dbms_xs_sessions.create_session('SMAVRIS', sessionid);
  5    :gsessionid := rawtohex(sessionid);
  6    dbms_xs_sessions.attach_session(sessionid, null);
  7  end ;
  8  /

PL/SQL procedure successfully completed.

SQL&gt; 
SQL&gt; -- Display the current user, it should be SMAVRIS now.
SQL&gt; select xs_sys_context('xs$session','username') from dual;

XS_SYS_CONTEXT('XS$SESSION','USERNAME')
--------------------------------------------------------------------------------
SMAVRIS

1 row selected.

SQL&gt; 
SQL&gt; -- Display the enabled application roles and database roles.
SQL&gt; select role_name from v$xs_session_roles union
  2  select role from session_roles order by 1;

ROLE_NAME
--------------------------------------------------------------------------------
DB_EMP
EMPLOYEE
HR_REPRESENTATIVE
XSCONNECT
XSPUBLIC
XS_CONNECT

6 rows selected.

SQL&gt; 
SQL&gt; -- SMAVRIS can view all the records including SALARY column.
SQL&gt; select email, first_name, last_name, department_id, manager_id, salary
  2  from employees where department_id = 60 or department_id = 40
  3  order by department_id, email;

EMAIL      FIRST_NAME      LAST_NAME       DEPARTMENT_ID MANAGER_ID  SALARY
---------- --------------- --------------- ------------- ---------- -------
SMAVRIS    Susan           Mavris                     40        101    6500
AHUNOLD    Alexander       Hunold                     60        102    9000
BERNST     Bruce           Ernst                      60        103    6000
DAUSTIN    David           Austin                     60        103    4800
DLORENTZ   Diana           Lorentz                    60        103    4200
VPATABAL   Valli           Pataballa                  60        103    4800

6 rows selected.

SQL&gt; 
SQL&gt; -- EMPLOYEES table has 107 rows, we expect to see all of them.
SQL&gt; select count(*) from employees;

  COUNT(*)
----------
       107

1 row selected.

SQL&gt; 
SQL&gt; -- Disable hr_representative role
SQL&gt; exec dbms_xs_sessions.disable_role('hr_representative');

PL/SQL procedure successfully completed.

SQL&gt; 
SQL&gt; -- SMAVRIS should only be able to see her own record.
SQL&gt; select email, first_name, last_name, department_id, manager_id, salary
  2  from employees where department_id = 60 or department_id = 40
  3  order by department_id, email;

EMAIL      FIRST_NAME      LAST_NAME       DEPARTMENT_ID MANAGER_ID  SALARY
---------- --------------- --------------- ------------- ---------- -------
SMAVRIS    Susan           Mavris                     40        101    6500

1 row selected.

SQL&gt; 
SQL&gt; 
SQL&gt; -- Enable HR_ROLE
SQL&gt; exec dbms_xs_sessions.enable_role('hr_representative');

PL/SQL procedure successfully completed.

SQL&gt; 
SQL&gt; -- SMAVRIS can view all the records again.
SQL&gt; select email, first_name, last_name, department_id, manager_id, salary
  2  from employees where department_id = 60 or department_id = 40
  3  order by department_id, email;

EMAIL      FIRST_NAME      LAST_NAME       DEPARTMENT_ID MANAGER_ID  SALARY
---------- --------------- --------------- ------------- ---------- -------
SMAVRIS    Susan           Mavris                     40        101    6500
AHUNOLD    Alexander       Hunold                     60        102    9000
BERNST     Bruce           Ernst                      60        103    6000
DAUSTIN    David           Austin                     60        103    4800
DLORENTZ   Diana           Lorentz                    60        103    4200
VPATABAL   Valli           Pataballa                  60        103    4800

6 rows selected.

SQL&gt; 
SQL&gt; -- EMPLOYEES table has 107 rows, we expect to see all of them.
SQL&gt; select count(*) from employees;

  COUNT(*)
----------
       107

1 row selected.

SQL&gt; 
SQL&gt; -- Detach and destroy the application session.
SQL&gt; declare
  2    sessionid raw(16);
  3  begin
  4    sessionid := hextoraw(:gsessionid);
  5    dbms_xs_sessions.detach_session;
  6    dbms_xs_sessions.destroy_session(sessionid);
  7  end;
  8  /

PL/SQL procedure successfully completed.

SQL&gt; 
SQL&gt; exit
</code></pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="DBFSG832"></a><div class="props_rev_3"><a id="GUID-E041C7EE-68C9-4495-BC1F-F87A3B567A98" name="GUID-E041C7EE-68C9-4495-BC1F-F87A3B567A98"></a><h4 id="DBFSG-GUID-E041C7EE-68C9-4495-BC1F-F87A3B567A98" class="sect4">hrdemo.log</h4>
                  <div>
                     <div class="section">
                        <p>The Java <code class="codeph">hrdemo.log</code> file.
                        </p><pre class="oac_no_warn" dir="ltr">Query HR.EMPLOYEES table as user "DAUSTIN"
  EMAIL  | FIRST_NAME | LAST_NAME  | DEPT | SALARY | UPDATE | VIEW_SALARY
  AHUNOLD|   Alexander|      Hunold|    60|   *****|   false|   false
   BERNST|       Bruce|       Ernst|    60|   *****|   false|   false
  DAUSTIN|       David|      Austin|    60|    4800|   false|    true
 DLORENTZ|       Diana|     Lorentz|    60|   *****|   false|   false
 VPATABAL|       Valli|   Pataballa|    60|   *****|   false|   false
 
Query HR.EMPLOYEES table as user "SMAVRIS"
  EMAIL  | FIRST_NAME | LAST_NAME  | DEPT | SALARY | UPDATE | VIEW_SALARY
  AHUNOLD|   Alexander|      Hunold|    60|    9000|    true|    true
   BERNST|       Bruce|       Ernst|    60|    6000|    true|    true
  DAUSTIN|       David|      Austin|    60|    4800|    true|    true
  DFAVIET|      Daniel|      Faviet|   100|    9000|    true|    true
 DLORENTZ|       Diana|     Lorentz|    60|    4200|    true|    true
 ISCIARRA|      Ismael|     Sciarra|   100|    7700|    true|    true
    JCHEN|        John|        Chen|   100|    8200|    true|    true
  JMURMAN| Jose Manuel|       Urman|   100|    7800|    true|    true
    LPOPP|        Luis|        Popp|   100|    6900|    true|    true
 NGREENBE|       Nancy|   Greenberg|   100|   12008|    true|    true
  SMAVRIS|       Susan|      Mavris|    40|    6500|    true|    true
 VPATABAL|       Valli|   Pataballa|    60|    4800|    true|    true
</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="DBFSG833"></a><div class="props_rev_3"><a id="GUID-027FBD01-2EFE-47C8-A84F-5E52B5469382" name="GUID-027FBD01-2EFE-47C8-A84F-5E52B5469382"></a><h4 id="DBFSG-GUID-027FBD01-2EFE-47C8-A84F-5E52B5469382" class="sect4">hrdemo_clean.log</h4>
                  <div>
                     <div class="section">
                        <p>The <code class="codeph">hrdemo_clean.log</code> file.
                        </p><pre class="pre codeblock"><code>SQL&gt; @hrdemo_clean
SQL&gt; 
SQL&gt; define passwd=&amp;1
Enter value for 1: test
SQL&gt; 
SQL&gt; connect hr/hr;
Connected.
SQL&gt; 
SQL&gt; -- Remove policy from the table.
SQL&gt; begin
  2    xs_data_security.remove_object_policy(policy=&gt;'employees_ds',
  3                                          schema=&gt;'hr', object=&gt;'employees');
  4  end;
  5  /

PL/SQL procedure successfully completed.

SQL&gt; 
SQL&gt; -- Delete security class and ACLs
SQL&gt; exec xs_security_class.delete_security_class('hr_privileges', xs_admin_util.cascade_option);

PL/SQL procedure successfully completed.

SQL&gt; exec xs_acl.delete_acl('emp_acl', xs_admin_util.cascade_option);

PL/SQL procedure successfully completed.

SQL&gt; exec xs_acl.delete_acl('it_acl', xs_admin_util.cascade_option);

PL/SQL procedure successfully completed.

SQL&gt; exec xs_acl.delete_acl('hr_acl', xs_admin_util.cascade_option);

PL/SQL procedure successfully completed.

SQL&gt; 
SQL&gt; -- Delete data security policy
SQL&gt; exec xs_data_security.delete_policy('employees_ds', xs_admin_util.cascade_option);

PL/SQL procedure successfully completed.

SQL&gt; 
SQL&gt; connect sys/&amp;passwd as sysdba
Connected.
SQL&gt; -- Delete application users and roles
SQL&gt; exec xs_principal.delete_principal('employee', xs_admin_util.cascade_option);

PL/SQL procedure successfully completed.

SQL&gt; exec xs_principal.delete_principal('hr_representative', xs_admin_util.cascade_option);

PL/SQL procedure successfully completed.

SQL&gt; exec xs_principal.delete_principal('it_engineer', xs_admin_util.cascade_option);

PL/SQL procedure successfully completed.

SQL&gt; exec xs_principal.delete_principal('smavris', xs_admin_util.cascade_option);

PL/SQL procedure successfully completed.

SQL&gt; exec xs_principal.delete_principal('daustin', xs_admin_util.cascade_option);

PL/SQL procedure successfully completed.

SQL&gt; 
SQL&gt; -- Delete database role
SQL&gt; drop role db_emp;

Role dropped.

SQL&gt; 
SQL&gt; -- Delete session administrator
SQL&gt; drop user hr_session;

User dropped.

SQL&gt; -- Delete the common user used to connect to DB
SQL&gt; drop user hr_common;

User dropped.

SQL&gt; 
SQL&gt; -- Delete dispatcher
SQL&gt; exec xs_principal.delete_principal('dispatcher', xs_admin_util.cascade_option);

PL/SQL procedure successfully completed.

SQL&gt; 
SQL&gt; exit
</code></pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>