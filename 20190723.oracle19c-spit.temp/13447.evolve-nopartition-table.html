<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="You can change a nonpartitioned table into a partitioned table.">
      <meta name="description" content="You can change a nonpartitioned table into a partitioned table.">
      <title>Changing a Nonpartitioned Table into a Partitioned Table</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="VLDB and Partitioning Guide">
      <meta property="og:description" content="You can change a nonpartitioned table into a partitioned table.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="VLDB and Partitioning Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="vldb-and-partitioning-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-04-23T18:05:22-07:00">
      <meta name="dcterms.title" content="VLDB and Partitioning Guide">
      <meta name="dcterms.dateCopyrighted" content="2008, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96199-03">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="drop-partition-table.html" title="Previous" type="text/html">
      <link rel="next" href="manage_hypt.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="VLDBG">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="drop-partition-table.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="manage_hypt.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">VLDB and Partitioning Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="partition-admin.html" property="item" typeof="WebPage"><span property="name">Partition Administration</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Changing a Nonpartitioned Table into a Partitioned Table</li>
            </ol>
            <a id="GUID-6054142E-207A-4DF0-A62A-4C1A94DD36C4" name="GUID-6054142E-207A-4DF0-A62A-4C1A94DD36C4"></a><a id="VLDBG00302"></a>
            
            <h2 id="VLDBG-GUID-6054142E-207A-4DF0-A62A-4C1A94DD36C4" class="sect2">Changing a Nonpartitioned Table into a Partitioned Table</h2>
         </header>
         <div class="ind">
            <div>
               <p>You can change a nonpartitioned table into a partitioned table.</p>
               <p>The following topics are discussed:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="evolve-nopartition-table.html#GUID-5C0F8D12-DDDF-42AB-B644-1880156832BC" title="Oracle Database provides a mechanism to move one or more partitions or to make other changes to the partitions' physical structures without significantly affecting the availability of the partitions for DML. This mechanism is called online table redefinition.">Using Online Redefinition to Partition Collection Tables</a></p>
                  </li>
                  <li>
                     <p><a href="evolve-nopartition-table.html#GUID-5FDB7D59-DD05-40E4-8AB4-AF82EA0D0FE5" title="A non-partitioned table can be converted to a partitioned table with a MODIFY clause added to the ALTER TABLE SQL statement.">Converting a Non-Partitioned Table to a Partitioned Table</a></p>
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-6054142E-207A-4DF0-A62A-4C1A94DD36C4__GUID-0B6B57EA-7AED-4E05-A271-505D84D227BF">
                  <p class="notep1">See Also:</p>
                  <p><a href="../admin/managing-tables.html#ADMIN11675" target="_blank"><span><cite>Oracle Database Administratorâ€™s Guide</cite></span></a> for information about redefining partitions of a table
                  </p>
               </div>
            </div><a id="VLDBG14075"></a><a id="VLDBG1197"></a><div class="props_rev_3"><a id="GUID-5C0F8D12-DDDF-42AB-B644-1880156832BC" name="GUID-5C0F8D12-DDDF-42AB-B644-1880156832BC"></a><h3 id="VLDBG-GUID-5C0F8D12-DDDF-42AB-B644-1880156832BC" class="sect3">Using Online Redefinition to Partition Collection Tables</h3>
               <div>
                  <p>Oracle Database provides a mechanism to move one or more partitions or to make other changes to the partitions' physical structures without significantly affecting the availability of the partitions for DML. This mechanism is called online table redefinition.</p>
                  <div class="section">
                     <p>You can use online redefinition to copy nonpartitioned Collection Tables to partitioned Collection Tables and Oracle Database inserts rows into the appropriate partitions in the Collection Table. <a href="evolve-nopartition-table.html#GUID-5C0F8D12-DDDF-42AB-B644-1880156832BC__CHDHIDJJ">Example 4-40</a> illustrates how this is done for nested tables inside an Objects column; a similar example works for Ordered Collection Type Tables inside an <code class="codeph">XMLType</code> table or column. During the <code class="codeph">copy_table_dependents</code> operation, you specify <code class="codeph">0</code> or <code class="codeph">false</code> for copying the indexes and constraints, because you want to keep the indexes and constraints of the newly defined collection table. However, the Collection Tables and its partitions have the same names as that of the interim table (<code class="codeph">print_media2</code> in <a href="evolve-nopartition-table.html#GUID-5C0F8D12-DDDF-42AB-B644-1880156832BC__CHDHIDJJ">Example 4-40</a>). You must take explicit steps to preserve the Collection Table names.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-5C0F8D12-DDDF-42AB-B644-1880156832BC__CHDHIDJJ">
                     <p class="titleinexample">Example 4-40 Redefining partitions with collection tables</p><pre class="oac_no_warn" dir="ltr">CONNECT / AS SYSDBA
DROP USER eqnt CASCADE;
CREATE USER eqnt IDENTIFIED BY eqnt;
GRANT CONNECT, RESOURCE TO eqnt;
 
-- Grant privleges required for online redefinition.
GRANT EXECUTE ON DBMS_REDEFINITION TO eqnt;
GRANT ALTER ANY TABLE TO eqnt;
GRANT DROP ANY TABLE TO eqnt;
GRANT LOCK ANY TABLE TO eqnt;
GRANT CREATE ANY TABLE TO eqnt;
GRANT SELECT ANY TABLE TO eqnt;
 
-- Privileges required to perform cloning of dependent objects.
GRANT CREATE ANY TRIGGER TO eqnt;
GRANT CREATE ANY INDEX TO eqnt;
 
CONNECT eqnt/eqnt
 
CREATE TYPE textdoc_typ AS OBJECT ( document_typ VARCHAR2(32));
/
CREATE TYPE textdoc_tab AS TABLE OF textdoc_typ;
/

-- (old) non partitioned nested table
CREATE TABLE print_media
    ( product_id        NUMBER(6) primary key
    , ad_textdocs_ntab  textdoc_tab
    )
NESTED TABLE ad_textdocs_ntab STORE AS equi_nestedtab
(   (document_typ NOT NULL)
    STORAGE (INITIAL 8M)
)</pre><pre class="oac_no_warn" dir="ltr">;
 
-- Insert into base table
INSERT INTO print_media VALUES (1,
   textdoc_tab(textdoc_typ('xx'), textdoc_typ('yy')));
INSERT INTO print_media VALUES (11,
   textdoc_tab(textdoc_typ('aa'), textdoc_typ('bb')));
COMMIT;
 
-- Insert into nested table
INSERT INTO TABLE
  (SELECT p.ad_textdocs_ntab FROM print_media p WHERE p.product_id = 11)
   VALUES ('cc');
 
SELECT * FROM print_media;

PRODUCT_ID   AD_TEXTDOCS_NTAB(DOCUMENT_TYP)
----------   ------------------------------
         1   TEXTDOC_TAB(TEXTDOC_TYP('xx'), TEXTDOC_TYP('yy'))
        11   TEXTDOC_TAB(TEXTDOC_TYP('aa'), TEXTDOC_TYP('bb'), TEXTDOC_TYP('cc'))
 
-- Creating partitioned Interim Table
CREATE TABLE print_media2
    ( product_id        NUMBER(6)
    , ad_textdocs_ntab  textdoc_tab
    )
NESTED TABLE ad_textdocs_ntab STORE AS equi_nestedtab2
(   (document_typ NOT NULL)
    STORAGE (INITIAL 8M)
)
PARTITION BY RANGE (product_id)
(
    PARTITION P1 VALUES LESS THAN (10),
    PARTITION P2 VALUES LESS THAN (20)
);
 
EXEC dbms_redefinition.start_redef_table('eqnt', 'print_media', 'print_media2');
 
DECLARE
 error_count pls_integer := 0;
BEGIN
  dbms_redefinition.copy_table_dependents('eqnt', 'print_media', 'print_media2',
                                          0, true, false, true, false,
                                          error_count);
 
  dbms_output.put_line('errors := ' || to_char(error_count));
END;
/
 
EXEC  dbms_redefinition.finish_redef_table('eqnt', 'print_media', 'print_media2');
 
-- Drop the interim table
DROP TABLE print_media2;
 
-- print_media has partitioned nested table here

SELECT * FROM print_media PARTITION (p1);

PRODUCT_ID   AD_TEXTDOCS_NTAB(DOCUMENT_TYP)
----------   ------------------------------
         1   TEXTDOC_TAB(TEXTDOC_TYP('xx'), TEXTDOC_TYP('yy'))

SELECT * FROM print_media PARTITION (p2);

PRODUCT_ID   AD_TEXTDOCS_NTAB(DOCUMENT_TYP)
----------   ------------------------------
        11   TEXTDOC_TAB(TEXTDOC_TYP('aa'), TEXTDOC_TYP('bb'), TEXTDOC_TYP('cc'))</pre></div>
                  <!-- class="example" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-5FDB7D59-DD05-40E4-8AB4-AF82EA0D0FE5" name="GUID-5FDB7D59-DD05-40E4-8AB4-AF82EA0D0FE5"></a><h3 id="VLDBG-GUID-5FDB7D59-DD05-40E4-8AB4-AF82EA0D0FE5" class="sect3">Converting a Non-Partitioned Table to a Partitioned Table</h3>
               <div>
                  <p>A non-partitioned table can be converted to a partitioned table with a <code class="codeph">MODIFY</code> clause added to the <code class="codeph">ALTER</code> <code class="codeph">TABLE</code> SQL statement.
                  </p>
                  <p> In addition, the keyword <code class="codeph">ONLINE</code> can be specified, enabling concurrent DML operations while the conversion is ongoing.
                  </p>
                  <p>The following is an example of the <code class="codeph">ALTER TABLE</code> statement using the <code class="codeph">ONLINE</code> keyword for an online conversion to a partitioned table.
                  </p>
                  <div class="example" id="GUID-5FDB7D59-DD05-40E4-8AB4-AF82EA0D0FE5__GUID-7E992DD2-5B56-4FC6-BCA9-B517DF0353C9">
                     <p class="titleinexample">Example 4-41 Using the MODIFY clause of ALTER TABLE to convert online to a partitioned table</p><pre class="oac_no_warn" dir="ltr">ALTER TABLE employees_convert MODIFY
  PARTITION BY RANGE (employee_id) INTERVAL (100)
  ( PARTITION P1 VALUES LESS THAN (100),
    PARTITION P2 VALUES LESS THAN (500)
   ) ONLINE
  UPDATE INDEXES
 ( IDX1_SALARY LOCAL,
   IDX2_EMP_ID GLOBAL PARTITION BY RANGE (employee_id)
  ( PARTITION IP1 VALUES LESS THAN (MAXVALUE))
 );</pre></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-5FDB7D59-DD05-40E4-8AB4-AF82EA0D0FE5__GUID-FDDDBB01-038E-4FCF-BBF9-90D00DF3A794">Considerations When Using the UPDATE INDEXES Clause</p>
                     <p>When using the <code class="codeph">UPDATE</code> <code class="codeph">INDEXES</code> clause, note the following.
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>This clause can be used to change the partitioning state of indexes and storage properties of the indexes being converted. </p>
                        </li>
                        <li>
                           <p>The specification of the <code class="codeph">UPDATE</code> <code class="codeph">INDEXES</code> clause is optional. 
                           </p>
                           <p>Indexes are maintained both for the online and offline conversion to a partitioned table.</p>
                        </li>
                        <li>
                           <p>This clause cannot change the columns on which the original list of indexes are defined. </p>
                        </li>
                        <li>
                           <p>This clause cannot change the uniqueness property of the index or any other index property.</p>
                        </li>
                        <li>
                           <p>If you do not specify the tablespace for any of the indexes, then the following tablespace defaults apply. </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Local indexes after the conversion collocate with the table partition.</p>
                              </li>
                              <li>
                                 <p>Global indexes after the conversion reside in the same tablespace of the original global index on the non-partitioned table.</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>If you do not specify the <code class="codeph">INDEXES</code> clause or the <code class="codeph">INDEXES</code> clause does not specify all the indexes on the original non-partitioned table, then the following default behavior applies for all unspecified indexes.
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Global partitioned indexes remain the same and retain the original partitioning shape.</p>
                              </li>
                              <li>
                                 <p>Non-prefixed indexes become global nonpartitioned indexes.</p>
                              </li>
                              <li>
                                 <p>Prefixed indexes are converted to local partitioned indexes. </p>
                                 <p>Prefixed means that the partition key columns are included in the index definition, but the index definition is not limited to including the partitioning keys only.</p>
                              </li>
                              <li>
                                 <p>Bitmap indexes become local partitioned indexes, regardless whether they are prefixed or not. </p>
                                 <p>Bitmap indexes must always be local partitioned indexes.</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>The conversion operation cannot be performed if there are domain indexes.</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>