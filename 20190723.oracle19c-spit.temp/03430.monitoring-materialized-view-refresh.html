<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="This chapter describes how to use refresh statistics to monitor the performance of materialized view refresh operations.">
      <meta name="description" content="This chapter describes how to use refresh statistics to monitor the performance of materialized view refresh operations.">
      <title>Monitoring Materialized View Refresh Operations</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Data Warehousing Guide">
      <meta property="og:description" content="This chapter describes how to use refresh statistics to monitor the performance of materialized view refresh operations.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Data Warehousing Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="database-data-warehousing-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-09T00:20:13-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2001, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96243-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="synchronous-refresh.html" title="Previous" type="text/html">
      <link rel="next" href="dimensions.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Data Warehousing Guide">
    <meta name="dcterms.isVersionOf" content="DWHSG">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="synchronous-refresh.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="dimensions.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Data Warehousing Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-optimizing-dw.html" property="item" typeof="WebPage"><span property="name">Optimizing Data Warehouses</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Monitoring Materialized View Refresh Operations</li>
            </ol>
            <a id="GUID-6AD8879A-0BE5-466E-8D19-1D076C5DDFFB" name="GUID-6AD8879A-0BE5-466E-8D19-1D076C5DDFFB"></a>
            
            <h2 id="DWHSG-GUID-6AD8879A-0BE5-466E-8D19-1D076C5DDFFB" class="sect2"><span class="enumeration_chapter">9 </span>Monitoring Materialized View Refresh Operations
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>This chapter describes how to use refresh statistics to monitor the performance of materialized view refresh operations.</p>
               <p></p>
               <p>This chapter contains the following topics:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="monitoring-materialized-view-refresh.html#GUID-F6DBC9A1-7C48-4653-9B52-27C0CCC2D2EA" title="Oracle Database collects and stores statistics about materialized view refresh operations. These statistics are accessible using data dictionary views.">About Materialized View Refresh Statistics</a></p>
                  </li>
                  <li>
                     <p><a href="monitoring-materialized-view-refresh.html#GUID-D5FD6B4A-D211-4EB6-890A-6BC5FCC2C73E" title="Oracle Database manages the collection and retention of materialized view refresh statistics based on the defined database settings. By default, the database collects and stores basic statistics about materialized view refresh operations for the entire database.">Overview of Managing Materialized View Refresh Statistics</a></p>
                  </li>
                  <li>
                     <p><a href="monitoring-materialized-view-refresh.html#GUID-AA9F1365-AC7D-4A35-B6B9-95036DDF6597" title="Oracle Database stores materialized view refresh statistics in the data dictionary. Setting the collection level for materialized view refresh controls the detail level of refresh statistics collected.">About Data Dictionary Views that Store Materialized View Refresh Statistics</a></p>
                  </li>
                  <li>
                     <p><a href="monitoring-materialized-view-refresh.html#GUID-F06DFCF7-BC77-4A63-9A27-410F36D9152D" title="Oracle Database collects basic statistics about materialized view refresh operations. These statistics are stored in the data dictionary and can be used to analyze the performance of materialized view refresh operations.">Collecting Materialized View Refresh Statistics</a></p>
                  </li>
                  <li>
                     <p><a href="monitoring-materialized-view-refresh.html#GUID-2504FDE4-EE8E-492A-ADA5-15162A909AD9" title="Oracle Database stores the collected materialized view refresh statistics for a period of time specified by the retention period.">Retaining Materialized View Refresh Statistics</a></p>
                  </li>
                  <li>
                     <p><a href="monitoring-materialized-view-refresh.html#GUID-D4D01309-4ACA-426B-8F33-75E9FB8DF838" title="Data dictionary views store both the default settings and materialized view-specific settings that manage materialized view refresh statistics.">Viewing Materialized View Refresh Statistics Settings</a></p>
                  </li>
                  <li>
                     <p><a href="monitoring-materialized-view-refresh.html#GUID-B4215657-7526-4C64-AB27-B906EBA28A00" title="The DBMS_MVIEW_STATS.PURGE_REFRESH_STATS procedure enables you to explicitly purge materialized view refresh statistics that are older than a specified period from the data dictionary.">Purging Materialized View Refresh Statistics</a></p>
                  </li>
                  <li>
                     <p><a href="monitoring-materialized-view-refresh.html#GUID-8F9CC2EC-9CFC-4F56-97D5-5EB099BD852A" title="You can view both current and historical statistics for materialized view refresh operations by querying the data dictionary views that store refresh statistics.">Viewing Materialized View Refresh Statistics</a></p>
                  </li>
                  <li>
                     <p><a href="monitoring-materialized-view-refresh.html#GUID-D87F8F81-8B93-4D7E-87F5-3BFEAA2A7C06" title="Materialized view refresh statistics that are stored in data dictionary views can be used to analyze the refresh performance of materialized views.">Analyzing Materialized View Refresh Performance Using Refresh Statistics</a></p>
                  </li>
               </ul>
            </div>
            <div class="sect2"><a id="GUID-F6DBC9A1-7C48-4653-9B52-27C0CCC2D2EA" name="GUID-F6DBC9A1-7C48-4653-9B52-27C0CCC2D2EA"></a><h3 id="DWHSG-GUID-F6DBC9A1-7C48-4653-9B52-27C0CCC2D2EA" class="sect3"><span class="enumeration_section">9.1 </span>About Materialized View Refresh Statistics
               </h3>
               <div>
                  <p>Oracle Database collects and stores statistics about materialized view refresh operations. These statistics are accessible using data dictionary views. </p>
                  <p>Statistics for both current and historical materialized view refresh operations are stored in the database. Historical materialized view refresh statistics enable you to understand and analyze materialized view refresh performance over time in your database. Refresh statistics can be collected at varying levels of granularity. </p>
                  <p>Maintaining materialized view refresh statistics provides the following:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Reporting capabilities for materialized view refresh operations</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Display both current and historical statistics for materialized view refresh operations</p>
                           </li>
                           <li>
                              <p>Display statistics on actual refresh execution times</p>
                           </li>
                           <li>
                              <p>Track the performance of materialized view refresh over time using statistics on actual refresh execution times</p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>Diagnostic capabilities for materialized view refresh performance</p>
                        <p>Detailed current and historical statistics can be used to quickly analyze the performance of materialized view refresh operations. For example, if a materialized view takes a long time to refresh, you can use refresh statistics to determine if the slowdown is due to increased system load or vastly varying change data.</p>
                     </li>
                  </ul>
               </div>
            </div>
            <div class="sect2"><a id="GUID-D5FD6B4A-D211-4EB6-890A-6BC5FCC2C73E" name="GUID-D5FD6B4A-D211-4EB6-890A-6BC5FCC2C73E"></a><h3 id="DWHSG-GUID-D5FD6B4A-D211-4EB6-890A-6BC5FCC2C73E" class="sect3"><span class="enumeration_section">9.2 </span>Overview of Managing Materialized View Refresh Statistics
               </h3>
               <div>
                  <p>Oracle Database manages the collection and retention of materialized view refresh statistics based on the defined database settings. By default, the database collects and stores basic statistics about materialized view refresh operations for the entire database. </p>
                  <p>Managing materialized view refresh statistics comprises of the defining policies that control the following:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Level of details for materialized view refresh statistics</p>
                     </li>
                     <li>
                        <p>Retention period of materialized view refresh statistics</p>
                     </li>
                  </ul>
                  <p>Use the following techniques to define policies that manage materialized view refresh statistics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Define default settings that are applicable to the entire database</p>
                        <p>The <code class="codeph">DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT</code> procedure defines default settings that manage the collection and retention of materialized view refresh statistics for the entire database. 
                        </p>
                     </li>
                     <li>
                        <p>Define collection and retention policies for individual materialized views</p>
                        <p>The <code class="codeph">DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS</code> procedure provides more fine-grained control over materialized view refresh statistics by managing the collection and retention of statistics at the level in individual materialized views. Settings made at the materialized view level override the database-level settings.
                        </p>
                     </li>
                  </ul>
                  <div class="infoboxnote" id="GUID-D5FD6B4A-D211-4EB6-890A-6BC5FCC2C73E__GUID-D980E6E9-9014-47BC-9C79-B4DAE1FDD5BD">
                     <p class="notep1">Note:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-F06DFCF7-BC77-4A63-9A27-410F36D9152D" title="Oracle Database collects basic statistics about materialized view refresh operations. These statistics are stored in the data dictionary and can be used to analyze the performance of materialized view refresh operations.">Collecting Materialized View Refresh Statistics</a></p>
                        </li>
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-2504FDE4-EE8E-492A-ADA5-15162A909AD9" title="Oracle Database stores the collected materialized view refresh statistics for a period of time specified by the retention period.">Retaining Materialized View Refresh Statistics</a></p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-AA9F1365-AC7D-4A35-B6B9-95036DDF6597" name="GUID-AA9F1365-AC7D-4A35-B6B9-95036DDF6597"></a><h3 id="DWHSG-GUID-AA9F1365-AC7D-4A35-B6B9-95036DDF6597" class="sect3"><span class="enumeration_section">9.3 </span>About Data Dictionary Views that Store Materialized View Refresh Statistics
               </h3>
               <div>
                  <p>Oracle Database stores materialized view refresh statistics in the data dictionary. Setting the collection level for materialized view refresh controls the detail level of refresh statistics collected. </p>
                  <p>Each materialized view refresh operation is identified using a unique refresh ID. A single refresh operation could refresh multiple materialized views. For example, when the <code class="codeph">REFRESH_DEPENDENT</code> procedure is used to refresh a single materialized view, all materialized views that are dependent on the specified materialized view are also refreshed as part of the same refresh operation.  Thus, all the materialized views refreshed as part of this operation will have the same refresh ID.
                  </p>
                  <div class="tblformal" id="GUID-AA9F1365-AC7D-4A35-B6B9-95036DDF6597__GUID-D09AE281-E251-46B9-9D9A-7C544D6FDB8D">
                     <p class="titleintable">Table 9-1 Data Dictionary Views that Store Materialized View Refresh Statistics</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="Data Dictionary Views that Store Materialized View Refresh Statistics" summary="This table describes the data dictionary views that store statistics on materialized view refresh operations" width="100%" frame="hsides" border="1" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="20%" id="d39969e261">View Name</th>
                              <th align="left" valign="bottom" width="20%" id="d39969e263">Description</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d39969e267" headers="d39969e261 "><code class="codeph">DBA_MVREF_STATS</code></td>
                              <td align="left" valign="top" width="20%" headers="d39969e267 d39969e263 ">
                                 <p>Stores basic statistics for a materialized view refresh such as the refresh ID and basic timing statistics for the refresh operation. </p>
                                 <p>This view contains the following information about each materialized view for which refresh statistics are collected:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>name of the materialized view</p>
                                    </li>
                                    <li>
                                       <p>refresh method used</p>
                                    </li>
                                    <li>
                                       <p>number of rows in the materialized view at the beginning and end of the refresh operation</p>
                                    </li>
                                    <li>
                                       <p>number of steps used to refresh the materialized view</p>
                                    </li>
                                 </ul>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d39969e289" headers="d39969e261 "><code class="codeph">DBA_MVREF_RUN_STATS</code></td>
                              <td align="left" valign="top" width="20%" headers="d39969e289 d39969e263 ">
                                 <p>Stores detailed information about each materialized view refresh operation including the following:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>parameters specified when running the refresh operation such as list of materialized views, refresh method, purge option, and so on.</p>
                                    </li>
                                    <li>
                                       <p>number of materialized views refreshed in the refresh operation.</p>
                                    </li>
                                    <li>
                                       <p>detailed timing statistics for the refresh operation including start time, end time, and elapsed time.</p>
                                    </li>
                                 </ul>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d39969e306" headers="d39969e261 "><code class="codeph">DBA_MVREF_CHANGE_STATS</code></td>
                              <td align="left" valign="top" width="20%" headers="d39969e306 d39969e263 ">
                                 <p>Contains change data load information for the base tables associated with a materialized view refresh operation.</p>
                                 <p>The details include base table names, materialized view names, number of rows inserted, number of rows updated, number of rows deleted, number of direct-load inserts, PMOPs details, and number of rows at the beginning of the refresh operation.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d39969e315" headers="d39969e261 "><code class="codeph">DBA_MVREF_STMT_STATS</code></td>
                              <td align="left" valign="top" width="20%" headers="d39969e315 d39969e263 ">
                                 <p>Contains information related to each refresh statement that is part of a single materialized view refresh operation.</p>
                                 <p>This includes information such as materialized view name, refresh ID, the refresh statement, SQLID of the refresh statement, and execution plan of the statement.</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <div class="infoboxnotealso" id="GUID-AA9F1365-AC7D-4A35-B6B9-95036DDF6597__GUID-4F2CA3CF-2C7E-4138-BF5B-89B6F6AD45B1">
                     <p class="notep1">See Also:</p>
                     <p><a href="../refrn/index.html" target="_blank"><span><cite>Oracle Database Reference</cite></span></a></p>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-F06DFCF7-BC77-4A63-9A27-410F36D9152D" name="GUID-F06DFCF7-BC77-4A63-9A27-410F36D9152D"></a><h3 id="DWHSG-GUID-F06DFCF7-BC77-4A63-9A27-410F36D9152D" class="sect3"><span class="enumeration_section">9.4 </span>Collecting Materialized View Refresh Statistics
               </h3>
               <div>
                  <p>Oracle Database collects basic statistics about materialized view refresh operations. These statistics are stored in the data dictionary and can be used to analyze the performance of materialized view refresh operations. </p>
                  <div class="infoboxnotealso" id="GUID-F06DFCF7-BC77-4A63-9A27-410F36D9152D__GUID-904D4E07-36F0-440C-98DD-2331BF920BB6">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-EBEAEDE0-6DE1-477C-B140-7C6F7F594271" title="By default, Oracle Database collects basic refresh statistics for all materialized views refresh operations.">About Collecting Materialized View Refresh Statistics</a></p>
                        </li>
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-D758F3E6-EA01-4F01-BAD9-1D5A0AFD7CB2" title="The DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT procedure enables you to set defaults for managing the collection of materialized view refresh statistics at the database level.">Specifying Default Settings for Collecting Materialized View Refresh Statistics</a></p>
                        </li>
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-2EF89116-0920-4F5A-8E4B-14C0F7D8B2FD" title="You can modify the settings that manage the collection of materialized view refresh statistics by using the DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS procedure.">Modifying the Collection Level for Materialized View Refresh Statistics</a></p>
                        </li>
                     </ul>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-EBEAEDE0-6DE1-477C-B140-7C6F7F594271" name="GUID-EBEAEDE0-6DE1-477C-B140-7C6F7F594271"></a><h4 id="DWHSG-GUID-EBEAEDE0-6DE1-477C-B140-7C6F7F594271" class="sect4"><span class="enumeration_section">9.4.1 </span>About Collecting Materialized View Refresh Statistics
                  </h4>
                  <div>
                     <p>By default, Oracle Database collects basic refresh statistics for all materialized views refresh operations.</p>
                     <p>Oracle Database enables you to control the granularity and level at which materialized view refresh statistics are collected. Statistics can be collected for all materialized views in the database or for a specific set of materialized views. If you are interested in monitoring only some materialized views in the database, then you can collect statistics at the materialized view level. Collecting refresh statistics for a selected set of materialized views is useful because refresh patterns of materialized views can vary widely.</p>
                     <p>The collection level defines the amount of statistics that the database collects for materialized view refresh operations. You can either collect basic statistics or more detailed information such as the parameters used and the SQL statements run during the materialized view refresh operation.</p>
                     <p>Use the procedures in the <code class="codeph">DBMS_MVIEW_STATS</code> package to set the <code class="codeph">COLLECTION_LEVEL</code> parameter, which specifies the collection level for materialized view refresh statistics. The values that can be set for the <code class="codeph">COLLECTION_LEVEL</code> parameter are:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>NONE</p>
                           <p>No statistics are collected for materialized view refresh operations.</p>
                        </li>
                        <li>
                           <p>TYPICAL</p>
                           <p>Only basic refresh statistics are collected for materialized view refresh operations. This is the default setting.</p>
                        </li>
                        <li>
                           <p>ADVANCED</p>
                           <p>Detailed statistics, including the parameters used in the refresh operation and the SQL statements that are run, are collected for materialized view refresh operations.</p>
                        </li>
                     </ul>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-D758F3E6-EA01-4F01-BAD9-1D5A0AFD7CB2" name="GUID-D758F3E6-EA01-4F01-BAD9-1D5A0AFD7CB2"></a><h4 id="DWHSG-GUID-D758F3E6-EA01-4F01-BAD9-1D5A0AFD7CB2" class="sect4"><span class="enumeration_section">9.4.2 </span>Specifying Default Settings for Collecting Materialized View Refresh Statistics
                  </h4>
                  <div>
                     <p>The <code class="codeph">DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT</code> procedure enables you to set defaults for managing the collection of materialized view refresh statistics at the database level.
                     </p>
                     <div class="section">
                        <p>You can override the system defaults by specifying different settings at the individual materialized view level. Materialized views for which the default settings are not overridden will use the system default settings.</p>
                        <p>By default, Oracle Database collects and stores basic statistics about materialized view refresh operations for the entire database. You can disable statistics collection or change the default setting by modifying the statistics collection level. </p>
                        <p>To set the default collection level for materialized view refresh statistics at the database level:</p>
                     </div>
                     <!-- class="section" -->
                     <ul>
                        <li><span>Run the <code class="codeph">DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT</code> procedure and set the <code class="codeph">COLLECTION_LEVEL</code> parameter.</span></li>
                     </ul>
                     <div class="example" id="GUID-D758F3E6-EA01-4F01-BAD9-1D5A0AFD7CB2__GUID-7158C175-C0E3-47BA-B7F3-B6F57DD5196B">
                        <p class="titleinexample">Example 9-1 Setting Materialized View Refresh Statistics Collection Level for the Database</p>
                        <p>This example sets the default collection level for materialized view refresh statistics to ADVANCED indicating that detailed statistics about materialized view refresh operations will be collected and stored.</p><pre class="pre codeblock"><code>DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT ('COLLECTION_LEVEL','ADVANCED');</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-D758F3E6-EA01-4F01-BAD9-1D5A0AFD7CB2__GUID-78AE67B3-91C9-4231-9180-D6803E79A656">
                        <p class="titleinexample">Example 9-2 Disabling Statistics Collection for Materialized View Refresh</p>
                        <p>This example sets the default collection level for materialized view refresh statistics to NONE thereby disabling statistics collection.</p><pre class="pre codeblock"><code>DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT ('COLLECTION_LEVEL','NONE');</code></pre></div>
                     <!-- class="example" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-D758F3E6-EA01-4F01-BAD9-1D5A0AFD7CB2__GUID-5C35513D-94A0-4A24-9493-E593A541108C">
                           <p class="notep1">See Also:</p>
                           <p><a href="../arpls/DBMS_MVIEW_STATS.html#ARPLS-GUID-D52E7FAD-D01A-478F-9861-2C9CDBCB60FF" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-2EF89116-0920-4F5A-8E4B-14C0F7D8B2FD" name="GUID-2EF89116-0920-4F5A-8E4B-14C0F7D8B2FD"></a><h4 id="DWHSG-GUID-2EF89116-0920-4F5A-8E4B-14C0F7D8B2FD" class="sect4"><span class="enumeration_section">9.4.3 </span>Modifying the Collection Level for Materialized View Refresh Statistics
                  </h4>
                  <div>
                     <p>You can modify the settings that manage the collection of materialized view refresh statistics by using the <code class="codeph">DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS</code> procedure. 
                     </p>
                     <div class="section">
                        <p>You can modify the statistics collection behavior either for the entire database or for one or more materialized views. The new collection settings override the default settings made at the database level or previous settings made for the specified materialized views. For example, the system default for <code class="codeph">COLLECTION_LEVEL</code> is set to TYPICAL for the database. You then use the <code class="codeph">DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS</code> procedure to modify the collection level for the materialized views <code class="codeph">MV1</code> and <code class="codeph">MV2</code> to ADVANCED. The remaining materialized views in the database will continue to use the TYPICAL collection level.
                        </p>
                        <p>To modify the collection level for materialized view refresh statistics, either at the database level or materialized view level:</p>
                     </div>
                     <!-- class="section" -->
                     <ul>
                        <li><span>Run the <code class="codeph">DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS</code> procedure and set the <code class="codeph">COLLECTION_LEVEL</code> parameter to the required value</span></li>
                     </ul>
                     <div class="example" id="GUID-2EF89116-0920-4F5A-8E4B-14C0F7D8B2FD__GUID-8F78DA4C-B47F-48FA-B30D-4A659C5D7325">
                        <p class="titleinexample">Example 9-3 Setting the Materialized View Statistics Collection Level for the Entire Database</p>
                        <p>The following example modifies the collection level for materialized view refresh statistics at the database level to TYPICAL. Specifying <code class="codeph">NULL</code> instead of one or more materialized view names indicates that this setting is for the entire database.
                        </p><pre class="pre codeblock"><code>DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS (NULL, 'TYPICAL');</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-2EF89116-0920-4F5A-8E4B-14C0F7D8B2FD__GUID-D7539A66-65BD-4580-842D-57F0C077C113">
                        <p class="titleinexample">Example 9-4 Setting the Materialized View Statistics Collection Level for Multiple Materialized Views</p>
                        <p>This example sets the collection level for the materialized views <code class="codeph">SALES_2013_MV</code> and <code class="codeph">SALES_2014_MV</code> in the <code class="codeph">SH</code> schema to ADVANCED. The retention period is set to 60 days. This setting overrides any default settings that may have been specified at the database level.
                        </p><pre class="pre codeblock"><code>DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS ('SH.SALES_2013_MV, SH.SALES_2014_MV','ADVANCED',60);</code></pre></div>
                     <!-- class="example" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-2EF89116-0920-4F5A-8E4B-14C0F7D8B2FD__GUID-78A9708F-8401-4818-B08D-72BE55B870BA">
                           <p class="notep1">See Also:</p>
                           <p><a href="../arpls/DBMS_MVIEW_STATS.html#ARPLS-GUID-5935488C-CB7F-4C92-A50F-949461F0281D" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-2504FDE4-EE8E-492A-ADA5-15162A909AD9" name="GUID-2504FDE4-EE8E-492A-ADA5-15162A909AD9"></a><h3 id="DWHSG-GUID-2504FDE4-EE8E-492A-ADA5-15162A909AD9" class="sect3"><span class="enumeration_section">9.5 </span>Retaining Materialized View Refresh Statistics
               </h3>
               <div>
                  <p>Oracle Database stores the collected materialized view refresh statistics for a period of time specified by the retention period. </p>
                  <div class="infoboxnotealso" id="GUID-2504FDE4-EE8E-492A-ADA5-15162A909AD9__GUID-CC503E0F-E4B9-4825-9E48-9081865255A3">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-AF606D42-C6DC-4806-8DF3-C8ED3CF3AE04" title="The retention period defines the duration, in days, for which materialized view refresh statistics are stored in the data dictionary. Collected statistics are automatically purged after the retention period is reached.">About Retaining Materialized View Refresh Statistics</a></p>
                        </li>
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-BB9A5914-BEAD-439A-8E53-A8D3F6CC80F9" title="The DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT procedure sets defaults for managing the retention of materialized view refresh statistics at the database level.">Specifying the Default Retention Period for Materialized View Refresh Statistics</a></p>
                        </li>
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-90DC0F87-E772-42E8-9EAB-028B862A4022" title="The DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS procedure enables you to modify the retention period set for materialized view refresh statistics.">Modifying the Retention Period for Materialized View Refresh Statistics</a></p>
                        </li>
                     </ul>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-AF606D42-C6DC-4806-8DF3-C8ED3CF3AE04" name="GUID-AF606D42-C6DC-4806-8DF3-C8ED3CF3AE04"></a><h4 id="DWHSG-GUID-AF606D42-C6DC-4806-8DF3-C8ED3CF3AE04" class="sect4"><span class="enumeration_section">9.5.1 </span>About Retaining Materialized View Refresh Statistics
                  </h4>
                  <div>
                     <p>The retention period defines the duration, in days, for which materialized view refresh statistics are stored in the data dictionary. Collected statistics are automatically purged after the retention period is reached.</p>
                     <p>The retention period for materialized view refresh statistics can be set either at the database level or the materialized view level. The <code class="codeph">RETENTION_PERIOD</code> parameter in <code class="codeph">DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT</code> or <code class="codeph">DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS</code> enables you to specify the duration for which materialized view refresh statistics must be retained in the data dictionary. 
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-BB9A5914-BEAD-439A-8E53-A8D3F6CC80F9" name="GUID-BB9A5914-BEAD-439A-8E53-A8D3F6CC80F9"></a><h4 id="DWHSG-GUID-BB9A5914-BEAD-439A-8E53-A8D3F6CC80F9" class="sect4"><span class="enumeration_section">9.5.2 </span>Specifying the Default Retention Period for Materialized View Refresh Statistics
                  </h4>
                  <div>
                     <p>The <code class="codeph">DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT</code> procedure sets defaults for managing the retention of materialized view refresh statistics at the database level.
                     </p>
                     <div class="section">
                        <p>By default, Oracle Database retains materialized view refresh statistics for 365 days from the date of collection. After the retention period is reached, the statistics are purged from the data dictionary. You can override the system default setting by specifying different settings at the individual materialized view level. Materialized views for which the default settings are not overridden will continue to use the system default settings.</p>
                        <p>You can specify that refresh statistics must never be purged from the database by setting the retention period to -1.</p>
                        <p>To specify a new default retention period for the entire database:</p>
                     </div>
                     <!-- class="section" -->
                     <ul>
                        <li><span>Set the <code class="codeph">RETENTION_PERIOD</code> parameter of the <code class="codeph">DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT</code> procedure to the required number of days</span></li>
                     </ul>
                     <div class="example" id="GUID-BB9A5914-BEAD-439A-8E53-A8D3F6CC80F9__GUID-FE17E445-2519-4725-9370-7302CD275888">
                        <p class="titleinexample">Example 9-5 Setting the Retention Period for Materialized View Refresh Statistics </p>
                        <p>This example sets the default retention period for materialized view refresh statistics for the entire database to 60 days.</p><pre class="pre codeblock"><code>DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT ('RETENTION_PERIOD',60);</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-BB9A5914-BEAD-439A-8E53-A8D3F6CC80F9__GUID-AE6BFFBF-146B-4161-97C1-A237B9A93C08">
                        <p class="titleinexample">Example 9-6 Preventing the Purging of Materialized View Refresh Statistics </p>
                        <p>This example sets the retention period for materialized view refresh statistics to -1 thereby ensuring that refresh statistics are not automatically purged when the default retention period is reached. When you use this setting, refresh statistics will need to be explicitly purged from the data dictionary using the <code class="codeph">DBMS_MVIEW_STATS.PURGE_REFRESH_STATS</code> procedure.
                        </p><pre class="pre codeblock"><code>DBMS_MVIEW_STATS.SET_SYSTEM_DEFAULT ('RETENTION_PERIOD',&#x2013;1);</code></pre></div>
                     <!-- class="example" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-BB9A5914-BEAD-439A-8E53-A8D3F6CC80F9__GUID-C1610700-3801-4B82-B776-588AAE24033C">
                           <p class="notep1">See Also:</p>
                           <p><a href="../arpls/DBMS_MVIEW_STATS.html#ARPLS-GUID-D52E7FAD-D01A-478F-9861-2C9CDBCB60FF" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-90DC0F87-E772-42E8-9EAB-028B862A4022" name="GUID-90DC0F87-E772-42E8-9EAB-028B862A4022"></a><h4 id="DWHSG-GUID-90DC0F87-E772-42E8-9EAB-028B862A4022" class="sect4"><span class="enumeration_section">9.5.3 </span>Modifying the Retention Period for Materialized View Refresh Statistics
                  </h4>
                  <div>
                     <p>The <code class="codeph">DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS</code> procedure enables you to modify the retention period set for materialized view refresh statistics. 
                     </p>
                     <div class="section">
                        <p>You can modify the retention period either for the entire database or for one or more materialized views. When you modify the retention period only for specific materialized views, the remaining materialized views in the database continue to use their existing retention period. </p>
                        <p>Suppose that your system default setting is to collect basic materialized view refresh statistics and retain them for 60 days. However, for a particular set of materialized views, you want to collect detailed statistics and retain these statistics for 45 days. In this case, for the specific set of materialized views, you set <code class="codeph">COLLECTION_LEVEL</code> to ADVANCED and <code class="codeph">RETENTION_PERIOD</code> to 45.
                        </p>
                        <p>To modify the retention period for materialized view refresh statistics either at the database level to materialized view level:</p>
                     </div>
                     <!-- class="section" -->
                     <ul>
                        <li><span>Run the <code class="codeph">DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS</code> procedure and set the<code class="codeph"> RETENTION_PERIOD</code> parameter to the required value</span></li>
                     </ul>
                     <div class="example" id="GUID-90DC0F87-E772-42E8-9EAB-028B862A4022__GUID-A3231911-A53A-4D26-8D3D-8686E27B23BD">
                        <p class="titleinexample">Example 9-7 Using Default Materialized View Refresh Statistics Settings for Retention Period</p>
                        <p>This example sets the collection level for the materialized view <code class="codeph">SALES_MV</code> in the <code class="codeph">SH</code> schema to TYPICAL. Since NULL is used for the retention period, the system-wide default setting for retention period is used for this materialized view.
                        </p><pre class="pre codeblock"><code>DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS ('SH.SALES_MV','TYPICAL',NULL);</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-90DC0F87-E772-42E8-9EAB-028B862A4022__GUID-B8DD3B77-C0BF-4E6D-8B37-54CE21079544">
                        <p class="titleinexample">Example 9-8 Setting the Retention Period for a Materialized View</p>
                        <p>This example sets the collection level for the <code class="codeph">SH.SALES_MV</code> to ADVANCED and the retention period to 45 days. This overrides the existing retention period set for this materialized view.
                        </p><pre class="pre codeblock"><code>DBMS_MVIEW_STATS.SET_MVREF_STATS_PARAMS ('SH.SALES_MV','ADVANCED',45);</code></pre></div>
                     <!-- class="example" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-90DC0F87-E772-42E8-9EAB-028B862A4022__GUID-AA77B255-ABE8-4E8D-A17A-30E3A4976EAD">
                           <p class="notep1">See Also:</p>
                           <p><a href="../arpls/DBMS_MVIEW_STATS.html#ARPLS-GUID-5935488C-CB7F-4C92-A50F-949461F0281D" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-D4D01309-4ACA-426B-8F33-75E9FB8DF838" name="GUID-D4D01309-4ACA-426B-8F33-75E9FB8DF838"></a><h3 id="DWHSG-GUID-D4D01309-4ACA-426B-8F33-75E9FB8DF838" class="sect3"><span class="enumeration_section">9.6 </span>Viewing Materialized View Refresh Statistics Settings
               </h3>
               <div>
                  <p>Data dictionary views store both the default settings and materialized view-specific settings that manage materialized view refresh statistics.</p>
                  <div class="section">
                     <p>To view the database-level default settings for collecting and retaining materialized view refresh statistics:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Query the <code class="codeph">parameter_name</code> and <code class="codeph">value</code> columns in the <code class="codeph">DBA_MVREF_STATS_SYS_DEFAULTS</code> view
                           </p>
                        </li>
                     </ul>
                     <p>To view the collection and retention settings for refresh statistics of one or more materialized views:</p>
                  </div>
                  <!-- class="section" -->
                  <ul>
                     <li><span>Query the <code class="codeph">parameter_name</code> and <code class="codeph">value</code> columns in the <code class="codeph">DBA_MVREF_STATS_PARAMS</code> view by filtering data using the <code class="codeph">mv_owner</code> and <code class="codeph">mv_name</code> columns</span></li>
                  </ul>
                  <div class="example" id="GUID-D4D01309-4ACA-426B-8F33-75E9FB8DF838__GUID-EC5AF9DE-24FF-45BC-804B-27F6431783BB">
                     <p class="titleinexample">Example 9-9 Displaying the Database-level Default Settings for Managing Materialized View Refresh Statistics</p>
                     <p>The following query displays the database level default settings for managing materialized view refresh statistics:</p><pre class="pre codeblock"><code>SELECT parameter_name, value from DBA_MVREF_STATS_SYS_DEFAULTS;

PARAMETER_NAME			VALUE
---------------			--------
COLLECTION_LEVEL		TYPICAL
RETENTION_PERIOD		45
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-D4D01309-4ACA-426B-8F33-75E9FB8DF838__GUID-B0C54C69-CA6A-465D-A66E-152013CC832A">
                     <p class="titleinexample">Example 9-10 Displaying the Refresh Statistics Settings for a Set of Materialized Views</p>
                     <p>The following query displays the refresh statistics settings for all the materialized view owned by the <code class="codeph">SH</code> schema:
                     </p><pre class="pre codeblock"><code>SELECT mv_name,collection_level,retention_period 
FROM DBA_MVREF_STATS_PARAMS 
WHERE mv_owner = 'SH';

MV_NAME			COLLECTION_LEVEL	RETENTION_PERIOD
--------		----------------	-----------------
MY_RTMV             	ADVANCED              	60
NEW_SALES_RTMV      	ADVANCED              	45
MY_SUM_SALES_RTMV   	TYPICAL               	31
SALES_RTMV          	TYPICAL               	-1
CAL_MONTH_SALES_MV  	TYPICAL               	45

5 rows selected.
</code></pre></div>
                  <!-- class="example" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-B4215657-7526-4C64-AB27-B906EBA28A00" name="GUID-B4215657-7526-4C64-AB27-B906EBA28A00"></a><h3 id="DWHSG-GUID-B4215657-7526-4C64-AB27-B906EBA28A00" class="sect3"><span class="enumeration_section">9.7 </span>Purging Materialized View Refresh Statistics
               </h3>
               <div>
                  <p>The <code class="codeph">DBMS_MVIEW_STATS.PURGE_REFRESH_STATS</code> procedure enables you to explicitly purge materialized view refresh statistics that are older than a specified period from the data dictionary.
                  </p>
                  <div class="section">
                     <p>By default, materialized view refresh statistics are removed from the data dictionary after the specified retention period. Depending on your settings, the purging may be performed for the entire database or for a set of specified materialized views. You can use the <code class="codeph">DBMS_MVIEW_STATS.PURGE_REFRESH_STATS</code> procedure to explicitly purge refresh statistics that are older than a specified time without altering the set retention period. Explicit purging of refresh statistics overrides the current setting for retention period but does not alter the setting.
                     </p>
                     <p>To purge materialized view refresh statistics stored in the database:</p>
                  </div>
                  <!-- class="section" -->
                  <ul>
                     <li class="stepexpand"><span>Run the <code class="codeph">DBMS_MVIEW_STATS.PURGE_REFRESH_STATS</code> procedure.</span><div>
                           <p>Specify the materialized views for which statistics must be purged and the duration beyond which statistics must be purged.</p>
                        </div>
                     </li>
                  </ul>
                  <div class="example" id="GUID-B4215657-7526-4C64-AB27-B906EBA28A00__GUID-AD82C52D-3A2B-4941-ACF6-7E7CF216B0FE">
                     <p class="titleinexample">Example 9-11 Purging Refresh Statistics for a Materialized View</p>
                     <p>Assume that the retention period for refresh statistics of the materialized view <code class="codeph">SALES_MV</code> is 60 days. At any given time, the refresh statistics for the previous 60 days are available. However, because of space constraints, you want to purge the statistics for the last 30 days. Use the <code class="codeph">DBMS_MVIEW_STATS.PURGE_REFRESH_STATS</code> procedure to do this.
                     </p>
                     <p>Note that the retention period set for <code class="codeph">SALES_MV</code> remains unaltered. The purge is a one-time operation.
                     </p><pre class="pre codeblock"><code>DBMS_MVIEW_STATS.PURGE_REFRESH_STATS (’SH.SALES_MV’,30);</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-B4215657-7526-4C64-AB27-B906EBA28A00__GUID-2238A186-E776-4CF3-977E-CF35DAF60A0C">
                     <p class="titleinexample">Example 9-12 Purging Refresh Statistics for All Materialized Views</p>
                     <p>This example purges materialized view refresh statistics that are older than 20 days for all materialized views in the database. Specifying <code class="codeph">NULL</code> instead of one or more materialized views indicates that this setting is for the entire database.
                     </p><pre class="pre codeblock"><code>DBMS_MVIEW_STATS.PURGE_REFRESH_STATS (NULL,20);</code></pre></div>
                  <!-- class="example" -->
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-B4215657-7526-4C64-AB27-B906EBA28A00__GUID-2CB525B3-B7CA-47F8-935B-B045401B23DD">
                        <p class="notep1">See Also:</p>
                        <p><a href="../arpls/DBMS_MVIEW_STATS.html#ARPLS-GUID-3BA6F833-24CA-432D-8B62-56A020606676" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a></p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-8F9CC2EC-9CFC-4F56-97D5-5EB099BD852A" name="GUID-8F9CC2EC-9CFC-4F56-97D5-5EB099BD852A"></a><h3 id="DWHSG-GUID-8F9CC2EC-9CFC-4F56-97D5-5EB099BD852A" class="sect3"><span class="enumeration_section">9.8 </span>Viewing Materialized View Refresh Statistics
               </h3>
               <div>
                  <p>You can view both current and historical statistics for materialized view refresh operations by querying the data dictionary views that store refresh statistics.</p>
                  <p>Depending on the collection level setting, materialized view refresh statistics are stored in one or more of the following views: <code class="codeph">DBA_MVREFS_STATS</code>, <code class="codeph">DBA_MVREF_RUN_STATS</code>, <code class="codeph">DBA_MVREF_CHANGE_STATS</code>, and <code class="codeph">DBA_MVREF_STMT_STATS</code>. There are corresponding <code class="codeph">USER_</code> versions for all these views. The views contain a <code class="codeph">REFRESH_ID</code> column that can be used to join one or more views, when required.
                  </p>
                  <div class="infoboxnotealso" id="GUID-8F9CC2EC-9CFC-4F56-97D5-5EB099BD852A__GUID-76D259BF-9B81-4A13-96C6-79623F32C2AC">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-681103A3-996F-4862-A9D3-2EA8D0269BA4" title="Use the DBA_MVREF_STATS view to display basic statistics about materialized view refresh operations.">Viewing Basic Refresh Statistics for a Materialized View</a></p>
                        </li>
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-7F2FF444-7FFD-4F2A-8D04-CBE7CD2EB04E" title="The DBA_MVREF_RUN_STATS view stores detailed statistics about materialized view refresh operation. When a refresh operation affects multiple materialized views, detailed statistics are available for all affected materialized views.">Viewing Detailed Statistics for Each Materialized View Refresh Operation</a></p>
                        </li>
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-D3C9BA73-E6DE-4135-AAE9-414103D4C715" title="The DBA_MVREF_CHANGE_STATS view stores detailed change data statistics for materialized view refresh operations. This includes the base tables that were refreshed, the number of rows inserted, number of rows updated, number of rows deleted, and partition maintenance operations (PMOPs) details.">Viewing Change Data Statistics During Materialized View Refresh Operations</a></p>
                        </li>
                        <li>
                           <p><a href="monitoring-materialized-view-refresh.html#GUID-BD3E19B7-0F73-466D-87A7-7D477D55DBBA" title="Query the DBA_MVREF_STMT_STATS view to display information about all the SQL statements used in a materialized view refresh operation.">Viewing the SQL Statements Associated with A Materialized View Refresh Operation</a></p>
                        </li>
                     </ul>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-681103A3-996F-4862-A9D3-2EA8D0269BA4" name="GUID-681103A3-996F-4862-A9D3-2EA8D0269BA4"></a><h4 id="DWHSG-GUID-681103A3-996F-4862-A9D3-2EA8D0269BA4" class="sect4"><span class="enumeration_section">9.8.1 </span>Viewing Basic Refresh Statistics for a Materialized View
                  </h4>
                  <div>
                     <p>Use the <code class="codeph">DBA_MVREF_STATS</code> view to display basic statistics about materialized view refresh operations.
                     </p>
                     <div class="section">
                        <p>Each materialized view refresh operation is identified using a unique refresh ID. The <code class="codeph">DBA_MVREF_STATS</code> view stores the refresh ID, refresh method, names of materialized views refreshed, basic execution times, and the number of steps in the refresh operation.
                        </p>
                        <p>To view basic refresh statistics for materialized view refresh operations:</p>
                     </div>
                     <!-- class="section" -->
                     <ul>
                        <li><span>Query the <code class="codeph">DBA_MVREF_STATS</code> view with list of required columns and use conditions to filter the required data</span></li>
                     </ul>
                     <div class="example" id="GUID-681103A3-996F-4862-A9D3-2EA8D0269BA4__GUID-12BCEE5D-106E-44C7-921D-F872D0E99B37">
                        <p class="titleinexample">Example 9-13 Displaying Basic Statistics for a Materialized View Refresh Operation</p>
                        <p>The following query displays some refresh statistics for refresh operations on the <code class="codeph">SH.NEW_SALES_RTMV</code> materialized view. Information includes the refresh method, refresh time, number of rows in the materialized view at the start of the refresh operation, and number of rows at the end of the refresh operation.
                        </p><pre class="pre codeblock"><code>SELECT refresh_id, refresh_method, elapsed_time, initial_num_rows, final_num_rows
FROM dba_mvref_stats
WHERE mv_name = 'NEW_SALES_RTMV' and mv_owner = 'SH';

REFRESH_ID    REFRESH_METHOD    ELAPSED_TIME    INITIAL_NUM_ROWS    FINAL_NUM_ROWS
----------    --------------    -------------   ----------------    ----------------
49            FAST              0               766                 788
61            FAST              1               788                 788
81            FAST              1               788                 798

3 rows selected.
</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-681103A3-996F-4862-A9D3-2EA8D0269BA4__GUID-42C5604F-91CE-48C4-A7E1-5F823855A2E3">
                        <p class="titleinexample">Example 9-14 Displaying Materialized Views Based on their Refresh Times</p>
                        <p>The following example displays the names of materialized views whose refresh operations took more than 10 minutes. Since <code class="codeph">elapsed_time</code> is specified in seconds, we use 600 in the query.
                        </p><pre class="pre codeblock"><code>SELECT mv_owner, mv_name, refresh_method
FROM dba_mvref_stats
WHERE elapsed_time &gt; 600;

</code></pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-7F2FF444-7FFD-4F2A-8D04-CBE7CD2EB04E" name="GUID-7F2FF444-7FFD-4F2A-8D04-CBE7CD2EB04E"></a><h4 id="DWHSG-GUID-7F2FF444-7FFD-4F2A-8D04-CBE7CD2EB04E" class="sect4"><span class="enumeration_section">9.8.2 </span>Viewing Detailed Statistics for Each Materialized View Refresh Operation
                  </h4>
                  <div>
                     <p>The <code class="codeph">DBA_MVREF_RUN_STATS</code> view stores detailed statistics about materialized view refresh operation. When a refresh operation affects multiple materialized views, detailed statistics are available for all affected materialized views.
                     </p>
                     <div class="section">
                        <p>Materialized views can be refreshed using one of the following procedures in the <code class="codeph">DBMS_MVIEW</code> package: <code class="codeph">REFRESH</code>, <code class="codeph">REFRESH_DEPENDENT</code>, or <code class="codeph">REFRESH_ALL</code>. Each procedure contains different parameters that specify how the refresh must be performed. The<code class="codeph"> DBA_MVREF_RUN_STATS</code> view contains information about the parameters specified for the refresh operation, the number of materialized views refreshed, execution times, and log purge time. 
                        </p>
                        <p>To view detailed refresh statistics for materialized view refresh operations:</p>
                     </div>
                     <!-- class="section" -->
                     <ul>
                        <li><span>Query the <code class="codeph">DBA_MVREF_RUN_STATS</code> view with the list of required columns and use conditions to filter the required data</span></li>
                     </ul>
                     <div class="example" id="GUID-7F2FF444-7FFD-4F2A-8D04-CBE7CD2EB04E__GUID-F1CDF6BC-4553-4F9F-87B2-1DBCFF191951">
                        <p class="titleinexample">Example 9-15 Listing All Materialized Views Refreshed in a Single Refresh Operation</p>
                        <p>The following example displays the materialized views and refresh times for materialized views that were refreshed as part of the specified refresh ID.</p><pre class="pre codeblock"><code>SELECT mviews, elapsed_time, complete_stats_available
FROM dba_mvref_run_stats
WHERE refresh_id = 100;

MVIEWS              ELAPSED_TIME      COMPLETE_STATS_AVAIALBE
--------            ------------      -------------------------
"SH"."SALES_RTMV"   1                 Y</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-7F2FF444-7FFD-4F2A-8D04-CBE7CD2EB04E__GUID-374ADC11-8CB0-403E-87CD-19B155BDFF9A">
                        <p class="titleinexample">Example 9-16 Viewing the Parameters Specified During a Materialized View Refresh Operation</p>
                        <p>The following example displays the list of refreshed materialized views and some of the parameters specified during the refresh operation for refresh ID 81.</p><pre class="pre codeblock"><code>SELECT mviews, refresh_after_errors, purge_option, parallelism, nested
FROM dba_mvref_run_stats
WHERE run_owner = 'SH' and refresh_id=81;

MVIEWS              	R     PURGE_OPTION    PARALLELISM   NESTED
------              	-     ------------    ------------  -------
"SH"."SALES_RTMV"	N	1		0	N</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-7F2FF444-7FFD-4F2A-8D04-CBE7CD2EB04E__GUID-35F5556C-A8B3-4171-8ECF-D1C854770F67">
                        <p class="titleinexample">Example 9-17 Displaying Detailed Statistics for a Materialized View Refresh Operation</p>
                        <p>The following example displays detailed statistics for the refresh operation with refresh ID 156. The details include the number of materialized views refreshed, the owner and names of materialized views, and the time taken for the refresh.</p><pre class="pre codeblock"><code>SELECT num_mvs, mv_owner, mv_name, r.elapsed_time
FROM dba_mvref_stats s, dba_mvref_run_stats r
WHERE s.refresh_id = r.refresh_id and refresh_id = 156;

NUM_MVS     MV_OWNER    MV_NAME			ELAPSED_TIME
--------    --------    --------		-----------
1           SH          SALES_RTMV		5</code></pre></div>
                     <!-- class="example" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-7F2FF444-7FFD-4F2A-8D04-CBE7CD2EB04E__GUID-A813D2DA-DDEF-4229-87DB-E13B759ECECB">
                           <p class="notep1">See Also:</p>
                           <p><a href="../refrn/DBA_MVREF_RUN_STATS.html#REFRN-GUID-A078FAB9-BE12-42BF-811C-D6E2EEF5A952" target="_blank"><span><cite>Oracle Database Reference</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-D3C9BA73-E6DE-4135-AAE9-414103D4C715" name="GUID-D3C9BA73-E6DE-4135-AAE9-414103D4C715"></a><h4 id="DWHSG-GUID-D3C9BA73-E6DE-4135-AAE9-414103D4C715" class="sect4"><span class="enumeration_section">9.8.3 </span>Viewing Change Data Statistics During Materialized View Refresh Operations
                  </h4>
                  <div>
                     <p>The <code class="codeph">DBA_MVREF_CHANGE_STATS</code> view stores detailed change data statistics for materialized view refresh operations. This includes the base tables that were refreshed, the number of rows inserted, number of rows updated, number of rows deleted, and partition maintenance operations (PMOPs) details.
                     </p>
                     <div class="section">
                        <p>You can join the <code class="codeph">DBA_MVREF_CHANGE_STATS</code> view with other views that contain materialized view refresh statistics to provide more complete statistics.
                        </p>
                        <p>To view detailed change data statistics for materialized view refresh operations:</p>
                     </div>
                     <!-- class="section" -->
                     <ul>
                        <li><span>Query the <code class="codeph">DBA_MVREF_CHANGE_STATS</code> view with the list of required columns and use conditions to filter the required data</span></li>
                     </ul>
                     <div class="example" id="GUID-D3C9BA73-E6DE-4135-AAE9-414103D4C715__GUID-160B85F7-321E-4B01-960F-ABD6BCD970D5">
                        <p class="titleinexample">Example 9-18 Determining if a Refresh Operation Resulted in PMOPs</p>
                        <p>The following example displays the base table names and PMOP details for the refresh operation with refresh ID 1876. The query output contains one record for each base table of the materialized view.</p><pre class="pre codeblock"><code>SELECT tbl_name, mv_name, pmops_occurred, pmop_details
FROM dba_mvref_change_stats
WHERE refresh_id =1876;

TBL_NAME      MV_NAME     PMOPS_OCCURRED    PMOP_DETAILS
---------     --------    --------------    ------------
MY_SALES      SALES_RTMV    N	
</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-D3C9BA73-E6DE-4135-AAE9-414103D4C715__GUID-9C6F5423-42D1-4813-8817-35BE1F5D31A7">
                        <p class="titleinexample">Example 9-19 Displaying the Number of Rows Modified During a Refresh Operation</p>
                        <p>This example displays the following details about each base table in a refresh operation on the <code class="codeph">SH.MY_SALES</code> materialized view: number of rows in the tables, number of rows inserted, number of rows updates, number of rows deleted, number of direct load inserts, and details of PMOP operations.
                        </p><pre class="pre codeblock"><code>SELECT tbl_name, num_rows, num_rows_ins, num_rows_upd, num_rows_del, num_rows_dl_ins, pmops_occurred, pmop_details
FROM dba_mvref_change_stats
WHERE mv_name = 'MY_SALES' and mv_owner = 'SH';
</code></pre></div>
                     <!-- class="example" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-D3C9BA73-E6DE-4135-AAE9-414103D4C715__GUID-2A186927-B7AB-47C8-9F3C-747D008B0531">
                           <p class="notep1">See Also:</p>
                           <p><a href="../refrn/DBA_MVREF_CHANGE_STATS.html#REFRN-GUID-1343FE59-366F-4F2D-A539-51BEE0D8B204" target="_blank"><span><cite>Oracle Database Reference</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-BD3E19B7-0F73-466D-87A7-7D477D55DBBA" name="GUID-BD3E19B7-0F73-466D-87A7-7D477D55DBBA"></a><h4 id="DWHSG-GUID-BD3E19B7-0F73-466D-87A7-7D477D55DBBA" class="sect4"><span class="enumeration_section">9.8.4 </span>Viewing the SQL Statements Associated with A Materialized View Refresh Operation
                  </h4>
                  <div>
                     <p>Query the <code class="codeph">DBA_MVREF_STMT_STATS</code> view to display information about all the SQL statements used in a materialized view refresh operation.
                     </p>
                     <div class="section">
                        <p>Each refresh operation can consist of multiple steps, each of which is performed using a SQL statement. For each step in a refresh operation, you can view the step number and the SQL statement. </p>
                        <p>To view the SQL statements associated with materialized view refresh operations:</p>
                     </div>
                     <!-- class="section" -->
                     <ul>
                        <li><span>Query the <code class="codeph">DBA_MVREF_STMT_STATS</code> view with the list of required columns and use conditions to filter the required data</span></li>
                     </ul>
                     <div class="example" id="GUID-BD3E19B7-0F73-466D-87A7-7D477D55DBBA__GUID-8377ED79-FFA2-4A6B-BF0C-A5E5321B359B">
                        <p class="titleinexample">Example 9-20 Displaying SQL Statements for Each Step in a Refresh Operation</p>
                        <p>The following example displays the materialized view names, SQL statements used to refresh the materialized view, and execution time for the materialized view refresh operation with refresh ID is 1278.</p><pre class="pre codeblock"><code>SELECT mv_name, step, stmt, execution_time
FROM dba_mvref_stmt_stats
WHERE refresh_id = 1278;
</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-BD3E19B7-0F73-466D-87A7-7D477D55DBBA__GUID-1A22FAFB-7B46-42E1-9EFC-7E426E5F568F">
                        <p class="titleinexample">Example 9-21 Displaying Refresh Statements Used in the Current Refresh of an Materialized View</p>
                        <p>This example displays the individual SQL statements that are used to the refresh the <code class="codeph">MY_SALES</code> materialized view. A single refresh operation may consist of multiple steps, each of which executes a SQL statement. The details displayed in this example include the step number, SQL ID of the SQL statement, the SQL statement that is executed, and the execution time for the SQL statement.
                        </p><pre class="pre codeblock"><code>SELECT step, sqlid, stmt, execution_time
FROM DBA_MVREF_STATS M, DBA_MVREF_STMT_STATS S
WHERE M.refresh_id = S.refresh_id and M.mv_name = 'MY_SALES'
ORDER BY step;
</code></pre></div>
                     <!-- class="example" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-BD3E19B7-0F73-466D-87A7-7D477D55DBBA__GUID-36B5AE3F-9662-436C-9ED1-996E5F2114D7">
                           <p class="notep1">See Also:</p>
                           <p><a href="../refrn/DBA_MVREF_STMT_STATS.html#REFRN-GUID-A1C15C62-A01B-4727-B3BF-9D73568EE552" target="_blank"><span><cite>Oracle Database Reference</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-D87F8F81-8B93-4D7E-87F5-3BFEAA2A7C06" name="GUID-D87F8F81-8B93-4D7E-87F5-3BFEAA2A7C06"></a><h3 id="DWHSG-GUID-D87F8F81-8B93-4D7E-87F5-3BFEAA2A7C06" class="sect3"><span class="enumeration_section">9.9 </span>Analyzing Materialized View Refresh Performance Using Refresh Statistics
               </h3>
               <div>
                  <p>Materialized view refresh statistics that are stored in data dictionary views can be used to analyze the refresh performance of materialized views.</p>
                  <div class="section">
                     <p>Refresh statistics provide detailed information that enables you to understand and analyze materialized view refresh operations and their performance. Typically, you analyze refresh statistics for critical or long running materialized view refresh operations. If a materialized view takes longer to refresh than it does normally, then you can analyze its past refresh times and change data to identify any differences that may account for the increased time (for example, 5 times more data that needs to be refreshed this time). </p>
                     <p><span class="bold">To analyze materialized view refresh performance:</span></p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>Set the collection level and retention period for the materialized view to collect refresh statistics over a period of time.</span><div>You can set these at the database level or at the materialized view level.</div>
                     </li>
                     <li class="stepexpand"><span>Identify the materialized views whose refresh performance needs to be analyzed.</span><div>Typically, you would be interested in analyzing the refresh performance of a specific set of materialized views in the database. In this case, you can modify the refresh statistics settings for these materialized views as per your requirement.</div>
                     </li>
                     <li class="stepexpand"><span>Where multiple refresh operations take place over a period of time (for the materialized views you want to analyze), Oracle Database collects the desired refresh statistics. </span></li>
                     <li class="stepexpand"><span>Query the data dictionary views that store refresh statistics and analyze the refresh behavior of materialized views of interest over time to understand refresh behavior.</span><div>The database stores both historical and current statistics which can be analyzed to understand refresh behavior.</div>
                     </li>
                  </ol>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>