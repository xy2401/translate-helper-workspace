<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="You can configure a PDB snapshot carousel for a specified PDB, create snapshots manually or automatically, and set the maximum number of snapshots.">
      <meta name="description" content="You can configure a PDB snapshot carousel for a specified PDB, create snapshots manually or automatically, and set the maximum number of snapshots.">
      <title>Administering a PDB Snapshot Carousel</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Administrator’s Guide ">
      <meta property="og:description" content="You can configure a PDB snapshot carousel for a specified PDB, create snapshots manually or automatically, and set the maximum number of snapshots.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Administrator’s Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="multitenant-administrators-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-03-20T09:59:22-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="2017, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96136-03">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="administering-pdbs-with-sql-plus.html" title="Previous" type="text/html">
      <link rel="next" href="administering-application-containers-with-sql-plus.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Multitenant Administrator's Guide">
    <meta name="dcterms.isVersionOf" content="MULTI">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="administering-pdbs-with-sql-plus.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="administering-application-containers-with-sql-plus.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Administrator’s Guide </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="managing-a-multitenant-environment.html" property="item" typeof="WebPage"><span property="name">Administering a Multitenant Environment</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Administering a PDB Snapshot Carousel</li>
            </ol>
            <a id="GUID-FF6DF540-0C22-451C-80B3-1ACA8C8CB7D2" name="GUID-FF6DF540-0C22-451C-80B3-1ACA8C8CB7D2"></a>
            
            <h2 id="MULTI-GUID-FF6DF540-0C22-451C-80B3-1ACA8C8CB7D2" class="sect2"><span class="enumeration_chapter">16 </span>Administering a <span>PDB Snapshot Carousel</span></h2>
         </header>
         <div class="ind">
            <div>
               <p>You can configure a <span>PDB snapshot carousel</span> for a specified PDB, create snapshots manually or automatically, and set the maximum number of snapshots.
               </p>
               <p>This section contains the following topics:</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="administering-pdb-snapshots.html#GUID-72CA6DD5-4DE5-4375-BEA6-A01E5E31A01B">About PDB Snapshot Carousel</a><br><span>A PDB snapshot carousel is a library of PDB snapshots.</span>  
                  </li>
                  <li class="ulchildlink"><a href="administering-pdb-snapshots.html#GUID-B6A785B6-42F2-4027-9DA5-6FA1164CCC5C">Setting the Maximum Number of Snapshots in a PDB Snapshot Carousel</a><br>You can set the maximum number of PDB snapshots for a PDB.
                  </li>
                  <li class="ulchildlink"><a href="administering-pdb-snapshots.html#GUID-82BCCB60-4A6F-4687-BD16-64A5FE767FB5">Configuring Automatic PDB Snapshots</a><br>Configure a PDB for automatic snapshots by using the <code class="codeph">SNAPSHOT MODE EVERY</code> clause when creating or altering a PDB.
                  </li>
                  <li class="ulchildlink"><a href="administering-pdb-snapshots.html#GUID-FBF77C07-9B40-4BF3-8C7D-61C8F11E2B14">Creating PDB Snapshots Manually</a><br>To create a PDB snapshot manually, specify the <code class="codeph">SNAPSHOT <span class="codeinlineitalic">snapshot_name</span></code> clause in <code class="codeph">ALTER PLUGGABLE DATABASE</code> or <code class="codeph">CREATE PLUGGABLE DATABASE</code>.
                  </li>
                  <li class="ulchildlink"><a href="administering-pdb-snapshots.html#GUID-9E7D3176-9504-429D-895F-A3D60028FE5A">Dropping a PDB Snapshot</a><br>You can drop a PDB snapshot by running an <code class="codeph">ALTER PLUGGABLE DATABASE</code> statement with the <code class="codeph">DROP SNAPSHOT</code> clause.
                  </li>
                  <li class="ulchildlink"><a href="administering-pdb-snapshots.html#GUID-87CB7869-5A15-456F-90B8-361A0D06D8AF">Viewing Metadata for PDB Snapshots</a><br>The data dictionary views <code class="codeph">DBA_PDB_SNAPSHOTS</code> and <code class="codeph">DBA_PDB_SNAPSHOTFILE</code> show the metadata for PDB snapshots.
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>Parent topic:</strong> <a href="managing-a-multitenant-environment.html#GUID-93F1E584-D309-4301-82E0-AD0E60D4977C" title="You can administer a multitenant environment using SQL*Plus or Enterprise Manager Cloud Control (Cloud Control).">Administering a Multitenant Environment</a></p>
                  </div>
               </div>
            </div>
            
            <div class="sect2"><a id="GUID-72CA6DD5-4DE5-4375-BEA6-A01E5E31A01B" name="GUID-72CA6DD5-4DE5-4375-BEA6-A01E5E31A01B"></a><h3 id="MULTI-GUID-72CA6DD5-4DE5-4375-BEA6-A01E5E31A01B" class="sect3"><span class="enumeration_section">16.1 </span>About <span>PDB Snapshot Carousel</span></h3>
               <div>
                  <p><span>A PDB snapshot carousel is a library of PDB snapshots.</span>  
                  </p>
                  <p><span><span id="GUID-72CA6DD5-4DE5-4375-BEA6-A01E5E31A01B__d5e1624">A <strong class="term">PDB snapshot</strong> is a point-in-time copy of a PDB.</span> You can create snapshots manually using the <code class="codeph">SNAPSHOT</code> clause of <code class="codeph">CREATE PLUGGABLE DATABASE</code> (or <code class="codeph">ALTER PLUGGABLE DATABASE</code>), or automatically using the <code class="codeph">EVERY <span class="codeinlineitalic">interval</span></code> clause.</span></p>
                  <p>Starting in <span>Oracle Database 19c</span>, you can make snapshots of source PDBs in read/write mode. The content of a PDB snapshot depends on the setting of the <code class="codeph">CLONEDB</code> initialization parameter when the snapshot is created. When <code class="codeph">CLONEDB</code> is <code class="codeph">TRUE</code>, the snapshot is a sparse copy of the PDB data files. When <code class="codeph">CLONEDB</code> is <code class="codeph">FALSE</code>, the snapshot is a full copy of the PDB files.
                  </p>
                  <p>This section contains the following topics:</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="administering-pdb-snapshots.html#GUID-87183462-C87C-432C-BE7E-282B1F1202F4">Purpose of PDB Snapshot Carousel</a><br>A <span>PDB snapshot carousel</span> is a useful way of maintaining a library of recent PDB copies for point-in-time recovery and cloning.
                     </li>
                     <li class="ulchildlink"><a href="administering-pdb-snapshots.html#GUID-F2FC2FCB-2DA2-43B5-B98D-8902BC8D66A6">How PDB Snapshot Carousel Works</a><br>The carousel for a specific PDB is a circular library of copies for this PDB. 
                     </li>
                     <li class="ulchildlink"><a href="administering-pdb-snapshots.html#GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF">User Interface for PDB Snapshot Carousel</a><br>The <code class="codeph">SNAPSHOT MODE</code> clause controls creation of snapshots, and determines whether creation is manual, automatic, or disabled.
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-72CA6DD5-4DE5-4375-BEA6-A01E5E31A01B__GUID-2B838C1E-DA59-4675-96E2-789D15689B03">
                     <p class="notep1">See Also:</p>
                     <p><span><a href="../dblic/Licensing-Information.html#DBLIC-GUID-0F9EB85D-4610-4EDF-89C2-4916A0E7AC87" target="_blank"><span><cite>Oracle Database Licensing Information User Manual</cite></span></a> for details on which features are supported for different editions and services</span></p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="administering-pdb-snapshots.html#GUID-FF6DF540-0C22-451C-80B3-1ACA8C8CB7D2" title="You can configure a PDB snapshot carousel for a specified PDB, create snapshots manually or automatically, and set the maximum number of snapshots.">Administering a PDB Snapshot Carousel</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-87183462-C87C-432C-BE7E-282B1F1202F4" name="GUID-87183462-C87C-432C-BE7E-282B1F1202F4"></a><h4 id="MULTI-GUID-87183462-C87C-432C-BE7E-282B1F1202F4" class="sect4"><span class="enumeration_section">16.1.1 </span>Purpose of <span>PDB Snapshot Carousel</span></h4>
                  <div>
                     <p>A <span>PDB snapshot carousel</span> is a useful way of maintaining a library of recent PDB copies for point-in-time recovery and cloning.
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-87183462-C87C-432C-BE7E-282B1F1202F4__GUID-F75B3C72-B251-470D-8417-97D0AD782A84">Cloning PDBs for Development and Testing</p>
                        <p>In a typical development use case, you clone a production PDB for testing. When the CDB is in <code class="codeph">ARCHIVELOG</code> mode and local undo mode, the source production PDB can be opened in read/write mode and fully functional during the operation. This technique is known as <strong class="term">hot cloning</strong>. The hot clone is transactionally consistent with the source PDB as of the SCN at the completion of the <code class="codeph">ALTER PLUGGABLE DATABASE ... OPEN</code> statement.
                        </p>
                        <p>For example, while the production PDB named <code class="codeph">pdb1_prod</code> is open and in use, you create a refreshable clone named <code class="codeph">pdb1_test_master</code>. You then configure <code class="codeph">pdb1_test_master</code> to create automatic snapshots every day. When you need new PDBs for testing, create a full clone of any PDB snapshot, and then create sparse clones using <code class="codeph">CREATE PLUGGABLE DATABASE ... SNAPSHOT COPY</code>. 
                        </p>
                        <p>The following figure shows the creation of the clone <code class="codeph">pdb1_test_full1</code> from the PDB snapshot taken on April 5. The figure shows three snapshot copy PDBs created from <code class="codeph">pdb1_test_full1</code>.
                        </p>
                        <div class="figure" id="GUID-87183462-C87C-432C-BE7E-282B1F1202F4__GUID-BE4DAD25-D140-43DD-8BE8-E02A30BA6433">
                           <p class="titleinfigure">Figure 16-1 Automatic Snapshots of a Refreshable Clone PDB</p><img src="img/multi_pb_001a1.png" alt="Description of Figure 16-1 follows" title="Description of Figure 16-1 follows" longdesc="img_text/multi_pb_001a1.html"><br><a href="img_text/multi_pb_001a1.html">Description of "Figure 16-1 Automatic Snapshots of a Refreshable Clone PDB"</a></div>
                        <!-- class="figure" -->
                        <p>Starting in Oracle Database 19c, when the <code class="codeph">CLONEDB</code> initialization parameter is <code class="codeph">TRUE</code>, you can create sparse, database-managed snapshots of a read/write PDB using <code class="codeph">ALTER PLUGGABLE DATABASE SNAPSHOT</code>. Only the first database-managed PDB snapshot is full. You can clone sparse PDBs from the snapshots by executing <code class="codeph">CREATE PLUGGABLE DATABASE ... USING SNAPSHOT</code>. Unlike in previous releases, the clone PDBs do not require the source PDB to remain in read/only mode for the lifetime of the clone PDBs.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-87183462-C87C-432C-BE7E-282B1F1202F4__GUID-C3F9E599-5C78-4B0B-87FA-65E2AE4A654D">Point-in-Time Restore with <span>PDB Snapshot Carousel</span></p>
                        <p>A typical strategy is to take a snapshot of a PDB every day at the same time. Another strategy is to take a PDB snapshot manually before data loads. In either case, a <span>PDB snapshot carousel</span> enables you to restore a PDB using any available PDB snapshot.
                        </p>
                        <p>For example, a sales history PDB named <code class="codeph">pdb1_prod</code> generates an automatic snapshot every day at 12:01 a.m. On the daily data load on the afternoon of Monday 4/9, you accidentally load the wrong data, corrupting the PDB. You can create a new production PDB based on the Monday 4/9 snapshot, drop the corrupted PDB, and then retry the data load.
                        </p>
                        <div class="figure" id="GUID-87183462-C87C-432C-BE7E-282B1F1202F4__GUID-9E3BDF6C-438E-45CF-8036-F809220662CC">
                           <p class="titleinfigure">Figure 16-2 Restore a Production PDB Using a Snapshot</p><img src="img/multi_pb_003a.png" alt="Description of Figure 16-2 follows" title="Description of Figure 16-2 follows" longdesc="img_text/multi_pb_003a.html"><br><a href="img_text/multi_pb_003a.html">Description of "Figure 16-2 Restore a Production PDB Using a Snapshot"</a></div>
                        <!-- class="figure" -->
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-87183462-C87C-432C-BE7E-282B1F1202F4__GUID-31595C90-5E04-4133-85D4-9078A802CC51">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="q">"<a href="cloning-a-pdb.html#GUID-8A6287A1-14E5-4B45-972F-FC2FB3CDCF8B" title="Cloning means creating a new PDB from a source PDB or from a non-CDB.">About Cloning a PDB or Non-CDB</a>"</span></p>
                           </li>
                           <li>
                              <p><a href="../sqlrf/CREATE-PLUGGABLE-DATABASE.html#SQLRF-GUID-F2DBA8DD-EEA8-4BB7-A07F-78DC04DB1FFC" target="_blank"><span><cite>Oracle Database SQL Language Reference</cite></span></a> for <code class="codeph">CREATE PLUGGABLE DATABASE</code> syntax and semantics
                              </p>
                           </li>
                           <li>
                              <p><span><a href="../dblic/Licensing-Information.html#DBLIC-GUID-0F9EB85D-4610-4EDF-89C2-4916A0E7AC87" target="_blank"><span><cite>Oracle Database Licensing Information User Manual</cite></span></a> for details on which features are supported for different editions and services</span></p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="administering-pdb-snapshots.html#GUID-72CA6DD5-4DE5-4375-BEA6-A01E5E31A01B" title="A PDB snapshot carousel is a library of PDB snapshots.">About PDB Snapshot Carousel</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-F2FC2FCB-2DA2-43B5-B98D-8902BC8D66A6" name="GUID-F2FC2FCB-2DA2-43B5-B98D-8902BC8D66A6"></a><h4 id="MULTI-GUID-F2FC2FCB-2DA2-43B5-B98D-8902BC8D66A6" class="sect4"><span class="enumeration_section">16.1.2 </span>How <span>PDB Snapshot Carousel</span> Works
                  </h4>
                  <div>
                     <p>The carousel for a specific PDB is a circular library of copies for this PDB. </p>
                     <p>The database creates successive copies in the carousel either on demand or automatically. The database overwrites the oldest snapshot when the snapshot limit is reached.</p>
                     <p>This section includes the following topics:</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="administering-pdb-snapshots.html#GUID-35B03C37-00BA-4945-BF20-9A7C4C541955">Contents of a PDB Snapshot</a><br>The contents of a PDB snapshot depend on the setting of the <code class="codeph">CLONEDB</code> initialization parameter.
                        </li>
                        <li class="ulchildlink"><a href="administering-pdb-snapshots.html#GUID-751B6486-D4C3-4A66-8CAD-7DEF067F34DB">Contents of a PDB Snapshot Carousel</a><br>The <span>PDB snapshot carousel</span> is the set of all existing snapshots for a PDB.
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="administering-pdb-snapshots.html#GUID-72CA6DD5-4DE5-4375-BEA6-A01E5E31A01B" title="A PDB snapshot carousel is a library of PDB snapshots.">About PDB Snapshot Carousel</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="sect4"><a id="GUID-35B03C37-00BA-4945-BF20-9A7C4C541955" name="GUID-35B03C37-00BA-4945-BF20-9A7C4C541955"></a><h5 id="MULTI-GUID-35B03C37-00BA-4945-BF20-9A7C4C541955" class="sect5"><span class="enumeration_section">16.1.2.1 </span>Contents of a PDB Snapshot
                     </h5>
                     <div>
                        <p>The contents of a PDB snapshot depend on the setting of the <code class="codeph">CLONEDB</code> initialization parameter.
                        </p>
                        <div class="section">
                           <p class="subhead3" id="GUID-35B03C37-00BA-4945-BF20-9A7C4C541955__GUID-76ECBCA8-BD11-4679-8B16-F7B87C1E65AA">Snapshot Names</p>
                           <p>The name of a database-managed PDB snapshot is either user-specified or system-generated. For system-generated snapshot names, <code class="codeph">SNAP_</code> is prefixed to a unique identifier, which contains the snapshot SCN. For example, the following query shows three snapshots with system-generated names and the SCNs at which they were taken:
                           </p><pre class="pre codeblock"><code>SET LINESIZE 200
SET PAGESIZE 50000

COL CON_ID FORMAT 999999
COL CON_NAME FORMAT a15
COL SNAPSHOT_NAME FORMAT a27

SELECT CON_ID, CON_NAME, SNAPSHOT_NAME, SNAPSHOT_SCN FROM DBA_PDB_SNAPSHOTS;

 CON_ID CON_NAME        SNAPSHOT_NAME               SNAPSHOT_SCN
------- --------------- --------------------------- ------------
      5 HRPDB           SNAP_1389467754_993556301        2925293
      5 HRPDB           SNAP_1389467754_993556306        2925679
      5 HRPDB           SNAP_1389467754_993556309        2925698</code></pre><div class="infoboxnote" id="GUID-35B03C37-00BA-4945-BF20-9A7C4C541955__GUID-FEE7CE17-B281-4A3F-980C-B0581F730B0C">
                              <p class="notep1">Note:</p>
                              <p id="GUID-35B03C37-00BA-4945-BF20-9A7C4C541955__d5e5244">See <span id="GUID-35B03C37-00BA-4945-BF20-9A7C4C541955__d5e5246"><a href="../dblic/Licensing-Information.html#DBLIC-GUID-0F9EB85D-4610-4EDF-89C2-4916A0E7AC87" target="_blank"><span><cite>Oracle Database Licensing Information User Manual</cite></span></a> for details on which features are supported for different editions and services</span>.
                              </p>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-35B03C37-00BA-4945-BF20-9A7C4C541955__GUID-4868542E-5F00-4CC5-9E00-6A99B6734F1B">Full and Sparse Snapshots</p>
                           <p><span>Using technologies such as sparseness and copy-on-write, snapshot clone PDBs created when <code class="codeph">CLONEDB</code> is <code class="codeph">TRUE</code> behave as full data set copies of a source PDB, without requiring all data to be replicated. Only data file headers are copied. If data blocks in the snapshot clone PDB are modified, then Oracle Database copies the affected blocks, causing the file headers of the source and clone PDBs to diverge. The source PDB headers point to the original data blocks, whereas the clone PDB headers point to the copied data blocks.</span></p>
                           <p>When <code class="codeph">CLONEDB</code> is <code class="codeph">FALSE</code>, data files of the PDB snapshot reside in an archive file on the file system. The archive has the file extension <code class="codeph">.pdb</code>. No archived redo log files are included. Typically, the archive file is stored in the same directory as the PDB data files. 
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-35B03C37-00BA-4945-BF20-9A7C4C541955__GUID-8422A9FC-612D-4599-9CC8-C141227EC4AB">Snapshot Directories</p>
                           <p>Every PDB has its own snapshot directory. Within this directory, each snapshot has its own subdirectory named after the SCN at which it was taken. The following query shows the sparse PDB snapshots for <code class="codeph">hrpdb</code>, which has a DBID of <code class="codeph">1389467754</code>:
                           </p><pre class="pre codeblock"><code>SET LINESIZE 200
SET PAGESIZE 50000

COL SNAPSHOT_NAME FORMAT a27
COL FULL_SNAPSHOT_PATH FORMAT a65

SELECT SNAPSHOT_NAME, SNAPSHOT_SCN, FULL_SNAPSHOT_PATH FROM DBA_PDB_SNAPSHOTS;

SNAPSHOT_NAME               SNAPSHOT_SCN FULL_SNAPSHOT_PATH
--------------------------- ------------ ---------------------------------------
SNAP_1389467754_993556301        2925293 /d1/snapshots/pdb_1389467754/2925293/
SNAP_1389467754_993556306        2925679 /d1/snapshots/pdb_1389467754/2925679/
SNAP_1389467754_993556309        2925698 /d1/snapshots/pdb_1389467754/2925698/</code></pre><div class="infoboxnote" id="GUID-35B03C37-00BA-4945-BF20-9A7C4C541955__GUID-3AEADA5B-DD46-4832-998A-6EC50D168D49">
                              <p class="notep1">Note:</p>
                              <p>If the snapshot were full instead of sparse, then the full snapshot path would specify an archive with the <code class="codeph">.pdb</code> suffix. 
                              </p>
                           </div>
                           <p>The directory for <code class="codeph">/d1/snapshots/pdb_1389467754/2925698/</code> contains the following files:
                           </p><pre class="pre codeblock"><code>archparlog_1_63_52d1986a_993552590.arc  
o1_mf_salestbs_g03341t2_.dbf
o1_mf_sysext_g0333vqw_.dbf
o1_mf_undo_1_g033gd2j_.dbf            
o1_mf_sysaux_g0333vqv_.dbf   
o1_mf_system_g0333vqt_.dbf
HRPDB.xml</code></pre><p>The set includes the data files, archived redo log files, and an XML file that contains metadata about the PDB snapshot. The following <code class="codeph">du</code> command shows that the size of the snapshot data files, which are sparse, is small relative to the size of the data files:
                           </p><pre class="pre codeblock"><code>% du -h *dbf
16K     o1_mf_salestbs_g03341t2_.dbf
16K     o1_mf_sysaux_g0333vqv_.dbf
16K     o1_mf_sysext_g0333vqw_.dbf
16K     o1_mf_system_g0333vqt_.dbf
16K     o1_mf_undo_1_g033gd2j_.dbf
</code></pre><p>The following data dictionary join shows the snapshot file names and types for snapshot <code class="codeph">2925698</code>:
                           </p><pre class="pre codeblock"><code>SELECT f.SNAPSHOT_FILENAME, f.SNAPSHOT_FILETYPE
FROM   DBA_PDB_SNAPSHOTS s, DBA_PDB_SNAPSHOTFILE f
WHERE  s.SNAPSHOT_SCN=f.SNAPSHOT_SCN
AND    s.CON_ID=f.CON_ID
ORDER BY s.SNAPSHOT_SCN DESC;

SNAPSHOT_FILENAME                                                        SNAPSHOT
-----------------------------------------------------------------        --------
/d1/snapshots/pdb_1389467754/2925698/o1_mf_sysaux_g0333vqv_.dbf              DATA
/d1/snapshots/pdb_1389467754/2925698/o1_mf_system_g0333vqt_.dbf              DATA
/d1/snapshots/pdb_1389467754/2925698/HRPDB.xml                                XML
/d1/snapshots/pdb_1389467754/2925698/o1_mf_sysext_g0333vqw_.dbf              DATA
/d1/snapshots/pdb_1389467754/2925698/o1_mf_salestbs_g03341t2_.dbf            DATA
/d1/snapshots/pdb_1389467754/2925698/o1_mf_undo_1_g033gd2j_.dbf              DATA
/d1/snapshots/pdb_1389467754/2925698/archparlog_1_63_52d1986a_993552590.arc  ARCH
/d1/snapshots/pdb_1389467754/2925679/o1_mf_sysext_g0333vqw_.dbf              DATA
/d1/snapshots/pdb_1389467754/2925679/o1_mf_salestbs_g03341t2_.dbf            DATA
/d1/snapshots/pdb_1389467754/2925679/o1_mf_undo_1_g033gd2j_.dbf              DATA
/d1/snapshots/pdb_1389467754/2925679/o1_mf_sysaux_g0333vqv_.dbf              DATA
/d1/snapshots/pdb_1389467754/2925679/archparlog_1_63_52d1986a_993552590.arc  ARCH
/d1/snapshots/pdb_1389467754/2925679/HRPDB.xml                                XML
/d1/snapshots/pdb_1389467754/2925679/o1_mf_system_g0333vqt_.dbf              DATA
/d1/snapshots/pdb_1389467754/2925293/HRPDB.xml                                XML
/d1/snapshots/pdb_1389467754/2925293/o1_mf_system_g0333vqt_.dbf              DATA
/d1/snapshots/pdb_1389467754/2925293/o1_mf_sysaux_g0333vqv_.dbf              DATA
/d1/snapshots/pdb_1389467754/2925293/o1_mf_undo_1_g033gd2j_.dbf              DATA
/d1/snapshots/pdb_1389467754/2925293/o1_mf_salestbs_g03341t2_.dbf            DATA
/d1/snapshots/pdb_1389467754/2925293/o1_mf_sysext_g0333vqw_.dbf              DATA
/d1/snapshots/pdb_1389467754/2925293/archparlog_1_63_52d1986a_993552590.arc  ARCH</code></pre></div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-35B03C37-00BA-4945-BF20-9A7C4C541955__GUID-AE32E3F8-128C-44B5-9C7C-A3C7EAECCB81">
                           <p class="notep1">See Also:</p>
                           <p><span class="q">"<a href="cloning-a-pdb.html#GUID-F26C8A55-2465-475A-905A-83BD2E68AE6E" title="In Oracle Multitenant, the term snapshot means different things depending on context.">Types of Snapshots</a>"</span></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="administering-pdb-snapshots.html#GUID-F2FC2FCB-2DA2-43B5-B98D-8902BC8D66A6" title="The carousel for a specific PDB is a circular library of copies for this PDB.">How PDB Snapshot Carousel Works</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-751B6486-D4C3-4A66-8CAD-7DEF067F34DB" name="GUID-751B6486-D4C3-4A66-8CAD-7DEF067F34DB"></a><h5 id="MULTI-GUID-751B6486-D4C3-4A66-8CAD-7DEF067F34DB" class="sect5"><span class="enumeration_section">16.1.2.2 </span>Contents of a <span>PDB Snapshot Carousel</span></h5>
                     <div>
                        <p>The <span>PDB snapshot carousel</span> is the set of all existing snapshots for a PDB.
                        </p>
                        <p>The <code class="codeph">MAX_PDB_SNAPSHOTS</code> property specifies the maximum number of snapshots permitted in the carousel. The current setting is visible in the <code class="codeph">CDB_PROPERTIES</code> view.
                        </p>
                        <p>The following figure shows a carousel for <code class="codeph">cdb1_pdb1</code>. In this example, the database takes a PDB snapshot automatically every day, maintaining a set of 8. After the first 8 snapshots have been created, every new snapshot replaces the oldest snapshot. For example, the Tuesday 4/10 snapshot replaces the Monday 4/2 snapshot; the Wednesday 4/11 snapshot replaces the Tuesday 4/3 snapshot; and so on.
                        </p>
                        <div class="figure" id="GUID-751B6486-D4C3-4A66-8CAD-7DEF067F34DB__GUID-C10629BB-27E3-4D04-A8B4-8473515CC5C6">
                           <p class="titleinfigure">Figure 16-3 <span>PDB Snapshot Carousel</span></p><img src="img/multi_pb_002a.png" alt="Description of Figure 16-3 follows" title="Description of Figure 16-3 follows" longdesc="img_text/multi_pb_002a.html"><br><a href="img_text/multi_pb_002a.html">Description of "Figure 16-3 PDB Snapshot Carousel"</a></div>
                        <!-- class="figure" -->
                        <p>Starting <span>Oracle Database 19c</span>, all PDB snapshots in the carousel except the first one can be sparse, and the source PDB can remain in read/write mode. This feature significantly reduces the storage space consumed by the carousel.
                        </p>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-751B6486-D4C3-4A66-8CAD-7DEF067F34DB__GUID-5ACA1C13-303D-4113-89AF-733AA4CD8930">
                           <p class="notep1">See Also:</p>
                           <p><span><a href="../dblic/Licensing-Information.html#DBLIC-GUID-0F9EB85D-4610-4EDF-89C2-4916A0E7AC87" target="_blank"><span><cite>Oracle Database Licensing Information User Manual</cite></span></a> for details on which features are supported for different editions and services</span></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="administering-pdb-snapshots.html#GUID-F2FC2FCB-2DA2-43B5-B98D-8902BC8D66A6" title="The carousel for a specific PDB is a circular library of copies for this PDB.">How PDB Snapshot Carousel Works</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF" name="GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF"></a><h4 id="MULTI-GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF" class="sect4"><span class="enumeration_section">16.1.3 </span>User Interface for <span>PDB Snapshot Carousel</span></h4>
                  <div>
                     <p>The <code class="codeph">SNAPSHOT MODE</code> clause controls creation of snapshots, and determines whether creation is manual, automatic, or disabled.
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF__GUID-68C6A6E5-BF63-478C-9C00-8D2524470DAC">CREATE PLUGGABLE DATABASE Statement</p>
                        <p>To set the snapshot mode for a PDB, use one of the following values in the <code class="codeph">SNAPSHOT MODE</code> clause of <code class="codeph">ALTER PLUGGABLE DATABASE</code> or <code class="codeph">CREATE PLUGGABLE DATABASE</code>:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">MANUAL</code></p>
                              <p>This clause, which is the default, enables the creation of manual snapshots of the PDB. To create a snapshot on demand, specify the <code class="codeph">SNAPSHOT <span class="codeinlineitalic">snapshot_name</span></code> clause in an <code class="codeph">ALTER PLUGGABLE DATABASE</code> or <code class="codeph">CREATE PLUGGABLE DATABASE</code> statement.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">EVERY <span class="codeinlineitalic">snapshot_interval</span> [MINUTES|HOURS]</code></p>
                              <p>This clause enables the automatic creation of snapshots after an interval of time. The following restrictions apply to the interval specified:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>The minutes value must be less than <code class="codeph">3000</code>.
                                    </p>
                                 </li>
                                 <li>
                                    <p>The hours value must be less than <code class="codeph">2000</code>.
                                    </p>
                                 </li>
                              </ul>
                              <p>The database assigns each automatic snapshot a system-generated name. Note that manual snapshots are also supported for the PDB when <code class="codeph">EVERY</code> is specified.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">NONE</code></p>
                              <p> This clause disables snapshot creation for the PDB.</p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF__GUID-2FFC8633-8544-4BB0-9755-9BF6E0FDD169">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="q">"<a href="cloning-a-pdb.html#GUID-F6F105E1-AB69-4DD0-9A70-51EDD4B2426D" title="A PDB snapshot is a database-managed, point-in-time copy of a PDB. A snapshot clone PDB is a PDB created from a snapshot.">About Cloning PDBs from PDB Snapshots</a>"</span></p>
                              </li>
                              <li>
                                 <p><a href="../sqlrf/CREATE-PLUGGABLE-DATABASE.html#SQLRF55694" target="_blank"><span><cite>Oracle Database SQL Language Reference</cite></span></a> for the syntax and semantics of the <code class="codeph">SNAPSHOT</code> clause
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF__GUID-8E94B3A9-89D2-4588-935C-4A7D32CA5C24">CLONEDB Initialization Parameter</p>
                        <p>Starting in <span>Oracle Database 19c</span>, the behavior of PDB snapshots depends on the setting of the <code class="codeph">CLONEDB</code> initialization parameter:
                        </p>
                        <ul style="list-style-type: disc;" id="GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF__UL_G4J_VWZ_YFB">
                           <li>
                              <p><code class="codeph">CLONEDB=TRUE</code></p>
                              <p>You can take snapshots of PDBs that are in read/write mode or read-only mode. The first snapshot of the PDB contains full copies of the original PDB files, but subsequent snapshots of the same PDB contain sparse files.</p>
                           </li>
                           <li>
                              <p><code class="codeph">CLONEDB=FALSE</code></p>
                              <p>You can only take snapshots of read-only PDBs. Every snapshot is a full copy of the source PDB files. In this case, if you create a clone PDB based on a PDB snapshot, then the source PDB must remain read-only for the lifetime of the clone PDB.</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF__GUID-49436BE1-1278-4609-9F9F-E1F41F98F546">MAX_PDB_SNAPSHOTS Database Property</p>
                        <p>To set the maximum number of snapshots for a PDB, specify the <code class="codeph">MAX_PDB_SNAPSHOTS</code> property in <code class="codeph">ALTER PLUGGABLE DATABASE</code> or <code class="codeph">CREATE PLUGGABLE DATABASE</code>. The default is for the property is <code class="codeph">8</code>, which is also the maximum value. When the maximum allowed number of snapshots has been created, the database purges the oldest snapshot. The <code class="codeph">CDB_PROPERTIES</code> view shows the setting of <code class="codeph">MAX_PDB_SNAPSHOTS</code>.
                        </p>
                        <div class="infoboxnotealso" id="GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF__GUID-C86393BE-C66F-4369-8298-009A3AB3DBD1">
                           <p class="notep1">See Also:</p>
                           <p><a href="../sqlrf/ALTER-PLUGGABLE-DATABASE.html#SQLRF-GUID-A29491AD-8F0F-4E52-9D94-57FC3FF8FBC7" target="_blank"><span><cite>Oracle Database SQL Language Reference</cite></span></a> for the syntax of the <code class="codeph">ALTER PLUGGABLE DATABASE</code> statement
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF__GUID-AF193A24-4D17-4460-8956-D3FB1F5DA922">Snapshot-Related Data Dictionary Views</p>
                        <p>The following data dictionary views provide snapshot information:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>The <code class="codeph">DBA_PDB_SNAPSHOTS</code> view records metadata about PDB snapshots, including snapshot name, creation SCN, creation time, and file name.
                              </p>
                           </li>
                           <li>
                              <p>The <code class="codeph">DBA_PDB_SNAPSHOTFILE</code> view lists the names and types of the files in a PDB snapshot. This view is only populated when the snapshots are sparse.
                              </p>
                           </li>
                           <li>
                              <p>The <code class="codeph">DBA_PDBS</code> view has a <code class="codeph">SNAPSHOT_MODE</code> and <code class="codeph">SNAPSHOT_INTERVAL</code> column.
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-8771C38E-E6C1-49BC-8160-CE987E6154AF__GUID-5E1BCA5F-FE85-4447-BC43-98309C2E4308">
                        <p class="notep1">See Also:</p>
                        <p><span><cite>Oracle Database Reference</cite></span> to learn about <a href="../refrn/DBA_PDB_SNAPSHOTS.html#GUID-B1389923-0F82-476F-BBEE-39364F10A988" target="_blank"><code class="codeph">DBA_PDB_SNAPSHOTS</code></a>, <a href="../refrn/DBA_PDB_SNAPSHOTFILE.html#GUID-990A75BF-090C-4298-AA9A-27F7BF8C35C3" target="_blank"><code class="codeph">DBA_PDB_SNAPSHOTFILE</code></a>, and <a href="../refrn/DBA_PDBS.html#GUID-439126EA-A6B6-45B8-AAFA-37EE4356BBEF" target="_blank"><code class="codeph">DBA_PDBS</code></a></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="administering-pdb-snapshots.html#GUID-72CA6DD5-4DE5-4375-BEA6-A01E5E31A01B" title="A PDB snapshot carousel is a library of PDB snapshots.">About PDB Snapshot Carousel</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
            <div class="sect2"><a id="GUID-B6A785B6-42F2-4027-9DA5-6FA1164CCC5C" name="GUID-B6A785B6-42F2-4027-9DA5-6FA1164CCC5C"></a><h3 id="MULTI-GUID-B6A785B6-42F2-4027-9DA5-6FA1164CCC5C" class="sect3"><span class="enumeration_section">16.2 </span>Setting the Maximum Number of Snapshots in a <span>PDB Snapshot Carousel</span></h3>
               <div>
                  <p>You can set the maximum number of PDB snapshots for a PDB.</p>
                  <div class="section">
                     <p>The <code class="codeph">MAX_PDB_SNAPSHOTS</code> database property sets the maximum number of snapshots for every PDB in a <span>PDB snapshot carousel</span>. The default maximum is <code class="codeph">8</code>. You cannot set the property to a number greater than <code class="codeph">8</code>.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-B6A785B6-42F2-4027-9DA5-6FA1164CCC5C__GUID-F1ED63D6-900C-45CD-95C4-8EF6FF72DFAE">Prerequisites</p>
                     <p>The PDB must be open in read/write mode.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-B6A785B6-42F2-4027-9DA5-6FA1164CCC5C__GUID-843BFDED-C629-46ED-BAE2-04C7693E90F8">To set the maximum number of PDB snapshots for a PDB:</p>
                     <ol>
                        <li>
                           <p>In SQL*Plus, ensure that the current container is the PDB for which you want to set the limit.</p>
                        </li>
                        <li>
                           <p>Optionally, query <code class="codeph">CDB_PROPERTIES</code> for the current setting of the <code class="codeph">SET MAX_PDB_SNAPSHOTS</code> property.
                           </p>
                        </li>
                        <li>
                           <p>Run an <code class="codeph">ALTER PLUGGABLE DATABASE</code> or <code class="codeph">ALTER DATABASE</code> statement with the <code class="codeph">SET MAX_PDB_SNAPSHOTS</code> clause.
                           </p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-B6A785B6-42F2-4027-9DA5-6FA1164CCC5C__GUID-509A37D6-9BB3-469B-BB3A-B5D32C8C2AE1">
                     <p class="titleinexample">Example 16-1 Setting the Maximum Number of PDB Snapshots for a PDB</p>
                     <p>The following query shows the maximum in the carousel for <code class="codeph">cdb1_pdb1</code> (sample output included):
                     </p><pre class="pre codeblock"><code>SET LINESIZE 150
COL CON_ID FORMAT 99999
COL PROPERTY_NAME FORMAT a17
COL PDB_NAME FORMAT a9
COL VALUE FORMAT a3
COL DESCRIPTION FORMAT a43

SELECT r.CON_ID, p.PDB_NAME, PROPERTY_NAME, 
       PROPERTY_VALUE AS value, DESCRIPTION 
FROM   CDB_PROPERTIES r, CDB_PDBS p 
WHERE  r.CON_ID = p.CON_ID 
AND    PROPERTY_NAME LIKE 'MAX_PDB%' 
ORDER BY PROPERTY_NAME;

CON_ID PDB_NAME  PROPERTY_NAME     VAL DESCRIPTION
------ --------- ----------------- --- -------------------------------------------
     3 CDB1_PDB1 MAX_PDB_SNAPSHOTS 8   maximum number of snapshots for a given PDB
</code></pre><p>The following SQL statement sets the maximum number of PDB snapshots for the current PDB to 7:</p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE SET MAX_PDB_SNAPSHOTS=7;</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-B6A785B6-42F2-4027-9DA5-6FA1164CCC5C__GUID-CB8DC44C-F1FD-4463-AF82-D635818D9AAC">
                     <p class="titleinexample">Example 16-2 Dropping All Snapshots in a <span>PDB Snapshot Carousel</span></p>
                     <p>To drop all snapshots in a <span>PDB snapshot carousel</span>, set the <code class="codeph">MAX_PDB_SNAPSHOTS</code> database property to <code class="codeph">0</code> (zero), as shown in the following statement:
                     </p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE SET MAX_PDB_SNAPSHOTS=0;</code></pre><p>This technique is faster than executing <code class="codeph">ALTER PLUGGABLE DATABASE ... DROP SNAPSHOT <span class="codeinlineitalic">snapshot_name</span></code> for every snapshot.
                     </p>
                  </div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-B6A785B6-42F2-4027-9DA5-6FA1164CCC5C__GUID-4C70D67B-4ECE-4CD1-91A3-4C84986CC119">
                     <p class="notep1">See Also:</p>
                     <p><span class="q">"<a href="administering-a-cdb-with-sql-plus.html#GUID-D75CAF12-1073-40DB-B096-51B63E4C01E3" title="You can use SQL*Plus to access the root or a PDB in a CDB.">About Container Access in a CDB</a>"</span></p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="administering-pdb-snapshots.html#GUID-FF6DF540-0C22-451C-80B3-1ACA8C8CB7D2" title="You can configure a PDB snapshot carousel for a specified PDB, create snapshots manually or automatically, and set the maximum number of snapshots.">Administering a PDB Snapshot Carousel</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-82BCCB60-4A6F-4687-BD16-64A5FE767FB5" name="GUID-82BCCB60-4A6F-4687-BD16-64A5FE767FB5"></a><h3 id="MULTI-GUID-82BCCB60-4A6F-4687-BD16-64A5FE767FB5" class="sect3"><span class="enumeration_section">16.3 </span>Configuring Automatic PDB Snapshots
               </h3>
               <div>
                  <p>Configure a PDB for automatic snapshots by using the <code class="codeph">SNAPSHOT MODE EVERY</code> clause when creating or altering a PDB.
                  </p>
                  <div class="section">By default, a PDB is configured for manual snapshots.</div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-82BCCB60-4A6F-4687-BD16-64A5FE767FB5__GUID-EE62ACB9-8F13-41B1-BB75-4335F42BE8DC">Prerequisites</p>
                     <p>Note the following prerequisites for the <code class="codeph">ALTER PLUGGABLE DATABASE SNAPSHOT</code> statement:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The CDB must be in local undo mode.</p>
                        </li>
                        <li>
                           <p>The administrator must have the privileges to create a PDB and drop a PDB.</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-82BCCB60-4A6F-4687-BD16-64A5FE767FB5__GUID-895929A2-9D3A-4A6E-AB24-6B894FDE5EF2">To configure automatic snapshots when altering a PDB:</p>
                     <ol>
                        <li>
                           <p>In SQL*Plus, log in as an administrator to the PDB whose snapshot mode you intend to configure.</p>
                        </li>
                        <li>
                           <p>Optionally, query <code class="codeph">DBA_PDBS</code> to determine the current snapshot mode.
                           </p>
                        </li>
                        <li>
                           <p>Run <code class="codeph">ALTER PLUGGABLE DATABASE</code> with the <code class="codeph">SNAPSHOT MODE EVERY <span class="codeinlineitalic">interval</span></code> clause, specifying either <code class="codeph">MINUTES</code> or <code class="codeph">HOURS</code>.
                           </p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-82BCCB60-4A6F-4687-BD16-64A5FE767FB5__TOCONFIGUREAUTOMATICSNAPSHOTSWHENAL-37ABCC8A">To configure automatic snapshots when creating a PDB:</p>
                     <ol>
                        <li>
                           <p>In SQL*Plus, log in as an administrator to the CDB root or application root.</p>
                        </li>
                        <li>
                           <p>Optionally, query <code class="codeph">DBA_PDBS</code> to determine the current snapshot mode.
                           </p>
                        </li>
                        <li>
                           <p>Run <code class="codeph">CREATE PLUGGABLE DATABASE</code> with the <code class="codeph">SNAPSHOT MODE EVERY <span class="codeinlineitalic">interval</span></code> clause, specifying either <code class="codeph">MINUTES</code> or <code class="codeph">HOURS</code>.
                           </p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-82BCCB60-4A6F-4687-BD16-64A5FE767FB5__GUID-C7045DF2-C315-4D15-B0C2-27CCBFB535E0">
                     <p class="titleinexample">Example 16-3 Configuring an Automatic Snapshot Every Day for an Existing PDB</p>
                     <p>This example assumes that you are logged in to the PDB whose snapshot mode you intend to change. Query the data dictionary to confirm that the PDB is currently in <code class="codeph">MANUAL</code> mode (sample output included):
                     </p><pre class="pre codeblock"><code>SELECT SNAPSHOT_MODE "S_MODE", SNAPSHOT_INTERVAL/60 "SNAP_INT_HRS" FROM DBA_PDBS;

S_MODE SNAP_INT_HRS
------ ------------
MANUAL</code></pre><p>Change the snapshot mode to every 24 hours:</p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE SNAPSHOT MODE EVERY 24 HOURS;</code></pre><p>Confirm the change to automatic mode:</p><pre class="pre codeblock"><code>SELECT SNAPSHOT_MODE "S_MODE", SNAPSHOT_INTERVAL/60 "SNAP_INT_HRS" FROM DBA_PDBS;

S_MODE SNAP_INT_HRS
------ ------------
AUTO             24</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-82BCCB60-4A6F-4687-BD16-64A5FE767FB5__GUID-B7A04ED2-4C4D-4A1A-AD37-2F50EF7BE27E">
                     <p class="titleinexample">Example 16-4 Creating a PDB That Takes Snapshots Every Two Hours</p>
                     <p>This example assumes that you are logged in to the CDB root. The following statement creates <code class="codeph">cdb1_pdb3</code> from an existing PDB named <code class="codeph">cdb1_pdb1</code>, and configures it to take snapshots automatically every 2 hours:
                     </p><pre class="pre codeblock"><code>CREATE PLUGGABLE DATABASE cdb1_pdb3 FROM cdb1_pdb1
  FILE_NAME_CONVERT=('cdb1_pdb1','cdb1_pdb3')
  SNAPSHOT MODE EVERY 120 MINUTES;</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-82BCCB60-4A6F-4687-BD16-64A5FE767FB5__GUID-31595C90-5E04-4133-85D4-9078A802CC51">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><span class="q">"<a href="cloning-a-pdb.html#GUID-539A1F68-27B9-4802-95AC-2C721347296C" title="This scenario creates a new PDB from a PDB snapshot by executing CREATE PLUGGABLE DATABASE ... USING SNAPSHOT.">Cloning a PDB from a PDB Snapshot: Scenario</a>"</span></p>
                        </li>
                        <li>
                           <p><span class="q">"<a href="administering-a-cdb-with-sql-plus.html#GUID-1AAB032F-D13A-4E06-A062-59E0487C2FC5" title="You can change a CDB to local undo mode by issuing an ALTER DATABASE LOCAL UNDO ON statement and restarting the database.">Configuring a CDB to Use Local Undo Mode</a>"</span></p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="administering-pdb-snapshots.html#GUID-FF6DF540-0C22-451C-80B3-1ACA8C8CB7D2" title="You can configure a PDB snapshot carousel for a specified PDB, create snapshots manually or automatically, and set the maximum number of snapshots.">Administering a PDB Snapshot Carousel</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-FBF77C07-9B40-4BF3-8C7D-61C8F11E2B14" name="GUID-FBF77C07-9B40-4BF3-8C7D-61C8F11E2B14"></a><h3 id="MULTI-GUID-FBF77C07-9B40-4BF3-8C7D-61C8F11E2B14" class="sect3"><span class="enumeration_section">16.4 </span>Creating PDB Snapshots Manually
               </h3>
               <div>
                  <p>To create a PDB snapshot manually, specify the <code class="codeph">SNAPSHOT <span class="codeinlineitalic">snapshot_name</span></code> clause in <code class="codeph">ALTER PLUGGABLE DATABASE</code> or <code class="codeph">CREATE PLUGGABLE DATABASE</code>.
                  </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-FBF77C07-9B40-4BF3-8C7D-61C8F11E2B14__GUID-BBEB4503-6406-433D-A4E1-91846C9C167C">Prerequisites</p>
                     <p>Note the following prerequisites for the <code class="codeph">ALTER PLUGGABLE DATABASE SNAPSHOT</code> statement:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The CDB must be in local undo mode. You can check the mode by using the following query, which returns <code class="codeph">TRUE</code> when local undo is enabled:
                           </p><pre class="pre codeblock"><code>SELECT * FROM DATABASE_PROPERTIES WHERE PROPERTY_NAME='LOCAL_UNDO_ENABLED';</code></pre></li>
                        <li>
                           <p>The DBA must have the privileges to create and drop a PDB.</p>
                        </li>
                        <li>
                           <p>If the source PDB is in read/write mode, then <code class="codeph">CLONEDB</code> must be set to <code class="codeph">TRUE</code>, in which case all snapshots except the first one are sparse.
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-FBF77C07-9B40-4BF3-8C7D-61C8F11E2B14__GUID-8BC45F3E-85D2-4E0E-B46A-DA6049388906">To create a PDB snapshot:</p>
                     <ol>
                        <li>
                           <p>In SQL*Plus, log in as an administrator to the PDB whose snapshot you intend to create.</p>
                        </li>
                        <li>
                           <p>Optionally, query <code class="codeph">DBA_PDBS.SNAPSHOT_MODE</code> to confirm that the snapshot mode is not set to <code class="codeph">NONE</code>.
                           </p>
                        </li>
                        <li>
                           <p>Run an <code class="codeph">ALTER PLUGGABLE DATABASE</code> statement with the <code class="codeph">SNAPSHOT</code> clause.
                           </p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-FBF77C07-9B40-4BF3-8C7D-61C8F11E2B14__GUID-509A37D6-9BB3-469B-BB3A-B5D32C8C2AE1">
                     <p class="titleinexample">Example 16-5 Creating a PDB Snapshot with a User-Specified Name</p>
                     <p>The following SQL statements create two PDB snapshots of <code class="codeph">cdb1_pdb1</code>, one before and one after a Wednesday data load:
                     </p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE SNAPSHOT cdb1_pdb1_b4WLOAD;
-- data load
ALTER PLUGGABLE DATABASE SNAPSHOT cdb1_pdb1_afWLOAD;</code></pre><p>The following query of <code class="codeph">DBA_PDB_SNAPSHOTS</code> shows the locations of two snapshots of the PDB named <code class="codeph">cdb1_pdb1</code> (sample output included):
                     </p><pre class="pre codeblock"><code>SET LINESIZE 150
COL CON_NAME FORMAT a9
COL SNAPSHOT_NAME FORMAT a20
COL SNAP_SCN FORMAT 9999999
COL FULL_SNAPSHOT_PATH FORMAT a45

SELECT CON_ID, CON_NAME, SNAPSHOT_NAME, 
       SNAPSHOT_SCN AS snap_scn, FULL_SNAPSHOT_PATH 
FROM   DBA_PDB_SNAPSHOTS
ORDER BY SNAP_SCN;

 CON_ID CON_NAME   SNAPSHOT_NAME        SNAP_SCN FULL_SNAPSHOT_PATH
------- --------- -------------------- -------- ------------------------------------------
      3 CDB1_PDB1 CDB1_PDB1_B4WLOAD     2962078 /d1/oracle/dbs/snap_3489077498_2962078.pdb
      3 CDB1_PDB1 CDB1_PDB1_AFWLOAD     2962938 /d1/oracle/dbs/snap_3489077498_2962938.pdb
</code></pre><p>If you do not specify a PDB snapshot name, then the database generates a unique name. Note that the snapshot paths in the preceding example are <code class="codeph">.pdb</code> archives, which means that snapshots are full rather than sparse.
                     </p>
                  </div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-FBF77C07-9B40-4BF3-8C7D-61C8F11E2B14__GUID-0DE08F77-0073-4F63-84D9-1E3C79AAADBF">
                     <p class="titleinexample">Example 16-6 Creating a PDB Snapshot with a System-Specified Name</p>
                     <p>The following SQL statement creates a snapshot, but does not specify a name:</p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE SNAPSHOT;</code></pre><p>The following sample query shows that the database assigned the snapshot a name prefixed with <code class="codeph">SNAP_</code>:
                     </p><pre class="pre codeblock"><code>SET LINESIZE 150
COL CON_NAME FORMAT a9
COL SNAPSHOT_NAME FORMAT a25
COL SNAP_SCN FORMAT 9999999
COL FULL_SNAPSHOT_PATH FORMAT a45

SELECT CON_ID, CON_NAME, SNAPSHOT_NAME, 
       SNAPSHOT_SCN AS snap_scn, FULL_SNAPSHOT_PATH 
FROM   DBA_PDB_SNAPSHOTS
ORDER BY SNAP_SCN;

 CON_ID CON_NAME  SNAPSHOT_NAME             SNAP_SCN FULL_SNAPSHOT_PATH
------- --------- ------------------------- -------- ------------------------------------------
      3 CDB1_PDB1 CDB1_PDB1_B4WLOAD          2962078 /d1/oracle/dbs/snap_3489077498_2962078.pdb
      3 CDB1_PDB1 CDB1_PDB1_AFWLOAD          2962938 /d1/oracle/dbs/snap_3489077498_2962938.pdb
      3 CDB1_PDB1 SNAP_3489077498_960130367  2993525 /d1/oracle/dbs/snap_3489077498_2993525.pdb
</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-FBF77C07-9B40-4BF3-8C7D-61C8F11E2B14__GUID-75F8BAB3-9623-4C97-A916-116F9F9F20D7">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><span class="q">"<a href="administering-a-cdb-with-sql-plus.html#GUID-D75CAF12-1073-40DB-B096-51B63E4C01E3" title="You can use SQL*Plus to access the root or a PDB in a CDB.">About Container Access in a CDB</a>"</span></p>
                        </li>
                        <li>
                           <p><span class="q">"<a href="administering-a-cdb-with-sql-plus.html#GUID-1AAB032F-D13A-4E06-A062-59E0487C2FC5" title="You can change a CDB to local undo mode by issuing an ALTER DATABASE LOCAL UNDO ON statement and restarting the database.">Configuring a CDB to Use Local Undo Mode</a>"</span></p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="administering-pdb-snapshots.html#GUID-FF6DF540-0C22-451C-80B3-1ACA8C8CB7D2" title="You can configure a PDB snapshot carousel for a specified PDB, create snapshots manually or automatically, and set the maximum number of snapshots.">Administering a PDB Snapshot Carousel</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-9E7D3176-9504-429D-895F-A3D60028FE5A" name="GUID-9E7D3176-9504-429D-895F-A3D60028FE5A"></a><h3 id="MULTI-GUID-9E7D3176-9504-429D-895F-A3D60028FE5A" class="sect3"><span class="enumeration_section">16.5 </span>Dropping a PDB Snapshot
               </h3>
               <div>
                  <p>You can drop a PDB snapshot by running an <code class="codeph">ALTER PLUGGABLE DATABASE</code> statement with the <code class="codeph">DROP SNAPSHOT</code> clause.
                  </p>
                  <div class="section">
                     <p>To drop all PDB snapshots based on a PDB, set the <code class="codeph">MAX_PDB_SNAPSHOTS</code> property in the PDB to <code class="codeph">0</code> (zero).
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-9E7D3176-9504-429D-895F-A3D60028FE5A__GUID-C8D468D5-FC95-44E2-A11D-FD07967AAF50">To drop a PDB snapshot:</p>
                     <ol>
                        <li>
                           <p>In SQL*Plus, ensure that the current container is the PDB from which you created the PDB snapshot.</p>
                        </li>
                        <li>
                           <p>Run an <code class="codeph">ALTER PLUGGABLE DATABASE</code> statement with the <code class="codeph">DROP SNAPSHOT</code> clause.
                           </p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-9E7D3176-9504-429D-895F-A3D60028FE5A__GUID-509A37D6-9BB3-469B-BB3A-B5D32C8C2AE1">
                     <p class="titleinexample">Example 16-7 Dropping a PDB Snapshot</p>
                     <p>The following SQL statement drops a PDB snapshot named <code class="codeph">sales_snap</code>:
                     </p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE DROP SNAPSHOT sales_snap;</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-9E7D3176-9504-429D-895F-A3D60028FE5A__GUID-1A26FD38-5B50-4249-8861-7135E4F1AFA7">
                     <p class="notep1">See Also:</p>
                     <p><span class="q">"<a href="administering-a-cdb-with-sql-plus.html#GUID-D75CAF12-1073-40DB-B096-51B63E4C01E3" title="You can use SQL*Plus to access the root or a PDB in a CDB.">About Container Access in a CDB</a>"</span></p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="administering-pdb-snapshots.html#GUID-FF6DF540-0C22-451C-80B3-1ACA8C8CB7D2" title="You can configure a PDB snapshot carousel for a specified PDB, create snapshots manually or automatically, and set the maximum number of snapshots.">Administering a PDB Snapshot Carousel</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-87CB7869-5A15-456F-90B8-361A0D06D8AF" name="GUID-87CB7869-5A15-456F-90B8-361A0D06D8AF"></a><h3 id="MULTI-GUID-87CB7869-5A15-456F-90B8-361A0D06D8AF" class="sect3"><span class="enumeration_section">16.6 </span>Viewing Metadata for PDB Snapshots
               </h3>
               <div>
                  <p>The data dictionary views <code class="codeph">DBA_PDB_SNAPSHOTS</code> and <code class="codeph">DBA_PDB_SNAPSHOTFILE</code> show the metadata for PDB snapshots.
                  </p>
                  <div class="section">
                     <p><code class="codeph">DBA_PDB_SNAPSHOTS</code> contains general information about the snapshot, including name, SCN, time, and path. <code class="codeph">DBA_PDB_SNAPSHOTFILE</code> shows the path and file type of every file in a snapshot: data files, archived redo log files, and XML files.
                     </p>
                     <div class="infoboxnote" id="GUID-87CB7869-5A15-456F-90B8-361A0D06D8AF__GUID-62B7B4D9-5B06-419E-B2FD-7A61DFC68F4F">
                        <p class="notep1">Note:</p>
                        <p><code class="codeph">DBA_PDB_SNAPSHOTFILE</code> only shows sparse clone PDBs. To create sparse clones, the <code class="codeph">CLONEDB</code> initialization parameter must be set to <code class="codeph">TRUE</code>.
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-87CB7869-5A15-456F-90B8-361A0D06D8AF__GUID-FBC91654-7FE7-49E3-8E11-6EFBC62929C5">To view metadata for PDB snapshots:</p>
                     <ol>
                        <li>
                           <p>In SQL*Plus, log in to the database as an administrative user.</p>
                        </li>
                        <li>
                           <p>Query <code class="codeph">DBA_PDB_SNAPSHOTS</code>.
                           </p>
                           <p>For example, run the following query (sample output included):</p>i<pre class="pre codeblock"><code>COL SNAPSHOT_NAME FORMAT a30
SELECT SNAPSHOT_NAME, SNAPSHOT_SCN, SNAPSHOT_TIME FROM DBA_PDB_SNAPSHOTS;

SNAPSHOT_NAME                  SNAPSHOT_SCN SNAPSHOT_TIME
------------------------------ ------------ -------------
HRPDB_SNAP_F                        3678939    1536262569
HRPDB_SNAP_S                        4954803     986473745</code></pre></li>
                        <li>
                           <p>Query <code class="codeph">DBA_PDB_SNAPSHOTFILE</code>.
                           </p>
                           <p>For example, run the following join query (sample output included):</p><pre class="pre codeblock"><code>SET LINESIZE 120
COL SNAPSHOT_NAME FORMAT a12
COL SNAPSHOT_FILENAME FORMAT a63

SELECT SNAPSHOT_NAME, SNAPSHOT_FILENAME, SNAPSHOT_FILETYPE AS TYPE
FROM   DBA_PDB_SNAPSHOTS s, DBA_PDB_SNAPSHOTFILE f
WHERE  s.SNAPSHOT_SCN=f.SNAPSHOT_SCN;

SNAPSHOT_NAM SNAPSHOT_FILENAME                                             TYPE
------------ ------------------------------------------------------------- ----
HRPDB_SNAP_S /d1/snapshots/4954803/o1_mf_undo_1_fry1l5bq_.dbf              DATA
HRPDB_SNAP_S /d1/snapshots/4954803/o1_mf_salestbs_fry19m6h_.dbf            DATA
HRPDB_SNAP_S /d1/snapshots/4954803/o1_mf_sysext_fry19d1n_.dbf              DATA
HRPDB_SNAP_S /d1/snapshots/4954803/o1_mf_sysaux_fry19d1m_.dbf              DATA
HRPDB_SNAP_S /d1/snapshots/4954803/o1_mf_system_fry19d1k_.dbf              DATA
HRPDB_SNAP_S /d1/snapshots/4954803/HRPDB.xml                               XML
HRPDB_SNAP_S /d1/snapshots/4954803/archparlog_1_274_b87ca51e_985963814.arc ARCH</code></pre></li>
                     </ol>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-87CB7869-5A15-456F-90B8-361A0D06D8AF__GUID-74C40090-ECE4-4229-90C6-47E8CB29B10D">
                     <p class="titleinexample">Example 16-8 Querying Metadata for Full PDB Snapshots</p>
                     <p>The following query shows two PDB snapshots. The snapshots are full, not sparse, as indicated by the <code class="codeph">.pdb</code> extension.
                     </p><pre class="pre codeblock"><code> 
SET LINESIZE 200
SET PAGESIZE 50000

COL CON_ID FORMAT 999999
COL CON_NAME FORMAT a8
COL SNAPSHOT_NAME FORMAT a25
COL FULL_SNAPSHOT_PATH FORMAT a65

CON_ID  CON_NAME SNAPSHOT_NAME             SNAPSHOT_SCN FULL_SNAPSHOT_PATH
------- -------- ------------------------- ------------ -------------------------------
      5 HRPDB    SNAP_3286480866_994766895      3160319 /d1/snap_3286480866_3160319.pdb
      5 HRPDB    SNAP_3286480866_994767095      3165758 /d1/snap_3286480866_3165758.pdb</code></pre><p>The following query of <code class="codeph">DBA_PDB_SNAPSHOTFILE</code> returns no rows because this view is only populated when PDB snapshots are sparse:
                     </p><pre class="pre codeblock"><code>SQL&gt; SELECT COUNT(*) FROM DBA_PDB_SNAPSHOTFILE;

  COUNT(*)
----------
         0</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="administering-pdb-snapshots.html#GUID-FF6DF540-0C22-451C-80B3-1ACA8C8CB7D2" title="You can configure a PDB snapshot carousel for a specified PDB, create snapshots manually or automatically, and set the maximum number of snapshots.">Administering a PDB Snapshot Carousel</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>