<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="SQL plan management is a preventative mechanism that enables the optimizer to automatically manage execution plans, ensuring that the database uses only known or verified plans.">
      <meta name="description" content="SQL plan management is a preventative mechanism that enables the optimizer to automatically manage execution plans, ensuring that the database uses only known or verified plans.">
      <title>Overview of SQL Plan Management</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="SQL Tuning Guide">
      <meta property="og:description" content="SQL plan management is a preventative mechanism that enables the optimizer to automatically manage execution plans, ensuring that the database uses only known or verified plans.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="SQL Tuning Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="sql-tuning-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-31T14:57:08-08:00">
      <meta name="dcterms.title" content="SQL Tuning Guide">
      <meta name="dcterms.dateCopyrighted" content="2013, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96095-03">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="managing-sql-profiles.html" title="Previous" type="text/html">
      <link rel="next" href="managing-sql-plan-baselines.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TGSQL">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="managing-sql-profiles.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="managing-sql-plan-baselines.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">SQL Tuning Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="sql-controls.html" property="item" typeof="WebPage"><span property="name">SQL Management Objects</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Overview of SQL Plan Management</li>
            </ol>
            <a id="GUID-F1C45056-F998-43E5-B362-83F88DA49E58" name="GUID-F1C45056-F998-43E5-B362-83F88DA49E58"></a><a id="TGSQL615"></a>
            
            <h2 id="TGSQL-GUID-F1C45056-F998-43E5-B362-83F88DA49E58" class="sect2"><span class="enumeration_chapter">27 </span>Overview of SQL Plan Management
            </h2>
         </header>
         <div class="ind">
            <div>
               <p><strong class="term">SQL plan management</strong> is a preventative mechanism that enables the optimizer to automatically manage execution plans, ensuring that the database uses only known or verified plans. 
               </p>
               <p>This chapter contains the following topics:</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="overview-of-sql-plan-management.html#GUID-8A14C53D-8C2E-41BD-8B1F-AF32B4193418">About SQL Plan Baselines</a><br>SQL plan management uses a mechanism called a <strong class="term">SQL plan baseline</strong>, which is a set of accepted plans that the optimizer is allowed to use for a SQL statement.
                  </li>
                  <li class="ulchildlink"><a href="overview-of-sql-plan-management.html#GUID-C4749F43-89C3-4C27-9ED1-DA0D34A05586">Purpose of SQL Plan Management</a><br>SQL plan management prevents performance regressions caused by plan changes. 
                  </li>
                  <li class="ulchildlink"><a href="overview-of-sql-plan-management.html#GUID-D09EA02C-12A8-439F-B06B-04C4D539BFCE">Plan Capture</a><br><strong class="term">SQL plan capture</strong> refers to techniques for capturing and storing relevant information about plans in the SQL Management Base for a set of SQL statements.
                  </li>
                  <li class="ulchildlink"><a href="overview-of-sql-plan-management.html#GUID-67A76171-62CB-49A5-B5BD-CFFE26511E90">Plan Selection</a><br><span class="bold">SQL plan selection</span> is the optimizer ability to detect plan changes based on stored plan history, and the use of SQL plan baselines to select plans to avoid potential performance regressions.
                  </li>
                  <li class="ulchildlink"><a href="overview-of-sql-plan-management.html#GUID-3AB2B2F2-A7CD-404C-A36D-8CB5AD5A78B4">Plan Evolution</a><br>In general, SQL <strong class="term">plan evolution</strong> is the process by which the optimizer verifies new plans and adds them to an existing SQL plan baseline. 
                  </li>
                  <li class="ulchildlink"><a href="overview-of-sql-plan-management.html#GUID-169AFEFC-6DB2-483B-90D3-877B0FD2AC67">Storage Architecture for SQL Plan Management</a><br>The SQL plan management infrastructure records the signatures of parsed statements, and both accepted and unaccepted plans.
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>Parent topic:</strong> <a href="sql-controls.html#GUID-2889EBC8-1FAD-412F-9779-865028473607" title="A SQL management object is a feature that stabilizes the execution plans of individual SQL statements. SQL profiles and SQL plan baselines are SQL management objects.">SQL Management Objects</a></p>
                  </div>
               </div>
            </div>
            
            <div class="sect2"><a id="GUID-8A14C53D-8C2E-41BD-8B1F-AF32B4193418" name="GUID-8A14C53D-8C2E-41BD-8B1F-AF32B4193418"></a><h3 id="TGSQL-GUID-8A14C53D-8C2E-41BD-8B1F-AF32B4193418" class="sect3"><span class="enumeration_section">27.1 </span>About SQL Plan Baselines
               </h3>
               <div>
                  <p>SQL plan management uses a mechanism called a <strong class="term">SQL plan baseline</strong>, which is a set of accepted plans that the optimizer is allowed to use for a SQL statement.
                  </p>
                  <p>In this context, a plan includes all plan-related information (for example, SQL plan identifier, set of hints, bind values, and optimizer environment) that the optimizer needs to reproduce an execution plan. The baseline is implemented as a set of plan rows and the outlines required to reproduce the plan. An outline is a set of optimizer hints used to force a specific plan.</p>
                  <p>The main components of SQL plan management are as follows:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Plan capture</p>
                        <p>This component stores relevant information about plans for a set of SQL statements.</p>
                     </li>
                     <li>
                        <p>Plan selection</p>
                        <p>This component is the detection by the optimizer of plan changes based on stored plan history, and the use of SQL plan baselines to select appropriate plans to avoid potential performance regressions.</p>
                     </li>
                     <li>
                        <p>Plan evolution</p>
                        <p>This component is the process of adding new plans to existing SQL plan baselines, either manually or automatically. In the typical use case, the database accepts a plan into the plan baseline only after verifying that the plan performs well.</p>
                     </li>
                  </ul>
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="overview-of-sql-plan-management.html#GUID-F1C45056-F998-43E5-B362-83F88DA49E58" title="SQL plan management is a preventative mechanism that enables the optimizer to automatically manage execution plans, ensuring that the database uses only known or verified plans.">Overview of SQL Plan Management</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="TGSQL617"></a><div class="props_rev_3"><a id="GUID-C4749F43-89C3-4C27-9ED1-DA0D34A05586" name="GUID-C4749F43-89C3-4C27-9ED1-DA0D34A05586"></a><h3 id="TGSQL-GUID-C4749F43-89C3-4C27-9ED1-DA0D34A05586" class="sect3"><span class="enumeration_section">27.2 </span>Purpose of SQL Plan Management
               </h3>
               <div>
                  <p>SQL plan management prevents performance regressions caused by plan changes. </p>
                  <p>A secondary goal is to gracefully adapt to changes such as new optimizer statistics or indexes by verifying and accepting only plan changes that improve performance.</p>
                  <div class="infoboxnote" id="GUID-C4749F43-89C3-4C27-9ED1-DA0D34A05586__GUID-87C898B3-4B7F-4FC0-8F09-F88670FE1118">
                     <p class="notep1">Note:</p>
                     <p>SQL plan baselines cannot help when an event has caused irreversible execution plan changes, such as dropping an index.</p>
                  </div>
                  <p>This section contains the following topics:</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="overview-of-sql-plan-management.html#GUID-F7111F80-83ED-42B2-B3DF-188A5C7427F4">Benefits of SQL Plan Management</a><br>SQL plan management can improve or preserve SQL performance in database upgrades and system and data changes.
                     </li>
                     <li class="ulchildlink"><a href="overview-of-sql-plan-management.html#GUID-27C85EB8-C4CE-40C5-B99C-F4ADDC09A617">Differences Between SQL Plan Baselines and SQL Profiles</a><br>Both SQL profiles and SQL plan baselines help improve the performance of SQL statements by ensuring that the optimizer uses only optimal plans. 
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="overview-of-sql-plan-management.html#GUID-F1C45056-F998-43E5-B362-83F88DA49E58" title="SQL plan management is a preventative mechanism that enables the optimizer to automatically manage execution plans, ensuring that the database uses only known or verified plans.">Overview of SQL Plan Management</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL780"></a><div class="props_rev_3"><a id="GUID-F7111F80-83ED-42B2-B3DF-188A5C7427F4" name="GUID-F7111F80-83ED-42B2-B3DF-188A5C7427F4"></a><h4 id="TGSQL-GUID-F7111F80-83ED-42B2-B3DF-188A5C7427F4" class="sect4"><span class="enumeration_section">27.2.1 </span>Benefits of SQL Plan Management
                  </h4>
                  <div>
                     <p>SQL plan management can improve or preserve SQL performance in database upgrades and system and data changes.</p>
                     <p>Specifically, benefits include:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>A database upgrade that installs a new optimizer version usually results in plan changes for a small percentage of SQL statements.</p>
                           <p>Most plan changes result in either improvement or no performance change. However, some plan changes may cause performance regressions. SQL plan baselines significantly minimize potential regressions resulting from an upgrade. </p>
                           <p>When you upgrade, the database only uses plans from the plan baseline. The database puts new plans that are not in the current baseline into a holding area, and later evaluates them to determine whether they use fewer resources than the current plan in the baseline. If the plans perform better, then the database promotes them into the baseline; otherwise, the database does not promote them.</p>
                        </li>
                        <li>
                           <p>Ongoing system and data changes can affect plans for some SQL statements, potentially causing performance regressions.</p>
                           <p>SQL plan baselines help minimize performance regressions and stabilize SQL performance.</p>
                        </li>
                        <li>
                           <p>Deployment of new application modules introduces new SQL statements into the database.</p>
                           <p>The application software may use appropriate SQL execution plans developed in a standard test configuration for the new statements. If the system configuration is significantly different from the test configuration, then the database can evolve SQL plan baselines over time to produce better performance.</p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-F7111F80-83ED-42B2-B3DF-188A5C7427F4__GUID-175522B5-5614-4790-8048-2D4AAA4CD717">
                        <p class="notep1">See Also:</p>
                        <p><a href="../upgrd/intro-to-upgrading-oracle-database.html#UPGRD001" target="_blank"><span class="italic">Oracle Database Upgrade Guide</span></a> to learn how to upgrade an Oracle database
                        </p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="overview-of-sql-plan-management.html#GUID-C4749F43-89C3-4C27-9ED1-DA0D34A05586" title="SQL plan management prevents performance regressions caused by plan changes.">Purpose of SQL Plan Management</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL781"></a><div class="props_rev_3"><a id="GUID-27C85EB8-C4CE-40C5-B99C-F4ADDC09A617" name="GUID-27C85EB8-C4CE-40C5-B99C-F4ADDC09A617"></a><h4 id="TGSQL-GUID-27C85EB8-C4CE-40C5-B99C-F4ADDC09A617" class="sect4"><span class="enumeration_section">27.2.2 </span>Differences Between SQL Plan Baselines and SQL Profiles
                  </h4>
                  <div>
                     <p>Both SQL profiles and SQL plan baselines help improve the performance of SQL statements by ensuring that the optimizer uses only optimal plans. </p>
                     <p>Both profiles and baselines are internally implemented using hints. However, these mechanisms have significant differences, including the following:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>In general, SQL plan baselines are proactive, whereas SQL profiles are reactive.</p>
                           <p>Typically, you create SQL plan baselines <span class="italic">before</span> significant performance problems occur. SQL plan baselines prevent the optimizer from using suboptimal plans in the future.
                           </p>
                           <p>The database creates SQL profiles when you invoke SQL Tuning Advisor, which you do typically only <span class="italic">after</span> a SQL statement has shown high-load symptoms. SQL profiles are primarily useful by providing the ongoing resolution of optimizer mistakes that have led to suboptimal plans. Because the SQL profile mechanism is reactive, it cannot guarantee stable performance as drastic database changes occur.
                           </p>
                           <div class="figure" id="GUID-27C85EB8-C4CE-40C5-B99C-F4ADDC09A617__GUID-5FDDC457-26D0-453B-8991-E6066D88AAB3">
                              <p class="titleinfigure">Figure 27-1 SQL Plan Baselines and SQL Profiles</p><img src="img/tgsql_vm_028.png" alt="Description of Figure 27-1 follows" title="Description of Figure 27-1 follows" longdesc="img_text/tgsql_vm_028.html"><br><a href="img_text/tgsql_vm_028.html">Description of "Figure 27-1 SQL Plan Baselines and SQL Profiles"</a></div>
                           <!-- class="figure" -->
                        </li>
                        <li>
                           <p>SQL plan baselines reproduce a specific plan, whereas SQL profiles correct optimizer cost estimates.</p>
                           <p>A SQL plan baseline is a set of accepted plans. Each plan is implemented using a set of outline hints that fully specify a particular plan. SQL profiles are also implemented using hints, but these hints do not specify any specific plan. Rather, the hints correct miscalculations in the optimizer estimates that lead to suboptimal plans. For example, a hint may correct the cardinality estimate of a table.</p>
                           <p>Because a profile does not constrain the optimizer to any one plan, a SQL profile is more flexible than a SQL plan baseline. For example, changes in initialization parameters and optimizer statistics enable the optimizer to choose a better plan.</p>
                        </li>
                     </ul>
                     <p>Oracle recommends that you use SQL Tuning Advisor. In this way, you follow the recommendations made by the advisor for SQL profiles and plan baselines rather than trying to determine which mechanism is best for each SQL statement.</p>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-27C85EB8-C4CE-40C5-B99C-F4ADDC09A617__GUID-0A19FE9C-0DDB-4830-9E95-DCA30532B662">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="q">"<a href="influencing-the-optimizer.html#GUID-B198573A-C64B-4071-9CD8-738355A20DD7" title="A hint is embedded within a SQL comment.">About Optimizer Hints</a>"</span></p>
                           </li>
                           <li>
                              <p><span class="q">"<a href="managing-sql-profiles.html#GUID-C7FE0936-63B8-46EF-A03E-7E59F704606E" title="When warranted, SQL Tuning Advisor recommends a SQL profile. You can use DBMS_SQLTUNE to implement, alter, drop, and transport SQL profiles.">Managing SQL Profiles</a>"</span></p>
                           </li>
                           <li>
                              <p><span class="q">"<a href="sql-tuning-advisor.html#GUID-8E1A39CB-A491-4254-8B31-9B1DF7B52AA1" title="Use SQL Tuning Advisor to obtain recommendations for improving performance of high-load SQL statements, and prevent regressions by only executing optimal plans.">Analyzing SQL with SQL Tuning Advisor</a>"</span></p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="overview-of-sql-plan-management.html#GUID-C4749F43-89C3-4C27-9ED1-DA0D34A05586" title="SQL plan management prevents performance regressions caused by plan changes.">Purpose of SQL Plan Management</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL784"></a><div class="props_rev_3"><a id="GUID-D09EA02C-12A8-439F-B06B-04C4D539BFCE" name="GUID-D09EA02C-12A8-439F-B06B-04C4D539BFCE"></a><h3 id="TGSQL-GUID-D09EA02C-12A8-439F-B06B-04C4D539BFCE" class="sect3"><span class="enumeration_section">27.3 </span>Plan Capture
               </h3>
               <div>
                  <p><strong class="term">SQL plan capture</strong> refers to techniques for capturing and storing relevant information about plans in the SQL Management Base for a set of SQL statements.
                  </p>
                  <p>Capturing a plan means making SQL plan management aware of this plan. You can configure initial plan capture to occur automatically by setting an initialization parameter, or you can capture plans manually by using the <code class="codeph">DBMS_SPM</code> package.
                  </p>
                  <p>This section contains the following topics:</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="overview-of-sql-plan-management.html#GUID-5A1E6CF4-70E5-4C26-A67B-EFDBB93EC621">Automatic Initial Plan Capture</a><br>When enabled, the database checks whether executed SQL statements are eligible for automatic capture.
                     </li>
                     <li class="ulchildlink"><a href="overview-of-sql-plan-management.html#GUID-30DAEDBC-9CA6-49AB-ADEB-AC0CBA128D43">Manual Plan Capture</a><br>In SQL plan management, <strong class="term">manual plan capture</strong> refers to the user-initiated bulk load of existing plans into a SQL plan baseline.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="overview-of-sql-plan-management.html#GUID-F1C45056-F998-43E5-B362-83F88DA49E58" title="SQL plan management is a preventative mechanism that enables the optimizer to automatically manage execution plans, ensuring that the database uses only known or verified plans.">Overview of SQL Plan Management</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL623"></a><div class="props_rev_3"><a id="GUID-5A1E6CF4-70E5-4C26-A67B-EFDBB93EC621" name="GUID-5A1E6CF4-70E5-4C26-A67B-EFDBB93EC621"></a><h4 id="TGSQL-GUID-5A1E6CF4-70E5-4C26-A67B-EFDBB93EC621" class="sect4"><span class="enumeration_section">27.3.1 </span>Automatic Initial Plan Capture
                  </h4>
                  <div>
                     <p>When enabled, the database checks whether executed SQL statements are eligible for automatic capture.</p>
                     <p>You can enable <strong class="term">automatic initial plan capture</strong> by setting <code class="codeph">OPTIMIZER_CAPTURE_SQL_PLAN_BASELINES</code> to <code class="codeph">true</code> (the default is <code class="codeph">false</code>). Note that the initialization parameter <code class="codeph">OPTIMIZER_USE_SQL_PLAN_BASELINES</code> is independent. For example, if <code class="codeph">OPTIMIZER_CAPTURE_SQL_PLAN_BASELINES</code> is <code class="codeph">true</code>, then the database creates initial plan baselines regardless of whether <code class="codeph">OPTIMIZER_USE_SQL_PLAN_BASELINES</code> is <code class="codeph">true</code> or <code class="codeph">false</code>.
                     </p>
                     <p>This section contains the following topics:</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="overview-of-sql-plan-management.html#GUID-A3A528EB-CC02-426D-90F7-3AE9FCBDC201">Eligibility for Automatic Initial Plan Capture</a><br>To be eligible for automatic plan capture, an executed statement must be repeatable, and it must not be excluded by any capture filters. 
                        </li>
                        <li class="ulchildlink"><a href="overview-of-sql-plan-management.html#GUID-09CD2E8A-902E-488F-8570-A5839643BF5E">Plan Matching for Automatic Initial Plan Capture</a><br>If the database executes a repeatable SQL statement, and if this statement passes through the <code class="codeph">DBMS_SPM.CONFIGURE</code> filters, then the database attempts to match a plan in the SQL plan baseline.
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-5A1E6CF4-70E5-4C26-A67B-EFDBB93EC621__GUID-702A2CBC-483F-4EF9-8594-4B9F839E3516">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="q">"<a href="overview-of-sql-plan-management.html#GUID-67A76171-62CB-49A5-B5BD-CFFE26511E90" title="SQL plan selection is the optimizer ability to detect plan changes based on stored plan history, and the use of SQL plan baselines to select plans to avoid potential performance regressions.">Plan Selection</a>"</span></p>
                           </li>
                           <li>
                              <p><a href="../refrn/OPTIMIZER_USE_SQL_PLAN_BASELINES.html#REFRN10293" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">OPTIMIZER_USE_SQL_PLAN_BASELINES</code> initialization parameter
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="overview-of-sql-plan-management.html#GUID-D09EA02C-12A8-439F-B06B-04C4D539BFCE" title="SQL plan capture refers to techniques for capturing and storing relevant information about plans in the SQL Management Base for a set of SQL statements.">Plan Capture</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="sect4"><a id="GUID-A3A528EB-CC02-426D-90F7-3AE9FCBDC201" name="GUID-A3A528EB-CC02-426D-90F7-3AE9FCBDC201"></a><h5 id="TGSQL-GUID-A3A528EB-CC02-426D-90F7-3AE9FCBDC201" class="sect5"><span class="enumeration_section">27.3.1.1 </span>Eligibility for Automatic Initial Plan Capture
                     </h5>
                     <div>
                        <p>To be eligible for automatic plan capture, an executed statement must be repeatable, and it must not be excluded by any capture filters. </p>
                        <p>By default, the database considers all repeatable SQL statements as eligible for capture, with the following exceptions:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">CREATE TABLE</code> when the <code class="codeph">AS SELECT</code> clause is <span class="italic">not</span> specified
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">DROP TABLE</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">INSERT INTO ... VALUES</code></p>
                           </li>
                        </ul>
                        <p>The first check for eligibility is repeated execution. If a statement is executed less than twice, then the database does not consider it eligible for a SQL plan baseline. If a statement is executed at least twice, then it is by definition repeatable, and so the database considers it eligible for further checking.</p>
                        <div class="infoboxnote" id="GUID-A3A528EB-CC02-426D-90F7-3AE9FCBDC201__GUID-27EA6C35-0D01-4CFF-B492-B6E002D44388">
                           <p class="notep1">Note:</p>
                           <p>SQL plan management does not protect statements that have been explained using <code class="codeph">EXPLAIN PLAN</code> but have not been executed.
                           </p>
                        </div>
                        <p>For repeatable statements, the <code class="codeph">DBMS_SPM.CONFIGURE</code> procedure enables you to create an <a href="glossary.html#GUID-B07EE39D-D28D-4BDE-BF79-356DDB5306BD"><span class="xrefglossterm">automatic capture filter</span></a>. Thus, you can capture only statements that you want, and exclude noncritical statements, thereby saving space in the <code class="codeph">SYSAUX</code> tablespace. Noncritical queries often have the following characteristics:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Not executed often enough to be significant</p>
                           </li>
                           <li>
                              <p>Not resource-intensive</p>
                           </li>
                           <li>
                              <p>Not sufficiently complex to benefit from SQL plan management</p>
                           </li>
                        </ul>
                        <p>For a specified parameter, a filter either includes (<code class="codeph">allow=&gt;TRUE</code>) or excludes (<code class="codeph">allow=&gt;FALSE</code>) plans for statements with the specified values. To be eligible for capture, a repeatable statement must not be <span class="italic">excluded</span> by any filter. The <code class="codeph">DBMS_SPM.CONFIGURE</code> procedure supports filters for SQL text, parsing schema name, module, and action.
                        </p>
                        <p>A null value for any parameter removes the filter. By using <code class="codeph">parameter_value=&gt;'%'</code> in combination with <code class="codeph">allow=FALSE</code>, you can filter out all values for a parameter, and then create a separate filter to include only specified values. The <code class="codeph">DBA_SQL_MANAGEMENT_CONFIG</code> view shows the current filters.
                        </p>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-A3A528EB-CC02-426D-90F7-3AE9FCBDC201__GUID-1988DD3F-9D2D-4BC8-8F8B-18AC0B989513">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="q">"<a href="managing-sql-plan-baselines.html#GUID-82EFB280-8868-47E1-8360-6A9CA995BD56" title="If OPTIMIZER_CAPTURE_SQL_PLAN_BASELINES=true, then you can use the DBMS_SPM.CONFIGURE procedure to create an automatic capture filter for repeatable statements.">Configuring Filters for Automatic Plan Capture</a>"</span></p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_SPM.html#ARPLS-GUID-D855D4B9-D071-4BB2-A554-38479867DE76" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about the <code class="codeph">DBMS_SPM.CONFIGURE</code> procedure
                                 </p>
                              </li>
                              <li>
                                 <p><a href="../refrn/DBA_SQL_MANAGEMENT_CONFIG.html#REFRN-GUID-4E9C3D2A-93B8-49C5-9169-C54A9EB7431C" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn more about the <code class="codeph">DBA_SQL_MANAGEMENT_CONFIG</code> view
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="overview-of-sql-plan-management.html#GUID-5A1E6CF4-70E5-4C26-A67B-EFDBB93EC621" title="When enabled, the database checks whether executed SQL statements are eligible for automatic capture.">Automatic Initial Plan Capture</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-09CD2E8A-902E-488F-8570-A5839643BF5E" name="GUID-09CD2E8A-902E-488F-8570-A5839643BF5E"></a><h5 id="TGSQL-GUID-09CD2E8A-902E-488F-8570-A5839643BF5E" class="sect5"><span class="enumeration_section">27.3.1.2 </span>Plan Matching for Automatic Initial Plan Capture
                     </h5>
                     <div>
                        <p>If the database executes a repeatable SQL statement, and if this statement passes through the <code class="codeph">DBMS_SPM.CONFIGURE</code> filters, then the database attempts to match a plan in the SQL plan baseline.
                        </p>
                        <p>For automatic initial plan capture, the plan matching algorithm is as follows:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>If a SQL plan baseline does <span class="italic">not</span> exist, then the optimizer creates a plan history and SQL plan baseline for the statement, marking the initial plan for the statement as accepted and adding it to the SQL plan baseline.
                              </p>
                           </li>
                           <li>
                              <p>If a SQL plan baseline exists, then the optimizer behavior depends on the cost-based plan derived at parse time:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>If this plan does <span class="italic">not</span> match a plan in the SQL plan baseline, then the optimizer marks the new plan as unaccepted and adds it to the SQL plan baseline.
                                    </p>
                                 </li>
                                 <li>
                                    <p>If this plan <span class="italic">does</span> match a plan in the SQL plan baseline, then nothing is added to the SQL plan baseline.
                                    </p>
                                 </li>
                              </ul>
                           </li>
                        </ul>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="overview-of-sql-plan-management.html#GUID-5A1E6CF4-70E5-4C26-A67B-EFDBB93EC621" title="When enabled, the database checks whether executed SQL statements are eligible for automatic capture.">Automatic Initial Plan Capture</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="TGSQL624"></a><div class="props_rev_3"><a id="GUID-30DAEDBC-9CA6-49AB-ADEB-AC0CBA128D43" name="GUID-30DAEDBC-9CA6-49AB-ADEB-AC0CBA128D43"></a><h4 id="TGSQL-GUID-30DAEDBC-9CA6-49AB-ADEB-AC0CBA128D43" class="sect4"><span class="enumeration_section">27.3.2 </span>Manual Plan Capture
                  </h4>
                  <div>
                     <p>In SQL plan management, <strong class="term">manual plan capture</strong> refers to the user-initiated bulk load of existing plans into a SQL plan baseline.
                     </p>
                     <p>Use Cloud Control or PL/SQL to load the execution plans for SQL statements from <a href="glossary.html#GUID-FFE0E053-D523-4035-AC92-7121EF756610"><span class="xrefglossterm">AWR</span></a>, a <a href="glossary.html#GUID-52FB0AE5-7346-44E5-BE92-3C09385B1DDC"><span class="xrefglossterm">SQL tuning set (STS)</span></a>, the <a href="glossary.html#GUID-577D0DD3-FB98-4B1B-BCFB-95313BB35C01"><span class="xrefglossterm">shared SQL area</span></a>, a staging table, or a <a href="glossary.html#GUID-A1BD6A75-73B9-4F68-8FD6-A89057E95ADF"><span class="xrefglossterm">stored outline</span></a>.
                     </p>
                     <div class="figure" id="GUID-30DAEDBC-9CA6-49AB-ADEB-AC0CBA128D43__GUID-8906F5AC-F4C7-4658-8C97-EAC577D1235E">
                        <p class="titleinfigure">Figure 27-2 Loading Plans into a SQL Plan Baseline</p><img src="img/tgsql_vm_007.png" alt="Description of Figure 27-2 follows" title="Description of Figure 27-2 follows" longdesc="img_text/tgsql_vm_007.html"><br><a href="img_text/tgsql_vm_007.html">Description of "Figure 27-2 Loading Plans into a SQL Plan Baseline"</a></div>
                     <!-- class="figure" -->
                     <p>The loading behavior varies depending on whether a SQL plan baseline exists for each statement represented in the bulk load:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>If a baseline for the statement does not exist, then the database does the following:</p>
                           <ol>
                              <li>
                                 <p>Creates a plan history and plan baseline for the statement</p>
                              </li>
                              <li>
                                 <p>Marks the initial plan for the statement as accepted </p>
                              </li>
                              <li>
                                 <p>Adds the plan to the new baseline</p>
                              </li>
                           </ol>
                        </li>
                        <li>
                           <p>If a baseline for the statement exists, then the database does the following:</p>
                           <ol>
                              <li>
                                 <p>Marks the loaded plan as accepted</p>
                              </li>
                              <li>
                                 <p>Adds the plan to the plan baseline for the statement <span class="italic">without</span> verifying the plan's performance
                                 </p>
                              </li>
                           </ol>
                        </li>
                     </ul>
                     <p>Manually loaded plans are always marked accepted because the optimizer assumes that any plan loaded manually by the administrator has acceptable performance. You can load plans without enabling them by setting the <code class="codeph">enabled</code> parameter to <code class="codeph">NO</code> in the <code class="codeph">DBMS_SPM.LOAD_PLANS_FROM_<span class="codeinlineitalic">%</span></code> functions.
                     </p>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-30DAEDBC-9CA6-49AB-ADEB-AC0CBA128D43__GUID-FE1F2FF2-A733-438C-B80F-621BA916D30D">
                        <p class="notep1">See Also:</p>
                        <p><a href="../arpls/DBMS_SPM.html#GUID-74594B3C-6D36-4008-8E2E-20EEB278D0BB" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about the <code class="codeph">DBMS_SPM.LOAD_PLANS_FROM_<span class="codeinlineitalic">%</span></code> functions
                        </p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="overview-of-sql-plan-management.html#GUID-D09EA02C-12A8-439F-B06B-04C4D539BFCE" title="SQL plan capture refers to techniques for capturing and storing relevant information about plans in the SQL Management Base for a set of SQL statements.">Plan Capture</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL625"></a><div class="props_rev_3"><a id="GUID-67A76171-62CB-49A5-B5BD-CFFE26511E90" name="GUID-67A76171-62CB-49A5-B5BD-CFFE26511E90"></a><h3 id="TGSQL-GUID-67A76171-62CB-49A5-B5BD-CFFE26511E90" class="sect3"><span class="enumeration_section">27.4 </span>Plan Selection
               </h3>
               <div>
                  <p><span class="bold">SQL plan selection</span> is the optimizer ability to detect plan changes based on stored plan history, and the use of SQL plan baselines to select plans to avoid potential performance regressions.
                  </p>
                  <p>When the database performs a <a href="glossary.html#GUID-AB764C9E-2F03-49A9-BF8B-36A9FBD03BCE"><span class="xrefglossterm">hard parse</span></a> of a SQL statement, the optimizer generates a best-cost plan. By default, the optimizer then attempts to find a matching plan in the SQL plan baseline for the statement. If no plan baseline exists, then the database runs the statement with the best-cost plan.
                  </p>
                  <p>If a plan baseline exists, then the optimizer behavior depends on whether the newly generated plan is in the plan baseline:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>If the new plan is in the baseline, then the database executes the statement using the found plan.</p>
                     </li>
                     <li>
                        <p>If the new plan is <span class="italic">not</span> in the baseline, then the optimizer marks the newly generated plan as unaccepted and adds it to the plan history. Optimizer behavior depends on the contents of the plan baseline:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>If fixed plans exist in the plan baseline, then the optimizer uses the fixed plan with the lowest cost.</p>
                           </li>
                           <li>
                              <p>If no fixed plans exist in the plan baseline, then the optimizer uses the baseline plan with the lowest cost.</p>
                           </li>
                           <li>
                              <p>If no reproducible plans exist in the plan baseline, which could happen if every plan in the baseline referred to a dropped index, then the optimizer uses the newly generated cost-based plan.</p>
                           </li>
                        </ul>
                     </li>
                  </ul>
                  <div class="figure" id="GUID-67A76171-62CB-49A5-B5BD-CFFE26511E90__GUID-FFFD0C0C-A746-401F-A4F4-42E194C95745">
                     <p class="titleinfigure">Figure 27-3 Decision Tree for SQL Plan Selection</p><img src="img/tgsql_vm_003.png" alt="Description of Figure 27-3 follows" title="Description of Figure 27-3 follows" longdesc="img_text/tgsql_vm_003.html"><br><a href="img_text/tgsql_vm_003.html">Description of "Figure 27-3 Decision Tree for SQL Plan Selection"</a></div>
                  <!-- class="figure" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-67A76171-62CB-49A5-B5BD-CFFE26511E90__GUID-2341897B-8CE7-4E1A-9507-985B3F8F531C">
                     <p class="notep1">See Also:</p>
                     <p><span class="q">"<a href="overview-of-sql-plan-management.html#GUID-B51FBAA9-EE95-4F19-AD4B-F5F4C2910688" title="A fixed plan is an accepted plan that is marked as preferred, so that the optimizer considers only the fixed plans in the baseline. Fixed plans influence the plan selection process of the optimizer.">Fixed Plans</a>"</span></p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="overview-of-sql-plan-management.html#GUID-F1C45056-F998-43E5-B362-83F88DA49E58" title="SQL plan management is a preventative mechanism that enables the optimizer to automatically manage execution plans, ensuring that the database uses only known or verified plans.">Overview of SQL Plan Management</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="TGSQL626"></a><div class="props_rev_3"><a id="GUID-3AB2B2F2-A7CD-404C-A36D-8CB5AD5A78B4" name="GUID-3AB2B2F2-A7CD-404C-A36D-8CB5AD5A78B4"></a><h3 id="TGSQL-GUID-3AB2B2F2-A7CD-404C-A36D-8CB5AD5A78B4" class="sect3"><span class="enumeration_section">27.5 </span>Plan Evolution
               </h3>
               <div>
                  <p>In general, SQL <strong class="term">plan evolution</strong> is the process by which the optimizer verifies new plans and adds them to an existing SQL plan baseline. 
                  </p>
                  <p>This section contains the following topics:</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="overview-of-sql-plan-management.html#GUID-FD80224B-A2DD-4C9D-A35B-879A55BA6A45">Purpose of Plan Evolution</a><br>Typically, a SQL plan baseline for a statement starts with one accepted plan.
                     </li>
                     <li class="ulchildlink"><a href="overview-of-sql-plan-management.html#GUID-E24924CE-81F3-41DF-8469-9BBA8C386E47">How Plan Evolution Works</a><br>Plan evolution involves both verifying and adding plans.
                     </li>
                     <li class="ulchildlink"><a href="overview-of-sql-plan-management.html#GUID-55CF99F0-41E0-4160-8789-422689C74AD8">PL/SQL Subprograms for Plan Evolution</a><br>The <code class="codeph">DBMS_SPM</code> package provides procedures and functions for plan evolution. 
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="overview-of-sql-plan-management.html#GUID-F1C45056-F998-43E5-B362-83F88DA49E58" title="SQL plan management is a preventative mechanism that enables the optimizer to automatically manage execution plans, ensuring that the database uses only known or verified plans.">Overview of SQL Plan Management</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL94644"></a><div class="props_rev_3"><a id="GUID-FD80224B-A2DD-4C9D-A35B-879A55BA6A45" name="GUID-FD80224B-A2DD-4C9D-A35B-879A55BA6A45"></a><h4 id="TGSQL-GUID-FD80224B-A2DD-4C9D-A35B-879A55BA6A45" class="sect4"><span class="enumeration_section">27.5.1 </span>Purpose of Plan Evolution
                  </h4>
                  <div>
                     <p>Typically, a SQL plan baseline for a statement starts with one accepted plan.</p>
                     <p>However, some SQL statements perform well when executed with different plans under different conditions. For example, a SQL statement with bind variables whose values result in different selectivities may have several optimal plans. Creating a materialized view or an index or repartitioning a table may make current plans more expensive than other plans.</p>
                     <p>If new plans were never added to SQL plan baselines, then the performance of some SQL statements might degrade. Thus, it is sometimes necessary to evolve newly accepted plans into SQL plan baselines. Plan evolution prevents performance regressions by verifying the performance of a new plan before including it in a SQL plan baseline.</p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="overview-of-sql-plan-management.html#GUID-3AB2B2F2-A7CD-404C-A36D-8CB5AD5A78B4" title="In general, SQL plan evolution is the process by which the optimizer verifies new plans and adds them to an existing SQL plan baseline.">Plan Evolution</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-E24924CE-81F3-41DF-8469-9BBA8C386E47" name="GUID-E24924CE-81F3-41DF-8469-9BBA8C386E47"></a><h4 id="TGSQL-GUID-E24924CE-81F3-41DF-8469-9BBA8C386E47" class="sect4"><span class="enumeration_section">27.5.2 </span>How Plan Evolution Works
                  </h4>
                  <div>
                     <p>Plan evolution involves both verifying and adding plans.</p>
                     <p>Specifically, plan evolution consists of the following distinct steps:</p>
                     <ol>
                        <li>
                           <p>Verifying</p>
                           <p> The optimizer ensures that unaccepted plans perform at least as well as accepted plans in a SQL plan baseline (known as <a href="glossary.html#GUID-B1FE5553-56FF-440B-B37A-D024CFA679A9"><span class="xrefglossterm">plan verification</span></a>).
                           </p>
                        </li>
                        <li>
                           <p>Adding</p>
                           <p>After the database has proved that unaccepted plans perform as well as accepted plans, the database adds the plans to the baseline.</p>
                        </li>
                     </ol>
                     <p>In the standard case of plan evolution, the optimizer performs the preceding steps sequentially, so that a new plan is not usable by SQL plan management until the optimizer verifies plan performance relative to the SQL plan baseline. However, you can configure SQL plan management to perform one step without performing the other. The following graphic shows the possible paths for plan evolution.</p>
                     <div class="figure" id="GUID-E24924CE-81F3-41DF-8469-9BBA8C386E47__GUID-D69F3046-5A51-47E4-BDD1-086E2AB4821F">
                        <p class="titleinfigure">Figure 27-4 Plan Evolution</p><img src="img/tgsql_vm_023.png" alt="Description of Figure 27-4 follows" title="Description of Figure 27-4 follows" longdesc="img_text/tgsql_vm_023.html"><br><a href="img_text/tgsql_vm_023.html">Description of "Figure 27-4 Plan Evolution"</a></div>
                     <!-- class="figure" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="overview-of-sql-plan-management.html#GUID-3AB2B2F2-A7CD-404C-A36D-8CB5AD5A78B4" title="In general, SQL plan evolution is the process by which the optimizer verifies new plans and adds them to an existing SQL plan baseline.">Plan Evolution</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL94645"></a><div class="props_rev_3"><a id="GUID-55CF99F0-41E0-4160-8789-422689C74AD8" name="GUID-55CF99F0-41E0-4160-8789-422689C74AD8"></a><h4 id="TGSQL-GUID-55CF99F0-41E0-4160-8789-422689C74AD8" class="sect4"><span class="enumeration_section">27.5.3 </span>PL/SQL Subprograms for Plan Evolution
                  </h4>
                  <div>
                     <p>The <code class="codeph">DBMS_SPM</code> package provides procedures and functions for plan evolution. 
                     </p>
                     <p>These subprograms use the task infrastructure. For example, <code class="codeph">CREATE_EVOLVE_TASK</code> creates an evolution task, whereas <code class="codeph">EXECUTE_EVOLVE_TASK</code> executes it. All task evolution subprograms have the string <code class="codeph">EVOLVE_TASK</code> in the name. 
                     </p>
                     <p>Use the evolve procedures on demand, or configure the subprograms to run automatically. The automatic maintenance task <code class="codeph">SYS_AUTO_SPM_EVOLVE_TASK</code> executes daily in the scheduled maintenance window. The task perform the following actions automatically:
                     </p>
                     <ol>
                        <li>
                           <p>Selects and ranks unaccepted plans for verification</p>
                        </li>
                        <li>
                           <p>Accepts each plan if it satisfies the performance threshold</p>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-55CF99F0-41E0-4160-8789-422689C74AD8__GUID-846EE365-DA79-4BD8-A963-4B10107F382C">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="q">"<a href="managing-sql-plan-baselines.html#GUID-A94CFA49-910A-4237-A7BB-39BFA94E227E" title="SPM Evolve Advisor is a SQL advisor that evolves plans that have recently been added to the SQL plan baseline. The advisor simplifies plan evolution by eliminating the requirement to do it manually.">Managing the SPM Evolve Advisor Task</a>"</span></p>
                           </li>
                           <li>
                              <p><span class="q">"<a href="managing-sql-plan-baselines.html#GUID-19E6FFB0-BC7A-4CDB-AE36-6D67C15C7332" title="You can use PL/SQL or Cloud Control to manually evolve an unaccepted plan to determine whether it performs better than any plan currently in the plan baseline.">Evolving SQL Plan Baselines Manually</a>"</span></p>
                           </li>
                           <li>
                              <p><a href="../arpls/DBMS_SPM.html#ARPLS150" target="_blank"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> to learn about the <code class="codeph">DBMS_SPM</code> package
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="overview-of-sql-plan-management.html#GUID-3AB2B2F2-A7CD-404C-A36D-8CB5AD5A78B4" title="In general, SQL plan evolution is the process by which the optimizer verifies new plans and adds them to an existing SQL plan baseline.">Plan Evolution</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL630"></a><div class="props_rev_3"><a id="GUID-169AFEFC-6DB2-483B-90D3-877B0FD2AC67" name="GUID-169AFEFC-6DB2-483B-90D3-877B0FD2AC67"></a><h3 id="TGSQL-GUID-169AFEFC-6DB2-483B-90D3-877B0FD2AC67" class="sect3"><span class="enumeration_section">27.6 </span>Storage Architecture for SQL Plan Management
               </h3>
               <div>
                  <p>The SQL plan management infrastructure records the signatures of parsed statements, and both accepted and unaccepted plans.</p>
                  <p>This section contains the following topics:</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="overview-of-sql-plan-management.html#GUID-EA548FAC-B350-4F31-96E9-8541AA8AC267">SQL Management Base</a><br>The <span class="bold">SQL management base (SMB)</span> is a logical repository in the data dictionary.
                     </li>
                     <li class="ulchildlink"><a href="overview-of-sql-plan-management.html#GUID-AEF0CAF0-49A5-4EDB-9D91-6E033912593B">SQL Statement Log</a><br>When automatic SQL plan capture is enabled, the <strong class="term">SQL statement log</strong> contains the signature of statements that the optimizer has evaluated over time.
                     </li>
                     <li class="ulchildlink"><a href="overview-of-sql-plan-management.html#GUID-BC65F4D4-1CEE-4014-8188-C849A0D9251A">SQL Plan History</a><br>The <strong class="term">SQL plan history</strong> is the set of captured SQL execution plans. The history contains both SQL plan baselines and unaccepted plans.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="overview-of-sql-plan-management.html#GUID-F1C45056-F998-43E5-B362-83F88DA49E58" title="SQL plan management is a preventative mechanism that enables the optimizer to automatically manage execution plans, ensuring that the database uses only known or verified plans.">Overview of SQL Plan Management</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL631"></a><div class="props_rev_3"><a id="GUID-EA548FAC-B350-4F31-96E9-8541AA8AC267" name="GUID-EA548FAC-B350-4F31-96E9-8541AA8AC267"></a><h4 id="TGSQL-GUID-EA548FAC-B350-4F31-96E9-8541AA8AC267" class="sect4"><span class="enumeration_section">27.6.1 </span>SQL Management Base
                  </h4>
                  <div>
                     <p>The <span class="bold">SQL management base (SMB)</span> is a logical repository in the data dictionary.
                     </p>
                     <p> The SMB contains the following:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>SQL statement log, which contains only SQL IDs</p>
                        </li>
                        <li>
                           <p>SQL plan history, which includes the SQL plan baselines</p>
                        </li>
                        <li>
                           <p>SQL profiles</p>
                        </li>
                        <li>
                           <p>SQL patches</p>
                        </li>
                     </ul>
                     <p>The SMB stores information that the optimizer can use to maintain or improve SQL performance.</p>
                     <p>The SMB resides in the <code class="codeph">SYSAUX</code> tablespace and uses automatic segment-space management. Because the SMB is located entirely within the <code class="codeph">SYSAUX</code> tablespace, the database does not use SQL plan management and SQL tuning features when this tablespace is unavailable.
                     </p>
                     <div class="figure" id="GUID-EA548FAC-B350-4F31-96E9-8541AA8AC267__GUID-432F6017-93B1-4911-9548-4D4678FAD60F">
                        <p class="titleinfigure">Figure 27-5 SMB Architecture</p><img src="img/tgsql_vm_002.png" alt="Description of Figure 27-5 follows" title="Description of Figure 27-5 follows" longdesc="img_text/tgsql_vm_002.html"><br><a href="img_text/tgsql_vm_002.html">Description of "Figure 27-5 SMB Architecture"</a></div>
                     <!-- class="figure" -->
                     <div class="infoboxnote" id="GUID-EA548FAC-B350-4F31-96E9-8541AA8AC267__GUID-EF62AAA7-B016-4AEA-99CF-D51450C324E3">
                        <p class="notep1">Note:</p>
                        <p>Data visibility and privilege requirements may differ when using the SMB with pluggable databases. See <a href="../multi/administering-a-cdb-with-sql-plus.html#ADMIN13885" target="_blank"><span><cite>Oracle Database Administrators Guide</cite></span></a> for a table that summarizes how manageability features work in a container database (CDB).
                        </p>
                     </div>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-EA548FAC-B350-4F31-96E9-8541AA8AC267__GUID-91DF20B2-AB42-4B8D-BF4D-1ACD2C081E9D">
                        <p class="notep1">See Also:</p>
                        <p><a href="../admin/creating-and-configuring-an-oracle-database.html#ADMIN00203" target="_blank"><span><cite>Oracle Database Administrators Guide</cite></span></a> to learn about the <code class="codeph">SYSAUX</code> tablespace
                        </p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="overview-of-sql-plan-management.html#GUID-169AFEFC-6DB2-483B-90D3-877B0FD2AC67" title="The SQL plan management infrastructure records the signatures of parsed statements, and both accepted and unaccepted plans.">Storage Architecture for SQL Plan Management</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL633"></a><a id="TGSQL632"></a><div class="props_rev_3"><a id="GUID-AEF0CAF0-49A5-4EDB-9D91-6E033912593B" name="GUID-AEF0CAF0-49A5-4EDB-9D91-6E033912593B"></a><h4 id="TGSQL-GUID-AEF0CAF0-49A5-4EDB-9D91-6E033912593B" class="sect4"><span class="enumeration_section">27.6.2 </span>SQL Statement Log
                  </h4>
                  <div>
                     <p>When automatic SQL plan capture is enabled, the <strong class="term">SQL statement log</strong> contains the signature of statements that the optimizer has evaluated over time.
                     </p>
                     <p>A <a href="glossary.html#GUID-160EB64E-536F-4313-B7B0-191C2719CF1F"><span class="xrefglossterm">SQL signature</span></a> is a numeric hash value computed using a SQL statement text that has been normalized for case insensitivity and white space. When the optimizer parses a statement, it creates signature. 
                     </p>
                     <p>During automatic capture, the database matches this signature against the SQL statement log (<code class="codeph">SQLLOG$</code>) to determine whether the signature has been observed before. If it has not, then the database adds the signature to the log. If the signature is already in the log, then the database has confirmation that the statement is a <a href="glossary.html#GUID-FB73DB1A-CF56-4A19-8AFD-E5C2E0C5BDDB"><span class="xrefglossterm">repeatable SQL statement</span></a>.
                     </p>
                     <div class="infoboxnote" id="GUID-AEF0CAF0-49A5-4EDB-9D91-6E033912593B__GUID-CC01A03D-5249-44C0-A592-2BF6CDE288CF">
                        <p class="notep1">Note:</p>
                        <p>If a filter excludes a statement, then its signature is also excluded from the log.</p>
                     </div>
                     <div class="example" id="GUID-AEF0CAF0-49A5-4EDB-9D91-6E033912593B__GUID-4999E3B0-1798-46F3-A509-F4CF74B5D63C">
                        <p class="titleinexample">Example 27-1 Logging SQL Statements</p>
                        <p>This example illustrates how the database tracks statements in the statement log and creates baselines automatically for repeatable statements. An initial query of the statement log shows no tracked SQL statements. After a query of <code class="codeph">hr.jobs</code> for <code class="codeph">AD_PRES</code>, the log shows one tracked statement.
                        </p><pre class="pre codeblock"><code>SQL&gt; ALTER SYSTEM SET OPTIMIZER_CAPTURE_SQL_PLAN_BASELINES=true;

System altered.

SQL&gt; SELECT * FROM SQLLOG$;
 
no rows selected
 
SQL&gt; SELECT job_title FROM hr.jobs WHERE job_id = 'AD_PRES';
 
JOB_TITLE
-----------------------------------
President
 
SQL&gt; SELECT * FROM SQLLOG$;
 
 SIGNATURE     BATCH#
---------- ----------
1.8096E+19          1
</code></pre><p>Now the session executes a different <code class="codeph">jobs</code> query. The log shows two tracked statements:
                        </p><pre class="pre codeblock"><code>SQL&gt; SELECT job_title FROM hr.jobs WHERE job_id='PR_REP';
 
JOB_TITLE
-----------------------------------
Public Relations Representative
 
SQL&gt; SELECT * FROM SQLLOG$;
 
 SIGNATURE     BATCH#
---------- ----------
1.7971E+19          1
1.8096E+19          1
</code></pre><p>A query of <code class="codeph">DBA_SQL_PLAN_BASELINES</code> shows that no baseline for either statement exists because neither statement is repeatable:
                        </p><pre class="pre codeblock"><code>SQL&gt; SELECT SQL_HANDLE, SQL_TEXT 
  2  FROM DBA_SQL_PLAN_BASELINES 
  3  WHERE SQL_TEXT LIKE 'SELECT job_title%';
 
no rows selected
</code></pre><p>The session executes the query for <code class="codeph">job_id='PR_REP'</code> a second time. Because this statement is now repeatable, and because automatic SQL plan capture is enabled, the database creates a plan baseline for this statement. The query for <code class="codeph">job_id='AD_PRES'</code> has only been executed once, so no plan baseline exists for it.
                        </p><pre class="pre codeblock"><code>SQL&gt; SELECT job_title FROM hr.jobs WHERE job_id='PR_REP';
 
JOB_TITLE
-----------------------------------
Public Relations Representative
 
SQL&gt; SELECT SQL_HANDLE, SQL_TEXT 
  2  FROM DBA_SQL_PLAN_BASELINES 
  3  WHERE SQL_TEXT LIKE 'SELECT job_title%';
 
SQL_HANDLE           SQL_TEXT
-------------------- --------------------
SQL_f9676a330f972dd5 SELECT job_title FRO
                     M hr.jobs WHERE job_
                     id='PR_REP'</code></pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-AEF0CAF0-49A5-4EDB-9D91-6E033912593B__GUID-E2E86269-EB9F-4E8E-8525-C34D6ABD7A10">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="q">"<a href="overview-of-sql-plan-management.html#GUID-5A1E6CF4-70E5-4C26-A67B-EFDBB93EC621" title="When enabled, the database checks whether executed SQL statements are eligible for automatic capture.">Automatic Initial Plan Capture</a>"</span></p>
                           </li>
                           <li>
                              <p><a href="../refrn/DBA_SQL_PLAN_BASELINES.html#REFRN23714" target="_blank"><span class="italic">Oracle Database Reference</span></a> to learn about <code class="codeph">DBA_SQL_PLAN_BASELINES</code></p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="overview-of-sql-plan-management.html#GUID-169AFEFC-6DB2-483B-90D3-877B0FD2AC67" title="The SQL plan management infrastructure records the signatures of parsed statements, and both accepted and unaccepted plans.">Storage Architecture for SQL Plan Management</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL634"></a><div class="props_rev_3"><a id="GUID-BC65F4D4-1CEE-4014-8188-C849A0D9251A" name="GUID-BC65F4D4-1CEE-4014-8188-C849A0D9251A"></a><h4 id="TGSQL-GUID-BC65F4D4-1CEE-4014-8188-C849A0D9251A" class="sect4"><span class="enumeration_section">27.6.3 </span>SQL Plan History
                  </h4>
                  <div>
                     <p>The <strong class="term">SQL plan history</strong> is the set of captured SQL execution plans. The history contains both SQL plan baselines and unaccepted plans.
                     </p>
                     <p>In SQL plan management, the database detects new SQL execution plans for existing SQL plan baselines and records the new plan in the history so that they can be evolved (verified). Evolution is initiated automatically by the database or manually by the DBA.</p>
                     <p>Starting in <span>Oracle Database 12c</span>, the SMB stores the execution plans for all SQL statements in the SQL plan history. The <code class="codeph">DBMS_XPLAN.DISPLAY_SQL_PLAN_BASELINE</code> function fetches and displays the plan from the SMB. For plans created before <span>Oracle Database 12c</span>, the function must compile the SQL statement and generate the plan because the SMB does not store it.
                     </p>
                     <p>This section contains the following topics:</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="overview-of-sql-plan-management.html#GUID-7ACCE857-4A76-4459-862D-50969C74D56B">Enabled Plans</a><br>An <span class="bold">enabled plan</span> is a plan that is eligible for use by the optimizer.
                        </li>
                        <li class="ulchildlink"><a href="overview-of-sql-plan-management.html#GUID-AABE25C1-55BD-40F4-AB79-28B4373D545D">Accepted Plans</a><br>An <span class="bold">accepted plan</span> is a plan that is in a SQL plan baseline for a SQL statement and thus available for use by the optimizer. An accepted plan contains a set of hints, a plan hash value, and other plan-related information.
                        </li>
                        <li class="ulchildlink"><a href="overview-of-sql-plan-management.html#GUID-B51FBAA9-EE95-4F19-AD4B-F5F4C2910688">Fixed Plans</a><br>A <span class="bold">fixed plan</span> is an accepted plan that is marked as preferred, so that the optimizer considers only the fixed plans in the baseline. Fixed plans influence the plan selection process of the optimizer.
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-BC65F4D4-1CEE-4014-8188-C849A0D9251A__GUID-3178121F-8E7C-4B67-876B-6E444A163B38">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="q">"<a href="managing-sql-plan-baselines.html#GUID-582BC3FB-2F52-4190-B807-16B79346B776" title="To view the plans stored in the SQL plan baseline for a specific statement, use the DBMS_XPLAN.DISPLAY_SQL_PLAN_BASELINE function. This function uses plan information stored in the plan history to display the plans.">Displaying Plans in a SQL Plan Baseline</a>"</span></p>
                           </li>
                           <li>
                              <p><a href="../arpls/DBMS_XPLAN.html#ARPLS70138" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_XPLAN.DISPLAY_SQL_PLAN_BASELINE</code> function
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="overview-of-sql-plan-management.html#GUID-169AFEFC-6DB2-483B-90D3-877B0FD2AC67" title="The SQL plan management infrastructure records the signatures of parsed statements, and both accepted and unaccepted plans.">Storage Architecture for SQL Plan Management</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL635"></a><div class="props_rev_3"><a id="GUID-7ACCE857-4A76-4459-862D-50969C74D56B" name="GUID-7ACCE857-4A76-4459-862D-50969C74D56B"></a><h5 id="TGSQL-GUID-7ACCE857-4A76-4459-862D-50969C74D56B" class="sect5"><span class="enumeration_section">27.6.3.1 </span>Enabled Plans
                     </h5>
                     <div>
                        <p>An <span class="bold">enabled plan</span> is a plan that is eligible for use by the optimizer.
                        </p>
                        <p>When plans are loaded with the <code class="codeph">enabled</code> parameter set to <code class="codeph">YES</code> (default), the database automatically marks the resulting SQL plan baselines as enabled, even if they are unaccepted. You can manually change an enabled plan to a <a href="glossary.html#GUID-A8FEC167-D149-4AC8-9FD5-B2E698026021"><span class="xrefglossterm">disabled plan</span></a>, which means the optimizer can no longer use the plan even if it is accepted.
                        </p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="overview-of-sql-plan-management.html#GUID-BC65F4D4-1CEE-4014-8188-C849A0D9251A" title="The SQL plan history is the set of captured SQL execution plans. The history contains both SQL plan baselines and unaccepted plans.">SQL Plan History</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL637"></a><a id="TGSQL636"></a><div class="props_rev_3"><a id="GUID-AABE25C1-55BD-40F4-AB79-28B4373D545D" name="GUID-AABE25C1-55BD-40F4-AB79-28B4373D545D"></a><h5 id="TGSQL-GUID-AABE25C1-55BD-40F4-AB79-28B4373D545D" class="sect5"><span class="enumeration_section">27.6.3.2 </span>Accepted Plans
                     </h5>
                     <div>
                        <p>An <span class="bold">accepted plan</span> is a plan that is in a SQL plan baseline for a SQL statement and thus available for use by the optimizer. An accepted plan contains a set of hints, a plan hash value, and other plan-related information.
                        </p>
                        <p>The SQL plan history for a statement contains all plans, both accepted and unaccepted. After the optimizer generates the first accepted plan in a plan baseline, every subsequent <a href="glossary.html#GUID-C02667C0-BF55-4CCE-B347-71CE5C3B6F1B"><span class="xrefglossterm">unaccepted plan</span></a> is added to the plan history, awaiting verification, but is not in the SQL plan baseline.
                        </p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="overview-of-sql-plan-management.html#GUID-BC65F4D4-1CEE-4014-8188-C849A0D9251A" title="The SQL plan history is the set of captured SQL execution plans. The history contains both SQL plan baselines and unaccepted plans.">SQL Plan History</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL639"></a><a id="TGSQL638"></a><div class="props_rev_3"><a id="GUID-B51FBAA9-EE95-4F19-AD4B-F5F4C2910688" name="GUID-B51FBAA9-EE95-4F19-AD4B-F5F4C2910688"></a><h5 id="TGSQL-GUID-B51FBAA9-EE95-4F19-AD4B-F5F4C2910688" class="sect5"><span class="enumeration_section">27.6.3.3 </span>Fixed Plans
                     </h5>
                     <div>
                        <p>A <span class="bold">fixed plan</span> is an accepted plan that is marked as preferred, so that the optimizer considers only the fixed plans in the baseline. Fixed plans influence the plan selection process of the optimizer.
                        </p>
                        <p>Assume that three plans exist in the SQL plan baseline for a statement. You want the optimizer to give preferential treatment to only two of the plans. As shown in the following figure, you mark these two plans as fixed so that the optimizer uses only the best plan from these two, ignoring the other plans.</p>
                        <div class="figure" id="GUID-B51FBAA9-EE95-4F19-AD4B-F5F4C2910688__CDEDDDAE">
                           <p class="titleinfigure">Figure 27-6 Fixed Plans</p><img src="img/tgsql_vm_008.png" alt="Description of Figure 27-6 follows" title="Description of Figure 27-6 follows" longdesc="img_text/tgsql_vm_008.html"><br><a href="img_text/tgsql_vm_008.html">Description of "Figure 27-6 Fixed Plans"</a></div>
                        <!-- class="figure" -->
                        <p>If new plans are added to a baseline that contains at least one enabled fixed plan, then the optimizer cannot use the new plans until you manually declare them as fixed.</p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="overview-of-sql-plan-management.html#GUID-BC65F4D4-1CEE-4014-8188-C849A0D9251A" title="The SQL plan history is the set of captured SQL execution plans. The history contains both SQL plan baselines and unaccepted plans.">SQL Plan History</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>