<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="Cursor sharing can improve database application performance by orders of magnitude.">
      <meta name="description" content="Cursor sharing can improve database application performance by orders of magnitude.">
      <title>Improving Real-World Performance Through Cursor Sharing</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="SQL Tuning Guide">
      <meta property="og:description" content="Cursor sharing can improve database application performance by orders of magnitude.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="SQL Tuning Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="sql-tuning-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-31T14:57:08-08:00">
      <meta name="dcterms.title" content="SQL Tuning Guide">
      <meta name="dcterms.dateCopyrighted" content="2013, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96095-03">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="influencing-the-optimizer.html" title="Previous" type="text/html">
      <link rel="next" href="monitoring-and-tracing-sql.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TGSQL">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="influencing-the-optimizer.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="monitoring-and-tracing-sql.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">SQL Tuning Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="optimizer-controls.html" property="item" typeof="WebPage"><span property="name">Optimizer Controls </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Improving Real-World Performance Through Cursor Sharing</li>
            </ol>
            <a id="GUID-971F4652-3950-4662-82DE-713DDEED317C" name="GUID-971F4652-3950-4662-82DE-713DDEED317C"></a><a id="TGSQL848"></a>
            
            <h2 id="TGSQL-GUID-971F4652-3950-4662-82DE-713DDEED317C" class="sect2"><span class="enumeration_chapter">20 </span>Improving Real-World Performance Through Cursor Sharing
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>Cursor sharing can improve database application performance by orders of magnitude.</p>
               <p>This chapter contains the following topics:</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-1DEE6AD7-C30E-4ABB-9BFF-B5895A6E386B">Overview of Cursor Sharing</a><br>Oracle Database can share cursors, which are pointers to private SQL areas in the shared pool.
                  </li>
                  <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-267E5860-A8D5-4E5F-AE60-16304E97E4EE">CURSOR_SHARING and Bind Variable Substitution</a><br>This topic explains what the <code class="codeph">CURSOR_SHARING</code> initialization parameter is, and how setting it to different values affects how Oracle Database uses bind variables.
                  </li>
                  <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-277432AA-CD1C-4A75-AB28-7358E63265B3">Adaptive Cursor Sharing</a><br>The <strong class="term">adaptive cursor sharing</strong> feature enables a single statement that contains bind variables to use multiple execution plans.
                  </li>
                  <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-EA2FC76C-275B-49E1-B38C-BA39B3B3E864">Real-World Performance Guidelines for Cursor Sharing</a><br>The Real-World Performance team has created guidelines for how to optimize cursor sharing in Oracle database applications.
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>Parent topic:</strong> <a href="optimizer-controls.html#GUID-12325D58-595B-473A-A6C7-C6A4430894CA" title="You can use hints and initialization parameter to influence optimizer decisions and behavior.">Optimizer Controls</a></p>
                  </div>
               </div>
            </div>
            
            <div class="sect2"><a id="GUID-1DEE6AD7-C30E-4ABB-9BFF-B5895A6E386B" name="GUID-1DEE6AD7-C30E-4ABB-9BFF-B5895A6E386B"></a><h3 id="TGSQL-GUID-1DEE6AD7-C30E-4ABB-9BFF-B5895A6E386B" class="sect3"><span class="enumeration_section">20.1 </span>Overview of Cursor Sharing
               </h3>
               <div>
                  <p>Oracle Database can share cursors, which are pointers to private SQL areas in the shared pool.</p>
                  <p>This section contains the following topics:</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-7A37EEAC-1B50-4744-B4BC-A3052313A7E4">About Cursors</a><br>A <strong class="term">private SQL area</strong> holds information about a parsed SQL statement and other session-specific information for processing. 
                     </li>
                     <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-5154DB60-EB3C-41EF-AF32-226FC54BDA75">About Cursors and Parsing</a><br>If an application issues a statement, and if Oracle Database cannot reuse a cursor, then  it must build a new executable version of the application code. This operation is known as a <strong class="term">hard parse</strong>.
                     </li>
                     <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-B7ABA6CC-3E81-4990-BDE4-CF69181079B9">About Literals and Bind Variables</a><br>Bind variables are essential to cursor sharing in Oracle database applications.
                     </li>
                     <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-E04CF45D-CC70-4122-9BAC-EAB5B4D0E17A">About the Life Cycle of Shared Cursors</a><br>The database allocates a new shared SQL area when the optimizer parses a new SQL statement that is not DDL. The amount of memory required depends on the statement complexity. 
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-971F4652-3950-4662-82DE-713DDEED317C" title="Cursor sharing can improve database application performance by orders of magnitude.">Improving Real-World Performance Through Cursor Sharing</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-7A37EEAC-1B50-4744-B4BC-A3052313A7E4" name="GUID-7A37EEAC-1B50-4744-B4BC-A3052313A7E4"></a><h4 id="TGSQL-GUID-7A37EEAC-1B50-4744-B4BC-A3052313A7E4" class="sect4"><span class="enumeration_section">20.1.1 </span>About Cursors
                  </h4>
                  <div>
                     <p>A <strong class="term">private SQL area</strong> holds information about a parsed SQL statement and other session-specific information for processing. 
                     </p>
                     <p>When a server process executes SQL or PL/SQL code, the process uses the private SQL area to store bind variable values, query execution state information, and query execution work areas. The private SQL areas for each execution of a statement are not shared and may contain different values and data.</p>
                     <p>A <a href="glossary.html#GUID-B29D6FB9-8D89-4124-A14F-E0FAEDAB2AA5"><span class="xrefglossterm">cursor</span></a> is a name or handle to a specific private SQL area. The cursor contains session-specific state information such as bind variable values and result sets.
                     </p>
                     <p>As shown in the following graphic, you can think of a cursor as a pointer on the client side and as a state on the server side. Because cursors are closely associated with private SQL areas, the terms are sometimes used interchangeably.</p>
                     <div class="figure" id="GUID-7A37EEAC-1B50-4744-B4BC-A3052313A7E4__GUID-32E3A1C4-201D-4E91-B19F-A704352DFC12">
                        <p class="titleinfigure">Figure 20-1 Cursor</p><img src="img/cncpt324.gif" alt="Description of Figure 20-1 follows" title="Description of Figure 20-1 follows" longdesc="img_text/cncpt324.html"><br><a href="img_text/cncpt324.html">Description of "Figure 20-1 Cursor"</a></div>
                     <!-- class="figure" -->
                     <p>This section contains the following topics:</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-782D3329-0CC5-4312-B9B5-2A012A4AD7C8">Private and Shared SQL Areas</a><br>A cursor in the private SQL area points to a <strong class="term">shared SQL area</strong> in the library cache. 
                        </li>
                        <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-8CC2E0D8-4C67-4795-93A8-9F563E7F27C7">Parent and Child Cursors</a><br>Every parsed SQL statement has a parent cursor and one or more child cursors.
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-1DEE6AD7-C30E-4ABB-9BFF-B5895A6E386B" title="Oracle Database can share cursors, which are pointers to private SQL areas in the shared pool.">Overview of Cursor Sharing</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL94739"></a><div class="props_rev_3"><a id="GUID-782D3329-0CC5-4312-B9B5-2A012A4AD7C8" name="GUID-782D3329-0CC5-4312-B9B5-2A012A4AD7C8"></a><h5 id="TGSQL-GUID-782D3329-0CC5-4312-B9B5-2A012A4AD7C8" class="sect5"><span class="enumeration_section">20.1.1.1 </span>Private and Shared SQL Areas
                     </h5>
                     <div>
                        <p>A cursor in the private SQL area points to a <strong class="term">shared SQL area</strong> in the library cache. 
                        </p>
                        <p>Unlike the private SQL area, which contains session state information, the shared SQL area contains the parse tree and execution plan for the statement. For example, an execution of <code class="codeph">SELECT * FROM employees</code> has a plan and parse tree stored in one shared SQL area. An execution of <code class="codeph">SELECT * FROM departments</code>, which differs both syntactically and semantically, has a plan and parse tree stored in a separate shared SQL area.
                        </p>
                        <p>Multiple private SQL areas in the same or different sessions can reference a single shared SQL area, a phenomenon known as <strong class="term">cursor sharing</strong>. For example, an execution of <code class="codeph">SELECT * FROM employees</code> in one session and an execution of the <code class="codeph">SELECT * FROM employees</code> (accessing the same table) in a different session can use the same parse tree and plan. A shared SQL area that is accessed by multiple statements is known as a <a href="glossary.html#GUID-9DD889F6-A0BF-4E68-A53F-FC15371E9A09"><span class="xrefglossterm">shared cursor</span></a>.
                        </p>
                        <div class="figure" id="GUID-782D3329-0CC5-4312-B9B5-2A012A4AD7C8__GUID-DD8551AB-10C5-429A-8DDD-98ADC803D3E4">
                           <p class="titleinfigure">Figure 20-2 Cursor Sharing</p><img src="img/cncpt252.gif" alt="Description of Figure 20-2 follows" title="Description of Figure 20-2 follows" longdesc="img_text/cncpt252.html"><br><a href="img_text/cncpt252.html">Description of "Figure 20-2 Cursor Sharing"</a></div>
                        <!-- class="figure" -->
                        <p>Oracle Database automatically determines whether the SQL statement or PL/SQL block being issued is textually identical to another statement currently in the library cache, using the following steps:</p>
                        <ol>
                           <li>
                              <p>The text of the statement is hashed. </p>
                           </li>
                           <li>
                              <p>The database looks for a matching hash value for an existing SQL statement in the shared pool. The following options are possible:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>No matching hash value exists.</p>
                                    <p>In this case, the SQL statement does not currently exist in the shared pool, so the database performs a hard parse. This ends the shared pool check.</p>
                                 </li>
                                 <li>
                                    <p>A matching hash value exists.</p>
                                    <p>In this case, the database proceeds to the next step, which is a text match.</p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>The database compares the text of the matched statement to the text of the hashed statement to determine whether they are identical. The following options are possible:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>The textual match fails.</p>
                                    <p>In this case, the text match process stops, resulting in a hard parse.</p>
                                 </li>
                                 <li>
                                    <p>The textual match succeeds.</p>
                                    <p>In this case, the database proceeds to the next step: determining whether the SQL can share an existing parent cursor.</p>
                                    <p>For a textual match to occur, the text of the SQL statements or PL/SQL blocks must be character-for-character identical, including spaces, case, and comments. For example, the following statements cannot use the same shared SQL area:</p><pre class="pre codeblock"><code>SELECT * FROM employees;
SELECT * FROM Employees;
SELECT *  FROM employees;
</code></pre><p>Usually, SQL statements that differ only in literals cannot use the same shared SQL area. For example, the following statements do not resolve to the same SQL area:</p><pre class="pre codeblock"><code>SELECT count(1) FROM employees WHERE manager_id = 121;
SELECT count(1) FROM employees WHERE manager_id = 247;
</code></pre><p>The only exception to this rule is when the parameter <code class="codeph">CURSOR_SHARING</code> has been set to <code class="codeph">FORCE</code>, in which case similar statements can share SQL areas. 
                                    </p>
                                 </li>
                              </ul>
                           </li>
                        </ol>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-782D3329-0CC5-4312-B9B5-2A012A4AD7C8__GUID-CEA14D38-B95B-4029-97DC-51F591CB6FA8">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="q">"<a href="improving-rwp-cursor-sharing.html#GUID-8CC2E0D8-4C67-4795-93A8-9F563E7F27C7" title="Every parsed SQL statement has a parent cursor and one or more child cursors.">Parent and Child Cursors</a>"</span></p>
                              </li>
                              <li>
                                 <p><span class="q">"<a href="improving-rwp-cursor-sharing.html#GUID-7FF4E133-06A7-401E-9BFC-3B0B9C902346" title="The best practice is to write sharable SQL and use the default of EXACT for CURSOR_SHARING.">Do Not Use CURSOR_SHARING = FORCE as a Permanent Fix</a>"</span> to learn about the costs involved in using <code class="codeph">CURSOR_SHARING</code></p>
                              </li>
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=GUID-455358F8-D657-49A2-B32B-13A1DC53E7D2" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn more about the <code class="codeph">CURSOR_SHARING</code> initialization parameter
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-7A37EEAC-1B50-4744-B4BC-A3052313A7E4" title="A private SQL area holds information about a parsed SQL statement and other session-specific information for processing.">About Cursors</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-8CC2E0D8-4C67-4795-93A8-9F563E7F27C7" name="GUID-8CC2E0D8-4C67-4795-93A8-9F563E7F27C7"></a><h5 id="TGSQL-GUID-8CC2E0D8-4C67-4795-93A8-9F563E7F27C7" class="sect5"><span class="enumeration_section">20.1.1.2 </span>Parent and Child Cursors
                     </h5>
                     <div>
                        <p>Every parsed SQL statement has a parent cursor and one or more child cursors.</p>
                        <p>The parent cursor stores the text of the SQL statement. If the text of two statements is identical, then the statements share the same parent cursor. If the text is different, however, then the database creates a separate parent cursor.</p>
                        <div class="example" id="GUID-8CC2E0D8-4C67-4795-93A8-9F563E7F27C7__GUID-638A7A3E-22FA-4572-80B3-0A52FC21A7A9">
                           <p class="titleinexample">Example 20-1 Parent Cursors</p>
                           <p>In this example, the first two statements are syntactically different (the letter “c” is lowercase in the first statement and uppercase in the second statement), but semantically identical. Because of the syntactic difference, these statements have different parent cursors. The third statement is syntactically identical to the first statement (lowercase “c”), but semantically different because it refers to a <code class="codeph">customers</code> table in a different schema. Because of the syntactic identity, the third statement can share a parent cursor with the first statement.
                           </p><pre class="pre codeblock"><code>SQL&gt; CONNECT oe@inst1
Enter password: *******
Connected.
SQL&gt; SELECT COUNT(*) FROM customers;

  COUNT(*)
----------
       319

SQL&gt; SELECT COUNT(*) FROM Customers;

  COUNT(*)
----------
       319

SQL&gt; CONNECT sh@inst1
Enter password:  *******
Connected.
SQL&gt; SELECT COUNT(*) FROM customers;

  COUNT(*)
----------
    155500
</code></pre><p>The following query of <code class="codeph">V$SQL</code> indicates the two parents. The statement with the SQL ID of <code class="codeph">8h916vv2yw400</code>, which is the lowercase “c” version of the statement, has one parent cursor and two child cursors: child 0 and child 1. The statement with the SQL ID of <code class="codeph">5rn2uxjtpz0wd</code>, which is the uppercase “c” version of the statement, has a different parent cursor and only one child cursor: child 0.
                           </p><pre class="pre codeblock"><code>SQL&gt; CONNECT SYSTEM@inst1
Enter password:  *******
Connected.

SQL&gt; COL SQL_TEXT FORMAT a30
SQL&gt; COL CHILD# FORMAT 99999
SQL&gt; COL EXEC FORMAT 9999
SQL&gt; COL SCHEMA FORMAT a6
SQL&gt; SELECT SQL_ID, PARSING_SCHEMA_NAME AS SCHEMA, SQL_TEXT, 
  2  CHILD_NUMBER AS CHILD#, EXECUTIONS AS EXEC FROM V$SQL 
  3  WHERE SQL_TEXT LIKE '%ustom%' AND SQL_TEXT NOT LIKE '%SQL_TEXT%' ORDER BY SQL_ID;

SQL_ID        SCHEMA SQL_TEXT                       CHILD# EXEC
------------- ------ ------------------------------ ------ -----
5rn2uxjtpz0wd OE     SELECT COUNT(*) FROM Customers	 0     1
8h916vv2yw400 OE     SELECT COUNT(*) FROM customers	 0     1
8h916vv2yw400 SH     SELECT COUNT(*) FROM customers	 1     1
</code></pre><p>This section contains the following topics:</p>
                        </div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-9D5F5901-FCAC-41E0-B405-8F02840BB08B">Parent Cursors and V$SQLAREA</a><br>The <code class="codeph">V$SQLAREA</code> view contains one row for every parent cursor.
                           </li>
                           <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-D8E8EC1C-76CF-44B2-AC41-5F720EBDB349">Child Cursors and V$SQL</a><br>Every parent cursor has one or more child cursors.
                           </li>
                           <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-5AC5DAC7-D5D0-4FF6-85E6-9A4C3B28C890">Cursor Mismatches and V$SQL_SHARED_CURSOR</a><br>If a parent cursor has multiple children, then the <code class="codeph">V$SQL_SHARED_CURSOR</code> view provides information about why the cursor was not shared. For several types of incompatibility, the <code class="codeph">TRANSLATION_MISMATCH</code> column indicates a mismatch with the value <code class="codeph">Y</code> or <code class="codeph">N</code>.
                           </li>
                        </ul>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-7A37EEAC-1B50-4744-B4BC-A3052313A7E4" title="A private SQL area holds information about a parsed SQL statement and other session-specific information for processing.">About Cursors</a></p>
                           </div>
                        </div>
                     </div>
                     
                     <div class="sect5"><a id="GUID-9D5F5901-FCAC-41E0-B405-8F02840BB08B" name="GUID-9D5F5901-FCAC-41E0-B405-8F02840BB08B"></a><h6 id="TGSQL-GUID-9D5F5901-FCAC-41E0-B405-8F02840BB08B" class="sect6"><span class="enumeration_section">20.1.1.2.1 </span>Parent Cursors and V$SQLAREA
                        </h6>
                        <div>
                           <p>The <code class="codeph">V$SQLAREA</code> view contains one row for every parent cursor.
                           </p>
                           <div class="example" id="GUID-9D5F5901-FCAC-41E0-B405-8F02840BB08B__GUID-4BBFB7F8-171B-4C08-BB8C-347DCA041058">
                              <p>In the following example, a query of <code class="codeph">V$SQLAREA</code> shows two parent cursors, each identified with a different <code class="codeph">SQL_ID</code>. The <code class="codeph">VERSION_COUNT</code> indicates the number of child cursors.
                              </p><pre class="pre codeblock"><code>COL SQL_TEXT FORMAT a30
SELECT SQL_TEXT, SQL_ID, VERSION_COUNT, HASH_VALUE
FROM   V$SQLAREA
WHERE  SQL_TEXT LIKE '%mployee%'
AND    SQL_TEXT NOT LIKE '%SQL_TEXT%';
 
SQL_TEXT                       SQL_ID        VERSION_COUNT HASH_VALUE
------------------------------ ------------- ------------- ----------
SELECT * FROM Employees        5bzhzpaa0wy9m             1 2483976499
SELECT * FROM employees        4959aapufrm1k             2 1961610290</code></pre><p>In the preceding output, the <code class="codeph">VERSION_COUNT</code> of <code class="codeph">2</code> for <code class="codeph">SELECT * FROM employees</code> indicates multiple child cursors, which were necessary because the statement was executed against two different objects. In contrast, the statement <code class="codeph">SELECT * FROM Employees</code> (note the capital "E") was executed once, and so has one parent cursor, and one child cursor (<code class="codeph">VERSION_COUNT</code> of <code class="codeph">1</code>).
                              </p>
                           </div>
                           <!-- class="example" -->
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-8CC2E0D8-4C67-4795-93A8-9F563E7F27C7" title="Every parsed SQL statement has a parent cursor and one or more child cursors.">Parent and Child Cursors</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-D8E8EC1C-76CF-44B2-AC41-5F720EBDB349" name="GUID-D8E8EC1C-76CF-44B2-AC41-5F720EBDB349"></a><h6 id="TGSQL-GUID-D8E8EC1C-76CF-44B2-AC41-5F720EBDB349" class="sect6"><span class="enumeration_section">20.1.1.2.2 </span>Child Cursors and V$SQL
                        </h6>
                        <div>
                           <p>Every parent cursor has one or more child cursors.</p>
                           <p>A <strong class="term">child cursor</strong> contains the execution plan, bind variables, metadata about objects referenced in the query, optimizer environment, and other information. In contrast to the parent cursor, the child cursor does not store the text of the SQL statement.
                           </p>
                           <p>If a statement is able to reuse a parent cursor, then the database checks whether the statement can reuse an existing child cursor. The database performs several checks, including the following:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The database compares objects referenced in the issued statement to the objects referenced by the statement in the pool to ensure that they are all identical.</p>
                                 <p>References to schema objects in the SQL statements or PL/SQL blocks must resolve to the same object in the same schema. For example, if two users issue the following SQL statement, and if each user has its own <code class="codeph">employees</code> table, then the following statement is not identical because the statement references different <code class="codeph">employees</code> tables for each user:
                                 </p><pre class="pre codeblock"><code>SELECT * FROM employees;
</code></pre><div class="infoboxnote" id="GUID-D8E8EC1C-76CF-44B2-AC41-5F720EBDB349__GUID-A5474EDF-A1AD-4EA6-9EC6-CA5316AA8F26">
                                    <p class="notep1">Note:</p>
                                    <p>The database can share cursors for a private temporary table, but only within the same session. The database associates the session identifier as part of the cursor context. During a soft parse, the database can share the child cursor only when the current session ID matches with the session ID in the cursor context.</p>
                                 </div>
                              </li>
                              <li>
                                 <p>The database determines whether the optimizer mode is identical. </p>
                                 <p>For example, SQL statements must be optimized using the same <a href="glossary.html#GUID-B9EC4A43-179B-43D1-B63C-82300FC34596"><span class="xrefglossterm">optimizer goal</span></a>.
                                 </p>
                              </li>
                           </ul>
                           <div class="example" id="GUID-D8E8EC1C-76CF-44B2-AC41-5F720EBDB349__GUID-9C8CC0EA-0CC8-4A93-8588-7702FF789814">
                              <p class="titleinexample">Example 20-2 Multiple Child Cursors</p>
                              <p><code class="codeph">V$SQL</code> describes the statements that currently reside in the library cache. It contains one row for every child cursor, as shown in the following example:
                              </p><pre class="pre codeblock"><code>SELECT SQL_TEXT, SQL_ID, USERNAME AS USR, CHILD_NUMBER AS CHILD#, 
       HASH_VALUE, PLAN_HASH_VALUE AS PLAN_HASHV
FROM   V$SQL s, DBA_USERS d
WHERE  SQL_TEXT LIKE '%mployee%'
AND    SQL_TEXT NOT LIKE '%SQL_TEXT%'
AND    d.USER_ID = s.PARSING_USER_ID;

SQL_TEXT                SQL_ID        USR CHILD# HASH_VALUE PLAN_HASHV
----------------------- ------------- --- ------ ---------- ----------
SELECT * FROM Employees 5bzhzpaa0wy9m  HR      0 2483976499 1445457117
SELECT * FROM employees 4959aapufrm1k  HR      0 1961610290 1445457117
SELECT * FROM employees 4959aapufrm1k  SH      1 1961610290 1445457117</code></pre><p>In the preceding results, the <code class="codeph">CHILD#</code> of the bottom two statements is different (<code class="codeph">0</code> and <code class="codeph">1</code>), even though the <code class="codeph">SQL_ID</code> is the same. This means that the statements have the same parent cursor, but different child cursors. In contrast, the statement with the <code class="codeph">SQL_ID</code> of <code class="codeph">5bzhzpaa0wy9m</code> has one parent and one child (<code class="codeph">CHILD#</code> of <code class="codeph">0</code>). All three SQL statements use the same execution plan, as indicated by identical values in the <code class="codeph">PLAN_HASH_VALUE</code> column.
                              </p>
                           </div>
                           <!-- class="example" -->
                        </div>
                        <div>
                           <div class="relinfo">
                              <p><strong>Related Topics</strong></p>
                              <ul>
                                 <li><a href="optimizer-statistics-concepts.html#GUID-C0F7F290-8430-442F-8E7D-0371834E9917" title="Temporary tables are classified as global, private, or cursor-duration.">Types of Temporary Tables</a></li>
                                 <li><a href="influencing-the-optimizer.html#GUID-2D3EEFD3-C4C6-4D2F-B24A-8DC0C1E1CBA1" title="The optimizer goal is the prioritization of resource usage by the optimizer.">Choosing an Optimizer Goal</a></li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-8CC2E0D8-4C67-4795-93A8-9F563E7F27C7" title="Every parsed SQL statement has a parent cursor and one or more child cursors.">Parent and Child Cursors</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-5AC5DAC7-D5D0-4FF6-85E6-9A4C3B28C890" name="GUID-5AC5DAC7-D5D0-4FF6-85E6-9A4C3B28C890"></a><h6 id="TGSQL-GUID-5AC5DAC7-D5D0-4FF6-85E6-9A4C3B28C890" class="sect6"><span class="enumeration_section">20.1.1.2.3 </span>Cursor Mismatches and V$SQL_SHARED_CURSOR
                        </h6>
                        <div>
                           <p>If a parent cursor has multiple children, then the <code class="codeph">V$SQL_SHARED_CURSOR</code> view provides information about why the cursor was not shared. For several types of incompatibility, the <code class="codeph">TRANSLATION_MISMATCH</code> column indicates a mismatch with the value <code class="codeph">Y</code> or <code class="codeph">N</code>.
                           </p>
                           <div class="example" id="GUID-5AC5DAC7-D5D0-4FF6-85E6-9A4C3B28C890__GUID-2F5BDA06-1E34-44B4-A7CF-A04ECD088936">
                              <p class="titleinexample">Example 20-3 Translation Mismatch</p>
                              <p> In this example, the <code class="codeph">TRANSLATION_MISMATCH</code> column shows that the two statements (<code class="codeph">SELECT * FROM employees</code>) referenced different objects, resulting in a <code class="codeph">TRANSLATION_MISMATCH</code> value of <code class="codeph">Y</code> for the last statement. Because sharing was not possible, each statement had a separate child cursor, as indicated by <code class="codeph">CHILD_NUMBER</code> of <code class="codeph">0</code> and <code class="codeph">1</code>.
                              </p><pre class="pre codeblock"><code>SELECT S.SQL_TEXT, S.CHILD_NUMBER, s.CHILD_ADDRESS, 
       C.TRANSLATION_MISMATCH
FROM   V$SQL S, V$SQL_SHARED_CURSOR C
WHERE  SQL_TEXT LIKE '%employee%'
AND    SQL_TEXT NOT LIKE '%SQL_TEXT%'
AND S.CHILD_ADDRESS = C.CHILD_ADDRESS;

SQL_TEXT                       CHILD_NUMBER    CHILD_ADDRESS T
------------------------------ ------------ ---------------- -
SELECT * FROM employees                   0 0000000081EE8690 N
SELECT * FROM employees                   1 0000000081F22508 Y</code></pre></div>
                           <!-- class="example" -->
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-8CC2E0D8-4C67-4795-93A8-9F563E7F27C7" title="Every parsed SQL statement has a parent cursor and one or more child cursors.">Parent and Child Cursors</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-5154DB60-EB3C-41EF-AF32-226FC54BDA75" name="GUID-5154DB60-EB3C-41EF-AF32-226FC54BDA75"></a><h4 id="TGSQL-GUID-5154DB60-EB3C-41EF-AF32-226FC54BDA75" class="sect4"><span class="enumeration_section">20.1.2 </span>About Cursors and Parsing
                  </h4>
                  <div>
                     <p>If an application issues a statement, and if Oracle Database cannot reuse a cursor, then  it must build a new executable version of the application code. This operation is known as a <strong class="term">hard parse</strong>.
                     </p>
                     <p>A <a href="glossary.html#GUID-BA91B10B-FBA3-4DF6-B59B-9AA57C683D33"><span class="xrefglossterm">soft parse</span></a> is any parse that is not a hard parse, and occurs when the database can reuse existing code. Some soft parses are less resource-intensive than others. For example, if a parent cursor for the statement already exists, then Oracle Database can perform various optimizations, and then store the child cursor in the shared SQL area. If a parent cursor does not exist, however, then Oracle Database must also store the parent cursor in the shared SQL area, which creates additional memory overhead.
                     </p>
                     <p>Effectively, a hard parse recompiles a statement before running it. Hard parsing a SQL statement before every execution is analogous to recompiling a C program before every execution. A hard parse performs operations such as the following:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Checking the syntax of the SQL statement</p>
                        </li>
                        <li>
                           <p>Checking the semantics of the SQL statement</p>
                        </li>
                        <li>
                           <p>Checking the access rights of the user issuing the statement</p>
                        </li>
                        <li>
                           <p>Creating an execution plan</p>
                        </li>
                        <li>
                           <p>Accessing the library cache and data dictionary cache  numerous times to check the data dictionary</p>
                        </li>
                     </ul>
                     <p>An especially resource-intensive aspect of hard parsing is accessing the library cache and data dictionary cache numerous times to check the data dictionary. When the database accesses these areas, it uses a serialization device called a <a href="glossary.html#GUID-B1C1EE03-1E9E-45F9-BD12-3B05654F7615"><span class="xrefglossterm">latch</span></a> on required objects so that their definition does not change during the check. Latch contention increases statement execution time and decreases concurrency.
                     </p>
                     <p>For all of the preceding reasons, the CPU and memory overhead of hard parses can create serious performance problems. The problems are especially evident in web applications that accept user input from a form, and then generate SQL statements dynamically. The Real-World Performance group strongly recommends reducing hard parsing as much as possible.</p>
                     <div class="infoboxnote" id="GUID-5154DB60-EB3C-41EF-AF32-226FC54BDA75__RWP3CONNECTIONPOOLSANDHARDPARSING-7EE8CD10">
                        <p class="notep1">Video:</p>
                        <p>
                           <div class="video-box">
                              <div id="9268" class="video-container"></div>
                           </div>
                        </p>
                     </div>
                     <div class="example" id="GUID-5154DB60-EB3C-41EF-AF32-226FC54BDA75__FINDINGPARSEINFORMATIONUSINGVSQL-7EE8A824">
                        <p class="titleinexample">Example 20-4 Finding Parse Information Using V$SQL</p>
                        <p>You can use various techniques to monitor hard and soft parsing. This example queries the session statistics to determine whether repeated executions of a <code class="codeph">DBA_JOBS</code> query increase the hard parse count. The first execution of the statement increases the hard parse count to <code class="codeph">49</code>, but the second execution does not change the hard parse count, which means that Oracle Database reused application code.
                        </p><pre class="pre codeblock"><code>SQL&gt; ALTER SYSTEM FLUSH SHARED_POOL;

System altered.

SQL&gt; COL NAME FORMAT a18

SQL&gt; SELECT s.NAME, m.VALUE
  2  FROM   V$STATNAME s, V$MYSTAT m
  3  WHERE  s.STATISTIC# = m.STATISTIC#
  4  AND    s.NAME LIKE '%(hard%';

NAME                    VALUE
------------------ ----------
parse count (hard)         48

SQL&gt; SELECT COUNT(*) FROM DBA_JOBS;

  COUNT(*)
----------
	 0

SQL&gt; SELECT s.NAME, m.VALUE
  2  FROM   V$STATNAME s, V$MYSTAT m
  3  WHERE  s.STATISTIC# = m.STATISTIC#
  4  AND    s.NAME LIKE '%(hard%';

NAME                    VALUE
------------------ ----------
parse count (hard)         <span class="bold">49</span>

SQL&gt; SELECT COUNT(*) FROM DBA_JOBS;

  COUNT(*)
----------
	 0

SQL&gt; SELECT s.NAME, m.VALUE
  2  FROM   V$STATNAME s, V$MYSTAT m
  3  WHERE  s.STATISTIC# = m.STATISTIC#
  4  AND    s.NAME LIKE '%(hard%';

NAME                    VALUE
------------------ ----------
parse count (hard)         49
</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-5154DB60-EB3C-41EF-AF32-226FC54BDA75__FINDINGPARSEINFORMATIONUSINGTRACEFI-7EE8AD2E">
                        <p class="titleinexample">Example 20-5 Finding Parse Information Using Trace Files</p>
                        <p>This example uses SQL Trace and the TKPROF utility to find parse information. You log in to the database with administrator privileges, and then query the directory location of the trace files (sample output included):</p><pre class="pre codeblock"><code>SET LINESIZE 120
COLUMN value FORMAT A80

SELECT value
FROM   v$diag_info
WHERE  name = 'Default Trace File';

VALUE
--------------------------------------------------------------------------------
/disk1/oracle/log/diag/rdbms/orcl/orcl/trace/orcl_ora_23054.trc
</code></pre><p>You enable tracing, use the <code class="codeph">TRACEFILE_IDENTIFIER</code> initialization parameter to give the trace file a meaningful name, and then query <code class="codeph">hr.employees</code>:
                        </p><pre class="pre codeblock"><code>EXEC DBMS_MONITOR.SESSION_TRACE_ENABLE(waits=&gt;TRUE, binds=&gt;TRUE); 
ALTER SESSION SET TRACEFILE_IDENTIFIER = "emp_stmt";
SELECT * FROM hr.employees;
EXIT;</code></pre><p>Search the default trace file directory for the trace file that you generated:</p><pre class="pre codeblock"><code>% ls *emp_stmt.trc
orcl_ora_17950_emp_stmt.trc
</code></pre><p>Use TKPROF to format the trace file, and then open the formatted file:</p><pre class="pre codeblock"><code>% tkprof orcl_ora_17950_emp_stmt.trc emp.out; vi emp.out</code></pre><p>The formatted trace file contains the parse information for the query of <code class="codeph">hr.employees</code>.
                        </p><pre class="pre codeblock"><code>SQL ID: brmjpfs7dcnub Plan Hash: 1445457117

SELECT *
FROM
 hr.employees


call     count       cpu    elapsed       disk      query    current        rows
------- ------  -------- ---------- ---------- ---------- ----------  ----------
Parse        1      0.07       0.08          0          0          0           0
Execute      1      0.00       0.00          0          0          0           0
Fetch        9      0.00       0.00          3         12          0         107
------- ------  -------- ---------- ---------- ---------- ----------  ----------
total       11      0.07       0.08          3         12          0         107

<span class="bold">Misses in library cache during parse: 1
</span>Optimizer mode: ALL_ROWS
Parsing user id: SYSTEM
Number of plan statistics captured: 1

Rows (1st) Rows (avg) Rows (max)  Row Source Operation
---------- ---------- ----------  ---------------------------------------------------
       107        107        107  TABLE ACCESS FULL EMPLOYEES (cr=12 pr=3 pw=0 time=497 
                                    us starts=1 cost=2 size=7383 card=107)
</code></pre><p>A library cache miss indicates a hard parse. Performing the same steps for a second execution of the same statement produces the following trace output, which shows no library cache misses:</p><pre class="pre codeblock"><code>SQL ID: brmjpfs7dcnub Plan Hash: 1445457117

SELECT *
FROM
 hr.employees


call     count       cpu    elapsed       disk      query    current        rows
------- ------  -------- ---------- ---------- ---------- ----------  ----------
Parse        1      0.00       0.00          0          0          0           0
Execute      1      0.00       0.00          0          0          0           0
Fetch        9      0.00       0.00          3         12          0         107
------- ------  -------- ---------- ---------- ---------- ----------  ----------
total       11      0.00       0.00          3         12          0         107

<span class="bold">Misses in library cache during parse: 0
</span>Optimizer mode: ALL_ROWS
Parsing user id: SYSTEM
Number of plan statistics captured: 1

Rows (1st) Rows (avg) Rows (max)  Row Source Operation
---------- ---------- ----------  ---------------------------------------------------
       107        107        107  TABLE ACCESS FULL EMPLOYEES (cr=12 pr=3 pw=0 time=961 
                                    us starts=1 cost=2 size=7383 card=107)
</code></pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-5154DB60-EB3C-41EF-AF32-226FC54BDA75__GUID-B29631D2-F84C-42DC-870B-27F90D6FDC3B">
                        <p class="notep1">See Also:</p>
                        <p><span class="q">"<a href="sql-processing.html#GUID-BFF0B26C-0A5D-4F79-B01E-8E1C4064A6AD" title="During the parse, the database performs a shared pool check to determine whether it can skip resource-intensive steps of statement processing.">Shared Pool Check</a>"</span></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-1DEE6AD7-C30E-4ABB-9BFF-B5895A6E386B" title="Oracle Database can share cursors, which are pointers to private SQL areas in the shared pool.">Overview of Cursor Sharing</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL849"></a><div class="props_rev_3"><a id="GUID-B7ABA6CC-3E81-4990-BDE4-CF69181079B9" name="GUID-B7ABA6CC-3E81-4990-BDE4-CF69181079B9"></a><h4 id="TGSQL-GUID-B7ABA6CC-3E81-4990-BDE4-CF69181079B9" class="sect4"><span class="enumeration_section">20.1.3 </span>About Literals and Bind Variables
                  </h4>
                  <div>
                     <p>Bind variables are essential to cursor sharing in Oracle database applications.</p>
                     <p>This section contains the following topics:</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-015E6C8F-4C33-4680-9481-9F93DEDD844B">Literals and Cursors</a><br>When constructing SQL statements, some Oracle applications use literals instead of bind variables. 
                        </li>
                        <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-042A85BF-D96E-44AB-9312-4EB115CCE7B0">Bind Variables and Cursors</a><br>You can develop Oracle applications to use bind variables instead of literals. 
                        </li>
                        <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-3550B486-A3D6-4FB2-99A9-4B90D4ADE421">Bind Variable Peeking</a><br>In <strong class="term">bind variable peeking</strong> (also known as <span class="italic">bind peeking</span>), the optimizer looks at the value in a bind variable when the database performs a hard parse of a statement.
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-1DEE6AD7-C30E-4ABB-9BFF-B5895A6E386B" title="Oracle Database can share cursors, which are pointers to private SQL areas in the shared pool.">Overview of Cursor Sharing</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="sect4"><a id="GUID-015E6C8F-4C33-4680-9481-9F93DEDD844B" name="GUID-015E6C8F-4C33-4680-9481-9F93DEDD844B"></a><h5 id="TGSQL-GUID-015E6C8F-4C33-4680-9481-9F93DEDD844B" class="sect5"><span class="enumeration_section">20.1.3.1 </span>Literals and Cursors
                     </h5>
                     <div>
                        <p>When constructing SQL statements, some Oracle applications use literals instead of bind variables. </p>
                        <p>For example, the statement <code class="codeph">SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; 101</code> uses the literal value <code class="codeph">101</code> for the employee ID. By default, when similar statements do not use bind variables, Oracle Database cannot take advantage of cursor sharing. Thus, Oracle Database sees a statement that is identical except for the value <code class="codeph">102</code>, or any other random value, as a completely new statement, requiring a hard parse.
                        </p>
                        <p>The Real-World Performance group has determined that applications that use literals are a frequent cause of performance, scalability, and security problems. In the real world, it is not uncommon for applications to be written quickly, without considering cursor sharing. A classic example is a “screen scraping” application that copies the contents out of a web form, and then concatenates strings to construct the SQL statement dynamically.</p>
                        <p>Major problems that result from using literal values include the following:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Applications that concatenate literals input by an end user are prone to SQL injection attacks. Only rewriting the applications to use bind variables eliminates this threat.</p>
                           </li>
                           <li>
                              <p>If every statement is hard parsed, then cursors are not shared, and so the database must consume more memory to create the cursors.</p>
                           </li>
                           <li>
                              <p>Oracle Database must latch the shared pool and library cache when hard parsing. As the number of hard parses increases, so does the number of processes waiting to latch the shared pool. This situation decreases concurrency and increases contention.</p>
                           </li>
                        </ul>
                        <div class="infoboxnote" id="GUID-015E6C8F-4C33-4680-9481-9F93DEDD844B__ORACLEDATABASE12CRECOVERINGAPLUGGAB-6B61826C">
                           <p class="notep1">Video:</p>
                           <p>
                              <div class="video-box">
                                 <div id="9269" class="video-container"></div>
                              </div>
                           </p>
                        </div>
                        <div class="example" id="GUID-015E6C8F-4C33-4680-9481-9F93DEDD844B__GUID-7FADDE5F-A0E4-4F29-B82A-414BCBCAE57A">
                           <p class="titleinexample">Example 20-6 Literals and Cursor Sharing</p>
                           <p>Consider an application that executes the following statements, which differ only in literals:</p><pre class="pre codeblock"><code>SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; 101;
SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; 120;
SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; 165;</code></pre><p>The following query of <code class="codeph">V$SQLAREA</code> shows that the three statements require three different parent cursors. As shown by <code class="codeph">VERSION_COUNT</code>, each parent cursor requires its own child cursor.
                           </p><pre class="pre codeblock"><code>COL SQL_TEXT FORMAT a30
SELECT SQL_TEXT, SQL_ID, VERSION_COUNT, HASH_VALUE
FROM   V$SQLAREA
WHERE  SQL_TEXT LIKE '%mployee%'
AND    SQL_TEXT NOT LIKE '%SQL_TEXT%';

SQL_TEXT                              SQL_ID VERSION_COUNT HASH_VALUE
------------------------------ ------------- ------------- ----------
SELECT SUM(salary) FROM hr.emp b1tvfcc5qnczb             1  191509483
loyees WHERE employee_id &lt; 165
SELECT SUM(salary) FROM hr.emp cn5250y0nqpym             1 2169198547
loyees WHERE employee_id &lt; 101
SELECT SUM(salary) FROM hr.emp au8nag2vnfw67             1 3074912455
loyees WHERE employee_id &lt; 120
</code></pre></div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-015E6C8F-4C33-4680-9481-9F93DEDD844B__GUID-16EF4F90-4ACF-4267-B7FA-5E26CF423F2A">
                           <p class="notep1">See Also:</p>
                           <p><span class="q">"<a href="improving-rwp-cursor-sharing.html#GUID-7FF4E133-06A7-401E-9BFC-3B0B9C902346" title="The best practice is to write sharable SQL and use the default of EXACT for CURSOR_SHARING.">Do Not Use CURSOR_SHARING = FORCE as a Permanent Fix</a>"</span> to learn about SQL injection
                           </p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-B7ABA6CC-3E81-4990-BDE4-CF69181079B9" title="Bind variables are essential to cursor sharing in Oracle database applications.">About Literals and Bind Variables</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-042A85BF-D96E-44AB-9312-4EB115CCE7B0" name="GUID-042A85BF-D96E-44AB-9312-4EB115CCE7B0"></a><h5 id="TGSQL-GUID-042A85BF-D96E-44AB-9312-4EB115CCE7B0" class="sect5"><span class="enumeration_section">20.1.3.2 </span>Bind Variables and Cursors
                     </h5>
                     <div>
                        <p>You can develop Oracle applications to use bind variables instead of literals. </p>
                        <p>A <a href="glossary.html#GUID-CA223D31-C3CC-4037-9BAD-9AB69FDD4212"><span class="xrefglossterm">bind variable</span></a> is a placeholder in a query. For example, the statement <code class="codeph">SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; :emp_id</code> uses the bind variable<code class="codeph">:emp_id</code> for the employee ID. 
                        </p>
                        <p>The Real-World Performance group has found that applications that use bind variables perform better, scale better, and are more secure. Major benefits that result from using bind variables include the following:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Applications that use bind variables are not vulnerable to the same SQL injection attacks as applications that use literals.</p>
                           </li>
                           <li>
                              <p>When identical statements use bind variables, Oracle Database can take advantage of cursor sharing, and share the plan and other information when different values are bound to the same statement.</p>
                           </li>
                           <li>
                              <p>Oracle Database avoids the overhead of latching the shared pool and library cache required for hard parsing.</p>
                           </li>
                        </ul>
                        <div class="infoboxnote" id="GUID-042A85BF-D96E-44AB-9312-4EB115CCE7B0__ORACLEDATABASE12CRECOVERINGAPLUGGAB-6B61826C">
                           <p class="notep1">Video:</p>
                           <p>
                              <div class="video-box">
                                 <div id="9269" class="video-container"></div>
                              </div>
                           </p>
                        </div>
                        <div class="example" id="GUID-042A85BF-D96E-44AB-9312-4EB115CCE7B0__GUID-19F02899-4D61-4F80-850A-4A71CA2273F2">
                           <p class="titleinexample">Example 20-7 Bind Variables and Shared Cursors</p>
                           <p>The following example uses the <code class="codeph">VARIABLE</code> command in SQL*Plus to create the <code class="codeph">emp_id</code> bind variable, and then executes a query using three different bind values (<code class="codeph">101</code>, <code class="codeph">120</code>, and <code class="codeph">165</code>):
                           </p><pre class="pre codeblock"><code>VARIABLE emp_id NUMBER

EXEC :emp_id := 101;
SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; :emp_id;
EXEC :emp_id := 120;
SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; :emp_id;
EXEC :emp_id := 165;
SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; :emp_id;
</code></pre><p>The following query of <code class="codeph">V$SQLAREA</code> shows one unique SQL statement:
                           </p><pre class="pre codeblock"><code>COL SQL_TEXT FORMAT a34
SELECT SQL_TEXT, SQL_ID, VERSION_COUNT, HASH_VALUE
FROM   V$SQLAREA
WHERE  SQL_TEXT LIKE '%mployee%'
AND    SQL_TEXT NOT LIKE '%SQL_TEXT%';

SQL_TEXT                           SQL_ID        VERSION_COUNT HASH_VALUE
---------------------------------- ------------- ------------- ----------
SELECT SUM(salary) FROM hr.employe 4318cbskba8yh             1 615850960
es WHERE employee_id &lt; :emp_id
</code></pre><p>The <code class="codeph">VERSION_COUNT</code> value of <code class="codeph">1</code> indicates that the database reused the same child cursor rather than creating three separate child cursors. Using a bind variable made this reuse possible.
                           </p>
                        </div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-B7ABA6CC-3E81-4990-BDE4-CF69181079B9" title="Bind variables are essential to cursor sharing in Oracle database applications.">About Literals and Bind Variables</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL94738"></a><a id="TGSQL95251"></a><div class="props_rev_3"><a id="GUID-3550B486-A3D6-4FB2-99A9-4B90D4ADE421" name="GUID-3550B486-A3D6-4FB2-99A9-4B90D4ADE421"></a><h5 id="TGSQL-GUID-3550B486-A3D6-4FB2-99A9-4B90D4ADE421" class="sect5"><span class="enumeration_section">20.1.3.3 </span>Bind Variable Peeking
                     </h5>
                     <div>
                        <p>In <strong class="term">bind variable peeking</strong> (also known as <span class="italic">bind peeking</span>), the optimizer looks at the value in a bind variable when the database performs a hard parse of a statement.
                        </p>
                        <p> The optimizer does not look at the bind variable values before every parse. Rather, the optimizer peeks only when the optimizer is <span class="italic">first</span> invoked, which is during the hard parse.
                        </p>
                        <p>When a query uses literals, the optimizer can use the literal values to find the best plan. However, when a query uses bind variables, the optimizer must select the best plan without the presence of literals in the SQL text. This task can be extremely difficult. By peeking at bind values during the initial hard parse, the optimizer can determine the cardinality of a <code class="codeph">WHERE</code> clause condition as if literals <span class="italic">had</span> been used, thereby improving the plan.
                        </p>
                        <p>Because the optimizer only peeks at the bind value during the hard parse, the plan may not be optimal for all possible bind values. The following examples illustrate this principle.</p>
                        <div class="example" id="GUID-3550B486-A3D6-4FB2-99A9-4B90D4ADE421__GUID-FA3A4623-2191-44E3-B169-F456704A6F0D">
                           <p class="titleinexample">Example 20-8 Literals Result in Different Execution Plans</p>
                           <p>Assume that you execute the following statements, which execute three different statements using different literals (<code class="codeph">101</code>, <code class="codeph">120</code>, and <code class="codeph">165</code>), and then display the execution plans for each:
                           </p><pre class="pre codeblock"><code>SET LINESIZE 167
SET PAGESIZE 0
SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; 101;
SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR());
SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; 120;
SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR());
SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; 165;
SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR());</code></pre><p>The database hard parsed all three statements, which were not identical. The <code class="codeph">DISPLAY_CURSOR</code> output, which has been edited for clarity, shows that the optimizer chose the same index range scan plan for the first two statements, but a full table scan plan for the statement using literal <code class="codeph">165</code>:
                           </p><pre class="pre codeblock"><code>SQL_ID	cn5250y0nqpym, child number 0
-------------------------------------
SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; 101

Plan hash value: 2410354593

-------------------------------------------------------------------------------------
|Id| Operation                            | Name         |Rows|Bytes|Cost(%CPU)|Time|
-------------------------------------------------------------------------------------
| 0| SELECT STATEMENT                     |               |  |   |2 (100)|          |
| 1|  SORT AGGREGATE                      |               |1 | 8 |       |          |
| 2|   TABLE ACCESS BY INDEX ROWID BATCHED| EMPLOYEES     |1 | 8 |2 (0)  | 00:00:01 |
|*3|    INDEX RANGE SCAN                  | EMP_EMP_ID_PK |1 |   |1 (0)  | 00:00:01 |
-------------------------------------------------------------------------------------
Predicate Information (identified by operation id):
---------------------------------------------------

   3 - access("EMPLOYEE_ID"&lt;101)

SQL_ID	au8nag2vnfw67, child number 0
-------------------------------------
SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; 120

Plan hash value: 2410354593

-------------------------------------------------------------------------------------
|Id| Operation                            | Name         |Rows|Bytes|Cost(%CPU)|Time|
-------------------------------------------------------------------------------------
| 0| SELECT STATEMENT                     |               |  |   |2 (100)|          |
| 1|  SORT AGGREGATE                      |               |1 | 8 |       |          |
| 2|   TABLE ACCESS BY INDEX ROWID BATCHED| EMPLOYEES     |20|160|2 (0)  | 00:00:01 |
|*3|    INDEX RANGE SCAN                  | EMP_EMP_ID_PK |20|   |1 (0)  | 00:00:01 |
-------------------------------------------------------------------------------------

Predicate Information (identified by operation id):
---------------------------------------------------

   3 - access("EMPLOYEE_ID"&lt;120)

SQL_ID	b1tvfcc5qnczb, child number 0
-------------------------------------
SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; 165

Plan hash value: 1756381138

-------------------------------------------------------------------------
| Id  | Operation          | Name      |Rows| Bytes |Cost(%CPU)| Time   |
-------------------------------------------------------------------------
|   0 | SELECT STATEMENT   |           |    |       | 2 (100)|          |
|   1 |  SORT AGGREGATE    |           |  1 |     8 |        |          |
|*  2 |   TABLE ACCESS FULL| EMPLOYEES | 66 |   528 | 2   (0)| 00:00:01 |
-------------------------------------------------------------------------

Predicate Information (identified by operation id):
---------------------------------------------------

   2 - filter("EMPLOYEE_ID"&lt;165)
</code></pre><p>The preceding output shows that the optimizer considers a full table scan more efficient than an index scan for the query that returns more rows. </p>
                        </div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-3550B486-A3D6-4FB2-99A9-4B90D4ADE421__GUID-6FD916FD-09BD-4C78-B37E-6788C4B0911E">
                           <p class="titleinexample">Example 20-9 Bind Variables Result in Cursor Reuse</p>
                           <p>This example rewrites the queries executed in <a href="improving-rwp-cursor-sharing.html#GUID-3550B486-A3D6-4FB2-99A9-4B90D4ADE421__GUID-FA3A4623-2191-44E3-B169-F456704A6F0D">Example 20-8</a> to use bind variables instead of literals. You bind the same values (<code class="codeph">101</code>, <code class="codeph">120</code>, and <code class="codeph">165</code>) to the bind variable <code class="codeph">:emp_id</code>, and then display the execution plans for each:
                           </p><pre class="pre codeblock"><code>VAR emp_id NUMBER

EXEC :emp_id := 101;
SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; :emp_id;
SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR());
EXEC :emp_id := 120;
SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; :emp_id;
SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR());
EXEC :emp_id := 165;
SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; :emp_id;
SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR());</code></pre><p>The <code class="codeph">DISPLAY_CURSOR</code> output shows that the optimizer chose exactly the same plan for all three statements:
                           </p><pre class="pre codeblock"><code>SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; :emp_id

Plan hash value: 2410354593

-------------------------------------------------------------------------------------
| Id | Operation                            | Name      |Rows|Bytes|Cost (%CPU)|Time|
-------------------------------------------------------------------------------------
|  0 | SELECT STATEMENT                     |               | |  |2 (100)|          |
|  1 |  SORT AGGREGATE                      |               |1|8 |       |          |
|  2 |   TABLE ACCESS BY INDEX ROWID BATCHED| EMPLOYEES     |1|8 |  2 (0)| 00:00:01 |
|* 3 |    INDEX RANGE SCAN                  | EMP_EMP_ID_PK |1|  |  1 (0)| 00:00:01 |
-------------------------------------------------------------------------------------

Predicate Information (identified by operation id):
---------------------------------------------------

   3 - access("EMPLOYEE_ID"&lt;:EMP_ID)</code></pre><p>In contrast, when the preceding statements were executed with literals, the optimizer chose a lower-cost full table scan when the employee ID value was <code class="codeph">165</code>. This is the problem solved by adaptive cursor sharing.
                           </p>
                        </div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-3550B486-A3D6-4FB2-99A9-4B90D4ADE421__GUID-7FEE5005-AD37-4B53-9242-46BF2804A121">
                           <p class="notep1">See Also:</p>
                           <p> <span class="q">"<a href="improving-rwp-cursor-sharing.html#GUID-277432AA-CD1C-4A75-AB28-7358E63265B3" title="The adaptive cursor sharing feature enables a single statement that contains bind variables to use multiple execution plans.">Adaptive Cursor Sharing</a>"</span></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-B7ABA6CC-3E81-4990-BDE4-CF69181079B9" title="Bind variables are essential to cursor sharing in Oracle database applications.">About Literals and Bind Variables</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
               <div class="sect3"><a id="GUID-E04CF45D-CC70-4122-9BAC-EAB5B4D0E17A" name="GUID-E04CF45D-CC70-4122-9BAC-EAB5B4D0E17A"></a><h4 id="TGSQL-GUID-E04CF45D-CC70-4122-9BAC-EAB5B4D0E17A" class="sect4"><span class="enumeration_section">20.1.4 </span>About the Life Cycle of Shared Cursors
                  </h4>
                  <div>
                     <p>The database allocates a new shared SQL area when the optimizer parses a new SQL statement that is not DDL. The amount of memory required depends on the statement complexity. </p>
                     <p>The database can remove a shared SQL area from the shared pool even if this area corresponds to an open cursor that has been unused for a long time. If the open cursor is later used to run its statement, then the database reparses the statement and allocates a new shared SQL area. The database does not remove cursors whose statements are executing, or whose rows have not been completely fetched.</p>
                     <p>Shared SQL areas can become invalid because of changes to dependent schema objects or to optimizer statistics. Oracle Database uses two techniques to manage the cursor life cycle: invalidation and rolling invalidation.</p>
                     <p>This section contains the following topics:</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-8D950FF9-EFC0-4264-B4A7-427891C21909">Cursor Marked Invalid</a><br>When a shared SQL area is marked invalid, the database can remove it from the shared pool, along with valid cursors that have been unused for some time. 
                        </li>
                        <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-0BCC0D7A-F1E9-4173-B123-F175BC236588">Cursors Marked Rolling Invalid</a><br>When cursors are marked rolling invalid (<code class="codeph">V$SQL.IS_ROLLING_INVALID</code> is <code class="codeph">Y</code>), the database gradually performs hard parses over an extended time.
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-E04CF45D-CC70-4122-9BAC-EAB5B4D0E17A__GUID-BB0424E6-AC10-485A-9BB7-F099820F3BA7">
                        <p class="notep1">See Also:</p>
                        <p><a href="../cncpt/memory-architecture.html#GUID-F41EF3AF-42D7-4445-A2DD-E800A5E54E3F" target="_blank"><span><cite>Oracle Database Concepts</cite></span></a> for an overview of memory allocation in the shared pool
                        </p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-1DEE6AD7-C30E-4ABB-9BFF-B5895A6E386B" title="Oracle Database can share cursors, which are pointers to private SQL areas in the shared pool.">Overview of Cursor Sharing</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="sect4"><a id="GUID-8D950FF9-EFC0-4264-B4A7-427891C21909" name="GUID-8D950FF9-EFC0-4264-B4A7-427891C21909"></a><h5 id="TGSQL-GUID-8D950FF9-EFC0-4264-B4A7-427891C21909" class="sect5"><span class="enumeration_section">20.1.4.1 </span>Cursor Marked Invalid
                     </h5>
                     <div>
                        <p>When a shared SQL area is marked invalid, the database can remove it from the shared pool, along with valid cursors that have been unused for some time. </p>
                        <p>In some situations, the database must execute a statement that is associated with an invalid shared SQL area in the shared pool. In this case, the database performs a hard parse of the statement before execution.</p>
                        <p>The database immediately marks dependent shared SQL areas invalid when the following conditions are met:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">DBMS_STATS</code> gathers statistics for a table, table cluster, or index when the <code class="codeph">NO_INVALIDATE</code> parameter is <code class="codeph">FALSE</code>.
                              </p>
                           </li>
                           <li>
                              <p>A SQL statement references a schema object, which is later modified by a DDL statement that uses immediate cursor invalidation (default). </p>
                              <p>You can manually specify immediate invalidation on statements such as <code class="codeph">ALTER TABLE ... IMMEDIATE VALIDATION</code> and <code class="codeph">ALTER INDEX ... IMMEDIATE VALIDATION</code>, or set the <code class="codeph">CURSOR_INVALIDATION</code> initialization parameter to <code class="codeph">IMMEDIATE</code> at the session or system level.
                              </p>
                              <div class="infoboxnote" id="GUID-8D950FF9-EFC0-4264-B4A7-427891C21909__GUID-515E1D5A-8CDD-461A-A4DA-3166A57B8458">
                                 <p class="notep1">Note:</p>
                                 <p>A DDL statement using the <code class="codeph">DEFERRED VALIDATION</code> clause overrides the <code class="codeph">IMMEDIATE</code> setting of the <code class="codeph">CURSOR_INVALIDATION</code> initialization parameter.
                                 </p>
                              </div>
                           </li>
                        </ul>
                        <p>When the preceding conditions are met, the database reparses the affected statements at next execution.</p>
                        <p> When the database invalidates a cursor, the <code class="codeph">V$SQL.INVALIDATIONS</code> value increases (for example, from <code class="codeph">0</code> to <code class="codeph">1</code>), and <code class="codeph">V$SQL.OBJECT_STATUS</code> shows <code class="codeph">INVALID_UNAUTH</code>.
                        </p>
                        <div class="example" id="GUID-8D950FF9-EFC0-4264-B4A7-427891C21909__GUID-6236BE5D-98B5-43B5-BC5F-9A28546F878B">
                           <p class="titleinexample">Example 20-10 Forcing Cursor Invalidation by Setting NO_INVALIDATE=FALSE</p>
                           <p>This example logs in as user <code class="codeph">sh</code>, who has been granted administrator privileges. The example queries <code class="codeph">sales</code>, and then gathers statistics for this table with <code class="codeph">NO_INVALIDATE=FALSE</code>. Afterward, the <code class="codeph">V$SQL.INVALIDATIONS</code> value changes from <code class="codeph">0</code> to <code class="codeph">1</code> for the cursor, indicating that the database flagged the cursor as invalid.
                           </p><pre class="pre codeblock"><code>SQL&gt; SELECT COUNT(*) FROM sales;

  COUNT(*)
----------
    918843

SQL&gt; SELECT PREV_SQL_ID SQL_ID FROM V$SESSION WHERE SID = SYS_CONTEXT('userenv', 'SID');

SQL_ID
-------------
1y17j786c7jbh

SQL&gt; SELECT CHILD_NUMBER, EXECUTIONS,
  2  PARSE_CALLS, INVALIDATIONS, OBJECT_STATUS 
  3  FROM V$SQL WHERE SQL_ID = '1y17j786c7jbh';

CHILD_NUMBER EXECUTIONS PARSE_CALLS INVALIDATIONS OBJECT_STATUS
------------ ---------- ----------- ------------- -------------
           0          1           1             0 VALID

SQL&gt; EXEC DBMS_STATS.GATHER_TABLE_STATS(null,'sales',no_invalidate =&gt; FALSE);

PL/SQL procedure successfully completed.

SQL&gt; SELECT CHILD_NUMBER, EXECUTIONS,
  2  PARSE_CALLS, INVALIDATIONS, OBJECT_STATUS
  3  FROM V$SQL WHERE SQL_ID = '1y17j786c7jbh';

CHILD_NUMBER EXECUTIONS PARSE_CALLS INVALIDATIONS OBJECT_STATUS
------------ ---------- ----------- ------------- --------------
           0          1           1             1 INVALID_UNAUTH</code></pre></div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-8D950FF9-EFC0-4264-B4A7-427891C21909__ORACLEDATABASESQLTUNINGGUIDETOLEARN-DEBC5660">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="q">"<a href="influencing-the-optimizer.html#GUID-C1C85DEA-3583-40FE-B5BB-6AC8F76FFE34" title="Oracle Database provides initialization parameters to influence various aspects of optimizer behavior, including cursor sharing, adaptive optimization, and the optimizer mode.">About Optimizer Initialization Parameters</a>"</span></p>
                              </li>
                              <li>
                                 <p><a href="../sqlrf/ALTER-TABLE.html#SQLRF01001" target="_blank"><span><cite>Oracle Database SQL Language Reference</cite></span></a> to learn more about <code class="codeph">ALTER TABLE ... IMMEDIATE VALIDATION</code>  and other DDL statements that permit immediate validation
                                 </p>
                              </li>
                              <li>
                                 <p><a href="../refrn/V-SQL.html#REFRN30246" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn more about <code class="codeph">V$SQL</code> and <code class="codeph">V$SQLAREA</code> dynamic views
                                 </p>
                              </li>
                              <li>
                                 <p><a href="../refrn/CURSOR_INVALIDATION.html#REFRN-GUID-6BAB61E7-FABA-41D3-B73A-EB828A6767E5" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn more about the <code class="codeph">CURSOR_INVALIDATION</code> initialization parameter
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-E04CF45D-CC70-4122-9BAC-EAB5B4D0E17A" title="The database allocates a new shared SQL area when the optimizer parses a new SQL statement that is not DDL. The amount of memory required depends on the statement complexity.">About the Life Cycle of Shared Cursors</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-0BCC0D7A-F1E9-4173-B123-F175BC236588" name="GUID-0BCC0D7A-F1E9-4173-B123-F175BC236588"></a><h5 id="TGSQL-GUID-0BCC0D7A-F1E9-4173-B123-F175BC236588" class="sect5"><span class="enumeration_section">20.1.4.2 </span>Cursors Marked Rolling Invalid
                     </h5>
                     <div>
                        <p>When cursors are marked rolling invalid (<code class="codeph">V$SQL.IS_ROLLING_INVALID</code> is <code class="codeph">Y</code>), the database gradually performs hard parses over an extended time.
                        </p>
                        <div class="infoboxnote" id="GUID-0BCC0D7A-F1E9-4173-B123-F175BC236588__GUID-D0B46ECA-71CA-449C-8878-AF2C1250763A">
                           <p class="notep1">Note:</p>
                           <p>When <code class="codeph">V$SQL.IS_ROLLING_REFRESH_INVALID</code> is <code class="codeph">Y</code>, the underlying object has changed, but recompilation of the cursor is not required. The database updates metadata in the cursor.
                           </p>
                        </div>
                        <div class="section">
                           <p class="subhead3" id="GUID-0BCC0D7A-F1E9-4173-B123-F175BC236588__GUID-0C183D1F-EF53-40EE-B471-8332C769D73A">Purpose of Rolling Invalidation</p>
                           <p>Because a sharp increase in hard parses can significantly degrade performance, rolling invalidation—also called <span class="italic">deferred invalidation</span>—is useful for workloads that simultaneously invalidate many cursors. The database assigns each invalid cursor a randomly generated time period. SQL areas invalidated at the same time typically have different time periods.
                           </p>
                           <p>A hard parse occurs only if a query accessing the cursor executes <span class="italic">after</span> the time period has expired. In this way, the database diffuses the overhead of hard parsing over time.
                           </p>
                           <div class="infoboxnote" id="GUID-0BCC0D7A-F1E9-4173-B123-F175BC236588__GUID-5B8DB31C-6F8E-473C-BF07-EC553D69A0EA">
                              <p class="notep1">Note:</p>
                              <p>If parallel SQL statements are marked rolling invalid, then the database performs a hard parse at next execution, regardless of whether the time period has expired. In an Oracle Real Application Clusters (Oracle RAC) environment, this technique ensures consistency between execution plans of parallel execution servers and the query coordinator.</p>
                           </div>
                           <p>An analogy for rolling invalidation might be the gradual replacement of worn-out office furniture. Instead of replacing all the furniture at once, forcing a substantial financial outlay, a company assigns each piece a different expiration date. Over the course of a year, a piece stays in use until it is replaced, at which point a cost is incurred.</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-0BCC0D7A-F1E9-4173-B123-F175BC236588__GUID-8F6F3DDE-B238-42E0-AF98-CC8EA3F56BD8">Specification of Deferred Invalidation</p>
                           <p>By default, DDL specifies that statements accessing the object use immediate cursor invalidation. For example, if you create a table or an index, then cursors that reference this table or index use immediate invalidation.</p>
                           <p>If a DDL statement supports deferred cursor invalidation, then you can override the default behavior by using statements such as <code class="codeph">ALTER TABLE ... DEFERRED INVALIDATION</code>. The options depend on the DDL statement. For example, <code class="codeph">ALTER INDEX</code> only supports <code class="codeph">DEFERRED INVALIDATION</code> when the <code class="codeph">UNUSABLE</code> or <code class="codeph">REBUILD</code> option is also specified.
                           </p>
                           <p>An alternative to DDL is setting the <code class="codeph">CURSOR_INVALIDATION</code> initialization parameter to <code class="codeph">DEFERRED</code> at the session or system level. A DDL statement using the <code class="codeph">IMMEDIATE INVALIDATION</code> clause overrides the <code class="codeph">DEFERRED</code> setting of the <code class="codeph">CURSOR_INVALIDATION</code> initialization parameter.
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-0BCC0D7A-F1E9-4173-B123-F175BC236588__GUID-C2858E6D-0111-4CC7-AA42-6D97C07FAD14">When Rolling Invalidation Occurs</p>
                           <p>If the <code class="codeph">DEFERRED INVALIDATION</code> attribute applies to an object, either as a result of DDL or an initialization parameter setting, then statements that access the object may be subject to deferred invalidation. The database marks shared SQL areas as rolling invalid in either of the following circumstances:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">DBMS_STATS</code> gathers statistics for a table, table cluster, or index when the <code class="codeph">NO_INVALIDATE</code> parameter is set to <code class="codeph">DBMS_STATS.AUTO_INVALIDATE</code>. This is the default setting.
                                 </p>
                              </li>
                              <li>
                                 <p>One of the following statements is issued with <code class="codeph">DEFERRED INVALIDATION</code> in circumstances that do not prevent the use of deferred invalidation:
                                 </p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p><a href="../sqlrf/ALTER-TABLE.html#GUID-552E7373-BF93-477D-9DA3-B2C9386F2877" target="_blank"><code class="codeph">ALTER TABLE</code></a> on partitioned tables
                                       </p>
                                    </li>
                                    <li>
                                       <p><a href="../sqlrf/ALTER-TABLE.html#GUID-552E7373-BF93-477D-9DA3-B2C9386F2877" target="_blank"><code class="codeph">ALTER TABLE ... PARALLEL</code></a></p>
                                    </li>
                                    <li>
                                       <p><a href="../sqlrf/ALTER-INDEX.html#GUID-D8F648E7-8C07-4C89-BB71-862512536558" target="_blank"><code class="codeph">ALTER INDEX ... UNUSABLE</code></a></p>
                                    </li>
                                    <li>
                                       <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=GUID-D8F648E7-8C07-4C89-BB71-862512536558" target="_blank"><code class="codeph">ALTER INDEX ... REBUILD</code></a></p>
                                    </li>
                                    <li>
                                       <p><a href="../sqlrf/CREATE-INDEX.html#GUID-1F89BBC0-825F-4215-AF71-7588E31D8BFE" target="_blank"><code class="codeph">CREATE INDEX</code></a></p>
                                    </li>
                                    <li>
                                       <p><a href="../sqlrf/DROP-INDEX.html#GUID-F60F75DF-2866-4F93-BB7F-8FCE64BF67B6" target="_blank"><code class="codeph">DROP INDEX</code></a></p>
                                    </li>
                                    <li>
                                       <p><a href="../sqlrf/TRUNCATE-TABLE.html#GUID-B76E5846-75B5-4876-98EC-439E15E4D8A4" target="_blank"><code class="codeph">TRUNCATE TABLE</code></a> on partitioned tables
                                       </p>
                                    </li>
                                 </ul>
                                 <p>A subset of DDL statements require immediate cursor invalidation for DML (<code class="codeph">INSERT</code>, <code class="codeph">UPDATE</code>, <code class="codeph">DELETE</code>, or <code class="codeph">MERGE</code>) but not <code class="codeph">SELECT</code> statements. Many factors relating to the specific DDL statements and affected cursors determine whether Oracle Database uses deferred invalidation.
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-0BCC0D7A-F1E9-4173-B123-F175BC236588__ORACLEDATABASESQLTUNINGGUIDETOLEARN-DEBC5660">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="q">"<a href="influencing-the-optimizer.html#GUID-C1C85DEA-3583-40FE-B5BB-6AC8F76FFE34" title="Oracle Database provides initialization parameters to influence various aspects of optimizer behavior, including cursor sharing, adaptive optimization, and the optimizer mode.">About Optimizer Initialization Parameters</a>"</span></p>
                              </li>
                              <li>
                                 <p><a href="../sqlrf/ALTER-TABLE.html#SQLRF01001" target="_blank"><span><cite>Oracle Database SQL Language Reference</cite></span></a> to learn more about <code class="codeph">ALTER TABLE ... DEFERRED INVALIDATION</code> and other DDL statements that permit deferred invalidation
                                 </p>
                              </li>
                              <li>
                                 <p><a href="../refrn/V-SQL.html#REFRN30246" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn more about <code class="codeph">V$SQL</code> and <code class="codeph">V$SQLAREA</code> dynamic views
                                 </p>
                              </li>
                              <li>
                                 <p><a href="../refrn/CURSOR_INVALIDATION.html#REFRN-GUID-6BAB61E7-FABA-41D3-B73A-EB828A6767E5" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn more about the <code class="codeph">CURSOR_INVALIDATION</code> initialization parameter
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-E04CF45D-CC70-4122-9BAC-EAB5B4D0E17A" title="The database allocates a new shared SQL area when the optimizer parses a new SQL statement that is not DDL. The amount of memory required depends on the statement complexity.">About the Life Cycle of Shared Cursors</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div><a id="TGSQL94748"></a><div class="props_rev_3"><a id="GUID-267E5860-A8D5-4E5F-AE60-16304E97E4EE" name="GUID-267E5860-A8D5-4E5F-AE60-16304E97E4EE"></a><h3 id="TGSQL-GUID-267E5860-A8D5-4E5F-AE60-16304E97E4EE" class="sect3"><span class="enumeration_section">20.2 </span>CURSOR_SHARING and Bind Variable Substitution
               </h3>
               <div>
                  <p>This topic explains what the <code class="codeph">CURSOR_SHARING</code> initialization parameter is, and how setting it to different values affects how Oracle Database uses bind variables.
                  </p>
                  <p>This section contains the following topics:</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-7A0CD3D1-1ECB-4DA4-813A-0D8D79C8B65D">CURSOR_SHARING Initialization Parameter</a><br>The <code class="codeph">CURSOR_SHARING</code> initialization parameter controls how the database processes statements with bind variables.
                     </li>
                     <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-250B8578-4407-4A10-B609-67C2276EBBBB">Parsing Behavior When CURSOR_SHARING = FORCE</a><br>When SQL statements use literals rather than bind variables, setting the <code class="codeph">CURSOR_SHARING</code> initialization parameter to <code class="codeph">FORCE</code> enables the database to replace literals with system-generated bind variables. Using this technique, the database can sometimes reduce the number of parent cursors in the shared SQL area.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-971F4652-3950-4662-82DE-713DDEED317C" title="Cursor sharing can improve database application performance by orders of magnitude.">Improving Real-World Performance Through Cursor Sharing</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-7A0CD3D1-1ECB-4DA4-813A-0D8D79C8B65D" name="GUID-7A0CD3D1-1ECB-4DA4-813A-0D8D79C8B65D"></a><h4 id="TGSQL-GUID-7A0CD3D1-1ECB-4DA4-813A-0D8D79C8B65D" class="sect4"><span class="enumeration_section">20.2.1 </span>CURSOR_SHARING Initialization Parameter
                  </h4>
                  <div>
                     <p>The <code class="codeph">CURSOR_SHARING</code> initialization parameter controls how the database processes statements with bind variables.
                     </p>
                     <div class="section">
                        <p>In <span>Oracle Database 12c</span>, the parameter supports the following values:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">EXACT</code></p>
                              <p>This is the default value. The database enables only textually identical statements to share a cursor. The database does not attempt to replace literal values with system-generated bind variables. In this case, the optimizer generates a plan for each statement based on the literal value.</p>
                           </li>
                           <li>
                              <p><code class="codeph">FORCE</code></p>
                              <p>The database replaces all literals with system-generated bind variables. For statements that are identical after the bind variables replace the literals, the optimizer uses the same plan.</p>
                           </li>
                        </ul>
                        <div class="infoboxnote" id="GUID-7A0CD3D1-1ECB-4DA4-813A-0D8D79C8B65D__GUID-0AA98E35-F14C-4578-911C-08B989FD2885">
                           <p class="notep1">Note:</p>
                           <p>The <code class="codeph">SIMILAR</code> value for <code class="codeph">CURSOR_SHARING</code> is deprecated.
                           </p>
                        </div>
                        <p>You can set <code class="codeph">CURSOR_SHARING</code> at the system or session level, or use the <code class="codeph">CURSOR_SHARING_EXACT</code> hint at the statement level.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-7A0CD3D1-1ECB-4DA4-813A-0D8D79C8B65D__GUID-9CD5DA26-0477-4437-8155-9E5B890F6913">
                        <p class="notep1">See Also:</p>
                        <p><span class="q">"<a href="improving-rwp-cursor-sharing.html#GUID-7FF4E133-06A7-401E-9BFC-3B0B9C902346" title="The best practice is to write sharable SQL and use the default of EXACT for CURSOR_SHARING.">Do Not Use CURSOR_SHARING = FORCE as a Permanent Fix</a>"</span></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-267E5860-A8D5-4E5F-AE60-16304E97E4EE" title="This topic explains what the CURSOR_SHARING initialization parameter is, and how setting it to different values affects how Oracle Database uses bind variables.">CURSOR_SHARING and Bind Variable Substitution</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL94749"></a><div class="props_rev_3"><a id="GUID-250B8578-4407-4A10-B609-67C2276EBBBB" name="GUID-250B8578-4407-4A10-B609-67C2276EBBBB"></a><h4 id="TGSQL-GUID-250B8578-4407-4A10-B609-67C2276EBBBB" class="sect4"><span class="enumeration_section">20.2.2 </span>Parsing Behavior When CURSOR_SHARING = FORCE
                  </h4>
                  <div>
                     <p>When SQL statements use literals rather than bind variables, setting the <code class="codeph">CURSOR_SHARING</code> initialization parameter to <code class="codeph">FORCE</code> enables the database to replace literals with system-generated bind variables. Using this technique, the database can sometimes reduce the number of parent cursors in the shared SQL area.
                     </p>
                     <div class="infoboxnote" id="GUID-250B8578-4407-4A10-B609-67C2276EBBBB__GUID-70C3427D-7F0A-4814-BF08-664009ED7865">
                        <p class="notep1">Note:</p>
                        <p>If a statement uses an <code class="codeph">ORDER BY</code> clause, then the database does not perform literal replacement in the clause because it is not semantically correct to consider the constant column number as a literal. The column number in the <code class="codeph">ORDER BY</code> clause affects the query plan and execution, so the database cannot share two cursors having different column numbers.
                        </p>
                     </div>
                     <p>When <code class="codeph">CURSOR_SHARING</code> is set to <code class="codeph">FORCE</code>, the database performs the following steps during the parse:
                     </p>
                     <ol>
                        <li>
                           <p>Copies <span class="italic">all</span> literals in the statement to the PGA, and replaces them with system-generated bind variables
                           </p>
                           <p>For example, an application could process the following statement:</p><pre class="pre codeblock"><code>SELECT SUBSTR(last_name, 1, 4), SUM(salary) 
FROM   hr.employees 
WHERE  employee_id &lt; 101 GROUP BY last_name</code></pre><p>The optimizer replaces literals, including the literals in the <code class="codeph">SUBSTR</code> function, as follows:
                           </p><pre class="pre codeblock"><code>SELECT SUBSTR(last_name, :"SYS_B_0", :"SYS_B_1"), SUM(salary) 
FROM   hr.employees 
WHERE  employee_id &lt; :"SYS_B_2" GROUP BY last_name</code></pre></li>
                        <li>
                           <p>Searches for an identical statement (same SQL hash value) in the shared pool</p>
                           <p>If an identical statement is <span class="italic">not</span> found, then the database performs a hard parse. Otherwise, the database proceeds to the next step.
                           </p>
                        </li>
                        <li>
                           <p>Performs a soft parse of the statement</p>
                        </li>
                     </ol>
                     <p>As the preceding steps indicate, setting the <code class="codeph">CURSOR_SHARING</code> initialization parameter to <code class="codeph">FORCE</code> does <span class="italic">not</span> reduce the parse count. Rather, in some cases, <code class="codeph">FORCE</code> enables the database to perform a soft parse instead of a hard parse. Also, <code class="codeph">FORCE</code> does not the prevent against SQL injection attacks because Oracle Database binds the values after any injection has already occurred.
                     </p>
                     <div class="example" id="GUID-250B8578-4407-4A10-B609-67C2276EBBBB__GUID-2321405F-C9F1-45E1-AD89-667498594D02">
                        <p class="titleinexample">Example 20-11 Replacement of Literals with System Bind Variables</p>
                        <p>This example sets <code class="codeph">CURSOR_SHARING</code> to <code class="codeph">FORCE</code> at the session level, executes three statements containing literals, and displays the plan for each statement:
                        </p><pre class="pre codeblock"><code>ALTER SESSION SET CURSOR_SHARING=FORCE;
SET LINESIZE 170
SET PAGESIZE 0
SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; 101;
SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR());
SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; 120;
SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR());
SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; 165;
SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR());</code></pre><p>The following<code class="codeph"> DISPLAY_CURSOR</code> output, edited for readability, shows that all three statements used the same plan. The optimizer chose the plan, an index range scan, because it peeked at the <span class="italic">first</span> value (<code class="codeph">101</code>) bound to the system bind variable, and picked this plan as the best for all values. In fact, this plan is not the best plan for all values. When the value is <code class="codeph">165</code>, a full table scan is more efficient.
                        </p><pre class="pre codeblock"><code>SQL_ID	cxx8n1cxr9khn, child number 0
-------------------------------------
SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; :"SYS_B_0"

Plan hash value: 2410354593

-------------------------------------------------------------------------------------
| Id  | Operation                           | Name       |Rows|Bytes|Cost(%CPU)|Time|
-------------------------------------------------------------------------------------
|  0 | SELECT STATEMENT                     |               |  |   |2 (100)|        |
|  1 |  SORT AGGREGATE                      |               |1 | 8 |       |        |
|  2 |   TABLE ACCESS BY INDEX ROWID BATCHED| EMPLOYEES     |1 | 8 |2 (0)  |00:00:01|
|* 3 |    INDEX RANGE SCAN                  | EMP_EMP_ID_PK |1 |   |1 (0)  |00:00:01|
-------------------------------------------------------------------------------------
Predicate Information (identified by operation id):
---------------------------------------------------

   3 - access("EMPLOYEE_ID"&lt;101)

</code></pre><p>A query of <code class="codeph">V$SQLAREA</code> confirms that Oracle Database replaced with the literal with system bind variable <code class="codeph">:”SYS_B_0”</code>, and created one parent and one child cursor (<code class="codeph">VERSION_COUNT=1</code>) for all three statements, which means that all executions shared the same plan.
                        </p><pre class="pre codeblock"><code>COL SQL_TEXT FORMAT a36
SELECT SQL_TEXT, SQL_ID, VERSION_COUNT, HASH_VALUE
FROM   V$SQLAREA
WHERE  SQL_TEXT LIKE '%mployee%'
AND    SQL_TEXT NOT LIKE '%SQL_TEXT%';

SQL_TEXT                             SQL_ID        VERSION_COUNT HASH_VALUE
------------------------------------ ------------- ------------- ----------
SELECT SUM(salary) FROM hr.employees cxx8n1cxr9khn             1  997509652
 WHERE employee_id &lt; :"SYS_B_0"
</code></pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-250B8578-4407-4A10-B609-67C2276EBBBB__GUID-C8938B20-ABD1-4FE3-B718-2D84BCB814D5">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="q">"<a href="improving-rwp-cursor-sharing.html#GUID-782D3329-0CC5-4312-B9B5-2A012A4AD7C8" title="A cursor in the private SQL area points to a shared SQL area in the library cache.">Private and Shared SQL Areas</a>"</span> for more details on the various checks performed
                              </p>
                           </li>
                           <li>
                              <p><a href="../refrn/CURSOR_SHARING.html#REFRN10025" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">CURSOR_SHARING</code> initialization parameter
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-267E5860-A8D5-4E5F-AE60-16304E97E4EE" title="This topic explains what the CURSOR_SHARING initialization parameter is, and how setting it to different values affects how Oracle Database uses bind variables.">CURSOR_SHARING and Bind Variable Substitution</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL94740"></a><div class="props_rev_3"><a id="GUID-277432AA-CD1C-4A75-AB28-7358E63265B3" name="GUID-277432AA-CD1C-4A75-AB28-7358E63265B3"></a><h3 id="TGSQL-GUID-277432AA-CD1C-4A75-AB28-7358E63265B3" class="sect3"><span class="enumeration_section">20.3 </span>Adaptive Cursor Sharing
               </h3>
               <div>
                  <p>The <strong class="term">adaptive cursor sharing</strong> feature enables a single statement that contains bind variables to use multiple execution plans.
                  </p>
                  <p>Cursor sharing is "adaptive" because the cursor adapts its behavior so that the database does not always use the same plan for each execution or bind variable value. This section contains the following topics:</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-42432DFE-D56A-4B9A-8FCF-94FB86012AFC">Purpose of Adaptive Cursor Sharing</a><br>With bind peeking, the optimizer peeks at the values of user-defined bind variables on the first invocation of a cursor. 
                     </li>
                     <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-25A179EF-CAE7-42A2-BF91-F1D4EDAACCEC">How Adaptive Cursor Sharing Works: Example</a><br>Adaptive cursor sharing monitors statements that use bind variables to determine whether a new plan is more efficient.
                     </li>
                     <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-BC20D195-C80F-492A-B2D9-0BE2AFF6968C">Bind-Sensitive Cursors</a><br>A <span class="bold">bind-sensitive cursor</span> is a cursor whose optimal plan may depend on the value of a bind variable. 
                     </li>
                     <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-FD923B79-F1A8-401A-8C61-FD00B41A70F4">Bind-Aware Cursors</a><br>A <span class="bold">bind-aware cursor</span> is a bind-sensitive cursor that is eligible to use different plans for different bind values. 
                     </li>
                     <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-59B4BED5-62FF-421F-92ED-7BB32F6E68F4">Cursor Merging</a><br>If the optimizer creates a plan for a bind-aware cursor, and if this plan is the same as an existing cursor, then the optimizer can perform <strong class="term">cursor merging</strong>.
                     </li>
                     <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-A3B8972A-A74D-4353-960B-5E09D294031E">Adaptive Cursor Sharing Views</a><br>You can use the <code class="codeph">V$</code> views for adaptive cursor sharing to see selectivity ranges, cursor information (such as whether a cursor is bind-aware or bind-sensitive), and execution statistics.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-971F4652-3950-4662-82DE-713DDEED317C" title="Cursor sharing can improve database application performance by orders of magnitude.">Improving Real-World Performance Through Cursor Sharing</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-42432DFE-D56A-4B9A-8FCF-94FB86012AFC" name="GUID-42432DFE-D56A-4B9A-8FCF-94FB86012AFC"></a><h4 id="TGSQL-GUID-42432DFE-D56A-4B9A-8FCF-94FB86012AFC" class="sect4"><span class="enumeration_section">20.3.1 </span>Purpose of Adaptive Cursor Sharing
                  </h4>
                  <div>
                     <p>With bind peeking, the optimizer peeks at the values of user-defined bind variables on the first invocation of a cursor. </p>
                     <p>The optimizer determines the cardinality of any <code class="codeph">WHERE</code> clause condition as if literals had been used instead of bind variables. If a column in a <code class="codeph">WHERE</code> clause has skewed data, however, then a histogram may exist on this column. When the optimizer peeks at the value of the user-defined bind variable and chooses a plan, this plan may not be good for all values. 
                     </p>
                     <p>In adaptive cursor sharing, the database monitors data accessed over time for different bind values, ensuring the optimal choice of cursor for a specific bind value. For example, the optimizer might choose one plan for bind value <code class="codeph">10</code> and a different plan for bind value <code class="codeph">50</code>. Cursor sharing is "adaptive" because the cursor adapts its behavior so that the optimizer does not always choose the same plan for each execution or bind variable value. Thus, the optimizer automatically detects when different execution of a statement would benefit from different execution plans.
                     </p>
                     <div class="infoboxnote" id="GUID-42432DFE-D56A-4B9A-8FCF-94FB86012AFC__GUID-07DBCDAF-D36B-4C4E-B4E7-2A0BCEDB2D9E">
                        <p class="notep1">Note:</p>
                        <p>Adaptive cursor sharing is independent of the <code class="codeph">CURSOR_SHARING</code> initialization parameter. Adaptive cursor sharing is equally applicable to statements that contain user-defined and system-generated bind variables. Adaptive cursor sharing does not apply to statements that contain only literals. 
                        </p>
                     </div>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-277432AA-CD1C-4A75-AB28-7358E63265B3" title="The adaptive cursor sharing feature enables a single statement that contains bind variables to use multiple execution plans.">Adaptive Cursor Sharing</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-25A179EF-CAE7-42A2-BF91-F1D4EDAACCEC" name="GUID-25A179EF-CAE7-42A2-BF91-F1D4EDAACCEC"></a><h4 id="TGSQL-GUID-25A179EF-CAE7-42A2-BF91-F1D4EDAACCEC" class="sect4"><span class="enumeration_section">20.3.2 </span>How Adaptive Cursor Sharing Works: Example
                  </h4>
                  <div>
                     <p>Adaptive cursor sharing monitors statements that use bind variables to determine whether a new plan is more efficient.</p>
                     <p>Assume that an application executes the following statement five times, binding different values every time:</p><pre class="pre codeblock"><code>SELECT * FROM employees WHERE salary = :sal AND department_id = :dept</code></pre><p>Also assume in this example that a histogram exists on at least one of the columns in the predicate. The database processes this statement as follows:</p>
                     <ol>
                        <li>
                           <p>The application issues the statement for the first time, which causes a hard parse. During the parse, the database performs the following tasks:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Peeks at the bind variables to generate the initial plan.</p>
                              </li>
                              <li>
                                 <p>Marks the cursor as bind-sensitive. A <a href="glossary.html#GUID-13913DD1-DD30-49DF-8041-B3C0F0DC7F7D"><span class="xrefglossterm">bind-sensitive cursor</span></a> is a cursor whose optimal plan may depend on the value of a bind variable. To determine whether a different plan is beneficial, the database monitors the behavior of a bind-sensitive cursor that uses different bind values.
                                 </p>
                              </li>
                              <li>
                                 <p>Stores metadata about the predicate, including the cardinality of the bound values (in this example, assume that only 5 rows were returned).</p>
                              </li>
                              <li>
                                 <p>Creates an execution plan (in this example, index access) based on the peeked values.</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>The database executes the cursor, storing the bind values and execution statistics in the cursor.</p>
                        </li>
                        <li>
                           <p>The application issues the statement a second time, using different bind variables, causing the database to perform a soft parse, and find the matching cursor in the library cache.</p>
                        </li>
                        <li>
                           <p>The database executes the cursor.</p>
                        </li>
                        <li>
                           <p>The database performs the following post-execution tasks:</p>
                           <ol type="a">
                              <li>
                                 <p>The database compares the execution statistics for the second execution with the first-execution statistics.</p>
                              </li>
                              <li>
                                 <p>The database observes the pattern of statistics over all previous executions, and then decides whether to mark the cursor as a <a href="glossary.html#GUID-4266372A-4D7E-4738-92BA-868354F55786"><span class="xrefglossterm">bind-aware cursor</span></a>. In this example, assume that the database decides the cursor is bind-aware.
                                 </p>
                              </li>
                           </ol>
                        </li>
                        <li>
                           <p>The application issues the statement a third time, using different bind variables, which causes a soft parse. Because the cursor is bind-aware, the database does the following:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Determines whether the cardinality of the new values falls within the same range as the stored cardinality. In this example, the cardinality is similar: 8 rows instead of 5 rows.</p>
                              </li>
                              <li>
                                 <p>Reuses the execution plan in the existing child cursor.</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>The database executes the cursor.</p>
                        </li>
                        <li>
                           <p>The application issues the statement a fourth time, using different bind variables, causing a soft parse. Because the cursor is bind-aware, the database does the following:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Determines whether the cardinality of the new values falls within the same range as the stored cardinality. In this example, the cardinality is vastly different: 102 rows (in a table with 107 rows) instead of 5 rows.</p>
                              </li>
                              <li>
                                 <p>Does not find a matching child cursor.</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>The database performs a hard parse. As a result, the database does the following:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Creates a new child cursor with a <span class="italic">second</span> execution plan (in this example, a full table scan)
                                 </p>
                              </li>
                              <li>
                                 <p>Stores metadata about the predicate, including the cardinality of the bound values, in the cursor</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>The database executes the new cursor.</p>
                        </li>
                        <li>
                           <p>The database stores the new bind values and execution statistics in the new child cursor.</p>
                        </li>
                        <li>
                           <p>The application issues the statement a fifth time, using different bind variables, which causes a soft parse. Because the cursor is bind-aware, the database does the following:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Determines whether the cardinality of the new values falls within the same range as the stored cardinality. In this example, the cardinality is 20.</p>
                              </li>
                              <li>
                                 <p>Does not find a matching child cursor.</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>The database performs a hard parse. As a result, the database does the following:</p>
                           <ol type="a">
                              <li>
                                 <p>Creates a new child cursor with a <span class="italic">third</span> execution plan (in this example, index access)
                                 </p>
                              </li>
                              <li>
                                 <p>Determines that this index access execution plan is the same as the index access execution plan used for the first execution of the statement</p>
                              </li>
                              <li>
                                 <p>Merges the two child cursors containing index access plans, which involves storing the combined cardinality statistics into one child cursor, and deleting the other one</p>
                              </li>
                           </ol>
                        </li>
                        <li>
                           <p>The database executes the cursor using the index access execution plan.</p>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-277432AA-CD1C-4A75-AB28-7358E63265B3" title="The adaptive cursor sharing feature enables a single statement that contains bind variables to use multiple execution plans.">Adaptive Cursor Sharing</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL94742"></a><a id="TGSQL94741"></a><div class="props_rev_3"><a id="GUID-BC20D195-C80F-492A-B2D9-0BE2AFF6968C" name="GUID-BC20D195-C80F-492A-B2D9-0BE2AFF6968C"></a><h4 id="TGSQL-GUID-BC20D195-C80F-492A-B2D9-0BE2AFF6968C" class="sect4"><span class="enumeration_section">20.3.3 </span>Bind-Sensitive Cursors
                  </h4>
                  <div>
                     <p>A <span class="bold">bind-sensitive cursor</span> is a cursor whose optimal plan may depend on the value of a bind variable. 
                     </p>
                     <p>The database has examined the bind value when computing cardinality, and considers the query “sensitive” to plan changes based on different bind values. The database monitors the behavior of a bind-sensitive cursor that uses different bind values to determine whether a different plan is beneficial.</p>
                     <p>The optimizer uses the following criteria to decide whether a cursor is bind-sensitive:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The optimizer has peeked at the bind values to generate cardinality estimates.</p>
                        </li>
                        <li>
                           <p>The bind is used in an equality or a range predicate.</p>
                        </li>
                     </ul>
                     <p>For each execution of the query with a new bind value, the database records the execution statistics for the new value and compares them to the execution statistics for the previous value. If execution statistics vary greatly, then the database marks the cursor bind-aware.</p>
                     <div class="example" id="GUID-BC20D195-C80F-492A-B2D9-0BE2AFF6968C__GUID-AE386A44-DBE5-4B73-B866-37129E9C9070">
                        <p class="titleinexample">Example 20-12 Column with Significant Data Skew</p>
                        <p>This example assumes that the <code class="codeph">hr.employees.department_id</code> column has significant data skew. <code class="codeph">SYSTEM</code> executes the following setup code, which adds 100,000 employees in department 50 to the <code class="codeph">employees</code> table in the sample schema, for a total of 100,107 rows, and then gathers table statistics:
                        </p><pre class="pre codeblock"><code>DELETE FROM hr.employees WHERE employee_id &gt; 999;

ALTER TABLE hr.employees DISABLE NOVALIDATE CONSTRAINT emp_email_uk;

DECLARE
v_counter NUMBER(7) := 1000;
BEGIN
 FOR i IN 1..100000 LOOP    
 INSERT INTO hr.employees 
   VALUES (v_counter,null,'Doe','Doe@example.com',null,'07-JUN-02','AC_ACCOUNT',null,null,null,50);
 v_counter := v_counter + 1;
 END LOOP;
END;
/
COMMIT; 

EXEC DBMS_STATS.GATHER_TABLE_STATS ( ownname =&gt; 'hr', tabname =&gt; 'employees');

ALTER SYSTEM FLUSH SHARED_POOL;</code></pre><p>The following query shows a histogram on the <code class="codeph">employees.department_id</code> column:
                        </p><pre class="pre codeblock"><code>COL TABLE_NAME FORMAT a15
COL COLUMN_NAME FORMAT a20
COL HISTOGRAM FORMAT a9

SELECT TABLE_NAME, COLUMN_NAME, HISTOGRAM
FROM   DBA_TAB_COLS
WHERE  OWNER = 'HR'
AND    TABLE_NAME = 'EMPLOYEES'
AND    COLUMN_NAME = 'DEPARTMENT_ID';

TABLE_NAME      COLUMN_NAME          HISTOGRAM
--------------- -------------------- ---------
EMPLOYEES       DEPARTMENT_ID        FREQUENCY</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-BC20D195-C80F-492A-B2D9-0BE2AFF6968C__GUID-F1AFAAFE-CCB3-4117-89F6-5E09A17377E7">
                        <p class="titleinexample">Example 20-13 Low-Cardinality Query</p>
                        <p>This example continues the example in <a href="improving-rwp-cursor-sharing.html#GUID-BC20D195-C80F-492A-B2D9-0BE2AFF6968C__GUID-AE386A44-DBE5-4B73-B866-37129E9C9070">Example 20-12</a>. The following query shows that the value <code class="codeph">10</code> has extremely low cardinality for the column <code class="codeph">department_id</code>, occupying .00099% of the rows:
                        </p><pre class="pre codeblock"><code>VARIABLE dept_id NUMBER
EXEC :dept_id := 10;
SELECT COUNT(*), MAX(employee_id) FROM hr.employees WHERE department_id = :dept_id;

  COUNT(*) MAX(EMPLOYEE_ID)
---------- ----------------
         1              200
</code></pre><p>The optimizer chooses an <a href="glossary.html#GUID-15413560-9C69-4C7A-A16E-824D1DE7C5B3"><span class="xrefglossterm">index range scan</span></a>, as expected for such a low-cardinality query:
                        </p><pre class="pre codeblock"><code>SQL&gt; SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR);

PLAN_TABLE_OUTPUT
-------------------------------------
SQL_ID	a9upgaqqj7bn5, child number 0
-------------------------------------
select COUNT(*), MAX(employee_id) FROM hr.employees WHERE department_id = :dept_id

Plan hash value: 1642965905

-------------------------------------------------------------------------------------
| Id| Operation                           | Name       |Rows|Bytes|Cost (%CPU)|Time |
-------------------------------------------------------------------------------------
| 0| SELECT STATEMENT                     |                   |  |  |2(100)|        |
| 1|  SORT AGGREGATE                      |                   |1 |8 |      |        |
| 2|   TABLE ACCESS BY INDEX ROWID BATCHED| EMPLOYEES         |1 |8 |2  (0)|00:00:01|
|*3|    INDEX RANGE SCAN                  | EMP_DEPARTMENT_IX |1 |  |1  (0)|00:00:01|
-------------------------------------------------------------------------------------

Predicate Information (identified by operation id):
---------------------------------------------------

   3 - access("DEPARTMENT_ID"=:DEPT_ID)
</code></pre><p>The following query of <code class="codeph">V$SQL</code> obtains information about the cursor:
                        </p><pre class="pre codeblock"><code>COL BIND_AWARE FORMAT a10
COL SQL_TEXT FORMAT a22
COL CHILD# FORMAT 99999
COL EXEC FORMAT 9999
COL BUFF_GETS FORMAT 999999999
COL BIND_SENS FORMAT a9
COL SHARABLE FORMAT a9

SELECT SQL_TEXT, CHILD_NUMBER AS CHILD#, EXECUTIONS AS EXEC, 
       BUFFER_GETS AS BUFF_GETS, IS_BIND_SENSITIVE AS BIND_SENS, 
       IS_BIND_AWARE AS BIND_AWARE, IS_SHAREABLE AS SHARABLE
FROM   V$SQL
WHERE  SQL_TEXT LIKE '%mployee%'
AND    SQL_TEXT NOT LIKE '%SQL_TEXT%';

SQL_TEXT               CHILD#  EXEC  BUFF_GETS BIND_SENS BIND_AWARE SHARABLE
---------------------- ------ ----- ---------- --------- ---------- --------
SELECT COUNT(*), MAX(e      0     1        196         Y          N        Y
mployee_id) FROM hr.em
ployees WHERE departme
nt_id = :dept_id
</code></pre><p>The preceding output shows one <a href="glossary.html#GUID-DD551B34-F6E3-4077-8C1D-500ACDC7380D"><span class="xrefglossterm">child cursor</span></a> that has been executed once for the low-cardinality query. The cursor has been marked bind-sensitive because the optimizer believes the optimal plan may depend on the value of the bind variable. 
                        </p>
                        <p>When a cursor is marked bind-sensitive, Oracle Database monitors the behavior of the cursor using different bind values, to determine whether a different plan for different bind values is more efficient. The database marked this cursor bind-sensitive because the optimizer used the histogram on the <code class="codeph">department_id</code> column to compute the selectivity of the predicate <code class="codeph">WHERE department_id = :dept_id</code>. Because the presence of the histogram indicates that the column is skewed, different values of the bind variable may require different plans.
                        </p>
                     </div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-BC20D195-C80F-492A-B2D9-0BE2AFF6968C__GUID-F47E3D3C-8287-4D04-8A3C-14868E1A143F">
                        <p class="titleinexample">Example 20-14 High-Cardinality Query</p>
                        <p>This example continues the example in <a href="improving-rwp-cursor-sharing.html#GUID-BC20D195-C80F-492A-B2D9-0BE2AFF6968C__GUID-F1AFAAFE-CCB3-4117-89F6-5E09A17377E7">Example 20-13</a>. The following code re-executes the same query using the value <code class="codeph">50</code>, which occupies 99.9% of the rows:
                        </p><pre class="pre codeblock"><code>EXEC :dept_id := 50;
SELECT COUNT(*), MAX(employee_id) FROM hr.employees WHERE department_id = :dept_id;

  COUNT(*) MAX(EMPLOYEE_ID)
---------- ----------------
    100045	     100999
</code></pre><p>Even though such an unselective query would be more efficient with a full table scan, the optimizer chooses the same index range scan used for <code class="codeph">department_id=10</code>. This reason is that the database assumes that the existing plan in the cursor can be shared:
                        </p><pre class="pre codeblock"><code>SQL&gt; SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR);

PLAN_TABLE_OUTPUT
-------------------------------------
SQL_ID	a9upgaqqj7bn5, child number 0
-------------------------------------
SELECT COUNT(*), MAX(employee_id) FROM hr.employees WHERE department_id = :dept_id

Plan hash value: 1642965905

-------------------------------------------------------------------------------------
| Id| Operation                           | Name       |Rows|Bytes|Cost (%CPU)|Time |
-------------------------------------------------------------------------------------
| 0| SELECT STATEMENT                     |                   |  |  |2(100)|        |
| 1|  SORT AGGREGATE                      |                   |1 |8 |      |        |
| 2|   TABLE ACCESS BY INDEX ROWID BATCHED| EMPLOYEES         |1 |8 |2  (0)|00:00:01|
|*3|    INDEX RANGE SCAN                  | EMP_DEPARTMENT_IX |1 |  |1  (0)|00:00:01|
-------------------------------------------------------------------------------------

Predicate Information (identified by operation id):
---------------------------------------------------

   3 - access("DEPARTMENT_ID"=:DEPT_ID)
</code></pre><p>A query of <code class="codeph">V$SQL</code> shows that the child cursor has now been executed twice:
                        </p><pre class="pre codeblock"><code>SELECT SQL_TEXT, CHILD_NUMBER AS CHILD#, EXECUTIONS AS EXEC, 
       BUFFER_GETS AS BUFF_GETS, IS_BIND_SENSITIVE AS BIND_SENS, 
       IS_BIND_AWARE AS BIND_AWARE, IS_SHAREABLE AS SHARABLE
FROM   V$SQL
WHERE  SQL_TEXT LIKE '%mployee%'
AND    SQL_TEXT NOT LIKE '%SQL_TEXT%';

SQL_TEXT               CHILD#  EXEC  BUFF_GETS BIND_SENS BIND_AWARE SHARABLE
---------------------- ------ ----- ---------- --------- ---------- --------
SELECT COUNT(*), MAX(e      0     2       1329         Y          N        Y
mployee_id) FROM hr.em
ployees WHERE departme
nt_id = :dept_id
</code></pre><p>At this stage, the optimizer has not yet marked the cursor as bind-aware.</p>
                     </div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-BC20D195-C80F-492A-B2D9-0BE2AFF6968C__GUID-4672F5A8-B32C-4601-A4A9-F8563A913F5B">
                        <p class="notep1">See Also:</p>
                        <p><a href="../refrn/V-SQL.html#REFRN30246" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about <code class="codeph">V$SQL</code></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-277432AA-CD1C-4A75-AB28-7358E63265B3" title="The adaptive cursor sharing feature enables a single statement that contains bind variables to use multiple execution plans.">Adaptive Cursor Sharing</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL94744"></a><a id="TGSQL94743"></a><div class="props_rev_3"><a id="GUID-FD923B79-F1A8-401A-8C61-FD00B41A70F4" name="GUID-FD923B79-F1A8-401A-8C61-FD00B41A70F4"></a><h4 id="TGSQL-GUID-FD923B79-F1A8-401A-8C61-FD00B41A70F4" class="sect4"><span class="enumeration_section">20.3.4 </span>Bind-Aware Cursors
                  </h4>
                  <div>
                     <p>A <span class="bold">bind-aware cursor</span> is a bind-sensitive cursor that is eligible to use different plans for different bind values. 
                     </p>
                     <p>After a cursor has been made bind-aware, the optimizer chooses plans for future executions based on the bind value and its cardinality estimate. Thus, “bind-aware” means essentially “best plan for the current bind value.”</p>
                     <p>When a statement with a bind-sensitive cursor executes, the optimizer uses an internal algorithm to determine whether to mark the cursor bind-aware. The decision depends on whether the cursor produces significantly different data access patterns for different bind values, resulting in a performance cost that differs from expectations.</p>
                     <p>If the database marks the cursor bind-aware, then the <span class="italic">next</span> time that the cursor executes the database does the following:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Generates a new plan based on the bind value</p>
                        </li>
                        <li>
                           <p>Marks the original cursor generated for the statement as not sharable (<code class="codeph">V$SQL.IS_SHAREABLE</code> is <code class="codeph">N</code>). The original cursor is no longer usable and is eligible to age out of the library cache
                           </p>
                        </li>
                     </ul>
                     <p>When the same query repeatedly executes with different bind values, the database adds new bind values to the “signature” of the SQL statement (which includes the optimizer environment, NLS settings, and so on), and categorizes the values. The database examines the bind values, and considers whether the current bind value results in a significantly different data volume, or whether an existing plan is sufficient. The database does <span class="italic">not</span> need to create a new plan for each new value.
                     </p>
                     <p>Consider a scenario in which you execute a statement with 12 distinct bind values (executing each distinct value twice), which causes the database to trigger 5 hard parses, and create 2 additional plans. Because the database performs 5 hard parses, it creates 5 new child cursors, even though some cursors have the same execution plan as existing cursors. The database marks the superfluous cursors as not usable, which means these cursors eventually age out of the library cache.</p>
                     <p>During the initial hard parses, the optimizer is essentially mapping out the relationship between bind values and the appropriate execution plan. After this initial period, the database eventually reaches a steady state. Executing with a new bind value results in picking the best child cursor in the cache, without requiring a hard parse. Thus, the number of parses does <span class="italic">not</span> scale with the number of different bind values.
                     </p>
                     <div class="example" id="GUID-FD923B79-F1A8-401A-8C61-FD00B41A70F4__GUID-C0792D56-FF53-405A-8747-162EDF3A6B2E">
                        <p class="titleinexample">Example 20-15 Bind-Aware Cursors</p>
                        <p>This example continues the example in <span class="q">"<a href="improving-rwp-cursor-sharing.html#GUID-BC20D195-C80F-492A-B2D9-0BE2AFF6968C" title="A bind-sensitive cursor is a cursor whose optimal plan may depend on the value of a bind variable.">Bind-Sensitive Cursors</a>"</span>. The following code issues a second query <code class="codeph">employees</code> with the bind variable set to <code class="codeph">50</code>:
                        </p><pre class="pre codeblock"><code>EXEC :dept_id := 50;
SELECT COUNT(*), MAX(employee_id) FROM hr.employees WHERE department_id = :dept_id;

  COUNT(*) MAX(EMPLOYEE_ID)
---------- ----------------
    100045           100999
</code></pre><p>During the first two executions, the database was monitoring the behavior of the queries, and determined that the different bind values caused the queries to differ significantly in cardinality. Based on this difference, the database adapts its behavior so that the same plan is not always shared for this query. Thus, the optimizer generates a new plan based on the current bind value, which is <code class="codeph">50</code>:
                        </p><pre class="pre codeblock"><code>SQL&gt; SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR);

PLAN_TABLE_OUTPUT
-------------------------------------
SQL_ID	a9upgaqqj7bn5, child number 1
-------------------------------------
SELECT COUNT(*), MAX(employee_id) FROM hr.employees WHERE department_id = :dept_id

Plan hash value: 1756381138

-----------------------------------------------------------------------------
| Id  | Operation          | Name      | Rows  | Bytes | Cost(%CPU)| Time   |
-----------------------------------------------------------------------------
|   0 | SELECT STATEMENT   |           |       |       |254 (100)|          |
|   1 |  SORT AGGREGATE    |           |     1 |     8 |         |          |
|*  2 |   TABLE ACCESS FULL| EMPLOYEES |  100K |  781K |254  (15)| 00:00:01 |
-----------------------------------------------------------------------------
Predicate Information (identified by operation id):
---------------------------------------------------

   2 - filter("DEPARTMENT_ID"=:DEPT_ID)

</code></pre><p>The following query of <code class="codeph">V$SQL</code> obtains information about the cursor:
                        </p><pre class="pre codeblock"><code>SELECT SQL_TEXT, CHILD_NUMBER AS CHILD#, EXECUTIONS AS EXEC, 
       BUFFER_GETS AS BUFF_GETS, IS_BIND_SENSITIVE AS BIND_SENS, 
       IS_BIND_AWARE AS BIND_AWARE, IS_SHAREABLE AS SHAREABLE
FROM   V$SQL
WHERE  SQL_TEXT LIKE '%mployee%'
AND    SQL_TEXT NOT LIKE '%SQL_TEXT%';

SQL_TEXT               CHILD#  EXEC  BUFF_GETS BIND_SENS BIND_AWARE SHAREABLE
---------------------- ------ ----- ---------- --------- ---------- ---------
SELECT COUNT(*), MAX(e      0     2       1329         Y          N         N
mployee_id) FROM hr.em
ployees WHERE departme
nt_id = :dept_id

SELECT COUNT(*), MAX(e      1     1        800         Y          Y         Y
mployee_id) FROM hr.em
ployees WHERE departme
nt_id = :dept_id
</code></pre><p>The preceding output shows that the database created an additional child cursor (<code class="codeph">CHILD#</code> of <code class="codeph">1</code>). Cursor <code class="codeph">0</code> is now marked as not shareable. Cursor <code class="codeph">1</code> shows a number of buffers gets lower than cursor <code class="codeph">0</code>, and is marked both bind-sensitive and bind-aware. A bind-aware cursor may use different plans for different bind values, depending on the selectivity of the predicates containing the bind variable.
                        </p>
                     </div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-FD923B79-F1A8-401A-8C61-FD00B41A70F4__GUID-4CFDCC42-4003-4B01-94CC-9A6F7F604463">
                        <p class="titleinexample">Example 20-16 Bind-Aware Cursors: Choosing the Optimal Plan</p>
                        <p>This example continues the example in <span class="q">"<a href="improving-rwp-cursor-sharing.html#GUID-FD923B79-F1A8-401A-8C61-FD00B41A70F4__GUID-C0792D56-FF53-405A-8747-162EDF3A6B2E">Example 20-15</a>"</span>. The following code executes the same <code class="codeph">employees</code> query with the value of <code class="codeph">10</code>, which has extremely low cardinality (only one row):
                        </p><pre class="pre codeblock"><code>EXEC :dept_id := 10;
SELECT COUNT(*), MAX(employee_id) FROM hr.employees WHERE department_id = :dept_id;

  COUNT(*) MAX(EMPLOYEE_ID)
---------- ----------------
         1              200
</code></pre><p>The following output shows that the optimizer picked the best plan, which is an index scan, based on the low cardinality estimate for the current bind value of <code class="codeph">10</code>:
                        </p><pre class="pre codeblock"><code>SQL&gt; SELECT * from TABLE(DBMS_XPLAN.DISPLAY_CURSOR);

PLAN_TABLE_OUTPUT
-------------------------------------
SQL_ID	a9upgaqqj7bn5, child number 2
-------------------------------------
select COUNT(*), MAX(employee_id) FROM hr.employees WHERE department_id = :dept_id

Plan hash value: 1642965905

-------------------------------------------------------------------------------------
| Id| Operation                           | Name       |Rows|Bytes|Cost (%CPU)|Time |
-------------------------------------------------------------------------------------
| 0| SELECT STATEMENT                     |                   |  |  |2(100)|        |
| 1|  SORT AGGREGATE                      |                   |1 |8 |      |        |
| 2|   TABLE ACCESS BY INDEX ROWID BATCHED| EMPLOYEES         |1 |8 |2  (0)|00:00:01|
|*3|    INDEX RANGE SCAN                  | EMP_DEPARTMENT_IX | 1|  |1  (0)|00:00:01|
-------------------------------------------------------------------------------------

Predicate Information (identified by operation id):
---------------------------------------------------

   3 - access("DEPARTMENT_ID"=:DEPT_ID)
</code></pre><p>The <code class="codeph">V$SQL</code> output now shows that three child cursors exist:
                        </p><pre class="pre codeblock"><code>SELECT SQL_TEXT, CHILD_NUMBER AS CHILD#, EXECUTIONS AS EXEC, 
       BUFFER_GETS AS BUFF_GETS, IS_BIND_SENSITIVE AS BIND_SENS, 
       IS_BIND_AWARE AS BIND_AWARE, IS_SHAREABLE AS SHAREABLE
FROM   V$SQL
WHERE  SQL_TEXT LIKE '%mployee%'
AND    SQL_TEXT NOT LIKE '%SQL_TEXT%';

SQL_TEXT               CHILD#  EXEC  BUFF_GETS BIND_SENS BIND_AWARE SHAREABLE
---------------------- ------ ----- ---------- --------- ---------- ---------
SELECT COUNT(*), MAX(e      0     2       1329         Y          N         N
mployee_id) FROM hr.em
ployees WHERE departme
nt_id = :dept_id

SELECT COUNT(*), MAX(e      1     1        800         Y          Y         Y
mployee_id) FROM hr.em
ployees WHERE departme
nt_id = :dept_id

SELECT COUNT(*), MAX(e      2     1          3         Y          Y         Y
mployee_id) FROM hr.em
ployees WHERE departme
nt_id = :dept_id
</code></pre><p>The database discarded the original cursor (<code class="codeph">CHILD#</code> of <code class="codeph">0</code>) when the cursor switched to bind-aware mode. This is a one-time overhead. The database marked cursor <code class="codeph">0</code> as not shareable (<code class="codeph">SHAREABLE</code> is <code class="codeph">N</code>), which means that this cursor is unusable and will be among the first to age out of the cursor cache.
                        </p>
                     </div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-FD923B79-F1A8-401A-8C61-FD00B41A70F4__GUID-D25AC2B6-21FE-4939-9AAC-C30CA021210B">
                        <p class="notep1">See Also:</p>
                        <p><a href="../refrn/V-SQL.html#REFRN30246" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about <code class="codeph">V$SQL</code></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-277432AA-CD1C-4A75-AB28-7358E63265B3" title="The adaptive cursor sharing feature enables a single statement that contains bind variables to use multiple execution plans.">Adaptive Cursor Sharing</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL94745"></a><div class="props_rev_3"><a id="GUID-59B4BED5-62FF-421F-92ED-7BB32F6E68F4" name="GUID-59B4BED5-62FF-421F-92ED-7BB32F6E68F4"></a><h4 id="TGSQL-GUID-59B4BED5-62FF-421F-92ED-7BB32F6E68F4" class="sect4"><span class="enumeration_section">20.3.5 </span>Cursor Merging
                  </h4>
                  <div>
                     <p>If the optimizer creates a plan for a bind-aware cursor, and if this plan is the same as an existing cursor, then the optimizer can perform <strong class="term">cursor merging</strong>.
                     </p>
                     <p>In this case, the database merges cursors to save space in the library cache. The database increases the selectivity range for the cursor to include the selectivity of the new bind value.</p>
                     <p>When a query uses a new bind variable, the optimizer tries to find a cursor that it thinks is a good fit based on similarity in the selectivity of the bind value. If the database cannot find such a cursor, then it creates a new one. If the plan for the new cursor is the same as one of the existing cursors, then the database merges the two cursors to save space in the library cache. The merge results in the database marking one cursor as not sharable. If the library cache is under space pressure, then the database ages out the non-sharable cursor first. </p>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-59B4BED5-62FF-421F-92ED-7BB32F6E68F4__GUID-B1002D1E-AB42-4329-8D0F-70E7C750A9AA">
                        <p class="notep1">See Also:</p>
                        <p> <span class="q">"<a href="improving-rwp-cursor-sharing.html#GUID-BC20D195-C80F-492A-B2D9-0BE2AFF6968C__GUID-AE386A44-DBE5-4B73-B866-37129E9C9070">Example 20-12</a>"</span></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-277432AA-CD1C-4A75-AB28-7358E63265B3" title="The adaptive cursor sharing feature enables a single statement that contains bind variables to use multiple execution plans.">Adaptive Cursor Sharing</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL94746"></a><div class="props_rev_3"><a id="GUID-A3B8972A-A74D-4353-960B-5E09D294031E" name="GUID-A3B8972A-A74D-4353-960B-5E09D294031E"></a><h4 id="TGSQL-GUID-A3B8972A-A74D-4353-960B-5E09D294031E" class="sect4"><span class="enumeration_section">20.3.6 </span>Adaptive Cursor Sharing Views
                  </h4>
                  <div>
                     <p>You can use the <code class="codeph">V$</code> views for adaptive cursor sharing to see selectivity ranges, cursor information (such as whether a cursor is bind-aware or bind-sensitive), and execution statistics.
                     </p>
                     <div class="section">
                        <p>Specifically, use the following views:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">V$SQL</code> shows whether a cursor is bind-sensitive or bind-aware.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">V$SQL_CS_HISTOGRAM</code> shows the distribution of the execution count across a three-bucket execution history histogram.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">V$SQL_CS_SELECTIVITY</code> shows the selectivity ranges stored for every predicate containing a bind variable if the selectivity was used to check cursor sharing. It contains the text of the predicates, and the low and high values for the selectivity ranges.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">V$SQL_CS_STATISTICS</code> summarizes the information that the optimizer uses to determine whether to mark a cursor bind-aware. For a sample of executions, the database tracks the rows processed, buffer gets, and CPU time. The <code class="codeph">PEEKED</code> column shows <code class="codeph">YES</code> when the bind set was used to build the cursor; otherwise, the value is <code class="codeph">NO</code>.
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-A3B8972A-A74D-4353-960B-5E09D294031E__GUID-AA5603B4-437D-48AC-9446-F461DDC1A5EF">
                        <p class="notep1">See Also:</p>
                        <p><a href="../refrn/V-SQL.html#REFRN30246" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about <code class="codeph">V$SQL</code> and its related views
                        </p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-277432AA-CD1C-4A75-AB28-7358E63265B3" title="The adaptive cursor sharing feature enables a single statement that contains bind variables to use multiple execution plans.">Adaptive Cursor Sharing</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
            <div class="sect2"><a id="GUID-EA2FC76C-275B-49E1-B38C-BA39B3B3E864" name="GUID-EA2FC76C-275B-49E1-B38C-BA39B3B3E864"></a><h3 id="TGSQL-GUID-EA2FC76C-275B-49E1-B38C-BA39B3B3E864" class="sect3"><span class="enumeration_section">20.4 </span>Real-World Performance Guidelines for Cursor Sharing
               </h3>
               <div>
                  <p>The Real-World Performance team has created guidelines for how to optimize cursor sharing in Oracle database applications.</p>
                  <p>This section contains the following topics:</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-3C4E8893-02F2-40C3-A485-4BE066A67921">Develop Applications with Bind Variables for Security and Performance</a><br>The Real-World Performance group strongly suggests that all enterprise applications use bind variables. 
                     </li>
                     <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-7FF4E133-06A7-401E-9BFC-3B0B9C902346">Do Not Use CURSOR_SHARING = FORCE as a Permanent Fix</a><br>The best practice is to write sharable SQL and use the default of <code class="codeph">EXACT</code> for <code class="codeph">CURSOR_SHARING</code>. 
                     </li>
                     <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-6C3AFFA0-21DD-41BC-8DEE-5FC9A58B0954">Establish Coding Conventions to Increase Cursor Reuse</a><br>By default, any variation in the text of two SQL statements prevents the database from sharing a cursor, including the names of bind variables. Also, changes in the size of bind variables can cause cursor mismatches. For this reason, using bind variables in application code is not enough to <span class="italic">guarantee</span> cursor sharing.
                     </li>
                     <li class="ulchildlink"><a href="improving-rwp-cursor-sharing.html#GUID-DFFA6889-AF72-47F8-BC28-5BC05FEE8553">Minimize Session-Level Changes to the Optimizer Environment</a><br>A best practice is to prevent users of the application from changing the optimization approach and goal for their individual sessions. Any changes to the optimizer environment can prevent otherwise identical statements from sharing cursors.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-971F4652-3950-4662-82DE-713DDEED317C" title="Cursor sharing can improve database application performance by orders of magnitude.">Improving Real-World Performance Through Cursor Sharing</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-3C4E8893-02F2-40C3-A485-4BE066A67921" name="GUID-3C4E8893-02F2-40C3-A485-4BE066A67921"></a><h4 id="TGSQL-GUID-3C4E8893-02F2-40C3-A485-4BE066A67921" class="sect4"><span class="enumeration_section">20.4.1 </span>Develop Applications with Bind Variables for Security and Performance
                  </h4>
                  <div>
                     <p>The Real-World Performance group strongly suggests that all enterprise applications use bind variables. </p>
                     <div class="section">Oracle Database applications were intended to be written with bind variables. Avoid application designs that result in large numbers of users issuing dynamic, unshared SQL statements.
                        <p>Whenever Oracle Database fails to find a match for a statement in the library cache, it must perform a hard parse. Despite the dangers of developing applications with literals, not all real-world applications use bind variables. Developers sometimes find that it is faster and easier to write programs that use literals. However, decreased development time does not lead to better performance and security after deployment.</p>
                        <div class="infoboxnote" id="GUID-3C4E8893-02F2-40C3-A485-4BE066A67921__SEERWP3CONNECTIONPOOLSANDHARDPARSIN-7CDE75E1">
                           <p class="notep1">Video:</p>
                           <p>
                              <div class="video-box">
                                 <div id="9268" class="video-container"></div>
                              </div>
                           </p>
                        </div>
                        <p>The primary benefits of using bind variables are as follows:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Resource efficiency</p>
                              <p>Compiling a program before every execution does not use resources efficiently, but this is essentially what Oracle Database does when it performs a hard parse. The database server must expend significant CPU and memory to create cursors, generate and evaluate execution plans, and so on. By enabling the database to share cursors, soft parsing consumes far fewer resources. If an application uses literals instead of bind variables, but executes only a few queries each day, then DBAs may not perceive the extra overhead as a performance problem. However, if an application executes hundreds or thousands of queries per second, then the extra resource overhead can easily degrade performance to unacceptable levels. Using bind variables enables the database to perform a hard parse only once, no matter how many times the statement executes.</p>
                           </li>
                           <li>
                              <p>Scalability</p>
                              <p> When the database performs a hard parse, the database spends more time acquiring and holding latches in the shared pool and library cache. Latches are low-level serialization devices. The longer and more frequently the database latches structures in shared memory, the longer the queue for these latches becomes. When multiple statements share the same execution plan, the requests for latches and the durations of latches go down. This behavior increases scalability.</p>
                           </li>
                           <li>
                              <p>Throughput and response time </p>
                              <p>When the database avoids constantly reparsing and creating cursors, more of its time is spent in user space. The Real-World Performance group has found that changing literals to use binds often leads to orders of magnitude improvements in throughput and user response time.</p>
                              <div class="infoboxnote" id="GUID-3C4E8893-02F2-40C3-A485-4BE066A67921__SEERWP4BINDVARIABLESANDSOFTPARSINGF-7CDE8F66">
                                 <p class="notep1">Video:</p>
                                 <p>
                                    <div class="video-box">
                                       <div id="9269" class="video-container"></div>
                                    </div>
                                 </p>
                              </div>
                           </li>
                           <li>
                              <p>Security</p>
                              <p>The only way to prevent SQL injection attacks is to use bind variables. Malicious users can exploit application that concatenate strings by “injecting” code into the application. </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-3C4E8893-02F2-40C3-A485-4BE066A67921__FORANEXAMPLEOFANAPPLICATIONTHATFIXE-7D417FD0">
                        <p class="notep1">See Also:</p>
                        <p><a href="../lnpls/dynamic-sql.html#LNPLS647" target="_blank"><span><cite>Oracle Database PL/SQL Language Reference</cite></span></a> for an example of an application that fixes a security vulnerability created by literals
                        </p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-EA2FC76C-275B-49E1-B38C-BA39B3B3E864" title="The Real-World Performance team has created guidelines for how to optimize cursor sharing in Oracle database applications.">Real-World Performance Guidelines for Cursor Sharing</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL94750"></a><div class="props_rev_3"><a id="GUID-7FF4E133-06A7-401E-9BFC-3B0B9C902346" name="GUID-7FF4E133-06A7-401E-9BFC-3B0B9C902346"></a><h4 id="TGSQL-GUID-7FF4E133-06A7-401E-9BFC-3B0B9C902346" class="sect4"><span class="enumeration_section">20.4.2 </span>Do Not Use CURSOR_SHARING = FORCE as a Permanent Fix
                  </h4>
                  <div>
                     <p>The best practice is to write sharable SQL and use the default of <code class="codeph">EXACT</code> for <code class="codeph">CURSOR_SHARING</code>. 
                     </p>
                     <div class="section">However, for applications with many similar statements, setting <code class="codeph">CURSOR_SHARING</code> to <code class="codeph">FORCE</code> can sometimes significantly improve cursor sharing. The replacement of literals with system-generated bind values can lead to reduced memory usage, faster parses, and reduced latch contention. However, <code class="codeph">FORCE</code> is not meant to be a permanent development solution.
                        <p>As a general guideline, the Real-World Performance group recommends <span class="italic">against</span> setting <code class="codeph">CURSOR_SHARING</code> to <code class="codeph">FORCE</code> exception in rare situations, and then only when all of the following conditions are met:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Statements in the shared pool differ only in the values of literals.</p>
                           </li>
                           <li>
                              <p>Response time is suboptimal because of a very high number of library cache misses.</p>
                           </li>
                           <li>
                              <p>Your existing code has a serious security and scalability bug—the absence of bind variables—and you need a <span class="italic">temporary</span> band-aid until the source code can be fixed.
                              </p>
                           </li>
                           <li>
                              <p>You set this initialization parameter at the session level and not at the instance level.</p>
                           </li>
                        </ul>
                        <p>Setting <code class="codeph">CURSOR_SHARING</code> to <code class="codeph">FORCE</code> has the following drawbacks:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>It indicates that the application does not use user-defined bind variables, which means that it is open to SQL injection. Setting <code class="codeph">CURSOR_SHARING</code> to <code class="codeph">FORCE</code>  does <span class="italic">not</span> fix SQL injection bugs or render the code any more secure. The database binds values only after any malicious SQL text has already been injected.
                              </p>
                              <div class="p">
                                 <div class="infoboxnote" id="GUID-7FF4E133-06A7-401E-9BFC-3B0B9C902346__ORACLEDATABASE12CRECOVERINGAPLUGGAB-6B61826C">
                                    <p class="notep1">Video:</p>
                                    <p>
                                       <div class="video-box">
                                          <div id="9269" class="video-container"></div>
                                       </div>
                                    </p>
                                 </div>
                              </div>
                           </li>
                           <li>
                              <p>The database must perform extra work during the soft parse to find a similar statement in the shared pool.</p>
                           </li>
                           <li>
                              <p>The database removes every literal, which means that it can remove useful information. For example, the database strips out literal values in <code class="codeph">SUBSTR</code> and <code class="codeph">TO_DATE</code> functions. The use of system-generated bind variables where literals are more optimal can have a negative impact on execution plans.
                              </p>
                           </li>
                           <li>
                              <p>There is an increase in the maximum lengths (as returned by <code class="codeph">DESCRIBE</code>) of any selected expressions that contain literals in a <code class="codeph">SELECT</code> statement. However, the actual length of the data returned does not change.
                              </p>
                           </li>
                           <li>
                              <p>Star transformation is not supported.</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-7FF4E133-06A7-401E-9BFC-3B0B9C902346__GUID-833ECB56-AA3D-4E07-A1AB-87888C9D761A">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="q">"<a href="improving-rwp-cursor-sharing.html#GUID-267E5860-A8D5-4E5F-AE60-16304E97E4EE" title="This topic explains what the CURSOR_SHARING initialization parameter is, and how setting it to different values affects how Oracle Database uses bind variables.">CURSOR_SHARING and Bind Variable Substitution</a>"</span></p>
                           </li>
                           <li>
                              <p><a href="../refrn/CURSOR_SHARING.html#REFRN10025" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">CURSOR_SHARING</code> initialization parameter
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-EA2FC76C-275B-49E1-B38C-BA39B3B3E864" title="The Real-World Performance team has created guidelines for how to optimize cursor sharing in Oracle database applications.">Real-World Performance Guidelines for Cursor Sharing</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-6C3AFFA0-21DD-41BC-8DEE-5FC9A58B0954" name="GUID-6C3AFFA0-21DD-41BC-8DEE-5FC9A58B0954"></a><h4 id="TGSQL-GUID-6C3AFFA0-21DD-41BC-8DEE-5FC9A58B0954" class="sect4"><span class="enumeration_section">20.4.3 </span>Establish Coding Conventions to Increase Cursor Reuse
                  </h4>
                  <div>
                     <p>By default, any variation in the text of two SQL statements prevents the database from sharing a cursor, including the names of bind variables. Also, changes in the size of bind variables can cause cursor mismatches. For this reason, using bind variables in application code is not enough to <span class="italic">guarantee</span> cursor sharing.
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-6C3AFFA0-21DD-41BC-8DEE-5FC9A58B0954__GUID-0E3271DB-A52F-41E5-80B5-073F48386605"></p>
                        <p>The Real-World Performance group recommends that you standardize spacing and capitalization conventions for SQL statements and PL/SQL blocks. Also establish conventions for the naming and definitions of bind variables. If the database does not share cursors as expected, begin your diagnosis by querying <code class="codeph">V$SQL_SHARED_CURSOR</code>.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-6C3AFFA0-21DD-41BC-8DEE-5FC9A58B0954__GUID-3DEA82EF-D06F-4872-9A1F-E7342DFC4DB0">
                        <p class="titleinexample">Example 20-17 Variations in SQL Text</p>
                        <p>In this example, an application that uses bind variables executes 7 statements using the same bind variable value, but the statements are not textually identical:</p><pre class="pre codeblock"><code>VARIABLE emp_id NUMBER
EXEC :emp_id := 101;

SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; :emp_id;
SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; :EMP_ID;
SELECT SUM(salary) FROM hr.employees WHERE employee_id &lt; :Emp_Id;
SELECT SUM(salary)  FROM hr.employees WHERE employee_id &lt; :emp_id;
select sum(salary) from hr.employees where employee_id &lt; :emp_id;
Select sum(salary) From hr.employees Where employee_id &lt; :emp_id;
Select sum(salary) From hr.employees Where employee_id&lt; :emp_id;</code></pre><p>A query of <code class="codeph">V$SQLAREA</code> shows that no cursor sharing occurred:
                        </p><pre class="pre codeblock"><code>COL SQL_TEXT FORMAT a35
SELECT SQL_TEXT, SQL_ID, VERSION_COUNT, HASH_VALUE
FROM   V$SQLAREA
WHERE  SQL_TEXT LIKE '%mployee%'
AND    SQL_TEXT NOT LIKE '%SQL_TEXT%';

SQL_TEXT                            SQL_ID        VERSION_COUNT HASH_VALUE
----------------------------------- ------------- ------------- ----------
SELECT SUM(salary) FROM hr.employee bkrfu3ggu5315             1 3751971877
s WHERE employee_id &lt; :EMP_ID
SELECT SUM(salary) FROM hr.employee 70mdtwh7xj9gv             1  265856507
s WHERE employee_id &lt; :Emp_Id
Select sum(salary) From hr.employee 18tt4ny9u5wkt             1 2476929625
s Where employee_id&lt; :emp_id
SELECT SUM(salary)  FROM hr.employe b6b21tbyaf8aq             1 4238811478
es WHERE employee_id &lt; :emp_id
SELECT SUM(salary) FROM hr.employee 4318cbskba8yh             1  615850960
s WHERE employee_id &lt; :emp_id
select sum(salary) from hr.employee 633zpx3xm71kj             1 4214457937
s where employee_id &lt; :emp_id
Select sum(salary) From hr.employee 1mqbbbnsrrw08             1  830205960
s Where employee_id &lt; :emp_id

7 rows selected.
</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-6C3AFFA0-21DD-41BC-8DEE-5FC9A58B0954__GUID-8C2B8622-0CF8-4A0A-A706-391B750A4B95">
                        <p class="titleinexample">Example 20-18 Bind Length Mismatch</p>
                        <p>The following code defines a bind variable with different lengths, and then executes textually identical statements with the same bind values:</p><pre class="pre codeblock"><code>VARIABLE lname VARCHAR2(20)
EXEC :lname := 'Taylor';
SELECT SUM(salary) FROM hr.employees WHERE last_name = :lname;
VARIABLE lname VARCHAR2(100)
EXEC :lname := 'Taylor';
SELECT SUM(salary) FROM hr.employees WHERE last_name = :lname;
</code></pre><p>The following query shows that the database did not share the cursor:</p><pre class="pre codeblock"><code>COL SQL_TEXT FORMAT a35
SELECT SQL_TEXT, SQL_ID, VERSION_COUNT, HASH_VALUE
FROM   V$SQLAREA
WHERE  SQL_TEXT LIKE '%mployee%'
AND    SQL_TEXT NOT LIKE '%SQL_TEXT%';

SQL_TEXT                            SQL_ID	       VERSION_COUNT HASH_VALUE
----------------------------------- ------------- ------------- ----------
SELECT SUM(salary) FROM hr.employee buh8j4557r0h1             2 1249608193
s WHERE last_name = :lname
</code></pre><p>The reason is because of the bind lengths:</p><pre class="pre codeblock"><code>COL BIND_LENGTH_UPGRADEABLE FORMAT a15
SELECT s.SQL_TEXT, s.CHILD_NUMBER, 
       c.BIND_LENGTH_UPGRADEABLE
FROM   V$SQL s, V$SQL_SHARED_CURSOR c
WHERE  SQL_TEXT LIKE '%employee%'
AND    SQL_TEXT NOT LIKE '%SQL_TEXT%'
AND    s.CHILD_ADDRESS = c.CHILD_ADDRESS;

SQL_TEXT                            CHILD_NUMBER BIND_LENGTH_UPG
----------------------------------- ------------ ---------------
SELECT SUM(salary) FROM hr.employee            0 N
s WHERE last_name = :lname
SELECT SUM(salary) FROM hr.employee            1 Y
s WHERE last_name = :lname
</code></pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-EA2FC76C-275B-49E1-B38C-BA39B3B3E864" title="The Real-World Performance team has created guidelines for how to optimize cursor sharing in Oracle database applications.">Real-World Performance Guidelines for Cursor Sharing</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL94747"></a><div class="props_rev_3"><a id="GUID-DFFA6889-AF72-47F8-BC28-5BC05FEE8553" name="GUID-DFFA6889-AF72-47F8-BC28-5BC05FEE8553"></a><h4 id="TGSQL-GUID-DFFA6889-AF72-47F8-BC28-5BC05FEE8553" class="sect4"><span class="enumeration_section">20.4.4 </span>Minimize Session-Level Changes to the Optimizer Environment
                  </h4>
                  <div>
                     <p>A best practice is to prevent users of the application from changing the optimization approach and goal for their individual sessions. Any changes to the optimizer environment can prevent otherwise identical statements from sharing cursors.</p>
                     <div class="example" id="GUID-DFFA6889-AF72-47F8-BC28-5BC05FEE8553__GUID-A866629E-AC61-44B7-9110-5C0A18607632">
                        <p class="titleinexample">Example 20-19 Environment Mismatches</p>
                        <p>This example shows two textually identical statements that nevertheless do not share a cursor:</p><pre class="pre codeblock"><code>VARIABLE emp_id NUMBER

EXEC :emp_id := 110;

ALTER SESSION SET OPTIMIZER_MODE = FIRST_ROWS;
SELECT salary FROM hr.employees WHERE employee_id &lt; :emp_id;
ALTER SESSION SET OPTIMIZER_MODE = ALL_ROWS;
SELECT salary FROM hr.employees WHERE employee_id &lt; :emp_id;
</code></pre><p>A query of <code class="codeph">V$SQL_SHARED_CURSOR</code> shows a mismatch in the optimizer modes:
                        </p><pre class="pre codeblock"><code>SELECT S.SQL_TEXT, S.CHILD_NUMBER, s.CHILD_ADDRESS, 
       C.OPTIMIZER_MODE_MISMATCH
FROM   V$SQL S, V$SQL_SHARED_CURSOR C
WHERE  SQL_TEXT LIKE '%employee%'
AND    SQL_TEXT NOT LIKE '%SQL_TEXT%'
AND S.CHILD_ADDRESS = C.CHILD_ADDRESS;

SQL_TEXT                            CHILD_NUMBER CHILD_ADDRESS    O
----------------------------------- ------------ ---------------- -
SELECT salary FROM hr.employees WHE            0 0000000080293040 N
RE employee_id &lt; :emp_id
SELECT salary FROM hr.employees WHE            1 000000008644E888 Y
RE employee_id &lt; :emp_id
</code></pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="improving-rwp-cursor-sharing.html#GUID-EA2FC76C-275B-49E1-B38C-BA39B3B3E864" title="The Real-World Performance team has created guidelines for how to optimize cursor sharing in Oracle database applications.">Real-World Performance Guidelines for Cursor Sharing</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>