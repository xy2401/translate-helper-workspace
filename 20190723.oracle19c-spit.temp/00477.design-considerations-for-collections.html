<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Design Considerations for Collections</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Object-Relational Developer's Guide ">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Object-Relational Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="object-relational-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-11T02:05:10-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96436-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="design-considerations-for-REFs.html" title="Previous" type="text/html">
      <link rel="next" href="design-considerations-for-methods.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Object-Relational Developer's Guide">
    <meta name="dcterms.isVersionOf" content="ADOBJ">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="design-considerations-for-REFs.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="design-considerations-for-methods.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Object-Relational Developer's Guide </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="design-considerations-for-oracle-objects.html" property="item" typeof="WebPage"><span property="name"> Design Considerations for Oracle Objects </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Design Considerations for Collections</li>
            </ol>
            <a id="GUID-F3904AFE-E6E3-48E9-9482-5DB98D1CD03F" name="GUID-F3904AFE-E6E3-48E9-9482-5DB98D1CD03F"></a><a id="ADOBJ00807"></a>
            
            <h2 id="ADOBJ-GUID-F3904AFE-E6E3-48E9-9482-5DB98D1CD03F" class="sect2"><span class="enumeration_section">9.4 </span>Design Considerations for Collections
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>There are certain considerations to think about when you work with collections.</p>
               <p>Topics:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p>
                        <a href="design-considerations-for-collections.html#GUID-CD77D40B-CCAC-4F38-9BD9-C904F35618DA" title="You can query for a list of people and their home phone numbers, based on the home_phones() function you just created.">Viewing Object Data in Relational Form with Unnesting Queries</a></p>
                  </li>
                  <li>
                     
                     <p>
                        <a href="design-considerations-for-collections.html#GUID-92C119FE-CB10-485F-B3E9-C6DE56594650">Storage Considerations for Varrays</a></p>
                     
                  </li>
                  <li>
                     <p>
                        <a href="design-considerations-for-collections.html#GUID-BEE41686-942F-4709-A359-EFF5426EA5AE">Performance of Varrays Versus Nested Tables</a></p>
                     
                  </li>
                  <li>
                     <p>
                        <a href="design-considerations-for-collections.html#GUID-75F19B20-952E-46B5-B814-938E76FF716B">Design Considerations for Nested Tables</a></p>
                  </li>
                  <li>
                     
                     <p>
                        <a href="design-considerations-for-collections.html#GUID-C50A1468-81D3-4C85-BAAF-AC83F4C2A10D" title="You can nest collection types to create true multilevel collections.">Design Considerations for Multilevel Collections</a></p>
                  </li>
               </ul>
            </div><a id="ADOBJ7445"></a><a id="ADOBJ7444"></a><div class="props_rev_3"><a id="GUID-CD77D40B-CCAC-4F38-9BD9-C904F35618DA" name="GUID-CD77D40B-CCAC-4F38-9BD9-C904F35618DA"></a><h3 id="ADOBJ-GUID-CD77D40B-CCAC-4F38-9BD9-C904F35618DA" class="sect3"><span class="enumeration_section">9.4.1 </span>Viewing Object Data in Relational Form with Unnesting Queries
               </h3>
               <div>
                  <div class="section">
                     <p>An unnesting query on a collection allows the data to be viewed in a flat (relational) form.</p>
                     <p>You can execute unnesting queries on single-level and <a id="d34147e164" class="indexterm-anchor"></a><a id="d34147e168" class="indexterm-anchor"></a>multilevel collections of either nested tables or varrays.
                     </p>
                     <p>Nested tables can be unnested for queries using the <code class="codeph">TABLE</code> syntax, as in the following example: 
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-CD77D40B-CCAC-4F38-9BD9-C904F35618DA__GUID-9E879858-C6E3-45B8-8528-331E1DE9251C">
                     <p class="titleinexample">Example 9-4 Unnesting a Nested Table with the TABLE Function</p><pre class="oac_no_warn" dir="ltr">SELECT p.name_obj, n.num 
   FROM people_reltab p, TABLE(p.phones_ntab) n ;
</pre></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p>Here, <code class="codeph">phones_ntab</code> specifies the attributes of the <code class="codeph">phones_ntab</code> nested table. To retrieve even parent rows that have no child rows (no phone numbers, in this case), use the outer join syntax, with the <code class="codeph">+</code>. For example:
                     </p><pre class="oac_no_warn" dir="ltr">SELECT p.name_obj, n.num 
   FROM people_reltab p, TABLE(p.phones_ntab) (+) n ;
</pre><p>If the <code class="codeph">SELECT</code> list of a query does not refer to any columns from the parent table other than the nested table column, the query is optimized to execute only against the nested table's storage table.
                     </p>
                     <p>The unnesting query syntax is the same for varrays as for nested tables. For instance, suppose the <code class="codeph">phones_ntab</code> nested table is instead a varray named <code class="codeph">phones_var</code>. The following example shows how to use the <code class="codeph">TABLE</code> syntax to query the varray:
                     </p><pre class="pre codeblock"><code>SELECT p.name_obj, v.num
FROM people_reltab p, TABLE(p.phones_var) v;</code></pre></div>
                  <!-- class="section" -->
               </div><a id="ADOBJ7447"></a><a id="ADOBJ7446"></a><div class="props_rev_3"><a id="GUID-14A861C3-E6F9-4D05-88C3-0EF915AE7932" name="GUID-14A861C3-E6F9-4D05-88C3-0EF915AE7932"></a><h4 id="ADOBJ-GUID-14A861C3-E6F9-4D05-88C3-0EF915AE7932" class="sect4"><span class="enumeration_section">9.4.1.1 </span>Creating Procedures and Functions to Unnest Queries
                  </h4>
                  <div>
                     <div class="section">
                        <p>You can create procedures and functions that you can then execute to perform unnesting queries. For example, you can create a function called <code class="codeph">home_phones()</code> that returns only the phone numbers where <code class="codeph">location</code> is <code class="codeph">home</code>. To create the <code class="codeph">home_phones()</code> function, you enter code like the following:
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-14A861C3-E6F9-4D05-88C3-0EF915AE7932__GUID-F21C96C9-0AA3-42B8-9DC7-29BFC52BA566">
                        <p class="titleinexample">Example 9-5 Creating the home_phones Function</p><pre class="oac_no_warn" dir="ltr">CREATE OR REPLACE FUNCTION home_phones(allphones IN phone_ntabtyp)  
         RETURN phone_ntabtyp IS 
   homephones phone_ntabtyp := phone_ntabtyp(); 
   indx1      number; 
   indx2      number := 0; 
BEGIN 
   FOR indx1 IN 1..allphones.count LOOP 
      IF 
         allphones(indx1).location = 'home' 
      THEN 
         homephones.extend;    -- extend the local collection 
         indx2 := indx2 + 1;    
         homephones(indx2) := allphones(indx1); 
      END IF; 
   END LOOP; 
 
   RETURN homephones; 
END; 
/ 
</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="ADOBJ7448"></a><div class="props_rev_3"><a id="GUID-23FF7B9D-2789-42F9-A6A6-516DA66C480D" name="GUID-23FF7B9D-2789-42F9-A6A6-516DA66C480D"></a><h4 id="ADOBJ-GUID-23FF7B9D-2789-42F9-A6A6-516DA66C480D" class="sect4"><span class="enumeration_section">9.4.1.2 </span>Querying the TABLE Function to Unnest Data
                  </h4>
                  <div>
                     <p>You can query for a list of people and their home phone numbers, based on the <code class="codeph">home_phones()</code> function you just created. 
                     </p>
                     <div class="example" id="GUID-23FF7B9D-2789-42F9-A6A6-516DA66C480D__GUID-EEF0E0EB-4A90-4E5D-9DC0-E81DD8BB61EE">
                        <p class="titleinexample">Example 9-6 Querying for Phone Numbers</p>
                        <p>See <a href="design-considerations-for-collections.html#GUID-14A861C3-E6F9-4D05-88C3-0EF915AE7932__GUID-F21C96C9-0AA3-42B8-9DC7-29BFC52BA566">Example 9-5</a></p><pre class="oac_no_warn" dir="ltr">SELECT p.name_obj, n.num 
   FROM people_reltab p, TABLE(
      CAST(<span class="bold">home_phones</span>(p.phones_ntab) AS phone_ntabtyp)) n ;  
 </pre><p>To query for a list of people and their home phone numbers, including those people who do not have a home phone number listed, enter the following:</p><pre class="oac_no_warn" dir="ltr">SELECT p.name_obj, n.num 
   FROM people_reltab p,  
       TABLE(CAST(home_phones(p.phones_ntab) AS phone_ntabtyp))(+) n ;</pre><div class="infoboxnotealso" id="GUID-23FF7B9D-2789-42F9-A6A6-516DA66C480D__GUID-F291FD21-3BA8-45A8-9DF6-EA1E06265B52">
                           <p class="notep1">See Also:</p>
                           <p><a href="../sqlrf/Introduction-to-Oracle-SQL.html#SQLRF001" target="_blank"><span class="italic">Oracle Database SQL Language Reference </span></a>and <a href="../addci/using-pipelined-and-parallel-table-functions.html#ADDCI2140" target="_blank"><span class="italic">Oracle Database Data Cartridge Developer's Guide</span></a> for more information about the <code class="codeph">TABLE</code> function
                           </p>
                        </div>
                     </div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div><a id="ADOBJ7449"></a><div class="props_rev_3"><a id="GUID-92C119FE-CB10-485F-B3E9-C6DE56594650" name="GUID-92C119FE-CB10-485F-B3E9-C6DE56594650"></a><h3 id="ADOBJ-GUID-92C119FE-CB10-485F-B3E9-C6DE56594650" class="sect3"><span class="enumeration_section">9.4.2 </span>Storage Considerations for Varrays
               </h3>
               <div>
                  <p>The size of a stored varray depends only on the current count of the number of elements in the varray and not on the maximum number of elements that it can hold.</p>
                  <p>Because the storage of varrays incurs some overhead, such as null information, the size of the varray stored may be slightly greater than the size of the elements multiplied by the count. </p>
                  <p>Varrays are stored in columns either as raw values or <code class="codeph">LOB</code>s. Oracle decides how to store the varray when the varray is defined, based on the maximum possible size of the varray computed using the <code class="codeph">LIMIT</code> of the declared varray. If the size exceeds approximately 4000 bytes, then the varray is stored in <code class="codeph">LOB</code>s. Otherwise, the varray is stored in the column itself as a raw value. In addition, Oracle supports inline LOBs which means that elements that fit in the first 4000 bytes of a large varray, with some bytes reserved for the LOB locator, are stored in the column of the row. See also <a href="../adlob/introduction-to-large-objects.html#ADLOB001" target="_blank"><span class="italic">Oracle Database SecureFiles and Large Objects Developer's Guide</span></a>.
                  </p>
               </div><a id="ADOBJ7450"></a><div class="props_rev_3"><a id="GUID-9EA1444F-A46A-4230-B0E3-FD6A57B246C1" name="GUID-9EA1444F-A46A-4230-B0E3-FD6A57B246C1"></a><h4 id="ADOBJ-GUID-9EA1444F-A46A-4230-B0E3-FD6A57B246C1" class="sect4"><span class="enumeration_section">9.4.2.1 </span>About Propagating VARRAY Size Change
                  </h4>
                  <div>
                     <p>When changing the size of a <code class="codeph">VARRAY</code> type, a new type version is generated for the dependent types.
                     </p>
                     <p>It is important to be aware of this when a <code class="codeph">VARRAY</code> column is not explicitly stored as a LOB and its maximum size is originally smaller than 4000 bytes. If the size is larger than or equal to 4000 bytes after the increase, the <code class="codeph">VARRAY</code> column has to be stored as a LOB. This requires an extra operation to upgrade the metadata of the <code class="codeph">VARRAY</code> column in order to set up the necessary LOB metadata information including the LOB segment and LOB index.
                     </p>
                     <p>The <code class="codeph">CASCADE</code> option in the <code class="codeph">ALTER</code> <code class="codeph">TYPE</code> statement propagates the <code class="codeph">VARRAY</code> size change to its dependent types and tables. A new version is generated for each valid dependent type and dependent tables metadata are updated accordingly based on the different case scenarios described previously. If the <code class="codeph">VARRAY</code> column is in a cluster table, an<code class="codeph"> ALTER</code> <code class="codeph">TYPE</code> statement with the <code class="codeph">CASCADE</code> option fails because a cluster table does not support a LOB. 
                     </p>
                     <p>The <code class="codeph">CASCADE</code> option in the <code class="codeph">ALTER</code> <code class="codeph">TYPE</code> statement also provides the <code class="codeph">[NOT]</code> <code class="codeph">INCLUDING</code> <code class="codeph">TABLE</code> <code class="codeph">DATA</code> option. The <code class="codeph">NOT</code> <code class="codeph">INCLUDING</code> <code class="codeph">TABLE</code> <code class="codeph">DATA</code> option only updates the metadata of the table, but does not convert the data image. In order to convert the <code class="codeph">VARRAY</code> image to the latest version format, you can either specify <code class="codeph">INCLUDING</code> <code class="codeph">TABLE</code> <code class="codeph">DATA</code> explicitly in <code class="codeph">ALTER</code> <code class="codeph">TYPE</code> <code class="codeph">CASCADE</code> statement or issue <code class="codeph">ALTER</code> <code class="codeph">TABLE</code> <code class="codeph">UPGRADE</code> statement.
                     </p>
                  </div>
               </div>
            </div><a id="ADOBJ7452"></a><a id="ADOBJ7453"></a><a id="ADOBJ7451"></a><div class="props_rev_3"><a id="GUID-BEE41686-942F-4709-A359-EFF5426EA5AE" name="GUID-BEE41686-942F-4709-A359-EFF5426EA5AE"></a><h3 id="ADOBJ-GUID-BEE41686-942F-4709-A359-EFF5426EA5AE" class="sect3"><span class="enumeration_section">9.4.3 </span>Performance of Varrays Versus Nested Tables
               </h3>
               <div>
                  <p>If an entire collection is manipulated as a single unit in the application, varrays perform much better than nested tables. The varray is stored packed and requires no joins to retrieve the data, unlike nested tables. </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-BEE41686-942F-4709-A359-EFF5426EA5AE__GUID-19A4E9E7-9E11-4BCC-83E1-9031B12B2F68">Varray Querying</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>The unnesting syntax can be used to access varray columns similar to the way it is used to access nested tables. See <span class="q">"<a href="design-considerations-for-collections.html#GUID-CD77D40B-CCAC-4F38-9BD9-C904F35618DA" title="You can query for a list of people and their home phone numbers, based on the home_phones() function you just created.">Viewing Object Data in Relational Form with Unnesting Queries</a>"</span> for more information.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-BEE41686-942F-4709-A359-EFF5426EA5AE__GUID-09BE72C4-88F3-4BB9-A85B-E36F06233B8B">Varray Updates</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>Piece-wise updates of a varray value are not supported. Thus, when a varray is updated, the entire old collection is replaced by the new collection. </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="ADOBJ7454"></a><div class="props_rev_3"><a id="GUID-75F19B20-952E-46B5-B814-938E76FF716B" name="GUID-75F19B20-952E-46B5-B814-938E76FF716B"></a><h3 id="ADOBJ-GUID-75F19B20-952E-46B5-B814-938E76FF716B" class="sect3"><span class="enumeration_section">9.4.4 </span>Design Considerations for Nested Tables
               </h3>
               <div>
                  <p>Topics:</p>
                  <p>There are several design considerations for using nested tables. </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="design-considerations-for-collections.html#GUID-474BD701-F7A2-435B-AE93-00B5B3AD974B">Nested Table Storage</a></p>
                     </li>
                     <li>
                        <p><a href="design-considerations-for-collections.html#GUID-1DA271C6-48E6-4FD7-B250-C54A9146F168">Nested Table Indexes</a></p>
                     </li>
                     <li>
                        <p><a href="design-considerations-for-collections.html#GUID-1CCB041E-AE30-4732-B39B-695E3291DC57">Nested Table Locators</a></p>
                     </li>
                     <li>
                        <p><a href="design-considerations-for-collections.html#GUID-12CE90BB-B224-4730-9851-8A6935A0AAEC">Set Membership Query Optimazation</a></p>
                     </li>
                  </ul>
               </div><a id="ADOBJ7456"></a><a id="ADOBJ7455"></a><div class="props_rev_3"><a id="GUID-474BD701-F7A2-435B-AE93-00B5B3AD974B" name="GUID-474BD701-F7A2-435B-AE93-00B5B3AD974B"></a><h4 id="ADOBJ-GUID-474BD701-F7A2-435B-AE93-00B5B3AD974B" class="sect4"><span class="enumeration_section">9.4.4.1 </span>Nested Table Storage
                  </h4>
                  <div>
                     <p>Oracle stores the rows of a nested table in a separate storage table. A system generated <code class="codeph">NESTED_TABLE_ID</code>, which is 16 bytes in length, correlates the parent row with the rows in its corresponding storage table. 
                     </p>
                     <p><a href="design-considerations-for-collections.html#GUID-474BD701-F7A2-435B-AE93-00B5B3AD974B__I445616">Figure 9-2</a> shows how the storage table works. The storage table contains each value for each nested table in a nested table column. Each value occupies one row in the storage table. The storage table uses the <code class="codeph">NESTED_TABLE_ID</code> to track the nested table for each value. So, in <a href="design-considerations-for-collections.html#GUID-474BD701-F7A2-435B-AE93-00B5B3AD974B__I445616">Figure 9-2</a>, all of the values that belong to nested table <code class="codeph">A</code> are identified, all of the values that belong to nested table <code class="codeph">B</code> are identified, and so on.
                     </p>
                     <div class="figure" id="GUID-474BD701-F7A2-435B-AE93-00B5B3AD974B__I445616">
                        <p class="titleinfigure">Figure 9-2 Nested Table Storage</p><img src="img/adobj021.gif" width="496" alt="Description of Figure 9-2 follows" title="Description of Figure 9-2 follows" longdesc="img_text/adobj021.html"><br><a href="img_text/adobj021.html">Description of "Figure 9-2 Nested Table Storage"</a></div>
                     <!-- class="figure" -->
                  </div>
               </div><a id="ADOBJ7460"></a><div class="props_rev_3"><a id="GUID-1DA271C6-48E6-4FD7-B250-C54A9146F168" name="GUID-1DA271C6-48E6-4FD7-B250-C54A9146F168"></a><h4 id="ADOBJ-GUID-1DA271C6-48E6-4FD7-B250-C54A9146F168" class="sect4"><span class="enumeration_section">9.4.4.2 </span>Nested Table Indexes
                  </h4>
                  <div>
                     <p>When creating nested tables stored in heap tables, Oracle database automatically creates an index on the <code class="codeph">NESTED_TABLE_ID </code>column of the storage table and an index on the corresponding ID column of the parent table. 
                     </p>
                     <p>Creating an index on the <code class="codeph">NESTED_TABLE_ID </code> column enables the database to access the child rows of the nested table more efficiently, because the database must perform a join between the parent table and the nested table using the <code class="codeph">NESTED_TABLE_ID </code> column. 
                     </p>
                  </div>
               </div><a id="ADOBJ7461"></a><div class="props_rev_3"><a id="GUID-1CCB041E-AE30-4732-B39B-695E3291DC57" name="GUID-1CCB041E-AE30-4732-B39B-695E3291DC57"></a><h4 id="ADOBJ-GUID-1CCB041E-AE30-4732-B39B-695E3291DC57" class="sect4"><span class="enumeration_section">9.4.4.3 </span>Nested Table Locators
                  </h4>
                  <div>
                     <p>For large child sets, the parent row and a locator to the child set can be returned so that the child rows can be accessed on demand; the child sets also can be filtered. Using nested table locators enables you to avoid unnecessarily transporting child rows for every parent. </p>
                     <p>You can perform either one of the following actions to access the child rows using the nested table locator:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Call the OCI collection functions. This action occurs implicitly when you access the elements of the collection in the client-side code, such as <span class="italic"><code class="codeph">OCIColl*</code></span> functions. The entire collection is retrieved implicitly on the first access.
                           </p>
                           <div class="infoboxnotealso" id="GUID-1CCB041E-AE30-4732-B39B-695E3291DC57__GUID-6AFD5C6E-309F-4295-B525-06F396C2B73E">
                              <p class="notep1">See Also:</p>
                              <p><a href="../lnoci/oci-collection-and-iterator-functions.html#LNOCI181" target="_blank"><span class="italic">Oracle Call Interface Programmer's Guide </span></a>for more information about OCI collection functions.
                              </p>
                           </div>
                        </li>
                        <li>
                           <p>Use SQL to retrieve the rows corresponding to the nested table.</p>
                        </li>
                     </ul>
                     <p>In a multilevel collection, you can use a locator with a specified collection at any level of nesting. </p>
                     <p>The following topics specify ways that a collection can be retrieved as a locator:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="design-considerations-for-collections.html#GUID-FA901FF7-1847-4A38-9FDC-E2649C5BB5C4">At Table Creation Time</a></p>
                        </li>
                        <li>
                           <p><a href="design-considerations-for-collections.html#GUID-8CDEBFAB-6C05-4C0D-84AA-3A917E98CC36">As a HINT During Retrieval</a></p>
                        </li>
                     </ul>
                  </div><a id="ADOBJ7463"></a><a id="ADOBJ7462"></a><div class="props_rev_3"><a id="GUID-FA901FF7-1847-4A38-9FDC-E2649C5BB5C4" name="GUID-FA901FF7-1847-4A38-9FDC-E2649C5BB5C4"></a><h5 id="ADOBJ-GUID-FA901FF7-1847-4A38-9FDC-E2649C5BB5C4" class="sect5"><span class="enumeration_section">9.4.4.3.1 </span>At Table Creation Time
                     </h5>
                     <div>
                        <div class="section">
                           <p>When the collection type is being used as a column type and the <code class="codeph">NESTED</code> <code class="codeph">TABLE</code> storage clause is used, you can use the <code class="codeph">RETURN</code> <code class="codeph">AS</code> <code class="codeph">LOCATOR</code> clause to specify that a particular collection is to be retrieved as a locator. 
                           </p>
                           <p>For instance, suppose that <code class="codeph">inner_table</code> is a collection type consisting of three levels of nested tables. In the following example, the <code class="codeph">RETURN</code> <code class="codeph">AS</code> <code class="codeph">LOCATOR</code> clause specifies that the third level of nested tables is always to be retrieved as a locator.
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-FA901FF7-1847-4A38-9FDC-E2649C5BB5C4__GUID-D1AC8C04-C0A4-4DD6-B17C-30EDD8D44323">
                           <p class="titleinexample">Example 9-7 Using the RETURN AS LOCATOR Clause</p><pre class="oac_no_warn" dir="ltr">CREATE TYPE inner_table AS TABLE OF NUMBER;/
CREATE TYPE middle_table AS TABLE OF inner_table;/
CREATE TYPE outer_table AS TABLE OF middle_table;/
CREATE TABLE tab1 (
  col1 NUMBER,
  col2 outer_table)
 NESTED TABLE col2 STORE AS col2_ntab
  (NESTED TABLE COLUMN_VALUE STORE AS cval1_ntab 
    (NESTED TABLE COLUMN_VALUE STORE AS cval2_ntab <span class="bold">RETURN AS LOCATOR</span>) );</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="ADOBJ7464"></a><div class="props_rev_3"><a id="GUID-8CDEBFAB-6C05-4C0D-84AA-3A917E98CC36" name="GUID-8CDEBFAB-6C05-4C0D-84AA-3A917E98CC36"></a><h5 id="ADOBJ-GUID-8CDEBFAB-6C05-4C0D-84AA-3A917E98CC36" class="sect5"><span class="enumeration_section">9.4.4.3.2 </span>As a HINT During Retrieval
                     </h5>
                     <div>
                        <div class="section">
                           <p>A query can retrieve a collection as a locator by means of the hint <code class="codeph">NESTED_TABLE_GET_REFS</code>. Here is an example of retrieving the column <code class="codeph">col2</code> from the table <code class="codeph">tab1</code> as a locator:
                           </p><pre class="oac_no_warn" dir="ltr">SELECT <span class="bold">/*+ NESTED_TABLE_GET_REFS +*/</span> col2
  FROM tab1
 WHERE col1 = 2;</pre><p>Unlike with the <code class="codeph">RETURN</code> <code class="codeph">AS</code> <code class="codeph">LOCATOR</code> clause, however, you cannot specify a particular inner collection to return as a locator when using the hint.
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="ADOBJ7465"></a><div class="props_rev_3"><a id="GUID-12CE90BB-B224-4730-9851-8A6935A0AAEC" name="GUID-12CE90BB-B224-4730-9851-8A6935A0AAEC"></a><h4 id="ADOBJ-GUID-12CE90BB-B224-4730-9851-8A6935A0AAEC" class="sect4"><span class="enumeration_section">9.4.4.4 </span>Set Membership Query Optimization
                  </h4>
                  <div>
                     <p>Set membership queries are useful when you want to search for a specific item in a nested table. </p>
                     <p>The following query tests the membership in a child-set; specifically, whether the location <code class="codeph">home</code> is in the nested table <code class="codeph">phones_ntab</code>, which is in the parent table <code class="codeph">people_reltab</code>:
                     </p><pre class="oac_no_warn" dir="ltr">SELECT * FROM people_reltab p
   WHERE 'home' IN (SELECT location FROM TABLE(p.phones_ntab)) ;
</pre><p>Oracle can execute a query that tests the membership in a child-set more efficiently by transforming it internally into a semijoin. However, this optimization only happens if the <code class="codeph">ALWAYS_SEMI_JOIN</code> initialization parameter is set. If you want to perform semijoins, the valid values for this parameter are <code class="codeph">MERGE</code> and <code class="codeph">HASH</code>; these parameter values indicate which join method to use.
                     </p>
                     <div class="infoboxnote" id="GUID-12CE90BB-B224-4730-9851-8A6935A0AAEC__GUID-0CB4F886-590A-4EA7-8447-89BC1BE2337F">
                        <p class="notep1">Note:</p>
                        <p>In the preceding example, <code class="codeph">home</code> and <code class="codeph">location</code> are child set elements. If the child set elements are object types, they must have a map or order method to perform a set membership query.
                        </p>
                     </div>
                  </div>
               </div>
            </div><a id="ADOBJ7468"></a><a id="ADOBJ7470"></a><a id="ADOBJ7467"></a><a id="ADOBJ7469"></a><a id="ADOBJ7471"></a><a id="ADOBJ7472"></a><a id="ADOBJ7466"></a><div class="props_rev_3"><a id="GUID-C50A1468-81D3-4C85-BAAF-AC83F4C2A10D" name="GUID-C50A1468-81D3-4C85-BAAF-AC83F4C2A10D"></a><h3 id="ADOBJ-GUID-C50A1468-81D3-4C85-BAAF-AC83F4C2A10D" class="sect3"><span class="enumeration_section">9.4.5 </span>Design Considerations for Multilevel Collections
               </h3>
               <div>
                  <p>You can nest collection types to create true multilevel collections.</p>
                  <p><a href="support-for-collection-data-types.html#GUID-0EF7C6B0-B68A-4671-A7B6-857D8F6F3DA8"> Support for Collection Data Types</a> describes how to nest collection types such as a nested table of nested tables, a nested table of varrays, a varray of nested tables, or a varray or nested table of an object type that has an attribute of a collection type. These create true multilevel collections.
                  </p>
                  <p>You can also nest collections indirectly using <code class="codeph">REF</code>s. For example, you can create a nested table of an object type that has an attribute that references an object that has a nested table or varray attribute. If you do not actually need to access all elements of a multilevel collection, then nesting a collection with <code class="codeph">REF</code>s may provide better performance because only the <code class="codeph">REF</code>s need to be loaded, not the elements themselves. 
                  </p>
                  <p>True multilevel collections (specifically multilevel nested tables) perform better for queries that access individual elements of the collection. Using nested table locators can improve the performance of programmatic access if you do not need to access all elements.</p>
                  <p>A series of examples demonstrate this type of design.</p>
                  <p>Topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="design-considerations-for-collections.html#GUID-4178F558-7E27-44EF-9123-97360F0C126A" title="You can create an object table with a multilevel collection.">Creating an Object Table with a Multilevel Collection</a></p>
                     </li>
                     <li>
                        <p><a href="design-considerations-for-collections.html#GUID-B33E4084-34ED-4B5D-AEF6-F566AFEE9A2D" title="You can create an object table using REFs">Creating an Object Table Using REFs</a></p>
                     </li>
                     <li>
                        <p>I<a href="design-considerations-for-collections.html#GUID-F2696EEE-87A7-4FBE-94C9-F8D56FD33541" title="After you have created an object table, you can then insert values into it.">Inserting Values into Object Tables</a></p>
                     </li>
                  </ul>
               </div>
               <div class="sect3"><a id="GUID-4178F558-7E27-44EF-9123-97360F0C126A" name="GUID-4178F558-7E27-44EF-9123-97360F0C126A"></a><h4 id="ADOBJ-GUID-4178F558-7E27-44EF-9123-97360F0C126A" class="sect4"><span class="enumeration_section">9.4.5.1 </span>Creating an Object Table with a Multilevel Collection
                  </h4>
                  <div>
                     <p>You can create an object table with a multilevel collection.</p>
                     <div class="section">
                        <p>To create an example of a collection that uses <code class="codeph">REF</code>s to nest another collection, you create a new object type called <code class="codeph">person_objtyp</code> using the object types provided: <code class="codeph">name_objtyp</code>, <code class="codeph">address_objtyp</code>, and <code class="codeph">phone_ntabtyp</code>. Remember that the <code class="codeph">phone_ntabtyp</code> object type is a nested table because each person may have more than one phone number.
                        </p>
                        <p>To create the <code class="codeph">person_objtyp</code> object type and an object table called <code class="codeph">people_objtab</code> of <code class="codeph">person_objtyp</code> object type, issue the following SQL statement:
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-4178F558-7E27-44EF-9123-97360F0C126A__GUID-DFB7633B-827E-4C4D-A6D4-8DFE4AA4A1C7">
                        <p class="titleinexample">Example 9-8 Creating an Object Table with a Multilevel Collection</p><pre class="oac_no_warn" dir="ltr">CREATE TYPE person_objtyp AS OBJECT (
   id            NUMBER(4), 
   name_obj      name_objtyp,
   address_obj   address_objtyp,
   phones_ntab   phone_ntabtyp);
/
</pre><pre class="oac_no_warn" dir="ltr">CREATE TABLE <span class="bold">people_objtab</span> OF person_objtyp (id PRIMARY KEY)
   NESTED TABLE phones_ntab STORE AS phones_store_ntab ;
</pre><p>The <code class="codeph">people_objtab</code> table has the same attributes as the <code class="codeph">people_reltab</code> table. The difference is that the <code class="codeph">people_objtab</code> is an object table with row objects, while the <code class="codeph">people_reltab</code> table is a relational table with column objects, as seen in <span class="q">"<a href="general-storage-considerations-for-objects.html#GUID-58E2E291-67B1-4B30-809A-609A8FF07CBA" title="Column object storage is similar to storage of an equivalent set of scalar columns that collectively make up the object.">Column Object Storage in Relational Tables</a>"</span>. 
                        </p>
                        <div class="figure" id="GUID-4178F558-7E27-44EF-9123-97360F0C126A__GUID-5756F856-F7CB-4829-9A96-412A7EFCEDBB">
                           <p class="titleinfigure">Figure 9-3 Object-Relational Representation of the people_objtab Object Table</p><img src="img/adobj015.gif" alt="Description of Figure 9-3 follows" title="Description of Figure 9-3 follows" longdesc="img_text/adobj015.html"><br><a href="img_text/adobj015.html">Description of "Figure 9-3 Object-Relational Representation of the people_objtab Object Table"</a></div>
                        <!-- class="figure" -->
                        <p>You can reference the row objects in the <code class="codeph">people_objtab</code> object table from other tables. For example, suppose you want to create a <code class="codeph">projects_objtab</code> table that contains:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>A project identification number for each project.</p>
                           </li>
                           <li>
                              <p>The title of each project.</p>
                           </li>
                           <li>
                              <p>The project lead for each project.</p>
                           </li>
                           <li>
                              <p>A description of each project.</p>
                           </li>
                           <li>
                              <p>Nested table collection of the team of people assigned to each project.</p>
                           </li>
                        </ul>
                        <p>You can use <code class="codeph">REF</code>s in the <code class="codeph">people_objtab</code> for the project leads, and you can use a nested table collection of <code class="codeph">REF</code>s for the team. To begin, create a nested table object type called <code class="codeph">personref_ntabtyp</code> based on the <code class="codeph">person_objtyp</code> object type:
                        </p><pre class="oac_no_warn" dir="ltr">CREATE TYPE personref_ntabtyp AS TABLE OF REF person_objtyp;
/</pre><p>You are now set up to create to create an object table as shown in <a href="design-considerations-for-collections.html#GUID-B33E4084-34ED-4B5D-AEF6-F566AFEE9A2D" title="You can create an object table using REFs">Creating an Object Table Using REFs</a>.
                        </p>
                     </div>
                     <!-- class="example" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-B33E4084-34ED-4B5D-AEF6-F566AFEE9A2D" name="GUID-B33E4084-34ED-4B5D-AEF6-F566AFEE9A2D"></a><h4 id="ADOBJ-GUID-B33E4084-34ED-4B5D-AEF6-F566AFEE9A2D" class="sect4"><span class="enumeration_section">9.4.5.2 </span>Creating an Object Table Using REFs
                  </h4>
                  <div>
                     <p>You can create an object table using REFs </p>
                     <div class="section">
                        <p>After creating the person object table, in <a href="design-considerations-for-collections.html#GUID-4178F558-7E27-44EF-9123-97360F0C126A" title="You can create an object table with a multilevel collection.">Creating an Object Table with a Multilevel Collection</a>,, you are ready to create the project object table <code class="codeph">projects_objtab</code>. First, create the object type <code class="codeph">projects_objtyp</code>, then create the object table <code class="codeph">projects_objtab</code> based on the <code class="codeph">projects_objtyp</code>.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-B33E4084-34ED-4B5D-AEF6-F566AFEE9A2D__CJADDCJI">
                        <p class="titleinexample">Example 9-9 Creating an Object Table Using REFs</p><pre class="oac_no_warn" dir="ltr">CREATE TYPE projects_objtyp AS OBJECT (
   id              NUMBER(4),   
   title           VARCHAR2(15),
   projlead_ref    REF person_objtyp,
   description     CLOB,
   team_ntab       personref_ntabtyp);
/
CREATE TABLE projects_objtab OF projects_objtyp (id PRIMARY KEY)
   NESTED TABLE team_ntab STORE AS team_store_ntab ;</pre><div class="figure" id="GUID-B33E4084-34ED-4B5D-AEF6-F566AFEE9A2D__GUID-B5137BC7-D4A4-4CE7-A438-C3FEB0ADB076">
                           <p class="titleinfigure">Figure 9-4 Object-Relational Representation of the projects_objtab Object Table</p><img src="img/adobj016.gif" alt="Description of Figure 9-4 follows" title="Description of Figure 9-4 follows" longdesc="img_text/adobj016.html"><br><a href="img_text/adobj016.html">Description of "Figure 9-4 Object-Relational Representation of the projects_objtab Object Table"</a></div>
                        <!-- class="figure" -->
                        <p>After the <code class="codeph">people_objtab</code> object table and the <code class="codeph">projects_objtab</code> object table are in place, you indirectly have a nested collection. That is, the <code class="codeph">projects_objtab</code> table contains a nested table collection of <code class="codeph">REF</code>s that point to the people in the <code class="codeph">people_objtab</code> table, and the people in the <code class="codeph">people_objtab</code> table have a nested table collection of phone numbers.
                        </p>
                        <p>You are now set to insert value as shown <a href="design-considerations-for-collections.html#GUID-F2696EEE-87A7-4FBE-94C9-F8D56FD33541" title="After you have created an object table, you can then insert values into it.">Inserting Values into Object Tables</a>.
                        </p>
                     </div>
                     <!-- class="example" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-F2696EEE-87A7-4FBE-94C9-F8D56FD33541" name="GUID-F2696EEE-87A7-4FBE-94C9-F8D56FD33541"></a><h4 id="ADOBJ-GUID-F2696EEE-87A7-4FBE-94C9-F8D56FD33541" class="sect4"><span class="enumeration_section">9.4.5.3 </span>Inserting Values into the PEOPLE_OBJTAB Object Table
                  </h4>
                  <div>
                     <p>After you have created an object table, you can then insert values into it.</p>
                     <div class="section">
                        <p>You can insert values into the <code class="codeph">people_objtab</code> table as in this example.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-F2696EEE-87A7-4FBE-94C9-F8D56FD33541__CJAJHHJB">
                        <p class="titleinexample">Example 9-10 Inserting Values into the people_objtab Object Table</p><pre class="oac_no_warn" dir="ltr">INSERT INTO people_objtab VALUES (
   0001,
   name_objtyp('JOHN', 'JACOB', 'SCHMIDT'),
   address_objtyp('1252 Maple Road', 'Fairfax', 'VA', '22033'),
   phone_ntabtyp(
      phone_objtyp('home', '650.555.0141'),
      phone_objtyp('work', '510.555.0122'))) ;

INSERT INTO people_objtab VALUES (
   0002,
   name_objtyp('MARY', 'ELLEN', 'MILLER'),
   address_objtyp('33 Spruce Street', 'McKees Rocks', 'PA', '15136'),
   phone_ntabtyp(
      phone_objtyp('home', '415.555.0143'),
      phone_objtyp('work', '650.555.0192'))) ;

INSERT INTO people_objtab VALUES (
   0003,
   name_objtyp('SARAH', 'MARIE', 'SINGER'),
   address_objtyp('525 Pine Avenue', 'San Mateo', 'CA', '94403'),
   phone_ntabtyp(
      phone_objtyp('home', '510.555.0101'),
      phone_objtyp('work', '650.555.0178'),
      phone_objtyp('cell', '650.555.0143'))) ;
</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-F2696EEE-87A7-4FBE-94C9-F8D56FD33541__GUID-38044152-BB32-43BB-8E6F-DA8333BD9682">
                        <p class="titleinexample">Example 9-11 Inserting Values into the projects_objtab Object Table</p>
                        <p>Then, you can insert into the <code class="codeph">projects_objtab</code> relational table by selecting from the <code class="codeph">people_objtab</code> object table using a <code class="codeph">REF</code> operator, as in .
                        </p><pre class="oac_no_warn" dir="ltr">
INSERT INTO projects_objtab VALUES (
   1101,
   'Demo Product',
   (SELECT REF(p) FROM people_objtab p WHERE id = 0001), 
   'Demo the product, show all the great features.',
   personref_ntabtyp(
      (SELECT REF(p) FROM people_objtab p WHERE id = 0001),
      (SELECT REF(p) FROM people_objtab p WHERE id = 0002), 
      (SELECT REF(p) FROM people_objtab p WHERE id = 0003))) ;

INSERT INTO projects_objtab VALUES (
   1102,
   'Create PRODDB',   
   (SELECT REF(p) FROM people_objtab p WHERE id = 0002),
   'Create a database of our products.',
   personref_ntabtyp(
      (SELECT REF(p) FROM people_objtab p WHERE id = 0002),
      (SELECT REF(p) FROM people_objtab p WHERE id = 0003))) ;
</pre></div>
                     <!-- class="example" -->
                     <div class="section">
                        <div class="infoboxnote" id="GUID-F2696EEE-87A7-4FBE-94C9-F8D56FD33541__GUID-DFC2FE0E-DB41-4496-85DF-2C62B9D2A73D">
                           <p class="notep1">Note:</p>
                           <p>This example uses nested tables to store <code class="codeph">REF</code>s, but you also can store <code class="codeph">REF</code>s in varrays. That is, you can have a varray of <code class="codeph">REF</code>s.
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>