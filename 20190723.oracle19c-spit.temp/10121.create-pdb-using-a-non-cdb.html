<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="You can create a PDB using a non-CDB in different ways.">
      <meta name="description" content="You can create a PDB using a non-CDB in different ways.">
      <title>Creating a PDB Using a Non-CDB</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Upgrading and Converting Non-CDBs to a PDB with the Same Operating System">
      <meta property="og:description" content="You can create a PDB using a non-CDB in different ways.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Upgrading and Converting Non-CDBs to a PDB with the Same Operating System">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="upgrading-and-converting-non-cdbs-pdb-same-operating-system.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-08T17:29:43-08:00">
      <meta name="dcterms.title" content="Upgrading and Converting Non-CDBs to a PDB with the Same Operating System">
      <meta name="dcterms.dateCopyrighted" content="2018, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="F10903-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="about-testing-the-upgraded-production-oracle-db.html" title="Previous" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="SPUCS">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="about-testing-the-upgraded-production-oracle-db.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="#" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Upgrading and Converting Non-CDBs to a PDB with the Same Operating System</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Creating a PDB Using a Non-CDB</li>
            </ol>
            <a id="GUID-5DBBD832-B8D5-42CE-8D5C-986037656A7E" name="GUID-5DBBD832-B8D5-42CE-8D5C-986037656A7E"></a>
            
            <h2 id="SPUCS-GUID-5DBBD832-B8D5-42CE-8D5C-986037656A7E" class="sect2"><span class="enumeration_chapter">5 </span>Creating a PDB Using a Non-CDB
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>You can create a PDB using a non-CDB in different ways.</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="create-pdb-using-a-non-cdb.html#GUID-EE58804F-A999-4F7C-93DE-D641B3C1047B">Adopting a Non-CDB as a PDB</a><br>You can adopt (move) a non-CDB into a PDB by using the <code class="codeph">DBMS_PDB.DESCRIBE</code> procedure. 
                  </li>
               </ul>
            </div>
            
            <div class="props_rev_3"><a id="GUID-EE58804F-A999-4F7C-93DE-D641B3C1047B" name="GUID-EE58804F-A999-4F7C-93DE-D641B3C1047B"></a><h3 id="SPUCS-GUID-EE58804F-A999-4F7C-93DE-D641B3C1047B" class="sect3">Adopting a Non-CDB as a PDB</h3>
               <div>
                  <p>You can adopt (move) a non-CDB into a PDB by using the <code class="codeph">DBMS_PDB.DESCRIBE</code> procedure. 
                  </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-EE58804F-A999-4F7C-93DE-D641B3C1047B__GUID-0A3EC9AD-C344-4C3C-94E8-DC479F15D0DD">To adopt a non-CDB as a PDB using the <code class="codeph">DBMS_PDB</code> package:
                     </p>
                     <ol>
                        <li>
                           <p>Create the CDB if it does not exist.</p>
                        </li>
                        <li>
                           <p>Ensure that the non-CDB is in a transactionally-consistent state.</p>
                        </li>
                        <li>
                           <p>Place the non-CDB in read-only mode.</p>
                        </li>
                        <li>
                           <p>Connect to the non-CDB, and run the <code class="codeph">DBMS_PDB.DESCRIBE</code> procedure to construct an XML file that describes the non-CDB.
                           </p>
                           <p>The current user must have <code class="codeph">SYSDBA</code> administrative privilege. The user must exercise the privilege using <code class="codeph">AS SYSDBA</code> at connect time.
                           </p>
                           <p>For example, to generate an XML file named <code class="codeph">ncdb.xml</code> in the <code class="codeph">/disk1/oracle</code> directory, run the following procedure:
                           </p><pre class="pre codeblock"><code>BEGIN
  DBMS_PDB.DESCRIBE(
    pdb_descr_file =&gt; '/disk1/oracle/ncdb.xml');
END;
/
</code></pre><p>After the procedure completes successfully, you can use the XML file and the non-CDB database files to plug the non-CDB into a CDB.</p>
                        </li>
                        <li>
                           <p>Run the <code class="codeph">DBMS_PDB.CHECK_PLUG_COMPATIBILITY</code> function to determine whether the non-CDB is compatible with the CDB.
                           </p>
                           <p>When you run the function, set the following parameters:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">pdb_descr_file</code> - Set this parameter to the full path to the XML file.
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">pdb_name</code> - Specify the name of the new PDB. If this parameter is omitted, then the PDB name in the XML file is used.
                                 </p>
                              </li>
                           </ul>
                           <p>For example, to determine whether a non-CDB described by the <code class="codeph">/disk1/oracle/ncdb.xml</code> file is compatible with the current CDB, run the following PL/SQL block:
                           </p><pre class="pre codeblock"><code>SET SERVEROUTPUT ON
DECLARE
  compatible CONSTANT VARCHAR2(3) := 
    CASE DBMS_PDB.CHECK_PLUG_COMPATIBILITY(
           pdb_descr_file =&gt; '/disk1/oracle/ncdb.xml',
           pdb_name       =&gt; 'NCDB')
    WHEN TRUE THEN 'YES'
    ELSE 'NO'
END;
BEGIN
  DBMS_OUTPUT.PUT_LINE(compatible);
END;
/
</code></pre><p>If the output is <code class="codeph">YES</code>, then the non-CDB is compatible, and you can continue with the next step. If the output is <code class="codeph">NO</code>, then the non-CDB is not compatible, and you can check the <code class="codeph">PDB_PLUG_IN_VIOLATIONS</code> view to see why it is not compatible. All violations must be corrected before you continue. For example, any version or patch mismatches should be resolved by running an upgrade or the datapatch utility. After correcting the violations, run <code class="codeph">DBMS_PDB.CHECK_PLUG_COMPATIBILITY</code> again to ensure that the non-CDB is compatible with the CDB.
                           </p>
                        </li>
                        <li>
                           <p>Shut down the non-CDB.</p>
                        </li>
                        <li>
                           <p>Plug in the non-CDB.</p>
                           <p>For example, the following SQL statement plugs in a non-CDB, copies its files to a new location, and includes only the <code class="codeph">tbs3</code> user tablespace from the non-CDB:
                           </p><pre class="pre codeblock"><code>CREATE PLUGGABLE DATABASE ncdb USING '/disk1/oracle/ncdb.xml'
  COPY
  FILE_NAME_CONVERT = ('/disk1/oracle/dbs/', '/disk2/oracle/ncdb/')
  USER_TABLESPACES=('tbs3');
</code></pre><p>If there are no violations, then do not open the new PDB. You will open it in the following step.</p>
                           <p>The <code class="codeph">USER_TABLESPACES</code> clause enables you to separate data that was used for multiple tenants in a non-CDB into different PDBs. You can use multiple <code class="codeph">CREATE PLUGGABLE DATABASE</code> statements with this clause to create other PDBs that include the data from other tablespaces that existed in the non-CDB.
                           </p>
                        </li>
                        <li>
                           <p>Run the <code class="codeph"><span class="codeinlineitalic">ORACLE_HOME</span>/rdbms/admin/noncdb_to_pdb.sql</code> script. This script must be run before the PDB can be opened for the first time.
                           </p>
                           <p>If the PDB was not a non-CDB, then running the <code class="codeph">noncdb_to_pdb.sql</code> script is not required. To run the <code class="codeph">noncdb_to_pdb.sql</code> script, complete the following steps:
                           </p>
                           <ol type="a">
                              <li>
                                 <p>Access the PDB.</p>
                                 <p>The current user must have <code class="codeph">SYSDBA</code> administrative privilege, and the privilege must be either commonly granted or locally granted in the PDB. The user must exercise the privilege using <code class="codeph">AS SYSDBA</code> at connect time.
                                 </p>
                              </li>
                              <li>
                                 <p>Run the <code class="codeph">noncdb_to_pdb.sql</code> script:
                                 </p><pre class="pre codeblock"><code>@$ORACLE_HOME/rdbms/admin/noncdb_to_pdb.sql
</code></pre></li>
                           </ol>
                           <p>The script opens the PDB, performs changes, and closes the PDB when the changes are complete.</p>
                        </li>
                        <li id="GUID-EE58804F-A999-4F7C-93DE-D641B3C1047B__OPENTHENEWPDBINREADWRITEMODE.YOUMUS-EF8E3A86">
                           <p>Open the new PDB in read/write mode.</p>
                           <p>You must open the new PDB in read/write mode for Oracle Database to complete the integration of the new PDB into the CDB. An error is returned if you attempt to open the PDB in read-only mode. After the PDB is opened in read/write mode, its status is <code class="codeph">NORMAL</code>.
                           </p>
                        </li>
                        <li>
                           <p>Back up the PDB.</p>
                           <p>A PDB cannot be recovered unless it is backed up.</p>
                        </li>
                     </ol>
                     <div class="infoboxnote" id="GUID-EE58804F-A999-4F7C-93DE-D641B3C1047B__GUID-E9DD002C-0C50-487B-B857-6AA13F0DC51F">
                        <p class="notep1">Note:</p>
                        <p>If an error is returned during PDB creation, then the PDB being created might be in an <code class="codeph">UNUSABLE</code> state. You can check a PDB's state by querying the <code class="codeph">CDB_PDBS</code> or <code class="codeph">DBA_PDBS</code> view, and you can learn more about PDB creation errors by checking the alert log. An unusable PDB can only be dropped, and it must be dropped before a PDB with the same name as the unusable PDB can be created.
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="create-pdb-using-a-non-cdb.html#GUID-5DBBD832-B8D5-42CE-8D5C-986037656A7E" title="You can create a PDB using a non-CDB in different ways.">Creating a PDB Using a Non-CDB</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>