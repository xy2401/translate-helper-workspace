<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="The C DOM API for XMLType lets you operate on XMLType instances using a DOM in C.">
      <meta name="description" content="The C DOM API for XMLType lets you operate on XMLType instances using a DOM in C.">
      <title>C DOM API for XMLType</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Developer's Guide ">
      <meta property="og:description" content="The C DOM API for XMLType lets you operate on XMLType instances using a DOM in C.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="xml-db-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-03-30T12:32:42-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="2002, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96222-03">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="Java-DOM-API-for-XMLType.html" title="Previous" type="text/html">
      <link rel="next" href="XML-DB-and-ODP-for-dot-NET.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="XML DB Developer's Guide">
    <meta name="dcterms.isVersionOf" content="ADXDB">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="Java-DOM-API-for-XMLType.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="XML-DB-and-ODP-for-dot-NET.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Developer's Guide </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="XMLType-APIs.html" property="item" typeof="WebPage"><span property="name"> XMLType APIs</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> C DOM API for XMLType</li>
            </ol>
            <a id="GUID-3530DFDE-0125-4A95-9DCA-29BA804F1BA9" name="GUID-3530DFDE-0125-4A95-9DCA-29BA804F1BA9"></a><a id="ADXDB1400"></a>
            
            <h2 id="ADXDB-GUID-3530DFDE-0125-4A95-9DCA-29BA804F1BA9" class="sect2"><span class="enumeration_chapter">14 </span> C DOM API for XMLType
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>The C DOM API for <code class="codeph">XMLType</code> lets you operate on <code class="codeph">XMLType</code> instances using a DOM in C.
               </p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="C-API-for-XMLType.html#GUID-C5C310E6-7CDD-45B7-9CD0-CC3FE74B6659">Overview of the C DOM API for XMLType</a><br>The C DOM API for <code class="codeph">XMLType</code> is a DOM API that is used for Oracle XML Developer's Kit (XDK) and Oracle XML&nbsp;DB. You can use it for XML data that is inside or outside the database. 
                  </li>
                  <li class="ulchildlink"><a href="C-API-for-XMLType.html#GUID-DF6B7D2F-95D9-4B1A-827E-DD456E275E7B">Access to XMLType Data Stored in the Database Using OCI</a><br>Oracle XML&nbsp;DB provides support for storing and manipulating XML instances using abstract data type <code class="codeph">XMLType</code>. These XML instances can be accessed and manipulated on the client side using the Oracle Call Interface (OCI) in conjunction with the C DOM API for XML.
                  </li>
                  <li class="ulchildlink"><a href="C-API-for-XMLType.html#GUID-5E94BF15-CCE2-48BC-A692-6BEE4FC106A9">Creating XMLType Instances on the Client</a><br>You can construct new <code class="codeph">XMLType</code> instances on the client side using the C DOM API methods <code class="codeph">XMLCreateDocument()</code> and <code class="codeph">XmlLoadDom()</code>.
                  </li>
                  <li class="ulchildlink"><a href="C-API-for-XMLType.html#GUID-10FA0209-10E6-49CC-B783-4340B221CB35">XML Context Parameter for C DOM API Functions</a><br>An <span class="italic">XML context</span> is a required parameter for all the C DOM API functions. This opaque context encapsulates information about the data encoding, the error message language, and so on. The contents of the context are different for Oracle XML Developer's Kit applications and Oracle XML&nbsp;DB. 
                  </li>
                  <li class="ulchildlink"><a href="C-API-for-XMLType.html#GUID-8B2A5513-A30A-4F2E-ACA0-90BB9E533E8D">Initializing and Terminating an XML Context</a><br>An example illustrates a C program that uses the C&nbsp;DOM API to construct an XML document and save it to Oracle Database.
                  </li>
                  <li class="ulchildlink"><a href="C-API-for-XMLType.html#GUID-556A53A1-7522-4786-AAB8-157326B7DFEA">Using the C API for XML with Binary XML</a><br>You can use the C API for XML to read or write XML data that is encoded as binary XML from or to Oracle XML DB. Doing so involves the usual read and write procedures. 
                  </li>
                  <li class="ulchildlink"><a href="C-API-for-XMLType.html#GUID-060FFEF3-A3C5-48EB-B008-D6496B5749A3">Using the Oracle XML Developer's Kit Pull Parser with Oracle XML&nbsp;DB</a><br>You can use the Oracle XML Developer's Kit pull parser with <code class="codeph">XMLType</code> instances in Oracle XML&nbsp;DB. When you use this parser, parsing is done on demand, so your application drives the parsing process. 
                  </li>
                  <li class="ulchildlink"><a href="C-API-for-XMLType.html#GUID-687495C3-551B-4786-8A5F-F594985553E2">Common XMLType Operations in C</a><br>Common XML operations are provided by the C API for XML.
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>Parent topic:</strong> <a href="XMLType-APIs.html#GUID-6209297F-DBE4-4F31-85F1-4083BF5BDE01" title="You can use Oracle XML&nbsp;DB XMLType PL/SQL, Java, C APIs, and Oracle Data Provider for .NET (ODP.NET) to access and manipulate XML data.">XMLType APIs</a></p>
                  </div>
               </div>
            </div>
            <a id="ADXDB4962"></a><div class="props_rev_3"><a id="GUID-C5C310E6-7CDD-45B7-9CD0-CC3FE74B6659" name="GUID-C5C310E6-7CDD-45B7-9CD0-CC3FE74B6659"></a><h3 id="ADXDB-GUID-C5C310E6-7CDD-45B7-9CD0-CC3FE74B6659" class="sect3"><span class="enumeration_section">14.1 </span>Overview of the C DOM API for XMLType
               </h3>
               <div>
                  <p>The C DOM API for <code class="codeph">XMLType</code> is a DOM API that is used for Oracle XML Developer's Kit (XDK) and Oracle XML&nbsp;DB. You can use it for XML data that is inside or outside the database. 
                  </p>
                  <p>DOM refers to compliance with the World Wide Web Consortium (W3C) DOM 2.0 Recommendation.</p>
                  <p>The C DOM API for <code class="codeph">XMLType</code> also includes performance-improving extensions that you can use in XDK for traditional storage of XML data, or in Oracle XML&nbsp;DB for storage as an <code class="codeph">XMLType</code> column in a table.
                  </p>
                  <div class="infoboxnote" id="GUID-C5C310E6-7CDD-45B7-9CD0-CC3FE74B6659__GUID-E7791695-608B-422C-A5B0-19D1A7FBD346">
                     <p class="notep1">Note:</p>
                     <p>C DOM functions from releases prior to Oracle Database&nbsp;10g Release 1 are supported only for backward compatibility.</p>
                  </div>
                  <p>The C DOM API for <code class="codeph">XMLType</code> is implemented on <code class="codeph">XMLType</code> in Oracle XML&nbsp;DB. In the W3C DOM Recommendation, the term "document" is used in a broad sense (URI, file system, memory buffer, standard input and output). The C DOM API for <code class="codeph">XMLType</code> is a combined programming interface that includes all of the functionality needed by Oracle XML Developer's Kit and Oracle XML&nbsp;DB applications. It provides XSLT and XML Schema implementations. Although the DOM 2.0 Recommendation was followed closely, some naming changes were required for mapping from the objected-oriented DOM 2.0 Recommendation to the flat C namespace. For example, method <code class="codeph">getName()</code> was renamed to <code class="codeph">getAttrName()</code>.
                  </p>
                  <p>The C DOM API for <code class="codeph">XMLType</code> supersedes older Oracle APIs. In particular, the <code class="codeph">oraxml</code> interface (top-level, DOM, SAX, and XSLT) and <code class="codeph">oraxsd.h</code> (Schema) interfaces will be deprecated in a future release.
                  </p>
                  <p>The reference documentation for the C and C++ Application Programming Interfaces (APIs) that you can use to manipulate XML data is <a href="../caxml/index.html" target="_blank"><span><cite>Oracle Database XML C API Reference</cite></span></a>, and <a href="../cpxml/index.html" target="_blank"><span><cite>Oracle Database XML C++ API Reference</cite></span></a>.
                  </p>
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-C5C310E6-7CDD-45B7-9CD0-CC3FE74B6659__GUID-BD28138B-325E-4844-B502-5D74CE997DDB">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span> for information about PL/SQL APIs for XML
                           </p>
                        </li>
                        <li>
                           <p><a href="../jaxml/index.html" target="_blank"><span><cite>Oracle Database XML Java API Reference</cite></span></a> for information about Java APIs for XML
                           </p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="C-API-for-XMLType.html#GUID-3530DFDE-0125-4A95-9DCA-29BA804F1BA9" title="The C DOM API for XMLType lets you operate on XMLType instances using a DOM in C.">C DOM API for XMLType</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB4964"></a><div class="props_rev_3"><a id="GUID-DF6B7D2F-95D9-4B1A-827E-DD456E275E7B" name="GUID-DF6B7D2F-95D9-4B1A-827E-DD456E275E7B"></a><h3 id="ADXDB-GUID-DF6B7D2F-95D9-4B1A-827E-DD456E275E7B" class="sect3"><span class="enumeration_section">14.2 </span>Access to XMLType Data Stored in the Database Using OCI
               </h3>
               <div>
                  <p>Oracle XML&nbsp;DB provides support for storing and manipulating XML instances using abstract data type <code class="codeph">XMLType</code>. These XML instances can be accessed and manipulated on the client side using the Oracle Call Interface (OCI) in conjunction with the C DOM API for XML.
                  </p>
                  <p> You can bind and define <code class="codeph">XMLType</code> values using the C DOM structure <code class="codeph">xmldocnode</code>. This structure can be used for binding, defining and operating on XML values in OCI statements. You can use OCI statements to select XML data from the server, which you can then use with C DOM API functions. Similarly, values can be bound back to SQL statements directly.
                  </p>
                  <p>The main flow for an application program involves initializing the usual OCI handles, such as server handle and statement handle, and then initializing an XML context parameter. You can then either operate on XML instances in the database or create new instances on the client side. The initialized XML context can be used with all of the C DOM functions.</p>
                  <div class="section"></div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="C-API-for-XMLType.html#GUID-10FA0209-10E6-49CC-B783-4340B221CB35" title="An XML context is a required parameter for all the C DOM API functions. This opaque context encapsulates information about the data encoding, the error message language, and so on. The contents of the context are different for Oracle XML Developer's Kit applications and Oracle XML&nbsp;DB.">XML Context Parameter for C DOM API Functions</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="C-API-for-XMLType.html#GUID-3530DFDE-0125-4A95-9DCA-29BA804F1BA9" title="The C DOM API for XMLType lets you operate on XMLType instances using a DOM in C.">C DOM API for XMLType</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB4965"></a><div class="props_rev_3"><a id="GUID-5E94BF15-CCE2-48BC-A692-6BEE4FC106A9" name="GUID-5E94BF15-CCE2-48BC-A692-6BEE4FC106A9"></a><h3 id="ADXDB-GUID-5E94BF15-CCE2-48BC-A692-6BEE4FC106A9" class="sect3"><span class="enumeration_section">14.3 </span>Creating XMLType Instances on the Client
               </h3>
               <div>
                  <p>You can construct new <code class="codeph">XMLType</code> instances on the client side using the C DOM API methods <code class="codeph">XMLCreateDocument()</code> and <code class="codeph">XmlLoadDom()</code>.
                  </p>
                  <div class="section">
                     <p>You can construct empty <code class="codeph">XMLType</code> instances using <code class="codeph">XMLCreateDocument()</code>. This is similar to using <code class="codeph">OCIObjectNew()</code> for other types. 
                     </p>
                     <p>You construct a non-empty <code class="codeph">XMLType</code> instance using <code class="codeph">XmlLoadDom()</code>, as follows:
                     </p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li><span>Initialize the <code class="codeph">xmlctx</code> as in <a href="C-API-for-XMLType.html#GUID-8B2A5513-A30A-4F2E-ACA0-90BB9E533E8D__CHDGCGGE">Example 14-1</a>.</span></li>
                     <li><span>Construct the XML data from a user buffer, local file, or URI. The return value, a (<code class="codeph">xmldocnode*</code>), can be used in the rest of the common C API.</span></li>
                     <li><span>If required, you can cast (<code class="codeph">xmldocnode *</code>) to (<code class="codeph">void*</code>) and provide it directly as the bind value.</span></li>
                  </ol>
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="C-API-for-XMLType.html#GUID-3530DFDE-0125-4A95-9DCA-29BA804F1BA9" title="The C DOM API for XMLType lets you operate on XMLType instances using a DOM in C.">C DOM API for XMLType</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB4966"></a><div class="props_rev_3"><a id="GUID-10FA0209-10E6-49CC-B783-4340B221CB35" name="GUID-10FA0209-10E6-49CC-B783-4340B221CB35"></a><h3 id="ADXDB-GUID-10FA0209-10E6-49CC-B783-4340B221CB35" class="sect3"><span class="enumeration_section">14.4 </span>XML Context Parameter for C DOM API Functions
               </h3>
               <div>
                  <p>An <span class="italic">XML context</span> is a required parameter for all the C DOM API functions. This opaque context encapsulates information about the data encoding, the error message language, and so on. The contents of the context are different for Oracle XML Developer's Kit applications and Oracle XML&nbsp;DB. 
                  </p>
                  <div class="section">
                     <p>For Oracle XML&nbsp;DB, OCI functions <code class="codeph">OCIXmlDbInitXmlCtx()</code>and <code class="codeph">OCIXmlDbFreeXmlCtx()</code>, respectively, initialize and terminate an XML context.
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="C-API-for-XMLType.html#GUID-71C33EF4-ED8C-4C61-8BDA-C1177F2CAA30">OCIXmlDbInitXmlCtx() Syntax</a><br>OCI function <code class="codeph">OCIXmlDbInitXmlCtx()</code>initializes an XML context. 
                     </li>
                     <li class="ulchildlink"><a href="C-API-for-XMLType.html#GUID-22790786-C29D-4D86-8108-46586E41CF1C">OCIXmlDbFreeXmlCtx() Syntax</a><br>OCI function <code class="codeph">OCIXmlDbFreeXmlCtx()</code>terminates an XML context. 
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="C-API-for-XMLType.html#GUID-3530DFDE-0125-4A95-9DCA-29BA804F1BA9" title="The C DOM API for XMLType lets you operate on XMLType instances using a DOM in C.">C DOM API for XMLType</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADXDB4968"></a><a id="ADXDB4967"></a><div class="props_rev_3"><a id="GUID-71C33EF4-ED8C-4C61-8BDA-C1177F2CAA30" name="GUID-71C33EF4-ED8C-4C61-8BDA-C1177F2CAA30"></a><h4 id="ADXDB-GUID-71C33EF4-ED8C-4C61-8BDA-C1177F2CAA30" class="sect4"><span class="enumeration_section">14.4.1 </span>OCIXmlDbInitXmlCtx() Syntax
                  </h4>
                  <div>
                     <p>OCI function <code class="codeph">OCIXmlDbInitXmlCtx()</code>initializes an XML context. 
                     </p>
                     <div class="section">
                        <p>The syntax of <code class="codeph">OCIXmlDbInitXmlCtx()</code> is as follows:
                        </p><pre class="pre codeblock"><code>xmlctx *OCIXmlDbInitXMlCtx (OCIEnv        *envhp,
                            OCISvcHp      *svchp,
                            OCIError      *errhp,
                            ocixmldbparam *params,
                            ub4           num_params);
</code></pre><p><a href="C-API-for-XMLType.html#GUID-71C33EF4-ED8C-4C61-8BDA-C1177F2CAA30__BGGHEDDH" title="This table describes the OCIXmlDBlInitXmlCtx parameters.">Table 14-1</a> describes the parameters.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="tblformal" id="GUID-71C33EF4-ED8C-4C61-8BDA-C1177F2CAA30__BGGHEDDH">
                        <p class="titleintable">Table 14-1 OCIXmlDbInitXMlCtx() Parameters </p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="OCIXmlDbInitXMlCtx() Parameters " summary="This table describes the OCIXmlDBlInitXmlCtx parameters." width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="23%" id="d76905e526">Parameter</th>
                                 <th align="left" valign="bottom" width="77%" id="d76905e529">Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d76905e534" headers="d76905e526 ">
                                    <p><code class="codeph">envhp (IN)</code></p>
                                 </td>
                                 <td align="left" valign="top" width="77%" headers="d76905e534 d76905e529 ">
                                    <p>The OCI environment handle.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d76905e542" headers="d76905e526 ">
                                    <p><code class="codeph">svchp (IN)</code></p>
                                 </td>
                                 <td align="left" valign="top" width="77%" headers="d76905e542 d76905e529 ">
                                    <p>The OCI service handle.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d76905e550" headers="d76905e526 ">
                                    <p><code class="codeph">errhp (IN)</code></p>
                                 </td>
                                 <td align="left" valign="top" width="77%" headers="d76905e550 d76905e529 ">
                                    <p>The OCI error handle.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d76905e558" headers="d76905e526 ">
                                    <p><code class="codeph">params (IN)</code></p>
                                 </td>
                                 <td align="left" valign="top" width="77%" headers="d76905e558 d76905e529 ">
                                    <p>An array of optional values:</p>
                                    <ul style="list-style-type: disc;">
                                       <li>
                                          <p>OCI duration. Default value is <code class="codeph">OCI_DURATION_SESSION</code>.
                                          </p>
                                       </li>
                                       <li>
                                          <p>Error handler, which is a user-registered callback:</p><pre class="pre codeblock"><code>void (*err_handler) (sword errcode, 
                     (CONST OraText *) errmsg);</code></pre></li>
                                    </ul>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d76905e578" headers="d76905e526 ">
                                    <p><code class="codeph">num_params (IN)</code></p>
                                 </td>
                                 <td align="left" valign="top" width="77%" headers="d76905e578 d76905e529 ">
                                    <p>Number of parameters to be read from <code class="codeph">params</code>.
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="C-API-for-XMLType.html#GUID-10FA0209-10E6-49CC-B783-4340B221CB35" title="An XML context is a required parameter for all the C DOM API functions. This opaque context encapsulates information about the data encoding, the error message language, and so on. The contents of the context are different for Oracle XML Developer's Kit applications and Oracle XML&nbsp;DB.">XML Context Parameter for C DOM API Functions</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADXDB4969"></a><div class="props_rev_3"><a id="GUID-22790786-C29D-4D86-8108-46586E41CF1C" name="GUID-22790786-C29D-4D86-8108-46586E41CF1C"></a><h4 id="ADXDB-GUID-22790786-C29D-4D86-8108-46586E41CF1C" class="sect4"><span class="enumeration_section">14.4.2 </span>OCIXmlDbFreeXmlCtx() Syntax
                  </h4>
                  <div>
                     <p>OCI function <code class="codeph">OCIXmlDbFreeXmlCtx()</code>terminates an XML context. 
                     </p>
                     <div class="section">
                        <p>The syntax of <code class="codeph">OCIXmlDbFreeXmlCtx() </code>is as follows, where parameter <code class="codeph">xctx (IN)</code> is the XML context to terminate.:
                        </p><pre class="pre codeblock"><code>void OCIXmlDbFreeXmlCtx (xmlctx *xctx);</code></pre></div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="C-API-for-XMLType.html#GUID-10FA0209-10E6-49CC-B783-4340B221CB35" title="An XML context is a required parameter for all the C DOM API functions. This opaque context encapsulates information about the data encoding, the error message language, and so on. The contents of the context are different for Oracle XML Developer's Kit applications and Oracle XML&nbsp;DB.">XML Context Parameter for C DOM API Functions</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="ADXDB4971"></a><a id="ADXDB4970"></a><div class="props_rev_3"><a id="GUID-8B2A5513-A30A-4F2E-ACA0-90BB9E533E8D" name="GUID-8B2A5513-A30A-4F2E-ACA0-90BB9E533E8D"></a><h3 id="ADXDB-GUID-8B2A5513-A30A-4F2E-ACA0-90BB9E533E8D" class="sect3"><span class="enumeration_section">14.5 </span>Initializing and Terminating an XML Context
               </h3>
               <div>
                  <p>An example illustrates a C program that uses the C&nbsp;DOM API to construct an XML document and save it to Oracle Database.</p>
                  <div class="section">
                     <p><a href="C-API-for-XMLType.html#GUID-8B2A5513-A30A-4F2E-ACA0-90BB9E533E8D__CHDGCGGE">Example 14-1</a> shows this. The document constructed is stored in table <code class="codeph">my_table</code>. OCI functions <code class="codeph">OCIXmlDbInitXmlCtx()</code> and <code class="codeph">OCIXmlDbFreeXmlCtx()</code> are used to initialize and terminate the XML context, respectively. These functions are defined in header file <code class="codeph">ocixmldb.h</code>.
                     </p>
                     <p>The code uses helper functions <code class="codeph">exec_bind_xml</code>, <code class="codeph">init_oci_handles</code>, and <code class="codeph">free_oci_handles</code>, which are not listed here. The complete listing of this example, including the helper functions, can be found in <a href="oracle-supplied-XML-schemas-and-examples.html#GUID-8FCAD86A-3BF9-4B20-A9EE-8FC46C95C3CE" title="Full listings are provided here for the Oracle XML&nbsp;DB-supplied XML schemas, purchase-order XML schemas and an XSLT stylesheet used in various examples, and C-language (OCI) examples for loading XML content into Oracle XML&nbsp;DB and initializing and terminating an XML context.">Oracle-Supplied XML Schemas and Examples</a>, <a href="oracle-supplied-XML-schemas-and-examples.html#GUID-8CA90A5B-999C-49B6-A2FD-41427C332F17" title="An example shows how to use OCI functions OCIXmlDbInitXmlCtx() and OCIXmlDbFreeXmlCtx() to initialize and terminate an XML context. It constructs an XML document using the C&nbsp;DOM API and saves it to the database.">Initializing and Terminating an XML Context (OCI)</a>.
                     </p>
                     <p>The C code in <a href="C-API-for-XMLType.html#GUID-8B2A5513-A30A-4F2E-ACA0-90BB9E533E8D__CHDGCGGE">Example 14-1</a> assumes that the following SQL code has first been executed to create table <code class="codeph">my_table</code> in database schema <code class="codeph">capiuser</code>:
                     </p><pre class="pre codeblock"><code>CONNECT CAPIUSER
Enter password: <span class="italic">password</span>

Connected.

CREATE TABLE my_table OF XMLType;
</code></pre><p><a href="C-API-for-XMLType.html#GUID-687495C3-551B-4786-8A5F-F594985553E2__CHDBIHJI">Example 14-4</a> queries table <code class="codeph">my_table</code> to show the data that was inserted by <a href="C-API-for-XMLType.html#GUID-8B2A5513-A30A-4F2E-ACA0-90BB9E533E8D__CHDGCGGE">Example 14-1</a>.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-8B2A5513-A30A-4F2E-ACA0-90BB9E533E8D__CHDGCGGE">
                     <p class="titleinexample">Example 14-1 Using OCIXMLDBINITXMLCTX() and OCIXMLDBFREEXMLCTX()</p><pre class="pre codeblock"><code>#ifndef S_ORACLE
#endif
#ifndef ORATYPES_ORACLE
#include &lt;oratypes.h&gt;
#endif
#ifndef XML_ORACLE
#include &lt;xml.h&gt;
#endif
#ifndef OCIXML_ORACLE
#include &lt;ocixml.h&gt;
#endif
#ifndef OCI_ORACLE
#include &lt;oci.h&gt;
#endif
#include &lt;string.h&gt;
 
typedef struct test_ctx {
        OCIEnv *envhp;
        OCIError *errhp;
        OCISvcCtx *svchp;
        OCIStmt *stmthp;
        OCIServer *srvhp;
        OCIDuration dur;
        OCISession *sesshp;
        oratext *username;
        oratext *password;
} test_ctx;
 
/* Helper function 1: execute a sql statement which binds xml data */
static sword <span class="bold">exec_bind_xml</span>(OCISvcCtx *svchp,
                           OCIError *errhp,
                           OCIStmt *stmthp,
                           void *xml,
                           OCIType *xmltdo,
                           OraText *sqlstmt);
 
/* Helper function 2: Initialize OCI handles and connect */
static sword <span class="bold">init_oci_handles</span>(test_ctx *ctx);
 
/* Helper function 3: Free OCI handles and disconnect */
static <span class="bold">sword free_oci_handles</span>(test_ctx *ctx);
 
void <span class="bold">main</span>()
{
  test_ctx temp_ctx;
  test_ctx *ctx = &amp;temp_ctx;
  OCIType *xmltdo = (OCIType *) 0;
  xmldocnode *doc = (xmldocnode *)0;
  ocixmldbparam params[1];
  xmlnode *quux, *foo, *foo_data, *top;
  xmlerr err;
  sword status = 0;
  xmlctx *xctx;
 
  oratext ins_stmt[] = "insert into my_table values (:1)"; 
  oratext tlpxml_test_sch[] = "<span class="bold">&lt;TOP/&gt;</span>";
  ctx-&gt;username = (oratext *)"capiuser";
  ctx-&gt;password = (oratext *)"***********"; /* Replace with real password */
 
  /* Initialize envhp, svchp, errhp, dur, stmthp */
  init_oci_handles(ctx);
 
  /* Get an xml context */
  params[0].name_ocixmldbparam = XCTXINIT_OCIDUR;
  params[0].value_ocixmldbparam = &amp;ctx-&gt;dur;
  xctx = <span class="bold">OCIXmlDbInitXmlCtx</span>(ctx-&gt;envhp, ctx-&gt;svchp, ctx-&gt;errhp, params, 1);
 
  /* Start processing - first, check that this DOM supports XML 1.0 */
  printf("\n\nSupports XML 1.0? : %s\n",
         <span class="bold">XmlHasFeature</span>(xctx, (oratext *) "xml", (oratext *) "1.0") ?
         "YES" : "NO");
 
  /* Parse a document */
  if (!(doc = <span class="bold">XmlLoadDom</span>(xctx, &amp;err, "buffer", tlpxml_test_sch,
                         "buffer_length", sizeof(tlpxml_test_sch)-1,
                         "validate", TRUE, NULL)))
  {
    printf("Parse failed, code %d\n", err);
  }
  else
  {
    /* Get the document element */
    top = (xmlnode *)<span class="bold">XmlDomGetDocElem</span>(xctx, doc);
 
    /* Print out the top element */
    printf("\n\nOriginal top element is :\n");   
    <span class="bold">XmlSaveDom</span>(xctx, &amp;err, top, "stdio", stdout, NULL);
 
    /* Print out the document. The changes are reflected here */
    printf("\n\nOriginal document is :\n");
    <span class="bold">XmlSaveDom</span>(xctx, &amp;err, (xmlnode *)doc, "stdio", stdout, NULL);
 
    /* Create some elements and add them to the document */
    quux = (xmlnode *) <span class="bold">XmlDomCreateElem</span>(xctx ,doc, (oratext *) "<span class="bold">QUUX</span>");
    foo = (xmlnode *) <span class="bold">XmlDomCreateElem</span>(xctx, doc, (oratext *) "<span class="bold">FOO</span>");
    foo_data = (xmlnode *) <span class="bold">XmlDomCreateText</span>(xctx, doc, (oratext *) "<span class="bold">data</span>");
    foo_data = <span class="bold">XmlDomAppendChild</span>(xctx, (xmlnode *) foo, (xmlnode *) foo_data);
    foo = <span class="bold">XmlDomAppendChild</span>(xctx, quux, foo);
    quux = <span class="bold">XmlDomAppendChild</span>(xctx, top, quux);
 
    /* Print out the top element */
    printf("\n\nNow the top element is :\n");   
    <span class="bold">XmlSaveDom</span>(xctx, &amp;err, top, "stdio", stdout, NULL);
 
    /* Print out the document.  The changes are reflected here */
    printf("\n\nNow the document is :\n");
    <span class="bold">XmlSaveDom</span>(xctx, &amp;err, (xmlnode *)doc, "stdio", stdout, NULL);
 
    /* Insert the document into my_table */
    status = OCITypeByName(ctx-&gt;envhp, ctx-&gt;errhp, ctx-&gt;svchp, 
                           (const text *) "SYS", (ub4) strlen((char *)"SYS"), 
                           (const text *) "XMLTYPE",
                           (ub4) strlen((char *)"XMLTYPE"), (CONST text *) 0,
                           (ub4) 0, OCI_DURATION_SESSION, OCI_TYPEGET_HEADER,
                           (OCIType **) &amp;xmltdo);
    if (status == OCI_SUCCESS)
    {
      exec_bind_xml(ctx-&gt;svchp, ctx-&gt;errhp, ctx-&gt;stmthp, (void *)doc, xmltdo, 
                    ins_stmt);
    }
  }
  /* Free xml ctx */
  <span class="bold">OCIXmlDbFreeXmlCtx</span>(xctx);
 
  /* Free envhp, svchp, errhp, stmthp */
  free_oci_handles(ctx);
}
</code></pre><p>The output from compiling and running this C program is as follows:</p><pre class="oac_no_warn" dir="ltr">Supports XML 1.0? : YES
 
Original top element is :
&lt;TOP/&gt;
 
Original document is :
&lt;TOP/&gt;
 
Now the top element is :
&lt;TOP&gt;
  &lt;QUUX&gt;
    &lt;FOO&gt;data&lt;/FOO&gt;
  &lt;/QUUX&gt;
&lt;/TOP&gt;
 
Now the document is :
&lt;TOP&gt;
  &lt;QUUX&gt;
    &lt;FOO&gt;data&lt;/FOO&gt;
  &lt;/QUUX&gt;
&lt;/TOP&gt;
</pre><p>This is the result of querying the constructed document in <code class="codeph">my_table</code>:
                     </p><pre class="oac_no_warn" dir="ltr">SELECT * FROM my_table;

SYS_NC_ROWINFO$
---------------
&lt;TOP&gt; 
  &lt;QUUX&gt; 
    &lt;FOO&gt;data&lt;/FOO&gt; 
  &lt;/QUUX&gt; 
&lt;/TOP&gt; 
 
1 row selected.
</pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="C-API-for-XMLType.html#GUID-3530DFDE-0125-4A95-9DCA-29BA804F1BA9" title="The C DOM API for XMLType lets you operate on XMLType instances using a DOM in C.">C DOM API for XMLType</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB4977"></a><a id="ADXDB4976"></a><div class="props_rev_3"><a id="GUID-556A53A1-7522-4786-AAB8-157326B7DFEA" name="GUID-556A53A1-7522-4786-AAB8-157326B7DFEA"></a><h3 id="ADXDB-GUID-556A53A1-7522-4786-AAB8-157326B7DFEA" class="sect3"><span class="enumeration_section">14.6 </span>Using the C API for XML with Binary XML
               </h3>
               <div>
                  <p>You can use the C API for XML to read or write XML data that is encoded as binary XML from or to Oracle XML DB. Doing so involves the usual read and write procedures. </p>
                  <div class="section">
                     <p>Binary XML is a compact, XML Schema-aware encoding of XML data. You can use binary XML as a storage model for <code class="codeph">XMLType</code> data in the database, but you can also use it for XML data located outside the database. 
                     </p>
                     <p>Binary XML data is XML Schema-aware, and it can use various encoding schemes, depending on your needs. In order to manipulate binary XML data, you must have both the data and this metadata about the relevant XML schemas and encodings. </p>
                     <p>For <code class="codeph">XMLType</code> data stored in the database, this metadata is also stored in the database. However, depending on how your database and data are set up, the metadata might not be on the same server as the data it applies to. If this is the case, then, before you can read or write binary XML data from or to the database, you must carry out these steps:
                     </p>
                     <ol>
                        <li>
                           <p>Create a context instance for the metadata.</p>
                        </li>
                        <li>
                           <p>Associate this context with a data connection that you use to access binary XML data in the database. A data connection can be a dedicated connection (<code class="codeph">OCISvcCtx</code>) or a connection pool (<code class="codeph">OCICPool</code>).
                           </p>
                        </li>
                     </ol>
                     <p>Then, when your application needs to encode or decode binary XML data on the data connection, it automatically fetches the metadata needed for that. As is illustrated by <a href="C-API-for-XMLType.html#GUID-556A53A1-7522-4786-AAB8-157326B7DFEA__CHDEHEHF">Example 14-2</a>, the overall sequence of actions is as follows:
                     </p>
                     <ol>
                        <li>
                           <p>Create the usual OCI handles for environment (<code class="codeph">OCIEnv</code>), connection (<code class="codeph">OCISvcCtx</code>), and error context (<code class="codeph">OCIError</code>).
                           </p>
                        </li>
                        <li>
                           <p>Create one or more metadata contexts, as needed. A metadata context is sometimes referred to as a metadata repository, and <code class="codeph">OCIBinXMLReposCtx</code> is the OCI context data structure. You use <code class="codeph">OCIBinXMLCreateReposCtxFromConn</code> to create a metadata context from a dedicated connection and <code class="codeph">OCIBinXMLCreateReposCtxFromCPool</code> to create a context from a connection pool.
                           </p>
                        </li>
                        <li>
                           <p>Associate the metadata context(s) with the binary XML data connection(s). You use <code class="codeph">OCIBinXmlSetReposCtxForConn</code> to do this.
                           </p>
                        </li>
                        <li>
                           <p>(Optional) If the XML data originated outside of the database, use <code class="codeph">setPicklePreference</code> to specify that XML data to be sent to the database from now on is in binary XML format. This applies to a DOM document (<code class="codeph">xmldomdoc</code>). If you do not specify binary XML, the data is stored as text (<code class="codeph">CLOB</code>).
                           </p>
                        </li>
                        <li>
                           <p>Use OCI libraries to read and write XML data from and to the database. Whenever it is needed for encoding or decoding binary XML documents, the necessary metadata is fetched automatically using the metadata context. Use the C DOM API for XML to operate on the XML data at the client level.</p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-556A53A1-7522-4786-AAB8-157326B7DFEA__GUID-485AD655-204D-4965-8517-F4D163801F48">
                        <p class="notep1">See Also:</p>
                        <p><a href="../adxdk/using-binary-XML-with-C.html#ADXDK1810" target="_blank"><span><cite>Oracle XML Developer's Kit Programmer's Guide</cite></span></a></p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-556A53A1-7522-4786-AAB8-157326B7DFEA__CHDEHEHF">
                     <p class="titleinexample">Example 14-2 Using the C API for XML with Binary XML</p><pre class="oac_no_warn" dir="ltr"><span class="bold">. . .</span>
/* Private types and constants */
#define SCHEMA        (OraText *)"SYS"
#define TYPE          (OraText *)"XMLTYPE"
#define USER          (OraText *)"oe"
#define USER_LEN      (ub2)(strlen((char *)USER))
#define PWD           (OraText *)"oe"
#define PWD_LEN       (ub2)(strlen((char *)PWD))
#define NUM_PARAMS    1
static void checkerr(OCIError *errhp, sword status);
static sword create_env(OraText *user, ub2 user_len, OraText *pwd, ub2 pwd_len,
                        OCIEnv **envhp, OCISvcCtx **svchp, OCIError **errhp);
static sword run_example(OCIEnv *envhp, OCISvcCtx *svchp, OCIError *errhp,
                         OCIDuration dur);
static void cleanup(OCIEnv *envhp, OCISvcCtx *svchp, OCIError *errhp);
 
int <span class="bold">main</span> (int argc, char *argv[])
{
  OCIEnv     *envhp;
  <span class="bold">OCISvcCtx</span>  *svchp;
  OCIError   *errhp;
  printf("*** Starting Binary XML Example program\n");
  if (create_env(USER, USER_LEN, PWD, PWD_LEN, &amp;envhp, &amp;svchp, &amp;errhp))
    {
      printf("FAILED: create_env()\n");
      cleanup(envhp, svchp, errhp);
      return OCI_ERROR;
    }
  if (run_example(envhp, svchp, errhp, OCI_DURATION_SESSION))
    {
      printf("FAILED: run_example()\n");
      cleanup(envhp, svchp, errhp);
      return OCI_ERROR;
    }
  cleanup(envhp, svchp, errhp);
  printf ("*** Completed Binary XML example\n");
  return OCI_SUCCESS;
}
 
static sword <span class="bold">create_env</span>(OraText *user, ub2 user_len,
                        OraText *pwd,  ub2 pwd_len,
                        OCIEnv **envhp, OCISvcCtx **svchp, OCIError **errhp)
{
  sword       status;
  OCIServer  *srvhp;
  OCISession *usrp;
  OCICPool   *poolhp;
  OraText    *poolname;
  ub4         poolnamelen;
  OraText    *database =(OraText *)"";
  <span class="bold">OCIBinXmlReposCtx</span> *rctx;
  /* Create and initialize environment. Allocate error handle. */
  <span class="bold">. . .</span>
  if ((status = OCIConnectionPoolCreate((dvoid *)*envhp, (dvoid*)*errhp,
                                        (dvoid *)poolhp, &amp;poolname,
                                        (sb4 *)&amp;poolnamelen, 
                                        (OraText *)0, 
                                        (sb4) 0, 1, 10, 1, 
                                        (OraText *)USER, 
                                        (sb4) USER_LEN, 
                                        (OraText *)PWD, 
                                        (sb4) PWD_LEN,
                                        OCI_DEFAULT)) != OCI_SUCCESS)
    {
      printf ("OCIConnectionPoolCreate - Fail %d\n", status);
      return OCI_ERROR;
    }
  status = OCILogon2((OCIEnv *)*envhp, *errhp, svchp, (OraText *)USER,
                     (ub4)USER_LEN, (const oratext *)PWD, (ub4)PWD_LEN,
                     (const oratext *)poolname, poolnamelen, OCI_CPOOL);
  if (status)
    {
      printf ("OCILogon2 - Fail %d\n", status);
      return OCI_ERROR;
    }
  <span class="bold">OCIBinXmlCreateReposCtxFromCPool</span>(*envhp, poolhp, *errhp, &amp;rctx);
  <span class="bold">OCIBinXmlSetReposCtxForConn</span>(*svchp, rctx);
  return OCI_SUCCESS;
}
 
static sword <span class="bold">run_example</span>(OCIEnv *envhp, OCISvcCtx *svchp, OCIError *errhp,
                         OCIDuration dur)
{
  OCIType   *xmltdo = (OCIType *)0;
  OCIStmt   *stmthp;
  OCIDefine *defnp;
  xmldocnode *xmldoc = (xmldocnode *)0;
  ub4        xmlsize = 0;
  text      *selstmt = (text *)"SELECT doc FROM po_binxmltab";
  sword      status;
  struct xmlctx *xctx = (xmlctx *) 0;
  ocixmldbparam params[NUM_PARAMS];
  xmlerr xerr = (xmlerr) 0;
  /* Obtain type definition for XMLType. Allocate statement handle.
     Prepare SELECT statement. Define variable for XMLType. Execute statement. */
  <span class="bold">. . .</span>
  /* Construct xmlctx for using XML C API */
  params[0].name_ocixmldbparam = XCTXINIT_OCIDUR;
  params[0].value_ocixmldbparam = &amp;dur;
  xctx = OCIXmlDbInitXmlCtx(envhp, svchp, errhp, params, NUM_PARAMS);
  /* Print result to local string */
  XmlSaveDom(xctx, &amp;xerr, (xmlnode *)xmldoc, "stdio", stdout, NULL);
  /* Free instances */
  <span class="bold">. . .</span>
}</pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="intro-to-XML-DB.html#GUID-B8507F44-B010-4384-94E6-101131DD7D88" title="XMLType is an abstract data type that provides different storage models to best fit your data and your use of it. As an abstract data type, your applications and database queries gain in flexibility: the same interface is available for all XMLType operations.">XMLType Storage Models</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="C-API-for-XMLType.html#GUID-3530DFDE-0125-4A95-9DCA-29BA804F1BA9" title="The C DOM API for XMLType lets you operate on XMLType instances using a DOM in C.">C DOM API for XMLType</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB4979"></a><a id="ADXDB4978"></a><div class="props_rev_3"><a id="GUID-060FFEF3-A3C5-48EB-B008-D6496B5749A3" name="GUID-060FFEF3-A3C5-48EB-B008-D6496B5749A3"></a><h3 id="ADXDB-GUID-060FFEF3-A3C5-48EB-B008-D6496B5749A3" class="sect3"><span class="enumeration_section">14.7 </span>Using the Oracle XML Developer's Kit Pull Parser with Oracle XML&nbsp;DB
               </h3>
               <div>
                  <p>You can use the Oracle XML Developer's Kit pull parser with <code class="codeph">XMLType</code> instances in Oracle XML&nbsp;DB. When you use this parser, parsing is done on demand, so your application drives the parsing process. 
                  </p>
                  <div class="section">
                     <p>Your application accesses an XML document through a sequence of events, with start tags, end tags, and comments, just as in Simple API for XML (SAX) parsing. However, unlike the case of SAX parsing, where parsing events are handled by callbacks, in pull parsing your application calls methods to ask for (pull) events only when it needs them. This gives the application more control over XML processing. In particular, filtering is more flexible with the pull parser than with the SAX parser.</p>
                     <p>You can also use the Oracle XML Developer's Kit pull parser to perform stream-based XML Schema validation.</p>
                     <p><a href="C-API-for-XMLType.html#GUID-060FFEF3-A3C5-48EB-B008-D6496B5749A3__CHDIFDBE">Example 14-3</a> shows how to use the Oracle XML&nbsp;DB pull parser with an <code class="codeph">XMLType</code> instance. To use the pull parser, you also need static library <code class="codeph">libxml10.a</code> on UNIX and Linux systems or <code class="codeph">oraxml10.dll</code> on Microsoft Windows systems. You also need header file <code class="codeph">xmlev.h</code>.
                     </p>
                     <div class="infoboxnotealso" id="GUID-060FFEF3-A3C5-48EB-B008-D6496B5749A3__GUID-D9D74E5C-F57E-4528-9592-2731705A0CAB">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="../adxdk/using-XML-parser-for-C.html#ADXDK1410" target="_blank"><span><cite>Oracle XML Developer's Kit Programmer's Guide</cite></span></a> for information about the Oracle XML Developer's Kit pull parser
                              </p>
                           </li>
                           <li>
                              <p><a href="../adxdk/using-XML-schema-processor-for-C.html#ADXDK1600" target="_blank"><span><cite>Oracle XML Developer's Kit Programmer's Guide</cite></span></a> for information on using the pull parser for stream-based validation
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-060FFEF3-A3C5-48EB-B008-D6496B5749A3__CHDIFDBE">
                     <p class="titleinexample">Example 14-3 Using the Oracle XML&nbsp;DB Pull Parser</p><pre class="oac_no_warn" dir="ltr">#define MAXBUFLEN 64*1024
void main()
{
  test_ctx temp_ctx;
  test_ctx *ctx = &amp;temp_ctx;
  OCIType *xmltdo = (OCIType *) 0;
  ocixmldbparam params[1];
  sword status = 0;
  xmlctx *xctx;
  OCIDefine *defnp = (OCIDefine *) 0;
  oratext sel_stmt[] =
    "<span class="bold">SELECT XMLSerialize(DOCUMENT x.OBJECT_VALUE AS CLOB) FROM PURCHASEORDER x where rownum = 1</span>";
  OCILobLocator *cob;
  ub4 amtp, nbytes;
  ub1 bufp[MAXBUFLEN];
  ctx-&gt;username = (oratext *)"oe";
  ctx-&gt;password = (oratext *)"*************";    /* Replace with real password */
 
  <span class="bold">/* Initialize envhp, svchp, errhp, dur, stmthp */</span>
  init_oci_handles(ctx);
 
  <span class="bold">/* Get an xml context */</span>
  params[0].name_ocixmldbparam = XCTXINIT_OCIDUR;
  params[0].value_ocixmldbparam = &amp;ctx-&gt;dur;
  xctx = OCIXmlDbInitXmlCtx(ctx-&gt;envhp, ctx-&gt;svchp, ctx-&gt;errhp, params, 1);
 
  <span class="bold">/* Start processing */</span>
  printf("\n\n<span class="bold">Supports XML 1.0? :</span> %s\n",
         XmlHasFeature(xctx, (oratext *) "xml", (oratext *) "1.0") ?
         "YES" : "NO");
 
  <span class="bold">/* Allocate the lob descriptor */</span>
  status = OCIDescriptorAlloc((dvoid *) ctx-&gt;envhp, (dvoid **) &amp;clob,
                       (ub4)OCI_DTYPE_LOB, (size_t) 0, (dvoid **) 0);
  if (status)
  {
    printf("OCIDescriptorAlloc Failed\n");
    goto error;
  }
  status = OCIStmtPrepare(ctx-&gt;stmthp, ctx-&gt;errhp,
                 (CONST OraText *)sel_stmt, (ub4) strlen((char *)sel_stmt),
                 (ub4) OCI_NTV_SYNTAX, (ub4) OCI_DEFAULT);
  if (status)
  {
    printf("OCIStmtPrepare Failed\n");
    goto error;
  }
  status = OCIDefineByPos(ctx-&gt;stmthp, &amp;defnp, ctx-&gt;errhp, (ub4) 1,
                 (dvoid *) &amp;clob, (sb4) -1, (ub2 ) SQLT_CLOB,
                 (dvoid *) 0, (ub2 *)0,
                 (ub2 *)0, (ub4) OCI_DEFAULT);
  if (status)
  {
    printf("OCIDefineByPos Failed\n");
    goto error;
  }
  status = OCIStmtExecute(ctx-&gt;svchp, ctx-&gt;stmthp, ctx-&gt;errhp, (ub4) 1,
                          (ub4) 0, (CONST OCISnapshot*) 0, (OCISnapshot*) 0,
                          (ub4) OCI_DEFAULT);
  if (status)
  {
    printf("OCIStmtExecute Failed\n");
    goto error;
  }
  /* read the fetched value into a buffer */
  amtp = nbytes = MAXBUFLEN-1;
  status = OCILobRead(ctx-&gt;svchp, ctx-&gt;errhp, clob, &amp;amtp,
                (ub4) 1, (dvoid *) bufp, (ub4) nbytes, (dvoid *)0,
                (sb4 (*)(dvoid *, CONST dvoid *, ub4, ub1)) 0,
                (ub2) 0, (ub1) SQLCS_IMPLICIT);
  if (status)
  {
    printf("OCILobRead Failed\n");
    goto error;
  }
  bufp[amtp] = '\0';
  if (amtp &gt; 0)
  {
     printf("\n<span class="bold">=&gt; Query result</span> of %s: \n%s\n", sel_stmt, bufp);
     <span class="bold">/********** PULL PARSING ******************/</span>
     status = pp_parse(xctx, bufp, amtp);
     if (status)
       printf("Pull Parsing failed\n");
  }
error: 
  <span class="bold">/* Free XML Ctx */</span>
  OCIXmlDbFreeXmlCtx(xctx);
 
  <span class="bold">/* Free envhp, svchp, errhp, stmthp */</span>
  free_oci_handles(ctx);
}
#define ERRBUFLEN 256
sb4 pp_parse(xctx, buf, amt)
xmlctx  *xctx;
oratext *buf;
ub4     amt;
{
  xmlevctx *evctx;
  xmlerr   xerr = XMLERR_OK;
  oratext  message[ERRBUFLEN];
  oratext  *emsg = message;
  xmlerr   ecode;
  boolean  done, inattr = FALSE;
  xmlevtype event;
 
  <span class="bold">/* Create an XML event context - Pull Parser Context */</span>
  evctx = XmlEvCreatePPCtx(xctx, &amp;xerr,
                           "expand_entities", FALSE,
                           "validate", TRUE,
                           "attr_events", TRUE,
                           "raw_buffer_len", 1024,
                           NULL);
 if (!evctx)
  {
    printf("FAILED: XmlEvCreatePPCtx: %d\n", xerr);
    return OCI_ERROR;
  }
  <span class="bold">/* Load the document from input buffer */</span>
  xerr = XmlEvLoadPPDoc(xctx, evctx, "buffer", buf, amt, "utf-8");
  if (xerr)
  {
    printf("FAILED: XmlEvLoadPPDoc: %d\n", xerr);
    return OCI_ERROR;
  }
 <span class="bold"> /* Process the events until END_DOCUMENT event or error */</span>
  done = FALSE;
  while(!done)
  {
    event = XmlEvNext(evctx);
    switch(event)
    {
      case XML_EVENT_START_ELEMENT:
        printf("<span class="bold">START ELEMENT:</span> %s\n", XmlEvGetName0(evctx));
        break;
      case XML_EVENT_END_ELEMENT:
        printf("<span class="bold">END ELEMENT:</span> %s\n", XmlEvGetName0(evctx));
        break;
      case XML_EVENT_START_DOCUMENT:
        printf("<span class="bold">START DOCUMENT</span>\n");
        break;
      case XML_EVENT_END_DOCUMENT:
        printf("<span class="bold">END DOCUMENT</span>\n");
        done = TRUE;
        break;
      case XML_EVENT_START_ATTR:
        printf("<span class="bold">START ATTRIBUTE:</span> %s\n", XmlEvGetAttrName0(evctx, 0));
        inattr = TRUE;
        break;
      case XML_EVENT_END_ATTR:
        printf("<span class="bold">END ATTRIBUTE:</span> %s\n", XmlEvGetAttrName0(evctx, 0));
        inattr = FALSE;
        break;
      case XML_EVENT_CHARACTERS:
        if (inattr)
          printf("<span class="bold">ATTR VALUE:</span> %s\n", XmlEvGetText0(evctx));
        else
          printf("<span class="bold">TEXT:</span> %s\n", XmlEvGetText0(evctx));
        break;
      case XML_EVENT_ERROR:
      case XML_EVENT_FATAL_ERROR:
        done = TRUE;
        ecode = XmlEvGetError(evctx, &amp;emsg);
        printf("ERROR: %d: %s\n", ecode, emsg);
        break;
    }
  }
  <span class="bold">/* Destroy the event context */</span>
  XmlEvDestroyPPCtx(xctx, evctx);
  return OCI_SUCCESS;
}</pre><p>The output from compiling and running this C program is as follows:</p><pre class="oac_no_warn" dir="ltr"><span class="bold">=&gt; Query result</span> of XMLSerialize(DOCUMENT x.OBJECT_VALUE AS CLOB) FROM PURCHASEORDER x where rownum = 1: </pre><pre class="oac_no_warn" dir="ltr">&lt;PurchaseOrder xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xsi:noNamespaceSchemaLocation=
                 "http://localhost:8080/source/schemas/poSource/xsd/purchaseOrder.xsd"&gt;
  &lt;Reference&gt;AMCEWEN-20021009123336171PDT&lt;/Reference&gt;
  &lt;Actions&gt;
    &lt;Action&gt;
      &lt;User&gt;KPARTNER&lt;/User&gt;
    &lt;/Action&gt;
  &lt;/Actions&gt;
  &lt;Reject/&gt;
  &lt;Requestor&gt;Allan D. McEwen&lt;/Requestor&gt;
  &lt;User&gt;AMCEWEN&lt;/User&gt;
  &lt;CostCenter&gt;S30&lt;/CostCenter&gt;
  &lt;ShippingInstructions&gt;
    &lt;name&gt;Allan D. McEwen&lt;/name&gt;
    &lt;address&gt;Oracle Plaza
Twin Dolphin Drive
Redwood Shores
CA
94065
USA&lt;/address&gt;
    &lt;telephone&gt;650 506 7700&lt;/telephone&gt;
  &lt;/ShippingInstructions&gt;
  &lt;SpecialInstructions&gt;Ground&lt;/SpecialInstructions&gt;
  &lt;LineItems&gt;
    &lt;LineItem ItemNumber="1"&gt;
      &lt;Description&gt;Salesman&lt;/Description&gt;
      &lt;Part Id="37429158920" UnitPrice="39.95" Quantity="2"/&gt;
    &lt;/LineItem&gt;
    <span class="bold">. . .</span>
  &lt;/LineItems&gt;
&lt;/PurchaseOrder&gt;
 
START DOCUMENT
START ELEMENT: PurchaseOrder
START ATTRIBUTE: xmlns:xsi
ATTR VALUE: http://www.w3.org/2001/XMLSchema-instance
END ATTRIBUTE: xmlns:xsi
START ATTRIBUTE: xsi:noNamespaceSchemaLocation
ATTR VALUE: http://localhost:8080/source/schemas/poSource/xsd/purchaseOrder.xsd
END ATTRIBUTE: xsi:noNamespaceSchemaLocation
START ELEMENT: Reference
TEXT: AMCEWEN-20021009123336171PDT
END ELEMENT: Reference
START ELEMENT: Actions
START ELEMENT: Action
START ELEMENT: User
TEXT: KPARTNER
END ELEMENT: User
END ELEMENT: Action
END ELEMENT: Actions
START ELEMENT: Reject
END ELEMENT: Reject
START ELEMENT: Requestor
TEXT: Allan D. McEwen
END ELEMENT: Requestor
START ELEMENT: User
TEXT: AMCEWEN
END ELEMENT: User
START ELEMENT: CostCenter
TEXT: S30
END ELEMENT: CostCenter
START ELEMENT: ShippingInstructions
START ELEMENT: name
TEXT: Allan D. McEwen
END ELEMENT: name
START ELEMENT: address
TEXT: Oracle Plaza
Twin Dolphin Drive
Redwood Shores
CA
94065
USA
END ELEMENT: address
START ELEMENT: telephone
TEXT: 650 506 7700
END ELEMENT: telephone
END ELEMENT: ShippingInstructions
START ELEMENT: SpecialInstructions
TEXT: Ground
END ELEMENT: SpecialInstructions
START ELEMENT: LineItems
START ELEMENT: LineItem
START ATTRIBUTE: ItemNumber
ATTR VALUE: 1
END ATTRIBUTE: ItemNumber
START ELEMENT: Description
TEXT: Salesman
END ELEMENT: Description
START ELEMENT: Part
START ATTRIBUTE: Id
ATTR VALUE: 37429158920
END ATTRIBUTE: Id
START ATTRIBUTE: UnitPrice
ATTR VALUE: 39.95
END ATTRIBUTE: UnitPrice
START ATTRIBUTE: Quantity
ATTR VALUE: 2
END ATTRIBUTE: Quantity
END ELEMENT: Part
END ELEMENT: LineItem
<span class="bold">. . .</span>
END ELEMENT: LineItems
END ELEMENT: PurchaseOrder
END DOCUMENT</pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="C-API-for-XMLType.html#GUID-3530DFDE-0125-4A95-9DCA-29BA804F1BA9" title="The C DOM API for XMLType lets you operate on XMLType instances using a DOM in C.">C DOM API for XMLType</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB4981"></a><a id="ADXDB4982"></a><a id="ADXDB4980"></a><div class="props_rev_3"><a id="GUID-687495C3-551B-4786-8A5F-F594985553E2" name="GUID-687495C3-551B-4786-8A5F-F594985553E2"></a><h3 id="ADXDB-GUID-687495C3-551B-4786-8A5F-F594985553E2" class="sect3"><span class="enumeration_section">14.8 </span>Common XMLType Operations in C
               </h3>
               <div>
                  <p>Common XML operations are provided by the C API for XML.</p>
                  <p><a href="C-API-for-XMLType.html#GUID-687495C3-551B-4786-8A5F-F594985553E2__BABGGACF" title="This table describes the C API for XML’s XMLType functions.">Table 14-2</a> provides the <code class="codeph">XMLType</code> functional equivalent of common XML operations.
                  </p>
                  <div class="tblformal" id="GUID-687495C3-551B-4786-8A5F-F594985553E2__BABGGACF">
                     <p class="titleintable">Table 14-2 Common XMLType Operations in C </p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="Common XMLType Operations in C " summary="This table describes the C API for XML’s XMLType functions." width="100%" frame="hsides" border="1" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="44%" id="d76905e1245">Description</th>
                              <th align="left" valign="bottom" width="56%" id="d76905e1248">C API XMLType Function</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="44%" id="d76905e1253" headers="d76905e1245 ">
                                 <p>Create empty <code class="codeph">XMLType</code> instance
                                 </p>
                              </td>
                              <td align="left" valign="top" width="56%" headers="d76905e1253 d76905e1248 ">
                                 <p><code class="codeph">XmlCreateDocument()</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="44%" id="d76905e1264" headers="d76905e1245 ">
                                 <p>Create from a source buffer</p>
                              </td>
                              <td align="left" valign="top" width="56%" headers="d76905e1264 d76905e1248 ">
                                 <p><code class="codeph">XmlLoadDom()</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="44%" id="d76905e1272" headers="d76905e1245 ">
                                 <p>Extract an XPath expression</p>
                              </td>
                              <td align="left" valign="top" width="56%" headers="d76905e1272 d76905e1248 ">
                                 <p><code class="codeph">XmlXPathEvalexpr()</code> and family
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="44%" id="d76905e1281" headers="d76905e1245 ">
                                 <p>Transform using an XSLT stylesheet</p>
                              </td>
                              <td align="left" valign="top" width="56%" headers="d76905e1281 d76905e1248 ">
                                 <p><code class="codeph">XmlXslProcess()</code> and family
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="44%" id="d76905e1290" headers="d76905e1245 ">
                                 <p>Check if an XPath exists</p>
                              </td>
                              <td align="left" valign="top" width="56%" headers="d76905e1290 d76905e1248 ">
                                 <p><code class="codeph">XmlXPathEvalexpr()</code> and family
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="44%" id="d76905e1299" headers="d76905e1245 ">
                                 <p>Is document schema-based?</p>
                              </td>
                              <td align="left" valign="top" width="56%" headers="d76905e1299 d76905e1248 ">
                                 <p><code class="codeph">XmlDomIsSchemaBased()</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="44%" id="d76905e1307" headers="d76905e1245 ">
                                 <p>Get schema information</p>
                              </td>
                              <td align="left" valign="top" width="56%" headers="d76905e1307 d76905e1248 ">
                                 <p><code class="codeph">XmlDomGetSchema()</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="44%" id="d76905e1315" headers="d76905e1245 ">
                                 <p>Get document namespace</p>
                              </td>
                              <td align="left" valign="top" width="56%" headers="d76905e1315 d76905e1248 ">
                                 <p><code class="codeph">XmlDomGetNodeURI()</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="44%" id="d76905e1323" headers="d76905e1245 ">
                                 <p>Validate using schema</p>
                              </td>
                              <td align="left" valign="top" width="56%" headers="d76905e1323 d76905e1248 ">
                                 <p><code class="codeph">XmlSchemaValidate()</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="44%" id="d76905e1331" headers="d76905e1245 ">
                                 <p>Obtain DOM from <code class="codeph">XMLType</code></p>
                              </td>
                              <td align="left" valign="top" width="56%" headers="d76905e1331 d76905e1248 ">
                                 <p>Cast <code class="codeph">(void *)</code> to<code class="codeph"> (xmldocnode *)</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="44%" id="d76905e1345" headers="d76905e1245 ">
                                 <p>Obtain XMLType from DOM</p>
                              </td>
                              <td align="left" valign="top" width="56%" headers="d76905e1345 d76905e1248 ">
                                 <p>Cast <code class="codeph">(xmldocnode *)</code> to <code class="codeph">(void *)</code></p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <div class="infoboxnotealso" id="GUID-687495C3-551B-4786-8A5F-F594985553E2__GUID-4CBD907D-4B95-4991-825E-B520D0F83A24">
                     <p class="notep1">See Also:</p>
                     <p><a href="../adxdk/using-XML-parser-for-C.html#ADXDK1400" target="_blank"><span><cite>Oracle XML Developer's Kit Programmer's Guide</cite></span></a> "XML Parser for C"
                     </p>
                  </div>
                  <p><a href="C-API-for-XMLType.html#GUID-687495C3-551B-4786-8A5F-F594985553E2__CHDBIHJI">Example 14-4</a> shows how to use the DOM to determine how many instances of a particular part have been ordered. The part in question has <code class="codeph">Id</code> <code class="codeph">37429158722</code>. See <a href="oracle-supplied-XML-schemas-and-examples.html#GUID-8FCAD86A-3BF9-4B20-A9EE-8FC46C95C3CE" title="Full listings are provided here for the Oracle XML&nbsp;DB-supplied XML schemas, purchase-order XML schemas and an XSLT stylesheet used in various examples, and C-language (OCI) examples for loading XML content into Oracle XML&nbsp;DB and initializing and terminating an XML context.">Oracle-Supplied XML Schemas and Examples</a>, <a href="oracle-supplied-XML-schemas-and-examples.html#GUID-8CA90A5B-999C-49B6-A2FD-41427C332F17__BABGHJFA">Example A-6</a> for the definitions of helper functions <code class="codeph">exec_bind_xml</code>, <code class="codeph">free_oci_handles</code>, and <code class="codeph">init_oci_handles</code>.
                  </p>
                  <div class="example" id="GUID-687495C3-551B-4786-8A5F-F594985553E2__CHDBIHJI">
                     <p class="titleinexample">Example 14-4 Using the DOM to Count Ordered Parts</p><pre class="oac_no_warn" dir="ltr">#ifndef S_ORACLE
#endif
#ifndef ORATYPES_ORACLE
#include &lt;oratypes.h&gt;
#endif
#ifndef XML_ORACLE
#include &lt;xml.h&gt;
#endif
#ifndef OCIXML_ORACLE
#include &lt;ocixml.h&gt;
#endif
#ifndef OCI_ORACLE
#include &lt;oci.h&gt;
#endif
#include &lt;string.h&gt;
 
typedef struct test_ctx {
        OCIEnv *envhp;
        OCIError *errhp;
        OCISvcCtx *svchp;
        OCIStmt *stmthp;
        OCIServer *srvhp;
        OCIDuration dur;
        OCISession *sesshp;
        oratext *username;
        oratext *password;
} test_ctx;
 
/* Helper function 1: execute a sql statement which binds xml data */
static sword <span class="bold">exec_bind_xml</span>(OCISvcCtx *svchp,
                           OCIError *errhp,
                           OCIStmt *stmthp,
                           void *xml,
                           OCIType *xmltdo,
                           OraText *sqlstmt);
 
/* Helper function 2: Initialize OCI handles and connect */
static sword <span class="bold">init_oci_handles</span>(test_ctx *ctx);
 
/* Helper function 3: Free OCI handles and disconnect */
static sword <span class="bold">free_oci_handles</span>(test_ctx *ctx);
 
void <span class="bold">main</span>()
{
  test_ctx temp_ctx;
  test_ctx *ctx = &amp;temp_ctx;
  OCIType *xmltdo = (OCIType *) 0;
  xmldocnode *doc = (xmldocnode *)0;
  ocixmldbparam params[1];
  xmlnode *quux, *foo, *foo_data, *top;
  xmlerr err;
  sword status = 0;
  xmlctx *xctx;
  ub4 xmlsize = 0;
  OCIDefine *defnp = (OCIDefine *) 0;
  oratext sel_stmt[] = "SELECT SYS_NC_ROWINFO$ FROM PURCHASEORDER";
  xmlnodelist *litems = (xmlnodelist *)0;
  xmlnode *item = (xmlnode *)item;
  xmlnode *part;
  xmlnamedmap *attrs;
  xmlnode *id;
  xmlnode *qty;
  oratext *idval;
  oratext *qtyval;
  ub4 total_qty;
  int i;
  int numdocs;
  
  ctx-&gt;username = (oratext *)"oe";
  ctx-&gt;password = (oratext *)"***********";   /* Replace with real password */

  /* Initialize envhp, svchp, errhp, dur, stmthp */
  init_oci_handles(ctx);
 
  /* Get an xml context */
  params[0].name_ocixmldbparam = XCTXINIT_OCIDUR;
  params[0].value_ocixmldbparam = &amp;ctx-&gt;dur;
  xctx = OCIXmlDbInitXmlCtx(ctx-&gt;envhp, ctx-&gt;svchp, ctx-&gt;errhp, params, 1);
 
  /* Start processing */
  printf("\n\n<span class="bold">Supports XML 1.0? :</span> %s\n",
         XmlHasFeature(xctx, (oratext *) "xml", (oratext *) "1.0") ?
         "YES" : "NO");
 
  /* Get the documents from the database using a select statement */
  status = OCITypeByName(ctx-&gt;envhp, ctx-&gt;errhp, ctx-&gt;svchp, (const text *) "SYS",
                         (ub4) strlen((char *)"SYS"), (const text *) "XMLTYPE",
                         (ub4) strlen((char *)"XMLTYPE"), (CONST text *) 0,
                         (ub4) 0, OCI_DURATION_SESSION, OCI_TYPEGET_HEADER,
                         (OCIType **) &amp;xmltdo);
  status = OCIStmtPrepare(ctx-&gt;stmthp, ctx-&gt;errhp,
                 (CONST OraText *)sel_stmt, (ub4) strlen((char *)sel_stmt),
                 (ub4) OCI_NTV_SYNTAX, (ub4) OCI_DEFAULT);
  status = OCIDefineByPos(ctx-&gt;stmthp, &amp;defnp, ctx-&gt;errhp, (ub4) 1, (dvoid *) 0,
                 (sb4) 0, SQLT_NTY, (dvoid *) 0, (ub2 *)0,
                 (ub2 *)0, (ub4) OCI_DEFAULT);
  status = OCIDefineObject(defnp, ctx-&gt;errhp, (OCIType *) xmltdo,
                  (dvoid **) &amp;doc,
                  &amp;xmlsize, (dvoid **) 0, (ub4 *) 0);
  status = OCIStmtExecute(ctx-&gt;svchp, ctx-&gt;stmthp, ctx-&gt;errhp, (ub4) 0, (ub4) 0,
                 (CONST OCISnapshot*) 0, (OCISnapshot*) 0, (ub4) OCI_DEFAULT);
 
  /* Initialize variables */
  total_qty = 0;
  numdocs = 0; 
 
  /* Loop through all the documents */
  while ((status = OCIStmtFetch2(ctx-&gt;stmthp, ctx-&gt;errhp, (ub4) 1, (ub4) OCI_FETCH_NEXT,
                                 (ub4)1, (ub4) OCI_DEFAULT)) == 0)
  {
    numdocs++;
 
    /* Get all the LineItem elements */
    litems = XmlDomGetDocElemsByTag(xctx, doc, (oratext *)"LineItem");
    i = 0;
 
    /* Loop through all LineItems */
    while (item = XmlDomGetNodeListItem(xctx, litems, i))
    {
      /* Get the part */
      part = XmlDomGetLastChild(xctx, item);
     
      /* Get the attributes */
      attrs = XmlDomGetAttrs(xctx, (xmlelemnode *)part);
 
      /* Get the id attribute and its value */
      id = XmlDomGetNamedItem(xctx, attrs, (oratext *)"Id");
      idval = XmlDomGetNodeValue(xctx, id);
 
      /* Keep only parts with id 37429158722 */
      if (idval &amp;&amp; (strlen((char *)idval) == 11 )
          &amp;&amp; !strncmp((char *)idval, (char *)"37429158722", 11))
      {
        /* Get the quantity attribute and its value.*/
        qty = XmlDomGetNamedItem(xctx, attrs, (oratext *)"Quantity");
        qtyval = XmlDomGetNodeValue(xctx, qty);
 
        /* Add the quantity to total_qty */
        total_qty += atoi((char *)qtyval);
      }
      i++;
    }
    XmlFreeDocument(xctx, doc);
    doc = (xmldocnode *)0;
  }
  printf("<span class="bold">Total quantity needed for part 37429158722 =</span> %d\n", total_qty);
  printf("<span class="bold">Number of documents in table PURCHASEORDER =</span> %d\n", numdocs);
 
  /* Free Xml Ctx */
  OCIXmlDbFreeXmlCtx(xctx);
 
  /* Free envhp, svchp, errhp, stmthp */
  free_oci_handles(ctx);
}
</pre><p>The output from compiling and running this C program is as follows:</p><pre class="oac_no_warn" dir="ltr">Supports XML 1.0? : YES
Total quantity needed for part 37429158722 = 42
Number of documents in table PURCHASEORDER = 132</pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="C-API-for-XMLType.html#GUID-3530DFDE-0125-4A95-9DCA-29BA804F1BA9" title="The C DOM API for XMLType lets you operate on XMLType instances using a DOM in C.">C DOM API for XMLType</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>