<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Update an Employee Record</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="2 Day + Java Developer's Guide ">
      <meta property="og:description" content>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="2 Day + Java Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="2-day-java-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-02-12T07:23:23-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2007, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96442-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="search-employee-id.html" title="Previous" type="text/html">
      <link rel="next" href="best-practices.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="2 Day + Java Developer's Guide">
    <meta name="dcterms.isVersionOf" content="TDPJD">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="search-employee-id.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="best-practices.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">2 Day + Java Developer's Guide </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Update an Employee Record</li>
            </ol>
            <a id="GUID-927C853F-5A00-45CD-9F88-F820B39ABD25" name="GUID-927C853F-5A00-45CD-9F88-F820B39ABD25"></a>
            
            <h2 id="TDPJD-GUID-927C853F-5A00-45CD-9F88-F820B39ABD25" class="sect2"><span class="enumeration_chapter">7 </span>Update an Employee Record
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>The <span class="bold">hradmin</span> has the privilege to update an employee record. The <span class="bold">hrstaff</span> user does not have this privilege. 
               </p>
               <p>First, you must search for an employee in the records. Once you retrieve the information related to the employee, you will find the ‘Edit’ and ‘Delete’options to modify details related to the employee. </p>
               <p>This Chapter shows you the classes that need to be created and code that needs to be added to build ‘Search by Employee ID’ functionality. </p>
               <p>In this Chapter, you will learn how to:</p>
               <p>1. Declare a new new method <span class="italic">getEmployeeByFn(String)</span> in <span class="italic">EmployeeBean.java</span> 
               </p>
               <p>2. Declare a new method <span class="italic">updateEmployee(int)</span> in <span class="italic">EmployeeBean.java</span></p>
               <p>3. Implement a new method <span class="italic">getEmployeeByFn(String) </span>in <span class="italic">EmployeeBeanImpl.java</span></p>
               <p>4. Implement a new method <span class="italic">updateEmployee(int) </span>in <span class="italic">EmployeeBeanImpl.java</span></p>
               <p>5. Add the code to a <span class="italic">WebController.java</span> to process the request and response
               </p>
               <p>6. Create a HTML page (<span class="italic">listByName.html</span>) to display the results
               </p>
               <p></p>
               <p><span class="bold">Class Name:</span></p>
               <p><code class="codeph">src/main/java/com/oracle/jdbc/samples/entity/Employee.java</code></p>
               <p></p>
               <p>Use the <code class="codeph">Employee.java</code> file that you created, earlier in the example.
               </p>
            </div>
            <div class="sect2"><a id="GUID-E8E28FC7-3C53-4CA2-97D2-5D89F164A044" name="GUID-E8E28FC7-3C53-4CA2-97D2-5D89F164A044"></a><h3 id="TDPJD-GUID-E8E28FC7-3C53-4CA2-97D2-5D89F164A044" class="sect3">Declare a new method <span class="italic">getEmployeeByFn(String)</span> in EmployeeBean.java
               </h3>
               <div>
                  <p><span class="bold">Class Name: </span>src/main/java/com/oracle/jdbc/samples/bean/EmployeeBean.java
                  </p>
                  <p><span class="bold">Github Location: </span><a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/java/com/oracle/jdbc/samples/bean/JdbcBean.java" target="_blank">EmployeeBean.java</a></p>
                  <p><span class="bold">Description:</span> The method <code class="codeph">getEmployeeByFn</code><code class="codeph">(String)</code> helps you search employees based on their first name. 
                  </p>
                  <p>To modify details of the employee, the <span class="bold">hradmin</span> must first search for the employee based on his/her first name. 
                  </p>
                  <p>Steps to be performed:</p>
                  <p><span class="bold">Step 1: Declare a method</span> <code class="codeph">getEmployeeByFn(String)</code><code class="codeph"></code></p>
                  <p>Step 1: Instructions for declaring getEmployeeByFn(String) method:</p>
                  <p>1. Use the class EmployeeBean that you created on Day 1 of the exercise. You can add new methods for each of the functionalities. </p>
                  <p>2. Declare a method <code class="codeph">getEmployeeByFn(String)</code> that takes first name as a parameter. 
                  </p>
                  <p><code class="codeph">public List&lt;Employee&gt; getEmployeeByFn(String fn)throws SQLException;</code></p>
               </div>
            </div>
            <div class="sect2"><a id="GUID-B90255F8-6234-458B-B6E7-DB70D01570DF" name="GUID-B90255F8-6234-458B-B6E7-DB70D01570DF"></a><h3 id="TDPJD-GUID-B90255F8-6234-458B-B6E7-DB70D01570DF" class="sect3">Declare a new method <span class="italic">updateEmployee(Employee)</span> 
               </h3>
               <div>
                  <p><span class="bold">Class Name: </span><code class="codeph">src/main/java/com/oracle/jdbc/samples/bean/EmployeeBean.java</code>.
                  </p>
                  <p><span class="bold">Github Location: </span><a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/java/com/oracle/jdbc/samples/bean/JdbcBean.java" target="_blank">EmployeeBean.java</a></p>
                  <p><span class="bold">Description:</span> This method allows you to update attributes of an employee such as first name, last name, salary, job_id etc
                  </p>
                  <p><span class="bold">Steps to be Performed:</span></p>
                  <p><span class="bold">Step 2: Declare a method <span class="italic">updateEmployee(Employee)</span></span> 
                  </p>
                  <p><span class="bold">Instructions for declaring <code class="codeph">updateEmployee(Employee)</code> method</span></p>
                  <p>1. Use the <code class="codeph">EmployeeBean</code> file that you created in the exercise from Day 1 for ‘<code class="codeph">ListAll</code>’ functionality. You can use the same class and add new methods for the new functionalities. 
                  </p>
                  <p>2. Declare a method <code class="codeph">updateEmployee(Employee)</code> that takes Employee object as a parameter. 
                  </p>
                  <p><code class="codeph">public String updateEmployee(Employee employee) throws SQLException;</code></p>
               </div>
            </div>
            <div class="sect2"><a id="GUID-676ED6A0-E20B-4BD3-87FF-0C5859DEF3CE" name="GUID-676ED6A0-E20B-4BD3-87FF-0C5859DEF3CE"></a><h3 id="TDPJD-GUID-676ED6A0-E20B-4BD3-87FF-0C5859DEF3CE" class="sect3">Implement a New Method <code class="codeph">getEmployeebyFn()</code> for Search by Employee name
               </h3>
               <div>
                  <p><span class="bold">Class Name:</span></p>
                  <p><code class="codeph">src/main/java/com/oracle/jdbc/samples/bean/JdbcBeanImpl.java</code></p>
                  <p><span class="bold">Github Location: </span><a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/java/com/oracle/jdbc/samples/bean/JdbcBeanImpl.java" target="_blank">EmployeeBeanImpl.java</a></p>
                  <p>Description: Implement a new method <code class="codeph">getEmployeeByFn(String)</code> to search by employee id. This method uses the employee id as an input parameter and returns an object of type Employee. 
                  </p>
                  <p><span class="bold">Steps to be Performed:</span><span class="bold"></span> Implement a method <code class="codeph">getEmployeeByFn(String)</code></p>
                  <p><span class="bold">Instructions for implementing </span><code class="codeph">getEmployeeByFn(String)</code><span class="bold"> method</span>: 
                  </p>
                  <p>1. Declare <code class="codeph">getEmployeeByFn(String)</code> that returns a an Employee object. 
                  </p>
                  <p><code class="codeph">public List&lt;Employee&gt; getEmployeeByFn(String fn) throws SQLException {</code></p>
                  <p>2. Declare a variable for the return value of type <code class="codeph">List&lt;Employee&gt;</code></p>
                  <p><code class="codeph">List&lt;Employee&gt; returnValue = new ArrayList&lt;&gt;();</code></p>
                  <p>3. Create a <code class="codeph">try</code> block. The <code class="codeph">try</code> block will help you create a database connection by invoking the <code class="codeph">getConnection</code> method. 
                  </p>
                  <p><code class="codeph">try (Connection connection = getConnection()) {</code></p>
                  <p>4. Create another <code class="codeph">try</code> block to create a <code class="codeph">PreparedStatement</code>. Add the query that will be executed to select an employee based on the employee id. 
                  </p>
                  <div class="p"><pre class="pre codeblock"><code>try (PreparedStatement preparedStatement = connection.prepareStatement("SELECT Employee_Id, First_Name, Last_Name, Email, Phone_Number, Job_Id, Salary FROM EMPLOYEES WHERE First_Name LIKE ?")) {
</code></pre>5. Set an input parameter — first name of the employee. The input parameter of the method is set as the IN parameter for the<code class="codeph"> preparedStatement</code>. 
                  </div>
                  <p><code class="codeph">preparedStatement.setString(1, fn + '%');</code></p>
                  <p>6. Create another <code class="codeph">try</code> block for <code class="codeph">ResultSet</code>. Include the query that needs to be executed. 
                  </p>
                  <p><code class="codeph">try (ResultSet resultSet = preparedStatement.executeQuery()) {</code></p>
                  <p>7. Include while statement to loop through the results. If any record is found, add it to the <code class="codeph">returnValue</code>. 
                  </p>
                  <div class="p"><pre class="pre codeblock"><code>while(resultSet.next()) {
    returnValue.add(new Employee(resultSet));
  } 
</code></pre>8. Ensure you close parenthesis for all <code class="codeph">try</code> blocks. 
                  </div>
                  <p>9. Catch the <code class="codeph">SQLException</code> and log the message in the logger. 
                  </p>
                  <div class="p"><pre class="pre codeblock"><code>catch (SQLException ex) {
  logger.log(Level.SEVERE, null, ex);
  throw ex;
}
</code></pre>10. Return the List of employees from the method<code class="codeph"> getEmployee(int) </code></div>
                  <p><code class="codeph">return returnValue; </code></p>
               </div>
            </div>
            <div class="sect2"><a id="GUID-99AB7C3E-B414-484E-ABF8-09FCD3BFA7A3" name="GUID-99AB7C3E-B414-484E-ABF8-09FCD3BFA7A3"></a><h3 id="TDPJD-GUID-99AB7C3E-B414-484E-ABF8-09FCD3BFA7A3" class="sect3">Implement a new method <span class="italic">updateEmployee(Employee)</span></h3>
               <div>
                  <p></p>
                  <p><span class="bold">Class Name: </span>src/main/java/com/oracle/jdbc/samples/bean/EmployeeBeanImpl.java.
                  </p>
                  <p><span class="bold">Github Location: </span><a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/java/com/oracle/jdbc/samples/bean/JdbcBeanImpl.java" target="_blank">EmployeeBeanImpl.java</a></p>
                  <p><span class="bold">Description:</span> The method <code class="codeph">updateEmployee(Employee)</code> enables you to update the employee details such as first_name, last_name etc, in the employee record. 
                  </p>
                  <p><span class="bold">Steps to be performed:</span> <span class="bold">Implement a method</span> <code class="codeph">updateEmployee(Employee)</code></p>
                  <p><span class="bold">Instructions for Implementing <code class="codeph">UpdateEmployee(Employee) </code>method: </span><span class="bold"></span></p>
                  <p>1. Declare method <code class="codeph">updateEmployee(Employee)</code>. 
                  </p>
                  <p><code class="codeph">public String updateEmployee(Employee employee) throws SQLException {</code></p>
                  <p>2. Declare and initialize a variable for capturing the number of records updated. </p>
                  <p><code class="codeph">int updateCount = 0;</code></p>
                  <p>3. Create a <code class="codeph">try</code> block to establish a database connection by invoking the method <code class="codeph">getConnection()</code>. 
                  </p>
                  <p><code class="codeph">try (Connection connection = getConnection()) {</code></p>
                  <p>4. Create another try block to make a <code class="codeph">PreparedStatement</code>. Include the query you will need to execute to select an employee based on the employee id. 
                  </p>
                  <div class="p"><pre class="pre codeblock"><code>try (PreparedStatement preparedStatement = connection.prepareStatement("UPDATE employees SET FIRST_NAME = ?, LAST_NAME = ?, EMAIL = ?, PHONE_NUMBER = ?, SALARY = ? WHERE EMPLOYEE_ID = ?")) {</code></pre>5. Set the new values entered by the user for each attribute and execute the prepapredStatement. </div>
                  <div class="p"><pre class="pre codeblock"><code>preparedStatement.setString(1, employee.getFirst_Name());
preparedStatement.setString(2, employee.getLast_Name());
preparedStatement.setString(3, employee.getEmail());
preparedStatement.setString(4, employee.getPhone_Number());
preparedStatement.setInt(5, employee.getSalary());
   preparedStatement.setInt(6, employee.getEmployee_Id());
updateCount = preparedStatement.executeUpdate();
</code></pre>6. Close parenthesis for all <code class="codeph">try</code> blocks. 
                  </div>
                  <p>7. Catch the SQLException and log the message in the logger as shown below:</p>
                  <div class="p"><pre class="pre codeblock"><code>catch (SQLException ex) {
  logger.log(Level.SEVERE, "Unable to update record", ex);
  throw new SQLException("Alert! Record could not be updated, "
    +ex.getMessage(), ex);}
</code></pre>8. Log the message with the number of records updated to the logger. </div>
                  <p><code class="codeph">logger.fine("Update count: " +updateCount);</code></p>
                  <p>9. If none of the records were updated, enter a message as follows:</p>
                  <div class="p"><pre class="pre codeblock"><code>if (updateCount != 1) {
  logger.severe("Unable to update record");
  throw new SQLException("Alert! Record could not be updated");
}
</code></pre>10. Return the success message if the record was updated.<pre class="pre codeblock"><code>return "Success: Record updated";</code></pre></div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-CA64A30B-0563-4B8A-ADF3-B9E073F69C4E" name="GUID-CA64A30B-0563-4B8A-ADF3-B9E073F69C4E"></a><h3 id="TDPJD-GUID-CA64A30B-0563-4B8A-ADF3-B9E073F69C4E" class="sect3">Add the Code to a Servlet (<span class="italic">WebController.java</span>) 
               </h3>
               <div>
                  <p>This is the start of your topic.</p>
                  <p><span class="bold">Class Name: </span>src/main/java/com/oracle/jdbc/samples/web/WebController.java
                  </p>
                  <p><span class="bold">Github Location:</span> <a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/java/com/oracle/jdbc/samples/web/WebController.java" target="_blank">WebController.java</a></p>
                  <p><span class="bold">Description: </span>You have created the servlet in the Day 1 exercise. In this section, you will add the relevant code to give a salary raise to all employees. 
                  </p>
                  <p><span class="bold">Step 6: </span>Add code to calculate salary budget, after the user enters the input percentage. This is handled in the <code class="codeph">doPost()</code> method. 
                  </p>
                  <p><span class="bold">Instructions to add code to doPost(req, res):</span> 
                  </p>
                  <p>1. You have already created this method in the ‘Update an Employee’ record section. </p>
                  <div class="p">2. Create another <code class="codeph">if</code> block to check the functionality to be invoked based on the input. <pre class="pre codeblock"><code>if ("incrementSalary".equals(value)) {
  if ((value = request.getParameter(INCREMENT_PCT)) != null)   {
       try {
   System.out.println("increment% = " +value);
   response.setContentType("application/json");
List&lt;Employee&gt; employeeList =   employeeBean.incrementSalary(Integer.valueOf(value));
   System.out.println("incrementSalary, employeeList: " +employeeList.toString());
   gson.toJson(employeeList,
new TypeToken&lt;ArrayList&lt;Employee&gt;&gt;(){}.getType(),
response.getWriter());
  }catch (Exception ea) {         response.setStatus(HttpServletResponse.SC_NOT_MODIFIED);
   }
} else {           
response.setStatus(HttpServletResponse.SC_NOT_MODIFIED);
      }
}</code></pre></div>
                  <p>3. Ensure all the parenthesis are closed properly. </p>
               </div>
            </div>
            <div class="sect2"><a id="GUID-B8D371B4-4DF5-401E-9A85-1BA5DD2EC854" name="GUID-B8D371B4-4DF5-401E-9A85-1BA5DD2EC854"></a><h3 id="TDPJD-GUID-B8D371B4-4DF5-401E-9A85-1BA5DD2EC854" class="sect3">Create a new HTML(<span class="italic">incrementSalary.html</span>) 
               </h3>
               <div>
                  <p><span class="bold">Class Name: </span><code class="codeph">src/main/webapp/incrementSalary.html.</code></p>
                  <p><span class="bold">Github Location:</span> <a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/webapp/incrementSalary.html" target="_blank">incrementSalary.html</a></p>
                  <p><span class="bold">Description</span>: This HTML displays an input box to enter the percentage for calculating the salary budget. 
                  </p>
                  <p>Step 7: Create the title, head, and stylesheet for the HTML page</p>
                  <p>Step 8: Create a function to submit the input field i.e, employee first name</p>
                  <p>Step 9: Create a method processResponse() &#x2013; To process the JSON response and show the results on the HTML page</p>
                  <p></p>
                  <p><span class="bold">Step 7: Instructions to create the title, stylesheet, and body of the HTML page: </span></p>
                  <p>1. Create the title, stylesheet, and body of the HTML page.</p>
                  <div class="p"><pre class="pre codeblock"><code>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
&lt;title&gt;Increment Salary&lt;/title&gt;
&lt;link rel="stylesheet" type="text/css" href="css/app.css" &gt;
&lt;link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"&gt;
&lt;script    src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"&gt;script    src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"&gt;&lt;/script&gt;
&lt;/head&gt;</code></pre></div>
                  <p><span class="bold">Step 8: Instructions for Handling the Input Field</span></p>
                  <p>1. Start the &lt;body&gt; tag and a &lt;input&gt; tag for capturing the percentage for salary raise.</p>
                  <div class="p"><pre class="pre codeblock"><code>&lt;body&gt;
&lt;div&gt; Enter the percentage increase in salary&lt;inputid='incrementField' type="number" max="100" min="3"&gt;%
&lt;/div&gt;
&lt;div id="UpdateButton"&gt; &lt;button type="button" class="btn btn-info btn-lg" onclick='javascipt:confirmUpdate()'&gt; Increment Salaries&lt;/button&gt; &lt;button type="button" class="btn btn-default btn-lg" onclick='javascipt:cancelUpdate()'&gt;Cancel&lt;/button&gt;&lt;/div&gt;
&lt;div id="status" class="none"&gt;&lt;/div&gt;
&lt;div id="id-emp"&gt;&lt;/div&gt;
&lt;script&gt;
function showStatus(c, message) {
     $('#status').text(message);
     $('#status').attr('class', c);
       }

function confirmUpdate() {
  var increment = $('#incrementField').val();
  var res = confirm("Do you really want to Increment Salary by " +increment +"%?");
  if(res == true) {
    console.log("Salary record");
    $('#UpdateButton').hide();
    showStatus("alert alert-info", "Updating records, processing request");
    var xmlhttp = new XMLHttpRequest();
    var url = "WebController?op=incrementSalary&amp;incrementPct=" +increment;
    xmlhttp.onreadystatechange = function() {
      if (xmlhttp.readyState == 4 &amp;&amp; xmlhttp.status == 200) {
        processResponse(xmlhttp.responseText);
        showStatus("alert alert-success", "Updating records, successfully updated");
      }
      else {
        showStatus("alert alert-danger", "Updating records, failure, could not update records");
      }
    }
    xmlhttp.open("POST", url, true);
    xmlhttp.send();
    showStatus("alert alert-info", "Updating records, request sent");

  }
  else {
    console.log("Salary not updated");
    showStatus("alert alert-warning", "Updating records, attempt cancelled");

  }
}

&lt;/script&gt;</code></pre></div>
                  <p><span class="bold">Step 9: Instructions to Create <code class="codeph">processResponse()</code> method:</span></p>
                  <p>1. Create the function <code class="codeph">processRequest()</code> to display the JSON results on HTML page. 
                  </p>
                  <div class="p"><pre class="pre codeblock"><code>unction processResponse(response) {
  var arr = JSON.parse(response);
  var i;
  var out = "&lt;table&gt;";
keys = Object.keys(arr[0]);

  // Print headers
  out += "&lt;tr&gt;"
for(i = 0; i &lt; keys.length; ++i) {
    out += "&lt;th&gt;"+keys[i]+"&lt;/th&gt;"
}
out += "&lt;/tr&gt;";

// Print values
for(j = 0; j &lt; arr.length; j++) {
out += "&lt;tr&gt;"
for(i = 0; i &lt; keys.length; ++i) {
out += "&lt;td&gt;"+arr[j][keys[i]]+"&lt;/td&gt;"
}
out += "&lt;/tr&gt;"
}
out += "&lt;/table&gt;";
document.getElementById("id-emp").innerHTML = out;
}
</code></pre></div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-324F8A0C-12F0-4004-96ED-4EE6BCF378C2" name="GUID-324F8A0C-12F0-4004-96ED-4EE6BCF378C2"></a><h3 id="TDPJD-GUID-324F8A0C-12F0-4004-96ED-4EE6BCF378C2" class="sect3"><span class="bold">Creating Login Users in Tomcat</span></h3>
               <div>
                  <p>The HR Web Application will have two users — <code class="codeph">hradmin</code> and <code class="codeph">hrstaff</code>. 
                  </p>
                  <p>After you login on the home scree using your credentials, you will be able to see the landing page, with details of the web application. The hradmin and hrstaff have different privileges and access to different features. </p>
                  <p>This Chapter will show you the required classes that you need to create and how to build the ‘Login’ functionality in Tomcat. </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Create a XML file (<span class="italic">tomcat-users.xml)</span> for login functionality
                        </p>
                     </li>
                     <li>
                        <p>Create a HTML page (<span class="italic">login.html</span>) to login the user 
                        </p>
                     </li>
                     <li>
                        <p>Create a HTML page (<span class="italic">login-failed.html</span>) to display the error message 
                        </p>
                     </li>
                     <li>
                        <p>Create a <span class="italic">web.xml</span> to authenticate the users during login 
                        </p>
                     </li>
                     <li>
                        <p>Create a HTML page (about.html) to show more details about the application</p>
                     </li>
                     <li>
                        <p>Create a landing page (index.html) and define the html pages for redirection</p>
                     </li>
                     <li>Add code to the servlet (<span class="italic">WebController.java</span>) to process logout 
                     </li>
                  </ul>
                  <div class="section">
                     <p class="subhead2" id="GUID-324F8A0C-12F0-4004-96ED-4EE6BCF378C2__GUID-77D6CD12-F0F6-4151-988A-40EA2B34DD5F">Create an XML file (<span class="italic">tomcat-users.xml)</span> for login functionality
                     </p>
                     <p><span class="bold">Class Name: </span><code class="codeph">/java/HRWebApp/tomcat-users.java</code></p>
                     <p><span class="bold">Github Location:</span> <a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/tomcat-users.xml" target="_blank">tomcat-users.xml</a></p>
                     <p><span class="bold">Description:</span> Create an XML file tomcat-users.xml and list down the login users you want to allow access to. Specify both username and password for each one of the users.
                     </p>
                     <p><span class="bold">Step 1: Create a new file tomcat-user.xml</span></p>
                     <p><span class="bold">Instructions for creating tomcat-users.xml:</span> 
                     </p>
                     <p>1. Create the file <code class="codeph">tomcat-users.xml</code>.  Place this file under <code class="codeph">TOMCAT_HOME/conf /tomcat-users.xml</code> 
                     </p>
                     <div class="p"><pre class="pre codeblock"><code>&lt;?xml version='1.0' encoding='utf-8'?&gt; z
&lt;tomcat-users xmlns="http://tomcat.apache.org/xml"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://tomcat.apache.org/xml tomcat-users.xsd" version="1.0"&gt;
&lt;role rolename="manager"/&gt;
&lt;role rolename="staff"/&gt;
&lt;user username="hradmin" password="welcome" roles="manager,staff"/&gt;
&lt;user username="hrstaff" password="welcome" roles="staff"/&gt;
&lt;/tomcat-users&gt;</code></pre></div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-324F8A0C-12F0-4004-96ED-4EE6BCF378C2__GUID-4B2A6D9C-2C13-4BAE-B6FC-2E29D29D44C9">Create a new HTML (<span class="italic">login.html</span>) 
                     </p>
                     <p><span class="bold">Class Name: </span>src/main/webapp/login.html
                     </p>
                     <p><span class="bold">Github Location:</span> <a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/webapp/login.html" target="_blank">login.html</a></p>
                     <p><span class="bold">Description:</span> The login page is displayed when you invoke the main page of the web application. The login page shows up fields to capture username and password. 
                     </p>
                     <p>Step 2: Create the title, head, and stylesheet for <span class="italic">login.html</span></p>
                     <p>Step 3: Create the &lt;body&gt; to capture input fields and submit the form</p>
                     <p></p>
                     <p><span class="bold">Step 2: Instructions to create title, head and stylesheet for </span><code class="codeph">login.html:</code></p>
                     <p>1. Create the file <code class="codeph">tomcat-users.xml</code>. Place this file <code class="codeph">TOMCAT_HOME/conf/tomcat-users.xml</code>. 
                     </p>
                     <div class="p"><pre class="pre codeblock"><code>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
&lt;title&gt;Login to Jdbc Web Sample application&lt;/title&gt;
&lt;link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"&gt;
&lt;style&gt;
#cent {
    position:absolute;
    top:50%;
    left:50%;
    margin-top:-50px; /* this is half the height of your div*/
    margin-left:-100px; /*this is half of width of your div*/
  }
   td {
     height: 30px;
   }

&lt;/style&gt;
&lt;/head&gt;</code></pre></div>
                     <p><span class="bold">Step 3: Instructions to Create the &lt;body&gt; and submit the form: </span></p>
                     <p>1. Create the &lt;body&gt; and &lt;form&gt; to submit the login credentials entered by the user. </p>
                     <div class="p"><pre class="pre codeblock"><code>&lt;body&gt;
&lt;div id="cent"&gt;
&lt;form method="POST" action="j_security_check"&gt;
&lt;table&gt;
&lt;tr&gt;
&lt;td colspan="2"&gt;Login to the Jdbc Web Sample application:&lt;/td&gt;
&lt;/tr&gt;
&lt;td&gt;Name:&lt;/td&gt;
&lt;td&gt;&lt;input type="text" name="j_username" /&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Password:&lt;/td&gt;
&lt;td&gt;&lt;input type="password" name="j_password"/&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td colspan="2"&gt;&lt;input type="submit" value="Go" /&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;
&lt;/form&gt;
&lt;/div&gt;
&lt;/body&gt;</code></pre></div>
                     <p></p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-324F8A0C-12F0-4004-96ED-4EE6BCF378C2__GUID-095142DF-F5DE-4217-A70A-14105CEFD126">Create a new HTML (<span class="italic">login-failed.html</span>) 
                     </p>
                     <p><span class="bold">Class Name: </span>src/main/webapp/login-failed.html
                     </p>
                     <p><span class="bold">Github Location:</span><a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/webapp/login-failed.html" target="_blank"> login-failed.html</a></p>
                     <p><span class="bold">Description: </span>This the html page that will be displayed if the login is unsuccessful. 
                     </p>
                     <p><span class="bold">Step 4: Create the new page <span class="italic">login-failed.html </span>to show a message during unsuccessful login attempts</span></p>
                     <p><span class="bold">Instructions to Create a new HTML page</span> <code class="codeph">login-failed.html</code>. 
                     </p>
                     <p>1. Create the <code class="codeph">login-failed.html</code> as shown below.
                     </p>
                     <div class="p"><pre class="pre codeblock"><code>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
&lt;title&gt;Login Failed&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;p&gt;
Sorry, login failed!
&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre></div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-324F8A0C-12F0-4004-96ED-4EE6BCF378C2__GUID-47C99078-0C28-4D5F-913F-E481B0EF3FE7">Create a <span class="italic">web.xml</span> to authenticate the users during login
                     </p>
                     <p><span class="bold">Class Name: </span><code class="codeph">src/main/webapp/WEB-INF/web.xml</code></p>
                     <p><span class="bold">Github Location:</span><a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/webapp/WEB-INF/web.xml" target="_blank"> web.xml</a></p>
                     <p><span class="bold">Description: </span>The web.xml file consists of descriptors to authenticate the users when the login page is shows to the user. 
                     </p>
                     <p><span class="bold">Steps:</span> Create the file web.xml as shown below. 
                     </p>
                     <p><span class="bold">Instructions for creating</span> <code class="codeph">web.xml</code></p>
                     <p>1. Use the following steps to create the web.xml file: </p>
                     <div class="p"><pre class="pre codeblock"><code>&lt;!DOCTYPE web-app PUBLIC
 "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
 "http://java.sun.com/dtd/web-app_2_3.dtd"&gt;
&lt;web-app&gt;
&lt;display-name&gt;Jdbc Web Sample&lt;/display-name&gt;
&lt;security-role&gt;
&lt;role-name&gt;manager&lt;/role-name&gt;
&lt;/security-role&gt;
&lt;security-role&gt;
&lt;role-name&gt;staff&lt;/role-name&gt;
&lt;/security-role&gt;
&lt;security-constraint&gt;
&lt;web-resource-collection&gt;
&lt;web-resource-name&gt;Wildcard means whole app requires 
authentication&lt;/web-resource-name&gt;
&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;http-method&gt;GET&lt;/http-method&gt;
&lt;http-method&gt;POST&lt;/http-method&gt;
&lt;/web-resource-collection&gt;
&lt;auth-constraint&gt;
&lt;role-name&gt;manager&lt;/role-name&gt;
&lt;/auth-constraint&gt;
&lt;user-data-constraint&gt;
&lt;transport-guarantee&gt;NONE&lt;/transport-guarantee&gt;
&lt;/user-data-constraint&gt;
&lt;/security-constraint&gt;
&lt;security-constraint&gt;
&lt;web-resource-collection&gt;
&lt;web-resource-name&gt;Wildcard means whole app requires 
authentication&lt;/web-resource-name&gt;
&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;http-method&gt;GET&lt;/http-method&gt;
&lt;/web-resource-collection&gt;
&lt;auth-constraint&gt;
&lt;role-name&gt;staff&lt;/role-name&gt;
&lt;/auth-constraint&gt;
&lt;user-data-constraint&gt;
&lt;transport-guarantee&gt;NONE&lt;/transport-guarantee&gt;
&lt;/user-data-constraint&gt;
  &lt;/security-constraint&gt;
&lt;login-config&gt;
&lt;auth-method&gt;FORM&lt;/auth-method&gt;
&lt;form-login-config&gt;
&lt;form-login-page&gt;/login.html&lt;/form-login-page&gt;
&lt;form-error-page&gt;/login-failed.html&lt;/form-error-page&gt;
&lt;/form-login-config&gt;
&lt;/login-config&gt;
&lt;/web-app&gt;</code></pre></div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-324F8A0C-12F0-4004-96ED-4EE6BCF378C2__GUID-02696127-4327-4AC2-9E74-717A941759F0">Create a HTML page <span class="italic">(about.html)</span> to describe the web application
                     </p>
                     <p><span class="bold">Class Name: </span><code class="codeph">src/main/webapp/about.html</code></p>
                     <p><span class="bold">Github Location:</span> <a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/webapp/about.html" target="_blank">about.html</a></p>
                     <p><span class="bold">Description: </span>The <code class="codeph">about.html</code> file displays information about the HR Application, users and functionalities. 
                     </p>
                     <p>Step 6: Download the <a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/webapp/about.html" target="_blank">about.html</a> and use it in your application.
                     </p>
                     <p></p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-324F8A0C-12F0-4004-96ED-4EE6BCF378C2__GUID-1F3C523C-3EC1-49E7-8F41-EC9035E3D048">Create a landing page (index.html) and define the pages for redirection</p>
                     <p><span class="bold">Class Name: </span><code class="codeph">src/main/webapp/index.html</code></p>
                     <p><span class="bold">Github Location: </span><a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/webapp/index.html" target="_blank">index.html</a></p>
                     <p><span class="bold">Description: </span>The index.html file consists of all details about the HR Web Application. It describes in detail its users and functionalities. 
                     </p>
                     <p>Step 7: Create the title, head, and stylesheet for <span class="italic">index.html</span></p>
                     <p>Step 8: Create the <code class="codeph">&lt;body&gt; </code>to invoke the html pages for redirecting the requests
                     </p>
                     <p></p>
                     <p><span class="bold">7. Instructions to Create title, head and stylesheet for </span>index.html: 
                     </p>
                     <p>1. Create the index.html file. </p>
                     <div class="p"><pre class="pre codeblock"><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="utf-8"&gt;
&lt;title&gt;Employee table listing&lt;/title&gt;
&lt;link rel="stylesheet" type="text/css" href="css/app.css" &gt;
&lt;style&gt;
iframe:focus {
outline: none;
}
iframe[seamless] {
display: block;
}
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;</code></pre></div>
                     <p><span class="bold">Step 8: Instructions to Create &lt;body&gt;, redirection, and actions for buttons: </span></p>
                     <p></p>1. Create <code class="codeph">&lt;body&gt;</code> and actions for the features through navigation links and logout. <pre class="pre codeblock"><code>&lt;body&gt;
&lt;div id="sideNav" class="sidenav"&gt;

&lt;a href="javascript:void(0)" class="closebtn" onclick="closeNav()" class="staff"&gt;×&lt;/a&gt;
&lt;a href="javascript:switchSrc('listAll.html')" class="staff"&gt;List All&lt;/a&gt;
&lt;a href="javascript:switchSrc('listById.html')" class="staff"&gt;Search By Id&lt;/a&gt;

&lt;a href="javascript:switchSrc('listByName.html')" class="manager"&gt;Update Employee Record&lt;/a&gt;
&lt;a href="javascript:switchSrc('incrementSalary.html')" class="manager"&gt;Increment Salary&lt;/a&gt;
&lt;a href="javascript:switchSrc('about.html')"&gt;About&lt;/a&gt;
&lt;/div&gt;
&lt;div id="main"&gt;
&lt;div align="right"&gt;
&lt;div
id="myrole"
        style="display:inline; color:#393318; display: block; background-color:#eff0f1;position: absolute; top: 20px; right: 8%;"
    &gt;myrole&lt;/div&gt;
&lt;a href="javascript:void(0)"
       onclick="logout()"
       class="staff"
       style="display: block; position: absolute; top: 20px; right: 1%"&gt;Logout&lt;/a&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;span style="font-size:30px;cursor:pointer" onclick="openNav()"&gt; Java 2 Days HR Web Application		&lt;/span&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;iframe id="content"
src="about.html"
frameborder="0"
style="overflow:hidden; height:100%; width:100%"
height="100%"
width="100%"&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;script&gt;
function openNav() {
  document.getElementById("sideNav").style.width = "256px";
  document.getElementById("main").style.marginLeft = "256px";
}

function closeNav() {
  document.getElementById("sideNav").style.width = "0";
  document.getElementById("main").style.marginLeft= "0";
}

function switchSrc(src) {
  document.getElementById('content').src = src;
}

function logout() {

  var xmllogout = new XMLHttpRequest();
  xmllogout.open("GET", "WebController?logout=true", true, "_", "_");
  xmllogout.withCredentials = true;
  // Invlalid credentials to fake logout
  xmllogout.setRequestHeader("Authorization", "Basic 00001");
  xmllogout.send();

  xmllogout.onreadystatechange = function() {
    window.location.replace("index.html");
  }

 return true;
}

var xmlhttp = new XMLHttpRequest();
var url = "getrole";

xmlhttp.onreadystatechange = function() {
  if (xmlhttp.readyState == 4 &amp;&amp; xmlhttp.status == 200) {
    role = xmlhttp.responseText;
    console.log("role: " +role);
    if (role == "staff") {
      console.log ("disabling manager");
      var x = document.getElementsByClassName('manager');
      for(i = 0; i &lt; x.length; ++i) {
        x[i].style.display = 'none';
      }
    }
    document.getElementById('myrole').innerHTML = ' '+role+' ';
  }
}
xmlhttp.open("GET", url, true);
xmlhttp.send();
&lt;/script&gt;
&lt;/body&gt;</code></pre><p></p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-324F8A0C-12F0-4004-96ED-4EE6BCF378C2__GUID-65A885B7-0FAC-4872-B929-E232DA654CF0">Add code to the servlet (<span class="italic">WebController.java</span>) to process logout 
                     </p>
                     <p><span class="bold">Class Name: </span><code class="codeph">src/main/java/com/oracle/jdbc/samples/web/WebController.java</code></p>
                     <p><span class="bold">Github Location:</span> <a href="https://github.com/oracle/oracle-db-examples/blob/master/java/HRWebApp/src/main/java/com/oracle/jdbc/samples/web/WebController.java" target="_blank">WebController.java</a></p>
                     <p><span class="bold">Description:</span> You have created this servlet in the Day 1 exercise. In this step, you will add relevant code to implement logout and login. 
                     </p>
                     <p><span class="bold">Step 9</span><span class="bold">: Update the method </span><code class="codeph">processRequest(req, res)</code><span class="bold"><span class="italic"> </span>for log out functionality<span class="italic"> </span></span></p>
                     <p><span class="bold">Instructions to Update the Method</span> <code class="codeph">processRequest (req, res):</code></p>
                     <p>1. You have created a method in the “ListAll” feature in the earlier steps. In this step, you will add code for the <code class="codeph">logout</code> functionality. 
                     </p>
                     <p>2. Create an <code class="codeph">if</code> block to verify the functionality you will invoke based on input. Check if the input valuie is ‘<code class="codeph">LOGOUT</code>’. Then, invoke the relevant method to log out the user.
                     </p>
                     <div class="p"><pre class="pre codeblock"><code>if ((value = request.getParameter(LOGOUT)) != null) {
/* Getting session and then invalidating it */

 HttpSession session = request.getSession(false);
if (request.isRequestedSessionIdValid() &amp;&amp; session != null)   {
  session.invalidate();
}
handleLogOutResponse(request,response);
   response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);
return;
} 

private void handleLogOutResponse(HttpServletRequest request,
HttpServletResponse response) {
    Cookie[] cookies = request.getCookies();
    for (Cookie cookie : cookies) {
      cookie.setMaxAge(0);
      cookie.setValue(null);
      cookie.setPath("/");
      response.addCookie(cookie);

    }
  }
</code></pre>3. Verify that all parenthesis are closed properly. </div> 
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>