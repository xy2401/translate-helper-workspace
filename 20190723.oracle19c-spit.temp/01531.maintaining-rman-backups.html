<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Maintaining RMAN Backups and Repository&nbsp;Records</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Backup and Recovery User's Guide">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Backup and Recovery User's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96241-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="reporting-rman-operations.html" title="Previous" type="text/html">
      <link rel="next" href="managing-recovery-catalog.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User's Guide">
    <meta name="dcterms.isVersionOf" content="BRADV">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="reporting-rman-operations.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="managing-recovery-catalog.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Backup and Recovery User's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-managing-rman-backups.html" property="item" typeof="WebPage"><span property="name"> Managing RMAN Backups </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Maintaining RMAN Backups and Repository&nbsp;Records</li>
            </ol>
            <a id="GUID-F5C3D045-279B-4AB3-8A91-3231A716402C" name="GUID-F5C3D045-279B-4AB3-8A91-3231A716402C"></a><a id="BRADV8007"></a>
            
            <h2 id="BRADV-GUID-F5C3D045-279B-4AB3-8A91-3231A716402C" class="sect2"><span class="enumeration_chapter">12 </span> Maintaining RMAN Backups and Repository&nbsp;Records
            </h2>
         </header>
         <div class="ind">
            <div>
               <p><a id="d58406e69" class="indexterm-anchor"></a><a id="d58406e73" class="indexterm-anchor"></a><a id="d58406e75" class="indexterm-anchor"></a><a id="d58406e77" class="indexterm-anchor"></a>This chapter describes how to manage the RMAN repository records, and RMAN backups and copies. This chapter also explains maintenance tasks related to the fast recovery area. This chapter contains the following topics:
               </p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="maintaining-rman-backups.html#GUID-9B20BEFF-DE04-481C-8A50-46902B3B8B5F" title="The recommended maintenance strategy is to configure a fast recovery area, a backup retention policy, and an archived redo log deletion policy. In this case, the database automatically maintains and deletes backups and archived redo logs as needed. However, manual maintenance of database backups and archived redo logs is sometimes necessary.RMAN provides multiple commands to maintain RMAN backups and repository records.RMAN always stores its metadata in the control file of each target database on which it performs operations. If you register a target database in the recovery catalog, then RMAN stores the metadata for this target database in the recovery catalog. The database in a Data Guard environment that creates a backup or copy is associated with the file. For example, if RMAN is connected to target database standby1 and backs it up, then this backup is associated with standby1.For a crosscheck, RMAN can only update the status of a file from AVAILABLE to EXPIRED when connected to the database associated with the file. RMAN can delete files when connected to any database. If RMAN is not connected as TARGET to the database associated with a file, and if RMAN cannot delete a file successfully, then RMAN prompts you to connect as TARGET to the database associated with the file. You must then use DELETE ... FORCE to delete the file metadata.If a maintenance command changes RMAN metadata only, then you can connect RMAN as TARGET to any database in the Data Guard environment. A backup remains associated with a database unless you explicitly use the CHANGE ... RESET DB_UNIQUE_NAME to associate the backup with a different database.">Overview of RMAN Backup and Repository Maintenance</a></p>
                  </li>
                  <li>
                     <p><a href="maintaining-rman-backups.html#GUID-7DEB9336-5398-4CAE-8418-09285E363CD5" title="RMAN is designed to work without a recovery catalog. If you choose not to use a recovery catalog, however, then the control file of each target database is the exclusive repository for RMAN metadata.">Maintaining the Control File Repository</a></p>
                  </li>
                  <li>
                     <p><a href="maintaining-rman-backups.html#GUID-A60E5493-8988-40E5-9E70-36AE6A0DFD69" title="Although the fast recovery area is largely self-managing, some situations may require database administration intervention.">Maintaining the Fast Recovery Area</a></p>
                  </li>
                  <li>
                     <p><a href="maintaining-rman-backups.html#GUID-93AE3A35-4B8C-424A-A5D4-CE14E160738C" title="Several situations can cause a discrepancy between the repository and the files that it records, including tape or disk failures and user-managed copies or deletions of RMAN-related files.">Updating the RMAN Repository</a></p>
                  </li>
                  <li>
                     <p><a href="maintaining-rman-backups.html#GUID-8C4B395D-7C24-485F-BEA0-A355821FB93D" title="You can use the RMAN DELETE command to delete archived redo logs and RMAN backups.">Deleting RMAN Backups and Archived Redo Logs</a></p>
                  </li>
                  <li>
                     <p><a href="maintaining-rman-backups.html#GUID-45EFE02D-488C-4F55-A648-6FFF5CB7A32F" title="To remove a database from the operating system, you can use the DROP DATABASE command in RMAN. RMAN removes the server parameter file, all data files, online redo logs, and control files belonging to the target database.">Dropping a Database</a></p>
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-F5C3D045-279B-4AB3-8A91-3231A716402C__GUID-AC9CD89C-7FF4-486D-9B25-0E0265166ACD">
                  <p class="notep1">See Also:</p>
                  <p><a href="managing-recovery-catalog.html#GUID-E836E243-6620-495B-ACFB-AC0001EF4E89" title="This section explains the basic concepts related to managing a recovery catalog.A recovery catalog is a database schema used by RMAN to store metadata about one or more Oracle databases. Typically, you store the catalog in a dedicated database.The recovery catalog contains metadata about RMAN operations for each registered target database. When RMAN is connected to a recovery catalog, RMAN obtains its metadata exclusively from the catalog.The process of enrolling of a database in a recovery catalog for RMAN use is called registration.The owner of a centralized recovery catalog, which is also called the base recovery catalog, can grant or revoke restricted access to the catalog to other database users. For RMAN operations such as backup, restore, and crosscheck, RMAN always first updates the control file and then propagates the metadata to the recovery catalog. This flow of metadata from the mounted control file to the recovery catalog, which is known as recovery catalog resynchronization, ensures that the metadata that RMAN obtains from the control file is current.You can use a stored script as an alternative to a command file for managing frequently used sequences of RMAN commands. The script is stored in the recovery catalog rather than on the file system.You must use a recovery catalog to manage RMAN metadata for all physical databases, both primary and standby databases, in the Data Guard environment. RMAN uses the recovery catalog as the single source of truth for the Data Guard environment.Managing a recovery catalog consists of creating the catalog and then registering your target databases with the catalog.Creating a recovery catalog consists of multiple phases that includes configuring the recovery catalog database, creating the recovery catalog schema owner, and then creating the catalog. When you use a recovery catalog, RMAN requires that you maintain a recovery catalog schema. The recovery catalog is stored in the default tablespace of the schema. Privileged users such as SYS cannot be the owner of the recovery catalog.You must allocate space to be used by the catalog schema. The size of the recovery catalog schema depends upon the number of databases monitored by the catalog. If you are creating your recovery catalog in an existing database, then add enough room to hold the default tablespace for the recovery catalog schema. After choosing the recovery catalog database and creating the necessary space, you are ready to create the owner of the recovery catalog and grant this user necessary privileges. After creating the catalog owner, create the catalog tables with the RMAN CREATE CATALOG command. The command creates the catalog in the default tablespace of the catalog owner.Registering a target database in the recovery catalog maintains the database’s records in the recovery catalog.The process of enrolling of a target database in a recovery catalog is called registration.In a Data Guard environment, the primary and standby databases share the same DBID and database name. To be eligible for registration in the recovery catalog, each database in the Data Guard environment must have different DB_UNIQUE_NAME values.The first step in using a recovery catalog with a target database is registering the target database in the recovery catalog. If you use the catalog in a Data Guard environment, then you can only register the primary database in this way.If you have data file copies, backup pieces, or archived logs on disk, then you can catalog them in the recovery catalog with the CATALOG command. When using a recovery catalog, cataloging older backups that have aged out of the control file lets RMAN use the older backups during restore operations. RMAN provides multiple commands to create and manage virtual private catalogs.RMAN uses the Virtual Private Database (VPD) functionality to implement virtual private catalogs. Creating a virtual private catalog is a multi-step process in which you first create the database user who will own the virtual private catalog and then create the virtual private catalog.To store backup metadata for a target database in a virtual private catalog, you must register the database with the virtual private catalog.After you create a virtual private catalog, you can revoke catalog access privileges as necessary.This section describes how to use the UPGRADE CATALOG command to upgrade a virtual private catalog.Include the recovery catalog database in your backup and recovery strategy. If you do not back up the recovery catalog and a disk failure occurs that destroys the recovery catalog database, then you may lose the metadata in the catalog. Without the recovery catalog contents, recovery of your other databases is likely to be more difficult.A single recovery catalog can store metadata for multiple target databases. Consequently, loss of the recovery catalog can be disastrous. You must back up the recovery catalog frequently.The recovery catalog database is a database like any other, and is also a key part of your backup and recovery strategy. Protect the recovery catalog like any other part of your database, by backing it up. The backup strategy for your recovery catalog database is part of an overall backup and recovery strategy.When backing up the recovery catalog database, you can use RMAN to make the backups. A recovery catalog is only effective when separated from the data that it is designed to protect. Thus, you must never store a recovery catalog containing the RMAN repository for a database in the same database as the target database. Also, do not store the catalog database on the same disks as the target database.Logical backups of the RMAN recovery catalog created with the Data Pump Export utility can be a useful supplement for physical backups. Restoring and recovering the recovery catalog database is much like restoring and recovering any other database with RMAN. You can create and store scripts in the recovery catalog. You can use a stored script as an alternative to a command file for managing frequently used sequences of RMAN commands. The script is stored in the recovery catalog rather than on the file system.You can use the CREATE SCRIPT command to create a stored script. To update stored scripts, use the REPLACE SCRIPT command. Use the EXECUTE SCRIPT command to run a stored script. You can specify substitution variables in the CREATE SCRIPT command.The PRINT SCRIPT command displays a stored script or writes it out to a file. Use the LIST ... SCRIPT NAMES command to display the names of scripts defined in the recovery catalog. Use the DELETE GLOBAL SCRIPT command to delete a stored script from the recovery catalog.To run the RMAN client and start a stored script in the recovery catalog on startup, use the SCRIPT argument when starting the RMAN client.Maintaining the recovery catalog consists of tasks such as resynchronizing, updating, and upgrading the recovery catalog.After you have created a recovery catalog and registered your target databases, you must maintain this catalog.When RMAN performs a resynchronization, it compares the recovery catalog to either the current or backup control file of the target database and updates the catalog with metadata that is missing or changed. Resynchronization of the recovery catalog ensures that the metadata that RMAN obtains from the control file stays current. Resynchronizations can be full or partial. RMAN only automatically resynchronizes the recovery catalog with a database when connected to this database as TARGET. Thus, RMAN does not automatically resynchronize every database in a Data Guard environment when connected as TARGET to one database in the environment.RMAN automatically resynchronizes the recovery catalog when RMAN is connected to a target database and recovery catalog and you have executed RMAN commands. If the recovery catalog is unavailable when you issue RMAN commands that cause a partial resynchronization, then open the catalog database later and resynchronize it manually with the RESYNC CATALOG command. You can create or change an RMAN configuration for a standby database even when not connected to this database as TARGET. Your goal is to ensure that the metadata in the recovery catalog is current. Because the recovery catalog obtains its metadata from the target control file, the currency of the data in the catalog depends on the currency of the data in the control file. You must make sure that the backup metadata in the control file is recorded in the catalog before it is overwritten with new records.Use RESYNC CATALOG to force a full resynchronization of the recovery catalog with a target database control file. You may decide to change the DB_UNIQUE_NAME of a database in a Data Guard environment. In this case, you can run the CHANGE DB_UNIQUE_NAME command to associate the metadata stored in recovery catalog for the old DB_UNIQUE_NAME to the new DB_UNIQUE_NAME.You can use the UNREGISTER DATABASE command to unregister a database from the recovery catalog. Use the UNREGISTER DATABASE command to unregister a target database.The UNREGISTER command supports a DB_UNIQUE_NAME clause for use in a Data Guard environment. You can use this clause to remove metadata for a specific database.In a Zero Data Loss Recovery Appliance (Recovery Appliance) environment, the UNREGISTER DATABASE command cannot be used to unregister a protected database from the Recovery Appliance catalog. Instead, use the DBMS_RA.DELETE_DB procedure.You create an incarnation of the database when you open the database with the RESETLOGS option. You can access a record of the new incarnation in the V$DATABASE_INCARNATION view.This section explains what a recovery catalog upgrade is and when you must do it.If you are upgrading to Oracle Database 12c Release 1 (12.1.0.2) or later, then the recovery catalog database must use the Enterprise Edition of Oracle Database.Assume that you upgrade the recovery catalog schema to Oracle Database 11g or later in a Data Guard environment. When RMAN connects to a standby database, it automatically registers the new database information and resynchronizes to obtain the file names from the control file.The schema version of the recovery catalog is stored in the recovery catalog itself. The information is important in case you maintain multiple databases of different versions in your production system, and you must determine whether the catalog schema version is usable with a specific target database version.This scenario assumes that you are upgrading a recovery catalog schema to the current version. You can use the IMPORT CATALOG command in RMAN to merge one recovery catalog schema into another. When using IMPORT CATALOG, the source catalog schema is the catalog schema to import into a different schema. The destination catalog schema is the catalog schema into which you intend to import the source catalog schema.In a Recovery Appliance environment, a single, centrally-managed Recovery Appliance catalog residing on the Recovery Appliance is shared by all the protected databases. This catalog must be used by all protected databases that send backups to Recovery Appliance.A target database, recovery catalog database, and recovery catalog schema can be at different database versions. The recommended practice is to import all existing recovery catalogs into a single recovery catalog at the latest version of the recovery catalog schema. When importing one recovery catalog into another, no connection to a target database is necessary. RMAN only needs connectivity to the source and destination catalogs.The procedure for moving a recovery catalog from one database to another is a variation of the procedure for importing a catalog. The DROP CATALOG command removes those objects that were created by the CREATE CATALOG command. If the user who owns the recovery catalog also owns objects that were not created by CREATE CATALOG, then the DROP CATALOG command does not remove these objects.">	 Managing a Recovery Catalog</a> for RMAN maintenance issues that are specific to a <a href="glossary.html#GUID-CBFA8015-2DFF-42B1-A818-D6C5B92C608F"><span class="xrefglossterm">recovery catalog</span></a></p>
               </div>
            </div><a id="BRADV89607"></a><div class="props_rev_3"><a id="GUID-9B20BEFF-DE04-481C-8A50-46902B3B8B5F" name="GUID-9B20BEFF-DE04-481C-8A50-46902B3B8B5F"></a><h3 id="BRADV-GUID-9B20BEFF-DE04-481C-8A50-46902B3B8B5F" class="sect3"><span class="enumeration_section">12.1 </span>Overview of RMAN Backup and Repository Maintenance
               </h3>
               <div>
                  <p>This section explains the purpose and basic concepts of RMAN repository maintenance.</p>
               </div><a id="BRADV89608"></a><div class="props_rev_3"><a id="GUID-B6224394-4309-4225-BECF-20A8E7155368" name="GUID-B6224394-4309-4225-BECF-20A8E7155368"></a><h4 id="BRADV-GUID-B6224394-4309-4225-BECF-20A8E7155368" class="sect4"><span class="enumeration_section">12.1.1 </span>Purpose of Backup and Repository Maintenance
                  </h4>
                  <div>
                     <p>The recommended maintenance strategy is to configure a fast recovery area, a backup retention policy, and an archived redo log deletion policy. In this case, the database automatically maintains and deletes backups and archived redo logs as needed. However, manual maintenance of database backups and archived redo logs is sometimes necessary.</p>
                     <p>Managing RMAN backups involves the following related tasks:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Managing the database backups that are stored on disk or tape</p>
                        </li>
                        <li>
                           <p>Managing the records of those backups in the RMAN repository</p>
                        </li>
                     </ul>
                     <p>An important part of RMAN maintenance is deleting backups that are no longer needed. If you configure a fast recovery area, then the database automatically deletes unneeded files in this area automatically; even so, you may want to delete backups and copies from tape. You may even need to delete an entire database. You can use an RMAN command to perform these tasks.</p>
                     <p>The fast recovery area may require occasional maintenance. For example, the fast recovery area may become full, in which case you can add space to it. Alternatively, you may want to change the location of the recovery area.</p>
                     <p>It is possible for the <a href="glossary.html#GUID-F5643EDD-CE1B-4A9F-9E6E-ADDFD6452341"><span class="xrefglossterm">RMAN repository</span></a> to fail to reflect the true state of files on disk or tape. For example, a user may delete a backup from disk with an operating system utility. In this case, the RMAN repository shows that the file exists when it does not. In a similar situation, a tape containing RMAN backups may be corrupted. You can use <a href="glossary.html#GUID-F89B6EF7-3067-45B0-A45C-DE5247E0C326"><span class="xrefglossterm">RMAN maintenance commands</span></a> to update the repository with accurate information.
                     </p>
                  </div>
               </div><a id="BRADV990"></a><div class="props_rev_3"><a id="GUID-E5BBAAFE-1191-4A96-A63A-91EDF87F7C3E" name="GUID-E5BBAAFE-1191-4A96-A63A-91EDF87F7C3E"></a><h4 id="BRADV-GUID-E5BBAAFE-1191-4A96-A63A-91EDF87F7C3E" class="sect4"><span class="enumeration_section">12.1.2 </span>Basic Concepts of Backup and Repository Maintenance
                  </h4>
                  <div>
                     <p>RMAN provides multiple commands to maintain RMAN backups and repository records.</p>
                     <p>Following are the RMAN maintenance commands:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The <a href="../rcmrf/CATALOG.html#RCMRF109" target="_blank"><code class="codeph">CATALOG</code></a> command enables you to add records about RMAN and user-managed backups that are currently not recorded in the RMAN repository, or to remove records for backups that are recorded.
                           </p>
                        </li>
                        <li>
                           <p>The <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF110" target="_blank"><code class="codeph">CHANGE</code></a> command enables you to update the status of records in the RMAN repository.
                           </p>
                        </li>
                        <li>
                           <p>The <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF119" target="_blank"><code class="codeph">CROSSCHECK</code></a> command enables you to synchronize the logical backup records with the physical reality of files in backup storage.
                           </p>
                        </li>
                        <li>
                           <p>The <a href="../rcmrf/DELETE.html#RCMRF121" target="_blank"><code class="codeph">DELETE</code></a> command enables you to delete backups from the operating system.
                           </p>
                        </li>
                     </ul>
                  </div><a id="BRADV90061"></a><div class="props_rev_3"><a id="GUID-E67EC11B-BEB9-40F4-AEC7-F97574960EE0" name="GUID-E67EC11B-BEB9-40F4-AEC7-F97574960EE0"></a><h5 id="BRADV-GUID-E67EC11B-BEB9-40F4-AEC7-F97574960EE0" class="sect5"><span class="enumeration_section">12.1.2.1 </span>About Maintenance Commands and RMAN Repository Metadata
                     </h5>
                     <div>
                        <p>RMAN always stores its metadata in the control file of each target database on which it performs operations. If you register a target database in the recovery catalog, then RMAN stores the metadata for this target database in the recovery catalog. </p>
                        <p>All of the RMAN maintenance commands work with or without a recovery catalog.</p>
                        <div class="infoboxnotealso" id="GUID-E67EC11B-BEB9-40F4-AEC7-F97574960EE0__GUID-9978B34B-B665-4F3D-B23B-52F0FBF6F47D">
                           <p class="notep1">See Also:</p>
                           <p><a href="managing-recovery-catalog.html#GUID-5FC1C46A-748D-4DAF-9EF4-62781ACBE319" title="Maintaining the recovery catalog consists of tasks such as resynchronizing, updating, and upgrading the recovery catalog.">Maintaining a Recovery Catalog</a></p>
                        </div>
                     </div>
                  </div><a id="BRADV90062"></a><div class="props_rev_3"><a id="GUID-F0C0A8F9-CBDF-4EDE-BAAF-F93CC37638B1" name="GUID-F0C0A8F9-CBDF-4EDE-BAAF-F93CC37638B1"></a><h5 id="BRADV-GUID-F0C0A8F9-CBDF-4EDE-BAAF-F93CC37638B1" class="sect5"><span class="enumeration_section">12.1.2.2 </span>About Maintenance Commands in a Data Guard Environment
                     </h5>
                     <div>
                        <p>The database in a Data Guard environment that creates a backup or copy is associated with the file. For example, if RMAN is connected to target database <code class="codeph">standby1</code> and backs it up, then this backup is associated with <code class="codeph">standby1</code>.
                        </p>
                        <p>If backups are accessible to RMAN according to the criteria specified in <span class="q">"<a href="rman-architecture.html#GUID-E514F9D2-D96E-4087-B8C5-5A8EB6A44E6B" title="RMAN uses a recovery catalog to track file names for all database files in a Data Guard environment.">About RMAN File Management in a Data Guard Environment</a>"</span>, you can use RMAN maintenance commands such as <code class="codeph">CHANGE</code>, <code class="codeph">DELETE</code>, and <code class="codeph">CROSSCHECK</code> for backups when connected to any primary or standby database. 
                        </p>
                     </div><a id="BRADV99968"></a><div class="props_rev_3"><a id="GUID-2792BBD5-2FD4-435B-85A3-0916D8EF6EC6" name="GUID-2792BBD5-2FD4-435B-85A3-0916D8EF6EC6"></a><h6 id="BRADV-GUID-2792BBD5-2FD4-435B-85A3-0916D8EF6EC6" class="sect6"><span class="enumeration_section">12.1.2.2.1 </span>About Crosschecks in a Data Guard Environment
                        </h6>
                        <div>
                           <p>For a crosscheck, RMAN can only update the status of a file from <code class="codeph">AVAILABLE</code> to <code class="codeph">EXPIRED</code> when connected to the database associated with the file. 
                           </p>
                           <p>Thus, if RMAN crosschecks a file and does not find it, and if the file is associated with a database to which it is not connected as <code class="codeph">TARGET</code>, then RMAN prompts you to perform the crosscheck when connected to the target database associated with the file. RMAN performs a crosscheck when you run the <code class="codeph">CROSSCHECK</code> or <code class="codeph">CHANGE ... AVAILABLE</code> command.
                           </p>
                        </div>
                     </div><a id="BRADV99969"></a><div class="props_rev_3"><a id="GUID-99A84A87-1B70-46E0-934C-320BBE230C33" name="GUID-99A84A87-1B70-46E0-934C-320BBE230C33"></a><h6 id="BRADV-GUID-99A84A87-1B70-46E0-934C-320BBE230C33" class="sect6"><span class="enumeration_section">12.1.2.2.2 </span>About Deletion in a Data Guard Environment
                        </h6>
                        <p>RMAN can delete files when connected to any database. If RMAN is not connected as <code class="codeph">TARGET</code> to the database associated with a file, and if RMAN cannot delete a file successfully, then RMAN prompts you to connect as <code class="codeph">TARGET</code> to the database associated with the file. You must then use <code class="codeph">DELETE ... FORCE</code> to delete the file metadata.
                        </p>
                     </div><a id="BRADV99970"></a><div class="props_rev_3"><a id="GUID-41D4B085-7D27-4D12-937B-5CB2BB039312" name="GUID-41D4B085-7D27-4D12-937B-5CB2BB039312"></a><h6 id="BRADV-GUID-41D4B085-7D27-4D12-937B-5CB2BB039312" class="sect6"><span class="enumeration_section">12.1.2.2.3 </span>About Updates to RMAN Metadata in a Data Guard Environment
                        </h6>
                        <div>
                           <p>If a maintenance command changes RMAN metadata only, then you can connect RMAN as <code class="codeph">TARGET</code> to any database in the Data Guard environment. 
                           </p>
                           <p>Commands that change only metadata include:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">CHANGE ... UNAVAILABLE</code> or <code class="codeph">CHANGE ... UNCATALOG</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">CHANGE ... KEEP</code> or <code class="codeph">CHANGE ... NOKEEP</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">CHANGE ... RESET DB_UNIQUE_NAME</code></p>
                              </li>
                           </ul>
                           <p>By default, the <code class="codeph">CHANGE</code> command only operates on files that are accessible according to the rules specified in <span class="q">"<a href="rman-architecture.html#GUID-4176237B-67BE-4C87-A4B8-7AF2E0E6035E" title="The accessibility of a backup is different from its association. In a Data Guard environment, the recovery catalog considers disk backups as accessible only to the database with which they are associated, whereas tape backups created on one database are accessible to all databases.">About Accessibility of Backups in a Data Guard Environment</a>"</span>. However, you can change the status of files associated with a database other than the target database by using the <code class="codeph">FOR DB_UNIQUE_NAME</code> option.
                           </p>
                        </div>
                     </div><a id="BRADV99971"></a><div class="props_rev_3"><a id="GUID-C64AF73E-8824-4F60-B6AC-D05133691B7E" name="GUID-C64AF73E-8824-4F60-B6AC-D05133691B7E"></a><h6 id="BRADV-GUID-C64AF73E-8824-4F60-B6AC-D05133691B7E" class="sect6"><span class="enumeration_section">12.1.2.2.4 </span>About Files Not Associated with a Database
                        </h6>
                        <div>
                           <p> A backup remains associated with a database unless you explicitly use the <code class="codeph">CHANGE ... RESET DB_UNIQUE_NAME</code> to associate the backup with a different database.
                           </p>
                           <p>In some cases the <code class="codeph">DB_UNIQUE_NAME</code> may not be known for a specific file. For example, the value of <code class="codeph">DB_UNIQUE_NAME</code> is <code class="codeph">null</code> when the database name is not known to the recovery catalog, as for Oracle9<span class="italic">i</span> databases that are registered in a recovery catalog. Also, rows can have a <code class="codeph">DB_UNIQUE_NAME</code> of <code class="codeph">null</code> because a database has been upgraded to the current version, but the recovery catalog schema has not reconciled the <code class="codeph">DB_UNIQUE_NAME</code> values for all files. By default, RMAN associates files whose <code class="codeph">SITE_KEY</code> is <code class="codeph">null</code> with the database to which RMAN is connected as <code class="codeph">TARGET</code>.
                           </p>
                           <div class="infoboxnotealso" id="GUID-C64AF73E-8824-4F60-B6AC-D05133691B7E__GUID-8A3138A8-C360-4F1F-B1E6-D45105CC2D25">
                              <p class="notep1">See Also:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><a href="../sbydb/using-RMAN-in-oracle-data-guard-configurations.html#SBYDB04700" target="_blank"><span><cite>Oracle Data Guard Concepts and Administration</cite></span></a> to learn how to use RMAN to back up and restore files in a Data Guard environment
                                    </p>
                                 </li>
                                 <li>
                                    <p><a href="../rcmrf/CHANGE.html#RCMRF110" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> for a description of the RMAN <code class="codeph">CHANGE</code> command
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV8602"></a><div class="props_rev_3"><a id="GUID-7DEB9336-5398-4CAE-8418-09285E363CD5" name="GUID-7DEB9336-5398-4CAE-8418-09285E363CD5"></a><h3 id="BRADV-GUID-7DEB9336-5398-4CAE-8418-09285E363CD5" class="sect3"><span class="enumeration_section">12.2 </span>Maintaining the Control File Repository
               </h3>
               <div>
                  <p>RMAN is designed to work without a recovery catalog. If you choose not to use a recovery catalog, however, then the control file of each target database is the exclusive repository for RMAN metadata.</p>
                  <p>You must know how information is stored in the control file and ensure that your backup and recovery strategy protects the control file.</p>
                  <div class="infoboxnotealso" id="GUID-7DEB9336-5398-4CAE-8418-09285E363CD5__GUID-1FE55C6B-1A1D-4168-8680-AC2B703B8C32">
                     <p class="notep1">See Also:</p>
                     <p><a href="../admin/managing-control-files.html#ADMIN006" target="_blank"><span><cite>Oracle Database Administrator’s Guide</cite></span></a> for an overview of the control file and more details about managing control files
                     </p>
                  </div>
               </div><a id="BRADV89609"></a><div class="props_rev_3"><a id="GUID-3588948E-87A2-42BD-931B-F62BEC9C7EC9" name="GUID-3588948E-87A2-42BD-931B-F62BEC9C7EC9"></a><h4 id="BRADV-GUID-3588948E-87A2-42BD-931B-F62BEC9C7EC9" class="sect4"><span class="enumeration_section">12.2.1 </span>About Control File Records
                  </h4>
                  <div>
                     <p>The control file contains two types of records: circular reuse records and noncircular reuse records.</p>
                     <p>Circular reuse records contain noncritical information that is eligible to be overwritten if needed. These records contain information that is continually generated by the database. When all available record slots are full, the database either expands the control file to make room for a new record or overwrites the oldest record. The <code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code> initialization parameter specifies the minimum age in days of a record before it can be reused.
                     </p>
                     <p>Noncircular reuse records contain critical information that does not change often and cannot be overwritten. Some examples of information in noncircular reuse records include data files, online redo log files, and redo threads.</p>
                     <p>As you make backups of a target database, the database records these backups in the control file. To prevent the control file from growing too large because of the addition of new records, records can be reused if they are older than a threshold that you specify. The <code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code> initialization parameter determines the minimum age in days of a record before it can be overwritten:
                     </p><pre class="pre codeblock"><code>CONTROL_FILE_RECORD_KEEP_TIME = <span class="italic">integer</span>
</code></pre><p>For example, if the parameter value is <code class="codeph">14</code>, then any record of age 14 days or older is a candidate for reuse. Information in an overwritten record is lost. The oldest record available for reuse is used first.
                     </p>
                     <p>When the database must add new RMAN repository records to the control file, but no record is older than the threshold, the database attempts to expand the size of the control file. If the underlying operating system prevents the expansion of the control file (due to a disk full condition, for instance), then the database overwrites the oldest record in the control file. </p>
                     <p>The database records the overwrite in the alert log located in the <a href="glossary.html#GUID-BDCE90D1-13B7-4D2C-A761-1583A238A247"><span class="xrefglossterm">Automatic Diagnostic Repository (ADR)</span></a>. For each record that it overwrites, the database records an entry in the alert log similar to the following:
                     </p><pre class="pre codeblock"><code>kccwnc: following control file record written over:  
RECID #72 Recno 72 Record timestamp  
07/28/06 22:15:21  
Thread=1 Seq#=3460  
Backup set key: stamp=372031415, count=17  
Low scn: 0x0000.3af33f36  
07/27/06 21:00:08  
Next scn: 0x0000.3af3871b  
07/27/06 23:23:54
Resetlogs scn and time  
scn: 0x0000.00000001</code></pre></div><a id="BRADV89610"></a><div class="props_rev_3"><a id="GUID-B6C169D5-C93F-40E2-AF15-A17A9E1CB873" name="GUID-B6C169D5-C93F-40E2-AF15-A17A9E1CB873"></a><h5 id="BRADV-GUID-B6C169D5-C93F-40E2-AF15-A17A9E1CB873" class="sect5"><span class="enumeration_section">12.2.1.1 </span>About Fast Recovery Area and Control File Records
                     </h5>
                     <div>
                        <p>When a control file record containing information about a file created in the fast recovery area is about to be reused, the database attempts to delete the file from the fast recovery area when the file is eligible for deletion. Otherwise, the database expands the size of the control file section containing the record for this file.</p>
                        <p>The database logs the expansion in the alert log with a message like this example, where <span class="italic"><code class="codeph">nnnn</code></span> is the number of the control file record type:
                        </p><pre class="pre codeblock"><code>kccwnc: trying to expand control file section <span class="italic">nnnn</span> for Oracle Managed Files
</code></pre><p>If the control file is at the maximum size supported under the host operating system, then the database cannot expand the control file. In such a situation, this warning appears in the alert log:</p><pre class="pre codeblock"><code>WARNING: Oracle Managed File filename is unknown to control file. This is the result of limitation in control file size that could not keep all recovery area files. 
</code></pre><p>The preceding message means that the control file cannot hold a record of all fast recovery area files needed to satisfy the configured retention policy. The next section explains how to respond to this situation.</p>
                        <div class="infoboxnotealso" id="GUID-B6C169D5-C93F-40E2-AF15-A17A9E1CB873__GUID-5026AC33-190D-47A1-AE11-F870F71E353E">
                           <p class="notep1">See Also:</p>
                           <p><a href="../refrn/CONTROL_FILE_RECORD_KEEP_TIME.html#REFRN10020" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> for information about the <code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code> initialization parameter
                           </p>
                        </div>
                     </div>
                  </div>
               </div><a id="BRADV8206"></a><div class="props_rev_3"><a id="GUID-1DE96E35-27A3-42DE-BF96-89AE66FD7D2A" name="GUID-1DE96E35-27A3-42DE-BF96-89AE66FD7D2A"></a><h4 id="BRADV-GUID-1DE96E35-27A3-42DE-BF96-89AE66FD7D2A" class="sect4"><span class="enumeration_section">12.2.2 </span>Preventing the Loss of Control File Records
                  </h4>
                  <div>
                     <p>The best way to prevent the loss of RMAN metadata because of overwritten control file records is to use a recovery catalog.</p>
                     <div class="section">
                        <p>If you cannot use a recovery catalog, then you can take the following measures:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Set the <code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code> value to slightly longer than the oldest file that you must keep. For example, if you back up the whole database once a week, then you must keep every backup for at least 7 days. Set <code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code> to a value such as <code class="codeph">10</code> or <code class="codeph">14</code>. The default value of <code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code> is 7 days.
                              </p>
                              <div class="infoboxnote" id="GUID-1DE96E35-27A3-42DE-BF96-89AE66FD7D2A__GUID-5B47F210-6F43-4385-AD05-448A3CBF612E">
                                 <p class="notep1">Caution:</p>
                                 <p>Regardless of whether you use a recovery catalog, never use RMAN when <code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code> is set to 0. If you do, then you may lose backup records.
                                 </p>
                              </div>
                           </li>
                           <li>
                              <p>Store the control file in a file system rather than on a <a href="glossary.html#GUID-D6545038-B176-4D0E-9B4B-E4187A063984"><span class="xrefglossterm">raw device</span></a> so that it can expand.
                              </p>
                           </li>
                           <li>
                              <p>Monitor the alert log to ensure that Oracle Database is not overwriting control file records. The alert log is located in the <a href="glossary.html#GUID-BDCE90D1-13B7-4D2C-A761-1583A238A247"><span class="xrefglossterm">Automatic Diagnostic Repository (ADR)</span></a>.
                              </p>
                           </li>
                        </ul>
                        <p>If you use a fast recovery area, then follow these guidelines to avoid a situation in which the control file cannot hold a record of all fast recovery area files needed to satisfy the backup retention policy:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>If the block size of the control file is not at its maximum, then use a larger block size, preferably 32 kilobytes.</p>
                              <p>To achieve this aim, you must set the <code class="codeph">SYSTEM</code> tablespace block size to be greater than or equal to the control file block size, and re-create the control file after changing <code class="codeph">DB_BLOCK_SIZE</code>. The files in the fast recovery area are recataloged, but the records for files on tape are lost.
                              </p>
                           </li>
                           <li>
                              <p>Make the files in the fast recovery area eligible for deletion by backing them up to tertiary storage such as tape. </p>
                              <p>For example, you can use <code class="codeph">BACKUP RECOVERY AREA</code> to specifically back up files in the fast recovery area to a media manager.
                              </p>
                           </li>
                           <li>
                              <p>If the backup retention policy is keeping backups and archived logs longer than your business requirements, then you can make more files in the fast recovery area eligible for deletion by changing the retention policy to a shorter recovery window or lower degree of redundancy. </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV284"></a><a id="BRADV89611"></a><div class="props_rev_3"><a id="GUID-9490431E-F205-4ABD-81D8-993A9F3A9EF7" name="GUID-9490431E-F205-4ABD-81D8-993A9F3A9EF7"></a><h4 id="BRADV-GUID-9490431E-F205-4ABD-81D8-993A9F3A9EF7" class="sect4"><span class="enumeration_section">12.2.3 </span>Protecting the Control File
                  </h4>
                  <div>
                     <p>If you are not using a recovery catalog to store RMAN metadata, then it is doubly important that you protect each target database control file.</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-9490431E-F205-4ABD-81D8-993A9F3A9EF7__GUID-71B051E7-46D9-4DD3-B4FD-E83B9642152A">To protect the control file:</p>
                        <p>You can use the following strategy to protect the control file.</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Create redundant copies of control files through <a href="glossary.html#GUID-635043F8-78E2-4B43-A3C4-E27AFEAF363C"><span class="xrefglossterm">multiplexing</span></a> or operating system <a href="glossary.html#GUID-305BF676-5718-47C7-9902-A6E3A200A0DF"><span class="xrefglossterm">mirroring</span></a>.</span><div>
                              <p>In this way, the database can survive the loss of a subset of the control files without requiring you to restore a control file from backup. Oracle recommends that you use a minimum of two multiplexed or mirrored control files on separate disks.</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Configure the <a href="glossary.html#GUID-7CDA6567-DFB0-450D-8771-B033E9872AF7"><span class="xrefglossterm">control file autobackup</span></a> feature. </span><div>
                              <p>In this case, RMAN automatically backs up the control file when you run certain RMAN commands. If a control file autobackup is available, RMAN can restore the server parameter and backup control file, and mount the database. After the control file is mounted, you can restore the remainder of the database.</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Keep a record of the database DBID.</span><div>
                              <p>If you lose the control files, then you can use the DBID to recover the database.</p>
                           </div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-9490431E-F205-4ABD-81D8-993A9F3A9EF7__GUID-CB330F9E-F3F9-4799-B786-55F42E4E840C">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="backing-up-database.html#GUID-D25F0A92-12AE-490E-AB8F-C9E54E081CDD" title="You can back up the control file when the database is mounted or open. RMAN uses a snapshot control file to ensure a read-consistent version.">Backing Up Control Files with RMAN</a> to learn about manual and automatic control file backups
                                 </p>
                              </li>
                              <li>
                                 <p><a href="rman-backup-concepts.html#GUID-95840C84-1595-49AC-923D-310DA750676B" title="Having recent backups of your control file and server parameter file is extremely valuable in many recovery situations. To ensure that you have backups of these files, the database supports control file and server parameter file autobackups.">About RMAN Control File and Server Parameter File Autobackups</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV89612"></a><div class="props_rev_3"><a id="GUID-A60E5493-8988-40E5-9E70-36AE6A0DFD69" name="GUID-A60E5493-8988-40E5-9E70-36AE6A0DFD69"></a><h3 id="BRADV-GUID-A60E5493-8988-40E5-9E70-36AE6A0DFD69" class="sect3"><span class="enumeration_section">12.3 </span>Maintaining the Fast Recovery Area
               </h3>
               <p>Although the fast recovery area is largely self-managing, some situations may require database administration intervention.</p><a id="BRADV89613"></a><div class="props_rev_3"><a id="GUID-2D7B9EF4-C306-4377-82F2-DDE3549FB63C" name="GUID-2D7B9EF4-C306-4377-82F2-DDE3549FB63C"></a><h4 id="BRADV-GUID-2D7B9EF4-C306-4377-82F2-DDE3549FB63C" class="sect4"><span class="enumeration_section">12.3.1 </span>Deletion Rules for the Fast Recovery Area
                  </h4>
                  <div>
                     <p>RMAN uses certain rules to determine when files can be deleted from the fast recovery area.</p>
                     <p>The following rules govern when files become eligible for deletion from the recovery area:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Permanent files are never eligible for deletion.</p>
                        </li>
                        <li>
                           <p>Files that are obsolete under the retention policy are eligible for deletion.</p>
                        </li>
                        <li>
                           <p>Transient files that have been copied to tape are eligible for deletion. </p>
                        </li>
                        <li>
                           <p>Archived redo logs are not eligible for deletion until all the consumers of the logs have satisfied their requirements.</p>
                           <p>Consumers of logs can include RMAN, standby databases, and the Flashback Database feature.</p>
                        </li>
                        <li>
                           <p>Foreign archived logs that have been mined by a LogMiner session on a logical standby database are eligible for deletion. Because it is generated from a different database than the current database, a <a href="glossary.html#GUID-E2428029-4C01-4DFF-8C08-028EF57CF8C7"><span class="xrefglossterm">foreign archived redo log</span></a> has a different DBID than the current archived redo logs.
                           </p>
                        </li>
                     </ul>
                     <p>The safe and reliable way to control deletion of files from the fast recovery area is to configure your retention policy and archived log deletion policy. To increase the likelihood that files moved to tape are retained on disk, increase the fast recovery area quota.</p>
                     <div class="infoboxnotealso" id="GUID-2D7B9EF4-C306-4377-82F2-DDE3549FB63C__GUID-21407E1D-E1B9-4863-B75F-FFD43881CFA6">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="q">"<a href="configuring-rman-client-basic.html#GUID-061CCF1D-2C8D-4460-B469-9C32893A590A" title="The fast recovery area can contain control files, online redo logs, archived redo logs, flashback logs, and RMAN backups.">Overview of Files in the Fast Recovery Area</a>"</span> for information about the contents of the fast recovery area and the difference between permanent and transient files
                              </p>
                           </li>
                           <li>
                              <p><span class="q">"<a href="configuring-rman-client-basic.html#GUID-FA142760-8ACB-43DA-939C-8407618D2D0F" title="You can use RMAN to create a persistent configuration that governs when archived redo logs are eligible for deletion from disk.">Configuring an Archived Redo Log Deletion Policy</a>"</span> for information about how to configure an archived redo log deletion policy that determines when logs are eligible to be deleted 
                              </p>
                           </li>
                           <li>
                              <p><a href="configuring-rman-client-basic.html#GUID-03DE4CF6-9D9F-4806-B5CA-CAA4CF5F2133" title="The backup retention policy specifies which backups must be retained to meet your data recovery requirements.">Configuring the Backup Retention Policy</a> for information about how to configure the retention policy
                              </p>
                           </li>
                           <li>
                              <p><a href="../sbydb/using-RMAN-in-oracle-data-guard-configurations.html#SBYDB04700" target="_blank"><span><cite>Oracle Data Guard Concepts and Administration</cite></span></a> to learn about archived redo log management in a Data Guard environment
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="BRADV285"></a><a id="BRADV89614"></a><div class="props_rev_3"><a id="GUID-86350744-262F-4C51-81F6-410712D08FEC" name="GUID-86350744-262F-4C51-81F6-410712D08FEC"></a><h4 id="BRADV-GUID-86350744-262F-4C51-81F6-410712D08FEC" class="sect4"><span class="enumeration_section">12.3.2 </span>Monitoring Fast Recovery Area Space Usage
                  </h4>
                  <div>
                     <p>You can use the <code class="codeph">V$RECOVERY_FILE_DEST</code> and <code class="codeph">V$RECOVERY_AREA_USAGE</code> views to determine whether you have allocated enough space for your fast recovery area.
                     </p>
                     <div class="section">
                        <p>Query the <code class="codeph">V$RECOVERY_FILE_DEST</code> view to discover the current location, disk quota, space in use, space reclaimable by deleting files, and total number of files in the fast recovery area. The space columns specify the amount in bytes. Query the <code class="codeph">V$RECOVERY_AREA_USAGE</code> view to discover the percentage of the total disk quota used by different types of files. Also, you can determine how much space for each type of file can be reclaimed by deleting files that are obsolete, redundant, or backed up to tape.
                        </p>
                        <p>When guaranteed restore points are defined on your database, you must monitor the amount of space used in your fast recovery area for files required to meet the guarantee. Use the query for viewing guaranteed restore points in <span class="q">"<a href="using-flasback-database-restore-points.html#GUID-1A583D44-66CB-4D21-B170-2A07CFF6EE65" title="You can use the V$RESTORE_POINT control file view to obtain information about all currently-defined restore points (normal and guaranteed), including CDB restore points and PDB restore points.">Listing Restore Points Using the V$RESTORE_POINT View</a>"</span> and see the <code class="codeph">STORAGE_SIZE</code> column to determine the space required for files related to each guaranteed restore point.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-86350744-262F-4C51-81F6-410712D08FEC__CHDJIBFG">
                        <p class="titleinexample">Example 12-1 Fast Recovery Area Space Consumption</p>
                        <p>The following example displays details about the fast recovery area such as the location, disk quota, space usage, and number of files.</p><pre class="pre codeblock"><code>SELECT * FROM V$RECOVERY_FILE_DEST;

NAME          SPACE_LIMIT SPACE_USED SPACE_RECLAIMABLE NUMBER_OF_FILES  CON_ID
------------  ----------- ---------- ----------------- ---------------  ------
/mydisk/rcva   5368709120 109240320             256000              28       0
</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-86350744-262F-4C51-81F6-410712D08FEC__GUID-438D91B3-155D-467D-93B0-2365C5241B37">
                        <p class="titleinexample">Example 12-2 Fast Recovery Area Space Usage Based on Type of Files</p>
                        <p>The following example displays the percentage of space used, percentage of space that can be reclaimed, and number of files in the fast recovery area for each type of file.</p><pre class="pre codeblock"><code>SELECT * FROM V$RECOVERY_AREA_USAGE;

FILE_TYPE    PERCENT_SPACE_USED PERCENT_SPACE_RECLAIMABLE NUMBER_OF_FILES  CON_ID
------------ ------------------ ------------------------- ---------------  ------
CONTROLFILE                   0                         0               0       0
ONLINELOG                     2                         0              22       0
ARCHIVELOG                 4.05                      2.01              31       0
BACKUPPIECE                3.94                      3.86               8       0
IMAGECOPY                 15.64                     10.43              66       0
FLASHBACKLOG                .08                         0               1       0
</code></pre><div class="infoboxnotealso" id="GUID-86350744-262F-4C51-81F6-410712D08FEC__GUID-2A44A4C5-F348-46B0-AB95-06F9A090583D">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">V$RECOVERY_AREA_USAGE</code> in <a href="../refrn/V-RECOVERY_FILE_DEST.html#REFRN30304" target="_blank"><span><cite>Oracle Database Reference</cite></span></a></p>
                              </li>
                              <li>
                                 <p><code class="codeph">V$RECOVERY_FILE_DEST</code> in <a href="../refrn/V-RECOVERY_AREA_USAGE.html#REFRN30377" target="_blank"><span><cite>Oracle Database Reference</cite></span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="example" -->
                  </div>
               </div><a id="BRADV89615"></a><div class="props_rev_3"><a id="GUID-26C1A1E8-5555-4399-9DD1-39BA90E45A0C" name="GUID-26C1A1E8-5555-4399-9DD1-39BA90E45A0C"></a><h4 id="BRADV-GUID-26C1A1E8-5555-4399-9DD1-39BA90E45A0C" class="sect4"><span class="enumeration_section">12.3.3 </span>Managing Space for Flashback Logs in the Fast Recovery Area
                  </h4>
                  <div>
                     <p>You cannot manage the flashback logs in the fast recovery area directly other than by setting the flashback retention target or using guaranteed restore points.</p>
                     <div class="section">
                        <p>Nevertheless, you can manage fast recovery area space as a whole to maximize the space available for retention of flashback logs. In this way you increase the likelihood of achieving the flashback target.</p>
                        <p>To make space for flashback logs, back up the other contents of your fast recovery area to tape with commands such as <code class="codeph">BACKUP</code> <code class="codeph">RECOVERY</code> <code class="codeph">AREA</code>, <code class="codeph">BACKUP</code> <code class="codeph">BACKUPSET</code>, and so on. Oracle Database automatically removes obsolete files from the fast recovery area. If offloading backups to tape still does not create enough space to satisfy the backup retention policy and flashback retention target, then allocate more space in the fast recovery area.
                        </p>
                        <p>Starting with Oracle Database Release 19c, the management of space in the fast recovery area is simplified. Oracle Database monitors flashback logs in the fast recovery area and automatically deletes flashback logs that are beyond the retention period. When the retention target is reduced, flashback logs that are beyond the retention period are deleted immediately. </p>
                        <p>The <code class="codeph">COMPATIBLE</code> initialization parameter must be set to 19.0.0 or higher for flashback logs to be automatically deleted. 
                        </p>
                        <p>In scenarios where a sudden workload spike causes a large number of flashback logs to be created, the workload is monitored for a few days before deleting flashback logs that are beyond the retention period. This avoids the overhead of recreating the flashback logs, if another peak workload occurs soon after.</p>
                        <div class="infoboxnote" id="GUID-26C1A1E8-5555-4399-9DD1-39BA90E45A0C__GUID-DAD66707-ECBD-423A-90F1-2C04480202A5">
                           <p class="notep1">Note:</p>
                           <p>You cannot back up flashback logs. Thus, the <code class="codeph">BACKUP</code> <code class="codeph">RECOVERY</code> <code class="codeph">AREA</code> operation does not include the flashback logs when backing up the fast recovery area contents to tape.
                           </p>
                        </div>
                        <div class="infoboxnotealso" id="GUID-26C1A1E8-5555-4399-9DD1-39BA90E45A0C__GUID-8CA85899-9F57-477F-802D-3E30E61FDB95">
                           <p class="notep1">See Also:</p>
                           <p><a href="using-flasback-database-restore-points.html#GUID-502D1646-2A81-4F04-BC3A-1927298A8F8D" title="If you enable Flashback Database and define one or more guaranteed restore points, then the database performs normal flashback logging.">About Logging for Flashback Database with Guaranteed Restore Points Defined</a> for the rules for flashback log deletion
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV89616"></a><div class="props_rev_3"><a id="GUID-3F11ECB5-1321-45F5-A557-BB1A5BAF011F" name="GUID-3F11ECB5-1321-45F5-A557-BB1A5BAF011F"></a><h4 id="BRADV-GUID-3F11ECB5-1321-45F5-A557-BB1A5BAF011F" class="sect4"><span class="enumeration_section">12.3.4 </span>Responding to a Full Fast Recovery Area
                  </h4>
                  <div>
                     <p>If the RMAN retention policy requires keeping a set of backups larger than the fast recovery area disk quota, or if the retention policy is set to <code class="codeph">NONE</code>, then the fast recovery area can fill completely with no reclaimable space.
                     </p>
                     <div class="section">
                        <p>The database issues a warning alert when reclaimable space is less than 15% and a critical alert when reclaimable space is less than 3%. To warn the DBA of this condition, an entry is added to the alert log and to the <code class="codeph">DBA_OUTSTANDING_ALERTS</code> table (used by Enterprise Manager). Nevertheless, the database continues to consume space in the fast recovery area until there is no reclaimable space left.
                        </p>
                        <p>When the recovery area is completely full, the error displayed is as follows, where <span class="italic">nnnnn</span> is the number of bytes required and <span class="italic">mmmmm</span> is the disk quota:
                        </p><pre class="oac_no_warn" dir="ltr">ORA-19809: limit exceeded for recovery files
ORA-19804: cannot reclaim <span class="italic">nnnnn</span> bytes disk space from <span class="italic">mmmmm</span> limit
</pre><p>You have several choices for how to resolve a full fast recovery area when no files are eligible for deletion:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Make more disk space available and increase <code class="codeph">DB_RECOVERY_FILE_DEST_SIZE</code> to reflect the additional space.
                              </p>
                           </li>
                           <li>
                              <p>Move backups from the fast recovery area to tertiary storage such as tape. </p>
                              <p>One convenient way to back up all of your recovery area files to tape together is the <code class="codeph">BACKUP</code> <code class="codeph">RECOVERY</code> <code class="codeph">AREA</code> command. After you transfer backups from the recovery area to tape, you can delete files from the fast recovery area. Flashback logs cannot be backed up outside the recovery area and are not backed up by <code class="codeph">BACKUP</code> <code class="codeph">RECOVERY</code> <code class="codeph">AREA</code>.
                              </p>
                           </li>
                           <li>
                              <p>Run <code class="codeph">DELETE</code> for any files that have been removed with an operating system utility.
                              </p>
                              <p>If you use host operating system commands to delete files, then the database is not aware of the resulting free space. You can run the RMAN <code class="codeph">CROSSCHECK</code> command to have RMAN recheck the contents of the fast recovery area and identify expired files, and then use the <code class="codeph">DELETE EXPIRED</code> command to delete every <a href="glossary.html#GUID-A8547B27-5415-4AAA-B2B4-C0998EB62E47"><span class="xrefglossterm">expired backup</span></a> from the RMAN repository.
                              </p>
                           </li>
                           <li>
                              <p>Ensure that your guaranteed restore points are necessary. If not, delete them.</p>
                              <p>Flashback logs that are not needed for a guaranteed restore point are deleted automatically to gain space for other files in the fast recovery area. A guaranteed restore point forces the retention of flashback logs required to perform Flashback Database to the restore point SCN.</p>
                           </li>
                           <li>
                              <p>Review your backup retention policy and, if using Data Guard, your archived redo log deletion policy.</p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-3F11ECB5-1321-45F5-A557-BB1A5BAF011F__GUID-BE7D2B8C-9E15-4E5B-BC64-EAA04E9C9422">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="maintaining-rman-backups.html#GUID-8C4B395D-7C24-485F-BEA0-A355821FB93D" title="You can use the RMAN DELETE command to delete archived redo logs and RMAN backups.">Deleting RMAN Backups and Archived Redo Logs</a></p>
                              </li>
                              <li>
                                 <p><a href="using-flasback-database-restore-points.html#GUID-A1563822-015B-4941-B7EB-C3D44A63232C" title="When you are satisfied that you do not need an existing restore point, or when you want to create a restore point with the name of an existing restore point, you can drop the restore point, using the DROP RESTORE POINT SQL*Plus statement.">Dropping Restore Points</a></p>
                              </li>
                              <li>
                                 <p><a href="backing-up-database.html#GUID-93BAB347-063F-439E-BDF3-109AB8D1F8E7" title="RMAN backups are created using the BACKUP command.The primary purpose of RMAN backups is to protect your data. If a media failure or disaster occurs, then you can restore your backups and recover lost changes.You can back up all or part of your database with the BACKUP command from within the RMAN client.You can provide arguments to the BACKUP command to override the default backup options.The BACKUP command takes a DEVICE TYPE clause that specifies whether to back up to disk or tape device.RMAN can create backups on disk as image copies or as backup sets.RMAN provides a range of options to name the files generated by the BACKUP command. When backing up to disk, you can specify a format to spread the backup across several drives for improved performance. RMAN attaches a character string called a tag to every backup it creates, as a way of identifying the backup. You can either accept the default tag or specify your own with the TAG parameter of the BACKUP command.User-specified tags are a useful way to indicate the purpose or usage of different classes of backups or copies. Use the TAG parameter with the BACKUP command to specify tags for backup sets and image copies.When creating backup sets, you can use RMAN support for binary compression of backup sets by including the AS COMPRESSED BACKUPSET option to the BACKUP command.A multisection backup enables large data files to be divided into sections that can be backed up in parallel across multiple channels. This provides faster backup performance and better recovery times.While an image copy is being created, RMAN uses multiple channels to write files sections. However, the output of this operation is one copy for each data file.You can perform a whole database backup with the database mounted or open. You can back up one or more tablespaces with the BACKUP TABLESPACE command or one or more data files with the BACKUP DATAFILE command. You can back up the control file when the database is mounted or open. RMAN uses a snapshot control file to ensure a read-consistent version. A manual backup of the control file is different from a control file autobackup. RMAN makes a control file autobackup after the files specified in the BACKUP command are backed up. To make a manual backup, you can either specify INCLUDE CURRENT CONTROLFILE when backing up other files or specify BACKUP CURRENT CONTROLFILE. RMAN automatically backs up the current server parameter file in certain cases. The BACKUP SPFILE command backs up the parameter file explicitly. The server parameter file that is backed up is the one currently in use by the instance. You can only back up a database in NOARCHIVELOG mode when the database is closed and in a consistent state.Preplugin backups ensure that an RMAN backup is usable after a non-CDB is plugged in as a PDB into a CDB. Use the BACKUP command to back up multitenant container databases (CDBs) and pluggable databases (PDBs).RMAN and Oracle Enterprise Manager Cloud Control provide full support for backup and recovery in a multitenant environment.Backing up a whole multitenant container database (CDB) is similar to backing up a non-CDB. When you back up a whole CDB, RMAN backs up the root, all the pluggable databases (PDBs), and the archived redo logs.You can use RMAN to make a backup of only the root. Because the root contains critical metadata for the whole CDB, Oracle recommends that you back up the root or back up the whole CDB at regular intervals.Oracle Enterprise Manager Cloud Control (Cloud Control) can be used to back up the root.RMAN enables you to back up one or more PDBs in a CDB using the BACKUP command. Preplugin backups of a PDB can be used to perform restore and recover operations after the PDB is migrated and plugged in to a different destination CDB.Oracle Enterprise Manager Cloud Control (Cloud Control) can be used to perform backups of pluggable databases (PDBs).Because tablespaces in different PDBs can have the same name, to eliminate ambiguity you must connect directly to a PDB to back up one or more of its tablespaces.This example creates a preplugin backup of the PDB my_pdb that is contained in CDB cdb_prod. The CDB uses shared undo and is open in read-write mode.RMAN enables you to use the BACKUP command to perform backup operations on the application root, one or more application PDBs, and the application container.RMAN can back up application containers, application PDBs, and the application root.Use the RMAN BACKUP command to back up the application root.Use the BACKUP command to back up an application container, which consists of the application root and all the application PDBs that belong to the application root.The BACKUP command is used to back up one or more application PDBs. Use the BACKUP command to back up sparse databases.RMAN enables you to back up a sparse database, using steps similar to backing up a whole database, in the backup set or image copy format.You can back up one or more tablespaces containing sparse data files or individual sparse data files using the BACKUP command. RMAN enables you to back up one or more sparse PDBs in a CDB. Archived redo logs are the key to successful media recovery. You should back them up regularly.Several features of RMAN backups are specific to archived redo logs. For example, you can use BACKUP ... DELETE to delete one or all copies of archived redo logs from disk after backing them up to backup sets. Even if your redo logs are being archived to multiple destinations and you use RMAN to back up archived redo logs, RMAN selects only one copy of the archived redo log file to include in the backup set. Because logs with the same log sequence number are identical, RMAN does not need to include more than one log copy.Automatic online redo log switching is an important RMAN feature. In a CDB, archived redo logs can be backed up only when you connect to the root as a common user with the SYSDBA or SYSBACKUP privilege. To back up archived logs, use the BACKUP ARCHIVELOG command.You can indicate that RMAN should automatically skip backups of archived redo logs.You can back up archived redo logs in a multitenant container database (CDB) by using the BACKUP ARCHIVELOG command.The BACKUP ARCHIVELOG ... DELETE INPUT command deletes archived log files after they are backed up. This command eliminates the separate step of manually deleting archived redo logs. In a CDB, you can delete archived redo logs after they are backed up by using the BACKUP ARCHIVELOG ... DELETE INPUT command.An incremental backup copies only data file blocks that have changed since a specified previous backup. Use the BACKUP command to create incremental backups.RMAN incremental backups provide multiple benefits.Choose a backup strategy according to an acceptable MTTR (mean time to recover). You can use the Volume Shadow Copy Service (VSS) with the Oracle VSS writer to make a shadow copy or snapshot of files in a database.By incrementally updating backups, you can avoid the overhead of making full image copy backups of data files, while also minimizing time required for media recovery of your database. For example, if you run a daily backup script, then you never have more than 1 day of redo to apply for media recovery.To create incremental backups for use in an incrementally updated backup strategy, use the BACKUP ... FOR RECOVER OF COPY WITH TAG form of the BACKUP command. The command is best understood in a sample script that implements the strategy.The block change tracking feature for incremental backups improves backup performance by recording changed blocks for each data file.If block change tracking is enabled on a primary or standby database, then RMAN uses a block change tracking file to identify changed blocks for incremental backups. By reading this small bitmap file to determine which blocks changed, RMAN avoids having to scan every block in the data file that it is backing up.Oracle Database automatically manages space in the change tracking file to retain block change data that covers the eight most recent backups. After the maximum of eight bitmaps is reached, the oldest bitmap is overwritten by the bitmap that tracks the current changes.By default, the block change tracking file is created as an Oracle managed file in the destination specified by the DB_CREATE_FILE_DEST initialization parameter. You can also place the block change tracking file in any location that you choose, by specifying its name when enabling block change tracking. The size of the block change tracking file is proportional to the size of the database and the number of enabled threads of redo. You can enable block change tracking when the database is either open or mounted. When you disable block change tracking, the database removes the block change tracking file from the operating system.You can query the V$BLOCK_CHANGE_TRACKING view to determine whether change tracking is enabled, and if it is, the file name of the block change tracking file.To move the change tracking file, use the ALTER DATABASE RENAME FILE statement. You can use BACKUP... KEEP to create a backup that is both all-inclusive and exempt from the backup retention policy.You can exempt a backup from the retention policy by using the KEEP option with the BACKUP command. Typically, you make an archival backup to tape. Because your data protection backups are most likely to be on a set of tapes that remain accessible and are recycled, it is advisable to reserve a set of tapes for the archival backup. Use the BACKUP command with the KEEP option to make archival backups.One purpose of an archival backup is to create a test database. You can use the BACKUP BACKUPSET command to back up backup sets produced by other backup jobs. You can also use BACKUP RECOVERY AREA to back up recovery files created in the current and all previous fast recovery area destinations. The BACKUP BACKUPSET command creates additional copies of backup pieces in a backup set, but does not create a new backup set. For a backup retention policy based on redundancy, a backup set is counted as one instance of a backup. This statement is true even if there are multiple copies of the backup pieces that form the backup set, such as when a backup set has been backed up from disk to tape.Use the BACKUP BACKUPSET command to copy backup sets from disk to tape. Use the BACKUP command to back up image copies to tape.">Backing Up the Database</a> to decide on a retention policy
                                 </p>
                              </li>
                              <li>
                                 <p><a href="../sbydb/using-RMAN-in-oracle-data-guard-configurations.html#SBYDB04700" target="_blank"><span><cite>Oracle Data Guard Concepts and Administration</cite></span></a>for more information about archived log deletion policy with Data Guard
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV89618"></a><div class="props_rev_3"><a id="GUID-733CDB10-D2EE-45C8-A408-0774CC4CA875" name="GUID-733CDB10-D2EE-45C8-A408-0774CC4CA875"></a><h4 id="BRADV-GUID-733CDB10-D2EE-45C8-A408-0774CC4CA875" class="sect4"><span class="enumeration_section">12.3.5 </span>Changing the Fast Recovery Area to a New Location
                  </h4>
                  <div>
                     <p>Use the <code class="codeph">ALTER SYSTEM</code> command to change the location of the fast recovery area.
                     </p>
                     <div class="section">
                        <p>If you must move the fast recovery area of your database to a new location, then follow this procedure:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Start SQL*Plus on the target database and change the <code class="codeph">DB_RECOVERY_FILE_DEST</code> initialization parameter. For example, enter the following command to set the destination to the ASM disk group <code class="codeph">disk1</code>:</span><div><pre class="pre codeblock"><code>ALTER SYSTEM SET DB_RECOVERY_FILE_DEST='+disk1' SCOPE=BOTH SID='*';
</code></pre><p>After you change this parameter, all new fast recovery area files are created in the new location.</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Either leave or move the permanent files, flashback logs, and transient files in the old flash recovery location.</span><div>
                              <p>If you leave the existing files in the flash recovery, then the database deletes the transient files from the old fast recovery area as they become eligible for deletion. </p>
                              <p>If you must move the old files to the new fast recovery area, then see the <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=OSTMG89997" target="_blank"><span><cite>Oracle Automatic Storage Management Administrator's Guide</cite></span></a>. The procedure for moving database files into and out of an ASM disk group with RMAN works when moving files into and out of a fast recovery area.
                              </p>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV89619"></a><div class="props_rev_3"><a id="GUID-C04DF4D4-07BA-47F1-A5AD-878C99C55F98" name="GUID-C04DF4D4-07BA-47F1-A5AD-878C99C55F98"></a><h4 id="BRADV-GUID-C04DF4D4-07BA-47F1-A5AD-878C99C55F98" class="sect4"><span class="enumeration_section">12.3.6 </span>Disabling the Fast Recovery Area
                  </h4>
                  <div>
                     <p>The <code class="codeph">ALTER SYSTEM</code> command can be used to disable the fast recovery area.
                     </p>
                     <div class="p">Before disabling the fast recovery area, you must first drop all guaranteed restore points and then turn off Flashback Database. </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>You can then set the <code class="codeph">DB_RECOVERY_FILE_DEST</code> initialization parameter to a null string to disable the fast recovery area. For example, use the following SQL statement to change the parameter on a running database:
                        </p><pre class="pre codeblock"><code>ALTER SYSTEM SET DB_RECOVERY_FILE_DEST='' SCOPE=BOTH SID='*';
</code></pre><p>The database no longer provides the space management features of the fast recovery area for the files stored in the old <code class="codeph">DB_RECOVERY_FILE_DEST</code> location. The files are still known to the RMAN repository, however, and available for backup and restore activities.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV89620"></a><div class="props_rev_3"><a id="GUID-435335A2-95DC-41C1-9CEE-9539AD595FA7" name="GUID-435335A2-95DC-41C1-9CEE-9539AD595FA7"></a><h4 id="BRADV-GUID-435335A2-95DC-41C1-9CEE-9539AD595FA7" class="sect4"><span class="enumeration_section">12.3.7 </span>Responding to an Instance Crash During File Creation
                  </h4>
                  <div>
                     <p>As a rule, the fast recovery area is self-maintaining. When an instance crashes during the creation of a file in the fast recovery area, however, the database may leave the file in the fast recovery area.</p>
                     <div class="section">
                        <p>When this situation occurs, the alert log contains the following error, where <span class="italic"><code class="codeph">location</code></span> is the location of the fast recovery area:
                        </p><pre class="oac_no_warn" dir="ltr">ORA-19816: WARNING: Files may exist in <span class="italic">location</span> that are not known to database.
</pre><p>In such a situation, use the RMAN command <code class="codeph">CATALOG RECOVERY AREA</code> to recatalog any such files. If the file header of the file in question is corrupted, then delete the file manually with an operating system utility.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV89623"></a><div class="props_rev_3"><a id="GUID-93AE3A35-4B8C-424A-A5D4-CE14E160738C" name="GUID-93AE3A35-4B8C-424A-A5D4-CE14E160738C"></a><h3 id="BRADV-GUID-93AE3A35-4B8C-424A-A5D4-CE14E160738C" class="sect3"><span class="enumeration_section">12.4 </span>Updating the RMAN Repository
               </h3>
               <div>
                  <p>Several situations can cause a discrepancy between the repository and the files that it records, including tape or disk failures and user-managed copies or deletions of RMAN-related files.</p>
                  <p>This section explains how to ensure that the RMAN repository accurately reflects the reality of the RMAN-related files stored on disk and tape. </p>
               </div><a id="BRADV8171"></a><div class="props_rev_3"><a id="GUID-EFF8F8D1-D67C-4202-9C8E-DE74ADFF1FFB" name="GUID-EFF8F8D1-D67C-4202-9C8E-DE74ADFF1FFB"></a><h4 id="BRADV-GUID-EFF8F8D1-D67C-4202-9C8E-DE74ADFF1FFB" class="sect4"><span class="enumeration_section">12.4.1 </span>Crosschecking the RMAN Repository
                  </h4>
                  <div>
                     <p>To ensure that data about backups in the recovery catalog or control file is synchronized with corresponding data on disk or in the media management catalog, perform a crosscheck. The <code class="codeph">CROSSCHECK</code> command operates only on files that are currently recorded in the RMAN repository.
                     </p>
                     <p>If you use a fast recovery area, backup retention policy, and archived redo log deletion policy, then you do not need to perform crosschecks very often. If you delete files by means other than RMAN, then you must perform a crosscheck periodically to ensure that the repository data stays current. </p>
                  </div><a id="BRADV287"></a><a id="BRADV89624"></a><div class="props_rev_3"><a id="GUID-85697492-1075-484C-9B45-35277BBC2305" name="GUID-85697492-1075-484C-9B45-35277BBC2305"></a><h5 id="BRADV-GUID-85697492-1075-484C-9B45-35277BBC2305" class="sect5"><span class="enumeration_section">12.4.1.1 </span>About RMAN Crosschecks
                     </h5>
                     <div>
                        <p>Crosschecks update outdated RMAN repository information about backups whose repository records do not match their physical status. For example, if a user removes archived logs from disk with an operating system command, the repository still indicates that the logs are on disk, when in fact they are not.</p>
                        <p><a href="maintaining-rman-backups.html#GUID-85697492-1075-484C-9B45-35277BBC2305__I1010226">Figure 12-1</a> illustrates a crosscheck of a media manager. RMAN queries the RMAN repository for the names and locations of the four backup sets to be checked. RMAN sends this information to the target database server, which queries the media management software about the backups. The media management software then checks its media catalog and reports back to the server that backup set <code class="codeph">3</code> is missing. RMAN updates the status of backup set <code class="codeph">3</code> to <code class="codeph">EXPIRED</code> in the repository. The record for backup set <code class="codeph">3</code> is deleted after you run <code class="codeph">DELETE</code> <code class="codeph">EXPIRED</code>.
                        </p>
                        <div class="figure" id="GUID-85697492-1075-484C-9B45-35277BBC2305__I1010226">
                           <p class="titleinfigure">Figure 12-1 Crosschecking a Media Manager</p><img src="img/bradv031.png" alt="Description of Figure 12-1 follows" title="Description of Figure 12-1 follows" longdesc="img_text/bradv031.html"><br><a href="img_text/bradv031.html">Description of "Figure 12-1 Crosschecking a Media Manager"</a></div>
                        <!-- class="figure" -->
                        <p>Crosschecks are useful because they can do the following:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Update outdated information about backups that disappeared from disk or tape or became corrupted</p>
                           </li>
                           <li>
                              <p>Update the repository if you delete archived redo logs or other files with operating system commands</p>
                           </li>
                        </ul>
                        <p>Use the crosscheck feature to check the status of a backup on disk or tape. If the backup is on disk, then <code class="codeph">CROSSCHECK</code> checks whether the header of the file is valid. If a backup is on tape, then the command checks that the backups exist in the media management software catalog.
                        </p>
                        <p>Backup pieces and image copies can have the status <code class="codeph">AVAILABLE</code>, <code class="codeph">EXPIRED</code>, or <code class="codeph">UNAVAILABLE</code>. You can view the status of backups by running the RMAN <code class="codeph">LIST</code> command or by querying <code class="codeph">V$BACKUP_FILES</code> or recovery catalog views such as <code class="codeph">RC_DATAFILE_COPY</code> or <code class="codeph">RC_ARCHIVED_LOG</code>. A crosscheck updates the RMAN repository so that all of these techniques provide accurate information. RMAN updates each backup in the RMAN repository to status <code class="codeph">EXPIRED</code> if the backup is no longer available. If a new crosscheck determines that an <a href="glossary.html#GUID-A8547B27-5415-4AAA-B2B4-C0998EB62E47"><span class="xrefglossterm">expired backup</span></a> is available again, then RMAN updates its status to <code class="codeph">AVAILABLE</code>.
                        </p>
                        <div class="infoboxnote" id="GUID-85697492-1075-484C-9B45-35277BBC2305__GUID-FE122600-9448-4489-B153-FFAA2D1503F4">
                           <p class="notep1">Note:</p>
                           <p>The <code class="codeph">CROSSCHECK</code> command does <span class="italic">not</span> delete operating system files or remove repository records. You must use the <code class="codeph">DELETE</code> command for these operations.
                           </p>
                        </div>
                        <p>You can issue the <code class="codeph">DELETE</code> <code class="codeph">EXPIRED</code> command to delete all expired backups. RMAN removes the record for the expired file from the repository. If for some reason the file still exists on the media, then RMAN issues warnings and lists the mismatched objects that cannot be deleted.
                        </p>
                        <div class="infoboxnotealso" id="GUID-85697492-1075-484C-9B45-35277BBC2305__GUID-95A4763F-70E8-43A9-AEC8-F1C1AAC501C5">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="../rcmrf/CROSSCHECK.html#RCMRF119" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> for <code class="codeph">CROSSCHECK</code> syntax and a description of the possible status values
                                 </p>
                              </li>
                              <li>
                                 <p><a href="../rcmrf/DELETE.html#RCMRF121" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> for <code class="codeph">DELETE</code> syntax
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="BRADV89625"></a><div class="props_rev_3"><a id="GUID-E1D38362-4C8E-4F16-AEBF-6A6429D7BB3A" name="GUID-E1D38362-4C8E-4F16-AEBF-6A6429D7BB3A"></a><h5 id="BRADV-GUID-E1D38362-4C8E-4F16-AEBF-6A6429D7BB3A" class="sect5"><span class="enumeration_section">12.4.1.2 </span>Crosschecking All Backups and Copies 
                     </h5>
                     <div>
                        <p>After connecting to the target database and recovery catalog (if you use one), run <code class="codeph">CROSSCHECK</code> commands as needed to verify the status and availability of backups known to RMAN.
                        </p>
                        <div class="section">
                           <p>You can configure or manually allocate multiple channels before issuing <code class="codeph">CROSSCHECK</code> or <code class="codeph">DELETE</code> commands. RMAN searches for each backup on all channels that have the same device type as the channel used to create the backup. The multichannel feature is primarily intended for use when crosschecking or deleting backups on both disk and tape within a single command. For example, assume that you have an <a href="glossary.html#GUID-2E48CE71-9547-4196-B715-5CE59033262E"><span class="xrefglossterm">SBT</span></a> channel configured as follows:
                           </p><pre class="pre codeblock"><code>CONFIGURE DEVICE TYPE sbt PARALLELISM 1;
CONFIGURE DEFAULT DEVICE TYPE sbt;
</code></pre><p>In this case you can run the following commands to crosscheck both disk and SBT:</p><pre class="pre codeblock"><code>CROSSCHECK BACKUP;
CROSSCHECK COPY;
</code></pre><p>RMAN uses both the SBT channel and the preconfigured disk channel to perform the crosscheck. Sample output follows:</p><pre class="pre codeblock"><code>allocated channel: ORA_SBT_TAPE_1
channel ORA_SBT_TAPE_1: sid=12 devtype=SBT_TAPE
channel ORA_SBT_TAPE_1: WARNING: Oracle Test Disk API
using channel ORA_DISK_1
crosschecked backup piece: found to be 'AVAILABLE'
backup piece handle=/oracle/dbs/16c5esv4_1_1 recid=36 stamp=408384484
crosschecked backup piece: found to be 'AVAILABLE'
backup piece handle=/oracle/dbs/c-674966176-20000915-01 recid=37 stamp=408384496
crosschecked backup piece: found to be 'AVAILABLE'
backup piece handle=12c5erb2_1_1 recid=32 stamp=408382820
     .
     .
     .
</code></pre><p>If you do not have an automatic SBT channel configured, then you can manually allocate maintenance channels on disk and tape.</p><pre class="pre codeblock"><code>ALLOCATE CHANNEL FOR MAINTENANCE DEVICE TYPE sbt;
CROSSCHECK BACKUP;
CROSSCHECK COPY;
</code></pre><p>You do not have to manually allocate a disk channel because RMAN uses the preconfigured disk channel.</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="BRADV288"></a><a id="BRADV89626"></a><div class="props_rev_3"><a id="GUID-C306C814-ACB3-49E7-AEBD-C0A7FC78D163" name="GUID-C306C814-ACB3-49E7-AEBD-C0A7FC78D163"></a><h5 id="BRADV-GUID-C306C814-ACB3-49E7-AEBD-C0A7FC78D163" class="sect5"><span class="enumeration_section">12.4.1.3 </span>Crosschecking Specific Backup Sets and Copies
                     </h5>
                     <div>
                        <p>You can use the <code class="codeph">LIST</code> command to report your backups and then use the <code class="codeph">CROSSCHECK</code> command to check that specific backups described in the <code class="codeph">LIST</code> output still exist. 
                        </p>
                        <p>The <code class="codeph">DELETE</code> <code class="codeph">EXPIRED</code> command deletes repository records for backups that fail the crosscheck.
                        </p>
                        <div class="section">
                           <p class="subhead3" id="GUID-C306C814-ACB3-49E7-AEBD-C0A7FC78D163__GUID-5C69440C-888B-4CC5-986C-8FA4EA1814F5">To crosscheck specified backups:</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ol>
                              <li>
                                 <p>Start RMAN and connect to a target database and recovery catalog (if used).</p>
                              </li>
                              <li>
                                 <p>Run a <code class="codeph">LIST</code> command to identify the backups to be checked. 
                                 </p>
                                 <p>For example, run the following command: </p><pre class="pre codeblock"><code>LIST BACKUP;  # lists all backup sets, proxy copies, and image copies
</code></pre><p>Crosscheck the desired backups or copies. </p>
                                 <p>The following sample commands illustrate different types of crosschecks:</p>
                                 <p></p><pre class="pre codeblock"><code>CROSSCHECK BACKUP;  # checks backup sets, proxy copies, and image copies
CROSSCHECK COPY OF DATABASE;
CROSSCHECK BACKUPSET 1338, 1339, 1340;
CROSSCHECK BACKUPPIECE TAG 'nightly_backup';
CROSSCHECK BACKUP OF ARCHIVELOG ALL SPFILE;
CROSSCHECK BACKUP OF DATAFILE "?/oradata/trgt/system01.dbf"
  COMPLETED AFTER 'SYSDATE-14';
CROSSCHECK BACKUPSET DEVICE TYPE disk BACKED UP 3 TIMES TO sbt;
CROSSCHECK BACKUP OF DATABASE BACKED UP 2 TIMES TO sbt;
CROSSCHECK CONTROLFILECOPY '/tmp/control01.ctl';
CROSSCHECK DATAFILECOPY 113, 114, 115;
CROSSCHECK PROXY 789;</code></pre></li>
                           </ol>
                           <div class="infoboxnotealso" id="GUID-C306C814-ACB3-49E7-AEBD-C0A7FC78D163__GUID-D0628D95-1639-498A-ADFB-C4E939600C9A">
                              <p class="notep1">See Also:</p>
                              <p><a href="../rcmrf/CROSSCHECK.html#RCMRF119" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> for more details on using <code class="codeph">CROSSCHECK</code> to check backups of specific files
                              </p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-13BC4512-CCD8-4ADA-A7DB-45EEF10A58C5" name="GUID-13BC4512-CCD8-4ADA-A7DB-45EEF10A58C5"></a><h5 id="BRADV-GUID-13BC4512-CCD8-4ADA-A7DB-45EEF10A58C5" class="sect5"><span class="enumeration_section">12.4.1.4 </span>Crosschecking Preplugin Backups
                     </h5>
                     <div>
                        <p>Use the <code class="codeph">CROSSCHECK</code> command to verify the status and availability of preplugin backups and preplugin archived redo log files known to RMAN.
                        </p>
                        <div class="section">
                           <p></p>
                        </div>
                        <!-- class="section" -->
                        <div class="p">Ensure that the preplugin backups and preplugin archived redo log files created on the source CDB are accessible to the target database.</div>
                        <!-- class="section" -->
                        <div class="p"><span class="bold">To crosscheck preplugin backups:</span></div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Start RMAN and connect to the root of the target database as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege. Connect to a recovery catalog, if used.</span><div>
                                 <p>See <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Ensure that the target CDB is open in read-write mode.</span><div>
                                 <p>The following command displays the open mode of the database:</p><pre class="pre codeblock"><code>SELECT OPEN_MODE FROM V$DATABASE;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>Set the preplugin container to the PDB whose preplugin backups must be crosschecked.</span><div>
                                 <p>The following example sets the preplugin container to the PDB <code class="codeph">my_pdb</code>:
                                 </p><pre class="pre codeblock"><code>SET PREPLUGIN CONTAINER=my_pdb;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>Run the <code class="codeph">CROSSCHECK</code> command to verify the status and availability of preplugin backups.</span><div>
                                 <p>The following command crosschecks the backups for PDB <code class="codeph">my_pdb</code>.
                                 </p><pre class="pre codeblock"><code>CROSSCHECK PREPLUGIN BACKUP OF PLUGGABLE DATABASE my_pdb;</code></pre></div>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div><a id="BRADV8173"></a><div class="props_rev_3"><a id="GUID-D7C0DB1F-A0E6-43A2-8A6F-4B175D37BDFE" name="GUID-D7C0DB1F-A0E6-43A2-8A6F-4B175D37BDFE"></a><h4 id="BRADV-GUID-D7C0DB1F-A0E6-43A2-8A6F-4B175D37BDFE" class="sect4"><span class="enumeration_section">12.4.2 </span>Changing the Repository Status of Backups and Copies
                  </h4>
                  <div>
                     <p>RMAN provides multiple methods of changing the repository status of backups and copies.</p>
                     <p>Perform any of the following tasks to change the repository status of backups and copies:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Making backups available or unavailable</p>
                           <p>You can change the status of a backup if it becomes temporarily available or unavailable. For example, if a mounted disk undergoes maintenance, then you can update the records for backups on the disk to status <code class="codeph">UNAVAILABLE</code>.
                           </p>
                           <p><a href="maintaining-rman-backups.html#GUID-B8ADC6B5-A7F4-4045-9BCE-CC9912F8FCFC" title="Run the CHANGE...UNAVAILABLE command when a backup cannot be found or has migrated offsite.">Updating a Backup to Status AVAILABLE or UNAVAILABLE</a> describes how to make backups available or unavailable.
                           </p>
                        </li>
                        <li>
                           <p>Including or exempting backups from the retention policy</p>
                           <p>Archival backups can be created by using the <code class="codeph">KEEP</code> clause to exempt backups from the configured retention policy. You can also change the status of an archival backup and subsequently include it in the configured retention policy.
                           </p>
                           <p><a href="maintaining-rman-backups.html#GUID-9450FE74-62AE-4194-88BA-41E709576163" title="You can designate backups as exempt from the retention policy. This technique is useful for archiving backups to comply with business requirements.">Changing the Status of an Archival Backup</a> describes how to change the status of archival backups.
                           </p>
                        </li>
                     </ul>
                  </div><a id="BRADV289"></a><a id="BRADV89627"></a><div class="props_rev_3"><a id="GUID-B8ADC6B5-A7F4-4045-9BCE-CC9912F8FCFC" name="GUID-B8ADC6B5-A7F4-4045-9BCE-CC9912F8FCFC"></a><h5 id="BRADV-GUID-B8ADC6B5-A7F4-4045-9BCE-CC9912F8FCFC" class="sect5"><span class="enumeration_section">12.4.2.1 </span>Updating a Backup to Status AVAILABLE or UNAVAILABLE
                     </h5>
                     <div>
                        <p>Run the <code class="codeph">CHANGE...UNAVAILABLE</code> command when a backup cannot be found or has migrated offsite.
                        </p>
                        <div class="section">
                           <p> RMAN does not use files with status <code class="codeph">UNAVAILABLE</code> in <code class="codeph">RESTORE</code> or <code class="codeph">RECOVER</code> commands. If the file is later found or returns to the main site, then you can update its status again by issuing <code class="codeph">CHANGE...AVAILABLE</code> . The files in the fast recovery area cannot be marked as <code class="codeph">UNAVAILABLE</code>.
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-B8ADC6B5-A7F4-4045-9BCE-CC9912F8FCFC__GUID-114FAEE6-0832-4829-B58E-00EC1E86CA24">To update the status of a file in the repository to UNAVAILABLE or AVAILABLE:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Issue a <code class="codeph">LIST</code> command to determine the availability status of RMAN backups. For example, issue the following command to list all backups:</span><div><pre class="pre codeblock"><code>LIST BACKUP;
</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>Run <code class="codeph">CHANGE</code> with the <code class="codeph">UNAVAILABLE</code> or <code class="codeph">AVAILABLE</code> keyword to update its status in the RMAN repository.</span><div>
                                 <p>The following examples illustrate forms of the <code class="codeph">CHANGE</code> command:
                                 </p><pre class="pre codeblock"><code>CHANGE DATAFILECOPY '/tmp/control01.ctl' UNAVAILABLE;
CHANGE COPY OF ARCHIVELOG SEQUENCE BETWEEN 1000 AND 1012 UNAVAILABLE;
CHANGE BACKUPSET 12 UNAVAILABLE;
CHANGE BACKUP OF SPFILE TAG "TAG20120208T154556" UNAVAILABLE;
CHANGE DATAFILECOPY '/tmp/system01.dbf' AVAILABLE;
CHANGE BACKUPSET 12 AVAILABLE;
CHANGE BACKUP OF SPFILE TAG "TAG20120208T154556" AVAILABLE;</code></pre></div>
                           </li>
                        </ol>
                        <div class="section">
                           <div class="infoboxnotealso" id="GUID-B8ADC6B5-A7F4-4045-9BCE-CC9912F8FCFC__GUID-8CE4A116-713D-4330-B05A-B1071B590C25">
                              <p class="notep1">See Also:</p>
                              <p><a href="../rcmrf/CHANGE.html#RCMRF110" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> for <code class="codeph">CHANGE</code> command syntax
                              </p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="BRADV290"></a><a id="BRADV99973"></a><div class="props_rev_3"><a id="GUID-9450FE74-62AE-4194-88BA-41E709576163" name="GUID-9450FE74-62AE-4194-88BA-41E709576163"></a><h5 id="BRADV-GUID-9450FE74-62AE-4194-88BA-41E709576163" class="sect5"><span class="enumeration_section">12.4.2.2 </span>Changing the Status of an Archival Backup
                     </h5>
                     <div>
                        <p>You can designate backups as exempt from the retention policy. This technique is useful for archiving backups to comply with business requirements.</p>
                        <div class="section">
                           <p>An <a href="glossary.html#GUID-52B0BB49-8AC2-4C8E-A52F-1908CDE77717"><span class="xrefglossterm">archival backup</span></a> is still a fully valid backup, however, and can be restored just as any other RMAN backup.
                           </p>
                           <div class="infoboxnote" id="GUID-9450FE74-62AE-4194-88BA-41E709576163__GUID-A80A4F2B-5618-458C-AA17-E0B34D2207CE">
                              <p class="notep1">Note:</p>
                              <p>The <code class="codeph">KEEP</code> <code class="codeph">FOREVER</code> clause requires the use of a recovery catalog, because the control file cannot contain an infinitely large set of RMAN repository data.
                              </p>
                           </div>
                           <p>You can use the <code class="codeph">CHANGE</code> command to alter the <code class="codeph">KEEP</code> status of an existing backup. For example, you may decide that you no longer want to keep a long-term backup. The same options available for <code class="codeph">BACKUP...KEEP</code> are available with <code class="codeph">CHANGE...KEEP</code> .
                           </p>
                           <p>You cannot set <code class="codeph">KEEP</code> attributes for backup sets or files stored in the <a href="glossary.html#GUID-6E3CDD76-A573-4E5C-B12D-59C232C96C19"><span class="xrefglossterm">fast recovery area</span></a>.
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-9450FE74-62AE-4194-88BA-41E709576163__GUID-085015B8-A1B4-4637-A2DF-0A2322153292">To alter the KEEP status of an archival backup:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Issue a <code class="codeph">LIST</code> command to list the backups. For example, issue the following command to list all backups:</span><div><pre class="pre codeblock"><code>LIST BACKUP;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>Issue a <code class="codeph">CHANGE...KEEP</code> command to define a different retention period for this backup, or a <code class="codeph">CHANGE...NOKEEP</code> command to let the retention policy apply to this file. </span><div>
                                 <p>This example allows a backup set to be subject to the backup retention policy: </p><pre class="pre codeblock"><code>CHANGE BACKUPSET 231 NOKEEP;
</code></pre><p>This example makes a data file copy exempt from the retention policy for 180 days: </p><pre class="pre codeblock"><code>CHANGE DATAFILECOPY '/tmp/system01.dbf' KEEP UNTIL TIME 'SYSDATE+180';</code></pre></div>
                           </li>
                        </ol>
                        <div class="section">
                           <div class="infoboxnotealso" id="GUID-9450FE74-62AE-4194-88BA-41E709576163__GUID-C831D5C9-2383-4C3C-88D3-F566B489BAE3">
                              <p class="notep1">See Also:</p>
                              <p><a href="backing-up-database.html#GUID-8894680E-8BBA-475D-8815-D789C1A04FD9" title="You can use BACKUP... KEEP to create a backup that is both all-inclusive and exempt from the backup retention policy.You can exempt a backup from the retention policy by using the KEEP option with the BACKUP command. Typically, you make an archival backup to tape. Because your data protection backups are most likely to be on a set of tapes that remain accessible and are recycled, it is advisable to reserve a set of tapes for the archival backup. Use the BACKUP command with the KEEP option to make archival backups.One purpose of an archival backup is to create a test database.">Making Database Backups for Long-Term Storage</a></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-79700ED7-B63B-4538-B939-7F9370585FF5" name="GUID-79700ED7-B63B-4538-B939-7F9370585FF5"></a><h5 id="BRADV-GUID-79700ED7-B63B-4538-B939-7F9370585FF5" class="sect5"><span class="enumeration_section">12.4.2.3 </span>Changing the Status of Backups for Dropped PDBs
                     </h5>
                     <div>
                        <p>Use the <code class="codeph">CHANGE</code> command with the <code class="codeph">GUID</code> option to change the status of backups that correspond to pluggable databases (PDBs) that have been dropped from a multitenant container database (CDB).
                        </p>
                        <div class="section">
                           <p></p>
                           <p>After you drop a PDB, you cannot use the PDB name to change the status of backups associated with the dropped PDB. Instead, use the GUID to identify the dropped PDB.</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Connect to the root as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege.</span></li>
                           <li class="stepexpand"><span>Query the <code class="codeph">DBA_PDB_HISTORY</code> view to determine the GUID of the PDB that was dropped.</span><div>
                                 <p>The following example displays the PDBs that were deleted from the CDB <code class="codeph">test_db</code>:
                                 </p><pre class="pre codeblock"><code>SELECT pdb_name, pdb_guid FROM dba_pdb_history
WHERE db_name = 'test_db';</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>Use the <code class="codeph">CHANGE</code> command with the <code class="codeph">GUID</code> clause to modify the status of a backup corresponding to a dropped PDB.</span><div>
                                 <p>The following commands remove RMAN repository records of backup pieces and image copies associated with a dropped PDB that is identified using its GUID.</p><pre class="pre codeblock"><code>CHANGE BACKUPPIECE GUID 'DFCE8C3A437F214EB4230070EC0D294E' UNCATALOG;
CHANGE COPY GUID 'DFCE8C3A437F214EB4230070EC0D294E' UNCATALOG;</code></pre></div>
                           </li>
                        </ol>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-7528E10B-F7DE-4421-ADDE-EF6F63EA55E8" name="GUID-7528E10B-F7DE-4421-ADDE-EF6F63EA55E8"></a><h5 id="BRADV-GUID-7528E10B-F7DE-4421-ADDE-EF6F63EA55E8" class="sect5"><span class="enumeration_section">12.4.2.4 </span>Changing the Status of Preplugin Backups
                     </h5>
                     <div>
                        <p>Use the <code class="codeph">CHANGE</code> command to modify the repository status of preplugin backups and preplugin archived redo log files.
                        </p>
                        <div class="section">
                           <p></p>
                        </div>
                        <!-- class="section" -->
                        <div class="p">Ensure that the preplugin backups and archived redo log files created on the source CDB are accessible to the target database.</div>
                        <!-- class="section" -->
                        <div class="section">
                           <p><span class="bold">To change the status of preplugin backups:</span></p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Start RMAN and connect to the root as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege. Connect to a recovery catalog, if used.</span><div>
                                 <p>See <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Ensure that the target CDB is open in read-write mode.</span><div>
                                 <p>The following command displays the open mode of the database:</p><pre class="pre codeblock"><code>SELECT OPEN_MODE FROM V$DATABASE;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>Set the current container to the PDB whose preplugin backups must be crosschecked.</span><div>
                                 <p>The following example sets the preplugin container to the PDB <code class="codeph">my_pdb</code>:
                                 </p><pre class="pre codeblock"><code>SET PREPLUGIN CONTAINER=my_pdb;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>Run the <code class="codeph">CHANGE</code> command to verify the status and availability of preplugin archived redo log files.</span><div>
                                 <p>The following command makes all preplugin archived redo log files available.</p><pre class="pre codeblock"><code>CHANGE PREPLUGIN BACKUP OF ARCHIVELOG ALL AVAILABLE;</code></pre></div>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div><a id="BRADV8174"></a><div class="props_rev_3"><a id="GUID-3FC88C14-C9CC-445D-8922-C92659004FA4" name="GUID-3FC88C14-C9CC-445D-8922-C92659004FA4"></a><h4 id="BRADV-GUID-3FC88C14-C9CC-445D-8922-C92659004FA4" class="sect4"><span class="enumeration_section">12.4.3 </span>Adding Backup Records to the RMAN Repository
                  </h4>
                  <div>
                     <p>You can use the <code class="codeph">CATALOG</code> command to make RMAN aware of the existence of archived logs not recorded in the repository or copies of database files that are created through means other than RMAN. 
                     </p>
                  </div><a id="BRADV89628"></a><div class="props_rev_3"><a id="GUID-57DADE2D-4663-4FDC-9563-EC39603642C1" name="GUID-57DADE2D-4663-4FDC-9563-EC39603642C1"></a><h5 id="BRADV-GUID-57DADE2D-4663-4FDC-9563-EC39603642C1" class="sect5"><span class="enumeration_section">12.4.3.1 </span>About Cataloging Operations
                     </h5>
                     <div>
                        <p>The target database control file keeps records of all archived redo logs generated by the target database and all RMAN backups. The purpose of the <code class="codeph">CATALOG</code> command is to add metadata to the repository when it does not have a record of files for RMAN to manage.
                        </p>
                        <p>Run the RMAN <code class="codeph">CATALOG</code> command when:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>You use an operating system utility to make copies of data files, archived logs, or backup pieces. In this case, the repository has no record of them. </p>
                           </li>
                           <li>
                              <p>You perform recovery with a backup control file and you change the archiving destination or format during recovery. In this situation, the repository does not have information about archived logs needed for recovery, and you must catalog these logs.</p>
                           </li>
                           <li>
                              <p>You want to catalog data file copy as a level 0 backup, thus enabling you to perform an incremental backup later by using the data file copy as the base of an incremental backup strategy.</p>
                           </li>
                           <li>
                              <p>You want to catalog user-managed copies of Oracle7 database files created before you migrated to a higher release, or of Oracle8 and higher database files created before you started to use RMAN. These data file copies enable you to recover the database if it fails after migration but before you have a chance to take a backup of the migrated database.</p>
                           </li>
                        </ul>
                        <p>Whenever you make a user-managed copy, for example, by using the UNIX <code class="codeph">cp</code> command to copy a data file, be sure to catalog it. When making user-managed copies, you can use the <code class="codeph">ALTER TABLESPACE...BEGIN/END BACKUP</code> statement to make data file copies off an online tablespace. Although RMAN does not create such data file copies, you can use the <code class="codeph">CATALOG</code> command to add them to the recovery catalog so that RMAN is aware of them. 
                        </p>
                        <p>For a user-managed copy to be cataloged, it must be:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Accessible on disk</p>
                           </li>
                           <li>
                              <p>A complete image copy of a single file</p>
                           </li>
                           <li>
                              <p>Either a data file copy, control file copy, archived redo log copy, or backup piece copy</p>
                           </li>
                        </ul>
                        <p>For example, if you store data files on mirrored disk drives, then you can create a user-managed copy by breaking the mirror. In this scenario, use the <code class="codeph">CATALOG</code> command to notify RMAN of the existence of the user-managed copy after breaking the mirror. Before reforming the mirror, run a <code class="codeph">CHANGE...UNCATALOG</code> command to notify RMAN that the file copy no longer exists.
                        </p>
                     </div>
                  </div><a id="BRADV291"></a><a id="BRADV89629"></a><div class="props_rev_3"><a id="GUID-F5DB5D09-59AE-42D8-87C7-B8AE671DEE02" name="GUID-F5DB5D09-59AE-42D8-87C7-B8AE671DEE02"></a><h5 id="BRADV-GUID-F5DB5D09-59AE-42D8-87C7-B8AE671DEE02" class="sect5"><span class="enumeration_section">12.4.3.2 </span>Cataloging User-Managed Data File Copies
                     </h5>
                     <div>
                        <p>Use the <code class="codeph">CATALOG</code> command to propagate information about user-managed copies to the RMAN repository. After the files are cataloged, you can run the <code class="codeph">LIST</code> command or query <code class="codeph">V$BACKUP_FILES</code> view to confirm the information is contained in the RMAN repository.
                        </p>
                        <div class="section">
                           <p class="subhead3" id="GUID-F5DB5D09-59AE-42D8-87C7-B8AE671DEE02__GUID-C3014C81-1BC5-4C52-A72F-3D99CCC00AED">To create and catalog a user-managed copy of a data file:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Make a data file copy with an operating system utility. <code class="codeph">ALTER TABLESPACE BEGIN/END BACKUP</code> is necessary if the database is open and the data files are online while the backup is in progress. This example backs up an online data file, using the SQL*Plus <code class="codeph">HOST</code> command to issue an operating system command.</span><div><pre class="pre codeblock"><code>SQL&gt; ALTER TABLESPACE users BEGIN BACKUP;
SQL&gt; HOST CP $ORACLE_HOME/oradata/trgt/users01.dbf /tmp/users01.dbf;
SQL&gt; ALTER TABLESPACE users END BACKUP;
</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>Start RMAN and connect to a target database and recovery catalog (if used).</span></li>
                           <li class="stepexpand"><span>Run the <code class="codeph">CATALOG</code> command. </span><div>
                                 <p>For example, enter the following command to catalog a user-managed data file copy:</p><pre class="pre codeblock"><code>CATALOG DATAFILECOPY '/tmp/users01.dbf';
</code></pre><p>If you try to catalog a data file copy from a database other than the connected target database, then RMAN issues an error such as the following:</p><pre class="pre codeblock"><code>RMAN-00571: ===========================================================
RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============
RMAN-00571: ===========================================================
RMAN-03009: failure of catalog command on default channel at 08/29/2013 14:44:34
ORA-19563: datafile copy header validation failed for file /tmp/tools01.dbf</code></pre><div class="infoboxnotealso" id="GUID-F5DB5D09-59AE-42D8-87C7-B8AE671DEE02__GUID-ADC5BD7B-DBBE-4DC9-8E3C-87DADFB38C82">
                                    <p class="notep1">See Also:</p>
                                    <p><a href="../rcmrf/CATALOG.html#RCMRF109" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> for <code class="codeph">CATALOG</code> command syntax
                                    </p>
                                 </div>
                              </div>
                           </li>
                        </ol>
                     </div>
                  </div><a id="BRADV292"></a><a id="BRADV8204"></a><div class="props_rev_3"><a id="GUID-A049B0D9-C035-4A31-81D6-B54229C9A10D" name="GUID-A049B0D9-C035-4A31-81D6-B54229C9A10D"></a><h5 id="BRADV-GUID-A049B0D9-C035-4A31-81D6-B54229C9A10D" class="sect5"><span class="enumeration_section">12.4.3.3 </span>Cataloging Backup Pieces
                     </h5>
                     <div>
                        <p>You can catalog backup pieces on disk. This technique is useful if you use an operating system utility to copy backup pieces from one location to another on the same host, or from one host to another. </p>
                        <div class="section">
                           <p>You can even catalog a backup piece from a prior <a href="glossary.html#GUID-4CCAB7DD-FEA7-4237-AF2C-304BA3BD52B1"><span class="xrefglossterm">incarnation</span></a> of the database. RMAN can determine whether that backup piece can be used during a subsequent restore and recovery operation. 
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-A049B0D9-C035-4A31-81D6-B54229C9A10D__GUID-367133C5-AFB3-4B63-9C19-DC7216563863">To catalog a backup piece:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Start RMAN and connect to a target database and recovery catalog (if used).</span></li>
                           <li class="stepexpand"><span>Catalog the file names of the backup pieces. </span><div>
                                 <p>For example, enter the following command:</p><pre class="pre codeblock"><code>CATALOG BACKUPPIECE '/disk2/09dtq55d_1_2', '/disk2/0bdtqdou_1_1';
</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>Optionally, run a <code class="codeph">LIST</code> command or query <code class="codeph">V$</code> views to verify your changes. </span><div>
                                 <p>Views include <code class="codeph">V$BACKUP_PIECE</code>, <code class="codeph">V$BACKUP_SET</code>, <code class="codeph">V$BACKUP_DATAFILE</code>, <code class="codeph">V$BACKUP_REDOLOG</code>, and <code class="codeph">V$BACKUP_SPFILE</code>. The following query shows the names of backup pieces:
                                 </p><pre class="pre codeblock"><code>SELECT HANDLE 
FROM   V$BACKUP_PIECE;</code></pre><div class="infoboxnotealso" id="GUID-A049B0D9-C035-4A31-81D6-B54229C9A10D__GUID-BBA33C5D-59AC-44D9-B81F-1A4B52D50E5F">
                                    <p class="notep1">See Also:</p>
                                    <p><a href="../rcmrf/CATALOG.html#RCMRF109" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> for <code class="codeph">CATALOG</code> <code class="codeph">BACKUPPIECE</code> restrictions
                                    </p>
                                 </div>
                              </div>
                           </li>
                        </ol>
                     </div>
                  </div><a id="BRADV293"></a><a id="BRADV8203"></a><div class="props_rev_3"><a id="GUID-6DAB69CD-17D1-48AD-B1DD-7D1A6D073BB8" name="GUID-6DAB69CD-17D1-48AD-B1DD-7D1A6D073BB8"></a><h5 id="BRADV-GUID-6DAB69CD-17D1-48AD-B1DD-7D1A6D073BB8" class="sect5"><span class="enumeration_section">12.4.3.4 </span>Cataloging All Files in a Disk Location
                     </h5>
                     <div>
                        <p>If you use Automatic Storage Management (ASM), an Oracle Managed Files framework, or the fast recovery area, then you may want to recatalog files that are known to the disk management system but are no longer listed in the RMAN repository. This situation can occur when the intended mechanism for tracking file names fails due to media failure, software bug, or user error.</p>
                        <div class="section">
                           <p>The <code class="codeph">CATALOG START WITH</code> command enables you to search through all files in an ASM disk group, Oracle Managed Files location, or traditional file system directory and investigate those that are not recorded in the RMAN repository. If the command can catalog a file, then it does so. If it cannot catalog the file, then it makes its best guess about the contents of the skipped file.
                           </p>
                           <p>The <code class="codeph">CATALOG RECOVERY AREA</code> command enables you to catalog all files in the recovery area. Typically, you do not need to run this command manually because RMAN automatically runs it as needed, for example, when you restore or create a control file. You can run this command when files are copied into the fast recovery area by operating system utilities.
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-6DAB69CD-17D1-48AD-B1DD-7D1A6D073BB8__GUID-AC8F20BA-BA89-4F02-9245-AA2A7D80B79F">To catalog all files in a disk location:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Start RMAN and connect to a target database and recovery catalog (if used).</span></li>
                           <li class="stepexpand"><span>Run the <code class="codeph">CATALOG</code> command, specifying the disk location whose files you want to catalog. </span><div>
                                 <p>For example, enter the following commands:</p><pre class="pre codeblock"><code>CATALOG START WITH '+disk'; # catalog all files from an ASM disk group
CATALOG START WITH '/fs1/datafiles/'; # catalog all files in directory</code></pre><div class="infoboxnote" id="GUID-6DAB69CD-17D1-48AD-B1DD-7D1A6D073BB8__GUID-8702E0E0-4498-42FD-A697-19D3980AC0E8">
                                    <p class="notep1">Note:</p>
                                    <p>Wildcard characters are not legal in the <code class="codeph">START WITH</code> clause.
                                    </p>
                                 </div>
                                 <p>You can use the <code class="codeph">CATALOG RECOVERY AREA</code> command to catalog all files in the recovery area. During this operation, any files in the recovery area not listed in the RMAN repository are added. For example:
                                 </p><pre class="pre codeblock"><code>CATALOG RECOVERY AREA;
</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>Run a <code class="codeph">LIST</code> command to verify that the files were cataloged.</span></li>
                        </ol>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-CFB5CC03-24AD-458E-881C-561256136120" name="GUID-CFB5CC03-24AD-458E-881C-561256136120"></a><h5 id="BRADV-GUID-CFB5CC03-24AD-458E-881C-561256136120" class="sect5"><span class="enumeration_section">12.4.3.5 </span>Cataloging Preplugin Archived Redo Logs
                     </h5>
                     <div>
                        <p>Use the <code class="codeph">CATALOG</code> command to add preplugin archived redo log files to the RMAN repository.
                        </p>
                        <div class="section">
                           <p></p>
                        </div>
                        <!-- class="section" -->
                        <div class="p">Ensure that the preplugin archived redo log files created on the source CDB are accessible to the target database.</div>
                        <!-- class="section" -->
                        <div class="section"><span class="bold">To catalog preplugin backups of archived redo log files:</span></div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Start RMAN and connect to the root of the target database as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege. Connect to a recovery catalog, if used.</span><div>
                                 <p>See <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Ensure that the target CDB is open in read-write mode.</span><div>
                                 <p>The following command displays the open mode of the database:</p><pre class="pre codeblock"><code>SELECT OPEN_MODE FROM V$DATABASE;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>Set the current container to the PDB whose preplugin backups must be crosschecked.</span><div>
                                 <p>The following example sets the preplugin container to the PDB <code class="codeph">my_pdb</code>:
                                 </p><pre class="pre codeblock"><code>SET PREPLUGIN CONTAINER=my_pdb;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>Run the <code class="codeph">CATALOG</code> command to catalog preplugin archived redo log files in the RMAN repository.</span><div>
                                 <div class="p">The following command catalogs the specified preplugin archived redo log.<pre class="pre codeblock"><code>CATALOG PREPLUGIN ARCHIVELOG '/disk1/backups/DB18c/backupset/2017_10_09/o1_mf_annnn_MYPDB_MIGR_dxq2r45h_.bkp';</code></pre></div>
                              </div>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div><a id="BRADV8175"></a><div class="props_rev_3"><a id="GUID-C675D0A5-E764-4A76-B91E-CC66EE19E801" name="GUID-C675D0A5-E764-4A76-B91E-CC66EE19E801"></a><h4 id="BRADV-GUID-C675D0A5-E764-4A76-B91E-CC66EE19E801" class="sect4"><span class="enumeration_section">12.4.4 </span>Removing Records from the RMAN Repository
                  </h4>
                  <p>You can remove records for files from the RMAN repository.</p><a id="BRADV89630"></a><div class="props_rev_3"><a id="GUID-ED189CEE-26C0-4DA9-891F-E940F9050660" name="GUID-ED189CEE-26C0-4DA9-891F-E940F9050660"></a><h5 id="BRADV-GUID-ED189CEE-26C0-4DA9-891F-E940F9050660" class="sect5"><span class="enumeration_section">12.4.4.1 </span>About Uncataloging Operations in the RMAN Repository
                     </h5>
                     <div>
                        <p>Run the <code class="codeph">CHANGE...UNCATALOG</code> command to perform the following actions on RMAN repository records:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Update a backup record in the control file repository to status <code class="codeph">DELETED</code></p>
                           </li>
                           <li>
                              <p>Delete a specific backup record from the recovery catalog (if you use one)</p>
                           </li>
                        </ul>
                        <p>RMAN does not change the specified physical files: it only alters the repository records for these files.</p>
                        <p>You can use this command when you have deleted a backup through a means other than RMAN. For example, if you delete archived redo logs with an operating system utility, then remove the record for this log from the repository by issuing a <code class="codeph">CHANGE</code> <code class="codeph">ARCHIVELOG</code> <code class="codeph">...</code> <code class="codeph">UNCATALOG</code> command.
                        </p>
                     </div>
                  </div><a id="BRADV294"></a><a id="BRADV89631"></a><div class="props_rev_3"><a id="GUID-56D305E0-DA23-4B63-BDF5-33776987FB43" name="GUID-56D305E0-DA23-4B63-BDF5-33776987FB43"></a><h5 id="BRADV-GUID-56D305E0-DA23-4B63-BDF5-33776987FB43" class="sect5"><span class="enumeration_section">12.4.4.2 </span>Removing Records for Files Deleted with Operating System Utilities
                     </h5>
                     <div>
                        <p>You can use the <code class="codeph">CHANGE ... UNCATALOG</code> command to update the RMAN repository for the absent files.
                        </p>
                        <div class="section">
                           <p>In some circumstances, users may have removed backups or archived redo logs with operating system utilities. Unless you run <code class="codeph">CROSSCHECK</code>, RMAN does not know about the deletion. In such cases, you can use the <code class="codeph">CHANGE..UNCATALOG</code> command.
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-56D305E0-DA23-4B63-BDF5-33776987FB43__GUID-F6F095A0-C2EC-4431-B5CE-892B26085B0F">To remove the catalog record for a backup or archived redo log:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Run a <code class="codeph">CHANGE</code> <code class="codeph">...</code> <code class="codeph">UNCATALOG</code> command for the backups that you deleted from the operating system with operating system commands. This example deletes repository references to disk copies of the control file and data file <code class="codeph">1</code>:</span><div><pre class="pre codeblock"><code>CHANGE CONTROLFILECOPY '/tmp/control01.ctl' UNCATALOG;
CHANGE DATAFILECOPY '/tmp/system01.dbf' UNCATALOG;
CHANGE BACKUPSET '/disk1/oradata/backups/db1_full.bkp' UNCATALOG;
</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>Optionally, view the relevant recovery catalog view, for example, <code class="codeph">RC_DATAFILE_COPY</code> or <code class="codeph">RC_CONTROLFILE_COPY</code>, to confirm that a given record was removed. This query confirms that the record of copy <code class="codeph">4833</code> was removed:</span><div><pre class="pre codeblock"><code>SELECT CDF_KEY, STATUS 
FROM RC_DATAFILE_COPY 
WHERE CDF_KEY = 4833;

CDF_KEY    STATUS
---------- ------
0 rows selected.</code></pre></div>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV8172"></a><div class="props_rev_3"><a id="GUID-8C4B395D-7C24-485F-BEA0-A355821FB93D" name="GUID-8C4B395D-7C24-485F-BEA0-A355821FB93D"></a><h3 id="BRADV-GUID-8C4B395D-7C24-485F-BEA0-A355821FB93D" class="sect3"><span class="enumeration_section">12.5 </span>Deleting RMAN Backups and Archived Redo Logs
               </h3>
               <div>
                  <p>You can use the RMAN <code class="codeph">DELETE</code> command to delete archived redo logs and RMAN backups. 
                  </p>
                  <p>For backups on disk, deleting backups physically removes the backup file from disk. For backups on <a href="glossary.html#GUID-2E48CE71-9547-4196-B715-5CE59033262E"><span class="xrefglossterm">SBT</span></a> devices, the RMAN <code class="codeph">DELETE</code> command instructs the media manager to delete the backup pieces or proxy copies on tape. In either case, RMAN updates the RMAN repository to reflect the deletion.
                  </p>
                  <div class="infoboxnote" id="GUID-8C4B395D-7C24-485F-BEA0-A355821FB93D__GUID-C9F5E703-BE0A-4331-B2DE-6CB3879999AA">
                     <p class="notep1">Note:</p>
                     <p>In a CDB, you can delete archived logs only when you connect to the root as a user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege. Archived redo logs cannot be deleted when connected to a PDB.
                     </p>
                  </div>
               </div><a id="BRADV89632"></a><div class="props_rev_3"><a id="GUID-8EFDE192-A385-457E-B00A-7A9ED7598223" name="GUID-8EFDE192-A385-457E-B00A-7A9ED7598223"></a><h4 id="BRADV-GUID-8EFDE192-A385-457E-B00A-7A9ED7598223" class="sect4"><span class="enumeration_section">12.5.1 </span>Overview of Deleting RMAN Backups
                  </h4>
                  <div>
                     <p>Every RMAN backup produces a corresponding record in the RMAN repository. This record is stored in the control file. If a recovery catalog is used, then the record can also be found in the recovery catalog after the recovery catalog is resynchronized from the control file. </p>
                     <p>For example, if you generate a full database backup set, then you can view the record for this backup set in <code class="codeph">V$BACKUP_SET</code>. If you use a recovery catalog, then you can also access the record in the <code class="codeph">RC_BACKUP_SET</code> catalog view.
                     </p>
                     <p>The <code class="codeph">V$</code> control file views and recovery catalog views differ in the way that they store information, and this affects how RMAN handles repository records. The recovery catalog RMAN repository is stored in actual database tables, while the control file version of the repository is stored in an internal structure in the control file.
                     </p>
                     <p>When you use an RMAN command to delete a backup or archived redo log file, RMAN does the following:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Removes the physical file from the operating system (if the file is still present)</p>
                        </li>
                        <li>
                           <p>Updates the file records in the control file to status <code class="codeph">DELETED</code></p>
                        </li>
                        <li>
                           <p>Removes the file records from the recovery catalog tables (if RMAN is connected to a recovery catalog)</p>
                        </li>
                     </ul>
                     <p>Because of the way that control file data is stored, RMAN cannot remove the record from the control file, only update it to <code class="codeph">DELETED</code> status. Because the recovery catalog tables are ordinary database tables, however, RMAN deletes rows from them in the same way that rows are deleted from any table.
                     </p>
                  </div><a id="BRADV295"></a><a id="BRADV90079"></a><div class="props_rev_3"><a id="GUID-1A707B20-A04E-4D24-9722-605E95158754" name="GUID-1A707B20-A04E-4D24-9722-605E95158754"></a><h5 id="BRADV-GUID-1A707B20-A04E-4D24-9722-605E95158754" class="sect5"><span class="enumeration_section">12.5.1.1 </span>About RMAN Deletion Commands
                     </h5>
                     <div>
                        <p>You can delete backups and recovery catalog records for backups.</p>
                        <p>The following table describes the RMAN commands that can delete backups.</p>
                        <div class="tblformal" id="GUID-1A707B20-A04E-4D24-9722-605E95158754__CHDDBBIJ">
                           <p class="titleintable">Table 12-1 RMAN Deletion Commands</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="RMAN Deletion Commands" summary="This table describes RMAN commands that can delete backups." width="100%" frame="hsides" border="1" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" id="d58406e5890">Command</th>
                                    <th align="left" valign="bottom" id="d58406e5893">Purpose</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d58406e5898" headers="d58406e5890 ">
                                       <p><code class="codeph">DELETE</code></p>
                                    </td>
                                    <td align="left" valign="top" headers="d58406e5898 d58406e5893 ">
                                       <p>To delete backups, update the control file records to status <code class="codeph">DELETED</code>, and remove their records from the recovery catalog (if a recovery catalog is used). 
                                       </p>
                                       <p>You can specify that <code class="codeph">DELETE</code> removes backups that are <code class="codeph">EXPIRED</code> or <code class="codeph">OBSOLETE</code>. If you run <code class="codeph">DELETE</code> <code class="codeph">EXPIRED</code> on a backup that exists, then RMAN issues a warning and does not delete the backup. If you use the <code class="codeph">DELETE</code> command with the optional <code class="codeph">FORCE</code> keyword, then RMAN deletes the specified backups, but ignores any I/O errors, including those that occur when a backup is missing from disk or tape. It then updates the RMAN repository to reflect the fact that the backup is deleted, regardless of whether RMAN was able to delete the file or whether the file was missing.
                                       </p>
                                       <p>RMAN uses all configured channels to perform the deletion. If you use <code class="codeph">DELETE</code> for files on devices that are not configured for automatic channels, then you must first use <code class="codeph">ALLOCATE CHANNEL FOR MAINTENANCE</code> command. For example, if you made a backup with the SBT channel, but only a disk channel is configured, then you must manually allocate an SBT channel for <code class="codeph">DELETE</code>. An automatic or manually allocated maintenance channel is required when you use <code class="codeph">DELETE</code> command on a disk-only file.
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d58406e5947" headers="d58406e5890 ">
                                       <p><code class="codeph">BACKUP...DELETE [ALL] INPUT</code> 
                                       </p>
                                    </td>
                                    <td align="left" valign="top" headers="d58406e5947 d58406e5893 ">
                                       <p>To back up archived logs, data file copies, or backup sets, then delete the input files from the operating system after the successful completion of the backup. RMAN also deletes and updates repository records for the deleted input files.</p>
                                       <p>If you specify <code class="codeph">DELETE</code> <code class="codeph">INPUT</code> (without <code class="codeph">ALL</code>), then RMAN deletes only the specific files that it backs up. If you specify <code class="codeph">ALL INPUT</code>, then RMAN deletes all copies of the files recorded in the RMAN repository.
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d58406e5970" headers="d58406e5890 ">
                                       <p><code class="codeph">CHANGE...UNCATALOG</code> 
                                       </p>
                                    </td>
                                    <td align="left" valign="top" headers="d58406e5970 d58406e5893 ">
                                       <p>To delete recovery catalog records for specified backups and change their control file records to status <code class="codeph">DELETED</code>. The <code class="codeph">CHANGE...UNCATALOG</code> command only changes the RMAN repository record of backups, and does not actually delete backups.
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>The RMAN repository record for an object can sometimes fail to reflect the physical status of the object. For example, you back up an archived redo log to disk and then use an operating system utility to delete it. If you run <code class="codeph">DELETE</code> without first running <code class="codeph">CROSSCHECK</code>, then the repository erroneously lists the log as <code class="codeph">AVAILABLE</code>. 
                        </p>
                        <p>If you run RMAN interactively, then RMAN asks for confirmation before deleting any files. You can suppress these confirmations by using the <code class="codeph">NOPROMPT</code> keyword with any form of the <code class="codeph">BACKUP</code> command:
                        </p><pre class="pre codeblock"><code>DELETE NOPROMPT ARCHIVELOG ALL;</code></pre><div class="infoboxnotealso" id="GUID-1A707B20-A04E-4D24-9722-605E95158754__GUID-ACCD65CE-855A-49C2-9EF7-DA27A273B3D5">
                           <p class="notep1">See Also:</p>
                           <p><a href="../rcmrf/DELETE.html#RCMRF121" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> for a description of <code class="codeph">DELETE</code> behavior when mismatches occur between the RMAN repository and physical media
                           </p>
                        </div>
                     </div>
                  </div><a id="BRADV90080"></a><div class="props_rev_3"><a id="GUID-8E5E9B7B-6627-4B14-8BFC-1C53EFB82FEF" name="GUID-8E5E9B7B-6627-4B14-8BFC-1C53EFB82FEF"></a><h5 id="BRADV-GUID-8E5E9B7B-6627-4B14-8BFC-1C53EFB82FEF" class="sect5"><span class="enumeration_section">12.5.1.2 </span>About Deletion of Archived Redo Logs
                     </h5>
                     <div>
                        <p>The recommended maintenance strategy is to configure a fast recovery area, a backup retention policy, and an archived redo log deletion policy.</p>
                        <p>By default, the archived redo logs deletion policy is configured to <code class="codeph">NONE</code>. In this case, the fast recovery area considers the logs eligible for deletion if they have been backed up at least once to disk or tape or the logs are obsolete according to the backup retention policy.
                        </p>
                        <p>Archived redo logs can be deleted automatically by the database or by any of the user-initiated RMAN commands listed in <a href="maintaining-rman-backups.html#GUID-1A707B20-A04E-4D24-9722-605E95158754__CHDDBBIJ" title="This table describes RMAN commands that can delete backups.">Table 12-1</a>. For logs in the recovery area, the database retains them as long as possible and automatically deletes eligible logs when disk space is required. You can delete eligible logs from any location, inside or outside the recovery area, with <code class="codeph">BACKUP ... DELETE INPUT</code> or <code class="codeph">DELETE ARCHIVELOG</code>. Both of these commands obey the archive redo log deletion policy when the policy is any setting other than <code class="codeph">NONE</code>. You can override the archived redo log deletion policy settings by using the <code class="codeph">FORCE</code> option in the <code class="codeph">DELETE</code> command.
                        </p>
                        <div class="infoboxnotealso" id="GUID-8E5E9B7B-6627-4B14-8BFC-1C53EFB82FEF__GUID-932E245A-5414-45AC-B1FC-C785C73BF966">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="maintaining-rman-backups.html#GUID-E5BBAAFE-1191-4A96-A63A-91EDF87F7C3E" title="RMAN provides multiple commands to maintain RMAN backups and repository records.">Basic Concepts of Backup and Repository Maintenance</a></p>
                              </li>
                              <li>
                                 <p><a href="configuring-rman-client-basic.html#GUID-FA142760-8ACB-43DA-939C-8407618D2D0F" title="You can use RMAN to create a persistent configuration that governs when archived redo logs are eligible for deletion from disk.">Configuring an Archived Redo Log Deletion Policy</a></p>
                              </li>
                              <li>
                                 <p>The <code class="codeph">CONFIGURE ARCHIVELOG DELETION POLICY</code> entry in <a href="../rcmrf/CONFIGURE.html#RCMRF113" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> for detailed information about policy options
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
               </div><a id="BRADV296"></a><a id="BRADV89633"></a><div class="props_rev_3"><a id="GUID-0F82F489-C5FB-41C2-9687-AE9A5CD89406" name="GUID-0F82F489-C5FB-41C2-9687-AE9A5CD89406"></a><h4 id="BRADV-GUID-0F82F489-C5FB-41C2-9687-AE9A5CD89406" class="sect4"><span class="enumeration_section">12.5.2 </span>Deleting All Backups and Copies
                  </h4>
                  <div>
                     <p>Use the RMAN <code class="codeph">DELETE</code> command to delete backups and image copies.
                     </p>
                     <div class="section">
                        <p>In some circumstances, you may need to delete all backup sets, proxy copies, and image copies associated with a database. For example, you no longer need a database and want to remove all related files from the system. An image copy is a file generated with <code class="codeph">BACKUP AS COPY</code> command, a log archived by the database, or a file cataloged with the <code class="codeph">CATALOG</code> command.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-0F82F489-C5FB-41C2-9687-AE9A5CD89406__GUID-D4F05D76-331B-4B4E-9155-3BC5BB145A2E">To delete all backups and copies:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Start RMAN and connect to a target database and recovery catalog (if used).</span></li>
                        <li class="stepexpand"><span>If necessary, allocate maintenance channels for the devices containing the backups to be deleted.</span><div>
                              <p>As explained in <a href="maintaining-rman-backups.html#GUID-1A707B20-A04E-4D24-9722-605E95158754__CHDDBBIJ" title="This table describes RMAN commands that can delete backups.">Table 12-1</a>, RMAN uses all configured channels to perform the deletion. If channels are configured, then you do not need to manually allocate maintenance channels.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Crosscheck the backups and copies to ensure that the logical records are synchronized with the physical media.</span><div><pre class="pre codeblock"><code>CROSSCHECK BACKUP;
CROSSCHECK COPY;
</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Delete the backups and copies.</span><div>
                              <p>For example, enter the following commands and then enter <code class="codeph">YES</code> when prompted:
                              </p><pre class="pre codeblock"><code>DELETE BACKUP;
DELETE COPY;
</code></pre><p>If disk and tape channels are configured, then RMAN uses both the configured SBT channel and the preconfigured disk channel when deleting. RMAN prompts you for confirmation before deleting any files.</p>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV297"></a><a id="BRADV89634"></a><div class="props_rev_3"><a id="GUID-D39FCF70-C71B-46C7-8ED5-94CF33A5611D" name="GUID-D39FCF70-C71B-46C7-8ED5-94CF33A5611D"></a><h4 id="BRADV-GUID-D39FCF70-C71B-46C7-8ED5-94CF33A5611D" class="sect4"><span class="enumeration_section">12.5.3 </span>Deleting Specified Backups and Copies
                  </h4>
                  <div>
                     <p>You can use both the <code class="codeph">DELETE</code> and <code class="codeph">BACKUP ... DELETE</code> commands to delete specific backups and copies.
                     </p>
                     <div class="section">
                        <p>The <code class="codeph">BACKUP ... DELETE</code> command backs up the files first, typically to tape, and then deletes the input files afterward.
                        </p>
                        <p>The <code class="codeph">DELETE</code> command supports a wide range of options to identify objects to delete. When deleting archived redo logs, RMAN uses the configured settings to determine whether a log can be deleted.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-D39FCF70-C71B-46C7-8ED5-94CF33A5611D__GUID-CAAA59BD-9164-4940-933C-F5435DAC7083">To delete specified backups and copies:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Start RMAN and connect to a target database and recovery catalog (if used).</span></li>
                        <li class="stepexpand"><span>If necessary, allocate maintenance channels for the devices containing the backups to be deleted.</span><div>
                              <p>As explained in <a href="maintaining-rman-backups.html#GUID-1A707B20-A04E-4D24-9722-605E95158754__CHDDBBIJ" title="This table describes RMAN commands that can delete backups.">Table 12-1</a>, RMAN uses all configured channels to perform the deletion. If channels are configured, then you do not need to manually allocate maintenance channels.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Delete the specified backups and copies.</span><div>
                              <p>The following examples show many of the common ways to specify backups and archived logs to delete with the <code class="codeph">DELETE</code> command:
                              </p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>Deleting backups using primary keys from <code class="codeph">LIST</code> output:
                                    </p><pre class="pre codeblock"><code>DELETE BACKUPPIECE 101;
</code></pre></li>
                                 <li>
                                    <p>Deleting backups by file name on disk:</p><pre class="pre codeblock"><code>DELETE CONTROLFILECOPY '/tmp/control01.ctl';
</code></pre></li>
                                 <li>
                                    <p>Deleting archived redo logs:</p><pre class="pre codeblock"><code>DELETE NOPROMPT ARCHIVELOG UNTIL SEQUENCE 300;
</code></pre></li>
                                 <li>
                                    <p>Deleting backups based on tags:</p><pre class="pre codeblock"><code>DELETE BACKUP TAG 'before_upgrade';
</code></pre></li>
                                 <li>
                                    <p>Deleting backups based on the objects backed up and the media or disk location where the backup is stored:</p><pre class="pre codeblock"><code>DELETE BACKUP OF TABLESPACE users DEVICE TYPE sbt; # delete only from tape
DELETE COPY OF CONTROLFILE LIKE '/tmp/%';
</code></pre></li>
                                 <li>
                                    <p>Deleting archived redo logs from disk based on whether they are backed up on tape: </p><pre class="pre codeblock"><code>DELETE ARCHIVELOG ALL 
   BACKED UP 3 TIMES TO sbt;</code></pre><p></p>
                                 </li>
                                 <li>
                                    <p>Deleting backup sets that were backed up twice to tape:</p><pre class="pre codeblock"><code>DELETE BACKUPSET DEVICE TYPE disk BACKED UP 2 TIMES TO sbt;</code></pre></li>
                                 <li>
                                    <p>Deleting backups of the target database that were backed up once to tape:</p><pre class="pre codeblock"><code>DELETE BACKUP OF DATABASE DEVICE TYPE disk BACKED UP 1 TIMES TO sbt;</code></pre></li>
                              </ul>
                           </div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-D39FCF70-C71B-46C7-8ED5-94CF33A5611D__GUID-AF54462F-A006-4381-98F3-9B2747BC0C83">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="configuring-rman-client-basic.html#GUID-FA142760-8ACB-43DA-939C-8407618D2D0F" title="You can use RMAN to create a persistent configuration that governs when archived redo logs are eligible for deletion from disk.">Configuring an Archived Redo Log Deletion Policy</a></p>
                              </li>
                              <li>
                                 <p><a href="../rcmrf/DELETE.html#RCMRF121" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> for complete information about the <code class="codeph">DELETE</code> command options
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div><a id="BRADV89636"></a><div class="props_rev_3"><a id="GUID-4B7E3F2B-25E0-4F66-B34D-E547200DF4AD" name="GUID-4B7E3F2B-25E0-4F66-B34D-E547200DF4AD"></a><h5 id="BRADV-GUID-4B7E3F2B-25E0-4F66-B34D-E547200DF4AD" class="sect5"><span class="enumeration_section">12.5.3.1 </span>Deleting Specified Files with BACKUP ... DELETE
                     </h5>
                     <div>
                        <p>You can use <code class="codeph">BACKUP ... DELETE</code> to back up archived redo logs, data file copies, or backup sets and then delete the input files after successfully backing them up. 
                        </p>
                        <div class="section">
                           <p>Specifying the <code class="codeph">DELETE INPUT</code> option is equivalent to issuing the <code class="codeph">DELETE</code> command for the input files. RMAN uses the configured settings to determine whether an archived redo log can be deleted.The <code class="codeph">ALL</code> option in the <code class="codeph">DELETE ALL INPUT</code> clause applies only to archived redo logs. If you run <code class="codeph">BACKUP ... DELETE ALL INPUT</code>, then the command deletes all copies of corresponding archived redo logs or data file copies that match the selection criteria in the <code class="codeph">BACKUP</code> command.
                           </p>
                           <div class="infoboxnotealso" id="GUID-4B7E3F2B-25E0-4F66-B34D-E547200DF4AD__GUID-80C13516-3875-46D7-84AE-0EA54872600D">
                              <p class="notep1">See Also:</p>
                              <p><a href="configuring-rman-client-basic.html#GUID-FA142760-8ACB-43DA-939C-8407618D2D0F" title="You can use RMAN to create a persistent configuration that governs when archived redo logs are eligible for deletion from disk.">Configuring an Archived Redo Log Deletion Policy</a></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="BRADV300"></a><a id="BRADV89637"></a><div class="props_rev_3"><a id="GUID-ABB66655-6FAC-4375-AFA0-2E40634085A5" name="GUID-ABB66655-6FAC-4375-AFA0-2E40634085A5"></a><h4 id="BRADV-GUID-ABB66655-6FAC-4375-AFA0-2E40634085A5" class="sect4"><span class="enumeration_section">12.5.4 </span>Deleting Expired RMAN Backups and Copies
                  </h4>
                  <div>
                     <p>If you run <code class="codeph">CROSSCHECK</code>, and if RMAN cannot locate the files, then it updates their records in the RMAN repository to <code class="codeph">EXPIRED</code> status. You can then use the <code class="codeph">DELETE EXPIRED</code> command to remove records of expired backups and copies from the RMAN repository.
                     </p>
                     <div class="section">
                        <p>The <code class="codeph">DELETE EXPIRED</code> command issues warnings if any files marked as <code class="codeph">EXPIRED</code> actually exist. In rare cases, the repository can mark a file as <code class="codeph">EXPIRED</code> even though it exists. For example, a directory containing a file is corrupted at the time of the crosscheck, but is later repaired, or the media manager was not configured properly and reported some backups as not existing when they really existed.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-ABB66655-6FAC-4375-AFA0-2E40634085A5__GUID-B793C621-31B3-4D50-BDFC-8E2B57CD79E4">To delete expired repository records:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>If you have not performed a crosscheck recently, then issue a <code class="codeph">CROSSCHECK</code> command. For example, issue:</span><div><pre class="pre codeblock"><code>CROSSCHECK BACKUP;
</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Delete the expired backups. For example, issue:</span><div><pre class="pre codeblock"><code>DELETE EXPIRED BACKUP;</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV89639"></a><div class="props_rev_3"><a id="GUID-DB5F52FF-58DE-4486-B0B3-D0EAEA26A776" name="GUID-DB5F52FF-58DE-4486-B0B3-D0EAEA26A776"></a><h4 id="BRADV-GUID-DB5F52FF-58DE-4486-B0B3-D0EAEA26A776" class="sect4"><span class="enumeration_section">12.5.5 </span>Deleting Obsolete RMAN Backups Based on Retention Policies
                  </h4>
                  <div>
                     <p>The RMAN <code class="codeph">DELETE</code> command supports an <code class="codeph">OBSOLETE</code> option, which deletes backups that are no longer needed to satisfy specified recoverability requirements. 
                     </p>
                     <div class="section">
                        <p>You can delete files that are obsolete according to the configured default retention policy, or another retention policy that you specify as an option to the <code class="codeph">DELETE OBSOLETE</code> command. As with other forms of the <code class="codeph">DELETE</code> command, the files deleted are removed from backup media, deleted from the recovery catalog, and marked as <code class="codeph">DELETED</code> in the control file.
                        </p>
                        <p>If you specify the <code class="codeph">DELETE OBSOLETE</code> command with no arguments, then RMAN deletes all obsolete backups defined by the configured retention policy. For example:
                        </p><pre class="pre codeblock"><code>DELETE OBSOLETE;</code></pre></div>
                     <!-- class="section" -->
                  </div><a id="BRADV89640"></a><div class="props_rev_3"><a id="GUID-74F6BD50-B15F-40C6-95A1-6E8196C2D03F" name="GUID-74F6BD50-B15F-40C6-95A1-6E8196C2D03F"></a><h5 id="BRADV-GUID-74F6BD50-B15F-40C6-95A1-6E8196C2D03F" class="sect5"><span class="enumeration_section">12.5.5.1 </span>DELETE OBSOLETE Behavior When KEEP UNTIL TIME Expires
                     </h5>
                     <div>
                        <p>If the <code class="codeph">KEEP UNTIL TIME</code> period has not expired for an archival backup, RMAN does not consider the backup as obsolete. As soon as the <code class="codeph">KEEP UNTIL</code> period expires, however, the backup is immediately considered to be obsolete, regardless of any configured backup retention policy. Thus, <code class="codeph">DELETE OBSOLETE</code> deletes any backup created with <code class="codeph">BACKUP ... KEEP UNTIL TIME</code> if the <code class="codeph">KEEP</code> time has expired.
                        </p>
                        <div class="infoboxnotealso" id="GUID-74F6BD50-B15F-40C6-95A1-6E8196C2D03F__GUID-FDE903BF-76B8-4689-96BC-3789623DECAB">
                           <p class="notep1">See Also:</p>
                           <p><a href="../rcmrf/keepOption.html#RCMRF131" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> for <span class="italic"><code class="codeph">keepOption</code></span> syntax
                           </p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-89EE05B7-1610-4FE7-BA33-0C212E30420A" name="GUID-89EE05B7-1610-4FE7-BA33-0C212E30420A"></a><h4 id="BRADV-GUID-89EE05B7-1610-4FE7-BA33-0C212E30420A" class="sect4"><span class="enumeration_section">12.5.6 </span>Deleting Backups of Dropped PDBs
                  </h4>
                  <div>
                     <p>Use the <code class="codeph">DELETE</code> command with the <code class="codeph">GUID</code> option to delete backups of pluggable databases (PDBs) that have been dropped from a multitenant container database (CDB).
                     </p>
                     <div class="section">
                        <p>The <code class="codeph">DELETE BACKUP ... OF PLUGGABLE DATABASE</code> command deletes backups of the specified PDB. However, after a PDB is dropped, you cannot use this command because the a PDB with the specified name no longer exists. In such cases, use the <code class="codeph">DELETE BACKUP … GUID</code> command to delete backups of dropped PDBs. Each PDB has a globally unique identifier (GUID) which can be used to uniquely identify a PDB. The GUID of dropped PDBs is available in the <code class="codeph">DBA_PDB_HISTORY</code> view.
                        </p>
                        <p><span class="bold">To delete backups of a dropped PDB:</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Connect to the root as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege.</span></li>
                        <li class="stepexpand"><span>Query the <code class="codeph">DBA_PDB_HISTORY</code> view to determine the GUID of the PDB that was dropped.</span><div>
                              <p>The following example displays the PDBs that were deleted from the CDB <code class="codeph">prod_db</code>:
                              </p><pre class="pre codeblock"><code>SELECT pdb_name, pdb_guid FROM dba_pdb_history
WHERE db_name = 'prod_db';</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Use the <code class="codeph">DELETE</code> command with the <code class="codeph">GUID</code> option to delete backups or copies associated with the dropped PDB.</span><div>
                              <p>The following commands delete backup sets and image copies of a dropped PDB with the specified GUID:</p><pre class="pre codeblock"><code>DELETE BACKUP GUID '100E64EC12445321C0352900AF0FAC93';
DELETE COPY GUID '100E64EC12445321C0352900AF0FAC93';</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-9180E139-6C6E-41C2-8615-D99FC1C2C238" name="GUID-9180E139-6C6E-41C2-8615-D99FC1C2C238"></a><h4 id="BRADV-GUID-9180E139-6C6E-41C2-8615-D99FC1C2C238" class="sect4"><span class="enumeration_section">12.5.7 </span>Deleting Preplugin Backups
                  </h4>
                  <div>
                     <p>Use the <code class="codeph">DELETE</code> command to delete preplugin backups and prelplugin archived redo log files.
                     </p>
                     <div class="section">
                        <p></p>
                     </div>
                     <!-- class="section" -->
                     <div class="p">Ensure that the preplugin backups created on the source database are accessible to the target CDB.</div>
                     <!-- class="section" -->
                     <div class="section"><span class="bold">To delete preplugin backups:</span></div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Start RMAN and connect to the root of the target CDB as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege. Connect to a recovery catalog, if used.</span><div>
                              <p>See <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Ensure that the target CDB is open in read-write mode.</span><div>
                              <p>The following command displays the open mode of the database:</p><pre class="pre codeblock"><code>SELECT OPEN_MODE FROM V$DATABASE;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Set the current container to the PDB whose preplugin backups must be crosschecked.</span><div>
                              <p>The following example sets the preplugin container to the PDB <code class="codeph">my_pdb</code>:
                              </p><pre class="pre codeblock"><code>SET PREPLUGIN CONTAINER=my_pdb;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Run the <code class="codeph">DELETE</code> command to verify the status and availability of preplugin backups.</span><div>
                              <p>The following command deletes preplugin backups of the PDB <code class="codeph">my_pdb</code>.
                              </p><pre class="pre codeblock"><code>DELETE PREPLUGIN BACKUP OF PLUGGABLE DATABASE my_pdb;</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div>
            </div><a id="BRADV612"></a><a id="BRADV89641"></a><div class="props_rev_3"><a id="GUID-45EFE02D-488C-4F55-A648-6FFF5CB7A32F" name="GUID-45EFE02D-488C-4F55-A648-6FFF5CB7A32F"></a><h3 id="BRADV-GUID-45EFE02D-488C-4F55-A648-6FFF5CB7A32F" class="sect3"><span class="enumeration_section">12.6 </span>Dropping a Database
               </h3>
               <div>
                  <p>To remove a database from the operating system, you can use the <code class="codeph">DROP</code> <code class="codeph">DATABASE</code> command in RMAN. RMAN removes the server parameter file, all data files, online redo logs, and control files belonging to the target database.
                  </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-45EFE02D-488C-4F55-A648-6FFF5CB7A32F__GUID-0CFAA00F-2165-4581-B0F7-38866089E00C">To delete a database:</p>
                     <p><code class="codeph">DROP</code> <code class="codeph">DATABASE</code> requires that RMAN be connected to the target database, and that the target database be mounted. The command does not require connection to the recovery catalog. If RMAN is connected to the recovery catalog, and if you specify the option <code class="codeph">INCLUDE</code> <code class="codeph">COPIES</code> <code class="codeph">AND</code> <code class="codeph">BACKUPS</code>, then RMAN also unregisters the database.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>Start RMAN and connect to a target database and recovery catalog (if used).</span><div>
                           <div class="infoboxnotealso" id="GUID-45EFE02D-488C-4F55-A648-6FFF5CB7A32F__GUID-F2AB446A-61BB-44CD-9D17-D3DD98E11CA8">
                              <p class="notep1">See Also:</p>
                              <p><a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a></p>
                           </div>
                        </div>
                     </li>
                     <li class="stepexpand"><span>Catalog all backups that are associated with the database. For example, the following commands catalog files in the fast recovery area, and then in a secondary archiving destination:</span><div><pre class="pre codeblock"><code>CATALOG START WITH '+disk1';    # all files from recovery area on ASM disk
CATALOG START WITH '/arch_dest2';  # all files from second archiving location
</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>Delete all backups and copies associated with the database. For example:</span><div><pre class="pre codeblock"><code>DELETE BACKUPSET; # deletes all backups
DELETE COPY; # deletes all image copies (including archived logs)
</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>Remove the database from the operating system. </span><div>
                           <p>The following command deletes the database and automatically unregisters it from the recovery catalog (if used). RMAN prompts for confirmation.</p><pre class="pre codeblock"><code>DROP DATABASE;</code></pre></div>
                     </li>
                  </ol>
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-45EFE02D-488C-4F55-A648-6FFF5CB7A32F__GUID-9EB81D90-5D86-418E-B992-FA537D5BBA49">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="user-managed-recovery-advanced.html#GUID-834054AF-7189-4CD6-93D4-1CD4EB6BF1F1">Dropping a Database with SQL*Plus</a> to learn how to use the SQL <code class="codeph">DROP</code> <code class="codeph">DATABASE</code> statement
                              </p>
                           </li>
                           <li>
                              <p><a href="../rcmrf/DROP-DATABASE.html#RCMRF190" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> for the RMAN <code class="codeph">DROP DATABASE</code> command syntax
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>