<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Performance Guidelines</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Database SecureFiles and Large Objects Developer's Guide">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Database SecureFiles and Large Objects Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="securefiles-and-large-objects-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-02-12T02:58:18-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96333-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="advanced-design-considerations.html" title="Previous" type="text/html">
      <link rel="next" href="LOB-administration.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="SecureFiles and Large Objects Developer's Guide">
    <meta name="dcterms.isVersionOf" content="ADLOB">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="advanced-design-considerations.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="LOB-administration.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Database SecureFiles and Large Objects Developer's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="application-design-with-LOBs.html" property="item" typeof="WebPage"><span property="name">     Application Design with LOBs</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Performance Guidelines</li>
            </ol>
            <a id="GUID-0EA0E7B7-96E6-4393-B2DA-1F2CA72A72B7" name="GUID-0EA0E7B7-96E6-4393-B2DA-1F2CA72A72B7"></a><a id="ADLOB45549"></a>
            
            <h2 id="ADLOB-GUID-0EA0E7B7-96E6-4393-B2DA-1F2CA72A72B7" class="sect2"><span class="enumeration_chapter">15 </span> Performance Guidelines
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>There are performance guidelines for applications that use LOB data types.</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="performance-guidelines.html#GUID-8505852E-936B-477F-B958-14574BB6EDA4" title="LOB pre-fetching allows to preview initial part of the data or use LOB locator interface to access the stored dataOracle Database allow LOBs to use Data Interface for read and write operations provided the LOB size is smaller than the available buffer size.">LOB Performance Guidelines</a></p>
                  </li>
                  <li>
                     <p><a href="performance-guidelines.html#GUID-40E8C7B6-701A-44B2-9295-B9108BF8F61F">Moving Data to LOBs in a Threaded Environment</a></p>
                  </li>
                  <li>
                     <p><a href="performance-guidelines.html#GUID-5B66CF22-D22C-4218-A8E5-0D97D88A30EE">LOB Access Statistics</a></p>
                  </li>
               </ul>
            </div><a id="ADLOB45550"></a><div class="props_rev_3"><a id="GUID-8505852E-936B-477F-B958-14574BB6EDA4" name="GUID-8505852E-936B-477F-B958-14574BB6EDA4"></a><h3 id="ADLOB-GUID-8505852E-936B-477F-B958-14574BB6EDA4" class="sect3">LOB Performance Guidelines</h3>
               <div>
                  <p>There are various performance guidelines that apply to applications that use LOB data types. </p>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="performance-guidelines.html#GUID-786F32FA-CC8F-45FE-B589-52A3F954569C">All LOBs</a></li>
                        <li><a href="performance-guidelines.html#GUID-5B91B4C3-ADDE-4153-91FF-589692291A03">Persistent LOBs</a></li>
                        <li><a href="performance-guidelines.html#GUID-4E9360AA-C610-4341-AAD3-9DCDF82CF085">Temporary LOBs</a></li>
                     </ul>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-786F32FA-CC8F-45FE-B589-52A3F954569C" name="GUID-786F32FA-CC8F-45FE-B589-52A3F954569C"></a><h4 id="ADLOB-GUID-786F32FA-CC8F-45FE-B589-52A3F954569C" class="sect4">All LOBs</h4>
                  <div>
                     <p></p>
                     <p>This section explains guidelines for using LOBs.</p>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="performance-guidelines.html#GUID-2959491E-25BA-4CE0-9930-7A5DDEB7A78D">Chunk Size</a></li>
                           <li><a href="performance-guidelines.html#GUID-5B89B20C-B438-408B-A5F8-0C4FB447E254">LOB Pre-fetching</a></li>
                           <li><a href="performance-guidelines.html#GUID-E6412006-5298-49B8-B4ED-AC63E31E735D">Small LOBs</a></li>
                           <li><a href="performance-guidelines.html#GUID-D513CBA3-ED2F-461B-AF20-CCF02E069429">Large LOBs</a></li>
                        </ul>
                     </div>
                  </div><a id="ADLOB45551"></a><div class="props_rev_3"><a id="GUID-2959491E-25BA-4CE0-9930-7A5DDEB7A78D" name="GUID-2959491E-25BA-4CE0-9930-7A5DDEB7A78D"></a><h5 id="ADLOB-GUID-2959491E-25BA-4CE0-9930-7A5DDEB7A78D" class="sect5">Chunk Size</h5>
                     <div>
                        <p>A chunk is one or more Oracle blocks. You can specify the chunk size for the LOB when creating the table that contains the LOB. </p>
                        <p>This corresponds to the data size used by Oracle Database when accessing or modifying the LOB value. Part of the chunk is used to store system-related information and the rest stores the LOB value. The API you are using has a function that returns the amount of space used in the LOB chunk to store the LOB value. In PL/SQL use <code class="codeph">DBMS_LOB.GETCHUNKSIZE</code>. In OCI, use <code class="codeph">OCILobGetChunkSize()</code>. For SecureFiles, the usable data area of the tablespace block size is returned.
                        </p>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-5B89B20C-B438-408B-A5F8-0C4FB447E254" name="GUID-5B89B20C-B438-408B-A5F8-0C4FB447E254"></a><h5 id="ADLOB-GUID-5B89B20C-B438-408B-A5F8-0C4FB447E254" class="sect5">LOB Pre-fetching</h5>
                     <div>
                        <p>LOB pre-fetching allows to preview initial part of the data or use LOB locator interface to access the stored data</p>
                        <p>LOB pre-fetching allows to perform the following operations:</p>
                        <div class="p">
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Preview the initial part of the data</p>
                              </li>
                              <li>
                                 <p>Use the locator interface to access the stored data</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>Related Topics</strong></p>
                           <ul>
                              <li><a href="overview-of-supplied-LOB-APIs.html#GUID-2DF37952-AD10-461B-8398-458EAE37BF47">Prefetching of LOB Data, Length, and Chunk Size</a></li>
                              <li><a href="overview-of-supplied-LOB-APIs.html#GUID-2F5DB980-31B8-4BCE-883C-C93135D8B6C7">Prefetching LOBs to Improve Performance</a></li>
                           </ul>
                        </div>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-E6412006-5298-49B8-B4ED-AC63E31E735D" name="GUID-E6412006-5298-49B8-B4ED-AC63E31E735D"></a><h5 id="ADLOB-GUID-E6412006-5298-49B8-B4ED-AC63E31E735D" class="sect5">Small LOBs</h5>
                     <div>
                        <p>Oracle Database allow LOBs to use Data Interface for read and write operations provided the LOB size is smaller than the available buffer size.</p>
                        <p>Oracle Database allow LOBs to use Data Interface for data read and write operations if the LOB size is smaller than the available buffer size.</p>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>Related Topics</strong></p>
                           <ul>
                              <li><a href="data-interface-for-persistent-LOBs.html#GUID-4BFDD493-F3FE-451C-9B03-21669D635586">Data Interface for Persistent LOBs</a></li>
                           </ul>
                        </div>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-D513CBA3-ED2F-461B-AF20-CCF02E069429" name="GUID-D513CBA3-ED2F-461B-AF20-CCF02E069429"></a><h5 id="ADLOB-GUID-D513CBA3-ED2F-461B-AF20-CCF02E069429" class="sect5">Large LOBs</h5>
                     <div>
                        <p></p>
                        <p>Starting from Oracle Database 19c release, piecewise or callback mechanism can be used for OCILobRead and OCILobWrite operations.</p>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-5B91B4C3-ADDE-4153-91FF-589692291A03" name="GUID-5B91B4C3-ADDE-4153-91FF-589692291A03"></a><h4 id="ADLOB-GUID-5B91B4C3-ADDE-4153-91FF-589692291A03" class="sect4">Persistent LOBs</h4>
                  <div></div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="performance-guidelines.html#GUID-05BECDAD-4166-4BEF-832D-47FA78BED2E7">Performance Guidelines for Small BasicFiles LOBs</a></li>
                           <li><a href="performance-guidelines.html#GUID-D895BC0B-A450-4B58-B05C-8EC631F38455">General Performance Guidelines for BasicFiles LOBs</a></li>
                        </ul>
                     </div>
                  </div><a id="ADLOB45552"></a><div class="props_rev_3"><a id="GUID-05BECDAD-4166-4BEF-832D-47FA78BED2E7" name="GUID-05BECDAD-4166-4BEF-832D-47FA78BED2E7"></a><h5 id="ADLOB-GUID-05BECDAD-4166-4BEF-832D-47FA78BED2E7" class="sect5">Performance Guidelines for Small BasicFiles LOBs </h5>
                     <div>
                        <p>If most LOBs in your database tables are small in size, use these guidelines. </p>
                        <p>For LOBs in your database tables that are 8K bytes or less, with only a few rows containing LOBs larger than 8K bytes, then use these guidelines to maximize database performance: </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Use <code class="codeph">ENABLE STORAGE IN ROW</code>.
                              </p>
                           </li>
                           <li>
                              <p>Set the <code class="codeph">DB_BLOCK_SIZE</code> initialization parameter to 8K bytes and use a chunk size of 8K bytes.
                              </p>
                           </li>
                           <li>
                              <div class="infoboxnotealso" id="GUID-05BECDAD-4166-4BEF-832D-47FA78BED2E7__NOTE-12332-DFE38D42">
                                 <p class="notep1">See Also:</p>
                                 <p><a href="LOB-storage-with-applications.html#GUID-517E1234-EFCD-4D16-B69B-23F72A18A77D">LOB Storage Parameters</a> for more information on tuning other parameters such as <code class="codeph">CACHE,</code> <code class="codeph">PCTVERSION</code>, and <code class="codeph">CHUNK</code> for the LOB segment
                                 </p>
                              </div>
                           </li>
                        </ul>
                     </div>
                  </div><a id="ADLOB45553"></a><div class="props_rev_3"><a id="GUID-D895BC0B-A450-4B58-B05C-8EC631F38455" name="GUID-D895BC0B-A450-4B58-B05C-8EC631F38455"></a><h5 id="ADLOB-GUID-D895BC0B-A450-4B58-B05C-8EC631F38455" class="sect5">General Performance Guidelines for BasicFiles LOBs</h5>
                     <div>
                        <p>You can achieve maximum performance with BasicFiles LOBs. </p>
                        <p>Use these guidelines for maximum performance with BasicFiles LOBs:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>When Possible, Read/Write <a id="d83472e780" class="indexterm-anchor"></a><a id="d83472e784" class="indexterm-anchor"></a><a id="d83472e786" class="indexterm-anchor"></a>Large Data Chunks at a Time: 
                              </p>
                              <p>Because LOBs are big, you can obtain the best performance by reading and writing large pieces of a LOB value at a time. This helps in several respects: </p>
                              <ol>
                                 <li>
                                    <p>If accessing the LOB from the client side and the client is at a different node than the server, then large reads/writes reduce network overhead. </p>
                                 </li>
                                 <li>
                                    <p>If using the <code class="codeph">NOCACHE</code> option, then each small read/write incurs an I/O. Reading/writing large quantities of data reduces the I/O. 
                                    </p>
                                 </li>
                                 <li>
                                    <p>Writing to the LOB creates a new version of the LOB chunk. Therefore, writing small amounts at a time incurs the cost of a new version for each small write. If logging is on, then the chunk is also stored in the redo log. </p>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>Use <code class="codeph">OCILobRead2()</code> and <code class="codeph">OCILobWrite2()</code> with Callback: 
                              </p>
                              <p>So that data is streamed to and from the LOB. Ensure the length of the entire write is set in the <code class="codeph">amount</code> parameter on input. Whenever possible, read and write in <span class="italic">multiples</span> of the LOB <span class="italic">chunk</span> size. 
                              </p>
                           </li>
                           <li>
                              <p>Use a Checkout/Check-in Model for LOBs:</p>
                              <p>LOBs are optimized for the following operations: </p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>SQL <code class="codeph">UPDATE</code> which replaces the entire LOB value 
                                    </p>
                                 </li>
                                 <li>
                                    <p>Copy the entire LOB data to the client, modify the LOB data on the client side, copy the entire LOB data back to the database. This can be done using <code class="codeph">OCILobRead2</code>() and <code class="codeph">OCILobWrite2</code>() with streaming.
                                    </p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>Commit changes frequently. </p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="ADLOB106"></a><a id="ADLOB105"></a><div class="props_rev_3"><a id="GUID-4E9360AA-C610-4341-AAD3-9DCDF82CF085" name="GUID-4E9360AA-C610-4341-AAD3-9DCDF82CF085"></a><h4 id="ADLOB-GUID-4E9360AA-C610-4341-AAD3-9DCDF82CF085" class="sect4">Temporary LOBs</h4>
                  <div>
                     <p>In addition to the guidelines described in <span class="q">"<a href="performance-guidelines.html#GUID-8505852E-936B-477F-B958-14574BB6EDA4" title="LOB pre-fetching allows to preview initial part of the data or use LOB locator interface to access the stored dataOracle Database allow LOBs to use Data Interface for read and write operations provided the LOB size is smaller than the available buffer size.">LOB Performance Guidelines</a>"</span> on LOB performance in general, here are some guidelines for using temporary LOBs: 
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Use PGA memory to store temporary LOBs for improved performance.</p>
                        </li>
                        <li>
                           <p>Use a separate temporary tablespace for temporary LOB storage instead of the default system tablespace </p>
                           <p>This avoids device contention when copying data from persistent LOBs to temporary LOBs. </p>
                           <p>If you use the newly provided enhanced SQL semantics functionality in your applications, then there are many more temporary LOBs created silently in SQL and PL/SQL than before. Ensure that <span class="italic"><span class="bold">temporary tablespace</span></span> for storing these temporary LOBs is<span class="italic"><span class="bold"> large enough</span></span> for your applications. In particular, these temporary LOBs are silently created when you use the following:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>SQL functions on LOBs</p>
                              </li>
                              <li>
                                 <p>PL/SQL built-in character functions on LOBs</p>
                              </li>
                              <li>
                                 <p>Variable assignments from <code class="codeph">VARCHAR2</code>/<code class="codeph">RAW</code> to <code class="codeph">CLOB</code>s/<code class="codeph">BLOB</code>s, respectively. 
                                 </p>
                              </li>
                              <li>
                                 <p>Perform a <code class="codeph">LONG</code>-to-<code class="codeph">LOB</code> migration 
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>If SQL operators are used on LOBs, the PGA memory and temporary tablespace must be large enough to accommodate the temporary LOBs generated by SQL operators.</p>
                        </li>
                        <li>
                           <p>Free up temporary LOBs returned from SQL queries and PL/SQL programs</p>
                           <p>In PL/SQL, C (OCI), Java and other programmatic interfaces, SQL query results or PL/SQL program executions return temporary LOBs for operation/function calls on LOBs. For example: </p><pre class="oac_no_warn" dir="ltr">SELECT substr(CLOB_Column, 4001, 32000) FROM ... 
</pre><p>If the query is executed in PL/SQL, then the returned temporary LOBs are automatically freed at the end of a PL/SQL program block. You can also explicitly free the temporary LOBs at any time. In OCI and Java, the returned temporary LOB must be explicitly freed. </p>
                           <p>Without proper deallocation of the temporary LOBs returned from SQL queries, temporary tablespace is filled and you may observe performance degradation. </p>
                        </li>
                        <li>
                           <p>In PL/SQL, use <a id="d83472e990" class="indexterm-anchor"></a>NOCOPY to pass temporary LOB parameters by reference whenever possible. 
                           </p>
                           <div class="infoboxnotealso" id="GUID-4E9360AA-C610-4341-AAD3-9DCDF82CF085__NOTE-12223-DFE41FBA">
                              <p class="notep1">See Also:</p>
                              <p><a href="../lnpls/overview.html#LNPLS-GUID-2FBCFBBE-6B42-4DB8-83F3-55B63B75B1EB" target="_blank"><span><cite>Oracle Database PL/SQL Language Reference</cite></span></a>for more information on passing parameters by reference and parameter aliasing
                              </p>
                           </div>
                        </li>
                        <li>
                           <p>Take advantage of buffer cache on temporary LOBs.</p>
                           <p> <a id="d83472e1006" class="indexterm-anchor"></a><a id="d83472e1010" class="indexterm-anchor"></a><a id="d83472e1014" class="indexterm-anchor"></a>Temporary LOBs created with the CACHE parameter set to true move through the buffer cache. Otherwise temporary LOBs are read directly from, and written directly to, disk. 
                           </p>
                        </li>
                        <li>
                           <p>For optimal performance, temporary LOBs use reference on read, copy on write semantics. When a temporary LOB locator is assigned to another locator, the physical LOB data is not copied. Subsequent READ operations using either of the LOB locators refer to the same physical LOB data. On the first WRITE operation after the assignment, the physical LOB data is copied in order to preserve LOB value semantics, that is, to ensure that each locator points to a unique LOB value. This performance consideration mainly applies to the PL/SQL and OCI environments. </p>
                           <p>In PL/SQL, reference on read, copy on write semantics are illustrated as follows:</p><pre class="oac_no_warn" dir="ltr">
LOCATOR1 BLOB; 
LOCATOR2 BLOB; 
DBMS_LOB.CREATETEMPORARY (LOCATOR1,TRUE,DBMS_LOB.SESSION); 

-- LOB data is not copied in this assignment operation:  
LOCATOR2 := LOCATOR;  
-- These read operations refer to the same physical LOB copy: 
DBMS_LOB.READ(LOCATOR1, ...); 
DBMS_LOB.GETLENGTH(LOCATOR2, ...); 

-- A physical copy of the LOB data is made on WRITE:  
DBMS_LOB.WRITE(LOCATOR2, ...); 
</pre><p>In OCI, to ensure value semantics of LOB locators and data, <code class="codeph">OCILobLocatorAssign()</code> is used to copy temporary LOB locators and the LOB Data. <code class="codeph">OCILobLocatorAssign()</code> does not make a round trip to the server. The physical temporary LOB copy is made when LOB updates happen in the same round trip as the LOB update API as illustrated in the following: 
                           </p><pre class="oac_no_warn" dir="ltr">
OCILobLocator *LOC1;
OCILobLocator *LOC2;
OCILobCreateTemporary(... LOC1, ... TRUE,OCI_DURATION_SESSION);

/* No round-trip is incurred in the following call. */
OCILobLocatorAssign(... LOC1, LOC2);

/* Read operations refer to the same physical LOB copy. */
OCILobRead2(... LOC1 ...)

/* One round-trip is incurred to make a new copy of the
 * LOB data and to write to the new LOB copy.
 */
OCILobWrite2(... LOC1 ...)

/* LOC2 does not see the same LOB data as LOC1. */
OCILobRead2(... LOC2 ...)

</pre><p>If LOB value semantics are not intended, then you can use C pointers to achieve reference semantics as illustrated in the following: </p><pre class="oac_no_warn" dir="ltr">OCILobLocator *LOC1;
OCILobLocator *LOC2;
OCILobCreateTemporary(... LOC1, ... TRUE,OCI_DURATION_SESSION);

/* Pointer is copied. LOC1 and LOC2 refer to the same LOB data. */
LOC2 = LOC1;

/* Write to LOC2. */
OCILobWrite2(...LOC2...)

/* LOC1 sees the change made to LOC2. */
OCILobRead2(...LOC1...)
</pre></li>
                        <li>
                           <p>Use OCI_OBJECT mode for temporary LOBs</p>
                           <p>To improve the performance of temporary LOBs on LOB assignment, use <code class="codeph">OCI_OBJECT</code> mode for <code class="codeph">OCILobLocatorAssign()</code>. In <code class="codeph">OCI_OBJECT</code> mode, the database tries to minimize the number of deep copies to be done. Hence, after <code class="codeph">OCILobLocatorAssign()</code> is done on a source temporary LOB in <code class="codeph">OCI_OBJECT</code> mode, the source and the destination locators point to the same LOB until any modification is made through either LOB locator.
                           </p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div><a id="ADLOB45556"></a><a id="ADLOB45557"></a><a id="ADLOB45555"></a><div class="props_rev_3"><a id="GUID-40E8C7B6-701A-44B2-9295-B9108BF8F61F" name="GUID-40E8C7B6-701A-44B2-9295-B9108BF8F61F"></a><h3 id="ADLOB-GUID-40E8C7B6-701A-44B2-9295-B9108BF8F61F" class="sect3">Moving Data to LOBs in a Threaded Environment</h3>
               <div>
                  <p>There are two possible procedures that you can use to move data to LOBs in a threaded environment, one of which should be avoided.</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-40E8C7B6-701A-44B2-9295-B9108BF8F61F__GUID-B179BBED-4F7E-4250-8778-12327443478A">Recommended Procedure</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <div class="infoboxnote" id="GUID-40E8C7B6-701A-44B2-9295-B9108BF8F61F__GUID-262E3250-3717-41A1-88F6-76678921E716">
                        <p class="notep1">Note:</p>
                        <p></p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>There is no requirement to create an empty LOB in this procedure. </p>
                           </li>
                           <li>
                              <p>You can use the <code class="codeph">RETURNING</code> clause as part of the <code class="codeph">INSERT/UPDATE</code> statement to return a locked LOB locator. This eliminates the need for doing a <code class="codeph">SELECT-FOR-UPDATE</code>, as mentioned in step 3. 
                              </p>
                           </li>
                        </ul>
                     </div>
                     <p>The recommended procedure is as follows:</p>
                     <ol>
                        <li>
                           <p><code class="codeph">INSERT</code> an empty LOB, <code class="codeph">RETURNING</code> the LOB locator.
                           </p>
                        </li>
                        <li>
                           <p>Move data into the LOB using this locator.</p>
                        </li>
                        <li>
                           <p><code class="codeph">COMMIT</code>. This releases the ROW locks and makes the LOB data persistent.
                           </p>
                        </li>
                     </ol>
                     <p>Alternatively, you can insert more than 4000 bytes of data directly for the LOB columns or LOB attributes.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-40E8C7B6-701A-44B2-9295-B9108BF8F61F__GUID-B9DE57EA-9A65-4E80-9DB2-26F54460BF1E">Procedure to Avoid</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>The following sequence requires a new connection when using a threaded environment, adversely affects performance, and is not recommended: </p>
                     <ol>
                        <li>
                           <p>Create an empty (non-<code class="codeph">NULL</code>) LOB 
                           </p>
                        </li>
                        <li>
                           <p>Perform <code class="codeph">INSERT</code> using the empty LOB 
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">SELECT-FOR-UPDATE</code> of the row just entered 
                           </p>
                        </li>
                        <li>
                           <p>Move data into the LOB </p>
                        </li>
                        <li>
                           <p><code class="codeph">COMMIT</code>. This releases the <code class="codeph">ROW</code> locks and makes the LOB data persistent.
                           </p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="ADLOB0710"></a><div class="props_rev_3"><a id="GUID-5B66CF22-D22C-4218-A8E5-0D97D88A30EE" name="GUID-5B66CF22-D22C-4218-A8E5-0D97D88A30EE"></a><h3 id="ADLOB-GUID-5B66CF22-D22C-4218-A8E5-0D97D88A30EE" class="sect3">LOB Access Statistics</h3>
               <div>
                  <p>After Oracle Database 10<span class="italic">g</span> Release 2, three session-level statistics specific to LOBs are available to users: LOB reads, LOB writes, and LOB writes unaligned. 
                  </p>
                  <p>Session statistics are accessible through the <code class="codeph">V$MYSTAT</code>, <code class="codeph">V$SESSTAT</code>, and <code class="codeph">V$SYSSTAT</code> dynamic performance views. To query these views, the user must be granted the privileges <code class="codeph">SELECT_CATALOG_ROLE</code>, <code class="codeph">SELECT ON SYS.V_$MYSTAT</code> view, and <code class="codeph">SELECT ON SYS.V_$STATNAME</code> view.
                  </p>
                  <p><a id="d83472e1302" class="indexterm-anchor"></a><a id="d83472e1304" class="indexterm-anchor"></a><a id="d83472e1306" class="indexterm-anchor"></a>LOB reads is defined as the number of LOB API read operations performed in the session/system. A single LOB API read may correspond to multiple physical/logical disk block reads.
                  </p>
                  <p>LOB writes is defined as the number of LOB API write operations performed in the session/system. A single LOB API write may correspond to multiple physical/logical disk block writes.</p>
                  <p>LOB writes unaligned is defined as the number of LOB API write operations whose start offset or buffer size is not aligned to the internal chunk size of the LOB. Writes aligned to chunk boundaries are the most efficient write operations. The internal chunk size of a LOB is available through the LOB API (for example, using PL/SQL, by <code class="codeph">DBMS_LOB.GETCHUNKSIZE()</code>).
                  </p>
                  <p>The following simple example demonstrates how LOB session statistics are updated as the user performs read/write operations on LOBs.</p>
                  <p>It is important to note that session statistics are aggregated across operations to all LOBs accessed in a session; the statistics are not separated or categorized by objects (that is, table, column, segment, object numbers, and so on). </p>
                  <p>In these examples, you reconnect to the database for each demonstration to clear the <code class="codeph">V$MYSTAT</code>. This enables you to see how the lob statistics change for the specific operation you are testing, without the potentially obscuring effect of past LOB operations within the same session.
                  </p>
                  <div class="infoboxnote" id="GUID-5B66CF22-D22C-4218-A8E5-0D97D88A30EE__GUID-5FA04D0B-03B2-4E3F-A81D-3DB21C2485CA">
                     <p class="notep1">See also:</p>
                     <p><a href="../refrn/statistics-descriptions.html#REFRN103" target="_blank"><span class="italic">Oracle Database Reference</span></a>, appendix E, "Statistics Descriptions"
                     </p>
                  </div>
               </div><a id="ADLOB45558"></a><div class="props_rev_3"><a id="GUID-C8AD5DF4-BA4F-411E-B2A7-B58C355F3790" name="GUID-C8AD5DF4-BA4F-411E-B2A7-B58C355F3790"></a><h4 id="ADLOB-GUID-C8AD5DF4-BA4F-411E-B2A7-B58C355F3790" class="sect4">Example of Retrieving LOB Access Statistics</h4>
                  <div>
                     <div class="section">
                        <p>This example demonstrates retrieving LOB access statistics.</p><pre class="oac_no_warn" dir="ltr">rem
rem Set up the user
rem
 
CONNECT / AS SYSDBA;
SET ECHO ON; 
GRANT SELECT_CATALOG_ROLE TO pm;
GRANT SELECT ON sys.v_$mystat TO pm;
GRANT SELECT ON sys.v_$statname TO pm;
 
rem
rem Create a simplified view for statistics queries
rem
 
CONNECT pm;
SET ECHO ON;
 
DROP VIEW mylobstats;
CREATE VIEW mylobstats
AS
SELECT  SUBSTR(n.name,1,20) name,
        m.value             value
FROM    v$mystat    m,
        v$statname  n
WHERE   m.statistic# = n.statistic#
    AND n.name LIKE 'lob%';
 
rem
rem Create a test table
rem
 
DROP TABLE t;
CREATE TABLE t (i NUMBER, c CLOB)
    lob(c) STORE AS (DISABLE STORAGE IN ROW);
 
rem
rem Populate some data
rem
rem This should result in unaligned writes, one for
rem each row/lob populated.
rem

CONNECT pm
SELECT * FROM mylobstats;
INSERT INTO t VALUES (1, 'a');
INSERT INTO t VALUES (2, rpad('a',4000,'a'));
COMMIT;
SELECT * FROM mylobstats;
 
rem
rem Get the lob length
rem
rem Computing lob length does not read lob data, no change
rem in read/write stats.
rem
 
CONNECT pm;
SELECT * FROM mylobstats;
SELECT LENGTH(c) FROM t;
SELECT * FROM mylobstats;
 
rem
rem Read the lobs
rem
rem Lob reads are performed, one for each lob in the table.
rem
 
CONNECT pm;
SELECT * FROM mylobstats;
SELECT * FROM t;
SELECT * FROM mylobstats;
 
rem
rem Read and manipulate the lobs (through temporary lobs)
rem
rem The use of complex operators like "substr()" results in
rem the implicit creation and use of temporary lobs. operations
rem on temporary lobs also update lob statistics.
rem
 
CONNECT pm;
SELECT * FROM mylobstats;
SELECT substr(c, length(c), 1) FROM t;
SELECT substr(c, 1, 1) FROM t;
SELECT * FROM mylobstats;
 
rem
rem Perform some aligned overwrites
rem
rem Only lob write statistics are updated because both the
rem byte offset of the write, and the size of the buffer
rem being written are aligned on the lob chunksize.
rem
 
CONNECT pm;
SELECT * FROM mylobstats;
DECLARE
    loc     CLOB;
    buf     LONG;
    chunk   NUMBER;
BEGIN
    SELECT c INTO loc FROM t WHERE i = 1
        FOR UPDATE;
 
    chunk := DBMS_LOB.GETCHUNKSIZE(loc);
    buf   := rpad('b', chunk, 'b');
 
    -- aligned buffer length and offset
    DBMS_LOB.WRITE(loc, chunk, 1, buf);
    DBMS_LOB.WRITE(loc, chunk, 1+chunk, buf);
    COMMIT;
END;
/
SELECT * FROM mylobstats;
 
rem
rem Perform some unaligned overwrites
rem 
rem Both lob write and lob unaligned write statistics are
rem updated because either one or both of the write byte offset
rem and buffer size are unaligned with the lob's chunksize.
rem 
 
CONNECT pm;
SELECT * FROM mylobstats;
DECLARE
    loc CLOB;
    buf LONG;
BEGIN
    SELECT c INTO loc FROM t WHERE i = 1
        FOR UPDATE;
 
    buf := rpad('b', DBMS_LOB.GETCHUNKSIZE(loc), 'b');
 
    -- unaligned buffer length
    DBMS_LOB.WRITE(loc, DBMS_LOB.GETCHUNKSIZE(loc)-1, 1, buf);
 
    -- unaligned start offset
    DBMS_LOB.WRITE(loc, DBMS_LOB.GETCHUNKSIZE(loc), 2, buf);
 
    -- unaligned buffer length and start offset
    DBMS_LOB.WRITE(loc, DBMS_LOB.GETCHUNKSIZE(loc)-1, 2, buf);
 
    COMMIT;
END;
/
SELECT * FROM mylobstats;
DROP TABLE t;
DROP VIEW mylobstats;
 
CONNECT / AS SYSDBA
REVOKE SELECT_CATALOG_ROLE FROM pm;
REVOKE SELECT ON sys.v_$mystat FROM pm;
REVOKE SELECT ON sys.v_$statname FROM pm;
 
QUIT;
</pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>