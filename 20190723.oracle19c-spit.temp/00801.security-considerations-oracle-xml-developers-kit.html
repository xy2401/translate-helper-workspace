<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="The security measures to be taken when using software programs that are built using XDK are explained in this chapter.">
      <meta name="description" content="The security measures to be taken when using software programs that are built using XDK are explained in this chapter.">
      <title>Security Considerations for Oracle XML Developer's Kit</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Programmer's Guide">
      <meta property="og:description" content="The security measures to be taken when using software programs that are built using XDK are explained in this chapter.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Programmer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="xml-developers-kit-programmers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-11T05:58:48-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2001, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96292-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="introduction-to-XDK.html" title="Previous" type="text/html">
      <link rel="next" href="XDK-for-C.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="XML Developers Kit Programmers Guide">
    <meta name="dcterms.isVersionOf" content="ADXDK">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="introduction-to-XDK.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="XDK-for-C.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Programmer's Guide</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Security Considerations for Oracle XML Developer's Kit</li>
            </ol>
            <a id="GUID-5BA0F90B-4B43-49E3-B7F0-700A7755689B" name="GUID-5BA0F90B-4B43-49E3-B7F0-700A7755689B"></a>
            
            <h2 id="ADXDK-GUID-5BA0F90B-4B43-49E3-B7F0-700A7755689B" class="sect2"><span class="enumeration_chapter">2 </span>Security Considerations for Oracle XML Developer's Kit
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>The security measures to be taken when using software programs that are built using XDK are explained in this chapter.</p>
            </div>
            <div class="sect2"><a id="GUID-8AEC58C0-3E65-417E-AB46-EA5E505F86FC" name="GUID-8AEC58C0-3E65-417E-AB46-EA5E505F86FC"></a><h3 id="ADXDK-GUID-8AEC58C0-3E65-417E-AB46-EA5E505F86FC" class="sect3">Implementing Security for Java</h3>
               <div>
                  <p>The process to implement security for Java programs.</p>
               </div>
               <div class="sect3"><a id="GUID-A1547226-6486-4F0D-AE23-E21B4510D61A" name="GUID-A1547226-6486-4F0D-AE23-E21B4510D61A"></a><h4 id="ADXDK-GUID-A1547226-6486-4F0D-AE23-E21B4510D61A" class="sect4">Securing XSLT Processing with Oracle XML Developer's Kit</h4>
                  <div>
                     <p>Before using Oracle XML Developer’s Kit for XSLT processing you need to secure it by setting some configuration options.</p>
                     <div class="section">
                        <p>You must enable secure processing for both the <code class="codeph">XSLProcessor</code> API and the JAXP transformer API, as follows.
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Use this Java code to enable the secure processing mode for <code class="codeph">XSLProcessor</code>:
                              </p><pre class="pre codeblock"><code>processor.setAttribute(XMLConstants.FEATURE_SECURE_PROCESSING, Boolean.TRUE);&nbsp;</code></pre></li>
                           <li>
                              <p>Use this Java code to enable the secure processing mode for <code class="codeph">SAXTransformerFactory</code> of the JAXP transformer API:
                              </p><pre class="pre codeblock"><code>factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);&nbsp;</code></pre></li>
                        </ul>
                        <p>Together, those settings improve XML-parsing security in the following ways:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>The settings block access to external resources, by default. </p>
                              <p>Developers can then use <code class="codeph">org.xml.sax.EntityResolver</code> or <code class="codeph">javax.xml.transform.URIResolver</code> to resolve <code class="codeph">include</code> and <code class="codeph">import</code> elements in an XSL stylesheet. They can use Java interface <code class="codeph">URIResolver</code> to provide XPath or XSLT functions access to trusted external resources.
                              </p>
                           </li>
                           <li>
                              <p>The settings block the use of Java reflection to execute Java code.</p>
                              <p>Developers can convert trusted Java classes to interface <code class="codeph">javax.xml.xpath.XPathFunction</code> and use interface <code class="codeph">javax.xml.xpath.XPathFunctionResolver</code> to resolve them.
                              </p>
                           </li>
                           <li>
                              <p>The settings limit recursive entity expansion.</p>
                              <p>This helps avoid a common denial-of-service attack from excessive resource consumption.</p>
                              <div class="infoboxnote" id="GUID-A1547226-6486-4F0D-AE23-E21B4510D61A__GUID-1E8F8EC7-D599-4A68-A3F3-C3AC36CD4D77">
                                 <p class="notep1">Note:</p>
                                 <p>Although this can limit recursive entity <span class="italic">expansion</span>, XDK cannot limit resource consumption during XML transformation. An XSL stylesheet can include an infinite loop or otherwise consume resources extravagantly. For this reason, XSL stylesheets must not be accepted from untrusted sources or external entities. <span class="italic">Test all stylesheets used</span>, to ensure that they do not consume excessive resources.
                                 </p>
                              </div>
                           </li>
                        </ul>
                        <p>In addition, Oracle recommends that all code that performs XSLT processing of data or files obtained from users or from external, untrusted entities check that secure processing is enabled for both the XSLProcessor API and the JAXP transformer API. Not doing this opens a security vulnerability. After the XSL processor has been secured, accessing external resources and running Java extension functions is not allowed.</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-A1547226-6486-4F0D-AE23-E21B4510D61A__GUID-7F1DC426-BBF6-4DEA-8873-10E4EB4BCCD6">Arbitrary Security Exemptions</p>
                        <p>If you want to arbitrarily override security restrictions, you can use the following options:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Perform any of the following modifications to allow access to some external sources:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>Set <code class="codeph">URIResolver</code> to either <code class="codeph">SAXTransformerFactory</code> or <code class="codeph">XSLProcessor</code>, using the method <code class="codeph">setURIResolver()</code>.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Set <code class="codeph">EntityResolver</code> to <code class="codeph">XSLProcessor</code> using the method <code class="codeph">setEntityResolver()</code>.
                                    </p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>Use the Java interface <code class="codeph">oracle.xml.xslt.XSLSecurityManager</code> to register a whitelist of Java classes and methods with which you can use Java reflection extension functions.
                              </p>
                           </li>
                           <li>
                              <p>Register <code class="codeph">XSLSecurityManager</code> using the <code class="codeph">XSLProcessor</code> method <code class="codeph">setAttribute()</code> to run an extension function that you know to be safe:
                              </p><pre class="pre codeblock"><code>processor.setAttribute(XSLProcessor.SECURITY_MANAGER, securityManager);</code></pre></li>
                           <li>
                              <p>Use a simple API on <code class="codeph">XSLSecurityManager</code> to implement a whitelist of Java classes and methods:
                              </p><pre class="pre codeblock"><code>boolean checkExtensionFunction(String className, String fnName);</code></pre></li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-45303542-41DE-4455-93B3-854A826EF8BB" name="GUID-45303542-41DE-4455-93B3-854A826EF8BB"></a><h4 id="ADXDK-GUID-45303542-41DE-4455-93B3-854A826EF8BB" class="sect4">Using the Oracle XML Parser Safely</h4>
                  <div>
                     <p>Like many XML parsers, by default the XDK parser tries to resolve external references. An attacker can exploit this behavior to perform XML External Entity (XXE) and XML Entity Expansion (XEE) attacks. To avoid this vulnerability, disable the use of arbitrary references to external resources, and disable unconstrained entity expansion. </p>
                     <div class="section">
                        <p>To implement a global security setting, which blocks all parsers that are created within the system from using external entities, set the Java system property <code class="codeph">oracle.xdkjava.security.resolveEntityDefault</code> to <code class="codeph">false</code>.
                        </p>
                        <p>To block entity expansion for a particular parser, or to limit the number of levels of entity expansion, set the attribute <code class="codeph">XMLParser.RESOLVE_ENTITY_DEFAULT</code>, or <code class="codeph">XMLParser.ENTITY_EXPANSION_DEPTH</code> to the parser. 
                        </p>
                        <p>For example:</p><pre class="pre codeblock"><code>DOMParser domParser = new DOMParser();&nbsp;// Extend oracle.xml.parser.v2.XMLParser
domParser.setAttribute(DOMParser.EXPAND_ENTITYREF, false); // Do not&nbsp; expand entity references
domParser.setAttribute(DOMParser.DTD_OBJECT, dtdObj);&nbsp;&nbsp;// dtdObj is an instance of oracle.xml.parser.v2.DTD
domParser.setAttribute(DOMParser.ENTITY_EXPANSION_DEPTH, 12); // Do not allow more than 11 levels of entity expansion</code></pre><p>If you use JAXP to enable XML parsing, then set <code class="codeph">FEATURE_SECURE_PROCESSING</code> to <code class="codeph">true</code> for <code class="codeph">DocumentBuilderFactory</code> or <code class="codeph">SAXParserFactor</code>. This blocks the expansion of external entities, limits entity expansion to a depth of 11, and limits the entity expansion count to 64000.
                        </p><pre class="pre codeblock"><code>my_factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);</code></pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-45303542-41DE-4455-93B3-854A826EF8BB__GUID-67C20A07-6A63-48D3-B2E2-0F48C20C6CBD">
                           <p class="notep1">See Also:</p>
                           <p><a href="https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Prevention_Cheat_Sheet" target="_blank">XML External Entity (XXE) Prevention Cheat Sheet</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-45303542-41DE-4455-93B3-854A826EF8BB__GUID-9F24FC66-9FC4-40A1-9C17-AFAC4366E99B">
                        <p class="titleinexample">Example 2-1 Improving Safety of Java Code that Uses an XML Parser</p>
                        <p>This Java snippet blocks resolution of external entities, limits the number of entity-expansion levels, and limits the number of entity expansions.</p><pre class="pre codeblock"><code>try&nbsp;{
  DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
  dbf.setNamespaceAware(true);
  dbf.setXIncludeAware(false);
  dbf.<span class="bold">setExpandEntityReferences</span>(<span class="bold">false</span>);&nbsp;&nbsp;// Disable expanding of entities
  try&nbsp;{
    dbf.setFeature(XMLConstants.<span class="bold">FEATURE_SECURE_PROCESSING</span>,&nbsp;<span class="bold">true</span>);
  } catch&nbsp;(Throwable e) {
      //handle old parser version
      ...
  }
  DocumentBuilder dp = dbf.newDocumentBuilder();
  // Make resolveEntity just throw an exception.
  //   (If you really need to support external references
  //    then resolve publicId only against trusted values.)
  dp.<span class="bold">setEntityResolver</span>(new&nbsp;EntityResolver() {
    public&nbsp;InputSource resolveEntity(String publicId, String systemId)
                        &nbsp;throws&nbsp;DOMException, IOException {
      <span class="bold">throw</span>&nbsp;new&nbsp;<span class="bold">DOMException</span>((short)0,&nbsp;"Security Violation");
    }
  });
...</code></pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-050DF080-439E-4515-9DFE-1D3D9D4571BD" name="GUID-050DF080-439E-4515-9DFE-1D3D9D4571BD"></a><h3 id="ADXDK-GUID-050DF080-439E-4515-9DFE-1D3D9D4571BD" class="sect3">Implementing Security for C</h3>
               <div>
                  <p>The process to implement security for C programs.</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-050DF080-439E-4515-9DFE-1D3D9D4571BD__GUID-FC66519C-624B-49C2-BA4B-79D200DCD665">Block Insecure Accesses</p>
                     <p>Usually, there are two sets of XDK C APIs that take the risks of the XXE attack: one set uses the function <code class="codeph">LpxInitEncoded()</code>and the other set uses the function <code class="codeph">XmlCreate()</code>or <code class="codeph">XmlCreateNew()</code></p>
                     <p>For <code class="codeph">LpxInitEncoded()</code>, feed the flags <code class="codeph">LPX_FLAG_URL_DONT_OPEN </code> and <code class="codeph">LPX_FLAG_FILE_DONT_OPEN</code> into the parser API to block external resource accesses.
                     </p>
                     <p>For example:</p><pre class="pre codeblock"><code>LpxBufferParse ( ctx,
                 (oratext *) buf,
                 (size_t) lstlen ( buf ),
                 (oratext *) "UTF-8", (lx_langid) 0, (lxglo *) 0,
                 LPX_FLAG_URL_DONT_OPEN | LPX_FLAG_FILE_DONT_OPEN);</code></pre><p>For <code class="codeph">XmlCreate()</code>or <code class="codeph">XmlCreateNew()</code>, set the parameter <code class="codeph">no_ri_open</code> to <code class="codeph">TRUE</code> when creating the context <code class="codeph">xctx</code>. This setting will block insecure accesses for parser APIs which use <code class="codeph">xctx</code>. 
                     </p>
                     <p>For example:</p><pre class="pre codeblock"><code>xctx = XmlCreateNew(&amp;xerr, (oratext *) "test",
                    (oratext **)NULL, 0, (oratext *)NULL,
                    "data_encoding", “AL32UTF8”,
                    "input_encoding", "AL32UTF8",
                    "no_ri_open",  "TRUE", /* disallow URI resolution */
                    "error_handler", test_errmsg,
                    NULL);</code></pre><p>The parameter <code class="codeph">no_ri_open</code> can also be set to <code class="codeph">TRUE</code> in DOM APIs to block insecure accesses. Setting this flag in DOM APIs ensures that security is enforced even when this flag is not set in <code class="codeph">XmlCreate()</code>.
                     </p>
                     <p>For example:</p><pre class="pre codeblock"><code>doc = XmlLoadDom(xctx, &amp;xerr,
                 "file", filename,
                 "discard_whitespace", TRUE,
                 "validate", TRUE,
                 "no_ri_open", TRUE, /* disallow URI resolution */
                 NULL);
</code></pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-050DF080-439E-4515-9DFE-1D3D9D4571BD__GUID-A993E34C-CCF1-472D-A228-6162A0E4E83C">Allow Arbitrary Accesses</p>
                     <p>When users want to allow arbitrary references to external resources or make the accesses under their own control, they can implement the following steps:</p>
                     <ol>
                        <li>
                           <p>Set <code class="codeph">no_ri_open</code> to <code class="codeph">FALSE</code> in the locations shown in the previous examples.
                           </p>
                        </li>
                        <li>
                           <p>Develop customized open, read and close callback functions and initialize an <code class="codeph">OraSteam</code> using these functions.
                           </p>
                        </li>
                        <li>
                           <p>Override access to <code class="codeph">xctx</code> with <code class="codeph">OraSteam</code></p>
                        </li>
                     </ol>
                     <p>For example:</p><pre class="pre codeblock"><code>ostream = OraStreamInit(actx, (oratext *)"test", &amp;oerr,
                        "open", http_open,
                        "read", http_read,
                        "close", http_close,
                        NULL);
xerr = XmlAccess(xctx, XML_ACCESS_HTTP, ostream);</code></pre><p>The code creates an instance of <code class="codeph">ostream</code> by providing three callbacks. The created stream will override the access inside <code class="codeph">xctx</code> using <code class="codeph">XmlAccess</code>. <code class="codeph">xctx</code> is used when calling APIs such as <code class="codeph">XmlLoadDom</code>. Hence, the user has the option to create rules based on which they can access external resources.
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-4FB6E252-2EC9-4D53-9282-4FC41C282161" name="GUID-4FB6E252-2EC9-4D53-9282-4FC41C282161"></a><h3 id="ADXDK-GUID-4FB6E252-2EC9-4D53-9282-4FC41C282161" class="sect3">Security for C++</h3>
               <div>
                  <p>By default, C++ APIs block accesses to external resources &#x2013; thereby ensuring security. However, users can override this security restriction and allow arbitrary references to external resources based on their discretion.</p>
                  <p>The <code class="codeph">xmlctx.hpp</code> header file uses the <code class="codeph">CXmlCtx(bool no_ri_open)</code> API to initialize the <code class="codeph">xctx</code> context and set the parameter <code class="codeph">no_ri_open</code>. When the <code class="codeph">no_ri_open</code> parameter is set to <code class="codeph">true</code>, parser APIs that use <code class="codeph">xctx</code> will not be able to access external resources. When the <code class="codeph">no_ri_open</code> parameter is set to <code class="codeph">false</code>, parser APIs that use <code class="codeph">xctx</code> will be able to access external resources.
                  </p>
                  <p>By default, parser APIs that use <code class="codeph">xctx</code> cannot access external resources. To allow access, set the <code class="codeph">no_ri_open</code> parameter to <code class="codeph">false</code> as shown below:
                  </p><pre class="pre codeblock"><code>xctx = CXmlCtx(FALSE); /* allow URI resolution */ </code></pre><div class="infoboxnote" id="GUID-4FB6E252-2EC9-4D53-9282-4FC41C282161__GUID-ADF68510-3FA6-4CEF-9ACE-C6E3DDD2E47E">
                     <p class="notep1">Caution:</p>
                     <p>Allowing access to external resources can cause XML External Entity (XXE) and XML Entity Expansion (XEE) attacks. The user should be cautions when overriding the security restriction and allowing access to external resources.</p>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>