<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Shared Servers Considerations</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Java Developer's Guide ">
      <meta property="og:description" content>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Java Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="java-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-11T00:55:24-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="1999, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96468-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="threading-in-database.html" title="Previous" type="text/html">
      <link rel="next" href="calling-Java-methods.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Java Developer's Guide">
    <meta name="dcterms.isVersionOf" content="JJDEV">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="threading-in-database.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="calling-Java-methods.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Java Developer's Guide </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="Java-applications-in-database.html" property="item" typeof="WebPage"><span property="name"> Java Applications on Oracle Database </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Shared Servers Considerations</li>
            </ol>
            <a id="GUID-94B10C5C-91C0-48EC-9C41-98FE4C2E2F9E" name="GUID-94B10C5C-91C0-48EC-9C41-98FE4C2E2F9E"></a><a id="JJDEV13150"></a>
            
            <h2 id="JJDEV-GUID-94B10C5C-91C0-48EC-9C41-98FE4C2E2F9E" class="sect2"><span class="enumeration_section">2.13 </span>Shared Servers Considerations
            </h2>
         </header>
         <div class="ind">
            <div>
               <div class="infoboxnote" id="GUID-94B10C5C-91C0-48EC-9C41-98FE4C2E2F9E__GUID-2256EC87-4420-4B76-AB78-07FAEFD3FD0E">
                  <p class="notep1">Note:</p>
                  <p>Oracle recommends dedicated servers for performance reasons. Additionally, dedicated servers support a class of applications that rely on threads and sockets that stay open across calls. For example, the JMX agent connectivity functionality.</p>
               </div>
               <p>For sessions that use shared servers, certain limitations exist across calls. The reason is that a session that uses a shared server is not guaranteed to connect to the same process on a subsequent database call, and hence the session-specific memory and objects that need to live across calls are saved in the SGA. This means that process-specific resources, such as threads, open files, and sockets, must be cleaned up at the end of each call, and therefore, will not be available for the next call.</p>
               <p>This section covers the following topics:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="shared-server-consideration.html#GUID-EA77D9AB-1B1E-4C51-83CC-85FD197B3066">End-of-Call Migration</a></p>
                  </li>
                  <li>
                     <p><a href="shared-server-consideration.html#GUID-4A026E9F-CD34-48AC-888A-1898EE85D1D2">Oracle-Specific Support for End-of-Call Optimization</a></p>
                  </li>
                  <li>
                     <p><a href="shared-server-consideration.html#GUID-1C344053-ED62-4BF0-B47A-14AA86C3F31F">The EndOfCallRegistry.registerCallback() Method</a></p>
                  </li>
                  <li>
                     <p><a href="shared-server-consideration.html#GUID-704140B0-37DC-478F-984B-F9C9D836560C">The EndOfCallRegistry.runCallbacks() Method</a></p>
                  </li>
                  <li>
                     <p><a href="shared-server-consideration.html#GUID-72B02490-F61E-47F3-ABEE-A6F6ECA3AAA7">The Callback Interface</a></p>
                  </li>
                  <li>
                     <p><a href="shared-server-consideration.html#GUID-5A35823E-A7F2-41C4-A030-3D0284685E6C">The Callback.act() method</a></p>
                  </li>
                  <li>
                     <p><a href="shared-server-consideration.html#GUID-D8CABE53-E0BF-4D31-ADAE-51DD84530C06">Operating System Resources Affected Across Calls</a></p>
                  </li>
               </ul>
            </div>
            <div>
               <div class="relinfo">
                  <p><strong>Related Topics</strong></p>
                  <ul>
                     <li><a href="using-JMX.html#GUID-DCBEAE2C-7C92-4AE5-8069-CD4E5FFDAFB4">Managing Your Applications Using JMX</a></li>
                  </ul>
               </div>
            </div>
            <a id="JJDEV13151"></a><div class="props_rev_3"><a id="GUID-EA77D9AB-1B1E-4C51-83CC-85FD197B3066" name="GUID-EA77D9AB-1B1E-4C51-83CC-85FD197B3066"></a><h3 id="JJDEV-GUID-EA77D9AB-1B1E-4C51-83CC-85FD197B3066" class="sect3"><span class="enumeration_section">2.13.1 </span>End-of-Call Migration
               </h3>
               <div>
                  <p>In the shared server mode, Oracle Database preserves the state of your Java program between calls by migrating all objects that are reachable from <code class="codeph">static</code> variables to session space at the end of the call. Session space exists within the session of the client to store <code class="codeph">static</code> variables and objects that exist between calls. Oracle JVM automatically performs this migration operation at the end of every call.
                  </p>
                  <p>This migration operation is a memory and performance consideration. Hence, you should be aware of what you designate to exist between calls and keep the <code class="codeph">static</code> variables and objects to a minimum. If you store objects in <code class="codeph">static</code> variables needlessly, then you impose an unnecessary burden on the memory manager to perform the migration and consume per-session resources. By limiting your <code class="codeph">static</code> variables to only what is necessary, you help the memory manager and improve the performance of your server.
                  </p>
                  <p>To maximize the number of users who can run your Java program at the same time, it is important to minimize the footprint of a session. In particular, to achieve maximum scalability, an inactive session should take up as little memory space as possible. A simple technique to minimize footprint is to release large data structures at the end of every call. You can lazily re-create many data structures when you need them again in another call. For this reason, Oracle JVM has a mechanism for calling a specified Java method when a session is about to become inactive, such as at the end of a call.</p>
                  <p>This mechanism is the <code class="codeph">EndOfCallRegistry</code> notification. It enables you to clear <code class="codeph">static</code> variables at the end of the call and reinitialize the variables using a lazy initialization technique when the next call comes in. You should run this only if you are concerned about the amount of storage you require the memory manager to store in between calls. It becomes a concern only for complex stateful server applications that you implement in Java.
                  </p>
                  <p>The decision of whether to null-out data structures at the end of the call and then re-create them for each new call is a typical time and space trade-off. There is some extra time spent in re-creating the structure, but you can save significant space by not holding on to the structure between calls. In addition, there is a time consideration, because objects, especially large objects, are more expensive to access after they have been migrated to session space. The penalty results from the differences in representation of session, as opposed to objects based on call-space.</p>
                  <p>Examples of data structures that are candidates for this type of optimization include:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Buffers or caches.</p>
                     </li>
                     <li>
                        <p>Static fields, such as arrays, which once initialized can remain unchanged during the course of the program.</p>
                     </li>
                     <li>
                        <p>Any dynamically built data structure that can have a space-efficient representation between calls and a more speed-efficient representation for the duration of a call. This can be tricky and may complicate your code, making it hard to maintain. Therefore, you should consider doing this only after demonstrating that the space saved is worth the effort.</p>
                     </li>
                  </ul>
               </div>
            </div><a id="JJDEV13153"></a><a id="JJDEV13154"></a><a id="JJDEV13152"></a><div class="props_rev_3"><a id="GUID-4A026E9F-CD34-48AC-888A-1898EE85D1D2" name="GUID-4A026E9F-CD34-48AC-888A-1898EE85D1D2"></a><h3 id="JJDEV-GUID-4A026E9F-CD34-48AC-888A-1898EE85D1D2" class="sect3"><span class="enumeration_section">2.13.2 </span>Oracle-Specific Support for End-of-Call Optimization
               </h3>
               <div>
                  <p><a id="d18226e362" class="indexterm-anchor"></a>Y<a id="d18226e367" class="indexterm-anchor"></a>ou can register the <code class="codeph">static</code> variables that you want cleared at the end of the call when the buffer, field, or data structure is created. Within the <code class="codeph">oracle.aurora.memoryManager.EndOfCallRegistry</code> class, the <a id="d18226e378" class="indexterm-anchor"></a><code class="codeph">registerCallback()</code> method takes an object that implements a <code class="codeph">Callback</code> object. The <code class="codeph">registerCallback()</code> method stores this object until the end of the call. At the end of the call, Oracle JVM calls the <a id="d18226e390" class="indexterm-anchor"></a><code class="codeph">act()</code> method within all registered <code class="codeph">Callback</code> objects. The <code class="codeph">act()</code> method within the <code class="codeph">Callback</code> object is implemented to clear the user-defined buffer, field, or data structure. Once cleared, the <code class="codeph">Callback</code> object is removed from the registry.
                  </p>
                  <div class="infoboxnote" id="GUID-4A026E9F-CD34-48AC-888A-1898EE85D1D2__GUID-410B0AAB-0E4D-4A02-8301-353F5F089E99">
                     <p class="notep1">Note:</p>
                     <p>If the end of the call is also the end of the session, then callbacks are not started, because the session space will be cleared anyway.</p>
                  </div>
                  <p>A weak table holds the registry of end-of-call callbacks. If either the <code class="codeph">Callback</code> object or value are not reachable from the Java program, then both the object and the value will be dropped from the table. The use of a weak table to hold callbacks also means that registering a callback will not prevent the garbage collector from reclaiming that object. Therefore, you must hold on to the callback yourself if you need it, and you cannot rely on the table holding it back.
                  </p>
                  <p>The way you use <code class="codeph">EndOfCallRegistry</code> depends on whether you are dealing with objects held in <code class="codeph">static</code> fields or instance fields.
                  </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-4A026E9F-CD34-48AC-888A-1898EE85D1D2__GUID-1FD4E004-68E1-439E-B238-732C6B983DC3">Static fields</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>Use <code class="codeph">EndOfCallRegistry</code> to clear state associated with an entire class. In this case, the <code class="codeph">Callback</code> object should be held in a <code class="codeph">private</code> <code class="codeph">static</code> field. Any code that requires access to the cached data that was dropped between calls must call a method that lazily creates, or re-creates, the cached data.
                     </p>
                     <p>C<a id="d18226e444" class="indexterm-anchor"></a>onsider the following example:
                     </p><pre class="oac_no_warn" dir="ltr">import oracle.aurora.memoryManager.Callback;
import oracle.aurora.memoryManager.EndOfCallRegistry;

class Example
{
  static Object cachedField = null;
  private static Callback thunk = null;

  static void clearCachedField()
  {
    // clear out both the cached field, and the thunk so they don't
    // take up session space between calls
    cachedField = null;
    thunk = null;
  }

  private static Object getCachedField()
  {
    if (cachedField == null) 
    {
      // save thunk in static field so it doesn't get reclaimed
      // by garbage collector
      thunk = new Callback () {
        public void act(Object obj)
        {
          Example.clearCachedField();
        }
      };
      
      // register thunk to clear cachedField at end-of-call.
      EndOfCallRegistry.registerCallback(thunk);
      // finally, set cached field
      cachedField = createCachedField();
    }
    return cachedField;
  }

  private static Object createCachedField()
  {
    ...
  }
}
</pre><p>The preceding example does the following:</p>
                     <ol>
                        <li>
                           <p>Creates a <code class="codeph">Callback</code> object within a <code class="codeph">static</code> field, <code class="codeph">thunk</code>.
                           </p>
                        </li>
                        <li>
                           <p>Registers this <code class="codeph">Callback</code> object for end-of-call migration.
                           </p>
                        </li>
                        <li>
                           <p>Implements the <code class="codeph">Callback.act()</code> method to free up all <code class="codeph">static</code> variables, including the <code class="codeph">Callback</code> object itself.
                           </p>
                        </li>
                        <li>
                           <p>Provides a method, <code class="codeph">createCachedField()</code>, for lazily re-creating the cache.
                           </p>
                        </li>
                     </ol>
                     <p>When you create the cache, the <code class="codeph">Callback</code> object is automatically registered within the <code class="codeph">getCachedField()</code> method. At end-of-call, Oracle JVM calls the registered <code class="codeph">Callback.act()</code> method, which frees the static memory.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-4A026E9F-CD34-48AC-888A-1898EE85D1D2__GUID-5F089229-5002-4E48-96AC-36FA12097EB2">Instance fields</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>Use <code class="codeph">EndOfCallRegistry</code> to clear state in data structures held in instance fields. For example, when a state is associated with each instance of a class, each instance has a field that holds the cached state for the instance and fills in the cached field as necessary. You can access the cached field with a method that ensures the state is cached.
                     </p>
                     <p>Consider the following example:</p><pre class="oac_no_warn" dir="ltr">import oracle.aurora.memoryManager.Callback;
import oracle.aurora.memoryManager.EndOfCallRegistry;

class Example2 implements Callback
{
  private Object cachedField = null;

  public voidact (Object obj)
  {
    // clear cached field
    cachedField = null;
    obj = null;
  }

  // our accessor method
  private static Object getCachedField()
  {
    if (cachedField == null)
    {
      // if cachedField is not filled in then you must
      // register self, and fill it in.
      EndOfCallRegistry.registerCallback(self);
      cachedField = createCachedField();
    }
    return cachedField;
  }

  private Object createCachedField()
  {
    ...
  }
}
</pre><p>The preceding example does the following:</p>
                     <ol>
                        <li>
                           <p>Implements the instance as a <code class="codeph">Callback</code> object.
                           </p>
                        </li>
                        <li>
                           <p>Implements the <code class="codeph">Callback.act()</code> method to free up the instance fields.
                           </p>
                        </li>
                        <li>
                           <p>When you request a cache, the <code class="codeph">Callback</code> object registers itself for the end-of-call migration.
                           </p>
                        </li>
                        <li>
                           <p>Provides a method, <code class="codeph">createCachedField()</code>, for lazily re-creating the cache.
                           </p>
                        </li>
                     </ol>
                     <p>When you create the cache, the <code class="codeph">Callback</code> object is automatically registered within the <code class="codeph">getCachedField()</code> method. At end-of-call, Oracle JVM calls the registered <code class="codeph">Callback.act()</code> method, which frees the cache.
                     </p>
                     <p>This approach ensures that the lifetime of the <code class="codeph">Callback</code> object is identical to the lifetime of the instance, because they are the same object.
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDEV13155"></a><div class="props_rev_3"><a id="GUID-1C344053-ED62-4BF0-B47A-14AA86C3F31F" name="GUID-1C344053-ED62-4BF0-B47A-14AA86C3F31F"></a><h3 id="JJDEV-GUID-1C344053-ED62-4BF0-B47A-14AA86C3F31F" class="sect3"><span class="enumeration_section">2.13.3 </span>The EndOfCallRegistry.registerCallback() Method
               </h3>
               <div>
                  <div class="section">
                     <p>The <code class="codeph">registerCallback()</code> method installs a <code class="codeph">Callback</code> object within a registry. At the end of the call, Oracle JVM calls the <code class="codeph">act()</code> method of all registered <code class="codeph">Callback</code> objects.
                     </p>
                     <p>You can register your <code class="codeph">Callback</code> object by itself or with an <code class="codeph">Object</code> instance. If you need additional information stored within an object to be passed into <code class="codeph">act()</code>, then you can register this object with the <code class="codeph">value</code> parameter, which is an instance of <code class="codeph">Object</code>.
                     </p>
                     <p>The following are the valid signatures of the <code class="codeph">registerCallback()</code> method:
                     </p><pre class="oac_no_warn" dir="ltr">public static void registerCallback(Callback thunk, Object value);

public static void registerCallback(Callback thunk);
</pre><p>The following table lists the parameters of <code class="codeph">registerCallback</code> and their description:
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="tblformal" id="GUID-1C344053-ED62-4BF0-B47A-14AA86C3F31F__GUID-900DCBCD-CE8F-4721-8284-0AE3FC4BB1C1">
                     <table cellpadding="4" cellspacing="0" class="Formal" title summary="This table lists the parameters of registerCallback method in the left column and the corresponding description in the right column." width="100%" frame="hsides" border="1" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="19%" id="d18226e694">Parameter</th>
                              <th align="left" valign="bottom" width="81%" id="d18226e697">Description</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="19%" id="d18226e702" headers="d18226e694 ">
                                 <p><code class="codeph">thunk</code></p>
                              </td>
                              <td align="left" valign="top" width="81%" headers="d18226e702 d18226e697 ">
                                 <p>The <code class="codeph">Callback</code> object to be called at the end-of-call migration.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="19%" id="d18226e713" headers="d18226e694 ">
                                 <p><code class="codeph">value</code></p>
                              </td>
                              <td align="left" valign="top" width="81%" headers="d18226e713 d18226e697 ">
                                 <p>If you need additional information stored within an object to be passed into <code class="codeph">act()</code>, then you can register this object with the <code class="codeph">value</code> parameter. In some cases, the <code class="codeph">value</code> parameter is necessary to hold the state that the callback needs. However, most users do not need to specify a value for this parameter.
                                 </p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
               </div>
            </div><a id="JJDEV13156"></a><div class="props_rev_3"><a id="GUID-704140B0-37DC-478F-984B-F9C9D836560C" name="GUID-704140B0-37DC-478F-984B-F9C9D836560C"></a><h3 id="JJDEV-GUID-704140B0-37DC-478F-984B-F9C9D836560C" class="sect3"><span class="enumeration_section">2.13.4 </span>The EndOfCallRegistry.runCallbacks() Method
               </h3>
               <div>
                  <div class="section">
                     <p>The signature of the <code class="codeph">runCallbacks()</code> method is as follows:
                     </p><pre class="oac_no_warn" dir="ltr">static void runCallbacks()
</pre><p>JVM calls this method at end-of-call and calls <code class="codeph">act()</code> for every <code class="codeph">Callback</code> object registered using <code class="codeph">registerCallback()</code>. It is called at end-of-call, before object migration and before the last finalization step.
                     </p>
                     <div class="infoboxnote" id="GUID-704140B0-37DC-478F-984B-F9C9D836560C__GUID-AAB406A3-8A08-4D9B-A66D-97D946C2CD2E">
                        <p class="notep1">Note:</p>
                        <p>Do not call this method in your code.</p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDEV13157"></a><div class="props_rev_3"><a id="GUID-72B02490-F61E-47F3-ABEE-A6F6ECA3AAA7" name="GUID-72B02490-F61E-47F3-ABEE-A6F6ECA3AAA7"></a><h3 id="JJDEV-GUID-72B02490-F61E-47F3-ABEE-A6F6ECA3AAA7" class="sect3"><span class="enumeration_section">2.13.5 </span>The Callback Interface
               </h3>
               <div>
                  <div class="section">
                     <p>The interface is declared as follows:</p><pre class="oac_no_warn" dir="ltr">Interface oracle.aurora.memoryManager.Callback
</pre><p>Any object you want to register using <code class="codeph">EndOfCallRegistry.registerCallback()</code> must implement the <code class="codeph">Callback</code> interface. This interface can be useful in your application, where you require notification at end-of-call.
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDEV13158"></a><div class="props_rev_3"><a id="GUID-5A35823E-A7F2-41C4-A030-3D0284685E6C" name="GUID-5A35823E-A7F2-41C4-A030-3D0284685E6C"></a><h3 id="JJDEV-GUID-5A35823E-A7F2-41C4-A030-3D0284685E6C" class="sect3"><span class="enumeration_section">2.13.6 </span>The Callback.act() method
               </h3>
               <div>
                  <div class="section">
                     <p>The signature of the <code class="codeph">act()</code> method is as follows:
                     </p><pre class="oac_no_warn" dir="ltr">public void act(Object value)
</pre><p>You can implement any activity that you require to occur at the end of the call. Usually, this method contains procedures for clearing any memory that would be saved to session space.</p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDEV13160"></a><a id="JJDEV13161"></a><a id="JJDEV13162"></a><a id="JJDEV13163"></a><a id="JJDEV13164"></a><a id="JJDEV13159"></a><div class="props_rev_3"><a id="GUID-D8CABE53-E0BF-4D31-ADAE-51DD84530C06" name="GUID-D8CABE53-E0BF-4D31-ADAE-51DD84530C06"></a><h3 id="JJDEV-GUID-D8CABE53-E0BF-4D31-ADAE-51DD84530C06" class="sect3"><span class="enumeration_section">2.13.7 </span>Operating System Resources Affected Across Calls
               </h3>
               <div>
                  <div class="section">
                     <p><a id="d18226e1140" class="indexterm-anchor"></a>In the shared server mode, Oracle JVM closes any open operating system resources <a id="d18226e1145" class="indexterm-anchor"></a><a id="d18226e1149" class="indexterm-anchor"></a>at the end of a database call, as shown in the following table:
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="tblformal" id="GUID-D8CABE53-E0BF-4D31-ADAE-51DD84530C06__GUID-F9A406ED-06BE-4720-90E9-9D5EF31BC945">
                     <table cellpadding="4" cellspacing="0" class="Formal" title summary="The following table lists the operating system resources across calls in the left column and specifies the corresponding lifetime in the right column." width="100%" frame="hsides" border="1" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="24%" id="d18226e1162">Resource</th>
                              <th align="left" valign="bottom" width="76%" id="d18226e1165">Lifetime</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="24%" id="d18226e1170" headers="d18226e1162 ">
                                 <p>Files</p>
                              </td>
                              <td align="left" valign="top" width="76%" headers="d18226e1170 d18226e1165 ">
                                 <p>The system closes all files left open when a database call ends.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="24%" id="d18226e1177" headers="d18226e1162 ">
                                 <p>Threads</p>
                              </td>
                              <td align="left" valign="top" width="76%" headers="d18226e1177 d18226e1165 ">
                                 <p>All threads are terminated when a call ends.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="24%" id="d18226e1184" headers="d18226e1162 ">
                                 <p>Sockets</p>
                              </td>
                              <td align="left" valign="top" width="76%" headers="d18226e1184 d18226e1165 ">
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>Client sockets can exist across calls.</p>
                                    </li>
                                    <li>
                                       <p>Server sockets terminate when the call ends.</p>
                                    </li>
                                 </ul>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="24%" id="d18226e1196" headers="d18226e1162 ">
                                 <p>Objects that depend on operating system resources</p>
                              </td>
                              <td align="left" valign="top" width="76%" headers="d18226e1196 d18226e1165 ">
                                 <p>Regardless of the usable lifetime of the object, the Java object can be valid for the duration of the session. This can occur, for example, if the Java object is stored in a <code class="codeph">static</code> class variable, or a class variable references it directly or indirectly. If you attempt to use one of these Java objects after its usable lifetime is over, then Oracle Database will throw an exception. This is true for the following examples:
                                 </p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>If an attempt is made to read from a <code class="codeph">java.io.FileInputStream</code> that was closed at the end of a previous call, then a <code class="codeph">java.io.IOException</code> is raised.
                                       </p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">java.lang.Thread.isAlive()</code> is <code class="codeph">false</code> for any <code class="codeph">Thread</code> object running in a previous call and still accessible in a subsequent call.
                                       </p>
                                    </li>
                                 </ul>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <div class="section">
                     <p><a id="d18226e1228" class="indexterm-anchor"></a>You should close resources that are local to a single call when the call ends. However, for <code class="codeph">static</code> objects that hold on to operating system resources, you must be aware of how these resources are affected after the call ends.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-D8CABE53-E0BF-4D31-ADAE-51DD84530C06__GUID-393401DC-3503-4C4B-BC69-4243D3BECF51">Files</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>In the shared server mode, Oracle JVM automatically closes open operating system constructs when the call ends. This can affect any operating system resources within your Java object. If you have a file opened within a <code class="codeph">static</code> variable, then the file handle is closed at the end of the call for you. Therefore, if you hold on to the <code class="codeph">File</code> object across calls, then the next usage of the file handle throws an exception.
                     </p>
                     <p>In the following example, the <code class="codeph">Concat</code> class enables multiple files to be written into a single file, <code class="codeph">outFile</code>. On the first call, <code class="codeph">outFile</code> is created. The first input file is opened, read, written to <code class="codeph">outFile</code>, and the call ends. Because <code class="codeph">outFile</code> is defined as a <code class="codeph">static</code> variable, it is moved into session space between call invocations. However, the file handle is closed at the end of the call. The next time you call <code class="codeph">addFile()</code>, you will get an exception.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-D8CABE53-E0BF-4D31-ADAE-51DD84530C06__BABGIEJC">
                     <p class="titleinexample">Example 2-5 Compromising Your Operating System Resources</p><pre class="oac_no_warn" dir="ltr">public class Concat
{
  static File outFile = new File("outme.txt");
  FileWriter out = new FileWriter(outFile);

  public static void addFile(String[] newFile)
  {
    File inFile = new File(newFile);
    FileReader in = new FileReader(inFile);
    int i;

    while ((i = in.read()) != -1)
      out.write(i);
    in.close();
  }
}
</pre></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p>There are workarounds. To ensure that your handles stay valid, close your files, buffers, and so on, at the end of every call, and reopen the resource at the beginning of the next call. Another option is to use the database rather than using operating system resources. For example, try to use database tables rather than a file. Alternatively, do not store operating system resources within <code class="codeph">static</code> objects that are expected to live across calls. Instead, use operating system resources only within objects local to the call.
                     </p>
                     <p>The following example shows how you can perform concatenation, without compromising your operating system resources. The <code class="codeph">addFile()</code> method opens the <code class="codeph">outme.txt</code> file within each call, ensuring that anything written into the file is appended to the end. At the end of each call, the file is closed. Two things occur:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The <code class="codeph">File</code> object no longer exists outside a call.
                           </p>
                        </li>
                        <li>
                           <p>The operating system resource, the <code class="codeph">outme.txt</code> file, is reopened for each call. If you had made the <code class="codeph">File</code> object a <code class="codeph">static</code> variable, then the closing of <code class="codeph">outme.txt</code> within each call would ensure that the operating system resource is not compromised.
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-D8CABE53-E0BF-4D31-ADAE-51DD84530C06__BABGCDBC">
                     <p class="titleinexample">Example 2-6 Correctly Managing Your Operating System Resources</p><pre class="oac_no_warn" dir="ltr">public class Concat
{

  public static void addFile(String[] newFile)
  {
    /*open the output file each call; make sure the input*/
    /*file is written out to the end by making it "append=true"*/
    FileWriter out = new FileWriter("outme.txt", TRUE);
    File inFile = new File(newFile);
    FileReader in = new FileReader(inFile);
    int i;

    while ((i = in.read()) != -1)
      out.write(i);
    in.close();
    
    /*close the output file between calls*/
    out.close();
  }
}</pre></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-D8CABE53-E0BF-4D31-ADAE-51DD84530C06__GUID-EC8D506F-BFFA-4EBE-8037-6BB6010B3757">Sockets</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>Sockets are used in setting up a connection between a client and a server. For each database connection, sockets are used at either end of the connection. Your application does not set up the connection. The connection is set up by the underlying networking protocol, TTC or IIOP of Oracle Net.</p>
                     <div class="infoboxnotealso" id="GUID-D8CABE53-E0BF-4D31-ADAE-51DD84530C06__GUID-70BC4A94-B4D3-44AA-98C4-C605D7D9DF27">
                        <p class="notep1">See Also:</p>
                        <p><span class="q">"<a href="configuring-Oracle-JVM.html#GUID-39EE0E84-2418-4AA6-8BE8-8FDEBDE53BCA">Configuring Oracle JVM</a>"</span> for information about how to configure your connection.
                        </p>
                     </div>
                     <p>You may also want to set up another connection, for example, connecting to a specified URL from within one of the classes stored within the database. To do so, instantiate sockets for servicing the client and server sides of the connection using the following:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The <code class="codeph">java.net.Socket()</code> constructor creates a client socket.
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">java.net.ServerSocket()</code> constructor creates a server socket.
                           </p>
                        </li>
                     </ul>
                     <p>A socket exists at each end of the connection. The server side of the connection that listens for incoming calls is serviced by a <code class="codeph">ServerSocket</code> instance. The client side of the connection that sends requests is serviced through a <code class="codeph">Socket</code> instance. You can use sockets as defined within JVM with the restriction that a <code class="codeph">ServerSocket</code> instance within a shared server cannot exist across calls.
                     </p>
                     <p>The following table lists the socket types and their description:</p>
                  </div>
                  <!-- class="section" -->
                  <div class="tblformal" id="GUID-D8CABE53-E0BF-4D31-ADAE-51DD84530C06__GUID-734CA642-C70A-4825-B299-8B9C9BFDD847">
                     <table cellpadding="4" cellspacing="0" class="Formal" title summary="This table lists the various socket types in the left column and their description in the right column." width="100%" frame="hsides" border="1" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="24%" id="d18226e1367">Socket Type</th>
                              <th align="left" valign="bottom" width="76%" id="d18226e1370">Description</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="24%" id="d18226e1375" headers="d18226e1367 ">
                                 <p>Socket</p>
                              </td>
                              <td align="left" valign="top" width="76%" headers="d18226e1375 d18226e1370 ">
                                 <p>Because the client side of the connection is outbound, the <code class="codeph">Socket</code> instance can be serviced across calls within a shared server.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="24%" id="d18226e1385" headers="d18226e1367 ">
                                 <p>ServerSocket</p>
                              </td>
                              <td align="left" valign="top" width="76%" headers="d18226e1385 d18226e1370 ">
                                 <p>The server side of the connection is a listener. The <code class="codeph">ServerSocket</code> instance is closed at the end of a call within a shared server. The shared servers move on to another client at the end of every call. You will receive an I/O exception stating that the socket was closed, if you try to use the <code class="codeph">ServerSocket</code> instance outside of the call it was created in.
                                 </p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-D8CABE53-E0BF-4D31-ADAE-51DD84530C06__GUID-78BC7B86-AC5B-451B-AD0F-08B55C98262B">Threads</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>In the shared server mode, when a call ends because of a return or uncaught exceptions, Oracle JVM throws <code class="codeph">ThreadDeathException</code> in all daemon threads. <code class="codeph">ThreadDeathException</code> essentially forces threads to stop running. Code that depends on threads living across calls does not behave as expected in the shared server mode. For example, the value of a <code class="codeph">static</code> variable that tracks initialization of a thread may become incorrect in subsequent calls because all threads are killed at the end of a database call.
                     </p>
                     <p>As a specific example, the standard RMI Server functions in the shared server mode. However, it is useful only within the context of a single call. This is because the RMI Server forks daemon threads, which are in the shared server mode, are killed at the end of call, that is, the daemon thread are killed when all non-daemon threads return. If the RMI server session is reentered in a subsequent call, then these daemon threads are not restarted and the RMI server fails to function properly.</p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>