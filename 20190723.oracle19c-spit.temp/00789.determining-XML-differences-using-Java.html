<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="An explanation is given of how to determine the differences between two Extensible Markup Language (XML) inputs, using the Java library included in the Oracle XML Developer's Kit (XDK).">
      <meta name="description" content="An explanation is given of how to determine the differences between two Extensible Markup Language (XML) inputs, using the Java library included in the Oracle XML Developer's Kit (XDK).">
      <title>Determining XML Differences Using Java</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Programmer's Guide">
      <meta property="og:description" content="An explanation is given of how to determine the differences between two Extensible Markup Language (XML) inputs, using the Java library included in the Oracle XML Developer's Kit (XDK).">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Programmer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="xml-developers-kit-programmers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-11T05:58:48-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2001, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96292-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="using-XML-pipeline-processor-for-Java.html" title="Previous" type="text/html">
      <link rel="next" href="using-XML-SQL-utility.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="XML Developers Kit Programmers Guide">
    <meta name="dcterms.isVersionOf" content="ADXDK">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="using-XML-pipeline-processor-for-Java.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="using-XML-SQL-utility.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Programmer's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="XDK-for-Java.html" property="item" typeof="WebPage"><span property="name">Oracle XML Developer's Kit for Java</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Determining XML Differences Using Java</li>
            </ol>
            <a id="GUID-BA951010-1085-4715-89F0-1F2312C4AA4A" name="GUID-BA951010-1085-4715-89F0-1F2312C4AA4A"></a><a id="ADXDK1005"></a><a id="ADXDK199"></a>
            
            <h2 id="ADXDK-GUID-BA951010-1085-4715-89F0-1F2312C4AA4A" class="sect2"><span class="enumeration_chapter">20 </span>Determining XML Differences Using Java
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>An explanation is given of how to determine the differences between two Extensible Markup Language (XML) inputs, using the Java library included in the Oracle XML Developer's Kit (XDK).</p>
               <div class="section"> </div>
               <!-- class="section" -->
            </div><a id="ADXDK128"></a><div class="props_rev_3"><a id="GUID-D7465EE7-EE9C-48D2-8F8F-85294B2BE20C" name="GUID-D7465EE7-EE9C-48D2-8F8F-85294B2BE20C"></a><h3 id="ADXDK-GUID-D7465EE7-EE9C-48D2-8F8F-85294B2BE20C" class="sect3">Overview of XML Diffing Utilities for Java</h3>
               <div>
                  <p>The Java XML diffing library includes diffing, hashing, and equality-comparison methods for XML inputs in class <code class="codeph">XmlUtils</code> of package <code class="codeph">oracle.xml.diff</code>. 
                  </p>
                  <p>The <code class="codeph">Options</code> class in the <code class="codeph">oracle.xml.diff</code> package provides options that enable users to control how the input is processed by the methods in the <code class="codeph">XmlUtils</code> class (see <a href="determining-XML-differences-using-Java.html#GUID-B5320E40-B2BD-4548-9ED4-FD71C426DCAC" title="The Java XML diffing library supports two options, which you can set using methods in the Options class of the oracle.xml.diff package. The Options object is passed in directly to the diff, hash, and equal methods on each invocation.">User Options for the Java XML Diffing Library</a>). One of these supported options is white space normalization, which is enabled by default.
                  </p>
                  <p>The algorithm used by the XML diffing methods is specifically designed for the use case of finding differences between two large XML documents (5 MB or more) within seconds, where the minimal diff is not required. The minimal diff is the smallest possible set of changes which, when applied to the first XML input, produces an output equivalent (identical) to the second XML input. Known minimal diff algorithms require prohibitively large amounts of memory and time for processing multimegabyte inputs. The algorithm used in the XML diff methods produces best quality (as close to minimal as possible) diffs in the absence of recurring identical subtrees in the XML inputs.</p>
                  <p>The Java XML diffing library provides several equivalent variants of each method to allow XML inputs in different forms, including Document Object Model (DOM) nodes, files, and input streams. Internally, the diffing, hashing, and equality comparisons operate on a DOM tree. Input that is not in the form of a DOM tree is internally converted to a DOM tree. To reduce computational overhead, Oracle recommends passing in DOM directly whenever possible.</p>
                  <p>The Java XML diffing library includes methods to return the diff output as a DOM document, or as a list of objects, each representing a diff operation. With the second option, you can avoid the overhead of XML document generation. With the first option, the resulting document conforms to the XML schema described in <a href="determining-XML-differences-using-Java.html#GUID-DAA1054B-74EA-4EBE-A20C-ABF293D1ECC3" title="The output schema xdiff.xsd, to which the Java XML diffing library conforms, is presented.">Diff Output Schema</a>. The first option is useful, for example, if the diff output must be stored as a log for future reference.
                  </p>
                  <p>The hash methods provided by the Java XML diffing library compute the hash value of XML input. If the hash values of the two XML inputs are equal, they are identical with a very high probability.</p>
                  <p>The equal methods provided in the Java XML diffing library compare two inputs for equality.</p>
                  <p>To use the Java XML diffing library, your application must run with Java version 1.6 or later, with any DOM implementation.</p>
                  <div class="infoboxnote" id="GUID-D7465EE7-EE9C-48D2-8F8F-85294B2BE20C__GUID-0943AF26-DB52-4EB3-A960-24197461333F">
                     <p class="notep1">Note:</p>
                     <p>The application programming interface (API) components described in this chapter are contained within the Java package <code class="codeph">oracle.xml.diff</code>. For brevity, fully qualified names are used only when necessary to avoid confusion.
                     </p>
                     <p>See <a href="../jaxml/index.html" target="_blank"><span><cite>Oracle Database XML Java API Reference</cite></span></a> for more information about the <code class="codeph">oracle.xml.diff</code> package.
                     </p>
                  </div>
               </div>
            </div><a id="ADXDK129"></a><div class="props_rev_3"><a id="GUID-B5320E40-B2BD-4548-9ED4-FD71C426DCAC" name="GUID-B5320E40-B2BD-4548-9ED4-FD71C426DCAC"></a><h3 id="ADXDK-GUID-B5320E40-B2BD-4548-9ED4-FD71C426DCAC" class="sect3">User Options for the Java XML Diffing Library</h3>
               <div>
                  <p>The Java XML diffing library supports two options, which you can set using methods in the <code class="codeph">Options</code> class of the <code class="codeph">oracle.xml.diff</code> package. The <code class="codeph">Options</code> object is passed in directly to the diff, hash, and equal methods on each invocation.
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Text Node Normalization (enabled by default)</p>
                        <p>Text nodes are normalized in the DOM trees on which the diff, hash, and equal methods operate. Text node normalization involves coalescing adjacent text nodes, followed by stripping leading and trailing white space from the coalesced nodes. Single text nodes have their leading and trailing white space stripped. White-space-only text nodes are eliminated.</p>
                        <p>Normalization is performed within the library with minimal additional space, and without modifying the provided XML inputs.</p>
                        <p>To perform your own normalization on the DOM inputs before passing them to the library, you must invoke the method <code class="codeph">normalizeTextNodes(false)</code> on the <code class="codeph">Options</code> object to turn off the default normalization.
                        </p>
                        <p>Oracle does not recommend invoking the diff methods without performing some type of normalization, either the default or your own. The diff quality suffers in the presence of identical white space text nodes, which commonly occur in XML documents.</p>
                     </li>
                     <li>
                        <p>Ignoring Namespace Prefix Differences (enabled by default)</p>
                        <p>XML namespace prefix differences are ignored by the diff, hash, and equal methods. For example, two DOM nodes are considered equal if they are identical except for having different prefixes (even if the two different prefixes map to Universal Resource Identifier (URI) of the same namespace. To configure the library to treat different namespace prefixes as truly different, even if they map to the same URI, you can invoke the method <code class="codeph">ignorePrefixDifferences(false)</code> on the <code class="codeph">Options</code> object to turn off the default namespace prefix behavior.
                        </p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-B5320E40-B2BD-4548-9ED4-FD71C426DCAC__GUID-20627278-C69D-40B9-AB45-405F3EB664CC">
                     <p class="notep1">See Also:</p>
                     <p><a href="../jaxml/index.html" target="_blank"><span><cite>Oracle Database XML Java API Reference</cite></span></a> for details about the methods in the <code class="codeph">Options</code> class
                     </p>
                  </div>
               </div>
            </div><a id="ADXDK1006"></a><a id="ADXDK130"></a><div class="props_rev_3"><a id="GUID-10A0F3AF-DDD9-4511-9F35-D0106B74CC94" name="GUID-10A0F3AF-DDD9-4511-9F35-D0106B74CC94"></a><h3 id="ADXDK-GUID-10A0F3AF-DDD9-4511-9F35-D0106B74CC94" class="sect3">Using Java XML Diffing Methods to Find Differences</h3>
               <div>
                  <p>The Java XML dffing library provides various <code class="codeph">diff</code> and <code class="codeph">diffToDoc</code> methods in the <code class="codeph">XmlUtils</code> class of the <code class="codeph">oracle.xml.diff</code> package. You can use these methods to compare two XML inputs to determine if there are any differences between them.
                  </p>
                  <p>The <code class="codeph">diffToDoc</code> methods return the output as a DOM document that conforms to the schema described in <a href="determining-XML-differences-using-Java.html#GUID-DAA1054B-74EA-4EBE-A20C-ABF293D1ECC3" title="The output schema xdiff.xsd, to which the Java XML diffing library conforms, is presented.">Diff Output Schema</a>. The Java XML diffing library includes several equivalent variants of these methods, which accept inputs in different forms (DOM nodes, files, and others).
                  </p>
                  <p>The Java XML diffing library includes an equivalent set of <code class="codeph">diff</code> methods that enable you to work on the diff output that is returned as a list of diff operation objects.
                  </p>
                  <p>Because the DOM document that represents the diff does not need to be constructed, using the <code class="codeph">diff</code> methods is more efficient than using the <code class="codeph">difftoDoc</code> methods. You should consider using these methods whenever you do not need a representation of the diff in XML form. To use the <code class="codeph">diff </code>methods, you must create an implementation of the <code class="codeph">DiffOpReceiver</code> interface, and then pass it as a parameter to the <code class="codeph">diff</code> methods. The <code class="codeph">DiffOpReceiver.receiveDiff</code> method receives the diff as a list of <code class="codeph">DiffOp</code> objects.
                  </p>
                  <p>The diff result, whether it is returned as a DOM document or as a list of <code class="codeph">DiffOps</code> objects, can be understood as a series of diff operations. The possible diff operations are:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>append-node</p>
                     </li>
                     <li>
                        <p>insert-node-before</p>
                     </li>
                     <li>
                        <p>delete-node</p>
                     </li>
                  </ul>
                  <p>Applying the sequence of diff operations on the first DOM tree produces a tree that is equivalent to the second DOM tree. For example, using these two XML inputs:</p>
                  <p>First input: <code class="codeph">&lt;a&gt;&lt;b/&gt;&lt;/a&gt;</code></p>
                  <p>Second input: <code class="codeph">&lt;a&gt;&lt;c/&gt;&lt;/a&gt;</code></p>
                  <p>The diff result from comparing the first and second input is a list, with these two diff operations:</p><pre class="pre codeblock"><code>delete-node /a[1]/b[1]
append-node &lt;c/&gt; to /a[1]
</code></pre><p>Deleting the node represented by the XPath expression <code class="codeph">/a/b</code> in the first input, and then appending <code class="codeph">&lt;c/&gt;</code> to the node represented by the XPath expression <code class="codeph">/a</code> in the first input produces the result <code class="codeph">&lt;a&gt;&lt;c/&gt;&lt;/a&gt;</code>, which is equivalent to the second input.
                  </p>
                  <p>When the diff operations are output to a DOM document by the <code class="codeph">domToDoc(…)</code> method, they rely on XPath expressions to indicate the node locations. These XPath locations refer to node positions in the original first input. They do not reflect the applied diff operations.
                  </p>
                  <div class="infoboxnote" id="GUID-10A0F3AF-DDD9-4511-9F35-D0106B74CC94__GUID-0426B707-A522-421F-ACD9-E2E963666982">
                     <p class="notep1">Note:</p>
                     <p>The Java XML diffing library does not support append-node, insert-node-before, and delete-node operations for attribute nodes. Thus, when any attributes of a node are changed, the change is shown as a delete of the whole node, followed by the insert or the append of the new node with the changed attributes.</p>
                     <p>For example, for these two inputs:</p>
                     <p>First input: <code class="codeph">&lt;a attr1="val1"&gt;&lt;b/&gt;&lt;/a&gt;</code></p>
                     <p>Second input: <code class="codeph">&lt;a attr2="val2"&gt;&lt;b/&lt;/a&gt;</code></p>
                     <p>The diff consists of these two diff operations:</p><pre class="pre codeblock"><code>insert &lt;a attr2="val2"&gt;&lt;b/&gt;&lt;/a&gt; before /a[1]
delete /a[1]</code></pre></div>
                  <div class="section"> </div>
                  <!-- class="section" -->
                  <div class="section">
                     <div class="infoboxnote" id="GUID-10A0F3AF-DDD9-4511-9F35-D0106B74CC94__GUID-6D59B4CF-C68E-4922-9056-5BC104A7FCB6">
                        <p class="notep1">Note:</p>
                        <p>This section uses XML document output to describe each diff operation. Although they are not described here, diff operation results that are returned programmatically are equivalent.</p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-10A0F3AF-DDD9-4511-9F35-D0106B74CC94__GUID-C00159F4-0834-44FC-B78D-3B96990ED441">
                        <p class="notep1">See Also:</p>
                        <p><a href="../jaxml/index.html" target="_blank"><span><cite>Oracle Database XML Java API Reference</cite></span></a> for more information about the <code class="codeph">DiffOpReceiver</code> interface, and for details about the methods in the <code class="codeph">XmlUtils</code> class
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADXDK138"></a><a id="ADXDK131"></a><div class="props_rev_3"><a id="GUID-8E436BF5-210B-49BE-8C11-EFB007CFA70C" name="GUID-8E436BF5-210B-49BE-8C11-EFB007CFA70C"></a><h4 id="ADXDK-GUID-8E436BF5-210B-49BE-8C11-EFB007CFA70C" class="sect4">About the append-node Operation</h4>
                  <div>
                     <p>The append-node operation specifies that a given node is to be appended as the last child of a particular first input node. </p>
                     <p><a href="determining-XML-differences-using-Java.html#GUID-8E436BF5-210B-49BE-8C11-EFB007CFA70C__BABCHAEI">Example 20-1</a> shows an append-node operation that adds the highlighted node <code class="codeph">&lt;enumeration value="FL"/&gt;</code> to a document.
                     </p>
                     <p>Invoking a <code class="codeph">diffToDoc(…)</code> method, using the original document (without the highlighted change) and the changed document as input produces this output:
                     </p><pre class="oac_no_warn" dir="ltr">&lt;xd:append-node
 xd:parent-xpath="/schema[1]/simpleType[1]/restriction[1]"
 xd:node-type="element"&gt; 
         &lt;xd:content&gt; 
             &lt;enumeration value="FL"/&gt; 
         &lt;/xd:content&gt; 
&lt;/xd:append-node&gt;
</pre><p>The append-node operation is represented by the <code class="codeph">&lt;append-node&gt;</code> element in the preceding output. This element specifies that a node of the given type is added as the last child of the given first input parent node. The <code class="codeph">parent-xpath</code> attribute specifies the parent node. The <code class="codeph">node-type</code> attribute specifies the type of the node to be appended. The <code class="codeph">&lt;content&gt;</code> child element specifies the node to be appended.
                     </p>
                     <p>Alternatively, when the <code class="codeph">diff(…)</code> methods are used, the append-node operation is accessible in the <code class="codeph">DiffOpReceiver.receiverDiff(…)</code> method as a <code class="codeph">DiffOp</code> object. In this case, the operation returns the actual references to the nodes in the two DOM trees involved in the diff operation. The reference to the parent node in the first input is returned by invoking the <code class="codeph">getParent()</code> method of <code class="codeph">DiffOp</code>. The reference to the node to be appended from the second input is returned by invoking the <code class="codeph">getNew()</code> method of <code class="codeph">DiffOp</code>.
                     </p>
                     <div class="example" id="GUID-8E436BF5-210B-49BE-8C11-EFB007CFA70C__BABCHAEI">
                        <p class="titleinexample">Example 20-1 Appending a Node</p><pre class="oac_no_warn" dir="ltr">&lt;schema&gt;
…
     &lt;simpleType name="USState"&gt; 
          &lt;restriction base="string"&gt; 
               &lt;enumeration value="NY"/&gt; 
               &lt;enumeration value="TX"/&gt; 
               &lt;enumeration value="CA"/&gt;
               <span class="bold">&lt;enumeration value="FL"/&gt;</span>
          &lt;/restriction&gt; 
     &lt;/simpleType&gt;  
…
&lt;/schema&gt;
</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="ADXDK140"></a><a id="ADXDK139"></a><div class="props_rev_3"><a id="GUID-06A4BA93-73E3-44CB-950F-71689D0B23C6" name="GUID-06A4BA93-73E3-44CB-950F-71689D0B23C6"></a><h4 id="ADXDK-GUID-06A4BA93-73E3-44CB-950F-71689D0B23C6" class="sect4">About the insert-node-before Operation</h4>
                  <div>
                     <p>The insert-node-before operation specifies that a given node is to be inserted before a particular node in the first input. </p>
                     <p><a href="determining-XML-differences-using-Java.html#GUID-06A4BA93-73E3-44CB-950F-71689D0B23C6__BABGGHJD">Example 20-2</a> shows an insert-node-before operation that inserts the highlighted node <code class="codeph">&lt;!-- A type representing US States --&gt;</code> before the node <code class="codeph">&lt;simpleType name="USState"&gt;</code> in a document.
                     </p>
                     <p>Invoking a <code class="codeph">diffToDoc(…)</code> method, using the original document (without the highlighted change) and the changed document as input produces this output:
                     </p><pre class="oac_no_warn" dir="ltr">&lt;xd:insert-node-before xd:node-type="comment" 
 xd:xpath="/schema[1]/simpleType[1]"&gt;
           &lt;xd:content&gt;
                   &lt;!-- A type representing US States --&gt;
           &lt;/xd:content&gt;
&lt;/xd:insert-node-before&gt;
</pre><p>The insert-node-before operation is represented by the <code class="codeph">&lt;insert-node-before&gt;</code> element in the preceding output. This element specifies that a node of the given type is inserted before the given first input node. The <code class="codeph">xpath</code> attribute specifies the location of the first input node. The <code class="codeph">node-type</code> attribute specifies the type of the node to be inserted. The <code class="codeph">&lt;content&gt;</code> child element specifies the node to be inserted.
                     </p>
                     <p>Alternatively, when the <code class="codeph">diff(…)</code> methods are used, the insert-node-before operation is accessible in the <code class="codeph">DiffOpReceiver.receiverDiff(…)</code> method as a <code class="codeph">DiffOp</code> object. In this case, the operation returns the actual references to the nodes in the two DOM trees involved in the diff operation. The reference to the node before which to insert a node in the first input is returned by invoking the <code class="codeph">getSibling()</code> method of <code class="codeph">DiffOp</code>. The reference to the node to be inserted from the second input is returned by invoking the <code class="codeph">getNew()</code> method of <code class="codeph">DiffOp</code>.
                     </p>
                     <div class="example" id="GUID-06A4BA93-73E3-44CB-950F-71689D0B23C6__BABGGHJD">
                        <p class="titleinexample">Example 20-2 Inserting a Node</p><pre class="oac_no_warn" dir="ltr">&lt;schema&gt;
…
    <span class="bold">&lt;!-- A type representing US States --&gt;</span>   
    &lt;simpleType name="USState"&gt; 
            &lt;restriction base="string"&gt; 
                &lt;enumeration value="NY"/&gt; 
                &lt;enumeration value="TX"/&gt; 
                &lt;enumeration value="CA"/&gt; 
            &lt;/restriction&gt; 
    &lt;/simpleType&gt;
…
&lt;/schema&gt;
</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="ADXDK197"></a><a id="ADXDK141"></a><div class="props_rev_3"><a id="GUID-F1C7A6C0-0386-4A15-B11C-813D5C96611B" name="GUID-F1C7A6C0-0386-4A15-B11C-813D5C96611B"></a><h4 id="ADXDK-GUID-F1C7A6C0-0386-4A15-B11C-813D5C96611B" class="sect4">About the delete-node Operation</h4>
                  <div>
                     <p>The delete-node operation specifies that a particular node (and its subtree) in the first input is to be deleted. </p>
                     <p><a href="determining-XML-differences-using-Java.html#GUID-F1C7A6C0-0386-4A15-B11C-813D5C96611B__BABJAAAJ">Example 20-3</a> shows a delete-node operation that deletes the highlighted node <code class="codeph">&lt;element name="LineItems" maxOccurs="unbounded"&gt;</code> from a document.
                     </p>
                     <p>Invoking a diffToDoc(…) method, using the original document (without the highlighted change) and the changed document as input produces this output:</p><pre class="oac_no_warn" dir="ltr">&lt;xd:delete-node xd:node-type="element" xd:xpath=
 "/schema[1]/element[1]/complexType[1]/sequence[1]/element[1]/element[1]"/&gt;
</pre><p>The delete-node operation is represented by the <code class="codeph">&lt;delete-node&gt;</code> element in the preceding output. This element specifies that a node of the given type is deleted. The <code class="codeph">xpath</code> attribute specifies the location of the first input node. The <code class="codeph">node-type</code> attribute specifies the type of the node to be deleted.
                     </p>
                     <p>Alternatively, when the <code class="codeph">diff(…)</code> methods are used, the delete-node operation is accessible in the <code class="codeph">DiffOpReceiver.receiverDiff(…)</code> method as a <code class="codeph">DiffOp</code> object. In this case, the operation returns the actual reference to the node in the first input DOM tree. The reference to the node to be deleted from the first input is returned by invoking <code class="codeph">getCurrent()</code> method of <code class="codeph">DiffOp</code>.
                     </p>
                     <div class="example" id="GUID-F1C7A6C0-0386-4A15-B11C-813D5C96611B__BABJAAAJ">
                        <p class="titleinexample">Example 20-3 Deleting a Node</p><pre class="oac_no_warn" dir="ltr">&lt;schema&gt;
…
     &lt;element name="PurchaseOrder"&gt; 
        &lt;complexType&gt; 
           &lt;sequence&gt; 
              &lt;element name="PO-Number" type="string"&gt; 
                 <span class="bold">&lt;element name="LineItems" maxOccurs="unbounded"&gt;</span>
…
&lt;/schema&gt;
</pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div><a id="ADXDK200"></a><a id="ADXDK203"></a><a id="ADXDK198"></a><div class="props_rev_3"><a id="GUID-3609E900-A840-43B4-8F03-2A706A6DD3D0" name="GUID-3609E900-A840-43B4-8F03-2A706A6DD3D0"></a><h3 id="ADXDK-GUID-3609E900-A840-43B4-8F03-2A706A6DD3D0" class="sect3">Invoking diff and difftoDoc Methods in a Java Application</h3>
               <div>
                  <p>Examples here show how to compare two inputs by invoking <code class="codeph">diff</code> and <code class="codeph">diffToDoc</code> methods from a Java application.
                  </p>
                  <div class="section">
                     <p></p>
                     <p><a href="determining-XML-differences-using-Java.html#GUID-3609E900-A840-43B4-8F03-2A706A6DD3D0__BABHAGEF">Example 20-4</a> shows how to use the <code class="codeph">diffToDoc</code> method to compare the input files <code class="codeph">doc</code> and <code class="codeph">doc1</code>.
                     </p>
                     <p>Continuing with this example, the two input files <code class="codeph">f1.xml</code> and <code class="codeph">f2.xml</code> contain the same data as in <a href="determining-XML-differences-using-Java.html#GUID-8E436BF5-210B-49BE-8C11-EFB007CFA70C__BABCHAEI">Example 20-1</a>.
                     </p>
                     <p>This sample code displays the contents of <code class="codeph">f1.xml</code>:
                     </p><pre class="oac_no_warn" dir="ltr">&lt;schema&gt;
     &lt;simpleType name="USState"&gt;
          &lt;restriction base="string"&gt;
               &lt;enumeration value="NY"/&gt;
               &lt;enumeration value="TX"/&gt;
               &lt;enumeration value="CA"/&gt;
          &lt;/restriction&gt;
     &lt;/simpleType&gt;
&lt;/schema&gt;
</pre><p>And this sample code displays the contents of <code class="codeph">f2.xml</code>:
                     </p><pre class="oac_no_warn" dir="ltr">&lt;schema&gt;
     &lt;simpleType name="USState"&gt;
          &lt;restriction base="string"&gt;
               &lt;enumeration value="NY"/&gt;
               &lt;enumeration value="TX"/&gt;
               &lt;enumeration value="CA"/&gt;
               &lt;enumeration value="FL"/&gt;
          &lt;/restriction&gt;
     &lt;/simpleType&gt;
&lt;/schema&gt;
</pre><p>Assume that <code class="codeph">textDiff.java</code> and the input files are in the current directory. Then enter these commands to compile and run the example:
                     </p><pre class="oac_no_warn" dir="ltr">javac -classpath "xml.jar" textDiff.java
java &#x2013;classpath “xml.jar:." textDiff f1.xml f2.xml
</pre><p>Serializing the resulting <code class="codeph">diffAsDom</code> document produces this output:
                     </p><pre class="oac_no_warn" dir="ltr">&lt;xd:xdiff xmlns:xd="http://xmlns.oracle.com/xdb/xdiff.xsd"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://xmlns.oracle.com/xdb/xdiff.xsd http://xmlns.oracle.com/xdb/xdiff.xsd"&gt;
    &lt;?oracle-xmldiff operations-in-docorder="true"
     output-model="snapshot" diff-algorithm="greedy-heuristic"?&gt;
    &lt;xd:append-node xd:node-type="element" 
     xd:parent-xpath="/schema[1]/simpleType[1]/restriction[1]"&gt;
        &lt;xd:content&gt;
            &lt;enumeration value="FL"/&gt;
        &lt;/xd:content&gt;
    &lt;/xd:append-node&gt;
&lt;/xd:xdiff&gt;
</pre><p><a href="determining-XML-differences-using-Java.html#GUID-3609E900-A840-43B4-8F03-2A706A6DD3D0__BABIEBAA">Example 20-5</a> shows how to use an implementation of the <code class="codeph">DiffOpReceiver</code> interface to process the diff returned from the comparison between two XML inputs as a list of <code class="codeph">DiffOp</code> objects.
                     </p>
                     <p>Enter these commands to compile and run the example:</p><pre class="oac_no_warn" dir="ltr">javac -classpath "xml.jar" progDiff.java
java &#x2013;classpath “xml.jar:." progDiff f1.xml f2.xml
</pre><p>The example generates this output:</p><pre class="oac_no_warn" dir="ltr">APPENDING NODE:
&lt;enumeration value="FL"/&gt;
TO THE PARENT NODE:
&lt;restriction base="string"&gt;
    &lt;enumeration value="NY"/&gt;
    &lt;enumeration value="TX"/&gt;
    &lt;enumeration value="CA"/&gt;
&lt;/restriction&gt;</pre></div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-3609E900-A840-43B4-8F03-2A706A6DD3D0__BABHAGEF">
                     <p class="titleinexample">Example 20-4 Getting a diff as a Document from a Java Application</p><pre class="oac_no_warn" dir="ltr">import oracle.xml.diff.XmlUtils;
import oracle.xml.diff.Options;
 
import java.io.File;
 
import org.w3c.dom.Node;
import org.w3c.dom.Document;
 
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.DocumentBuilder;
 
public class textDiff
{
    public static void main(String[] args) throws Exception
    {
        XmlUtils xmlUtils = new XmlUtils();
 
        //Parse the two input files
        DocumentBuilderFactory dbFactory =   
                  DocumentBuilderFactory.newInstance();
        dbFactory.setNamespaceAware(true);
        DocumentBuilder docBuilder = 
                  dbFactory.newDocumentBuilder();
        Node doc = docBuilder.parse(new File(args[0]));
        Node doc1 = docBuilder.parse(new File(args[1]));
 
        //Run the diff
        try
        {
            Document diffAsDom = xmlUtils.diffToDoc(doc, 
                                  doc1, new Options());
        }
        catch (Exception e)
        {
            e.printStackTrace();
        }
    }
}
</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-3609E900-A840-43B4-8F03-2A706A6DD3D0__BABIEBAA">
                     <p class="titleinexample">Example 20-5 Getting a diff Using DiffOpReceiver from a Java Application</p><pre class="oac_no_warn" dir="ltr">import oracle.xml.diff.DiffOp;
import oracle.xml.diff.DiffOpReceiver;
 
import java.util.List;
import java.util.Properties;
 
import java.io.File;
 
import org.w3c.dom.Node;
 
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.DocumentBuilder;
 
public class progDiff
{
  public static void main(String[] args) throws Exception
  {
     XmlUtils xmlUtils = new XmlUtils();
 
     //Parse the two input files
     DocumentBuilderFactory dbFac = 
                        DocumentBuilderFactory.newInstance();
     dbFac.setNamespaceAware(true);
     DocumentBuilder docBuilder = dbFac.newDocumentBuilder();
     Node doc = docBuilder.parse(new File(args[0]));
     Node doc1 = docBuilder.parse(new File(args[1]));
 
     Options opt = new Options();
 
     //Instantiate the DiffOpReceiver. This is the object that 
     //will receive DiffOps, ie diff operations that the XmlDiff
     //outputs. Each object represents either deletion or insert   
     //or append of a node. In this DiffOpReceiverImpl     
     //implementation (see below) of the DiffOpReceiver 
     //interface, we simply print out each diff operation.
     DiffOpReceiver diffOpRec = 
                 new progDiff().new DiffOpReceiverImpl();
     xmlUtils.diff(doc, doc1, diffOpRec, opt);
  }
 
  class DiffOpReceiverImpl implements DiffOpReceiver
  {
      public void receiveDiff(List&lt;DiffOp&gt; diffOps)
      {
         try
         {
             for (int i = 0; i &lt; diffOps.size(); i++)
             {
                 DiffOp diffOperation= diffOps.get(i);
 
                 //Delete operation, print out the deleted
                 // node from the first tree
                 if (diffOperation.getOpName() ==
                     DiffOp.Name.DELETE)
                    System.out.println ("DELETING NODE:\n" + 
    XmlUtils.nodeToString(diffOperation.getCurrent(), false));
                 
                 //Insert operation. Print out the node 
                 //from the second tree to be inserted,
                 //and the node from the first tree 
                 //before  which the insertion will happen
                 else if (diffOperation.getOpName() == 
                          DiffOp.Name.INSERT_BEFORE_NODE)
                    System.out.println ("INSERTING NODE:\n" + 
       XmlUtils.nodeToString(diffOperation.getNew(), false) +
                                           "BEFORE NODE:\n" + 
    XmlUtils.nodeToString(diffOperation.getSibling(), false));
                 
 
 
 
                 //Append as the last node of the parent. 
                 //Print out the node from the second tree
                 //that will be appended, and the parent 
                 //node from the first tree to which the
                 //former node will be appended as the 
                 //last child.
                 else if (diffOperation.getOpName() ==   
                    DiffOp.Name.INSERT_BY_APPENDING)
                    System.out.println ("APPENDING NODE:\n" +
       XmlUtils.nodeToString(diffOperation.getNew(), false) +
                                    "TO THE PARENT NODE:\n" +  
       XmlUtils.nodeToString(diffOperation.getParent(), false));
           }
       }
       catch (Exception e)
       {
           System.err.println ("Error while printing out the 
                            diff result:" + e.getMessage());
       }
    }
  }
}
</pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="ADXDK204"></a><div class="props_rev_3"><a id="GUID-1E3D0182-7F76-48C6-AF27-239EEE6F6C44" name="GUID-1E3D0182-7F76-48C6-AF27-239EEE6F6C44"></a><h3 id="ADXDK-GUID-1E3D0182-7F76-48C6-AF27-239EEE6F6C44" class="sect3">Using Java XML hash and equal Methods to Identify and Compare Inputs</h3>
               <div>
                  <p>The Java XML diffing library provides <code class="codeph">hash</code> methods to compute a hash value that uniquely identifies the input, with a high probability. Because there is a very low probability of a hash collision, there can be no guarantee that two inputs are identical when their hash values match. 
                  </p>
                  <p>To check that two inputs are truly identical with absolute certainty, use the <code class="codeph">equal</code> methods. The <code class="codeph">equal</code> methods process both inputs simultaneously, while checking them for absolute equality.
                  </p>
                  <p>The Java XML diffing library provides several equivalent variants of the <code class="codeph">hash</code> and <code class="codeph">equal</code> methods that accept inputs in different forms (DOM nodes, files, and more).
                  </p>
                  <div class="infoboxnotealso" id="GUID-1E3D0182-7F76-48C6-AF27-239EEE6F6C44__GUID-2F7D5446-48F4-4B07-8FDF-E746A6B039AD">
                     <p class="notep1">See Also:</p>
                     <p><a href="../jaxml/index.html" target="_blank"><span><cite>Oracle Database XML Java API Reference</cite></span></a> for details about the <code class="codeph">hash</code> and <code class="codeph">equal</code> methods in the <code class="codeph">XmlUtils</code> class
                     </p>
                  </div>
               </div>
            </div><a id="ADXDK206"></a><a id="ADXDK205"></a><div class="props_rev_3"><a id="GUID-DAA1054B-74EA-4EBE-A20C-ABF293D1ECC3" name="GUID-DAA1054B-74EA-4EBE-A20C-ABF293D1ECC3"></a><h3 id="ADXDK-GUID-DAA1054B-74EA-4EBE-A20C-ABF293D1ECC3" class="sect3">Diff Output Schema</h3>
               <div>
                  <p>The output schema <code class="codeph">xdiff.xsd</code>, to which the Java XML diffing library conforms, is presented.
                  </p>
                  <div class="example" id="GUID-DAA1054B-74EA-4EBE-A20C-ABF293D1ECC3__BABBHHCB">
                     <p class="titleinexample">Example 20-6 Diff Output Schema: xdiff.xsd</p><pre class="oac_no_warn" dir="ltr">&lt;schema targetNamespace="http://xmlns.oracle.com/xdb/xdiff.xsd"
    xmlns="http://www.w3.org/2001/XMLSchema"
    xmlns:xd="http://xmlns.oracle.com/xdb/xdiff.xsd"
    version="1.0" elementFormDefault="qualified"
    attributeFormDefault="qualified"&gt;
    &lt;annotation&gt;
        &lt;documentation xml:lang="en"&gt; 
         Defines the structure of XML documents that capture the difference
         between two XML inputs. Changes that are not supported by Oracle
         XmlDiff may not be expressible in this schema.
           
        'oracle-xmldiff' PI:
 
        We use 'oracle-xmldiff' PI to describe certain aspects of the diff.
        This should be the first element of top level xdiff element.
 
        version-number: version number of the XML diff schema
       
        output-model: output model for representing the diff. Currently, only
        the "snapshot" model is supported.
       
        Snapshot model:
        Each operation uses XPaths as if no operations
        have been applied to the input document.
        Default and works for both Xmldiff and XmlPatch. 
 
        &lt;!-- Example:
            &lt;?oracle-xmldiff version-number = "1.0" output-model = "snapshot"?&gt;
        --&gt;
        &lt;/documentation&gt; 
     &lt;/annotation&gt; 
    &lt;!-- Enumerate the supported node types --&gt; 
    &lt;simpleType name="xdiff-nodetype"&gt; 
        &lt;restriction base="string"&gt; 
            &lt;enumeration value="element"/&gt; 
            &lt;enumeration value="text"/&gt; 
            &lt;enumeration value="cdata"/&gt;
            &lt;enumeration value="processing-instruction"/&gt;
            &lt;enumeration value="comment"/&gt;            
         &lt;/restriction&gt; 
    &lt;/simpleType&gt;
 
    &lt;element name="xdiff"&gt; 
        &lt;complexType&gt; 
            &lt;choice minOccurs="0" maxOccurs="unbounded"&gt; 
 
                &lt;element name="append-node"&gt; 
                    &lt;complexType&gt; 
                        &lt;sequence&gt; 
                            &lt;element name="content" type="anyType"/&gt; 
                        &lt;/sequence&gt; 
                        &lt;attribute name="node-type" type="xd:xdiff-nodetype"/&gt; 
                        &lt;attribute name="parent-xpath" type="string"/&gt; 
                    &lt;/complexType&gt; 
                &lt;/element&gt;
 
                &lt;element name="insert-node-before"&gt; 
                    &lt;complexType&gt; 
                        &lt;sequence&gt; 
                            &lt;element name="content" type="anyType"/&gt; 
                        &lt;/sequence&gt; 
                        &lt;attribute name="xpath" type="string"/&gt; 
                        &lt;attribute name="node-type" type="xd:xdiff-nodetype"/&gt;
 
                    &lt;/complexType&gt; 
                &lt;/element&gt;
 
                &lt;element name="delete-node"&gt; 
                    &lt;complexType&gt; 
                        &lt;attribute name="node-type" type="xd:xdiff-nodetype"/&gt;
                        &lt;attribute name="xpath" type="string"/&gt; 
                    &lt;/complexType&gt; 
                &lt;/element&gt;
 
             &lt;/choice&gt; 
        &lt;/complexType&gt; 
    &lt;/element&gt; 
&lt;/schema&gt;
</pre></div>
                  <!-- class="example" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>