<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="Certain applications may be interested in knowing what Workspace Manager operations are being performed and may want to take some actions based on that. Several types of Workspace Manager operations can be captured as events.">
      <meta name="description" content="Certain applications may be interested in knowing what Workspace Manager operations are being performed and may want to take some actions based on that. Several types of Workspace Manager operations can be captured as events.">
      <title>Workspace Manager Events</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Workspace Manager Developer's Guide">
      <meta property="og:description" content="Certain applications may be interested in knowing what Workspace Manager operations are being performed and may want to take some actions based on that. Several types of Workspace Manager operations can be captured as events.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Workspace Manager Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="workspace-manager-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-11T16:49:08-08:00">
      <meta name="dcterms.title" content="Workspace Manager Developer's Guide">
      <meta name="dcterms.dateCopyrighted" content="2000, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E94792-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="introduction-to-workspace-manager.html" title="Previous" type="text/html">
      <link rel="next" href="valid-time-support.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="ADWSM">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="introduction-to-workspace-manager.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="valid-time-support.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Workspace Manager Developer's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="workspace-manager-concepts-usage.html" property="item" typeof="WebPage"><span property="name"> Conceptual and Usage Information </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Workspace Manager Events</li>
            </ol>
            <a id="GUID-C37F89FE-48D9-478D-A227-DBC043FF569D" name="GUID-C37F89FE-48D9-478D-A227-DBC043FF569D"></a><a id="ADWSM040"></a>
            
            <h2 id="ADWSM-GUID-C37F89FE-48D9-478D-A227-DBC043FF569D" class="sect2"><span class="enumeration_chapter">2 </span> Workspace Manager Events
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>Certain applications may be interested in knowing what Workspace Manager operations are being performed and may want to take some actions based on that. Several types of Workspace Manager operations can be captured as events.</p>
               <p>Workspace Manager provides a framework for communicating these events asynchronously to the interested applications. The applications can then take some actions based on the event. Some scenarios in which events can be used include the following:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p>An application wants to be notified whenever a workspace is merged to LIVE so that it can refresh its data.</p>
                  </li>
                  <li>
                     <p>Workspace data needs to be archived whenever a new savepoint is created.</p>
                  </li>
               </ul>
               <p><a id="d24603e36" class="indexterm-anchor"></a>The Workspace Manager event framework is built on the Oracle Advanced Queuing (AQ) capability. Messaging features provided by AQ, such as asynchronous notification, persistence, propagation, access control, history, and rule-based subscription, can be used for Workspace Manager events.
               </p>
               <p>Workspace Manager creates a multiconsumer queue where events are enqueued. The relevant information about the event, such as the type of event, the user and workspace that triggered the event, and the name of the versioned table, is initialized in the event payload and enqueued. Applications can subscribe to these events, optionally specifying a rule for their subscriptions. Only the events that satisfy the rule will be applicable to the subscriber. Subscribers can get event notification in variety of ways, such as listening for the events in the queue, registering a callback for notification, or explicitly dequeuing events from the queue.</p>
               <p>Because events are communicated asynchronously to the other applications, the performance of the workspace operation generating the event is not affected.</p>
               <div class="infoboxnote" id="GUID-C37F89FE-48D9-478D-A227-DBC043FF569D__GUID-AB5D6343-B5B6-4B66-94B2-EA919FD1030C">
                  <p class="notep1">Note:</p>
                  <p>To use Workspace Manager events in an application, you must understand the relevant AQ concepts and techniques described in <a href="../adque/aq-introduction.html#ADQUE0100" target="_blank"><span class="italic">Oracle Database Advanced Queuing User's Guide</span></a>.
                  </p>
               </div>
               <p>This chapter contains the following major sections:</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="workspace-manager-events.html#GUID-75395F72-985A-472F-AFB2-D9A18D854DAA">List of Workspace Manager Events</a><br>The following table lists the Workspace Manager events and when each occurs.
                  </li>
                  <li class="ulchildlink"><a href="workspace-manager-events.html#GUID-1E5983A9-ECAD-4BC6-8B3C-2B158A2F06C4">Event Parameters</a><br>When an event occurs, information is stored in parameters that are bundled into an object type called <code class="codeph">WMSYS.WM$EVENT_TYPE</code> and enqueued into the event queue. A subscriber can dequeue the event object on receiving notification. 
                  </li>
                  <li class="ulchildlink"><a href="workspace-manager-events.html#GUID-E5CD75CB-7402-450F-BB3B-32F18E6394F8">ALLOW_CAPTURE_EVENTS System Parameter</a><br>The Workspace Manager system parameter <code class="codeph">ALLOW_CAPTURE_EVENTS</code> can be used to capture events.
                  </li>
                  <li class="ulchildlink"><a href="workspace-manager-events.html#GUID-FF092E6F-784F-4D5E-AA64-E9A0CDDBC8BA">AQ Operations and Workspace Manager Events</a><br>This section describes Advanced Queuing objects and techniques relevant to developers of applications that work with captured Workspace Manager events.
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>Parent topic:</strong> <a href="workspace-manager-concepts-usage.html#GUID-4364945A-B6E1-47FF-9360-273FF92D7F76">Conceptual and Usage Information</a></p>
                  </div>
               </div>
            </div>
            <a id="ADWSM99182"></a><a id="ADWSM99181"></a><div class="props_rev_3"><a id="GUID-75395F72-985A-472F-AFB2-D9A18D854DAA" name="GUID-75395F72-985A-472F-AFB2-D9A18D854DAA"></a><h3 id="ADWSM-GUID-75395F72-985A-472F-AFB2-D9A18D854DAA" class="sect3"><span class="enumeration_section">2.1 </span>List of Workspace Manager Events
               </h3>
               <div>
                  <p>The following table lists the Workspace Manager events and when each occurs.</p>
                  <div class="tblformal" id="GUID-75395F72-985A-472F-AFB2-D9A18D854DAA__G1021522">
                     <p class="titleintable">Table 2-1 Workspace Manager Events</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="Workspace Manager Events" summary="Workspace Manager Events. Column 1 is Event, and column 2 is Occurs." width="100%" frame="hsides" border="1" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="50%" id="d24603e144">Event</th>
                              <th align="left" valign="bottom" width="50%" id="d24603e147">Occurs</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e152" headers="d24603e144 ">
                                 <p>TABLE_MERGE_W_REMOVE_DATA</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e152 d24603e147 ">
                                 <p>When <a href="DBMS_WM-reference.html#GUID-025C9C04-73BD-4AD6-91AA-029EE4D50F4A">MergeTable</a> is invoked with <code class="codeph">remove_data</code> set to <code class="codeph">TRUE</code>.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e169" headers="d24603e144 ">
                                 <p>TABLE_MERGE_WO_REMOVE_DATA</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e169 d24603e147 ">
                                 <p>When <a href="DBMS_WM-reference.html#GUID-025C9C04-73BD-4AD6-91AA-029EE4D50F4A">MergeTable</a> is invoked with <code class="codeph">remove_data</code> set to <code class="codeph">FALSE</code>.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e186" headers="d24603e144 ">
                                 <p>TABLE_REFRESH</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e186 d24603e147 ">
                                 <p>When <a href="DBMS_WM-reference.html#GUID-6600B232-A8C2-4564-B0DD-227F7271317A">RefreshTable</a> is invoked.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e197" headers="d24603e144 ">
                                 <p>TABLE_ROLLBACK</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e197 d24603e147 ">
                                 <p>When <a href="DBMS_WM-reference.html#GUID-7AB0F531-1C20-48CA-893D-EE252A57EA73">RollbackTable</a> is invoked.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e208" headers="d24603e144 ">
                                 <p>WORKSPACE_COMPRESS</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e208 d24603e147 ">
                                 <p>When <a href="DBMS_WM-reference.html#GUID-BD1132FA-656F-442D-A940-661E67DC562E">CompressWorkspace</a> or <a href="DBMS_WM-reference.html#GUID-7622FE8D-B9FF-41F9-AF69-8523E10FE535">CompressWorkspaceTree</a> is invoked.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e223" headers="d24603e144 ">
                                 <p>WORKSPACE_CREATE</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e223 d24603e147 ">
                                 <p>When <a href="DBMS_WM-reference.html#GUID-963E70CB-491F-4539-A9FD-4CA9E49D75B1">CreateWorkspace</a> is invoked.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e234" headers="d24603e144 ">
                                 <p>WORKSPACE_MERGE_W_REMOVE</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e234 d24603e147 ">
                                 <p>When <a href="DBMS_WM-reference.html#GUID-638B284A-0A7F-4D3F-8DD7-D302489B29C7">MergeWorkspace</a> is invoked with <code class="codeph">remove_workspace</code> set to <code class="codeph">TRUE</code>.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e251" headers="d24603e144 ">
                                 <p>WORKSPACE_MERGE_WO_REMOVE</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e251 d24603e147 ">
                                 <p>When <a href="DBMS_WM-reference.html#GUID-638B284A-0A7F-4D3F-8DD7-D302489B29C7">MergeWorkspace</a> is invoked with <code class="codeph">remove_workspace</code> set to <code class="codeph">FALSE</code>.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e268" headers="d24603e144 ">
                                 <p>WORKSPACE_REFRESH</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e268 d24603e147 ">
                                 <p>When <a href="DBMS_WM-reference.html#GUID-E4AE382B-FF99-4333-8F21-A56DE5318338">RefreshWorkspace</a> is invoked.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e279" headers="d24603e144 ">
                                 <p>WORKSPACE_REMOVE</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e279 d24603e147 ">
                                 <p>When <a href="DBMS_WM-reference.html#GUID-C2D5232B-C82F-4D1F-8FDE-D5800EF5DE13">RemoveWorkspace</a> or <a href="DBMS_WM-reference.html#GUID-C6B0F84A-9649-425B-97CF-0299344F2C68">RemoveWorkspaceTree</a> is invoked.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e294" headers="d24603e144 ">
                                 <p>WORKSPACE_ROLLBACK</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e294 d24603e147 ">
                                 <p>When <a href="DBMS_WM-reference.html#GUID-34F03A7E-6280-4231-BFBC-28D0FEB0486C">RollbackWorkspace</a> is invoked.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="50%" id="d24603e306" headers="d24603e144 ">
                                 <p>WORKSPACE_VERSION</p>
                              </td>
                              <td align="left" valign="top" width="50%" headers="d24603e306 d24603e147 ">
                                 <p>When a new version is created in the workspace as a result of the creation of an explicit or implicit savepoint. (Savepoints are described in <a href="introduction-to-workspace-manager.html#GUID-9F85C3B4-55C8-4C15-87B1-381B0AB04206">Using Savepoints</a>.)
                                 </p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="workspace-manager-events.html#GUID-C37F89FE-48D9-478D-A227-DBC043FF569D" title="Certain applications may be interested in knowing what Workspace Manager operations are being performed and may want to take some actions based on that. Several types of Workspace Manager operations can be captured as events.">Workspace Manager Events</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADWSM99184"></a><a id="ADWSM99183"></a><div class="props_rev_3"><a id="GUID-1E5983A9-ECAD-4BC6-8B3C-2B158A2F06C4" name="GUID-1E5983A9-ECAD-4BC6-8B3C-2B158A2F06C4"></a><h3 id="ADWSM-GUID-1E5983A9-ECAD-4BC6-8B3C-2B158A2F06C4" class="sect3"><span class="enumeration_section">2.2 </span>Event Parameters
               </h3>
               <div>
                  <p>When an event occurs, information is stored in parameters that are bundled into an object type called <code class="codeph">WMSYS.WM$EVENT_TYPE</code> and enqueued into the event queue. A subscriber can dequeue the event object on receiving notification. 
                  </p>
                  <p>The following table describes the Workspace Manager event parameters.</p>
                  <div class="tblformal" id="GUID-1E5983A9-ECAD-4BC6-8B3C-2B158A2F06C4__G1021565">
                     <p class="titleintable">Table 2-2 Workspace Manager Event Parameters</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="Workspace Manager Event Parameters" summary="Workspace Manager Event Parameters. Column 1 is Event Parameter, column 2 is Data Type, and column 3 is Description." width="100%" frame="hsides" border="1" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="29%" id="d24603e377">Event Parameter</th>
                              <th align="left" valign="bottom" width="29%" id="d24603e380">Data Type</th>
                              <th align="left" valign="bottom" width="43%" id="d24603e383">Description</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d24603e388" headers="d24603e377 ">
                                 <p>event_name</p>
                              </td>
                              <td align="left" valign="top" width="29%" headers="d24603e388 d24603e380 ">
                                 <p><code class="codeph">VARCHAR2(128)</code></p>
                              </td>
                              <td align="left" valign="top" width="43%" headers="d24603e388 d24603e383 ">
                                 <p>Name indicating the type of event.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d24603e399" headers="d24603e377 ">
                                 <p>workspace_name</p>
                              </td>
                              <td align="left" valign="top" width="29%" headers="d24603e399 d24603e380 ">
                                 <p><code class="codeph">VARCHAR2(128)</code></p>
                              </td>
                              <td align="left" valign="top" width="43%" headers="d24603e399 d24603e383 ">
                                 <p>Workspace that caused the event to occur.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d24603e410" headers="d24603e377 ">
                                 <p>parent_workspace_name</p>
                              </td>
                              <td align="left" valign="top" width="29%" headers="d24603e410 d24603e380 ">
                                 <p><code class="codeph">VARCHAR2(128)</code></p>
                              </td>
                              <td align="left" valign="top" width="43%" headers="d24603e410 d24603e383 ">
                                 <p>Parent workspace of the workspace that caused the event to occur.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d24603e421" headers="d24603e377 ">
                                 <p>user_name</p>
                              </td>
                              <td align="left" valign="top" width="29%" headers="d24603e421 d24603e380 ">
                                 <p><code class="codeph">VARCHAR2(128)</code></p>
                              </td>
                              <td align="left" valign="top" width="43%" headers="d24603e421 d24603e383 ">
                                 <p>User that caused the event to occur.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d24603e432" headers="d24603e377 ">
                                 <p>table_name </p>
                              </td>
                              <td align="left" valign="top" width="29%" headers="d24603e432 d24603e380 ">
                                 <p><code class="codeph">VARCHAR2(128)</code></p>
                              </td>
                              <td align="left" valign="top" width="43%" headers="d24603e432 d24603e383 ">
                                 <p>Version-enabled table on which the event occurred. If this parameter does not apply to an event, it is null.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d24603e443" headers="d24603e377 ">
                                 <p>aux_params</p>
                              </td>
                              <td align="left" valign="top" width="29%" headers="d24603e443 d24603e380 ">
                                 <p><code class="codeph">WMSYS.WM$NV_PAIR_NT_TYPE</code> (which is table of <code class="codeph">WMSYS.WM$NV_PAIR_TYPE</code>)
                                 </p>
                              </td>
                              <td align="left" valign="top" width="43%" headers="d24603e443 d24603e383 ">
                                 <p>A nested table of (name,value) pairs that can contain additional information about the event.</p>
                                 <p>For <code class="codeph">TABLE_</code><span class="italic">xxx</span><span class="italic"> </span>events, it has one row containing the <code class="codeph">WHERE</code> clause string used for the operation.
                                 </p>
                                 <p>For <code class="codeph">WORKSPACE_VERSION</code> events, it has one row containing the savepoint name associated with the newly created version.
                                 </p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="workspace-manager-events.html#GUID-C37F89FE-48D9-478D-A227-DBC043FF569D" title="Certain applications may be interested in knowing what Workspace Manager operations are being performed and may want to take some actions based on that. Several types of Workspace Manager operations can be captured as events.">Workspace Manager Events</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADWSM99186"></a><a id="ADWSM99185"></a><div class="props_rev_3"><a id="GUID-E5CD75CB-7402-450F-BB3B-32F18E6394F8" name="GUID-E5CD75CB-7402-450F-BB3B-32F18E6394F8"></a><h3 id="ADWSM-GUID-E5CD75CB-7402-450F-BB3B-32F18E6394F8" class="sect3"><span class="enumeration_section">2.3 </span>ALLOW_CAPTURE_EVENTS System Parameter
               </h3>
               <div>
                  <p>The Workspace Manager system parameter <code class="codeph">ALLOW_CAPTURE_EVENTS</code> can be used to capture events.
                  </p>
                  <p>Before you can capture any Workspace Manager events, you must use the <a href="DBMS_WM-reference.html#GUID-3DF05DFE-4D98-4F09-AB40-2CDA0A0F3EFD">SetSystemParameter</a> procedure to set the Workspace Manager system parameter <code class="codeph">ALLOW_CAPTURE_EVENTS</code> to the value <code class="codeph">ON</code>. This does not, however, cause any events to be captured; to capture events, you must use the <a href="DBMS_WM-reference.html#GUID-9D766800-9C80-440A-82EB-8FFD56062641">SetCaptureEvent</a> procedure.
                  </p>
                  <p>You can later disallow the capture of Workspace Manager events by using the <a href="DBMS_WM-reference.html#GUID-3DF05DFE-4D98-4F09-AB40-2CDA0A0F3EFD">SetSystemParameter</a> procedure to set <code class="codeph">ALLOW_CAPTURE_EVENTS</code> to the value <code class="codeph">OFF</code>, but you must first ensure that no events are currently being captured. <a href="workspace-manager-events.html#GUID-E5CD75CB-7402-450F-BB3B-32F18E6394F8__I1021298">Example 2-1</a> shows the sequence of procedure calls for enabling and disabling the capture of all events, and starting and stopping the capture all events.
                  </p>
                  <div class="example" id="GUID-E5CD75CB-7402-450F-BB3B-32F18E6394F8__I1021298">
                     <p class="titleinexample">Example 2-1 Capturing Workspace Manager Events</p><pre class="oac_no_warn" dir="ltr">-- Allow Workspace Manager events to be captured. (Required for SetCaptureEvent)
EXECUTE DBMS_WM.SetSystemParameter ('ALLOW_CAPTURE_EVENTS', 'ON');
-- Start capturing all Workspace Manager events.
EXECUTE DBMS_WM.SetCaptureEvent ('ALL_EVENTS','ON');
   .
   .
   .
-- Stop capturing all Workspace Manager events.
EXECUTE DBMS_WM.SetCaptureEvent ('ALL_EVENTS','OFF');
-- Disallow capture of Workspace Manager events.
EXECUTE DBMS_WM.SetSystemParameter ('ALLOW_CAPTURE_EVENTS', 'OFF');</pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="workspace-manager-events.html#GUID-C37F89FE-48D9-478D-A227-DBC043FF569D" title="Certain applications may be interested in knowing what Workspace Manager operations are being performed and may want to take some actions based on that. Several types of Workspace Manager operations can be captured as events.">Workspace Manager Events</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADWSM99187"></a><div class="props_rev_3"><a id="GUID-FF092E6F-784F-4D5E-AA64-E9A0CDDBC8BA" name="GUID-FF092E6F-784F-4D5E-AA64-E9A0CDDBC8BA"></a><h3 id="ADWSM-GUID-FF092E6F-784F-4D5E-AA64-E9A0CDDBC8BA" class="sect3"><span class="enumeration_section">2.4 </span>AQ Operations and Workspace Manager Events
               </h3>
               <div>
                  <p>This section describes Advanced Queuing objects and techniques relevant to developers of applications that work with captured Workspace Manager events.</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="workspace-manager-events.html#GUID-D5B33938-643E-4F53-9B06-06559BB03244">Workspace Manager Event Queue Administration</a><br></li>
                     <li class="ulchildlink"><a href="workspace-manager-events.html#GUID-8F9EF92F-F4F7-45CE-838F-5873685018AE">Privileges and Access Control for Queues</a><br></li>
                     <li class="ulchildlink"><a href="workspace-manager-events.html#GUID-264003A4-9C2C-4529-81B0-A78C1E1073CC">Rule-Based Subscription</a><br></li>
                     <li class="ulchildlink"><a href="workspace-manager-events.html#GUID-19EB7A56-8914-4265-AFAD-448CF9F78AC8">Listening for Events</a><br></li>
                     <li class="ulchildlink"><a href="workspace-manager-events.html#GUID-C598F17B-DBC2-4F6F-8951-0D96BF226453">Asynchronous Notification</a><br></li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="workspace-manager-events.html#GUID-C37F89FE-48D9-478D-A227-DBC043FF569D" title="Certain applications may be interested in knowing what Workspace Manager operations are being performed and may want to take some actions based on that. Several types of Workspace Manager operations can be captured as events.">Workspace Manager Events</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADWSM99189"></a><a id="ADWSM99188"></a><div class="props_rev_3"><a id="GUID-D5B33938-643E-4F53-9B06-06559BB03244" name="GUID-D5B33938-643E-4F53-9B06-06559BB03244"></a><h4 id="ADWSM-GUID-D5B33938-643E-4F53-9B06-06559BB03244" class="sect4"><span class="enumeration_section">2.4.1 </span>Workspace Manager Event Queue Administration
                  </h4>
                  <div>
                     <p>Workspace Manager creates a multiconsumer queue named <code class="codeph">WMSYS.WM$EVENT_QUEUE</code> based on a queue table named <code class="codeph">WMSYS.WM$EVENT_QUEUE_TABLE</code>. The queue payload type is <code class="codeph">WMSYS.WM$EVENT_TYPE</code>, which is an object type.
                     </p>
                     <p>AQ creates some views for the queue that can be used for administrative purposes. <a href="workspace-manager-events.html#GUID-D5B33938-643E-4F53-9B06-06559BB03244__G1021601" title="AQ Administrative Views for Workspace Manager. Column 1 is View Name, and column 2 is Description.">Table 2-3</a> describes the views of interest to developers of Workspace Manager applications.
                     </p>
                     <div class="tblformal" id="GUID-D5B33938-643E-4F53-9B06-06559BB03244__G1021601">
                        <p class="titleintable">Table 2-3 AQ Administrative Views for Workspace Manager</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="AQ Administrative Views for Workspace Manager" summary="AQ Administrative Views for Workspace Manager. Column 1 is View Name, and column 2 is Description." width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="31%" id="d24603e684">View Name</th>
                                 <th align="left" valign="bottom" width="69%" id="d24603e687">Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d24603e692" headers="d24603e684 ">
                                    <p>WMSYS.AQ$WM$EVENT_QUEUE_TABLE</p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d24603e692 d24603e687 ">
                                    <p>Describes the queue table in which events are stored. This view can be used for querying the events. The <code class="codeph">AQ_ADMINISTRATOR_ROLE</code> role and the <code class="codeph">WM_ADMIN</code> system privilege are granted select privileges on this view.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d24603e705" headers="d24603e684 ">
                                    <p>WMSYS.AQ$WM$EVENT_QUEUE_TABLE_S</p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d24603e705 d24603e687 ">
                                    <p>Displays all the subscribers for the event queue; also displays the transformation for the subscriber if it was created with one. The <code class="codeph">AQ_ADMINISTRATOR_ROLE</code> role and the <code class="codeph">WM_ADMIN</code> system privilege are granted select privileges on this view.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d24603e718" headers="d24603e684 ">
                                    <p>WMSYS.AQ$WM$EVENT_QUEUE_TABLE_R</p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d24603e718 d24603e687 ">
                                    <p>Displays only the rule-based subscribers for all queues in a given queue table, as well as the text of the rule defined by each subscriber. Also displays the transformation for the subscriber if one was specified. The <code class="codeph">AQ_ADMINISTRATOR_ROLE</code> role and the <code class="codeph">WM_ADMIN</code> system privilege are granted select privileges on this view.
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="workspace-manager-events.html#GUID-FF092E6F-784F-4D5E-AA64-E9A0CDDBC8BA" title="This section describes Advanced Queuing objects and techniques relevant to developers of applications that work with captured Workspace Manager events.">AQ Operations and Workspace Manager Events</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADWSM99191"></a><a id="ADWSM99190"></a><div class="props_rev_3"><a id="GUID-8F9EF92F-F4F7-45CE-838F-5873685018AE" name="GUID-8F9EF92F-F4F7-45CE-838F-5873685018AE"></a><h4 id="ADWSM-GUID-8F9EF92F-F4F7-45CE-838F-5873685018AE" class="sect4"><span class="enumeration_section">2.4.2 </span>Privileges and Access Control for Queues
                  </h4>
                  <div>
                     <p>The database administrator has several options for granting privileges and access to queues. Some possible scenarios include:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Grant the system privileges <code class="codeph">ENQUEUE ANY QUEUE</code> and <code class="codeph">DEQUEUE ANY QUEUE</code> directly to a database user by using the <code class="codeph">DBMS_AQADM.GRANT_SYSTEM_PRIVILEGE</code> procedure, and optionally later revoke privileges by using the <code class="codeph">DBMS_AQADM.REVOKE_SYSTEM_PRIVILEGE</code> procedure.
                           </p>
                        </li>
                        <li>
                           <p>Grant the queue privileges <code class="codeph">ENQUEUE</code> and <code class="codeph">DEQUEUE</code> to the event queue <code class="codeph">WMSYS.WM$EVENT_QUEUE</code> to a database user by using the <code class="codeph">DBMS_AQADM.GRANT_QUEUE_PRIVILEGE</code> procedure, and optionally later revoke privileges by using the <code class="codeph">DBMS_AQADM.REVOKE_QUEUE_PRIVILEGE</code> procedure.
                           </p>
                        </li>
                        <li>
                           <p>Grant the role <code class="codeph">AQ_ADMINISTRATOR_ROLE</code> to a database user to give that user administrative privileges on any queue.
                           </p>
                        </li>
                     </ul>
                     <p><a href="workspace-manager-events.html#GUID-8F9EF92F-F4F7-45CE-838F-5873685018AE__i1021283">Example 2-2</a> shows privileges being granted for a user to subscribe to the event queue and dequeue events.
                     </p>
                     <div class="example" id="GUID-8F9EF92F-F4F7-45CE-838F-5873685018AE__i1021283">
                        <p class="titleinexample">Example 2-2 Granting Privileges for Queue Access</p><pre class="oac_no_warn" dir="ltr">-- Do the following while connected as SYSDBA.
-- These privileges are required for the user to execute AQ packages.
grant execute on DBMS_AQ to SCOTT ;
grant execute on DBMS_AQADM to SCOTT ;

-- Grant privilege to SCOTT for subscribing to the event queue.
exec DBMS_AQADM.GRANT_SYSTEM_PRIVILEGE('MANAGE_ANY','SCOTT') ;

-- Grant privilege to SCOTT to dequeue events. (As an alternative, you could use
-- DBMS_AQADM.GRANT_QUEUE_PRIVILEGE to grant the DEQUEUE privilege on
-- WMSYS.WM$EVENT_QUEUE.)
exec DBMS_AQADM.GRANT_SYSTEM_PRIVILEGE('DEQUEUE_ANY','SCOTT') ;</pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="workspace-manager-events.html#GUID-FF092E6F-784F-4D5E-AA64-E9A0CDDBC8BA" title="This section describes Advanced Queuing objects and techniques relevant to developers of applications that work with captured Workspace Manager events.">AQ Operations and Workspace Manager Events</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADWSM99193"></a><a id="ADWSM99192"></a><div class="props_rev_3"><a id="GUID-264003A4-9C2C-4529-81B0-A78C1E1073CC" name="GUID-264003A4-9C2C-4529-81B0-A78C1E1073CC"></a><h4 id="ADWSM-GUID-264003A4-9C2C-4529-81B0-A78C1E1073CC" class="sect4"><span class="enumeration_section">2.4.3 </span>Rule-Based Subscription
                  </h4>
                  <div>
                     <p>An event can be delivered to multiple recipients based on event parameters. You can define a rule-based subscription for the event queue as the mechanism for specifying interest in receiving events. Subscriber rules are then used to evaluate recipients for event delivery. A null rule indicates that the subscriber wishes to receive all events.</p>
                     <p><a href="workspace-manager-events.html#GUID-264003A4-9C2C-4529-81B0-A78C1E1073CC__i1021306">Example 2-3</a> creates a rule-based subscription for user SCOTT to deliver WORKSPACE_MERGE_WO_REMOVE events when the parent workspace is the <code class="codeph">LIVE</code> workspace.
                     </p>
                     <div class="example" id="GUID-264003A4-9C2C-4529-81B0-A78C1E1073CC__i1021306">
                        <p class="titleinexample">Example 2-3 Rule-Based Subscription for Workspace Manager Events</p><pre class="oac_no_warn" dir="ltr">rem =================================================
rem Create queue subscribers
rem Register for MergeWorkspace event when
rem a workspace is merged to LIVE
rem =================================================

connect scott
-- Enter password when prompted.

DECLARE
    subscriber sys.aq$_agent;
BEGIN
    subscriber := sys.aq$_agent('MERGE_LISTENER', NULL, NULL);
    dbms_aqadm.add_subscriber(
      queue_name =&gt; 'WMSYS.WM$EVENT_QUEUE',
      subscriber =&gt; subscriber,
      rule =&gt; 'tab.user_data.event_name = ''WORKSPACE_MERGE_WO_REMOVE''
               and tab.user_data.parent_workspace_name = ''LIVE''');
END;
/</pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="workspace-manager-events.html#GUID-FF092E6F-784F-4D5E-AA64-E9A0CDDBC8BA" title="This section describes Advanced Queuing objects and techniques relevant to developers of applications that work with captured Workspace Manager events.">AQ Operations and Workspace Manager Events</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADWSM99195"></a><a id="ADWSM99194"></a><div class="props_rev_3"><a id="GUID-19EB7A56-8914-4265-AFAD-448CF9F78AC8" name="GUID-19EB7A56-8914-4265-AFAD-448CF9F78AC8"></a><h4 id="ADWSM-GUID-19EB7A56-8914-4265-AFAD-448CF9F78AC8" class="sect4"><span class="enumeration_section">2.4.4 </span>Listening for Events
                  </h4>
                  <div>
                     <p>The listen call is a blocking call that can be used to wait for events on a queue or a list of subscriptions. If the listen returns successfully, a dequeue must be used to retrieve the event.</p>
                     <p><a href="workspace-manager-events.html#GUID-19EB7A56-8914-4265-AFAD-448CF9F78AC8__i1021314">Example 2-4</a> listens for events on an event queue.
                     </p>
                     <div class="example" id="GUID-19EB7A56-8914-4265-AFAD-448CF9F78AC8__i1021314">
                        <p class="titleinexample">Example 2-4 Listening for a Workspace Manager Event</p><pre class="oac_no_warn" dir="ltr">rem ==============================================================
rem The following example shows how an application can listen for
rem an event. Explicit dequeue must be performed to get the actual
rem event parameters. The user SCOTT must have sufficient privileges 
rem as described in the "Access Control" section.
rem ==============================================================

connect scott
-- Enter password when prompted.

set serveroutput on

DECLARE
 qlist dbms_aq.aq$_agent_list_t;
 agent_w_msg sys.aq$_agent;
 listen_timeout exception;
 pragma exception_init(listen_timeout, -25254);
BEGIN
 qlist(0) := sys.aq$_agent('MERGE_LISTENER', 'WMSYS.WM$EVENT_QUEUE', NULL);

 dbms_output.put_line ('Listening on event queue.');

 BEGIN

 DBMS_AQ.LISTEN(
         agent_list =&gt; qlist,
         wait =&gt; 30,
         agent =&gt;  agent_w_msg);

         dbms_output.put_line(agent_w_msg.name) ;

         /* The event can be dequeued here to get the event data */

 EXCEPTION
        when listen_timeout THEN
                null;
 END;

END;
/</pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="workspace-manager-events.html#GUID-FF092E6F-784F-4D5E-AA64-E9A0CDDBC8BA" title="This section describes Advanced Queuing objects and techniques relevant to developers of applications that work with captured Workspace Manager events.">AQ Operations and Workspace Manager Events</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADWSM99197"></a><a id="ADWSM99196"></a><div class="props_rev_3"><a id="GUID-C598F17B-DBC2-4F6F-8951-0D96BF226453" name="GUID-C598F17B-DBC2-4F6F-8951-0D96BF226453"></a><h4 id="ADWSM-GUID-C598F17B-DBC2-4F6F-8951-0D96BF226453" class="sect4"><span class="enumeration_section">2.4.5 </span>Asynchronous Notification
                  </h4>
                  <div>
                     <p>Asynchronous notification allows clients to receive notification of an event of interest. The client can use it to monitor multiple subscriptions. The client does not have to be connected to the database to receive notifications regarding its subscriptions. </p>
                     <p>If an application registers for asynchronous notification of Workspace Manager events using callbacks, the minimum values for the following <code class="codeph">init.ora</code> parameters should be:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><code class="codeph">aq_tm_processes</code> = 1
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">job_queue_processes</code> = 2
                           </p>
                        </li>
                     </ul>
                     <p><a href="workspace-manager-events.html#GUID-C598F17B-DBC2-4F6F-8951-0D96BF226453__I1021329">Example 2-5</a> registers for a callback to receive asynchronous notification of events.
                     </p>
                     <div class="example" id="GUID-C598F17B-DBC2-4F6F-8951-0D96BF226453__I1021329">
                        <p class="titleinexample">Example 2-5 Receiving Asynchronous Notification of Events</p><pre class="oac_no_warn" dir="ltr">rem =====================================================
rem Example of how to register for a callback to the event
rem queue on behalf of a subscriber. Subscriber has already
rem been defined in previous section. The callback is
rem invoked by the AQ framework whenever an event satisfying the
rem rule for the subscriber occurs. The minimum values for
rem the following init.ora parameters should be set as follows.
rem   aq_tm_processes = 1
rem   job_queue_processes = 2
rem The user SCOTT must have sufficient privileges.
rem ===========================================================

CONNECT scott
-- Enter password when prompted.

CREATE TABLE merge_log
(
  event_name      varchar2(128),
  workspace_name  varchar2(128),
  parent_workspace_name varchar2(128),
  user_name       varchar2(128)
);

CREATE OR REPLACE PROCEDURE scott.event_callback(
   context RAW , reginfo sys.aq$_reg_info, descr sys.aq$_descriptor, 
   payload VARCHAR2,  payloadl NUMBER)
AS
    deq_msgid           RAW(16);
    dopt                dbms_aq.dequeue_options_t;
    mprop               dbms_aq.message_properties_t;
    event               WMSYS.WM$EVENT_TYPE;
    no_messages         exception;
    pragma exception_init(no_messages, -25228);

BEGIN
    dopt.consumer_name := 'MERGE_LISTENER';
    dopt.wait := 30;
    dopt.msgid := descr.msg_id;

    dbms_aq.dequeue(
        queue_name =&gt; 'WMSYS.WM$EVENT_QUEUE',
        dequeue_options =&gt; dopt,
        message_properties =&gt; mprop,
        payload =&gt; event,
        msgid =&gt; deq_msgid);

    INSERT INTO merge_log VALUES (event.event_name, event.workspace_name,
      event.parent_workspace_name, event.user_name);

    /* Note: If there are additional parameters stored in
       "aux_params" attribute, it can be accessed using 
       event.aux_params(1).name, event.aux_params(1).value, 
       event.aux_params(2).name … and so on. The number of 
       parameters can be accessed using event.aux_params.count 
       when aux_params is not null.
     */
END;
/

grant execute on scott.event_callback to public ;

rem ==================================================
rem Register a callback for the event
rem Queue name and subscriber name have to be specified
rem while registering for a callback
rem ==================================================

DECLARE
  reginfo1            sys.aq$_reg_info;
  reginfolist         sys.aq$_reg_info_list;
BEGIN
  reginfo1 := sys.aq$_reg_info('WMSYS.WM$EVENT_QUEUE:MERGE_LISTENER',1,'plsql://scott.event_callback?PR=1',HEXTORAW('FF'));

  reginfolist := sys.aq$_reg_info_list(reginfo1);

  sys.dbms_aq.register(reginfolist, 1);

  COMMIT;

END;
/</pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="workspace-manager-events.html#GUID-FF092E6F-784F-4D5E-AA64-E9A0CDDBC8BA" title="This section describes Advanced Queuing objects and techniques relevant to developers of applications that work with captured Workspace Manager events.">AQ Operations and Workspace Manager Events</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>