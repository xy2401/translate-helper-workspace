<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="Oracle Maps is the name for a suite of technologies for developing high-performance interactive web-based mapping applications.">
      <meta name="description" content="Oracle Maps is the name for a suite of technologies for developing high-performance interactive web-based mapping applications.">
      <title>Oracle Maps</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Map Visualization Developer's Guide ">
      <meta property="og:description" content="Oracle Maps is the name for a suite of technologies for developing high-performance interactive web-based mapping applications.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Map Visualization Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="spatial-and-graph-map-visualization-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-10T11:37:22-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2001, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E94797-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="map-visualization-servers.html" title="Previous" type="text/html">
      <link rel="next" href="oracle-map-builder-tool.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Spatial and Graph Map Visualization Developer's Guide">
    <meta name="dcterms.isVersionOf" content="JIMPV">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="map-visualization-servers.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="oracle-map-builder-tool.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Map Visualization Developer's Guide </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Oracle Maps</li>
            </ol>
            <a id="GUID-9B4DB4C9-5E4B-4776-92F6-84084F65784E" name="GUID-9B4DB4C9-5E4B-4776-92F6-84084F65784E"></a><a id="JIMPV8000"></a>
            
            <h2 id="JIMPV-GUID-9B4DB4C9-5E4B-4776-92F6-84084F65784E" class="sect2"><span class="enumeration_chapter">4 </span>Oracle Maps
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>Oracle Maps is the name for a suite of technologies for developing high-performance interactive web-based mapping applications.</p>
               <p><a id="d26950e23" class="indexterm-anchor"></a>Oracle Maps is included with the map visualization component.
               </p>
               <p>The map visualization component allows users who have a valid license and comply with map tile providersâ€™ Terms of Use to display map tiles from those licensed services.</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="oracle-maps.html#GUID-0D5BC30A-40AC-4347-89FA-E95D44918E32">Oracle Maps JavaScript API</a><br>The Oracle Maps JavaScript client is a browser-based map visualization engine that works on top of the map tile server and that uses HTML5 technology.
                  </li>
                  <li class="ulchildlink"><a href="oracle-maps.html#GUID-B0C3C99C-3D0C-4FB7-BCF5-F924A42B56CC">Developing Oracle Maps Applications</a><br>This topic describes how to develop Oracle Maps applications.
                  </li>
                  <li class="ulchildlink"><a href="oracle-maps.html#GUID-E3A7A484-B021-459C-8AE9-E7ABBDC04C94">Using Google Maps</a><br>Applications can display Google Maps tiles as a built-in map tile layer, by creating and adding to the map window an instance of <code class="codeph">MVGoogleTileLayer</code> .
                  </li>
                  <li class="ulchildlink"><a href="oracle-maps.html#GUID-DB268520-D5AC-4E32-A674-6FB17A21B72B">Transforming Data to a Spherical Mercator Coordinate System</a><br>Popular online map services such as Google Maps use a spherical Mercator projection for their maps.
                  </li>
                  <li class="ulchildlink"><a href="oracle-maps.html#GUID-F1647A8F-CA15-42D2-8037-09B0EA332611">Using Dynamic Tile Layers</a><br>A <span class="bold">dynamic tile layer</span> is a tile layer defined on the client side.
                  </li>
               </ul>
            </div>
            <a id="JIMPV9821"></a><div class="props_rev_3"><a id="GUID-0D5BC30A-40AC-4347-89FA-E95D44918E32" name="GUID-0D5BC30A-40AC-4347-89FA-E95D44918E32"></a><h3 id="JIMPV-GUID-0D5BC30A-40AC-4347-89FA-E95D44918E32" class="sect3"><span class="enumeration_section">4.1 </span>Oracle Maps JavaScript API
               </h3>
               <div>
                  <p>The Oracle Maps JavaScript client is a browser-based map visualization engine that works on top of the map tile server and that uses HTML5 technology.</p>
                  <p>It implements the following functions:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Fetching map tiles from the map tile server and displaying them as a map tile layer in the web browser.</p>
                     </li>
                     <li>
                        <p>Controlling user interaction, such as dragging for map navigation, clicking features, drawing rectangles, and redlining.</p>
                        <p>Drawing a rectangle refers to the application user creating a rectangle by clicking and holding the mouse button at one corner of the rectangle, dragging the mouse to the diagonally opposite corner, and releasing the mouse button.</p>
                        <p><span class="bold">Redlining</span> refers to the application user creating a polygon or polyline by clicking the mouse button and then moving the mouse and clicking multiple times, with each click extending the redline by a straight line. (Redline drawings are often rendered in red, although you can specify a line style that uses any color.)
                        </p>
                     </li>
                  </ul>
                  <p>To access these functions, use the JavaScript API, which consists of several JavaScript classes. For detailed information about all classes in the Oracle Maps JavaScript API ), see the Javadoc-style reference documentation, which is included in the <code class="codeph">mvdemo.ear</code> file and is available at the following location: <code class="codeph">http://</code><span class="italic"><code class="codeph">host:port</code></span><code class="codeph">/mvdemo/api/oracle_maps_html5_api.jsp</code></p>
                  <p>Tutorials and demos for the API are available as a standalone packaged application with the root context path <code class="codeph">/mvdemo</code>. The tutorials start with the basics (display a map tile layer, add a navigation panel, display interactive features and information windows) and move on to more complex topics such as registering event listeners, programmatically creating and using styles, and spatial filtering.
                  </p>
                  <p>The tutorials are all based on the MVDEMO sample data set (available from the map visualization component page on the Oracle Technology Network) and assume a data source named <code class="codeph">mvdemo</code>. The tutorial page has three panels. The left one lists the sample code, or demo, titles. Click on one and a map, or the result of executing that sample code, is displayed in the top right panel. The bottom panel has tabs titled JavaScript and HTML, which respectively show the JavaScript and HTML code fragments for the selected demo.
                  </p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="oracle-maps.html#GUID-D915B019-4F89-4648-BD93-53CD42D2690E">About the Oracle Maps JavaScript API</a><br></li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="oracle-maps.html#GUID-9B4DB4C9-5E4B-4776-92F6-84084F65784E" title="Oracle Maps is the name for a suite of technologies for developing high-performance interactive web-based mapping applications.">Oracle Maps</a></p>
                     </div>
                  </div>
               </div>
               <a id="JIMPV9960"></a><div class="props_rev_3"><a id="GUID-D915B019-4F89-4648-BD93-53CD42D2690E" name="GUID-D915B019-4F89-4648-BD93-53CD42D2690E"></a><h4 id="JIMPV-GUID-D915B019-4F89-4648-BD93-53CD42D2690E" class="sect4"><span class="enumeration_section">4.1.1 </span>About the Oracle Maps JavaScript API
                  </h4>
                  <div>
                     <p>The Oracle Maps JavaScript API takes advantage of the capabilities of modern browsers and HTML5. Some of its features include:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Built-in support of various third party map tile services, such as maps.oracle.com, Nokia Maps, OpenStreet Maps, and other mapping service providers</p>
                        </li>
                        <li>
                           <p>Rich client side rendering of geospatial data with on-the-fly application of rendering styles and effects such as gradients, animation, and drop-shadows</p>
                        </li>
                        <li>
                           <p>Autoclustering of large number of points and client side heat map generation</p>
                        </li>
                        <li>
                           <p>Client side feature filtering based on attribute values as well as spatial predicates (query windows)</p>
                        </li>
                        <li>
                           <p>A rich set of built-in map controls and tools, including a customizable navigation bar and information windows, configurable layer control, and red-lining and distance measurement tools</p>
                        </li>
                     </ul>
                     <p>Existing server-side predefined styles and themes will work with the API. For example, the following code snippet creates an interactive vector layer based on a predefined theme <code class="codeph">mvdemo.customers</code>, which has an associated predefined style:
                     </p><pre class="oac_no_warn" dir="ltr">var baseURL  = "http://"+document.location.host+"/mapviewer";
var layer = new OM.layer.VectorLayer("layer1",  
 {
     def:{
                type:OM.layer.VectorLayer.TYPE_PREDEFINED, 
                dataSource:"mvdemo", 
                theme:"customers", 
                url: baseURL
            }
  });
</pre><p>The API has the following top-level classes and subpackages, all of which are in the namespace <code class="codeph">OM</code>:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The <code class="codeph">Map</code> class is the main class of the API.
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">Feature</code> class represents individual geo features.
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">MapContext</code> class a top-level class encapsulating some essential contextual information, such as the current map center point and zoom level. It is typically passed into event listeners.
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">control</code> package contains all the map controls, such as navigation bar and overview map.
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">event</code> package contains all the map and layer event classes.
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">filter</code> package contains all the client-side filters (spatial or relational) for selecting, or subsetting, the displayed vector layer features.
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">geometry</code> package contains various geometry classes.
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">layer</code> package contains various tile and vector layer classes. The tile layer classes include access to a few online map services such as Oracle, Nokia, and OpenStreetMap. The vector layers are interactive feature layers.
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">infowindow</code> package contains the customizable information windows and their styles.
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">style</code> package contains styles applicable to vector data on the client side. It also includes visual effects such as animation, gradients, and drop shadows.
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">tool</code> package contains various map tools such as for distance measuring, red-lining, and geometry drawing.
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">universe</code> package contains built-in, or predefined, <span class="italic">map universes</span>. A map universe defines the bounding box and set of zoom level definitions for the map content.
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">util</code> package contains various utility classes.
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">visualfilter</code> package provides an interface for the various visual effects, such as gradients and drop shadows.
                           </p>
                        </li>
                     </ul>
                     <p><code class="codeph">OM.Map</code> is the main entry class for all map operations inside the web browser. This and other classes provide interfaces for adding application-specific logic, operations, and interactivity in web mapping applications. The application logic and operations can include the following:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Create a map client instance and associate it with the map container DIV object created in the web page.</p>
                        </li>
                        <li>
                           <p>Configure map parameters such as map center and map zoom level.</p>
                        </li>
                        <li>
                           <p>Optionally, create and manipulate map tile layers. A map tile layer is not required. An application can have only interactive vector layers using a custom Universe that programmatically defines the zoom levels and scales.</p>
                        </li>
                        <li>
                           <p>Create and manipulate vector layers.</p>
                        </li>
                        <li>
                           <p>Display an information window on the map.</p>
                        </li>
                        <li>
                           <p>Create fixed map decorations, such as a map title, a copyright note, and map controls.</p>
                        </li>
                        <li>
                           <p>Access built-in utilities such as a navigation panel, rectangle or circle tool, scale bar, and overview map panel.</p>
                        </li>
                        <li>
                           <p>Use event listeners to customize event handling and thus map interactions.</p>
                        </li>
                     </ul>
                     <p>Other notes and considerations on using the Oracle Maps API:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The "FOI server" in a previous version of the API is now a data server that streams the vector geometries and attributes for features to the client for local rendering. Therefore, the "FOI layers" in a previous version are now called <span class="bold">vector layers</span>.
                           </p>
                        </li>
                        <li>
                           <p>A background map tile layer is not required in order to display interactive vector layers. For example, an application can display a thematic map of states (such as color-filled by population quintile) with no background tile layer.</p>
                        </li>
                        <li>
                           <p>The API depends on and includes <code class="codeph">JQuery</code> and <code class="codeph">JQueryUI</code>. So, <code class="codeph">oraclemapsv2.js</code> includes <code class="codeph">jquery-1.7.2.min.js</code> and <code class="codeph">jquery-ui-1.8.16.min.js</code>. If your application also uses JQuery and JQueryUI and includes them already, then use the file <code class="codeph">oraclemapsv2_core.js</code> in the <code class="codeph">&lt;script&gt;</code> tag instead to load the Oracle Maps library. That is, use the following:
                           </p>
                           <p><code class="codeph">&lt;script src="/mapviewer/jslib/v2/oraclemapsv2_core.js"&gt;&lt;/script&gt;</code></p>
                           <p>instead of:</p>
                           <p><code class="codeph">&lt;script src="/mapviewer/jslib/v2/oraclemapsv2.js"&gt;&lt;/script&gt;</code></p>
                        </li>
                     </ul>
                     <p>For information about developing applications using the API, see <a href="oracle-maps.html#GUID-B0C3C99C-3D0C-4FB7-BCF5-F924A42B56CC" title="This topic describes how to develop Oracle Maps applications.">Developing Oracle Maps Applications</a> and the Oracle-supplied tutorials and demos.
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="oracle-maps.html#GUID-0D5BC30A-40AC-4347-89FA-E95D44918E32" title="The Oracle Maps JavaScript client is a browser-based map visualization engine that works on top of the map tile server and that uses HTML5 technology.">Oracle Maps JavaScript API</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="JIMPV9822"></a><div class="props_rev_3"><a id="GUID-B0C3C99C-3D0C-4FB7-BCF5-F924A42B56CC" name="GUID-B0C3C99C-3D0C-4FB7-BCF5-F924A42B56CC"></a><h3 id="JIMPV-GUID-B0C3C99C-3D0C-4FB7-BCF5-F924A42B56CC" class="sect3"><span class="enumeration_section">4.2 </span>Developing Oracle Maps Applications
               </h3>
               <div>
                  <p>This topic describes how to develop Oracle Maps applications.</p>
                  <p>If the underlying base map and layers are managed in an Oracle database, each map tile layer displayed in the client application must have a corresponding database metadata entry in the USER_SDO_CACHED_MAPS metadata view (described in <a href="map-visualization-concepts.html#GUID-820FD52E-E02D-4371-B85B-88B76FAC50FF">xxx_SDO_CACHED_MAPS Views</a>) . Similarly, if an interactive layer is based on database content, it must have a metadata entry in the USER_SDO_THEMES view (described in <a href="map-visualization-concepts.html#GUID-565BF7E3-C504-4CDC-88B0-E1ACC67300E5" title="The mapping metadata describing base maps, themes, and styles is stored in the global tables SDO_MAPS_TABLE, SDO_THEMES_TABLE, and SDO_STYLES_TABLE, which are owned by MDSYS.">Map Visualizer Metadata Views</a>, especially <a href="map-visualization-concepts.html#GUID-BB3EC523-0FE9-47DD-994F-D3B8726F2347">xxx_SDO_THEMES Views</a>). These tile and interactive layers, and the styles and styling rules for them, can be defined using the Map Builder tool (described in <a href="oracle-map-builder-tool.html#GUID-17324FF4-9AA2-4182-93B7-B7999737FA67" title="This chapter briefly describes the map visualization component Map Builder tool, also referred to as Oracle Map Builder. It does not provide detailed information about the tool's interface; for that you should use see online help available when you use Oracle Map Builder.">Oracle Map Builder Tool</a>).
                  </p>
                  <p>To develop Oracle Maps applications using the API, follow these basic steps:</p>
                  <ol>
                     <li>
                        <p>Import the <code class="codeph">oraclemapsv2.js</code> library.
                        </p>
                        <p>The API is provided in a single JavaScript library packaged as part of the map visualization component EAR archive.</p>
                     </li>
                     <li>
                        <p>After the map visualization component is deployed and started, load the library through a <code class="codeph">&lt;script&gt;</code> tag, for example:
                        </p><pre class="oac_no_warn" dir="ltr">&lt;script  type="text/javascript" url="http://localhost:8080/mapviewer/jslib/v2/oraclemapsv2.js"/&gt;
</pre><div class="infoboxnote" id="GUID-B0C3C99C-3D0C-4FB7-BCF5-F924A42B56CC__GUID-70DFA383-4218-44F0-AFB1-AACA1D9D4B38">
                           <p class="notep1">Note:</p>
                           <p> If you need a specific jQuery version other than the one packaged in <code class="codeph">oraclemapsv2.js</code> (shown in the preceding example), then you can add your preferred jQuery first, followed by a list of libraries. For example:
                           </p><pre class="oac_no_warn" dir="ltr">&lt;script src="<span class="italic">your_preferred_jQuery_library_listed_here_first</span>.js "&gt;&lt;/script&gt;
&lt;script src="v2/jquery/jquery.hammer-full.min.js"&gt;&lt;/script&gt;
&lt;script src="v2/jquery/jquery.i18n.properties-min-1.0.9.js"&gt;&lt;/script&gt;
&lt;script src="v2/jquery/jquery.mousewheel.min.js"&gt;&lt;/script&gt;
&lt;script src="v2/rtree/rtree-min.js"&gt;&lt;/script&gt;
&lt;script src="v2/fortknox-libs/fortknox-canvas.js"&gt;&lt;/script&gt;
&lt;script src="v2/oraclemapsv2_core.js"&gt;&lt;/script&gt;
</pre></div>
                     </li>
                     <li>
                        <p>Create a <code class="codeph">&lt;DIV&gt;</code> tag in the HTML page, which will contain the interactive map.
                        </p>
                     </li>
                     <li>
                        <p>Create a client-side map instance that will handle all map display functions.</p>
                        <p>The class is named <code class="codeph">OM.Map</code> and is the main entry point of the API.
                        </p>
                     </li>
                     <li>
                        <p>Set up a map universe (unless you also do the optional next step).</p>
                        <p>A map universe basically defines the overall map extent, the number of zoom levels, and optionally the resolution (in map units per pixel) at each zoom level. Note that a predefined tile layer is not necessary in order to display interactive vector layers or themes. For example, an interactive thematic map of sales by region does not need to have a background map, or tile layer.</p>
                     </li>
                     <li>
                        <p>(Optional) Add a tile layer that serves as the background map.</p>
                        <p>The tile layer can be from the database, such as <code class="codeph">mvdemo.demo_map</code>, or from a supported service, such as Nokia Maps. Adding a tile layer also implicitly defines a map universe, and therefore the preceding step (setting up a map universe) is not necessary in this case.
                        </p>
                     </li>
                     <li>
                        <p>Add one or more interactive vector layers.</p>
                        <p><code class="codeph">OM.VectorLayer</code> uses HTML5 (Canvas or SVG) technology to render all the data in the browser. So, unless specified otherwise, all vector layer content is loaded once and there are no subsequent database queries, or data fetching, on map zoom or pan operations.
                        </p>
                     </li>
                     <li>
                        <p>Add one or more map controls, tools, and other application-specific UI controls so that users can set the displayed layers, styling, and visual effects.</p>
                     </li>
                  </ol>
                  <p>If you need to prevent themes from being streamed by default, you must protect them is by adding authentication, that is, by adding a security constraint in the map visualization component <code class="codeph">web.xml</code> file and by configuring the <code class="codeph">mds.xml</code> file to authorize access to various themes. For information, see <a href="introduction-to-map-visualization-component.html#GUID-DA9FF5B5-17C1-472C-B6EF-B968869BA21F">Configuring and Securing the Map Data Server for the HTML5 API</a>.
                  </p>
                  <p>For detailed instructions and related information about using the API, see the Oracle-supplied tutorials and demos.</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="oracle-maps.html#GUID-1030CA92-20CB-4800-A59A-62A8CF065629">Creating the Client Application with the API</a><br></li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="oracle-maps.html#GUID-9B4DB4C9-5E4B-4776-92F6-84084F65784E" title="Oracle Maps is the name for a suite of technologies for developing high-performance interactive web-based mapping applications.">Oracle Maps</a></p>
                     </div>
                  </div>
               </div>
               <a id="JIMPV10133"></a><div class="props_rev_3"><a id="GUID-1030CA92-20CB-4800-A59A-62A8CF065629" name="GUID-1030CA92-20CB-4800-A59A-62A8CF065629"></a><h4 id="JIMPV-GUID-1030CA92-20CB-4800-A59A-62A8CF065629" class="sect4"><span class="enumeration_section">4.2.1 </span>Creating the Client Application with the API
                  </h4>
                  <div>
                     <p>Oracle Maps applications run inside web browsers and require only HTML5 (Canvas) support and JavaScript enabled. No additional plugins are required.</p>
                     <p>The source for an Oracle Maps application is typically packaged in an HTML page, which consists of the following parts:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>A <code class="codeph">&lt;script&gt;</code> element that loads the Oracle Maps client library into the browser's JavaScript engine. For example:
                           </p><pre class="oac_no_warn" dir="ltr">&lt;script src="/mapviewer/jslib/v2/oraclemapsv2.js"&gt;&lt;/script&gt;
</pre></li>
                        <li>
                           <p>An HTML <code class="codeph">&lt;div&gt;</code> element that will contain the map. For example:
                           </p><pre class="oac_no_warn" dir="ltr">&lt;div id="map" style="width: 600px; height: 500px"&gt;&lt;/div&gt;
</pre></li>
                        <li>
                           <p>JavaScript code that creates the map client instance and sets the initial map content (tile and vector layer), the initial center and zoom, and map controls. This code should be packaged inside a function which is executed when the HTML page is loaded or ready. The function is specified in the <code class="codeph">onload</code> attribute of the <code class="codeph">&lt;body&gt;</code> element of the HTML page. For example:
                           </p><pre class="oac_no_warn" dir="ltr">function on_load_mapview()
{
  var baseURL  = "http://"+document.location.host+"/mapviewer";
  // Create an OM.Map instance to display the map
  var mapview = new OM.Map(document.getElementById("map"),
                           {
                             mapviewerURL:baseURL
                           });
  // Add a map tile layer as background.
  var tileLayer = new OM.layer.TileLayer(
        "baseMap",
        {
            dataSource:"mvdemo",
            tileLayer:"demo_map",
            tileServerURL:baseURL+"/mcserver"
        });
  mapview.addLayer(tileLayer);
  // Set the initial map center and zoom level
  var mapCenterLon = -122.45;
  var mapCenterLat = 37.7706;
  var mapZoom = 4;
  var mpoint = new OM.geometry.Point(mapCenterLon,mapCenterLat,8307);
  mapview.setMapCenter(mpoint);
  mapview.setMapZoomLevel(mapZoom);
  // Add a theme-based FOI layer to display customers on the map
  customersLayer = new OM.layer.VectorLayer("customers",
        {
            def:
                {
                type:OM.layer.VectorLayer.TYPE_PREDEFINED,
                dataSource:"mvdemo", theme:"customers",
                url: baseURL,
                loadOnDemand: false
                }
        });
  mapview.addLayer(customersLayer);
  // Add a navigation panel on the right side of the map
  var navigationPanelBar = new OM.control.NavigationPanelBar();
  navigationPanelBar.setStyle(
{backgroundColor:"#FFFFFF",buttonColor:"#008000",size:12});
  mapview.addMapDecoration(navigationPanelBar);
  // Add a scale bar
  var mapScaleBar = new OM.control.ScaleBar();
  mapview.addMapDecoration(mapScaleBar);
  // Display the map.
  // The initialization and display is done just once.
  mapview.init();
}
</pre></li>
                        <li>
                           <p>Additional HTML elements and JavaScript code that implement other application-specific user interface and control logic. For example, the HTML <code class="codeph">&lt;input&gt;</code> element and JavaScript function <code class="codeph">setLayerVisible</code> together implement a layer visibility control. The <code class="codeph">setLayerVisible</code> function is coded as follows:
                           </p><pre class="oac_no_warn" dir="ltr">function setLayerVisible(checkBox)
{
  // Show the customers vector layer if the check box is checked and
  // hide it otherwise.
  if(checkBox.checked)
    customersLayer.setVisible(true) ;
  else
    customersLayer.setVisible(false);
}
</pre><p>The function is specified in the <code class="codeph">onclick</code> attribute of the <code class="codeph">&lt;input&gt;</code> element defining the checkbox. In the following example, the function is executed whenever the user clicks on the Show Customers check box:
                           </p><pre class="oac_no_warn" dir="ltr">&lt;INPUT TYPE="checkbox" onclick="setLayerVisible(this)" checked/&gt;Show Customers</pre></li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="oracle-maps.html#GUID-B0C3C99C-3D0C-4FB7-BCF5-F924A42B56CC" title="This topic describes how to develop Oracle Maps applications.">Developing Oracle Maps Applications</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="JIMPV9942"></a><div class="props_rev_3"><a id="GUID-E3A7A484-B021-459C-8AE9-E7ABBDC04C94" name="GUID-E3A7A484-B021-459C-8AE9-E7ABBDC04C94"></a><h3 id="JIMPV-GUID-E3A7A484-B021-459C-8AE9-E7ABBDC04C94" class="sect3"><span class="enumeration_section">4.3 </span>Using Google Maps
               </h3>
               <div>
                  <p>Applications can display Google Maps tiles as a built-in map tile layer, by creating and adding to the map window an instance of <code class="codeph">MVGoogleTileLayer</code> .
                  </p>
                  <p>Internally, the Oracle Maps client uses the official Google Maps API to display the map that is directly served by the Google Maps server.</p>
                  <p>To use the Google Maps tiles, your usage of the tiles must meet the terms of service specified by Google (see <a href="https://developers.google.com/readme/terms" target="_blank"><code class="codeph">https://developers.google.com/readme/terms</code></a>).
                  </p>
                  <p>If you need to overlay your own spatial data on top of the Google Maps tile layer, see also <a href="oracle-maps.html#GUID-DB268520-D5AC-4E32-A674-6FB17A21B72B" title="Popular online map services such as Google Maps use a spherical Mercator projection for their maps.">Transforming Data to a Spherical Mercator Coordinate System</a>.)
                  </p>
                  <p>The following sections describe the two options for using built-in map tile layers.</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="oracle-maps.html#GUID-CEBF1805-101D-4B7C-A051-641A71BFBCBC">Defining Google Maps Tile Layers on the Client Side</a><br></li>
                     <li class="ulchildlink"><a href="oracle-maps.html#GUID-104759F3-E7AA-41B2-A1E4-6BD76FA66399">Defining the Built-In Map Tile Layers on the Server Side</a><br></li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="oracle-maps.html#GUID-9B4DB4C9-5E4B-4776-92F6-84084F65784E" title="Oracle Maps is the name for a suite of technologies for developing high-performance interactive web-based mapping applications.">Oracle Maps</a></p>
                     </div>
                  </div>
               </div>
               <a id="JIMPV9943"></a><div class="props_rev_3"><a id="GUID-CEBF1805-101D-4B7C-A051-641A71BFBCBC" name="GUID-CEBF1805-101D-4B7C-A051-641A71BFBCBC"></a><h4 id="JIMPV-GUID-CEBF1805-101D-4B7C-A051-641A71BFBCBC" class="sect4"><span class="enumeration_section">4.3.1 </span>Defining Google Maps Tile Layers on the Client Side
                  </h4>
                  <div>
                     <p>To define a built-in map tile layer on the client side, you need to create a <code class="codeph">MVGoogleTileLayer</code> object, and add it to the MVMapView object. (As of Oracle Fusion Middleware Release 11.1.1.6, <code class="codeph">MVGoogleTileLayer</code> uses the Google Maps Version 3 API by default.)
                     </p>
                     <p>For example, to use Google tiles, add the Google tile layer to your map:</p><pre class="oac_no_warn" dir="ltr">mapview = new MVMapView(document.getElementById("map"), baseURL);
tileLayer = new MVGoogleTileLayer() ;
mapview.addMapTileLayer(tileLayer);
</pre><p>In your application, you can invoke the method <code class="codeph">MVGoogleTileLayer.setMapType</code> to set the map type to be one of the types supported by the map providers, such as road, satellite, or hybrid.
                     </p>
                     <p>For usage examples and more information, see the JavaScript API documentation for <code class="codeph">MVGoogleTileLayer</code>, and the tutorial demo <span class="italic">Built-in Google Maps Tile Layer</span>.
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="oracle-maps.html#GUID-E3A7A484-B021-459C-8AE9-E7ABBDC04C94" title="Applications can display Google Maps tiles as a built-in map tile layer, by creating and adding to the map window an instance of MVGoogleTileLayer .">Using Google Maps</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="JIMPV9944"></a><div class="props_rev_3"><a id="GUID-104759F3-E7AA-41B2-A1E4-6BD76FA66399" name="GUID-104759F3-E7AA-41B2-A1E4-6BD76FA66399"></a><h4 id="JIMPV-GUID-104759F3-E7AA-41B2-A1E4-6BD76FA66399" class="sect4"><span class="enumeration_section">4.3.2 </span>Defining the Built-In Map Tile Layers on the Server Side
                  </h4>
                  <div>
                     <p>You can define a built-in map tile layer (also called an external tile layer) on the server side in the metadata, and use it as a regular map visualization component tile layer on the client side.&nbsp;To define a built-in map tile layer on the server side, follow these steps:</p>
                     <ol>
                        <li>
                           <p>Log into the map visualization component administration page (explained in <a href="introduction-to-map-visualization-component.html#GUID-2191CCA7-AC00-4E8C-9011-D27CE3E50CDC">Logging in to the Map Visualization Component Administration Page</a>).
                           </p>
                        </li>
                        <li>
                           <p>Select the Admin tab and click<span class="bold">Create tile layer</span>.
                           </p>
                        </li>
                        <li>
                           <p>For <span class="bold">Tile Layer Type</span>, choose&nbsp;Oracle Maps, Google Maps, HERE Maps, OpenStreet Maps, Tomtom Maps, or LocationBox Maps,&nbsp;and click&nbsp;<span class="bold">Next</span>.
                           </p>
                        </li>
                        <li>
                           <p>Provide a name for this external tile layer (such as GOOGLE_MAP), and select the data source where the tile layer definition is to be stored.</p>
                        </li>
                        <li>
                           <p>Set the license key that you have obtained from the map provider and other relevant properties (details are available for specific external tile layers),&nbsp;and click&nbsp;<span class="bold">Next</span>.
                           </p>
                        </li>
                        <li>
                           <p>Review the XML Description of the external tile layer. You may click <span class="bold">Previous</span> to go to the previous page to make changes.
                           </p>
                        </li>
                        <li>
                           <p>Click <span class="bold">Submit</span> to create the tile layer.
                           </p>
                        </li>
                     </ol>
                     <p>After you have created the built-in map tile layer on the server side, you can use it like any other tile layer served by MapViewer. You do not need to add any <code class="codeph">&lt;script&gt;</code> tag to load the external JavaScript library.
                     </p>
                     <p>The following code snippetshows a Google Maps tile layer defined on the server side:</p><pre class="oac_no_warn" dir="ltr"> var tileLayer = new OM.layer.TileLayer("google1", {
      dataSource:"mvdemo", 
      tileLayer:"GOOGLE_MAP"
      });
	
  map.addLayer(tileLayer) ;
</pre><div class="infoboxnote" id="GUID-104759F3-E7AA-41B2-A1E4-6BD76FA66399__GUID-E6D2FA26-99F4-4B37-A3BF-9FFE1CB5E2D2">
                        <p class="notep1">Note:</p>
                        <p>Each built-in tile layer has its own specific properties. You may need to check with the service provider for requirements.</p>
                        <p>If Google Maps will be used, you may need to provide the following properties:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">key</code>: the key you obtained from Google Maps.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">client</code>: the client ID, an optional property you may obtain from Google Maps. The key property is still needed when the client ID is provided.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">lib_url</code>: the Google Maps API URL, for example: <code class="codeph">http://maps.google.com/maps/api/js?sensor=false</code>. If not provided, a default value will be used.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">version</code>: the current API version is 3.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">mapTyelList</code>, a list of map types may be provided: MVGoogleTileLayer.TYPE_ROAD; MVGoogleTileLayer.TYPE_SHADED; MVGoogleTileLayer.TYPE_SATELLITE; MVGoogleTileLayer.TYPE_HYBRID.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">mapTypeVisible</code>, a Boolean <code class="codeph">true</code> or <code class="codeph">false</code> value to indicate whether to have the map type buttons be displayed for selecting map types.
                              </p>
                           </li>
                        </ul>
                        <p></p>
                     </div>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="oracle-maps.html#GUID-E3A7A484-B021-459C-8AE9-E7ABBDC04C94" title="Applications can display Google Maps tiles as a built-in map tile layer, by creating and adding to the map window an instance of MVGoogleTileLayer .">Using Google Maps</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="JIMPV9945"></a><div class="props_rev_3"><a id="GUID-DB268520-D5AC-4E32-A674-6FB17A21B72B" name="GUID-DB268520-D5AC-4E32-A674-6FB17A21B72B"></a><h3 id="JIMPV-GUID-DB268520-D5AC-4E32-A674-6FB17A21B72B" class="sect3"><span class="enumeration_section">4.4 </span>Transforming Data to a Spherical Mercator Coordinate System
               </h3>
               <div>
                  <p>Popular online map services such as Google Maps use a spherical Mercator projection for their maps.</p>
                  <p>If you are using an Oracle Database release earlier than 11.1.0.7, and if you need to overlay your own spatial data on top of such a tile layer, such as a Google Maps tile layer, you must set up the database to properly handle coordinate system transformation between the coordinate system of that tile layer and your own data coordinate system, if the two coordinate systems are not the same.</p>
                  <div class="infoboxnote" id="GUID-DB268520-D5AC-4E32-A674-6FB17A21B72B__GUID-5D55AE6D-7924-4B42-A358-DF9F5209DD37">
                     <p class="notep1">Note:</p>
                     <p>To perform the actions in this section, your database must be Release 10.2.0.1 or later.</p>
                  </div>
                  <p>Google Maps uses a Spherical Mercator coordinate system (EPSG: 3785), which is also widely used among commercial API providers such as Yahoo! Maps. This coordinate system (SRID 3785) was not provided with Oracle Spatial and Graph before Release 11.1.0.7. In order to enable the map visualization componentthe map visualization component and Oracle Spatial and Graph to transform your own data to this coordinate system, you must first add this coordinate system definition into your Oracle database if it is not already defined.</p>
                  <p>To check if this coordinate system is defined, you can enter the following statement: </p><pre class="oac_no_warn" dir="ltr">SELECT srid FROM mdsys.cs_srs WHERE srid=3785;
</pre><p>If the preceding statement returns a row, you do not need to perform the actions in this section. If the preceding statement does not return a row, you must perform the actions in this section in order to be able to overlay your own spatial data on top of the tile layer.</p>
                  <p>Follow these steps:</p>
                  <ol>
                     <li>
                        <p>Connect to the database as a privileged user, such as one with the DBA role.</p>
                     </li>
                     <li>
                        <p>Run the <code class="codeph">csdefinition.sql</code> script, as follows. (Replace <span class="italic"><code class="codeph">$MAPVIEWER_HOME</code></span> with the root directory of the WebLogic Server instance where your MapViewer is deployed, and enter the command on a single line.)
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Linux: <span class="italic"><code class="codeph">$MAPVIEWER_HOME</code></span><code class="codeph">/j2ee/home/applications/mapviewer/web/WEB-INF/admin/csdefinition.sql</code></p>
                           </li>
                           <li>
                              <p>Windows: <span class="italic"><code class="codeph">$MAPVIEWER_HOME</code></span><code class="codeph">\j2ee\home\applications\mapviewer\web\WEB-INF\admin\csdefinition.sql</code></p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>If necessary, create a transformation rule to cause Oracle Spatial and Graph to skip datum conversion when transforming data from a specified coordinate system to the Spherical Mercator system. To find out if you need to create such a transformation rule, see <a href="oracle-maps.html#GUID-46480CF4-3E2C-483C-ADD3-410D34E56C8A">Creating a Transformation Rule to Skip Datum Conversion</a>.
                        </p>
                     </li>
                     <li>
                        <p>Either pre-transform your spatial data for better performance, or let the map visualization component transform the data at runtime ("on the fly"). Note that if your database release is earlier than 10.2.0.4, pre-transforming is the only option.</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>To pre-transform all your data into the Spherical Mercator coordinate system, use the SDO_CS.TRANSFORM_LAYER procedure on all the data, and use the transformed data for mapping. (See the SDO_CS.TRANSFORM_LAYER reference section in <a href="../spatl/SDO_CS-reference.html#SPATL1076" target="_blank"><span class="italic">Oracle Spatial and Graph Developer's Guide</span></a>.)
                              </p>
                           </li>
                           <li>
                              <p>To let the map visualization component transform the data at runtime, do not transform the data before using it for mapping.</p>
                           </li>
                        </ul>
                     </li>
                  </ol>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="oracle-maps.html#GUID-46480CF4-3E2C-483C-ADD3-410D34E56C8A">Creating a Transformation Rule to Skip Datum Conversion</a><br></li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="oracle-maps.html#GUID-9B4DB4C9-5E4B-4776-92F6-84084F65784E" title="Oracle Maps is the name for a suite of technologies for developing high-performance interactive web-based mapping applications.">Oracle Maps</a></p>
                     </div>
                  </div>
               </div>
               <a id="JIMPV9947"></a><a id="JIMPV9946"></a><div class="props_rev_3"><a id="GUID-46480CF4-3E2C-483C-ADD3-410D34E56C8A" name="GUID-46480CF4-3E2C-483C-ADD3-410D34E56C8A"></a><h4 id="JIMPV-GUID-46480CF4-3E2C-483C-ADD3-410D34E56C8A" class="sect4"><span class="enumeration_section">4.4.1 </span>Creating a Transformation Rule to Skip Datum Conversion
                  </h4>
                  <div>
                     <p>Spatial data is often in a coordinate system based on an ellipsoid datum, such as WGS84 or BNG. In such cases, Oracle Spatial and Graph by default applies datum conversion when transforming the data into the Spherical Mercator system. This will introduce a small amount of mismatch or error between your data and the Google Maps other map service tiles. If you want to address this issue, you can create transformation rules that tell Oracle Spatial and Graph to skip datum conversion when transforming data from a specified coordinate system to the Spherical Mercator system.</p>
                     <p><a href="oracle-maps.html#GUID-46480CF4-3E2C-483C-ADD3-410D34E56C8A__BACCFFFA">Example 4-1</a> shows SQL statements that are included in the <code class="codeph">csdefinition.sql</code> script and that create such transformations rules. However, if the coordinate system of your spatial data is not covered by the rules shown in <a href="oracle-maps.html#GUID-46480CF4-3E2C-483C-ADD3-410D34E56C8A__BACCFFFA">Example 4-1</a>, you can create your own rule if the coordinate system of your data is not covered by these rules. (For more information about creating coordinate system transformation rules, see <a href="../spatl/coordinate-systems-concepts.html#SPATL054" target="_blank"><span class="italic">Oracle Spatial and Graph Developer's Guide</span></a>.)
                     </p>
                     <div class="example" id="GUID-46480CF4-3E2C-483C-ADD3-410D34E56C8A__BACCFFFA">
                        <p class="titleinexample">Example 4-1 Transformation Rules Defined in the csdefinition.sql Script</p><pre class="oac_no_warn" dir="ltr">-- Create the tfm_plans, that is, the transformation rules.
-- Note: This will result in an incorrect conversion since it ignores a datum
-- datum between the ellipsoid and the sphere. However, the data will match
-- up better on Google Maps.
 
-- For wgs84 (8307)
call sdo_cs.create_pref_concatenated_op( 83073785, 'CONCATENATED OPERATION 8307 3785', TFM_PLAN(SDO_TFM_CHAIN(8307, 1000000000, 4055, 19847, 3785)), NULL);
 
-- For 4326, EPSG equivalent of 8307
call sdo_cs.create_pref_concatenated_op( 43263785, 'CONCATENATED_OPERATION_4326_3785', TFM_PLAN(SDO_TFM_CHAIN(4326, 1000000000, 4055, 19847, 3785)), NULL); 
 
-- For OS BNG, Oracle SRID 81989
call sdo_cs.create_pref_concatenated_op( 819893785, 'CONCATENATED OPERATION 81989 3785', TFM_PLAN(SDO_TFM_CHAIN(81989, -19916, 2000021, 1000000000, 4055, 19847, 3785)), NULL); 
 
-- For 27700, EPSG equivalent of 81989
call sdo_cs.create_pref_concatenated_op( 277003785, 'CONCATENATED_OPERATION_27700_3785', TFM_PLAN(SDO_TFM_CHAIN(27700, -19916, 4277, 1000000000, 4055, 19847, 3785)), NULL);
commit;</pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="oracle-maps.html#GUID-DB268520-D5AC-4E32-A674-6FB17A21B72B" title="Popular online map services such as Google Maps use a spherical Mercator projection for their maps.">Transforming Data to a Spherical Mercator Coordinate System</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
            <div class="props_rev_3"><a id="GUID-F1647A8F-CA15-42D2-8037-09B0EA332611" name="GUID-F1647A8F-CA15-42D2-8037-09B0EA332611"></a><h3 id="JIMPV-GUID-F1647A8F-CA15-42D2-8037-09B0EA332611" class="sect3"><span class="enumeration_section">4.5 </span>Using Dynamic Tile Layers
               </h3>
               <div>
                  <p>A <span class="bold">dynamic tile layer</span> is a tile layer defined on the client side.
                  </p>
                  <p>A dynamic tile layer differs from a regular tile layer in the following ways:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>It is defined by the client application, so it does not need to be predefined in the USER_SDO_CACHED_MAPS metadata.</p>
                     </li>
                     <li>
                        <p>The server does not cache the map tiles.</p>
                     </li>
                     <li>
                        <p>It can use third party maps services, when a map tile image URL generation function is provided.</p>
                     </li>
                  </ul>
                  <p>Thus, a dynamic tile layer can be defined dynamically by a client application, and the map images may come from a map visualization component server or from a third party map service.</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="oracle-maps.html#GUID-9D06150F-FECD-4982-BDF5-C514F309A1AB">Creating a Universe and Configuration Instance for a Dynamic Tile Layer</a><br></li>
                     <li class="ulchildlink"><a href="oracle-maps.html#GUID-B8F07CD7-3B9B-4C8A-9CF1-2E247498ADC1">Creating a Dynamic Tile Layer Using a Base Map</a><br></li>
                     <li class="ulchildlink"><a href="oracle-maps.html#GUID-D66B53D6-9F3D-45CA-92F5-4F5E40C0B9C7">Creating a Dynamic Tile Layer Using Predefined Themes</a><br></li>
                     <li class="ulchildlink"><a href="oracle-maps.html#GUID-B515D9FC-C99B-4660-B4C2-FFF5570E7054">Creating a Dynamic Tile Layer Using Spatial Tables Directly</a><br></li>
                     <li class="ulchildlink"><a href="oracle-maps.html#GUID-66199642-3D36-47F4-BB45-02943A10EF42">Creating a Dynamic Tile Layer Using Third Party Map Services</a><br></li>
                     <li class="ulchildlink"><a href="oracle-maps.html#GUID-31918E3F-96F8-41E6-B835-5796714DC54F">Dynamic Tile Layer Use Case</a><br></li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="oracle-maps.html#GUID-9B4DB4C9-5E4B-4776-92F6-84084F65784E" title="Oracle Maps is the name for a suite of technologies for developing high-performance interactive web-based mapping applications.">Oracle Maps</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="props_rev_3"><a id="GUID-9D06150F-FECD-4982-BDF5-C514F309A1AB" name="GUID-9D06150F-FECD-4982-BDF5-C514F309A1AB"></a><h4 id="JIMPV-GUID-9D06150F-FECD-4982-BDF5-C514F309A1AB" class="sect4"><span class="enumeration_section">4.5.1 </span>Creating a Universe and Configuration Instance for a Dynamic Tile Layer
                  </h4>
                  <div>
                     <p>Before creating a dynamic tile layer instance, you must create a universe and a tile layer configuration for a dynamic tile layer. </p>
                     <p>For example, assume that a variable named baseURL is properly defined (such as http://myapp.mycorp.com/mapviewer) and that the specified data source exists. You must create a tile layer configuration instance and a universe instance. You can use an Oracle Maps JavaScript API built-in universe or create your own. For simplicity, a built-in universe is used here.</p>
                     <p>A tile layer configuration instance only needs to define the dimension of an image tile, and 256 pixels for a tile image's width and height are commonly used. The following code snippet creates this instance:</p><pre class="pre codeblock"><code>  var  myuniv= new OM.universe.LatLonUniverse();  // a built-in universe
  var  myconfig=new OM.layer.TileLayerConfig(  // a tile layer configure instance
          {
	        tileImageWidth: 256,  
	        tileImageHeight: 256
          });
</code></pre></div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="oracle-maps.html#GUID-F1647A8F-CA15-42D2-8037-09B0EA332611" title="A dynamic tile layer is a tile layer defined on the client side.">Using Dynamic Tile Layers</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="props_rev_3"><a id="GUID-B8F07CD7-3B9B-4C8A-9CF1-2E247498ADC1" name="GUID-B8F07CD7-3B9B-4C8A-9CF1-2E247498ADC1"></a><h4 id="JIMPV-GUID-B8F07CD7-3B9B-4C8A-9CF1-2E247498ADC1" class="sect4"><span class="enumeration_section">4.5.2 </span>Creating a Dynamic Tile Layer Using a Base Map
                  </h4>
                  <div>
                     <p>Creating a dynamic tile layer using a base map is the simplest approach, because the map contents are already defined by a server-side map visualization component  base map. Follow these steps.</p>
                     <ol>
                        <li>
                           <p>Create a <code class="codeph">ServerMapRequest</code> instance and set its properties. For example:
                           </p><pre class="pre codeblock"><code>        var req = new OM.server.ServerMapRequest(baseURL);
        req.setProperties({
            dataSource:"MVDEMO",
            basemap: 'demo_map',  // this basemap property defines the map contents
            transparent:true,
            antialiase:"false"
        });
</code></pre></li>
                        <li>
                           <p>Create an object containing properties of this dynamic tile layer. For example:</p><pre class="pre codeblock"><code>        var dtl_props = {  
            universe: myuniv,            
            tileLayerConfig: myconfig,
            tileServerURL: baseURL + "/omserver",  // map images come from this omserver
            enableUTFGrid: true,  // the UTFGrid is enabled
            enableUTFGridInfoWindow: true,  // the info window for displaying UTFGrid is enabled
            utfGridResolution: 4   // one grid cell represents 16 (4 by 4) image pixels
        };
</code></pre><p>In this example, the string value in variable <code class="codeph">tileServerURL</code> is pointing to a map visualization component server. It could be the same server as where the web application is deployed, or another map visualization component server instance. For example, it can be in either of the following forms:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>From the same Oracle Maps server instance:. For example:</p><pre class="pre codeblock"><code>var baseURL=document.location.protocol+"//"+document.location.host+"/mapviewer";</code></pre></li>
                              <li>
                                 <p>From another Oracle Maps server instance. For example:</p><pre class="pre codeblock"><code>var baseURL="http://myapp.mycorp.com/mapviewer ";</code></pre></li>
                           </ul>
                        </li>
                        <li>
                           <p>Create a dynamic tile layer. For example:</p><pre class="pre codeblock"><code>  var dynamic_tilelayer_1 = new OM.layer.DynamicTileLayer("dtl1", dtl_props, req);</code></pre><p>The dynamic tile layer requests map images from the map visualization component's map server (omserver), which renders a fresh map image and does not cache the images on disk.</p>
                        </li>
                     </ol>
                     <p>From the preceding examples, notice that three statements are given to create a dynamic tile layer: (1) create a map request instance (<code class="codeph">ServerMapRequest</code>);  (2) create an object containing the dynamic tile layer related properties; and (3) instantiate a dynamic tile layer.
                     </p>
                     <p>The dynamic tile layer requests map images from the map visualization component's map server (<code class="codeph">omserver</code>), which renders a fresh map image and does not cache the images on disk.
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="oracle-maps.html#GUID-F1647A8F-CA15-42D2-8037-09B0EA332611" title="A dynamic tile layer is a tile layer defined on the client side.">Using Dynamic Tile Layers</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="props_rev_3"><a id="GUID-D66B53D6-9F3D-45CA-92F5-4F5E40C0B9C7" name="GUID-D66B53D6-9F3D-45CA-92F5-4F5E40C0B9C7"></a><h4 id="JIMPV-GUID-D66B53D6-9F3D-45CA-92F5-4F5E40C0B9C7" class="sect4"><span class="enumeration_section">4.5.3 </span>Creating a Dynamic Tile Layer Using Predefined Themes
                  </h4>
                  <div>
                     <p>Another approach to creating a dynamic tile layer is to use predefined themes. Follow these steps.</p>
                     <ol>
                        <li>
                           <p>Create a <code class="codeph">ServerMapRequest</code> instance and set its properties. For example:
                           </p><pre class="pre codeblock"><code>        var req = new OM.server.ServerMapRequest(baseURL);
        req.setProperties({
            dataSource:"MVDEMO",
            transparent:true,
            antialiase:"false",
        });
        // the three themes below are defined in the metadata already.
        var t1 = new OM.server.ServerPredefinedTheme("THEME_DEMO_STATES");
        var t2 = new OM.server.ServerPredefinedTheme("THEME_DEMO_HIGHWAYS");
        var t3 = new OM.server.ServerPredefinedTheme("THEME_DEMO_CITIES");
        req.addThemes([t1, t2, t3]);
</code></pre></li>
                        <li>
                           <p>Create an object containing properties of this dynamic tile layer. For example:</p><pre class="pre codeblock"><code>        var dtl_props = {  
            universe: myuniv,            
            tileLayerConfig: myconfig,
            tileServerURL: baseURL + "/omserver",
            enableUTFGrid: true,
            enableUTFGridInfoWindow: true,
            utfGridResolution: 4
        };
</code></pre></li>
                        <li>
                           <p>Create a dynamic tile layer. For example:</p><pre class="pre codeblock"><code>  var dynamic_tilelayer_2 = new OM.layer.DynamicTileLayer("dtl2", dtl_props, req);</code></pre><p>The dynamic tile layer requests map images from the map visualization component's map server (omserver), which renders a fresh map image and does not cache the images on disk.</p>
                        </li>
                     </ol>
                     <p>Instead of specifying a server base map, in this approach the <code class="codeph">ServerMapRequest</code> instance adds some map visualization component server predefined themes. From a practical perspective, this allows the client-side application to create tile layers using the server-side defined themes in the view USER_SDO_THEMES.
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="oracle-maps.html#GUID-F1647A8F-CA15-42D2-8037-09B0EA332611" title="A dynamic tile layer is a tile layer defined on the client side.">Using Dynamic Tile Layers</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="props_rev_3"><a id="GUID-B515D9FC-C99B-4660-B4C2-FFF5570E7054" name="GUID-B515D9FC-C99B-4660-B4C2-FFF5570E7054"></a><h4 id="JIMPV-GUID-B515D9FC-C99B-4660-B4C2-FFF5570E7054" class="sect4"><span class="enumeration_section">4.5.4 </span>Creating a Dynamic Tile Layer Using Spatial Tables Directly
                  </h4>
                  <div>
                     <p>You can directly use spatial tables for a dynamic tile layer by creating <code class="codeph">ServerJBCTheme</code> instances and adding them into a <code class="codeph">ServerMapRequest</code> instance. Follow these steps.
                     </p>
                     <ol>
                        <li>
                           <p>Create a style. For example: </p><pre class="pre codeblock"><code>        var myc1 = new OM.style.Color({
            styleName: "mycolor1",
            stroke: "#333333", 
            strokeOpacity: 1.0,
            fill: "#F2EFE9", 
            fillOpacity: 1.0
        });
</code></pre></li>
                        <li>
                           <p>Create a JDBC theme and set its properties. Spatial tables are used in a SQL query statement. The statement, as a string type variable, is set as an attribute in the <code class="codeph">OM.server.ServerJDBCTheme</code> instance. For example:
                           </p><pre class="pre codeblock"><code>        var jdbcTStates= new OM.server.ServerJDBCTheme('theme_jdbc_states');
        jdbcTStates.setDataSourceName('mvdemo');
        jdbcTStates.setSRID('8307');
        jdbcTStates.setGeometryColumnName('geom');
        var sql='select totpop, poppsqmi, state, state_abrv, geom from states'; // the query
        jdbcTStates.setQuery(sql);  // set the SQL string
        jdbcTStates.addInfoColumn({column: 'state_abrv', name:'State'});
        jdbcTStates.addInfoColumn({column: 'totpop', name:'Population'});
        jdbcTStates.addInfoColumn({column: 'poppsqmi', name:'Pop. Density'});
        jdbcTStates.setRenderingStyleName('mycolor1');
</code></pre></li>
                        <li>
                           <p>Create a <code class="codeph">ServerMapRequest</code> instance and set its properties. For example:
                           </p><pre class="pre codeblock"><code>        var req = new OM.server.ServerMapRequest(baseURL);
        req.setProperties({
            dataSource:"MVDEMO",
            transparent:true,
            antialiase:"false",
        });
        req.addTheme(jdbcTStates);
        req.addStyle(myc1);
</code></pre></li>
                        <li>
                           <p>Create an object containing properties of this dynamic tile layer. For example:</p><pre class="pre codeblock"><code>        var dtl_props = {  
            universe: myuniv,            
            tileLayerConfig: myconfig,
            tileServerURL: baseURL + "/omserver",
            enableUTFGrid: true,
            enableUTFGridInfoWindow: true,
            utfGridResolution: 4
        };
</code></pre></li>
                        <li>
                           <p>Create a dynamic tile layer. For example:</p><pre class="pre codeblock"><code>  var dynamic_tilelayer_3 = new OM.layer.DynamicTileLayer("dtl3", dtl_props, req);</code></pre></li>
                     </ol>
                     <p>In this example, a dynamically defined style and a <code class="codeph">ServerJDBCTheme</code> object are created first. The <code class="codeph">ServerJDBCTheme</code> can make use the spatial tables directly using a SQL statement. The tables are then used by the <code class="codeph">addTheme</code> and <code class="codeph">addStyle</code> methods of a <code class="codeph">ServerMapRequest</code> object.
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="oracle-maps.html#GUID-F1647A8F-CA15-42D2-8037-09B0EA332611" title="A dynamic tile layer is a tile layer defined on the client side.">Using Dynamic Tile Layers</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="props_rev_3"><a id="GUID-66199642-3D36-47F4-BB45-02943A10EF42" name="GUID-66199642-3D36-47F4-BB45-02943A10EF42"></a><h4 id="JIMPV-GUID-66199642-3D36-47F4-BB45-02943A10EF42" class="sect4"><span class="enumeration_section">4.5.5 </span>Creating a Dynamic Tile Layer Using Third Party Map Services
                  </h4>
                  <div>
                     <p>Another approach to create a dynamic tile layer is to use third party map services. The map service URL of a third party is provided by a client provided URL generation function. Follow these steps.</p>
                     <ol>
                        <li>
                           <p>Using the third party map service provider's specifications, create a URL construction function for building map image requests by a dynamic tile layer. For example:</p><pre class="pre codeblock"><code>var urlb = function (w, h, minX, minY, maxX, maxY, options){
      var str="http://my.mycorp.com:8080/geoserver/ows?";
      var optParams="";
      str = str+"request=getmap"+
      "&amp;bbox="+minX+","+minY+","+maxX+","+maxY+
      "&amp;width="+w+
      "&amp;height="+h;
      
    if (!OM.isNull(options)) {
      for (var key in options) {
        optParams=optParams +"&amp;"+key +"="+options[key];
      }
    }    
    return str+optParams;
  }
</code></pre></li>
                        <li>
                           <p>Create an object containing properties of this dynamic tile layer. For example:</p><pre class="pre codeblock"><code>var dtl_props = {  
    universe: myuniv,            
    tileLayerConfig: myconfig,
    urlBuilder: urlb,
    urlBuilderOptions: {
              "layers":  "topp:states,sf:sfdem,sf:roads,sf:streams",
              "CRS":     "CRS:84",
              "service": "WMS",
              "version": "1.3.0",
              "format":  "image/png"
        } 
};
</code></pre></li>
                        <li>
                           <p>Create a dynamic tile layer. For example:</p><pre class="pre codeblock"><code>  var dynamic_tilelayer_4 = new OM.layer.DynamicTileLayer("dl4", dtl_props);</code></pre></li>
                     </ol>
                     <p>In this example, a dynamic tile layer instance (<code class="codeph">dynamic_tilelayer_4</code>) contains a <code class="codeph">urlBuilder</code> property to provide a URL generation function (<code class="codeph">iurlb</code>). The URL generation function will be used by the dynamic tile layer for fetching image tiles from the specified map service provider. This example uses a third party map provider, a <code class="codeph">GeoServer</code> instance, to provide map images.
                     </p>
                     <p>Additional map service provider required parameters can be provided in the <code class="codeph">urlBuilderOptions</code> property. This example specifies several additional parameters (<code class="codeph">layers</code>, <code class="codeph">CRS</code>, <code class="codeph">service</code>, <code class="codeph">version</code>, and <code class="codeph">format</code>) needed by the <code class="codeph">GeoServer</code> instance.
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="oracle-maps.html#GUID-F1647A8F-CA15-42D2-8037-09B0EA332611" title="A dynamic tile layer is a tile layer defined on the client side.">Using Dynamic Tile Layers</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="props_rev_3"><a id="GUID-31918E3F-96F8-41E6-B835-5796714DC54F" name="GUID-31918E3F-96F8-41E6-B835-5796714DC54F"></a><h4 id="JIMPV-GUID-31918E3F-96F8-41E6-B835-5796714DC54F" class="sect4"><span class="enumeration_section">4.5.6 </span>Dynamic Tile Layer Use Case
                  </h4>
                  <div>
                     <p>This topic describes a dynamic tile layer use case.</p>
                     <p>The code examples come from a dynamic tile layer application. The application uses the map visualization component server to provide map image tiles. It uses spatial tables directly via an <code class="codeph">OM.server.ServerJDBCTheme</code> instance.
                     </p>
                     <ol>
                        <li>
                           <p>Obtain the SQL query's "where" clause from an application's user interface using the <code class="codeph">getWhereClauseFromUI()</code> function, assuming that this function is properly defined already in that application and returns expected results. For example:
                           </p><pre class="pre codeblock"><code>    var  wherec = getWhereClauseFromUI();</code></pre></li>
                        <li>
                           <p>Create a JDBC theme and set its properties. For example:</p><pre class="pre codeblock"><code>    var objJDBCTheme= new OM.server.ServerJDBCTheme();
    objJDBCTheme.setDataSourceName('storm');
    objJDBCTheme.setSRID('3857');
    objJDBCTheme.setXColumnName('long_loc');
    objJDBCTheme.setYColumnName('lat_loc');

    objJDBCTheme.addInfoColumn({column: 'YEAR', name:'Year'});
    objJDBCTheme.addInfoColumn({column: 'MONTH', name:'Month'});
    objJDBCTheme.addInfoColumn({column: 'DAY', name:'Day'});
    objJDBCTheme.addInfoColumn({column: 'STATE', name:'State'});
    objJDBCTheme.addInfoColumn({column: 'LOSS', name:'Loss'});
    objJDBCTheme.addInfoColumn({column: 'CROPLOSS', name:'Crop_loss'});
    objJDBCTheme.addInfoColumn({column: 'FATALITIES', name:'Fatalities'});
    objJDBCTheme.addInfoColumn({column: 'INJURIES', name:'Injuries'});

    objJDBCTheme.setName('theme_tornado');
    objJDBCTheme.setQuery("SELECT s.geom.sdo_point.x long_loc,s.geom.sdo_point.y lat_loc,year,month,day,state,fatalities,injuries,loss,croploss from tornado_3857 s"+
(wherec === "" ?"": wherec));
    objJDBCTheme.setRenderingStyleName('V.TORNADO');
</code></pre></li>
                        <li>
                           <p>Create a <code class="codeph">ServerMapRequest</code> instance and set its properties. For example:
                           </p><pre class="pre codeblock"><code>        var req = new OM.server.ServerMapRequest(baseURL);
        req.setProperties({
            dataSource:'storm',
            transparent:true,  // map image is set to be transparent
            antialiase:"false"
        });
        req.addTheme(objJDBCTheme);
</code></pre></li>
                        <li>
                           <p>Create an object containing properties of this dynamic tile layer. For example:</p><pre class="pre codeblock"><code>        var dtl_props = {  
            universe: myuniv,            
            tileLayerConfig: myconfig,
            tileServerURL: baseURL + "/omserver",
            enableUTFGrid: true,
            enableUTFGridInfoWindow: true,
            utfGridResolution: 4
        };
</code></pre></li>
                        <li>
                           <p>Create a dynamic tile layer. For example:</p><pre class="pre codeblock"><code>  var tornado_damage = new OM.layer.DynamicTileLayer("tornado_damage", dtl_props, req);</code></pre></li>
                     </ol>
                     <p>The code examples in the preceding steps illustrate the following:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The map application fetches map images from a map visualization component server. Therefore, it may use all available features from the map visualization component server.</p>
                        </li>
                        <li>
                           <p>The map image is set to be transparent (that is, the value for property <code class="codeph">transparent</code> is <code class="codeph">true</code>). This setting makes all of the non-overlapping features visible when multiple dynamic tile layers are stacked for display. For example, when you overlay a <code class="codeph">tornado_damage</code> dynamic tile layer on top of a <code class="codeph">hail_damage</code> dynamic tile layer, you may see both layers on the map when such events (as their names suggest) were happening at non-overlapping locations. This setting is more useful for multiple layers containing linear and point features. Note that since the API allows you to turn on/off a layer's visibility, you can always make a layer of interest stand out and be visible in your application.
                           </p>
                        </li>
                        <li>
                           <p>The dynamic tile layer also enables the map visualization component server's <code class="codeph">UTFGrid</code> support (specifically, the value for property <code class="codeph">enableUTFGrid</code> is set to <code class="codeph">true</code>, with a resolution value set to 4 for the <code class="codeph">utfGridResolution</code> property). This setting instructs map visualization component's API to request an additional <code class="codeph">UTFGrid</code> file as a companion of its map tile image. It is a JSON file, and it contains a two-dimensional grid table in UTF encoding, that matches the tile image. It also contains some text attributes for each grid cell.
                           </p>
                           <p>When a mouse event (for example, a mouse click) is triggered at an image pixel, its corresponding grid cell can then be located, its UTF code be obtained, and subsequently, the text attributes associated with that grid cell's UTF code can be retrieved and displayed in a popup info window.</p>
                           <p>The text attributes contained in that JSON file are specified using the <code class="codeph">addInfoColumn()</code> method. Those text attributes will be displayed in an info window for a pixel being clicked on the map.
                           </p>
                           <p>Note that if server-side predefined geometry themes are used by a dynamic tile layer, the text attributes for an info window must have been specified in theme's <code class="codeph">&lt;hidden_info&gt;</code> element. This also applies for the base map-based dynamic tile layers, where the predefined themes are found in the map visualization component's base map definition
                           </p>
                           <p>A resolution value (for example, <code class="codeph">"utfGridResolution":4</code>) indicates the width and height of the grid cell compares with its companion map tile image pixel. In this example, one grid cell in the <code class="codeph">UTFGrid</code> data set represents 16 pixels (4x4=16).
                           </p>
                        </li>
                        <li>
                           <p>This dynamic tile layer makes use of spatial table directly via a <code class="codeph">ServerJDBCTheme</code> to define its map contents. In its embedded SQL statement, the client web application has the flexibility to construct the whole statement, including the tables to use, the columns to select, and the "where" clause to refine the query. In the code snippets, it assumes that a client function, <code class="codeph">getWhereClauseFromUI()</code>, only constructs the 'where' clause in the JDBC theme definition.
                           </p>
                        </li>
                     </ul>
                     <p>The dynamic tile layer supported in the Oracle Maps JavaScript API allows the map visualization component server metadata to be used by the tile layer, and it offers flexibility in how a dynamic tile layer is defined and where to fetch its map images by the client application.</p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="oracle-maps.html#GUID-F1647A8F-CA15-42D2-8037-09B0EA332611" title="A dynamic tile layer is a tile layer defined on the client side.">Using Dynamic Tile Layers</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>