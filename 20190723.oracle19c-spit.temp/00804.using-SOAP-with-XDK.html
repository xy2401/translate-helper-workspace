<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="An explanation is given of how to use Simple Object Access Protocol (SOAP) with the Oracle XML Developer's Kit (XDK) for C.">
      <meta name="description" content="An explanation is given of how to use Simple Object Access Protocol (SOAP) with the Oracle XML Developer's Kit (XDK) for C.">
      <title>Using SOAP with the Oracle XML Developer's Kit for C</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Programmer's Guide">
      <meta property="og:description" content="An explanation is given of how to use Simple Object Access Protocol (SOAP) with the Oracle XML Developer's Kit (XDK) for C.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Programmer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="xml-developers-kit-programmers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-11T05:58:48-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2001, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96292-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="determining-XML-differences-using-C.html" title="Previous" type="text/html">
      <link rel="next" href="XDK-for-Java.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="XML Developers Kit Programmers Guide">
    <meta name="dcterms.isVersionOf" content="ADXDK">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="determining-XML-differences-using-C.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="XDK-for-Java.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Programmer's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="XDK-for-C.html" property="item" typeof="WebPage"><span property="name">Oracle XML Developer's Kit for C</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Using SOAP with the Oracle XML Developer's Kit for C</li>
            </ol>
            <a id="GUID-DC6C8B37-2B99-4C11-A4C6-D6CF2F5E441C" name="GUID-DC6C8B37-2B99-4C11-A4C6-D6CF2F5E441C"></a><a id="ADXDK1043"></a><a id="ADXDK19852"></a>
            
            <h2 id="ADXDK-GUID-DC6C8B37-2B99-4C11-A4C6-D6CF2F5E441C" class="sect2"><span class="enumeration_chapter">9 </span>Using SOAP with the Oracle XML Developer's Kit for C
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>An explanation is given of how to use Simple Object Access Protocol (SOAP) with the Oracle XML Developer's Kit (XDK) for C.</p>
               <div class="section"></div>
               <!-- class="section" -->
               <div class="infoboxnotealso" id="GUID-DC6C8B37-2B99-4C11-A4C6-D6CF2F5E441C__GUID-80387919-9AD6-464F-874D-B49E115CFC63">
                  <p class="notep1">See Also:</p>
                  <p><a href="../adxdb/native-XML-DB-web-services.html#ADXDB3900" target="_blank"><span><cite>Oracle XML&nbsp;DB Developerâ€™s Guide</cite></span></a></p>
               </div>
            </div><a id="ADXDK19853"></a><div class="props_rev_3"><a id="GUID-97787437-6E3F-4FC0-949B-B151E1861C38" name="GUID-97787437-6E3F-4FC0-949B-B151E1861C38"></a><h3 id="ADXDK-GUID-97787437-6E3F-4FC0-949B-B151E1861C38" class="sect3">Introduction to SOAP for C</h3>
               <div>
                  <p>SOAP is an Extensible Markup Language (XML) protocol for exchanging structured and typed information between peers using HTTP and HTTPS in a distributed environment. Only HTTP 1.0 is supported in XDK for Oracle Database 10g Release 2. </p>
                  <p>SOAP has three parts:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>The SOAP envelope which defines how to present what is in the message, who must process the message, and whether that processing is optional or mandatory.</p>
                     </li>
                     <li>
                        <p>A set of serialization and deserialization rules for converting application data types to and from XML.</p>
                     </li>
                     <li>
                        <p>A SOAP remote procedure call (RPC) that defines calls and responses.</p>
                        <div class="infoboxnote" id="GUID-97787437-6E3F-4FC0-949B-B151E1861C38__GUID-6E8C4645-D28D-4602-80CF-5BC1EF46AEEB">
                           <p class="notep1">Note:</p>
                           <p>RPC and serialization/deserialization are not supported in this release.</p>
                        </div>
                     </li>
                  </ul>
                  <p>SOAP is operating system and language-independent because it is XML-based. This chapter presents the C implementation of the functions that read and write the SOAP message.</p>
                  <p>SOAP Version 1.2 is the definition of an XML-based message which is specified as an XML Infoset (an abstract data set, it could be XML 1.0) that gives a description of the message contents. Version 1.1 is also supported.</p>
               </div><a id="ADXDK19854"></a><div class="props_rev_3"><a id="GUID-EE6B64F4-9260-4E9D-A687-163AF7EE2D6D" name="GUID-EE6B64F4-9260-4E9D-A687-163AF7EE2D6D"></a><h4 id="ADXDK-GUID-EE6B64F4-9260-4E9D-A687-163AF7EE2D6D" class="sect4">SOAP Messaging Overview</h4>
                  <div>
                     <p>SOAP is a lightweight protocol for sending and receiving requests and responses across the Internet. Because it is based on XML and transport protocols such as HTTP, it is not blocked by most firewalls. SOAP is independent of operating system, implementation language, and object model. </p>
                     <p>The power of SOAP is its ability to act as the glue between heterogeneous software components. For example, Visual Basic clients can invoke Common Object Request Broker Architecture (CORBA) services running on UNIX computers; Macintosh clients can invoke Perl objects running on Linux.</p>
                     <p>SOAP messages have these parts:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>An <strong class="term">envelope</strong> that contains the message, defines how to process the message and who processes it, and whether processing is optional or mandatory. The <code class="codeph">Envelope</code> element is required. 
                           </p>
                        </li>
                        <li>
                           <p>A set of <strong class="term">encoding rules</strong> that describe the data types for the application. These rules define a serialization mechanism that converts the application data types to and from XML.
                           </p>
                        </li>
                        <li>
                           <p>A <strong class="term">remote procedure call (RPC)</strong> request and response convention. This required element is called a body element. The <code class="codeph">Body</code> element contains a first subelement whose name is the name of a method. This method request element contains elements for each input and output parameter. The element names are the parameter names. RPC is not currently supported in this release.
                           </p>
                        </li>
                     </ul>
                     <p>SOAP is independent of any transport protocol. Nevertheless, SOAP used over HTTP for remote service invocation has emerged as a standard for delivering programmatic content over the Internet.</p>
                     <p>Besides being independent of transfer protocol, SOAP is also independent of operating system. In other words, SOAP enables programs to communicate even when they are written in different languages and run on different operating systems.</p>
                  </div><a id="ADXDK19855"></a><div class="props_rev_3"><a id="GUID-221EA94A-2F7A-40DA-907B-D3214CFB28D9" name="GUID-221EA94A-2F7A-40DA-907B-D3214CFB28D9"></a><h5 id="ADXDK-GUID-221EA94A-2F7A-40DA-907B-D3214CFB28D9" class="sect5">SOAP Message Format</h5>
                     <div>
                        <p>Types of SOAP messages are described.</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Requests for a service, including input parameters</p>
                           </li>
                           <li>
                              <p>Responses from the requested service, including return value and output parameters</p>
                           </li>
                           <li>
                              <p>Optional fault elements containing error codes and information</p>
                           </li>
                        </ul>
                        <p>In a SOAP message, the <strong class="term">payload</strong> contains the XML-encoded data. The payload contains no processing information. In contrast, the message header may contain processing information.
                        </p>
                     </div><a id="ADXDK19857"></a><a id="ADXDK19856"></a><div class="sect5"><a id="GUID-683C406E-BA75-4D41-A422-835656CB4FF4" name="GUID-683C406E-BA75-4D41-A422-835656CB4FF4"></a><h6 id="ADXDK-GUID-683C406E-BA75-4D41-A422-835656CB4FF4" class="sect6">SOAP Requests</h6>
                        <div>
                           <p>SOAP requests are described.</p>
                           <p>In SOAP requests, the XML payload contains several elements that include:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Root element</p>
                              </li>
                              <li>
                                 <p>Method element</p>
                              </li>
                              <li>
                                 <p>Header elements (optional)</p>
                              </li>
                           </ul>
                           <p><a href="using-SOAP-with-XDK.html#GUID-683C406E-BA75-4D41-A422-835656CB4FF4__CHDHJHJJ">Example 9-1</a> shows the format of a sample SOAP message request. A <code class="codeph">GetLastTradePrice</code> SOAP request is sent to a <code class="codeph">StockQuote</code> service. The request accepts a string parameter representing the company stock symbol and returns a float representing the stock price in the SOAP response.
                           </p>
                           <div class="example" id="GUID-683C406E-BA75-4D41-A422-835656CB4FF4__CHDHJHJJ">
                              <p class="titleinexample">Example 9-1 SOAP Request Message</p><pre class="oac_no_warn" dir="ltr">POST /StockQuote HTTP/1.0
Host: www.stockquoteserver.com
Content-Type: application/soap+xml; charset="utf-8"
Content-Length: nnnn
SOAPAction: "Some-URI"

&lt;SOAP-ENV:Envelope  xmlns:SOAP-ENV="http://www.w3.org/2003/05/soap-envelope"
            SOAP-ENV:encodingStyle="http://www.w3.org/2003/05/soap-encoding/"&gt;
  &lt;SOAP-ENV:Body&gt;
    &lt;m:GetLastTradePrice xmlns:m="Some-URI"&gt;
      &lt;symbol&gt;ORCL&lt;/symbol&gt;
    &lt;m:GetLastTradePrice&gt;
  &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;
</pre></div>
                           <!-- class="example" -->
                           <p>In <a href="using-SOAP-with-XDK.html#GUID-683C406E-BA75-4D41-A422-835656CB4FF4__CHDHJHJJ">Example 9-1</a>, the XML document is the SOAP message. The <code class="codeph">&lt;SOAP-ENV:Envelope&gt;</code> element is the top-level element of the XML document. The payload is represented by the method element <code class="codeph">&lt;m:GetLastTradePrice&gt;</code>. XML namespaces distinguish SOAP identifiers from application-specific identifiers. 
                           </p>
                           <p>The first line of the header specifies that the request uses HTTP as the transport protocol:</p><pre class="oac_no_warn" dir="ltr">POST /StockQuote HTTP/1.1
</pre><p>Because SOAP is independent of transport protocol, the rules governing XML payload format are independent of the use of HTTP for transport of the payload. This HTTP request points to the URI <code class="codeph">/StockQuote</code>. Because the SOAP specification is silent on the issue of component activation, the code behind this URI determines how to activate the component and invoke the <code class="codeph">GetLastTradePrice</code> method. 
                           </p>
                        </div>
                     </div><a id="ADXDK19859"></a><a id="ADXDK19858"></a><div class="props_rev_3"><a id="GUID-B975BA93-4413-48F0-B27E-25E3B0C10DF0" name="GUID-B975BA93-4413-48F0-B27E-25E3B0C10DF0"></a><h6 id="ADXDK-GUID-B975BA93-4413-48F0-B27E-25E3B0C10DF0" class="sect6">Example of a SOAP Response</h6>
                        <div>
                           <p>An example of a SOAP response is presented.</p>
                           <p><a href="using-SOAP-with-XDK.html#GUID-B975BA93-4413-48F0-B27E-25E3B0C10DF0__CHDCHGHH">Example 9-2</a> shows the format of the response to the request in <a href="using-SOAP-with-XDK.html#GUID-683C406E-BA75-4D41-A422-835656CB4FF4__CHDHJHJJ">Example 9-1</a>. Element <code class="codeph">&lt;Price&gt;</code> contains the stock price for <code class="codeph">ORCL</code> requested by the first message.
                           </p>
                           <p>The messages shown in <a href="using-SOAP-with-XDK.html#GUID-683C406E-BA75-4D41-A422-835656CB4FF4__CHDHJHJJ">Example 9-1</a> and <a href="using-SOAP-with-XDK.html#GUID-B975BA93-4413-48F0-B27E-25E3B0C10DF0__CHDCHGHH">Example 9-2</a> show two-way SOAP messaging, that is, a SOAP request that is answered by a SOAP response. A one-way SOAP message does not require a SOAP message in response.
                           </p>
                           <div class="example" id="GUID-B975BA93-4413-48F0-B27E-25E3B0C10DF0__CHDCHGHH">
                              <p class="titleinexample">Example 9-2 SOAP Response Message</p><pre class="pre codeblock"><code>HTTP/1.0 200 OK
Content-Type: application/soap+xml; charset="utf-8"
Content-Length: nnnn

&lt;SOAP-ENV:Envelope  xmlns:SOAP-ENV="http://www.w3.org/2003/05/soap-envelope" 
 SOAP-ENV:encodingStyle="http://www.w3.org/2003/05/soap-encoding/"&gt;
  &lt;SOAP-ENV:Body&gt;
    &lt;m:GetLastTradePriceResponse xmlns:m="Some-URI"&gt;
      &lt;Price&gt;13.5&lt;/Price&gt;
    &lt;/m:GetLastTradePriceResponse&gt;
  &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;
</code></pre></div>
                           <!-- class="example" -->
                        </div>
                     </div>
                  </div>
               </div><a id="ADXDK19860"></a><div class="props_rev_3"><a id="GUID-E2B40E66-A184-4A1E-8790-B04B8F8A80CD" name="GUID-E2B40E66-A184-4A1E-8790-B04B8F8A80CD"></a><h4 id="ADXDK-GUID-E2B40E66-A184-4A1E-8790-B04B8F8A80CD" class="sect4">Using SOAP Clients</h4>
                  <div>
                     <p>SOAP clients are user-written applications that generate XML documents. The documents make a request for a SOAP service and handle a SOAP response. The SOAP implementation in XDK handles requests from any client that sends a valid SOAP request. </p>
                     <div class="section">
                        <p>The SOAP client application programming interface (API) has these features:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Supports a synchronous invocation model for requests and responses</p>
                           </li>
                           <li>
                              <p>Facilitates the writing of client applications to make SOAP requests</p>
                           </li>
                           <li>
                              <p>Encapsulates the creation of the SOAP request and the details of sending the request over the underlying transport protocol</p>
                           </li>
                           <li>
                              <p>Supports a pluggable transport, allowing the client to easily change the transport (available transports include HTTP and HTTPS, but only HTTP 1.0 is supported in this release)</p>
                           </li>
                        </ul>
                        <p>A SOAP client must perform these steps to make a request and receive a response:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li><span>Gather all parameters that are needed to invoke a service.</span></li>
                        <li><span>Create a SOAP service request message, which is an XML message that is built according to the SOAP protocol. It contains all the values of all input parameters encoded in XML. This process is called <strong class="term">serialization</strong>.</span></li>
                        <li><span>Submit the request to a SOAP server using a transport protocol that is supported by the SOAP server.</span></li>
                        <li><span>Receive a SOAP response message.</span></li>
                        <li><span>Determine the success or failure of the request by handling the SOAP Fault element.</span></li>
                        <li><span>Convert the returned parameter from XML to native data type. This process is called <strong class="term">deserialization</strong>.</span></li>
                        <li><span>Use the result as needed.</span></li>
                     </ol>
                  </div>
               </div><a id="ADXDK19861"></a><div class="props_rev_3"><a id="GUID-53495893-9965-441A-BADF-A848C5FB3DB6" name="GUID-53495893-9965-441A-BADF-A848C5FB3DB6"></a><h4 id="ADXDK-GUID-53495893-9965-441A-BADF-A848C5FB3DB6" class="sect4">Using SOAP Servers</h4>
                  <div>
                     <p>The steps performed by a SOAP server when executing a SOAP service request are described.</p>
                     <ol>
                        <li>
                           <p>The SOAP server receives the service request.</p>
                        </li>
                        <li>
                           <p>The server parses the XML request and then decides whether to execute or reject the message.</p>
                        </li>
                        <li>
                           <p>If the message is executed, then the server determines whether the requested service exists.</p>
                        </li>
                        <li>
                           <p>The server converts all input parameters from XML into data types that the service understands.</p>
                        </li>
                        <li>
                           <p>The server invokes the service.</p>
                        </li>
                        <li>
                           <p>The server converts the return parameter to XML and generates a SOAP response message.</p>
                        </li>
                        <li>
                           <p>The server sends the response message back to the caller.</p>
                        </li>
                     </ol>
                  </div>
               </div>
            </div><a id="ADXDK19863"></a><a id="ADXDK19862"></a><div class="props_rev_3"><a id="GUID-8AA3100D-6E51-4D08-B5C4-4819C7EACF64" name="GUID-8AA3100D-6E51-4D08-B5C4-4819C7EACF64"></a><h3 id="ADXDK-GUID-8AA3100D-6E51-4D08-B5C4-4819C7EACF64" class="sect3">SOAP C Functions</h3>
               <div>
                  <p>The SOAP C implementation uses the <code class="codeph">xml.h</code> header. A context of type <code class="codeph">xmlctx</code> must be created before a SOAP context can be created. 
                  </p>
                  <p>HTTP aspects of SOAP are hidden from the user. SOAP endpoints are specified as a couple (binding, endpoint) where binding is of type <code class="codeph">xmlsoapbind</code> and the endpoint is a (<code class="codeph">void *</code>) depending on the binding. Currently, only one binding is supported, <code class="codeph">XMLSOAP_BIND_HTTP</code>. For HTTP binding, the endpoint is an (<code class="codeph">OraText *</code>) URL.
                  </p>
                  <p>The SOAP layer creates and transports SOAP messages between endpoints, and decomposes received SOAP messages. </p>
                  <p>The C functions are declared in <code class="codeph">xmlsoap.h</code>. Here is the beginning of that header file:
                  </p>
                  <div class="infoboxnotealso" id="GUID-8AA3100D-6E51-4D08-B5C4-4819C7EACF64__GUID-51CF2FC4-5921-4DC5-BCA1-040F4B0E97D6">
                     <p class="notep1">See Also:</p>
                     <p> <a href="../caxml/package-SOAP-API.html#CAXML01300" target="_blank"><span><cite>Oracle Database XML C API Reference</cite></span></a> for the C SOAP APIs
                     </p>
                  </div>
                  <div class="example" id="GUID-8AA3100D-6E51-4D08-B5C4-4819C7EACF64__GUID-D73DB195-39E0-4C3B-BB9D-54CA6C540DDE">
                     <p class="titleinexample">Example 9-3 SOAP C Functions Defined in xmlsoap.h</p><pre class="oac_no_warn" dir="ltr">   FILE NAME
        xmlsoap.h - XML SOAP APIs
 
   FILE DESCRIPTION
        XML SOAP Public APIs
 
   PUBLIC FUNCTIONS
        XmlSoapCreateCtx         - Create and return a SOAP context
        XmlSoapDestroyCtx        - Destroy a SOAP context
 
        XmlSoapCreateConnection  - Create a SOAP connection object
        XmlSoapDestroyConnection - Destroy a SOAP connection object
 
        XmlSoapCall              - Send a SOAP message &amp; wait for reply
 
        XmlSoapCreateMsg         - Create and return an empty SOAP message
        XmlSoapDestroyMsg        - Destroy a SOAP message created
                                      w/XmlSoapCreateMsg
 
        XmlSoapGetEnvelope       - Return a SOAP message's envelope
        XmlSoapGetHeader         - Return a SOAP message's envelope header
        XmlSoapGetBody           - Return a SOAP message's envelope body
 
        XmlSoapAddHeaderElement  - Adds an element to a SOAP header
        XmlSoapGetHeaderElement  - Gets an element from a SOAP header
 
        XmlSoapAddBodyElement    - Adds an element to a SOAP message body
        XmlSoapGetBodyElement    - Gets an element from a SOAP message body
 
        XmlSoapSetMustUnderstand - Set mustUnderstand attr for SOAP hdr elem
        XmlSoapGetMustUnderstand - Get mustUnderstand attr from SOAP hdr elem
 
        XmlSoapSetRole           - Set role for SOAP header element
        XmlSoapGetRole           - Get role from SOAP header element
 
        XmlSoapSetRelay          - Set relay Header element property
        XmlSoapGetRelay          - Get relay Header element property
 
        XmlSoapSetFault          - Set Fault in SOAP message
        XmlSoapHasFault          - Does SOAP message have a Fault?
        XmlSoapGetFault          - Return Fault code, reason, and details
        
        XmlSoapAddFaultReason    - Add additional Reason to Fault
        XmlSoapAddFaultSubDetail - Add additional child to Fault Detail
        XmlSoapGetReasonNum      - Get number of Reasons in Fault element
        XmlSoapGetReasonLang     - Get a lang of a reasons with a
                                       particular iindex.
 
        XmlSoapError             - Get error message(s)
 
*/
 
#ifndef XMLSOAP_ORACLE
# define XMLSOAP_ORACLE
 
# ifndef XML_ORACLE
#  include &lt;xml.h&gt;
# endif
 
/*---------------------------------------------------------------------------
                Package SOAP - Simple Object Access Protocol APIs
 
     W3C: "SOAP is a lightweight protocol for exchange of information
     in a decentralized, distributed environment.  It is an XML based
     protocol that consists of three parts: an envelope that defines a
     framework for describing what is in a message and how to process
     it, a set of encoding rules for expressing instances of
     application-defined datatypes, and a convention for representing
     remote procedure calls and responses."
     Atachments are allowed only in Soap 1.1     
     In Soap 1.2 body may not have other elements if Fault is present.
  
     Structure of a SOAP message:
 
     [SOAP message (XML document)
        [SOAP envelope
             [SOAP header?
                 element*
             ]
             [SOAP body
                 (element* | Fault)?
             ]
        ]
     ]
---------------------------------------------------------------------------*/
...</pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="ADXDK19865"></a><a id="ADXDK19866"></a><a id="ADXDK19864"></a><div class="props_rev_3"><a id="GUID-38829ADC-8292-419D-876E-4C0BB7019CA2" name="GUID-38829ADC-8292-419D-876E-4C0BB7019CA2"></a><h3 id="ADXDK-GUID-38829ADC-8292-419D-876E-4C0BB7019CA2" class="sect3">SOAP Example 1: Sending an XML Document</h3>
               <div>
                  <p>An XML document is presented that shows a request to a travel company for a reservation on a plane flight from New York to Los Angeles for John Smith. A simple example creates the XML document, sends it, receives and decomposes a reply. There is some minimal error checking.</p>
                  <p>The <code class="codeph">DEBUG</code> option is shown for correcting anomalies. The program may not work on all operating systems. To send this XML document, the first client C program follows these steps:
                  </p>
                  <ol>
                     <li>
                        <p>After declaring variables in <code class="codeph">main()</code>, an XML context, <code class="codeph">xctx</code>, is created using <code class="codeph">XmlCreate()</code> and the context is then used to create a SOAP context, <code class="codeph">ctx</code>, using <code class="codeph">XmlSoapCreateCtx()</code>.
                        </p>
                     </li>
                     <li>
                        <p>To construct the message, <code class="codeph">XmlSoapCreateMsg()</code> is called and returns an empty SOAP message.
                        </p>
                     </li>
                     <li>
                        <p>The header is constructed using <code class="codeph">XmlSoapAddHeaderElement()</code>, <code class="codeph">XmlSoapSetRole()</code>, <code class="codeph">XmlSoapSetMustUnderstand()</code>, and <code class="codeph">XmlDomAddTextElem()</code> to fill in the envelope with text.
                        </p>
                     </li>
                     <li>
                        <p>The body elements are created by <code class="codeph">XmlSoapAddBodyElement()</code>, <code class="codeph">XmlDomCreateElemNS()</code>, and a series of invocations of <code class="codeph">XmlDomAddTextElem()</code>. Then <code class="codeph">XmlDomAppendChild()</code> completes the section of the body specifying the New York to Los Angeles flight.
                        </p>
                     </li>
                     <li>
                        <p>The return flight is built in an analogous way. The lodging is added with another <code class="codeph">XmlSoapAddBodyElement()</code> invocation.
                        </p>
                     </li>
                     <li>
                        <p>The connection must be created next with <code class="codeph">XmlSoapCreateConnection()</code>, specifying HTTP binding (the only binding available now) and an endpoint URL.
                        </p>
                     </li>
                     <li>
                        <p>The function <code class="codeph">XmlSoapCall()</code> sends the message over the defined connection with the SOAP server, and then waits for the reply. 
                        </p>
                     </li>
                     <li>
                        <p>The message reply is returned in the form of another SOAP message. This is done with <code class="codeph">XmlSaveDom()</code> and <code class="codeph">XmlSoapHasFault()</code> used with <code class="codeph">XmlSoapGetFault()</code> to check for a fault and analyze the fault. The fault is parsed into its parts, which is output in this example. 
                        </p>
                     </li>
                     <li>
                        <p>If there was no fault returned, this is followed by <code class="codeph">XmlSoapGetBody()</code> to return the envelope body. <code class="codeph">XmlSaveDom()</code> completes the analysis of the returned message.
                        </p>
                     </li>
                     <li>
                        <p>To clean up, use <code class="codeph">XmlSoapDestroyMsg()</code> on the message and on the reply, <code class="codeph">XmlDestroyCtx()</code> to destroy the SOAP context, and <code class="codeph">XmlDestroy()</code> to destroy the XML context.
                        </p>
                     </li>
                  </ol>
                  <div class="example" id="GUID-38829ADC-8292-419D-876E-4C0BB7019CA2__GUID-E9CD8429-D166-439B-9101-9D5786426A4A">
                     <p class="titleinexample">Example 9-4 Example 1 SOAP Message</p><pre class="pre codeblock"><code>&lt;?xml version='1.0' ?&gt;
&lt;env:Envelope xmlns:env="http://www.w3.org/2003/05/soap-envelope"&gt; 
 &lt;env:Header&gt;
  &lt;m:reservation xmlns:m="http://travelcompany.example.org/reservation" 
          env:role="http://www.w3.org/2003/05/soap-envelope/role/next"
           env:mustUnderstand="true"&gt;
   &lt;m:reference&gt;uuid:093a2da1-q345-739r-ba5d-pqff98fe8j7d&lt;/m:reference&gt;
   &lt;m:dateAndTime&gt;2001-11-29T13:20:00.000-05:00&lt;/m:dateAndTime&gt;
  &lt;/m:reservation&gt;
  &lt;n:passenger xmlns:n="http://mycompany.example.com/employees"
          env:role="http://www.w3.org/2003/05/soap-envelope/role/next"
           env:mustUnderstand="true"&gt;
   &lt;n:name&gt;John Smith&lt;/n:name&gt;
  &lt;/n:passenger&gt;
 &lt;/env:Header&gt;
 &lt;env:Body&gt;
  &lt;p:itinerary
    xmlns:p="http://travelcompany.example.org/reservation/travel"&gt;
   &lt;p:departure&gt;
     &lt;p:departing&gt;New York&lt;/p:departing&gt;
     &lt;p:arriving&gt;Los Angeles&lt;/p:arriving&gt;
     &lt;p:departureDate&gt;2001-12-14&lt;/p:departureDate&gt;
     &lt;p:departureTime&gt;late afternoon&lt;/p:departureTime&gt;
     &lt;p:seatPreference&gt;aisle&lt;/p:seatPreference&gt;
   &lt;/p:departure&gt;
   &lt;p:return&gt;
     &lt;p:departing&gt;Los Angeles&lt;/p:departing&gt;
     &lt;p:arriving&gt;New York&lt;/p:arriving&gt;
     &lt;p:departureDate&gt;2001-12-20&lt;/p:departureDate&gt;
     &lt;p:departureTime&gt;mid-morning&lt;/p:departureTime&gt;
     &lt;p:seatPreference/&gt;
   &lt;/p:return&gt;
  &lt;/p:itinerary&gt;
  &lt;q:lodging
   xmlns:q="http://travelcompany.example.org/reservation/hotels"&gt;
   &lt;q:preference&gt;none&lt;/q:preference&gt;
  &lt;/q:lodging&gt;
 &lt;/env:Body&gt;
&lt;/env:Envelope&gt;
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-38829ADC-8292-419D-876E-4C0BB7019CA2__BABEGEGD">
                     <p class="titleinexample">Example 9-5 Example 1 SOAP C Client</p><pre class="pre codeblock"><code>#ifndef S_ORACLE
# include &lt;s.h&gt;
#endif
 
#ifndef XML_ORACLE
# include &lt;xml.h&gt;
#endif
 
#ifndef XMLSOAP_ORACLE
# include &lt;xmlsoap.h&gt;
#endif
 
 
#define MY_URL "http://my_url.com"
 
/* static function declaration */
static xmlerr add_ns_decl(xmlsoapctx  *ctx, xmlctx *xctx, xmlelemnode *elem,
                        oratext *pfx, oratext *uri);
 
 
sb4 main( sword argc, char *argv[])
{
    xmlctx      *xctx;
    xmlerr       xerr;
    xmlsoapctx  *ctx;
    oratext     *url;
    xmlsoapcon  *con;
 
    xmldocnode  *msg1, *reply, *msg2, *msg3;
    xmlelemnode *res, *pas, *pref, *itin, *departure, *ret, *lodging;
    xmlelemnode *departing, *arriving, *trans, *text, *charge, *card, *name;
    xmlelemnode *body, *header;
    boolean      has_fault;
    oratext     *code, *reason, *lang, *node, *role;
    xmlelemnode *detail;
    oratext *comp_uri   = "http://travelcompany.example.org/";
    oratext *mres_uri   = "http://travelcompany.example.org/reservation";
    oratext *trav_uri   = "http://travelcompany.example.org/reservation/travel";
    oratext *hotel_uri  = "http://travelcompany.example.org/reservation/hotels";
    oratext *npas_uri   = "http://mycompany.example.com/employees";
 
    oratext *tparty_uri = "http://thirdparty.example.org/transaction";
    oratext *estyle_uri = "http://example.com/encoding";
    oratext *soap_style_uri = "http://www.w3.org/2003/05/soap-encoding";
    oratext *estyle     = "env:encodingStyle";
    oratext *finance_uri = "http://mycompany.example.com/financial";
    
 
    if (!(xctx = XmlCreate(&amp;xerr, (oratext *)"SOAP_test",NULL)))
    {
        printf("Failed to create XML context, error %u\n", (unsigned) xerr);
        return EX_FAIL;
    }
    /* Create SOAP context */
    if (!(ctx = XmlSoapCreateCtx(xctx, &amp;xerr, (oratext *) "example", NULL)))
       {
         printf("Failed to create SOAP context, error %u\n", (unsigned) xerr);
         return EX_FAIL;
       }
 
 
    /* EXAMPLE 1 */
    /* construct message */
    if (!(msg1 = XmlSoapCreateMsg(ctx, &amp;xerr)))
    {
      printf("Failed to create SOAP message, error %u\n", (unsigned) xerr);
      return xerr;
    }
    res = XmlSoapAddHeaderElement(ctx, msg1, "m:reservation", mres_uri, &amp;xerr);
    xerr = XmlSoapSetRole(ctx, res, XMLSOAP_ROLE_NEXT);
    xerr = XmlSoapSetMustUnderstand(ctx, res, TRUE);
    (void) XmlDomAddTextElem(xctx, res, mres_uri, "m:reference",
                 "uuid:093a2da1-q345-739r-ba5d-pqff98fe8j7d");
    (void) XmlDomAddTextElem(xctx, res, mres_uri, "m:dateAndTime",
                               "2001-11-29T13:20:00.000-05:00");
    pas = XmlSoapAddHeaderElement(ctx, msg1, "n:passenger", npas_uri, &amp;xerr);
    xerr = XmlSoapSetRole(ctx, pas, XMLSOAP_ROLE_NEXT);
    xerr = XmlSoapSetMustUnderstand(ctx, pas, TRUE);
    (void) XmlDomAddTextElem(xctx, pas, npas_uri, "n:name",
                              "John Smith");
    /* Fill body */
    /* Itinerary */
    itin = XmlSoapAddBodyElement(ctx, msg1, "p:itinerary", trav_uri, &amp;xerr);
    /* Departure */
    departure = XmlDomCreateElemNS(xctx, msg1,  trav_uri, "p:departure");
    (void) XmlDomAddTextElem(xctx, departure, trav_uri,
                              "p:departing","New York");
    (void) XmlDomAddTextElem(xctx, departure, trav_uri,
                              "p:arriving", "Los Angeles");
    (void) XmlDomAddTextElem(xctx, departure, trav_uri,
                              "p:departureDate", "2001-12-14");
    (void) XmlDomAddTextElem(xctx, departure, trav_uri,
                              "p:departureTime", "late afternoon");
    (void) XmlDomAddTextElem(xctx, departure, trav_uri,
                              "p:seatPreference", "aisle");
    XmlDomAppendChild(xctx, itin, departure);
 
    /* Return */
    ret = XmlDomCreateElemNS(xctx, msg1,  trav_uri, "p:return");
    (void) XmlDomAddTextElem(xctx, ret, trav_uri,
                              "p:departing", "Los Angeles");
    (void) XmlDomAddTextElem(xctx, ret, trav_uri,
                              "p:arriving", "New York");
    (void) XmlDomAddTextElem(xctx, ret, trav_uri,
                              "p:departureDate", "2001-12-20");
    (void) XmlDomAddTextElem(xctx, ret, trav_uri,
                              "p:departureTime", "mid-morning");
    pref = XmlDomCreateElemNS(xctx, msg1, trav_uri, "p:seatPreference");
    (void) XmlDomAppendChild(xctx, ret, pref);
    XmlDomAppendChild(xctx, itin, ret);
 
    /* Lodging */
    lodging = XmlSoapAddBodyElement(ctx, msg1, "q:lodging", hotel_uri, &amp;xerr);
    (void) XmlDomAddTextElem(xctx, lodging, hotel_uri,
                              "q:preference", "none");
 
#ifdef DEBUG
    /* dump the message in debug mode */
    printf("Message:\n");  
    XmlSaveDom(xctx, &amp;xerr, msg1, "stdio", stdout, "indent_step", 1, NULL);
#endif

/* END OF EXAMPLE 1 */

    /* create connection */
    url = MY_URL;
    if (!(con = XmlSoapCreateConnection(ctx, &amp;xerr, XMLSOAP_BIND_HTTP,
          url, NULL, 0, NULL, 0,
          "XTest: baz", NULL)))
      {
        printf("Failed to create SOAP connection, error %u\n", (unsigned) xerr);
        return xerr;
    }
 
    reply = XmlSoapCall(ctx, con, msg1, &amp;xerr);
    XmlSoapDestroyConnection(ctx, con);
 
    if (!reply)
    {
      printf("Call failed, no message returned.\n");
      return xerr;
    }
 
#ifdef DEBUG
    printf("Reply:\n");  
    XmlSaveDom(xctx, &amp;xerr, reply, "stdio", stdout, NULL);
#endif    
 
     printf("\n==== Header:\n ");    
    header = XmlSoapGetHeader(ctx, reply, &amp;xerr);
    if (!header)
    {
        printf("NULL\n");
    }
    else
        XmlSaveDom(xctx, &amp;xerr, header, "stdio", stdout, NULL);
    
 
   /* check for fault */
    has_fault = XmlSoapHasFault(ctx, reply, &amp;xerr);
    if(has_fault)
    {
        lang = NULL;
        xerr = XmlSoapGetFault(ctx, reply, &amp;code, &amp;reason, &amp;lang,
                               &amp;node, &amp;role, &amp;detail);
        if (xerr)
        {
            printf("error getting Fault %d\n", xerr);
            return EX_FAIL;
        }
         if(code)
            printf("   Code -- %s\n", code);
        else
            printf("   NO Code\n");
        if(reason)
            printf("   Reason -- %s\n", reason);
        else
            printf("   NO Reason\n");
        if(lang)
            printf("   Lang -- %s\n", lang);
        else
            printf("   NO Lang\n");
        if(node)
            printf("   Node -- %s\n", node);
        else
            printf("   NO Node\n");
        if(role)                
            printf("   Role -- %s\n", role);
        else
            printf("   NO Role\n");
        if(detail)
        {
            printf("   Detail\n");
            XmlSaveDom(xctx, &amp;xerr, detail, "stdio", stdout, NULL);
            printf("\n");
        }
        else
            printf("   NO Detail\n");
       
    }
    else
    {
        body = XmlSoapGetBody(ctx, reply, &amp;xerr);
        printf("==== Body:\n ");
        if (!body)
        {
            printf("NULL\n");
            return EX_FAIL;
        }
        XmlSaveDom(xctx, &amp;xerr, body, "stdio", stdout, NULL);
    }
    (void) XmlSoapDestroyMsg(ctx, reply);
    (void) XmlSoapDestroyMsg(ctx, msg1);
    (void) XmlSoapDestroyCtx(ctx);
    XmlDestroy(xctx);
}</code></pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="ADXDK19868"></a><a id="ADXDK19869"></a><a id="ADXDK19867"></a><div class="props_rev_3"><a id="GUID-6313E920-EAE2-43AF-AB90-866CA58A100C" name="GUID-6313E920-EAE2-43AF-AB90-866CA58A100C"></a><h3 id="ADXDK-GUID-6313E920-EAE2-43AF-AB90-866CA58A100C" class="sect3">SOAP Example 2: A Response Asking for Clarification</h3>
               <div>
                  <p>A travel company wants to know which New York airport a traveller, John Smith, will depart from: JFK, EWR, or LGA. It sends a response message that asks for such clarification.</p>
                  <p>To send this XML document as a SOAP message, substitute this code block for the lines beginning with <code class="codeph">/* EXAMPLE 1 */</code> and ending with <code class="codeph">/* END OF EXAMPLE 1 */</code> in <a href="using-SOAP-with-XDK.html#GUID-38829ADC-8292-419D-876E-4C0BB7019CA2__BABEGEGD">Example 9-5</a></p>
                  <div class="example" id="GUID-6313E920-EAE2-43AF-AB90-866CA58A100C__GUID-77BBA2A6-3005-4837-B9C1-9483C7AF7D1F">
                     <p class="titleinexample">Example 9-6 Example 2 SOAP Message</p><pre class="pre codeblock"><code>&lt;?xml version='1.0' ?&gt;
&lt;env:Envelope xmlns:env="http://www.w3.org/2003/05/soap-envelope"&gt; 
 &lt;env:Header&gt;
  &lt;m:reservation xmlns:m="http://travelcompany.example.org/reservation" 
      env:role="http://www.w3.org/2003/05/soap-envelope/role/next"
           env:mustUnderstand="true"&gt;
   &lt;m:reference&gt;uuid:093a2da1-q345-739r-ba5d-pqff98fe8j7d&lt;/m:reference&gt;
   &lt;m:dateAndTime&gt;2001-11-29T13:35:00.000-05:00&lt;/m:dateAndTime&gt;
  &lt;/m:reservation&gt;
  &lt;n:passenger xmlns:n="http://mycompany.example.com/employees"
      env:role="http://www.w3.org/2003/05/soap-envelope/role/next"
           env:mustUnderstand="true"&gt;
   &lt;n:name&gt;John Smith&lt;/n:name&gt;
  &lt;/n:passenger&gt;
 &lt;/env:Header&gt;
 &lt;env:Body&gt;
  &lt;p:itineraryClarification 
    xmlns:p="http://travelcompany.example.org/reservation/travel"&gt;
   &lt;p:departure&gt;
     &lt;p:departing&gt;
       &lt;p:airportChoices&gt;
          JFK LGA EWR 
       &lt;/p:airportChoices&gt;
     &lt;/p:departing&gt;
   &lt;/p:departure&gt;
   &lt;p:return&gt;
     &lt;p:arriving&gt;
       &lt;p:airportChoices&gt;
         JFK LGA EWR 
       &lt;/p:airportChoices&gt;
     &lt;/p:arriving&gt;
   &lt;/p:return&gt;  
  &lt;/p:itineraryClarification&gt;
 &lt;/env:Body&gt;
&lt;/env:Envelope&gt;
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-6313E920-EAE2-43AF-AB90-866CA58A100C__GUID-B665E6E0-8400-4647-B2EC-A1630E655CB8">
                     <p class="titleinexample">Example 9-7 Example 2 SOAP C Client</p><pre class="pre codeblock"><code>#define XMLSOAP_MAX_NAME        1024
 
/* we need this function for examples 2 and 3 */
static xmlerr add_ns_decl(xmlsoapctx  *ctx, xmlctx *xctx, xmlelemnode *elem,
                          oratext *pfx, oratext *uri)
{
    oratext     *aq, aqbuf[XMLSOAP_MAX_NAME];
    xmldocnode  *doc;
    oratext     *xmlns = "xmlns:";
    
    /* if no room for "xmlns:usersprefix\0" then fail now */
    if ((strlen((char *)pfx) + strlen((char *)xmlns)) &gt;
        sizeof(aqbuf))
        return EX_FAIL;
    (void) strcpy((char *)aqbuf, (char *)xmlns);
    strcat((char *)aqbuf, (char *)pfx);
    doc = XmlDomGetOwnerDocument(xctx, elem);
    aq = XmlDomSaveString(xctx, doc, aqbuf);
    XmlDomSetAttrNS(xctx, elem, uri, aq, uri);
    return XMLERR_OK;
}
 
    /* EXAMPLE 2 */
    /* construct message */
    if (!(msg2 = XmlSoapCreateMsg(ctx, &amp;xerr)))
    {
         printf("Failed to create SOAP message, error %u\n", (unsigned) xerr);
         return xerr;
    }
    res = XmlSoapAddHeaderElement(ctx, msg2, "m:reservation", mres_uri, &amp;xerr);
    xerr = XmlSoapSetRole(ctx, res, XMLSOAP_ROLE_NEXT);
    xerr = XmlSoapSetMustUnderstand(ctx, res, TRUE);
    (void) XmlDomAddTextElem(xctx, res, mres_uri, "m:reference",
                 "uuid:093a2da1-q345-739r-ba5d-pqff98fe8j7d");
    (void) XmlDomAddTextElem(xctx, res, mres_uri, "m:dateAndTime",
                               "2001-11-29T13:35:00.000-05:00");
    pas = XmlSoapAddHeaderElement(ctx, msg2, "n:passenger", npas_uri, &amp;xerr);
    xerr = XmlSoapSetRole(ctx, pas, XMLSOAP_ROLE_NEXT);
    xerr = XmlSoapSetMustUnderstand(ctx, pas, TRUE);
    (void) XmlDomAddTextElem(xctx, pas, npas_uri, "n:name",
                              "John Smith");
    /* Fill body */
    /* Itinerary */
    itin = XmlSoapAddBodyElement(ctx, msg2, "p:itineraryClarification",
                                 trav_uri, &amp;xerr);
    /* Departure */
    departure = XmlDomCreateElemNS(xctx, msg2,  trav_uri, "p:departure");
    departing = XmlDomCreateElem(xctx, msg2,  "p:departing");
    (void) XmlDomAddTextElem(xctx, departing, trav_uri,
                              "p:airportChoices", "JFK LGA EWR");
    (void) XmlDomAppendChild(xctx, departure, departing);
    XmlDomAppendChild(xctx, itin, departure);
 
    /* Return */
    ret = XmlDomCreateElemNS(xctx, msg2,  trav_uri, "p:return");
    arriving = XmlDomCreateElemNS(xctx, msg2,  trav_uri, "p:arriving");
    (void) XmlDomAddTextElem(xctx, arriving, trav_uri,
                              "p:airportChoices", "JFK LGA EWR");
    XmlDomAppendChild(xctx, ret, arriving);
    XmlDomAppendChild(xctx, itin, ret);
 
#ifdef DEBUG
    XmlSaveDom(xctx, &amp;xerr, msg2, "stdio", stdout, "indent_step", 1, NULL);
#endif</code></pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="ADXDK19871"></a><a id="ADXDK19872"></a><a id="ADXDK19870"></a><div class="props_rev_3"><a id="GUID-C850D49A-2E4F-4F4A-BED4-5B6E3CF7D130" name="GUID-C850D49A-2E4F-4F4A-BED4-5B6E3CF7D130"></a><h3 id="ADXDK-GUID-C850D49A-2E4F-4F4A-BED4-5B6E3CF7D130" class="sect3">SOAP Example 3: Using POST</h3>
               <div>
                  <p>An example sends credit card information for John Smith as an XML document using  method <code class="codeph">POST</code>. <code class="codeph">XmlSoapCall()</code> writes the HTTP header that precedes the XML message in the example.
                  </p>
                  <p>The C Client includes this code block which is substituted like the second example in <a href="using-SOAP-with-XDK.html#GUID-38829ADC-8292-419D-876E-4C0BB7019CA2__BABEGEGD">Example 9-5</a>:
                  </p>
                  <div class="example" id="GUID-C850D49A-2E4F-4F4A-BED4-5B6E3CF7D130__GUID-58DDA73F-62AB-403A-A4C0-21F992FD6E86">
                     <p class="titleinexample">Example 9-8 Example 3 SOAP Message</p><pre class="pre codeblock"><code>POST /Reservations HTTP/1.0
Host: travelcompany.example.org
Content-Type: application/soap+xml; charset="utf-8"
Content-Length: nnnn

&lt;?xml version='1.0' ?&gt;
&lt;env:Envelope xmlns:env="http://www.w3.org/2003/05/soap-envelope" &gt;
 &lt;env:Header&gt;
   &lt;t:transaction
           xmlns:t="http://thirdparty.example.org/transaction"
           env:encodingStyle="http://example.com/encoding"
           env:mustUnderstand="true" &gt;5&lt;/t:transaction&gt;
 &lt;/env:Header&gt;  
 &lt;env:Body&gt;
  &lt;m:chargeReservation 
      env:encodingStyle="http://www.w3.org/2003/05/soap-encoding"
         xmlns:m="http://travelcompany.example.org/"&gt;
   &lt;m:reservation xmlns:m="http://travelcompany.example.org/reservation"&gt;
    &lt;m:code&gt;FT35ZBQ&lt;/m:code&gt;
   &lt;/m:reservation&gt;   
   &lt;o:creditCard xmlns:o="http://mycompany.example.com/financial"&gt;
    &lt;n:name xmlns:n="http://mycompany.example.com/employees"&gt;
           John Smith
    &lt;/n:name&gt;     
    &lt;o:number&gt;123456789099999&lt;/o:number&gt;
    &lt;o:expiration&gt;2005-02&lt;/o:expiration&gt;
   &lt;/o:creditCard&gt;
  &lt;/m:chargeReservation&gt;
 &lt;/env:Body&gt;
&lt;/env:Envelope&gt;
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-C850D49A-2E4F-4F4A-BED4-5B6E3CF7D130__GUID-09E4AA70-22BF-473A-AA7F-83743438E9E4">
                     <p class="titleinexample">Example 9-9 Example 3 SOAP C Client</p><pre class="pre codeblock"><code>#define XMLSOAP_MAX_NAME        1024
 
/* we need this function for examples 2 and 3 */
static xmlerr add_ns_decl(xmlsoapctx  *ctx, xmlctx *xctx, xmlelemnode *elem,
                          oratext *pfx, oratext *uri)
{
    oratext     *aq, aqbuf[XMLSOAP_MAX_NAME];
    xmldocnode  *doc;
    oratext     *xmlns = "xmlns:";
    
    /* if no room for "xmlns:usersprefix\0" then fail now */
    if ((strlen((char *)pfx) + strlen((char *)xmlns)) &gt;
        sizeof(aqbuf))
        return EX_FAIL;
    (void) strcpy((char *)aqbuf, (char *)xmlns);
    strcat((char *)aqbuf, (char *)pfx);
    doc = XmlDomGetOwnerDocument(xctx, elem);
    aq = XmlDomSaveString(xctx, doc, aqbuf);
    XmlDomSetAttrNS(xctx, elem, uri, aq, uri);
    return XMLERR_OK;
}
 
    /* EXAMPLE 3 */
    if (!(msg3 = XmlSoapCreateMsg(ctx, &amp;xerr)))
    {
        printf("Failed to create SOAP message, error %u\n", (unsigned) xerr);
        return xerr;
    }
    trans = XmlSoapAddHeaderElement(ctx,msg3, "t:transaction", tparty_uri, &amp;xerr);
    xerr = XmlSoapSetMustUnderstand(ctx, trans, TRUE);
    XmlDomSetAttr(xctx, trans, estyle, estyle_uri);
    text = XmlDomCreateText(xctx, msg3, "5");
    XmlDomAppendChild(xctx, trans, text);
    
    /* Fill body */
    /* Charge Reservation */
    charge = XmlSoapAddBodyElement(ctx,msg3,"m:chargeReservation",comp_uri,&amp;xerr);
    XmlDomSetAttr(xctx, charge, estyle, soap_style_uri);
    res = XmlDomCreateElemNS(xctx, msg3, mres_uri,  "m:reservation");
    if (add_ns_decl(ctx, xctx, res, "m", mres_uri))
        return EX_FAIL; 
    (void) XmlDomAddTextElem(xctx, res, mres_uri,
                              "m:code", "FT35ZBQ");
    (void) XmlDomAppendChild(xctx, charge, res);
 
    /* create card elem with  namespace */
    card = XmlDomCreateElemNS(xctx, msg3, finance_uri, "o:creditCard");
    if (add_ns_decl(ctx, xctx, card, "o", finance_uri))
        return EX_FAIL; 
    name =  XmlDomAddTextElem(xctx, card, npas_uri,
                              "n:name", "John Smith");
    /* add namespace */
    if (add_ns_decl(ctx, xctx, name, "n", npas_uri))
        return EX_FAIL; 
    (void)  XmlDomAddTextElem(xctx, card, finance_uri,
                              "o:number", "123456789099999");
    (void) XmlDomAddTextElem(xctx, card, finance_uri,
                              "o:expiration", "2005-02");
    (void) XmlDomAppendChild(xctx, charge, card);
 
#ifdef DEBUG
    XmlSaveDom(xctx, &amp;xerr, msg3, "stdio", stdout, "indent_step", 1, NULL);
#endif
</code></pre></div>
                  <!-- class="example" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>