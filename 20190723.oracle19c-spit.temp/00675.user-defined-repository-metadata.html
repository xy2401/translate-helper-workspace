<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="You can create your own metadata to associate with XML data stored in Oracle XML&nbsp;DB Repository.">
      <meta name="description" content="You can create your own metadata to associate with XML data stored in Oracle XML&nbsp;DB Repository.">
      <title>User-Defined Repository Metadata</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Developer's Guide ">
      <meta property="og:description" content="You can create your own metadata to associate with XML data stored in Oracle XML&nbsp;DB Repository.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="xml-db-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-03-30T12:32:42-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="2002, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96222-03">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="repository-access-using-protocols.html" title="Previous" type="text/html">
      <link rel="next" href="XML-DB-repository-events.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="XML DB Developer's Guide">
    <meta name="dcterms.isVersionOf" content="ADXDB">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="repository-access-using-protocols.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="XML-DB-repository-events.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Developer's Guide </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="XML-DB-repository.html" property="item" typeof="WebPage"><span property="name"> Oracle XML&nbsp;DB Repository</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> User-Defined Repository Metadata</li>
            </ol>
            <a id="GUID-74BCC51E-2E7C-4DB6-8DCF-F65122FE132E" name="GUID-74BCC51E-2E7C-4DB6-8DCF-F65122FE132E"></a><a id="ADXDB2560"></a>
            
            <h2 id="ADXDB-GUID-74BCC51E-2E7C-4DB6-8DCF-F65122FE132E" class="sect2"><span class="enumeration_chapter">29 </span> User-Defined Repository Metadata
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>You can create your own metadata to associate with XML data stored in Oracle XML&nbsp;DB Repository.</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="user-defined-repository-metadata.html#GUID-812175D3-2558-4A84-A038-DF8FD932B7E6">Overview of Metadata and XML</a><br>Data that you use is often associated with additional information that is not part of the content. To process it in different ways, you can use such <strong class="term">metadata</strong> to group or classify data. 
                  </li>
                  <li class="ulchildlink"><a href="user-defined-repository-metadata.html#GUID-D299AF6E-5A5B-4757-B424-B558D0B5B227">Using XML Schemas to Define Resource Metadata</a><br>Before you can add user metadata to photo resources, you must define the structure of such metadata using XML Schema. An XML schema is created and registered for each kind (technique, category) of photo resource metadata.
                  </li>
                  <li class="ulchildlink"><a href="user-defined-repository-metadata.html#GUID-351751BE-25B8-4F4A-9706-5D54A1D93D4C">Addition, Modification, and Deletion of Resource Metadata</a><br>You can add, update, and delete user-defined resource metadata using PL/SQL procedures in package <code class="codeph">DBMS_XDB_REPOS</code>, SQL DML statements <code class="codeph">INSERT</code>, <code class="codeph">UPDATE</code>, and <code class="codeph">DELETE</code>, or WebDAV protocol method <code class="codeph">PROPPATCH</code>.
                  </li>
                  <li class="ulchildlink"><a href="user-defined-repository-metadata.html#GUID-71218C70-98BE-4336-A63D-129A1B4BD30A">Querying XML Schema-Based Resource Metadata</a><br>You can use metadata column <code class="codeph">RESID</code> when querying resource metadata, to join the metadata with the associated data.
                  </li>
                  <li class="ulchildlink"><a href="user-defined-repository-metadata.html#GUID-BB7CA0E0-E4A8-496C-BECF-46150BF27865">XML Image Metadata from Binary Image Metadata</a><br>Digital cameras include image metadata as part of the image files they produce. 
                  </li>
                  <li class="ulchildlink"><a href="user-defined-repository-metadata.html#GUID-9D74E515-7FB4-4FE4-B503-3F920AF3071C">Adding Non-Schema-Based Resource Metadata</a><br>You store user-defined resource metadata that is <span class="italic">not</span> XML Schema-based as a <code class="codeph">CLOB</code> instance under the <code class="codeph">Resource</code> element of the associated resource. 
                  </li>
                  <li class="ulchildlink"><a href="user-defined-repository-metadata.html#GUID-C224ED8C-338C-41D5-B714-4B9D403E600E">PL/SQL Procedures Affecting Resource Metadata</a><br>You can use PL/SQL procedures <code class="codeph">DBMS_XMLSCHEMA.registerSchema</code>, <code class="codeph">DBMS_XDBZ.enable_hierarchy</code>, <code class="codeph">DBMS_XDBZ.disable_hierarchy</code>, <code class="codeph">DBMS_XDBZ.is_hierarchy_enabled</code>, <code class="codeph">DBMS_XDB_REPOS.appendResourceMetadata</code>, <code class="codeph">DBMS_XDB_REPOS.deleteResourceMetadata</code>, <code class="codeph">DBMS_XDB_REPOS.purgeResourceMetadata</code>, and <code class="codeph">DBMS_XDB_REPOS.updateResourceMetadata</code> to perform resource metadata operations.
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>Parent topic:</strong> <a href="XML-DB-repository.html#GUID-840EBE35-8FC8-4150-9FC8-78442FD1B12B" title="Oracle XML&nbsp;DB Repository lets you version your data, implement and manage security, and use APIs to access and manipulate repository resources.">Oracle XML&nbsp;DB Repository</a></p>
                  </div>
               </div>
            </div>
            <a id="ADXDB5569"></a><div class="props_rev_3"><a id="GUID-812175D3-2558-4A84-A038-DF8FD932B7E6" name="GUID-812175D3-2558-4A84-A038-DF8FD932B7E6"></a><h3 id="ADXDB-GUID-812175D3-2558-4A84-A038-DF8FD932B7E6" class="sect3"><span class="enumeration_section">29.1 </span>Overview of Metadata and XML
               </h3>
               <div>
                  <p>Data that you use is often associated with additional information that is not part of the content. To process it in different ways, you can use such <strong class="term">metadata</strong> to group or classify data. 
                  </p>
                  <p>For example, you might have a collection of digital photographs, and you might associate metadata with each picture, such as information about the photographic characteristics (color composition, focal length) or context (location, kind of subject: landscape, people).</p>
                  <p>An Oracle XML&nbsp;DB repository <strong class="term">resource</strong> is an XML document that contains both metadata and data. The data is the contents of element <code class="codeph">Contents</code>. All other elements in the resource contain metadata. The data of a resource can be XML, but it need not be.
                  </p>
                  <p>You can associate resources in the Oracle XML&nbsp;DB repository with metadata that you define. In addition to such <span class="italic">user-defined metadata</span>, each repository resource also has associated metadata that Oracle XML&nbsp;DB creates automatically and uses (transparently) to manage the resource. Such <span class="italic">system-defined metadata</span> includes properties such as the owner and creation date of each resource.
                  </p>
                  <p>Except for system-defined metadata, you decide which resource information should be treated as data and which should be treated as metadata. For a photo resource, supplemental information about the photo is normally not considered to be part of the photo data, which is a binary image. For text, however, you sometimes have a choice of whether to include particular information in the resource contents (data) or keep it separate and associate it with the contents as metadata — that choice is often influenced by the applications that use or produce the data.</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="user-defined-repository-metadata.html#GUID-A8AB40C5-A1ED-4FC5-8377-01EEA7A4E8FC">Kinds of Metadata &#x2013; Uses of the Term</a><br>The term "metadata" is used in the context of XML in various ways, including XML Schema definitions, XML tags, and Oracle XML&nbsp;DB Repository resource information that supplements the resource content.
                     </li>
                     <li class="ulchildlink"><a href="user-defined-repository-metadata.html#GUID-CAE23F8E-CF58-429A-BF69-21B5F49C5E98">User-Defined Resource Metadata</a><br><span class="italic">User-defined resource metadata</span> is itself <span class="italic">represented as XML</span>: it is XML data that is associated with other XML data, describing it or providing supplementary, related information. 
                     </li>
                     <li class="ulchildlink"><a href="user-defined-repository-metadata.html#GUID-24ED504A-B966-422A-8A8C-9CD94C85C8BA">Scenario: Metadata for a Photo Collection</a><br>A scenario used to illustrate the use of schema-based resource metadata uses metadata associated with photographic image files that are stored in repository resources. You can create any number of different kinds of metadata to be associated with the same resource. 
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="user-defined-repository-metadata.html#GUID-74BCC51E-2E7C-4DB6-8DCF-F65122FE132E" title="You can create your own metadata to associate with XML data stored in Oracle XML&nbsp;DB Repository.">User-Defined Repository Metadata</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADXDB5570"></a><div class="props_rev_3"><a id="GUID-A8AB40C5-A1ED-4FC5-8377-01EEA7A4E8FC" name="GUID-A8AB40C5-A1ED-4FC5-8377-01EEA7A4E8FC"></a><h4 id="ADXDB-GUID-A8AB40C5-A1ED-4FC5-8377-01EEA7A4E8FC" class="sect4"><span class="enumeration_section">29.1.1 </span>Kinds of Metadata &#x2013; Uses of the Term
                  </h4>
                  <div>
                     <p>The term "metadata" is used in the context of XML in various ways, including XML Schema definitions, XML tags, and Oracle XML&nbsp;DB Repository resource information that supplements the resource content.</p>
                     <p>In addition to resource metadata (system-defined and user-defined), the term "metadata" is sometimes used to refer to the following:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>An XML <span class="italic">schema</span> is metadata that describes a class of XML documents.
                           </p>
                        </li>
                        <li>
                           <p>An XML <span class="italic">tag</span> (element or attribute name) is metadata that is used to label and organize the element content or attribute value.
                           </p>
                        </li>
                     </ul>
                     <p>You can associate metadata with an XML document that is the content of a repository resource in any of these ways:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>You can add additional XML elements containing the metadata information to the resource <span class="italic">contents</span>. For example, you could wrap digital image data in an XML document that also includes elements describing the photo. In this case, the data and its metadata are associated by being in the contents of the same resource. It is up to applications to separate the two and relate them correctly.
                           </p>
                        </li>
                        <li>
                           <p>You can add metadata information for a particular resource to the repository as the contents of a <span class="italic">separate resource</span>. In this case, it is up to applications to treat this resource as metadata and associate it with the data.
                           </p>
                        </li>
                        <li>
                           <p>You can add metadata information for a resource as repository <span class="italic">resource metadata</span>. In this case, Oracle XML&nbsp;DB recognizes the metadata as such. Applications can <span class="italic">discover</span> this metadata by querying the repository for it. They need not be informed separately of its existence and its association with the data.
                           </p>
                        </li>
                     </ul>
                     <div class="section"></div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="accessing-XML-DB-repository-data.html#GUID-950100D2-51D0-490F-B82A-A0C45BCCE8AD" title="Oracle XML&nbsp;DB Repository resources conform to the Oracle XML&nbsp;DB XML schema XDBResource.xsd. The elements in a resource include those needed to persistently store WebDAV-defined properties, such as creation date, modification date, WebDAV locks, owner, ACL, language, and character set.">Oracle XML&nbsp;DB Repository Resources</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="user-defined-repository-metadata.html#GUID-812175D3-2558-4A84-A038-DF8FD932B7E6" title="Data that you use is often associated with additional information that is not part of the content. To process it in different ways, you can use such metadata to group or classify data.">Overview of Metadata and XML</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADXDB5571"></a><div class="props_rev_3"><a id="GUID-CAE23F8E-CF58-429A-BF69-21B5F49C5E98" name="GUID-CAE23F8E-CF58-429A-BF69-21B5F49C5E98"></a><h4 id="ADXDB-GUID-CAE23F8E-CF58-429A-BF69-21B5F49C5E98" class="sect4"><span class="enumeration_section">29.1.2 </span>User-Defined Resource Metadata
                  </h4>
                  <div>
                     <p><span class="italic">User-defined resource metadata</span> is itself <span class="italic">represented as XML</span>: it is XML data that is associated with other XML data, describing it or providing supplementary, related information. 
                     </p>
                     <p>User-defined metadata for resources can be either XML schema-based or not:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Resource metadata that is <span class="italic">schema-based</span> is stored in separate (out-of-line) tables. These are related to the resource table by the resource OID, which is stored in the hidden object column <code class="codeph">RESID</code> of the metadata tables. 
                           </p>
                        </li>
                        <li>
                           <p>Resource metadata that is <span class="italic">not</span> schema-based is stored as part of the resource document in the resource table, <code class="codeph">XDB.XDB$RESOURCE</code>.
                           </p>
                        </li>
                     </ul>
                     <p>You can take advantage of schema-based metadata, in particular, to perform efficient queries and DML operations on resources. In this chapter, you learn how to perform the following tasks involving schema-based resource metadata:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Create and register an <span class="italic">XML schema</span> that defines the metadata for a particular kind of resource.
                           </p>
                        </li>
                        <li>
                           <p><span class="italic">Add</span> metadata to a repository resource, and <span class="italic">update</span> (modify) such metadata.
                           </p>
                        </li>
                        <li>
                           <p><span class="italic">Query</span> resource metadata to find associated content.
                           </p>
                        </li>
                        <li>
                           <p><span class="italic">Delete</span> specific metadata associated with a resource and <span class="italic">purge</span> all metadata associated with a resource.
                           </p>
                        </li>
                     </ul>
                     <p>In addition, you learn how to add non-schema-based metadata to a resource.</p>
                     <p>You can generally use user-defined resource metadata just as you would use resource data. In particular, versioning and access control management apply.</p>
                     <p>Typical uses of resource metadata include workflow applications, enforcing user rights management, tracking resource ownership, and controlling resource validity dates.</p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="user-defined-repository-metadata.html#GUID-812175D3-2558-4A84-A038-DF8FD932B7E6" title="Data that you use is often associated with additional information that is not part of the content. To process it in different ways, you can use such metadata to group or classify data.">Overview of Metadata and XML</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADXDB5572"></a><div class="props_rev_3"><a id="GUID-24ED504A-B966-422A-8A8C-9CD94C85C8BA" name="GUID-24ED504A-B966-422A-8A8C-9CD94C85C8BA"></a><h4 id="ADXDB-GUID-24ED504A-B966-422A-8A8C-9CD94C85C8BA" class="sect4"><span class="enumeration_section">29.1.3 </span>Scenario: Metadata for a Photo Collection
                  </h4>
                  <div>
                     <p>A scenario used to illustrate the use of schema-based resource metadata uses metadata associated with photographic image files that are stored in repository resources. You can create any number of different kinds of metadata to be associated with the same resource. </p>
                     <p>For image files, examples create metadata for information about both 1) the technical aspects of a photo and 2) the photo subject or the uses to which a photo might be put. These two kinds of associated metadata are used to query photo resources.</p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="user-defined-repository-metadata.html#GUID-812175D3-2558-4A84-A038-DF8FD932B7E6" title="Data that you use is often associated with additional information that is not part of the content. To process it in different ways, you can use such metadata to group or classify data.">Overview of Metadata and XML</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="ADXDB5574"></a><a id="ADXDB5575"></a><a id="ADXDB5573"></a><div class="props_rev_3"><a id="GUID-D299AF6E-5A5B-4757-B424-B558D0B5B227" name="GUID-D299AF6E-5A5B-4757-B424-B558D0B5B227"></a><h3 id="ADXDB-GUID-D299AF6E-5A5B-4757-B424-B558D0B5B227" class="sect3"><span class="enumeration_section">29.2 </span>Using XML Schemas to Define Resource Metadata
               </h3>
               <div>
                  <p>Before you can add user metadata to photo resources, you must define the structure of such metadata using XML Schema. An XML schema is created and registered for each kind (technique, category) of photo resource metadata.</p>
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-D299AF6E-5A5B-4757-B424-B558D0B5B227__GUID-8BB4B7B5-9538-46CE-908D-16AC79E09828">
                        <p class="notep1">See Also:</p>
                        <p><a href="user-defined-repository-metadata.html#GUID-24ED504A-B966-422A-8A8C-9CD94C85C8BA" title="A scenario used to illustrate the use of schema-based resource metadata uses metadata associated with photographic image files that are stored in repository resources. You can create any number of different kinds of metadata to be associated with the same resource.">Scenario: Metadata for a Photo Collection</a> for general information about the example user-defined metadata scenario
                        </p>
                     </div>
                     <p>The XML schema in <a href="user-defined-repository-metadata.html#GUID-D299AF6E-5A5B-4757-B424-B558D0B5B227__BABCEEAA">Example 29-1</a> defines metadata used to describe the technical aspects of a photo image file. It uses PL/SQL procedure <code class="codeph">DBMS_XMLSCHEMA.registerSchema</code> to register the XML schema. To identify this schema as defining repository resource <span class="italic">metadata</span>, it uses <code class="codeph">ENABLE_HIERARCHY_RESMETADATA</code> as the value for parameter <code class="codeph">enableHierarchy</code>. Resource contents (data) are defined by using value <code class="codeph">ENABLE_HIERARCHY_CONTENTS</code> (the default value), instead.
                     </p>
                     <p>The properties defined in <a href="user-defined-repository-metadata.html#GUID-D299AF6E-5A5B-4757-B424-B558D0B5B227__BABCEEAA">Example 29-1</a> are the image height, width, color depth, title, and brief description.
                     </p>
                     <p>The XML schema in <a href="user-defined-repository-metadata.html#GUID-D299AF6E-5A5B-4757-B424-B558D0B5B227__BABHHHFC">Example 29-2</a> defines metadata used to categorize a photo image file: to describe its content or possible uses. This simple example defines a single, general property for classification, named <code class="codeph">Category</code>.
                     </p>
                     <p>Notice that there is nothing in the XML schema definitions of metadata that restrict that information to being associated with any particular kind of data. You are free to associate any type of metadata with any type of resource. And multiple types of metadata can be associated with the same resource.</p>
                     <p>Notice, too, that the XML schema does not, by itself, define its associated data as being metadata — it is the schema <span class="italic">registration</span> that makes this characterization, through <code class="codeph">enableHierarchy</code> value <code class="codeph">ENABLE_HIERARCHY_RESMETADATA</code>. If the same schema were registered instead with <code class="codeph">enableHierarchy</code> value <code class="codeph">ENABLE_HIERARCHY_CONTENTS</code> (the default value), then it would define not metadata for resources, but resource <span class="italic">contents</span> with the same information. The same XML schema cannot be registered more than once under the same name. 
                     </p>
                     <div class="infoboxnote" id="GUID-D299AF6E-5A5B-4757-B424-B558D0B5B227__GUID-2773A2E9-886B-4425-BB59-567D29899CE6">
                        <p class="notep1">Note:</p>
                        <p>By default, user metadata is stored object-relationally if it is XML schema-based and as a <code class="codeph">CLOB</code> instance if non XML schema-based. You can store either as binary XML instead, by setting the <code class="codeph">OPTIONS</code> parameter for XML schema registration to <code class="codeph">REGISTER_BINARYXML</code>.
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-D299AF6E-5A5B-4757-B424-B558D0B5B227__BABCEEAA">
                     <p class="titleinexample">Example 29-1 Registering an XML Schema for Technical Photo Information</p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_XMLSCHEMA.registerSchema(
    SCHEMAURL       =&gt; '<span class="bold">imagetechnique.xsd</span>',
    SCHEMADOC       =&gt; '&lt;xsd:schema targetNamespace="inamespace"
                                    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
                                    xmlns:xdb="http://xmlns.oracle.com/xdb"
                                    xmlns="inamespace"&gt;
                          &lt;xsd:element name="<span class="bold">ImgTechMetadata</span>"
                                       xdb:defaultTable="<span class="bold">IMGTECHMETADATATABLE</span>"&gt;
                            &lt;xsd:complexType&gt;
                              &lt;xsd:sequence&gt;
                                &lt;xsd:element name="<span class="bold">Height</span>"      type="xsd:float"/&gt;
                                &lt;xsd:element name="<span class="bold">Width</span>"       type="xsd:float"/&gt;
                                &lt;xsd:element name="<span class="bold">ColorDepth</span>"  type="xsd:integer"/&gt;
                                &lt;xsd:element name="<span class="bold">Title</span>"       type="xsd:string"/&gt;
                                &lt;xsd:element name="<span class="bold">Description</span>" type="xsd:string"/&gt;
                              &lt;/xsd:sequence&gt;
                            &lt;/xsd:complexType&gt;
                          &lt;/xsd:element&gt;
                        &lt;/xsd:schema&gt;',
    enableHierarchy =&gt; DBMS_XMLSCHEMA.<span class="bold">ENABLE_HIERARCHY_RESMETADATA</span>);
END;
/</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-D299AF6E-5A5B-4757-B424-B558D0B5B227__BABHHHFC">
                     <p class="titleinexample">Example 29-2 Registering an XML Schema for Photo Categorization</p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_XMLSCHEMA.registerSchema(
    SCHEMAURL       =&gt; '<span class="bold">imagecategories.xsd</span>',
    SCHEMADOC       =&gt; '&lt;xsd:schema targetNamespace="<span class="bold">cnamespace</span>"
                                    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
                                    xmlns:xdb="http://xmlns.oracle.com/xdb"
                                    xmlns="cnamespace"&gt;
                          &lt;xsd:element name="<span class="bold">ImgCatMetadata</span>"
                                       xdb:defaultTable="<span class="bold">IMGCATMETADATATABLE</span>"&gt;
                            &lt;xsd:complexType&gt;
                              &lt;xsd:sequence&gt;
                                &lt;xsd:element name="<span class="bold">Categories</span>" 
                                             type="CategoriesType"/&gt;
                              &lt;/xsd:sequence&gt;
                            &lt;/xsd:complexType&gt;
                          &lt;/xsd:element&gt;
                          &lt;xsd:complexType name="CategoriesType"&gt;
                            &lt;xsd:sequence&gt;
                              &lt;xsd:element name="<span class="bold">Category</span>" type="xsd:string"
                                           maxOccurs="unbounded"/&gt;
                            &lt;/xsd:sequence&gt;
                          &lt;/xsd:complexType&gt;
                        &lt;/xsd:schema&gt;',
    enableHierarchy =&gt; DBMS_XMLSCHEMA.ENABLE_HIERARCHY_RESMETADATA);
END;
/
</pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="user-defined-repository-metadata.html#GUID-74BCC51E-2E7C-4DB6-8DCF-F65122FE132E" title="You can create your own metadata to associate with XML data stored in Oracle XML&nbsp;DB Repository.">User-Defined Repository Metadata</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB5576"></a><div class="props_rev_3"><a id="GUID-351751BE-25B8-4F4A-9706-5D54A1D93D4C" name="GUID-351751BE-25B8-4F4A-9706-5D54A1D93D4C"></a><h3 id="ADXDB-GUID-351751BE-25B8-4F4A-9706-5D54A1D93D4C" class="sect3"><span class="enumeration_section">29.3 </span>Addition, Modification, and Deletion of Resource Metadata
               </h3>
               <div>
                  <p>You can add, update, and delete user-defined resource metadata using PL/SQL procedures in package <code class="codeph">DBMS_XDB_REPOS</code>, SQL DML statements <code class="codeph">INSERT</code>, <code class="codeph">UPDATE</code>, and <code class="codeph">DELETE</code>, or WebDAV protocol method <code class="codeph">PROPPATCH</code>.
                  </p>
                  <p>You can add, update, and delete user-defined resource metadata in any of the following ways:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Use PL/SQL procedures in package <code class="codeph">DBMS_XDB_REPOS</code>: 
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">appendResourceMetadata</code> &#x2013; add metadata to a resource
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">updateResourceMetadata</code> &#x2013; modify resource metadata
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">deleteResourceMetadata</code> &#x2013; delete specific metadata from a resource
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">purgeResourceMetadata</code> &#x2013; delete <span class="italic">all</span> metadata from a resource
                              </p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>Use SQL DML statements <code class="codeph">INSERT</code>, <code class="codeph">UPDATE</code>, and <code class="codeph">DELETE</code> to update the resource directly
                        </p>
                     </li>
                     <li>
                        <p>Use WebDAV protocol method <code class="codeph">PROPPATCH</code></p>
                     </li>
                  </ul>
                  <p>You use SQL DM statements and WebDAV method <code class="codeph">PROPPATCH</code> to update or delete metadata in the same way as you add metadata. If you supply a complete <code class="codeph">Resource</code> element for one of these operations, then keep in mind that each resource metadata property must be a child (not just a descendant) of element <code class="codeph">Resource</code> — if you want multiple metadata elements of the same kind, you must collect them as children of a single parent metadata element. The order among such top-level user-defined resource metadata properties is unimportant and is not necessarily maintained by Oracle XML&nbsp;DB.
                  </p>
                  <p>The separate PL/SQL procedures in package <code class="codeph">DBMS_XDB_REPOS</code> are similar in their use. Each can be used with either XML schema-based or non-schema-based metadata. Some forms (signatures) of some of the procedures apply only to schema-based metadata. Procedures <code class="codeph">appendResourceMetadata</code> and <code class="codeph">deleteResourceMetadata</code> are illustrated here with examples. 
                  </p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="user-defined-repository-metadata.html#GUID-F2E53FE2-75E7-4CBE-AA66-D5A5176001F0">Adding Metadata Using APPENDRESOURCEMETADATA</a><br>You can use procedure <code class="codeph">DBMS_XDB_REPOS.appendResourceMetadata</code> to add user-defined metadata to resources.
                     </li>
                     <li class="ulchildlink"><a href="user-defined-repository-metadata.html#GUID-15C67AA1-B53C-4B4E-A768-46236D528593">Deleting Metadata Using DELETERESOURCEMETADATA</a><br>You can use procedure <code class="codeph">DBMS_XDB_REPOS.deleteResourceMetadata</code> to delete specific metadata associated with a resource. To delete <span class="italic">all</span> of the metadata associated with a resource, you can use procedure <code class="codeph">DBMS_XDB_REPOS.purgeResourceMetadata</code>.
                     </li>
                     <li class="ulchildlink"><a href="user-defined-repository-metadata.html#GUID-2A4F858D-D2C1-49AC-8A2C-87AA419D9596">Adding Metadata Using SQL DML</a><br>An alternative to using procedure <code class="codeph">DBMS_XDB_REPOS.appendResourceMetadata</code> to add, update, or delete resource metadata is to update the <code class="codeph">RESOURCE_VIEW</code> directly using DML statements <code class="codeph">INSERT</code> and <code class="codeph">UPDATE</code>. 
                     </li>
                     <li class="ulchildlink"><a href="user-defined-repository-metadata.html#GUID-065AB9FE-AC85-4AA3-861E-A97AE739E1FD">Adding Metadata Using WebDAV PROPPATCH</a><br>An alternative to using procedure <code class="codeph">DBMS_XDB_REPOS.appendResourceMetadata</code> to add resource metadata is to use WebDAV method <code class="codeph">PROPPATCH</code>. 
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-351751BE-25B8-4F4A-9706-5D54A1D93D4C__GUID-A393D061-0F6B-4DE9-80B1-E209AA525198">
                     <p class="notep1">See Also:</p>
                     <p><a href="../arpls/DBMS_XDB_REPOS.html#ARPLS74188" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for information about the procedures in PL/SQL package <code class="codeph">DBMS_XDB_REPOS</code></p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="user-defined-repository-metadata.html#GUID-74BCC51E-2E7C-4DB6-8DCF-F65122FE132E" title="You can create your own metadata to associate with XML data stored in Oracle XML&nbsp;DB Repository.">User-Defined Repository Metadata</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADXDB5578"></a><a id="ADXDB5579"></a><a id="ADXDB5577"></a><div class="props_rev_3"><a id="GUID-F2E53FE2-75E7-4CBE-AA66-D5A5176001F0" name="GUID-F2E53FE2-75E7-4CBE-AA66-D5A5176001F0"></a><h4 id="ADXDB-GUID-F2E53FE2-75E7-4CBE-AA66-D5A5176001F0" class="sect4"><span class="enumeration_section">29.3.1 </span>Adding Metadata Using APPENDRESOURCEMETADATA
                  </h4>
                  <div>
                     <p>You can use procedure <code class="codeph">DBMS_XDB_REPOS.appendResourceMetadata</code> to add user-defined metadata to resources.
                     </p>
                     <div class="section">
                        <p><a href="user-defined-repository-metadata.html#GUID-F2E53FE2-75E7-4CBE-AA66-D5A5176001F0__CIACFBID">Example 29-3</a> creates a photo resource and adds XML schema-based metadata of type <code class="codeph">ImgTechMetadata</code> to it, recording the technical information about the photo.
                        </p>
                        <p><a href="user-defined-repository-metadata.html#GUID-F2E53FE2-75E7-4CBE-AA66-D5A5176001F0__CIACDCJD">Example 29-4</a> adds metadata of type <code class="codeph">ImgTechMetadata</code> to the same resource as <a href="user-defined-repository-metadata.html#GUID-F2E53FE2-75E7-4CBE-AA66-D5A5176001F0__CIACFBID">Example 29-3</a>, placing the photo in several user-defined content categories.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-F2E53FE2-75E7-4CBE-AA66-D5A5176001F0__CIACFBID">
                        <p class="titleinexample">Example 29-3 Add Metadata to a Resource &#x2013; Technical Photo Information</p><pre class="oac_no_warn" dir="ltr">DECLARE
  returnbool BOOLEAN;
BEGIN
  returnbool := DBMS_XDB_REPOS.createResource(
                  '/public/horse_with_pig.jpg',
                  bfilename('MYDIR', 'horse_with_pig.jpg'));
  DBMS_XDB_REPOS.<span class="bold">appendResourceMetadata</span>(
    '/public/horse_with_pig.jpg',
    XMLType('&lt;i:<span class="bold">ImgTechMetadata</span>
                 xmlns:i="inamespace"
                 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xsi:schemaLocation="inamespace <span class="bold">imagetechnique.xsd</span>"&gt;
               &lt;Height&gt;1024&lt;/Height&gt;
               &lt;Width&gt;768&lt;/Width&gt;
               &lt;ColorDepth&gt;24&lt;/ColorDepth&gt;
               &lt;Title&gt;Pig Riding Horse&lt;/Title&gt;
               &lt;Description&gt;Picture of a pig riding a horse on the beach,
taken outside hotel window.&lt;/Description&gt;
             &lt;/i:ImgTechMetadata&gt;'));
END;
/
</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-F2E53FE2-75E7-4CBE-AA66-D5A5176001F0__CIACDCJD">
                        <p class="titleinexample">Example 29-4 Add Metadata to a Resource &#x2013; Photo Content Categories</p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_XDB_REPOS.appendResourceMetadata(
    '/public/horse_with_pig.jpg',
    XMLType('&lt;c:<span class="bold">ImgCatMetadata</span>
                 xmlns:c="cnamespace"
                 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xsi:schemaLocation="cnamespace <span class="bold">imagecategories.xsd</span>"&gt;
               &lt;Categories&gt;
                 &lt;Category&gt;Vacation&lt;/Category&gt;
                 &lt;Category&gt;Animals&lt;/Category&gt;
                 &lt;Category&gt;Humor&lt;/Category&gt;
                 &lt;Category&gt;2005&lt;/Category&gt;
               &lt;/Categories&gt;
             &lt;/c:ImgCatMetadata&gt;'));
END;
/

PL/SQL procedure successfully completed.
 
SELECT * FROM imgcatmetadatatable;
 
SYS_NC_ROWINFO$
--------------------------------------------------------------------------------
&lt;c:ImgCatMetadata xmlns:c="cnamespace" xmlns:xsi="http://www.w3.org/2001/XMLSche
ma-instance" xsi:schemaLocation="cnamespace imagecategories.xsd"&gt;
  &lt;Categories&gt;
    &lt;Category&gt;Vacation&lt;/Category&gt;
    &lt;Category&gt;Animals&lt;/Category&gt;
    &lt;Category&gt;Humor&lt;/Category&gt;
    &lt;Category&gt;2005&lt;/Category&gt;
  &lt;/Categories&gt;
&lt;/c:ImgCatMetadata&gt;
 
1 row selected.</pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="user-defined-repository-metadata.html#GUID-351751BE-25B8-4F4A-9706-5D54A1D93D4C" title="You can add, update, and delete user-defined resource metadata using PL/SQL procedures in package DBMS_XDB_REPOS, SQL DML statements INSERT, UPDATE, and DELETE, or WebDAV protocol method PROPPATCH.">Addition, Modification, and Deletion of Resource Metadata</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADXDB5581"></a><a id="ADXDB5580"></a><div class="props_rev_3"><a id="GUID-15C67AA1-B53C-4B4E-A768-46236D528593" name="GUID-15C67AA1-B53C-4B4E-A768-46236D528593"></a><h4 id="ADXDB-GUID-15C67AA1-B53C-4B4E-A768-46236D528593" class="sect4"><span class="enumeration_section">29.3.2 </span>Deleting Metadata Using DELETERESOURCEMETADATA
                  </h4>
                  <div>
                     <p>You can use procedure <code class="codeph">DBMS_XDB_REPOS.deleteResourceMetadata</code> to delete specific metadata associated with a resource. To delete <span class="italic">all</span> of the metadata associated with a resource, you can use procedure <code class="codeph">DBMS_XDB_REPOS.purgeResourceMetadata</code>.
                     </p>
                     <div class="section">
                        <p><a href="user-defined-repository-metadata.html#GUID-15C67AA1-B53C-4B4E-A768-46236D528593__BABEJIGD">Example 29-5</a> deletes the category metadata that was added to the photo resource in <a href="user-defined-repository-metadata.html#GUID-F2E53FE2-75E7-4CBE-AA66-D5A5176001F0__CIACDCJD">Example 29-4</a>. By default, both the resource link (<code class="codeph">REF</code>) to the metadata and the metadata table identified by that link are deleted. An optional parameter can be used to specify that only the link is to be deleted. The metadata table is then left as is but becomes unrelated to the resource. In this example, the default behavior is used.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-15C67AA1-B53C-4B4E-A768-46236D528593__BABEJIGD">
                        <p class="titleinexample">Example 29-5 Delete Specific Metadata from a Resource</p><pre class="pre codeblock"><code>BEGIN
  DBMS_XDB_REPOS.<span class="bold">deleteResourceMetadata</span>('/public/horse_with_pig.jpg',
                                  'cnamespace',
                                  'ImgCatMetadata');
END;
/

PL/SQL procedure successfully completed.
 
SELECT * FROM imgcatmetadatatable;
 
no rows selected</code></pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="user-defined-repository-metadata.html#GUID-351751BE-25B8-4F4A-9706-5D54A1D93D4C" title="You can add, update, and delete user-defined resource metadata using PL/SQL procedures in package DBMS_XDB_REPOS, SQL DML statements INSERT, UPDATE, and DELETE, or WebDAV protocol method PROPPATCH.">Addition, Modification, and Deletion of Resource Metadata</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADXDB5583"></a><a id="ADXDB5582"></a><div class="props_rev_3"><a id="GUID-2A4F858D-D2C1-49AC-8A2C-87AA419D9596" name="GUID-2A4F858D-D2C1-49AC-8A2C-87AA419D9596"></a><h4 id="ADXDB-GUID-2A4F858D-D2C1-49AC-8A2C-87AA419D9596" class="sect4"><span class="enumeration_section">29.3.3 </span>Adding Metadata Using SQL DML
                  </h4>
                  <div>
                     <p>An alternative to using procedure <code class="codeph">DBMS_XDB_REPOS.appendResourceMetadata</code> to add, update, or delete resource metadata is to update the <code class="codeph">RESOURCE_VIEW</code> directly using DML statements <code class="codeph">INSERT</code> and <code class="codeph">UPDATE</code>. 
                     </p>
                     <div class="section">
                        <p>Adding resource metadata in this way is illustrated by <a href="user-defined-repository-metadata.html#GUID-2A4F858D-D2C1-49AC-8A2C-87AA419D9596__CIAGJEDB">Example 29-6</a>. It shows how to accomplish the same thing as <a href="user-defined-repository-metadata.html#GUID-F2E53FE2-75E7-4CBE-AA66-D5A5176001F0__CIACFBID">Example 29-3</a> by inserting the metadata directly into <code class="codeph">RESOURCE_VIEW</code> using SQL statement <code class="codeph">UPDATE</code>. Other SQL DML statements may be used similarly.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-2A4F858D-D2C1-49AC-8A2C-87AA419D9596__CIAGJEDB">
                        <p class="titleinexample">Example 29-6 Adding Metadata to a Resource Using DML with RESOURCE_VIEW</p><pre class="pre codeblock"><code>UPDATE RESOURCE_VIEW
  SET RES =
    XMLQuery('declare namespace r = "http://xmlns.oracle.com/xdb/XDBResource.xsd"; (: :)
              declare namespace c = "cnamespace"; (: :)
              copy $tmp := . modify insert node
               &lt;c:ImgCatMetadata
                   xmlns:c="cnamespace"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="cnamespace imagecategories.xsd"&gt;
                 &lt;Categories&gt;
                   &lt;Category&gt;Vacation&lt;/Category&gt;
                   &lt;Category&gt;Animals&lt;/Category&gt;
                   &lt;Category&gt;Humor&lt;/Category&gt;
                   &lt;Category&gt;2005&lt;/Category&gt;
                 &lt;/Categories&gt;
               &lt;/c:ImgCatMetadata&gt;
              into $tmp/r:Resource
              return $tmp'
             PASSING RES
             RETURNING CONTENT)
    WHERE equals_path(RES, '/public/horse_with_pig.jpg') = 1;
/

SELECT * FROM imgcatmetadatatable;
 
SYS_NC_ROWINFO$
--------------------------------------------------------------------------------
&lt;c:ImgCatMetadata xmlns:c="cnamespace" xmlns:xsi="http://www.w3.org/2001/XMLSche
ma-instance" xsi:schemaLocation="cnamespace imagecategories.xsd"&gt;
  &lt;Categories&gt;
    &lt;Category&gt;Vacation&lt;/Category&gt;
    &lt;Category&gt;Animals&lt;/Category&gt;
    &lt;Category&gt;Humor&lt;/Category&gt;
    &lt;Category&gt;2005&lt;/Category&gt;
  &lt;/Categories&gt;
&lt;/c:ImgCatMetadata&gt;
 
1 row selected.
</code></pre><p>The following query extracts the inserted metadata using <code class="codeph">RESOURCE_VIEW</code>, rather than directly using metadata table <code class="codeph">imgcatmetadatatable</code>. (The result is shown here pretty-printed, for clarity.)
                        </p><pre class="pre codeblock"><code>SELECT XMLQuery('declare namespace r
                   = "http://xmlns.oracle.com/xdb/XDBResource.xsd"; (: :)
                 declare namespace c
                   = "cnamespace"; (: :)
                 /r:Resource/c:ImgCatMetadata'
                PASSING RES RETURNING CONTENT)
  FROM RESOURCE_VIEW
  WHERE equals_path(RES, '/public/horse_with_pig.jpg') = 1;
 
XMLQUERY('DECLARENAMESPACER="HTTP://XMLNS.ORACLE.COM/XDB/XDBRESOURCE.XSD";(::)DE
--------------------------------------------------------------------------------
&lt;c:ImgCatMetadata xmlns:c="cnamespace" 
                  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                  xsi:schemaLocation="cnamespace imagecategories.xsd"&gt;
  &lt;Categories&gt;
    &lt;Category&gt;Vacation&lt;/Category&gt;
    &lt;Category&gt;Animals&lt;/Category&gt;
    &lt;Category&gt;Humor&lt;/Category&gt;
    &lt;Category&gt;2005&lt;/Category&gt;
  &lt;/Categories&gt;
&lt;/c:ImgCatMetadata&gt;
 
1 row selected.</code></pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="user-defined-repository-metadata.html#GUID-351751BE-25B8-4F4A-9706-5D54A1D93D4C" title="You can add, update, and delete user-defined resource metadata using PL/SQL procedures in package DBMS_XDB_REPOS, SQL DML statements INSERT, UPDATE, and DELETE, or WebDAV protocol method PROPPATCH.">Addition, Modification, and Deletion of Resource Metadata</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ADXDB5584"></a><a id="ADXDB2565"></a><div class="props_rev_3"><a id="GUID-065AB9FE-AC85-4AA3-861E-A97AE739E1FD" name="GUID-065AB9FE-AC85-4AA3-861E-A97AE739E1FD"></a><h4 id="ADXDB-GUID-065AB9FE-AC85-4AA3-861E-A97AE739E1FD" class="sect4"><span class="enumeration_section">29.3.4 </span>Adding Metadata Using WebDAV PROPPATCH
                  </h4>
                  <div>
                     <p>An alternative to using procedure <code class="codeph">DBMS_XDB_REPOS.appendResourceMetadata</code> to add resource metadata is to use WebDAV method <code class="codeph">PROPPATCH</code>. 
                     </p>
                     <div class="section">
                        <p>This is illustrated in <a href="user-defined-repository-metadata.html#GUID-065AB9FE-AC85-4AA3-861E-A97AE739E1FD__CIAJIIEF">Example 29-7</a>. You can update and delete metadata similarly.
                        </p>
                        <p><a href="user-defined-repository-metadata.html#GUID-065AB9FE-AC85-4AA3-861E-A97AE739E1FD__CIAJIIEF">Example 29-7</a> shows how to accomplish the same thing as <a href="user-defined-repository-metadata.html#GUID-F2E53FE2-75E7-4CBE-AA66-D5A5176001F0__CIACDCJD">Example 29-4</a> by inserting the metadata using WebDAV method <code class="codeph">PROPPATCH</code>. Using appropriate tools, your application creates such a <code class="codeph">PROPPATCH</code> WebDAV request and sends it to the WebDAV server for processing.
                        </p>
                        <p>To update user-defined metadata, you proceed in the same way. To <span class="italic">delete</span> user-defined metadata, the WebDAV request is similar, but it has <code class="codeph">D:remove</code> in place of <code class="codeph">D:set</code>.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-065AB9FE-AC85-4AA3-861E-A97AE739E1FD__CIAJIIEF">
                        <p class="titleinexample">Example 29-7 Adding Metadata Using WebDAV PROPPATCH</p><pre class="pre codeblock"><code>PROPPATCH /public/horse_with_pig.jpg HTTP/1.1
Host: www.example.com
Content-Type: text/xml; charset="utf-8"
Content-Length: 609
Authorization: Basic dGRhZHhkYl9tZXRhOnRkYWR4ZGJfbWV0YQ==
Connection: close
 
&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;D:<span class="bold">propertyupdate</span> xmlns:D="<span class="bold">DAV:</span>" xmlns:Z="http://www.w3.com/standards/z39.50/"&gt;
  &lt;D:<span class="bold">set</span>&gt;
    &lt;D:<span class="bold">prop</span>&gt;
      &lt;c:ImgCatMetadata
          xmlns:c="cnamespace"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="cnamespace imagecategories.xsd"&gt;
        &lt;Categories&gt;
          &lt;Category&gt;Vacation&lt;/Category&gt;
          &lt;Category&gt;Animals&lt;/Category&gt;
          &lt;Category&gt;Humor&lt;/Category&gt;
          &lt;Category&gt;2005&lt;/Category&gt;
        &lt;/Categories&gt;
      &lt;/c:ImgCatMetadata&gt;
    &lt;/D:prop&gt;
  &lt;/D:set&gt;
&lt;/D:propertyupdate&gt;</code></pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="user-defined-repository-metadata.html#GUID-351751BE-25B8-4F4A-9706-5D54A1D93D4C" title="You can add, update, and delete user-defined resource metadata using PL/SQL procedures in package DBMS_XDB_REPOS, SQL DML statements INSERT, UPDATE, and DELETE, or WebDAV protocol method PROPPATCH.">Addition, Modification, and Deletion of Resource Metadata</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="ADXDB5586"></a><a id="ADXDB5585"></a><div class="props_rev_3"><a id="GUID-71218C70-98BE-4336-A63D-129A1B4BD30A" name="GUID-71218C70-98BE-4336-A63D-129A1B4BD30A"></a><h3 id="ADXDB-GUID-71218C70-98BE-4336-A63D-129A1B4BD30A" class="sect3"><span class="enumeration_section">29.4 </span>Querying XML Schema-Based Resource Metadata
               </h3>
               <div>
                  <p>You can use metadata column <code class="codeph">RESID</code> when querying resource metadata, to join the metadata with the associated data.
                  </p>
                  <div class="section">
                     <p>When you register an XML schema using the <code class="codeph">enableHierarchy</code> value <code class="codeph">ENABLE_HIERARCHY_RESMETADATA</code>, an additional column, <code class="codeph">RESID</code>, is added automatically to the <code class="codeph">XMLType</code> tables used to store the metadata. This column stores the object identifier (OID) of the resource associated with the metadata. You can use column <code class="codeph">RESID</code> when querying metadata, to join the metadata with the associated data.
                     </p>
                     <p>You can query metadata in these ways:</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Query <code class="codeph">RESOURCE_VIEW</code> for the metadata. For example:
                           </p><pre class="pre codeblock"><code>SELECT count(*) FROM RESOURCE_VIEW
  WHERE
    XMLExists(
      'declare namespace r
         = "http://xmlns.oracle.com/xdb/XDBResource.xsd"; (: :)
       declare namespace c
         = "cnamespace"; (: :)
       /r:Resource/c:ImgCatMetadata/Categories/Category[text()="Vacation"]'
      PASSING RES);

  COUNT(*)
----------
         1
 
1 row selected.
</code></pre></li>
                        <li>
                           <p>Query the XML schema-based table for the user-defined metadata directly, and join this metadata back to the resource table, identifying which resource to select. Use column <code class="codeph">RESID</code> of the metadata table to do this. For example:
                           </p><pre class="pre codeblock"><code>SELECT COUNT(*) FROM RESOURCE_VIEW rs, <span class="bold">imgcatmetadatatable ct</span>
  WHERE
    XMLExists(
      'declare namespace r
         = "http://xmlns.oracle.com/xdb/XDBResource.xsd"; (: :)
       declare namespace c
         = "cnamespace"; (: :)
       /r:Resource/c:ImgCatMetadata/Categories/Category'
      PASSING RES)
    AND <span class="bold">rs.RESID = ct.RESID</span>;

  COUNT(*)
----------
         1
 
1 row selected.
</code></pre></li>
                     </ul>
                     <p>Oracle recommends querying for user-defined metadata directly, for performance reasons. Direct queries of the <code class="codeph">RESOURCE_VIEW</code> alone <span class="italic">cannot be optimized</span> using XPath rewrite, because there is no way to determine whether or not target elements like <code class="codeph">Category</code> are stored in the <code class="codeph">CLOB</code> value or in an out-of-line table. 
                     </p>
                     <p>To improve performance further, create an index on each metadata column you intend to query.</p>
                     <p><a href="user-defined-repository-metadata.html#GUID-71218C70-98BE-4336-A63D-129A1B4BD30A__BABEHBGB">Example 29-8</a> queries both kinds of photo resource metadata, retrieving the paths to the resources that are categorized as vacation photos and have the title "Pig Riding Horse".
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-71218C70-98BE-4336-A63D-129A1B4BD30A__BABEHBGB">
                     <p class="titleinexample">Example 29-8 Query XML Schema-Based Resource Metadata</p><pre class="pre codeblock"><code>SELECT ANY_PATH
  FROM RESOURCE_VIEW rs, imgcatmetadatatable ct, imgtechmetadatatable tt
  WHERE XMLExists(
          'declare namespace r
             = "http://xmlns.oracle.com/xdb/XDBResource.xsd"; (: :)
           declare namespace c
             = "cnamespace"; (: :)
           /r:Resource/c:ImgCatMetadata/Categories/Category[text()="Vacation"]'
          PASSING RES)
    AND XMLExists(
          'declare namespace r
             = "http://xmlns.oracle.com/xdb/XDBResource.xsd"; (: :)
           declare namespace i
             = "inamespace"; (: :)
           /r:Resource/i:ImgTechMetadata/Title[text()="Pig Riding Horse"]'
          PASSING RES)
    AND rs.RESID = ct.RESID
    AND rs.RESID = tt.RESID;

ANY_PATH
--------------------------
/public/horse_with_pig.jpg
 
1 row selected.</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="user-defined-repository-metadata.html#GUID-74BCC51E-2E7C-4DB6-8DCF-F65122FE132E" title="You can create your own metadata to associate with XML data stored in Oracle XML&nbsp;DB Repository.">User-Defined Repository Metadata</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB5587"></a><div class="props_rev_3"><a id="GUID-BB7CA0E0-E4A8-496C-BECF-46150BF27865" name="GUID-BB7CA0E0-E4A8-496C-BECF-46150BF27865"></a><h3 id="ADXDB-GUID-BB7CA0E0-E4A8-496C-BECF-46150BF27865" class="sect3"><span class="enumeration_section">29.5 </span>XML Image Metadata from Binary Image Metadata
               </h3>
               <div>
                  <p>Digital cameras include image metadata as part of the image files they produce. </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>EXIF &#x2013; Exchangeable Image File Format</p>
                     </li>
                     <li>
                        <p>IPTC-NAA IIM &#x2013; International Press Telecommunications Council-Newspaper Association of America Information Interchange Model </p>
                     </li>
                     <li>
                        <p>XMP &#x2013; Extensible Metadata Platform</p>
                     </li>
                  </ul>
                  <p>EXIF is the metadata standard for digital still cameras. EXIF metadata is stored in TIFF and JPEG image files. IPTC and XMP metadata is commonly embedded in image files by desktop image-processing software.</p>
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="user-defined-repository-metadata.html#GUID-74BCC51E-2E7C-4DB6-8DCF-F65122FE132E" title="You can create your own metadata to associate with XML data stored in Oracle XML&nbsp;DB Repository.">User-Defined Repository Metadata</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB5589"></a><a id="ADXDB5588"></a><div class="props_rev_3"><a id="GUID-9D74E515-7FB4-4FE4-B503-3F920AF3071C" name="GUID-9D74E515-7FB4-4FE4-B503-3F920AF3071C"></a><h3 id="ADXDB-GUID-9D74E515-7FB4-4FE4-B503-3F920AF3071C" class="sect3"><span class="enumeration_section">29.6 </span>Adding Non-Schema-Based Resource Metadata
               </h3>
               <div>
                  <p>You store user-defined resource metadata that is <span class="italic">not</span> XML Schema-based as a <code class="codeph">CLOB</code> instance under the <code class="codeph">Resource</code> element of the associated resource. 
                  </p>
                  <div class="section">
                     <p>The default XML schema for a resource has a top-level element <span class="bold"><code class="codeph">any</code></span> (declared with <code class="codeph">maxOccurs= "unbounded"</code>), which admits any valid XML data as part of the resource document in the resource table, <code class="codeph">XDB.XDB$RESOURCE</code>.
                     </p>
                     <p>The following skeleton shows the structure and position of non-schema-based resource metadata:</p><pre class="pre codeblock"><code>     &lt;Resource xmlns="http://xmlns.oracle.com/xdb/XDBResource.xsd"
       &lt;Owner&gt;DESELBY&lt;/Owner&gt;
       ... &lt;!-- other system-defined metadata --&gt;
       &lt;!-- contents of the resource&gt;
       &lt;Contents&gt;
         ...
       &lt;/Contents&gt;
       &lt;!-- User-defined metadata (appearing within different namespace) --&gt;
       <span class="bold">&lt;MyOwnMetadata xmlns="http://www.example.com/custommetadata"&gt;</span>
         <span class="bold">&lt;MyElement1&gt;value1&lt;/MyElement1&gt;</span>
         <span class="bold">&lt;MyElement2&gt;value2&lt;/MyElement2&gt;</span>
       <span class="bold">&lt;/MyOwnMetadata&gt;</span>
     &lt;/Resource&gt;
</code></pre><p>You can set and access non-schema-based resource metadata belonging to namespaces other than <code class="codeph">XDBResource.xsd</code> by using any of the means described previously for accessing XML schema-based resource metadata. 
                     </p>
                     <p><a href="user-defined-repository-metadata.html#GUID-9D74E515-7FB4-4FE4-B503-3F920AF3071C__BABEDFFF">Example 29-9</a> illustrates this for the case of SQL DML operations, adding user-defined metadata directly to the <code class="codeph">&lt;RESOURCE&gt;</code> <span class="italic">document</span>. It shows how to add non-schema-based metadata to a resource using SQL DML.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-9D74E515-7FB4-4FE4-B503-3F920AF3071C__BABEDFFF">
                     <p class="titleinexample">Example 29-9 Add Non-Schema-Based Metadata to a Resource</p><pre class="pre codeblock"><code>DECLARE
  res BOOLEAN;
BEGIN
  res := DBMS_XDB_REPOS.createResource(
           '/public/NurseryRhyme.txt',
           bfilename('MYDIR', 'tdadxdb-xdb_repos_meta-011.txt'),
           nls_charset_id('AL32UTF8'));
  UPDATE RESOURCE_VIEW SET RES = 
   XMLQuery('declare namespace r = "http://xmlns.oracle.com/xdb/XDBResource.xsd"; (: :)
             declare namespace n = "nurserynamespace"; (: :)
             copy $tmp := . modify insert node
              &lt;n:NurseryMetadata&gt;
                &lt;Author&gt;Mother Goose&lt;/Author&gt;
              &lt;/n:NurseryMetadata&gt;
             into $tmp/r:Resource
             return $tmp'
            PASSING RES
            RETURNING CONTENT)
   WHERE equals_path(RES, '/public/NurseryRhyme.txt') = 1;
END;
/

PL/SQL procedure successfully completed.
 

SELECT XMLSerialize(DOCUMENT rs.RES AS CLOB) FROM RESOURCE_VIEW rs
  WHERE equals_path(RES, '/public/NurseryRhyme.txt') = 1;
 
XMLSERIALIZE(DOCUMENTRS.RESASCLOB)
--------------------------------------------------------------------------------
&lt;Resource xmlns="http://xmlns.oracle.com/xdb/XDBResource.xsd" Hidden="false" Inv
alid="false" Container="false" CustomRslv="false" VersionHistory="false" StickyR
ef="true"&gt;
  &lt;CreationDate&gt;2005-05-24T13:51:48.043234&lt;/CreationDate&gt;
  &lt;ModificationDate&gt;2005-05-24T13:51:48.290144&lt;/ModificationDate&gt;
  &lt;DisplayName&gt;NurseryRhyme.txt&lt;/DisplayName&gt;
  &lt;Language&gt;en-US&lt;/Language&gt;
  &lt;CharacterSet&gt;UTF-8&lt;/CharacterSet&gt;
  &lt;ContentType&gt;text/plain&lt;/ContentType&gt;
  &lt;RefCount&gt;1&lt;/RefCount&gt;
  &lt;ACL&gt;
    &lt;acl description="Public:All privileges to PUBLIC" xmlns="http://xmlns.oracl
e.com/xdb/acl.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:sch
emaLocation="http://xmlns.oracle.com/xdb/acl.xsd                           http:
//xmlns.oracle.com/xdb/acl.xsd" shared="true"&gt;
      &lt;ace&gt;
        &lt;principal&gt;PUBLIC&lt;/principal&gt;
        &lt;grant&gt;true&lt;/grant&gt;
        &lt;privilege&gt;
          &lt;all/&gt;
        &lt;/privilege&gt;
      &lt;/ace&gt;
    &lt;/acl&gt;
  &lt;/ACL&gt;
  &lt;Owner&gt;TDADXDB_META&lt;/Owner&gt;
  &lt;Creator&gt;TDADXDB_META&lt;/Creator&gt;
  &lt;LastModifier&gt;TDADXDB_META&lt;/LastModifier&gt;
  &lt;SchemaElement&gt;http://xmlns.oracle.com/xdb/XDBSchema.xsd#text&lt;/SchemaElement&gt;
  &lt;Contents&gt;
    &lt;text&gt;Mary had a little lamb
Its fleece was white as snow
and everywhere that Mary went
that lamb was sure to go
&lt;/text&gt;
  &lt;/Contents&gt;
  &lt;n:NurseryMetadata xmlns:n="nurserynamespace"&gt;
    &lt;Author xmlns=""&gt;Mother Goose&lt;/Author&gt;
  &lt;/n:NurseryMetadata&gt;
&lt;/Resource&gt;
 
1 row selected.</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="user-defined-repository-metadata.html#GUID-74BCC51E-2E7C-4DB6-8DCF-F65122FE132E" title="You can create your own metadata to associate with XML data stored in Oracle XML&nbsp;DB Repository.">User-Defined Repository Metadata</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB5590"></a><div class="props_rev_3"><a id="GUID-C224ED8C-338C-41D5-B714-4B9D403E600E" name="GUID-C224ED8C-338C-41D5-B714-4B9D403E600E"></a><h3 id="ADXDB-GUID-C224ED8C-338C-41D5-B714-4B9D403E600E" class="sect3"><span class="enumeration_section">29.7 </span>PL/SQL Procedures Affecting Resource Metadata
               </h3>
               <div>
                  <p>You can use PL/SQL procedures <code class="codeph">DBMS_XMLSCHEMA.registerSchema</code>, <code class="codeph">DBMS_XDBZ.enable_hierarchy</code>, <code class="codeph">DBMS_XDBZ.disable_hierarchy</code>, <code class="codeph">DBMS_XDBZ.is_hierarchy_enabled</code>, <code class="codeph">DBMS_XDB_REPOS.appendResourceMetadata</code>, <code class="codeph">DBMS_XDB_REPOS.deleteResourceMetadata</code>, <code class="codeph">DBMS_XDB_REPOS.purgeResourceMetadata</code>, and <code class="codeph">DBMS_XDB_REPOS.updateResourceMetadata</code> to perform resource metadata operations.
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><code class="codeph">DBMS_XMLSCHEMA.registerSchema</code> &#x2013; Register an XML schema. Parameter <code class="codeph">ENABLEHIERARCHY</code> affects resource metadata.
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">DBMS_XDBZ.enable_hierarchy</code> &#x2013; Enable repository support for an <code class="codeph">XMLType</code> table or view. Use parameter <code class="codeph">HIERARCHY_TYPE</code> with a value of <code class="codeph">DBMS_XDBZ.ENABLE_HIERARCHY_RESMETADATA</code> to enable resource metadata. This adds column <code class="codeph">RESID</code> to track the resource associated with the metadata.
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">DBMS_XDBZ.disable_hierarchy</code> &#x2013; Disable all repository support for an <code class="codeph">XMLType</code> table or view.
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">DBMS_XDBZ.is_hierarchy_enabled</code> &#x2013; Tests, using parameter <code class="codeph">HIERARCHY_TYPE</code>, whether the specified type of hierarchy is currently enabled for the specified <code class="codeph">XMLType</code> table or view. Value <code class="codeph">DBMS_XDBZ.IS_ENABLED_RESMETADATA</code> for <code class="codeph">HIERARCHY_TYPE</code> tests whether resource metadata is enabled.
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">DBMS_XDB_REPOS.appendResourceMetadata</code> &#x2013; Add metadata to a resource.
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">DBMS_XDB_REPOS.deleteResourceMetadata</code> &#x2013; Delete specified metadata from a resource.
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">DBMS_XDB_REPOS.purgeResourceMetadata</code> &#x2013; Delete all user-defined metadata from a resource. For schema-based resources, optional parameter <code class="codeph">DELETE_OPTION</code> can be used to specify whether or not to delete the metadata information, in addition to unlinking it.
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">DBMS_XDB_REPOS.updateResourceMetadata</code> &#x2013; Update the metadata for a resource.
                        </p>
                     </li>
                  </ul>
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-C224ED8C-338C-41D5-B714-4B9D403E600E__GUID-002227CC-7A19-4613-B874-449BD20F2CCB">
                     <p class="notep1">See Also:</p>
                     <p><a href="../arpls/DBMS_XDB_REPOS.html#ARPLS74188" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for detailed information about these PL/SQL procedures
                     </p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="user-defined-repository-metadata.html#GUID-74BCC51E-2E7C-4DB6-8DCF-F65122FE132E" title="You can create your own metadata to associate with XML data stored in Oracle XML&nbsp;DB Repository.">User-Defined Repository Metadata</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>