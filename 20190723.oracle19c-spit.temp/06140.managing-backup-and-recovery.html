<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Managing Backup and Recovery</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Real Application Clusters Administration and Deployment Guide">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Real Application Clusters Administration and Deployment Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="real-application-clusters-administration-and-deployment-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-04-25T14:02:30-07:00">
      <meta name="dcterms.title" content="Real Application Clusters Administration and Deployment Guide">
      <meta name="dcterms.dateCopyrighted" content="1999, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E95728-03">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="configuring-recovery-manager-and-archiving.html" title="Previous" type="text/html">
      <link rel="next" href="cloning-oracle-rac-to-nodes-in-a-new-cluster.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="RACAD">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="configuring-recovery-manager-and-archiving.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="cloning-oracle-rac-to-nodes-in-a-new-cluster.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Real Application Clusters Administration and Deployment Guide</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Managing Backup and Recovery</li>
            </ol>
            <a id="GUID-A02120B2-BE62-4172-B402-BF034566E471" name="GUID-A02120B2-BE62-4172-B402-BF034566E471"></a><a id="RACAD059"></a>
            
            <h2 id="RACAD-GUID-A02120B2-BE62-4172-B402-BF034566E471" class="sect2"><span class="enumeration_chapter">8 </span>Managing Backup and Recovery
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>This chapter explains instance recovery and how to use Recovery Manager (RMAN) to back up and restore Oracle Real Application Clusters (Oracle RAC) databases. This chapter also describes Oracle RAC instance recovery, parallel backup, recovery with SQL*Plus, and using the Fast Recovery Area in Oracle RAC. The topics in this chapter include:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="managing-backup-and-recovery.html#GUID-C87EEB8B-2F12-45AE-BD77-F9D449F5E07A">RMAN Backup Scenario for Noncluster File System Backups</a></p>
                  </li>
                  <li>
                     <p><a href="managing-backup-and-recovery.html#GUID-F5C92E41-9841-4E73-8871-D9965F3FEFE0">RMAN Restore Scenarios for Oracle RAC</a></p>
                  </li>
                  <li>
                     <p><a href="managing-backup-and-recovery.html#GUID-0AAFAEC9-2FDB-47D3-83E8-B70BA460F13E" title="Oracle Database provides RMAN for backing up and restoring the database.">Instance Recovery in Oracle RAC</a></p>
                  </li>
                  <li>
                     <p><a href="managing-backup-and-recovery.html#GUID-C0372EC9-CF9A-48E3-964A-33373042B502">Media Recovery in Oracle RAC</a></p>
                  </li>
                  <li>
                     <p><a href="managing-backup-and-recovery.html#GUID-A0CE341E-26E4-443D-806B-A821B7648495" title="Oracle Database automatically selects the optimum degree of parallelism for instance, crash, and media recovery.">Parallel Recovery in Oracle RAC</a></p>
                  </li>
                  <li>
                     <p><a href="managing-backup-and-recovery.html#GUID-4EE42D1E-32CB-4C60-ADBA-333901E4E710" title="To use a fast recovery area in Oracle RAC, you must place it on an Oracle ASM disk group, on a Cluster File System, or on a shared directory that is configured through a network file system file for each Oracle RAC instance.">Using a Fast Recovery Area in Oracle RAC</a></p>
                  </li>
               </ul>
               <div class="infoboxnote" id="GUID-A02120B2-BE62-4172-B402-BF034566E471__GUID-FDC73C6B-20EC-41AD-BCA9-FC79AA2F6A80">
                  <p class="notep1">Note:</p>
                  <p>For restore and recovery in Oracle RAC environments, you do not have to configure the instance that performs the recovery to also be the sole instance that restores all of the data files. In Oracle RAC, data files are accessible from every node in the <a href="glossary.html#GUID-1B7C963C-0E0C-425E-AD47-D75C912230CB"><span class="xrefglossterm">cluster</span></a>, so any node can restore archived redo log files. 
                  </p>
               </div>
            </div>
            <div>
               <div class="relinfo">
                  <p><strong>Related Topics</strong></p>
                  <ul>
                     <li><a href="../cwadd/managing-oracle-cluster-registry-and-voting-files.html#CWADD-GUID-70E524E1-0FAD-4962-9B9F-0691EAEE7A9F" target="_blank"><span><cite>Oracle Clusterware Administration and Deployment Guide</cite></span></a></li>
                  </ul>
               </div>
               <div class="infoboxnotealso" id="GUID-A02120B2-BE62-4172-B402-BF034566E471__GUID-52BAA83F-02CF-4361-B791-8E5C152CC1AF">
                  <p class="notep1">See Also:</p>
                  <p><span><cite>Oracle Clusterware Administration and Deployment Guide</cite></span> for information about backing up and restoring the Oracle Clusterware components such as the Oracle Cluster Registry (OCR) and the voting disk
                  </p>
               </div>
            </div><a id="RACAD062"></a><div class="sect2"><a id="GUID-C87EEB8B-2F12-45AE-BD77-F9D449F5E07A" name="GUID-C87EEB8B-2F12-45AE-BD77-F9D449F5E07A"></a><h3 id="RACAD-GUID-C87EEB8B-2F12-45AE-BD77-F9D449F5E07A" class="sect3">RMAN Backup Scenario for Noncluster File System Backups</h3>
               <div>
                  <p>In a non<a href="glossary.html#GUID-0152C87A-A61B-433F-ACAB-B3680D27B2F4"><span class="xrefglossterm">cluster file system</span></a> environment, each node can back up only to a locally mounted noncluster file system directory. For example, <code class="codeph">node1</code> cannot access the archived redo log files on <code class="codeph">node2</code> or <code class="codeph">node3</code> unless you configure the network file system for remote access. If you configure a network file system file for backups, then each node backs up its archived redo logs to a local directory. 
                  </p>
               </div>
            </div><a id="RACAD065"></a><div class="sect2"><a id="GUID-F5C92E41-9841-4E73-8871-D9965F3FEFE0" name="GUID-F5C92E41-9841-4E73-8871-D9965F3FEFE0"></a><h3 id="RACAD-GUID-F5C92E41-9841-4E73-8871-D9965F3FEFE0" class="sect3">RMAN Restore Scenarios for Oracle RAC</h3>
               <div>
                  <p>This section describes the following common RMAN restore scenarios: </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="managing-backup-and-recovery.html#GUID-A4C1C2D7-0079-44DC-8575-A9AD08DC7D45">Restoring Backups from a Cluster File System</a></p>
                     </li>
                     <li>
                        <p><a href="managing-backup-and-recovery.html#GUID-D56BABFD-D866-4786-BE07-E60068FED41D">Restoring Backups from a Noncluster File System</a></p>
                     </li>
                     <li>
                        <p><a href="managing-backup-and-recovery.html#GUID-97F3A80B-D3CD-47F8-80E7-FEEC71EF7229">Using RMAN or Oracle Enterprise Manager to Restore the Server Parameter File (SPFILE)</a></p>
                        <div class="infoboxnote" id="GUID-F5C92E41-9841-4E73-8871-D9965F3FEFE0__GUID-C2F50A7A-5D90-46D6-8368-E0684C243C30">
                           <p class="notep1">Note:</p>
                           <p>The restore and recovery procedures in a cluster file system scheme do not differ substantially from Oracle noncluster scenarios.</p>
                        </div>
                     </li>
                  </ul>
               </div><a id="RACAD883"></a><div class="sect3"><a id="GUID-A4C1C2D7-0079-44DC-8575-A9AD08DC7D45" name="GUID-A4C1C2D7-0079-44DC-8575-A9AD08DC7D45"></a><h4 id="RACAD-GUID-A4C1C2D7-0079-44DC-8575-A9AD08DC7D45" class="sect4">Restoring Backups from a Cluster File System</h4>
                  <div>
                     <p>The scheme that this section describes assumes that you are using the <span class="q">"Oracle Automatic Storage Management and Cluster File System Archiving Scheme"</span>. In this scheme, assume that <code class="codeph">node3</code> performed the backups to a cluster file system. If <code class="codeph">node3</code> is available for the restore and recovery operation, and if all of the archived logs have been backed up or are on disk, then run the following commands to perform complete recovery:
                     </p><pre class="oac_no_warn" dir="ltr">RESTORE DATABASE;
RECOVER DATABASE;
</pre><p>If <code class="codeph">node3</code> performed the backups but is unavailable, then configure a media management device for one of the remaining nodes and make the backup media from <code class="codeph">node3</code> available to this node.
                     </p>
                     <div class="infoboxnote" id="GUID-A4C1C2D7-0079-44DC-8575-A9AD08DC7D45__GUID-57804F88-77EB-40C9-B14B-68996AFE83C0">
                        <p class="notep1">Note:</p>
                        <p>If you configured RMAN as described in <span class="q">"Configuring Channels to Use Automatic Load Balancing"</span>, then, to load balance the channels across nodes, note that channels cannot be load balanced before at least one instance has successfully opened the database. This means that the channels will not be load balanced across the nodes during a full database restore. To achieve load balancing of channels for <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands, you can temporarily reallocate channels by running commands similar to the following:
                        </p><pre class="pre codeblock"><code>run {
ALLOCATE CHANNEL DEVICE TYPE sbt C1 CONNECT '@racinst_1'
ALLOCATE CHANNEL DEVICE TYPE sbt C2 CONNECT '@racinst_2'
...
}</code></pre></div>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="configuring-recovery-manager-and-archiving.html#GUID-2A6A3B47-DD1A-40AF-9550-C37229A556D8" title="The preferred configuration for Oracle RAC is to use Oracle Automatic Storage Management (Oracle ASM) for a recovery area using a disk group for your recovery set that is different from the disk group used for your data files.">Oracle Automatic Storage Management and Cluster File System Archiving Scheme</a></li>
                           <li><a href="configuring-recovery-manager-and-archiving.html#GUID-F0D41FE7-499E-40C2-AFBA-DBDFD110BED6">Configuring Channels to Use Automatic Load Balancing</a></li>
                        </ul>
                     </div>
                  </div>
               </div><a id="RACAD884"></a><div class="sect3"><a id="GUID-D56BABFD-D866-4786-BE07-E60068FED41D" name="GUID-D56BABFD-D866-4786-BE07-E60068FED41D"></a><h4 id="RACAD-GUID-D56BABFD-D866-4786-BE07-E60068FED41D" class="sect4">Restoring Backups from a Noncluster File System</h4>
                  <div>
                     <p>The scheme that this section describes assumes that you are using the <span class="q">"Noncluster File System Local Archiving Scheme"</span>. In this scheme, each node archives locally to a different directory. For example, <code class="codeph">node1</code> archives to <code class="codeph">/arc_dest_1</code>, <code class="codeph">node2</code> archives to <code class="codeph">/arc_dest_2</code>, and <code class="codeph">node3</code> archives to <code class="codeph">/arc_dest_3</code>. You must configure a network file system file so that the recovery node can read the archiving directories on the remaining nodes.
                     </p>
                     <p>If all nodes are available and if all archived redo logs have been backed up, then you can perform a complete restore and recovery by mounting the database and running the following commands from any node:</p><pre class="pre codeblock"><code>RESTORE DATABASE;
RECOVER DATABASE;</code></pre><p>Because the network file system configuration enables each node read access to the redo log files on other nodes, then the recovery node can read and apply the archived redo logs located on the local and remote disks. No manual transfer of archived redo logs is required.</p>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="configuring-recovery-manager-and-archiving.html#GUID-C28C9955-BDC7-4381-BD0D-B24BAD5B54DE" title="If you use noncluster file system local archiving for media recovery, then you must configure the node that is performing recovery for remote access to the other nodes so that it can read the archived redo log files in the archive directories on the other nodes.">Noncluster File System Local Archiving Scheme</a></li>
                        </ul>
                     </div>
                  </div>
               </div><a id="RACAD867"></a><div class="sect3"><a id="GUID-97F3A80B-D3CD-47F8-80E7-FEEC71EF7229" name="GUID-97F3A80B-D3CD-47F8-80E7-FEEC71EF7229"></a><h4 id="RACAD-GUID-97F3A80B-D3CD-47F8-80E7-FEEC71EF7229" class="sect4">Using RMAN or Oracle Enterprise Manager to Restore the Server Parameter File (SPFILE)</h4>
                  <div>
                     <p>RMAN can restore the server parameter file either to the default location or to a location that you specify.</p>
                     <p>You can also use <a id="d35780e1061" class="indexterm-anchor"></a>Oracle Enterprise Manager to restore the SPFILE. From the Backup/Recovery section of the <span class="bold">Maintenance</span> tab, click <span class="bold">Perform Recovery</span>. The Perform Recovery link is context-sensitive and navigates you to the SPFILE restore only when the database is closed.
                     </p>
                  </div>
               </div>
            </div><a id="RACAD063"></a><div class="sect2"><a id="GUID-0AAFAEC9-2FDB-47D3-83E8-B70BA460F13E" name="GUID-0AAFAEC9-2FDB-47D3-83E8-B70BA460F13E"></a><h3 id="RACAD-GUID-0AAFAEC9-2FDB-47D3-83E8-B70BA460F13E" class="sect3">Instance Recovery in Oracle RAC</h3>
               <div>
                  <p>Instance <a id="d35780e1213" class="indexterm-anchor"></a><a id="d35780e1217" class="indexterm-anchor"></a>failure occurs when software or hardware problems disable an instance. After instance failure, Oracle Database automatically uses the online redo logs to perform recovery as described in this section.
                  </p>
                  <p>This section includes the following topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="managing-backup-and-recovery.html#GUID-DA574121-2470-4E38-AD75-915DE49C019B">Single Node Failure in Oracle RAC</a></p>
                     </li>
                     <li>
                        <p><a href="managing-backup-and-recovery.html#GUID-7536AA43-C3D3-43DD-BA6E-AAC5D5ED024F">Multiple-Node Failures in Oracle RAC</a></p>
                     </li>
                     <li>
                        <p><a href="managing-backup-and-recovery.html#GUID-3618864D-82BD-40B5-9A21-6CCE6ABBC6D1" title="Oracle Database provides RMAN for backing up and restoring the database.">Using RMAN to Create Backups in Oracle RAC</a></p>
                     </li>
                     <li>
                        <p><a href="managing-backup-and-recovery.html#GUID-124B3BAB-FEE2-4CEE-B33A-1AD40D3399CF">Node Affinity Awareness of Fast Connections </a></p>
                     </li>
                     <li>
                        <p><a href="managing-backup-and-recovery.html#GUID-A74F5C79-B1D6-4C33-A0C7-77C5432EBFE2">Deleting Archived Redo Logs after a Successful Backup</a></p>
                     </li>
                     <li>
                        <p><a href="managing-backup-and-recovery.html#GUID-131BD138-21E6-4CAF-B37E-C523F728355C">Autolocation for Backup and Restore Commands</a></p>
                     </li>
                  </ul>
               </div><a id="RACAD856"></a><div class="sect3"><a id="GUID-DA574121-2470-4E38-AD75-915DE49C019B" name="GUID-DA574121-2470-4E38-AD75-915DE49C019B"></a><h4 id="RACAD-GUID-DA574121-2470-4E38-AD75-915DE49C019B" class="sect4">Single Node Failure in Oracle RAC</h4>
                  <div>
                     <p><a id="d35780e1398" class="indexterm-anchor"></a><a id="d35780e1402" class="indexterm-anchor"></a><a id="d35780e1404" class="indexterm-anchor"></a><a id="d35780e1408" class="indexterm-anchor"></a><a id="d35780e1412" class="indexterm-anchor"></a><a id="d35780e1416" class="indexterm-anchor"></a><a id="d35780e1420" class="indexterm-anchor"></a><a id="d35780e1424" class="indexterm-anchor"></a>Instance recovery in Oracle RAC does not include the recovery of applications that were running on the failed instance. Oracle Clusterware restarts the instance automatically.
                     </p>
                     <p>Applications that were running on a node before it failed continue running by using failure recognition and recovery. This provides consistent and uninterrupted service if hardware or software fails. When one instance performs recovery for another instance, the surviving instance reads online redo logs generated by the failed instance and uses that information to ensure that committed transactions are recorded in the database. Thus, data from committed transactions is not lost.<a id="d35780e1431" class="indexterm-anchor"></a><a id="d35780e1435" class="indexterm-anchor"></a> The instance performing recovery rolls back transactions that were active at the time of the failure and releases resources used by those transactions.<a id="d35780e1440" class="indexterm-anchor"></a><a id="d35780e1444" class="indexterm-anchor"></a><a id="d35780e1448" class="indexterm-anchor"></a><a id="d35780e1452" class="indexterm-anchor"></a><a id="d35780e1456" class="indexterm-anchor"></a><a id="d35780e1460" class="indexterm-anchor"></a><a id="d35780e1464" class="indexterm-anchor"></a><a id="d35780e1469" class="indexterm-anchor"></a></p>
                     <div class="infoboxnote" id="GUID-DA574121-2470-4E38-AD75-915DE49C019B__GUID-4BF5D1DC-45F9-4F5E-A6E2-177DFC0BB94F">
                        <p class="notep1">Note:</p>
                        <p>All online redo logs must be accessible for instance recovery. Therefore, Oracle recommends that you mirror your online redo logs.</p>
                     </div>
                  </div>
               </div><a id="RACAD865"></a><div class="sect3"><a id="GUID-7536AA43-C3D3-43DD-BA6E-AAC5D5ED024F" name="GUID-7536AA43-C3D3-43DD-BA6E-AAC5D5ED024F"></a><h4 id="RACAD-GUID-7536AA43-C3D3-43DD-BA6E-AAC5D5ED024F" class="sect4">Multiple-Node Failures in Oracle RAC</h4>
                  <div>
                     <p>When <a id="d35780e1617" class="indexterm-anchor"></a>multiple node <a id="d35780e1620" class="indexterm-anchor"></a>failures occur, if one instance survives, then Oracle RAC performs instance recovery for any other instances that fail. <a id="d35780e1625" class="indexterm-anchor"></a><a id="d35780e1629" class="indexterm-anchor"></a><a id="d35780e1633" class="indexterm-anchor"></a>If all instances of an Oracle RAC database fail, then Oracle Database automatically recovers the instances the next time one instance opens the database. The instance performing recovery can mount the database in either <a href="glossary.html#GUID-5D32446E-2961-496F-BDE1-FE5E9C119DA0"><span class="xrefglossterm">cluster database</span></a> or exclusive mode from any node of an Oracle RAC database. This recovery procedure is the same for Oracle Database running in shared mode as it is for Oracle Database running in exclusive mode, except that one instance performs instance recovery for all of the failed instances.<a id="d35780e1643" class="indexterm-anchor"></a></p>
                  </div>
               </div><a id="RACAD866"></a><div class="sect3"><a id="GUID-3618864D-82BD-40B5-9A21-6CCE6ABBC6D1" name="GUID-3618864D-82BD-40B5-9A21-6CCE6ABBC6D1"></a><h4 id="RACAD-GUID-3618864D-82BD-40B5-9A21-6CCE6ABBC6D1" class="sect4">Using RMAN to Create Backups in Oracle RAC</h4>
                  <div>
                     <p>Oracle Database provides RMAN for backing up and restoring the database.</p>
                     <p>RMAN enables you to back up, restore, and recover data files, control files, SPFILEs, and archived redo logs. RMAN is included with the Oracle Database server and it is installed by default. You can run RMAN from the command line or you can use it from the Backup Manager in Oracle Enterprise Manager. In addition, RMAN is the recommended backup and recovery tool if you are using Oracle Automatic Storage Management (Oracle ASM). The procedures for using RMAN in Oracle RAC environments do not differ substantially from those for Oracle noncluster environments.</p>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="../bradv/backing-up-database.html#BRADV-GUID-93BAB347-063F-439E-BDF3-109AB8D1F8E7" target="_blank"><span><cite>Oracle Database Backup and Recovery User’s Guide</cite></span></a></li>
                        </ul>
                     </div>
                  </div><a id="RACAD869"></a><div class="sect4"><a id="GUID-B99CAF7C-FFF5-4AE3-AD38-817D82EB654D" name="GUID-B99CAF7C-FFF5-4AE3-AD38-817D82EB654D"></a><h5 id="RACAD-GUID-B99CAF7C-FFF5-4AE3-AD38-817D82EB654D" class="sect5">Channel Connections to Cluster Instances with RMAN</h5>
                     <div>
                        <p>Channel connections to the instances are determined using the connect string defined by channel configurations. For example, in the following configuration, three channels are allocated using <code class="codeph">dbauser/pwd@<span class="variable" translate="no">service_name</span></code>. If you configure the SQL Net service name with load balancing turned on, then the channels are allocated at a node as decided by the load balancing algorithm.
                        </p><pre class="pre codeblock"><code>CONFIGURE DEVICE TYPE sbt PARALLELISM 3;
CONFIGURE DEFAULT DEVICE TYPE TO sbt;
CONFIGURE CHANNEL DEVICE TYPE SBT CONNECT 'dbauser/pwd@<span class="variable" translate="no">service_name</span>'</code></pre><p>However, if the service name used in the connect string is not for load balancing, then you can control at which instance the channels are allocated using separate connect strings for each channel configuration, as follows: </p><pre class="pre codeblock"><code>CONFIGURE DEVICE TYPE sbt PARALLELISM 3;
CONFIGURE CHANNEL 1.. CONNECT 'dbauser/pwd@mydb_1';
CONFIGURE CHANNEL 2.. CONNECT 'dbauser/pwd@mydb_2';
CONFIGURE CHANNEL 3.. CONNECT 'dbauser/pwd@mydb_3';</code></pre><p>In the previous example, it is assumed that <code class="codeph">mydb_1</code>, <code class="codeph">mydb_2</code> and <code class="codeph">mydb_3</code> are SQL*Net service names that connect to pre-defined nodes in your Oracle RAC environment. Alternatively, you can also use manually allocated channels to backup your database files. For example, the following command backs up the SPFILE, control file, data files and archived redo logs:
                        </p><pre class="pre codeblock"><code>RUN
{
    ALLOCATE CHANNEL CH1 CONNECT 'dbauser/pwd@mydb_1';
    ALLOCATE CHANNEL CH2 CONNECT 'dbauser/pwd@mydb_2';
    ALLOCATE CHANNEL CH3 CONNECT 'dbauser/pwd@mydb_3';
    BACKUP DATABASE PLUS ARCHIVED LOG;
}</code></pre><p>During a backup operation, if at least one channel allocated has access to the archived log, then RMAN automatically schedules the backup of the specific log on that channel. Because the control file, SPFILE, and data files are accessible by any channel, the backup operation of these files is distributed across the allocated channels. </p>
                        <p>For a local archiving scheme, there must be at least one channel allocated to all of the nodes that write to their local archived logs. For a cluster file system archiving scheme, if every node writes the archived logs in the same cluster file system, then the backup operation of the archived logs is distributed across the allocated channels. </p>
                        <div class="p">During a backup, the instances to which the channels connect must be either all mounted or all open. For example, if the instance on <code class="codeph">node1</code> has the database mounted while the instances on <code class="codeph">node2</code> and <code class="codeph">node3</code> have the database open, then the backup fails.
                        </div>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>Related Topics</strong></p>
                           <ul>
                              <li><a href="../rcmrf/rman-commands-at-sign-to-quit.html#RCMRF-GUID-8757D5C8-9360-4696-B5EF-5E6D0F8E5440" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a></li>
                           </ul>
                        </div>
                        <div class="infoboxnotealso" id="GUID-B99CAF7C-FFF5-4AE3-AD38-817D82EB654D__GUID-8E761587-74DF-49DB-B68D-04B8CE8859D2">
                           <p class="notep1">See Also:</p>
                           <p><span><cite>Oracle Database Backup and Recovery Reference</cite></span> for more information about the <code class="codeph">CONNECT</code> clause of the <code class="codeph">CONFIGURE CHANNEL</code> statement
                           </p>
                        </div>
                     </div>
                  </div>
               </div><a id="RACAD870"></a><div class="sect3"><a id="GUID-124B3BAB-FEE2-4CEE-B33A-1AD40D3399CF" name="GUID-124B3BAB-FEE2-4CEE-B33A-1AD40D3399CF"></a><h4 id="RACAD-GUID-124B3BAB-FEE2-4CEE-B33A-1AD40D3399CF" class="sect4">Node Affinity Awareness of Fast Connections </h4>
                  <div>
                     <p>In some cluster database configurations, some nodes of the cluster have faster access to certain data files than to other data files. RMAN automatically detects this situation, which is known as <a id="d35780e2147" class="indexterm-anchor"></a>node affinity awareness. When deciding which channel to use to back up a particular data file, RMAN gives preference to the nodes with faster access to the data files that you want to back up. For example, if you have a three-node cluster, and if <code class="codeph">node1</code> has faster read/write access to data files 7, 8, and 9 than the other nodes, then <code class="codeph">node1</code> has greater node affinity to those files than <code class="codeph">node2</code> and <code class="codeph">node3</code>.
                     </p>
                  </div>
               </div><a id="RACAD7337"></a><div class="sect3"><a id="GUID-A74F5C79-B1D6-4C33-A0C7-77C5432EBFE2" name="GUID-A74F5C79-B1D6-4C33-A0C7-77C5432EBFE2"></a><h4 id="RACAD-GUID-A74F5C79-B1D6-4C33-A0C7-77C5432EBFE2" class="sect4">Deleting Archived Redo Logs after a Successful Backup</h4>
                  <div>
                     <p>If you have configured the automatic channels as defined in section <span class="q">"Channel Connections to Cluster Instances with RMAN"</span>, then you can use the following example to delete the archived logs that you backed up <span class="italic"><code class="codeph">n</code></span> times. The device type can be <code class="codeph">DISK</code> or <code class="codeph">SBT</code>: 
                     </p><pre class="pre codeblock"><code>DELETE ARCHIVELOG ALL BACKED UP <span class="variable" translate="no">n</span> TIMES TO DEVICE TYPE <span class="variable" translate="no">device_type</span>;
</code></pre><p>During a delete operation, if at least one channel allocated has access to the archived log, then RMAN automatically schedules the deletion of the specific log on that channel. For a local archiving scheme, there must be at least one channel allocated that can delete an archived log. For a cluster file system archiving scheme, if every node writes to the archived logs on the same cluster file system, then the archived log can be deleted by any allocated channel.</p>
                     <p>If you have not configured automatic channels, then you can manually allocate the maintenance channels as follows and delete the archived logs.</p><pre class="pre codeblock"><code>ALLOCATE CHANNEL FOR MAINTENANCE DEVICE TYPE DISK CONNECT 'SYS/oracle@node1';
ALLOCATE CHANNEL FOR MAINTENANCE DEVICE TYPE DISK CONNECT 'SYS/oracle@node2';
ALLOCATE CHANNEL FOR MAINTENANCE DEVICE TYPE DISK CONNECT 'SYS/oracle@node3';
DELETE ARCHIVELOG ALL BACKED UP <span class="variable" translate="no">n</span> TIMES TO DEVICE TYPE <span class="variable" translate="no">device_type</span>;</code></pre></div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="managing-backup-and-recovery.html#GUID-B99CAF7C-FFF5-4AE3-AD38-817D82EB654D">Channel Connections to Cluster Instances with RMAN</a></li>
                        </ul>
                     </div>
                  </div>
               </div><a id="RACAD874"></a><div class="sect3"><a id="GUID-131BD138-21E6-4CAF-B37E-C523F728355C" name="GUID-131BD138-21E6-4CAF-B37E-C523F728355C"></a><h4 id="RACAD-GUID-131BD138-21E6-4CAF-B37E-C523F728355C" class="sect4">Autolocation for Backup and Restore Commands</h4>
                  <div>
                     <p>RMAN automatically performs autolocation of all files that it must back up or restore. If you use the noncluster file system local archiving scheme, then a node can only read the archived redo logs that were generated by an instance on that node. RMAN never attempts to back up archived redo logs on a channel it cannot read. </p>
                     <p>During a restore operation, RMAN automatically performs the autolocation of backups. A channel connected to a specific node only attempts to restore files that were backed up to the node. For example, assume that log sequence 1001 is backed up to the drive attached to <code class="codeph">node1</code>, while log 1002 is backed up to the drive attached to <code class="codeph">node2</code>. If you then allocate channels that connect to each node, then the channel connected to <code class="codeph">node1</code> can restore log 1001 (but not 1002), and the channel connected to <code class="codeph">node2</code> can restore log 1002 (but not 1001).
                     </p>
                  </div>
               </div>
            </div><a id="RACAD881"></a><div class="sect2"><a id="GUID-C0372EC9-CF9A-48E3-964A-33373042B502" name="GUID-C0372EC9-CF9A-48E3-964A-33373042B502"></a><h3 id="RACAD-GUID-C0372EC9-CF9A-48E3-964A-33373042B502" class="sect3">Media Recovery in Oracle RAC</h3>
               <div>
                  <p><a id="d35780e2637" class="indexterm-anchor"></a>Media recovery must be user-initiated through a client application, whereas instance recovery is automatically performed by the database. In these situations, use RMAN to restore backups of the data files and then <a id="d35780e2642" class="indexterm-anchor"></a>recover the database. The procedures for RMAN media recovery in Oracle RAC environments do not differ substantially from the media recovery procedures for noncluster environments.
                  </p>
                  <p>The node that performs the recovery must be able to restore all of the required data files. That node must also be able to either read all of the required archived redo logs on disk or be able to restore them from backups.</p>
                  <p>When recovering a database with encrypted tablespaces (for example after a <code class="codeph">SHUTDOWN ABORT</code> or a catastrophic error that brings down the database instance), you must open the Oracle Wallet after database mount and before you open the database, so the recovery process can decrypt data blocks and redo.
                  </p>
               </div>
            </div><a id="RACAD066"></a><div class="sect2"><a id="GUID-A0CE341E-26E4-443D-806B-A821B7648495" name="GUID-A0CE341E-26E4-443D-806B-A821B7648495"></a><h3 id="RACAD-GUID-A0CE341E-26E4-443D-806B-A821B7648495" class="sect3">Parallel Recovery in Oracle RAC</h3>
               <div>
                  <p>Oracle Database automatically selects the optimum degree of parallelism for instance, crash, and media recovery.</p>
                  <p>Oracle Database applies archived redo logs using an optimal number of parallel processes based on the availability of CPUs. You can use parallel instance recovery and parallel media recovery in Oracle RAC databases as described under the following topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="managing-backup-and-recovery.html#GUID-35D3CDF6-1F32-436D-822A-8558807910B1">Parallel Recovery with RMAN</a></p>
                     </li>
                     <li>
                        <p><a href="managing-backup-and-recovery.html#GUID-0FEDEDB5-4DAB-477A-9ADB-CCA89F253696">Disabling Parallel Recovery</a></p>
                     </li>
                  </ul>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="../bradv/introduction-backup-recovery.html#BRADV-GUID-9997EF87-B293-44D4-92F3-DD938E79170D" target="_blank"><span><cite>Oracle Database Backup and Recovery User’s Guide</cite></span></a></li>
                     </ul>
                  </div>
               </div><a id="RACAD7706"></a><a id="RACAD7707"></a><a id="RACAD7708"></a><a id="RACAD890"></a><div class="sect3"><a id="GUID-35D3CDF6-1F32-436D-822A-8558807910B1" name="GUID-35D3CDF6-1F32-436D-822A-8558807910B1"></a><h4 id="RACAD-GUID-35D3CDF6-1F32-436D-822A-8558807910B1" class="sect4">Parallel Recovery with RMAN</h4>
                  <div>
                     <p>With RMAN's <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands, Oracle Database automatically makes parallel the following three stages of recovery:
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-35D3CDF6-1F32-436D-822A-8558807910B1__GUID-4E833133-7D17-4922-8E48-FC646BE84381"><span class="bold">Restoring Data Files</span></p>
                     </div>
                     <!-- class="section" -->
                     <p>When restoring data files, the number of channels you allocate in the RMAN recover script effectively sets the parallelism that RMAN uses. For example, if you allocate five channels, you can have up to five parallel streams restoring data files.</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-35D3CDF6-1F32-436D-822A-8558807910B1__GUID-E8DFA675-12B6-49DA-9D45-CB0593AA3882"><span class="bold">Applying Incremental Backups</span></p>
                     </div>
                     <!-- class="section" -->
                     <p>Similarly, when you are applying incremental backups, the number of channels you allocate determines the potential parallelism.</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-35D3CDF6-1F32-436D-822A-8558807910B1__GUID-0967CAF4-9273-4528-9233-19CD7E712718"><span class="bold">Applying Archived Redo Logs</span></p>
                     </div>
                     <!-- class="section" -->
                     <p>With RMAN, the application of <a id="d35780e2984" class="indexterm-anchor"></a>archived redo logs is performed in parallel. Oracle Database automatically selects the optimum degree of parallelism based on available CPU resources.
                     </p>
                  </div>
               </div><a id="RACAD892"></a><div class="sect3"><a id="GUID-0FEDEDB5-4DAB-477A-9ADB-CCA89F253696" name="GUID-0FEDEDB5-4DAB-477A-9ADB-CCA89F253696"></a><h4 id="RACAD-GUID-0FEDEDB5-4DAB-477A-9ADB-CCA89F253696" class="sect4">Disabling Parallel Recovery</h4>
                  <div>
                     <p>You can override <a id="d35780e3131" class="indexterm-anchor"></a>parallel recovery using the procedures under the following topics:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="managing-backup-and-recovery.html#GUID-D618E45B-DEA9-4442-B9A3-71685E45A4FA">Disabling Instance and Crash Recovery Parallelism</a></p>
                        </li>
                        <li>
                           <p><a href="managing-backup-and-recovery.html#GUID-2DEFFCB4-F5E9-4C84-9547-161F15A0A0C0">Disabling Media Recovery Parallelism</a></p>
                        </li>
                     </ul>
                  </div><a id="RACAD7338"></a><div class="sect4"><a id="GUID-D618E45B-DEA9-4442-B9A3-71685E45A4FA" name="GUID-D618E45B-DEA9-4442-B9A3-71685E45A4FA"></a><h5 id="RACAD-GUID-D618E45B-DEA9-4442-B9A3-71685E45A4FA" class="sect5">Disabling Instance and Crash Recovery Parallelism</h5>
                     <div>
                        <p><a id="d35780e3287" class="indexterm-anchor"></a><a id="d35780e3291" class="indexterm-anchor"></a>To disable parallel instance and crash recovery on a system with multiple CPUs, set the <a id="d35780e3294" class="indexterm-anchor"></a><a id="d35780e3296" class="indexterm-anchor"></a><code class="codeph">RECOVERY_PARALLELISM</code> parameter in the database initialization parameter file, SPFILE, to <code class="codeph">0</code> or <code class="codeph">1</code>.
                        </p>
                     </div>
                  </div><a id="RACAD7072"></a><div class="sect4"><a id="GUID-2DEFFCB4-F5E9-4C84-9547-161F15A0A0C0" name="GUID-2DEFFCB4-F5E9-4C84-9547-161F15A0A0C0"></a><h5 id="RACAD-GUID-2DEFFCB4-F5E9-4C84-9547-161F15A0A0C0" class="sect5">Disabling Media Recovery Parallelism</h5>
                     <div>
                        <p>Use the <code class="codeph">NOPARALLEL</code> clause of the RMAN <code class="codeph">RECOVER</code> command or the <code class="codeph">ALTER DATABASE RECOVER</code> statement to force Oracle Database to use non-parallel media recovery.
                        </p>
                     </div>
                  </div>
               </div>
            </div><a id="RACAD895"></a><div class="sect2"><a id="GUID-4EE42D1E-32CB-4C60-ADBA-333901E4E710" name="GUID-4EE42D1E-32CB-4C60-ADBA-333901E4E710"></a><h3 id="RACAD-GUID-4EE42D1E-32CB-4C60-ADBA-333901E4E710" class="sect3">Using a Fast Recovery Area in Oracle RAC</h3>
               <div>
                  <p>To use a fast recovery area in Oracle RAC, you must place it on an Oracle ASM disk group, on a Cluster File System, or on a shared directory that is configured through a network file system file for each Oracle RAC instance.</p>
                  <p>In other words, the fast recovery area must be shared among all of the instances of an Oracle RAC database. In addition, set the parameter <code class="codeph">DB_RECOVERY_FILE_DEST</code> to the same value on all instances.
                  </p>
                  <p>Oracle Enterprise Manager enables you to set up a fast recovery area. To use this feature:</p>
                  <ol>
                     <li>
                        <p>From the Cluster Database home page, click the <span class="bold">Maintenance</span> tab.
                        </p>
                     </li>
                     <li>
                        <p>Under the Backup/Recovery options list, click <span class="bold">Configure Recovery Settings</span>.
                        </p>
                     </li>
                     <li>
                        <p>Specify your requirements in the Fast Recovery Area section of the page.</p>
                     </li>
                     <li>
                        <p>Click <span class="bold">Help</span> on this page for more information.
                        </p>
                     </li>
                  </ol>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="../bradv/configuring-rman-client-basic.html#BRADV-GUID-302339EC-EE0F-45FB-9862-BB2BA138AA13" target="_blank"><span><cite>Oracle Database Backup and Recovery User’s Guide</cite></span></a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>