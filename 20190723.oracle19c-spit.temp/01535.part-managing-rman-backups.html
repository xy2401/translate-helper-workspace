<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Managing RMAN Backups</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Backup and Recovery User's Guide">
      <meta property="og:description" content>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Backup and Recovery User's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96241-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="backing-up-database-advanced.html" title="Previous" type="text/html">
      <link rel="next" href="reporting-rman-operations.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User's Guide">
    <meta name="dcterms.isVersionOf" content="BRADV">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="backing-up-database-advanced.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="reporting-rman-operations.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Backup and Recovery User's Guide</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Managing RMAN Backups </li>
            </ol>
            <a id="GUID-9B9779FA-2C8B-4D11-AC3B-F6FFA95AE2D1" name="GUID-9B9779FA-2C8B-4D11-AC3B-F6FFA95AE2D1"></a><a id="BRADV273"></a>
            
            <h2 id="BRADV-GUID-9B9779FA-2C8B-4D11-AC3B-F6FFA95AE2D1" class="sect2"><span class="enumeration_part">Part IV </span> Managing RMAN Backups 
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>The following chapters describe how to manage RMAN backups. This part of the book contains these chapters:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="reporting-rman-operations.html#GUID-550638CC-0D16-4B1A-83C7-5D10181DC7C1" title="As part of your backup and recovery strategy, you should periodically run reports that indicate what you have backed up. You can determine which data files need backups or which files were not backed up recently. Also, you can preview which backups RMAN must restore if a problem occurs.RMAN stores metadata of every database on which it performs operations.In a Data Guard environment, you can use the LIST, REPORT, and SHOW commands just as you can when not using Data Guard. You can run these commands with the FOR DB_UNIQUE_NAME clause to show the backups associated with a specified database. The LIST command uses the information in the RMAN repository to provide lists of backups and other objects relating to backup and recovery. The primary purpose of the LIST command is to list backup and copies. Specify the desired objects with the listObjList or recordSpec clause. If you do not specify an object, then RMAN displays copies of all database files and archived redo log files.You can specify several different conditions to narrow your LIST output.Use the LIST command to list preplugin backups and preplugin archived redo log files.Each time an OPEN RESETLOGS operation is performed on a database, this operation creates a new incarnation of the database.The RMAN REPORT command analyzes the available backups and your database. The REPORT command provides various reports of RMAN backups.Use the REPORT NEED BACKUP command to determine which database files need backup under a specific retention policy. You can use options of the REPORT NEED BACKUP command to specify different retention policies.The REPORT NEED BACKUP command can check the entire database, skip specified tablespaces, or check only specific tablespaces or data files against different retention policies.You can limit the backups tested by the REPORT NEED BACKUP command to disk-based or tape-based backups only.When a data file has been changed by an unrecoverable operation, such as a direct load insert, normal media recovery cannot be used to recover the file, because an unrecoverable operation does not generate redo. You must perform either a full or incremental backup of affected data files after such operations, to ensure that data blocks affected by the unrecoverable operation can be recovered using RMAN.You can report backup sets, backup pieces, and data file copies that are obsolete that is, not needed to meet a specified retention policy by specifying the OBSOLETE keyword. The REPORT SCHEMA command lists and displays information about the database files, tablespaces, and so on. You can view reports on the metadata related to a multitenant container database (CDB), the root only, or one or more pluggable databases (PDBs). Use the LIST command with the GUID option to list backups of pluggable databases (PDBs) that have been dropped from a multitenant container database (CDB).In some cases, V$ views supply information that is not available through use of the LIST and REPORT commands. An RMAN job is the set of commands executed within an RMAN session. Thus, one RMAN job can contain multiple commands. The ENCRYPTED column of the V$BACKUP_PIECE and V$RMAN_BACKUP_PIECE views indicates whether a backup piece is encrypted (YES) or unencrypted (NO).The LIST, REPORT, and SHOW commands provide the easiest means of accessing the data in the control file and the recovery catalog. RMAN obtains backup and recovery metadata from a target database control file and stores it in the tables of the recovery catalog. The recovery catalog views are derived from these tables. The recovery catalog views are not normalized or optimized for user queries.Most recovery catalog views contain the columns DB_KEY and DBINC_KEY. Each database registered in the recovery catalog can be uniquely identified by either the primary key, which is the DB_KEY column value, or the DBID, which is the 32-bit unique database identifier. Each incarnation of a database is uniquely identified by the DBINC_KEY column.Special considerations apply when querying the recovery catalog in a Data Guard environment. The DB_KEY value, which is the primary key for a registered database, is used only in the recovery catalog. The easiest way is to obtain the DB_KEY is to use the DBID of the target database, which is displayed whenever you connect RMAN to a database as TARGET. You can query the view RC_BACKUP_FILES for information about all backups of any database registered in the recovery catalog. Before querying RC_BACKUP_FILES, however, you must call the DBMS_RCVMAN.SETDATABASE procedure.">Reporting on RMAN Operations</a></p>
                  </li>
                  <li>
                     <p><a href="maintaining-rman-backups.html#GUID-F5C3D045-279B-4AB3-8A91-3231A716402C" title="The recommended maintenance strategy is to configure a fast recovery area, a backup retention policy, and an archived redo log deletion policy. In this case, the database automatically maintains and deletes backups and archived redo logs as needed. However, manual maintenance of database backups and archived redo logs is sometimes necessary.RMAN provides multiple commands to maintain RMAN backups and repository records.RMAN always stores its metadata in the control file of each target database on which it performs operations. If you register a target database in the recovery catalog, then RMAN stores the metadata for this target database in the recovery catalog. The database in a Data Guard environment that creates a backup or copy is associated with the file. For example, if RMAN is connected to target database standby1 and backs it up, then this backup is associated with standby1.For a crosscheck, RMAN can only update the status of a file from AVAILABLE to EXPIRED when connected to the database associated with the file. RMAN can delete files when connected to any database. If RMAN is not connected as TARGET to the database associated with a file, and if RMAN cannot delete a file successfully, then RMAN prompts you to connect as TARGET to the database associated with the file. You must then use DELETE ... FORCE to delete the file metadata.If a maintenance command changes RMAN metadata only, then you can connect RMAN as TARGET to any database in the Data Guard environment. A backup remains associated with a database unless you explicitly use the CHANGE ... RESET DB_UNIQUE_NAME to associate the backup with a different database.RMAN is designed to work without a recovery catalog. If you choose not to use a recovery catalog, however, then the control file of each target database is the exclusive repository for RMAN metadata.The control file contains two types of records: circular reuse records and noncircular reuse records.When a control file record containing information about a file created in the fast recovery area is about to be reused, the database attempts to delete the file from the fast recovery area when the file is eligible for deletion. Otherwise, the database expands the size of the control file section containing the record for this file.The best way to prevent the loss of RMAN metadata because of overwritten control file records is to use a recovery catalog.If you are not using a recovery catalog to store RMAN metadata, then it is doubly important that you protect each target database control file.Although the fast recovery area is largely self-managing, some situations may require database administration intervention.RMAN uses certain rules to determine when files can be deleted from the fast recovery area.You can use the V$RECOVERY_FILE_DEST and V$RECOVERY_AREA_USAGE views to determine whether you have allocated enough space for your fast recovery area.You cannot manage the flashback logs in the fast recovery area directly other than by setting the flashback retention target or using guaranteed restore points.If the RMAN retention policy requires keeping a set of backups larger than the fast recovery area disk quota, or if the retention policy is set to NONE, then the fast recovery area can fill completely with no reclaimable space.Use the ALTER SYSTEM command to change the location of the fast recovery area.The ALTER SYSTEM command can be used to disable the fast recovery area.As a rule, the fast recovery area is self-maintaining. When an instance crashes during the creation of a file in the fast recovery area, however, the database may leave the file in the fast recovery area.Several situations can cause a discrepancy between the repository and the files that it records, including tape or disk failures and user-managed copies or deletions of RMAN-related files.To ensure that data about backups in the recovery catalog or control file is synchronized with corresponding data on disk or in the media management catalog, perform a crosscheck. The CROSSCHECK command operates only on files that are currently recorded in the RMAN repository.Crosschecks update outdated RMAN repository information about backups whose repository records do not match their physical status. For example, if a user removes archived logs from disk with an operating system command, the repository still indicates that the logs are on disk, when in fact they are not.After connecting to the target database and recovery catalog (if you use one), run CROSSCHECK commands as needed to verify the status and availability of backups known to RMAN.You can use the LIST command to report your backups and then use the CROSSCHECK command to check that specific backups described in the LIST output still exist. Use the CROSSCHECK command to verify the status and availability of preplugin backups and preplugin archived redo log files known to RMAN.RMAN provides multiple methods of changing the repository status of backups and copies.Run the CHANGE...UNAVAILABLE command when a backup cannot be found or has migrated offsite.You can designate backups as exempt from the retention policy. This technique is useful for archiving backups to comply with business requirements.Use the CHANGE command with the GUID option to change the status of backups that correspond to pluggable databases (PDBs) that have been dropped from a multitenant container database (CDB).Use the CHANGE command to modify the repository status of preplugin backups and preplugin archived redo log files.You can use the CATALOG command to make RMAN aware of the existence of archived logs not recorded in the repository or copies of database files that are created through means other than RMAN. The target database control file keeps records of all archived redo logs generated by the target database and all RMAN backups. The purpose of the CATALOG command is to add metadata to the repository when it does not have a record of files for RMAN to manage.Use the CATALOG command to propagate information about user-managed copies to the RMAN repository. After the files are cataloged, you can run the LIST command or query V$BACKUP_FILES view to confirm the information is contained in the RMAN repository.You can catalog backup pieces on disk. This technique is useful if you use an operating system utility to copy backup pieces from one location to another on the same host, or from one host to another. If you use Automatic Storage Management (ASM), an Oracle Managed Files framework, or the fast recovery area, then you may want to recatalog files that are known to the disk management system but are no longer listed in the RMAN repository. This situation can occur when the intended mechanism for tracking file names fails due to media failure, software bug, or user error.Use the CATALOG command to add preplugin archived redo log files to the RMAN repository.You can remove records for files from the RMAN repository.You can use the CHANGE ... UNCATALOG command to update the RMAN repository for the absent files.You can use the RMAN DELETE command to delete archived redo logs and RMAN backups. Every RMAN backup produces a corresponding record in the RMAN repository. This record is stored in the control file. If a recovery catalog is used, then the record can also be found in the recovery catalog after the recovery catalog is resynchronized from the control file. You can delete backups and recovery catalog records for backups.The recommended maintenance strategy is to configure a fast recovery area, a backup retention policy, and an archived redo log deletion policy.Use the RMAN DELETE command to delete backups and image copies.You can use both the DELETE and BACKUP ... DELETE commands to delete specific backups and copies.You can use BACKUP ... DELETE to back up archived redo logs, data file copies, or backup sets and then delete the input files after successfully backing them up. If you run CROSSCHECK, and if RMAN cannot locate the files, then it updates their records in the RMAN repository to EXPIRED status. You can then use the DELETE EXPIRED command to remove records of expired backups and copies from the RMAN repository.The RMAN DELETE command supports an OBSOLETE option, which deletes backups that are no longer needed to satisfy specified recoverability requirements. Use the DELETE command with the GUID option to delete backups of pluggable databases (PDBs) that have been dropped from a multitenant container database (CDB).Use the DELETE command to delete preplugin backups and prelplugin archived redo log files.To remove a database from the operating system, you can use the DROP DATABASE command in RMAN. RMAN removes the server parameter file, all data files, online redo logs, and control files belonging to the target database."> Maintaining RMAN Backups and Repository&nbsp;Records</a></p>
                  </li>
                  <li>
                     <p><a href="managing-recovery-catalog.html#GUID-E836E243-6620-495B-ACFB-AC0001EF4E89" title="This section explains the basic concepts related to managing a recovery catalog.A recovery catalog is a database schema used by RMAN to store metadata about one or more Oracle databases. Typically, you store the catalog in a dedicated database.The recovery catalog contains metadata about RMAN operations for each registered target database. When RMAN is connected to a recovery catalog, RMAN obtains its metadata exclusively from the catalog.The process of enrolling of a database in a recovery catalog for RMAN use is called registration.The owner of a centralized recovery catalog, which is also called the base recovery catalog, can grant or revoke restricted access to the catalog to other database users. For RMAN operations such as backup, restore, and crosscheck, RMAN always first updates the control file and then propagates the metadata to the recovery catalog. This flow of metadata from the mounted control file to the recovery catalog, which is known as recovery catalog resynchronization, ensures that the metadata that RMAN obtains from the control file is current.You can use a stored script as an alternative to a command file for managing frequently used sequences of RMAN commands. The script is stored in the recovery catalog rather than on the file system.You must use a recovery catalog to manage RMAN metadata for all physical databases, both primary and standby databases, in the Data Guard environment. RMAN uses the recovery catalog as the single source of truth for the Data Guard environment.Managing a recovery catalog consists of creating the catalog and then registering your target databases with the catalog.Creating a recovery catalog consists of multiple phases that includes configuring the recovery catalog database, creating the recovery catalog schema owner, and then creating the catalog. When you use a recovery catalog, RMAN requires that you maintain a recovery catalog schema. The recovery catalog is stored in the default tablespace of the schema. Privileged users such as SYS cannot be the owner of the recovery catalog.You must allocate space to be used by the catalog schema. The size of the recovery catalog schema depends upon the number of databases monitored by the catalog. If you are creating your recovery catalog in an existing database, then add enough room to hold the default tablespace for the recovery catalog schema. After choosing the recovery catalog database and creating the necessary space, you are ready to create the owner of the recovery catalog and grant this user necessary privileges. After creating the catalog owner, create the catalog tables with the RMAN CREATE CATALOG command. The command creates the catalog in the default tablespace of the catalog owner.Registering a target database in the recovery catalog maintains the databaseâ€™s records in the recovery catalog.The process of enrolling of a target database in a recovery catalog is called registration.In a Data Guard environment, the primary and standby databases share the same DBID and database name. To be eligible for registration in the recovery catalog, each database in the Data Guard environment must have different DB_UNIQUE_NAME values.The first step in using a recovery catalog with a target database is registering the target database in the recovery catalog. If you use the catalog in a Data Guard environment, then you can only register the primary database in this way.If you have data file copies, backup pieces, or archived logs on disk, then you can catalog them in the recovery catalog with the CATALOG command. When using a recovery catalog, cataloging older backups that have aged out of the control file lets RMAN use the older backups during restore operations. RMAN provides multiple commands to create and manage virtual private catalogs.RMAN uses the Virtual Private Database (VPD) functionality to implement virtual private catalogs. Creating a virtual private catalog is a multi-step process in which you first create the database user who will own the virtual private catalog and then create the virtual private catalog.To store backup metadata for a target database in a virtual private catalog, you must register the database with the virtual private catalog.After you create a virtual private catalog, you can revoke catalog access privileges as necessary.This section describes how to use the UPGRADE CATALOG command to upgrade a virtual private catalog.Include the recovery catalog database in your backup and recovery strategy. If you do not back up the recovery catalog and a disk failure occurs that destroys the recovery catalog database, then you may lose the metadata in the catalog. Without the recovery catalog contents, recovery of your other databases is likely to be more difficult.A single recovery catalog can store metadata for multiple target databases. Consequently, loss of the recovery catalog can be disastrous. You must back up the recovery catalog frequently.The recovery catalog database is a database like any other, and is also a key part of your backup and recovery strategy. Protect the recovery catalog like any other part of your database, by backing it up. The backup strategy for your recovery catalog database is part of an overall backup and recovery strategy.When backing up the recovery catalog database, you can use RMAN to make the backups. A recovery catalog is only effective when separated from the data that it is designed to protect. Thus, you must never store a recovery catalog containing the RMAN repository for a database in the same database as the target database. Also, do not store the catalog database on the same disks as the target database.Logical backups of the RMAN recovery catalog created with the Data Pump Export utility can be a useful supplement for physical backups. Restoring and recovering the recovery catalog database is much like restoring and recovering any other database with RMAN. You can create and store scripts in the recovery catalog. You can use a stored script as an alternative to a command file for managing frequently used sequences of RMAN commands. The script is stored in the recovery catalog rather than on the file system.You can use the CREATE SCRIPT command to create a stored script. To update stored scripts, use the REPLACE SCRIPT command. Use the EXECUTE SCRIPT command to run a stored script. You can specify substitution variables in the CREATE SCRIPT command.The PRINT SCRIPT command displays a stored script or writes it out to a file. Use the LIST ... SCRIPT NAMES command to display the names of scripts defined in the recovery catalog. Use the DELETE GLOBAL SCRIPT command to delete a stored script from the recovery catalog.To run the RMAN client and start a stored script in the recovery catalog on startup, use the SCRIPT argument when starting the RMAN client.Maintaining the recovery catalog consists of tasks such as resynchronizing, updating, and upgrading the recovery catalog.After you have created a recovery catalog and registered your target databases, you must maintain this catalog.When RMAN performs a resynchronization, it compares the recovery catalog to either the current or backup control file of the target database and updates the catalog with metadata that is missing or changed. Resynchronization of the recovery catalog ensures that the metadata that RMAN obtains from the control file stays current. Resynchronizations can be full or partial. RMAN only automatically resynchronizes the recovery catalog with a database when connected to this database as TARGET. Thus, RMAN does not automatically resynchronize every database in a Data Guard environment when connected as TARGET to one database in the environment.RMAN automatically resynchronizes the recovery catalog when RMAN is connected to a target database and recovery catalog and you have executed RMAN commands. If the recovery catalog is unavailable when you issue RMAN commands that cause a partial resynchronization, then open the catalog database later and resynchronize it manually with the RESYNC CATALOG command. You can create or change an RMAN configuration for a standby database even when not connected to this database as TARGET. Your goal is to ensure that the metadata in the recovery catalog is current. Because the recovery catalog obtains its metadata from the target control file, the currency of the data in the catalog depends on the currency of the data in the control file. You must make sure that the backup metadata in the control file is recorded in the catalog before it is overwritten with new records.Use RESYNC CATALOG to force a full resynchronization of the recovery catalog with a target database control file. You may decide to change the DB_UNIQUE_NAME of a database in a Data Guard environment. In this case, you can run the CHANGE DB_UNIQUE_NAME command to associate the metadata stored in recovery catalog for the old DB_UNIQUE_NAME to the new DB_UNIQUE_NAME.You can use the UNREGISTER DATABASE command to unregister a database from the recovery catalog. Use the UNREGISTER DATABASE command to unregister a target database.The UNREGISTER command supports a DB_UNIQUE_NAME clause for use in a Data Guard environment. You can use this clause to remove metadata for a specific database.In a Zero Data Loss Recovery Appliance (Recovery Appliance) environment, the UNREGISTER DATABASE command cannot be used to unregister a protected database from the Recovery Appliance catalog. Instead, use the DBMS_RA.DELETE_DB procedure.You create an incarnation of the database when you open the database with the RESETLOGS option. You can access a record of the new incarnation in the V$DATABASE_INCARNATION view.This section explains what a recovery catalog upgrade is and when you must do it.If you are upgrading to Oracle Database 12c Release 1 (12.1.0.2) or later, then the recovery catalog database must use the Enterprise Edition of Oracle Database.Assume that you upgrade the recovery catalog schema to Oracle Database 11g or later in a Data Guard environment. When RMAN connects to a standby database, it automatically registers the new database information and resynchronizes to obtain the file names from the control file.The schema version of the recovery catalog is stored in the recovery catalog itself. The information is important in case you maintain multiple databases of different versions in your production system, and you must determine whether the catalog schema version is usable with a specific target database version.This scenario assumes that you are upgrading a recovery catalog schema to the current version. You can use the IMPORT CATALOG command in RMAN to merge one recovery catalog schema into another. When using IMPORT CATALOG, the source catalog schema is the catalog schema to import into a different schema. The destination catalog schema is the catalog schema into which you intend to import the source catalog schema.In a Recovery Appliance environment, a single, centrally-managed Recovery Appliance catalog residing on the Recovery Appliance is shared by all the protected databases. This catalog must be used by all protected databases that send backups to Recovery Appliance.A target database, recovery catalog database, and recovery catalog schema can be at different database versions. The recommended practice is to import all existing recovery catalogs into a single recovery catalog at the latest version of the recovery catalog schema. When importing one recovery catalog into another, no connection to a target database is necessary. RMAN only needs connectivity to the source and destination catalogs.The procedure for moving a recovery catalog from one database to another is a variation of the procedure for importing a catalog. The DROP CATALOG command removes those objects that were created by the CREATE CATALOG command. If the user who owns the recovery catalog also owns objects that were not created by CREATE CATALOG, then the DROP CATALOG command does not remove these objects.">	 Managing a Recovery Catalog</a></p>
                  </li>
               </ul>
            </div>
         </div>
      </article>
   </body>
</html>