<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Distributed Transactions</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="JDBC Developer's Guide">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="JDBC Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="jdbc-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-02-13T13:20:37-08:00">
      <meta name="dcterms.title" content="JDBC Developer's Guide">
      <meta name="dcterms.dateCopyrighted" content="1999, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96471-02">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="transaction-management.html" title="Previous" type="text/html">
      <link rel="next" href="manageability.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="JJDBC">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="transaction-management.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="manageability.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">JDBC Developer's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="transaction-management.html" property="item" typeof="WebPage"><span property="name"> Transaction Management </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Distributed Transactions </li>
            </ol>
            <a id="GUID-FD21627C-0183-4AF3-8719-8490F069A41E" name="GUID-FD21627C-0183-4AF3-8719-8490F069A41E"></a><a id="JJDBC28000"></a>
            
            <h2 id="JJDBC-GUID-FD21627C-0183-4AF3-8719-8490F069A41E" class="sect2"><span class="enumeration_chapter">33 </span> Distributed Transactions 
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>This chapter discusses the Oracle Java Database Connectivity (JDBC) implementation of distributed transactions. These are multiphased transactions, often using multiple databases, which must be committed in a coordinated way. There is also related discussion of XA, which is a general standard, and not specific to Java, for distributed transactions.</p>
               <p>The following topics are discussed:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="distributed-transactions.html#GUID-78C5DAB6-46E5-44A4-9EC8-1149FDA176AB">AboutDistributed Transactions</a></p>
                  </li>
                  <li>
                     <p><a href="distributed-transactions.html#GUID-178456B8-4C4E-43BB-9097-DF2F269513CB">XA Components</a></p>
                  </li>
                  <li>
                     <p><a href="distributed-transactions.html#GUID-EAB7ACFA-5708-4608-B94D-0D9ECE391D67">Error Handling and Optimizations</a></p>
                  </li>
                  <li>
                     <p><a href="distributed-transactions.html#GUID-A1736524-8CB5-4965-89E3-C65C3861E784">About Implementing a Distributed Transaction</a></p>
                  </li>
                  <li>
                     <p><a href="distributed-transactions.html#GUID-1EF2D070-305D-49D9-9124-16FFDF7CCF74">Native-XA in Oracle JDBC Drivers</a></p>
                  </li>
               </ul>
               <div class="infoboxnote" id="GUID-FD21627C-0183-4AF3-8719-8490F069A41E__GUID-91D5AE93-7677-4312-838E-BF70C3A367DE">
                  <p class="notep1">Note:</p>
                  <p>This chapter discusses features of the JDBC 2.0 Optional Package, formerly known as the JDBC 2.0 Standard Extension application programming interface (API) that is available through the <code class="codeph">javax</code> packages.
                  </p>
               </div>
               <p>For further introductory and general information about distributed transactions, refer to the specifications for the JDBC 2.0 Optional Package and the Java Transaction API (JTA).</p>
            </div><a id="JJDBC28843"></a><div class="props_rev_3"><a id="GUID-78C5DAB6-46E5-44A4-9EC8-1149FDA176AB" name="GUID-78C5DAB6-46E5-44A4-9EC8-1149FDA176AB"></a><h3 id="JJDBC-GUID-78C5DAB6-46E5-44A4-9EC8-1149FDA176AB" class="sect3"><span class="enumeration_section">33.1 </span>About Distributed Transactions
               </h3>
               <div>
                  <p>The section covers the following topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="distributed-transactions.html#GUID-ECD0D367-582D-40F1-99E9-D76ABA451B23">Overview of Distributed Transaction</a></p>
                     </li>
                     <li>
                        <p><a href="distributed-transactions.html#GUID-1E5899A5-1977-4B25-A98A-B9AC0837EADF">Distributed Transaction Components and Scenarios</a></p>
                     </li>
                     <li>
                        <p><a href="distributed-transactions.html#GUID-D80FEF14-8360-4E0A-B950-AA5B56E98DE8">Distributed Transaction Concepts</a></p>
                     </li>
                     <li>
                        <p><a href="distributed-transactions.html#GUID-C6290011-D20A-41BD-9FA5-FEDBCD9B4F17">About Switching Between Global and Local Transactions</a></p>
                     </li>
                     <li>
                        <p><a href="distributed-transactions.html#GUID-B5EBFDDD-5A19-43C8-A2B7-6838F752800E">Oracle XA Packages</a></p>
                     </li>
                  </ul>
               </div>
               <div class="props_rev_3"><a id="GUID-ECD0D367-582D-40F1-99E9-D76ABA451B23" name="GUID-ECD0D367-582D-40F1-99E9-D76ABA451B23"></a><h4 id="JJDBC-GUID-ECD0D367-582D-40F1-99E9-D76ABA451B23" class="sect4"><span class="enumeration_section">33.1.1 </span>Overview of Distributed Transaction
                  </h4>
                  <div>
                     <p>A <span class="bold">distributed transaction</span>, sometimes referred to as a <span class="bold">global transaction</span>, is a set of two or more related transactions that must be managed in a coordinated way. The transactions that constitute a distributed transaction might be in the same database, but more typically are in different databases and often in different locations. Each individual transaction of a distributed transaction is referred to as a <span class="bold">transaction branch</span>.
                     </p>
                     <p>For example, a distributed transaction might consist of money being transferred from an account in one bank to an account in another bank. You would not want either transaction committed without assurance that both will complete successfully.</p>
                     <p>In JDBC, distributed transaction functionality is built on top of connection pooling functionality. This distributed transaction functionality is also built upon the open XA standard for distributed transactions. X<a id="d80952e156" class="indexterm-anchor"></a>A is part of the X/Open standard and is not specific to Java.
                     </p>
                     <p>JDBC is used to connect to database resources. However, to include all changes to multiple databases within a transaction, you must use the JDBC connections within a JTA global transaction. The process of including database SQL updates within a transaction is referred to as enlisting a database resource.</p>
                  </div>
               </div><a id="JJDBC28844"></a><div class="props_rev_3"><a id="GUID-1E5899A5-1977-4B25-A98A-B9AC0837EADF" name="GUID-1E5899A5-1977-4B25-A98A-B9AC0837EADF"></a><h4 id="JJDBC-GUID-1E5899A5-1977-4B25-A98A-B9AC0837EADF" class="sect4"><span class="enumeration_section">33.1.2 </span>Distributed Transaction Components and Scenarios
                  </h4>
                  <div>
                     <div class="section">
                        <p>In reading the remainder of the distributed transactions section, it will be helpful to keep the following points in mind:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>A distributed transaction system typically relies on an external trans<a id="d80952e198" class="indexterm-anchor"></a>action manager, such as a software component that implements standard JTA functionality, to coordinate the individual transactions.
                              </p>
                              <p>Many vendors offer XA-compliant JTA modules, including Oracle, which includes JTA in Oracle9<span class="italic">i</span> Application Server and Oracle Application Server 10<span class="italic">g</span>.
                              </p>
                           </li>
                           <li>
                              <p>XA functionality is usually isolated from a client application, being implemented instead in a middle-tier environment, such as an application server. </p>
                              <p>In many scenarios, the application server and transaction manager will be together on the middle tier, possibly together with some of the application code as well.</p>
                           </li>
                           <li>
                              <p>Discussion throughout this section is intended mostly for middle-tier developers.</p>
                           </li>
                           <li>
                              <p>The term resour<a id="d80952e220" class="indexterm-anchor"></a>ce manager is often used in discussing distributed transactions. A resource manager is simply an entity that manages data or some other kind of resource. Wherever the term is used in this chapter, it refers to a database.
                              </p>
                              <div class="infoboxnote" id="GUID-1E5899A5-1977-4B25-A98A-B9AC0837EADF__GUID-7B743D14-3A5F-4F39-9B41-EBBC30EBB2E5">
                                 <p class="notep1">Note:</p>
                                 <p>Using JTA functionality requires <code class="codeph">jta.jar</code> to be in the <code class="codeph">CLASSPATH</code> environment variable. This file is located at <span class="italic"><code class="codeph">ORACLE_HOME</code></span><code class="codeph">/jlib</code>. Oracle includes this file with the JDBC product.
                                 </p>
                              </div>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="JJDBC28845"></a><div class="props_rev_3"><a id="GUID-D80FEF14-8360-4E0A-B950-AA5B56E98DE8" name="GUID-D80FEF14-8360-4E0A-B950-AA5B56E98DE8"></a><h4 id="JJDBC-GUID-D80FEF14-8360-4E0A-B950-AA5B56E98DE8" class="sect4"><span class="enumeration_section">33.1.3 </span>Distributed Transaction Concepts
                  </h4>
                  <div>
                     <div class="section">
                        <p>When you use XA functionality, the transaction manager uses XA resource instances to prepare and coordinate each transaction branch and then to commit or roll back all transaction branches appropriately.</p>
                        <p>XA functionality includes the following key components:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>XA <a id="d80952e276" class="indexterm-anchor"></a>data sources
                              </p>
                              <p>These are extensions of connection pool data sources and other data sources, and similar in concept and functionality. </p>
                              <p>There will be one XA data source instance for each resource manager that will be used in the distributed transaction. You will typically create XA data source instances in your middle-tier software.</p>
                              <p>XA data sources produce XA connections.</p>
                           </li>
                           <li>
                              <p>XA con<a id="d80952e290" class="indexterm-anchor"></a>nections
                              </p>
                              <p>These are extensions of pooled connections and similar in concept and functionality. An XA connection encapsulates a physical database connection. Individual connection instances are temporary handles to these physical connections. </p>
                              <p>An XA connection instance corresponds to a single Oracle session, although the session can be used in sequence by multiple logical connection instances, as with pooled connection instances.</p>
                              <p>You will typically get an XA connection instance from an XA data source instance in your middle-tier software. You can get multiple XA connection instances from a single XA data source instance if the distributed transaction will involve multiple sessions in the same database.</p>
                              <p>XA connections produce <code class="codeph">OracleXAResource</code> instances and JDBC connection instances. 
                              </p>
                           </li>
                           <li>
                              <p>XA res<a id="d80952e309" class="indexterm-anchor"></a>ources
                              </p>
                              <p>These are used by a transaction manager in coordinating the transaction branches of a distributed transaction.</p>
                              <p>You will get one <code class="codeph">OracleXAResource</code> instance from each XA connection instance, typically in your middle-tier software. There is a one-to-one correlation between <code class="codeph">OracleXAResource</code> instances and XA connection instances. Equivalently, there is a one-to-one correlation between <code class="codeph">OracleXAResource</code> instances and Oracle sessions.
                              </p>
                              <p>In a typical scenario, the middle-tier component will hand off <code class="codeph">OracleXAResource</code> instances to the transaction manager, for use in coordinating distributed transactions. 
                              </p>
                              <p>Each <code class="codeph">OracleXAResource</code> instance corresponds to a single Oracle session. So, there can be only a single active transaction branch associated with an <code class="codeph">OracleXAResource</code> instance at any given time. However, there can be additional suspended transaction branches.
                              </p>
                              <p>Each <code class="codeph">OracleXAResource</code> instance has the functionality to start, end, prepare, commit, or roll back the operations of the transaction branch running in the session with which the <code class="codeph">OracleXAResource</code> instance is associated. 
                              </p>
                              <p>The prepare step is the first step of a two-phase commit operation. The transaction manager will issue a <code class="codeph">PREPARE</code> to each <code class="codeph">OracleXAResource</code> instance. Once the transaction manager sees that the operations of each transaction branch have prepared successfully, it will issue a <code class="codeph">COMMIT</code> to each <code class="codeph">OracleXAResource</code> instance to commit all the changes.
                              </p>
                           </li>
                           <li>
                              <p>Transactio<a id="d80952e365" class="indexterm-anchor"></a>n IDs
                              </p>
                              <p>These are used to identify transaction branches. Each ID includes a transaction branch ID component and a distributed transaction ID component. This is how a branch is associated with a distributed transaction. All <code class="codeph">OracleXAResource</code> instances associated with a given distributed transaction would have a transaction ID that includes the same distributed transaction ID component.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">OracleXAResource.ORATRANSLOOSE</code></p>
                              <p>Start a loosely coupled transaction with transaction ID <code class="codeph">xid</code>.
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="JJDBC28847"></a><a id="JJDBC28848"></a><a id="JJDBC28846"></a><div class="props_rev_3"><a id="GUID-C6290011-D20A-41BD-9FA5-FEDBCD9B4F17" name="GUID-C6290011-D20A-41BD-9FA5-FEDBCD9B4F17"></a><h4 id="JJDBC-GUID-C6290011-D20A-41BD-9FA5-FEDBCD9B4F17" class="sect4"><span class="enumeration_section">33.1.4 </span>About Switching Between Global and Local Transactions
                  </h4>
                  <div>
                     <div class="section">
                        <p><a id="d80952e408" class="indexterm-anchor"></a>Applications can share connections between local and global transactions. Applications can also switch connections between local transactions and global transactions.
                        </p>
                        <p>A connection is always in one of the following modes:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">NO_TXN</code></p>
                              <p>No transaction is actively using this connection.</p>
                           </li>
                           <li>
                              <p><code class="codeph">LOCAL_TXN</code></p>
                              <p>A local transaction with auto-commit turned off or disabled is actively using this connection.</p>
                           </li>
                           <li>
                              <p><code class="codeph">GLOBAL_TXN</code></p>
                              <p>A global transaction is actively using this connection.</p>
                           </li>
                        </ul>
                        <p>Each connection switches automatically between these modes depending on the operations carried out on the connection. A connection is always in <code class="codeph">NO_TXN</code> mode when it is instantiated.
                        </p>
                        <div class="infoboxnote" id="GUID-C6290011-D20A-41BD-9FA5-FEDBCD9B4F17__GUID-51AEDDA8-8DFC-4A24-8C5C-79DE922987B7">
                           <p class="notep1">Note:</p>
                           <p>The modes are maintained internally by the JDBC drivers in association with Oracle Database.</p>
                        </div>
                        <p><a href="distributed-transactions.html#GUID-C6290011-D20A-41BD-9FA5-FEDBCD9B4F17__CHDGEBDI" title="table">Table 33-1</a> describes the connection mode transition rules.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="tblformal" id="GUID-C6290011-D20A-41BD-9FA5-FEDBCD9B4F17__CHDGEBDI">
                        <p class="titleintable">Table 33-1 Connection Mode Transitions</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="Connection Mode Transitions" summary="table" width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="20%" id="d80952e460">Current Mode</th>
                                 <th align="left" valign="bottom" width="27%" id="d80952e463">Switches to  NO_TXN When</th>
                                 <th align="left" valign="bottom" width="25%" id="d80952e468">Switches to LOCAL_TXN When</th>
                                 <th align="left" valign="bottom" width="28%" id="d80952e471">Switches to GLOBAL_TXN When</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d80952e476" headers="d80952e460 ">
                                    <p><code class="codeph">NO_TXN</code></p>
                                 </td>
                                 <td align="left" valign="top" width="27%" headers="d80952e476 d80952e463 ">
                                    <p>NA</p>
                                 </td>
                                 <td align="left" valign="top" width="25%" headers="d80952e476 d80952e468 ">
                                    <p>Auto-commit mode is false and an Oracle data manipulation language (DML) statement is run.</p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d80952e476 d80952e471 ">
                                    <p>The <code class="codeph">start</code> method is called on an <code class="codeph">XAResource</code> obtained from the <code class="codeph">XAconnection</code> that provided the current connection.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d80952e499" headers="d80952e460 ">
                                    <p><code class="codeph">LOCAL_TXN</code></p>
                                 </td>
                                 <td align="left" valign="top" width="27%" headers="d80952e499 d80952e463 ">
                                    <p>Any of the following happens:</p>
                                    <ul style="list-style-type: disc;">
                                       <li>
                                          <p>An Oracle data definition language (DDL) statement is run.</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">commit</code> is called.
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">rollback</code> is called, but without parameters.
                                          </p>
                                       </li>
                                    </ul>
                                 </td>
                                 <td align="left" valign="top" width="25%" headers="d80952e499 d80952e468 ">
                                    <p>NA</p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d80952e499 d80952e471 ">
                                    <p>The <code class="codeph">start</code> method is called on an <code class="codeph">XAResource</code> obtained from the <code class="codeph">XAconnection</code> that provided the current connection. This feature is available starting from Oracle Database 12<span class="italic">c</span> Release 1 (12.1.0.2).
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d80952e539" headers="d80952e460 ">
                                    <p><code class="codeph">GLOBAL_TXN</code></p>
                                 </td>
                                 <td align="left" valign="top" width="27%" headers="d80952e539 d80952e463 ">
                                    <p>Within a global transaction open on this connection, <code class="codeph">end</code> is called on an <code class="codeph">XAResource</code> obtained from the <code class="codeph">XAconnection</code> that provided this connection.
                                    </p>
                                 </td>
                                 <td align="left" valign="top" width="25%" headers="d80952e539 d80952e468 ">
                                    <p>NEVER</p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d80952e539 d80952e471 ">
                                    <p>NA</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="section">
                        <p>If none of these rules is applicable, then the mode does not change.</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-C6290011-D20A-41BD-9FA5-FEDBCD9B4F17__GUID-0BE039EC-D760-467A-9AAC-E900145458EA">Mode Restrictions on Operations</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>The current connection mode restricts which operations are valid within a transaction.</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>In the <code class="codeph">LOCAL_TXN</code> mode, applications must not call <code class="codeph">prepare</code>, <code class="codeph">commit</code>, <code class="codeph">rollback</code>, <code class="codeph">forget</code>, or <code class="codeph">end</code> on an <code class="codeph">XAResource</code>. Doing so causes an <code class="codeph">XAException</code> to be thrown.
                              </p>
                           </li>
                           <li>
                              <p>In the <code class="codeph">GLOBAL_TXN</code> mode, applications must not call <code class="codeph">commit</code>, <code class="codeph">rollback</code>, <code class="codeph">rollback(Savepoint)</code>, <code class="codeph">setAutoCommit(true)</code>, or <code class="codeph">setSavepoint</code> on a <code class="codeph">java.sql.Connection</code>, and must not call <code class="codeph">OracleSetSavepoint</code> or <code class="codeph">oracleRollback</code> on an <code class="codeph">oracle.jdbc.OracleConnection</code>. Doing so causes a <code class="codeph">SQLException</code> to be thrown.
                              </p>
                              <div class="infoboxnote" id="GUID-C6290011-D20A-41BD-9FA5-FEDBCD9B4F17__GUID-B0E41C1E-FDAF-45F2-9BCE-0E5DB459BB89">
                                 <p class="notep1">Note:</p>
                                 <p>This mode-restriction error checking is in addition to the standard error checking on the transaction and savepoint APIs.</p>
                              </div>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="JJDBC28849"></a><div class="props_rev_3"><a id="GUID-B5EBFDDD-5A19-43C8-A2B7-6838F752800E" name="GUID-B5EBFDDD-5A19-43C8-A2B7-6838F752800E"></a><h4 id="JJDBC-GUID-B5EBFDDD-5A19-43C8-A2B7-6838F752800E" class="sect4"><span class="enumeration_section">33.1.5 </span>Oracle XA Packages
                  </h4>
                  <div>
                     <div class="section">
                        <p>Oracle supplies the following three packages that have classes to implement distributed transaction functionality according to the XA standard:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">oracle.jdbc.xa</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">oracle.jdbc.xa.client</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">oracle.jdbc.xa.server</code></p>
                           </li>
                        </ul>
                        <p>Classes for XA data sources, XA connections, and XA resources are in both the <code class="codeph">client</code> package and the <code class="codeph">server</code> package. An abstract class for each is in the top-level package. The <code class="codeph">OracleXid</code> and <code class="codeph">OracleXAException</code> classes are in the top-level <code class="codeph">oracle.jdbc.xa</code> package, because their functionality does not depend on where the code is running. 
                        </p>
                        <p>In middle-tier scenarios, you will import <code class="codeph">OracleXid</code>, <code class="codeph">OracleXAException</code>, and the <code class="codeph">oracle.jdbc.xa.client</code> package.
                        </p>
                        <p>If you intend your XA code to run in the target Oracle Database, however, you will import the <code class="codeph">oracle.jdbc.xa.server</code> package instead of the <code class="codeph">client</code> package.
                        </p>
                        <p>If code that will run inside a target database must also access remote databases, then do not import either package. Instead, you must fully qualify the names of any classes that you use from the <code class="codeph">client</code> package to access a remote database or from the <code class="codeph">server</code> package to access the local database. Class names are duplicated between these packages.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="JJDBC28850"></a><div class="props_rev_3"><a id="GUID-178456B8-4C4E-43BB-9097-DF2F269513CB" name="GUID-178456B8-4C4E-43BB-9097-DF2F269513CB"></a><h3 id="JJDBC-GUID-178456B8-4C4E-43BB-9097-DF2F269513CB" class="sect3"><span class="enumeration_section">33.2 </span>XA Components
               </h3>
               <div>
                  <div class="section">
                     <p>This section discusses the XA components, that is, the standard XA interfaces specified in the JDBC standard, and the Oracle classes that implement them. The following topics are covered:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="distributed-transactions.html#GUID-0600DB23-5DBF-4729-AB20-EDBE71EC6CCB">XADatasource Interface and Oracle Implementation</a></p>
                        </li>
                        <li>
                           <p><a href="distributed-transactions.html#GUID-03941C0D-32EF-49E6-934B-6EB080C5A64D">XAConnection Interface and Oracle Implementation</a></p>
                        </li>
                        <li>
                           <p><a href="distributed-transactions.html#GUID-F7013AB7-8F57-4260-A0F6-E7EAEDFBC063">XAResource Interface and Oracle Implementation</a></p>
                        </li>
                        <li>
                           <p><a href="distributed-transactions.html#GUID-CD752E5A-309E-440A-A711-71083DD5B6A6">OracleXAResource Method Functionality and Input Parameters</a></p>
                        </li>
                        <li>
                           <p><a href="distributed-transactions.html#GUID-4FE2BFF4-9F22-4752-B571-B44D6F220BDC">Xid Interface and Oracle Implementation</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="JJDBC28851"></a><div class="props_rev_3"><a id="GUID-0600DB23-5DBF-4729-AB20-EDBE71EC6CCB" name="GUID-0600DB23-5DBF-4729-AB20-EDBE71EC6CCB"></a><h4 id="JJDBC-GUID-0600DB23-5DBF-4729-AB20-EDBE71EC6CCB" class="sect4"><span class="enumeration_section">33.2.1 </span>XADatasource Interface and Oracle Implementation
                  </h4>
                  <div>
                     <div class="section">
                        <p>The <code class="codeph">javax.sql.XADataSource</code> interface outlines standard functionality of XA data sources, which are factories for XA connections. The overloaded <code class="codeph">getXAConnection</code> method returns an XA connection instance and optionally takes a user name and password as input:
                        </p><pre class="oac_no_warn" dir="ltr">public interface XADataSource
{
   XAConnection getXAConnection() throws SQLException;
   XAConnection getXAConnection(String user, String password)
      throws SQLException;
   ...
}
</pre><p>Oracle JDBC implements the <code class="codeph">XADataSource</code> interface with the <code class="codeph">OracleXADataSource</code> class, located both in the <code class="codeph">oracle.jdbc.xa.client package</code> and the <code class="codeph">oracle.jdbc.xa.server</code> package. 
                        </p>
                        <p>The <code class="codeph">OracleXADataSource</code> classes also extend the <code class="codeph">OracleConnectionPoolDataSource</code> class, which extends the <code class="codeph">OracleDataSource</code> class, and therefore, include all the connection properties.
                        </p>
                        <p>The <code class="codeph">getXAConnection</code> methods of the <code class="codeph">OracleXADataSource</code> class returns the Oracle implementation of XA connection instances, which are <code class="codeph">OracleXAConnection</code> instances.
                        </p>
                        <div class="infoboxnote" id="GUID-0600DB23-5DBF-4729-AB20-EDBE71EC6CCB__GUID-2771AC67-E5A5-40E5-ACE1-A9EB2F90FFED">
                           <p class="notep1">Note:</p>
                           <p>You can register XA data sources in Java Naming Directory and Interface (JNDI) using the same naming conventions as discussed previously for nonpooling data sources.</p>
                        </div>
                        <div class="infoboxnotealso" id="GUID-0600DB23-5DBF-4729-AB20-EDBE71EC6CCB__GUID-D7E220D5-B021-4FB3-958D-B83FC8FB2B97">
                           <p class="notep1">See Also:</p>
                           <p>For information about Fast Connection Failover, refer to <a href="../jjucp/fast-connection-failover.html#JJUCP08100" target="_blank"><span class="italic">Oracle Universal Connection Pool for JDBC Developer's Guide</span></a>.
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="JJDBC28852"></a><div class="props_rev_3"><a id="GUID-03941C0D-32EF-49E6-934B-6EB080C5A64D" name="GUID-03941C0D-32EF-49E6-934B-6EB080C5A64D"></a><h4 id="JJDBC-GUID-03941C0D-32EF-49E6-934B-6EB080C5A64D" class="sect4"><span class="enumeration_section">33.2.2 </span>XAConnection Interface and Oracle Implementation
                  </h4>
                  <div>
                     <div class="section">
                        <p>An XA connection instance, as with a pooled connection instance, encapsulates a physical connection to a database. This would be the database specified in the connection properties of the XA data source instance that produced the XA connection instance.</p>
                        <p>Each XA connection instance also has the facility to produce the <code class="codeph">OracleXAResource</code> instance that will correspond to it for use in coordinating the distributed transaction.
                        </p>
                        <p>An XA connection instance is an instance of a class that implements the standard <code class="codeph">javax.sql.XAConnection</code> interface:
                        </p><pre class="oac_no_warn" dir="ltr">public interface XAConnection extends PooledConnection
{
   javax.jta.xa.XAResource getXAResource() throws SQLException;
}
</pre><p>As you see, the <code class="codeph">XAConnection</code> interface extends the <code class="codeph">javax.sql.PooledConnection</code> interface, so it also includes the <code class="codeph">getConnection</code>, <code class="codeph">close</code>, <code class="codeph">addConnectionEventListener</code>, and <code class="codeph">removeConnectionEventListener</code> methods.
                        </p>
                        <p>Oracle JDBC implements the <code class="codeph">XAConnection</code> interface with the <code class="codeph">OracleXAConnection</code> class, located both in the <code class="codeph">oracle.jdbc.xa.client package</code> and the <code class="codeph">oracle.jdbc.xa.server</code> package. 
                        </p>
                        <p>The <code class="codeph">OracleXAConnection</code> classes also extend the <code class="codeph">OraclePooledConnection</code> class.
                        </p>
                        <p>The <code class="codeph">OracleXAConnection</code> class <code class="codeph">getXAResource</code> method returns the Oracle implementation of an <code class="codeph">OracleXAResource</code> instance, which is an <code class="codeph">OracleXAResource</code> instance. The <code class="codeph">getConnection</code> method returns an <code class="codeph">OracleConnection</code> instance.
                        </p>
                        <p>A JDBC connection instance returned by an XA connection instance acts as a temporary handle to the physical connection, as opposed to encapsulating the physical connection. The physical connection is encapsulated by the XA connection instance. The connection obtained from an <code class="codeph">XAConnection</code> object behaves exactly like a regular connection, until it participates in a global transaction. At that time, auto-commit status is set to <code class="codeph">false</code>. After the global transaction ends, auto-commit status is returned to the value it had before the global transaction. The default auto-commit status on a connection obtained from <code class="codeph">XAConnection</code> is <code class="codeph">false</code> in all releases prior to Oracle Database 10<span class="italic">g</span>. Starting from Oracle Database 10<span class="italic">g</span>, the default status is <code class="codeph">true</code>.
                        </p>
                        <p>Each time an XA connection instance <code class="codeph">getConnection</code> method is called, it returns a new connection instance that exhibits the default behavior, and closes any previous connection instance that still exists and had been returned by the same XA connection instance. However, it is advisable to explicitly close any previous connection instance before opening a new one.
                        </p>
                        <p>Calling the <code class="codeph">close</code> method of an XA connection instance closes the physical connection to the database. This is typically performed in the middle tier.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="JJDBC28853"></a><div class="props_rev_3"><a id="GUID-F7013AB7-8F57-4260-A0F6-E7EAEDFBC063" name="GUID-F7013AB7-8F57-4260-A0F6-E7EAEDFBC063"></a><h4 id="JJDBC-GUID-F7013AB7-8F57-4260-A0F6-E7EAEDFBC063" class="sect4"><span class="enumeration_section">33.2.3 </span>XAResource Interface and Oracle Implementation
                  </h4>
                  <div>
                     <div class="section">
                        <p>The transaction manager uses <code class="codeph">OracleXAResource</code> instances to coordinate all the transaction branches that constitute a distributed transaction.
                        </p>
                        <p>Each <code class="codeph">OracleXAResource</code> instance provides the following key functionality, typically invoked by the transaction manager:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>It associates and disassociates distributed transactions with the transaction branch operating in the XA connection instance that produced this <code class="codeph">OracleXAResource</code> instance. Essentially, it associates distributed transactions with the physical connection or session encapsulated by the XA connection instance. This is done through use of transaction IDs.
                              </p>
                           </li>
                           <li>
                              <p>It performs the two-phase commit functionality of a distributed transaction to ensure that changes are not committed in one transaction branch before there is assurance that the changes will succeed in all transaction branches. </p>
                              <div class="infoboxnote" id="GUID-F7013AB7-8F57-4260-A0F6-E7EAEDFBC063__GUID-DCCFBACE-2494-477B-9E5E-E0B6486C0B6C">
                                 <p class="notep1">Note:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>Because there must always be a one-to-one correlation between XA connection instances and <code class="codeph">OracleXAResource</code> instances, an <code class="codeph">OracleXAResource</code> instance is implicitly closed when the associated XA connection instance is closed.
                                       </p>
                                    </li>
                                    <li>
                                       <p>If a transaction is opened by a given <code class="codeph">OracleXAResource</code> instance, then it must also be closed by the same <code class="codeph">OracleXAResource</code> instance.
                                       </p>
                                    </li>
                                 </ul>
                              </div>
                           </li>
                        </ul>
                        <p>An <code class="codeph">OracleXAResource</code> instance is an instance of a class that implements the standard <code class="codeph">javax.transaction.xa.XAResource</code> interface. Oracle JDBC implements the <code class="codeph">XAResource</code> interface with the <code class="codeph">OracleXAResource</code> class, located both in the <code class="codeph">oracle.jdbc.xa.client</code> package and the <code class="codeph">oracle.jdbc.xa.server</code> package. 
                        </p>
                        <p>Oracle JDBC driver creates and returns an <code class="codeph">OracleXAResource</code> instance whenever the <code class="codeph">getXAResource</code> method of the <code class="codeph">OracleXAConnection</code> class is called, and it is Oracle JDBC driver that associates an <code class="codeph">OracleXAResource</code> instance with a connection instance and the transaction branch being run through that connection.
                        </p>
                        <p>This method is how an <code class="codeph">OracleXAResource</code> instance is associated with a particular connection and with the transaction branch being run in that connection.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="JJDBC28855"></a><a id="JJDBC28856"></a><a id="JJDBC28857"></a><a id="JJDBC28858"></a><a id="JJDBC28859"></a><a id="JJDBC28860"></a><a id="JJDBC28861"></a><a id="JJDBC28862"></a><a id="JJDBC28854"></a><div class="props_rev_3"><a id="GUID-CD752E5A-309E-440A-A711-71083DD5B6A6" name="GUID-CD752E5A-309E-440A-A711-71083DD5B6A6"></a><h4 id="JJDBC-GUID-CD752E5A-309E-440A-A711-71083DD5B6A6" class="sect4"><span class="enumeration_section">33.2.4 </span>OracleXAResource Method Functionality and Input Parameters
                  </h4>
                  <div>
                     <div class="section">
                        <p>The <code class="codeph">OracleXAResource</code> class has several methods to coordinate a transaction branch with the distributed transaction with which it is associated. This functionality usually involves two-phase commit operations. 
                        </p>
                        <p>A transaction manager, receiving <code class="codeph">OracleXAResource</code> instances from a middle-tier component, such as an application server, typically invokes this functionality.
                        </p>
                        <p>Each of these methods takes a transaction ID as input, in the form of an <code class="codeph">Xid</code> instance, which includes a transaction branch ID component and a distributed transaction ID component. Every transaction branch has a unique transaction ID, but transaction branches belonging to the same global transaction have the same global transaction component as part of their transaction IDs.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-CD752E5A-309E-440A-A711-71083DD5B6A6__GUID-F66E0F1D-762E-4E76-BEF6-84C455709BB3">start</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>Starts work on behalf of a transaction branch, associating the transaction branch with a distributed transaction.</p><pre class="oac_no_warn" dir="ltr">void start(Xid xid, int flags)
</pre><p>The <code class="codeph">flags</code> parameter must be one or more of the following values:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">XAResource.TMNOFLAGS</code></p>
                              <p>Flags the start of a new transaction branch for subsequent operations in the session associated with this XA resource instance. This branch will have the transaction ID <code class="codeph">xid</code>, which is an <code class="codeph">OracleXid</code> instance created by the transaction manager. This will map the transaction branch to the appropriate distributed transaction.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">XAResource.TMJOIN</code></p>
                              <p>Joins subsequent operations in the session associated with this XA resource instance to the existing transaction branch specified by <code class="codeph">xid</code>.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">XAResource.TMRESUME</code></p>
                              <p>Resumes the transaction branch specified by <code class="codeph">xid</code>.
                              </p>
                              <div class="infoboxnote" id="GUID-CD752E5A-309E-440A-A711-71083DD5B6A6__GUID-84C6551D-D36F-43CE-91F5-21444E0410AB">
                                 <p class="notep1">Note:</p>
                                 <p>A transaction branch can be resumed only if it had been suspended earlier.</p>
                              </div>
                           </li>
                           <li>
                              <p><code class="codeph">OracleXAResource.TMPROMOTE</code></p>
                              <p>Promotes a local transaction to a global transaction</p>
                           </li>
                           <li>
                              <p><code class="codeph">OracleXAResource.ORATMSERIALIZABLE</code></p>
                              <p>Starts a serializable transaction with transaction ID <code class="codeph">xid</code>.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">OracleXAResource.ORATMREADONLY</code></p>
                              <p>Starts a read-only transaction with transaction ID <code class="codeph">xid</code>.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">OracleXAResource.ORATMREADWRITE</code></p>
                              <p>Starts a read/write transaction with transaction ID <code class="codeph">xid</code>.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">OracleXAResource.ORATRANSLOOSE</code></p>
                              <p>Starts a loosely coupled transaction with transaction ID <code class="codeph">xid</code>.
                              </p>
                           </li>
                        </ul>
                        <p><code class="codeph">TMNOFLAGS</code>, <code class="codeph">TMJOIN</code>, <code class="codeph">TMRESUME</code>, <code class="codeph">TMPROMOTE</code>, <code class="codeph">ORATMSERIALIZABLE</code>, <code class="codeph">ORATMREADONLY</code>, and <code class="codeph">ORATMREADWRITE </code>are defined as <code class="codeph">static</code> members of the <code class="codeph">XAResource</code> interface and <code class="codeph">OracleXAResource</code> class. <code class="codeph">ORATMSERIALIZABLE</code>, <code class="codeph">ORATMREADONLY</code>, and <code class="codeph">ORATMREADWRITE</code> are the isolation-mode flags. The default isolation behavior is <code class="codeph">READ COMMITTED</code>.
                        </p>
                        <div class="infoboxnote" id="GUID-CD752E5A-309E-440A-A711-71083DD5B6A6__GUID-A277F597-3D7F-4F04-B5B9-BB67F8AB14F6">
                           <p class="notep1">Note:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Instead of using the <code class="codeph">start</code> method with <code class="codeph">TMRESUME</code>, the transaction manager can cast to <code class="codeph">OracleXAResource</code> and use the <code class="codeph">resume(Xid xid)</code> method, an Oracle extension.
                                 </p>
                              </li>
                              <li>
                                 <p>If you use <code class="codeph">TMRESUME</code>, then you must also use <code class="codeph">TMNOMIGRATE</code>, as in <code class="codeph">start(xid, XAResource.TMRESUME | OracleXAResource.TMNOMIGRATE)</code>. This prevents the application from receiving the error <code class="codeph">ORA 1002: fetch out of sequence</code>.
                                 </p>
                              </li>
                              <li>
                                 <p>If you use the isolation-mode flags incorrectly, then an exception with code <code class="codeph">XAER_INVAL</code> is raised. Furthermore, you cannot use isolation-mode flags when resuming a global transaction, because you cannot set the isolation level of an existing transaction. If you try to use the isolation-mode flags when resuming a transaction, then an external Oracle exception with code ORA-24790 is raised.
                                 </p>
                              </li>
                              <li>
                                 <p>In order to avoid <code class="codeph">Error ORA 1002: fetch out of sequence</code>, include the   <code class="codeph">TMNOMIGRATE</code> flag as part of the <code class="codeph">start</code> method. For example: 
                                 </p><pre class="oac_no_warn" dir="ltr">start(xid, XAResource.TMSUSPEND | OracleXAResource.TMNOMIGRATE);
</pre></li>
                              <li>
                                 <p>All the flags defined in <code class="codeph">OracleXAResource</code> are Oracle extensions. When writing a transaction manager that uses these flags, you should be mindful of this.
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <p>Note that to create an appropriate transaction ID in starting a transaction branch, the transaction manager must know to which distributed transaction the transaction branch belongs. The mechanics of this are handled between the middle tier and transaction manager.</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-CD752E5A-309E-440A-A711-71083DD5B6A6__GUID-89F6688F-529A-4418-8FE7-A4B4772D7278">end</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>Ends work on behalf of the transaction branch specified by <code class="codeph">xid</code>, disassociating the transaction branch from its distributed transaction.
                        </p><pre class="oac_no_warn" dir="ltr">void end(Xid xid, int flags)
</pre><p>The <code class="codeph">flags</code> parameter can have one of the following values:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">XAResource.TMSUCCESS</code></p>
                              <p>This is to indicate that this transaction branch is known to have succeeded.</p>
                           </li>
                           <li>
                              <p><code class="codeph">XAResource.TMFAIL</code></p>
                              <p>This is to indicate that this transaction branch is known to have failed.</p>
                           </li>
                           <li>
                              <p><code class="codeph">XAResource.TMSUSPEND</code></p>
                              <p>This is to suspend the transaction branch specified by <code class="codeph">xid</code>. By suspending transaction branches, you can have multiple transaction branches in a single session. Only one can be active at any given time, however. Also, this tends to be more expensive in terms of resources than having two sessions.
                              </p>
                           </li>
                        </ul>
                        <p><code class="codeph">TMSUCCESS</code>, <code class="codeph">TMFAIL</code>, and <code class="codeph">TMSUSPEND</code> are defined as static members of the <code class="codeph">XAResource</code> interface and <code class="codeph">OracleXAResource</code> class.
                        </p>
                        <div class="infoboxnote" id="GUID-CD752E5A-309E-440A-A711-71083DD5B6A6__GUID-07664836-6AA1-42DB-BDF1-6966841F53A5">
                           <p class="notep1">Note:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Instead of using the <code class="codeph">end</code> method with <code class="codeph">TMSUSPEND</code>, the transaction manager can cast to <code class="codeph">OracleXAResource</code> and use the <code class="codeph">suspend(Xid xid)</code> method, an Oracle extension.
                                 </p>
                              </li>
                              <li>
                                 <p>This XA functionality to suspend a transaction provides a way to switch between various transactions within a single JDBC connection. You can use the XA classes to accomplish this, even if you are not in a distributed transaction environment and would otherwise have no need for the XA classes.</p>
                              </li>
                              <li>
                                 <p>If you use <code class="codeph">TMSUSPEND</code>, then you must also use <code class="codeph">TMNOMIGRATE</code>, as in <code class="codeph">end(xid, XAResource.TMSUSPEND | OracleXAResource.TMNOMIGRATE)</code>. This prevents the application from receiving the error <code class="codeph">ORA 1002: fetch out of sequence</code>. 
                                 </p>
                              </li>
                              <li>
                                 <p>In order to avoid <code class="codeph">Error ORA 1002: fetch out of sequence</code>, include the   <code class="codeph">TMNOMIGRATE</code> flag as part of the end method. For example: 
                                 </p><pre class="oac_no_warn" dir="ltr">end(xid, XAResource.TMSUSPEND | OracleXAResource.TMNOMIGRATE);</pre></li>
                              <li>
                                 <p>All the flags defined in <code class="codeph">OracleXAResource</code> are Oracle         extensions. Any transaction manager that uses these flags should take heed of this.
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-CD752E5A-309E-440A-A711-71083DD5B6A6__GUID-3C5E0195-77F6-4768-9B6C-1BECFA80B9C4">prepare</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>Prepares the changes performed in the transaction branch specified by <code class="codeph">xid</code>. This is the first phase of a two-phase commit operation, to ensure that the database is accessible and that the changes can be committed successfully.
                        </p><pre class="oac_no_warn" dir="ltr">int prepare(Xid xid)
</pre><p>This method returns an integer value as follows:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">XAResource.XA_RDONLY</code></p>
                              <p>This is returned if the transaction branch runs only read-only operations such as <code class="codeph">SELECT</code> statements.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">XAResource.XA_OK</code></p>
                              <p>This is returned if the transaction branch runs updates that are all prepared without error.</p>
                           </li>
                        </ul>
                        <p><code class="codeph">XA_RDONLY</code> and <code class="codeph">XA_OK</code> are defined as <code class="codeph">static</code> members of the <code class="codeph">XAResource</code> interface and <code class="codeph">OracleXAResource</code> class.
                        </p>
                        <div class="infoboxnote" id="GUID-CD752E5A-309E-440A-A711-71083DD5B6A6__GUID-B871A921-D468-484E-9DA2-2392B7E1B6E4">
                           <p class="notep1">Note:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The <code class="codeph">prepare</code> method sometimes does not return any value if the transaction branch runs updates and any of them encounters errors during preparation. In this case, an XA exception is thrown.
                                 </p>
                              </li>
                              <li>
                                 <p>Always call the <code class="codeph">end</code> method on a branch before calling the <code class="codeph">prepare</code> method.
                                 </p>
                              </li>
                              <li>
                                 <p>If there is only one transaction branch in a distributed transaction, then there is no need to call the <code class="codeph">prepare</code> method. You can call the <code class="codeph">OracleXAResource</code> <code class="codeph">commit</code> method without preparing first.
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-CD752E5A-309E-440A-A711-71083DD5B6A6__GUID-C52864D1-B662-4AD8-92C4-DA75B4A73D1C">commit</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>Commits prepared changes in the transaction branch specified by <code class="codeph">xid</code>. This is the second phase of a two-phase commit and is performed only after all transaction branches have been successfully prepared.
                        </p><pre class="oac_no_warn" dir="ltr">void commit(Xid xid, boolean onePhase)
</pre><p>Set the <code class="codeph">onePhase</code> parameter as follows:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">true</code></p>
                              <p>This is to use one-phase instead of two-phase protocol in committing the transaction branch. This is appropriate if there is only one transaction branch in the distributed transaction; the <code class="codeph">prepare</code> step would be skipped.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">false</code></p>
                              <p>This is to use two-phase protocol in committing the transaction branch.</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-CD752E5A-309E-440A-A711-71083DD5B6A6__GUID-22B85181-296C-4CDF-82F0-D796CCCCBC10">rollback</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>Rolls back prepared changes in the transaction branch specified by <code class="codeph">xid</code>.
                        </p><pre class="oac_no_warn" dir="ltr">void rollback(Xid xid)</pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-CD752E5A-309E-440A-A711-71083DD5B6A6__GUID-84832424-E7A8-4BF3-B00D-A0758ADC8923">forget</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>Tells the resource manager to forget about a heuristically completed transaction branch.</p><pre class="oac_no_warn" dir="ltr">public void forget(Xid xid)</pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-CD752E5A-309E-440A-A711-71083DD5B6A6__GUID-77BD844A-6E3F-4F07-A344-DDE7ECEB5D3C">recover</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>The transaction manager calls this method during recovery to obtain the list of transaction branches that are currently in prepared or heuristically completed states.</p><pre class="oac_no_warn" dir="ltr">public Xid[] recover(int flag)</pre><div class="infoboxnote" id="GUID-CD752E5A-309E-440A-A711-71083DD5B6A6__GUID-4539DB7A-5DD5-4D48-BEC8-0BFC1B6DFB04">
                           <p class="notep1">Note:</p>
                           <p>Values for <code class="codeph">flag</code> other than <code class="codeph">TMSTARTRSCAN</code>, <code class="codeph">TMENDRSCAN</code>, or <code class="codeph">TMNOFLAGS</code>, cause an exception to be thrown, otherwise <code class="codeph">flag</code> is ignored.
                           </p>
                        </div>
                        <p>The resource manager returns zero or more <code class="codeph">Xid</code>s for the transaction branches that are currently in a prepared or heuristically completed state. If an error occurs during the operation, then the resource manager throws the appropriate <code class="codeph">XAException</code>.
                        </p>
                        <div class="infoboxnote" id="GUID-CD752E5A-309E-440A-A711-71083DD5B6A6__GUID-50CF2CD2-8A13-4C3B-BE63-4A069A6709D8">
                           <p class="notep1">Note:</p>
                           <p>The <code class="codeph">recover</code> method requires SELECT privilege on <code class="codeph">DBA_PENDING_TRANSACTIONS</code> and EXECUTE privilege on <code class="codeph">SYS.DBMS_XA</code> in Oracle database server. For database versions prior to Oracle Database 11<span class="italic">g</span> Release 1, where an Oracle patch including a fix for bug 5945463 is not available, or it is infeasible to apply the patch for the particular application scenario, the <code class="codeph">recover</code> method requires <code class="codeph">SYSBDBA</code> privilege. Regular use of <code class="codeph">SYSDBA</code> privilege is a security risk. So, Oracle strongly recommends that you upgrade your Database or apply the fix for bug 5945463, if you need to use the <code class="codeph">recover</code> method.
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-CD752E5A-309E-440A-A711-71083DD5B6A6__GUID-CA19D762-2DEA-4B57-BD1B-83FD47477D66">isSameRM</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>To determine if two <code class="codeph">OracleXAResource</code> instances correspond to the same resource manager, call the <code class="codeph">isSameRM</code> method from one <code class="codeph">OracleXAResource</code> instance, specifying the other <code class="codeph">OracleXAResource</code> instance as input. In the following example, presume <code class="codeph">xares1</code> and <code class="codeph">xares2</code> are <code class="codeph">OracleXAResource</code> instances:
                        </p><pre class="oac_no_warn" dir="ltr">boolean sameRM = xares1.isSameRM(xares2);
</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="JJDBC28863"></a><div class="props_rev_3"><a id="GUID-4FE2BFF4-9F22-4752-B571-B44D6F220BDC" name="GUID-4FE2BFF4-9F22-4752-B571-B44D6F220BDC"></a><h4 id="JJDBC-GUID-4FE2BFF4-9F22-4752-B571-B44D6F220BDC" class="sect4"><span class="enumeration_section">33.2.5 </span>Xid Interface and Oracle Implementation
                  </h4>
                  <div>
                     <div class="section">
                        <p>The transaction manager creates transaction ID instances and uses them in coordinating the branches of a distributed transaction. Each transaction branch is assigned a unique transaction ID, which includes the following information:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>For<a id="d80952e1810" class="indexterm-anchor"></a><a id="d80952e1814" class="indexterm-anchor"></a>mat identifier
                              </p>
                              <p>A format identifier specifies a Java transaction manager. For example, there could be a format identifier <code class="codeph">orcl</code>. This field <span class="italic">cannot</span> be null. The size of a format identifier is 4 bytes.
                              </p>
                           </li>
                           <li>
                              <p>Glo<a id="d80952e1828" class="indexterm-anchor"></a><a id="d80952e1832" class="indexterm-anchor"></a><a id="d80952e1836" class="indexterm-anchor"></a><a id="d80952e1838" class="indexterm-anchor"></a>bal transaction identifier
                              </p>
                              <p>It is also known as a distributed transaction ID component. The size of a global transaction identifier is 64 bytes.</p>
                           </li>
                           <li>
                              <p>Bra<a id="d80952e1846" class="indexterm-anchor"></a><a id="d80952e1850" class="indexterm-anchor"></a><a id="d80952e1854" class="indexterm-anchor"></a><a id="d80952e1856" class="indexterm-anchor"></a>nch qualifier
                              </p>
                              <p>It is also known as transaction branch ID component. The size of a branch qualifier is 64 bytes.</p>
                           </li>
                        </ul>
                        <p>The 64-byte global transaction identifier value will be identical in the transaction IDs of all transaction branches belonging to the same distributed transaction. However, the overall transaction ID is unique for every transaction branch.</p>
                        <p>An XA transaction ID instance is an instance of a class that implements the standard <code class="codeph">javax.transaction.xa.Xid</code> interface, which is a Java mapping of the X/Open transaction identifier XID structure. 
                        </p>
                        <p>Oracle implements this interface with the <code class="codeph">OracleXid</code> class in the <code class="codeph">oracle.jdbc.xa</code> package. <code class="codeph">OracleXid</code> instances are employed only in a transaction manager, transparent to application programs or an application server.
                        </p>
                        <div class="infoboxnote" id="GUID-4FE2BFF4-9F22-4752-B571-B44D6F220BDC__GUID-2AE19F6E-33F3-45F2-8F85-FF9631CC940B">
                           <p class="notep1">Note:</p>
                           <p>Oracle does not require the use of <code class="codeph">OracleXid</code> for <code class="codeph">OracleXAResource</code> calls. Instead, use any class that implements the <code class="codeph">javax.transaction.xa.Xid</code> interface. 
                           </p>
                        </div>
                        <p>A transaction manager may use the following in creating an <code class="codeph">OracleXid</code> instance:
                        </p><pre class="oac_no_warn" dir="ltr">public OracleXid(int fId, byte gId[], byte bId[]) throws XAException
</pre><p><code class="codeph">fId</code> is an integer value for the format identifier, <code class="codeph">gId[]</code> is a byte array for the global transaction identifier, and <code class="codeph">bId[]</code> is a byte array for the branch qualifier.
                        </p>
                        <p>The <code class="codeph">Xid</code> interface specifies the following getter methods:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">public int getFormatId()</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">public byte[] getGlobalTransactionId()</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">public type[] getBranchQualifier()</code></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="JJDBC28864"></a><div class="props_rev_3"><a id="GUID-EAB7ACFA-5708-4608-B94D-0D9ECE391D67" name="GUID-EAB7ACFA-5708-4608-B94D-0D9ECE391D67"></a><h3 id="JJDBC-GUID-EAB7ACFA-5708-4608-B94D-0D9ECE391D67" class="sect3"><span class="enumeration_section">33.3 </span>Error Handling and Optimizations
               </h3>
               <div>
                  <div class="section">
                     <p>This section focuses on the functionality of XA exceptions and error handling and the Oracle optimizations in its XA implementation. It covers the following topics:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="distributed-transactions.html#GUID-31804AB5-6CA2-45A4-AE4C-F58FCF86EB5D">XAException Classes and Methods</a></p>
                        </li>
                        <li>
                           <p><a href="distributed-transactions.html#GUID-57581BCF-85CE-4671-8323-CCAC62BA980A">Mapping Between Oracle Errors and XA Errors</a></p>
                        </li>
                        <li>
                           <p><a href="distributed-transactions.html#GUID-2C258328-7DFD-42ED-AA03-01959FFE924A">XA Error Handling</a></p>
                        </li>
                        <li>
                           <p><a href="distributed-transactions.html#GUID-FDF1F19F-7B5D-4BD8-AB6C-B26F47340C71">Oracle XA Optimizations</a></p>
                        </li>
                     </ul>
                     <p>The exception and error-handling discussion includes the standard XA exception class and the Oracle-specific XA exception class, as well as particular XA error codes and error-handling techniques.</p>
                  </div>
                  <!-- class="section" -->
               </div><a id="JJDBC28865"></a><div class="props_rev_3"><a id="GUID-31804AB5-6CA2-45A4-AE4C-F58FCF86EB5D" name="GUID-31804AB5-6CA2-45A4-AE4C-F58FCF86EB5D"></a><h4 id="JJDBC-GUID-31804AB5-6CA2-45A4-AE4C-F58FCF86EB5D" class="sect4"><span class="enumeration_section">33.3.1 </span>XAException Classes and Methods
                  </h4>
                  <div>
                     <div class="section">
                        <p>XA methods throw XA exceptions, as opposed to general exceptions or <code class="codeph">SQLExceptions</code>. An XA exception is an instance of the standard class <code class="codeph">javax.transaction.xa.XAException</code> or a subclass.
                        </p>
                        <p>An Oracle XAException is an instance that consists of an Oracle error portion and an XA error portion. Oracle provides the <code class="codeph">oracle.jdbc.xa.OracleXAException</code> subclasses of the standard <code class="codeph">javax.transaction.xa.XAException</code> class. An <code class="codeph">OracleXAException</code> instance is constructed using one of the following constructors:
                        </p><pre class="oac_no_warn" dir="ltr">public OracleXAException()

public OracleXAException(int error)
</pre><p>The error value is an error code that combines an Oracle SQL error value and an XA error value. The JDBC driver determines exactly how to combine the Oracle and XA error values.</p>
                        <p>The <code class="codeph">OracleXAException</code> class has the following methods:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">public int getOracleError()</code></p>
                              <p>This method returns the Oracle SQL error code pertaining to the exception, a standard ORA error number or 0 if there is no Oracle SQL error.</p>
                           </li>
                           <li>
                              <p><code class="codeph">public int getXAError()</code></p>
                              <p>This method returns the XA error code pertaining to the exception. XA error values are defined in the <code class="codeph">javax.transaction.xa.XAException</code> class.
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="JJDBC28867"></a><a id="JJDBC28866"></a><div class="props_rev_3"><a id="GUID-57581BCF-85CE-4671-8323-CCAC62BA980A" name="GUID-57581BCF-85CE-4671-8323-CCAC62BA980A"></a><h4 id="JJDBC-GUID-57581BCF-85CE-4671-8323-CCAC62BA980A" class="sect4"><span class="enumeration_section">33.3.2 </span>Mapping Between Oracle Errors and XA Errors
                  </h4>
                  <div>
                     <div class="section">
                        <p>Oracle errors correspond to XA errors in <code class="codeph">OracleXAException</code> instances as documented in <a href="distributed-transactions.html#GUID-57581BCF-85CE-4671-8323-CCAC62BA980A__CFHEEBFF" title="table">Table 33-2</a>.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="tblformal" id="GUID-57581BCF-85CE-4671-8323-CCAC62BA980A__CFHEEBFF">
                        <p class="titleintable">Table 33-2 Oracle-XA Error Mapping</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="Oracle-XA Error Mapping" summary="table" width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="41%" id="d80952e2096">Oracle Error Code</th>
                                 <th align="left" valign="bottom" width="59%" id="d80952e2099">XA Error Code</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="41%" id="d80952e2104" headers="d80952e2096 ">
                                    <p><code class="codeph">ORA 24756</code></p>
                                 </td>
                                 <td align="left" valign="top" width="59%" headers="d80952e2104 d80952e2099 ">
                                    <p><code class="codeph">XAException.XAER_NOTA</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="41%" id="d80952e2113" headers="d80952e2096 ">
                                    <p><code class="codeph">ORA 24764</code></p>
                                 </td>
                                 <td align="left" valign="top" width="59%" headers="d80952e2113 d80952e2099 ">
                                    <p><code class="codeph">XAException.XA_HEURCOM</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="41%" id="d80952e2122" headers="d80952e2096 ">
                                    <p><code class="codeph">ORA 24765</code></p>
                                 </td>
                                 <td align="left" valign="top" width="59%" headers="d80952e2122 d80952e2099 ">
                                    <p><code class="codeph">XAException.XA_HEURRB</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="41%" id="d80952e2131" headers="d80952e2096 ">
                                    <p><code class="codeph">ORA 24766</code></p>
                                 </td>
                                 <td align="left" valign="top" width="59%" headers="d80952e2131 d80952e2099 ">
                                    <p><code class="codeph">XAException.XA_HEURMIX</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="41%" id="d80952e2140" headers="d80952e2096 ">
                                    <p><code class="codeph">ORA 24767</code></p>
                                 </td>
                                 <td align="left" valign="top" width="59%" headers="d80952e2140 d80952e2099 ">
                                    <p><code class="codeph">XAException.XA_RDONLY</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="41%" id="d80952e2149" headers="d80952e2096 ">
                                    <p><code class="codeph">ORA 25351</code></p>
                                 </td>
                                 <td align="left" valign="top" width="59%" headers="d80952e2149 d80952e2099 ">
                                    <p><code class="codeph">XAException.XA_RETRY</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="41%" id="d80952e2158" headers="d80952e2096 ">
                                    <p><code class="codeph">ORA 30006</code></p>
                                 </td>
                                 <td align="left" valign="top" width="59%" headers="d80952e2158 d80952e2099 ">
                                    <p><code class="codeph">XAException.XA_RETRY</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="41%" id="d80952e2167" headers="d80952e2096 ">
                                    <p><code class="codeph">ORA 24763</code></p>
                                 </td>
                                 <td align="left" valign="top" width="59%" headers="d80952e2167 d80952e2099 ">
                                    <p><code class="codeph">XAException.XAER_PROTO</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="41%" id="d80952e2176" headers="d80952e2096 ">
                                    <p><code class="codeph">ORA 24769</code></p>
                                 </td>
                                 <td align="left" valign="top" width="59%" headers="d80952e2176 d80952e2099 ">
                                    <p><code class="codeph">XAException.XAER_PROTO</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="41%" id="d80952e2185" headers="d80952e2096 ">
                                    <p><code class="codeph">ORA 24770</code></p>
                                 </td>
                                 <td align="left" valign="top" width="59%" headers="d80952e2185 d80952e2099 ">
                                    <p><code class="codeph">XAException.XAER_PROTO</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="41%" id="d80952e2194" headers="d80952e2096 ">
                                    <p><code class="codeph">ORA 24776</code></p>
                                 </td>
                                 <td align="left" valign="top" width="59%" headers="d80952e2194 d80952e2099 ">
                                    <p><code class="codeph">XAException.XAER_PROTO</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="41%" id="d80952e2204" headers="d80952e2096 ">
                                    <p><code class="codeph">ORA 2056</code></p>
                                 </td>
                                 <td align="left" valign="top" width="59%" headers="d80952e2204 d80952e2099 ">
                                    <p><code class="codeph">XAException.XAER_PROTO</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="41%" id="d80952e2213" headers="d80952e2096 ">
                                    <p><code class="codeph">ORA 17448</code></p>
                                 </td>
                                 <td align="left" valign="top" width="59%" headers="d80952e2213 d80952e2099 ">
                                    <p><code class="codeph">XAException.XAER_PROTO</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="41%" id="d80952e2222" headers="d80952e2096 ">
                                    <p><code class="codeph">ORA 24768</code></p>
                                 </td>
                                 <td align="left" valign="top" width="59%" headers="d80952e2222 d80952e2099 ">
                                    <p><code class="codeph">XAException.XAER_PROTO</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="41%" id="d80952e2231" headers="d80952e2096 ">
                                    <p><code class="codeph">ORA 24775</code></p>
                                 </td>
                                 <td align="left" valign="top" width="59%" headers="d80952e2231 d80952e2099 ">
                                    <p><code class="codeph">XAException.XAER_PROTO</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="41%" id="d80952e2240" headers="d80952e2096 ">
                                    <p><code class="codeph">ORA 24761</code></p>
                                 </td>
                                 <td align="left" valign="top" width="59%" headers="d80952e2240 d80952e2099 ">
                                    <p><code class="codeph">XAException.XA_RBROLLBACK</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="41%" id="d80952e2249" headers="d80952e2096 ">
                                    <p><code class="codeph">ORA 2091</code></p>
                                 </td>
                                 <td align="left" valign="top" width="59%" headers="d80952e2249 d80952e2099 ">
                                    <p><code class="codeph">XAException.XA_RBROLLBACK</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="41%" id="d80952e2258" headers="d80952e2096 ">
                                    <p><code class="codeph">ORA 2092</code></p>
                                 </td>
                                 <td align="left" valign="top" width="59%" headers="d80952e2258 d80952e2099 ">
                                    <p><code class="codeph">XAException.XA_RBROLLBACK</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="41%" id="d80952e2267" headers="d80952e2096 ">
                                    <p><code class="codeph">ORA 24780</code></p>
                                 </td>
                                 <td align="left" valign="top" width="59%" headers="d80952e2267 d80952e2099 ">
                                    <p><code class="codeph">XAException.XAER_RMERR</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="41%" id="d80952e2276" headers="d80952e2096 ">
                                    <p>All other <code class="codeph">ORA</code> errors
                                    </p>
                                 </td>
                                 <td align="left" valign="top" width="59%" headers="d80952e2276 d80952e2099 ">
                                    <p><code class="codeph">XAException.XAER_RMFAIL</code></p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
               </div><a id="JJDBC28868"></a><div class="props_rev_3"><a id="GUID-2C258328-7DFD-42ED-AA03-01959FFE924A" name="GUID-2C258328-7DFD-42ED-AA03-01959FFE924A"></a><h4 id="JJDBC-GUID-2C258328-7DFD-42ED-AA03-01959FFE924A" class="sect4"><span class="enumeration_section">33.3.3 </span>XA Error Handling
                  </h4>
                  <div>
                     <div class="section">
                        <p>The following code snippet uses the <code class="codeph">OracleXAException</code> class to process an XA exception:
                        </p><pre class="oac_no_warn" dir="ltr">try {
   ...
   ...<span class="italic">Perform XA operations</span>...
   ...
} catch(OracleXAException oxae) { 
  int oraerr = oxae.getOracleError();
  System.out.println("Error " + oraerr);
} 
  catch(XAException xae)
{...<span class="italic">Process generic XA exception</span>...}
</pre><p>In case the XA operations did not throw an Oracle-specific XA exception, the code drops through to process a generic XA exception.</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="JJDBC28869"></a><div class="props_rev_3"><a id="GUID-FDF1F19F-7B5D-4BD8-AB6C-B26F47340C71" name="GUID-FDF1F19F-7B5D-4BD8-AB6C-B26F47340C71"></a><h4 id="JJDBC-GUID-FDF1F19F-7B5D-4BD8-AB6C-B26F47340C71" class="sect4"><span class="enumeration_section">33.3.4 </span>Oracle XA Optimizations
                  </h4>
                  <div>
                     <div class="section">
                        <p>Oracle JDBC has functionality to improve performance if two or more branches of a distributed transaction use the same database instance, meaning that the <code class="codeph">OracleXAResource</code> instances associated with these branches are associated with the same resource manager.
                        </p>
                        <p>In such a circumstance, the <code class="codeph">prepare</code> method of only one of these <code class="codeph">OracleXAResource</code> instances will return <code class="codeph">XA_OK</code> or will fail. The rest will return <code class="codeph">XA_RDONLY</code>, even if updates are made. This allows the transaction manager to implicitly join all the transaction branches and commit or roll back, in case of failure, the joined transaction through the <code class="codeph">OracleXAResource</code> instance that returned <code class="codeph">XA_OK</code> or failed.
                        </p>
                        <p>The transaction manager can use the <code class="codeph">OracleXAResource</code> class <code class="codeph">isSameRM</code> method to determine if two <code class="codeph">OracleXAResource</code> instances are using the same resource manager. This way it can interpret the meaning of <code class="codeph">XA_RDONLY</code> return values.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="JJDBC28870"></a><div class="props_rev_3"><a id="GUID-A1736524-8CB5-4965-89E3-C65C3861E784" name="GUID-A1736524-8CB5-4965-89E3-C65C3861E784"></a><h3 id="JJDBC-GUID-A1736524-8CB5-4965-89E3-C65C3861E784" class="sect3"><span class="enumeration_section">33.4 </span>About Implementing a Distributed Transaction
               </h3>
               <div>
                  <div class="section">
                     <p>This section provides an example of how to implement a distributed transaction using Oracle XA functionality. This section covers the following topics:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="distributed-transactions.html#GUID-DE4E55A0-9798-4FB1-BF11-1B011607612B">Summary of Imports for Oracle XA</a></p>
                        </li>
                        <li>
                           <p><a href="distributed-transactions.html#GUID-1964042C-AA18-4E8B-8B43-5DE58BFE2610">Oracle XA Code Sample</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="JJDBC28871"></a><div class="props_rev_3"><a id="GUID-DE4E55A0-9798-4FB1-BF11-1B011607612B" name="GUID-DE4E55A0-9798-4FB1-BF11-1B011607612B"></a><h4 id="JJDBC-GUID-DE4E55A0-9798-4FB1-BF11-1B011607612B" class="sect4"><span class="enumeration_section">33.4.1 </span>Summary of Imports for Oracle XA
                  </h4>
                  <div>
                     <div class="section">
                        <p>You must import the following for Oracle XA functionality:</p><pre class="oac_no_warn" dir="ltr">import oracle.jdbc.xa.OracleXid;
import oracle.jdbc.xa.OracleXAException;
import oracle.jdbc.pool.*;
import oracle.jdbc.xa.client.*;
import javax.transaction.xa.*;
</pre><p>The <code class="codeph">oracle.jdbc.pool</code> package has classes for connection pooling functionality, some of which have XA-related classes as subclasses.
                        </p>
                        <p>Alternatively, if the code will run inside Oracle Database and access that database for SQL operations, you must import <code class="codeph">oracle.jdbc.xa.server</code> instead of <code class="codeph">oracle.jdbc.xa.client</code>.
                        </p><pre class="oac_no_warn" dir="ltr">import oracle.jdbc.xa.server.*;
</pre><p>If your application must access another Oracle Database as part of an XA transaction using the server-side Thin driver, then your code can use the fully qualified names of the <code class="codeph">oracle.xa.client</code> classes.
                        </p>
                        <p>The <code class="codeph">client</code> and <code class="codeph">server</code> packages each have versions of the <code class="codeph">OracleXADataSource</code>, <code class="codeph">OracleXAConnection</code>, and <code class="codeph">OracleXAResource</code> classes. Abstract versions of these three classes are in the top-level <code class="codeph">oracle.jdbc.xa</code> package.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="JJDBC28872"></a><div class="props_rev_3"><a id="GUID-1964042C-AA18-4E8B-8B43-5DE58BFE2610" name="GUID-1964042C-AA18-4E8B-8B43-5DE58BFE2610"></a><h4 id="JJDBC-GUID-1964042C-AA18-4E8B-8B43-5DE58BFE2610" class="sect4"><span class="enumeration_section">33.4.2 </span>Oracle XA Code Sample
                  </h4>
                  <div>
                     <div class="section">
                        <p>This example uses a two-phase distributed transaction with two transaction branches, each to a separate database. </p>
                        <p>Note that for simplicity, this example combines code that would typically be in a middle tier with code that would typically be in a transaction manager, such as the <code class="codeph">OracleXAResource</code> method invocations and the creation of transaction IDs.
                        </p>
                        <p>For brevity, the specifics of creating transaction IDs and performing SQL operations are not shown here. The complete example is shipped with the product.</p>
                        <p>This example performs the following sequence:</p>
                        <ol>
                           <li>
                              <p>Start transaction branch #1.</p>
                           </li>
                           <li>
                              <p>Start transaction branch #2.</p>
                           </li>
                           <li>
                              <p>Execute DML operations on branch #1.</p>
                           </li>
                           <li>
                              <p>Execute DML operations on branch #2.</p>
                           </li>
                           <li>
                              <p>End transaction branch #1.</p>
                           </li>
                           <li>
                              <p>End transaction branch #2.</p>
                           </li>
                           <li>
                              <p>Prepare branch #1.</p>
                           </li>
                           <li>
                              <p>Prepare branch #2.</p>
                           </li>
                           <li>
                              <p>Commit branch #1.</p>
                           </li>
                           <li>
                              <p>Commit branch #2.</p>
                           </li>
                        </ol><pre class="oac_no_warn" dir="ltr">// You need to import the java.sql package to use JDBC
import java.sql.*;
import javax.sql.*;
import oracle.jdbc.*;
import oracle.jdbc.pool.*;
import oracle.jdbc.xa.OracleXid;
import oracle.jdbc.xa.OracleXAException;
import oracle.jdbc.xa.client.*;
import javax.transaction.xa.*;

class XA4
{
  public static void main (String args [])
       throws SQLException 
  {

    try
    {
        String URL1 = "jdbc:oracle:oci:@";
        // You can put a database name after the @ sign in the connection URL.
        String URL2 ="jdbc:oracle:thin:@(description=(address=(host=localhost)
                     (protocol=tcp)(port=5521))(connect_data=(service_name=orcl)))";
        // Create first DataSource and get connection
        OracleDataSource ods1 = new OracleDataSource();
        ods1.setURL(URL1);
        ods1.setUser("HR");
        ods1.setPassword("hr");
        Connection conna = ods1.getConnection();

        // Create second DataSource and get connection
        OracleDataSource ods2 = new OracleDataSource();
        ods2.setURL(URL2);
        ods2.setUser("HR");
        ods2.setPassword("hr");
        Connection connb = ods2.getConnection();

        // Prepare a statement to create the table
        Statement stmta = conna.createStatement ();

        // Prepare a statement to create the table
        Statement stmtb = connb.createStatement ();

        try
        {
          // Drop the test table
          stmta.execute ("drop table my_table");
        }
        catch (SQLException e)
        {
          // Ignore an error here
        }

        try
        {   
          // Create a test table
          stmta.execute ("create table my_table (col1 int)");
        }
        catch (SQLException e)
        {
          // Ignore an error here too
        }

        try
        {
          // Drop the test table
          stmtb.execute ("drop table my_tab");
        }
        catch (SQLException e)
        {
          // Ignore an error here
        }

        try
        {   
          // Create a test table
          stmtb.execute ("create table my_tab (col1 char(30))");
        }
        catch (SQLException e)
        {
          // Ignore an error here too
        }

        // Create XADataSource instances and set properties.
        OracleXADataSource oxds1 = new OracleXADataSource();
        oxds1.setURL("jdbc:oracle:oci:@");
        oxds1.setUser("HR");
        oxds1.setPassword("hr");

        OracleXADataSource oxds2 = new OracleXADataSource();

        oxds2.setURL("jdbc:oracle:thin:@(description=(address=(host=localhost)
                   (protocol=tcp)(port=5521))(connect_data=(service_name=orcl)))");
        oxds2.setUser("HR");
        oxds2.setPassword("hr");
    
        // Get XA connections to the underlying data sources
        XAConnection pc1  = oxds1.getXAConnection();
        XAConnection pc2  = oxds2.getXAConnection();

        // Get the physical connections
        Connection conn1 = pc1.getConnection();
        Connection conn2 = pc2.getConnection();

        // Get the XA resources
        XAResource oxar1 = pc1.getXAResource();
        XAResource oxar2 = pc2.getXAResource();

        // Create the Xids With the Same Global Ids
        Xid xid1 = createXid(1);
        Xid xid2 = createXid(2);

        // Start the Resources
        oxar1.start (xid1, XAResource.TMNOFLAGS);
        oxar2.start (xid2, XAResource.TMNOFLAGS);

        // Execute SQL operations with conn1 and conn2
        doSomeWork1 (conn1);
        doSomeWork2 (conn2);

        // END both the branches -- IMPORTANT
        oxar1.end(xid1, XAResource.TMSUCCESS);
        oxar2.end(xid2, XAResource.TMSUCCESS);

        // Prepare the RMs
        int prp1 =  oxar1.prepare (xid1);
        int prp2 =  oxar2.prepare (xid2);

        System.out.println("Return value of prepare 1 is " + prp1);
        System.out.println("Return value of prepare 2 is " + prp2);

        boolean do_commit = true;

        if (!((prp1 == XAResource.XA_OK) || (prp1 == XAResource.XA_RDONLY)))
           do_commit = false;

        if (!((prp2 == XAResource.XA_OK) || (prp2 == XAResource.XA_RDONLY)))
           do_commit = false;

       System.out.println("do_commit is " + do_commit);
        System.out.println("Is oxar1 same as oxar2 ? " + oxar1.isSameRM(oxar2));

        if (prp1 == XAResource.XA_OK)
          if (do_commit)
             oxar1.commit (xid1, false);
          else
             oxar1.rollback (xid1);

        if (prp2 == XAResource.XA_OK)
          if (do_commit)
             oxar2.commit (xid2, false);
          else
             oxar2.rollback (xid2);

         // Close connections
        conn1.close();
        conn1 = null;
        conn2.close();
        conn2 = null;

        pc1.close();
        pc1 = null;
        pc2.close();
        pc2 = null;

        ResultSet rset = stmta.executeQuery ("select col1 from my_table");
        while (rset.next())
          System.out.println("Col1 is " + rset.getInt(1));
  
        rset.close();
        rset = null;

        rset = stmtb.executeQuery ("select col1 from my_tab");
        while (rset.next())
          System.out.println("Col1 is " + rset.getString(1));
  
        rset.close();
        rset = null;

        stmta.close();
        stmta = null;
        stmtb.close();
        stmtb = null;

        conna.close();
        conna = null;
        connb.close();
        connb = null;

    } catch (SQLException sqe)
    {
      sqe.printStackTrace();
    } catch (XAException xae)
    {
      if (xae instanceof OracleXAException) {
        System.out.println("XA Error is " +
                      ((OracleXAException)xae).getXAError());
        System.out.println("SQL Error is " +
                      ((OracleXAException)xae).getOracleError());
      }
    }
  }

  static Xid createXid(int bids)
    throws XAException
  {...<span class="italic">Create transaction IDs</span>...}

  private static void doSomeWork1 (Connection conn)
   throws SQLException
  {...<span class="italic">Execute SQL operations</span>...}

  private static void doSomeWork2 (Connection conn)
   throws SQLException
  {...<span class="italic">Execute SQL operations</span>...}
}</pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="JJDBC28873"></a><div class="props_rev_3"><a id="GUID-1EF2D070-305D-49D9-9124-16FFDF7CCF74" name="GUID-1EF2D070-305D-49D9-9124-16FFDF7CCF74"></a><h3 id="JJDBC-GUID-1EF2D070-305D-49D9-9124-16FFDF7CCF74" class="sect3"><span class="enumeration_section">33.5 </span>Native-XA in Oracle JDBC Drivers
               </h3>
               <div>
                  <div class="section">
                     <p>In general, XA commands can be sent to the server in the following ways:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Through non-native APIs</p>
                        </li>
                        <li>
                           <p>Through native APIs</p>
                        </li>
                     </ul>
                     <p>There is a huge performance difference between the two methods of sending XA commands to the server. The use of native APIs provide high performance gains as compared to the use of non-native APIs.</p>
                     <p>Prior to Oracle Database 10<span class="italic">g</span>, the Thin driver used non-native APIs to send XA commands to the server because Thin native APIs were not available. The non-native APIs use PL/SQL procedures, so they have the following disadvantages:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>They require different messages on the wire.</p>
                        </li>
                        <li>
                           <p>They cause more round-trips to the database.</p>
                        </li>
                        <li>
                           <p>They cause more cursors to remain open.</p>
                        </li>
                        <li>
                           <p>They damage statement caching by occupying space in the Statement Cache.</p>
                        </li>
                     </ul>
                     <p>Moreover, the implementation of non-native APIs is in the server. So, in order to solve any problem in sending XA commands, it requires a server patch. This creates a major issue because sometimes the patch requires restarting the server.</p>
                     <p>Starting from Oracle Database 10<span class="italic">g</span>, the Thin native APIs are available and are used to send XA commands, by default. Native APIs are more than 10 times faster than the non-native ones.
                     </p>
                     <p>This section covers the following topics:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="distributed-transactions.html#GUID-C569E55B-4E1C-4DCF-88F4-05D831B69A55">OCI Native XA</a></p>
                        </li>
                        <li>
                           <p><a href="distributed-transactions.html#GUID-1F63D0AC-A68E-48D8-B07C-E4E04CC42609">Thin Native XA</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="JJDBC28875"></a><a id="JJDBC28876"></a><a id="JJDBC28877"></a><a id="JJDBC28874"></a><div class="props_rev_3"><a id="GUID-C569E55B-4E1C-4DCF-88F4-05D831B69A55" name="GUID-C569E55B-4E1C-4DCF-88F4-05D831B69A55"></a><h4 id="JJDBC-GUID-C569E55B-4E1C-4DCF-88F4-05D831B69A55" class="sect4"><span class="enumeration_section">33.5.1 </span>OCI Native XA
                  </h4>
                  <div>
                     <div class="section">
                        <p>Native XA is enabled through the use of the <code class="codeph">tnsEntry</code> and <code class="codeph">nativeXA</code> properties of the <code class="codeph">OracleXADataSource</code> class.
                        </p>
                        <div class="infoboxnote" id="GUID-C569E55B-4E1C-4DCF-88F4-05D831B69A55__GUID-23D64F4D-3959-4C2F-A0DE-04D49CDC7860">
                           <p class="notep1">Note:</p>
                           <p>Currently, OCI Native XA does not work in a multithreaded environment. The OCI driver uses the C/XA library of Oracle to support distributed transactions, which requires that an XAConnection be obtained for each thread before resuming a global transaction.</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-C569E55B-4E1C-4DCF-88F4-05D831B69A55__GUID-8C43188C-0089-4528-B4E3-10915B30C471">Configuration and Installation</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>On a  <a id="d80952e2716" class="indexterm-anchor"></a>Solaris or Linux system, you need the <code class="codeph">libheteroxa11.so</code> shared library to enable the Native XA feature. This library must be installed and available in the search path for the Native XA feature to work properly.
                        </p>
                        <p>On a Microsoft Windows system, you need the <code class="codeph">heteroxa11.dll</code> file to enable the Native XA feature. This file must be installed and available in the Windows DLL path for the Native XA feature to work properly.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-C569E55B-4E1C-4DCF-88F4-05D831B69A55__GUID-728D08D0-2CD2-43CC-896C-0BB6ED8AE5B6">Exception Handling</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>When using the Native XA feature in distributed transactions, it is recommended that the application simply check for <code class="codeph">XAException</code> or <code class="codeph">SQLException</code>, rather than <code class="codeph">OracleXAException</code> or <code class="codeph">OracleSQLException</code>.
                        </p>
                        <div class="infoboxnote" id="GUID-C569E55B-4E1C-4DCF-88F4-05D831B69A55__GUID-7EF7EE79-9165-4C84-A027-5970763BBBC6">
                           <p class="notep1">Note:</p>
                           <p>The mapping from SQL error codes to standard XA error codes does not apply to the Native XA feature.</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-C569E55B-4E1C-4DCF-88F4-05D831B69A55__GUID-F625D2D5-ECD4-49F0-9724-AEBC8686CF50">Native XA Code Example</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>The following portion of code shows how to enable the Native XA feature:</p><pre class="oac_no_warn" dir="ltr">...
// Create a XADataSource instance
OracleXADataSource oxds = new OracleXADataSource();
oxds.setURL(url);

// Set the nativeXA property to use Native XA feature
oxds.setNativeXA(true);

// Set the tnsEntry property to an older DB as required
oxds.setTNSEntryName("ora805");
...
</pre></div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="data-sources-and-URLs.html#GUID-088B1600-C6C2-4F19-A020-2DAF8FE1F1C3">Features and Properties of Data Sources</a></li>
                           <li><a href="JDBC-error-messages.html#GUID-1F040951-2DB5-4A65-8027-8A737E34F6B3">Native XA Messages</a></li>
                        </ul>
                     </div>
                  </div>
                  
               </div><a id="JJDBC28878"></a><div class="props_rev_3"><a id="GUID-1F63D0AC-A68E-48D8-B07C-E4E04CC42609" name="GUID-1F63D0AC-A68E-48D8-B07C-E4E04CC42609"></a><h4 id="JJDBC-GUID-1F63D0AC-A68E-48D8-B07C-E4E04CC42609" class="sect4"><span class="enumeration_section">33.5.2 </span>Thin Native XA
                  </h4>
                  <div>
                     <div class="section">
                        <p>Like the JDBC OCI driver, the JDBC Thin driver also provides support for Native XA. However, the JDBC Thin driver provides support for Native XA by default. This is unlike the case of the JDBC OCI driver in which the support for Native XA is not enabled by default.</p>
                        <p>You can disable Native XA by calling <code class="codeph">setNativeXA(false)</code> on the XA data source as follows:
                        </p><pre class="oac_no_warn" dir="ltr">...
// Create a XADataSource instance
OracleXADataSource oxds = new OracleXADataSource();
...
// Disabling Native XA
oxds.setNativeXA(false);
...
</pre><p>For example, you may need to disable Native XA as a workaround for a bug in the Native XA code.</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>