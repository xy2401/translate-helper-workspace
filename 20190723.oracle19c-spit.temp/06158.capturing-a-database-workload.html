<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="This chapter describes how to capture a database workload on the production system.">
      <meta name="description" content="This chapter describes how to capture a database workload on the production system.">
      <title>Capturing a Database Workload</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Testing Guide ">
      <meta property="og:description" content="This chapter describes how to capture a database workload on the production system.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Testing Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="testing-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-07T01:43:11-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2008, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96279-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="introduction-to-database-replay.html" title="Previous" type="text/html">
      <link rel="next" href="preprocessing-a-database-workload.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Testing Guide">
    <meta name="dcterms.isVersionOf" content="RATUG">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="introduction-to-database-replay.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="preprocessing-a-database-workload.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Testing Guide </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="database-replay.html" property="item" typeof="WebPage"><span property="name"> Database Replay </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Capturing a Database Workload </li>
            </ol>
            <a id="GUID-E774C161-98C0-43EF-8B78-DD74E2A2A219" name="GUID-E774C161-98C0-43EF-8B78-DD74E2A2A219"></a><a id="RATUG109"></a>
            
            <h2 id="RATUG-GUID-E774C161-98C0-43EF-8B78-DD74E2A2A219" class="sect2"><span class="enumeration_chapter">10 </span> Capturing a Database Workload 
            </h2>
         </header>
         <div class="ind">
            <div>
               <div><span>This chapter describes how to capture a database workload on the production system.</span> The first step in using Database Replay is to capture the production workload.
               </div>
               <p>This chapter contains the following sections:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-372BA03D-7A24-4300-A0AE-30E0D9D9C724" title="Before starting a workload capture, you should have a strategy in place to restore the database on the test system.">Prerequisites for Capturing a Database Workload</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-00E1BF0A-489C-4141-A21C-44E3D80EC320" title="Determine the location and set up a directory where the captured workload will be stored.">Setting Up the Capture Directory</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-79F20163-CE64-4C9C-9F71-C41A95460C05" title="Proper planning before workload capture is required to ensure that the capture will be accurate and useful when replayed in another environment.">Workload Capture Options</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-4A1995F1-78F9-4080-8DFC-1E3EBCB3F4B8" title="Certain types of user sessions and client requests may sometimes be captured in a workload, but they are not supported by Database Replay. Capturing these session and request types in a workload may result in errors during workload replay.">Workload Capture Restrictions</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-46D117CD-67F5-41AD-B85C-41DC6BEE3E23" title="Database Replay supports capturing a database workload on a system running Oracle Database 10g Release 2 that can be used to test database upgrades to Oracle Database 11g and subsequent releases.">Enabling and Disabling the Workload Capture Feature</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-61E843E8-393A-49CE-8AF7-DCFA3E31982A" title="The Database Replay resource type privileges enable you to view or operate any Database Replay entities. Additionally, you need the target operator privilege for the target from which the workload was captured to access the entities associated with the workload.">Enterprise Manager Privileges and Roles</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-1679DB12-B633-4021-A3B9-9CC6216D6681" title="This section describes how to capture a database workload using Enterprise Manager. The primary tool for capturing database workloads is Oracle Enterprise Manager.">Capturing a Database Workload Using Enterprise Manager</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67" title="Concurrent capture refers to capturing the workload on multiple databases simultaneously.">Capturing Workloads from Multiple Databases Concurrently</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-509ABE02-E9DB-420B-80AA-5FF2B8CDD9A5" title="This section describes how to monitor workload capture using Enterprise Manager. The primary tool for monitoring workload capture is Oracle Enterprise Manager.">Monitoring a Workload Capture Using Enterprise Manager</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-6F2BBECA-4259-493F-AEFE-4E4183476220" title="You can import a workload captured through the PL/SQL interface or through a different Enterprise Manager instance into Enterprise Manager to manage it as you would for a workload originally created within Enterprise Manager.">Importing a Workload External to Enterprise Manager</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-2DD9B05E-9BD9-4F4D-92F6-E399093CB876" title="For cases in which you have captured a large workload covering a long period of time, you may only want to replay a portion of it to accelerate testing. The Database Replay Workload Subsetting feature enables you to create new workloads by extracting portions of an existing captured workload.">Creating Subsets from an Existing Workload</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-F89B9D09-2394-4C3F-AA11-EF1A73C23A85" title="You can use the copy function for two purposes.">Copying or Moving a Workload to a New Location</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-7AB9889A-6F05-41D3-8EA1-F4BEEC507BDE" title="This section describes how to capture a database workload using APIs.">Capturing a Database Workload Using APIs</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-19A5094A-185D-4F1C-B441-FB72AC9EA2ED" title="This section describes how to encrypt and decrypt an existing workload capture using APIs.">Encrypting and Decrypting an Existing Workload Capture Using APIs</a></p>
                  </li>
                  <li>
                     <p><a href="capturing-a-database-workload.html#GUID-B9D817BE-43F0-4813-B161-14FFD7F51D40" title="This section summarizes the views that you can display to monitor workload capture.">Monitoring Workload Capture Using Views</a></p>
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-E774C161-98C0-43EF-8B78-DD74E2A2A219__GUID-90AFDA30-98ED-4ECF-9625-4830520D166C">
                  <p class="notep1">See Also:</p>
                  <p><span class="q">"<a href="introduction-to-database-replay.html#GUID-36DE5567-5A64-493B-A154-6581C678FC8A" title="The first step in using Database Replay is to capture the production workload. Capturing a workload involves recording all requests made by external clients to Oracle Database.">Workload Capture</a>"</span> for more information about how capturing a database workload fits within the Database Replay architecture
                  </p>
               </div>
            </div><a id="RATUG110"></a><div class="props_rev_3"><a id="GUID-372BA03D-7A24-4300-A0AE-30E0D9D9C724" name="GUID-372BA03D-7A24-4300-A0AE-30E0D9D9C724"></a><h3 id="RATUG-GUID-372BA03D-7A24-4300-A0AE-30E0D9D9C724" class="sect3"><span class="enumeration_section">10.1 </span>Prerequisites for Capturing a Database Workload
               </h3>
               <div>
                  <div><span>Before starting a workload capture, you should have a strategy in place to restore the database on the test system.</span> Before a workload can be replayed, the logical state of the application data on the replay system should be similar to that of the capture system when replay begins. To accomplish this, consider using one of the following methods:
                  </div>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Recovery Manager (RMAN) <code class="codeph">DUPLICATE</code> command
                        </p>
                     </li>
                     <li>
                        <p>Snapshot standby</p>
                     </li>
                     <li>
                        <p>Data Pump Import and Export</p>
                     </li>
                  </ul>
                  <p>This will allow you to restore the database on the replay system to the application state as of the workload capture start time.</p>
                  <p>If the database is protected by Database Vault, then you need to be authorized&nbsp;to use the <code class="codeph">DBMS_WORKLOAD_CAPTURE</code>&nbsp;and <code class="codeph">DBMS_WORKLOAD_REPLAY</code> packages in a Database Vault environment before you can use Database Replay.
                  </p>
                  <div class="infoboxnotealso" id="GUID-372BA03D-7A24-4300-A0AE-30E0D9D9C724__GUID-DBC1E0E3-9262-43DC-8FEC-CC6C1873B125">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/ratug&amp;id=DVADM-GUID-1CEE7F8F-5C83-4322-862E-8DA7A9EC8034" target="_blank"><span><cite>Oracle Database Vault Administrator’s Guide</cite></span></a> for information about using Database Replay in a Database Vault environment
                           </p>
                        </li>
                        <li>
                           <p><a href="../bradv/rman-duplicating-databases.html#BRADV-GUID-F31F9FCE-B610-49EB-B9DB-44B9AA4E838F" target="_blank"><span><cite>Oracle Database Backup and Recovery User’s Guide</cite></span></a> for information about duplicating databases with RMAN
                           </p>
                        </li>
                        <li>
                           <p><a href="../sbydb/managing-oracle-data-guard-physical-standby-databases.html#SBYDB00700" target="_blank"><span><cite>Oracle Data Guard Concepts and Administration</cite></span></a> for information about managing snapshot standby databases
                           </p>
                        </li>
                        <li>
                           <p><a href="../sutil/oracle-data-pump-overview.html#SUTIL100" target="_blank"><span><cite>Oracle Database Utilities</cite></span></a> for information about using Data Pump
                           </p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div><a id="RATUG114"></a><div class="props_rev_3"><a id="GUID-00E1BF0A-489C-4141-A21C-44E3D80EC320" name="GUID-00E1BF0A-489C-4141-A21C-44E3D80EC320"></a><h3 id="RATUG-GUID-00E1BF0A-489C-4141-A21C-44E3D80EC320" class="sect3"><span class="enumeration_section">10.2 </span>Setting Up the Capture Directory
               </h3>
               <div>
                  <div><span>Determine the location and set up a directory where the captured workload will be stored.</span> Before starting the workload capture, ensure that the directory is empty and has ample disk space to store the workload. If the directory runs out of disk space during a workload capture, the capture will stop. To estimate the amount of disk space that is required, you can run a test capture on your workload for a short duration (such as a few minutes) to extrapolate how much space you will need for a full capture. To avoid potential performance issues, you should also ensure that the target replay directory is mounted on a separate file system.
                  </div>
                  <p>For Oracle RAC, consider using a shared file system. Alternatively, you can set up one capture directory path that resolves to separate physical directories on each instance, but you will need to consolidate the files created in each of these directories into a single directory. For captures on an Oracle RAC database, Enterprise Manager only supports Oracle RAC configured with a shared file system. The entire content of the local capture directories on each instance (not only the capture files) must be copied to the shared directory before it can be used for preprocessing. For example, assume that you are:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Running an Oracle RAC environment in Linux with two database instances named <code class="codeph">host1</code> and <code class="codeph">host2</code></p>
                     </li>
                     <li>
                        <p>Using a capture directory object named <code class="codeph">CAPDIR</code> that resolves to <code class="codeph">/$ORACLE_HOME/rdbms/capture</code> on both instances
                        </p>
                     </li>
                     <li>
                        <p>Using a shared directory that resides in <code class="codeph">/nfs/rac_capture</code></p>
                     </li>
                  </ul>
                  <p>You will need to login into each host and run the following command:</p><pre class="oac_no_warn" dir="ltr">cp -r /$ORACLE_HOME/rdbms/capture/* /nfs/rac_capture
</pre><p>After this is done for both instances, the <code class="codeph">/nfs/rac_capture</code> shared directory is ready to be preprocessed or masked.
                  </p>
               </div>
            </div><a id="RATUG111"></a><div class="props_rev_3"><a id="GUID-79F20163-CE64-4C9C-9F71-C41A95460C05" name="GUID-79F20163-CE64-4C9C-9F71-C41A95460C05"></a><h3 id="RATUG-GUID-79F20163-CE64-4C9C-9F71-C41A95460C05" class="sect3"><span class="enumeration_section">10.3 </span>Workload Capture Options
               </h3>
               <div>
                  <p>Proper planning before workload capture is required to ensure that the capture will be accurate and useful when replayed in another environment.</p>
                  <p>Before capturing a database workload, carefully consider the following <a id="d17564e558" class="indexterm-anchor"></a>options:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="capturing-a-database-workload.html#GUID-77DFEBE7-4FF9-4CB4-97B2-8501ECB8E7E4" title="While this step is not required, Oracle recommends that the database be restarted before capturing the workload to ensure that ongoing and dependent transactions are allowed to be completed or rolled back before the capture begins.">Restarting the Database</a></p>
                     </li>
                     <li>
                        <p><a href="capturing-a-database-workload.html#GUID-45889420-6496-4E7C-B698-A62E2580B962" title="By default, all user sessions are recorded during workload capture. You can use workload filters to specify which user sessions to include in or exclude from the workload during workload capture.">Using Filters with Workload Capture</a></p>
                     </li>
                  </ul>
               </div><a id="RATUG255"></a><a id="RATUG112"></a><div class="props_rev_3"><a id="GUID-77DFEBE7-4FF9-4CB4-97B2-8501ECB8E7E4" name="GUID-77DFEBE7-4FF9-4CB4-97B2-8501ECB8E7E4"></a><h4 id="RATUG-GUID-77DFEBE7-4FF9-4CB4-97B2-8501ECB8E7E4" class="sect4"><span class="enumeration_section">10.3.1 </span>Restarting the Database
                  </h4>
                  <div>
                     <div><span>While this step is not required, Oracle recommends that the database be restarted before capturing the workload to ensure that ongoing and dependent transactions are allowed to be completed or rolled back before the capture begins.</span> If the database is not restarted before the capture begins, transactions that are in progress or have yet to be committed will not be fully captured in the workload. Ongoing transactions will thus not be replayed properly, because only the part of the transaction whose calls were captured will be replayed. This may result in undesired replay divergence when the workload is replayed. Any subsequent transactions with dependencies on the incomplete transactions may also generate errors during replay. On a busy system, it is normal to see some replay divergence, but the replay can still be used to perform meaningful analysis of a system change if the diverged calls do not make up a significant portion of the replay in terms of DB time and other such key attributes.
                     </div>
                     <div class="section">
                        <p>Before restarting the database, determine an appropriate time to shut down the production database before the workload capture when it is the least disruptive. For example, you may want to capture a workload that begins at 8:00 a.m. However, to avoid service interruption during normal business hours, you may not want to restart the database during this time. In this case, you should consider starting the workload capture at an earlier time, so that the database can be restarted at a time that is less disruptive.</p>
                        <p>Once the database is restarted, it is important to start the workload capture before any user sessions reconnect and start issuing any workload. Otherwise, transactions performed by these user sessions will not be replayed properly in subsequent database replays, because only the part of the transaction whose calls were executed after the workload capture is started will be replayed. To avoid this problem, consider restarting the database in <code class="codeph">RESTRICTED</code> mode using <code class="codeph">STARTUP RESTRICT</code>, which will only allow the <code class="codeph">SYS</code> user to login and start the workload capture. By default, once the workload capture begins, any database instance that are in <code class="codeph">RESTRICTED</code> mode will automatically switch to <code class="codeph">UNRESTRICTED</code> mode, and normal operations can continue while the workload is being captured.
                        </p>
                        <p>Only one workload capture can be performed at any given time. If you have a Oracle Real Application Clusters (Oracle RAC) configuration, workload capture is performed for the entire database. Once you enable capture for one of the Oracle RAC nodes, workload capture is started on all database instances (the workload capture process is Oracle RAC aware). Although it is not required, restarting all instances in a Oracle RAC configuration before workload capture is recommended to avoid capturing ongoing transactions.</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-77DFEBE7-4FF9-4CB4-97B2-8501ECB8E7E4__GUID-D1E0D1BB-7B0A-4C64-9070-F52F36292EEA">To restart all instances in a Oracle RAC configuration before workload capture:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li><span>Shut down all the instances.</span></li>
                        <li><span>Restart all the instances.</span></li>
                        <li><span>Start workload capture.</span></li>
                        <li><span>Connect the application and start the user workload.</span></li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-77DFEBE7-4FF9-4CB4-97B2-8501ECB8E7E4__GUID-2AF9D86A-9301-40FA-BCD9-972F88D66812">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="../admin/starting-up-and-shutting-down.html#ADMIN11146" target="_blank"><span><cite>Oracle Database Administrator’s Guide</cite></span></a> for information about restricting access to an instance at startup
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="RATUG113"></a><div class="props_rev_3"><a id="GUID-45889420-6496-4E7C-B698-A62E2580B962" name="GUID-45889420-6496-4E7C-B698-A62E2580B962"></a><h4 id="RATUG-GUID-45889420-6496-4E7C-B698-A62E2580B962" class="sect4"><span class="enumeration_section">10.3.2 </span>Using Filters with Workload Capture
                  </h4>
                  <div>
                     <div><span>By default, all user sessions are recorded during workload capture. You can use workload filters to specify which user sessions to include in or exclude from the workload during workload capture.</span> There are two types of workload filters: inclusion filters and exclusion filters. You can use either inclusion filters or exclusion filters in a workload capture, but not both.
                     </div>
                     <p><a id="d17564e808" class="indexterm-anchor"></a>Inclusion filters enable you to specify user sessions that will be captured in the workload. This is useful if you want to capture only a subset of the database workload.
                     </p>
                     <p><a id="d17564e816" class="indexterm-anchor"></a>Exclusion filters enable you to specify user sessions that will not be captured in the workload. This is useful if you want to filter out session types that do not need to captured in the workload, such as those that monitor the infrastructure—like Oracle Enterprise Manager (EM) or Statspack—or other such processes that are already running on the test system. For example, if the system where the workload will be replayed is running EM, replaying captured EM sessions on the system will result in duplication of workload. In this case, you may want to use exclusion filters to filter out EM sessions.
                     </p>
                  </div>
               </div>
            </div><a id="RATUG115"></a><div class="props_rev_3"><a id="GUID-4A1995F1-78F9-4080-8DFC-1E3EBCB3F4B8" name="GUID-4A1995F1-78F9-4080-8DFC-1E3EBCB3F4B8"></a><h3 id="RATUG-GUID-4A1995F1-78F9-4080-8DFC-1E3EBCB3F4B8" class="sect3"><span class="enumeration_section">10.4 </span>Workload Capture Restrictions
               </h3>
               <div>
                  <p>Certain types of user sessions and client requests may sometimes be captured in a workload, but they are not supported by Database Replay. Capturing these session and request types in a workload may result in errors during workload replay.</p>
                  <p>The following types of user sessions and client requests are not supported by Database Replay:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Direct path load of data from external files using utilities such as SQL*Loader</p>
                     </li>
                     <li>
                        <p>Non-PL/SQL based Advanced Queuing (AQ)</p>
                     </li>
                     <li>
                        <p>Flashback queries</p>
                     </li>
                     <li>
                        <p>Oracle Call Interface (OCI) based object navigations</p>
                     </li>
                     <li>
                        <p>Non SQL-based object access</p>
                     </li>
                     <li>
                        <p>Distributed transactions </p>
                        <p>Any distributed transactions that are captured will be replayed as local transactions.</p>
                     </li>
                     <li>
                        <p>XA transactions</p>
                        <p>XA transactions are not captured or replayed. All local transactions are captured.</p>
                     </li>
                     <li>
                        <p><code class="codeph">JAVA_XA</code> transactions
                        </p>
                        <p>If the workload uses the <code class="codeph">JAVA_XA</code> package, <code class="codeph">JAVA_XA</code> function and procedure calls are captured as normal PL/SQL workload. To avoid problems during workload replay, consider dropping the <code class="codeph">JAVA_XA</code> package on the replay system to enable the replay to complete successfully.
                        </p>
                     </li>
                     <li>
                        <p>Database Resident Connection Pooling (DRCP)</p>
                     </li>
                     <li>
                        <p>Workloads using OUT binds</p>
                     </li>
                     <li>
                        <p>Multi-threaded Server (MTS) and shared server sessions with synchronization mode set to <code class="codeph">OBJECT_ID</code></p>
                     </li>
                     <li>
                        <p>Migrated sessions</p>
                        <p>The workload is captured for migrated sessions. However, user logins or session migration operations are not captured. Without a valid user login or session migration, the replay may cause errors because the workload may be replayed by a wrong user.</p>
                     </li>
                  </ul>
                  <p>Typically, Database Replay refrains from capturing these types of non-supported user sessions and client requests. Even when they are captured, Database Replay will not replay them. Therefore, it is usually not necessary to manually filter out non-supported user sessions and client requests. In cases where they are captured and found to cause errors during replay, consider using workload capture filters to exclude them from the workload.</p>
                  <div class="infoboxnotealso" id="GUID-4A1995F1-78F9-4080-8DFC-1E3EBCB3F4B8__GUID-36569EBC-CA5E-4257-A0A7-00E4DF175F6C">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><span class="q">"<a href="capturing-a-database-workload.html#GUID-45889420-6496-4E7C-B698-A62E2580B962" title="By default, all user sessions are recorded during workload capture. You can use workload filters to specify which user sessions to include in or exclude from the workload during workload capture.">Using Filters with Workload Capture</a>"</span> for information about using workload capture filters
                           </p>
                        </li>
                        <li>
                           <p><span class="q">"<a href="replaying-a-database-workload.html#GUID-22C2E8D1-48E7-492E-B116-CDE79686E1BE" title="By default, all captured database calls are replayed during workload replay. You can use workload filters to specify which database calls to include in or exclude from the workload during workload replay.">Using Filters with Workload Replay</a>"</span> for information about using workload replay filters
                           </p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div><a id="RATUG116"></a><div class="props_rev_3"><a id="GUID-46D117CD-67F5-41AD-B85C-41DC6BEE3E23" name="GUID-46D117CD-67F5-41AD-B85C-41DC6BEE3E23"></a><h3 id="RATUG-GUID-46D117CD-67F5-41AD-B85C-41DC6BEE3E23" class="sect3"><span class="enumeration_section">10.5 </span>Enabling and Disabling the Workload Capture Feature
               </h3>
               <div>
                  <div><span>Database Replay supports capturing a database workload on a system running Oracle Database 10<span class="italic">g</span> Release 2 that can be used to test database upgrades to Oracle Database 11<span class="italic">g</span> and subsequent releases.</span> By default, the workload capture feature is not enabled in Oracle Database 10<span class="italic">g</span> Release 2 (10.2). You can enable or disable this feature by specifying the <code class="codeph">PRE_11G_ENABLE_CAPTURE</code> initialization parameter.
                  </div>
                  <div class="section">
                     <div class="infoboxnote" id="GUID-46D117CD-67F5-41AD-B85C-41DC6BEE3E23__GUID-335D43CD-6C22-4388-BBE8-FC340371267C">
                        <p class="notep1">Note:</p>
                        <p>It is only necessary to enable the workload capture feature if you are capturing a database workload on a system running Oracle Database 10<span class="italic">g</span> Release 2.
                        </p>
                        <p>If you are capturing a database workload on a system running Oracle Database 11<span class="italic">g</span> Release 1 or a later release, it is not necessary to enable the workload capture feature because it is enabled by default. Furthermore, the <code class="codeph">PRE_11G_ENABLE_CAPTURE</code> initialization parameter is only valid with Oracle Database 10<span class="italic">g</span> Release 2 (10.2) and cannot be used with subsequent releases.
                        </p>
                     </div>
                     <p>To enable the workload capture feature on a system running Oracle Database 10<span class="italic">g</span> Release 2, run the <code class="codeph">wrrenbl.sql</code> script at the SQL prompt:
                     </p><pre class="oac_no_warn" dir="ltr">@$ORACLE_HOME/rdbms/admin/wrrenbl.sql
</pre><p>The <code class="codeph">wrrenbl.sql</code> script calls the <code class="codeph">ALTER SYSTEM</code> SQL statement to set the <code class="codeph">PRE_11G_ENABLE_CAPTURE</code> initialization parameter to <code class="codeph">TRUE</code>. If a server parameter file (spfile) is being used, the <code class="codeph">PRE_11G_ENABLE_CAPTURE</code> initialization parameter will be modified for the currently running instance and recorded in the spfile, so that the new setting will persist when the database is restarted. If a spfile is not being used, the <code class="codeph">PRE_11G_ENABLE_CAPTURE</code> initialization parameter will only be modified for the currently running instance, and the new setting will not persist when the database is restarted. To make the setting persistent without using a spfile, you will need to manually specify the parameter in the initialization parameter file (<code class="codeph">init.ora</code>).
                     </p>
                     <p>To disable workload capture, run the <code class="codeph">wrrdsbl.sql</code> script at the SQL prompt:
                     </p><pre class="oac_no_warn" dir="ltr">@$ORACLE_HOME/rdbms/admin/wrrdsbl.sql
</pre><p>The <code class="codeph">wrrdsbl.sql</code> script calls the <code class="codeph">ALTER SYSTEM</code> SQL statement to set the <code class="codeph">PRE_11G_ENABLE_CAPTURE</code> initialization parameter to <code class="codeph">FALSE</code>. If a server parameter file (spfile) is being used, the <code class="codeph">PRE_11G_ENABLE_CAPTURE</code> initialization parameter will be modified for the currently running instance and also recorded in the spfile, so that the new setting will persist when the database is restarted. If a spfile is not being used, the <code class="codeph">PRE_11G_ENABLE_CAPTURE</code> initialization parameter will only be modified for the currently running instance, and the new setting will not persist when the database is restarted. To make the setting persistent without using a spfile, you will need to manually specify the parameter in the initialization parameter file (<code class="codeph">init.ora</code>).
                     </p>
                     <div class="infoboxnote" id="GUID-46D117CD-67F5-41AD-B85C-41DC6BEE3E23__GUID-D26A3F33-489F-4DE0-8A1A-1D7E0302A335">
                        <p class="notep1">Note:</p>
                        <p>The <code class="codeph">PRE_11G_ENABLE_CAPTURE</code> initialization parameter can only be used with Oracle Database 10<span class="italic">g</span> Release 2 (10.2). This parameter is not valid in subsequent releases. After upgrading the database, you will need to remove the parameter from the server parameter file (spfile) or the initialization parameter file (<code class="codeph">init.ora</code>); otherwise, the database will fail to start up.
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="RATUG4206"></a><div class="props_rev_3"><a id="GUID-61E843E8-393A-49CE-8AF7-DCFA3E31982A" name="GUID-61E843E8-393A-49CE-8AF7-DCFA3E31982A"></a><h3 id="RATUG-GUID-61E843E8-393A-49CE-8AF7-DCFA3E31982A" class="sect3"><span class="enumeration_section">10.6 </span>Enterprise Manager Privileges and Roles
               </h3>
               <div>
                  <div><span>The Database Replay resource type privileges enable you to view or operate any Database Replay entities. Additionally, you need the target operator privilege for the target from which the workload was captured to access the entities associated with the workload.</span> For a target that does not exist anymore, the Enterprise Manager user who owns the entities or the Enterprise Manager super user can still access the entities.
                  </div>
                  <p>The two security roles discussed in the following sections make it easier to grant or revoke privileges related to Database Replay entities.</p>
               </div><a id="RATUG4207"></a><div class="props_rev_3"><a id="GUID-BE70B41D-C1B1-4E0F-8254-A85DEDE820AE" name="GUID-BE70B41D-C1B1-4E0F-8254-A85DEDE820AE"></a><h4 id="RATUG-GUID-BE70B41D-C1B1-4E0F-8254-A85DEDE820AE" class="sect4"><span class="enumeration_section">10.6.1 </span>Database Replay Viewer Role
                  </h4>
                  <div>
                     <div><span>Users who have the Database Replay Viewer role can view any Database Replay entity. 	By default, no Enterprise Manager user is granted this role.</span> However, the EM_ALL_VIEWER role includes this role by default.
                     </div>
                     <p>The Database Replay Viewer role consists of the Database Replay Viewer (resource type) privilege.</p>
                  </div>
               </div><a id="RATUG4208"></a><div class="props_rev_3"><a id="GUID-FEA9EDAC-5F4E-42E0-9FA2-8E3C91C19BAD" name="GUID-FEA9EDAC-5F4E-42E0-9FA2-8E3C91C19BAD"></a><h4 id="RATUG-GUID-FEA9EDAC-5F4E-42E0-9FA2-8E3C91C19BAD" class="sect4"><span class="enumeration_section">10.6.2 </span>Database Replay Operator Role
                  </h4>
                  <div>
                     <div><span>The Database Replay Operator role includes the Database Replay Viewer role and thus its privileges. Users who have the Database Replay Operator role can also edit and delete any Database Replay entity. By default, no Enterprise Manager user is granted this role.</span> However, the EM_ALL_OPERATOR role includes this role by default.
                     </div>
                     <p>The Database Replay Operator role consists of the following privileges:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Database Replay Operator (resource type privilege)</p>
                        </li>
                        <li>
                           <p>Create new Named Credential (resource type privilege)</p>
                        </li>
                        <li>
                           <p>Create new job (resource type privilege)</p>
                        </li>
                        <li>
                           <p>Connect to any viewable target (target type privilege)</p>
                        </li>
                        <li>
                           <p>Execute Command Anywhere (target type privilege)</p>
                        </li>
                     </ul>
                     <p>To capture or replay a workload on a database target, an Enterprise Manager user needs all the privileges granted by the Database Replay Operator role plus the target operator privilege for the database target.</p>
                  </div>
               </div>
            </div><a id="RATUG256"></a><a id="RATUG117"></a><div class="props_rev_3"><a id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681" name="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681"></a><h3 id="RATUG-GUID-1679DB12-B633-4021-A3B9-9CC6216D6681" class="sect3"><span class="enumeration_section">10.7 </span>Capturing a Database Workload Using Enterprise Manager
               </h3>
               <div>
                  <p>This section describes how to capture a database workload using Enterprise Manager. The primary tool for capturing database workloads is Oracle Enterprise Manager.</p>
                  <div class="p">For information about the prerequisites, see <span class="q">"<a href="capturing-a-database-workload.html#GUID-372BA03D-7A24-4300-A0AE-30E0D9D9C724" title="Before starting a workload capture, you should have a strategy in place to restore the database on the test system.">Prerequisites for Capturing a Database Workload</a>"</span>.
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <div class="infobox-tip" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-58335361-4144-45BA-BB5E-DCCE958A7880">
                        <p class="notep1">Tip:</p>
                        <p>If Oracle Enterprise Manager is unavailable, you can capture database workloads using APIs, as described in <span class="q">"<a href="capturing-a-database-workload.html#GUID-7AB9889A-6F05-41D3-8EA1-F4BEEC507BDE" title="This section describes how to capture a database workload using APIs.">Capturing a Database Workload Using APIs</a>"</span>.
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-65826CD4-F6E5-49F6-8454-68D980B1F0D9">To capture a database workload using Enterprise Manager:</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>From the Enterprise menu of the Enterprise Manager Cloud Control console, select <span class="bold">Quality Management</span>, then <span class="bold">Database Replay</span>.</span><div>
                           <p>If the Database Login page appears, log in as a user with administrator privileges.</p>
                           <p>The Database Replay page appears.</p>
                           <div class="figure" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-636CB4DE-022E-4A2A-A249-ECE711E9B6B5"><img src="img/dbr.gif" width="505" alt="Description of dbr.gif follows" title="Description of dbr.gif follows" longdesc="img_text/dbr.html"><br><a href="img_text/dbr.html">Description of the illustration dbr.gif</a></div>
                           <!-- class="figure" -->
                        </div>
                     </li>
                     <li class="stepexpand"><span>From the Database Replay page, click the <span class="bold">Captured Workloads</span> tab, then click <span class="bold">Create</span> in the toolbar.</span><div>
                           <p>The Create Capture: Plan Environment page appears.</p>
                           <div class="figure" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-2B8D9A99-7E97-42B7-A98D-DFD7AD81890F"><img src="img/dbr_capture_plan_env.gif" width="518" alt="Description of dbr_capture_plan_env.gif follows" title="Description of dbr_capture_plan_env.gif follows" longdesc="img_text/dbr_capture_plan_env.html"><br><a href="img_text/dbr_capture_plan_env.html">Description of the illustration dbr_capture_plan_env.gif</a></div>
                           <!-- class="figure" -->
                        </div>
                     </li>
                     <li class="stepexpand"><span>Verify that you have met both prerequisites described on this page, then enable both checkboxes and click <span class="bold">Next</span>.</span><div>
                           <p>The Create Capture: Database page appears.</p>
                           <div class="figure" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-3ADA7CB0-1B46-403B-AB6C-BF9F1A87FF87"><img src="img/dbr_capture_databases.gif" width="511" alt="Description of dbr_capture_databases.gif follows" title="Description of dbr_capture_databases.gif follows" longdesc="img_text/dbr_capture_databases.html"><br><a href="img_text/dbr_capture_databases.html">Description of the illustration dbr_capture_databases.gif</a></div>
                           <!-- class="figure" -->
                        </div>
                     </li>
                     <li class="stepexpand"><span>Click <span class="bold">Add</span>.</span><div>
                           <p>The Add pop-up appears.</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>Provide a capture name, provide an optional description, then click the Target Database search icon.</span><div>
                           <p>The Search and Select: Targets pop-up appears.</p>
                           <div class="figure" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-F2949E59-359F-4A2E-9451-4F42B9D4B936"><img src="img/dbr_capture_select_db.gif" width="355" alt="Description of dbr_capture_select_db.gif follows" title="Description of dbr_capture_select_db.gif follows" longdesc="img_text/dbr_capture_select_db.html"><br><a href="img_text/dbr_capture_select_db.html">Description of the illustration dbr_capture_select_db.gif</a></div>
                           <!-- class="figure" -->
                        </div>
                     </li>
                     <li class="stepexpand"><span>Select a Target Type, optionally provide a configuration search, choose a target database from the list, then click <span class="bold">Select</span>.</span><div>
                           <p>The Add pop-up reappears with added sections for Database Credential and Database Host Credential.</p>
                           <div class="figure" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-8C559666-AF20-40F2-9365-D6B5C2235CFC"><img src="img/dbr_capture_add_db.gif" width="497" alt="Description of dbr_capture_add_db.gif follows" title="Description of dbr_capture_add_db.gif follows" longdesc="img_text/dbr_capture_add_db.html"><br><a href="img_text/dbr_capture_add_db.html">Description of the illustration dbr_capture_add_db.gif</a></div>
                           <!-- class="figure" -->
                        </div>
                     </li>
                     <li class="stepexpand"><span>Provide database credentials, database host credentials, a Database Capture Intermediate Storage Location, then click <span class="bold">OK</span>.</span><div>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>After the Capture, the files are copied to the storage location, unless you use the intermediate storage location as the final storage location.</p>
                                 <div class="infoboxnote" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-E54D2C50-806A-4327-AA05-DF5A7B9284E0">
                                    <p class="notep1">Note:</p>
                                    <p>For captures on an Oracle RAC database, Enterprise Manager only supports Oracle RAC configured with a shared file system.</p>
                                 </div>
                              </li>
                           </ul>
                           <p>The selected target database now appears in the list of databases in the Select Production Databases table.</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>Click <span class="bold">Next</span>.</span><div>
                           <p>The <span class="bold">Create Capture:</span> Options page appears.
                           </p>
                           <div class="figure" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-6A36A705-C33C-4D40-9B65-7742C5F89A36"><img src="img/dbr_capture_options.gif" width="509" alt="Description of dbr_capture_options.gif follows" title="Description of dbr_capture_options.gif follows" longdesc="img_text/dbr_capture_options.html"><br><a href="img_text/dbr_capture_options.html">Description of the illustration dbr_capture_options.gif</a></div>
                           <!-- class="figure" -->
                        </div>
                     </li>
                     <li class="stepexpand"><span>Select the workload capture options:</span><div>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Under the SQL Performance Analyzer section, select whether to capture SQL statements into a SQL tuning set during workload capture.</p>
                                 <p>While Database Replay provides an analysis of how a change affects your entire system, you can use a SQL tuning set in conjunction with the SQL Performance Analyzer to gain a more SQL-centric analysis of how the change affects SQL statements and execution plans.</p>
                                 <p>By capturing a SQL tuning set during workload capture and another SQL tuning set during workload replay, you can use the SQL Performance Analyzer to compare these SQL tuning sets to each other without having to re-execute the SQL statements. This enables you to obtain a SQL Performance Analyzer report and compare the SQL performance, before and after changes, while running Database Replay.</p>
                                 <div class="infoboxnote" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-D29286FD-75C8-408E-A434-5D1B2F19A9AC">
                                    <p class="notep1">Note:</p>
                                    <p>Capturing SQL statements into a SQL Tuning Set is the default, and is the recommended workload capture option. Capturing SQL statements into a SQL Tuning Set is not available for Oracle RAC.</p>
                                 </div>
                                 <div class="infobox-tip" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-EED23F14-8E8D-4297-88F7-51A7A8EB8D97">
                                    <p class="notep1">Tip:</p>
                                    <p>For information about comparing SQL tuning sets using SQL Performance Analyzer reports, see <span class="q">"<a href="analyzing-captured-and-replayed-workloads.html#GUID-F711BF47-3898-4A8A-A210-FD87866659F4" title="This section describes how to generate a SQL Performance Analyzer report using the DBMS_WORKLOAD_REPLAY package.">Generating SQL Performance Analyzer Reports Using APIs</a>"</span>.
                                    </p>
                                 </div>
                              </li>
                              <li>
                                 <p>Under the Workload Filters section, select whether to use exclusion filters by selecting <span class="bold">Exclusion</span> in the Filter Mode list, or inclusion filters by selecting <span class="bold">Inclusion</span> in the Filter Mode list.
                                 </p>
                                 <p>To add filters, click <span class="bold">Add</span> and enter the filter name, session attribute, and value in the corresponding fields. 
                                 </p>
                                 <div class="infobox-tip" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-1938A21D-769A-4DFD-99BF-4E84E6BFD77E">
                                    <p class="notep1">Tip:</p>
                                    <p>For more information, see <span class="q">"<a href="capturing-a-database-workload.html#GUID-45889420-6496-4E7C-B698-A62E2580B962" title="By default, all user sessions are recorded during workload capture. You can use workload filters to specify which user sessions to include in or exclude from the workload during workload capture.">Using Filters with Workload Capture</a>"</span>.
                                    </p>
                                 </div>
                              </li>
                           </ul>
                           <p>After selecting the desired workload capture options, click <span class="bold">Next</span>.
                           </p>
                           <p>The Create Capture: Storage page appears.</p>
                           <div class="figure" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-47E5CC7A-AB06-4155-A330-0D922EEC6A4D"><img src="img/dbr_capture_storage.gif" width="511" alt="Description of dbr_capture_storage.gif follows" title="Description of dbr_capture_storage.gif follows" longdesc="img_text/dbr_capture_storage.html"><br><a href="img_text/dbr_capture_storage.html">Description of the illustration dbr_capture_storage.gif</a></div>
                           <!-- class="figure" -->
                        </div>
                     </li>
                     <li class="stepexpand"><span>Click the Storage Host icon, choose a target from the list, then click <span class="bold">Select</span>.</span><div>
                           <p>The Storage page now requests Host Credentials and a Storage Location.</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>Provide Host Credentials, click <span class="bold">Browse</span> to select a Storage Location, select the location and click <span class="bold">OK</span>, then click <span class="bold">Next</span>.</span><div>
                           <p>The Create Capture: Schedule page appears.</p>
                           <div class="figure" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-6F80F30B-21E0-4D47-95F3-EF33EA00B8D8"><img src="img/dbr_capture_schedule.gif" width="505" alt="Description of dbr_capture_schedule.gif follows" title="Description of dbr_capture_schedule.gif follows" longdesc="img_text/dbr_capture_schedule.html"><br><a href="img_text/dbr_capture_schedule.html">Description of the illustration dbr_capture_schedule.gif</a></div>
                           <!-- class="figure" -->
                        </div>
                     </li>
                     <li class="stepexpand"><span>Schedule the starting time and duration for the capture, schedule the exporting of AWR data, then click <span class="bold">Next</span>.</span><div>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The default capture duration is 5 minutes. Change the capture duration to capture representative activity over a time period of interest that needs to be tested.</p>
                              </li>
                           </ul>
                           <p>The Create Capture: Review page appears.</p>
                           <div class="figure" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-68494305-2D63-424B-BA7A-C44B1FE8D6A9"><img src="img/dbr_capture_review.gif" width="515" alt="Description of dbr_capture_review.gif follows" title="Description of dbr_capture_review.gif follows" longdesc="img_text/dbr_capture_review.html"><br><a href="img_text/dbr_capture_review.html">Description of the illustration dbr_capture_review.gif</a></div>
                           <!-- class="figure" -->
                        </div>
                     </li>
                     <li class="stepexpand"><span>If all of the parameters appear as you have intended, click <span class="bold">Submit</span> to start the capture job.</span><div>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The "Capture SQL statements into a SQL Tuning Set during workload capture" option is enabled by default. Uncheck this option if you do not want to compare SQL tuning sets at the end of the Replay.</p>
                              </li>
                           </ul>
                           <p>The Database Replay page reappears, displays a message that the capture was created successfully, and displays the status of the capture in the Captures list, such as "Scheduled."</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>For detailed information about the capture, double-click the name of the capture.</span><div>
                           <p>The Capture Summary page appears, and displays several attributes, including the average active sessions, a workload comparison, and related concurrent captures, if any.</p>
                        </div>
                     </li>
                  </ol>
                  <div class="section">
                     <div class="infobox-tip" id="GUID-1679DB12-B633-4021-A3B9-9CC6216D6681__GUID-9320AFEB-03F9-46E4-9C6F-9EA371DA966F">
                        <p class="notep1">Tip:</p>
                        <p>After capturing a workload on the production system, you need to preprocess the captured workload, as described in <a href="preprocessing-a-database-workload.html#GUID-4CEE2F79-F5A7-4EBA-9018-0CB99AB51C0A" title="After a workload is captured and setup of the test system is complete, the captured data must be preprocessed.">Preprocessing a Database Workload</a>.
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="RATUG4124"></a><div class="sect2"><a id="GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67" name="GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67"></a><h3 id="RATUG-GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67" class="sect3"><span class="enumeration_section">10.8 </span>Capturing Workloads from Multiple Databases Concurrently
               </h3>
               <div>
                  <p>Concurrent capture refers to capturing the workload on multiple databases simultaneously.</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67__GUID-61D3DE46-416F-4C53-9DF3-94B13AB092D4">To capture a concurrent database replay workload:</p>
                     <ol>
                        <li>
                           <p>From the Enterprise menu of the Enterprise Manager Cloud Control console, select <span class="bold">Quality Management</span>, then <span class="bold">Database Replay</span>.
                           </p>
                           <p>If the Database Login page appears, log in as a user with administrator privileges.</p>
                           <p>The Database Replay page appears.</p>
                        </li>
                        <li>
                           <p>From the Database Replay page, click the <span class="bold">Captured</span> <span class="bold">Workloads</span> tab, then click <span class="bold">Create</span> in the toolbar.
                           </p>
                           <p>The Create Capture: Plan Environment page appears.</p>
                        </li>
                        <li>
                           <p>Make sure that you have met both prerequisites described on this page, then enable both checkboxes and click <span class="bold">Next</span>.
                           </p>
                           <p>The Create Capture: Database page appears.</p>
                           <div class="infobox-tip" id="GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67__GUID-FE712472-3383-4898-9E86-AC65BD0505E1">
                              <p class="notep1">Tip:</p>
                              <p>For information about the prerequisites, see <span class="q">"<a href="capturing-a-database-workload.html#GUID-372BA03D-7A24-4300-A0AE-30E0D9D9C724" title="Before starting a workload capture, you should have a strategy in place to restore the database on the test system.">Prerequisites for Capturing a Database Workload</a>"</span>.
                              </p>
                           </div>
                        </li>
                        <li id="GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67__BABGGAGG">
                           <p>Click <span class="bold">Add</span>.
                           </p>
                           <p>The Add pop-up appears. </p>
                        </li>
                        <li>
                           <p>Provide a Capture name, provide an optional description, then click the Target Database search icon.</p>
                           <p>The Search and Select: Targets pop-up appears.</p>
                        </li>
                        <li>
                           <p>Choose a target database from the list, then click <span class="bold">Select</span>.
                           </p>
                           <p>The Add pop-up reappears with added sections for Database Credential and Database Host Credential.</p>
                        </li>
                        <li id="GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67__BABIDAGC">
                           <p>Provide database credentials, database host credentials, a Database Capture Intermediate Storage Location, then click <span class="bold">OK</span>.
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>After the Capture, the files are copied to the storage location, unless you use the intermediate storage location as the final storage location.</p>
                              </li>
                           </ul>
                           <p>The selected target database now appears in the list of databases in the Select Production Databases table.</p>
                        </li>
                        <li>
                           <p>Add another database for concurrent capture:</p>
                           <ol type="a">
                              <li>
                                 <p>Follow the instructions in steps <a href="capturing-a-database-workload.html#GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67__BABGGAGG">4</a> through <a href="capturing-a-database-workload.html#GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67__BABIDAGC">7</a>.
                                 </p>
                                 <p>The Create Capture: Database page reappears, and displays the additional database for capture along with the first database you specified in steps <a href="capturing-a-database-workload.html#GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67__BABGGAGG">4</a> through <a href="capturing-a-database-workload.html#GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67__BABIDAGC">7</a>.
                                 </p>
                              </li>
                              <li>
                                 <p>Provide a name and optional description for the concurrent capture, then click <span class="bold">Next</span>.
                                 </p>
                                 <p>The Create Capture: Options page appears.</p>
                              </li>
                           </ol>
                        </li>
                        <li>
                           <p>Select the workload capture options:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Under the SQL Performance Analyzer section, select whether to capture SQL statements into a SQL tuning set during workload capture.</p>
                                 <p>While Database Replay provides an analysis of how a change affects your entire system, you can use a SQL tuning set in conjunction with the SQL Performance Analyzer to gain a more SQL-centric analysis of how the change affects SQL statements and execution plans.</p>
                                 <p>By capturing a SQL tuning set during workload capture and another SQL tuning set during workload replay, you can use the SQL Performance Analyzer to compare these SQL tuning sets to each other without having to re-execute the SQL statements. This enables you to obtain a SQL Performance Analyzer report and compare the SQL performance, before and after changes, while running Database Replay.</p>
                                 <div class="infoboxnote" id="GUID-B36B0024-FBB1-4560-87A8-C2EF499B6F67__GUID-5D549E24-474C-4B66-8146-90158D7C6C33">
                                    <p class="notep1">Note:</p>
                                    <p>Capturing SQL statements into a SQL tuning set is the default and recommended workload capture option.</p>
                                 </div>
                              </li>
                              <li>
                                 <p>Under the Workload Filters section, select whether to use exclusion filters by selecting <span class="bold">Exclusion</span> in the Filter Mode list, or inclusion filters by selecting <span class="bold">Inclusion</span> in the Filter Mode list.
                                 </p>
                                 <p>To add filters, click <span class="bold">Add</span> and enter the filter name, session attribute, and value in the corresponding fields. 
                                 </p>
                              </li>
                           </ul>
                           <p>After selecting the desired workload capture options, click <span class="bold">Next</span>.
                           </p>
                           <p>The Create Capture: Storage page appears.</p>
                        </li>
                        <li>
                           <p>Click the Storage Host icon, choose a target from the list, then click <span class="bold">Select</span>.
                           </p>
                           <p>The Storage page now requests Host Credentials and a Storage Location.</p>
                        </li>
                        <li>
                           <p>Provide Host Credentials, click <span class="bold">Browse</span> to select a Storage Location, then click <span class="bold">Next</span>.
                           </p>
                           <p>The Create Capture: Schedule page appears.</p>
                        </li>
                        <li>
                           <p>Schedule the starting time and duration for the capture, schedule the exporting of AWR data, then click <span class="bold">Next</span>.
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The default capture duration is 5 minutes. Change the capture duration to capture representative activity over a time period of interest that needs to be tested.</p>
                              </li>
                           </ul>
                           <p>The Create Capture: Review page appears.</p>
                        </li>
                        <li>
                           <p>If all of the parameters appear as you have intended, click <span class="bold">Submit</span> to start the Capture job.
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The "Capture SQL statements into a SQL Tuning Set during workload capture" option is enabled by default. Uncheck this option if you do not want to compare SQL tuning sets at the end of the Replay.</p>
                              </li>
                           </ul>
                           <p>The Database Replay page reappears, displays a message that the capture was created successfully, and displays the status of the capture in the Captures list, such as "Scheduled."</p>
                        </li>
                        <li>
                           <p>For detailed information about the capture, double-click the name of the capture.</p>
                           <p>The Capture Summary page appears, and displays several attributes, including the average active sessions, a workload comparison, and related concurrent captures. </p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="RATUG118"></a><div class="props_rev_3"><a id="GUID-509ABE02-E9DB-420B-80AA-5FF2B8CDD9A5" name="GUID-509ABE02-E9DB-420B-80AA-5FF2B8CDD9A5"></a><h3 id="RATUG-GUID-509ABE02-E9DB-420B-80AA-5FF2B8CDD9A5" class="sect3"><span class="enumeration_section">10.9 </span>Monitoring a Workload Capture Using Enterprise Manager
               </h3>
               <div>
                  <div><span>This section describes how to monitor workload capture using Enterprise Manager. The primary tool for monitoring workload capture is Oracle Enterprise Manager.</span> Using Enterprise Manager, you can:
                  </div>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Monitor or stop an active workload capture</p>
                     </li>
                     <li>
                        <p>View a completed workload capture</p>
                     </li>
                  </ul>
                  <div class="infobox-tip" id="GUID-509ABE02-E9DB-420B-80AA-5FF2B8CDD9A5__GUID-42B2A28D-C786-4D2B-B886-B2CC31929994">
                     <p class="notep1">Tip:</p>
                     <p>If Oracle Enterprise Manager is unavailable, you can monitor workload capture using views, as described in <span class="q">"<a href="capturing-a-database-workload.html#GUID-B9D817BE-43F0-4813-B161-14FFD7F51D40" title="This section summarizes the views that you can display to monitor workload capture.">Monitoring Workload Capture Using Views</a>"</span>.
                     </p>
                  </div>
                  <p>This section contains the following topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="capturing-a-database-workload.html#GUID-7C587389-1A13-45DB-ADBB-C3C5A4BB2751" title="This section describes how to monitor an active workload capture using Enterprise Manager.">Monitoring an Active Workload Capture</a></p>
                     </li>
                     <li>
                        <p><a href="capturing-a-database-workload.html#GUID-FA80B526-BD52-44CE-9E25-165FA4D9265E" title="This section describes how to stop an active workload capture using Enterprise Manager.">Stopping an Active Workload Capture</a></p>
                     </li>
                     <li>
                        <p><a href="capturing-a-database-workload.html#GUID-5657880C-4520-4089-A842-BC97A40461A6" title="This section describes how to manage a completed workload capture using Enterprise Manager.">Viewing a Completed Workload Capture</a></p>
                     </li>
                  </ul>
               </div><a id="RATUG257"></a><a id="RATUG119"></a><div class="props_rev_3"><a id="GUID-7C587389-1A13-45DB-ADBB-C3C5A4BB2751" name="GUID-7C587389-1A13-45DB-ADBB-C3C5A4BB2751"></a><h4 id="RATUG-GUID-7C587389-1A13-45DB-ADBB-C3C5A4BB2751" class="sect4"><span class="enumeration_section">10.9.1 </span>Monitoring an Active Workload Capture
                  </h4>
                  <div>
                     <p>This section describes how to monitor an active workload capture using Enterprise Manager.</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-7C587389-1A13-45DB-ADBB-C3C5A4BB2751__GUID-4CB57B49-857C-4A91-BF7E-52690E1C7453">To monitor an active workload capture:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>From the Enterprise menu of the Enterprise Manager Cloud Control console, select <span class="bold">Quality Management</span>, then <span class="bold">Database Replay</span>.</span><div>
                              <p>If the Database Login page appears, log in as a user with administrator privileges.</p>
                              <p>The Database Replay page appears.</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>From the Captured Workloads tab of the Database Replay page for a capture that has a Status other than Completed, click the name of the desired capture from the Capture table.</span><div>
                              <p>The Summary tab of the Database Replay page appears, showing detailed statistics, a chart for average active sessions that updates dynamically while the capture is in progress, a comparison of data for captured elements versus the same elements not captured, and related concurrent captures, if any.</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>The Not Captured data shown in the Active Average Sessions chart shows the database activity (database sessions) that is not being captured.</p>
                                 </li>
                                 <li>
                                    <p>The values for the Total column in the Comparison section shows all of the captured and uncaptured activity in the database. Filtering, as determined by the Workload Filters you provided in the Options step of the Create Capture wizard, is primarily why some activity is captured or not. Additionally, background activities, database scheduler jobs, and unreplayable calls are not captured. </p>
                                 </li>
                                 <li>
                                    <p>You can click the refresh icon in the upper right corner to update the capture while it is running.</p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>To return to the Database Replay page, click the Database Replay breadcrumb.</span></li>
                     </ol>
                  </div>
               </div><a id="RATUG258"></a><a id="RATUG120"></a><div class="props_rev_3"><a id="GUID-FA80B526-BD52-44CE-9E25-165FA4D9265E" name="GUID-FA80B526-BD52-44CE-9E25-165FA4D9265E"></a><h4 id="RATUG-GUID-FA80B526-BD52-44CE-9E25-165FA4D9265E" class="sect4"><span class="enumeration_section">10.9.2 </span>Stopping an Active Workload Capture
                  </h4>
                  <div>
                     <p>This section describes how to stop an active workload capture using Enterprise Manager.</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-FA80B526-BD52-44CE-9E25-165FA4D9265E__GUID-12B1BCAD-1FC7-4C5D-9F26-867C75DE1AD2">To stop an active workload capture:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>From the Enterprise menu of the Enterprise Manager Cloud Control console, select <span class="bold">Quality Management</span>, then <span class="bold">Database Replay</span>.</span><div>
                              <p>If the Database Login page appears, log in as a user with administrator privileges.</p>
                              <p>The Database Replay page appears.</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>From the Captured Workloads tab of the Database Replay page for a capture that has a Status of Draft, click the name in the Capture table of the capture you want to stop.</span><div>
                              <p>The Capture Summary page appears.</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Click the <span class="bold">Stop Capture</span> button.</span><div>
                              <p>The button label changes to Stopping Capture. When the process completes, the Status changes to Stopped.</p>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div><a id="RATUG259"></a><a id="RATUG121"></a><div class="props_rev_3"><a id="GUID-5657880C-4520-4089-A842-BC97A40461A6" name="GUID-5657880C-4520-4089-A842-BC97A40461A6"></a><h4 id="RATUG-GUID-5657880C-4520-4089-A842-BC97A40461A6" class="sect4"><span class="enumeration_section">10.9.3 </span>Viewing a Completed Workload Capture
                  </h4>
                  <div>
                     <p>This section describes how to manage a completed workload capture using Enterprise Manager.</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-5657880C-4520-4089-A842-BC97A40461A6__GUID-80C8A55B-4E5C-430A-9727-F67FB0198178">To view a completed workload capture:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>From the Enterprise menu of the Enterprise Manager Cloud Control console, select <span class="bold">Quality Management</span>, then <span class="bold">Database Replay</span>.</span><div>
                              <p>If the Database Login page appears, log in as a user with administrator privileges.</p>
                              <p>The Database Replay page appears.</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>From the Capture Workloads tab of the Database Replay page, click the name of a capture that has a Status of Completed.</span><div>
                              <p>The contents of the Summary tab of the Database Replay page appears as for a capture in progress, except the Average Active Sessions chart shows aggregated data for the capture time period, rather than dynamic data recorded during the capture.</p>
                              <div class="figure" id="GUID-5657880C-4520-4089-A842-BC97A40461A6__GUID-F4969042-F21C-49D3-892C-2DC8878C2984"><img src="img/dbr_capture_view.gif" width="505" alt="Description of dbr_capture_view.gif follows" title="Description of dbr_capture_view.gif follows" longdesc="img_text/dbr_capture_view.html"><br><a href="img_text/dbr_capture_view.html">Description of the illustration dbr_capture_view.gif</a></div>
                              <!-- class="figure" -->
                              <p>The Average Active Sessions chart provides a graphic display of the captured session activity compared to the uncaptured session activity (such as background activities or filtered sessions). This chart appears only when Active Session History (ASH) data is available for the capture period.</p>
                              <p>Under Comparison, various statistics for the workload capture are displayed: </p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>Capture column</p>
                                    <p>Displays the statistics for the captured session activity.</p>
                                 </li>
                                 <li>
                                    <p>Total column</p>
                                    <p>Displays the statistics for the total session activity.</p>
                                 </li>
                                 <li>
                                    <p>Percentage of Total column</p>
                                    <p>Displays the percentage of total session activity that has been captured in the workload.</p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>To return to the Database Replay page, click the Database Replay breadcrumb.</span></li>
                     </ol>
                     <div class="section">
                        <div class="infobox-tip" id="GUID-5657880C-4520-4089-A842-BC97A40461A6__GUID-437E637D-7A9E-476A-995A-1FF2487EFC3C">
                           <p class="notep1">Tip:</p>
                           <p>See <a href="analyzing-captured-and-replayed-workloads.html#GUID-3E9AA9F2-B37B-4E03-9E00-FEB0A141631E" title="This chapter describes how to analyze captured and replayed workloads using various Database Replay reports.">Analyzing Captured and Replayed Workloads</a> for information about accessing workload capture reports.
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="RATUG4238"></a><div class="sect2"><a id="GUID-6F2BBECA-4259-493F-AEFE-4E4183476220" name="GUID-6F2BBECA-4259-493F-AEFE-4E4183476220"></a><h3 id="RATUG-GUID-6F2BBECA-4259-493F-AEFE-4E4183476220" class="sect3"><span class="enumeration_section">10.10 </span>Importing a Workload External to Enterprise Manager
               </h3>
               <div>
                  <div><span>You can import a workload captured through the PL/SQL interface or through a different Enterprise Manager instance into Enterprise Manager to manage it as you would for a workload originally created within Enterprise Manager.</span> The workload can be in the process of being captured, or the Capture can be completed and the workload stored on a file system. You can also preprocess and replay the workload as you would ordinarily do for a workload created within Enterprise Manager.
                  </div>
                  <p>This feature is available for Cloud Control Database plug-in 12.1.0.5 and later releases.</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-6F2BBECA-4259-493F-AEFE-4E4183476220__GUID-A6C3F23E-48C6-4185-9C81-2128152E2D37">To import a database workload external to Enterprise Manager:</p>
                     <ol>
                        <li>
                           <p>From the Database Replay page, click the <span class="bold">Captured Workloads</span> tab, then click <span class="bold">Import</span> in the toolbar.
                           </p>
                           <p>The Import Workload: Source page appears. </p>
                        </li>
                        <li id="GUID-6F2BBECA-4259-493F-AEFE-4E4183476220__BEIDEJGD">
                           <p>Select one of the three choices available to import a captured workload, then click <span class="bold">Next</span>:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="bold">Import a completed captured workload from a directory in the file system</span></p>
                                 <p>This option typically applies for a workload created using an API, in which you now want to import it to Enterprise Manager for subsequent processing. In this case, Enterprise Manager may not even be managing the Capture database.</p>
                              </li>
                              <li>
                                 <p><span class="bold">Import a completed captured workload from a database target</span></p>
                                 <p>In this case, Enterprise Manager is probably already managing the Capture database. The Capture could have been done on this database, or it could have been loaded in as would be the case for the option above.</p>
                              </li>
                              <li>
                                 <p><span class="bold">Attach to a Capture running in a database target</span></p>
                                 <p>This option is similar to the option above, except this a Capture that is still in progress, rather than one that has already completed.</p>
                              </li>
                           </ul>
                           <p>The Import Workload: Database page appears. </p>
                        </li>
                        <li>
                           <p>Click <span class="bold">the search icon next to the Database Target field and select a database from the pop-up that appears.</span></p>
                           <div class="infoboxnote" id="GUID-6F2BBECA-4259-493F-AEFE-4E4183476220__GUID-43AA989E-0490-42F4-92D2-1B73C67409CC">
                              <p class="notep1">Note:</p>
                              <p>The target version of the database loading the workload must be at least as high as the one you used to capture the workload. For instance, if you captured using Oracle Database 12x, the database you select to read the Capture must be at least version 12x.</p>
                           </div>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The system now requests database and host credentials. </p>
                              </li>
                              <li>
                                 <p>In the previous step, if you chose to import a completed captured workload from a directory in the file system, the system also requires a workload location.</p>
                              </li>
                              <li>
                                 <p>A consolidated Replay has a different directory structure in which there are at least two capture directories. Consequently, if the workload directory contains a consolidated Replay, you need to enable the check box so that Enterprise Manager can be aware of the consolidated Replay during the import operation.</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>Provide the requisite input for the step above, then click <span class="bold">Next</span>.
                           </p>
                           <p>The Import Workload: Workload page appears.</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>If you chose "Import a completed captured workload from a directory in the file system" in step <a href="capturing-a-database-workload.html#GUID-6F2BBECA-4259-493F-AEFE-4E4183476220__BEIDEJGD">2</a>, this page provides a Load Workload button.
                                 </p>
                              </li>
                              <li>
                                 <p>If you chose “Import a completed captured workload from a database target" or “Attach to a Capture running in a database target" in step <a href="capturing-a-database-workload.html#GUID-6F2BBECA-4259-493F-AEFE-4E4183476220__BEIDEJGD">2</a>, this page provides a Discover Workload button.
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>Click either <span class="bold">Load Workload</span> or <span class="bold">Discover Workload</span>, depending on which button is available in accordance with your selection in step <a href="capturing-a-database-workload.html#GUID-6F2BBECA-4259-493F-AEFE-4E4183476220__BEIDEJGD">2</a>.
                           </p>
                           <p>The system displays workloads, if found, in the Discovered Workloads table. </p>
                        </li>
                        <li>
                           <p>Either click <span class="bold">Next</span> to load the workload, or select one of the workloads, then click <span class="bold">Next</span> to continue importing the workload.
                           </p>
                           <p>The Import Workload: Replay page appears only under the following conditions:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>You chose "Import a completed captured workload from a directory in the file system" in step <a href="capturing-a-database-workload.html#GUID-6F2BBECA-4259-493F-AEFE-4E4183476220__BEIDEJGD">2</a>.
                                 </p>
                              </li>
                              <li>
                                 <p> The workload contains one or more Replays.</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p><span class="italic">Optional:</span> Select one or more Replays, if desired, provide a <span class="bold">Replay Task Name</span>, then click <span class="bold">Next</span>.
                           </p>
                           <p>The Import Workload: Review page appears.</p>
                        </li>
                        <li>
                           <p>If everything appears as you have intended, click <span class="bold">Submit</span>.
                           </p>
                           <p>The Database Replay page reappears and displays a message stating that the job was submitted successfully. The Status column for your loaded or imported workload in the Captured Workload table will show In Progress.</p>
                           <div class="infobox-tip" id="GUID-6F2BBECA-4259-493F-AEFE-4E4183476220__GUID-0283728E-CE2D-4258-9D26-97621DDF59CC">
                              <p class="notep1">Tip:</p>
                              <p>You can check on the job's progress by clicking on the captured workload name that you just submitted in the Review step. A Capture Summary page appears, and you can click the Database Replay Import Job link to see the progress of the job execution steps. </p>
                           </div>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="RATUG4239"></a><div class="props_rev_3"><a id="GUID-2DD9B05E-9BD9-4F4D-92F6-E399093CB876" name="GUID-2DD9B05E-9BD9-4F4D-92F6-E399093CB876"></a><h3 id="RATUG-GUID-2DD9B05E-9BD9-4F4D-92F6-E399093CB876" class="sect3"><span class="enumeration_section">10.11 </span>Creating Subsets from an Existing Workload
               </h3>
               <div>
                  <p>For cases in which you have captured a large workload covering a long period of time, you may only want to replay a portion of it to accelerate testing. The Database Replay Workload Subsetting feature enables you to create new workloads by extracting portions of an existing captured workload.</p>
                  <div class="section">
                     <p>Enterprise Manager provides a wizard to extract a subset of data from an existing workload that you can use for Replay on a test system. Each extracted subset is a legitimate workload that can be replayed on its own or with other workloads in a consolidated Replay. </p>
                     <p>To perform a Replay, you need to preprocess the workloads. </p>
                     <p>This feature is available for Cloud Control Database plug-in 12.1.0.5 and later releases.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-2DD9B05E-9BD9-4F4D-92F6-E399093CB876__GUID-A79CE21E-7CD8-4EC3-99E3-12762FF9DA36">To extract subsets from a workload:</p>
                     <ol>
                        <li>
                           <p>From the Captured Workloads tab of the Database Replay page, select a workload for which you want to extract a subset, then click <span class="bold">Subset</span>.
                           </p>
                           <p>The Subset Workload: Define page appears, showing an Active Sessions History chart for the workload.</p>
                        </li>
                        <li>
                           <p>Select a starting and ending time for the subset you want to extract from the workload:</p>
                           <ol type="a">
                              <li>
                                 <p>Click <span class="bold">Add</span> above the Subsets table at the bottom of the page.
                                 </p>
                                 <p>The Create Subset pop-up appears.</p>
                              </li>
                              <li>
                                 <p>Select either snapshot or calendar times, provide start and end times, then click <span class="bold">OK</span>.
                                 </p>
                                 <div class="infoboxnote" id="GUID-2DD9B05E-9BD9-4F4D-92F6-E399093CB876__GUID-6AB21BD6-4C2C-4D0B-BF27-856041157143">
                                    <p class="notep1">Note:</p>
                                    <p>Snapshot time is the preferred choice, because not all performance data may be available for the calendar time you select.</p>
                                 </div>
                                 <p>Your selected time period now appears in the Active Sessions chart as a greyed-out segment.</p>
                              </li>
                              <li>
                                 <p><span class="italic">Optional:</span> Define one or more additional subsets with different time periods than those you selected in the step above.
                                 </p>
                              </li>
                              <li>
                                 <p><span class="italic">Optional:</span> In the Advanced Parameters section, indicate whether you want to include incomplete calls after the subset workload ends. The default is to include incomplete calls when the subset workload begins.
                                 </p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>These parameters enable you to include the calls outside of your defined boundaries. For example, when you specify a starting and ending time as the boundaries for a transaction, the transaction may have started before your indicated start time, and may also have continued after your indicated end time. </p>
                                    </li>
                                 </ul>
                              </li>
                           </ol>
                        </li>
                        <li>
                           <p>Click <span class="bold">Next</span>.
                           </p>
                           <p>The Subset Workload: Database page appears. </p>
                        </li>
                        <li>
                           <p>Click <span class="bold">the search icon next to the Database Target field and select a database for subsetting from the Search and Select: Targets pop-up that appears.</span></p>
                           <p>The system now requests database and host credentials.</p>
                        </li>
                        <li>
                           <p>Provide the requisite input for the step above, then click <span class="bold">Next</span>.
                           </p>
                           <p>The Subset Workload: Location page appears.</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>If the source host and staged database host are the same, the location is pre-populated, so you do not need to provide the location for the source workload files.</p>
                              </li>
                              <li>
                                 <p>If the source host and staged database host are not the same, do the following:</p>
                                 <ol type="a">
                                    <li>
                                       <p>Choose whether you want to access the workload files from the host name shown in the Host field, or whether you want to copy the files from the source host to the Destination Host shown.</p>
                                       <p><span class="bold">Access Directly</span> means that the database to be used to subset the workload can access the original workload directly using the specified file system location. This is typically the case when the original workload is stored at a network shared location.
                                       </p>
                                       <p><span class="bold">Access Copy</span> means that the two hosts are not in the shared network path. You need to provide the source host credentials so that Enterprise Manager can copy the original workload from its current location to the specified location on the subset database host.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Depending on your choice above, either provide the directory location containing the workload files, or provide the location for the destination host.</p>
                                    </li>
                                 </ol>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>In the Subset field, specify the storage location for each subset, then click <span class="bold">Next</span>.
                           </p>
                           <p>The Subset Workload: Schedule page appears.</p>
                        </li>
                        <li>
                           <p>Indicate when you want to start the subset job, then click <span class="bold">Next</span>.
                           </p>
                           <p>The Subset Workload: Review page appears.</p>
                        </li>
                        <li>
                           <p>If everything appears as you have intended, click <span class="bold">Submit</span>.
                           </p>
                           <p>The Database Replay page reappears and displays a message stating that the job was submitted successfully. The Status column for your subset in the Replay Tasks table will show In Progress.</p>
                           <div class="infobox-tip" id="GUID-2DD9B05E-9BD9-4F4D-92F6-E399093CB876__GUID-4C686A78-419E-4D52-B0F8-1F13356E6FBB">
                              <p class="notep1">Tip:</p>
                              <p>You can check on the job's progress by clicking on the subset name that you just submitted in the Review step. A Capture Summary page appears, and you can click the Database Replay Subset Job link to see the progress of the job execution steps. </p>
                           </div>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="RATUG4240"></a><div class="props_rev_3"><a id="GUID-F89B9D09-2394-4C3F-AA11-EF1A73C23A85" name="GUID-F89B9D09-2394-4C3F-AA11-EF1A73C23A85"></a><h3 id="RATUG-GUID-F89B9D09-2394-4C3F-AA11-EF1A73C23A85" class="sect3"><span class="enumeration_section">10.12 </span>Copying or Moving a Workload to a New Location
               </h3>
               <div>
                  <div><span>You can use the copy function for two purposes.</span> The purposes are:
                  </div>
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Duplicate the Capture files from the source to another host and location.</p>
                        </li>
                        <li>
                           <p>Move the Capture files to a new host and location, and delete the source files from the original location. </p>
                        </li>
                     </ul>
                     <p>This feature is available for Cloud Control Database plug-in 12.1.0.5 and later releases.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-F89B9D09-2394-4C3F-AA11-EF1A73C23A85__GUID-F414CFB1-F3A9-453B-B73F-0E678036C2C2">To copy a workload to a new location:</p>
                     <ol>
                        <li>
                           <p>From the Captured Workloads tab of the Database Replay page, select a workload you want to copy to a new location, then click <span class="bold">Copy</span>.
                           </p>
                           <p>The Copy Workload page appears, and displays the current source location of the workload directory you selected.</p>
                        </li>
                        <li>
                           <p>Provide or change credentials for the storage host, if necessary. The system automatically picks up the previously defined credentials for the current storage host.</p>
                        </li>
                        <li>
                           <p>Leave the After Copy radio button enabled, which is "Keep original workload in the source location."</p>
                        </li>
                        <li>
                           <p>Select the <span class="bold">Storage Host</span> for the new location of the workload directory.
                           </p>
                        </li>
                        <li>
                           <p>Provide credentials for the new storage host.</p>
                        </li>
                        <li>
                           <p>Select the directory for the new <span class="bold">Destination Location</span> for the workload. 
                           </p>
                        </li>
                        <li>
                           <p>Schedule the job, then click <span class="bold">Submit</span>.
                           </p>
                           <p>The Database Replay page reappears and displays a message stating that the job was submitted and that the storage location has been updated successfully.</p>
                           <div class="infobox-tip" id="GUID-F89B9D09-2394-4C3F-AA11-EF1A73C23A85__GUID-3658FA9A-06A8-43C9-A541-09E74A476E8B">
                              <p class="notep1">Tip:</p>
                              <p>You can check on the job's progress by going to the Job Activity page, searching for the job name that appeared in the submit message, then clicking its link to access the Job Run page. </p>
                           </div>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="RATUG122"></a><div class="props_rev_3"><a id="GUID-7AB9889A-6F05-41D3-8EA1-F4BEEC507BDE" name="GUID-7AB9889A-6F05-41D3-8EA1-F4BEEC507BDE"></a><h3 id="RATUG-GUID-7AB9889A-6F05-41D3-8EA1-F4BEEC507BDE" class="sect3"><span class="enumeration_section">10.13 </span>Capturing a Database Workload Using APIs
               </h3>
               <div>
                  <div><span>This section describes how to capture a database workload using APIs.</span> You can also use Oracle Enterprise Manager to capture database workloads, as described in <span class="q">"<a href="capturing-a-database-workload.html#GUID-1679DB12-B633-4021-A3B9-9CC6216D6681" title="This section describes how to capture a database workload using Enterprise Manager. The primary tool for capturing database workloads is Oracle Enterprise Manager.">Capturing a Database Workload Using Enterprise Manager</a>"</span>.
                  </div>
                  <p>Capturing a database workload using the <code class="codeph">DBMS_WORKLOAD_CAPTURE</code> package involves:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="capturing-a-database-workload.html#GUID-4F96F1D0-475F-49ED-A3FD-C29C773EECBE" title="This section describes how to add and remove workload capture filters.">Defining Workload Capture Filters</a></p>
                     </li>
                     <li>
                        <p><a href="capturing-a-database-workload.html#GUID-C85885FA-715D-48AB-80F1-9C546988E667" title="This section describes how to start a workload capture.">Starting a Workload Capture</a></p>
                     </li>
                     <li>
                        <p><a href="capturing-a-database-workload.html#GUID-B6EE18AF-453C-4B67-975A-67D2F8773086" title="This section describes how to stop a workload capture.">Stopping a Workload Capture</a></p>
                     </li>
                     <li>
                        <p><a href="capturing-a-database-workload.html#GUID-9607209D-210B-4371-80F7-5536509F4FFB" title="Exporting AWR data enables detailed analysis of the workload. This data is also required if you plan to run the Replay Compare Period report or the AWR Compare Period report on a pair of workload captures or replays.">Exporting AWR Data for Workload Capture</a></p>
                     </li>
                     <li>
                        <p><a href="capturing-a-database-workload.html#GUID-87A99A24-F4CD-4342-9817-012322038E07" title="After AWR data is exported from the capture system, you can import the AWR data into another system, such as a test system where the captured workload will be replayed.">Importing AWR Data for Workload Capture</a></p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-7AB9889A-6F05-41D3-8EA1-F4BEEC507BDE__GUID-D0BDC231-E9E6-4DC1-9F64-F50289E64893">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="../arpls/DBMS_WORKLOAD_CAPTURE.html#ARPLS207" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for information about the <code class="codeph">DBMS_WORKLOAD_CAPTURE</code> package
                           </p>
                        </li>
                     </ul>
                  </div>
               </div><a id="RATUG123"></a><div class="props_rev_3"><a id="GUID-4F96F1D0-475F-49ED-A3FD-C29C773EECBE" name="GUID-4F96F1D0-475F-49ED-A3FD-C29C773EECBE"></a><h4 id="RATUG-GUID-4F96F1D0-475F-49ED-A3FD-C29C773EECBE" class="sect4"><span class="enumeration_section">10.13.1 </span>Defining Workload Capture Filters
                  </h4>
                  <div>
                     <div><span>This section describes how to add and remove workload capture filters.</span> For information about using workload filters with workload capture, see <span class="q">"<a href="capturing-a-database-workload.html#GUID-45889420-6496-4E7C-B698-A62E2580B962" title="By default, all user sessions are recorded during workload capture. You can use workload filters to specify which user sessions to include in or exclude from the workload during workload capture.">Using Filters with Workload Capture</a>"</span>.
                     </div>
                     <div class="section">
                        <p class="subhead3" id="GUID-4F96F1D0-475F-49ED-A3FD-C29C773EECBE__GUID-89596064-009D-4D3E-A648-F406426BC433">To add filters to a workload capture:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Use the <a id="d17564e3397" class="indexterm-anchor"></a><code class="codeph">ADD_FILTER</code> procedure:
                              </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_WORKLOAD_CAPTURE.ADD_FILTER (
                           fname =&gt; 'user_ichan',
                           fattribute =&gt; 'USER',
                           fvalue =&gt; 'ICHAN');
END;
/
</pre><p>In this example, the <code class="codeph">ADD_FILTER</code> procedure adds a filter named user_ichan, which can be used to filter out all sessions belonging to the user name ICHAN.
                              </p>
                              <p>The <code class="codeph">ADD_FILTER</code> procedure in this example uses the following parameters:
                              </p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>The <code class="codeph">fname</code> required parameter specifies the name of the filter that will be added.
                                    </p>
                                 </li>
                                 <li>
                                    <p>The <code class="codeph">fattribute</code> required parameter specifies the attribute on which the filter will be applied. Valid values include PROGRAM, MODULE, ACTION, SERVICE, INSTANCE_NUMBER, and USER.
                                    </p>
                                 </li>
                                 <li>
                                    <p>The <code class="codeph">fvalue</code> required parameter specifies the value for the corresponding attribute on which the filter will be applied. It is possible to use wildcards such as % with some of the attributes, such as modules and actions.
                                    </p>
                                 </li>
                              </ul>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-4F96F1D0-475F-49ED-A3FD-C29C773EECBE__GUID-B83F221F-EFB5-494B-9DE7-4B4E99BDACCF">To remove filters from a workload capture:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Use the <a id="d17564e3442" class="indexterm-anchor"></a><code class="codeph">DELETE_FILTER</code> procedure:
                              </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_WORKLOAD_CAPTURE.DELETE_FILTER (fname =&gt; 'user_ichan');
END;
/
</pre><p>In this example, the <code class="codeph">DELETE_FILTER</code> procedure removes the filter named user_ichan from the workload capture.
                              </p>
                              <p>The <code class="codeph">DELETE_FILTER</code> procedure in this example uses the <code class="codeph">fname</code> required parameter, which specifies the name of the filter to be removed. The <code class="codeph">DELETE_FILTER</code> procedure will not remove filters that belong to completed captures; it only applies to filters of captures that have yet to start.
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="RATUG124"></a><div class="props_rev_3"><a id="GUID-C85885FA-715D-48AB-80F1-9C546988E667" name="GUID-C85885FA-715D-48AB-80F1-9C546988E667"></a><h4 id="RATUG-GUID-C85885FA-715D-48AB-80F1-9C546988E667" class="sect4"><span class="enumeration_section">10.13.2 </span>Starting a Workload Capture
                  </h4>
                  <div>
                     <div><span>This section describes how to start a workload capture.</span> 
                     </div>
                     <div class="p">Before starting a workload capture, you must first complete the prerequisites for capturing a database workload. The prerequisites are described in <span class="q">"<a href="capturing-a-database-workload.html#GUID-372BA03D-7A24-4300-A0AE-30E0D9D9C724" title="Before starting a workload capture, you should have a strategy in place to restore the database on the test system.">Prerequisites for Capturing a Database Workload</a>"</span>. You should also review the workload capture options, as described in <span class="q">"<a href="capturing-a-database-workload.html#GUID-79F20163-CE64-4C9C-9F71-C41A95460C05" title="Proper planning before workload capture is required to ensure that the capture will be accurate and useful when replayed in another environment.">Workload Capture Options</a>"</span>.
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>It is important to have a well-defined starting point for the workload so that the replay system can be restored to that point before initiating a replay of the captured workload. To have a well-defined starting point for the workload capture, it is preferable not to have any active user sessions when starting a workload capture. If active sessions perform ongoing transactions, those transactions will not be replayed properly in subsequent database replays, since only that part of the transaction whose calls were executed after the workload capture is started will be replayed. To avoid this problem, consider restarting the database in restricted mode using <code class="codeph">STARTUP RESTRICT</code> before starting the workload capture. Once the workload capture begins, the database will automatically switch to unrestricted mode and normal operations can continue while the workload is being captured. For more information about restarting the database before capturing a workload, see <span class="q">"<a href="capturing-a-database-workload.html#GUID-77DFEBE7-4FF9-4CB4-97B2-8501ECB8E7E4" title="While this step is not required, Oracle recommends that the database be restarted before capturing the workload to ensure that ongoing and dependent transactions are allowed to be completed or rolled back before the capture begins.">Restarting the Database</a>"</span>.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-C85885FA-715D-48AB-80F1-9C546988E667__GUID-B0019AEB-00C0-49CE-803C-4F3FDD9FCFAE">To start a workload capture:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Use the <a id="d17564e3592" class="indexterm-anchor"></a><code class="codeph">START_CAPTURE</code> procedure:
                              </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_WORKLOAD_CAPTURE.START_CAPTURE (name =&gt; 'dec10_peak', 
                           dir =&gt; 'dec10',
                           duration =&gt; 600,
                           capture_sts =&gt; TRUE,
                           sts_cap_interval =&gt; 300,
                           plsql_mode =&gt; 'extended'
                           encryption =&gt; 'AES256');
END;
/
</pre><p>In this example, a workload named <code class="codeph">dec10_peak</code> will be captured for 600 seconds and stored in the file system defined by the database directory object named <code class="codeph">dec10</code>. A SQL tuning set will also be captured in parallel with the workload capture.
                              </p>
                              <p>The <code class="codeph">START_CAPTURE</code> procedure in this example uses the following parameters:
                              </p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>The <code class="codeph">name</code> required parameter specifies the name of the workload that will be captured.
                                    </p>
                                 </li>
                                 <li>
                                    <p>The <code class="codeph">dir</code> required parameter specifies a directory object pointing to the directory where the captured workload will be stored.
                                    </p>
                                 </li>
                                 <li>
                                    <p>The <code class="codeph">duration</code> parameter specifies the number of seconds before the workload capture will end. If a value is not specified, the workload capture will continue until the <code class="codeph">FINISH_CAPTURE</code> procedure is called.
                                    </p>
                                 </li>
                                 <li>
                                    <p>The <code class="codeph">capture_sts</code> parameter specifies whether to capture a SQL tuning set in parallel with the workload capture. If this parameter is set to <code class="codeph">TRUE</code>, you can capture a SQL tuning set during workload capture, then capture another SQL tuning set during workload replay, and use SQL Performance Analyzer to compare the SQL tuning sets without having to re-execute the SQL statements. This enables you to obtain a SQL Performance Analyzer report and compare the SQL performance—before and after the change—while running Database Replay. You can also export the resulting SQL tuning set with its AWR data using the <code class="codeph">EXPORT_AWR</code> procedure, as described in <span class="q">"<a href="capturing-a-database-workload.html#GUID-9607209D-210B-4371-80F7-5536509F4FFB" title="Exporting AWR data enables detailed analysis of the workload. This data is also required if you plan to run the Replay Compare Period report or the AWR Compare Period report on a pair of workload captures or replays.">Exporting AWR Data for Workload Capture</a>"</span>.
                                    </p>
                                    <p>This feature is not supported for Oracle RAC. Workload capture filters that are defined using <code class="codeph">DBMS_WORKLOAD_CAPTURE</code> do not apply to the SQL tuning set capture. The default value for this parameter is <code class="codeph">FALSE</code>.
                                    </p>
                                 </li>
                                 <li>
                                    <p>The <code class="codeph">sts_cap_interval</code> parameter specifies the duration of the SQL tuning set capture from the cursor cache in seconds. The default value is 300. Setting the value of this parameter below the default value may cause additional overhead with some workloads and is not recommended.
                                    </p>
                                 </li>
                                 <li>
                                    <p>The optional <code class="codeph">plsql_mode</code> parameter determines how PL/SQL is handled by DB Replay during capture and replays.
                                    </p>
                                    <p>These two values can be set for the <code class="codeph">plsql_mode</code> parameter:
                                    </p>
                                    <ul style="list-style-type: disc;">
                                       <li>
                                          <p><code class="codeph">top_level</code>: Only top-level PL/SQL calls are captured and replayed, which is how DB Replay handled PL/SQL prior to Oracle Database 12<span class="italic">c</span> Release 2 (12.2.0.1). This is the default value.
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">extended</code>: Both top-level PL/SQL calls and SQL called from PL/SQL are captured. When the workload is replayed, the replay can be done at either top-level or extended level, but not both.
                                          </p>
                                       </li>
                                    </ul>
                                 </li>
                              </ul>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>The <code class="codeph">encryption</code> parameter specifies the algorithm used for encrypting capture files.
                                    </p>
                                    <p>The following encryption standards can be used for the <code class="codeph">encryption</code> parameter:
                                    </p>
                                    <ul style="list-style-type: disc;">
                                       <li>
                                          <p>NULL - Capture files are not encrypted (the default value)</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">AES128</code> - Capture files are encrypted using AES128
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">AES192</code> - Capture files are encrypted using AES192
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">AES256</code> - Capture files are encrypted using AES256
                                          </p>
                                       </li>
                                    </ul>
                                    <div class="infoboxnote" id="GUID-C85885FA-715D-48AB-80F1-9C546988E667__GUID-D7F637AD-C232-427A-83CB-8EF17E1E6D26">
                                       <p class="notep1">Note:</p>
                                       <p>To run <code class="codeph">START_CAPTURE</code> with encryption, you must set the password using the <code class="codeph">oracle.rat.database_replay.encryption</code> (case-sensitive) identifier. The password is stored in a software keystore. For more information about creating a software keystore, see <a href="../asoag/configuring-transparent-data-encryption.html#ASOAG-GUID-1FA85E9E-5666-4CF3-A3C7-1F8A9230B0C9" target="_blank"><span><cite>Oracle Database Advanced Security Guide</cite></span></a>.
                                       </p>
                                    </div>
                                 </li>
                              </ul>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-C85885FA-715D-48AB-80F1-9C546988E667__GUID-A1B49722-C27E-47CE-A2B3-6B9B16E72B01">Example: Setting up a password-based software keystore:</p>
                        <p>The following statement creates a password-based software keystore:</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT CREATE KEYSTORE 'MYKEYSTORE' IDENTIFIED BY <span class="italic">password;</span></pre><p>The following statements open the password-based software keystore and create a backup of the password-based software keystore:</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN IDENTIFIED BY <span class="italic">password;</span>

ADMINISTER KEY MANAGEMENT SET KEY IDENTIFIED BY <span class="italic">password</span> WITH BACKUP;</pre><p>The following statement adds secret <code class="codeph"><span class="codeinlineitalic">secret_key,</span></code> with the tag <code class="codeph">DBREPLAY,</code> for client <code class="codeph">'oracle.rat.database_replay.encryption'</code> to the password-based software keystore. It also creates a backup of the password-based software keystore before adding the secret:
                        </p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT ADD SECRET <span class="italic">secret_key</span> FOR CLIENT 'oracle.rat.database_replay.encryption' USING TAG 'DBREPLAY' 
IDENTIFIED BY <span class="italic">password</span> WITH BACKUP;</pre><p>The following statement closes the password-based software keystore:</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE CLOSE IDENTIFIED BY <span class="italic">password;</span></pre><div class="infoboxnote" id="GUID-C85885FA-715D-48AB-80F1-9C546988E667__GUID-122C54F7-FBB1-4120-8709-1761A7B7FB84">
                           <p class="notep1">Note:</p>
                           <p>The software keystore must be kept open before running database capture and database replay.</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="RATUG125"></a><div class="props_rev_3"><a id="GUID-B6EE18AF-453C-4B67-975A-67D2F8773086" name="GUID-B6EE18AF-453C-4B67-975A-67D2F8773086"></a><h4 id="RATUG-GUID-B6EE18AF-453C-4B67-975A-67D2F8773086" class="sect4"><span class="enumeration_section">10.13.3 </span>Stopping a Workload Capture
                  </h4>
                  <div>
                     <p>This section describes how to stop a workload capture.</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-B6EE18AF-453C-4B67-975A-67D2F8773086__GUID-B37D10BC-49AB-42DB-99EA-FE768A7CFCFB">To stop a workload capture:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Use the <a id="d17564e3881" class="indexterm-anchor"></a><code class="codeph">FINISH_CAPTURE</code> procedure:
                              </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_WORKLOAD_CAPTURE.FINISH_CAPTURE (); 
END;
/
</pre><p>In this example, the <code class="codeph">FINISH_CAPTURE</code> procedure finalizes the workload capture and returns the database to a normal state.
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <div class="infobox-tip" id="GUID-B6EE18AF-453C-4B67-975A-67D2F8773086__GUID-92B35556-4889-4EC6-971E-354C24264FAC">
                           <p class="notep1">Tip:</p>
                           <p>After capturing a workload on the production system, you need to preprocess the captured workload, as described in <a href="preprocessing-a-database-workload.html#GUID-4CEE2F79-F5A7-4EBA-9018-0CB99AB51C0A" title="After a workload is captured and setup of the test system is complete, the captured data must be preprocessed.">Preprocessing a Database Workload</a>.
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="RATUG126"></a><div class="props_rev_3"><a id="GUID-9607209D-210B-4371-80F7-5536509F4FFB" name="GUID-9607209D-210B-4371-80F7-5536509F4FFB"></a><h4 id="RATUG-GUID-9607209D-210B-4371-80F7-5536509F4FFB" class="sect4"><span class="enumeration_section">10.13.4 </span>Exporting AWR Data for Workload Capture
                  </h4>
                  <div>
                     <p>Exporting AWR data enables detailed analysis of the workload. This data is also required if you plan to run the Replay Compare Period report or the AWR Compare Period report on a pair of workload captures or replays.</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-9607209D-210B-4371-80F7-5536509F4FFB__GUID-B427ED7C-95E5-481B-9078-72145B02EBF8">To export AWR data:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Use the <a id="d17564e3998" class="indexterm-anchor"></a><code class="codeph">EXPORT_AWR</code> procedure:
                              </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_WORKLOAD_CAPTURE.EXPORT_AWR (capture_id =&gt; 2);
END;
/
</pre><p>In this example, the AWR snapshots that correspond to the workload capture with a capture ID of 2 are exported, along with any SQL tuning set that may have been captured during workload capture.</p>
                              <p>The <code class="codeph">EXPORT_AWR</code> procedure uses the <code class="codeph">capture_id</code> required parameter, which specifies the ID of the capture whose AWR snapshots will be exported. The value of the <code class="codeph">capture_id</code> parameter is displayed in the <code class="codeph">ID</code> column of the <code class="codeph">DBA_WORKLOAD_CAPTURES</code> view.
                              </p>
                              <div class="infoboxnote" id="GUID-9607209D-210B-4371-80F7-5536509F4FFB__GUID-683BE151-3C01-4FA7-BF57-C71BFBCE4B50">
                                 <p class="notep1">Note:</p>
                                 <p>This procedure works only if the corresponding workload capture was performed in the current database and the AWR snapshots that correspond to the original capture time period are still available.</p>
                              </div>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-9607209D-210B-4371-80F7-5536509F4FFB__GUID-57DFEFB3-43EA-4552-BDAB-BF746BA90B85">
                           <p class="notep1">See Also:</p>
                           <p><a href="../refrn/DBA_WORKLOAD_CAPTURES.html#REFRN23628" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> for information about the <code class="codeph">DBA_WORKLOAD_CAPTURES</code> view
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="RATUG4194"></a><div class="props_rev_3"><a id="GUID-87A99A24-F4CD-4342-9817-012322038E07" name="GUID-87A99A24-F4CD-4342-9817-012322038E07"></a><h4 id="RATUG-GUID-87A99A24-F4CD-4342-9817-012322038E07" class="sect4"><span class="enumeration_section">10.13.5 </span>Importing AWR Data for Workload Capture
                  </h4>
                  <div>
                     <div><span>After AWR data is exported from the capture system, you can import the AWR data into another system, such as a test system where the captured workload will be replayed.</span> Importing AWR data enables detailed analysis of the workload. This data is also required if you plan to run the Replay Compare Period report or the AWR Compare Period report on a pair of workload captures or replays.
                     </div>
                     <div class="section">
                        <p class="subhead3" id="GUID-87A99A24-F4CD-4342-9817-012322038E07__GUID-A39B4264-4AF3-487C-9CB0-6BB37E88722E">To import AWR data:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Use the <a id="d17564e4137" class="indexterm-anchor"></a><code class="codeph">IMPORT_AWR</code> function, as shown in the following example:
                              </p><pre class="oac_no_warn" dir="ltr">CREATE USER capture_awr
SELECT DBMS_WORKLOAD_CAPTURE.IMPORT_AWR (capture_id =&gt; 2,
                                         staging_schema =&gt; 'capture_awr')
  FROM DUAL;
</pre><p>In this example, the AWR snapshots that correspond to the workload capture with a capture ID of 2 are imported using a staging schema named <code class="codeph">capture_awr</code>.
                              </p>
                              <p>The <code class="codeph">IMPORT_AWR</code> procedure in this example uses the following parameters:
                              </p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>The <code class="codeph">capture_id</code> required parameter specifies the ID of the capture whose AWR snapshots will be import. The value of the <code class="codeph">capture_id</code> parameter is displayed in the <code class="codeph">ID</code> column of the <code class="codeph">DBA_WORKLOAD_CAPTURES</code> view.
                                    </p>
                                 </li>
                                 <li>
                                    <p>The <code class="codeph">staging_schema</code> required parameter specifies the name of a valid schema in the current database which can be used as a staging area while importing the AWR snapshots from the capture directory to the <code class="codeph">SYS</code> <code class="codeph">AWR</code> schema.
                                    </p>
                                 </li>
                              </ul>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <div class="infoboxnote" id="GUID-87A99A24-F4CD-4342-9817-012322038E07__GUID-11EDA585-1BA7-43CE-AB21-8D3357A61723">
                           <p class="notep1">Note:</p>
                           <p>This function fails if the schema specified by the <code class="codeph">staging_schema</code> parameter contains any tables with the same name as any of the AWR tables.
                           </p>
                        </div>
                        <div class="infoboxnotealso" id="GUID-87A99A24-F4CD-4342-9817-012322038E07__GUID-02B63215-231C-4BEF-B046-52E5F27BB15B">
                           <p class="notep1">See Also:</p>
                           <p><a href="../refrn/DBA_WORKLOAD_CAPTURES.html#REFRN23628" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> for information about the <code class="codeph">DBA_WORKLOAD_CAPTURES</code> view
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-19A5094A-185D-4F1C-B441-FB72AC9EA2ED" name="GUID-19A5094A-185D-4F1C-B441-FB72AC9EA2ED"></a><h3 id="RATUG-GUID-19A5094A-185D-4F1C-B441-FB72AC9EA2ED" class="sect3"><span class="enumeration_section">10.14 </span>Encrypting and Decrypting an Existing Workload Capture Using APIs
               </h3>
               <div>
                  <p>This section describes how to encrypt and decrypt an existing workload capture using APIs.</p>
                  <p>During a workload capture, a variety of information such as connection strings, SQL text, and bind values are saved. This information can be encrypted if it contains sensitive data. You can enable encryption during workload capture as described in <a href="capturing-a-database-workload.html#GUID-C85885FA-715D-48AB-80F1-9C546988E667" title="This section describes how to start a workload capture.">Starting a Workload Capture</a>.
                  </p>
               </div>
               <div class="sect3"><a id="GUID-F5B503CD-6E39-4EE4-9869-060731304EED" name="GUID-F5B503CD-6E39-4EE4-9869-060731304EED"></a><h4 id="RATUG-GUID-F5B503CD-6E39-4EE4-9869-060731304EED" class="sect4"><span class="enumeration_section">10.14.1 </span>Encrypting an Existing Workload Capture
                  </h4>
                  <div>
                     <p>This section describes how to encrypt an existing workload capture.</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-F5B503CD-6E39-4EE4-9869-060731304EED__GUID-B12D05B8-83E3-457D-BAC8-40E22140AC45">To encrypt an existing workload capture:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Use the <a id="d17564e4382" class="indexterm-anchor"></a><code class="codeph">ENCRYPT_CAPTURE</code> procedure:
                              </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_WORKLOAD_CAPTURE.ENCRYPT_CAPTURE(src_dir =&gt; 'dec10',
                                        dst_dir =&gt; 'dec10_enc',
                                        encryption =&gt; 'AES128');
END;
/
</pre><p>The <code class="codeph">ENCRYPT_CAPTURE</code> procedure in this example uses the following parameters:
                              </p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>The <code class="codeph">src_dir</code> parameter points to the directory that contains the workload capture to be encrypted.
                                    </p>
                                 </li>
                                 <li>
                                    <p>The <code class="codeph">dst_dir</code> parameter points to the directory where the encrypted capture is saved after encryption.
                                    </p>
                                 </li>
                                 <li>
                                    <p>The <code class="codeph">encryption</code> parameter specifies the algorithm used for encrypting the workload capture.
                                    </p>
                                 </li>
                              </ul>
                           </li>
                        </ul>
                        <div class="infoboxnote" id="GUID-F5B503CD-6E39-4EE4-9869-060731304EED__GUID-929FE974-FA5A-4DDE-8699-575477431791">
                           <p class="notep1">Note:</p>
                           <p>Before running <code class="codeph">DBMS_WORKLOAD_CAPTURE.ENCRYPT_CAPTURE</code>, you must store the <code class="codeph">oracle.rat.database_replay.encryption</code> (case-sensitive) identifier in a software keystore.
                           </p>
                        </div>
                        <div class="infoboxnotealso" id="GUID-F5B503CD-6E39-4EE4-9869-060731304EED__GUID-59F0A1AE-7AB6-4160-8CCB-823D8ABB20E6">
                           <p class="notep1">See Also:</p>
                           <p><a href="../arpls/DBMS_WORKLOAD_CAPTURE.html#ARPLS-GUID-14CC7E0D-BAD1-4FBE-B018-9C3341563E21" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-67E3C3B9-F074-4A4B-80C0-43DD515D5DB9" name="GUID-67E3C3B9-F074-4A4B-80C0-43DD515D5DB9"></a><h4 id="RATUG-GUID-67E3C3B9-F074-4A4B-80C0-43DD515D5DB9" class="sect4"><span class="enumeration_section">10.14.2 </span>Decrypting an Encrypted Workload Capture
                  </h4>
                  <div>
                     <p>This section describes how to decrypt an encrypted workload capture.</p>
                     <div class="section">
                        <p>An encrypted workload capture can be decrypted by using the <code class="codeph">DBMS_WORKLOAD_CAPTURE.DECRYPT_CAPTURE</code> procedure.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-67E3C3B9-F074-4A4B-80C0-43DD515D5DB9__GUID-373E2B2B-5755-4E1E-AEA3-467CCC86CA88">To decrypt an encrypted workload capture:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Use the <a id="d17564e4530" class="indexterm-anchor"></a><code class="codeph">DECRYPT_CAPTURE</code> procedure:
                              </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_WORKLOAD_CAPTURE.DECRYPT_CAPTURE(src_dir =&gt; 'dec10_enc',
                                        dst_dir =&gt; 'dec10');
END;
/
</pre><p>The <code class="codeph">DECRYPT_CAPTURE</code> procedure in this example uses the following parameters:
                              </p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>The <code class="codeph">src_dir</code> parameter points to the directory that contains the encrypted capture.
                                    </p>
                                 </li>
                                 <li>
                                    <p>The <code class="codeph">dst_dir</code> parameter points to the directory where the decrypted capture is saved after decryption.
                                    </p>
                                 </li>
                              </ul>
                           </li>
                        </ul>
                        <div class="infoboxnote" id="GUID-67E3C3B9-F074-4A4B-80C0-43DD515D5DB9__GUID-9B5361FF-4F9D-4DC3-ABDE-AD8D8DF2CEC4">
                           <p class="notep1">Note:</p>
                           <p>Before running <code class="codeph">DBMS_WORKLOAD_CAPTURE.DECRYPT_CAPTURE</code>, you must store the <code class="codeph">oracle.rat.database_replay.encryption</code> (case-sensitive) identifier in a software keystore.
                           </p>
                        </div>
                        <div class="infoboxnotealso" id="GUID-67E3C3B9-F074-4A4B-80C0-43DD515D5DB9__GUID-2A4E46BF-E6E2-4152-A467-E80FE858E63B">
                           <p class="notep1">See Also:</p>
                           <p><a href="../arpls/DBMS_WORKLOAD_CAPTURE.html#ARPLS-GUID-FF5E0954-DD22-4BE5-85F2-A720858C5A06" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="RATUG127"></a><div class="sect2"><a id="GUID-B9D817BE-43F0-4813-B161-14FFD7F51D40" name="GUID-B9D817BE-43F0-4813-B161-14FFD7F51D40"></a><h3 id="RATUG-GUID-B9D817BE-43F0-4813-B161-14FFD7F51D40" class="sect3"><span class="enumeration_section">10.15 </span>Monitoring Workload Capture Using Views
               </h3>
               <div>
                  <div><span>This section summarizes the views that you can display to monitor workload capture.</span> You can also use Oracle Enterprise Manager to monitor workload capture, as described in <span class="q">"<a href="capturing-a-database-workload.html#GUID-509ABE02-E9DB-420B-80AA-5FF2B8CDD9A5" title="This section describes how to monitor workload capture using Enterprise Manager. The primary tool for monitoring workload capture is Oracle Enterprise Manager.">Monitoring a Workload Capture Using Enterprise Manager</a>"</span>.
                  </div>
                  <p>To access these views, you need DBA privileges:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>The <code class="codeph">DBA_WORKLOAD_CAPTURES</code> view lists all the workload captures that have been captured in the current database.
                        </p>
                     </li>
                     <li>
                        <p>The <code class="codeph">DBA_WORKLOAD_FILTERS</code> view lists all workload filters used for workload captures defined in the current database.
                        </p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-B9D817BE-43F0-4813-B161-14FFD7F51D40__GUID-45594D61-FC4E-4C4E-83C1-F33CBB866A12">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="../refrn/DBA_WORKLOAD_CAPTURES.html#REFRN23628" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> for information about the <code class="codeph">DBA_WORKLOAD_CAPTURES</code> view
                           </p>
                        </li>
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/ratug&amp;id=REFRN23630" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> for information about the <code class="codeph">DBA_WORKLOAD_FILTERS</code> view
                           </p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>