<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Using a TransactionProvider</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Java API Developer's Guide ">
      <meta property="og:description" content>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Java API Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="olap-java-api-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-10T13:53:39-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2000, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96402-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="making-queries-using-source-methods.html" title="Previous" type="text/html">
      <link rel="next" href="understanding-cursor-classes-and-concepts.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="OLAP Java API Developer's Guide">
    <meta name="dcterms.isVersionOf" content="OLAAP">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="making-queries-using-source-methods.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="understanding-cursor-classes-and-concepts.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Java API Developer's Guide </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Using a TransactionProvider</li>
            </ol>
            <a id="GUID-E290E8B5-CC10-4BDF-91B1-7189BE7F12B9" name="GUID-E290E8B5-CC10-4BDF-91B1-7189BE7F12B9"></a><a id="OLAAP326"></a>
            
            <h2 id="OLAAP-GUID-E290E8B5-CC10-4BDF-91B1-7189BE7F12B9" class="sect2"><span class="enumeration_chapter">7 </span> Using a TransactionProvider
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>This chapter describes the Oracle OLAP Java API <code class="codeph">Transaction</code> and <code class="codeph">TransactionProvider</code> interfaces and describes how you use implementations of those interfaces in an application. You get a <code class="codeph">TransactionProvider</code> from a <code class="codeph">DataProvider</code>. You use the <code class="codeph">commitCurrentTransaction</code> method of the <code class="codeph">TransactionProvider</code> to save a metadata object in persistent storage in the database. You also use that method after creating a derived <code class="codeph">Source</code> and before creating a <code class="codeph">Cursor</code> for the <code class="codeph">Source</code>. For examples of committing a <code class="codeph">Transaction</code> after creating a metadata object, see <a href="creating-metadata-and-analytic-workspaces.html#GUID-67674127-304F-4F8A-BCA1-410C8CB4797E"> Creating Metadata and Analytic Workspaces</a>.
               </p>
               <p>This chapter includes the following topics:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="using-transaction-provider.html#GUID-97F18515-5688-4559-A476-0E87C2A787F1">About Creating a Metadata Object or a Query in a Transaction</a></p>
                  </li>
                  <li>
                     <p><a href="using-transaction-provider.html#GUID-BDE99A6B-1D4D-473E-A719-6590C6A4D7B1">Using TransactionProvider Objects</a></p>
                  </li>
               </ul>
            </div><a id="OLAAP327"></a><div class="props_rev_3"><a id="GUID-97F18515-5688-4559-A476-0E87C2A787F1" name="GUID-97F18515-5688-4559-A476-0E87C2A787F1"></a><h3 id="OLAAP-GUID-97F18515-5688-4559-A476-0E87C2A787F1" class="sect3"><span class="enumeration_section">7.1 </span>About Creating a Metadata Object or a Query in a Transaction
               </h3>
               <div>
                  <p>The Oracle OLAP Java API is transactional. Creating metadata objects or <code class="codeph">Source</code> objects for a query occurs in the context of a <code class="codeph">Transaction</code>. A <code class="codeph">TransactionProvider</code> provides <code class="codeph">Transaction</code> objects to the application and commits or discards those <code class="codeph">Transaction</code> objects.
                  </p>
                  <p>The <code class="codeph">TransactionProvider</code> ensures the following:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>A <code class="codeph">Transaction</code> is isolated from other <code class="codeph">Transaction</code> objects. Operations performed in a <code class="codeph">Transaction</code> are not visible in, and do not affect, other <code class="codeph">Transaction</code> objects.
                        </p>
                     </li>
                     <li>
                        <p>If an operation in a <code class="codeph">Transaction</code> fails, then the effects of the operation are undone (the <code class="codeph">Transaction</code> is rolled back).
                        </p>
                     </li>
                     <li>
                        <p>The effects of a completed <code class="codeph">Transaction</code> persist.
                        </p>
                     </li>
                  </ul>
                  <p><a id="d21847e170" class="indexterm-anchor"></a><a id="d21847e174" class="indexterm-anchor"></a><a id="d21847e178" class="indexterm-anchor"></a>When you create a <code class="codeph">DataProvider</code> and <code class="codeph">UserSession</code>, the session does not at first have a <code class="codeph">Transaction</code>. The first <code class="codeph">Transaction</code> in a session is a root <code class="codeph">Transaction</code>. You can explicitly create a root <code class="codeph">Transaction</code> by calling the <code class="codeph">createRootTransaction</code> method of the <code class="codeph">TransactionProvider</code>. If you do not explicitly created one, then Oracle OLAP automatically creates a root <code class="codeph">Transaction</code> the first time that you create or modify an <code class="codeph">MdmObject</code> or a derived <code class="codeph">Source</code>. To make permanent the changes to an <code class="codeph">MdmObject</code>, you must commit the root <code class="codeph">Transaction</code> in which you made the changes.
                  </p>
                  <p>A single-user application does not need to explicitly create a root <code class="codeph">Transaction</code>. The ability to create multiple root <code class="codeph">Transaction</code> objects is provided for use by multithreaded, middle-tier applications. If your application uses multiple root <code class="codeph">Transaction</code> objects, the changes that the application makes in one root <code class="codeph">Transaction</code> can be overwritten by changes the application makes in another root <code class="codeph">Transaction</code>. The changes that occur in the last root <code class="codeph">Transaction</code> that the application commits are the changes that persist.
                  </p>
                  <p><a id="d21847e244" class="indexterm-anchor"></a><a id="d21847e248" class="indexterm-anchor"></a>When you or Oracle OLAP creates the initial root <code class="codeph">Transaction</code>, it is the <span class="italic">current</span> <code class="codeph">Transaction</code>. If you create another root <code class="codeph">Transaction</code>, it becomes the current <code class="codeph">Transaction</code>.
                  </p>
                  <p>Oracle OLAP creates other <code class="codeph">Transaction</code> objects as you create <code class="codeph">Source</code> objects or child <code class="codeph">Transaction</code> objects under a root <code class="codeph">Transaction</code>. You must commit the root <code class="codeph">Transaction</code> for the Oracle Database to add to persistent storage any metadata objects that you have created in any <code class="codeph">Transaction</code> in the session.
                  </p>
                  <p>When you create a derived <code class="codeph">Source</code> by calling a method of another <code class="codeph">Source</code>, the derived <code class="codeph">Source</code> is created in the context of the current <code class="codeph">Transaction</code>. The <code class="codeph">Source</code> is <span class="italic">active</span> in the <code class="codeph">Transaction</code> in which you create it or in a child <code class="codeph">Transaction</code> of that <code class="codeph">Transaction</code>.
                  </p>
                  <p>You get or set the current <code class="codeph">Transaction</code>, or begin a child <code class="codeph">Transaction</code>, by calling methods of a <code class="codeph">TransactionProvider</code>. In a child <code class="codeph">Transaction</code> you can alter a query, for example by changing the selection of dimension elements or by performing a different mathematical or analytical operation on the data, which changes the state of a <code class="codeph">Template</code> that you created in the parent <code class="codeph">Transaction</code>. By displaying the data specified by the <code class="codeph">Source</code> produced by the <code class="codeph">Template</code> in the parent <code class="codeph">Transaction</code> and also displaying the data specified by the <code class="codeph">Source</code> produced by the <code class="codeph">Template</code> in the child <code class="codeph">Transaction</code>, you can provide the end user of your application with the means of easily altering a query and viewing the results of different operations on the same set of data, or the same operations on different sets of data.
                  </p>
               </div><a id="OLAAP328"></a><div class="props_rev_3"><a id="GUID-FF204E1F-854F-49C5-A70D-96B713F158D6" name="GUID-FF204E1F-854F-49C5-A70D-96B713F158D6"></a><h4 id="OLAAP-GUID-FF204E1F-854F-49C5-A70D-96B713F158D6" class="sect4"><span class="enumeration_section">7.1.1 </span>Types of Transaction Objects
                  </h4>
                  <div>
                     <p><a id="d21847e393" class="indexterm-anchor"></a><a id="d21847e397" class="indexterm-anchor"></a><a id="d21847e401" class="indexterm-anchor"></a><a id="d21847e403" class="indexterm-anchor"></a>The OLAP Java API has the following two types of <code class="codeph">Transaction</code> objects: 
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>A <span>read</span> <code class="codeph">Transaction</code>. Initially, the current <code class="codeph">Transaction</code> is a read <code class="codeph">Transaction</code>. A read <code class="codeph">Transaction</code> is required for creating a <code class="codeph">Cursor</code> to fetch data from Oracle OLAP. For more information on <code class="codeph">Cursor</code> objects, see <a href="retrieving-query-results.html#GUID-41769CCE-61BC-4A3C-8086-A4F6342458DA"> Retrieving Query Results</a>.
                           </p>
                        </li>
                        <li>
                           <p>A <span>write</span> <code class="codeph">Transaction</code>. A write <code class="codeph">Transaction</code> is required for creating a derived <code class="codeph">Source</code> or for changing the state of a <code class="codeph">Template</code>. For more information on creating a derived <code class="codeph">Source</code>, see <a href="understanding-source-objects.html#GUID-871159BB-8ED1-454B-B9FA-62F36683F4B2"> Understanding Source Objects</a>. For information on <code class="codeph">Template</code> objects, see <a href="creating-dynamic-queries.html#GUID-16DC09F2-FA92-4987-A125-2EE813B7413E"> Creating Dynamic Queries</a>.
                           </p>
                        </li>
                     </ul>
                     <p><a id="d21847e473" class="indexterm-anchor"></a>In the initial read <code class="codeph">Transaction</code>, if you create a derived <code class="codeph">Source</code> or if you change the state of a <code class="codeph">Template</code> object, then a child write <code class="codeph">Transaction</code> is automatically generated. That child <code class="codeph">Transaction</code> becomes the current <code class="codeph">Transaction</code>.
                     </p>
                     <p>If you then create another derived <code class="codeph">Source</code> or change the <code class="codeph">Template</code> state again, then that operation occurs in the same write <code class="codeph">Transaction</code>. You can create any number of derived <code class="codeph">Source</code> objects, or make any number of <code class="codeph">Template</code> state changes, in that same write <code class="codeph">Transaction</code>. You can use those <code class="codeph">Source</code> objects, or the <code class="codeph">Source</code> produced by the <code class="codeph">Template</code>, to define a complex query.
                     </p>
                     <p>Before you can create a <code class="codeph">Cursor</code> to fetch the result set specified by a derived <code class="codeph">Source</code>, you must move the <code class="codeph">Source</code> from the child write <code class="codeph">Transaction</code> into the parent read <code class="codeph">Transaction</code>. To do so, you commit the <code class="codeph">Transaction</code>.
                     </p>
                  </div>
               </div><a id="OLAAP330"></a><a id="OLAAP329"></a><div class="props_rev_3"><a id="GUID-E68EC9E9-F19A-42BA-9745-EE85184E92EB" name="GUID-E68EC9E9-F19A-42BA-9745-EE85184E92EB"></a><h4 id="OLAAP-GUID-E68EC9E9-F19A-42BA-9745-EE85184E92EB" class="sect4"><span class="enumeration_section">7.1.2 </span>Committing a Transaction
                  </h4>
                  <div>
                     <div class="section">
                        <p><a id="d21847e586" class="indexterm-anchor"></a><a id="d21847e590" class="indexterm-anchor"></a>To move a <code class="codeph">Source</code> that you created in a child <code class="codeph">Transaction</code> into the parent read <code class="codeph">Transaction</code>, call the <code class="codeph">commitCurrentTransaction</code> method of the <code class="codeph">TransactionProvider</code>. When you commit a child write <code class="codeph">Transaction</code>, a <code class="codeph">Source</code> you created in the child <code class="codeph">Transaction</code> moves into the parent read <code class="codeph">Transaction</code>. The child <code class="codeph">Transaction</code> disappears and the parent <code class="codeph">Transaction</code> becomes the current <code class="codeph">Transaction</code>. The <code class="codeph">Source</code> is active in the current read <code class="codeph">Transaction</code> and you can therefore create a <code class="codeph">Cursor</code> for it.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-E68EC9E9-F19A-42BA-9745-EE85184E92EB__BHAHEDGJ">
                        <p class="titleinexample">Example 7-1 Committing the Current Transaction</p>
                        <p>In this example, <code class="codeph">commit()</code> is a method that commits the current <code class="codeph">Transaction</code>. In the example, <code class="codeph">dp</code> is the <code class="codeph">DataProvider</code>.
                        </p><pre class="oac_no_warn" dir="ltr">private void commit()
{
  try 
  {
    (dp.getTransactionProvider()).commitCurrentTransaction();
  } 
  catch (Exception ex) 
  {
    System.out.println("Could not commit the Transaction. " + ex);
  } 
}</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="OLAAP331"></a><div class="props_rev_3"><a id="GUID-B6DF35A3-2A60-45F1-9254-F94A77946645" name="GUID-B6DF35A3-2A60-45F1-9254-F94A77946645"></a><h4 id="OLAAP-GUID-B6DF35A3-2A60-45F1-9254-F94A77946645" class="sect4"><span class="enumeration_section">7.1.3 </span>About Transaction and Template Objects
                  </h4>
                  <div>
                     <p><a id="d21847e697" class="indexterm-anchor"></a><a id="d21847e701" class="indexterm-anchor"></a>Getting and setting the current <code class="codeph">Transaction</code>, beginning a child <code class="codeph">Transaction</code>, and rolling back a <code class="codeph">Transaction</code> are operations that you use to allow an end user to make different selections starting from a given state of a dynamic query.
                     </p>
                     <p>To present the end user with alternatives based on the same initial query, you do the following:</p>
                     <ol>
                        <li>
                           <p>Create a <code class="codeph">Template</code> in a parent <code class="codeph">Transaction</code> and set the initial state for the <code class="codeph">Template</code>.
                           </p>
                        </li>
                        <li>
                           <p>Get the <code class="codeph">Source</code> produced by the <code class="codeph">Template</code>, create a <code class="codeph">Cursor</code> to retrieve the result set, get the values from the <code class="codeph">Cursor</code>, and then display the results to the end user.
                           </p>
                        </li>
                        <li>
                           <p>Begin a child <code class="codeph">Transaction</code> and modify the state of the <code class="codeph">Template</code>.
                           </p>
                        </li>
                        <li>
                           <p>Get the <code class="codeph">Source</code> produced by the <code class="codeph">Template</code> in the child <code class="codeph">Transaction</code>, create a <code class="codeph">Cursor</code>, get the values, and display them.
                           </p>
                        </li>
                     </ol>
                     <p>You can then replace the first <code class="codeph">Template</code> state with the second one or discard the second one and retain the first.
                     </p>
                  </div>
               </div><a id="OLAAP332"></a><div class="props_rev_3"><a id="GUID-086F7B02-F27D-4841-99CE-2314CAF8B1CF" name="GUID-086F7B02-F27D-4841-99CE-2314CAF8B1CF"></a><h4 id="OLAAP-GUID-086F7B02-F27D-4841-99CE-2314CAF8B1CF" class="sect4"><span class="enumeration_section">7.1.4 </span>Beginning a Child Transaction
                  </h4>
                  <div>
                     <div class="section">
                        <p>To begin a child read <code class="codeph">Transaction</code>, call the <code class="codeph">beginSubtransaction</code> method of the <code class="codeph">TransactionProvider</code> you are using. In the child read <code class="codeph">Transaction</code>, if you change the state of a <code class="codeph">Template</code>, then a child write <code class="codeph">Transaction</code> begins automatically. The write <code class="codeph">Transaction</code> is a child of the child read <code class="codeph">Transaction</code>.
                        </p>
                        <p>To get the data specified by the <code class="codeph">Source</code> produced by the <code class="codeph">Template</code>, you commit the write <code class="codeph">Transaction</code> into the parent read <code class="codeph">Transaction</code>. You can then create a <code class="codeph">Cursor</code> to fetch the data. The changed state of the <code class="codeph">Template</code> is not visible in the original parent. The changed state does not become visible in the parent until you commit the child read <code class="codeph">Transaction</code> into the parent read <code class="codeph">Transaction</code>.
                        </p>
                        <p>After beginning a child read <code class="codeph">Transaction</code>, you can begin a child read <code class="codeph">Transaction</code> of that child, or a grandchild of the initial parent <code class="codeph">Transaction</code>. For an example of creating child and grandchild <code class="codeph">Transaction</code> objects, see <a href="using-transaction-provider.html#GUID-BDE99A6B-1D4D-473E-A719-6590C6A4D7B1__I1006243">Example 7-3</a>.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="OLAAP334"></a><a id="OLAAP333"></a><div class="props_rev_3"><a id="GUID-EB051C3D-1F41-4E03-80C9-F26CF40E23DD" name="GUID-EB051C3D-1F41-4E03-80C9-F26CF40E23DD"></a><h4 id="OLAAP-GUID-EB051C3D-1F41-4E03-80C9-F26CF40E23DD" class="sect4"><span class="enumeration_section">7.1.5 </span>About Rolling Back a Transaction
                  </h4>
                  <div>
                     <div class="section">
                        <p><a id="d21847e917" class="indexterm-anchor"></a>You roll back, or undo, a <code class="codeph">Transaction</code> by calling the <code class="codeph">rollbackCurrentTransaction</code> method of the <code class="codeph">TransactionProvider</code> you are using. Rolling back a <code class="codeph">Transaction</code> discards any changes that you made during that <code class="codeph">Transaction</code> and makes the <code class="codeph">Transaction</code> disappear.
                        </p>
                        <p>Before rolling back a <code class="codeph">Transaction</code>, you must close any <code class="codeph">CursorManager</code> objects you created in that <code class="codeph">Transaction</code>. After rolling back a <code class="codeph">Transaction</code>, any <code class="codeph">Source</code> objects that you created or <code class="codeph">Template</code> state changes that you made in the <code class="codeph">Transaction</code> are no longer valid. Any <code class="codeph">Cursor</code> objects you created for those <code class="codeph">Source</code> objects are also invalid. 
                        </p>
                        <p>Once you roll back a <code class="codeph">Transaction</code>, you cannot commit that <code class="codeph">Transaction</code>. Likewise, once you commit a <code class="codeph">Transaction</code>, you cannot roll it back.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-EB051C3D-1F41-4E03-80C9-F26CF40E23DD__BABBEJFB">
                        <p class="titleinexample">Example 7-2 Rolling Back a Transaction</p>
                        <p><a id="d21847e986" class="indexterm-anchor"></a><a id="d21847e988" class="indexterm-anchor"></a>This example uses the <code class="codeph">TopBottomTemplate</code> and <code class="codeph">SingleSelectionTemplate</code> classes that are described in <a href="creating-dynamic-queries.html#GUID-16DC09F2-FA92-4987-A125-2EE813B7413E"> Creating Dynamic Queries</a>. In creating the <code class="codeph">TopBottomTemplate</code> and <code class="codeph">SingleSelectionTemplate</code> objects, the example uses the same code that appears in <a href="creating-dynamic-queries.html#GUID-C22245FA-E655-468E-8053-BAB7044C3F9B__I1006270">Example 10-4</a>. This example does not show that code. It sets the state of the <code class="codeph">TopBottomTemplate</code>. It begins a child <code class="codeph">Transaction</code> that sets a different state for the <code class="codeph">TopBottomTemplate</code> and then rolls back the child <code class="codeph">Transaction</code>. The <code class="codeph">println</code> method displays text through a <code class="codeph">CursorPrintWriter</code> object and the <code class="codeph">getContext</code> method gets a <code class="codeph">Context11g</code> object that has methods that create <code class="codeph">Cursor</code> objects and display their values through the <code class="codeph">CursorPrintWriter</code>. The <code class="codeph">CursorPrintWriter</code> and <code class="codeph">Context11g</code> classes are used by the example programs in this documentation.
                        </p><pre class="oac_no_warn" dir="ltr">// The current Transaction is a read Transaction, t1.
// Create a TopBottomTemplate using a hierarchy of the PRODUCT_AWJ dimension
// as the base and dp as the DataProvider.
TopBottomTemplate topNBottom = new TopBottomTemplate(prodHier, dp);

// Changing the state of a Template requires a write Transaction, so a
// write child Transaction, t2, is automatically started.
topNBottom.setTopBottomType(TopBottomTemplate.TOP_BOTTOM_TYPE_TOP);
topNBottom.setN(10);
topNBottom.setCriterion(singleSelections.getSource());

// Get the TransactionProvider and commit the Transaction t2.
TransactionProvider tp = dp.getTransactionProvider();
try
{
  tp.commitCurrentTransaction();           // t2 disappears
}
catch(Exception e)
{
  println("Cannot commit the Transaction. " + e);
}

// The current Transaction is now t1.
// Get the dynamic Source produced by the TopBottomTemplate.
Source result = topNBottom.getSource();

// Create a Cursor and display the results
println("\nThe current state of the TopBottomTemplate" +
        "\nproduces the following values:\n");
getContext().displayTopBottomResult(result);

// Start a child Transaction, t3. It is a read Transaction.
tp.beginSubtransaction();          // t3 is the current Transaction

// Change the state of topNBottom. Changing the state requires a 
// write Transaction so Transaction t4 starts automatically.
topNBottom.setTopBottomType(TopBottomTemplate.TOP_BOTTOM_TYPE_BOTTOM);
topNBottom.setN(15);

// Commit the Transaction.
try
{
  tp.commitCurrentTransaction();           // t4 disappears
}
catch(Exception e)
{
  println("Cannot commit the Transaction. " + e);
}

// Create a Cursor and display the results. // t3 is the current Transaction
println("\nIn the child Transaction, the state of the" +
        "\nTopBottomTemplate produces the following values:\n");
getContext().displayTopBottomResult(result);
// The displayTopBottomResult method closes the CursorManager for the
// Cursor created in t3.

// Undo t3, which discards the state of topNBottom that was set in t4.
tp.rollbackCurrentTransaction();        // t3 disappears

// Transaction t1 is now the current Transaction and the state of
// topNBottom is the one defined in t2.

// To show the current state of the TopNBottom template Source, commit
// the Transaction, create a Cursor, and display the Cursor values.
try
{
  tp.commitCurrentTransaction();
}
catch(Exception e)
{
  println("Cannot commit the Transaction. " + e);
}

println("\nAfter rolling back the child Transaction, the state of"
        + "\nthe TopBottomTemplate produces the following values:\n");
getContext().displayTopBottomResult(result);
</pre><p>The example produces the following output.</p><pre class="oac_no_warn" dir="ltr">The current state of the TopBottomTemplate
produces the following values:
 
 1. PRODUCT_PRIMARY::TOTAL_PRODUCT::TOTAL
 2. PRODUCT_PRIMARY::CLASS::SFT
 3. PRODUCT_PRIMARY::FAMILY::ACC
 4. PRODUCT_PRIMARY::CLASS::HRD
 5. PRODUCT_PRIMARY::FAMILY::MOD
 6. PRODUCT_PRIMARY::FAMILY::OS
 7. PRODUCT_PRIMARY::FAMILY::DISK
 8. PRODUCT_PRIMARY::ITEM::MOUSE PAD
 9. PRODUCT_PRIMARY::ITEM::OS 1 USER
10. PRODUCT_PRIMARY::ITEM::DLX MOUSE
 
In the child Transaction, the state of the
TopBottomTemplate produces the following values:
 
 1. PRODUCT_PRIMARY::ITEM::EXT CD ROM
 2. PRODUCT_PRIMARY::ITEM::OS DOC ITA
 3. PRODUCT_PRIMARY::ITEM::OS DOC SPA
 4. PRODUCT_PRIMARY::ITEM::INT CD USB
 5. PRODUCT_PRIMARY::ITEM::ENVY EXT KBD
 6. PRODUCT_PRIMARY::ITEM::19 SVGA
 7. PRODUCT_PRIMARY::ITEM::OS DOC FRE
 8. PRODUCT_PRIMARY::ITEM::OS DOC GER
 9. PRODUCT_PRIMARY::ITEM::ENVY ABM
10. PRODUCT_PRIMARY::ITEM::INT CD ROM
11. PRODUCT_PRIMARY::ITEM::ENVY EXE
12. PRODUCT_PRIMARY::ITEM::OS DOC KAN
13. PRODUCT_PRIMARY::ITEM::ENVY STD
14. PRODUCT_PRIMARY::ITEM::1GB USB DRV
15. PRODUCT_PRIMARY::ITEM::SENT MM
 
After rolling back the child Transaction, the state of
the TopBottomTemplate produces the following values:
 
 1. PRODUCT_PRIMARY::TOTAL_PRODUCT::TOTAL
 2. PRODUCT_PRIMARY::CLASS::SFT
 3. PRODUCT_PRIMARY::FAMILY::ACC
 4. PRODUCT_PRIMARY::CLASS::HRD
 5. PRODUCT_PRIMARY::FAMILY::MOD
 6. PRODUCT_PRIMARY::FAMILY::OS
 7. PRODUCT_PRIMARY::FAMILY::DISK
 8. PRODUCT_PRIMARY::ITEM::MOUSE PAD
 9. PRODUCT_PRIMARY::ITEM::OS 1 USER
10. PRODUCT_PRIMARY::ITEM::DLX MOUSE</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="OLAAP335"></a><div class="props_rev_3"><a id="GUID-E962EAE0-BA2F-489B-B831-385DF6199B9C" name="GUID-E962EAE0-BA2F-489B-B831-385DF6199B9C"></a><h4 id="OLAAP-GUID-E962EAE0-BA2F-489B-B831-385DF6199B9C" class="sect4"><span class="enumeration_section">7.1.6 </span>Getting and Setting the Current Transaction
                  </h4>
                  <div>
                     <div class="section">
                        <p><a id="d21847e1091" class="indexterm-anchor"></a><a id="d21847e1095" class="indexterm-anchor"></a><a id="d21847e1099" class="indexterm-anchor"></a>You get the current <code class="codeph">Transaction</code> by calling the <code class="codeph">getCurrentTransaction</code> method of the <code class="codeph">TransactionProvider</code> you are using, as in the following example.
                        </p><pre class="oac_no_warn" dir="ltr">Transaction t1 = tp.getCurrentTransaction();
</pre><p>To make a previously saved <code class="codeph">Transaction</code> the current <code class="codeph">Transaction</code>, you call the <code class="codeph">setCurrentTransaction</code> method of the <code class="codeph">TransactionProvider</code>, as in the following example.
                        </p><pre class="oac_no_warn" dir="ltr">tp.setCurrentTransaction(t1);</pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="OLAAP337"></a><a id="OLAAP336"></a><div class="props_rev_3"><a id="GUID-BDE99A6B-1D4D-473E-A719-6590C6A4D7B1" name="GUID-BDE99A6B-1D4D-473E-A719-6590C6A4D7B1"></a><h3 id="OLAAP-GUID-BDE99A6B-1D4D-473E-A719-6590C6A4D7B1" class="sect3"><span class="enumeration_section">7.2 </span>Using TransactionProvider Objects
               </h3>
               <div>
                  <div class="section">
                     <p><a id="d21847e1167" class="indexterm-anchor"></a>In the Oracle OLAP Java API, a <code class="codeph">DataProvider</code> provides an implementation of the <code class="codeph">TransactionProvider</code> interface. The <code class="codeph">TransactionProvider</code> provides <code class="codeph">Transaction</code> objects to your application.
                     </p>
                     <p>As described in <span class="q">"<a href="using-transaction-provider.html#GUID-E68EC9E9-F19A-42BA-9745-EE85184E92EB">Committing a Transaction</a>"</span>, you use the <code class="codeph">commitCurrentTransaction</code> method to make a derived <code class="codeph">Source</code> that you created in a child write <code class="codeph">Transaction</code> visible in the parent read <code class="codeph">Transaction</code>. You can then create a <code class="codeph">Cursor</code> for that <code class="codeph">Source</code>.
                     </p>
                     <p>If you are using <code class="codeph">Template</code> objects in your application, then you might also use the other methods of <code class="codeph">TransactionProvider</code> to do the following:
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Begin a child <code class="codeph">Transaction</code>.
                           </p>
                        </li>
                        <li>
                           <p>Get the current <code class="codeph">Transaction</code> so you can save it.
                           </p>
                        </li>
                        <li>
                           <p>Set the current <code class="codeph">Transaction</code> to a previously saved one.
                           </p>
                        </li>
                        <li>
                           <p>Rollback, or undo, the current <code class="codeph">Transaction</code>, which discards any changes made in the <code class="codeph">Transaction</code>. Once a <code class="codeph">Transaction</code> has been rolled back, it is invalid and cannot be committed. Once a <code class="codeph">Transaction</code> has been committed, it cannot be rolled back. If you created a <code class="codeph">Cursor</code> for a <code class="codeph">Source</code> in a <code class="codeph">Transaction</code>, then you must close the <code class="codeph">CursorManager</code> before rolling back the <code class="codeph">Transaction</code>.<a id="d21847e1269" class="indexterm-anchor"></a></p>
                        </li>
                     </ul>
                     <p><a id="d21847e1274" class="indexterm-anchor"></a><a id="d21847e1278" class="indexterm-anchor"></a><a id="d21847e1280" class="indexterm-anchor"></a><a href="using-transaction-provider.html#GUID-BDE99A6B-1D4D-473E-A719-6590C6A4D7B1__I1006243">Example 7-3</a> demonstrates the use of <code class="codeph">Transaction</code> objects to modify dynamic queries. Like <a href="using-transaction-provider.html#GUID-EB051C3D-1F41-4E03-80C9-F26CF40E23DD__BABBEJFB">Example 7-2</a>, this example uses the same code to create <code class="codeph">TopBottomTemplate</code> and <code class="codeph">SingleSelectionTemplate</code> objects as does <a href="creating-dynamic-queries.html#GUID-C22245FA-E655-468E-8053-BAB7044C3F9B__I1006270">Example 10-4</a>. This example does not show that code.
                     </p>
                     <p>To help track the <code class="codeph">Transaction</code> objects, this example saves the different <code class="codeph">Transaction</code> objects with calls to the <code class="codeph">getCurrentTransaction</code> method. In the example, the <code class="codeph">tp</code> object is the <code class="codeph">TransactionProvider</code>. The <code class="codeph">println</code> method displays text through a <code class="codeph">CursorPrintWriter</code> and the <code class="codeph">getContext</code> method gets a <code class="codeph">Context11g</code> object that has methods that create <code class="codeph">Cursor</code> objects and display their values through the <code class="codeph">CursorPrintWriter</code>. The <code class="codeph">commit</code> method is the method from <a href="using-transaction-provider.html#GUID-E68EC9E9-F19A-42BA-9745-EE85184E92EB__BHAHEDGJ">Example 7-1</a>.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-BDE99A6B-1D4D-473E-A719-6590C6A4D7B1__I1006243">
                     <p class="titleinexample">Example 7-3 Using Child Transaction Objects</p><pre class="oac_no_warn" dir="ltr">// The parent Transaction is the current Transaction at this point.
// Save the parent read Transaction as parentT1.
Transaction parentT1 = tp.getCurrentTransaction();

// Get the dynamic Source produced by the TopBottomTemplate.
Source result = topNBottom.getSource();

// Create a Cursor and display the results.
println("\nThe current state of the TopBottomTemplate" +
        "\nproduces the following values:\n");
getContext().displayTopBottomResult(result);

// Begin a child Transaction of parentT1.
tp.beginSubtransaction();  // This is a read Transaction.

// Save the child read Transaction as childT2.
Transaction childT2 = tp.getCurrentTransaction();

// Change the state of the TopBottomTemplate. This starts a
// write Transaction, a child of the read Transaction childT2.
topNBottom.setN(12);
topNBottom.setTopBottomType(TopBottomTemplate.TOP_BOTTOM_TYPE_BOTTOM);

// Save the child write Transaction as writeT3.
Transaction writeT3 = tp.getCurrentTransaction();

// Commit the write Transaction writeT3.
commit();

// The commit moves the changes made in writeT3 into its parent,
// the read Transaction childT2. The writeT3 Transaction
// disappears. The current Transaction is now childT2
// again but the state of the TopBottomTemplate has changed.

// Create a Cursor and display the results of the changes to the
// TopBottomTemplate that are visible in childT2.
try
{
  println("\nIn the child Transaction, the state of the" +
          "\nTopBottomTemplate produces the following values:\n");

  getContext().displayTopBottomResult(result);
}
catch(Exception e)
{
  println("Cannot display the results of the query. " + e);
}

// Begin a grandchild Transaction of the initial parent.
tp.beginSubtransaction();  // This is a read Transaction.

// Save the grandchild read Transaction as grandchildT4.
Transaction grandchildT4 = tp.getCurrentTransaction();

// Change the state of the TopBottomTemplate. This starts another
// write Transaction, a child of grandchildT4.
topNBottom.setTopBottomType(TopBottomTemplate.TOP_BOTTOM_TYPE_TOP);

// Save the write Transaction as writeT5.
Transaction writeT5 = tp.getCurrentTransaction();

// Commit writeT5.
commit();

// Transaction grandchildT4 is now the current Transaction and the
// changes made to the TopBottomTemplate state are visible.

// Create a Cursor and display the results visible in grandchildT4.
try
{
&nbsp;&nbsp;println("\nIn the grandchild Transaction, the state of the" +
          "\nTopBottomTemplate produces the following values:\n");
  getContext().displayTopBottomResult(result);
}
catch(Exception e)
{
&nbsp;&nbsp;println(""Cannot display the results of the query. " + e);
}

// Commit the grandchild into the child.
commit();

// Transaction childT2 is now the current Transaction.
// Instead of preparing and committing the grandchild Transaction,
// you could rollback the Transaction, as in the following
// method call:
//   rollbackCurrentTransaction();
// If you roll back the grandchild Transaction, then the changes
// you made to the TopBottomTemplate state in the grandchild 
// are discarded and childT2 is the current Transaction.

// Commit the child into the parent.
commit();

// Transaction parentT1 is now the current Transaction. Again,
// you can roll back the childT2 Transaction instead of committing it.
// If you do so, then the changes that you made in childT2 are discarded.
// The current Transaction is be parentT1, which has the original state
// of the TopBottomTemplate, without any of the changes made in the
// grandchild or the child transactions.</pre><p></p>
                     <p><a href="using-transaction-provider.html#GUID-BDE99A6B-1D4D-473E-A719-6590C6A4D7B1__I1006243">Example 7-3</a> produces the following output.
                     </p><pre class="oac_no_warn" dir="ltr">The current state of the TopBottomTemplate
produces the following values:
 
 1. PRODUCT_PRIMARY::TOTAL_PRODUCT::TOTAL
 2. PRODUCT_PRIMARY::CLASS::SFT
 3. PRODUCT_PRIMARY::FAMILY::ACC
 4. PRODUCT_PRIMARY::CLASS::HRD
 5. PRODUCT_PRIMARY::FAMILY::MOD
 6. PRODUCT_PRIMARY::FAMILY::OS
 7. PRODUCT_PRIMARY::FAMILY::DISK
 8. PRODUCT_PRIMARY::ITEM::MOUSE PAD
 9. PRODUCT_PRIMARY::ITEM::OS 1 USER
10. PRODUCT_PRIMARY::ITEM::DLX MOUSE
 
In the child Transaction, the state of the
TopBottomTemplate produces the following values:
 
 1. PRODUCT_PRIMARY::ITEM::EXT CD ROM
 2. PRODUCT_PRIMARY::ITEM::OS DOC ITA
 3. PRODUCT_PRIMARY::ITEM::OS DOC SPA
 4. PRODUCT_PRIMARY::ITEM::INT CD USB
 5. PRODUCT_PRIMARY::ITEM::ENVY EXT KBD
 6. PRODUCT_PRIMARY::ITEM::19 SVGA
 7. PRODUCT_PRIMARY::ITEM::OS DOC FRE
 8. PRODUCT_PRIMARY::ITEM::OS DOC GER
 9. PRODUCT_PRIMARY::ITEM::ENVY ABM
10. PRODUCT_PRIMARY::ITEM::INT CD ROM
11. PRODUCT_PRIMARY::ITEM::ENVY EXE
12. PRODUCT_PRIMARY::ITEM::OS DOC KAN
 
In the grandchild Transaction, the state of the
TopBottomTemplate produces the following values:
 
 1. PRODUCT_PRIMARY::TOTAL_PRODUCT::TOTAL
 2. PRODUCT_PRIMARY::CLASS::SFT
 3. PRODUCT_PRIMARY::FAMILY::ACC
 4. PRODUCT_PRIMARY::CLASS::HRD
 5. PRODUCT_PRIMARY::FAMILY::MOD
 6. PRODUCT_PRIMARY::FAMILY::OS
 7. PRODUCT_PRIMARY::FAMILY::DISK
 8. PRODUCT_PRIMARY::ITEM::MOUSE PAD
 9. PRODUCT_PRIMARY::ITEM::OS 1 USER
10. PRODUCT_PRIMARY::ITEM::DLX MOUSE
11. PRODUCT_PRIMARY::ITEM::LT CASE
12. PRODUCT_PRIMARY::ITEM::56KPS MODEM</pre></div>
                  <!-- class="example" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>