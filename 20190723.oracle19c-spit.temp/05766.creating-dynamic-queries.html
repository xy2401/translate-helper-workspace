<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Creating Dynamic Queries</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Java API Developer's Guide ">
      <meta property="og:description" content>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Java API Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="olap-java-api-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-10T13:53:39-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2000, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96402-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="retrieving-query-results.html" title="Previous" type="text/html">
      <link rel="next" href="setting-up-development-environment.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="OLAP Java API Developer's Guide">
    <meta name="dcterms.isVersionOf" content="OLAAP">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="retrieving-query-results.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="setting-up-development-environment.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Java API Developer's Guide </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Creating Dynamic Queries</li>
            </ol>
            <a id="GUID-16DC09F2-FA92-4987-A125-2EE813B7413E" name="GUID-16DC09F2-FA92-4987-A125-2EE813B7413E"></a><a id="OLAAP382"></a>
            
            <h2 id="OLAAP-GUID-16DC09F2-FA92-4987-A125-2EE813B7413E" class="sect2"><span class="enumeration_chapter">10 </span> Creating Dynamic Queries
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>To  create dynamic queries, you use the Oracle OLAP Java API <code class="codeph">Template</code> class and other related classes. The following topics describe these classes and provide examples of implementations of them.
               </p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="creating-dynamic-queries.html#GUID-1E84C8D1-E38F-4C46-AD72-D6F01FEB504D">About Template Objects</a></p>
                  </li>
                  <li>
                     <p><a href="creating-dynamic-queries.html#GUID-7446C31F-22A8-4476-9C70-574047267AB3">Overview of Template and Related Classes</a></p>
                  </li>
                  <li>
                     <p><a href="creating-dynamic-queries.html#GUID-BC9CA1ED-CA43-42C3-BB63-D70DF3F4CB43">Designing and Implementing a Template</a></p>
                  </li>
               </ul>
            </div><a id="OLAAP383"></a><div class="props_rev_3"><a id="GUID-1E84C8D1-E38F-4C46-AD72-D6F01FEB504D" name="GUID-1E84C8D1-E38F-4C46-AD72-D6F01FEB504D"></a><h3 id="OLAAP-GUID-1E84C8D1-E38F-4C46-AD72-D6F01FEB504D" class="sect3"><span class="enumeration_section">10.1 </span>About Template Objects
               </h3>
               <div>
                  <p><a id="d28686e88" class="indexterm-anchor"></a><a id="d28686e92" class="indexterm-anchor"></a><a id="d28686e94" class="indexterm-anchor"></a><a id="d28686e98" class="indexterm-anchor"></a>The <code class="codeph">Template</code> class is the basis of a very powerful feature of the Oracle OLAP Java API. You use <code class="codeph">Template</code> objects to create modifiable <code class="codeph">Source</code> objects. With those <code class="codeph">Source</code> objects, you can create dynamic queries that can change in response to end-user selections. <code class="codeph">Template</code> objects also offer a convenient way for you to translate user-interface elements into OLAP Java API operations and objects.
                  </p>
                  <p>For information on the <code class="codeph">Transaction</code> objects that you use to make changes to the dynamic <code class="codeph">Source</code> and to either save or discard those changes, see <a href="using-transaction-provider.html#GUID-E290E8B5-CC10-4BDF-91B1-7189BE7F12B9"> Using a TransactionProvider</a>.
                  </p>
               </div><a id="OLAAP384"></a><div class="props_rev_3"><a id="GUID-4E2695FD-52C1-4610-9B3A-3968C725821F" name="GUID-4E2695FD-52C1-4610-9B3A-3968C725821F"></a><h4 id="OLAAP-GUID-4E2695FD-52C1-4610-9B3A-3968C725821F" class="sect4"><span class="enumeration_section">10.1.1 </span>About Creating a Dynamic Source
                  </h4>
                  <div>
                     <p><a id="d28686e166" class="indexterm-anchor"></a>The main feature of a <code class="codeph">Template</code> is the ability to produce a dynamic <code class="codeph">Source</code>. That ability is based on two of the other objects that a <code class="codeph">Template</code> uses: instances of the <code class="codeph">DynamicDefinition</code> and <code class="codeph">MetadataState</code> classes.
                     </p>
                     <p><a id="d28686e187" class="indexterm-anchor"></a>When a <code class="codeph">Source</code> is created, Oracle OLAP automatically associates a <code class="codeph">SourceDefinition</code> with it. The <code class="codeph">SourceDefinition</code> has information about the <code class="codeph">Source</code>. Once created, the <code class="codeph">Source</code> and the associated <code class="codeph">SourceDefinition</code> are associated immutably. The <code class="codeph">getSource</code> method of a <code class="codeph">SourceDefinition</code> returns the <code class="codeph">Source</code> associated with it.
                     </p>
                     <p><a id="d28686e219" class="indexterm-anchor"></a><code class="codeph">DynamicDefinition</code> is a subclass of <code class="codeph">SourceDefinition</code>. A <code class="codeph">Template</code> creates a <code class="codeph">DynamicDefinition</code>, which acts as a proxy for the <code class="codeph">SourceDefinition</code> of the <code class="codeph">Source</code> produced by the <code class="codeph">Template</code>. This means that instead of always getting the same immutably associated <code class="codeph">Source</code>, the <code class="codeph">getSource</code> method of the <code class="codeph">DynamicDefinition</code> gets whatever <code class="codeph">Source</code> is currently produced by the <code class="codeph">Template</code>. The instance of the <code class="codeph">DynamicDefinition</code> does not change even though the <code class="codeph">Source</code> that it gets is different.
                     </p>
                     <p>The <code class="codeph">Source</code> that a <code class="codeph">Template</code> produces can change because the values, including other <code class="codeph">Source</code> objects, that the <code class="codeph">Template</code> uses to create the <code class="codeph">Source</code> can change. A <code class="codeph">Template</code> stores those values in a <code class="codeph">MetadataState</code>. A <code class="codeph">Template</code> provides methods to get the current state of the <code class="codeph">MetadataState</code>, to get or set a value, and to set the state. You use those methods to change the data values that the <code class="codeph">MetadataState</code> stores.
                     </p>
                     <p>You use a <code class="codeph">DynamicDefinition</code> to get the <code class="codeph">Source</code> produced by a <code class="codeph">Template</code>. If your application changes the state of the values that the <code class="codeph">Template</code> uses to create the <code class="codeph">Source</code>, for example, in response to end-user selections, then the application uses the same <code class="codeph">DynamicDefinition</code> to get the <code class="codeph">Source</code> again, even though the new <code class="codeph">Source</code> defines a result set different than the previous <code class="codeph">Source</code>.
                     </p>
                     <p>The <code class="codeph">Source</code> produced by a <code class="codeph">Template</code> can be the result of a series of <code class="codeph">Source</code> operations that create other <code class="codeph">Source</code> objects, such as a series of selections, sortings, calculations, and joins. You put the code for those operations in the <code class="codeph">generateSource</code> method of a <code class="codeph">SourceGenerator</code> for the <code class="codeph">Template</code>. That method returns the <code class="codeph">Source</code> produced by the <code class="codeph">Template</code>. The operations use the data stored in the <code class="codeph">MetadataState</code>.
                     </p>
                     <p>You might build an extremely complex query that involves the interactions of dynamic <code class="codeph">Source</code> objects produced by many different <code class="codeph">Template</code> objects. The end result of the query building is a <code class="codeph">Source</code> that defines the entire complex query. If you change the state of any one of the <code class="codeph">Template</code> objects that you used to create the final <code class="codeph">Source</code>, then the final <code class="codeph">Source</code> represents a result set that is different from that of the previous <code class="codeph">Source</code>. You can thereby modify the final query without having to reproduce all of the operations involved in defining the query.
                     </p>
                  </div>
               </div><a id="OLAAP385"></a><div class="props_rev_3"><a id="GUID-74B1C85F-4056-4068-9B94-A0B46812454B" name="GUID-74B1C85F-4056-4068-9B94-A0B46812454B"></a><h4 id="OLAAP-GUID-74B1C85F-4056-4068-9B94-A0B46812454B" class="sect4"><span class="enumeration_section">10.1.2 </span>About Translating User Interface Elements into OLAP Java API Objects
                  </h4>
                  <div>
                     <p>You design <code class="codeph">Template</code> objects to represent elements of the user interface of an application. Your <code class="codeph">Template</code> objects turn the selections that the end user makes into OLAP Java API query-building operations that produce a <code class="codeph">Source</code>. You then create a <code class="codeph">Cursor</code> to fetch from Oracle OLAP the result set defined by the <code class="codeph">Source</code>. You get the values from the <code class="codeph">Cursor</code> and display them to the end user. When an end user makes changes to the selections, you change the state of the <code class="codeph">Template</code>. You then get the <code class="codeph">Source</code> produced by the <code class="codeph">Template</code>, create a new <code class="codeph">Cursor</code>, get the new values, and display them.
                     </p>
                  </div>
               </div>
            </div><a id="OLAAP386"></a><div class="props_rev_3"><a id="GUID-7446C31F-22A8-4476-9C70-574047267AB3" name="GUID-7446C31F-22A8-4476-9C70-574047267AB3"></a><h3 id="OLAAP-GUID-7446C31F-22A8-4476-9C70-574047267AB3" class="sect3"><span class="enumeration_section">10.2 </span>Overview of Template and Related Classes
               </h3>
               <div>
                  <p><a id="d28686e489" class="indexterm-anchor"></a>In the OLAP Java API, several classes work together to produce a dynamic <code class="codeph">Source</code>. In designing a <code class="codeph">Template</code>, you must implement or extend the following: 
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>The <code class="codeph">Template</code> abstract class
                        </p>
                     </li>
                     <li>
                        <p>The <code class="codeph">MetadataState</code> interface
                        </p>
                     </li>
                     <li>
                        <p>The <code class="codeph">SourceGenerator</code> interface
                        </p>
                     </li>
                  </ul>
                  <p>Instances of those three classes, plus instances of the <code class="codeph">DataProvider</code> and <code class="codeph">DynamicDefinition</code> classes, work together to produce the <code class="codeph">Source</code> that the <code class="codeph">Template</code> defines.
                  </p>
               </div><a id="OLAAP387"></a><div class="props_rev_3"><a id="GUID-AC10A8D7-425F-4D6E-9337-FC90A4B0616A" name="GUID-AC10A8D7-425F-4D6E-9337-FC90A4B0616A"></a><h4 id="OLAAP-GUID-AC10A8D7-425F-4D6E-9337-FC90A4B0616A" class="sect4"><span class="enumeration_section">10.2.1 </span>What Is the Relationship Between the Classes That Produce a Dynamic Source?
                  </h4>
                  <div>
                     <p><a id="d28686e568" class="indexterm-anchor"></a>The classes that produce a dynamic <code class="codeph">Source</code> work together as follows:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>A <code class="codeph">Template</code> has methods that create a <code class="codeph">DynamicDefinition</code> and that get and set the current state of a <code class="codeph">MetadataState</code>. An extension to the <code class="codeph">Template</code> abstract class adds methods that get and set the values of fields on the <code class="codeph">MetadataState</code>.
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">MetadataState</code> implementation has fields for storing the data to use in generating the <code class="codeph">Source</code> for the <code class="codeph">Template</code>. When you create a new <code class="codeph">Template</code>, you pass the <code class="codeph">MetadataState</code> to the constructor of the <code class="codeph">Template</code>. When you call the <code class="codeph">getSource</code> method of the <code class="codeph">DynamicDefinition</code>, the <code class="codeph">MetadataState</code> is passed to the <code class="codeph">generateSource</code> method of the <code class="codeph">SourceGenerator</code>.
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">DataProvider</code> is used in creating a <code class="codeph">Template</code> and by the <code class="codeph">SourceGenerator</code> in creating new <code class="codeph">Source</code> objects.
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">SourceGenerator</code> implementation has a <code class="codeph">generateSource</code> method that uses the current state of the data in the <code class="codeph">MetadataState</code> to produce a <code class="codeph">Source</code> for the <code class="codeph">Template</code>. You pass in the <code class="codeph">SourceGenerator</code> to the <code class="codeph">createDynamicDefinition</code> method of the <code class="codeph">Template</code> to create a <code class="codeph">DynamicDefinition</code>. 
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">DynamicDefinition</code> has a <code class="codeph">getSource</code> method that gets the <code class="codeph">Source</code> produced by the <code class="codeph">SourceGenerator</code>. The <code class="codeph">DynamicDefinition</code> serves as a proxy for the <code class="codeph">SourceDefinition</code> that is immutably associated with the <code class="codeph">Source</code>.
                           </p>
                        </li>
                     </ul>
                  </div>
               </div><a id="OLAAP388"></a><div class="props_rev_3"><a id="GUID-09B314C5-2AAE-4874-B925-765CC89D8A37" name="GUID-09B314C5-2AAE-4874-B925-765CC89D8A37"></a><h4 id="OLAAP-GUID-09B314C5-2AAE-4874-B925-765CC89D8A37" class="sect4"><span class="enumeration_section">10.2.2 </span>Template Class
                  </h4>
                  <div>
                     <p><a id="d28686e738" class="indexterm-anchor"></a>You use a <code class="codeph">Template</code> to produce a modifiable <code class="codeph">Source</code>. A <code class="codeph">Template</code> has methods for creating a <code class="codeph">DynamicDefinition</code> and for getting and setting the current state of the <code class="codeph">Template</code>. In extending the <code class="codeph">Template</code> class, you add methods that provide access to the fields on the <code class="codeph">MetadataState</code> for the <code class="codeph">Template</code>. The <code class="codeph">Template</code> creates a <code class="codeph">DynamicDefinition</code> that you use to get the <code class="codeph">Source</code> produced by the <code class="codeph">SourceGenerator</code> for the <code class="codeph">Template</code>.
                     </p>
                     <p>For an example of a <code class="codeph">Template</code> implementation, see <a href="creating-dynamic-queries.html#GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E__I1006228">Example 10-1</a>.
                     </p>
                  </div>
               </div><a id="OLAAP389"></a><div class="props_rev_3"><a id="GUID-51205503-7C61-45C9-A482-C31A8B2B14A0" name="GUID-51205503-7C61-45C9-A482-C31A8B2B14A0"></a><h4 id="OLAAP-GUID-51205503-7C61-45C9-A482-C31A8B2B14A0" class="sect4"><span class="enumeration_section">10.2.3 </span>MetadataState Interface
                  </h4>
                  <div>
                     <p><a id="d28686e825" class="indexterm-anchor"></a>An implementation of the <code class="codeph">MetadataState</code> interface stores the current state of the values for a <code class="codeph">Template</code>. A <code class="codeph">MetadataState</code> must include a <code class="codeph">clone</code> method that creates a copy of the current state. 
                     </p>
                     <p>When instantiating a new <code class="codeph">Template</code>, you pass a <code class="codeph">MetadataState</code> to the <code class="codeph">Template</code> constructor. The <code class="codeph">Template</code> has methods for getting and setting the values stored by the <code class="codeph">MetadataState</code>. The <code class="codeph">generateSource</code> method of the <code class="codeph">SourceGenerator</code> for the <code class="codeph">Template</code> uses the <code class="codeph">MetadataState</code> when the method produces a <code class="codeph">Source</code> for the <code class="codeph">Template</code>.
                     </p>
                     <p>For an example of a <code class="codeph">MetadataState</code> implementation, see <a href="creating-dynamic-queries.html#GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E__I1006260">Example 10-2</a>.
                     </p>
                  </div>
               </div><a id="OLAAP390"></a><div class="props_rev_3"><a id="GUID-14CAD029-22D0-4997-BEE1-CF7E8027C1B6" name="GUID-14CAD029-22D0-4997-BEE1-CF7E8027C1B6"></a><h4 id="OLAAP-GUID-14CAD029-22D0-4997-BEE1-CF7E8027C1B6" class="sect4"><span class="enumeration_section">10.2.4 </span>SourceGenerator Interface
                  </h4>
                  <div>
                     <p><a id="d28686e918" class="indexterm-anchor"></a>An implementation of <code class="codeph">SourceGenerator</code> must include a <code class="codeph">generateSource</code> method, which produces a <code class="codeph">Source</code> for a <code class="codeph">Template</code>. A <code class="codeph">SourceGenerator</code> must produce only one type of <code class="codeph">Source</code>, such as a <code class="codeph">BooleanSource</code>, a <code class="codeph">NumberSource</code>, or a <code class="codeph">StringSource</code>. In producing the <code class="codeph">Source</code>, the <code class="codeph">generateSource</code> method uses the current state of the data represented by the <code class="codeph">MetadataState</code> for the <code class="codeph">Template</code>. 
                     </p>
                     <p>To get the <code class="codeph">Source</code> produced by the <code class="codeph">generateSource</code> method, you create a <code class="codeph">DynamicDefinition</code> by passing the <code class="codeph">SourceGenerator</code> to the <code class="codeph">createDynamicDefinition</code> method of the <code class="codeph">Template</code>. You then get the <code class="codeph">Source</code> by calling the <code class="codeph">getSource</code> method of the <code class="codeph">DynamicDefinition</code>.
                     </p>
                     <p>A <code class="codeph">Template</code> can create more than one <code class="codeph">DynamicDefinition</code>, each with a differently implemented <code class="codeph">SourceGenerator</code>. The <code class="codeph">generateSource</code> methods of the different <code class="codeph">SourceGenerator</code> objects use the same data, as defined by the current state of the <code class="codeph">MetadataState</code> for the <code class="codeph">Template</code>, to produce <code class="codeph">Source</code> objects that define different queries.
                     </p>
                     <p>For an example of a <code class="codeph">SourceGenerator</code> implementation, see <a href="creating-dynamic-queries.html#GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E__I1006264">Example 10-3</a>.
                     </p>
                  </div>
               </div><a id="OLAAP391"></a><div class="props_rev_3"><a id="GUID-078501D4-94DB-42A3-A060-DDBAC039CD01" name="GUID-078501D4-94DB-42A3-A060-DDBAC039CD01"></a><h4 id="OLAAP-GUID-078501D4-94DB-42A3-A060-DDBAC039CD01" class="sect4"><span class="enumeration_section">10.2.5 </span>DynamicDefinition Class
                  </h4>
                  <div>
                     <p><a id="d28686e1061" class="indexterm-anchor"></a><code class="codeph">DynamicDefinition</code> is a subclass of <code class="codeph">SourceDefinition</code>. You create a <code class="codeph">DynamicDefinition</code> by calling the <code class="codeph">createDynamicDefinition</code> method of a <code class="codeph">Template</code> and passing it a <code class="codeph">SourceGenerator</code>. You get the <code class="codeph">Source</code> produced by the <code class="codeph">SourceGenerator</code> by calling the <code class="codeph">getSource</code> method of the <code class="codeph">DynamicDefinition</code>.
                     </p>
                     <p>A <code class="codeph">DynamicDefinition</code> created by a <code class="codeph">Template</code> is a proxy for the <code class="codeph">SourceDefinition</code> of the <code class="codeph">Source</code> produced by the <code class="codeph">SourceGenerator</code>. The <code class="codeph">SourceDefinition</code> is immutably associated with the <code class="codeph">Source</code>. If the state of the <code class="codeph">Template</code> changes, then the <code class="codeph">Source</code> produced by the <code class="codeph">SourceGenerator</code> is different. Because the <code class="codeph">DynamicDefinition</code> is a proxy, you use the same <code class="codeph">DynamicDefinition</code> to get the new <code class="codeph">Source</code> even though that <code class="codeph">Source</code> has a different <code class="codeph">SourceDefinition</code>.
                     </p>
                     <p>The <code class="codeph">getCurrent</code> method of a <code class="codeph">DynamicDefinition</code> returns the <code class="codeph">SourceDefinition</code> immutably associated with the <code class="codeph">Source</code> that the <code class="codeph">generateSource</code> method currently returns. For an example of the use of a <code class="codeph">DynamicDefinition</code>, see <a href="creating-dynamic-queries.html#GUID-C22245FA-E655-468E-8053-BAB7044C3F9B__I1006270">Example 10-4</a>.
                     </p>
                  </div>
               </div>
            </div><a id="OLAAP392"></a><div class="props_rev_3"><a id="GUID-BC9CA1ED-CA43-42C3-BB63-D70DF3F4CB43" name="GUID-BC9CA1ED-CA43-42C3-BB63-D70DF3F4CB43"></a><h3 id="OLAAP-GUID-BC9CA1ED-CA43-42C3-BB63-D70DF3F4CB43" class="sect3"><span class="enumeration_section">10.3 </span>Designing and Implementing a Template
               </h3>
               <div>
                  <div class="section">
                     <p><a id="d28686e1203" class="indexterm-anchor"></a>The design of a <code class="codeph">Template</code> reflects the query-building elements of the user interface of an application. For example, suppose you want to develop an application that allows the end user to create a query that requests a number of values from the top or bottom of a list of values. The values are from one dimension of a measure. The other dimensions of the measure are limited to single values.
                     </p>
                     <p>The user interface of your application has a dialog box that allows the end user to do the following: </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Select a radio button that specifies whether the data values should be from the top or bottom of the range of values.</p>
                        </li>
                        <li>
                           <p>Select a measure from a drop-down list of measures.</p>
                        </li>
                        <li>
                           <p>Select a number from a field. The number specifies the number of data values to display.</p>
                        </li>
                        <li>
                           <p>Select one of the dimensions of the measure as the base of the data values to display. For example, if the user selects the product dimension, then the query specifies some number of products from the top or bottom of the list of products. The list is determined by the measure and the selected values of the other dimensions.</p>
                        </li>
                        <li>
                           <p>Click a button to bring up a dialog box through which the end user selects the single values for the other dimensions of the selected measure. After selecting the values of the dimensions, the end user clicks an OK button on the second dialog box and returns to the first dialog box.</p>
                        </li>
                        <li>
                           <p>Click an OK button to generate the query. The results of the query appear.</p>
                        </li>
                     </ul>
                     <p>To generate a <code class="codeph">Source</code> that represents the query that the end user creates in the first dialog box, you design a <code class="codeph">Template</code> called <code class="codeph">TopBottomTemplate</code>. You also design a second <code class="codeph">Template</code>, called <code class="codeph">SingleSelectionTemplate</code>, to create a <code class="codeph">Source</code> that represents the end user's selections of single values for the dimensions other than the base dimension. The designs of your <code class="codeph">Template</code> objects reflect the user interface elements of the dialog boxes.
                     </p>
                     <p>In designing the <code class="codeph">TopBottomTemplate</code> and its <code class="codeph">MetadataState</code> and <code class="codeph">SourceGenerator</code>, you do the following:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Create a class called <code class="codeph">TopBottomTemplate</code> that extends <code class="codeph">Template</code>. To the class, you add methods that get the current state of the <code class="codeph">Template</code>, set the values specified by the user, and then set the current state of the <code class="codeph">Template</code>.
                           </p>
                        </li>
                        <li>
                           <p>Create a class called <code class="codeph">TopBottomTemplateState</code> that implements <code class="codeph">MetadataState</code>. You provide fields on the class to store values for the <code class="codeph">SourceGenerator</code> to use in generating the <code class="codeph">Source</code> produced by the <code class="codeph">Template</code>. The values are set by methods of the <code class="codeph">TopBottomTemplate</code>.
                           </p>
                        </li>
                        <li>
                           <p>Create a class called <code class="codeph">TopBottomTemplateGenerator</code> that implements <code class="codeph">SourceGenerator</code>. In the <code class="codeph">generateSource</code> method of the class, you provide the operations that create the <code class="codeph">Source</code> specified by the end user's selections.
                           </p>
                        </li>
                     </ul>
                     <p>Using your application, an end user selects units sold as the measure and products as the base dimension in the first dialog box. The end user also selects the Asia Pacific region, the first quarter of 2001, and the direct sales channel as the single values for each of the remaining dimensions.</p>
                     <p>The query that the end user has created requests the ten products that have the highest total amount of units sold through the direct sales channel to customers in the Asia Pacific region during the calendar year 2001.</p>
                     <p>For examples of implementations of the <code class="codeph">TopBottomTemplate</code>, <code class="codeph">TopBottomTemplateState</code>, and <code class="codeph">TopBottomTemplateGenerator</code> classes, and an example of an application that uses them, see <a href="creating-dynamic-queries.html#GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E__I1006228">Example 10-1</a>, <a href="creating-dynamic-queries.html#GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E__I1006260">Example 10-2</a>, <a href="creating-dynamic-queries.html#GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E__I1006264">Example 10-3</a><span>,</span> and <a href="creating-dynamic-queries.html#GUID-C22245FA-E655-468E-8053-BAB7044C3F9B__I1006270">Example 10-4</a>. The <code class="codeph">TopBottomTemplateState</code> and <code class="codeph">TopBottomTemplateGenerator</code> classes are implemented as inner classes of the <code class="codeph">TopBottomTemplate</code> outer class.
                     </p>
                  </div>
                  <!-- class="section" -->
               </div><a id="OLAAP394"></a><a id="OLAAP395"></a><a id="OLAAP396"></a><a id="OLAAP393"></a><div class="props_rev_3"><a id="GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E" name="GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E"></a><h4 id="OLAAP-GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E" class="sect4"><span class="enumeration_section">10.3.1 </span>Implementing the Classes for a Template
                  </h4>
                  <div>
                     <div class="section">The examples in this topic implement the <code class="codeph">Template</code>, <code class="codeph">MetadataState</code>, and <code class="codeph">SourceGenerator</code> classes.
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E__I1006228">
                        <p class="titleinexample">Example 10-1 Implementing a Template</p>
                        <p><a id="d28686e1409" class="indexterm-anchor"></a><a id="d28686e1413" class="indexterm-anchor"></a>This example is an implementation of the <code class="codeph">TopBottomTemplate</code> class.
                        </p><pre class="oac_no_warn" dir="ltr">import oracle.olapi.data.source.DataProvider;
import oracle.olapi.data.source.DynamicDefinition;
import oracle.olapi.data.source.Source;
import oracle.olapi.data.source.SourceGenerator;
import oracle.olapi.data.source.Template;
import oracle.olapi.transaction.metadataStateManager.MetadataState;

/**
&nbsp;* Creates a TopBottomTemplateState, a TopBottomTemplateGenerator,
 * and a DynamicDefinition.
 * Gets the current state of the TopBottomTemplateState and the values 
 * that it stores. 
&nbsp;* Sets the data values stored by the TopBottomTemplateState and sets the
 * changed state as the current state.
&nbsp;*/
public class TopBottomTemplate extends Template 
{
// Constants for specifying the selection of elements from the 
// beginning or the end of the result set.
&nbsp;&nbsp;public static final int TOP_BOTTOM_TYPE_TOP = 0;
&nbsp;&nbsp;public static final int TOP_BOTTOM_TYPE_BOTTOM = 1;

&nbsp;&nbsp;// Variable to store the DynamicDefinition.
&nbsp;&nbsp;private DynamicDefinition dynamicDef;

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Creates a TopBottomTemplate with a default type and number values
&nbsp;&nbsp;&nbsp;* and the specified base dimension.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public TopBottomTemplate(Source base, DataProvider dataProvider)
  {
&nbsp;&nbsp;&nbsp;&nbsp;super(new TopBottomTemplateState(base, TOP_BOTTOM_TYPE_TOP, 0),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataProvider);
&nbsp;&nbsp;&nbsp;&nbsp;// Create the DynamicDefinition for this Template. Create the 
&nbsp;&nbsp;&nbsp;&nbsp;// TopBottomTemplateGenerator that the DynamicDefinition uses.
&nbsp;&nbsp;&nbsp;&nbsp;dynamicDef = 
&nbsp;&nbsp;&nbsp;&nbsp;createDynamicDefinition(new TopBottomTemplateGenerator(dataProvider));
&nbsp;&nbsp;}

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Gets the Source produced by the TopBottomTemplateGenerator
&nbsp;&nbsp;&nbsp;* from the DynamicDefinition.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public final Source getSource() 
  {
&nbsp;&nbsp;&nbsp;&nbsp;return dynamicDef.getSource();
&nbsp;&nbsp;}

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Gets the Source that is the base of the elements in the result set.
&nbsp;&nbsp;&nbsp;* Returns null if the state has no base.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public Source getBase()
  {
    TopBottomTemplateState state = (TopBottomTemplateState) getCurrentState();
    return state.base;
&nbsp;&nbsp;}

&nbsp;&nbsp;/**
   * Sets a Source as the base.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public void setBase(Source base) 
  {
&nbsp;&nbsp;&nbsp;&nbsp; TopBottomTemplateState state = (TopBottomTemplateState) getCurrentState();
&nbsp;&nbsp;&nbsp;&nbsp;state.base = base;
&nbsp;&nbsp;&nbsp;&nbsp;setCurrentState(state);
&nbsp;&nbsp;}

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Gets the Source that specifies the measure and the single
&nbsp;&nbsp;&nbsp;* selections from the dimensions other than the base.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public Source getCriterion()
  {
&nbsp;&nbsp;&nbsp;&nbsp;TopBottomTemplateState state = (TopBottomTemplateState) getCurrentState();
&nbsp;&nbsp;&nbsp;&nbsp;return state.criterion;
&nbsp;&nbsp;}

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Specifies a Source that defines the measure and the single values 
&nbsp;&nbsp;&nbsp;* selected from the dimensions other than the base.
&nbsp;&nbsp;&nbsp;* The SingleSelectionTemplate produces such a Source.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public void setCriterion(Source criterion)
  {
&nbsp;&nbsp;&nbsp;&nbsp;TopBottomTemplateState state = (TopBottomTemplateState) getCurrentState();
&nbsp;&nbsp;&nbsp;&nbsp;state.criterion = criterion;
&nbsp;&nbsp;&nbsp;&nbsp;setCurrentState(state);
&nbsp;&nbsp;}

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Gets the type, which is either TOP_BOTTOM_TYPE_TOP or 
&nbsp;&nbsp;&nbsp;* TOP_BOTTOM_TYPE_BOTTOM.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public int getTopBottomType()
  {
&nbsp;&nbsp;&nbsp;&nbsp;TopBottomTemplateState state = (TopBottomTemplateState) getCurrentState();
&nbsp;&nbsp;&nbsp;&nbsp;return state.topBottomType;
&nbsp;&nbsp;}

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Sets the type.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public void setTopBottomType(int topBottomType)
  {
&nbsp;&nbsp;&nbsp;&nbsp;if ((topBottomType &lt; TOP_BOTTOM_TYPE_TOP) ||
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(topBottomType &gt; TOP_BOTTOM_TYPE_BOTTOM	))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new IllegalArgumentException("InvalidTopBottomType");
&nbsp;&nbsp;&nbsp;&nbsp;TopBottomTemplateState state = (TopBottomTemplateState) getCurrentState();
&nbsp;&nbsp;&nbsp;&nbsp;state.topBottomType = topBottomType;
&nbsp;&nbsp;&nbsp;&nbsp;setCurrentState(state);
&nbsp;&nbsp;}

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Gets the number of values selected.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public float getN()
  {
&nbsp;&nbsp;&nbsp;&nbsp;TopBottomTemplateState state = (TopBottomTemplateState) getCurrentState();
&nbsp;&nbsp;&nbsp;&nbsp;return state.N;
&nbsp;&nbsp;}

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Sets the number of values to select.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public void setN(float N)
  {
&nbsp;&nbsp;&nbsp;&nbsp;TopBottomTemplateState state = (TopBottomTemplateState) getCurrentState();
&nbsp;&nbsp;&nbsp;&nbsp;state.N = N;
&nbsp;&nbsp;&nbsp;&nbsp;setCurrentState(state);
&nbsp;&nbsp;}
}
</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E__I1006260">
                        <p class="titleinexample">Example 10-2 Implementing a MetadataState</p>
                        <p><a id="d28686e1425" class="indexterm-anchor"></a>This example is an implementation of the <code class="codeph">TopBottomTemplateState</code> inner class.
                        </p><pre class="oac_no_warn" dir="ltr">/**
&nbsp;* Stores data that can be changed by a TopBottomTemplate.
&nbsp;* The data is used by a TopBottomTemplateGenerator in producing
&nbsp;* a Source for the TopBottomTemplate.
&nbsp;*/
private static final class TopBottomTemplateState
&nbsp;&nbsp;&nbsp;&nbsp; implements Cloneable, MetadataState
{
&nbsp;&nbsp;public int topBottomType;
&nbsp;&nbsp;public float N;
&nbsp;&nbsp;public Source criterion;
&nbsp;&nbsp;public Source base;

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Creates a TopBottomTemplateState.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public TopBottomTemplateState(Source base, int topBottomType, float N)
  {
&nbsp;&nbsp;&nbsp;&nbsp;this.base = base;
&nbsp;&nbsp;&nbsp;&nbsp;this.topBottomType = topBottomType;
&nbsp;&nbsp;&nbsp;&nbsp;this.N = N;
&nbsp;&nbsp;}

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Creates a copy of this TopBottomTemplateState.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public final Object clone()
  {
&nbsp;&nbsp;&nbsp;&nbsp;try 
    {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return super.clone();
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;catch(CloneNotSupportedException e) 
    {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return null;
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;}
}
</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E__I1006264">
                        <p class="titleinexample">Example 10-3 Implementing a SourceGenerator</p>
                        <p><a id="d28686e1439" class="indexterm-anchor"></a>This example  is an implementation of the <code class="codeph">TopBottomTemplateGenerator</code> inner class.
                        </p><pre class="oac_no_warn" dir="ltr">/**
&nbsp;* Produces a Source for a TopBottomTemplate based on the data
&nbsp;* values of a TopBottomTemplateState.
&nbsp;*/
private final class TopBottomTemplateGenerator
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;implements SourceGenerator
{
&nbsp;&nbsp;// Store the DataProvider.
&nbsp;&nbsp;private DataProvider _dataProvider;

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Creates a TopBottomTemplateGenerator.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public TopBottomTemplateGenerator(DataProvider dataProvider)
  {
&nbsp;&nbsp;&nbsp;&nbsp;_dataProvider = dataProvider;
&nbsp;&nbsp;}

&nbsp;&nbsp;/**
&nbsp;&nbsp;&nbsp;* Generates a Source for a TopBottomTemplate using the current 
&nbsp;&nbsp;&nbsp;* state of the data values stored by the TopBottomTemplateState.
&nbsp;&nbsp;&nbsp;*/
&nbsp;&nbsp;public Source generateSource(MetadataState state)
  {
&nbsp;&nbsp;&nbsp;&nbsp;TopBottomTemplateState castState = (TopBottomTemplateState) state;
&nbsp;&nbsp;&nbsp;&nbsp;if (castState.criterion == null)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new NullPointerException("CriterionParameterMissing");
&nbsp;&nbsp;&nbsp;&nbsp;Source sortedBase = null;

    // Depending on the topBottomType value, select from the base Source
    // the elements specified by the criterion Source and sort the
    // elements in ascending or descending order.
    // For descending order, specify that null values are last.
    // For ascending order, specify that null values are first.
       
&nbsp;&nbsp;&nbsp;&nbsp;if (castState.topBottomType == TOP_BOTTOM_TYPE_TOP)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sortedBase = castState.base.sortDescending(castState.criterion, false);
&nbsp;&nbsp;&nbsp;&nbsp;else
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sortedBase = castState.base.sortAscending(castState.criterion, true);
&nbsp;&nbsp;&nbsp;&nbsp;return sortedBase.interval(1, Math.round(castState.N));
&nbsp;&nbsp;}
}</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="OLAAP398"></a><a id="OLAAP397"></a><div class="props_rev_3"><a id="GUID-C22245FA-E655-468E-8053-BAB7044C3F9B" name="GUID-C22245FA-E655-468E-8053-BAB7044C3F9B"></a><h4 id="OLAAP-GUID-C22245FA-E655-468E-8053-BAB7044C3F9B" class="sect4"><span class="enumeration_section">10.3.2 </span>Implementing an Application That Uses Templates
                  </h4>
                  <div>
                     <div class="section">
                        <p><a id="d28686e1487" class="indexterm-anchor"></a><a id="d28686e1491" class="indexterm-anchor"></a>After you have stored the selections made by the end user in the <code class="codeph">MetadataState</code> for the <code class="codeph">Template</code>, use the <code class="codeph">getSource</code> method of the <code class="codeph">DynamicDefinition</code> to get the dynamic <code class="codeph">Source</code> created by the <code class="codeph">Template</code>. This topic provides an example of an application that uses the <code class="codeph">TopBottomTemplate</code> described in <a href="creating-dynamic-queries.html#GUID-BE2435F6-6CDF-4539-B6F6-9C0BDB83116E__I1006228">Example 10-1</a>. For brevity, the code does not contain much exception handling.
                        </p>
                        <p>The <code class="codeph">BaseExample11g</code> class creates and stores an instance of the <code class="codeph">Context11g</code> class, which has methods that do the following:
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Connect to an Oracle Database instance as the user in the command line arguments.</p>
                           </li>
                           <li>
                              <p>Create <code class="codeph">Cursor</code> objects and displays their values.
                              </p>
                           </li>
                        </ul>
                        <p><a href="creating-dynamic-queries.html#GUID-C22245FA-E655-468E-8053-BAB7044C3F9B__I1006270">Example 10-4</a> does the following:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Gets the <code class="codeph">MdmMetadataProvider</code> and the <code class="codeph">MdmRootSchema</code>.
                              </p>
                           </li>
                           <li>
                              <p>Gets the <code class="codeph">DataProvider</code>.
                              </p>
                           </li>
                           <li>
                              <p>Gets the <code class="codeph">MdmDatabaseSchema</code> for the user.
                              </p>
                           </li>
                           <li>
                              <p>Gets the <code class="codeph">MdmCube</code> that has the COSTS, UNITS and SALES measures. From the cube, the example gets the UNITS and SALES measures and the dimensions associated with the cube.
                              </p>
                           </li>
                           <li>
                              <p><a id="d28686e1572" class="indexterm-anchor"></a>Creates a <code class="codeph">SingleSelectionTemplate</code> for selecting single values from some of the dimensions of the measure. For the code of the <code class="codeph">SingleSelectionTemplate</code> class that this example uses, see <a href="SingleSelectionTemplate-class.html#GUID-923EAA61-EFC2-4269-943F-9C0369837D4E"> SingleSelectionTemplate Class</a>.
                              </p>
                           </li>
                           <li>
                              <p>Creates a <code class="codeph">TopBottomTemplate</code> and stores selections made by the end user.
                              </p>
                           </li>
                           <li>
                              <p>Gets the <code class="codeph">Source</code> produced by the <code class="codeph">TopBottomTemplate</code>.
                              </p>
                           </li>
                           <li>
                              <p>Uses the <code class="codeph">Context11g</code> object to create a <code class="codeph">Cursor</code> for that <code class="codeph">Source</code> and to display the <code class="codeph">Cursor</code> values.
                              </p>
                           </li>
                        </ul>
                        <p>The complete code for <a href="using-transaction-provider.html#GUID-BDE99A6B-1D4D-473E-A719-6590C6A4D7B1__I1006243">Example 7-3</a> includes some of the same code that is in <a href="creating-dynamic-queries.html#GUID-C22245FA-E655-468E-8053-BAB7044C3F9B__I1006270">Example 10-4</a>. The example does not show this code, which extends from the beginning of <a href="creating-dynamic-queries.html#GUID-C22245FA-E655-468E-8053-BAB7044C3F9B__I1006270">Example 10-4</a> to the following comment in the example:
                        </p><pre class="oac_no_warn" dir="ltr">// End of code not shown in 
//<a href="using-transaction-provider.html#GUID-BDE99A6B-1D4D-473E-A719-6590C6A4D7B1__I1006243">Example 7-3</a>.</pre></div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-C22245FA-E655-468E-8053-BAB7044C3F9B__I1006270">
                        <p class="titleinexample">Example 10-4 Getting the Source Produced by the Template</p><pre class="oac_no_warn" dir="ltr">import oracle.olapi.data.source.DataProvider;
import oracle.olapi.data.source.Source;
import oracle.olapi.examples.*;
import oracle.olapi.metadata.mdm.MdmAttribute;
import oracle.olapi.metadata.mdm.MdmBaseMeasure;
import oracle.olapi.metadata.mdm.MdmCube;
import oracle.olapi.metadata.mdm.MdmDatabaseSchema;
import oracle.olapi.metadata.mdm.MdmDimensionLevel;
import oracle.olapi.metadata.mdm.MdmDimensionMemberInfo;
import oracle.olapi.metadata.mdm.MdmHierarchyLevel;
import oracle.olapi.metadata.mdm.MdmLevelHierarchy;
import oracle.olapi.metadata.mdm.MdmMetadataProvider;
import oracle.olapi.metadata.mdm.MdmPrimaryDimension;
import oracle.olapi.metadata.mdm.MdmRootSchema;

/**
&nbsp;* Creates a query that specifies a number of elements from the top
&nbsp;* or bottom of a selection of dimension members, creates a Cursor
 * for the query, and displays the values of the Cursor.
 * The selected dimension members are those that have measure values
 * that are specified by selected members of the other dimensions of
 * the measure.
&nbsp;*/
public class TopBottomTest extends BaseExample11g
{
  /**
   * Gets the MdmMetadataProvider, the DataProvider, the MdmRootSchema, and the
   * MdmDatabaseSchema for the current user.
   * Gets the UNITS_CUBE_AWJ MdmCube.
   * From the cube, gets the MdmBaseMeasure objects for the UNITS and SALES
   * measures and the MdmPrimaryDimension objects that dimension them.
   * Gets a hierarchy of the PRODUCT_AWJ dimension and the leaf level of the
   * dimension.
   * Gets the short description attribute of the dimension.
   * Creates a SingleSelectionTemplate and adds selections to it.
   * Creates a TopBottomTemplate and sets the properties of it.
   * Gets the Source produced by the TopBottomTemplate, creates a Cursor 
   * for it, and displays the values of the Cursor.
   * Changes the state of the SingleSelectionTemplate and the
   * TopBottomTemplate, creates a new Cursor for the Source produced by the
   * TopBottomTemplate, and displays the values of that Cursor.
   */
  public void run() throws Exception
  {
    // Get the MdmMetadataProvider from the superclass.
    MdmMetadataProvider metadataProvider = getMdmMetadataProvider();
    // Get the DataProvider from the Context11g object of the superclass.
    DataProvider dp = getContext().getDataProvider();

    // Get the MdmRootSchema and the MdmDatabaseSchema for the user.
    MdmRootSchema mdmRootSchema =
      (MdmRootSchema)metadataProvider.getRootSchema();
    MdmDatabaseSchema mdmDBSchema = 
      mdmRootSchema.getDatabaseSchema(getContext().getUser());

    MdmCube unitsCube =
      (MdmCube)mdmDBSchema.getTopLevelObject("UNITS_CUBE_AWJ");
    MdmBaseMeasure mdmUnits = unitsCube.findOrCreateBaseMeasure("UNITS");
    MdmBaseMeasure mdmSales = unitsCube.findOrCreateBaseMeasure("SALES");

    // Get the Source objects for the measures.
    Source units = mdmUnits.getSource();
    Source sales = mdmSales.getSource();

    // Get the MdmPrimaryDimension objects for the dimensions of the cube. 
    List&lt;MdmPrimaryDimension&gt; cubeDims = unitsCube.getDimensions();
    MdmPrimaryDimension mdmTimeDim = null;
    MdmPrimaryDimension mdmProdDim = null;
    MdmPrimaryDimension mdmCustDim = null;
    MdmPrimaryDimension mdmChanDim = null;
    
    for(MdmPrimaryDimension mdmPrimDim : cubeDims)
    {
      if (mdmPrimDim.getName().startsWith("TIME"))
        mdmTimeDim = mdmPrimDim;
      else if (mdmPrimDim.getName().startsWith("PROD"))
        mdmProdDim = mdmPrimDim;
      else if (mdmPrimDim.getName().startsWith("CUST"))
        mdmCustDim = mdmPrimDim;
      else if (mdmPrimDim.getName().startsWith("CHAN"))
        mdmChanDim = mdmPrimDim;
    }

    // Get the hierarchy of the PRODUCT_AWJ dimension.
    MdmLevelHierarchy mdmProdHier = 
      mdmProdDim.findOrCreateLevelHierarchy("PRODUCT_PRIMARY");

    // Get the detail dimenson level of the PRODUCT_AWJ dimension.
    MdmDimensionLevel mdmItemDimLevel = 
      mdmProdDim.findOrCreateDimensionLevel("ITEM");
    // Get the hierarchy level of the dimension level.
    MdmHierarchyLevel mdmItemHierLevel = 
                       mdmProdHier.findOrCreateHierarchyLevel(mdmItemDimLevel);       
    // Get the Source for the hierarchy level.
    Source itemLevel = mdmItemHierLevel.getSource();

    // Get the short description attribute for the PRODUCT_AWJ dimension and
    // the Source for the attribute.
    MdmAttribute mdmProdShortDescrAttr = 
      mdmProdDim.getShortValueDescriptionAttribute();
    Source prodShortDescrAttr = mdmProdShortDescrAttr.getSource();

    // Create a SingleSelectionTemplate to produce a Source that
    // represents the measure values specified by single members of each of
    // the dimensions of the measure other than the base dimension.
    SingleSelectionTemplate singleSelections =
      new SingleSelectionTemplate(units, dp);

    // Create MdmDimensionMemberInfo objects for single members of the
    // other dimensions of the measure.
    MdmDimensionMemberInfo timeMemInfo =
      new MdmDimensionMemberInfo(mdmTimeDim, "CALENDAR_YEAR::YEAR::CY2001");
    MdmDimensionMemberInfo custMemInfo =
      new MdmDimensionMemberInfo(mdmCustDim, "SHIPMENTS::REGION::APAC");
    MdmDimensionMemberInfo chanMemInfo =
      new MdmDimensionMemberInfo(mdmChanDim, "CHANNEL_PRIMARY::CHANNEL::DIR");
 
    // Add the dimension member information objects to the
    // SingleSelectionTemplate.
    singleSelections.addDimMemberInfo(custMemInfo);
    singleSelections.addDimMemberInfo(chanMemInfo);
    singleSelections.addDimMemberInfo(timeMemInfo);

    // Create a TopBottomTemplate specifying, as the base, the Source for a
    // a level of a hierarchy.
    TopBottomTemplate topNBottom = new TopBottomTemplate(itemLevel, dp);

    // Specify whether to retrieve the elements from the beginning (top) or the
    // end (bottom) of the selected elements of the base dimension.
    topNBottom.setTopBottomType(TopBottomTemplate.TOP_BOTTOM_TYPE_TOP);

    // Set the number of elements of the base dimension to retrieve.
    topNBottom.setN(10);
    // Get the Source produced by the SingleSelectionTemplate and specify it as
    // the criterion object.
    topNBottom.setCriterion(singleSelections.getSource());

    // End of code not shown in 
    // <a href="using-transaction-provider.html#GUID-BDE99A6B-1D4D-473E-A719-6590C6A4D7B1__I1006243">Example 7-3</a>.

    // Display a description of the result.
    String resultDescription = " products with the most units sold \nfor";
    displayResultDescr(singleSelections, topNBottom, resultDescription);

    // Get the Source produced by the TopBottomTemplate.
    Source result = topNBottom.getSource();

    // Join the Source produced by the TopBottomTemplate with the short
    // value descriptions. Use the joinHidden method so that the
    // dimension member values do not appear in the result.
    Source result = prodShortDescrAttr.joinHidden(topNBottomResult);

    // Commit the current transaction.
    getContext().commit();  // Method of Context11g.

    // Create a Cursor for the result and display the values of the Cursor.
    getContext().displayTopBottomResult(result);

    // Change a dimension member selection of the SingleSelectionTemplate.
    timeMemInfo.setUniqueValue("CALENDAR_YEAR::YEAR::CY2000");
    singleSelections.changeSelection(timeMemInfo);
 
    // Change the number of elements selected and the type of selection.
    topNBottom.setN(5);
    topNBottom.setTopBottomType(TopBottomTemplate.TOP_BOTTOM_TYPE_BOTTOM);
 
    // Join the Source produced by the TopBottomTemplate to the short
    // description attribute.
    result = prodShortDescrAttr.joinHidden(topNBottomResult);

    // Commit the current transaction.
    getContext().commit();
 
    // Display a description of the result.
    resultDescription = " products with the fewest units sold \nfor";
    displayResultDescr(singleSelections, topNBottom, resultDescription);
 
    // Create a new Cursor for the Source produced by the TopBottomTemplate
    // and display the Cursor values.
    getContext().displayTopBottomResult(result);

    // Now change the measure to SALES, and get the top and bottom products by
    // SALES.    
    singleSelections.setMeasure(sales);
    // Change the number of elements selected.
    topNBottom.setN(7);
    // Change the type of selection back to the top.
    topNBottom.setTopBottomType(TopBottomTemplate.TOP_BOTTOM_TYPE_TOP);

    resultDescription = " products with the highest sales amounts \nfor";
    displayResultDescr(singleSelections, topNBottom, resultDescription);

    topNBottomResult = topNBottom.getSource();
    result = prodShortDescrAttr.joinHidden(topNBottomResult);
    
    // Commit the current transaction.
    getContext().commit();
    getContext().displayTopBottomResult(result);

    // Change the type of selection back to the bottom.
    topNBottom.setTopBottomType(TopBottomTemplate.TOP_BOTTOM_TYPE_BOTTOM);

    resultDescription = " products with the lowest sales amounts \nfor";
    displayResultDescr(singleSelections, topNBottom, resultDescription);

    topNBottomResult = topNBottom.getSource();
    result = prodShortDescrAttr.joinHidden(topNBottomResult);
    
    // Commit the current transaction.
    getContext().commit();
    getContext().displayTopBottomResult(result);

  } 

  /**
   * Displays a description of the results of the query.
   * 
   * @param singleSelections The SingleSelectionsTemplate used by the query.
   * 
   * @param topNBottom The TopBottomTemplate used by the query.
   * 
   * @param resultDescr A String that contains a description of the query.
   */
  private void displayResultDescr(SingleSelectionTemplate singleSelections,
                                  TopBottomTemplate topNBottom,
                                  String resultDescr)
  {
    DataProvider dp = getContext().getDataProvider();
    
    // Get the short descriptions of the dimension members of the  
    // SingleSelectionTemplate.
    StringBuffer shortDescrsForMemberVals =
      singleSelections.getMemberShortDescrs(dp);
    
    // Display the number of dimension members selected, the result description,
    // and the short descriptions of the single selection dimension members.
    println("\nThe " + Math.round(topNBottom.getN()) + resultDescr
            + shortDescrsForMemberVals +" are:\n"); 
  }

  /**
   * Runs the TopBottomTest application.
   *
   * @param args An array of String objects that provides the arguments
   *             required to connect to an Oracle Database instance, as
   *             specified in the Context11g class.
   */
  public static void main(String[] args) 
  {
    new TopBottomTest().execute(args);
  }</pre><p>}</p>
                        <p>The <code class="codeph">TopBottomTest</code> program produces the following output.
                        </p><pre class="oac_no_warn" dir="ltr">The 10 products with the most units sold
for Asia Pacific, Direct Sales, 2001 are:

 1. Mouse Pad
 2. Unix/Windows 1-user pack
 3. Deluxe Mouse
 4. Laptop carrying case
 5. 56Kbps V.90 Type II Modem
 6. 56Kbps V.92 Type II Fax/Modem
 7. Keyboard Wrist Rest
 8. Internal - DVD-RW - 6X
 9. O/S Documentation Set - English
10. External - DVD-RW - 8X
 
The 5 products with the fewest units sold
for Asia Pacific, Direct Sales, 2000 are:
 
 1. Envoy External Keyboard
 2. O/S Documentation Set - Italian
 3. External 48X CD-ROM
 4. O/S Documentation Set - Spanish
 5. Internal 48X CD-ROM USB

The 7 products with the highest sales amounts 
for Asia Pacific, Direct Sales, 2000 are:
 
 1. Sentinel Financial
 2. Sentinel Standard
 3. Envoy Executive
 4. Sentinel Multimedia
 5. Envoy Standard
 6. Envoy Ambassador
 7. 56Kbps V.90 Type II Modem
 
The 7 products with the lowest sales amounts 
for Asia Pacific, Direct Sales, 2000 are:

 1. Envoy External Keyboard
 2. Keyboard Wrist Rest
 3. Mouse Pad
 4. O/S Documentation Set - Italian
 5. O/S Documentation Set - Spanish
 6. Standard Mouse
 7. O/S Documentation Set - French</pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>