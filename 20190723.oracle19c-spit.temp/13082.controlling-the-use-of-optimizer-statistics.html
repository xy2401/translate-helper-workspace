<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="Using DBMS_STATS, you can specify when and how the optimizer uses statistics.">
      <meta name="description" content="Using DBMS_STATS, you can specify when and how the optimizer uses statistics.">
      <title>Controlling the Use of Optimizer Statistics</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="SQL Tuning Guide">
      <meta property="og:description" content="Using DBMS_STATS, you can specify when and how the optimizer uses statistics.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="SQL Tuning Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="sql-tuning-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-31T14:57:08-08:00">
      <meta name="dcterms.title" content="SQL Tuning Guide">
      <meta name="dcterms.dateCopyrighted" content="2013, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96095-03">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="managing-extended-statistics.html" title="Previous" type="text/html">
      <link rel="next" href="managing-historical-optimizer-statistics.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TGSQL">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="managing-extended-statistics.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="managing-historical-optimizer-statistics.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">SQL Tuning Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="optimizer-statistics.html" property="item" typeof="WebPage"><span property="name">Optimizer Statistics</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Controlling the Use of Optimizer Statistics</li>
            </ol>
            <a id="GUID-6D85C813-5FBF-4655-ACE5-1E50DB4F8E60" name="GUID-6D85C813-5FBF-4655-ACE5-1E50DB4F8E60"></a>
            
            <h2 id="TGSQL-GUID-6D85C813-5FBF-4655-ACE5-1E50DB4F8E60" class="sect2"><span class="enumeration_chapter">15 </span>Controlling the Use of Optimizer Statistics
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>Using <code class="codeph">DBMS_STATS</code>, you can specify when and how the optimizer uses statistics.
               </p>
               <p>This section contains the following topics:</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="controlling-the-use-of-optimizer-statistics.html#GUID-1147FF89-68F0-4B0F-831A-A7E5D151D02F">Locking and Unlocking Optimizer Statistics</a><br>You can lock statistics to prevent them from changing. 
                  </li>
                  <li class="ulchildlink"><a href="controlling-the-use-of-optimizer-statistics.html#GUID-8FF503A2-5E50-4054-AC3A-5672343BDFE3">Publishing Pending Optimizer Statistics</a><br>By default, the database automatically publishes statistics when the statistics collection ends. 
                  </li>
                  <li class="ulchildlink"><a href="controlling-the-use-of-optimizer-statistics.html#GUID-87A26DD9-E2C1-41E3-9EF0-D141F44F0968">Creating Artificial Optimizer Statistics for Testing</a><br>To provide the optimizer with user-created statistics for testing purposes, you can use the <code class="codeph">DBMS_STATS.SET_*_STATS</code> procedures. These procedures provide the optimizer with artificial values for the specified statistics.
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>Parent topic:</strong> <a href="optimizer-statistics.html#GUID-0A2F3D52-A135-43E1-9CAB-55BFE068A297" title="The accuracy of an execution plan depends on the quality of the optimizer statistics.">Optimizer Statistics</a></p>
                  </div>
               </div>
            </div>
            <a id="TGSQL489"></a><div class="props_rev_3"><a id="GUID-1147FF89-68F0-4B0F-831A-A7E5D151D02F" name="GUID-1147FF89-68F0-4B0F-831A-A7E5D151D02F"></a><h3 id="TGSQL-GUID-1147FF89-68F0-4B0F-831A-A7E5D151D02F" class="sect3"><span class="enumeration_section">15.1 </span>Locking and Unlocking Optimizer Statistics
               </h3>
               <div>
                  <p>You can lock statistics to prevent them from changing. </p>
                  <p>After statistics are locked, you cannot make modifications to the statistics until the statistics have been unlocked. Locking procedures are useful in a static environment when you want to guarantee that the statistics and resulting plan never change. For example, you may want to prevent new statistics from being gathered on a table or schema by the <code class="codeph">DBMS_STATS_JOB</code> process, such as highly volatile tables. 
                  </p>
                  <p>When you lock statistics on a table, all dependent statistics are locked. The locked statistics include table statistics, column statistics, histograms, and dependent index statistics. To overwrite statistics even when they are locked, you can set the value of the <code class="codeph">FORCE</code> argument in various <code class="codeph">DBMS_STATS</code> procedures, for example, <code class="codeph">DELETE_*_STATS</code> and <code class="codeph">RESTORE_*_STATS</code>, to <code class="codeph">true</code>.
                  </p>
                  <p>This section contains the following topics:</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="controlling-the-use-of-optimizer-statistics.html#GUID-F9BB2D09-BAED-466A-9953-B93442AD8E4A">Locking Statistics</a><br>The <code class="codeph">DBMS_STATS</code> package provides two procedures for locking statistics: <code class="codeph">LOCK_SCHEMA_STATS</code> and <code class="codeph">LOCK_TABLE_STATS</code>.
                     </li>
                     <li class="ulchildlink"><a href="controlling-the-use-of-optimizer-statistics.html#GUID-C6ACF2CB-DD6F-4977-863F-0ECE04BEF8B0">Unlocking Statistics</a><br>The <code class="codeph">DBMS_STATS</code> package provides two procedures for unlocking statistics: <code class="codeph">UNLOCK_SCHEMA_STATS</code> and <code class="codeph">UNLOCK_TABLE_STATS</code>.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="controlling-the-use-of-optimizer-statistics.html#GUID-6D85C813-5FBF-4655-ACE5-1E50DB4F8E60" title="Using DBMS_STATS, you can specify when and how the optimizer uses statistics.">Controlling the Use of Optimizer Statistics</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL491"></a><a id="TGSQL490"></a><div class="props_rev_3"><a id="GUID-F9BB2D09-BAED-466A-9953-B93442AD8E4A" name="GUID-F9BB2D09-BAED-466A-9953-B93442AD8E4A"></a><h4 id="TGSQL-GUID-F9BB2D09-BAED-466A-9953-B93442AD8E4A" class="sect4"><span class="enumeration_section">15.1.1 </span>Locking Statistics
                  </h4>
                  <div>
                     <p>The <code class="codeph">DBMS_STATS</code> package provides two procedures for locking statistics: <code class="codeph">LOCK_SCHEMA_STATS</code> and <code class="codeph">LOCK_TABLE_STATS</code>.
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-F9BB2D09-BAED-466A-9953-B93442AD8E4A__GUID-140446A6-13CA-4B5C-A213-1EFA83A77E51">Assumptions</p>
                        <p>This tutorial assumes the following:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>You gathered statistics on the <code class="codeph">oe.orders</code> table and on the <code class="codeph">hr</code> schema.
                              </p>
                           </li>
                           <li>
                              <p>You want to prevent the <code class="codeph">oe.orders</code> table statistics and <code class="codeph">hr</code> schema statistics from changing.
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-F9BB2D09-BAED-466A-9953-B93442AD8E4A__GUID-AC4C5ABC-2A37-4BE1-8189-224014B99C4A">To lock statistics:</p>
                        <ol>
                           <li>
                              <p>Start SQL*Plus and connect to the database as the <code class="codeph">oe</code> user.
                              </p>
                           </li>
                           <li>
                              <p>Lock the statistics on <code class="codeph">oe.orders</code>.
                              </p>
                              <p>For example, execute the following PL/SQL program:</p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.LOCK_TABLE_STATS('OE','ORDERS');
END;
/
</code></pre></li>
                           <li>
                              <p>Connect to the database as the <code class="codeph">hr</code> user.
                              </p>
                           </li>
                           <li>
                              <p>Lock the statistics in the <code class="codeph">hr</code> schema.
                              </p>
                              <p>For example, execute the following PL/SQL program:</p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.LOCK_SCHEMA_STATS('HR');
END;
/</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-F9BB2D09-BAED-466A-9953-B93442AD8E4A__GUID-74D20336-6542-4E43-AED3-7C159A12F281">
                        <p class="notep1">See Also:</p>
                        <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-77225DE6-28D1-4064-9531-87BB1CFB4405" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_STATS.LOCK_TABLE_STATS</code> procedure
                        </p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="controlling-the-use-of-optimizer-statistics.html#GUID-1147FF89-68F0-4B0F-831A-A7E5D151D02F" title="You can lock statistics to prevent them from changing.">Locking and Unlocking Optimizer Statistics</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL493"></a><a id="TGSQL492"></a><div class="props_rev_3"><a id="GUID-C6ACF2CB-DD6F-4977-863F-0ECE04BEF8B0" name="GUID-C6ACF2CB-DD6F-4977-863F-0ECE04BEF8B0"></a><h4 id="TGSQL-GUID-C6ACF2CB-DD6F-4977-863F-0ECE04BEF8B0" class="sect4"><span class="enumeration_section">15.1.2 </span>Unlocking Statistics
                  </h4>
                  <div>
                     <p>The <code class="codeph">DBMS_STATS</code> package provides two procedures for unlocking statistics: <code class="codeph">UNLOCK_SCHEMA_STATS</code> and <code class="codeph">UNLOCK_TABLE_STATS</code>.
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-C6ACF2CB-DD6F-4977-863F-0ECE04BEF8B0__GUID-64241D18-BBD8-4143-9BF9-593A2DBF2FC8">Assumptions</p>
                        <p>This tutorial assumes the following:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>You locked statistics on the <code class="codeph">oe.orders</code> table and on the <code class="codeph">hr</code> schema.
                              </p>
                           </li>
                           <li>
                              <p>You want to unlock these statistics.</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-C6ACF2CB-DD6F-4977-863F-0ECE04BEF8B0__GUID-A8E781A4-A2C3-428A-8CA7-58EBD4F7EE9F">To unlock statistics:</p>
                        <ol>
                           <li>
                              <p>Start SQL*Plus and connect to the database as the <code class="codeph">oe</code> user.
                              </p>
                           </li>
                           <li>
                              <p>Unlock the statistics on <code class="codeph">oe.orders</code>.
                              </p>
                              <p>For example, execute the following PL/SQL program:</p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.UNLOCK_TABLE_STATS('OE','ORDERS');
END;
/
</code></pre></li>
                           <li>
                              <p>Connect to the database as the <code class="codeph">hr</code> user.
                              </p>
                           </li>
                           <li>
                              <p>Unlock the statistics in the <code class="codeph">hr</code> schema.
                              </p>
                              <p>For example, execute the following PL/SQL program:</p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.UNLOCK_SCHEMA_STATS('HR');
END;
/</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-C6ACF2CB-DD6F-4977-863F-0ECE04BEF8B0__GUID-B1E91BD1-0A2C-4099-A72A-8A08E9FADB3E">
                        <p class="notep1">See Also:</p>
                        <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-690DF3FA-E225-4959-8836-5458F17217D5" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_STATS.UNLOCK_TABLE_STATS</code> procedure
                        </p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="controlling-the-use-of-optimizer-statistics.html#GUID-1147FF89-68F0-4B0F-831A-A7E5D151D02F" title="You can lock statistics to prevent them from changing.">Locking and Unlocking Optimizer Statistics</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL456"></a><div class="props_rev_3"><a id="GUID-8FF503A2-5E50-4054-AC3A-5672343BDFE3" name="GUID-8FF503A2-5E50-4054-AC3A-5672343BDFE3"></a><h3 id="TGSQL-GUID-8FF503A2-5E50-4054-AC3A-5672343BDFE3" class="sect3"><span class="enumeration_section">15.2 </span>Publishing Pending Optimizer Statistics
               </h3>
               <div>
                  <p>By default, the database automatically publishes statistics when the statistics collection ends. </p>
                  <p>Alternatively, you can use <a href="glossary.html#GUID-080D2B1E-AD95-43A4-9361-D9FB9C101D11"><span class="xrefglossterm">pending statistics</span></a> to save the statistics and not publish them immediately after the collection. This technique is useful for testing queries in a session with pending statistics. When the test results are satisfactory, you can publish the statistics to make them available for the entire database. 
                  </p>
                  <p>This section contains the following topics:</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="controlling-the-use-of-optimizer-statistics.html#GUID-8244B238-B835-4121-8FB2-D6213104E21A">About Pending Optimizer Statistics</a><br>The database stores pending statistics in the data dictionary just as for published statistics. 
                     </li>
                     <li class="ulchildlink"><a href="controlling-the-use-of-optimizer-statistics.html#GUID-A511A414-B777-4CCC-A5B8-AA2F74A3A663">User Interfaces for Publishing Optimizer Statistics</a><br>You can use the <code class="codeph">DBMS_STATS</code> package to perform operations relating to publishing statistics. 
                     </li>
                     <li class="ulchildlink"><a href="controlling-the-use-of-optimizer-statistics.html#GUID-28D2C31D-889F-4C21-8618-100BC3A72856">Managing Published and Pending Statistics</a><br>This section explains how to use <code class="codeph">DBMS_STATS</code> program units to change the publishing behavior of optimizer statistics, and also to export and delete these statistics.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="controlling-the-use-of-optimizer-statistics.html#GUID-6D85C813-5FBF-4655-ACE5-1E50DB4F8E60" title="Using DBMS_STATS, you can specify when and how the optimizer uses statistics.">Controlling the Use of Optimizer Statistics</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL457"></a><div class="props_rev_3"><a id="GUID-8244B238-B835-4121-8FB2-D6213104E21A" name="GUID-8244B238-B835-4121-8FB2-D6213104E21A"></a><h4 id="TGSQL-GUID-8244B238-B835-4121-8FB2-D6213104E21A" class="sect4"><span class="enumeration_section">15.2.1 </span>About Pending Optimizer Statistics
                  </h4>
                  <div>
                     <p>The database stores pending statistics in the data dictionary just as for published statistics. </p>
                     <p>By default, the optimizer uses published statistics. You can change the default behavior by setting the <code class="codeph">OPTIMIZER_USE_PENDING_STATISTICS</code> initialization parameter to <code class="codeph">true</code> (the default is <code class="codeph">false</code>).
                     </p>
                     <p>The top part of the following graphic shows the optimizer gathering statistics for the <code class="codeph">sh.customers</code> table and storing them in the data dictionary with pending status. The bottom part of the diagram shows the optimizer using only published statistics to process a query of <code class="codeph">sh.customers</code>.
                     </p>
                     <div class="figure" id="GUID-8244B238-B835-4121-8FB2-D6213104E21A__CHDEDCHI">
                        <p class="titleinfigure">Figure 15-1 Published and Pending Statistics</p><img src="img/tgsql_vm_039.png" alt="Description of Figure 15-1 follows" title="Description of Figure 15-1 follows" longdesc="img_text/tgsql_vm_039.html"><br><a href="img_text/tgsql_vm_039.html">Description of "Figure 15-1 Published and Pending Statistics"</a></div>
                     <!-- class="figure" -->
                     <p>In some cases, the optimizer can use a combination of published and pending statistics. For example, the database stores both published and pending statistics for the <code class="codeph">customers</code> table. For the <code class="codeph">orders</code> table, the database stores only published statistics. If <code class="codeph">OPTIMIZER_USE_PENDING_STATS = true</code>, then the optimizer uses pending statistics for <code class="codeph">customers</code> and published statistics for <code class="codeph">orders</code>. If <code class="codeph">OPTIMIZER_USE_PENDING_STATS = false</code>, then the optimizer uses published statistics for <code class="codeph">customers</code> and <code class="codeph">orders</code>.
                     </p>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-8244B238-B835-4121-8FB2-D6213104E21A__GUID-931891E4-EA6B-4C2E-AEF3-C25003C64E38">
                        <p class="notep1">See Also:</p>
                        <p><a href="../refrn/OPTIMIZER_USE_PENDING_STATISTICS.html#REFRN10288" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">OPTIMIZER_USE_PENDING_STATISTICS</code> initialization parameter
                        </p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="controlling-the-use-of-optimizer-statistics.html#GUID-8FF503A2-5E50-4054-AC3A-5672343BDFE3" title="By default, the database automatically publishes statistics when the statistics collection ends.">Publishing Pending Optimizer Statistics</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL459"></a><a id="TGSQL94929"></a><a id="TGSQL458"></a><div class="props_rev_3"><a id="GUID-A511A414-B777-4CCC-A5B8-AA2F74A3A663" name="GUID-A511A414-B777-4CCC-A5B8-AA2F74A3A663"></a><h4 id="TGSQL-GUID-A511A414-B777-4CCC-A5B8-AA2F74A3A663" class="sect4"><span class="enumeration_section">15.2.2 </span>User Interfaces for Publishing Optimizer Statistics
                  </h4>
                  <div>
                     <p>You can use the <code class="codeph">DBMS_STATS</code> package to perform operations relating to publishing statistics. 
                     </p>
                     <div class="section">
                        <p>The following table lists the relevant program units.</p>
                        <div class="tblformal" id="GUID-A511A414-B777-4CCC-A5B8-AA2F74A3A663__CHDEFDGF">
                           <p class="titleintable">Table 15-1 DBMS_STATS Program Units Relevant for Publishing Optimizer Statistics</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="DBMS_STATS Program Units Relevant for Publishing Optimizer Statistics" summary="Parameters for the create_extended_statistics Function" width="100%" frame="hsides" border="1" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="39%" id="d86157e1201">Program Unit</th>
                                    <th align="left" valign="bottom" width="61%" id="d86157e1204">Description</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="39%" id="d86157e1209" headers="d86157e1201 ">
                                       <p><code class="codeph">GET_PREFS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="61%" headers="d86157e1209 d86157e1204 ">
                                       <p>Check whether the statistics are automatically published as soon as <code class="codeph">DBMS_STATS</code> gathers them. For the parameter <code class="codeph">PUBLISH</code>, <code class="codeph">true</code> indicates that the statistics must be published when the database gathers them, whereas <code class="codeph">false</code> indicates that the database must keep the statistics pending.
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="39%" id="d86157e1229" headers="d86157e1201 ">
                                       <p><code class="codeph">SET_TABLE_PREFS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="61%" headers="d86157e1229 d86157e1204 ">
                                       <p>Set the <code class="codeph">PUBLISH</code> setting to <code class="codeph">true</code> or <code class="codeph">false</code> at the table level.
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="39%" id="d86157e1246" headers="d86157e1201 ">
                                       <p><code class="codeph">SET_SCHEMA_PREFS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="61%" headers="d86157e1246 d86157e1204 ">
                                       <p>Set the <code class="codeph">PUBLISH</code> setting to <code class="codeph">true</code> or <code class="codeph">false</code> at the schema level.
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="39%" id="d86157e1263" headers="d86157e1201 ">
                                       <p><code class="codeph">PUBLISH_PENDING_STATS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="61%" headers="d86157e1263 d86157e1204 ">
                                       <p>Publish valid pending statistics for all objects or only specified objects.</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="39%" id="d86157e1271" headers="d86157e1201 ">
                                       <p><code class="codeph">DELETE_PENDING_STATS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="61%" headers="d86157e1271 d86157e1204 ">
                                       <p>Delete pending statistics.</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="39%" id="d86157e1279" headers="d86157e1201 ">
                                       <p><code class="codeph">EXPORT_PENDING_STATS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="61%" headers="d86157e1279 d86157e1204 ">
                                       <p>Export pending statistics.</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>The initialization parameter <code class="codeph">OPTIMIZER_USE_PENDING_STATISTICS</code> determines whether the database uses pending statistics when they are available. The default value is <code class="codeph">false</code>, which means that the optimizer uses only published statistics. Set to <code class="codeph">true</code> to specify that the optimizer uses any existing pending statistics instead. The best practice is to set this parameter at the session level rather than at the database level.
                        </p>
                        <p>You can use access information about published statistics from data dictionary views. <a href="controlling-the-use-of-optimizer-statistics.html#GUID-A511A414-B777-4CCC-A5B8-AA2F74A3A663__CHDJFDDD" title="Parameters for the create_extended_statistics Function">Table 15-2</a> lists relevant views.
                        </p>
                        <div class="tblformal" id="GUID-A511A414-B777-4CCC-A5B8-AA2F74A3A663__CHDJFDDD">
                           <p class="titleintable">Table 15-2 Views Relevant for Publishing Optimizer Statistics</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="Views Relevant for Publishing Optimizer Statistics" summary="Parameters for the create_extended_statistics Function" width="100%" frame="hsides" border="1" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="43%" id="d86157e1314">View</th>
                                    <th align="left" valign="bottom" width="57%" id="d86157e1317">Description</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="43%" id="d86157e1322" headers="d86157e1314 ">
                                       <p><code class="codeph">USER_TAB_STATISTICS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="57%" headers="d86157e1322 d86157e1317 ">
                                       <p>Displays optimizer statistics for the tables accessible to the current user.</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="43%" id="d86157e1330" headers="d86157e1314 ">
                                       <p><code class="codeph">USER_TAB_COL_STATISTICS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="57%" headers="d86157e1330 d86157e1317 ">
                                       <p>Displays column statistics and histogram information extracted from <code class="codeph">ALL_TAB_COLUMNS</code>.
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="43%" id="d86157e1341" headers="d86157e1314 ">
                                       <p><code class="codeph">USER_PART_COL_STATISTICS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="57%" headers="d86157e1341 d86157e1317 ">
                                       <p>Displays column statistics and histogram information for the table partitions owned by the current user. </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="43%" id="d86157e1349" headers="d86157e1314 ">
                                       <p><code class="codeph">USER_SUBPART_COL_STATISTICS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="57%" headers="d86157e1349 d86157e1317 ">
                                       <p>Describes column statistics and histogram information for subpartitions of partitioned objects owned by the current user.</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="43%" id="d86157e1357" headers="d86157e1314 ">
                                       <p><code class="codeph">USER_IND_STATISTICS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="57%" headers="d86157e1357 d86157e1317 ">
                                       <p>Displays optimizer statistics for the indexes accessible to the current user.</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="43%" id="d86157e1365" headers="d86157e1314 ">
                                       <p><code class="codeph">USER_TAB_PENDING_STATS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="57%" headers="d86157e1365 d86157e1317 ">
                                       <p>Describes pending statistics for tables, partitions, and subpartitions accessible to the current user.</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="43%" id="d86157e1373" headers="d86157e1314 ">
                                       <p><code class="codeph">USER_COL_PENDING_STATS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="57%" headers="d86157e1373 d86157e1317 ">
                                       <p>Describes the pending statistics of the columns accessible to the current user.</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="43%" id="d86157e1381" headers="d86157e1314 ">
                                       <p><code class="codeph">USER_IND_PENDING_STATS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="57%" headers="d86157e1381 d86157e1317 ">
                                       <p>Describes the pending statistics for tables, partitions, and subpartitions accessible to the current user collected using the <code class="codeph">DBMS_STATS</code> package.
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-A511A414-B777-4CCC-A5B8-AA2F74A3A663__GUID-A1266D17-5F8E-40E7-B3E0-C238F2B47DD8">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="../arpls/DBMS_STATS.html#ARPLS059" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_STATS</code> package
                              </p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=REFRN26639" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about <code class="codeph">USER_TAB_PENDING_STATS</code> and related views
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="controlling-the-use-of-optimizer-statistics.html#GUID-8FF503A2-5E50-4054-AC3A-5672343BDFE3" title="By default, the database automatically publishes statistics when the statistics collection ends.">Publishing Pending Optimizer Statistics</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL461"></a><a id="TGSQL460"></a><div class="props_rev_3"><a id="GUID-28D2C31D-889F-4C21-8618-100BC3A72856" name="GUID-28D2C31D-889F-4C21-8618-100BC3A72856"></a><h4 id="TGSQL-GUID-28D2C31D-889F-4C21-8618-100BC3A72856" class="sect4"><span class="enumeration_section">15.2.3 </span>Managing Published and Pending Statistics
                  </h4>
                  <div>
                     <p>This section explains how to use <code class="codeph">DBMS_STATS</code> program units to change the publishing behavior of optimizer statistics, and also to export and delete these statistics.
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-28D2C31D-889F-4C21-8618-100BC3A72856__GUID-EE1F6A4D-F90A-44DF-9FCC-24BCA8704923">Assumptions</p>
                        <p>This tutorial assumes the following:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>You want to change the preferences for the <code class="codeph">sh.customers</code> and <code class="codeph">sh.sales</code> tables so that newly collected statistics have pending status.
                              </p>
                           </li>
                           <li>
                              <p>You want the current session to use pending statistics.</p>
                           </li>
                           <li>
                              <p>You want to gather and publish pending statistics on the <code class="codeph">sh.customers</code> table.
                              </p>
                           </li>
                           <li>
                              <p>You gather the pending statistics on the <code class="codeph">sh.sales</code> table, but decide to delete them without publishing them. 
                              </p>
                           </li>
                           <li>
                              <p>You want to change the preferences for the <code class="codeph">sh.customers</code> and <code class="codeph">sh.sales</code> tables so that newly collected statistics are published.
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-28D2C31D-889F-4C21-8618-100BC3A72856__GUID-BC6A7997-6C25-43B8-ACF6-EEA7F532655F">To manage published and pending statistics:</p>
                        <ol>
                           <li>
                              <p>Start SQL*Plus and connect to the database as user <code class="codeph">sh</code>.
                              </p>
                           </li>
                           <li>
                              <p>Query the global optimizer statistics publishing setting.</p>
                              <p>Run the following query (sample output included):</p><pre class="pre codeblock"><code>sh@PROD&gt; SELECT DBMS_STATS.GET_PREFS('PUBLISH') PUBLISH FROM DUAL;

PUBLISH
-------
TRUE
</code></pre><p>The value <code class="codeph">true</code> indicates that the database publishes statistics as it gathers them. Every table uses this value unless a specific table preference has been set. 
                              </p>
                              <p>When using <code class="codeph">GET_PREFS</code>, you can also specify a schema and table name. The function returns a table preference if it is set. Otherwise, the function returns the global preference.
                              </p>
                           </li>
                           <li>
                              <p>Query the pending statistics.</p>
                              <p>For example, run the following query (sample output included):</p><pre class="pre codeblock"><code>sh@PROD&gt; SELECT * FROM USER_TAB_PENDING_STATS;
 
no rows selected
</code></pre><p>This example shows that the database currently stores no pending statistics for the <code class="codeph">sh</code> schema.
                              </p>
                           </li>
                           <li>
                              <p>Change the publishing preferences for the <code class="codeph">sh.customers</code> table.
                              </p>
                              <p>For example, execute the following procedure so that statistics are marked as pending:</p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.SET_TABLE_PREFS('sh', 'customers', 'publish', 'false');
END;
/
</code></pre><p>Subsequently, when you gather statistics on the <code class="codeph">customers</code> table, the database does not automatically publish statistics when the gather job completes. Instead, the database stores the newly gathered statistics in the <code class="codeph">USER_TAB_PENDING_STATS</code> table.
                              </p>
                           </li>
                           <li>
                              <p>Gather statistics for <code class="codeph">sh.customers</code>.
                              </p>
                              <p>For example, run the following program:</p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.GATHER_TABLE_STATS('sh','customers');
END;
/
</code></pre></li>
                           <li>
                              <p>Query the pending statistics.</p>
                              <p>For example, run the following query (sample output included):</p><pre class="pre codeblock"><code>sh@PROD&gt; SELECT TABLE_NAME, NUM_ROWS FROM USER_TAB_PENDING_STATS;
 
TABLE_NAME                       NUM_ROWS
------------------------------ ----------
CUSTOMERS                           55500
</code></pre><p>This example shows that the database now stores pending statistics for the <code class="codeph">sh.customers</code> table.
                              </p>
                           </li>
                           <li>
                              <p>Instruct the optimizer to use the pending statistics in this session.</p>
                              <p>Set the initialization parameter <code class="codeph">OPTIMIZER_USE_PENDING_STATISTICS</code> to <code class="codeph">true</code> as shown:
                              </p><pre class="pre codeblock"><code>ALTER SESSION SET OPTIMIZER_USE_PENDING_STATISTICS = true;
</code></pre></li>
                           <li>
                              <p>Run a workload.</p>
                              <p>The following example changes the email addresses of all customers named Bruce Chalmers:</p><pre class="pre codeblock"><code>UPDATE  sh.customers 
  SET   cust_email='ChalmersB@company.example.icom' 
  WHERE cust_first_name = 'Bruce' 
  AND   cust_last_name = 'Chalmers';
COMMIT;
</code></pre><p>The optimizer uses the pending statistics instead of the published statistics when compiling all SQL statements in this session.</p>
                           </li>
                           <li>
                              <p>Publish the pending statistics for <code class="codeph">sh.customers</code>.
                              </p>
                              <p>For example, execute the following program:</p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.PUBLISH_PENDING_STATS('SH','CUSTOMERS');
END;
/
</code></pre></li>
                           <li>
                              <p>Change the publishing preferences for the <code class="codeph">sh.sales</code> table.
                              </p>
                              <p>For example, execute the following program:</p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.SET_TABLE_PREFS('sh', 'sales', 'publish', 'false');
END;
/
</code></pre><p>Subsequently, when you gather statistics on the <code class="codeph">sh.sales</code> table, the database does not automatically publish statistics when the gather job completes. Instead, the database stores the statistics in the <code class="codeph">USER_TAB_PENDING_STATS</code> table.
                              </p>
                           </li>
                           <li>
                              <p>Gather statistics for <code class="codeph">sh.sales</code>.
                              </p>
                              <p>For example, run the following program:</p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.GATHER_TABLE_STATS('sh','sales');
END;
/
</code></pre></li>
                           <li>
                              <p>Delete the pending statistics for <code class="codeph">sh.sales</code>.
                              </p>
                              <p>Assume you change your mind and now want to delete pending statistics for <code class="codeph">sh.sales</code>. Run the following program:
                              </p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.DELETE_PENDING_STATS('sh','sales');
END;
/
</code></pre></li>
                           <li>
                              <p>Change the publishing preferences for the <code class="codeph">sh.customers</code> and <code class="codeph">sh.sales</code> tables back to their default setting.
                              </p>
                              <p>For example, execute the following program:</p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.SET_TABLE_PREFS('sh', 'customers', 'publish', null);
  DBMS_STATS.SET_TABLE_PREFS('sh', 'sales', 'publish', null);
END;
/</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="controlling-the-use-of-optimizer-statistics.html#GUID-8FF503A2-5E50-4054-AC3A-5672343BDFE3" title="By default, the database automatically publishes statistics when the statistics collection ends.">Publishing Pending Optimizer Statistics</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
            <div class="sect2"><a id="GUID-87A26DD9-E2C1-41E3-9EF0-D141F44F0968" name="GUID-87A26DD9-E2C1-41E3-9EF0-D141F44F0968"></a><h3 id="TGSQL-GUID-87A26DD9-E2C1-41E3-9EF0-D141F44F0968" class="sect3"><span class="enumeration_section">15.3 </span>Creating Artificial Optimizer Statistics for Testing
               </h3>
               <div>
                  <p>To provide the optimizer with user-created statistics for testing purposes, you can use the <code class="codeph">DBMS_STATS.SET_*_STATS</code> procedures. These procedures provide the optimizer with artificial values for the specified statistics.
                  </p>
                  <p>This section contains the following topics:</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="controlling-the-use-of-optimizer-statistics.html#GUID-634642F2-212C-43F8-AC5F-CE014A5F5C61">About Artificial Optimizer Statistics</a><br>For testing purposes, you can manually create artificial statistics for a table, index, or the system using the <code class="codeph">DBMS_STATS.SET_*_STATS</code> procedures. 
                     </li>
                     <li class="ulchildlink"><a href="controlling-the-use-of-optimizer-statistics.html#GUID-D73DB2F4-46C1-4C5B-94DD-DE1F1DD5BBCC">Setting Artificial Optimizer Statistics for a Table</a><br>This topic explains how to set artificial statistics for a table using <code class="codeph">DBMS_STATS.SET_TABLE_STATS</code>. The basic steps are the same for <code class="codeph">SET_INDEX_STATS</code> and <code class="codeph">SET_SYSTEM_STATS</code>.
                     </li>
                     <li class="ulchildlink"><a href="controlling-the-use-of-optimizer-statistics.html#GUID-8EE82CF3-461E-441B-B143-86DFC08A318B">Setting Optimizer Statistics: Example</a><br>This example shows how to gather optimizer statistics for a table, set artificial statistics, and then compare the plans that the optimizer chooses based on the differing statistics.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="controlling-the-use-of-optimizer-statistics.html#GUID-6D85C813-5FBF-4655-ACE5-1E50DB4F8E60" title="Using DBMS_STATS, you can specify when and how the optimizer uses statistics.">Controlling the Use of Optimizer Statistics</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-634642F2-212C-43F8-AC5F-CE014A5F5C61" name="GUID-634642F2-212C-43F8-AC5F-CE014A5F5C61"></a><h4 id="TGSQL-GUID-634642F2-212C-43F8-AC5F-CE014A5F5C61" class="sect4"><span class="enumeration_section">15.3.1 </span>About Artificial Optimizer Statistics
                  </h4>
                  <div>
                     <p>For testing purposes, you can manually create artificial statistics for a table, index, or the system using the <code class="codeph">DBMS_STATS.SET_*_STATS</code> procedures. 
                     </p>
                     <p>When <code class="codeph">stattab</code> is null, the <code class="codeph">DBMS_STATS.SET_*_STATS</code> procedures insert the artificial statistics into the data dictionary directly. Alternatively, you can specify a user-created table.
                     </p>
                     <div class="infoboxnote" id="GUID-634642F2-212C-43F8-AC5F-CE014A5F5C61__GUID-447F2F1C-09AE-4F19-A30D-C56FCB4E675B">
                        <p class="notep1">Caution:</p>The <code class="codeph">DBMS_STATS.SET_*_STATS</code> procedures are intended for development testing only. Do not use them in a production database. If you set statistics in the data dictionary, then Oracle Database considers the set statistics as the “real” statistics, which means that statistics gathering jobs may not re-gather artificial statistics when they do not meet the criteria for staleness.
                     </div>
                     <p>Typical use cases for the <code class="codeph">DBMS_STATS.SET_*_STATS</code> procedures are:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Showing how execution plans change as the numbers of rows or blocks in a table change</p>
                           <p>For example, <code class="codeph">SET_TABLE_STATS</code> can set number of rows and blocks in a small or empty table to a large number. When you execute a query using the altered statistics, the optimizer may change the execution plan. For example, the increased row count may lead the optimizer to choose an index scan rather than a full table scan. By experimenting with different values, you can see how the optimizer will change its execution plan over time.
                           </p>
                        </li>
                        <li>
                           <p>Creating realistic statistics for temporary tables</p>
                           <p>You may want to see what the optimizer does when a large temporary table is referenced in multiple SQL statements. You can create a regular table, load representative data, and then use <code class="codeph">GET_TABLE_STATS</code> to retrieve the statistics. After you create the temporary table, you can “deceive” the optimizer into using these statistics by invoking <code class="codeph">SET_TABLE_STATS</code>.
                           </p>
                        </li>
                     </ul>
                     <p> Optionally, you can specify a unique ID for statistics in a user-created table. The <code class="codeph">SET_*_STATS</code> procedures have corresponding <code class="codeph">GET_*_STATS</code> procedures.
                     </p>
                     <div class="tblformal" id="GUID-634642F2-212C-43F8-AC5F-CE014A5F5C61__GUID-18BE8E4E-2372-4513-8606-0E2E0E665384">
                        <p class="titleintable">Table 15-3 DBMS_STATS Procedures for Setting Optimizer Statistics</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="DBMS_STATS Procedures for Setting Optimizer Statistics" summary="This table describes DBMS_STATS procedures that set artificial optimizer statistics." frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="20%" id="d86157e2080">DBMS_STATS Procedure</th>
                                 <th align="left" valign="bottom" width="20%" id="d86157e2082">Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d86157e2086" headers="d86157e2080 "><code class="codeph">SET_TABLE_STATS</code></td>
                                 <td align="left" valign="top" width="20%" headers="d86157e2086 d86157e2082 ">Sets table or partition statistics using parameters such as <code class="codeph">numrows</code>, <code class="codeph">numblks</code>, and <code class="codeph">avgrlen</code>.
                                    <p>If the database uses the In-Memory Column store, you can set <code class="codeph">im_imcu_count</code> to the number of IMCUs in the table or partition, and <code class="codeph">im_block_count</code> to the number of blocks in the table or partition. For an external table, <code class="codeph">scanrate</code> specifies the rate at which data is scanned in MB/second.
                                    </p>
                                    <p>The optimizer uses the cached data to estimate the number of cached blocks for index or statistics table access. The total cost is the I/O cost of reading data blocks from disk, the CPU cost of reading cached blocks from the buffer cache, and the CPU cost of processing the data.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d86157e2114" headers="d86157e2080 "><code class="codeph">SET_COLUMN_STATS</code></td>
                                 <td align="left" valign="top" width="20%" headers="d86157e2114 d86157e2082 ">Sets column statistics using parameters such as <code class="codeph">distcnt</code>, <code class="codeph">density</code>, <code class="codeph">nullcnt</code>, and so on.
                                    <p>In the version of this procedure that deals with user-defined statistics, use <code class="codeph">stattypname</code> to specify the type of statistics to store in the data dictionary.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d86157e2134" headers="d86157e2080 "><code class="codeph">SET_SYSTEM_STATS</code></td>
                                 <td align="left" valign="top" width="20%" headers="d86157e2134 d86157e2082 ">Sets system statistics using parameters such as <code class="codeph">iotfrspeed</code>, <code class="codeph">sreadtim</code>, and <code class="codeph">cpuspeed</code>.
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d86157e2149" headers="d86157e2080 "><code class="codeph">SET_INDEX_STATS</code></td>
                                 <td align="left" valign="top" width="20%" headers="d86157e2149 d86157e2082 ">Sets index statistics using parameters such as <code class="codeph">numrows</code>, <code class="codeph">numlblks</code>, <code class="codeph">avglblk</code>, <code class="codeph">clstfct</code>, and <code class="codeph">indlevel</code>.
                                    <p>In the version of this procedure that deals with user-defined statistics, use <code class="codeph">stattypname</code> to specify the type of statistics to store in the data dictionary.
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-634642F2-212C-43F8-AC5F-CE014A5F5C61__GUID-2A1CFADE-0412-4887-AC18-16AC0D0AEE56">
                        <p class="notep1">See Also:</p>
                        <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-F993ADFE-85A9-4939-84D1-CC7A6E5C56D2" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about <code class="codeph">DBMS_STATS.SET_TABLE_STATS</code> and the other procedures for setting optimizer statistics
                        </p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="controlling-the-use-of-optimizer-statistics.html#GUID-87A26DD9-E2C1-41E3-9EF0-D141F44F0968" title="To provide the optimizer with user-created statistics for testing purposes, you can use the DBMS_STATS.SET_*_STATS procedures. These procedures provide the optimizer with artificial values for the specified statistics.">Creating Artificial Optimizer Statistics for Testing</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-D73DB2F4-46C1-4C5B-94DD-DE1F1DD5BBCC" name="GUID-D73DB2F4-46C1-4C5B-94DD-DE1F1DD5BBCC"></a><h4 id="TGSQL-GUID-D73DB2F4-46C1-4C5B-94DD-DE1F1DD5BBCC" class="sect4"><span class="enumeration_section">15.3.2 </span>Setting Artificial Optimizer Statistics for a Table
                  </h4>
                  <div>
                     <p>This topic explains how to set artificial statistics for a table using <code class="codeph">DBMS_STATS.SET_TABLE_STATS</code>. The basic steps are the same for <code class="codeph">SET_INDEX_STATS</code> and <code class="codeph">SET_SYSTEM_STATS</code>.
                     </p>
                     <div class="p">Note the following task prerequisites:
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>For an object not owned by <code class="codeph">SYS</code>, you must be the owner of the object, or have the <code class="codeph">ANALYZE ANY</code> privilege.
                              </p>
                           </li>
                           <li>
                              <p> For an object owned by <code class="codeph">SYS</code>, you must have the <code class="codeph">ANALYZE ANY DICTIONARY</code> privilege or the <code class="codeph">SYSDBA</code> privilege.
                              </p>
                           </li>
                           <li>
                              <p>When invoking <code class="codeph">GET_*_STATS</code> for a table, column, or index, the referenced object must exist.
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="p">This task assumes the following:
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>You have the required privileges to use <code class="codeph">DBMS_STATS.SET_TABLE_STATS</code> for the specified table.
                              </p>
                           </li>
                           <li>
                              <p>You intend to store the statistics in the data dictionary.</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>In SQL*Plus, log in to the database as a user with the required privileges.</span></li>
                        <li class="stepexpand"><span>Run the <code class="codeph">DBMS_STATS.SET_TABLE_STATS</code> procedure, specifying the appropriate parameters for the statistics.</span><div>Typical parameters include the following:
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><code class="codeph">ownname</code> (not null)
                                    </p>
                                    <p>This parameter specifies the name of the schema containing the table.</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">tabname</code> (not null)
                                    </p>
                                    <p>This parameter specifies the name of the table whose statistics you intend to set.</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">partname</code></p>
                                    <p>This parameter specifies the name of a partition of the table.</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">numrows</code></p>
                                    <p>This parameter specifies the number of rows in the table.</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">numblks</code></p>
                                    <p>This parameter specifies the number of blocks in the table.</p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Query the table.</span></li>
                        <li class="stepexpand"><span>Optionally, to determine how the statistics affected the optimizer, query the execution plan.</span></li>
                        <li class="stepexpand"><span>Optionally, to perform further testing, return to Step 2 and reset the optimizer statistics.</span></li>
                     </ol>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="controlling-the-use-of-optimizer-statistics.html#GUID-87A26DD9-E2C1-41E3-9EF0-D141F44F0968" title="To provide the optimizer with user-created statistics for testing purposes, you can use the DBMS_STATS.SET_*_STATS procedures. These procedures provide the optimizer with artificial values for the specified statistics.">Creating Artificial Optimizer Statistics for Testing</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-8EE82CF3-461E-441B-B143-86DFC08A318B" name="GUID-8EE82CF3-461E-441B-B143-86DFC08A318B"></a><h4 id="TGSQL-GUID-8EE82CF3-461E-441B-B143-86DFC08A318B" class="sect4"><span class="enumeration_section">15.3.3 </span>Setting Optimizer Statistics: Example
                  </h4>
                  <div>
                     <p>This example shows how to gather optimizer statistics for a table, set artificial statistics, and then compare the plans that the optimizer chooses based on the differing statistics.</p>
                     <div class="section">This example assumes:
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>You are logged in to the database as a user with DBA privileges.</p>
                           </li>
                           <li>
                              <p>You want to test when the optimizer chooses an index scan.</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-8EE82CF3-461E-441B-B143-86DFC08A318B__GUID-158E0C68-A2AD-48A4-8E32-3AA23746A876">
                        <ol>
                           <li>
                              <p>Create a table called <code class="codeph">contractors</code>, and index the <code class="codeph">salary</code> column.
                              </p><pre class="pre codeblock"><code>CREATE TABLE contractors (
  con_id    NUMBER,
  last_name VARCHAR2(50),
  salary    NUMBER,
  CONSTRAINT cond_id_pk PRIMARY KEY(con_id) );

CREATE INDEX salary_ix ON contractors(salary);</code></pre></li>
                           <li>
                              <p>Insert a single row into this table.</p><pre class="pre codeblock"><code>INSERT INTO contractors VALUES (8, 'JONES',1000);
COMMIT;</code></pre></li>
                           <li>
                              <p>Gather statistics for the table.</p><pre class="pre codeblock"><code>EXECUTE DBMS_STATS.GATHER_TABLE_STATS( user, tabname =&gt; 'CONTRACTORS' );
</code></pre></li>
                           <li>
                              <p>Query the number of rows for the table and index (sample output included):</p><pre class="pre codeblock"><code>SQL&gt; SELECT NUM_ROWS FROM USER_TABLES WHERE TABLE_NAME = 'CONTRACTORS'; 

  NUM_ROWS
----------
         1

SQL&gt; SELECT NUM_ROWS FROM USER_INDEXES WHERE INDEX_NAME =  'SALARY_IX'; 

  NUM_ROWS
----------
         1
</code></pre></li>
                           <li>
                              <p>Query contractors whose salary is 1000, using the <code class="codeph">dynamic_sampling</code> hint to disable dynamic sampling:
                              </p><pre class="pre codeblock"><code>SELECT /*+ dynamic_sampling(contractors 0) */ * 
FROM   contractors 
WHERE  salary = 1000;
</code></pre></li>
                           <li>
                              <p>Query the execution plan chosen by the optimizer (sample output included):</p><pre class="pre codeblock"><code>SQL&gt; SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR);

SQL_ID	cy0wzytc16g9n, child number 0
-------------------------------------
SELECT /*+ dynamic_sampling(contractors 0) */ * FROM contractors WHERE
salary = 1000

Plan hash value: 5038823

----------------------------------------------------------------------
| Id  | Operation         | Name        |Rows|Bytes|Cost (%CPU)| Time|
----------------------------------------------------------------------
|   0 | SELECT STATEMENT  |             |   |    | 2 (100)|          |
|*  1 |  TABLE ACCESS FULL| CONTRACTORS | 1 | 12 | 2   (0)| 00:00:01 |
----------------------------------------------------------------------

Predicate Information (identified by operation id):
---------------------------------------------------

   1 - filter("SALARY"=1000)

19 rows selected.
</code></pre><p>Because only 1 row exists in the table, the optimizer chooses a full table scan over an index range scan.</p>
                           </li>
                           <li>
                              <p>Use <code class="codeph">SET_TABLE_STATS</code> and <code class="codeph">SET_INDEX_STATS</code> to simulate statistics for a table with 2000 rows stored in 10 data blocks:
                              </p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.SET_TABLE_STATS( 
    ownname =&gt; user
  , tabname =&gt; 'CONTRACTORS'
  , numrows =&gt; 2000
  , numblks =&gt; 10 );
END;
/

BEGIN 
  DBMS_STATS.SET_INDEX_STATS( 
    ownname =&gt; user
  , indname =&gt; 'SALARY_IX'
  , numrows =&gt; 2000 );
END;
/</code></pre></li>
                           <li>
                              <p>Query the number of rows for the table and index (sample output included):</p><pre class="pre codeblock"><code>SQL&gt; SELECT NUM_ROWS FROM USER_TABLES WHERE TABLE_NAME = 'CONTRACTORS'; 

  NUM_ROWS
----------
      2000

SQL&gt; SELECT NUM_ROWS FROM USER_INDEXES WHERE INDEX_NAME =  'SALARY_IX'; 

  NUM_ROWS
----------
      2000
</code></pre><p>Now the optimizer believes that the table contains 2000 rows in 10 blocks, even though only 1 row actually exists in one block.</p>
                           </li>
                           <li>
                              <p>Flush the shared pool to eliminate possibility of plan reuse, and then execute the same query of <code class="codeph">contractors</code>:
                              </p><pre class="pre codeblock"><code>ALTER SYSTEM FLUSH SHARED_POOL;

SELECT /*+ dynamic_sampling(contractors 0) */ * 
FROM   contractors 
WHERE  salary = 1000;
</code></pre></li>
                           <li>
                              <p>Query the execution plan chosen by the optimizer based on the artificial statistics (sample output included):</p><pre class="pre codeblock"><code>SQL&gt; SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR);

SQL_ID	cy0wzytc16g9n, child number 0
-------------------------------------
SELECT /*+ dynamic_sampling(contractors 0) */ * FROM contractors WHERE
salary = 1000

Plan hash value: 996794789

---------------------------------------------------------------------------------
|Id| Operation                           | Name      |Rows|Bytes|Cost(%CPU)|Time|
---------------------------------------------------------------------------------
| 0| SELECT STATEMENT                    |           |    |     |3(100)|        |
| 1|  TABLE ACCESS BY INDEX ROWID BATCHED|CONTRACTORS|2000|24000|3 (34)|00:00:01|
|*2|   INDEX RANGE SCAN                  |SALARY_IX  |2000|     |1  (0)|00:00:01|
---------------------------------------------------------------------------------

Predicate Information (identified by operation id):
---------------------------------------------------

   2 - access("SALARY"=1000)

20 rows selected.
</code></pre><p>Based on the artificially generated statistics for the number of rows and block distribution, the optimizer considers an index range scan more cost-effective.</p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="controlling-the-use-of-optimizer-statistics.html#GUID-87A26DD9-E2C1-41E3-9EF0-D141F44F0968" title="To provide the optimizer with user-created statistics for testing purposes, you can use the DBMS_STATS.SET_*_STATS procedures. These procedures provide the optimizer with artificial values for the specified statistics.">Creating Artificial Optimizer Statistics for Testing</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>