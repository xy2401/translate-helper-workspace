<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="Using the DBMS_METADATA APIs.">
      <meta name="description" content="Using the DBMS_METADATA APIs.">
      <title>Using the Metadata APIs</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Utilities ">
      <meta property="og:description" content="Using the DBMS_METADATA APIs.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Utilities">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="database-utilities.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-04-23T19:07:17-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="2002, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96081-02">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="oracle-logminer-utility.html" title="Previous" type="text/html">
      <link rel="next" href="oracle-original-export-utility.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Utilities">
    <meta name="dcterms.isVersionOf" content="SUTIL">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="oracle-logminer-utility.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="oracle-original-export-utility.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Utilities </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="other-oracle-utilities.html" property="item" typeof="WebPage"><span property="name"> Other Utilities</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">  Using the Metadata APIs</li>
            </ol>
            <a id="GUID-D9B1300F-B21D-416E-8B9B-C542195EF249" name="GUID-D9B1300F-B21D-416E-8B9B-C542195EF249"></a><a id="SUTIL015"></a>
            
            <h2 id="SUTIL-GUID-D9B1300F-B21D-416E-8B9B-C542195EF249" class="sect2"><span class="enumeration_chapter">23 </span>  Using the Metadata APIs
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>Using the <code class="codeph">DBMS_METADATA</code> APIs.
               </p>
               <p>The <code class="codeph">DBMS_METADATA</code> API enables you to do the following:
               </p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p>Retrieve an object's metadata as XML</p>
                  </li>
                  <li>
                     <p>Transform the XML in a variety of ways, including transforming it into SQL DDL</p>
                  </li>
                  <li>
                     <p>Submit the XML to re-create the object extracted by the retrieval</p>
                  </li>
               </ul>
               <p>The <code class="codeph">DBMS_METADATA_DIFF</code> API lets you compare objects between databases to identify metadata changes over time in objects of the same type.
               </p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="using-oracle-dbms_metadata-api.html#GUID-EFF19735-0C94-46CD-B1CB-123FEB390B43">Why Use the DBMS_METADATA API?</a><br>The <code class="codeph">DBMS_METADATA</code> API eliminates the need for you to write and maintain your own code for metadata extraction. 
                  </li>
                  <li class="ulchildlink"><a href="using-oracle-dbms_metadata-api.html#GUID-FF65F378-97BB-459A-A9C2-E0B105205D3D">Overview of the DBMS_METADATA API</a><br>Overview of the <code class="codeph">DBMS_METADATA</code> API.
                  </li>
                  <li class="ulchildlink"><a href="using-oracle-dbms_metadata-api.html#GUID-EE2AA635-EA83-4265-9727-E9C659842CEF">Using the DBMS_METADATA API to Retrieve an Object's Metadata</a><br>The retrieval interface of the <code class="codeph">DBMS_METADATA</code> API lets you specify the kind of object to be retrieved. 
                  </li>
                  <li class="ulchildlink"><a href="using-oracle-dbms_metadata-api.html#GUID-1DA999FD-1AFD-4D8D-A6D0-8EEB84E0D9E4">Using the DBMS_METADATA API to Re-Create a Retrieved Object</a><br>When you fetch metadata for an object, you may want to use it to re-create the object in a different database or schema.
                  </li>
                  <li class="ulchildlink"><a href="using-oracle-dbms_metadata-api.html#GUID-85AC0B9A-5C6E-4D2A-A3CA-30F5F7884048">Using the DBMS_METADATA API to Retrieve Collections of Different Object Types</a><br>Description and example of retrieving collections of different object types.
                  </li>
                  <li class="ulchildlink"><a href="using-oracle-dbms_metadata-api.html#GUID-E9A778A7-2E9D-4240-8707-A52FF65556FE">Using the DBMS_METADATA_DIFF API to Compare Object Metadata</a><br> Description and example that uses the retrieval, comparison, and submit interfaces of <code class="codeph">DBMS_METADATA</code> and <code class="codeph">DBMS_METADATA_DIFF</code> to fetch metadata for two tables, compare the metadata, and generate <code class="codeph">ALTER</code> statements which make one table like the other. 
                  </li>
                  <li class="ulchildlink"><a href="using-oracle-dbms_metadata-api.html#GUID-DF431094-5F1D-478D-87E6-04CC774B761F">Performance Tips for the Programmatic Interface of the DBMS_METADATA API</a><br> Describes how to enhance performance when using the programmatic interface of the <code class="codeph">DBMS_METADATA</code> API.
                  </li>
                  <li class="ulchildlink"><a href="using-oracle-dbms_metadata-api.html#GUID-89237236-4729-4E33-842D-D124A3C15B10">Example Usage of the DBMS_METADATA API</a><br>Example of how the <code class="codeph">DBMS_METADATA</code> API could be used. 
                  </li>
                  <li class="ulchildlink"><a href="using-oracle-dbms_metadata-api.html#GUID-B19C59EB-A9BC-4D1E-BD8C-135583D403CD">Summary of DBMS_METADATA Procedures</a><br>Provides brief descriptions of the procedures provided by the <code class="codeph">DBMS_METADATA</code> API. 
                  </li>
                  <li class="ulchildlink"><a href="using-oracle-dbms_metadata-api.html#GUID-CB5F314F-7412-40F1-B71C-8F6DFB45A4D8">Summary of DBMS_METADATA_DIFF Procedures</a><br> Provides brief descriptions of the procedures and functions provided by the <code class="codeph">DBMS_METADATA_DIFF</code> API. 
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>Parent topic:</strong> <a href="other-oracle-utilities.html#GUID-FCEA49BD-D3AF-4337-88F1-3A23545F35A6">Other Utilities</a></p>
                  </div>
               </div>
            </div>
            <a id="SUTIL1622"></a><div class="props_rev_3"><a id="GUID-EFF19735-0C94-46CD-B1CB-123FEB390B43" name="GUID-EFF19735-0C94-46CD-B1CB-123FEB390B43"></a><h3 id="SUTIL-GUID-EFF19735-0C94-46CD-B1CB-123FEB390B43" class="sect3"><span class="enumeration_section">23.1 </span>Why Use the DBMS_METADATA API?
               </h3>
               <div>
                  <p>The <code class="codeph">DBMS_METADATA</code> API eliminates the need for you to write and maintain your own code for metadata extraction. 
                  </p>
                  <p>Over time, as you have used the Oracle database, you may have developed your own code for extracting metadata from the dictionary, manipulating the metadata (adding columns, changing column data types, and so on) and then converting the metadata to DDL so that you could re-create the object on the same or another database. Keeping that code updated to support new dictionary features has probably proven to be challenging. </p>
                  <p>It provides a centralized facility for the extraction, manipulation, and re-creation of dictionary metadata. And it supports all dictionary objects at their most current level. </p>
                  <p>Although the <code class="codeph">DBMS_METADATA</code> API can dramatically decrease the amount of custom code you are writing and maintaining, it does not involve any changes to your normal database procedures. The <code class="codeph">DBMS_METADATA</code> API is installed in the same way as data dictionary views, by running <code class="codeph">catproc</code>.<code class="codeph">sql</code> to run a SQL script at database installation time. Once it is installed, it is available whenever the instance is operational, even in restricted mode.
                  </p>
                  <p>The <code class="codeph">DBMS_METADATA</code> API does not require you to make any source code changes when you change database releases because it is upwardly compatible across different Oracle releases. XML documents retrieved by one release can be processed by the submit interface on the same or later release. For example, XML documents retrieved by an Oracle9<span class="italic">i</span> database can be submitted to Oracle Database 10<span class="italic">g.</span></p>
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-oracle-dbms_metadata-api.html#GUID-D9B1300F-B21D-416E-8B9B-C542195EF249" title="Using the DBMS_METADATA APIs.">Using the Metadata APIs</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="SUTIL1623"></a><div class="props_rev_3"><a id="GUID-FF65F378-97BB-459A-A9C2-E0B105205D3D" name="GUID-FF65F378-97BB-459A-A9C2-E0B105205D3D"></a><h3 id="SUTIL-GUID-FF65F378-97BB-459A-A9C2-E0B105205D3D" class="sect3"><span class="enumeration_section">23.2 </span>Overview of the DBMS_METADATA API
               </h3>
               <div>
                  <p>Overview of the <code class="codeph">DBMS_METADATA</code> API.
                  </p>
                  <p>For the purposes of the <code class="codeph">DBMS_METADATA</code> API, every entity in the database is modeled as an object that belongs to an object type. For example, the table <code class="codeph">scott.emp</code> is an object and its object type is <code class="codeph">TABLE</code>. When you fetch an object's metadata you must specify the object type.
                  </p>
                  <p>To fetch a particular object or set of objects within an object type, you specify a filter. Different filters are defined for each object type. For example, two of the filters defined for the <code class="codeph">TABLE</code> object type are <code class="codeph">SCHEMA</code> and <code class="codeph">NAME</code>. They allow you to say, for example, that you want the table whose schema is <code class="codeph">scott</code> and whose name is <code class="codeph">emp</code>. 
                  </p>
                  <p>The <code class="codeph">DBMS_METADATA</code> API makes use of XML (Extensible Markup Language) and XSLT (Extensible Stylesheet Language Transformation). The <code class="codeph">DBMS_METADATA</code> API represents object metadata as XML because it is a universal format that can be easily parsed and transformed. The <code class="codeph">DBMS_METADATA</code> API uses XSLT to transform XML documents into either other XML documents or into SQL DDL.
                  </p>
                  <p>You can use the <code class="codeph">DBMS_METADATA</code> API to specify one or more transforms (XSLT scripts) to be applied to the XML when the metadata is fetched (or when it is resubmitted). The API provides some predefined transforms, including one named DDL that transforms the XML document into SQL creation DDL.
                  </p>
                  <p>You can then specify conditions on the transform by using transform parameters. You can also specify optional parse items to access specific attributes of an object's metadata. </p>
                  <p>For more details about all of these options and examples of their implementation, see the following sections:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="using-oracle-dbms_metadata-api.html#GUID-EE2AA635-EA83-4265-9727-E9C659842CEF" title="The retrieval interface of the DBMS_METADATA API lets you specify the kind of object to be retrieved.">Using the DBMS_METADATA API to Retrieve an Object's Metadata</a></p>
                     </li>
                     <li>
                        <p><a href="using-oracle-dbms_metadata-api.html#GUID-1DA999FD-1AFD-4D8D-A6D0-8EEB84E0D9E4" title="When you fetch metadata for an object, you may want to use it to re-create the object in a different database or schema.">Using the DBMS_METADATA API to Re-Create a Retrieved Object</a></p>
                     </li>
                     <li>
                        <p><a href="using-oracle-dbms_metadata-api.html#GUID-85AC0B9A-5C6E-4D2A-A3CA-30F5F7884048" title="Description and example of retrieving collections of different object types.">Using the DBMS_METADATA API to Retrieve Collections of Different Object Types</a></p>
                     </li>
                  </ul>
                  <div class="section">
                     <p class="subhead2" id="GUID-FF65F378-97BB-459A-A9C2-E0B105205D3D__GUID-28A33334-67A1-4031-8E24-FBB7A8892347">Using Views to Determine Valid DBMS_METADATA Options</p>
                     <p>You can use the following views to determine which <code class="codeph">DBMS_METADATA</code> transforms are allowed for each object type transformation, the parameters for each transform, and their parse items.
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="../refrn/DBMS_METADATA_TRANSFORMS.html#REFRN-GUID-486B1381-AA5B-4F00-B770-3244119D6C05" target="_blank">DBMS_METADATA_TRANSFORMS</a> - documents all valid Oracle-supplied transforms that are used with the <code class="codeph">DBMS_METADATA</code> package.
                           </p>
                        </li>
                        <li>
                           <p><a href="../refrn/DBMS_METADATA_TRANSFORM_PARAMS.html#REFRN-GUID-A042CD61-3AF5-4F11-BABB-4743486A3B88" target="_blank">DBMS_METADATA_TRANSFORM_PARAMS</a> - documents the valid transform parameters for each transform.
                           </p>
                        </li>
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sutil&amp;id=REFRN-GUID-2A2D4764-3DB6-4F1E-9D3A-2BF301BC577C" target="_blank">DBMS_METADATA_PARSE_ITEMS</a>- documents the valid parse items.
                           </p>
                        </li>
                     </ul>
                     <p>For example, suppose you want to know which transforms are allowed for <code class="codeph">INDEX</code> objects. The following query returns the transforms that are valid for <code class="codeph">INDEX</code> objects, the required input types, and the resulting output types:
                     </p><pre class="pre codeblock"><code>SQL&gt; SELECT transform, output_type, input_type, description
2 FROM dbms_metadata_transforms
3 WHERE object_type='INDEX';


TRANSFORM  OUTPUT_TYP INPUT_TYPE           DESCRIPTION
---------- ---------- -------------------- ----------------------------------------------------------------------
ALTERXML   ALTER_XML  SXML difference doc  Generate ALTER_XML from SXML difference document
SXMLDDL    DDL        SXML                 Convert SXML to DDL
MODIFY     XML        XML                  Modify XML document according to transform parameters
SXML       SXML       XML                  Convert XML to SXML
DDL        DDL        XML                  Convert XML to SQL to create the object
ALTERDDL   ALTER_DDL  ALTER_XML            Convert ALTER_XML to ALTER_DDL
MODIFYSXML SXML       SXML                 Modify SXML document
</code></pre><p>You might then want to know which transform parameters are valid for the DDL transform: </p><pre class="pre codeblock"><code>SQL&gt; SELECT param, datatype, default_val, description
2 FROM dbms_metadata_transform_params
3 WHERE object_type='INDEX' and transform='DDL'
4 ORDER BY param;


PARAM                     DATATYPE   DEFAULT_VA  DESCRIPTION
------------------------- ---------- ----------  ----------------------------------------------------------------------
INCLUDE_PARTITIONS        TEXT                   Include generated interval and list partitions in DDL 
                                                      transformation
INDEX_COMPRESSION_CLAUSE  TEXT       ""          Text of user-specified index compression clause
PARTITIONING              BOOLEAN    TRUE        Include partitioning clauses in transformation
PARTITION_NAME            TEXT       ""          Name of partition selected for the transformation
PCTSPACE                  NUMBER     ""          Percentage by which space allocation is to be modified
SEGMENT_ATTRIBUTES        BOOLEAN    TRUE        Include segment attribute clauses (physical attributes, storage 
                                                      attribues, tablespace, logging) in transformation
STORAGE                   BOOLEAN    TRUE        Include storage clauses in transformation
SUBPARTITION_NAME         TEXT       ""          Name of subpartition selected for the transformation
TABLESPACE                BOOLEAN    TRUE        Include tablespace clauses in transformation</code></pre><p>You can also perform the following query which returns specific metadata about the <code class="codeph">INDEX</code> object type::
                     </p><pre class="pre codeblock"><code>SQL&gt; SELECT parse_item, description 
2 FROM dbms_metadata_parse_items 
3 WHERE object_type='INDEX' and convert='Y';

PARSE_ITEM           DESCRIPTION
-------------------- --------------------------------------------------------------
OBJECT_TYPE          Object type
TABLESPACE           Object tablespace (default tablespace for partitioned objects)
BASE_OBJECT_SCHEMA   Schema of the base object
SCHEMA               Object schema, if any
NAME                 Object name
BASE_OBJECT_NAME     Name of the base object
BASE_OBJECT_TYPE     Object type of the base object
SYSTEM_GENERATED     Y = system-generated object; N = not system-generated</code></pre></div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-oracle-dbms_metadata-api.html#GUID-D9B1300F-B21D-416E-8B9B-C542195EF249" title="Using the DBMS_METADATA APIs.">Using the Metadata APIs</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="SUTIL1624"></a><div class="props_rev_3"><a id="GUID-EE2AA635-EA83-4265-9727-E9C659842CEF" name="GUID-EE2AA635-EA83-4265-9727-E9C659842CEF"></a><h3 id="SUTIL-GUID-EE2AA635-EA83-4265-9727-E9C659842CEF" class="sect3"><span class="enumeration_section">23.3 </span>Using the DBMS_METADATA API to Retrieve an Object's Metadata
               </h3>
               <div>
                  <p>The retrieval interface of the <code class="codeph">DBMS_METADATA</code> API lets you specify the kind of object to be retrieved. 
                  </p>
                  <p>This can be either a particular object type (such as a table, index, or procedure) or a heterogeneous collection of object types that form a logical unit (such as a database export or schema export). By default, metadata that you fetch is returned in an XML document.</p>
                  <div class="infoboxnote" id="GUID-EE2AA635-EA83-4265-9727-E9C659842CEF__GUID-C43193A5-98F0-4C5B-A946-C14502066969">
                     <p class="notep1">Note:</p>
                     <p>To access objects that are not in your own schema you must have the <code class="codeph">SELECT_CATALOG_ROLE</code> role. However, roles are disabled within many PL/SQL objects (stored procedures, functions, definer's rights APIs). Therefore, if you are writing a PL/SQL program that will access objects in another schema (or, in general, any objects for which you need the <code class="codeph">SELECT_CATALOG_ROLE</code> role), then you must put the code in an invoker's rights API.
                     </p>
                  </div>
                  <p>You can use the programmatic interface for casual browsing, or you can use it to develop applications. You would use the browsing interface if you simply wanted to make ad hoc queries of the system metadata. You would use the programmatic interface when you want to extract dictionary metadata as part of an application. In such cases, the procedures provided by the <code class="codeph">DBMS_METADATA</code> API can be used in place of SQL scripts and customized code that you may be currently using to do the same thing.
                  </p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="using-oracle-dbms_metadata-api.html#GUID-FBCB0C17-4B6A-4BC9-9F01-86015FA0F1C3">Typical Steps Used for Basic Metadata Retrieval</a><br>When you retrieve metadata, you use the <code class="codeph">DBMS_METADATA</code> PL/SQL API. 
                     </li>
                     <li class="ulchildlink"><a href="using-oracle-dbms_metadata-api.html#GUID-68EB7622-137B-46CC-AE50-75972582092E">Retrieving Multiple Objects</a><br>Description and example of retrieving multiple objects.
                     </li>
                     <li class="ulchildlink"><a href="using-oracle-dbms_metadata-api.html#GUID-27965831-A88D-4723-8402-F31DC9839B71">Placing Conditions on Transforms</a><br>You can use transform parameters to specify conditions on the transforms that you add. 
                     </li>
                     <li class="ulchildlink"><a href="using-oracle-dbms_metadata-api.html#GUID-BB45CA8D-2621-419B-906C-1E811499786A">Accessing Specific Metadata Attributes</a><br>Description and example of accessing specific metadata attributes.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-oracle-dbms_metadata-api.html#GUID-D9B1300F-B21D-416E-8B9B-C542195EF249" title="Using the DBMS_METADATA APIs.">Using the Metadata APIs</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="props_rev_2"><a id="GUID-FBCB0C17-4B6A-4BC9-9F01-86015FA0F1C3" name="GUID-FBCB0C17-4B6A-4BC9-9F01-86015FA0F1C3"></a><h4 id="SUTIL-GUID-FBCB0C17-4B6A-4BC9-9F01-86015FA0F1C3" class="sect4"><span class="enumeration_section">23.3.1 </span>Typical Steps Used for Basic Metadata Retrieval
                  </h4>
                  <div>
                     <p>When you retrieve metadata, you use the <code class="codeph">DBMS_METADATA</code> PL/SQL API. 
                     </p>
                     <div class="section">
                        <p>The following examples illustrate the programmatic and browsing interfaces.</p>
                        <p>The <code class="codeph">DBMS_METADATA</code> programmatic interface example provides a basic demonstration of using the <code class="codeph">DBMS_METADATA</code> programmatic interface to retrieve metadata for one table. It creates a <code class="codeph">DBMS_METADATA</code> program that creates a function named <code class="codeph">get_table_md</code>. This function returns metadata for one table.
                        </p>
                        <p>The <code class="codeph">DBMS_METADATA</code> browsing interface example demonstrates how you can use the browsing interface to obtain the same results. 
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-FBCB0C17-4B6A-4BC9-9F01-86015FA0F1C3__GUID-99E54742-0197-4C53-A4B0-6D23486B3ED1">
                        <p class="titleinexample">Example 23-1 Using the DBMS_METADATA Programmatic Interface to Retrieve Data </p>
                        <ol>
                           <li>
                              <p>Create a <code class="codeph">DBMS_METADATA</code> program that creates a function named <code class="codeph">get_table_md</code>, which will return the metadata for one table, <code class="codeph">timecards</code>, in the <code class="codeph">hr</code> schema. The content of such a program looks as follows. (For this example, name the program <code class="codeph">metadata_program</code>.<code class="codeph">sql</code>.)
                              </p><pre class="oac_no_warn" dir="ltr">CREATE OR REPLACE FUNCTION get_table_md RETURN CLOB IS
-- Define local variables.
h NUMBER; --handle returned by OPEN
th NUMBER; -- handle returned by ADD_TRANSFORM
doc CLOB;
BEGIN

-- Specify the object type.
h := DBMS_METADATA.OPEN('TABLE');

-- Use filters to specify the particular object desired.
DBMS_METADATA.SET_FILTER(h,'SCHEMA','HR');
DBMS_METADATA.SET_FILTER(h,'NAME','TIMECARDS');

 -- Request that the metadata be transformed into creation DDL.
th := DBMS_METADATA.ADD_TRANSFORM(h,'DDL');

 -- Fetch the object.
doc := DBMS_METADATA.FETCH_CLOB(h);

 -- Release resources.
DBMS_METADATA.CLOSE(h);
RETURN doc;
END;
/ 
</pre></li>
                           <li>
                              <p>Connect as user <code class="codeph">hr</code>.
                              </p>
                           </li>
                           <li>
                              <p>Run the program to create the <code class="codeph">get_table_md</code> function:
                              </p>
                              <p><code class="codeph">SQL&gt; @metadata_program</code></p>
                           </li>
                           <li>
                              <p>Use the newly created <code class="codeph">get_table_md</code> function in a select operation. To generate complete, uninterrupted output, set the <code class="codeph">PAGESIZE</code> to 0 and set <code class="codeph">LONG</code> to some large number, as shown, before executing your query:
                              </p><pre class="oac_no_warn" dir="ltr">SQL&gt; SET PAGESIZE 0
SQL&gt; SET LONG 1000000
SQL&gt; SELECT get_table_md FROM dual;
</pre></li>
                           <li>
                              <p>The output, which shows the metadata for the <code class="codeph">timecards</code> table in the <code class="codeph">hr</code> schema, looks similar to the following:
                              </p><pre class="oac_no_warn" dir="ltr">  CREATE TABLE "HR"."TIMECARDS"
   (    "EMPLOYEE_ID" NUMBER(6,0),
        "WEEK" NUMBER(2,0),
        "JOB_ID" VARCHAR2(10),
        "HOURS_WORKED" NUMBER(4,2),
         FOREIGN KEY ("EMPLOYEE_ID")
          REFERENCES "HR"."EMPLOYEES" ("EMPLOYEE_ID") ENABLE
   ) PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT)
  TABLESPACE "EXAMPLE"
</pre></li>
                        </ol>
                     </div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-FBCB0C17-4B6A-4BC9-9F01-86015FA0F1C3__GUID-F2DE8330-4777-4AD8-B129-EA25E8E24012">
                        <p class="titleinexample">Example 23-2 Using the DBMS_METADATA Browsing Interface to Retrieve Data</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SET PAGESIZE 0
SQL&gt; SET LONG 1000000
SQL&gt; SELECT DBMS_METADATA.GET_DDL('TABLE','TIMECARDS','HR') FROM dual;
</pre><p>The results of this query are same as shown in step 5 in the <code class="codeph">DBMS_METADATA</code> programmatic interface example.
                        </p>
                     </div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="using-oracle-dbms_metadata-api.html#GUID-EE2AA635-EA83-4265-9727-E9C659842CEF" title="The retrieval interface of the DBMS_METADATA API lets you specify the kind of object to be retrieved.">Using the DBMS_METADATA API to Retrieve an Object's Metadata</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="SUTIL3620"></a><a id="SUTIL1626"></a><div class="props_rev_3"><a id="GUID-68EB7622-137B-46CC-AE50-75972582092E" name="GUID-68EB7622-137B-46CC-AE50-75972582092E"></a><h4 id="SUTIL-GUID-68EB7622-137B-46CC-AE50-75972582092E" class="sect4"><span class="enumeration_section">23.3.2 </span>Retrieving Multiple Objects
                  </h4>
                  <div>
                     <p>Description and example of retrieving multiple objects.</p>
                     <div class="section">
                        <p>In the previous example “Using the <code class="codeph">DBMS_METADATA</code> Programmatic Interface to Retrieve Data,” the <code class="codeph">FETCH_CLOB</code> procedure was called only once, because it was known that there was only one object. However, you can also retrieve multiple objects, for example, all the tables in schema <code class="codeph">scott</code>. To do this, you need to use the following construct:
                        </p><pre class="oac_no_warn" dir="ltr">  LOOP
    doc := DBMS_METADATA.FETCH_CLOB(h);
    --
    -- When there are no more objects to be retrieved, FETCH_CLOB returns NULL.
    --
    EXIT WHEN doc IS NULL;
  END LOOP;
</pre><p>The following example demonstrates use of this construct and retrieving multiple objects. Connect as user <code class="codeph">scott</code> for this example. The password is <code class="codeph">tiger</code>.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-68EB7622-137B-46CC-AE50-75972582092E__I1014062">
                        <p class="titleinexample">Example 23-3 Retrieving Multiple Objects</p>
                        <ol>
                           <li>
                              <p>Create a table named <code class="codeph">my_metadata</code> and a procedure named <code class="codeph">get_tables_md</code>, as follows. Because not all objects can be returned, they are stored in a table and queried at the end.
                              </p><pre class="oac_no_warn" dir="ltr">DROP TABLE my_metadata;
CREATE TABLE my_metadata (md clob);
CREATE OR REPLACE PROCEDURE get_tables_md IS
-- Define local variables
h       NUMBER;         -- handle returned by 'OPEN'
th      NUMBER;         -- handle returned by 'ADD_TRANSFORM'
doc     CLOB;           -- metadata is returned in a CLOB
BEGIN

 -- Specify the object type.
 h := DBMS_METADATA.OPEN('TABLE');

 -- Use filters to specify the schema.
 DBMS_METADATA.SET_FILTER(h,'SCHEMA','SCOTT');

 -- Request that the metadata be transformed into creation DDL.
 th := DBMS_METADATA.ADD_TRANSFORM(h,'DDL');

 -- Fetch the objects.
 LOOP
   doc := DBMS_METADATA.FETCH_CLOB(h);

  -- When there are no more objects to be retrieved, FETCH_CLOB returns NULL.
   EXIT WHEN doc IS NULL;

   -- Store the metadata in a table.
   INSERT INTO my_metadata(md) VALUES (doc);
   COMMIT;
 END LOOP;
 
 -- Release resources.
 DBMS_METADATA.CLOSE(h);
END;
/
</pre></li>
                           <li>
                              <p>Execute the procedure:</p><pre class="oac_no_warn" dir="ltr">EXECUTE get_tables_md;
</pre></li>
                           <li>
                              <p>Query the <code class="codeph">my_metadata</code> table to see what was retrieved:
                              </p><pre class="oac_no_warn" dir="ltr">SET LONG 9000000
SET PAGES 0
SELECT * FROM my_metadata;</pre></li>
                        </ol>
                     </div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="using-oracle-dbms_metadata-api.html#GUID-EE2AA635-EA83-4265-9727-E9C659842CEF" title="The retrieval interface of the DBMS_METADATA API lets you specify the kind of object to be retrieved.">Using the DBMS_METADATA API to Retrieve an Object's Metadata</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="SUTIL3621"></a><a id="SUTIL3622"></a><a id="SUTIL1627"></a><div class="props_rev_3"><a id="GUID-27965831-A88D-4723-8402-F31DC9839B71" name="GUID-27965831-A88D-4723-8402-F31DC9839B71"></a><h4 id="SUTIL-GUID-27965831-A88D-4723-8402-F31DC9839B71" class="sect4"><span class="enumeration_section">23.3.3 </span>Placing Conditions on Transforms
                  </h4>
                  <div>
                     <p>You can use transform parameters to specify conditions on the transforms that you add. </p>
                     <div class="section">
                        <p>To do this, you use the <code class="codeph">SET_TRANSFORM_PARAM</code> procedure. For example, if you have added the <code class="codeph">DDL</code> transform for a <code class="codeph">TABLE</code> object, then you can specify the <code class="codeph">SEGMENT_ATTRIBUTES</code> transform parameter to indicate that you do not want segment attributes (physical, storage, logging, and so on) to appear in the DDL. The default is that segment attributes do appear in the DDL.
                        </p>
                        <p><a href="using-oracle-dbms_metadata-api.html#GUID-27965831-A88D-4723-8402-F31DC9839B71__I1014066">Example 23-4</a> shows use of the <code class="codeph">SET_TRANSFORM_PARAM</code> procedure.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-27965831-A88D-4723-8402-F31DC9839B71__I1014066">
                        <p class="titleinexample">Example 23-4 Placing Conditions on Transforms</p>
                        <ol>
                           <li>
                              <p>Create a function named <code class="codeph">get_table_md</code>, as follows:
                              </p><pre class="oac_no_warn" dir="ltr">CREATE OR REPLACE FUNCTION get_table_md RETURN CLOB IS
 -- Define local variables.
 h    NUMBER;   -- handle returned by 'OPEN'
 th   NUMBER;   -- handle returned by 'ADD_TRANSFORM'
 doc  CLOB;
BEGIN

 -- Specify the object type. 
 h := DBMS_METADATA.OPEN('TABLE');

 -- Use filters to specify the particular object desired.
 DBMS_METADATA.SET_FILTER(h,'SCHEMA','HR');
 DBMS_METADATA.SET_FILTER(h,'NAME','TIMECARDS');

 -- Request that the metadata be transformed into creation DDL.
 th := dbms_metadata.add_transform(h,'DDL');

 -- Specify that segment attributes are not to be returned.
 -- Note that this call uses the TRANSFORM handle, not the OPEN handle.
DBMS_METADATA.SET_TRANSFORM_PARAM(th,'SEGMENT_ATTRIBUTES',false);

 -- Fetch the object.
 doc := DBMS_METADATA.FETCH_CLOB(h);

 -- Release resources.
 DBMS_METADATA.CLOSE(h);

 RETURN doc;
END;
/
</pre></li>
                           <li>
                              <p>Perform the following query:</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT get_table_md FROM dual;
</pre><p>The output looks similar to the following:</p><pre class="oac_no_warn" dir="ltr">  CREATE TABLE "HR"."TIMECARDS"
   (    "EMPLOYEE_ID" NUMBER(6,0),
        "WEEK" NUMBER(2,0),
        "JOB_ID" VARCHAR2(10),
        "HOURS_WORKED" NUMBER(4,2),
         FOREIGN KEY ("EMPLOYEE_ID")
          REFERENCES "HR"."EMPLOYEES" ("EMPLOYEE_ID") ENABLE
   )
</pre></li>
                        </ol>
                        <p>The examples shown up to this point have used a single transform, the <code class="codeph">DDL</code> transform. The <code class="codeph">DBMS_METADATA</code> API also enables you to specify multiple transforms, with the output of the first being the input to the next and so on.
                        </p>
                        <p>Oracle supplies a transform called <code class="codeph">MODIFY</code> that modifies an XML document. You can do things like change schema names or tablespace names. To do this, you use remap parameters and the <code class="codeph">SET_REMAP_PARAM</code> procedure.
                        </p>
                        <p><a href="using-oracle-dbms_metadata-api.html#GUID-27965831-A88D-4723-8402-F31DC9839B71__I1014070">Example 23-5</a> shows a sample use of the <code class="codeph">SET_REMAP_PARAM</code> procedure. It first adds the <code class="codeph">MODIFY</code> transform and specifies remap parameters to change the schema name from <code class="codeph">hr</code> to <code class="codeph">scott</code>. It then adds the <code class="codeph">DDL</code> transform. The output of the <code class="codeph">MODIFY</code> transform is an XML document that becomes the input to the <code class="codeph">DDL</code> transform. The end result is the creation DDL for the <code class="codeph">timecards</code> table with all instances of schema <code class="codeph">hr</code> changed to <code class="codeph">scott</code>.
                        </p>
                     </div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-27965831-A88D-4723-8402-F31DC9839B71__I1014070">
                        <p class="titleinexample">Example 23-5 Modifying an XML Document</p>
                        <ol>
                           <li>
                              <p>Create a function named remap_schema:</p><pre class="oac_no_warn" dir="ltr">CREATE OR REPLACE FUNCTION remap_schema RETURN CLOB IS
-- Define local variables.
h NUMBER; --handle returned by OPEN
th NUMBER; -- handle returned by ADD_TRANSFORM
doc CLOB;
BEGIN

-- Specify the object type.
h := DBMS_METADATA.OPEN('TABLE');

-- Use filters to specify the particular object desired.
DBMS_METADATA.SET_FILTER(h,'SCHEMA','HR');
DBMS_METADATA.SET_FILTER(h,'NAME','TIMECARDS');

-- Request that the schema name be modified.
th := DBMS_METADATA.ADD_TRANSFORM(h,'MODIFY');
DBMS_METADATA.SET_REMAP_PARAM(th,'REMAP_SCHEMA','HR','SCOTT');

-- Request that the metadata be transformed into creation DDL.
th := DBMS_METADATA.ADD_TRANSFORM(h,'DDL');

-- Specify that segment attributes are not to be returned.
DBMS_METADATA.SET_TRANSFORM_PARAM(th,'SEGMENT_ATTRIBUTES',false);

-- Fetch the object.
doc := DBMS_METADATA.FETCH_CLOB(h);

-- Release resources.
DBMS_METADATA.CLOSE(h);
RETURN doc;
END;
/ 
</pre></li>
                           <li>
                              <p>Perform the following query:</p><pre class="oac_no_warn" dir="ltr">SELECT remap_schema FROM dual;
</pre><p>The output looks similar to the following:</p><pre class="oac_no_warn" dir="ltr">  CREATE TABLE "SCOTT"."TIMECARDS"
   (    "EMPLOYEE_ID" NUMBER(6,0),
        "WEEK" NUMBER(2,0),
        "JOB_ID" VARCHAR2(10),
        "HOURS_WORKED" NUMBER(4,2),
         FOREIGN KEY ("EMPLOYEE_ID")
          REFERENCES "SCOTT"."EMPLOYEES" ("EMPLOYEE_ID") ENABLE
   )
</pre><p>If you are familiar with XSLT, then you can add your own user-written transforms to process the XML.</p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="using-oracle-dbms_metadata-api.html#GUID-EE2AA635-EA83-4265-9727-E9C659842CEF" title="The retrieval interface of the DBMS_METADATA API lets you specify the kind of object to be retrieved.">Using the DBMS_METADATA API to Retrieve an Object's Metadata</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="SUTIL3623"></a><a id="SUTIL1628"></a><div class="props_rev_3"><a id="GUID-BB45CA8D-2621-419B-906C-1E811499786A" name="GUID-BB45CA8D-2621-419B-906C-1E811499786A"></a><h4 id="SUTIL-GUID-BB45CA8D-2621-419B-906C-1E811499786A" class="sect4"><span class="enumeration_section">23.3.4 </span>Accessing Specific Metadata Attributes
                  </h4>
                  <div>
                     <p>Description and example of accessing specific metadata attributes.</p>
                     <div class="section">
                        <p>It is often desirable to access specific attributes of an object's metadata, for example, its name or schema. You could get this information by parsing the returned metadata, but the <code class="codeph">DBMS_METADATA</code> API provides another mechanism; you can specify parse items, specific attributes that will be parsed out of the metadata and returned in a separate data structure. To do this, you use the <code class="codeph">SET_PARSE_ITEM</code> procedure.
                        </p>
                        <p><a href="using-oracle-dbms_metadata-api.html#GUID-BB45CA8D-2621-419B-906C-1E811499786A__I1014074">Example 23-6</a> fetches all tables in a schema. For each table, a parse item is used to get its name. The name is then used to get all indexes on the table. The example illustrates the use of the <code class="codeph">FETCH_DDL</code> function, which returns metadata in a <code class="codeph">sys</code>.<code class="codeph">ku$_ddls</code> object.
                        </p>
                        <p>This example assumes you are connected to a schema that contains some tables and indexes. It also creates a table named <code class="codeph">my_metadata</code>.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-BB45CA8D-2621-419B-906C-1E811499786A__I1014074">
                        <p class="titleinexample">Example 23-6 Using Parse Items to Access Specific Metadata Attributes</p>
                        <ol>
                           <li>
                              <p>Create a table named <code class="codeph">my_metadata</code> and a procedure named <code class="codeph">get_tables_and_indexes</code>, as follows:
                              </p><pre class="oac_no_warn" dir="ltr">DROP TABLE my_metadata;
CREATE TABLE my_metadata (
  object_type   VARCHAR2(30),
  name          VARCHAR2(30),
  md            CLOB);
CREATE OR REPLACE PROCEDURE get_tables_and_indexes IS
-- Define local variables.
h1      NUMBER;         -- handle returned by OPEN for tables
h2      NUMBER;         -- handle returned by OPEN for indexes
th1     NUMBER;         -- handle returned by ADD_TRANSFORM for tables
th2     NUMBER;         -- handle returned by ADD_TRANSFORM for indexes
doc     sys.ku$_ddls;   -- metadata is returned in sys.ku$_ddls,
                        --  a nested table of sys.ku$_ddl objects
ddl     CLOB;           -- creation DDL for an object
pi      sys.ku$_parsed_items;   -- parse items are returned in this object
                                -- which is contained in sys.ku$_ddl
objname VARCHAR2(30);   -- the parsed object name
idxddls sys.ku$_ddls;   -- metadata is returned in sys.ku$_ddls,
                        --  a nested table of sys.ku$_ddl objects
idxname VARCHAR2(30);   -- the parsed index name
BEGIN
 -- This procedure has an outer loop that fetches tables,
 -- and an inner loop that fetches indexes.
 
 -- Specify the object type: TABLE.
 h1 := DBMS_METADATA.OPEN('TABLE');
 
 -- Request that the table name be returned as a parse item.
 DBMS_METADATA.SET_PARSE_ITEM(h1,'NAME');
 
 -- Request that the metadata be transformed into creation DDL.
 th1 := DBMS_METADATA.ADD_TRANSFORM(h1,'DDL');
 
 -- Specify that segment attributes are not to be returned.
 DBMS_METADATA.SET_TRANSFORM_PARAM(th1,'SEGMENT_ATTRIBUTES',false);
 
 -- Set up the outer loop: fetch the TABLE objects.
 LOOP
   doc := dbms_metadata.fetch_ddl(h1);
 
-- When there are no more objects to be retrieved, FETCH_DDL returns NULL.
   EXIT WHEN doc IS NULL;
 
-- Loop through the rows of the ku$_ddls nested table.
   FOR i IN doc.FIRST..doc.LAST LOOP
     ddl := doc(i).ddlText;
     pi := doc(i).parsedItems;
     -- Loop through the returned parse items.
     IF pi IS NOT NULL AND pi.COUNT &gt; 0 THEN
       FOR j IN pi.FIRST..pi.LAST LOOP
         IF pi(j).item='NAME' THEN
           objname := pi(j).value;
         END IF;
       END LOOP;
     END IF;
     -- Insert information about this object into our table.
     INSERT INTO my_metadata(object_type, name, md)
       VALUES ('TABLE',objname,ddl);
     COMMIT;
   END LOOP;
 
   -- Now fetch indexes using the parsed table name as
   --  a BASE_OBJECT_NAME filter.
 
   -- Specify the object type.
   h2 := DBMS_METADATA.OPEN('INDEX');
 
   -- The base object is the table retrieved in the outer loop.
   DBMS_METADATA.SET_FILTER(h2,'BASE_OBJECT_NAME',objname);
 
   -- Exclude system-generated indexes.
   DBMS_METADATA.SET_FILTER(h2,'SYSTEM_GENERATED',false);
 
   -- Request that the index name be returned as a parse item.
   DBMS_METADATA.SET_PARSE_ITEM(h2,'NAME');
 
   -- Request that the metadata be transformed into creation DDL.
   th2 := DBMS_METADATA.ADD_TRANSFORM(h2,'DDL');
 
   -- Specify that segment attributes are not to be returned.
   DBMS_METADATA.SET_TRANSFORM_PARAM(th2,'SEGMENT_ATTRIBUTES',false);
  
 
   LOOP
    idxddls := dbms_metadata.fetch_ddl(h2);
 
    -- When there are no more objects to  be retrieved, FETCH_DDL returns NULL.
    EXIT WHEN idxddls IS NULL;
 
      FOR i in idxddls.FIRST..idxddls.LAST LOOP
        ddl := idxddls(i).ddlText;
        pi  := idxddls(i).parsedItems;
        -- Loop through the returned parse items.
        IF pi IS NOT NULL AND pi.COUNT &gt; 0 THEN
          FOR j IN pi.FIRST..pi.LAST LOOP
            IF pi(j).item='NAME' THEN
              idxname := pi(j).value;
            END IF;
          END LOOP;
         END IF;
   
         -- Store the metadata in our table.
          INSERT INTO my_metadata(object_type, name, md)
            VALUES ('INDEX',idxname,ddl);
         COMMIT;
       END LOOP;  -- for loop
  END LOOP;
  DBMS_METADATA.CLOSE(h2);
 END LOOP;
 DBMS_METADATA.CLOSE(h1);
END;
/
</pre></li>
                           <li>
                              <p>Execute the procedure:</p><pre class="oac_no_warn" dir="ltr">EXECUTE get_tables_and_indexes;
</pre></li>
                           <li>
                              <p>Perform the following query to see what was retrieved:</p><pre class="oac_no_warn" dir="ltr">SET LONG 9000000
SET PAGES 0
SELECT * FROM my_metadata;</pre></li>
                        </ol>
                     </div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="using-oracle-dbms_metadata-api.html#GUID-EE2AA635-EA83-4265-9727-E9C659842CEF" title="The retrieval interface of the DBMS_METADATA API lets you specify the kind of object to be retrieved.">Using the DBMS_METADATA API to Retrieve an Object's Metadata</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="SUTIL3624"></a><a id="SUTIL1629"></a><div class="props_rev_2"><a id="GUID-1DA999FD-1AFD-4D8D-A6D0-8EEB84E0D9E4" name="GUID-1DA999FD-1AFD-4D8D-A6D0-8EEB84E0D9E4"></a><h3 id="SUTIL-GUID-1DA999FD-1AFD-4D8D-A6D0-8EEB84E0D9E4" class="sect3"><span class="enumeration_section">23.4 </span>Using the DBMS_METADATA API to Re-Create a Retrieved Object
               </h3>
               <div>
                  <p>When you fetch metadata for an object, you may want to use it to re-create the object in a different database or schema.</p>
                  <div class="section">
                     <p>You may not be ready to make remapping decisions when you fetch the metadata. You may want to defer these decisions until later. To accomplish this, you fetch the metadata as XML and store it in a file or table. Later you can use the submit interface to re-create the object.</p>
                     <p>The submit interface is similar in form to the retrieval interface. It has an <code class="codeph">OPENW</code> procedure in which you specify the object type of the object to be created. You can specify transforms, transform parameters, and parse items. You can call the <code class="codeph">CONVERT</code> function to convert the XML to DDL, or you can call the <code class="codeph">PUT</code> function to both convert XML to DDL and submit the DDL to create the object.
                     </p>
                     <p><a href="using-oracle-dbms_metadata-api.html#GUID-1DA999FD-1AFD-4D8D-A6D0-8EEB84E0D9E4__I1014078">Example 23-7</a> fetches the XML for a table in one schema, and then uses the submit interface to re-create the table in another schema.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-1DA999FD-1AFD-4D8D-A6D0-8EEB84E0D9E4__I1014078">
                     <p class="titleinexample">Example 23-7 Using the Submit Interface to Re-Create a Retrieved Object</p>
                     <ol>
                        <li>
                           <p>Connect as a privileged user:</p><pre class="oac_no_warn" dir="ltr">CONNECT system
Enter password: <span class="italic">password</span>
</pre></li>
                        <li>
                           <p>Create an invoker's rights package to hold the procedure because access to objects in another schema requires the <code class="codeph">SELECT_CATALOG_ROLE</code> role. In a definer's rights PL/SQL object (such as a procedure or function), roles are disabled.
                           </p><pre class="oac_no_warn" dir="ltr">CREATE OR REPLACE PACKAGE example_pkg AUTHID current_user IS
  PROCEDURE move_table(
        table_name  in VARCHAR2,
        from_schema in VARCHAR2,
        to_schema   in VARCHAR2 );
END example_pkg;
/
CREATE OR REPLACE PACKAGE BODY example_pkg IS
PROCEDURE move_table(
        table_name  in VARCHAR2,
        from_schema in VARCHAR2,
        to_schema   in VARCHAR2 ) IS

-- Define local variables.
h1      NUMBER;         -- handle returned by OPEN
h2      NUMBER;         -- handle returned by OPENW
th1     NUMBER;         -- handle returned by ADD_TRANSFORM for MODIFY
th2     NUMBER;         -- handle returned by ADD_TRANSFORM for DDL
xml     CLOB;           -- XML document
errs    sys.ku$_SubmitResults := sys.ku$_SubmitResults();
err     sys.ku$_SubmitResult;
result  BOOLEAN;
BEGIN

-- Specify the object type.
h1 := DBMS_METADATA.OPEN('TABLE');

-- Use filters to specify the name and schema of the table.
DBMS_METADATA.SET_FILTER(h1,'NAME',table_name);
DBMS_METADATA.SET_FILTER(h1,'SCHEMA',from_schema);

-- Fetch the XML.
xml := DBMS_METADATA.FETCH_CLOB(h1);
IF xml IS NULL THEN
    DBMS_OUTPUT.PUT_LINE('Table ' || from_schema || '.' || table_name
|| ' not found');
    RETURN;
  END IF;

-- Release resources.
DBMS_METADATA.CLOSE(h1);

-- Use the submit interface to re-create the object in another schema.

-- Specify the object type using OPENW (instead of OPEN).
h2 := DBMS_METADATA.OPENW('TABLE');

-- First, add the MODIFY transform.
th1 := DBMS_METADATA.ADD_TRANSFORM(h2,'MODIFY');

-- Specify the desired modification: remap the schema name.
DBMS_METADATA.SET_REMAP_PARAM(th1,'REMAP_SCHEMA',from_schema,to_schema);

-- Now add the DDL transform so that the modified XML can be
--  transformed into creation DDL.
th2 := DBMS_METADATA.ADD_TRANSFORM(h2,'DDL');

-- Call PUT to re-create the object.
result := DBMS_METADATA.PUT(h2,xml,0,errs);

DBMS_METADATA.CLOSE(h2);
  IF NOT result THEN
    -- Process the error information.
    FOR i IN errs.FIRST..errs.LAST LOOP
      err := errs(i);
      FOR j IN err.errorLines.FIRST..err.errorLines.LAST LOOP
        dbms_output.put_line(err.errorLines(j).errorText);
      END LOOP;
    END LOOP;
  END IF;
END;
END example_pkg;
/
</pre></li>
                        <li>
                           <p>Now create a table named <code class="codeph">my_example</code> in the schema <code class="codeph">SCOTT</code>:
                           </p><pre class="oac_no_warn" dir="ltr">CONNECT scott
Enter password:
-- The password is tiger.

DROP TABLE my_example;
CREATE TABLE my_example (a NUMBER, b VARCHAR2(30));

CONNECT system
Enter password: <span class="italic">password</span>

SET LONG 9000000
SET PAGESIZE 0
SET SERVEROUTPUT ON SIZE 100000
</pre></li>
                        <li>
                           <p>Copy the <code class="codeph">my_example</code> table to the <code class="codeph">SYSTEM</code> schema:
                           </p><pre class="oac_no_warn" dir="ltr">DROP TABLE my_example;
EXECUTE example_pkg.move_table('MY_EXAMPLE','SCOTT','SYSTEM');
</pre></li>
                        <li>
                           <p>Perform the following query to verify that it worked:</p><pre class="oac_no_warn" dir="ltr">SELECT DBMS_METADATA.GET_DDL('TABLE','MY_EXAMPLE') FROM dual;</pre></li>
                     </ol>
                  </div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-oracle-dbms_metadata-api.html#GUID-D9B1300F-B21D-416E-8B9B-C542195EF249" title="Using the DBMS_METADATA APIs.">Using the Metadata APIs</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="SUTIL3625"></a><a id="SUTIL1630"></a><div class="props_rev_3"><a id="GUID-85AC0B9A-5C6E-4D2A-A3CA-30F5F7884048" name="GUID-85AC0B9A-5C6E-4D2A-A3CA-30F5F7884048"></a><h3 id="SUTIL-GUID-85AC0B9A-5C6E-4D2A-A3CA-30F5F7884048" class="sect3"><span class="enumeration_section">23.5 </span>Using the DBMS_METADATA API to Retrieve Collections of Different Object Types
               </h3>
               <div>
                  <p>Description and example of retrieving collections of different object types.</p>
                  <p>There may be times when you need to retrieve collections of objects in which the objects are of different types, but comprise a logical unit. For example, you might need to retrieve all the objects in a database or a schema, or a table and all its dependent indexes, constraints, grants, audits, and so on. To make such a retrieval possible, the <code class="codeph">DBMS_METADATA</code> API provides several heterogeneous object types. A heterogeneous object type is an ordered set of object types.
                  </p>
                  <p>Oracle supplies the following heterogeneous object types:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><code class="codeph">TABLE_EXPORT</code> - a table and its dependent objects
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">SCHEMA_EXPORT</code> - a schema and its contents
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">DATABASE_EXPORT</code> - the objects in the database
                        </p>
                     </li>
                  </ul>
                  <p>These object types were developed for use by the Data Pump Export utility, but you can use them in your own applications. </p>
                  <p>You can use only the programmatic retrieval interface (<code class="codeph">OPEN</code>, <code class="codeph">FETCH</code>, <code class="codeph">CLOSE</code>) with these types, not the browsing interface or the submit interface.
                  </p>
                  <p>You can specify filters for heterogeneous object types, just as you do for the homogeneous types. For example, you can specify the <code class="codeph">SCHEMA</code> and <code class="codeph">NAME</code> filters for <code class="codeph">TABLE_EXPORT</code>, or the <code class="codeph">SCHEMA</code> filter for <code class="codeph">SCHEMA_EXPORT</code>.
                  </p>
                  <p><a href="using-oracle-dbms_metadata-api.html#GUID-85AC0B9A-5C6E-4D2A-A3CA-30F5F7884048__I1014082">Example 23-8</a> shows how to retrieve the object types in the <code class="codeph">scott</code> schema. Connect as user <code class="codeph">scott</code>. The password is <code class="codeph">tiger</code>.
                  </p>
                  <div class="example" id="GUID-85AC0B9A-5C6E-4D2A-A3CA-30F5F7884048__I1014082">
                     <p class="titleinexample">Example 23-8 Retrieving Heterogeneous Object Types</p>
                     <ol>
                        <li>
                           <p>Create a table to store the retrieved objects:</p><pre class="oac_no_warn" dir="ltr">DROP TABLE my_metadata;
CREATE TABLE my_metadata (md CLOB);
CREATE OR REPLACE PROCEDURE get_schema_md IS

-- Define local variables.
h       NUMBER;         -- handle returned by OPEN
th      NUMBER;         -- handle returned by ADD_TRANSFORM
doc     CLOB;           -- metadata is returned in a CLOB
BEGIN

-- Specify the object type.
 h := DBMS_METADATA.OPEN('SCHEMA_EXPORT');

 -- Use filters to specify the schema.
 DBMS_METADATA.SET_FILTER(h,'SCHEMA','SCOTT');

 -- Request that the metadata be transformed into creation DDL.
 th := DBMS_METADATA.ADD_TRANSFORM(h,'DDL');

 -- Fetch the objects.
 LOOP
   doc := DBMS_METADATA.FETCH_CLOB(h);

   -- When there are no more objects to be retrieved, FETCH_CLOB returns NULL.
   EXIT WHEN doc IS NULL;

   -- Store the metadata in the table.
   INSERT INTO my_metadata(md) VALUES (doc);
   COMMIT;
 END LOOP;
 
 -- Release resources.
 DBMS_METADATA.CLOSE(h);
END;
/
</pre></li>
                        <li>
                           <p>Execute the procedure:</p><pre class="oac_no_warn" dir="ltr">EXECUTE get_schema_md;
</pre></li>
                        <li>
                           <p>Perform the following query to see what was retrieved:</p><pre class="oac_no_warn" dir="ltr">SET LONG 9000000
SET PAGESIZE 0
SELECT * FROM my_metadata;
</pre></li>
                     </ol>
                     <p>In this example, objects are returned ordered by object type; for example, all tables are returned, then all grants on tables, then all indexes on tables, and so on. The order is, generally speaking, a valid creation order. Thus, if you take the objects in the order in which they were returned and use the submit interface to re-create them in the same order in another schema or database, then there will usually be no errors. (The exceptions usually involve circular references; for example, if package A contains a call to package B, and package B contains a call to package A, then one of the packages will need to be recompiled a second time.)</p>
                  </div>
                  <!-- class="example" -->
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="using-oracle-dbms_metadata-api.html#GUID-E0EEE23F-EDED-40D2-BAE7-A1F5FF951589">Filtering the Return of Heterogeneous Object Types</a><br>Description and example of filtering the return of heterogeneous object types.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-oracle-dbms_metadata-api.html#GUID-D9B1300F-B21D-416E-8B9B-C542195EF249" title="Using the DBMS_METADATA APIs.">Using the Metadata APIs</a></p>
                     </div>
                  </div>
               </div>
               <a id="SUTIL3626"></a><a id="SUTIL1631"></a><div class="props_rev_3"><a id="GUID-E0EEE23F-EDED-40D2-BAE7-A1F5FF951589" name="GUID-E0EEE23F-EDED-40D2-BAE7-A1F5FF951589"></a><h4 id="SUTIL-GUID-E0EEE23F-EDED-40D2-BAE7-A1F5FF951589" class="sect4"><span class="enumeration_section">23.5.1 </span>Filtering the Return of Heterogeneous Object Types
                  </h4>
                  <div>
                     <p>Description and example of filtering the return of heterogeneous object types.</p>
                     <div class="section">
                        <p>For finer control of the objects returned, use the <code class="codeph">SET_FILTER</code> procedure and specify that the filter apply only to a specific member type. You do this by specifying the path name of the member type as the fourth parameter to <code class="codeph">SET_FILTER</code>. In addition, you can use the <code class="codeph">EXCLUDE_PATH_EXPR</code> filter to exclude all objects of an object type. For a list of valid path names, see the <code class="codeph">TABLE_EXPORT_OBJECTS</code> catalog view.
                        </p>
                        <p><a href="using-oracle-dbms_metadata-api.html#GUID-E0EEE23F-EDED-40D2-BAE7-A1F5FF951589__I1014087">Example 23-9</a> shows how you can use <code class="codeph">SET_FILTER</code> to specify finer control on the objects returned. Connect as user <code class="codeph">scott</code>. The password is <code class="codeph">tiger</code>.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-E0EEE23F-EDED-40D2-BAE7-A1F5FF951589__I1014087">
                        <p class="titleinexample">Example 23-9 Filtering the Return of Heterogeneous Object Types</p>
                        <ol>
                           <li>
                              <p>Create a table, <code class="codeph">my_metadata</code>, to store the retrieved objects. And create a procedure, <code class="codeph">get_schema_md2</code>.
                              </p><pre class="oac_no_warn" dir="ltr">DROP TABLE my_metadata;
CREATE TABLE my_metadata (md CLOB);
CREATE OR REPLACE PROCEDURE get_schema_md2 IS

-- Define local variables.
h       NUMBER;         -- handle returned by 'OPEN'
th      NUMBER;         -- handle returned by 'ADD_TRANSFORM'
doc     CLOB;           -- metadata is returned in a CLOB
BEGIN

 -- Specify the object type.
 h := DBMS_METADATA.OPEN('SCHEMA_EXPORT');

 -- Use filters to specify the schema.
 DBMS_METADATA.SET_FILTER(h,'SCHEMA','SCOTT');

 -- Use the fourth parameter to SET_FILTER to specify a filter
 -- that applies to a specific member object type.
 DBMS_METADATA.SET_FILTER(h,'NAME_EXPR','!=''MY_METADATA''','TABLE');

 -- Use the EXCLUDE_PATH_EXPR filter to exclude procedures.
 DBMS_METADATA.SET_FILTER(h,'EXCLUDE_PATH_EXPR','=''PROCEDURE''');

 -- Request that the metadata be transformed into creation DDL.
 th := DBMS_METADATA.ADD_TRANSFORM(h,'DDL');

 -- Use the fourth parameter to SET_TRANSFORM_PARAM to specify a parameter
 --  that applies to a specific member object type.
DBMS_METADATA.SET_TRANSFORM_PARAM(th,'SEGMENT_ATTRIBUTES',false,'TABLE');

 -- Fetch the objects.
 LOOP
   doc := dbms_metadata.fetch_clob(h);

   -- When there are no more objects to be retrieved, FETCH_CLOB returns NULL.
   EXIT WHEN doc IS NULL;

   -- Store the metadata in the table.
   INSERT INTO my_metadata(md) VALUES (doc);
   COMMIT;
 END LOOP;
 
 -- Release resources.
 DBMS_METADATA.CLOSE(h);
END;
/
</pre></li>
                           <li>
                              <p>Execute the procedure:</p><pre class="oac_no_warn" dir="ltr">EXECUTE get_schema_md2;
</pre></li>
                           <li>
                              <p>Perform the following query to see what was retrieved:</p><pre class="oac_no_warn" dir="ltr">SET LONG 9000000
SET PAGESIZE 0
SELECT * FROM my_metadata;</pre></li>
                        </ol>
                     </div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="using-oracle-dbms_metadata-api.html#GUID-85AC0B9A-5C6E-4D2A-A3CA-30F5F7884048" title="Description and example of retrieving collections of different object types.">Using the DBMS_METADATA API to Retrieve Collections of Different Object Types</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="SUTIL3628"></a><a id="SUTIL3627"></a><div class="props_rev_3"><a id="GUID-E9A778A7-2E9D-4240-8707-A52FF65556FE" name="GUID-E9A778A7-2E9D-4240-8707-A52FF65556FE"></a><h3 id="SUTIL-GUID-E9A778A7-2E9D-4240-8707-A52FF65556FE" class="sect3"><span class="enumeration_section">23.6 </span>Using the DBMS_METADATA_DIFF API to Compare Object Metadata
               </h3>
               <div>
                  <p> Description and example that uses the retrieval, comparison, and submit interfaces of <code class="codeph">DBMS_METADATA</code> and <code class="codeph">DBMS_METADATA_DIFF</code> to fetch metadata for two tables, compare the metadata, and generate <code class="codeph">ALTER</code> statements which make one table like the other. 
                  </p>
                  <div class="section">
                     <p>For simplicity, function variants are used throughout the example.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-E9A778A7-2E9D-4240-8707-A52FF65556FE__GUID-7A7FE9D7-77D8-483F-8B18-37FE39CCE24F">
                     <p class="titleinexample">Example 23-10 Comparing Object Metadata</p>
                     <ol>
                        <li>
                           <p>Create two tables, <code class="codeph">TAB1</code> and <code class="codeph">TAB2</code>:
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; CREATE TABLE TAB1
  2     (    "EMPNO" NUMBER(4,0),
  3          "ENAME" VARCHAR2(10),
  4          "JOB" VARCHAR2(9),
  5          "DEPTNO" NUMBER(2,0)
  6     ) ;
 
Table created.
 
SQL&gt; CREATE TABLE TAB2
  2     (    "EMPNO" NUMBER(4,0) PRIMARY KEY ENABLE,
  3          "ENAME" VARCHAR2(20),
  4          "MGR" NUMBER(4,0),
  5          "DEPTNO" NUMBER(2,0)
  6     ) ;
 
Table created.
 </pre><p>Note the differences between <code class="codeph">TAB1</code> and <code class="codeph">TAB2</code>:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The table names are different</p>
                              </li>
                              <li>
                                 <p><code class="codeph">TAB2</code> has a primary key constraint; <code class="codeph">TAB1</code> does not
                                 </p>
                              </li>
                              <li>
                                 <p>The length of the <code class="codeph">ENAME</code> column is different in each table
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">TAB1</code> has a <code class="codeph">JOB</code> column; <code class="codeph">TAB2</code> does not
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">TAB2</code> has a <code class="codeph">MGR</code> column; <code class="codeph">TAB1</code> does not
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>Create a function to return the table metadata in SXML format. The following are some key points to keep in mind about SXML when you are using the <code class="codeph">DBMS_METADATA_DIFF</code> API:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>SXML is an XML representation of object metadata.</p>
                              </li>
                              <li>
                                 <p>The SXML returned is not the same as the XML returned by <code class="codeph">DBMS_METADATA.GET_XML</code>, which is complex and opaque and contains binary values, instance-specific values, and so on.
                                 </p>
                              </li>
                              <li>
                                 <p>SXML looks like a direct translation of SQL creation DDL into XML. The tag names and structure correspond to names in the <a href="../sqlrf/SQL-Statements-ADMINISTER-KEY-MANAGEMENT-to-ALTER-JAVA.html#SQLRF008" target="_blank"><span class="italic">Oracle Database SQL Language Reference</span></a>.
                                 </p>
                              </li>
                              <li>
                                 <p>SXML is designed to support editing and comparison.</p>
                              </li>
                           </ul>
                           <p>To keep this example simple, a transform parameter is used to suppress physical properties:</p><pre class="oac_no_warn" dir="ltr">SQL&gt; CREATE OR REPLACE FUNCTION get_table_sxml(name IN VARCHAR2) RETURN CLOB IS
  2   open_handle NUMBER;
  3   transform_handle NUMBER;
  4   doc CLOB;
  5  BEGIN
  6   open_handle := DBMS_METADATA.OPEN('TABLE');
  7   DBMS_METADATA.SET_FILTER(open_handle,'NAME',name);
  8   --
  9   -- Use the 'SXML' transform to convert XML to SXML
 10   --
 11   transform_handle := DBMS_METADATA.ADD_TRANSFORM(open_handle,'SXML');
 12   --
 13   -- Use this transform parameter to suppress physical properties
 14   --
 15   DBMS_METADATA.SET_TRANSFORM_PARAM(transform_handle,'PHYSICAL_PROPERTIES',
 16                                     FALSE);
 17   doc := DBMS_METADATA.FETCH_CLOB(open_handle);
 18   DBMS_METADATA.CLOSE(open_handle);
 19   RETURN doc;
 20  END;
 21  /
 
Function created.
 </pre></li>
                        <li>
                           <p>Use the <code class="codeph">get_table_sxml</code> function to fetch the table SXML for the two tables:
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT get_table_sxml('TAB1') FROM dual;
 
  &lt;TABLE xmlns="http://xmlns.oracle.com/ku" version="1.0"&gt;
   &lt;SCHEMA&gt;SCOTT&lt;/SCHEMA&gt;
   &lt;NAME&gt;TAB1&lt;/NAME&gt;
   &lt;RELATIONAL_TABLE&gt;
      &lt;COL_LIST&gt;
         &lt;COL_LIST_ITEM&gt;
            &lt;NAME&gt;EMPNO&lt;/NAME&gt;
            &lt;DATATYPE&gt;NUMBER&lt;/DATATYPE&gt;
            &lt;PRECISION&gt;4&lt;/PRECISION&gt;
            &lt;SCALE&gt;0&lt;/SCALE&gt;
         &lt;/COL_LIST_ITEM&gt;
         &lt;COL_LIST_ITEM&gt;
            &lt;NAME&gt;ENAME&lt;/NAME&gt;
            &lt;DATATYPE&gt;VARCHAR2&lt;/DATATYPE&gt;
            &lt;LENGTH&gt;10&lt;/LENGTH&gt;
         &lt;/COL_LIST_ITEM&gt;
         &lt;COL_LIST_ITEM&gt;
            &lt;NAME&gt;JOB&lt;/NAME&gt;
            &lt;DATATYPE&gt;VARCHAR2&lt;/DATATYPE&gt;
            &lt;LENGTH&gt;9&lt;/LENGTH&gt;
         &lt;/COL_LIST_ITEM&gt;
         &lt;COL_LIST_ITEM&gt;
            &lt;NAME&gt;DEPTNO&lt;/NAME&gt;
            &lt;DATATYPE&gt;NUMBER&lt;/DATATYPE&gt;
            &lt;PRECISION&gt;2&lt;/PRECISION&gt;
            &lt;SCALE&gt;0&lt;/SCALE&gt;
         &lt;/COL_LIST_ITEM&gt;
      &lt;/COL_LIST&gt;
   &lt;/RELATIONAL_TABLE&gt;
&lt;/TABLE&gt; 
  
1 row selected.
 
SQL&gt; SELECT get_table_sxml('TAB2') FROM dual;
 
  &lt;TABLE xmlns="http://xmlns.oracle.com/ku" version="1.0"&gt;
   &lt;SCHEMA&gt;SCOTT&lt;/SCHEMA&gt;
   &lt;NAME&gt;TAB2&lt;/NAME&gt;
   &lt;RELATIONAL_TABLE&gt;
      &lt;COL_LIST&gt;
         &lt;COL_LIST_ITEM&gt;
            &lt;NAME&gt;EMPNO&lt;/NAME&gt;
            &lt;DATATYPE&gt;NUMBER&lt;/DATATYPE&gt;
            &lt;PRECISION&gt;4&lt;/PRECISION&gt;
            &lt;SCALE&gt;0&lt;/SCALE&gt;
         &lt;/COL_LIST_ITEM&gt;
         &lt;COL_LIST_ITEM&gt;
            &lt;NAME&gt;ENAME&lt;/NAME&gt;
            &lt;DATATYPE&gt;VARCHAR2&lt;/DATATYPE&gt;
            &lt;LENGTH&gt;20&lt;/LENGTH&gt;
         &lt;/COL_LIST_ITEM&gt;
         &lt;COL_LIST_ITEM&gt;
            &lt;NAME&gt;MGR&lt;/NAME&gt;
            &lt;DATATYPE&gt;NUMBER&lt;/DATATYPE&gt;
            &lt;PRECISION&gt;4&lt;/PRECISION&gt;
            &lt;SCALE&gt;0&lt;/SCALE&gt;
         &lt;/COL_LIST_ITEM&gt;
         &lt;COL_LIST_ITEM&gt;
            &lt;NAME&gt;DEPTNO&lt;/NAME&gt;
            &lt;DATATYPE&gt;NUMBER&lt;/DATATYPE&gt;
            &lt;PRECISION&gt;2&lt;/PRECISION&gt;
            &lt;SCALE&gt;0&lt;/SCALE&gt;
         &lt;/COL_LIST_ITEM&gt;
      &lt;/COL_LIST&gt;
      &lt;PRIMARY_KEY_CONSTRAINT_LIST&gt;
         &lt;PRIMARY_KEY_CONSTRAINT_LIST_ITEM&gt;
            &lt;COL_LIST&gt;
               &lt;COL_LIST_ITEM&gt;
                  &lt;NAME&gt;EMPNO&lt;/NAME&gt;
               &lt;/COL_LIST_ITEM&gt;
            &lt;/COL_LIST&gt;
         &lt;/PRIMARY_KEY_CONSTRAINT_LIST_ITEM&gt;
      &lt;/PRIMARY_KEY_CONSTRAINT_LIST&gt;
   &lt;/RELATIONAL_TABLE&gt;
&lt;/TABLE&gt; 
 
1 row selected.
 </pre></li>
                        <li>
                           <p>Compare the results using the <code class="codeph">DBMS_METADATA</code> browsing APIs:
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT dbms_metadata.get_sxml('TABLE','TAB1') FROM dual;
SQL&gt; SELECT dbms_metadata.get_sxml('TABLE','TAB2') FROM dual;
</pre></li>
                        <li>
                           <p>Create a function using the <code class="codeph">DBMS_METADATA_DIFF</code> API to compare the metadata for the two tables. In this function, the <code class="codeph">get_table_sxml</code> function that was just defined in step 2 is used.
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; CREATE OR REPLACE FUNCTION compare_table_sxml(name1 IN VARCHAR2,
  2                                          name2 IN VARCHAR2) RETURN CLOB IS
  3   doc1 CLOB;
  4   doc2 CLOB;
  5   diffdoc CLOB;
  6   openc_handle NUMBER;
  7  BEGIN
  8   --
  9   -- Fetch the SXML for the two tables
 10   --
 11   doc1 := get_table_sxml(name1);
 12   doc2 := get_table_sxml(name2);
 13   --
 14   -- Specify the object type in the OPENC call
 15   --
 16   openc_handle := DBMS_METADATA_DIFF.OPENC('TABLE');
 17   --
 18   -- Add each document
 19   --
 20   DBMS_METADATA_DIFF.ADD_DOCUMENT(openc_handle,doc1);
 21   DBMS_METADATA_DIFF.ADD_DOCUMENT(openc_handle,doc2);
 22   --
 23   -- Fetch the SXML difference document
 24   --
 25   diffdoc := DBMS_METADATA_DIFF.FETCH_CLOB(openc_handle);
 26   DBMS_METADATA_DIFF.CLOSE(openc_handle);
 27   RETURN diffdoc;
 28  END;
 29  /
 
Function created.
</pre></li>
                        <li>
                           <p>Use the function to fetch the SXML difference document for the two tables:</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT compare_table_sxml('TAB1','TAB2') FROM dual;

&lt;TABLE xmlns="http://xmlns.oracle.com/ku" version="1.0"&gt;
  &lt;SCHEMA&gt;SCOTT&lt;/SCHEMA&gt;
  &lt;NAME value1="TAB1"&gt;TAB2&lt;/NAME&gt;
  &lt;RELATIONAL_TABLE&gt;
    &lt;COL_LIST&gt;
      &lt;COL_LIST_ITEM&gt;
        &lt;NAME&gt;EMPNO&lt;/NAME&gt;
        &lt;DATATYPE&gt;NUMBER&lt;/DATATYPE&gt;
        &lt;PRECISION&gt;4&lt;/PRECISION&gt;
        &lt;SCALE&gt;0&lt;/SCALE&gt;
      &lt;/COL_LIST_ITEM&gt;
      &lt;COL_LIST_ITEM&gt;
        &lt;NAME&gt;ENAME&lt;/NAME&gt;
        &lt;DATATYPE&gt;VARCHAR2&lt;/DATATYPE&gt;
        &lt;LENGTH value1="10"&gt;20&lt;/LENGTH&gt;
      &lt;/COL_LIST_ITEM&gt;
      &lt;COL_LIST_ITEM src="1"&gt;
        &lt;NAME&gt;JOB&lt;/NAME&gt;
        &lt;DATATYPE&gt;VARCHAR2&lt;/DATATYPE&gt;
        &lt;LENGTH&gt;9&lt;/LENGTH&gt;
      &lt;/COL_LIST_ITEM&gt;
      &lt;COL_LIST_ITEM&gt;
        &lt;NAME&gt;DEPTNO&lt;/NAME&gt;
        &lt;DATATYPE&gt;NUMBER&lt;/DATATYPE&gt;
        &lt;PRECISION&gt;2&lt;/PRECISION&gt;
        &lt;SCALE&gt;0&lt;/SCALE&gt;
      &lt;/COL_LIST_ITEM&gt;
      &lt;COL_LIST_ITEM src="2"&gt;
        &lt;NAME&gt;MGR&lt;/NAME&gt;
        &lt;DATATYPE&gt;NUMBER&lt;/DATATYPE&gt;
        &lt;PRECISION&gt;4&lt;/PRECISION&gt;
        &lt;SCALE&gt;0&lt;/SCALE&gt;
      &lt;/COL_LIST_ITEM&gt;
    &lt;/COL_LIST&gt;
    &lt;PRIMARY_KEY_CONSTRAINT_LIST src="2"&gt;
      &lt;PRIMARY_KEY_CONSTRAINT_LIST_ITEM&gt;
        &lt;COL_LIST&gt;
          &lt;COL_LIST_ITEM&gt;
            &lt;NAME&gt;EMPNO&lt;/NAME&gt;
          &lt;/COL_LIST_ITEM&gt;
        &lt;/COL_LIST&gt;
      &lt;/PRIMARY_KEY_CONSTRAINT_LIST_ITEM&gt;
    &lt;/PRIMARY_KEY_CONSTRAINT_LIST&gt;
  &lt;/RELATIONAL_TABLE&gt;
&lt;/TABLE&gt;
 
1 row selected.
 </pre><p>The SXML difference document shows the union of the two SXML documents, with the XML attributes <code class="codeph">value1</code> and <code class="codeph">src</code> identifying the differences. When an element exists in only one document it is marked with <code class="codeph">src</code>. Thus, <code class="codeph">&lt;COL_LIST_ITEM src="1"&gt;</code> means that this element is in the first document (<code class="codeph">TAB1</code>) but not in the second. When an element is present in both documents but with different values, the element's value is the value in the second document and the <code class="codeph">value1</code> gives its value in the first. For example, <code class="codeph">&lt;LENGTH value1="10"&gt;20&lt;/LENGTH&gt;</code> means that the length is 10 in <code class="codeph">TAB1</code> (the first document) and 20 in <code class="codeph">TAB2</code>.
                           </p>
                        </li>
                        <li>
                           <p>Compare the result using the <code class="codeph">DBMS_METADATA_DIFF</code> browsing APIs:
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT dbms_metadata_diff.compare_sxml('TABLE','TAB1','TAB2') FROM dual;
</pre></li>
                        <li>
                           <p>Create a function using the <code class="codeph">DBMS_METADATA.CONVERT</code> API to generate an ALTERXML document. This is an XML document containing <code class="codeph">ALTER</code> statements to make one object like another. You can also use parse items to get information about the individual <code class="codeph">ALTER</code> statements. (This example uses the functions defined thus far.)
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; CREATE OR REPLACE FUNCTION get_table_alterxml(name1 IN VARCHAR2,
  2                                           name2 IN VARCHAR2) RETURN CLOB IS
  3   diffdoc CLOB;
  4   openw_handle NUMBER;
  5   transform_handle NUMBER;
  6   alterxml CLOB;
  7  BEGIN
  8   --
  9   -- Use the function just defined to get the difference document
 10   --
 11   diffdoc := compare_table_sxml(name1,name2);
 12   --
 13   -- Specify the object type in the OPENW call
 14   --
 15   openw_handle := DBMS_METADATA.OPENW('TABLE');
 16   --
 17   -- Use the ALTERXML transform to generate the ALTER_XML document
 18   --
 19   transform_handle := DBMS_METADATA.ADD_TRANSFORM(openw_handle,'ALTERXML');
 20   --
 21   -- Request parse items
 22   --
 23   DBMS_METADATA.SET_PARSE_ITEM(openw_handle,'CLAUSE_TYPE');
 24   DBMS_METADATA.SET_PARSE_ITEM(openw_handle,'NAME');
 25   DBMS_METADATA.SET_PARSE_ITEM(openw_handle,'COLUMN_ATTRIBUTE');
 26   --
 27   -- Create a temporary LOB
 28   --
 29   DBMS_LOB.CREATETEMPORARY(alterxml, TRUE );
 30   --
 31   -- Call CONVERT to do the transform
 32   --
 33   DBMS_METADATA.CONVERT(openw_handle,diffdoc,alterxml);
 34   --
 35   -- Close context and return the result
 36   --
 37   DBMS_METADATA.CLOSE(openw_handle);
 38   RETURN alterxml;
 39  END;
 40  /
 
Function created.
</pre></li>
                        <li>
                           <p>Use the function to fetch the ALTER_XML document:</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT get_table_alterxml('TAB1','TAB2') FROM dual;
 
&lt;ALTER_XML xmlns="http://xmlns.oracle.com/ku" version="1.0"&gt;
   &lt;OBJECT_TYPE&gt;TABLE&lt;/OBJECT_TYPE&gt;
   &lt;OBJECT1&gt;
      &lt;SCHEMA&gt;SCOTT&lt;/SCHEMA&gt;
      &lt;NAME&gt;TAB1&lt;/NAME&gt;
   &lt;/OBJECT1&gt;
   &lt;OBJECT2&gt;
      &lt;SCHEMA&gt;SCOTT&lt;/SCHEMA&gt;
      &lt;NAME&gt;TAB2&lt;/NAME&gt;
   &lt;/OBJECT2&gt;
   &lt;ALTER_LIST&gt;
      &lt;ALTER_LIST_ITEM&gt;
         &lt;PARSE_LIST&gt;
            &lt;PARSE_LIST_ITEM&gt;
               &lt;ITEM&gt;NAME&lt;/ITEM&gt;
               &lt;VALUE&gt;MGR&lt;/VALUE&gt;
            &lt;/PARSE_LIST_ITEM&gt;
            &lt;PARSE_LIST_ITEM&gt;
               &lt;ITEM&gt;CLAUSE_TYPE&lt;/ITEM&gt;
               &lt;VALUE&gt;ADD_COLUMN&lt;/VALUE&gt;
            &lt;/PARSE_LIST_ITEM&gt;
         &lt;/PARSE_LIST&gt;
         &lt;SQL_LIST&gt;
            &lt;SQL_LIST_ITEM&gt;
               &lt;TEXT&gt;ALTER TABLE "SCOTT"."TAB1" ADD ("MGR" NUMBER(4,0))&lt;/TEXT&gt;
            &lt;/SQL_LIST_ITEM&gt;
         &lt;/SQL_LIST&gt;
      &lt;/ALTER_LIST_ITEM&gt;
      &lt;ALTER_LIST_ITEM&gt;
         &lt;PARSE_LIST&gt;
            &lt;PARSE_LIST_ITEM&gt;
               &lt;ITEM&gt;NAME&lt;/ITEM&gt;
               &lt;VALUE&gt;JOB&lt;/VALUE&gt;
            &lt;/PARSE_LIST_ITEM&gt;
            &lt;PARSE_LIST_ITEM&gt;
               &lt;ITEM&gt;CLAUSE_TYPE&lt;/ITEM&gt;
               &lt;VALUE&gt;DROP_COLUMN&lt;/VALUE&gt;
            &lt;/PARSE_LIST_ITEM&gt;
         &lt;/PARSE_LIST&gt;
         &lt;SQL_LIST&gt;
            &lt;SQL_LIST_ITEM&gt;
               &lt;TEXT&gt;ALTER TABLE "SCOTT"."TAB1" DROP ("JOB")&lt;/TEXT&gt;
            &lt;/SQL_LIST_ITEM&gt;
         &lt;/SQL_LIST&gt;
      &lt;/ALTER_LIST_ITEM&gt;
      &lt;ALTER_LIST_ITEM&gt;
         &lt;PARSE_LIST&gt;
            &lt;PARSE_LIST_ITEM&gt;
               &lt;ITEM&gt;NAME&lt;/ITEM&gt;
               &lt;VALUE&gt;ENAME&lt;/VALUE&gt;
            &lt;/PARSE_LIST_ITEM&gt;
            &lt;PARSE_LIST_ITEM&gt;
               &lt;ITEM&gt;CLAUSE_TYPE&lt;/ITEM&gt;
               &lt;VALUE&gt;MODIFY_COLUMN&lt;/VALUE&gt;
            &lt;/PARSE_LIST_ITEM&gt;
            &lt;PARSE_LIST_ITEM&gt;
               &lt;ITEM&gt;COLUMN_ATTRIBUTE&lt;/ITEM&gt;
               &lt;VALUE&gt; SIZE_INCREASE&lt;/VALUE&gt;
            &lt;/PARSE_LIST_ITEM&gt;
         &lt;/PARSE_LIST&gt;
         &lt;SQL_LIST&gt;
            &lt;SQL_LIST_ITEM&gt;
               &lt;TEXT&gt;ALTER TABLE "SCOTT"."TAB1" MODIFY 
                    ("ENAME" VARCHAR2(20))
               &lt;/TEXT&gt;
            &lt;/SQL_LIST_ITEM&gt;
         &lt;/SQL_LIST&gt;
      &lt;/ALTER_LIST_ITEM&gt;
      &lt;ALTER_LIST_ITEM&gt;
         &lt;PARSE_LIST&gt;
            &lt;PARSE_LIST_ITEM&gt;
               &lt;ITEM&gt;CLAUSE_TYPE&lt;/ITEM&gt;
               &lt;VALUE&gt;ADD_CONSTRAINT&lt;/VALUE&gt;
            &lt;/PARSE_LIST_ITEM&gt;
         &lt;/PARSE_LIST&gt;
         &lt;SQL_LIST&gt;
            &lt;SQL_LIST_ITEM&gt;
               &lt;TEXT&gt;ALTER TABLE "SCOTT"."TAB1" ADD  PRIMARY KEY
                     ("EMPNO") ENABLE
               &lt;/TEXT&gt;
            &lt;/SQL_LIST_ITEM&gt;
         &lt;/SQL_LIST&gt;
      &lt;/ALTER_LIST_ITEM&gt;
      &lt;ALTER_LIST_ITEM&gt;
         &lt;PARSE_LIST&gt;
            &lt;PARSE_LIST_ITEM&gt;
               &lt;ITEM&gt;NAME&lt;/ITEM&gt;
               &lt;VALUE&gt;TAB1&lt;/VALUE&gt;
            &lt;/PARSE_LIST_ITEM&gt;
            &lt;PARSE_LIST_ITEM&gt;
               &lt;ITEM&gt;CLAUSE_TYPE&lt;/ITEM&gt;
               &lt;VALUE&gt;RENAME_TABLE&lt;/VALUE&gt;
            &lt;/PARSE_LIST_ITEM&gt;
         &lt;/PARSE_LIST&gt;
         &lt;SQL_LIST&gt;
            &lt;SQL_LIST_ITEM&gt;
               &lt;TEXT&gt;ALTER TABLE "SCOTT"."TAB1" RENAME TO "TAB2"&lt;/TEXT&gt;
            &lt;/SQL_LIST_ITEM&gt;
         &lt;/SQL_LIST&gt;
      &lt;/ALTER_LIST_ITEM&gt;
   &lt;/ALTER_LIST&gt;
&lt;/ALTER_XML&gt;
 
 
1 row selected.
 </pre></li>
                        <li>
                           <p>Compare the result using the <code class="codeph">DBMS_METADATA_DIFF</code> browsing API:
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT dbms_metadata_diff.compare_alter_xml('TABLE','TAB1','TAB2') FROM dual;
</pre></li>
                        <li>
                           <p>The ALTER_XML document contains an ALTER_LIST of each of the alters. Each ALTER_LIST_ITEM has a PARSE_LIST containing the parse items as name-value pairs and a SQL_LIST containing the SQL for the particular alter. You can parse this document and decide which of the SQL statements to execute, using the information in the PARSE_LIST. (Note, for example, that in this case one of the alters is a DROP_COLUMN, and you might choose not to execute that.)</p>
                        </li>
                        <li>
                           <p> Create one last function that uses the <code class="codeph">DBMS_METADATA.CONVERT</code> API and the <code class="codeph">ALTER DDL</code> transform to convert the ALTER_XML document into SQL DDL:
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; CREATE OR REPLACE FUNCTION get_table_alterddl(name1 IN VARCHAR2,
  2                                           name2 IN VARCHAR2) RETURN CLOB IS
  3   alterxml CLOB;
  4   openw_handle NUMBER;
  5   transform_handle NUMBER;
  6   alterddl CLOB;
  7  BEGIN
  8   --
  9   -- Use the function just defined to get the ALTER_XML document
 10   --
 11   alterxml := get_table_alterxml(name1,name2);
 12   --
 13   -- Specify the object type in the OPENW call
 14   --
 15   openw_handle := DBMS_METADATA.OPENW('TABLE');
 16   --
 17   -- Use ALTERDDL transform to convert the ALTER_XML document to SQL DDL
 18   -- 
 19   transform_handle := DBMS_METADATA.ADD_TRANSFORM(openw_handle,'ALTERDDL');
 20   --
 21   -- Use the SQLTERMINATOR transform parameter to append a terminator
 22   -- to each SQL statement
 23   --
 24   DBMS_METADATA.SET_TRANSFORM_PARAM(transform_handle,'SQLTERMINATOR',true);
 25   --
 26   -- Create a temporary lob
 27   --
 28   DBMS_LOB.CREATETEMPORARY(alterddl, TRUE );
 29   --
 30   -- Call CONVERT to do the transform
 31   --
 32   DBMS_METADATA.CONVERT(openw_handle,alterxml,alterddl);
 33   --
 34   -- Close context and return the result
 35   --
 36   DBMS_METADATA.CLOSE(openw_handle);
 37   RETURN alterddl;
 38  END;
 39  /
 
Function created.
 </pre></li>
                        <li>
                           <p>Use the function to fetch the SQL ALTER statements:</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT get_table_alterddl('TAB1','TAB2') FROM dual;
ALTER TABLE "SCOTT"."TAB1" ADD ("MGR" NUMBER(4,0))
/
  ALTER TABLE "SCOTT"."TAB1" DROP ("JOB")
/
  ALTER TABLE "SCOTT"."TAB1" MODIFY ("ENAME" VARCHAR2(20))
/
  ALTER TABLE "SCOTT"."TAB1" ADD  PRIMARY KEY ("EMPNO") ENABLE
/
  ALTER TABLE "SCOTT"."TAB1" RENAME TO "TAB2"
/
  
1 row selected.
 </pre></li>
                        <li>
                           <p>Compare the results using the <code class="codeph">DBMS_METADATA_DIFF</code> browsing API:
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT dbms_metadata_diff.compare_alter('TABLE','TAB1','TAB2') FROM dual;
ALTER TABLE "SCOTT"."TAB1" ADD ("MGR" NUMBER(4,0))
  ALTER TABLE "SCOTT"."TAB1" DROP ("JOB")
  ALTER TABLE "SCOTT"."TAB1" MODIFY ("ENAME" VARCHAR2(20))
  ALTER TABLE "SCOTT"."TAB1" ADD  PRIMARY KEY ("EMPNO") USING INDEX 
  PCTFREE 10 INITRANS 2 STORAGE ( INITIAL 16384 NEXT 16384 MINEXTENTS 1
  MAXEXTENTS 505 PCTINCREASE 50 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL
  DEFAULT)  ENABLE ALTER TABLE "SCOTT"."TAB1" RENAME TO "TAB2"
 
1 row selected.</pre></li>
                     </ol>
                  </div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-oracle-dbms_metadata-api.html#GUID-D9B1300F-B21D-416E-8B9B-C542195EF249" title="Using the DBMS_METADATA APIs.">Using the Metadata APIs</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="SUTIL1632"></a><div class="props_rev_3"><a id="GUID-DF431094-5F1D-478D-87E6-04CC774B761F" name="GUID-DF431094-5F1D-478D-87E6-04CC774B761F"></a><h3 id="SUTIL-GUID-DF431094-5F1D-478D-87E6-04CC774B761F" class="sect3"><span class="enumeration_section">23.7 </span>Performance Tips for the Programmatic Interface of the DBMS_METADATA API
               </h3>
               <div>
                  <p> Describes how to enhance performance when using the programmatic interface of the <code class="codeph">DBMS_METADATA</code> API.
                  </p>
                  <p>Specifically:</p>
                  <ol>
                     <li>
                        <p>Fetch all of one type of object before fetching the next. For example, if you are retrieving the definitions of all objects in your schema, first fetch all tables, then all indexes, then all triggers, and so on. This will be much faster than nesting <code class="codeph">OPEN</code> contexts; that is, fetch one table then all of its indexes, grants, and triggers, then the next table and all of its indexes, grants, and triggers, and so on. <a href="using-oracle-dbms_metadata-api.html#GUID-89237236-4729-4E33-842D-D124A3C15B10" title="Example of how the DBMS_METADATA API could be used.">Example Usage of the DBMS_METADATA API</a> reflects this second, less efficient means, but its purpose is to demonstrate most of the programmatic calls, which are best shown by this method.
                        </p>
                     </li>
                     <li>
                        <p>Use the <code class="codeph">SET_COUNT</code> procedure to retrieve more than one object at a time. This minimizes server round trips and eliminates many redundant function calls.
                        </p>
                     </li>
                     <li>
                        <p>When writing a PL/SQL package that calls the <code class="codeph">DBMS_METADATA</code> API, declare LOB variables and objects that contain LOBs (such as <code class="codeph">SYS</code>.<code class="codeph">KU</code>$<code class="codeph">_DDLS</code>) at package scope rather than within individual functions. This eliminates the creation and deletion of LOB duration structures upon function entrance and exit, which are very expensive operations. 
                        </p>
                     </li>
                  </ol>
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-oracle-dbms_metadata-api.html#GUID-D9B1300F-B21D-416E-8B9B-C542195EF249" title="Using the DBMS_METADATA APIs.">Using the Metadata APIs</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="SUTIL1633"></a><div class="props_rev_3"><a id="GUID-89237236-4729-4E33-842D-D124A3C15B10" name="GUID-89237236-4729-4E33-842D-D124A3C15B10"></a><h3 id="SUTIL-GUID-89237236-4729-4E33-842D-D124A3C15B10" class="sect3"><span class="enumeration_section">23.8 </span>Example Usage of the DBMS_METADATA API
               </h3>
               <div>
                  <p>Example of how the <code class="codeph">DBMS_METADATA</code> API could be used. 
                  </p>
                  <p>A script is provided that automatically runs the demo for you by performing the following actions:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Establishes a schema (<code class="codeph">MDDEMO</code>) and some payroll users.
                        </p>
                     </li>
                     <li>
                        <p>Creates three payroll-like tables within the schema and any associated indexes, triggers, and grants.</p>
                     </li>
                     <li>
                        <p>Creates a package, <code class="codeph">PAYROLL_DEMO</code>, that uses the <code class="codeph">DBMS_METADATA</code> API. The <code class="codeph">PAYROLL_DEMO</code> package contains a procedure, <code class="codeph">GET_PAYROLL_TABLES,</code> that retrieves the DDL for the two tables in the <code class="codeph">MDDEMO</code> schema that start with <code class="codeph">PAYROLL</code>. For each table, it retrieves the DDL for the table's associated dependent objects; indexes, grants, and triggers. All the DDL is written to a table named <code class="codeph">MDDEMO</code>.<code class="codeph">DDL</code>.
                        </p>
                     </li>
                  </ul>
                  <p>To execute the example, do the following:</p>
                  <ol>
                     <li>
                        <p>Start SQL*Plus as user <code class="codeph">system</code>. You will be prompted for a password.
                        </p><pre class="oac_no_warn" dir="ltr">sqlplus system
</pre></li>
                     <li>
                        <p>Install the demo, which is located in the file <code class="codeph">mddemo.sql</code> in <code class="codeph">rdbms</code>/<code class="codeph">demo</code>:
                        </p><pre class="oac_no_warn" dir="ltr">SQL&gt; @mddemo
</pre><p>For an explanation of what happens during this step, see <a href="using-oracle-dbms_metadata-api.html#GUID-7EE1E557-F95C-4C01-946E-5A9B4B6E41E7" title="Explanation of the DBMS_METADATA example.">What Does the DBMS_METADATA Example Do?</a>.
                        </p>
                     </li>
                     <li>
                        <p>Connect as user <code class="codeph">mddemo</code>. You will be prompted for a password, which is also <code class="codeph">mddemo</code>.
                        </p><pre class="oac_no_warn" dir="ltr">SQL&gt; CONNECT mddemo
Enter password:
</pre></li>
                     <li>
                        <p>Set the following parameters so that query output will be complete and readable:</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SET PAGESIZE 0
SQL&gt; SET LONG 1000000
</pre></li>
                     <li>
                        <p>Execute the <code class="codeph">GET_PAYROLL_TABLES</code> procedure, as follows:
                        </p><pre class="oac_no_warn" dir="ltr">SQL&gt; CALL payroll_demo.get_payroll_tables();
</pre></li>
                     <li>
                        <p>Execute the following SQL query: </p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT ddl FROM DDL ORDER BY SEQNO;
</pre><p>The output generated is the result of the execution of the <code class="codeph">GET_PAYROLL_TABLES</code> procedure. It shows all the DDL that was performed in Step 2 when the demo was installed. See <a href="using-oracle-dbms_metadata-api.html#GUID-D807A5A4-4809-4424-AA53-68081627A308" title="Explanation of the output generated from the GET_PAYROLL_TABLES procedure.">Output Generated from the GET_PAYROLL_TABLES Procedure </a> for a listing of the actual output.
                        </p>
                     </li>
                  </ol>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="using-oracle-dbms_metadata-api.html#GUID-7EE1E557-F95C-4C01-946E-5A9B4B6E41E7">What Does the DBMS_METADATA Example Do?</a><br>Explanation of the <code class="codeph">DBMS_METADATA</code> example.
                     </li>
                     <li class="ulchildlink"><a href="using-oracle-dbms_metadata-api.html#GUID-D807A5A4-4809-4424-AA53-68081627A308">Output Generated from the GET_PAYROLL_TABLES Procedure</a><br>Explanation of the output generated from the <code class="codeph">GET_PAYROLL_TABLES</code> procedure.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-oracle-dbms_metadata-api.html#GUID-D9B1300F-B21D-416E-8B9B-C542195EF249" title="Using the DBMS_METADATA APIs.">Using the Metadata APIs</a></p>
                     </div>
                  </div>
               </div>
               <a id="SUTIL1634"></a><div class="props_rev_3"><a id="GUID-7EE1E557-F95C-4C01-946E-5A9B4B6E41E7" name="GUID-7EE1E557-F95C-4C01-946E-5A9B4B6E41E7"></a><h4 id="SUTIL-GUID-7EE1E557-F95C-4C01-946E-5A9B4B6E41E7" class="sect4"><span class="enumeration_section">23.8.1 </span>What Does the DBMS_METADATA Example Do?
                  </h4>
                  <div>
                     <p>Explanation of the <code class="codeph">DBMS_METADATA</code> example.
                     </p>
                     <p>When the <code class="codeph">mddemo</code> script is run, the following steps take place. You can adapt these steps to your own situation.
                     </p>
                     <ol>
                        <li>
                           <p>Drops users as follows, if they exist. This will ensure that you are starting out with fresh data. If the users do not exist, then a message to that effect is displayed, no harm is done, and the demo continues to execute.</p><pre class="oac_no_warn" dir="ltr">CONNECT system
Enter password: <span class="italic">password</span>
SQL&gt; DROP USER mddemo CASCADE;
SQL&gt; DROP USER mddemo_clerk CASCADE;
SQL&gt; DROP USER mddemo_mgr CASCADE;
</pre></li>
                        <li>
                           <p>Creates user <code class="codeph">mddemo</code>, identified by <code class="codeph">mddemo</code>:
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; CREATE USER mddemo IDENTIFIED BY mddemo;
SQL&gt; GRANT resource, connect, create session,
  1     create table,
  2     create procedure, 
  3     create sequence,
  4     create trigger,
  5     create view,
  6     create synonym,
  7     alter session,
  8  TO mddemo;
</pre></li>
                        <li>
                           <p>Creates user <code class="codeph">mddemo_clerk</code>, identified by <code class="codeph">clerk</code>:
                           </p><pre class="oac_no_warn" dir="ltr">CREATE USER mddemo_clerk IDENTIFIED BY clerk;
</pre></li>
                        <li>
                           <p>Creates user <code class="codeph">mddemo_mgr</code>, identified by <code class="codeph">mgr</code>:
                           </p><pre class="oac_no_warn" dir="ltr">CREATE USER mddemo_mgr IDENTIFIED BY mgr;
</pre></li>
                        <li>
                           <p>Connect to SQL*Plus as <code class="codeph">mddemo</code> (the password is also <code class="codeph">mddemo</code>):
                           </p><pre class="oac_no_warn" dir="ltr">CONNECT mddemo
Enter password:
</pre></li>
                        <li>
                           <p>Creates some payroll-type tables:</p><pre class="oac_no_warn" dir="ltr">SQL&gt; CREATE TABLE payroll_emps
  2  ( lastname VARCHAR2(60) NOT NULL,
  3  firstname VARCHAR2(20) NOT NULL,
  4  mi VARCHAR2(2),
  5  suffix VARCHAR2(10),
  6  dob DATE NOT NULL,
  7  badge_no NUMBER(6) PRIMARY KEY,
  8  exempt VARCHAR(1) NOT NULL,
  9  salary NUMBER (9,2),
  10 hourly_rate NUMBER (7,2) )
  11 /

SQL&gt; CREATE TABLE payroll_timecards 
  2  (badge_no NUMBER(6) REFERENCES payroll_emps (badge_no),
  3  week NUMBER(2),
  4  job_id NUMBER(5),
  5  hours_worked NUMBER(4,2) )
  6 /
</pre></li>
                        <li>
                           <p>Creates a dummy table, <code class="codeph">audit_trail</code>. This table is used to show that tables that do not start with <code class="codeph">payroll</code> are not retrieved by the <code class="codeph">GET_PAYROLL_TABLES</code> procedure.
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; CREATE TABLE audit_trail 
  2  (action_time DATE,
  3  lastname VARCHAR2(60),
  4  action LONG )
  5  /
</pre></li>
                        <li>
                           <p>Creates some grants on the tables just created:</p><pre class="oac_no_warn" dir="ltr">SQL&gt; GRANT UPDATE (salary,hourly_rate) ON payroll_emps TO mddemo_clerk;
SQL&gt; GRANT ALL ON payroll_emps TO mddemo_mgr WITH GRANT OPTION;

SQL&gt; GRANT INSERT,UPDATE ON payroll_timecards TO mddemo_clerk;
SQL&gt; GRANT ALL ON payroll_timecards TO mddemo_mgr WITH GRANT OPTION;
</pre></li>
                        <li>
                           <p>Creates some indexes on the tables just created:</p><pre class="oac_no_warn" dir="ltr">SQL&gt; CREATE INDEX i_payroll_emps_name ON payroll_emps(lastname);
SQL&gt; CREATE INDEX i_payroll_emps_dob ON payroll_emps(dob);
SQL&gt; CREATE INDEX i_payroll_timecards_badge ON payroll_timecards(badge_no);
</pre></li>
                        <li>
                           <p>Creates some triggers on the tables just created:</p><pre class="oac_no_warn" dir="ltr">SQL&gt; CREATE OR REPLACE PROCEDURE check_sal( salary in number) AS BEGIN
  2  RETURN;
  3  END;
  4  /
</pre><p>Note that the security is kept fairly loose to keep the example simple.</p><pre class="oac_no_warn" dir="ltr">SQL&gt; CREATE OR REPLACE TRIGGER salary_trigger BEFORE INSERT OR UPDATE OF salary
ON payroll_emps
FOR EACH ROW WHEN (new.salary &gt; 150000)
CALL check_sal(:new.salary)
/

SQL&gt; CREATE OR REPLACE TRIGGER hourly_trigger BEFORE UPDATE OF hourly_rate ON payroll_emps
FOR EACH ROW
BEGIN :new.hourly_rate:=:old.hourly_rate;END;
/
</pre></li>
                        <li>
                           <p>Sets up a table to hold the generated DDL:</p><pre class="oac_no_warn" dir="ltr">CREATE TABLE ddl (ddl CLOB, seqno NUMBER);
</pre></li>
                        <li>
                           <p>Creates the <code class="codeph">PAYROLL_DEMO</code> package, which provides examples of how <code class="codeph">DBMS_METADATA</code> procedures can be used.
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; CREATE OR REPLACE PACKAGE payroll_demo AS PROCEDURE get_payroll_tables;
END;
/</pre><div class="infoboxnote" id="GUID-7EE1E557-F95C-4C01-946E-5A9B4B6E41E7__GUID-4EC4DCBB-C9E2-42F5-9276-040689EBF59D">
                              <p class="notep1">Note:</p>
                              <p>To see the entire script for this example, including the contents of the <code class="codeph">PAYROLL_DEMO</code> package, see the file <code class="codeph">mddemo.sql</code> located in your $<code class="codeph">ORACLE_HOME/rdbms/demo</code> directory.
                              </p>
                           </div>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="using-oracle-dbms_metadata-api.html#GUID-89237236-4729-4E33-842D-D124A3C15B10" title="Example of how the DBMS_METADATA API could be used.">Example Usage of the DBMS_METADATA API</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="SUTIL1635"></a><div class="props_rev_3"><a id="GUID-D807A5A4-4809-4424-AA53-68081627A308" name="GUID-D807A5A4-4809-4424-AA53-68081627A308"></a><h4 id="SUTIL-GUID-D807A5A4-4809-4424-AA53-68081627A308" class="sect4"><span class="enumeration_section">23.8.2 </span>Output Generated from the GET_PAYROLL_TABLES Procedure 
                  </h4>
                  <div>
                     <p>Explanation of the output generated from the <code class="codeph">GET_PAYROLL_TABLES</code> procedure.
                     </p>
                     <p>After you execute the <code class="codeph">mddemo.payroll_demo.get_payroll_tables </code>procedure, you can execute the following query:
                     </p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT ddl FROM ddl ORDER BY seqno;
</pre><p>The results are as follows, which reflect all the DDL executed by the script as described in the previous section.</p><pre class="oac_no_warn" dir="ltr">CREATE TABLE "MDDEMO"."PAYROLL_EMPS"
   (    "LASTNAME" VARCHAR2(60) NOT NULL ENABLE,
        "FIRSTNAME" VARCHAR2(20) NOT NULL ENABLE,
        "MI" VARCHAR2(2),
        "SUFFIX" VARCHAR2(10),
        "DOB" DATE NOT NULL ENABLE,
        "BADGE_NO" NUMBER(6,0),
        "EXEMPT" VARCHAR2(1) NOT NULL ENABLE,
        "SALARY" NUMBER(9,2),
        "HOURLY_RATE" NUMBER(7,2),
 PRIMARY KEY ("BADGE_NO") ENABLE
   ) ;

  GRANT UPDATE ("SALARY") ON "MDDEMO"."PAYROLL_EMPS" TO "MDDEMO_CLERK";
  GRANT UPDATE ("HOURLY_RATE") ON "MDDEMO"."PAYROLL_EMPS" TO "MDDEMO_CLERK";
  GRANT ALTER ON "MDDEMO"."PAYROLL_EMPS" TO "MDDEMO_MGR" WITH GRANT OPTION;
  GRANT DELETE ON "MDDEMO"."PAYROLL_EMPS" TO "MDDEMO_MGR" WITH GRANT OPTION;
  GRANT INDEX ON "MDDEMO"."PAYROLL_EMPS" TO "MDDEMO_MGR" WITH GRANT OPTION;
  GRANT INSERT ON "MDDEMO"."PAYROLL_EMPS" TO "MDDEMO_MGR" WITH GRANT OPTION;
  GRANT SELECT ON "MDDEMO"."PAYROLL_EMPS" TO "MDDEMO_MGR" WITH GRANT OPTION;
  GRANT UPDATE ON "MDDEMO"."PAYROLL_EMPS" TO "MDDEMO_MGR" WITH GRANT OPTION;
  GRANT REFERENCES ON "MDDEMO"."PAYROLL_EMPS" TO "MDDEMO_MGR" WITH GRANT OPTION;
  GRANT ON COMMIT REFRESH ON "MDDEMO"."PAYROLL_EMPS" TO "MDDEMO_MGR" WITH GRANT OPTION;
  GRANT QUERY REWRITE ON "MDDEMO"."PAYROLL_EMPS" TO "MDDEMO_MGR" WITH GRANT OPTION;

  CREATE INDEX "MDDEMO"."I_PAYROLL_EMPS_DOB" ON "MDDEMO"."PAYROLL_EMPS" ("DOB")
  PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 10240 NEXT 10240 MINEXTENTS 1 MAXEXTENTS 121 PCTINCREASE 50
  FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT) TABLESPACE "SYSTEM" ;


  CREATE INDEX "MDDEMO"."I_PAYROLL_EMPS_NAME" ON "MDDEMO"."PAYROLL_EMPS" ("LASTNAME")
  PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 10240 NEXT 10240 MINEXTENTS 1 MAXEXTENTS 121 PCTINCREASE 50
  FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT) TABLESPACE "SYSTEM" ;

  CREATE OR REPLACE TRIGGER hourly_trigger before update of hourly_rate on payroll_emps
for each row
begin :new.hourly_rate:=:old.hourly_rate;end;
/
ALTER TRIGGER "MDDEMO"."HOURLY_TRIGGER" ENABLE;

  CREATE OR REPLACE TRIGGER salary_trigger before insert or update of salary on payroll_emps
for each row  
WHEN (new.salary &gt; 150000)  CALL check_sal(:new.salary)
/
ALTER TRIGGER "MDDEMO"."SALARY_TRIGGER" ENABLE;


CREATE TABLE "MDDEMO"."PAYROLL_TIMECARDS"
   (    "BADGE_NO" NUMBER(6,0),
        "WEEK" NUMBER(2,0),
        "JOB_ID" NUMBER(5,0),
        "HOURS_WORKED" NUMBER(4,2),
 FOREIGN KEY ("BADGE_NO")
  REFERENCES "MDDEMO"."PAYROLL_EMPS" ("BADGE_NO") ENABLE
   ) ;

  GRANT INSERT ON "MDDEMO"."PAYROLL_TIMECARDS" TO "MDDEMO_CLERK";
  GRANT UPDATE ON "MDDEMO"."PAYROLL_TIMECARDS" TO "MDDEMO_CLERK";
  GRANT ALTER ON "MDDEMO"."PAYROLL_TIMECARDS" TO "MDDEMO_MGR" WITH GRANT OPTION;
  GRANT DELETE ON "MDDEMO"."PAYROLL_TIMECARDS" TO "MDDEMO_MGR" WITH GRANT OPTION;
  GRANT INDEX ON "MDDEMO"."PAYROLL_TIMECARDS" TO "MDDEMO_MGR" WITH GRANT OPTION;
  GRANT INSERT ON "MDDEMO"."PAYROLL_TIMECARDS" TO "MDDEMO_MGR" WITH GRANT OPTION;
  GRANT SELECT ON "MDDEMO"."PAYROLL_TIMECARDS" TO "MDDEMO_MGR" WITH GRANT OPTION;
  GRANT UPDATE ON "MDDEMO"."PAYROLL_TIMECARDS" TO "MDDEMO_MGR" WITH GRANT OPTION;
  GRANT REFERENCES ON "MDDEMO"."PAYROLL_TIMECARDS" TO "MDDEMO_MGR" WITH GRANT OPTION;
  GRANT ON COMMIT REFRESH ON "MDDEMO"."PAYROLL_TIMECARDS" TO "MDDEMO_MGR" WITH GRANT OPTION;
  GRANT QUERY REWRITE ON "MDDEMO"."PAYROLL_TIMECARDS" TO "MDDEMO_MGR" WITH GRANT OPTION;

  CREATE INDEX "MDDEMO"."I_PAYROLL_TIMECARDS_BADGE" ON "MDDEMO"."PAYROLL_TIMECARDS" ("BADGE_NO")
  PCTFREE 10 INITRANS 2 MAXTRANS 255
  STORAGE(INITIAL 10240 NEXT 10240 MINEXTENTS 1 MAXEXTENTS 121 PCTINCREASE 50
  FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT) TABLESPACE "SYSTEM" ;</pre></div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="using-oracle-dbms_metadata-api.html#GUID-89237236-4729-4E33-842D-D124A3C15B10" title="Example of how the DBMS_METADATA API could be used.">Example Usage of the DBMS_METADATA API</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="SUTIL3629"></a><a id="SUTIL3630"></a><a id="SUTIL3631"></a><a id="SUTIL1636"></a><div class="props_rev_2"><a id="GUID-B19C59EB-A9BC-4D1E-BD8C-135583D403CD" name="GUID-B19C59EB-A9BC-4D1E-BD8C-135583D403CD"></a><h3 id="SUTIL-GUID-B19C59EB-A9BC-4D1E-BD8C-135583D403CD" class="sect3"><span class="enumeration_section">23.9 </span>Summary of DBMS_METADATA Procedures
               </h3>
               <div>
                  <p>Provides brief descriptions of the procedures provided by the <code class="codeph">DBMS_METADATA</code> API. 
                  </p>
                  <div class="section">
                     <p>For detailed descriptions of these procedures, see<a href="../arpls/DBMS_METADATA.html#ARPLS026" target="_blank"><span class="italic"> Oracle Database PL/SQL Packages and Types Reference.</span></a></p>
                     <p>The following table provides a brief description of the procedures provided by the <code class="codeph">DBMS_METADATA</code> programmatic interface for retrieving multiple objects.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="tblformalwide" id="GUID-B19C59EB-A9BC-4D1E-BD8C-135583D403CD__G1029894">
                     <p class="titleintable">Table 23-1 DBMS_METADATA Procedures Used for Retrieving Multiple Objects</p>
                     <table cellpadding="4" cellspacing="0" class="FormalWide" title="DBMS_METADATA Procedures Used for Retrieving Multiple Objects" summary="DBMS_METADATA procedures used for retrieving multiple objects" width="100%" frame="hsides" border="1" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="41%" id="d145430e2268">PL/SQL Procedure Name</th>
                              <th align="left" valign="bottom" width="59%" id="d145430e2271">Description</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="41%" id="d145430e2276" headers="d145430e2268 "><pre class="oac_no_warn" dir="ltr">DBMS_METADATA.OPEN()</pre></td>
                              <td align="left" valign="top" width="59%" headers="d145430e2276 d145430e2271 ">
                                 <p>Specifies the type of object to be retrieved, the version of its metadata, and the object model.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="41%" id="d145430e2283" headers="d145430e2268 "><pre class="oac_no_warn" dir="ltr">DBMS_METADATA.SET_FILTER()</pre></td>
                              <td align="left" valign="top" width="59%" headers="d145430e2283 d145430e2271 ">
                                 <p>Specifies restrictions on the objects to be retrieved, for example, the object name or schema.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="41%" id="d145430e2290" headers="d145430e2268 "><pre class="oac_no_warn" dir="ltr">DBMS_METADATA.SET_COUNT()</pre></td>
                              <td align="left" valign="top" width="59%" headers="d145430e2290 d145430e2271 ">
                                 <p>Specifies the maximum number of objects to be retrieved in a single <code class="codeph">FETCH_xxx</code> call.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="41%" id="d145430e2300" headers="d145430e2268 "><pre class="oac_no_warn" dir="ltr">DBMS_METADATA.GET_QUERY()</pre></td>
                              <td align="left" valign="top" width="59%" headers="d145430e2300 d145430e2271 ">
                                 <p>Returns the text of the queries that are used by <code class="codeph">FETCH_xxx</code>. You can use this as a debugging aid.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="41%" id="d145430e2310" headers="d145430e2268 "><pre class="oac_no_warn" dir="ltr">DBMS_METADATA.SET_PARSE_ITEM()</pre></td>
                              <td align="left" valign="top" width="59%" headers="d145430e2310 d145430e2271 ">
                                 <p>Enables output parsing by specifying an object attribute to be parsed and returned. You can query the <code class="codeph">DBMS_METADATA_PARSE_ITEMS</code> to see all valid parse items.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="41%" id="d145430e2320" headers="d145430e2268 "><pre class="oac_no_warn" dir="ltr">DBMS_METADATA.ADD_TRANSFORM()</pre></td>
                              <td align="left" valign="top" width="59%" headers="d145430e2320 d145430e2271 ">
                                 <p>Specifies a transform that <code class="codeph">FETCH_xxx</code> applies to the XML representation of the retrieved objects. You can query the <code class="codeph">DBMS_METADATA_TRANSFORMS</code> view to see all valid Oracle-supplied transforms.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="41%" id="d145430e2333" headers="d145430e2268 "><pre class="oac_no_warn" dir="ltr">DBMS_METADATA.SET_TRANSFORM_PARAM()</pre></td>
                              <td align="left" valign="top" width="59%" headers="d145430e2333 d145430e2271 ">
                                 <p>Specifies parameters to the XSLT stylesheet identified by <code class="codeph">transform_handle.</code> You can query the <code class="codeph">DBMS_METADATA_TRANSFORM_PARAMS</code> view to see all the valid transform parameters for each transform.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="41%" id="d145430e2346" headers="d145430e2268 "><pre class="oac_no_warn" dir="ltr">DBMS_METADATA.SET_REMAP_PARAM()</pre></td>
                              <td align="left" valign="top" width="59%" headers="d145430e2346 d145430e2271 ">
                                 <p>Specifies parameters to the XSLT stylesheet identified by <code class="codeph">transform_handle</code>.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="41%" id="d145430e2356" headers="d145430e2268 "><pre class="oac_no_warn" dir="ltr">DBMS_METADATA.FETCH_xxx()</pre></td>
                              <td align="left" valign="top" width="59%" headers="d145430e2356 d145430e2271 ">
                                 <p>Returns metadata for objects meeting the criteria established by <code class="codeph">OPEN</code>, <code class="codeph">SET_FILTER</code>, <code class="codeph">SET_COUNT</code>, <code class="codeph">ADD_TRANSFORM</code>, and so on.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="41%" id="d145430e2375" headers="d145430e2268 "><pre class="oac_no_warn" dir="ltr">DBMS_METADATA.CLOSE()</pre></td>
                              <td align="left" valign="top" width="59%" headers="d145430e2375 d145430e2271 ">
                                 <p>Invalidates the handle returned by <code class="codeph">OPEN</code> and cleans up the associated state. 
                                 </p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <div class="section">
                     <p>The following table lists the procedures provided by the <code class="codeph">DBMS_METADATA</code> browsing interface and provides a brief description of each one. These functions return metadata for one or more dependent or granted objects. These procedures do not support heterogeneous object types. 
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="tblformal" id="GUID-B19C59EB-A9BC-4D1E-BD8C-135583D403CD__G1030147">
                     <p class="titleintable">Table 23-2 DBMS_METADATA Procedures Used for the Browsing Interface</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="DBMS_METADATA Procedures Used for the Browsing Interface" summary="DBMS_METADATA procedures used for the browsing interface" width="100%" frame="hsides" border="1" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="25%" id="d145430e2400">PL/SQL Procedure Name</th>
                              <th align="left" valign="bottom" width="75%" id="d145430e2403">Description</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="25%" id="d145430e2408" headers="d145430e2400 "><pre class="oac_no_warn" dir="ltr">DBMS_METADATA.GET_xxx()</pre></td>
                              <td align="left" valign="top" width="75%" headers="d145430e2408 d145430e2403 ">
                                 <p>Provides a way to return metadata for a single object. Each <code class="codeph">GET_xxx</code> call consists of an <code class="codeph">OPEN</code> procedure, one or two <code class="codeph">SET_FILTER</code> calls, optionally an <code class="codeph">ADD_TRANSFORM</code> procedure, a <code class="codeph">FETCH_xxx</code> call, and a <code class="codeph">CLOSE</code> procedure. 
                                 </p>
                                 <p>The <span class="italic"><code class="codeph">object_type</code></span> parameter has the same semantics as in the <code class="codeph">OPEN procedure</code>. <span class="italic"><code class="codeph">schema</code></span> and <span class="italic"><code class="codeph">name</code></span> are used for filtering. 
                                 </p>
                                 <p>If a transform is specified, then session-level transform flags are inherited.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="25%" id="d145430e2453" headers="d145430e2400 "><pre class="oac_no_warn" dir="ltr">DBMS_METADATA.GET_DEPENDENT_xxx()</pre></td>
                              <td align="left" valign="top" width="75%" headers="d145430e2453 d145430e2403 ">
                                 <p>Returns the metadata for one or more dependent objects, specified as XML or DDL.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="25%" id="d145430e2460" headers="d145430e2400 "><pre class="oac_no_warn" dir="ltr">DBMS_METADATA.GET_GRANTED_xxx()</pre></td>
                              <td align="left" valign="top" width="75%" headers="d145430e2460 d145430e2403 ">
                                 <p>Returns the metadata for one or more granted objects, specified as XML or DDL.</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <div class="section">
                     <p>The following table provides a brief description of the <code class="codeph">DBMS_METADATA</code> procedures and functions used for XML submission.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="tblformal" id="GUID-B19C59EB-A9BC-4D1E-BD8C-135583D403CD__G1030301">
                     <p class="titleintable">Table 23-3 DBMS_METADATA Procedures and Functions for Submitting XML Data</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="DBMS_METADATA Procedures and Functions for Submitting XML Data" summary="DBMS_METADATA procedures used for submitting XML data" width="100%" frame="hsides" border="1" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="36%" id="d145430e2482">PL/SQL Name</th>
                              <th align="left" valign="bottom" width="64%" id="d145430e2485">Description</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="36%" id="d145430e2490" headers="d145430e2482 "><pre class="oac_no_warn" dir="ltr">DBMS_METADATA.OPENW()</pre></td>
                              <td align="left" valign="top" width="64%" headers="d145430e2490 d145430e2485 ">
                                 <p>Opens a write context.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="36%" id="d145430e2497" headers="d145430e2482 "><pre class="oac_no_warn" dir="ltr">DBMS_METADATA.ADD_TRANSFORM()</pre></td>
                              <td align="left" valign="top" width="64%" headers="d145430e2497 d145430e2485 ">
                                 <p>Specifies a transform for the XML documents</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="36%" id="d145430e2504" headers="d145430e2482 "><pre class="oac_no_warn" dir="ltr">DBMS_METADATA.SET_TRANSFORM_PARAM() and 
DBMS_METADATA.SET_REMAP_PARAM()</pre></td>
                              <td align="left" valign="top" width="64%" headers="d145430e2504 d145430e2485 ">
                                 <p><code class="codeph">SET_TRANSFORM_PARAM</code> specifies a parameter to a transform.
                                 </p>
                                 <p><code class="codeph">SET_REMAP_PARAM</code> specifies a remapping for a transform.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="36%" id="d145430e2517" headers="d145430e2482 "><pre class="oac_no_warn" dir="ltr">DBMS_METADATA.SET_PARSE_ITEM()</pre></td>
                              <td align="left" valign="top" width="64%" headers="d145430e2517 d145430e2485 ">
                                 <p>Specifies an object attribute to be parsed.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="36%" id="d145430e2524" headers="d145430e2482 "><pre class="oac_no_warn" dir="ltr">DBMS_METADATA.CONVERT()</pre></td>
                              <td align="left" valign="top" width="64%" headers="d145430e2524 d145430e2485 ">
                                 <p>Converts an XML document to DDL.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="36%" id="d145430e2531" headers="d145430e2482 "><pre class="oac_no_warn" dir="ltr">DBMS_METADATA.PUT()</pre></td>
                              <td align="left" valign="top" width="64%" headers="d145430e2531 d145430e2485 ">
                                 <p>Submits an XML document to the database.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="36%" id="d145430e2538" headers="d145430e2482 "><pre class="oac_no_warn" dir="ltr">DBMS_METADATA.CLOSE()</pre></td>
                              <td align="left" valign="top" width="64%" headers="d145430e2538 d145430e2485 ">
                                 <p>Closes the context opened with <code class="codeph">OPENW</code>.
                                 </p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-oracle-dbms_metadata-api.html#GUID-D9B1300F-B21D-416E-8B9B-C542195EF249" title="Using the DBMS_METADATA APIs.">Using the Metadata APIs</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="SUTIL3633"></a><a id="SUTIL3632"></a><div class="props_rev_3"><a id="GUID-CB5F314F-7412-40F1-B71C-8F6DFB45A4D8" name="GUID-CB5F314F-7412-40F1-B71C-8F6DFB45A4D8"></a><h3 id="SUTIL-GUID-CB5F314F-7412-40F1-B71C-8F6DFB45A4D8" class="sect3"><span class="enumeration_section">23.10 </span>Summary of DBMS_METADATA_DIFF Procedures
               </h3>
               <div>
                  <p> Provides brief descriptions of the procedures and functions provided by the <code class="codeph">DBMS_METADATA_DIFF</code> API. 
                  </p>
                  <div class="section">
                     <p>For detailed descriptions of these procedures, see<a href="../arpls/DBMS_METADATA_DIFF.html#ARPLS354" target="_blank"><span class="italic"> Oracle Database PL/SQL Packages and Types Reference.</span></a></p>
                  </div>
                  <!-- class="section" -->
                  <div class="tblformalwide" id="GUID-CB5F314F-7412-40F1-B71C-8F6DFB45A4D8__GUID-54F379A6-DC4E-47D1-91FD-788A63A5273C">
                     <p class="titleintable">Table 23-4 DBMS_METADATA_DIFF Procedures and Functions</p>
                     <table cellpadding="4" cellspacing="0" class="FormalWide" title="DBMS_METADATA_DIFF Procedures and Functions" summary="Summary of DBMS_METADATA_DIFF procedures" width="100%" frame="hsides" border="1" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="41%" id="d145430e2614">PL/SQL Procedure Name</th>
                              <th align="left" valign="bottom" width="59%" id="d145430e2617">Description</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="41%" id="d145430e2622" headers="d145430e2614 ">
                                 <p><code class="codeph">OPENC</code> function
                                 </p>
                              </td>
                              <td align="left" valign="top" width="59%" headers="d145430e2622 d145430e2617 ">
                                 <p>Specifies the type of objects to be compared.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="41%" id="d145430e2631" headers="d145430e2614 ">
                                 <p><code class="codeph">ADD_DOCUMENT</code> procedure
                                 </p>
                              </td>
                              <td align="left" valign="top" width="59%" headers="d145430e2631 d145430e2617 ">
                                 <p>Specifies an SXML document to be compared.</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="41%" id="d145430e2640" headers="d145430e2614 ">
                                 <p><code class="codeph">FETCH_CLOB</code> functions and procedures
                                 </p>
                              </td>
                              <td align="left" valign="top" width="59%" headers="d145430e2640 d145430e2617 ">
                                 <p>Returns a CLOB showing the differences between the two documents specified by <code class="codeph">ADD_DOCUMENT</code>.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="41%" id="d145430e2652" headers="d145430e2614 ">
                                 <p><code class="codeph">CLOSE</code> procedure
                                 </p>
                              </td>
                              <td align="left" valign="top" width="59%" headers="d145430e2652 d145430e2617 ">
                                 <p>Invalidates the handle returned by <code class="codeph">OPENC</code> and cleans up associated state.
                                 </p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-oracle-dbms_metadata-api.html#GUID-D9B1300F-B21D-416E-8B9B-C542195EF249" title="Using the DBMS_METADATA APIs.">Using the Metadata APIs</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>