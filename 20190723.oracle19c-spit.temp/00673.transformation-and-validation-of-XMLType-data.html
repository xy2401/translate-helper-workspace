<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="There are several Oracle SQL functions and XMLType APIs for transforming XMLType data using XSLT stylesheets and for validating XMLType instances against an XML schema.">
      <meta name="description" content="There are several Oracle SQL functions and XMLType APIs for transforming XMLType data using XSLT stylesheets and for validating XMLType instances against an XML schema.">
      <title>Transformation and Validation of XMLType Data</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Developer's Guide ">
      <meta property="og:description" content="There are several Oracle SQL functions and XMLType APIs for transforming XMLType data using XSLT stylesheets and for validating XMLType instances against an XML schema.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="xml-db-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-03-30T12:32:42-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="2002, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96222-03">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="indexes-for-XMLType-data.html" title="Previous" type="text/html">
      <link rel="next" href="relational-data-to-and-from-XML-data.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="XML DB Developer's Guide">
    <meta name="dcterms.isVersionOf" content="ADXDB">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="indexes-for-XMLType-data.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="relational-data-to-and-from-XML-data.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Developer's Guide </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="manipulation-of-XML-in-XML-DB.html" property="item" typeof="WebPage"><span property="name"> Manipulation of XML Data in Oracle XML&nbsp;DB</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Transformation and Validation of XMLType Data</li>
            </ol>
            <a id="GUID-EC4E2212-67EF-425C-AB5E-D48E62EAB9A7" name="GUID-EC4E2212-67EF-425C-AB5E-D48E62EAB9A7"></a><a id="ADXDB0900"></a>
            
            <h2 id="ADXDB-GUID-EC4E2212-67EF-425C-AB5E-D48E62EAB9A7" class="sect2"><span class="enumeration_chapter">7 </span> Transformation and Validation of XMLType Data
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>There are several Oracle SQL functions and <code class="codeph">XMLType</code> APIs for transforming <code class="codeph">XMLType</code> data using XSLT stylesheets and for validating <code class="codeph">XMLType</code> instances against an XML schema.
               </p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="transformation-and-validation-of-XMLType-data.html#GUID-DBEB8B7E-B335-4D07-8A5D-42083A83155D">XSL Transformation and Oracle XML&nbsp;DB</a><br>You can apply XSL transformations to XML Schema-based documents using the built-in Oracle XML&nbsp;DB XSLT processor. In-database XML-specific optimizations can significantly reduce the memory required, eliminate the overhead associated with parsing, and reduce network traffic.
                  </li>
                  <li class="ulchildlink"><a href="transformation-and-validation-of-XMLType-data.html#GUID-45DAA30E-3F14-4D70-8105-ED3855B92A50">Validation of XMLType Instances</a><br>Besides needing to know whether a particular XML document is well-formed, you often need to know whether it conforms to a given XML schema, that is, whether it is valid with respect to that XML schema.
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>Parent topic:</strong> <a href="manipulation-of-XML-in-XML-DB.html#GUID-87C758D5-5792-483D-8894-4C01FCD2A8A0" title="The following are covered here: XQuery, XMLType operations, and indexing of XML data.">Manipulation of XML Data in Oracle XML&nbsp;DB</a></p>
                  </div>
               </div>
            </div>
            <a id="ADXDB4172"></a><a id="ADXDB4171"></a><div class="props_rev_3"><a id="GUID-DBEB8B7E-B335-4D07-8A5D-42083A83155D" name="GUID-DBEB8B7E-B335-4D07-8A5D-42083A83155D"></a><h3 id="ADXDB-GUID-DBEB8B7E-B335-4D07-8A5D-42083A83155D" class="sect3"><span class="enumeration_section">7.1 </span>XSL Transformation and Oracle XML&nbsp;DB
               </h3>
               <div>
                  <p>You can apply XSL transformations to XML Schema-based documents using the built-in Oracle XML&nbsp;DB XSLT processor. In-database XML-specific optimizations can significantly reduce the memory required, eliminate the overhead associated with parsing, and reduce network traffic.</p>
                  <p>The W3C XSLT Recommendation defines an XML language for specifying how to transform XML documents from one form to another. See <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adxdb&amp;id=w3_org_tr_xslt" target="_blank"><code class="codeph">http://www.w3.org/TR/xslt</code></a> for information about the XSLT standard.
                  </p>
                  <p>Transformation can include mapping from one XML schema to another or mapping from XML to some other format such as HTML or WML. </p>
                  <p>XSL transformation can be costly in terms of the amount of memory and processing required. In typical XSL processors, the entire source document and stylesheet must be parsed and loaded into memory, before processing can begin. Typically, XSL processors use DOM to provide dynamic memory representations of document and stylesheet, to allow random access to their different parts. The XSL processor then applies the stylesheet to the source document, generating a third document. </p>
                  <p>Parsing and loading the document and stylesheet into memory before beginning transformation requires significant memory and processor resources. It is especially inefficient when only a small part of the document needs to be transformed.</p>
                  <p>Oracle XML&nbsp;DB includes an XSLT processor that performs XSL transformations <span class="italic">inside the database</span>. In this way, it can provide XML-specific optimizations that can significantly reduce the memory required to perform the transformation, eliminate overhead associated with parsing, and reduce network traffic. 
                  </p>
                  <p>These optimizations are available, however, <span class="italic">only</span> when the source for the transformation is a <span class="italic">schema-based</span> XML document. In that case, there is no need to parse before processing can begin. The Oracle XML&nbsp;DB lazily loaded virtual DOM loads content only on demand, as the nodes are accessed. This also reduces the memory required, because only parts of the document that need to be processed are loaded. 
                  </p>
                  <p>You can transform XML data in the following ways:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>In Oracle Database &#x2013; Using Oracle SQL function <code class="codeph">XMLtransform</code>, <code class="codeph">XMLType</code> method <code class="codeph">transform()</code>, or PL/SQL package <code class="codeph">DBMS_XSLPROCESSOR</code></p>
                     </li>
                     <li>
                        <p>In the middle tier &#x2013; Using Oracle XML Developer's Kit transformation options , such as XSLT Processor for Java.</p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-DBEB8B7E-B335-4D07-8A5D-42083A83155D__GUID-EF4E8E76-0AB6-4F9D-90FA-750FD31F6442">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adxdb&amp;id=SQLRF06171" target="_blank"><span><cite>Oracle Database SQL Language Reference</cite></span></a> for information about SQL function <code class="codeph">XMLTransform</code></p>
                        </li>
                        <li>
                           <p><a href="PLSQL-APIs-for-XMLType.html#GUID-0E3358AF-0819-4B17-AF0B-793E96DA5EB9" title="You can use PL/SQL package DBMS_XSLPROCESSOR to transform one XML document to another or to convert XML data into HTML, PDF, or other formats. This package traverses the DOM tree for the document and applies Extensible Stylesheet Language Transformation (XSLT) statements to it to produce the transformed document.">PL/SQL XSLT Processor for XMLType (DBMS_XSLPROCESSOR)</a> and <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adxdb&amp;id=ARPLS379" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for information about PL/SQL package <code class="codeph">DBMS_XSLPROCESSOR</code></p>
                        </li>
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adxdb&amp;id=ADXDK19222" target="_blank"><span><cite>Oracle XML Developer's Kit Programmer's Guide</cite></span></a> for information about XSLT Processor for Java
                           </p>
                        </li>
                     </ul>
                  </div>
                  <p>Each of these XML transformation methods takes as input a source XML document and an XSL stylesheet in the form of <code class="codeph">XMLType</code> instances. For SQL function <code class="codeph">XMLtransform</code> and <code class="codeph">XMLType</code> method <code class="codeph">transform()</code>, the result of the transformation can be an XML document or a non-XML document, such as HTML. However, for PL/SQL package <code class="codeph">DBMS_XSLPROCESSOR</code>, the result of the transformation is expected to be a valid XML document. Any HTML data generated by a transformation using package <code class="codeph">DBMS_XSLPROCESSOR</code> is XHTML data, which is both valid XML data and valid HTML data.
                  </p>
                  <p><a href="transformation-and-validation-of-XMLType-data.html#GUID-DBEB8B7E-B335-4D07-8A5D-42083A83155D__BJFCGIFJ">Example 7-1</a> shows part of an XSLT stylesheet, <code class="codeph">PurchaseOrder.xsl</code>. The complete stylesheet is given in <a href="oracle-supplied-XML-schemas-and-examples.html#GUID-7593BF83-2C00-477D-8973-C070253C4456" title="The full listing is presented of XSLT stylesheet PurchaseOrder.xsl, which is used in various examples.">XSLT Stylesheet Example, PurchaseOrder.xsl</a>.
                  </p>
                  <p>These is nothing Oracle XML&nbsp;DB-specific about the stylesheet of <a href="transformation-and-validation-of-XMLType-data.html#GUID-DBEB8B7E-B335-4D07-8A5D-42083A83155D__BJFCGIFJ">Example 7-1</a>. A stylesheet can be stored in an <code class="codeph">XMLType</code> table or column or stored as non-schema-based XML data inside Oracle XML&nbsp;DB Repository.
                  </p>
                  <div class="example" id="GUID-DBEB8B7E-B335-4D07-8A5D-42083A83155D__BJFCGIFJ">
                     <p class="titleinexample">Example 7-1 XSLT Stylesheet Example: PurchaseOrder.xsl</p><pre class="oac_no_warn" dir="ltr">&lt;?xml version="1.0" encoding="WINDOWS-1252"?&gt;
&lt;xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:xdb="http://xmlns.oracle.com/xdb" 
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
  &lt;xsl:template match="/"&gt;
    &lt;html&gt;
      &lt;head/&gt;
      &lt;body bgcolor="#003333" text="#FFFFCC" link="#FFCC00" vlink="#66CC99" alink="#669999"&gt;
        &lt;FONT FACE="Arial, Helvetica, sans-serif"&gt;
          &lt;xsl:for-each select="PurchaseOrder"/&gt;
          &lt;xsl:for-each select="PurchaseOrder"&gt;
            &lt;center&gt;
              &lt;span style="font-family:Arial; font-weight:bold"&gt;
                &lt;FONT COLOR="#FF0000"&gt;
                  &lt;B&gt;PurchaseOrder &lt;/B&gt;
                &lt;/FONT&gt;
              &lt;/span&gt;
            &lt;/center&gt;
            &lt;br/&gt;
            &lt;center&gt;
              &lt;xsl:for-each select="Reference"&gt;
                &lt;span style="font-family:Arial; font-weight:bold"&gt;
                  &lt;xsl:apply-templates/&gt;
                &lt;/span&gt;
              &lt;/xsl:for-each&gt;
            &lt;/center&gt;
          &lt;/xsl:for-each&gt;
          &lt;P&gt;
            &lt;xsl:for-each select="PurchaseOrder"&gt;
              &lt;br/&gt;
            &lt;/xsl:for-each&gt;
            &lt;P/&gt;
            &lt;P&gt;
              &lt;xsl:for-each select="PurchaseOrder"&gt;
                &lt;br/&gt;
              &lt;/xsl:for-each&gt;
            &lt;/P&gt;
          &lt;/P&gt;
          &lt;xsl:for-each select="PurchaseOrder"/&gt;
          &lt;xsl:for-each select="PurchaseOrder"&gt;
            &lt;table border="0" width="100%" BGCOLOR="#000000"&gt;
              &lt;tbody&gt;
                &lt;tr&gt;
                  &lt;td WIDTH="296"&gt;
                    &lt;P&gt;
                      &lt;B&gt;
                        &lt;FONT SIZE="+1" COLOR="#FF0000" FACE="Arial, Helvetica, sans-serif"&gt;Internal&lt;/FONT&gt;
                      &lt;/B&gt;
                    &lt;/P&gt;

                    <span class="bold">...</span>

                  &lt;/td&gt;
                  &lt;td width="93"/&gt;
                  &lt;td valign="top" WIDTH="340"&gt;
                    &lt;B&gt;
                      &lt;FONT COLOR="#FF0000"&gt;
                        &lt;FONT SIZE="+1"&gt;Ship To&lt;/FONT&gt;
                      &lt;/FONT&gt;
                    &lt;/B&gt;
                    &lt;xsl:for-each select="ShippingInstructions"&gt;
                      &lt;xsl:if test="position()=1"/&gt;
                    &lt;/xsl:for-each&gt;
                    &lt;xsl:for-each select="ShippingInstructions"&gt;
                    &lt;/xsl:for-each&gt;
 
                      <span class="bold">...</span>
</pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="transformation-and-validation-of-XMLType-data.html#GUID-9E65513C-C113-4EA1-8511-462AC3EEE2D8">SQL Function XMLTRANSFORM and XMLType Method TRANSFORM()</a><br>SQL function <code class="codeph">XMLtransform</code> transforms an XML document by using an XSLT stylesheet. It returns the processed output as XML, HTML, and so on, as specified by the stylesheet.
                     </li>
                     <li class="ulchildlink"><a href="transformation-and-validation-of-XMLType-data.html#GUID-A35A47AF-A28C-4B2F-BB1C-AA10500E3BAF">XSL Transformation Using DBUri Servlet</a><br>You can apply an XSL transformation to XML content that is generated by the DBUri servlet.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="transformation-and-validation-of-XMLType-data.html#GUID-EC4E2212-67EF-425C-AB5E-D48E62EAB9A7" title="There are several Oracle SQL functions and XMLType APIs for transforming XMLType data using XSLT stylesheets and for validating XMLType instances against an XML schema.">Transformation and Validation of XMLType Data</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADXDB4722"></a><a id="ADXDB4723"></a><a id="ADXDB4721"></a><div class="props_rev_3"><a id="GUID-9E65513C-C113-4EA1-8511-462AC3EEE2D8" name="GUID-9E65513C-C113-4EA1-8511-462AC3EEE2D8"></a><h4 id="ADXDB-GUID-9E65513C-C113-4EA1-8511-462AC3EEE2D8" class="sect4"><span class="enumeration_section">7.1.1 </span>SQL Function XMLTRANSFORM and XMLType Method TRANSFORM()
                  </h4>
                  <div>
                     <p>SQL function <code class="codeph">XMLtransform</code> transforms an XML document by using an XSLT stylesheet. It returns the processed output as XML, HTML, and so on, as specified by the stylesheet.
                     </p>
                     <p><a href="transformation-and-validation-of-XMLType-data.html#GUID-9E65513C-C113-4EA1-8511-462AC3EEE2D8__I1026954">Figure 7-1</a> shows the syntax of Oracle SQL function <code class="codeph">XMLtransform</code>. This function takes as arguments an <code class="codeph">XMLType</code> instance and an XSLT stylesheet. The stylesheet can be an <code class="codeph">XMLType</code> instance or a <code class="codeph">VARCHAR2</code> string literal. It applies the stylesheet to the instance and returns an <code class="codeph">XMLType</code> instance.
                     </p>
                     <div class="figure" id="GUID-9E65513C-C113-4EA1-8511-462AC3EEE2D8__I1026954">
                        <p class="titleinfigure">Figure 7-1 XMLTRANSFORM Syntax</p><img src="img/xmltransform.gif" width="391" alt="Description of Figure 7-1 follows" title="Description of Figure 7-1 follows" longdesc="img_text/xmltransform.html"><br><a href="img_text/xmltransform.html">Description of "Figure 7-1 XMLTRANSFORM Syntax"</a></div>
                     <!-- class="figure" -->
                     <p>You can alternatively use <code class="codeph">XMLType</code> method <code class="codeph">transform()</code> as an alternative to Oracle SQL function <code class="codeph">XMLtransform</code>. It has the same functionality.
                     </p>
                     <p><a href="transformation-and-validation-of-XMLType-data.html#GUID-9E65513C-C113-4EA1-8511-462AC3EEE2D8__I1026237">Figure 7-2</a> shows how <code class="codeph">XMLtransform</code> transforms an XML document by using an XSLT stylesheet. It returns the processed output as XML, HTML, and so on, as specified by the XSLT stylesheet. You typically use <code class="codeph">XMLtransform</code> when retrieving or generating XML documents stored as <code class="codeph">XMLType</code> in the database. 
                     </p>
                     <div class="infoboxnotealso" id="GUID-9E65513C-C113-4EA1-8511-462AC3EEE2D8__GUID-D322B013-B74D-40C1-90A9-9A4D54B532F9">
                        <p class="notep1">See Also:</p>
                        <p><a href="intro-to-XML-DB.html#GUID-43B25825-FE37-4782-B627-8B2EFB44068D__BABCJCII">Figure 1-3</a> in <a href="intro-to-XML-DB.html#GUID-A8E97BAC-3685-46C8-8FD9-3D31D36F9344" title="Oracle XML&nbsp;DB provides Oracle Database with native XML support by encompassing both the SQL and XML data models in an interoperable way."> Introduction to Oracle XML&nbsp;DB</a></p>
                     </div>
                     <div class="figure" id="GUID-9E65513C-C113-4EA1-8511-462AC3EEE2D8__I1026237">
                        <p class="titleinfigure">Figure 7-2 Using XMLTRANSFORM</p><img src="img/adxdb008.png" width="405" alt="Description of Figure 7-2 follows" title="Description of Figure 7-2 follows" longdesc="img_text/adxdb008.html"><br><a href="img_text/adxdb008.html">Description of "Figure 7-2 Using XMLTRANSFORM"</a></div>
                     <!-- class="figure" -->
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="transformation-and-validation-of-XMLType-data.html#GUID-8AC216AA-45F5-43F1-8E0E-0A85021E7091">XMLTRANSFORM and XMLType.transform(): Examples</a><br>Examples illustrate how to use Oracle SQL function <code class="codeph">XMLtransform</code> and <code class="codeph">XMLType</code> method <code class="codeph">transform()</code> to transform XML data stored as <code class="codeph">XMLType</code> to various formats. 
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="transformation-and-validation-of-XMLType-data.html#GUID-DBEB8B7E-B335-4D07-8A5D-42083A83155D" title="You can apply XSL transformations to XML Schema-based documents using the built-in Oracle XML&nbsp;DB XSLT processor. In-database XML-specific optimizations can significantly reduce the memory required, eliminate the overhead associated with parsing, and reduce network traffic.">XSL Transformation and Oracle XML&nbsp;DB</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="ADXDB4725"></a><a id="ADXDB4726"></a><a id="ADXDB4728"></a><a id="ADXDB4173"></a><a id="ADXDB4724"></a><div class="props_rev_3"><a id="GUID-8AC216AA-45F5-43F1-8E0E-0A85021E7091" name="GUID-8AC216AA-45F5-43F1-8E0E-0A85021E7091"></a><h5 id="ADXDB-GUID-8AC216AA-45F5-43F1-8E0E-0A85021E7091" class="sect5"><span class="enumeration_section">7.1.1.1 </span>XMLTRANSFORM and XMLType.transform(): Examples
                     </h5>
                     <div>
                        <p>Examples illustrate how to use Oracle SQL function <code class="codeph">XMLtransform</code> and <code class="codeph">XMLType</code> method <code class="codeph">transform()</code> to transform XML data stored as <code class="codeph">XMLType</code> to various formats. 
                        </p>
                        <div class="section">
                           <p><a href="transformation-and-validation-of-XMLType-data.html#GUID-8AC216AA-45F5-43F1-8E0E-0A85021E7091__CFHJDEJE">Example 7-2</a> sets up an XML schema and tables that are needed to run other examples in this chapter. The call to <code class="codeph">deleteSchema</code> here ensures that there is no existing XML schema before creating one. If no such schema exists, then <code class="codeph">deleteSchema</code> raises an error.
                           </p>
                           <p><a href="transformation-and-validation-of-XMLType-data.html#GUID-8AC216AA-45F5-43F1-8E0E-0A85021E7091__I1027535">Example 7-3</a> stores an XSLT stylesheet, then retrieves it and uses it with Oracle SQL function <code class="codeph">XMLTransform</code> to transform the XML data stored in <a href="transformation-and-validation-of-XMLType-data.html#GUID-8AC216AA-45F5-43F1-8E0E-0A85021E7091__CFHJDEJE">Example 7-2</a>.
                           </p>
                           <p><a href="transformation-and-validation-of-XMLType-data.html#GUID-8AC216AA-45F5-43F1-8E0E-0A85021E7091__CFHGHGJI">Example 7-4</a> uses <code class="codeph">XMLType</code> method <code class="codeph">transform()</code> with an XSL stylesheet created on the fly.
                           </p>
                           <p><a href="transformation-and-validation-of-XMLType-data.html#GUID-8AC216AA-45F5-43F1-8E0E-0A85021E7091__BJFJJDIB">Example 7-5</a> uses <code class="codeph">XMLTransform</code> to apply an XSL stylesheet to produce HTML code. PL/SQL constructor <code class="codeph">XDBURIType</code> reads the XSL stylesheet from Oracle XML&nbsp;DB Repository.
                           </p>
                           <p>Only part of the HTML result is shown in <a href="transformation-and-validation-of-XMLType-data.html#GUID-8AC216AA-45F5-43F1-8E0E-0A85021E7091__BJFJJDIB">Example 7-5</a>. Omitted parts are indicated with an ellipsis (<span class="bold"><code class="codeph">. . .</code></span>). <a href="transformation-and-validation-of-XMLType-data.html#GUID-A35A47AF-A28C-4B2F-BB1C-AA10500E3BAF__BABJGIGH">Figure 7-3</a> shows what the transformed result looks like in a Web browser.
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-8AC216AA-45F5-43F1-8E0E-0A85021E7091__CFHJDEJE">
                           <p class="titleinexample">Example 7-2 Registering an XML Schema and Inserting XML Data</p><pre class="oac_no_warn" dir="ltr">BEGIN
  -- Delete the schema, if it already exists.
  DBMS_XMLSCHEMA.deleteSchema('http://www.example.com/schemas/ipo.xsd',4);
END;
/
BEGIN
  -- Register the schema
  DBMS_XMLSCHEMA.registerSchema(
    SCHEMAURL =&gt; 'http://www.example.com/schemas/ipo.xsd',
    SCHEMADOC =&gt; '&lt;schema targetNamespace="http://www.example.com/IPO"
                          xmlns="http://www.w3.org/2001/XMLSchema"
                          xmlns:ipo="http://www.example.com/IPO"&gt;
                    &lt;!-- annotation&gt;
                      &lt;documentation xml:lang="en"&gt;
                       International Purchase order schema for Example.com
                       Copyright 2000 Example.com. All rights reserved.
                      &lt;/documentation&gt;
                    &lt;/annotation --&gt;
                    &lt;element name="purchaseOrder" type="ipo:PurchaseOrderType"/&gt;
                    &lt;element name="comment" type="string"/&gt;
                    &lt;complexType name="PurchaseOrderType"&gt;
                      &lt;sequence&gt;
                        &lt;element name="shipTo"     type="ipo:Address"/&gt;
                        &lt;element name="billTo"     type="ipo:Address"/&gt;
                        &lt;element ref="ipo:comment" minOccurs="0"/&gt;
                        &lt;element name="items"      type="ipo:Items"/&gt;
                      &lt;/sequence&gt;
                      &lt;attribute name="orderDate" type="date"/&gt;
                    &lt;/complexType&gt;
                    &lt;complexType name="Items"&gt;
                      &lt;sequence&gt;
                        &lt;element name="item" minOccurs="0" maxOccurs="unbounded"&gt;
                          &lt;complexType&gt;
                            &lt;sequence&gt;
                              &lt;element name="productName" type="string"/&gt;
                              &lt;element name="quantity"&gt;
                                &lt;simpleType&gt;
                                  &lt;restriction base="positiveInteger"&gt;
                                    &lt;maxExclusive value="100"/&gt;
                                  &lt;/restriction&gt;
                                &lt;/simpleType&gt;
                              &lt;/element&gt;
                              &lt;element name="USPrice"    type="decimal"/&gt;
                              &lt;element ref="ipo:comment" minOccurs="0"/&gt;
                              &lt;element name="shipDate"   type="date" minOccurs="0"/&gt;
                            &lt;/sequence&gt;
                            &lt;attribute name="partNum" type="ipo:SKU" use="required"/&gt;
                          &lt;/complexType&gt;
                        &lt;/element&gt;
                      &lt;/sequence&gt;
                    &lt;/complexType&gt;
                    &lt;complexType name="Address"&gt;
                      &lt;sequence&gt;
                        &lt;element name="name"    type="string"/&gt;
                        &lt;element name="street"  type="string"/&gt;
                        &lt;element name="city"    type="string"/&gt;
                        &lt;element name="state"   type="string"/&gt;
                        &lt;element name="country" type="string"/&gt;
                        &lt;element name="zip"     type="string"/&gt;
                      &lt;/sequence&gt;
                    &lt;/complexType&gt;
                    &lt;simpleType name="SKU"&gt;
                      &lt;restriction base="string"&gt;
                        &lt;pattern value="[0-9]{3}-[A-Z]{2}"/&gt;
                      &lt;/restriction&gt;
                    &lt;/simpleType&gt;
                  &lt;/schema&gt;',
    LOCAL     =&gt; TRUE,
    GENTYPES  =&gt; TRUE);
END;
/

-- Create table to hold XML purchase-order documents, and insert the documents
DROP TABLE po_tab;
CREATE TABLE po_tab (id NUMBER, xmlcol XMLType) 
 XMLType COLUMN xmlcol
 XMLSCHEMA "http://www.example.com/schemas/ipo.xsd"
 ELEMENT "purchaseOrder";

INSERT INTO po_tab 
  VALUES(1, XMLType(
              '&lt;?xml version="1.0"?&gt;
               &lt;ipo:purchaseOrder
                 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xmlns:ipo="http://www.example.com/IPO"
                 xsi:schemaLocation="http://www.example.com/IPO
                                     http://www.example.com/schemas/ipo.xsd"
                 orderDate="1999-12-01"&gt;
                 &lt;shipTo&gt;
                   &lt;name&gt;Helen Zoe&lt;/name&gt;
                   &lt;street&gt;121 Broadway&lt;/street&gt;
                   &lt;city&gt;Cardiff&lt;/city&gt;
                   &lt;state&gt;Wales&lt;/state&gt;
                   &lt;country&gt;UK&lt;/country&gt;
                   &lt;zip&gt;CF2 1QJ&lt;/zip&gt;
                 &lt;/shipTo&gt;
                 &lt;billTo&gt;
                   &lt;name&gt;Robert Smith&lt;/name&gt;
                   &lt;street&gt;8 Oak Avenue&lt;/street&gt;
                   &lt;city&gt;Old Town&lt;/city&gt;
                   &lt;state&gt;CA&lt;/state&gt;
                   &lt;country&gt;US&lt;/country&gt;
                   &lt;zip&gt;95819&lt;/zip&gt;
                 &lt;/billTo&gt;
                 &lt;items&gt;
                   &lt;item partNum="833-AA"&gt;
                     &lt;productName&gt;Lapis necklace&lt;/productName&gt;
                     &lt;quantity&gt;1&lt;/quantity&gt;
                     &lt;USPrice&gt;99.95&lt;/USPrice&gt;
                     &lt;ipo:comment&gt;Want this for the holidays!&lt;/ipo:comment&gt;
                     &lt;shipDate&gt;1999-12-05&lt;/shipDate&gt;
                   &lt;/item&gt;
                 &lt;/items&gt;
               &lt;/ipo:purchaseOrder&gt;'));
</pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-8AC216AA-45F5-43F1-8E0E-0A85021E7091__I1027535">
                           <p class="titleinexample">Example 7-3 Using SQL Function XMLTRANSFORM to Apply an XSL Stylesheet</p><pre class="oac_no_warn" dir="ltr">DROP TABLE stylesheet_tab;
CREATE TABLE stylesheet_tab (id NUMBER, stylesheet XMLType);
INSERT INTO stylesheet_tab 
  VALUES (1, 
          XMLType(
            '&lt;?xml version="1.0" ?&gt;
             &lt;xsl:stylesheet version="1.0" 
                             xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
               &lt;xsl:template match="*"&gt;
                 &lt;td&gt;
                   &lt;xsl:choose&gt;
                     &lt;xsl:when test="count(child::*) &gt; 1"&gt;
                       &lt;xsl:call-template name="nested"/&gt;
                     &lt;/xsl:when&gt;
                     &lt;xsl:otherwise&gt;
                       &lt;xsl:value-of select="name(.)"/&gt;:&lt;xsl:value-of 
                                                          select="text()"/&gt;
                     &lt;/xsl:otherwise&gt;
                   &lt;/xsl:choose&gt;
                 &lt;/td&gt;
               &lt;/xsl:template&gt;
               &lt;xsl:template match="*" name="nested" priority="-1" mode="nested2"&gt;
                 &lt;b&gt;
                   &lt;!-- xsl:value-of select="count(child::*)"/ --&gt;
                   &lt;xsl:choose&gt;
                     &lt;xsl:when test="count(child::*) &gt; 1"&gt;
                       &lt;xsl:value-of select="name(.)"/&gt;:&lt;xsl:apply-templates 
                                                          mode="nested2"/&gt;
                     &lt;/xsl:when&gt;
                     &lt;xsl:otherwise&gt;
                       &lt;xsl:value-of select="name(.)"/&gt;:&lt;xsl:value-of 
                                                          select="text()"/&gt;
                     &lt;/xsl:otherwise&gt;
                   &lt;/xsl:choose&gt;
                 &lt;/b&gt;
               &lt;/xsl:template&gt;
             &lt;/xsl:stylesheet&gt;'));

SELECT XMLSerialize(DOCUMENT <span class="bold">XMLtransform</span>(x.xmlcol, y.stylesheet)
                    AS VARCHAR2(1000))
  AS result FROM po_tab x, stylesheet_tab y WHERE y.id = 1;
</pre><p>This produces the following output (pretty-printed here for readability):</p><pre class="oac_no_warn" dir="ltr">RESULT
---------------------------------------------------------
&lt;td&gt;
  &lt;b&gt;ipo:purchaseOrder:
    &lt;b&gt;shipTo:
      &lt;b&gt;name:Helen Zoe&lt;/b&gt;
      &lt;b&gt;street:100 Broadway&lt;/b&gt;
      &lt;b&gt;city:Cardiff&lt;/b&gt;
      &lt;b&gt;state:Wales&lt;/b&gt;
      &lt;b&gt;country:UK&lt;/b&gt;
      &lt;b&gt;zip:CF2 1QJ&lt;/b&gt;
    &lt;/b&gt;
    &lt;b&gt;billTo:
      &lt;b&gt;name:Robert Smith&lt;/b&gt;
      &lt;b&gt;street:8 Oak Avenue&lt;/b&gt;
      &lt;b&gt;city:Old Town&lt;/b&gt;
      &lt;b&gt;state:CA&lt;/b&gt;
      &lt;b&gt;country:US&lt;/b&gt;
      &lt;b&gt;zip:95819&lt;/b&gt;
    &lt;/b&gt;
    &lt;b&gt;items:&lt;/b&gt;
  &lt;/b&gt;
&lt;/td&gt;
</pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-8AC216AA-45F5-43F1-8E0E-0A85021E7091__CFHGHGJI">
                           <p class="titleinexample">Example 7-4 Using XMLType Method TRANSFORM() with a Transient XSL Stylesheet</p><pre class="oac_no_warn" dir="ltr">SELECT XMLSerialize(
         DOCUMENT
         x.xmlcol.<span class="bold">transform</span>(
           XMLType('&lt;?xml version="1.0" ?&gt;
                  &lt;xsl:stylesheet
                      version="1.0"
                      xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
                    &lt;xsl:template match="*"&gt;
                      &lt;td&gt;
                        &lt;xsl:choose&gt;
                          &lt;xsl:when test="count(child::*) &gt; 1"&gt;
                            &lt;xsl:call-template name="nested"/&gt;
                          &lt;/xsl:when&gt;
                          &lt;xsl:otherwise&gt;
                            &lt;xsl:value-of
                               select =
                                 "name(.)"/&gt;:&lt;xsl:value-of select="text()"/&gt;
                          &lt;/xsl:otherwise&gt;
                        &lt;/xsl:choose&gt;
                      &lt;/td&gt;
                    &lt;/xsl:template&gt;
                    &lt;xsl:template match="*" name="nested" priority="-1"
                                  mode="nested2"&gt;
                      &lt;b&gt;
                        &lt;!-- xsl:value-of select="count(child::*)"/ --&gt;
                        &lt;xsl:choose&gt;
                          &lt;xsl:when test="count(child::*) &gt; 1"&gt;
                            &lt;xsl:value-of select="name(.)"/&gt;:
                            &lt;xsl:apply-templates mode="nested2"/&gt;
                          &lt;/xsl:when&gt;
                          &lt;xsl:otherwise&gt;
                            &lt;xsl:value-of
                               select =
                                 "name(.)"/&gt;:&lt;xsl:value-of select="text()"/&gt;
                          &lt;/xsl:otherwise&gt;
                        &lt;/xsl:choose&gt;
                      &lt;/b&gt;
                    &lt;/xsl:template&gt;
                  &lt;/xsl:stylesheet&gt;'))
         AS varchar2(1000))
  FROM po_tab x;
</pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-8AC216AA-45F5-43F1-8E0E-0A85021E7091__BJFJJDIB">
                           <p class="titleinexample">Example 7-5 Using XMLTRANSFORM to Apply an XSL Stylesheet Retrieved Using XDBURIType</p><pre class="oac_no_warn" dir="ltr">SELECT
  <span class="bold">XMLTransform</span>(
    OBJECT_VALUE, 
    <span class="bold">XDBURIType</span>('/source/schemas/poSource/xsl/purchaseOrder.xsl').getXML())
  FROM purchaseorder
  WHERE XMLExists('$p/PurchaseOrder[Reference="SBELL-2002100912333601PDT"]'
                  PASSING OBJECT_VALUE AS "p");
 
XMLTRANSFORM(OBJECT_VALUE, XDBURITYPE('/SOURCE/SCHEMAS/POSOURCE/XSL/PURCHASEORDER.XSL').GET
---------------------------------------------------------------------------------------------
&lt;html xmlns:xdb="http://xmlns.oracle.com/xdb"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
  &lt;head/&gt;
  &lt;body bgcolor="#003333" text="#FFFFCC" link="#FFCC00" vlink="#66CC99" alink="#669999"&gt;
    &lt;FONT FACE="Arial, Helvetica, sans-serif"&gt;
      &lt;center&gt;
        &lt;span style="font-family:Arial; font-weight:bold"&gt;
          &lt;FONT COLOR="#FF0000"&gt;
            &lt;B&gt;PurchaseOrder &lt;/B&gt;
          &lt;/FONT&gt;
        &lt;/span&gt;
      &lt;/center&gt;
      &lt;br/&gt;
      &lt;center&gt;
        &lt;span style="font-family:Arial; font-weight:bold"&gt;SBELL-2002100912333601PDT&lt;/span&gt;
      &lt;/center&gt;
      &lt;P&gt;
        &lt;br/&gt;
        &lt;P/&gt;
        &lt;P&gt;
          &lt;br/&gt;
        &lt;/P&gt;
      &lt;/P&gt;
      &lt;table border="0" width="100%" BGCOLOR="#000000"&gt;
        &lt;tbody&gt;
          &lt;tr&gt;
            &lt;td WIDTH="296"&gt;
              &lt;P&gt;
                &lt;B&gt;
                  &lt;FONT SIZE="+1" COLOR="#FF0000" FACE="Arial, Helvetica,
                        sans-serif"&gt;Internal&lt;/FONT&gt;
                &lt;/B&gt;
              &lt;/P&gt;
              &lt;table border="0" width="98%" BGCOLOR="#000099"&gt;</pre><pre class="oac_no_warn" dir="ltr"><span class="bold">                                                     . . .</span></pre><pre class="oac_no_warn" dir="ltr">              &lt;/table&gt;
            &lt;/td&gt;
            &lt;td width="93"&gt;
            &lt;/td&gt;
            &lt;td valign="top" WIDTH="340"&gt;
              &lt;B&gt;
                &lt;FONT COLOR="#FF0000"&gt;
                  &lt;FONT SIZE="+1"&gt;Ship To&lt;/FONT&gt;
                &lt;/FONT&gt;
              &lt;/B&gt;
              &lt;table border="0" BGCOLOR="#999900"&gt;
                <span class="bold">. . .</span>
              &lt;/table&gt;
            &lt;/td&gt;
          &lt;/tr&gt;
        &lt;/tbody&gt;
      &lt;/table&gt;
      &lt;br/&gt;
      &lt;B&gt;
        &lt;FONT COLOR="#FF0000" SIZE="+1"&gt;Items:&lt;/FONT&gt;
      &lt;/B&gt;
      &lt;br/&gt;
      &lt;br/&gt;
      &lt;table border="0"&gt;
        <span class="bold">. . .</span>
      &lt;/table&gt;
    &lt;/FONT&gt;
  &lt;/body&gt;
&lt;/html&gt;
 
1 row selected.</pre></div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="transformation-and-validation-of-XMLType-data.html#GUID-9E65513C-C113-4EA1-8511-462AC3EEE2D8" title="SQL function XMLtransform transforms an XML document by using an XSLT stylesheet. It returns the processed output as XML, HTML, and so on, as specified by the stylesheet.">SQL Function XMLTRANSFORM and XMLType Method TRANSFORM()</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="ADXDB4227"></a><a id="ADXDB4228"></a><a id="ADXDB4226"></a><div class="props_rev_3"><a id="GUID-A35A47AF-A28C-4B2F-BB1C-AA10500E3BAF" name="GUID-A35A47AF-A28C-4B2F-BB1C-AA10500E3BAF"></a><h4 id="ADXDB-GUID-A35A47AF-A28C-4B2F-BB1C-AA10500E3BAF" class="sect4"><span class="enumeration_section">7.1.2 </span>XSL Transformation Using DBUri Servlet
                  </h4>
                  <div>
                     <p>You can apply an XSL transformation to XML content that is generated by the DBUri servlet.</p>
                     <p><a href="transformation-and-validation-of-XMLType-data.html#GUID-A35A47AF-A28C-4B2F-BB1C-AA10500E3BAF__BABJGIGH">Figure 7-3</a> shows the result of such a transformation. The URL is the following (it is split and truncated here):
                     </p><pre class="pre codeblock"><code>http://localhost:8080/oradb/SCOTT/PURCHASEORDER/ROW/PurchaseOrder[Reference="SBELL-2003030912333601PDT"]
contenttype=text/html&amp;<span class="bold">transform=/home/SCOTT/xsl/purchaseOrder.xsl</span>...
</code></pre><p>The presence of parameter <code class="codeph">transform</code> causes the DBUri servlet to use SQL function <code class="codeph">XMLTransform</code> to apply the XSL stylesheet at <code class="codeph">/home/SCOTT/xsl/purchaseOrder.xsl</code> to the <code class="codeph">PurchaseOrder</code> document that is identified by the main URL. The result of the transformation, which is HTML code, is returned to the browser for display. The URL also uses parameter <code class="codeph">contentType</code> to specify that the MIME-type of the final document is <code class="codeph">text/html</code>.
                     </p>
                     <div class="figure" id="GUID-A35A47AF-A28C-4B2F-BB1C-AA10500E3BAF__BABJGIGH">
                        <p class="titleinfigure">Figure 7-3 Database XSL Transformation of a PurchaseOrder Using DBUri Servlet</p><img src="img/xslt_po.gif" width="515" alt="Description of Figure 7-3 follows" title="Description of Figure 7-3 follows" longdesc="img_text/xslt_po.html"><br><a href="img_text/xslt_po.html">Description of "Figure 7-3 Database XSL Transformation of a PurchaseOrder Using DBUri Servlet"</a></div>
                     <!-- class="figure" -->
                     <p><a href="transformation-and-validation-of-XMLType-data.html#GUID-A35A47AF-A28C-4B2F-BB1C-AA10500E3BAF__CEGGCDJE">Figure 7-4</a> shows table <code class="codeph">departments</code> displayed as an HTML document. You need no code to achieve this. You need only an <code class="codeph">XMLType</code> view based on SQL/XML functions, an industry-standard XSL stylesheet, and <code class="codeph">DBUri</code> servlet. 
                     </p>
                     <div class="figure" id="GUID-A35A47AF-A28C-4B2F-BB1C-AA10500E3BAF__CEGGCDJE">
                        <p class="titleinfigure">Figure 7-4 Database XSL Transformation of Departments Table Using DBUri Servlet</p><img src="img/dburi_emp.gif" width="597" alt="Description of Figure 7-4 follows" title="Description of Figure 7-4 follows" longdesc="img_text/dburi_emp.html"><br><a href="img_text/dburi_emp.html">Description of "Figure 7-4 Database XSL Transformation of Departments Table Using DBUri Servlet"</a></div>
                     <!-- class="figure" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="transformation-and-validation-of-XMLType-data.html#GUID-DBEB8B7E-B335-4D07-8A5D-42083A83155D" title="You can apply XSL transformations to XML Schema-based documents using the built-in Oracle XML&nbsp;DB XSLT processor. In-database XML-specific optimizations can significantly reduce the memory required, eliminate the overhead associated with parsing, and reduce network traffic.">XSL Transformation and Oracle XML&nbsp;DB</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="ADXDB4729"></a><div class="props_rev_3"><a id="GUID-45DAA30E-3F14-4D70-8105-ED3855B92A50" name="GUID-45DAA30E-3F14-4D70-8105-ED3855B92A50"></a><h3 id="ADXDB-GUID-45DAA30E-3F14-4D70-8105-ED3855B92A50" class="sect3"><span class="enumeration_section">7.2 </span>Validation of XMLType Instances
               </h3>
               <div>
                  <p>Besides needing to know whether a particular XML document is well-formed, you often need to know whether it conforms to a given XML schema, that is, whether it is valid with respect to that XML schema.</p>
                  <p>XML schema-based data that is stored as binary XML it is automatically validated fully whenever it is inserted or updated. This validation does not require building a DOM. It is done using streaming, which is efficient and minimizes memory use.</p>
                  <p>For <code class="codeph">XMLType</code> data that is stored object-relationally, full validation requires building a DOM, which can be costly in terms of memory management. For this reason, Oracle XML&nbsp;DB does not automatically perform full validation when you insert or update data that is stored object-relationally.
                  </p>
                  <p>However, in the process of decomposing XML data to store it object-relationally, Oracle XML&nbsp;DB does automatically perform partial validation, to ensure that the structure of the XML document conforms to the SQL data type definitions that were derived from the XML schema.</p>
                  <p>If you require full validation for <code class="codeph">XMLType</code> data stored object-relationally, then consider validating on the client before inserting the data into the database or updating it.
                  </p>
                  <p>You can use the following to perform full validation and manipulate the recorded validation status of XML documents:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Oracle SQL function <span class="bold"><code class="codeph">XMLIsValid</code></span> and <code class="codeph">XMLType</code> method <span class="bold"><code class="codeph">IsSchemaValid()</code></span> &#x2013; Run the validation process unconditionally. Do not record any validation status. Return:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">1</code> if the document is determined to be <span class="italic">valid</span>.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">0</code> if the document is determined to be <span class="italic">invalid</span> or the validity of the document <span class="italic">cannot be determined</span>.
                              </p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p><code class="codeph">XMLType</code> method <span class="bold"><code class="codeph">SchemaValidate()</code></span> &#x2013; Runs the validation process if the validation status is <code class="codeph">0</code>, which it is by default. Sets the validation status to <code class="codeph">1</code> if the document is determined to be <span class="italic">valid</span>. (Otherwise, the status remains <code class="codeph">0</code>.)
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">XMLType</code> method <span class="bold"><code class="codeph">isSchemaValidated()</code></span> returns the recorded validation status of an <code class="codeph">XMLType</code> instance.
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">XMLType</code> method <span class="bold"><code class="codeph">setSchemaValidated()</code></span> sets (records) the validation status of an <code class="codeph">XMLType</code> instance.
                        </p>
                     </li>
                  </ul>
                  <p>The validation status indicates knowledge of validity, as follows:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><code class="codeph">1</code> means that the document is known to be <span class="italic">valid</span>.
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">0</code> means that validity of the document is <span class="italic">unknown</span>. The document might have been shown to be invalid during a validation check, but that invalidity is not recorded. A recorded validation status of <code class="codeph">0</code> indicates only a lack of knowledge about the document's validity.
                        </p>
                     </li>
                  </ul>
                  <div class="section"></div>
                  <!-- class="section" -->
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="transformation-and-validation-of-XMLType-data.html#GUID-BEF51F7F-33A8-4FED-AA21-FE8849821BEC">Partial and Full XML Schema Validation</a><br>When you insert XML Schema-based documents into the database they can be validated partially or fully.
                     </li>
                     <li class="ulchildlink"><a href="transformation-and-validation-of-XMLType-data.html#GUID-3563099E-B1F3-4B70-8D2F-8FA001FF632B">Validating XML Data Stored as XMLType: Examples</a><br>Examples here illustrate how to use Oracle SQL function <code class="codeph">XMLIsValid</code> and <code class="codeph">XMLType</code> methods <code class="codeph">isSchemaValid()</code> and <code class="codeph">schemaValidate()</code> to validate XML data being stored as <code class="codeph">XMLType</code> in Oracle XML&nbsp;DB.
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-45DAA30E-3F14-4D70-8105-ED3855B92A50__GUID-F462B68A-F414-4F2B-98FB-5EBD0D1D0AAE">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="../sqlrf/XMLISVALID.html#SQLRF06147" target="_blank"><span><cite>Oracle Database SQL Language Reference</cite></span></a> for information about Oracle SQL function <code class="codeph">XMLIsValid</code></p>
                        </li>
                        <li>
                           <p><a href="../arpls/XMLTYPE.html#ARPLS369" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for information about <code class="codeph">XMLType</code> methods <code class="codeph">IsSchemaValid()</code>, <code class="codeph">IsSchemaValidated()</code>, <code class="codeph">SchemaValidate()</code>, and <code class="codeph">setSchemaValidated()</code></p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="transformation-and-validation-of-XMLType-data.html#GUID-EC4E2212-67EF-425C-AB5E-D48E62EAB9A7" title="There are several Oracle SQL functions and XMLType APIs for transforming XMLType data using XSLT stylesheets and for validating XMLType instances against an XML schema.">Transformation and Validation of XMLType Data</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADXDB4102"></a><div class="props_rev_3"><a id="GUID-BEF51F7F-33A8-4FED-AA21-FE8849821BEC" name="GUID-BEF51F7F-33A8-4FED-AA21-FE8849821BEC"></a><h4 id="ADXDB-GUID-BEF51F7F-33A8-4FED-AA21-FE8849821BEC" class="sect4"><span class="enumeration_section">7.2.1 </span>Partial and Full XML Schema Validation
                  </h4>
                  <div>
                     <p>When you insert XML Schema-based documents into the database they can be validated partially or fully.</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="transformation-and-validation-of-XMLType-data.html#GUID-2360608F-BA11-4BEB-98F3-E79888A57BDD">Partial Validation</a><br>For binary XML storage, Oracle XML&nbsp;DB validates XML Schema-based documents fully when they are inserted into an <code class="codeph">XMLType</code> table or column. For object-relational XML storage, only a partial validation is performed. This is because complete XML schema validation is quite costly for object-relational storage, in terms of performance. 
                        </li>
                        <li class="ulchildlink"><a href="transformation-and-validation-of-XMLType-data.html#GUID-CD089007-3832-4812-8617-642B2854C6BE">Full Validation</a><br>Loading XML Schema-based data into binary XML storage fully validates it against the target XML schemas. For object-relational <code class="codeph">XMLType</code> storage, you can force full validation at any time.
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="transformation-and-validation-of-XMLType-data.html#GUID-45DAA30E-3F14-4D70-8105-ED3855B92A50" title="Besides needing to know whether a particular XML document is well-formed, you often need to know whether it conforms to a given XML schema, that is, whether it is valid with respect to that XML schema.">Validation of XMLType Instances</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="ADXDB4104"></a><a id="ADXDB4103"></a><div class="props_rev_3"><a id="GUID-2360608F-BA11-4BEB-98F3-E79888A57BDD" name="GUID-2360608F-BA11-4BEB-98F3-E79888A57BDD"></a><h5 id="ADXDB-GUID-2360608F-BA11-4BEB-98F3-E79888A57BDD" class="sect5"><span class="enumeration_section">7.2.1.1 </span>Partial Validation
                     </h5>
                     <div>
                        <p>For binary XML storage, Oracle XML&nbsp;DB validates XML Schema-based documents fully when they are inserted into an <code class="codeph">XMLType</code> table or column. For object-relational XML storage, only a partial validation is performed. This is because complete XML schema validation is quite costly for object-relational storage, in terms of performance. 
                        </p>
                        <p><span class="bold">Partial validation</span> ensures only that all of the mandatory elements and attributes are present, and that there are no unexpected elements or attributes in the document. That is, it ensures only that the structure of the XML document conforms to the SQL data type definitions that were derived from the XML schema. Partial validation does not ensure that the instance document is fully compliant with the XML schema.
                        </p>
                        <p><a href="transformation-and-validation-of-XMLType-data.html#GUID-2360608F-BA11-4BEB-98F3-E79888A57BDD__BABFEGDC">Example 7-6</a> provides an example of failing partial validation while inserting an XML document into table <code class="codeph">PurchaseOrder</code>, which is stored object-relationally.
                        </p>
                        <div class="example" id="GUID-2360608F-BA11-4BEB-98F3-E79888A57BDD__BABFEGDC">
                           <p class="titleinexample">Example 7-6 Error When Inserting Incorrect XML Document (Partial Validation)</p><pre class="pre codeblock"><code>INSERT INTO purchaseorder
  VALUES(XMLType(bfilename('XMLDIR', 'InvalidElement.xml'),
                 nls_charset_id('AL32UTF8')));
  VALUES(XMLType(bfilename('XMLDIR', 'InvalidElement.xml'),
         *
ERROR at line 2:
ORA-30937: No schema definition for 'UserName' (namespace '##local') in parent
'/PurchaseOrder'</code></pre></div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="transformation-and-validation-of-XMLType-data.html#GUID-BEF51F7F-33A8-4FED-AA21-FE8849821BEC" title="When you insert XML Schema-based documents into the database they can be validated partially or fully.">Partial and Full XML Schema Validation</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="ADXDB4105"></a><div class="props_rev_3"><a id="GUID-CD089007-3832-4812-8617-642B2854C6BE" name="GUID-CD089007-3832-4812-8617-642B2854C6BE"></a><h5 id="ADXDB-GUID-CD089007-3832-4812-8617-642B2854C6BE" class="sect5"><span class="enumeration_section">7.2.1.2 </span>Full Validation
                     </h5>
                     <div>
                        <p>Loading XML Schema-based data into binary XML storage fully validates it against the target XML schemas. For object-relational <code class="codeph">XMLType</code> storage, you can force full validation at any time.
                        </p>
                        <p>To force full validation, use either of the following:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Table level <code class="codeph">CHECK</code> constraint
                              </p>
                           </li>
                           <li>
                              <p>PL/SQL <code class="codeph">BEFORE INSERT</code> trigger
                              </p>
                           </li>
                        </ul>
                        <p>Both approaches ensure that only valid XML documents can be stored in the <code class="codeph">XMLType</code> table. 
                        </p>
                        <p>The advantage of a <code class="codeph">TABLE CHECK</code> constraint is that it is easy to code. The disadvantage is that it is based on Oracle SQL function <code class="codeph">XMLisValid</code>, so it can only indicate whether or not the XML document is valid. If an XML document is invalid, a <code class="codeph">TABLE CHECK</code> constraint cannot provide any information about <span class="italic">why</span> it is invalid. 
                        </p>
                        <p>A <code class="codeph">BEFORE INSERT</code> trigger requires slightly more code. The trigger validates the XML document by invoking <code class="codeph">XMLType</code> method <code class="codeph">schemaValidate()</code>. The advantage of using <code class="codeph">schemaValidate()</code> is that the exception raised provides additional information about what was wrong with the instance document. Using a <code class="codeph">BEFORE INSERT</code> trigger also makes it possible to attempt corrective action when an invalid document is encountered.
                        </p>
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="transformation-and-validation-of-XMLType-data.html#GUID-2920BC25-F964-452D-973B-5FACD538A744">Full XML Schema Validation Costs Processing Time and Memory Usage</a><br>Unless you are using binary XML storage, full XML schema validation costs processing time and memory. You should thus perform full XML schema validation only when necessary. 
                           </li>
                        </ul>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="transformation-and-validation-of-XMLType-data.html#GUID-BEF51F7F-33A8-4FED-AA21-FE8849821BEC" title="When you insert XML Schema-based documents into the database they can be validated partially or fully.">Partial and Full XML Schema Validation</a></p>
                           </div>
                        </div>
                     </div>
                     <a id="ADXDB4107"></a><a id="ADXDB4108"></a><a id="ADXDB4106"></a><div class="props_rev_3"><a id="GUID-2920BC25-F964-452D-973B-5FACD538A744" name="GUID-2920BC25-F964-452D-973B-5FACD538A744"></a><h6 id="ADXDB-GUID-2920BC25-F964-452D-973B-5FACD538A744" class="sect6"><span class="enumeration_section">7.2.1.2.1 </span>Full XML Schema Validation Costs Processing Time and Memory Usage
                        </h6>
                        <div>
                           <p>Unless you are using binary XML storage, full XML schema validation costs processing time and memory. You should thus perform full XML schema validation only when necessary. </p>
                           <p>If you can rely on your application to validate an XML document then you can obtain higher overall throughput with non-binary XML storage, by avoiding the overhead associated with full validation. If you cannot be sure about the validity of incoming XML documents, you can rely on the database to ensure that an <code class="codeph">XMLType</code> table or column contains only schema-valid XML documents.
                           </p>
                           <p><a href="transformation-and-validation-of-XMLType-data.html#GUID-2920BC25-F964-452D-973B-5FACD538A744__BABHIFBH">Example 7-7</a> shows how to force a full XML schema validation by adding a <code class="codeph">CHECK</code> constraint to an <code class="codeph">XMLType</code> table. In <a href="transformation-and-validation-of-XMLType-data.html#GUID-2920BC25-F964-452D-973B-5FACD538A744__BABHIFBH">Example 7-7</a>, the XML document <code class="codeph">InvalidReference</code> is a not valid with respect to the XML schema. The XML schema defines a minimum length of 18 characters for the text node associated with the <code class="codeph">Reference</code> element. In this document, the node contains the value <code class="codeph">SBELL-20021009</code>, which is only 14 characters long. Partial validation would not catch this error. Unless the constraint or trigger is present, attempts to insert this document into the database would succeed. 
                           </p>
                           <div class="example" id="GUID-2920BC25-F964-452D-973B-5FACD538A744__BABHIFBH">
                              <p class="titleinexample">Example 7-7 Forcing Full XML Schema Validation Using a CHECK Constraint</p><pre class="pre codeblock"><code>ALTER TABLE purchaseorder
  ADD CONSTRAINT validate_purchaseorder
  <span class="bold">CHECK (XMLIsValid(OBJECT_VALUE) = 1);</span>
 
Table altered.
 
INSERT INTO purchaseorder
  VALUES (XMLType(bfilename('XMLDIR', 'InvalidReference.xml'),
                  nls_charset_id('AL32UTF8')));

INSERT INTO purchaseorder
*
 
ERROR at line 1:
ORA-02290: check constraint (QUINE.VALIDATE_PURCHASEORDER) violated
</code></pre><p>Pseudocolumn <code class="codeph">OBJECT_VALUE</code> can be used to access the content of an <code class="codeph">XMLType</code> table from within a trigger. <a href="transformation-and-validation-of-XMLType-data.html#GUID-2920BC25-F964-452D-973B-5FACD538A744__BABDJDHC">Example 7-8</a> illustrates this, showing how to use a <code class="codeph">BEFORE INSERT</code> trigger to validate that the data being inserted into the <code class="codeph">XMLType</code> table conforms to the specified XML schema.
                              </p>
                           </div>
                           <!-- class="example" -->
                           <div class="example" id="GUID-2920BC25-F964-452D-973B-5FACD538A744__BABDJDHC">
                              <p class="titleinexample">Example 7-8 Enforcing Full XML Schema Validation Using a BEFORE INSERT Trigger</p><pre class="pre codeblock"><code>CREATE OR REPLACE TRIGGER validate_purchaseorder
   BEFORE INSERT ON purchaseorder
   FOR EACH ROW
BEGIN
  IF (:new.OBJECT_VALUE IS NOT NULL) THEN :new.<span class="bold">OBJECT_VALUE.schemavalidate</span>();
  END IF;
END;
/

INSERT INTO purchaseorder  VALUES (XMLType(bfilename('XMLDIR', 'InvalidReference.xml'),
                  nls_charset_id('AL32UTF8')));
  VALUES (XMLType( bfilename('XMLDIR', 'InvalidReference.xml'),
          *
ERROR at line 2:
ORA-31154: invalid XML document
ORA-19202: Error occurred in XML processing
LSX-00221: "SBELL-20021009" is too short (minimum length is 18)
LSX-00213: only 0 occurrences of particle "sequence", minimum is 1
ORA-06512: at "SYS.XMLTYPE", line 354
ORA-06512: at "QUINE.VALIDATE_PURCHASEORDER", line 3
ORA-04088: error during execution of trigger 'QUINE.VALIDATE_PURCHASEORDER'</code></pre></div>
                           <!-- class="example" -->
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="transformation-and-validation-of-XMLType-data.html#GUID-CD089007-3832-4812-8617-642B2854C6BE" title="Loading XML Schema-based data into binary XML storage fully validates it against the target XML schemas. For object-relational XMLType storage, you can force full validation at any time.">Full Validation</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div>
               </div><a id="ADXDB4741"></a><a id="ADXDB4742"></a><a id="ADXDB4743"></a><a id="ADXDB4744"></a><a id="ADXDB4740"></a><div class="props_rev_3"><a id="GUID-3563099E-B1F3-4B70-8D2F-8FA001FF632B" name="GUID-3563099E-B1F3-4B70-8D2F-8FA001FF632B"></a><h4 id="ADXDB-GUID-3563099E-B1F3-4B70-8D2F-8FA001FF632B" class="sect4"><span class="enumeration_section">7.2.2 </span>Validating XML Data Stored as XMLType: Examples
                  </h4>
                  <div>
                     <p>Examples here illustrate how to use Oracle SQL function <code class="codeph">XMLIsValid</code> and <code class="codeph">XMLType</code> methods <code class="codeph">isSchemaValid()</code> and <code class="codeph">schemaValidate()</code> to validate XML data being stored as <code class="codeph">XMLType</code> in Oracle XML&nbsp;DB.
                     </p>
                     <div class="section">
                        <p><a href="transformation-and-validation-of-XMLType-data.html#GUID-3563099E-B1F3-4B70-8D2F-8FA001FF632B__CFHHFGAI">Example 7-9</a> and <a href="transformation-and-validation-of-XMLType-data.html#GUID-3563099E-B1F3-4B70-8D2F-8FA001FF632B__CFHCEHFA">Example 7-10</a> show how to validate an XML instance against an XML schema using PL/SQL method <code class="codeph">isSchemaValid</code>().
                        </p>
                        <p><code class="codeph">XMLType</code> method <code class="codeph">schemaValidate()</code> can be used within <code class="codeph">INSERT</code> and <code class="codeph">UPDATE</code> triggers to ensure that all instances stored in the table are validated against the XML schema. <a href="transformation-and-validation-of-XMLType-data.html#GUID-3563099E-B1F3-4B70-8D2F-8FA001FF632B__CFHJFAEG">Example 7-11</a> illustrates this.
                        </p>
                        <p><a href="transformation-and-validation-of-XMLType-data.html#GUID-3563099E-B1F3-4B70-8D2F-8FA001FF632B__CFHEGCDB">Example 7-12</a> uses Oracle SQL function <code class="codeph">XMLIsValid</code> to do the following:
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Verify that the <code class="codeph">XMLType</code> instance conforms to the specified XML schema
                              </p>
                           </li>
                           <li>
                              <p>Ensure that the incoming XML documents are valid by using <code class="codeph">CHECK</code> constraints
                              </p>
                           </li>
                        </ul>
                        <div class="infoboxnote" id="GUID-3563099E-B1F3-4B70-8D2F-8FA001FF632B__GUID-432B1B1F-C9D8-4FCA-BF9B-E888BBA6DA28">
                           <p class="notep1">Note:</p>
                           <p>The validation functions and procedures described in <a href="transformation-and-validation-of-XMLType-data.html#GUID-45DAA30E-3F14-4D70-8105-ED3855B92A50" title="Besides needing to know whether a particular XML document is well-formed, you often need to know whether it conforms to a given XML schema, that is, whether it is valid with respect to that XML schema.">Validation of XMLType Instances</a> facilitate validation checking. Of these, <code class="codeph">schemaValidate</code> is the only one that raises errors that indicate why validation has failed.
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-3563099E-B1F3-4B70-8D2F-8FA001FF632B__CFHHFGAI">
                        <p class="titleinexample">Example 7-9 Validating XML Using Method ISSCHEMAVALID() in SQL</p><pre class="oac_no_warn" dir="ltr">SELECT x.xmlcol.<span class="bold">isSchemaValid</span>('http://www.example.com/schemas/ipo.xsd',
                              'purchaseOrder')
    FROM po_tab x;</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-3563099E-B1F3-4B70-8D2F-8FA001FF632B__CFHCEHFA">
                        <p class="titleinexample">Example 7-10 Validating XML Using Method ISSCHEMAVALID() in PL/SQL</p><pre class="oac_no_warn" dir="ltr">DECLARE
  xml_instance XMLType;
BEGIN
  SELECT x.xmlcol INTO xml_instance FROM po_tab x WHERE id = 1;
  IF xml_instance.<span class="bold">isSchemaValid</span>('http://www.example.com/schemas/ipo.xsd') = 0
    THEN raise_application_error(-20500, 'Invalid Instance');
    ELSE DBMS_OUTPUT.put_line('Instance is valid');
  END IF;
END;
/
Instance is valid
 
PL/SQL procedure successfully completed.
</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-3563099E-B1F3-4B70-8D2F-8FA001FF632B__CFHJFAEG">
                        <p class="titleinexample">Example 7-11 Validating XML Using Method SCHEMAVALIDATE() within Triggers</p><pre class="oac_no_warn" dir="ltr">DROP TABLE po_tab;
CREATE TABLE po_tab OF XMLType 
  XMLSCHEMA "http://www.example.com/schemas/ipo.xsd" ELEMENT "purchaseOrder";

CREATE TRIGGER emp_trig BEFORE INSERT OR UPDATE ON po_tab FOR EACH ROW

DECLARE 
  newxml XMLType;
BEGIn
  newxml := :new.OBJECT_VALUE;
  XMLTYPE.<span class="bold">schemavalidate</span>(newxml);
END;
/
</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-3563099E-B1F3-4B70-8D2F-8FA001FF632B__CFHEGCDB">
                        <p class="titleinexample">Example 7-12 Checking XML Validity Using XMLISVALID Within CHECK Constraints</p><pre class="oac_no_warn" dir="ltr">DROP TABLE po_tab;
CREATE TABLE po_tab OF XMLType 
   (<span class="bold">CHECK</span>(<span class="bold">XMLIsValid</span>(OBJECT_VALUE) = 1))
   XMLSCHEMA "http://www.example.com/schemas/ipo.xsd" ELEMENT "purchaseOrder";</pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="transformation-and-validation-of-XMLType-data.html#GUID-45DAA30E-3F14-4D70-8105-ED3855B92A50" title="Besides needing to know whether a particular XML document is well-formed, you often need to know whether it conforms to a given XML schema, that is, whether it is valid with respect to that XML schema.">Validation of XMLType Instances</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>