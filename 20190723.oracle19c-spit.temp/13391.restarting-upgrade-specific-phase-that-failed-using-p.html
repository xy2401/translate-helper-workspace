<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="Use this option to complete an upgrade after fixing errors.">
      <meta name="description" content="Use this option to complete an upgrade after fixing errors.">
      <title>Restarting the Upgrade from a Specific Phase that Failed Using -p</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Database Upgrade Guide">
      <meta property="og:description" content="Use this option to complete an upgrade after fixing errors.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Database Upgrade Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="database-upgrade-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-04-25T08:26:31-07:00">
      <meta name="dcterms.title" content="Database Upgrade Guide">
      <meta name="dcterms.dateCopyrighted" content="1996, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96252-05">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="rerunning-upgrades-oracle-database.html" title="Previous" type="text/html">
      <link rel="next" href="post-upgrade-tasks-oracle-database.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="UPGRD">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="rerunning-upgrades-oracle-database.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="post-upgrade-tasks-oracle-database.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Database Upgrade Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="upgrading-oracle-database.html" property="item" typeof="WebPage"><span property="name">Upgrading Oracle Database</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Restarting the Upgrade from a Specific Phase that Failed Using -p</li>
            </ol>
            <a id="GUID-AA77A1B9-C598-4979-AF3A-12DE713537F4" name="GUID-AA77A1B9-C598-4979-AF3A-12DE713537F4"></a>
            
            <h2 id="UPGRD-GUID-AA77A1B9-C598-4979-AF3A-12DE713537F4" class="sect2">Restarting the Upgrade from a Specific Phase that Failed Using -p</h2>
         </header>
         <div class="ind">
            <div>
               <p>Use this option to complete an upgrade after fixing errors.</p>
               <p>You can run the Parallel Upgrade Utility (<code>catctl.pl</code>, or the shell scripts <code>dbupgrade</code> or <code>dbupgrade.cmd</code>) with the <code class="codeph">-p</code> option to rerun an upgrade and skip upgrade phases that already have run successfully. You can also rerun the upgrade on one phase to test the fix for failed phases.
               </p>
               <p>To determine the phase number to restart, examine the upgrade log to identify where the first error occurred, and in what phase. You can then fix the cause of the error, and test the fix or rerun the upgrade to completion.</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="restarting-upgrade-specific-phase-that-failed-using-p.html#GUID-F9907B67-78C3-4BCB-B830-8A196BC1F0A2">Reviewing CDB Log Files for Failed Phases</a><br>Identify your log file location, and review the CDB and PDB log files.
                  </li>
                  <li class="ulchildlink"><a href="restarting-upgrade-specific-phase-that-failed-using-p.html#GUID-30AB55D5-2061-419D-8CDA-A78A269C79E6">Reviewing Non-CDB Log Files for Failed Phases</a><br>Identify your log file location, and review the Non-CDB log files. 
                  </li>
                  <li class="ulchildlink"><a href="restarting-upgrade-specific-phase-that-failed-using-p.html#GUID-29A9C778-7AE6-4C2C-85E6-4ADDA8466A34">Procedure for Finding and Restarting Multitenant Upgrades from a Failed Phase</a><br>To restart a multitenant upgrade from a failed phase, first identify which PDB created the error and then search its appropriate log file for the error.
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>Parent topic:</strong> <a href="upgrading-oracle-database.html#GUID-CC88F262-3370-4FFA-8604-EDA9F20F56D9" title="Oracle provides a comprehensive set of tools for upgrading Oracle Database with minimal downtime and for migrating your applications to the new release.">Upgrading Oracle Database</a></p>
                  </div>
               </div>
            </div>
            
            <div class="sect2"><a id="GUID-F9907B67-78C3-4BCB-B830-8A196BC1F0A2" name="GUID-F9907B67-78C3-4BCB-B830-8A196BC1F0A2"></a><h3 id="UPGRD-GUID-F9907B67-78C3-4BCB-B830-8A196BC1F0A2" class="sect3">Reviewing CDB Log Files for Failed Phases</h3>
               <div>
                  <p>Identify your log file location, and review the CDB and PDB log files.</p>
                  <div class="example" id="GUID-F9907B67-78C3-4BCB-B830-8A196BC1F0A2__GUID-83EDC627-AA98-4FEA-92C9-67008D0BA5BB">
                     <p>The location of the Automatic Diagnostic Repository (ADR) and the diagnostic log files created by the upgrade scripts can vary, depending on your environment variables and parameter settings.</p>
                     <p>You can set log file paths when you run the Parallel Upgrade Utility (<code>catctl</code>) by setting the <code class="codeph">-l</code> option to define a log file path.
                     </p>
                     <p></p>
                     <p>Log files for CDB$ROOT (CDBs) can span from <code class="codeph">catupgrd0...catupgrd7.log</code>. Log files for pluggable databases (PDBs) are identified by the PDB container name (<code class="codeph"><span class="variable" translate="no">dbname</span></code>), and span from <code class="codeph">catupgrdp<span class="variable" translate="no">dbname</span>0...catupgrdp<span class="variable" translate="no">dbname</span>7.log</code>.
                     </p>
                  </div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="restarting-upgrade-specific-phase-that-failed-using-p.html#GUID-AA77A1B9-C598-4979-AF3A-12DE713537F4" title="Use this option to complete an upgrade after fixing errors.">Restarting the Upgrade from a Specific Phase that Failed Using -p</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-30AB55D5-2061-419D-8CDA-A78A269C79E6" name="GUID-30AB55D5-2061-419D-8CDA-A78A269C79E6"></a><h3 id="UPGRD-GUID-30AB55D5-2061-419D-8CDA-A78A269C79E6" class="sect3">Reviewing Non-CDB Log Files for Failed Phases</h3>
               <div>
                  <p>Identify your log file location, and review the Non-CDB log files. </p>
                  <div class="section">
                     <p>The location of the Automatic Diagnostic Repository (ADR) and the diagnostic log files created by the upgrade scripts can vary, depending on your environment variables and parameter settings.</p>
                     <p>You can set log file paths when you run the Parallel Upgrade Utility (<code>catctl</code>) by setting the -l option to define a log file path.
                     </p>
                     <div class="infoboxnote" id="GUID-30AB55D5-2061-419D-8CDA-A78A269C79E6__GUID-AB81715A-60ED-43F8-AD1D-8572D821BD91">
                        <p class="notep1">Note:</p>
                        <p>Starting with Oracle Database 12<span class="italic">c</span>, release 1 (12.1), non-CDB architecture is deprecated. It can be desupported in a future release.
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-30AB55D5-2061-419D-8CDA-A78A269C79E6__GUID-83EDC627-AA98-4FEA-92C9-67008D0BA5BB">
                     <p>Log files can span from <code class="codeph">catupgrd0...catupgrd7.log</code>. 
                     </p>
                  </div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="restarting-upgrade-specific-phase-that-failed-using-p.html#GUID-AA77A1B9-C598-4979-AF3A-12DE713537F4" title="Use this option to complete an upgrade after fixing errors.">Restarting the Upgrade from a Specific Phase that Failed Using -p</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-29A9C778-7AE6-4C2C-85E6-4ADDA8466A34" name="GUID-29A9C778-7AE6-4C2C-85E6-4ADDA8466A34"></a><h3 id="UPGRD-GUID-29A9C778-7AE6-4C2C-85E6-4ADDA8466A34" class="sect3">Procedure for Finding and Restarting Multitenant Upgrades from a Failed Phase</h3>
               <div>
                  <p>To restart a multitenant upgrade from a failed phase, first identify which PDB created the error and then search its appropriate log file for the error.</p>
                  <div class="section">To identify the PDB that caused a multitenant upgrade failure, look at the upgrade summary report, or review catupgrd0.log; this log contains the upgrade summary report at the end of the file.</div>
                  <!-- class="section" -->
                  <div class="p">Use this procedure to check each log file looking for errors.</div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>Locate log files with errors. </span><div>
                           <p>For example:</p>
                           <p>Linux and Unix</p><pre class="pre codeblock"><code>$ grep -i 'error at line' catupgrd*.log 
</code></pre><p>Windows</p><pre class="pre codeblock"><code>C:\&gt; find /I "error at line" catupgrd*.log
</code></pre></div>
                        <div>The <code>grep</code> or <code>find</code> command displays the filenames of log files in which an error is found.
                        </div>
                     </li>
                     <li class="stepexpand"><span>Check each log file that has an error and identify where the first error occurred. Use the text editor of your choice to review each log file. Search for the first occurrence of the phrase <samp class="msgph">error at line</samp>'. When you find the phrase, then search backwards from the error (reverse search) for <code class="codeph">PHASE_TIME___START</code>.</span><div>
                           <p>For example:</p><pre class="pre codeblock"><code>PHASE_TIME___START 15 15-01-16 08:49:41
</code></pre></div>
                        <div>
                           <p>The number after <code class="codeph">PHASE_TIME___START</code> is the phase number where the error has occurred. In this example, the phase number is 15.
                           </p>
                           <p>Each log file can have an error in it. Repeat checking for the phrase <code class="codeph">PHASE_TIME___START</code>, and identify the phase number with errors for each log file that contains an error, and identify the log file that contains the lowest phase number.
                           </p>
                           <p>The log file that contains the lowest phase number is restart phase number, which is the phase number from which you restart the upgrade.</p>
                        </div>
                        <div>
                           <p>For example:</p><pre class="pre codeblock"><code>catupgrd0.log error occurred in phase 15:

PHASE_TIME___START 15 15-01-16 08:49:41

catupgrd1.log error occurred in phase 19:

PHASE_TIME___START 19 15-01-16 08:50:01
</code></pre></div>
                        <div>
                           <p>In this example, the restart phase number is 15. Ensure that you identify the first error seen in all the log files, so that you can restart the upgrade from that phase.</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>Restart the upgrade from the failed phase by changing directory to the running the Parallel Upgrade Utility (<code>catctl.pl</code>, which you can run from the command line using <code>dbupgrade</code> on Linux and Unix, and <code>dbupgrade.cmd</code> on Windows). Use the <code class="codeph">-p</code> flag to indicate that you want to restart the upgrade from a phase, and provide the restart phase number. In multitenant databases, also use the <code class="codeph">-c</code> flag using the syntax <code class="codeph">-c '<span class="variable" translate="no">PDBname</span>'</code>, where <code class="codeph"><span class="variable" translate="no">PDBname</span></code> is the name of the PDB where the failure occurred.</span><div>
                           <p>For example:</p>
                           <p>Non-CDB Oracle Database on a Linux or UNIX system:</p><pre class="pre codeblock"><code>cd $ORACLE_HOME/bin
dbupgrade -p 15</code></pre><p>PDB in a multitenant Oracle Database (CDB) on a Windows system:</p><pre class="pre codeblock"><code>cd $ORACLE_HOME/bin
dbupgrade -p 15 -c 'PDB1'</code></pre></div>
                        <div>In both examples, the upgrade is restarted from phase 15, identified with the <code class="codeph">-p</code> flag. In the multitenant example, the PDB with the error is identified with the <code class="codeph">-c</code> flag.
                        </div>
                        <div>In these examples, the upgrade starts from phase 15 and runs to the end of the upgrade.</div>
                     </li>
                     <li class="stepexpand"><span>(Optional) You can also run the phase that contained an error by specifying a stop phase, using the <code class="codeph">-P</code> flag. Using a stop phase allows the upgrade to just rerun that phase in which the error occurred. You can determine quickly if the error is fixed by running it on the phase with the error, without running the entire upgrade.</span><div>
                           <p>For example, using the Perl script Parallel Upgrade Utility command option:</p><pre class="pre codeblock"><code>cd $ORACLE_HOME/rdbms/admin
$ORACLE_HOME/perl/bin/perl catctl.pl -p 15 -P 15 -c 'PDB1' </code></pre></div>
                        <div>After you confirm that the error is fixed in the phase with the error, you can then resume the upgrade after that phase.</div>
                        <div>
                           <p>For example, if you have confirmed that the error in phase 15 of your multitenant database upgrade of PDB1 is fixed, then you can use the following command on Linux and Unix systems to continue the upgrade at phase 16:</p><pre class="pre codeblock"><code>cd $ORACLE_HOME/bin dbupgrade -p 16 -c 'PDB1' </code></pre></div>
                     </li>
                  </ol>
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="restarting-upgrade-specific-phase-that-failed-using-p.html#GUID-AA77A1B9-C598-4979-AF3A-12DE713537F4" title="Use this option to complete an upgrade after fixing errors.">Restarting the Upgrade from a Specific Phase that Failed Using -p</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>