<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="Optimizer Statistics Advisor analyzes how optimizer statistics are gathered, and then makes recommendations.">
      <meta name="description" content="Optimizer Statistics Advisor analyzes how optimizer statistics are gathered, and then makes recommendations.">
      <title>Analyzing Statistics Using Optimizer Statistics Advisor</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="SQL Tuning Guide">
      <meta property="og:description" content="Optimizer Statistics Advisor analyzes how optimizer statistics are gathered, and then makes recommendations.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="SQL Tuning Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="sql-tuning-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-31T14:57:08-08:00">
      <meta name="dcterms.title" content="SQL Tuning Guide">
      <meta name="dcterms.dateCopyrighted" content="2013, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96095-03">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="transporting-optimizer-statistics.html" title="Previous" type="text/html">
      <link rel="next" href="optimizer-controls.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TGSQL">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="transporting-optimizer-statistics.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="optimizer-controls.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">SQL Tuning Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="optimizer-statistics.html" property="item" typeof="WebPage"><span property="name">Optimizer Statistics</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Analyzing Statistics Using Optimizer Statistics Advisor</li>
            </ol>
            <a id="GUID-054F4B76-DD57-46EE-98EA-0FF04F49D1B3" name="GUID-054F4B76-DD57-46EE-98EA-0FF04F49D1B3"></a>
            
            <h2 id="TGSQL-GUID-054F4B76-DD57-46EE-98EA-0FF04F49D1B3" class="sect2"><span class="enumeration_chapter">18 </span>Analyzing Statistics Using Optimizer Statistics Advisor
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>Optimizer Statistics Advisor analyzes how optimizer statistics are gathered, and then makes recommendations.</p>
               <p>This chapter contains the following topics:</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-11B3764D-CCA1-415F-88DD-0F6884DF8D89">About Optimizer Statistics Advisor</a><br>Optimizer Statistics Advisor is built-in diagnostic software that analyzes the quality of statistics and statistics-related tasks. 
                  </li>
                  <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75">Basic Tasks for Optimizer Statistics Advisor</a><br>This section explains the basic workflow for using Optimizer Statistics Advisor. All procedures and functions are in the <code class="codeph">DBMS_STATS</code> package.
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>Parent topic:</strong> <a href="optimizer-statistics.html#GUID-0A2F3D52-A135-43E1-9CAB-55BFE068A297" title="The accuracy of an execution plan depends on the quality of the optimizer statistics.">Optimizer Statistics</a></p>
                  </div>
               </div>
            </div>
            
            <div class="sect2"><a id="GUID-11B3764D-CCA1-415F-88DD-0F6884DF8D89" name="GUID-11B3764D-CCA1-415F-88DD-0F6884DF8D89"></a><h3 id="TGSQL-GUID-11B3764D-CCA1-415F-88DD-0F6884DF8D89" class="sect3"><span class="enumeration_section">18.1 </span>About Optimizer Statistics Advisor
               </h3>
               <div>
                  <p>Optimizer Statistics Advisor is built-in diagnostic software that analyzes the quality of statistics and statistics-related tasks. </p>
                  <p>The advisor task runs automatically in the maintenance window, but you can also run it on demand. You can then view the advisor report. If the advisor makes recommendations, then in some cases you can run system-generated scripts to implement them.</p>
                  <p>The following figure provides a conceptual overview of Optimizer Statistics Advisor.</p>
                  <div class="figure" id="GUID-11B3764D-CCA1-415F-88DD-0F6884DF8D89__GUID-3307A35E-0220-42B0-8493-93F08A0A408C">
                     <p class="titleinfigure">Figure 18-1 Optimizer Statistics Advisor</p><img src="img/tgsql_vm_093.png" alt="Description of Figure 18-1 follows" title="Description of Figure 18-1 follows" longdesc="img_text/tgsql_vm_093.html"><br><a href="img_text/tgsql_vm_093.html">Description of "Figure 18-1 Optimizer Statistics Advisor"</a></div>
                  <!-- class="figure" -->
                  <p>This section contains the following topics:</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-B934DB62-F4AE-420C-B7C7-EE7FC3747C09">Purpose of Optimizer Statistics Advisor</a><br>Optimizer Statistics Advisor inspects how optimizer statistics are gathered.
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-2802EC39-07D0-4BBE-8E3B-07068A44C5B7">Optimizer Statistics Advisor Concepts</a><br>Optimizer Statistics Advisor uses the same advisor framework as Automatic Database Diagnostic Monitor (ADDM), SQL Performance Analyzer, and other advisors. 
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-36A7C2FE-C573-44D8-8CB0-CC6E11F814A7">Command-Line Interface to Optimizer Statistics Advisor</a><br>Perform Optimizer Statistics Advisor tasks using the <code class="codeph">DBMS_STATS</code> PL/SQL package.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-054F4B76-DD57-46EE-98EA-0FF04F49D1B3" title="Optimizer Statistics Advisor analyzes how optimizer statistics are gathered, and then makes recommendations.">Analyzing Statistics Using Optimizer Statistics Advisor</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-B934DB62-F4AE-420C-B7C7-EE7FC3747C09" name="GUID-B934DB62-F4AE-420C-B7C7-EE7FC3747C09"></a><h4 id="TGSQL-GUID-B934DB62-F4AE-420C-B7C7-EE7FC3747C09" class="sect4"><span class="enumeration_section">18.1.1 </span>Purpose of Optimizer Statistics Advisor
                  </h4>
                  <div>
                     <p>Optimizer Statistics Advisor inspects how optimizer statistics are gathered.</p>
                     <p>The advisor automatically diagnoses problems in the existing practices for gathering statistics. The advisor does <span class="italic">not</span> gather a new or alternative set of optimizer statistics. The output of the advisor is a report of findings and recommendations, which helps you follow best practices for gathering statistics.
                     </p>
                     <p>Optimizer statistics play a significant part in determining the execution plan for queries. Therefore, it is critical for the optimizer to gather and maintain accurate and up-to-date statistics. The optimizer provides the <code class="codeph">DBMS_STATS</code> package, which evolves from release to release, for this purpose. Typically, users develop their own strategies for gathering statistics based on specific workloads, and then use homegrown scripts to implement these strategies.
                     </p>
                     <p>This section contains the following topics:</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-F5B8540A-CF7E-464D-8288-25BC5966ACFA">Problems with a Traditional Script-Based Approach</a><br>The advantage of the scripted approach is that the scripts are typically tested and reviewed. However, the owner of suboptimal legacy scripts may not change them for fear of causing plan changes.
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-D81A7708-FDA0-45BB-A6E2-103858B047AE">Advantages of Optimizer Statistics Advisor</a><br>An advisor-based approach offers better scalability and maintainability than the traditional approach. 
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-11B3764D-CCA1-415F-88DD-0F6884DF8D89" title="Optimizer Statistics Advisor is built-in diagnostic software that analyzes the quality of statistics and statistics-related tasks.">About Optimizer Statistics Advisor</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="sect4"><a id="GUID-F5B8540A-CF7E-464D-8288-25BC5966ACFA" name="GUID-F5B8540A-CF7E-464D-8288-25BC5966ACFA"></a><h5 id="TGSQL-GUID-F5B8540A-CF7E-464D-8288-25BC5966ACFA" class="sect5"><span class="enumeration_section">18.1.1.1 </span>Problems with a Traditional Script-Based Approach
                     </h5>
                     <div>
                        <p>The advantage of the scripted approach is that the scripts are typically tested and reviewed. However, the owner of suboptimal legacy scripts may not change them for fear of causing plan changes.</p>
                        <p>The traditional approach has the following problems:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Legacy scripts may not keep pace with new best practices, which can change from release to release.</p>
                              <p>Frequently, successive releases add enhancements to histograms, sampling, workload monitoring, concurrency, and other optimizer-related features. For example, starting in <span>Oracle Database 12c</span>, Oracle recommends setting <code class="codeph">AUTO_SAMPLE_SIZE</code> instead of a percentage. However, legacy scripts typically specify a sampling percentage, which may lead to suboptimal execution plans.
                              </p>
                           </li>
                           <li>
                              <p>Resources are wasted on unnecessary statistics gathering.</p>
                              <p>A script may gather statistics multiple times each day on the same table.</p>
                           </li>
                           <li>
                              <p>Automatic statistics gathering jobs do not guarantee accurate and up-to-date statistics.</p>
                              <p>For example, sometimes the automatic statistics gathering job is not running because an initialization parameter combination disables it, or the job is terminated. Moreover, sometimes the automatic job maintenance window is insufficient because of resource constraints, or because too many objects require statistics collection. Jobs that stop running before gathering all statistics cause either no statistics or stale statistics for some objects, which can in turn cause suboptimal plans.</p>
                           </li>
                           <li>
                              <p>Statistics can sometimes be missing, stale, or incorrect.</p>
                              <p>For example, statistics may be inconsistent between a table and its index, or between tables with a primary key-foreign key relationship. Alternatively, a statistics gathering job may have been disabled by accident, or you may be unaware that a script has failed.</p>
                           </li>
                           <li>
                              <p>Lack of knowledge of the problem can be time-consuming and resource-intensive.</p>
                              <p>For example, a service request might seek a resolution to a problem, unaware that the problem is caused by suboptimal statistics. The diagnosis might require a great deal of time emailing scripts of the problematic queries, enabling traces, and investigating traces.</p>
                           </li>
                           <li>
                              <p>Recommended fixes may not be feasible.</p>
                              <p>Performance engineers may recommend changing the application code that maintains statistics. In some organizations, this requirement may be difficult or impossible to satisfy.</p>
                           </li>
                        </ul>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-B934DB62-F4AE-420C-B7C7-EE7FC3747C09" title="Optimizer Statistics Advisor inspects how optimizer statistics are gathered.">Purpose of Optimizer Statistics Advisor</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-D81A7708-FDA0-45BB-A6E2-103858B047AE" name="GUID-D81A7708-FDA0-45BB-A6E2-103858B047AE"></a><h5 id="TGSQL-GUID-D81A7708-FDA0-45BB-A6E2-103858B047AE" class="sect5"><span class="enumeration_section">18.1.1.2 </span>Advantages of Optimizer Statistics Advisor
                     </h5>
                     <div>
                        <p>An advisor-based approach offers better scalability and maintainability than the traditional approach. </p>
                        <p>If best practices change in a new release, then Optimizer Statistics Advisor encodes these practices in its rules. In this way, the advisor always provides the most up-to-date recommendations.</p>
                        <p>The advisor analyzes how you are currently gathering statistics (using manual scripts, explicitly setting parameters, and so on), the effectiveness of existing statistics gathering jobs, and the quality of the gathered statistics. Optimizer Statistics Advisor does <span class="italic">not</span> gather a new or alternative set of optimizer statistics, and so does not affect the workload. Rather, Optimizer Statistics Advisor analyzes information stored in the data dictionary, and then stores the findings and recommendations in the database.
                        </p>
                        <p>Optimizer Statistics Advisor provides the following advantages over the traditional approach:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Provides easy-to-understand reports</p>
                              <p>The advisor applies rules to generate findings, recommendations, and actions.</p>
                           </li>
                           <li>
                              <p>Supplies scripts to implement necessary fixes <span class="italic">without</span> requiring changes to application code
                              </p>
                              <p>When you implement a recommended action, benefit accrues to every execution of the improved statements. For example, if you set a global preference so that the sample size is <code class="codeph">AUTO_SAMPLE_SIZE</code> rather than a suboptimal percentage, then every plan based on the improved statistics can benefit from this change.
                              </p>
                           </li>
                           <li>
                              <p>Runs a predefined task named <code class="codeph">AUTO_STATS_ADVISOR_TASK</code>  once every day in the maintenance window
                              </p>
                              <p>For the automated job to run, the <code class="codeph">STATISTICS_LEVEL</code> initialization parameter must be set to <code class="codeph">TYPICAL</code> or <code class="codeph">ALL</code>.
                              </p>
                           </li>
                           <li>
                              <p>Supplies an API in the <code class="codeph">DBMS_STATS</code> package that enables you to create and run tasks manually, store findings and recommendations in data dictionary views, generate reports for the tasks, and implement corrections when necessary
                              </p>
                           </li>
                           <li>
                              <p>Integrates with existing tools</p>
                              <p>The advisor integrates with SQL Tuning Advisor and AWR, which summarize the Optimizer Statistics Advisor results.</p>
                           </li>
                        </ul>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-B934DB62-F4AE-420C-B7C7-EE7FC3747C09" title="Optimizer Statistics Advisor inspects how optimizer statistics are gathered.">Purpose of Optimizer Statistics Advisor</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
               <div class="sect3"><a id="GUID-2802EC39-07D0-4BBE-8E3B-07068A44C5B7" name="GUID-2802EC39-07D0-4BBE-8E3B-07068A44C5B7"></a><h4 id="TGSQL-GUID-2802EC39-07D0-4BBE-8E3B-07068A44C5B7" class="sect4"><span class="enumeration_section">18.1.2 </span>Optimizer Statistics Advisor Concepts
                  </h4>
                  <div>
                     <p>Optimizer Statistics Advisor uses the same advisor framework as Automatic Database Diagnostic Monitor (ADDM), SQL Performance Analyzer, and other advisors. </p>
                     <p>This section contains the following topics:</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-C1B53649-68FA-42F7-A06F-03D36A3F2B82">Components of Optimizer Statistics Advisor</a><br>The Optimizer Statistics Optimizer framework stores its metadata in data dictionary and dynamic performance views.
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-E842A1E1-3F81-4867-A808-F9CD27E066DB">Operational Modes for Optimizer Statistics Advisor</a><br>Optimizer Statistics Advisor supports both an automated and manual mode.
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-11B3764D-CCA1-415F-88DD-0F6884DF8D89" title="Optimizer Statistics Advisor is built-in diagnostic software that analyzes the quality of statistics and statistics-related tasks.">About Optimizer Statistics Advisor</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="sect4"><a id="GUID-C1B53649-68FA-42F7-A06F-03D36A3F2B82" name="GUID-C1B53649-68FA-42F7-A06F-03D36A3F2B82"></a><h5 id="TGSQL-GUID-C1B53649-68FA-42F7-A06F-03D36A3F2B82" class="sect5"><span class="enumeration_section">18.1.2.1 </span>Components of Optimizer Statistics Advisor
                     </h5>
                     <div>
                        <p>The Optimizer Statistics Optimizer framework stores its metadata in data dictionary and dynamic performance views.</p>
                        <p>The following Venn diagram shows the relationships among rules, findings, recommendations, and actions for Optimizer Statistics Advisor. For example, all findings are derived from rules, but not all rules generate findings.</p>
                        <div class="figure" id="GUID-C1B53649-68FA-42F7-A06F-03D36A3F2B82__GUID-73DED707-37AB-4B4E-B978-A853E625DC89">
                           <p class="titleinfigure">Figure 18-2 Optimizer Statistics Advisor Components</p><img src="img/tgsql_vm_091.png" alt="Description of Figure 18-2 follows" title="Description of Figure 18-2 follows" longdesc="img_text/tgsql_vm_091.html"><br><a href="img_text/tgsql_vm_091.html">Description of "Figure 18-2 Optimizer Statistics Advisor Components"</a></div>
                        <!-- class="figure" -->
                        <p>This section contains the following topics:</p>
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-6D8831EA-B478-4641-B84B-C341BB4D0799">Rules for Optimizer Statistics Advisor</a><br>An <span class="bold">Optimizer Statistics Advisor rule</span> is an Oracle-supplied standard by which Optimizer Statistics Advisor performs its checks. 
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-DA78E598-E6C9-4CB4-98CE-756C568AAEFC">Findings for Optimizer Statistics Advisor</a><br>A finding results when Optimizer Statistics Advisor examines the evidence stored in the database and concludes that the rules were not followed.
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-2A7A6CC8-D5FC-428B-B7F6-BE9483EE9212">Recommendations for Optimizer Statistics Advisor</a><br>Based on each finding, Optimizer Statistics Advisor makes recommendations on how to achieve better statistics. 
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-5AD86797-429E-45C5-B075-E4682AC2E41A">Actions for Optimizer Statistics Advisor</a><br>An Optimizer Statistics Advisor action is a SQL or PL/SQL script that implements recommendations. When feasible, recommendations have corresponding actions. The advisor stores actions in <code class="codeph">DBA_ADVISOR_ACTIONS</code>.
                           </li>
                        </ul>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-2802EC39-07D0-4BBE-8E3B-07068A44C5B7" title="Optimizer Statistics Advisor uses the same advisor framework as Automatic Database Diagnostic Monitor (ADDM), SQL Performance Analyzer, and other advisors.">Optimizer Statistics Advisor Concepts</a></p>
                           </div>
                        </div>
                     </div>
                     
                     <div class="sect5"><a id="GUID-6D8831EA-B478-4641-B84B-C341BB4D0799" name="GUID-6D8831EA-B478-4641-B84B-C341BB4D0799"></a><h6 id="TGSQL-GUID-6D8831EA-B478-4641-B84B-C341BB4D0799" class="sect6"><span class="enumeration_section">18.1.2.1.1 </span>Rules for Optimizer Statistics Advisor
                        </h6>
                        <div>
                           <p>An <span class="bold">Optimizer Statistics Advisor rule</span> is an Oracle-supplied standard by which Optimizer Statistics Advisor performs its checks. 
                           </p>
                           <p>The rules embody Oracle best practices based on the current feature set. If the best practices change from release to release, then the Optimizer Statistics Advisor rules also change.</p>
                           <p>The advisor organizes rules into the following classes:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>System</p>
                                 <p>This class checks the preferences for statistics collection, status of the automated statistics gathering job, use of SQL plan directives, and so on. Rules in this class have the value <code class="codeph">SYSTEM</code> in <code class="codeph">V$STATS_ADVISOR_RULES.RULE_TYPE</code>.
                                 </p>
                              </li>
                              <li>
                                 <p>Operation</p>
                                 <p>This class checks whether statistics collection uses the defaults, test statistics are created using the <code class="codeph">SET_<span class="codeinlineitalic">*</span>_STATS</code> procedures, and so on. Rules in this class have the value <code class="codeph">OPERATION</code> in <code class="codeph">V$STATS_ADVISOR_RULES.RULE_TYPE</code>.
                                 </p>
                              </li>
                              <li>
                                 <p>Object</p>
                                 <p>This class checks for the quality of the statistics, staleness of statistics, unnecessary collection of statistics, and so on. Rules in this class have the value <code class="codeph">OBJECT</code> in <code class="codeph">V$STATS_ADVISOR_RULES.RULE_TYPE</code>.
                                 </p>
                              </li>
                           </ul>
                           <p>The rules check for the following problems:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>How to gather statistics</p>
                                 <p>For example, one rule might specify the recommended setting for an initialization parameter. Another rule might specify that statistics should be gathered at the schema level.</p>
                              </li>
                              <li>
                                 <p>When to gather statistics</p>
                                 <p>For example, the advisor may recommend that the maintenance window for the automatic statistics gathering job should be enabled, or that the window should be extended.</p>
                              </li>
                              <li>
                                 <p>How to improve the efficiency of statistics gathering</p>
                                 <p>For example, a rule might specify that default parameters should be used in <code class="codeph">DBMS_STATS</code>, or that statistics should not be set manually.
                                 </p>
                              </li>
                           </ul>
                           <p>In <code class="codeph">V$STATS_ADVISOR_RULES</code>, each rule has a unique string ID that is usable in the <code class="codeph">DBMS_STATS</code> procedures and reports. You can use a <a href="glossary.html#GUID-AB17E858-B95F-4C39-85D7-1A17241A2204"><span class="xrefglossterm">rule filter</span></a> to specify rules that Optimizer Statistics Advisor should check. However, you cannot write new rules.
                           </p>
                           <div class="example" id="GUID-6D8831EA-B478-4641-B84B-C341BB4D0799__GUID-795C627B-3387-4BD5-A190-2B1BA8DF5E7B">
                              <p class="titleinexample">Example 18-1 Listing Rules in V$STATS_ADVISOR_RULES</p>
                              <p>The following query, with sample output, lists a subset of the rules in <code class="codeph">V$STATS_ADVISOR_RULES</code>. The rules may change from release to release.
                              </p><pre class="pre codeblock"><code>SET LINESIZE 208
SET PAGESIZE 100
COL ID FORMAT 99
COL NAME FORMAT a33
COL DESCRIPTION FORMAT a62

SELECT RULE_ID AS ID, NAME, RULE_TYPE, DESCRIPTION 
FROM   V$STATS_ADVISOR_RULES 
WHERE  RULE_ID BETWEEN 1 AND 12
ORDER BY RULE_ID;

ID NAME                            RULE_TYPE DESCRIPTION
-- ------------------------------- --------- -------------------------------------------------------
 1 UseAutoJob                      SYSTEM    Use Auto Job for Statistics Collection
 2 CompleteAutoJob                 SYSTEM    Auto Statistics Gather Job should complete successfully
 3 MaintainStatsHistory            SYSTEM    Maintain Statistics History
 4 UseConcurrent                   SYSTEM    Use Concurrent preference for Statistics Collection
 5 UseDefaultPreference            SYSTEM    Use Default Preference for Stats Collection
 6 TurnOnSQLPlanDirective          SYSTEM    SQL Plan Directives should not be disabled
 7 AvoidSetProcedures              OPERATION Avoid Set Statistics Procedures
 8 UseDefaultParams                OPERATION Use Default Parameters in Statistics Collection Proc.
 9 UseGatherSchemaStats            OPERATION Use gather_schema_stats procedure
10 AvoidInefficientStatsOprSeq     OPERATION Avoid inefficient statistics operation sequences
11 AvoidUnnecessaryStatsCollection OBJECT    Avoid unnecessary statistics collection
12 AvoidStaleStats                 OBJECT    Avoid objects with stale or no statistics

12 rows selected.
</code></pre></div>
                           <!-- class="example" -->
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-6D8831EA-B478-4641-B84B-C341BB4D0799__GUID-96037AE8-F724-4819-9772-E9C433D14026">
                              <p class="notep1">See Also:</p>
                              <p><a href="../refrn/V-STATS_ADVISOR_RULES.html#REFRN-GUID-C19D0FE4-3D40-45E3-B695-F5862CBF42C4" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn more about <code class="codeph">V$STATS_ADVISOR_RULES</code></p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-C1B53649-68FA-42F7-A06F-03D36A3F2B82" title="The Optimizer Statistics Optimizer framework stores its metadata in data dictionary and dynamic performance views.">Components of Optimizer Statistics Advisor</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-DA78E598-E6C9-4CB4-98CE-756C568AAEFC" name="GUID-DA78E598-E6C9-4CB4-98CE-756C568AAEFC"></a><h6 id="TGSQL-GUID-DA78E598-E6C9-4CB4-98CE-756C568AAEFC" class="sect6"><span class="enumeration_section">18.1.2.1.2 </span>Findings for Optimizer Statistics Advisor
                        </h6>
                        <div>
                           <p>A finding results when Optimizer Statistics Advisor examines the evidence stored in the database and concludes that the rules were not followed.</p>
                           <p>To generate findings, Optimizer Statistics Advisor executes a task, which is invoked either automatically or manually. This task analyzes the statistics history stored in the data dictionary, the statistics operation log, and the current statistics footprint that exists in <code class="codeph">SYSAUX</code>. For example, the advisor queries <code class="codeph">DBA_TAB_STATISTICS</code> and <code class="codeph">DBA_IND_STATISTICS</code> to determine whether statistics are stale, or whether a discrepancy exists between the numbers of rows.
                           </p>
                           <p>Typically, Optimizer Statistics Advisor generates a finding when a specific rule is not followed or is violated, although some findings—such as object staleness—provide only information. For example, a finding may show that <code class="codeph">DBMS_STATS.GATHER_TABLE_STATS</code> has used <code class="codeph">ESTIMATE_PERCENT=&gt;0.01</code>, which violates the <code class="codeph">ESTIMATE_PERCENT=&gt;AUTO_SAMPLE_SIZE</code> rule.
                           </p>
                           <p>A finding corresponds to exactly one rule. However, a rule can generate many findings.</p>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-DA78E598-E6C9-4CB4-98CE-756C568AAEFC__GUID-B2F54798-6AF1-4D2D-B090-2B944214AE71">
                              <p class="notep1">See Also:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS-GUID-01FAB8ED-E4A3-4C3E-8FE2-88717DCDDA06" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about <code class="codeph">DBMS_STATS</code></p>
                                 </li>
                                 <li>
                                    <p><a href="../refrn/ALL_TAB_STATISTICS.html#REFRN-GUID-C567F729-3748-4DFE-A22C-115CB7575D63" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn more about <code class="codeph">ALL_TAB_STATISTICS</code></p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-C1B53649-68FA-42F7-A06F-03D36A3F2B82" title="The Optimizer Statistics Optimizer framework stores its metadata in data dictionary and dynamic performance views.">Components of Optimizer Statistics Advisor</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-2A7A6CC8-D5FC-428B-B7F6-BE9483EE9212" name="GUID-2A7A6CC8-D5FC-428B-B7F6-BE9483EE9212"></a><h6 id="TGSQL-GUID-2A7A6CC8-D5FC-428B-B7F6-BE9483EE9212" class="sect6"><span class="enumeration_section">18.1.2.1.3 </span>Recommendations for Optimizer Statistics Advisor
                        </h6>
                        <div>
                           <p>Based on each finding, Optimizer Statistics Advisor makes recommendations on how to achieve better statistics. </p>
                           <p>For example, the advisor might discover a violation to the rule of not using sampling when gathering statistics, and recommend specifying <code class="codeph">AUTO_SAMPLE_SIZE</code> instead. The advisor stores the recommendations in <code class="codeph">DBA_ADVISOR_RECOMMENDATIONS</code>.
                           </p>
                           <p>Multiple recommendations may exist for a single finding. In this case, you must investigate to determine which recommendation to follow. Each recommendation includes one or more rationales that explain why Optimizer Statistics Advisor makes its recommendation. In some cases, findings may not generate recommendations.</p>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-2A7A6CC8-D5FC-428B-B7F6-BE9483EE9212__GUID-EDE77F14-6A65-4222-B9EA-25E7256C441C">
                              <p class="notep1">See Also:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><span class="q">"<a href="gathering-optimizer-statistics.html#GUID-88E321BF-445E-40BD-83A2-9EA107689B2F" title="In the context of optimizer statistics, sampling is the gathering of statistics from a random subset of table rows. By enabling the database to avoid full table scans and sorts of entire tables, sampling minimizes the resources necessary to gather statistics.">Guideline for Setting the Sample Size</a>"</span> to learn the guideline for the sample size
                                    </p>
                                 </li>
                                 <li>
                                    <p><a href="../refrn/DBA_ADVISOR_RECOMMENDATIONS.html#REFRN-GUID-A6E04D5A-5F3E-4DB7-AD7C-AB109439A80A" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about <code class="codeph">DBA_ADVISOR_RECOMMENDATIONS</code></p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-C1B53649-68FA-42F7-A06F-03D36A3F2B82" title="The Optimizer Statistics Optimizer framework stores its metadata in data dictionary and dynamic performance views.">Components of Optimizer Statistics Advisor</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-5AD86797-429E-45C5-B075-E4682AC2E41A" name="GUID-5AD86797-429E-45C5-B075-E4682AC2E41A"></a><h6 id="TGSQL-GUID-5AD86797-429E-45C5-B075-E4682AC2E41A" class="sect6"><span class="enumeration_section">18.1.2.1.4 </span>Actions for Optimizer Statistics Advisor
                        </h6>
                        <div>
                           <p>An Optimizer Statistics Advisor action is a SQL or PL/SQL script that implements recommendations. When feasible, recommendations have corresponding actions. The advisor stores actions in <code class="codeph">DBA_ADVISOR_ACTIONS</code>.
                           </p>
                           <p>For example, Optimizer Statistics Advisor executes a task that performs the following steps:</p>
                           <ol>
                              <li>
                                 <p>Checks rules</p>
                                 <p>The advisor checks conformity to the rule that stale statistics should be avoided.</p>
                              </li>
                              <li>
                                 <p>Generates finding</p>
                                 <p>The advisor discovers that a number of objects have no statistics.</p>
                              </li>
                              <li>
                                 <p>Generates recommendation</p>
                                 <p>The advisor recommends gathering statistics on the objects with no statistics.</p>
                              </li>
                              <li>
                                 <p>Generates action</p>
                                 <p>The advisor generates a PL/SQL script that executes <code class="codeph">DBMS_STATS.GATHER_DATABASE_STATS</code>, supplying a list of objects that need to have statistics gathered.
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-5AD86797-429E-45C5-B075-E4682AC2E41A__GUID-EDE77F14-6A65-4222-B9EA-25E7256C441C">
                              <p class="notep1">See Also:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><span class="q">"<a href="options-for-optimizer-statistics-gathering.html#GUID-E616363F-0A7B-4D4D-9384-63934DB69F7D" title="The preference_overrides_parameter statistics preference determines whether, when gathering optimizer statistics, to override the input value of a parameter with the statistics preference. In this way, you control when the database honors a parameter value passed to the statistics gathering procedures.">Statistics Preference Overrides</a>"</span> to learn how to override statistics gathering preferences
                                    </p>
                                 </li>
                                 <li>
                                    <p><span class="q">"<a href="gathering-optimizer-statistics.html#GUID-88E321BF-445E-40BD-83A2-9EA107689B2F" title="In the context of optimizer statistics, sampling is the gathering of statistics from a random subset of table rows. By enabling the database to avoid full table scans and sorts of entire tables, sampling minimizes the resources necessary to gather statistics.">Guideline for Setting the Sample Size</a>"</span> to learn more about <code class="codeph">AUTO_SAMPLE_SIZE</code></p>
                                 </li>
                                 <li>
                                    <p><a href="../refrn/DBA_ADVISOR_ACTIONS.html#REFRN-GUID-1D63E30C-4B9B-44A6-B03A-8D983906CB3F" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about <code class="codeph">DBA_ADVISOR_ACTIONS</code></p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-C1B53649-68FA-42F7-A06F-03D36A3F2B82" title="The Optimizer Statistics Optimizer framework stores its metadata in data dictionary and dynamic performance views.">Components of Optimizer Statistics Advisor</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-E842A1E1-3F81-4867-A808-F9CD27E066DB" name="GUID-E842A1E1-3F81-4867-A808-F9CD27E066DB"></a><h5 id="TGSQL-GUID-E842A1E1-3F81-4867-A808-F9CD27E066DB" class="sect5"><span class="enumeration_section">18.1.2.2 </span>Operational Modes for Optimizer Statistics Advisor
                     </h5>
                     <div>
                        <p>Optimizer Statistics Advisor supports both an automated and manual mode.</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Automated</p>
                              <p> The predefined task <code class="codeph">AUTO_STATS_ADVISOR_TASK</code> runs automatically in the maintenance window once per day. The task runs as part of the automatic optimizer statistics collection client. The automated task generates findings and recommendations, but does not implement actions automatically.
                              </p>
                              <p>As for any other task, you can configure the automated task, and generate reports. If the report recommends actions, then you can implement the actions manually.</p>
                           </li>
                           <li>
                              <p>Manual</p>
                              <p>You can create your own task using the <code class="codeph">DBMS_STATS.CREATE_ADVISOR_TASK</code> function, and then run it at any time using the <code class="codeph">EXECUTE_ADVISOR_TASK</code> procedure.
                              </p>
                              <p>Unlike the automated task, the manual task can implement actions automatically. Alternatively, you can configure the task to generate a PL/SQL script, which you can then run manually.</p>
                           </li>
                        </ul>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-E842A1E1-3F81-4867-A808-F9CD27E066DB__GUID-862BCFA7-307E-49CE-9544-D8E6EC866E61">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="q">"<a href="gathering-optimizer-statistics.html#GUID-F007E78A-9967-4921-8046-D8F59A9272B4" title="Oracle Database can gather optimizer statistics automatically.">Configuring Automatic Optimizer Statistics Collection</a>"</span></p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_STATS.html#GUID-FD355A10-E6FA-47A3-9228-A269905A156D" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about <code class="codeph">DBMS_STATS.CREATE_ADVISOR_TASK</code></p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-2802EC39-07D0-4BBE-8E3B-07068A44C5B7" title="Optimizer Statistics Advisor uses the same advisor framework as Automatic Database Diagnostic Monitor (ADDM), SQL Performance Analyzer, and other advisors.">Optimizer Statistics Advisor Concepts</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
               <div class="sect3"><a id="GUID-36A7C2FE-C573-44D8-8CB0-CC6E11F814A7" name="GUID-36A7C2FE-C573-44D8-8CB0-CC6E11F814A7"></a><h4 id="TGSQL-GUID-36A7C2FE-C573-44D8-8CB0-CC6E11F814A7" class="sect4"><span class="enumeration_section">18.1.3 </span>Command-Line Interface to Optimizer Statistics Advisor
                  </h4>
                  <div>
                     <p>Perform Optimizer Statistics Advisor tasks using the <code class="codeph">DBMS_STATS</code> PL/SQL package.
                     </p>
                     <div class="tblformal" id="GUID-36A7C2FE-C573-44D8-8CB0-CC6E11F814A7__SQLTUNINGADVISORPACKAGES-B5EBD3F6">
                        <p class="titleintable">Table 18-1 DBMS_STATS APIs for Task Creation and Deletion</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="DBMS_STATS APIs for Task Creation and Deletion" summary="This 2 column table shows procedures that create and delete tasks. Column 1 is the procedure. Column 2 describes that procedure. " width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="34%" id="d91513e2070">PL/SQL Procedure or Function</th>
                                 <th align="left" valign="bottom" width="66%" id="d91513e2073">Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="34%" id="d91513e2078" headers="d91513e2070 ">
                                    <p><code class="codeph">CREATE_ADVISOR_TASK</code></p>
                                 </td>
                                 <td align="left" valign="top" width="66%" headers="d91513e2078 d91513e2073 ">
                                    <p>Creates an advisor task for Optimizer Statistics Advisor. If the task name is already specified, then the advisor uses the specified task name; otherwise, the advisor automatically generates a new task name.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="34%" id="d91513e2086" headers="d91513e2070 ">
                                    <p><code class="codeph">DROP_ADVISOR_TASK</code></p>
                                 </td>
                                 <td align="left" valign="top" width="66%" headers="d91513e2086 d91513e2073 ">
                                    <p>Deletes an Optimizer Statistics Advisor task and all its result data.</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="tblformal" id="GUID-36A7C2FE-C573-44D8-8CB0-CC6E11F814A7__TASKEXECUTION-B5F7FCF5">
                        <p class="titleintable">Table 18-2 DBMS_STATS APIs for Task Execution</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="DBMS_STATS APIs for Task Execution" summary="This 2 column table shows procedures that execute, interrupt, cancel, reset, and resume tasks. Column 1 is the procedure. Column 2 describes that procedure. " width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="34%" id="d91513e2103">PL/SQL Procedure or Function</th>
                                 <th align="left" valign="bottom" width="66%" id="d91513e2106">Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="34%" id="d91513e2111" headers="d91513e2103 ">
                                    <p><code class="codeph">EXECUTE_ADVISOR_TASK</code></p>
                                 </td>
                                 <td align="left" valign="top" width="66%" headers="d91513e2111 d91513e2106 ">
                                    <p>Executes a previously created Optimizer Statistics Advisor task.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="34%" id="d91513e2119" headers="d91513e2103 ">
                                    <p><code class="codeph">INTERRUPT_ADVISOR_TASK</code></p>
                                 </td>
                                 <td align="left" valign="top" width="66%" headers="d91513e2119 d91513e2106 ">
                                    <p>Interrupts a currently executing Optimizer Statistics Advisor task. The task ends its operations as it would in a normal exit, enabling you to access intermediate results. You can resume the task later.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="34%" id="d91513e2127" headers="d91513e2103 ">
                                    <p><code class="codeph">CANCEL_ADVISOR_TASK</code></p>
                                 </td>
                                 <td align="left" valign="top" width="66%" headers="d91513e2127 d91513e2106 ">
                                    <p>Cancels an Optimizer Statistics Advisor task execution, and removes all intermediate results of the current execution.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="34%" id="d91513e2135" headers="d91513e2103 ">
                                    <p><code class="codeph">RESET_ADVISOR_TASK</code></p>
                                 </td>
                                 <td align="left" valign="top" width="66%" headers="d91513e2135 d91513e2106 ">
                                    <p>Resets an Optimizer Statistics Advisor task execution to its initial state. Call this procedure on a task that is not currently executing.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="34%" id="d91513e2143" headers="d91513e2103 ">
                                    <p><code class="codeph">RESUME_ADVISOR_TASK</code></p>
                                 </td>
                                 <td align="left" valign="top" width="66%" headers="d91513e2143 d91513e2106 ">
                                    <p>Resumes the Optimizer Statistics Advisor task execution that was most recently interrupted.</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="tblformal" id="GUID-36A7C2FE-C573-44D8-8CB0-CC6E11F814A7__GUID-0A877762-99C0-4115-B918-F04B2C2D13E6">
                        <p class="titleintable">Table 18-3 DBMS_STATS APIs for Advisor Reports</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="DBMS_STATS APIs for Advisor Reports" summary="This 2 column table shows procedures that report the results of a task, and get advisor recommendations. Column 1 is the procedure. Column 2 describes that procedure. " width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="40%" id="d91513e2160">PL/SQL Procedure or Function</th>
                                 <th align="left" valign="bottom" width="60%" id="d91513e2163">Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="40%" id="d91513e2168" headers="d91513e2160 ">
                                    <p><code class="codeph">REPORT_STATS_ADVISOR_TASK</code></p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d91513e2168 d91513e2163 ">
                                    <p>Reports the results of an Optimizer Statistics Advisor task.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="40%" id="d91513e2176" headers="d91513e2160 ">
                                    <p><code class="codeph">GET_ADVISOR_RECS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d91513e2176 d91513e2163 ">
                                    <p>Generates a recommendation report on the given item.</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="tblformal" id="GUID-36A7C2FE-C573-44D8-8CB0-CC6E11F814A7__GUID-E3167CD3-10BB-4152-A20E-DCFB33498234">
                        <p class="titleintable">Table 18-4 DBMS_STATS APIs for Task and Filter Configuration</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="DBMS_STATS APIs for Task and Filter Configuration" summary="This 2 column table shows procedures that configure tasks and filters. Column 1 is the procedure. Column 2 describes that procedure. " width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="45%" id="d91513e2193">PL/SQL Procedure or Function</th>
                                 <th align="left" valign="bottom" width="55%" id="d91513e2196">Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="45%" id="d91513e2201" headers="d91513e2193 ">
                                    <p><code class="codeph">CONFIGURE_ADVISOR_TASK</code></p>
                                 </td>
                                 <td align="left" valign="top" width="55%" headers="d91513e2201 d91513e2196 ">
                                    <p>Configures the Optimizer Statistics Advisor lists for the execution, reporting, script generation, and implementation of an advisor task.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="45%" id="d91513e2209" headers="d91513e2193 ">
                                    <p><code class="codeph">GET_ADVISOR_OPR_FILTER</code></p>
                                 </td>
                                 <td align="left" valign="top" width="55%" headers="d91513e2209 d91513e2196 ">
                                    <p>Creates an operation filter for a statistics operation.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="45%" id="d91513e2217" headers="d91513e2193 ">
                                    <p><code class="codeph">CONFIGURE_ADVISOR_RULE_FILTER</code></p>
                                 </td>
                                 <td align="left" valign="top" width="55%" headers="d91513e2217 d91513e2196 ">
                                    <p>Configures the rule filter for an Optimizer Statistics Advisor task.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="45%" id="d91513e2225" headers="d91513e2193 ">
                                    <p><code class="codeph">CONFIGURE_ADVISOR_OPR_FILTER</code></p>
                                 </td>
                                 <td align="left" valign="top" width="55%" headers="d91513e2225 d91513e2196 ">
                                    <p>Configures the operation filter for an Optimizer Statistics Advisor task.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="45%" id="d91513e2233" headers="d91513e2193 ">
                                    <p><code class="codeph">CONFIGURE_ADVISOR_OBJ_FILTER</code></p>
                                 </td>
                                 <td align="left" valign="top" width="55%" headers="d91513e2233 d91513e2196 ">
                                    <p>Configures the object filter for an Optimizer Statistics Advisor task.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="45%" id="d91513e2241" headers="d91513e2193 ">
                                    <p><code class="codeph">SET_ADVISOR_TASK_PARAMETER</code></p>
                                 </td>
                                 <td align="left" valign="top" width="55%" headers="d91513e2241 d91513e2196 ">
                                    <p>Updates the value of an Optimizer Statistics Advisor task parameter. Valid parameters are <code class="codeph">TIME_LIMIT</code> and <code class="codeph">OP_START_TIME</code>.
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="tblformal" id="GUID-36A7C2FE-C573-44D8-8CB0-CC6E11F814A7__GUID-047AD569-7B0A-4299-8213-CC0742FA540A">
                        <p class="titleintable">Table 18-5 DBMS_STATS APIs for Implementation of Recommended Actions</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="DBMS_STATS APIs for Implementation of Recommended Actions" summary="This 2 column table shows procedures that obtain scripts that implement actions, or implement the actions directly. Column 1 is the procedure. Column 2 describes that procedure. " width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="34%" id="d91513e2264">PL/SQL Procedure or Function</th>
                                 <th align="left" valign="bottom" width="66%" id="d91513e2267">Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="34%" id="d91513e2272" headers="d91513e2264 ">
                                    <p><code class="codeph">SCRIPT_ADVISOR_TASK</code></p>
                                 </td>
                                 <td align="left" valign="top" width="66%" headers="d91513e2272 d91513e2267 ">
                                    <p>Gets the script that implements the recommended actions for the problems found by the advisor. You can check this script, and then choose which actions to execute.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="34%" id="d91513e2280" headers="d91513e2264 ">
                                    <p><code class="codeph">IMPLEMENT_ADVISOR_TASK</code></p>
                                 </td>
                                 <td align="left" valign="top" width="66%" headers="d91513e2280 d91513e2267 ">
                                    <p>Implements the actions recommended by the advisor based on results from a specified Optimizer Statistics Advisor execution.</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="section"></div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-36A7C2FE-C573-44D8-8CB0-CC6E11F814A7__GUID-ECE7DB02-0C9F-4837-8022-F848CD8DD4DD">
                        <p class="notep1">See Also:</p>
                        <p><a href="../arpls/DBMS_SPM.html#ARPLS150" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_STATS</code> package
                        </p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-11B3764D-CCA1-415F-88DD-0F6884DF8D89" title="Optimizer Statistics Advisor is built-in diagnostic software that analyzes the quality of statistics and statistics-related tasks.">About Optimizer Statistics Advisor</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
            <div class="sect2"><a id="GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75" name="GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75"></a><h3 id="TGSQL-GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75" class="sect3"><span class="enumeration_section">18.2 </span>Basic Tasks for Optimizer Statistics Advisor
               </h3>
               <div>
                  <p>This section explains the basic workflow for using Optimizer Statistics Advisor. All procedures and functions are in the <code class="codeph">DBMS_STATS</code> package.
                  </p>
                  <p>The following figure shows the automatic and manual paths in the workflow. If <code class="codeph">AUTO_STATS_ADVISOR_TASK</code> runs automatically in the maintenance window, then your workflow begins by querying the report. In the manual workflow, you must use PL/SQL to create and execute the tasks.
                  </p>
                  <div class="figure" id="GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75__GUID-929C9F11-33BE-4BAB-B90A-52C91DA3B729">
                     <p class="titleinfigure">Figure 18-3 Basic Tasks for Optimizer Statistics Advisor</p><img src="img/tgsql_vm_092.png" alt="Description of Figure 18-3 follows" title="Description of Figure 18-3 follows" longdesc="img_text/tgsql_vm_092.html"><br><a href="img_text/tgsql_vm_092.html">Description of "Figure 18-3 Basic Tasks for Optimizer Statistics Advisor"</a></div>
                  <!-- class="figure" -->
                  <p>Typically, you perform Optimizer Statistics Advisor steps in the sequence shown in the following table.</p>
                  <div class="tblformal" id="GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75__GUID-E20F0255-F1D4-4AB5-A1EF-82847F6BDDDF">
                     <p class="titleintable">Table 18-6 Optimizer Statistics Advisor Workflow</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="Optimizer Statistics Advisor Workflow" summary="This table describes the workflow for Optimizer Statistics Advisor" frame="hsides" border="1" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="20%" id="d91513e2441">Step</th>
                              <th align="left" valign="bottom" width="20%" id="d91513e2443">Description</th>
                              <th align="left" valign="bottom" width="20%" id="d91513e2445">To Learn More</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d91513e2449" headers="d91513e2441 ">1</td>
                              <td align="left" valign="top" width="20%" headers="d91513e2449 d91513e2443 ">
                                 <p>Create an Optimizer Advisor task using <code class="codeph">DBMS_STATS.CREATE_ADVISOR_TASK</code> (manual workflow only).
                                 </p>
                              </td>
                              <td align="left" valign="top" width="20%" headers="d91513e2449 d91513e2445 ">
                                 <p><span class="q">"<a href="optimizer-statistics-advisor.html#GUID-BEA60A82-C473-493C-A033-05145DBF10CA" title="The DBMS_STATS.CREATE_ADVISOR_TASK function creates a task for Optimizer Statistics Advisor. If you do not specify a task name, then Optimizer Statistics Advisor generates one automatically.">Creating an Optimizer Statistics Advisor Task</a>"</span></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d91513e2469" headers="d91513e2441 ">2</td>
                              <td align="left" valign="top" width="20%" headers="d91513e2469 d91513e2443 ">
                                 <p>Optionally, list executions of advisor tasks by querying <code class="codeph">DBA_ADVISOR_EXECUTIONS</code>.
                                 </p>
                              </td>
                              <td align="left" valign="top" width="20%" headers="d91513e2469 d91513e2445 ">
                                 <p><span class="q">"<a href="optimizer-statistics-advisor.html#GUID-B6BC40C4-66CB-4E33-A2EB-5F40C2A48509" title="The DBA_ADVISOR_EXECUTIONS view lists executions of Optimizer Statistics Advisor tasks.">Listing Optimizer Statistics Advisor Tasks</a>"</span></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d91513e2489" headers="d91513e2441 ">3</td>
                              <td align="left" valign="top" width="20%" headers="d91513e2489 d91513e2443 ">
                                 <p>Optionally, configure a filter for the task using the <code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_<span class="codeinlineitalic">*</span>_FILTER</code> procedures.
                                 </p>
                              </td>
                              <td align="left" valign="top" width="20%" headers="d91513e2489 d91513e2445 ">
                                 <p><span class="q">"<a href="optimizer-statistics-advisor.html#GUID-A709D991-5550-404C-AC05-57308047388D" title="Filters enable you to include or exclude objects, rules, and operations from Optimizer Statistics Advisor tasks.">Creating Filters for an Optimizer Advisor Task</a>"</span></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d91513e2509" headers="d91513e2441 ">4</td>
                              <td align="left" valign="top" width="20%" headers="d91513e2509 d91513e2443 ">
                                 <p>Execute the advisor task using <code class="codeph">DBMS_STATS.EXECUTE_ADVISOR_TASK</code> (manual workflow only).
                                 </p>
                              </td>
                              <td align="left" valign="top" width="20%" headers="d91513e2509 d91513e2445 ">
                                 <p><span class="q">"<a href="optimizer-statistics-advisor.html#GUID-2E00F47C-B108-4345-9225-0F0CC9902249" title="The DBMS_STATS.EXECUTE_ADVISOR_TASK function executes a task for Optimizer Statistics Advisor. If you do not specify an execution name, then Optimizer Statistics Advisor generates one automatically.">Executing an Optimizer Statistics Advisor Task</a>"</span></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d91513e2529" headers="d91513e2441 ">5</td>
                              <td align="left" valign="top" width="20%" headers="d91513e2529 d91513e2443 ">
                                 <p>Generate an advisor report.</p>
                              </td>
                              <td align="left" valign="top" width="20%" headers="d91513e2529 d91513e2445 ">
                                 <p><span class="q">"<a href="optimizer-statistics-advisor.html#GUID-A391E0BA-4159-4311-B05F-9E4F409CF3ED" title="The DBMS_STATS.REPORT_ADVISOR_TASK function generates a report for an Optimizer Statistics Advisor task.">Generating a Report for an Optimizer Statistics Advisor Task</a>"</span></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="20%" id="d91513e2546" headers="d91513e2441 ">6</td>
                              <td align="left" valign="top" width="20%" headers="d91513e2546 d91513e2443 ">
                                 <p>Implement the recommendations in either of following ways:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>Implement all recommendations automatically using <code class="codeph">DBMS_STATS.IMPLEMENT_ADVISOR_TASK</code>.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Generate a PL/SQL script that implements recommendations using <code class="codeph">DBMS_STATS.SCRIPT_ADVISOR_TASK</code>, edit this script, and then run it manually.
                                       </p>
                                    </li>
                                 </ul>
                              </td>
                              <td align="left" valign="top" width="20%" headers="d91513e2546 d91513e2445 ">
                                 <p><span class="q">"<a href="optimizer-statistics-advisor.html#GUID-9C219CD5-A781-4AC0-AEC8-974EE8F5DEA9" title="The DBMS_STATS.IMPLEMENT_ADVISOR_TASK function implements the recommendations for a specified Optimizer Statistics Advisor task. If you do not specify an execution name, then Optimizer Statistics Advisor uses the most recent execution.">Implementing Actions Recommended by Optimizer Statistics Advisor</a>"</span> and <span class="q">"<a href="optimizer-statistics-advisor.html#GUID-4FD4A77F-6967-4D30-BB64-01E8AF4F9A65" title="The DBMS_STATS.SCRIPT_ADVISOR_TASK function generates an editable script with recommendations for a specified Optimizer Statistics Advisor task.">Generating a Script Using Optimizer Statistics Advisor</a>"</span></p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <div class="example" id="GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75__GUID-BCF21734-8BA1-4936-93F7-51FBF2A55215">
                     <p class="titleinexample">Example 18-2 Basic Script for Optimizer Statistics Advisor in Manual Workflow</p>
                     <p>This script illustrates a basic Optimizer Statistics Advisor session. It creates a task, executes it, generates a report, and then implements the recommendations.</p><pre class="pre codeblock"><code>DECLARE
  v_tname   VARCHAR2(128) := 'my_task';
  v_ename   VARCHAR2(128) := NULL;
  v_report  CLOB := null;
  v_script  CLOB := null;
  v_implementation_result CLOB;
BEGIN
  -- create a task
  v_tname := DBMS_STATS.CREATE_ADVISOR_TASK(v_tname);

  -- execute the task
  v_ename := DBMS_STATS.EXECUTE_ADVISOR_TASK(v_tname);

  -- view the task report
  v_report := DBMS_STATS.REPORT_ADVISOR_TASK(v_tname);
  DBMS_OUTPUT.PUT_LINE(v_report);

  -- implement all recommendations
  v_implementation_result := DBMS_STATS.IMPLEMENT_ADVISOR_TASK(v_tname);
END;</code></pre><p>This section contains the following topics:</p>
                  </div>
                  <!-- class="example" -->
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-BEA60A82-C473-493C-A033-05145DBF10CA">Creating an Optimizer Statistics Advisor Task</a><br>The <code class="codeph">DBMS_STATS.CREATE_ADVISOR_TASK</code> function creates a task for Optimizer Statistics Advisor. If you do not specify a task name, then Optimizer Statistics Advisor generates one automatically.
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-B6BC40C4-66CB-4E33-A2EB-5F40C2A48509">Listing Optimizer Statistics Advisor Tasks</a><br>The <code class="codeph">DBA_ADVISOR_EXECUTIONS</code> view lists executions of Optimizer Statistics Advisor tasks.
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-A709D991-5550-404C-AC05-57308047388D">Creating Filters for an Optimizer Advisor Task</a><br>Filters enable you to include or exclude objects, rules, and operations from Optimizer Statistics Advisor tasks.
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-2E00F47C-B108-4345-9225-0F0CC9902249">Executing an Optimizer Statistics Advisor Task</a><br>The <code class="codeph">DBMS_STATS.EXECUTE_ADVISOR_TASK</code> function executes a task for Optimizer Statistics Advisor. If you do not specify an execution name, then Optimizer Statistics Advisor generates one automatically.
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-A391E0BA-4159-4311-B05F-9E4F409CF3ED">Generating a Report for an Optimizer Statistics Advisor Task</a><br>The <code class="codeph">DBMS_STATS.REPORT_ADVISOR_TASK</code> function generates a report for an Optimizer Statistics Advisor task.
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-10D99B9A-9FDB-4265-A2D1-043D7165D216">Implementing Optimizer Statistics Advisor Recommendations</a><br>You can either implement all recommendations automatically using <code class="codeph">DBMS_STATS.IMPLEMENT_ADVISOR_TASK</code>, or generate an editable script using <code class="codeph">DBMS_STATS.SCRIPT_ADVISOR_TASK</code>.
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75__GUID-5FF22C31-8359-4DA4-B2D0-5BE5BD63C8FE">
                     <p class="notep1">See Also:</p>
                     <p><a href="../arpls/DBMS_SPM.html#ARPLS150" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_STATS</code> package
                     </p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-054F4B76-DD57-46EE-98EA-0FF04F49D1B3" title="Optimizer Statistics Advisor analyzes how optimizer statistics are gathered, and then makes recommendations.">Analyzing Statistics Using Optimizer Statistics Advisor</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-BEA60A82-C473-493C-A033-05145DBF10CA" name="GUID-BEA60A82-C473-493C-A033-05145DBF10CA"></a><h4 id="TGSQL-GUID-BEA60A82-C473-493C-A033-05145DBF10CA" class="sect4"><span class="enumeration_section">18.2.1 </span>Creating an Optimizer Statistics Advisor Task
                  </h4>
                  <div>
                     <p>The <code class="codeph">DBMS_STATS.CREATE_ADVISOR_TASK</code> function creates a task for Optimizer Statistics Advisor. If you do not specify a task name, then Optimizer Statistics Advisor generates one automatically.
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-BEA60A82-C473-493C-A033-05145DBF10CA__GUID-9ED127C6-BBE2-419A-8F6D-AC780322C07E">Prerequisites</p>
                        <p>To execute this subprogram, you must have the <code class="codeph">ADVISOR</code> privilege.
                        </p>
                        <div class="infoboxnote" id="GUID-BEA60A82-C473-493C-A033-05145DBF10CA__GUID-7188C95F-00F0-4B43-AC4B-456BA7023728">
                           <p class="notep1">Note:</p>
                           <p>This subprogram executes using invoker's rights.</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-BEA60A82-C473-493C-A033-05145DBF10CA__GUID-EC694F36-69D2-4619-AA21-F1D596EA9F2F">To create an Optimizer Statistics Advisor task:</p>
                        <ol>
                           <li>
                              <p>In SQL*Plus, log in to the database as a user with the necessary privileges.</p>
                           </li>
                           <li>
                              <p>Execute the <code class="codeph">DBMS_STATS.CREATE_ADVISOR_TASK</code> function in the following form, where <code class="codeph"><span class="codeinlineitalic">tname</span></code> is the name of the task and <span class="italic"><code class="codeph">ret</code></span> is the variable that contains the returned output:
                              </p><pre class="pre codeblock"><code>EXECUTE <span class="italic">ret</span> := DBMS_STATS.CREATE_ADVISOR_TASK('<span class="italic">tname</span>');</code></pre><p>For example, to create the task <code class="codeph">opt_adv_task1</code>, use the following code:
                              </p><pre class="pre codeblock"><code>DECLARE
  v_tname VARCHAR2(32767);
  v_ret   VARCHAR2(32767);
BEGIN
  v_tname := 'opt_adv_task1';
  v_ret := DBMS_STATS.CREATE_ADVISOR_TASK(v_tname);
END;
/
</code></pre></li>
                           <li>
                              <p>Optionally, query <code class="codeph">USER_ADVISOR_TASKS</code>:
                              </p><pre class="pre codeblock"><code>SELECT TASK_NAME, ADVISOR_NAME, CREATED, STATUS FROM USER_ADVISOR_TASKS;</code></pre><p>Sample output appears below:</p><pre class="pre codeblock"><code>TASK_NAME       ADVISOR_NAME         CREATED   STATUS
--------------- -------------------- --------- -----------
OPT_ADV_TASK1   Statistics Advisor   05-SEP-16 INITIAL
</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-BEA60A82-C473-493C-A033-05145DBF10CA__ORACLEDATABASEPLSQLPACKAGESANDTYPES-41F8FA6B">
                        <p class="notep1">See Also:</p>
                        <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-B930CE9B-7461-4691-8AA9-7E424C3C2C8C" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about <code class="codeph">CREATE_ADVISOR_TASK</code></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75" title="This section explains the basic workflow for using Optimizer Statistics Advisor. All procedures and functions are in the DBMS_STATS package.">Basic Tasks for Optimizer Statistics Advisor</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-B6BC40C4-66CB-4E33-A2EB-5F40C2A48509" name="GUID-B6BC40C4-66CB-4E33-A2EB-5F40C2A48509"></a><h4 id="TGSQL-GUID-B6BC40C4-66CB-4E33-A2EB-5F40C2A48509" class="sect4"><span class="enumeration_section">18.2.2 </span>Listing Optimizer Statistics Advisor Tasks
                  </h4>
                  <div>
                     <p>The <code class="codeph">DBA_ADVISOR_EXECUTIONS</code> view lists executions of Optimizer Statistics Advisor tasks.
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-B6BC40C4-66CB-4E33-A2EB-5F40C2A48509__GUID-196DDBDB-A467-4B68-8E9C-DD0A1B49CE27">To list Optimizer Statistics Advisor tasks:</p>
                        <ol>
                           <li>
                              <p>In SQL*Plus, log in to the database as a user with administrator privileges.</p>
                           </li>
                           <li>
                              <p>Query <code class="codeph">DBA_ADVISOR_EXECUTIONS</code> as follows:
                              </p><pre class="pre codeblock"><code>COL EXECUTION_NAME FORMAT a14

SELECT EXECUTION_NAME, EXECUTION_END, STATUS
FROM   DBA_ADVISOR_EXECUTIONS
WHERE  TASK_NAME = 'AUTO_STATS_ADVISOR_TASK'
ORDER BY 2;</code></pre><p>The following sample output shows 8 executions:</p><pre class="pre codeblock"><code>EXECUTION_NAME EXECUTION STATUS
-------------- --------- -----------
EXEC_1         27-AUG-16 COMPLETED
EXEC_17        28-AUG-16 COMPLETED
EXEC_42        29-AUG-16 COMPLETED
EXEC_67        30-AUG-16 COMPLETED
EXEC_92        01-SEP-16 COMPLETED
EXEC_117       02-SEP-16 COMPLETED
EXEC_142       03-SEP-16 COMPLETED
EXEC_167       04-SEP-16 COMPLETED

8 rows selected.
</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-B6BC40C4-66CB-4E33-A2EB-5F40C2A48509__ORACLEDATABASEREFERENCETOLEARNMOREA-4209B6D8">
                        <p class="notep1">See Also:</p>
                        <p><a href="../refrn/DBA_ADVISOR_EXECUTIONS.html#GUID-7DFD27C0-C995-4C6F-A56E-706C90DE74D7" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn more about <code class="codeph">DBA_ADVISOR_EXECUTIONS</code></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75" title="This section explains the basic workflow for using Optimizer Statistics Advisor. All procedures and functions are in the DBMS_STATS package.">Basic Tasks for Optimizer Statistics Advisor</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-A709D991-5550-404C-AC05-57308047388D" name="GUID-A709D991-5550-404C-AC05-57308047388D"></a><h4 id="TGSQL-GUID-A709D991-5550-404C-AC05-57308047388D" class="sect4"><span class="enumeration_section">18.2.3 </span>Creating Filters for an Optimizer Advisor Task
                  </h4>
                  <div>
                     <p>Filters enable you to include or exclude objects, rules, and operations from Optimizer Statistics Advisor tasks.</p>
                     <p>This section contains the following topics:</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-21F2295B-5DDE-42B6-9F5A-996C19EDF45B">About Filters for Optimizer Statistics Advisor</a><br>A filter is the use of <code class="codeph">DBMS_STATS</code> to restrict an Optimizer Statistics Advisor task to a user-specified set of rules, schemas, or operations.
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-9A1E79AC-2AF3-4BCD-A623-E86A3E1F0FFF">Creating an Object Filter for an Optimizer Advisor Task</a><br>The <code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_OBJ_FILTER</code> function creates a rule filter for a specified Optimizer Statistics Advisor task. The function returns a CLOB that contains the updated values of the filter.
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-17D46BD3-3ED4-4233-A56E-626A8E7C5E9E">Creating a Rule Filter for an Optimizer Advisor Task</a><br>The <code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_RULE_FILTER</code> function creates a rule filter for a specified Optimizer Statistics Advisor task. The function returns a CLOB that contains the updated values of the filter.
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-429AE714-6FBF-4D93-A77E-A89C84F08923">Creating an Operation Filter for an Optimizer Advisor Task</a><br>The <code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_OPR_FILTER</code> function creates an operation filter for a specified Optimizer Statistics Advisor task. The function returns a CLOB that contains the updated values of the filter.
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75" title="This section explains the basic workflow for using Optimizer Statistics Advisor. All procedures and functions are in the DBMS_STATS package.">Basic Tasks for Optimizer Statistics Advisor</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="sect4"><a id="GUID-21F2295B-5DDE-42B6-9F5A-996C19EDF45B" name="GUID-21F2295B-5DDE-42B6-9F5A-996C19EDF45B"></a><h5 id="TGSQL-GUID-21F2295B-5DDE-42B6-9F5A-996C19EDF45B" class="sect5"><span class="enumeration_section">18.2.3.1 </span>About Filters for Optimizer Statistics Advisor
                     </h5>
                     <div>
                        <p>A filter is the use of <code class="codeph">DBMS_STATS</code> to restrict an Optimizer Statistics Advisor task to a user-specified set of rules, schemas, or operations.
                        </p>
                        <p>Filters are useful for including or excluding a specific set of results. For example, you can configure an advisor task to include only recommendations for the <code class="codeph">sh</code> schema. Also, you can exclude all violations of the rule for stale statistics. The primary advantage of filters is the ability to ignore recommendations that you are not interested in, and reduce the overhead of the advisor task.
                        </p>
                        <p>The simplest way to create filters is to use the following <code class="codeph">DBMS_STATS</code> procedures either individually or in combination:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">CONFIGURE_ADVISOR_OBJ_FILTER</code></p>
                              <p>Use this procedure to include or exclude the specified database schemas or objects. The object filter takes in an owner name and an object name, with wildcards (<code class="codeph">%</code>) supported.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">CONFIGURE_ADVISOR_RULE_FILTER</code></p>
                              <p>Use this procedure to include or exclude the specified rules. Obtain the names of rules by querying <code class="codeph">V$STATS_ADVISOR_RULES</code>.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">CONFIGURE_ADVISOR_OPR_FILTER</code></p>
                              <p>Use this procedure to include or exclude the specified <code class="codeph">DBMS_STATS</code> operations. Obtain the IDs and names for operations by querying <code class="codeph">DBA_OPTSTAT_OPERATIONS</code>.
                              </p>
                           </li>
                        </ul>
                        <p>For the preceding functions, you can specify the type of operation to which the filter applies: <code class="codeph">EXECUTE</code>, <code class="codeph">REPORT</code>, <code class="codeph">SCRIPT</code>, and <code class="codeph">IMPLEMENT</code>. You can also combine types, as in <code class="codeph">EXECUTE + REPORT</code>. Null indicates that the filter applies to all types of advisor operations.
                        </p>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-21F2295B-5DDE-42B6-9F5A-996C19EDF45B__GUID-FDBB458D-4B2C-467F-89B8-39D7BC64BA87">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="../refrn/V-STATS_ADVISOR_RULES.html#REFRN-GUID-C19D0FE4-3D40-45E3-B695-F5862CBF42C4" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn more about <code class="codeph">V$STATS_ADVISOR_RULES</code></p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-01FAB8ED-E4A3-4C3E-8FE2-88717DCDDA06" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about <code class="codeph">DBMS_STATS</code></p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-A709D991-5550-404C-AC05-57308047388D" title="Filters enable you to include or exclude objects, rules, and operations from Optimizer Statistics Advisor tasks.">Creating Filters for an Optimizer Advisor Task</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-9A1E79AC-2AF3-4BCD-A623-E86A3E1F0FFF" name="GUID-9A1E79AC-2AF3-4BCD-A623-E86A3E1F0FFF"></a><h5 id="TGSQL-GUID-9A1E79AC-2AF3-4BCD-A623-E86A3E1F0FFF" class="sect5"><span class="enumeration_section">18.2.3.2 </span>Creating an Object Filter for an Optimizer Advisor Task
                     </h5>
                     <div>
                        <p>The <code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_OBJ_FILTER</code> function creates a rule filter for a specified Optimizer Statistics Advisor task. The function returns a CLOB that contains the updated values of the filter.
                        </p>
                        <div class="section">
                           <p>You can use either of the following basic strategies:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Include findings for all objects (by default, all objects are considered), and then exclude findings for specified objects.</p>
                              </li>
                              <li>
                                 <p>Exclude findings for all objects, and then include findings only for specified objects.</p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-9A1E79AC-2AF3-4BCD-A623-E86A3E1F0FFF__GUID-6FB2D0EE-03BB-4B05-8009-35401B438DA2">Prerequisites</p>
                           <p>To use the <code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_OBJ_FILTER</code> function, you must meet the following prerequisites:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>To execute this subprogram, you must have the <code class="codeph">ADVISOR</code> privilege.
                                 </p>
                              </li>
                              <li>
                                 <p>You must be the owner of the task.</p>
                              </li>
                           </ul>
                           <div class="infoboxnote" id="GUID-9A1E79AC-2AF3-4BCD-A623-E86A3E1F0FFF__GUID-4BAA7789-E60D-4F80-9CE8-8CEB3E202095">
                              <p class="notep1">Note:</p>
                              <p>This subprogram executes using invoker's rights.</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-9A1E79AC-2AF3-4BCD-A623-E86A3E1F0FFF__GUID-4CEDEF04-43AA-424D-A73C-9150F3E1DE7A">To create an object filter:</p>
                           <ol>
                              <li>
                                 <p>In SQL*Plus or SQL Developer, log in to the database as a user with the necessary privileges.</p>
                              </li>
                              <li>
                                 <p>Either exclude or include objects for a specified task using the <code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_OBJ_FILTER</code> function.
                                 </p>
                                 <p>Invoke the function in the following form, where the placeholders are defined as follows:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p><span class="italic"><code class="codeph">report</code></span> is the CLOB variable that contains the returned XML.
                                       </p>
                                    </li>
                                    <li>
                                       <p><code class="codeph"><span class="codeinlineitalic">tname</span></code> is the name of the task.
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">opr_type</code></span> is the type of operation to perform.
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">rule</code></span> is the name of the rule.
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">owner</code></span> is the schema for the objects.
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">table</code></span> is the name of the table.
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">action</code></span> is the name of the action: <code class="codeph">ENABLE</code>, <code class="codeph">DISABLE</code>, <code class="codeph">DELETE</code>, or <code class="codeph">SHOW</code>.
                                       </p>
                                    </li>
                                 </ul><pre class="pre codeblock"><code>BEGIN
  <span class="italic">report</span> := DBMS_STATS.CONFIGURE_ADVISOR_OBJ_FILTER(
    task_name          =&gt; '<span class="italic">tname</span>'
  , stats_adv_opr_type =&gt; '<span class="italic">opr_type</span>'
  , rule_name          =&gt; '<span class="italic">rule</span>'
  , ownname            =&gt; '<span class="italic">owner</span>'
  , tabname            =&gt; '<span class="italic">table</span>'
  , action             =&gt; '<span class="italic">action</span>' );
END;</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-9A1E79AC-2AF3-4BCD-A623-E86A3E1F0FFF__GUID-20C50C09-6049-4DCE-9E4E-3309C792A7C2">
                           <p class="titleinexample">Example 18-3 Including Only Objects in a Single Schema</p>
                           <p>In this example, for the task named <code class="codeph">opt_adv_task1</code>, your goal is to disable recommendations for all objects except those in the <code class="codeph">sh</code> schema. User account <code class="codeph">sh</code> has been granted <code class="codeph">ADVISOR</code> and <code class="codeph">READ ANY TABLE</code> privileges. You perform the following steps:
                           </p>
                           <ol>
                              <li>
                                 <p>Log in to the database as <code class="codeph">sh</code>.
                                 </p>
                              </li>
                              <li>
                                 <p>Drop any existing task named <code class="codeph">opt_adv_task1</code>.
                                 </p><pre class="pre codeblock"><code>DECLARE
  v_tname VARCHAR2(32767);
BEGIN
  v_tname := 'opt_adv_task1';
  DBMS_STATS.DROP_ADVISOR_TASK(v_tname);
END;
/
</code></pre></li>
                              <li>
                                 <p>Create a procedure named <code class="codeph">sh_obj_filter</code> that restricts a specified task to objects in the <code class="codeph">sh</code> schema.
                                 </p><pre class="pre codeblock"><code>CREATE OR REPLACE PROCEDURE sh_obj_filter(p_tname IN VARCHAR2) IS
   v_retc CLOB;
BEGIN
   -- Filter out all objects that are not in the sh schema
   v_retc := DBMS_STATS.CONFIGURE_ADVISOR_OBJ_FILTER(
               task_name          =&gt; p_tname
             , stats_adv_opr_type =&gt; 'EXECUTE'
             , rule_name          =&gt; NULL
             , ownname            =&gt; NULL
             , tabname            =&gt; NULL
             , action             =&gt; 'DISABLE' );

   v_retc := DBMS_STATS.CONFIGURE_ADVISOR_OBJ_FILTER(
               task_name          =&gt; p_tname
             , stats_adv_opr_type =&gt; 'EXECUTE'
             , rule_name          =&gt; NULL
             , ownname            =&gt; 'SH'
             , tabname            =&gt; NULL
             , action             =&gt; 'ENABLE' );
END;
/
SHOW ERRORS</code></pre></li>
                              <li>
                                 <p>Create a task named <code class="codeph">opt_adv_task1</code>, and then execute the <code class="codeph">sh_obj_filter</code> procedure for this task.
                                 </p><pre class="pre codeblock"><code>DECLARE
  v_tname VARCHAR2(32767);
  v_ret VARCHAR2(32767);
BEGIN
  v_tname := 'opt_adv_task1';
  v_ret   := DBMS_STATS.CREATE_ADVISOR_TASK(v_tname);
  sh_obj_filter(v_tname);
END;
/</code></pre></li>
                              <li>
                                 <p>Execute the task <code class="codeph">opt_adv_task1</code>.
                                 </p><pre class="pre codeblock"><code>DECLARE
  v_tname VARCHAR2(32767);
  v_ret   VARCHAR2(32767);
begin
  v_tname := 'opt_adv_task1';
  v_ret   := DBMS_STATS.EXECUTE_ADVISOR_TASK(v_tname);
END;
/</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-9A1E79AC-2AF3-4BCD-A623-E86A3E1F0FFF__GUID-FDBB458D-4B2C-467F-89B8-39D7BC64BA87">
                           <p class="notep1">See Also:</p>
                           <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-01FAB8ED-E4A3-4C3E-8FE2-88717DCDDA06" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about <code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_OBJ_FILTER</code></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-A709D991-5550-404C-AC05-57308047388D" title="Filters enable you to include or exclude objects, rules, and operations from Optimizer Statistics Advisor tasks.">Creating Filters for an Optimizer Advisor Task</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-17D46BD3-3ED4-4233-A56E-626A8E7C5E9E" name="GUID-17D46BD3-3ED4-4233-A56E-626A8E7C5E9E"></a><h5 id="TGSQL-GUID-17D46BD3-3ED4-4233-A56E-626A8E7C5E9E" class="sect5"><span class="enumeration_section">18.2.3.3 </span>Creating a Rule Filter for an Optimizer Advisor Task
                     </h5>
                     <div>
                        <p>The <code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_RULE_FILTER</code> function creates a rule filter for a specified Optimizer Statistics Advisor task. The function returns a CLOB that contains the updated values of the filter.
                        </p>
                        <div class="section">
                           <p>You can use either of the following basic strategies:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Enable all rules (by default, all rules are enabled), and then disable specified rules.</p>
                              </li>
                              <li>
                                 <p>Disable all rules, and then enable only specified rules.</p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-17D46BD3-3ED4-4233-A56E-626A8E7C5E9E__GUID-2792788F-AF64-4276-94B2-62F4887ECDAE">Prerequisites</p>
                           <p>To use the <code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_RULE_FILTER</code> function, you must meet the following prerequisites:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>To execute this subprogram, you must have the <code class="codeph">ADVISOR</code> privilege.
                                 </p>
                              </li>
                              <li>
                                 <p>You must be the owner of the task.</p>
                              </li>
                           </ul>
                           <div class="infoboxnote" id="GUID-17D46BD3-3ED4-4233-A56E-626A8E7C5E9E__GUID-CB7F2B99-FC03-4932-ABD9-DAB171495B97">
                              <p class="notep1">Note:</p>
                              <p>This subprogram executes using invoker's rights.</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-17D46BD3-3ED4-4233-A56E-626A8E7C5E9E__GUID-DB7DECAB-6935-48CD-A10F-6607C1AF6F5A">To create a rule filter:</p>
                           <ol>
                              <li>
                                 <p>In SQL*Plus or SQL Developer, log in to the database as a user with the necessary privileges.</p>
                              </li>
                              <li>
                                 <p>Obtain the names of the advisor rules by querying <code class="codeph">V$STATS_ADVISOR_RULES</code>.
                                 </p>
                                 <p>For example, query the view as follows (partial sample output included):</p><pre class="pre codeblock"><code>SET LINESIZE 200
SET PAGESIZE 100
COL ID FORMAT 99
COL NAME FORMAT a27
COL DESCRIPTION FORMAT a54

SELECT RULE_ID AS ID, NAME, RULE_TYPE, DESCRIPTION 
FROM   V$STATS_ADVISOR_RULES
ORDER BY RULE_ID;

ID NAME                        RULE_TYPE DESCRIPTION
-- --------------------------- --------- -------------------------------------------------------
 1 UseAutoJob                  SYSTEM    Use Auto Job for Statistics Collection
 2 CompleteAutoJob             SYSTEM    Auto Statistics Gather Job should complete successfully
 3 MaintainStatsHistory        SYSTEM    Maintain Statistics History
 4 UseConcurrent               SYSTEM    Use Concurrent preference for Statistics Collection
...</code></pre></li>
                              <li>
                                 <p>Either exclude or include rules for a specified task using the <code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_RULE_FILTER</code> function.
                                 </p>
                                 <p>Invoke the function in the following form, where the placeholders are defined as follows:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p><code class="codeph"><span class="codeinlineitalic">tname</span></code> is the name of the task.
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">report</code></span> is the CLOB variable that contains the returned XML.
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">opr_type</code></span> is the type of operation to perform.
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">rule</code></span> is the name of the rule.
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">action</code></span> is the name of the action: <code class="codeph">ENABLE</code>, <code class="codeph">DISABLE</code>, <code class="codeph">DELETE</code>, or <code class="codeph">SHOW</code>.
                                       </p>
                                    </li>
                                 </ul><pre class="pre codeblock"><code>BEGIN
  <span class="italic">report</span> := DBMS_STATS.DBMS_STATS.CONFIGURE_ADVISOR_RULE_FILTER(
    task_name          =&gt; '<span class="italic">tname</span>'
  , stats_adv_opr_type =&gt; '<span class="italic">opr_type</span>'
  , rule_name          =&gt; '<span class="italic">rule</span>'
  , action             =&gt; '<span class="italic">action</span>' );
END;</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-17D46BD3-3ED4-4233-A56E-626A8E7C5E9E__GUID-32078B98-C6BE-4931-8A6C-6B1FC3F4BF87">
                           <p class="titleinexample">Example 18-4 Excluding the Rule for Stale Statistics</p>
                           <p>In this example, you know that statistics are stale because the automated statistics job did not run. You want to generate a report for the task named <code class="codeph">opt_adv_task1</code>, but do not want to clutter it with recommendations about stale statistics.
                           </p>
                           <ol>
                              <li>
                                 <p>You query <code class="codeph">V$STATS_ADVISOR_RULES</code> for rules that deal with stale statistics (sample output included):
                                 </p><pre class="pre codeblock"><code>COL NAME FORMAT a15
SELECT RULE_ID AS ID, NAME, RULE_TYPE, DESCRIPTION 
FROM   V$STATS_ADVISOR_RULES
WHERE  DESCRIPTION LIKE '%tale%'
ORDER BY RULE_ID;

 ID NAME            RULE_TYPE DESCRIPTION
--- --------------- --------- -----------------------------------------
 12 AvoidStaleStats OBJECT    Avoid objects with stale or no statistics</code></pre></li>
                              <li>
                                 <p>You configure a filter using <code class="codeph">CONFIGURE_ADVISOR_RULE_FILTER</code>, specifying that task execution should exclude the rule <code class="codeph">AvoidStaleStats</code>, but honor all other rules:
                                 </p><pre class="pre codeblock"><code>VARIABLE b_ret CLOB
BEGIN
   :b_ret := DBMS_STATS.CONFIGURE_ADVISOR_RULE_FILTER(
     task_name          =&gt; 'opt_adv_task1'
,    stats_adv_opr_type =&gt; 'EXECUTE'
,    rule_name          =&gt; 'AvoidStaleStats'
,    action             =&gt; 'DISABLE' );
END;
/
</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-17D46BD3-3ED4-4233-A56E-626A8E7C5E9E__GUID-53C27C18-4F80-4FA9-A362-9CC5A3AA3AC9">
                           <p class="titleinexample">Example 18-5 Including Only the Rule for Avoiding Stale Statistics</p>
                           <p>This example is the inverse of the preceding example. You want to generate a report for the task named <code class="codeph">opt_adv_task1</code>, but want to see <span class="italic">only</span> recommendations about stale statistics.
                           </p>
                           <ol>
                              <li>
                                 <p>Query <code class="codeph">V$STATS_ADVISOR_RULES</code> for rules that deal with stale statistics (sample output included):
                                 </p><pre class="pre codeblock"><code>COL NAME FORMAT a15

SELECT RULE_ID AS ID, NAME, RULE_TYPE, DESCRIPTION 
FROM   V$STATS_ADVISOR_RULES
WHERE  DESCRIPTION LIKE '%tale%'
ORDER BY RULE_ID;

 ID NAME            RULE_TYPE DESCRIPTION
--- --------------- --------- -----------------------------------------
 12 AvoidStaleStats OBJECT    Avoid objects with stale or no statistics</code></pre></li>
                              <li>
                                 <p>Configure a filter using <code class="codeph">CONFIGURE_ADVISOR_RULE_FILTER</code>, specifying that task execution should <span class="italic">exclude</span> all rules:
                                 </p><pre class="pre codeblock"><code>VARIABLE b_ret CLOB
BEGIN
   :b_ret := DBMS_STATS.CONFIGURE_ADVISOR_RULE_FILTER(
     task_name          =&gt; 'opt_adv_task1'
,    stats_adv_opr_type =&gt; 'EXECUTE'
,    rule_name          =&gt; null
,    action             =&gt; 'DISABLE' );
END;
/
</code></pre></li>
                              <li>
                                 <p>Configure a filter that enables only the <code class="codeph">AvoidStaleStats</code> rule:
                                 </p><pre class="pre codeblock"><code>BEGIN
   :b_ret := DBMS_STATS.CONFIGURE_ADVISOR_RULE_FILTER(
     task_name          =&gt; 'opt_adv_task1'
,    stats_adv_opr_type =&gt; 'EXECUTE'
,    rule_name          =&gt; 'AvoidStaleStats'
,    action             =&gt; 'ENABLE' );
END;
/
</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-17D46BD3-3ED4-4233-A56E-626A8E7C5E9E__GUID-7EDC44AF-9062-4A15-AA22-5E47D12E878B">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=REFRN-GUID-C19D0FE4-3D40-45E3-B695-F5862CBF42C4" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn more about <code class="codeph">V$STATS_ADVISOR_RULES</code></p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-B930CE9B-7461-4691-8AA9-7E424C3C2C8C" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about <code class="codeph">CONFIGURE_ADVISOR_RULE_FILTER</code></p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-A709D991-5550-404C-AC05-57308047388D" title="Filters enable you to include or exclude objects, rules, and operations from Optimizer Statistics Advisor tasks.">Creating Filters for an Optimizer Advisor Task</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-429AE714-6FBF-4D93-A77E-A89C84F08923" name="GUID-429AE714-6FBF-4D93-A77E-A89C84F08923"></a><h5 id="TGSQL-GUID-429AE714-6FBF-4D93-A77E-A89C84F08923" class="sect5"><span class="enumeration_section">18.2.3.4 </span>Creating an Operation Filter for an Optimizer Advisor Task
                     </h5>
                     <div>
                        <p>The <code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_OPR_FILTER</code> function creates an operation filter for a specified Optimizer Statistics Advisor task. The function returns a CLOB that contains the updated values of the filter.
                        </p>
                        <div class="section">
                           <p>You can use either of the following basic strategies:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Disable all operations, and then enable only specified operations.</p>
                              </li>
                              <li>
                                 <p>Enable all operations (by default, all operations are enabled), and then disable specified operations.</p>
                              </li>
                           </ul>
                           <p> The <code class="codeph">DBA_OPTSTAT_OPERATIONS</code> view contains the IDs of statistics-related operations.
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-429AE714-6FBF-4D93-A77E-A89C84F08923__GUID-88848D61-4454-4A25-9E69-2B62C3B32357">Prerequisites</p>
                           <p>To use <code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_OPR_FILTER</code> function, you must meet the following prerequisites:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>To execute this subprogram, you must have the <code class="codeph">ADVISOR</code> privilege.
                                 </p>
                                 <div class="infoboxnote" id="GUID-429AE714-6FBF-4D93-A77E-A89C84F08923__GUID-5DF5B3A6-3097-4C4D-B9B1-B2107B6A6920">
                                    <p class="notep1">Note:</p>
                                    <p>This subprogram executes using invoker's rights.</p>
                                 </div>
                              </li>
                              <li>
                                 <p>You must be the owner of the task.</p>
                              </li>
                              <li>
                                 <p> To query the <code class="codeph">DBA_OPTSTAT_OPERATIONS</code> view, you must have the <code class="codeph">SELECT ANY TABLE</code> privilege.
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-429AE714-6FBF-4D93-A77E-A89C84F08923__GUID-9FA52FC9-B9A8-4F73-A16D-9068C9F1E4FB">To create an operation filter:</p>
                           <ol>
                              <li>
                                 <p>In SQL*Plus or SQL Developer, log in to the database as a user with the necessary privileges.</p>
                              </li>
                              <li>
                                 <p>Query the types of operations.</p>
                                 <p>For example, list all distinct operations in <code class="codeph">DBA_OPTSTAT_OPERATIONS</code> (sample output included):
                                 </p><pre class="pre codeblock"><code>SQL&gt; SELECT DISTINCT(OPERATION) FROM DBA_OPTSTAT_OPERATIONS ORDER BY OPERATION;

OPERATION
-----------------------
gather_dictionary_stats
gather_index_stats
gather_schema_stats
gather_table_stats
purge_stats
set_system_stats
</code></pre></li>
                              <li>
                                 <p>Obtain the IDs of the operations to be filtered by querying <code class="codeph">DBA_OPTSTAT_OPERATIONS</code>.
                                 </p>
                                 <p>For example, to obtain IDs for all statistics gathering operations for tables and indexes in the <code class="codeph">SYS</code> and <code class="codeph">sh</code> schemas, use the following query:
                                 </p><pre class="pre codeblock"><code>SELECT ID 
FROM   DBA_OPTSTAT_OPERATIONS
WHERE  (  OPERATION = 'gather_table_stats'
          OR OPERATION = 'gather_index_stats')
AND    (  TARGET LIKE 'SH.%'
          OR TARGET LIKE 'SYS.%');</code></pre></li>
                              <li>
                                 <p>Exclude or include rules for a specified task using the <code class="codeph">DBMS_STATS.CONFIGURE_ADVISOR_OPR_FILTER</code> function, specifying the IDs obtained in the previous step.
                                 </p>
                                 <p>Invoke the function in the following form, where the placeholders are defined as follows:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p><span class="italic"><code class="codeph">report</code></span> is the CLOB variable that contains the returned XML.
                                       </p>
                                    </li>
                                    <li>
                                       <p><code class="codeph"><span class="codeinlineitalic">tname</span></code> is the name of the task.
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">opr_type</code></span> is the type of operation to perform. This value cannot be null.
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">rule</code></span> is the name of the rule.
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">opr_id</code></span> is the ID (from <code class="codeph">DBA_OPTSTAT_OPERATIONS.ID</code>) of the operation to perform. This value cannot be null.
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">action</code></span> is the name of the action: <code class="codeph">ENABLE</code>, <code class="codeph">DISABLE</code>, <code class="codeph">DELETE</code>, or <code class="codeph">SHOW</code>.
                                       </p>
                                    </li>
                                 </ul><pre class="pre codeblock"><code>BEGIN
  <span class="italic">report</span> := DBMS_STATS.CONFIGURE_ADVISOR_OPR_FILTER(
    task_name          =&gt; '<span class="italic">tname</span>'
  , stats_adv_opr_type =&gt; '<span class="italic">opr_type</span>'
  , rule_name          =&gt; '<span class="italic">rule</span>'
  , operation_id       =&gt; '<span class="italic">op_id</span>'
  , action             =&gt; '<span class="italic">action</span>' );
END;</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-429AE714-6FBF-4D93-A77E-A89C84F08923__GUID-0964F1CB-4578-4EF3-B510-BE39CF29344B">
                           <p class="titleinexample">Example 18-6 Excluding Operations for Gathering Table Statistics</p>
                           <p>In this example, your goal is to exclude operations that gather table statistics in the <code class="codeph">hr</code> schema. User account <code class="codeph">stats</code> has been granted the <code class="codeph">DBA</code> role, <code class="codeph">ADVISOR</code> privilege, and <code class="codeph">SELECT ON DBA_OPTSTAT_OPERATIONS</code> privilege. You perform the following steps:
                           </p>
                           <ol>
                              <li>
                                 <p>Log in to the database as <code class="codeph">stats</code>.
                                 </p>
                              </li>
                              <li>
                                 <p>Drop any existing task named <code class="codeph">opt_adv_task1</code>.
                                 </p><pre class="pre codeblock"><code>DECLARE
  v_tname VARCHAR2(32767);
BEGIN
  v_tname := 'opt_adv_task1';
  DBMS_STATS.DROP_ADVISOR_TASK(v_tname);
END;
/
</code></pre></li>
                              <li>
                                 <p>Create a procedure named <code class="codeph">opr_filter</code> that configures a task to advise on all operations <span class="italic">except</span> those that gather statistics for tables in the <code class="codeph">hr</code> schema.
                                 </p><pre class="pre codeblock"><code>CREATE OR REPLACE PROCEDURE opr_filter(p_tname IN VARCHAR2) IS
   v_retc CLOB;
BEGIN
   -- For all rules, prevent the advisor from operating 
   -- on the operations selected in the following query
   FOR rec IN 
     (SELECT ID FROM DBA_OPTSTAT_OPERATIONS WHERE OPERATION = 'gather_table_stats' AND TARGET LIKE 'HR.%')
   LOOP
     v_retc := DBMS_STATS.CONFIGURE_ADVISOR_OPR_FILTER(
                 task_name          =&gt; p_tname
               , stats_adv_opr_type =&gt; NULL
               , rule_name          =&gt; NULL
               , operation_id       =&gt; rec.id
               , action             =&gt; 'DISABLE');
   END LOOP;
END;
/
SHOW ERRORS
</code></pre></li>
                              <li>
                                 <p>Create a task named <code class="codeph">opt_adv_task1</code>, and then execute the <code class="codeph">opr_filter</code> procedure for this task.
                                 </p><pre class="pre codeblock"><code>DECLARE
  v_tname VARCHAR2(32767);
  v_ret VARCHAR2(32767);
BEGIN
  v_tname := 'opt_adv_task1';
  v_ret   := DBMS_STATS.CREATE_ADVISOR_TASK(v_tname);
  opr_filter(v_tname);
END;
/</code></pre></li>
                              <li>
                                 <p>Execute the task <code class="codeph">opt_adv_task1</code>.
                                 </p><pre class="pre codeblock"><code>DECLARE
  v_tname VARCHAR2(32767);
  v_ret   VARCHAR2(32767);
begin
  v_tname := 'opt_adv_task1';
  v_ret   := DBMS_STATS.EXECUTE_ADVISOR_TASK(v_tname);
END;
/</code></pre></li>
                              <li>
                                 <p>Print the report.</p><pre class="pre codeblock"><code>SPOOL /tmp/rep.txt
SET LONG 1000000
COLUMN report FORMAT A200
SET LINESIZE 250
SET PAGESIZE 1000

SELECT DBMS_STATS.REPORT_ADVISOR_TASK(
         task_name      =&gt; 'opt_adv_task1'
       , execution_name =&gt; NULL
       , type           =&gt; 'TEXT'
       , section        =&gt; 'ALL' 
       ) AS report
FROM   DUAL;
SPOOL OFF</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="example" -->
                        <div class="section"></div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-429AE714-6FBF-4D93-A77E-A89C84F08923__GUID-E700E3DA-D9E4-4C97-BF78-F076A294270E">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="../refrn/DBA_OPTSTAT_OPERATIONS.html#REFRN-GUID-3D13B3C5-C1D1-47E7-B852-CD1563719402" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn more about <code class="codeph">DBA_OPTSTAT_OPERATIONS</code></p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_STATS.html#GUID-0BD07210-825E-4971-87B5-EE453B354EC7" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about <code class="codeph">CONFIGURE_ADVISOR_OPR_FILTER</code></p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-A709D991-5550-404C-AC05-57308047388D" title="Filters enable you to include or exclude objects, rules, and operations from Optimizer Statistics Advisor tasks.">Creating Filters for an Optimizer Advisor Task</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
               <div class="sect3"><a id="GUID-2E00F47C-B108-4345-9225-0F0CC9902249" name="GUID-2E00F47C-B108-4345-9225-0F0CC9902249"></a><h4 id="TGSQL-GUID-2E00F47C-B108-4345-9225-0F0CC9902249" class="sect4"><span class="enumeration_section">18.2.4 </span>Executing an Optimizer Statistics Advisor Task
                  </h4>
                  <div>
                     <p>The <code class="codeph">DBMS_STATS.EXECUTE_ADVISOR_TASK</code> function executes a task for Optimizer Statistics Advisor. If you do not specify an execution name, then Optimizer Statistics Advisor generates one automatically.
                     </p>
                     <div class="section">
                        <p>The results of performing this task depend on the privileges of the executing user:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">SYSTEM</code> level
                              </p>
                              <p>Only users with both the <code class="codeph">ANALYZE ANY</code> and <code class="codeph">ANALYZE ANY DICTIONARY</code> privileges can perform this task on system-level rules.
                              </p>
                           </li>
                           <li>
                              <p>Operation level</p>
                              <p>The results depend on the following privileges:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>Users with both the <code class="codeph">ANALYZE ANY</code> and <code class="codeph">ANALYZE ANY DICTIONARY</code> privileges can perform this task for all statistics operations.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Users with the <code class="codeph">ANALYZE ANY</code> privilege but <span class="italic">not</span> the <code class="codeph">ANALYZE ANY DICTIONARY</code> privilege can perform this task for statistics operations related to any schema except <code class="codeph">SYS</code>.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Users with the <code class="codeph">ANALYZE ANY DICTIONARY</code> privilege but <span class="italic">not</span> the <code class="codeph">ANALYZE ANY</code> privilege can perform this task for statistics operations related to their own schema and the <code class="codeph">SYS</code> schema.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Users with neither the <code class="codeph">ANALYZE ANY</code> nor the <code class="codeph">ANALYZE ANY DICTIONARY</code> privilege can only perform this operation for statistics operations relating to their own schema.
                                    </p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>Object level</p>
                              <p>Users can perform this task for any object for which they have statistics collection privileges.</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-2E00F47C-B108-4345-9225-0F0CC9902249__GUID-DD87FC79-BEA2-41FC-ACD2-2881F3EE6DFF">Prerequisites</p>
                        <p>This task has the following prerequisites:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>To execute this subprogram, you must have the <code class="codeph">ADVISOR</code> privilege.
                              </p>
                           </li>
                           <li>
                              <p>You must be the owner of the task.</p>
                           </li>
                           <li>
                              <p>If you specify an execution name, then this name must not conflict with an existing execution.</p>
                           </li>
                        </ul>
                        <div class="infoboxnote" id="GUID-2E00F47C-B108-4345-9225-0F0CC9902249__GUID-96084FA8-D531-45D8-A7DD-3DE624DF00EC">
                           <p class="notep1">Note:</p>
                           <p>This subprogram executes using invoker's rights.</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-2E00F47C-B108-4345-9225-0F0CC9902249__GUID-8779A8D6-76A9-4323-864A-47BF83C8EC08">To execute an Optimizer Statistics Advisor task:</p>
                        <ol>
                           <li>
                              <p>In SQL*Plus or SQL Developer, log in to the database as a user with the necessary privileges.</p>
                           </li>
                           <li>
                              <p>Execute the <code class="codeph">DBMS_STATS.EXECUTE_ADVISOR_TASK</code> function in the following form, where <code class="codeph"><span class="codeinlineitalic">tname</span></code> is the name of the task, <code class="codeph"><span class="codeinlineitalic">execname</span></code> is the optional name of the execution, and <span class="italic"><code class="codeph">ret</code></span> is the variable that contains the returned output:
                              </p><pre class="pre codeblock"><code>EXECUTE <span class="italic">ret</span> := DBMS_STATS.EXECUTE_ADVISOR_TASK('<span class="italic">tname</span>','<span class="italic">execname</span>');</code></pre><p>For example, to execute the task <code class="codeph">opt_adv_task1</code>, use the following code:
                              </p><pre class="pre codeblock"><code>DECLARE
  v_tname VARCHAR2(32767);
  v_ret   VARCHAR2(32767);
BEGIN
  v_tname := 'opt_adv_task1';
  v_ret := DBMS_STATS.EXECUTE_ADVISOR_TASK(v_tname);
END;
/
</code></pre></li>
                           <li>
                              <p>Optionally, obtain details about the execution by querying <code class="codeph">USER_ADVISOR_EXECUTIONS</code>:
                              </p><pre class="pre codeblock"><code>SELECT TASK_NAME, EXECUTION_NAME,
       EXECUTION_END, EXECUTION_TYPE AS TYPE, STATUS 
FROM   USER_ADVISOR_EXECUTIONS;</code></pre><p>Sample output appears below:</p><pre class="pre codeblock"><code>TASK_NAME       EXECUTION_NAME       EXECUTION TYPE       STATUS
--------------- -------------------- --------- ---------- -----------
OPT_ADV_TASK1   EXEC_136             23-NOV-15 STATISTICS COMPLETED
</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-2E00F47C-B108-4345-9225-0F0CC9902249__ORACLEDATABASEPLSQLPACKAGESANDTYPES-41FDABD7">
                        <p class="notep1">See Also:</p>
                        <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-B930CE9B-7461-4691-8AA9-7E424C3C2C8C" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about <code class="codeph">EXECUTE_ADVISOR_TASK</code></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75" title="This section explains the basic workflow for using Optimizer Statistics Advisor. All procedures and functions are in the DBMS_STATS package.">Basic Tasks for Optimizer Statistics Advisor</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-A391E0BA-4159-4311-B05F-9E4F409CF3ED" name="GUID-A391E0BA-4159-4311-B05F-9E4F409CF3ED"></a><h4 id="TGSQL-GUID-A391E0BA-4159-4311-B05F-9E4F409CF3ED" class="sect4"><span class="enumeration_section">18.2.5 </span>Generating a Report for an Optimizer Statistics Advisor Task
                  </h4>
                  <div>
                     <p>The <code class="codeph">DBMS_STATS.REPORT_ADVISOR_TASK</code> function generates a report for an Optimizer Statistics Advisor task.
                     </p>
                     <div class="section">The report contains the following sections:
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>General information</p>
                              <p>This section describes the task name, execution name, creation date, and modification date.</p>
                           </li>
                           <li>
                              <p>Summary</p>
                              <p>This section summarizes the findings and rules violated by the findings.</p>
                           </li>
                           <li>
                              <p>Findings</p>
                              <p>Each finding section lists the relevant rule and findings. If the advisor has a recommendation, then the recommendation is described. In some cases, a recommendation also has a rationale.</p>
                           </li>
                        </ul>
                        <p>The name of the automated Optimizer Statistics Advisor task is <code class="codeph">AUTO_STATS_ADVISOR_TASK</code>. If you follow the automated workflow, then you only need to query the automatically generated report.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-A391E0BA-4159-4311-B05F-9E4F409CF3ED__GUID-00F0670B-0379-43D5-8EDC-D1AEE3F4941B">Prerequisites</p>
                     </div>
                     <!-- class="section" -->
                     <div class="p">
                        <p>To generate a report with the <code class="codeph">DBMS_STATS.REPORT_ADVISOR_TASK</code> function, you must meet the following prerequisites:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>To execute this subprogram, you must have the <code class="codeph">ADVISOR</code> privilege.
                              </p>
                           </li>
                           <li>
                              <p>You must be the owner of the task.</p>
                           </li>
                        </ul>
                        <div class="infoboxnote" id="GUID-A391E0BA-4159-4311-B05F-9E4F409CF3ED__GUID-31C3008E-B2CE-40FA-9B34-98517298EDB7">
                           <p class="notep1">Note:</p>
                           <p>This subprogram executes using invoker's rights.</p>
                        </div>
                        <p>The results of performing this task depend on the privileges of the executing user:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">SYSTEM</code> level
                              </p>
                              <p>Only users with both the <code class="codeph">ANALYZE ANY</code> and <code class="codeph">ANALYZE ANY DICTIONARY</code> privileges can perform this task on system-level rules.
                              </p>
                           </li>
                           <li>
                              <p>Operation level</p>
                              <p>The results depend on the following privileges:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>Users with both the <code class="codeph">ANALYZE ANY</code> and <code class="codeph">ANALYZE ANY DICTIONARY</code> privileges can perform this task for all statistics operations.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Users with the <code class="codeph">ANALYZE ANY</code> privilege but <span class="italic">not</span> the <code class="codeph">ANALYZE ANY DICTIONARY</code> privilege can perform this task for statistics operations related to any schema except <code class="codeph">SYS</code>.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Users with the <code class="codeph">ANALYZE ANY DICTIONARY</code> privilege but <span class="italic">not</span> the <code class="codeph">ANALYZE ANY</code> privilege can perform this task for statistics operations related to their own schema and the <code class="codeph">SYS</code> schema.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Users with neither the <code class="codeph">ANALYZE ANY</code> nor the <code class="codeph">ANALYZE ANY DICTIONARY</code> privilege can only perform this operation for statistics operations relating to their own schema.
                                    </p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>Object level</p>
                              <p>Users can perform this task for any object for which they have statistics collection privileges.</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-A391E0BA-4159-4311-B05F-9E4F409CF3ED__GUID-29A5E694-5B2B-41F5-A9C0-227C3BFA7354">To generate an Optimizer Statistics Advisor report:</p>
                        <ol>
                           <li>
                              <p>In SQL*Plus, log in to the database as a user with <code class="codeph">ADVISOR</code> privileges.
                              </p>
                           </li>
                           <li>
                              <p>Query the <code class="codeph">DBMS_STATS.REPORT_ADVISOR_TASK</code> function output.
                              </p>
                              <p>Use the following query, where the placeholders have the following definitions:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><code class="codeph"><span class="codeinlineitalic">tname</span></code> is the name of the task.
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph"><span class="codeinlineitalic">exec</span></code> is the name of the execution.
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph"><span class="codeinlineitalic">type</span></code> is the type of output: <code class="codeph">TEXT</code>, <code class="codeph">HTML</code>, or <code class="codeph">XML</code>.
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph"><span class="codeinlineitalic">sect</span></code> is the section of the report: <code class="codeph">SUMMARY</code>, <code class="codeph">FINDINGS</code>, <code class="codeph">ERRORS</code>, and <code class="codeph">ALL</code>.
                                    </p>
                                 </li>
                                 <li>
                                    <p><span class="italic"><code class="codeph">lvl</code></span> is the format of the report: <code class="codeph">BASIC</code>, <code class="codeph">TYPICAL</code>, <code class="codeph">ALL</code>, or <code class="codeph">SHOW_HIDDEN</code>.
                                    </p>
                                 </li>
                              </ul><pre class="pre codeblock"><code>SET LINESIZE 3000
SET LONG 500000
SET PAGESIZE 0
SET LONGCHUNKSIZE 100000

SELECT DBMS_STATS.REPORT_ADVISOR_TASK('<span class="italic">tname</span>', '<span class="italic">exec</span>', '<code class="codeph"><span class="codeinlineitalic">type</span></code>', '<code class="codeph"><span class="codeinlineitalic">sect</span></code>', '<code class="codeph"><span class="codeinlineitalic">lvl</span></code>') AS REPORT
FROM   DUAL;</code></pre><p>For example, to print a report for <code class="codeph">AUTO_STATS_ADVISOR_TASK</code>, use the following query:
                              </p><pre class="pre codeblock"><code>SELECT DBMS_STATS.REPORT_ADVISOR_TASK('AUTO_STATS_ADVISOR_TASK',NULL,'TEXT','ALL','ALL') AS REPORT 
FROM   DUAL;</code></pre><p>The following sample report shows four findings:</p><pre class="pre codeblock"><code>GENERAL INFORMATION
-------------------------------------------------------------------------------
 Task Name	 : AUTO_STATS_ADVISOR_TASK
 Execution Name  : EXEC_136	
 Created	 : 09-05-16 02:52:34 
 Last Modified	 : 09-05-16 12:31:24 
-------------------------------------------------------------------------------
SUMMARY
-------------------------------------------------------------------------------
 For execution EXEC_136 of task AUTO_STATS_ADVISOR_TASK, the Statistics Advisor
 has 4 findings. The findings are related to the following rules: 
 AVOIDSETPROCEDURES, USEDEFAULTPARAMS, USEGATHERSCHEMASTATS, NOTUSEINCREMENTAL. 
Please refer to the finding section for detailed information.

-------------------------------------------------------------------------------
FINDINGS
-------------------------------------------------------------------------------
 Rule Name:	    AvoidSetProcedures
 Rule Description:  Avoid Set Statistics Procedures				
 Finding:  There are 5 SET_[COLUMN|INDEX|TABLE|SYSTEM]_STATS procedures being	
           used for statistics gathering.
 Recommendation:  Do not use SET_[COLUMN|INDEX|TABLE|SYSTEM]_STATS procedures.
                  Gather statistics instead of setting them.			
 Rationale:  SET_[COLUMN|INDEX|TABLE|SYSTEM]_STATS will cause bad plans due to
             wrong or inconsistent statistics.				   
----------------------------------------------------
 Rule Name:	    UseDefaultParams						
 Rule Description:  Use Default Parameters in Statistics Collection Procedures  
 Finding:  There are 367 statistics operations using nondefault parameters.	
 Recommendation:  Use default parameters for statistics operations.		
 Example:

 -- Gathering statistics for 'SH' schema using all default parameter values:	
 BEGIN dbms_stats.gather_schema_stats('SH'); END;				
 Rationale:  Using default parameter values for statistics gathering operations 
             is more efficient.	
----------------------------------------------------
 Rule Name:	    UseGatherSchemaStats					
 Rule Description:  Use gather_schema_stats procedure
 Finding:  There are 318 uses of GATHER_TABLE_STATS.
 Recommendation:  Use GATHER_SCHEMA_STATS instead of GATHER_TABLE_STATS.	
 Example:

 -- Gather statistics for 'SH' schema:						
 BEGIN dbms_stats.gather_schema_stats('SH'); END;				
 Rationale:  GATHER_SCHEMA_STATS has more options available, including checking 
             for staleness and gathering statistics concurrently. Also it is
             more maintainable for new tables added to the schema. If you only
             want to gather statistics for certain tables in the schema, specify
             them in the obj_filter_list parameter of GATHER_SCHEMA_STATS.						
----------------------------------------------------
 Rule Name:	    NotUseIncremental

 Rule Description:  Statistics should not be maintained incrementally when it is not							
 Finding:  Incremental option has been turned on for 10 tables, which will not benefit 
           from using the incremental option.
 Schema:
 SH
 Objects:
 CAL_MONTH_SALES_MV    
 CAL_MONTH_SALES_MV    
 CHANNELS
 COUNTRIES   
 CUSTOMERS    
 DIMENSION_EXCEPTIONS    
 FWEEK_PSCAT_SALES_MV    
 FWEEK_PSCAT_SALES_MV    
 PRODUCTS    
 PROMOTIONS    
 SUPPLEMENTARY_DEMOGRAPHICS 
 TIMES

 Recommendation:  Do not use the incremental option for statistics gathering on these objects.						
 Example:									
 --
 Turn off the incremental option for 'SH.SALES':     
 dbms_stats.set_table_prefs('SH', 'SALES', 'INCREMENTAL', 'FALSE');		
 Rationale:  The overhead of using the incremental option on these tables
             outweighs the benefit of using the incremental option.  
</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-A391E0BA-4159-4311-B05F-9E4F409CF3ED__ORACLEDATABASEPLSQLPACKAGESANDTYPES-41FF0C16">
                        <p class="notep1">See Also:</p>
                        <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-B930CE9B-7461-4691-8AA9-7E424C3C2C8C" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about <code class="codeph">REPORT_ADVISOR_TASK</code></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75" title="This section explains the basic workflow for using Optimizer Statistics Advisor. All procedures and functions are in the DBMS_STATS package.">Basic Tasks for Optimizer Statistics Advisor</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-10D99B9A-9FDB-4265-A2D1-043D7165D216" name="GUID-10D99B9A-9FDB-4265-A2D1-043D7165D216"></a><h4 id="TGSQL-GUID-10D99B9A-9FDB-4265-A2D1-043D7165D216" class="sect4"><span class="enumeration_section">18.2.6 </span>Implementing Optimizer Statistics Advisor Recommendations
                  </h4>
                  <div>
                     <p>You can either implement all recommendations automatically using <code class="codeph">DBMS_STATS.IMPLEMENT_ADVISOR_TASK</code>, or generate an editable script using <code class="codeph">DBMS_STATS.SCRIPT_ADVISOR_TASK</code>.
                     </p>
                     <p>This section contains the following topics:</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-9C219CD5-A781-4AC0-AEC8-974EE8F5DEA9">Implementing Actions Recommended by Optimizer Statistics Advisor</a><br>The <code class="codeph">DBMS_STATS.IMPLEMENT_ADVISOR_TASK</code> function implements the recommendations for a specified Optimizer Statistics Advisor task. If you do not specify an execution name, then Optimizer Statistics Advisor uses the most recent execution.
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-advisor.html#GUID-4FD4A77F-6967-4D30-BB64-01E8AF4F9A65">Generating a Script Using Optimizer Statistics Advisor</a><br>The <code class="codeph">DBMS_STATS.SCRIPT_ADVISOR_TASK</code> function generates an editable script with recommendations for a specified Optimizer Statistics Advisor task.
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-EA9D4850-A988-462D-BBDE-E6299F6F0D75" title="This section explains the basic workflow for using Optimizer Statistics Advisor. All procedures and functions are in the DBMS_STATS package.">Basic Tasks for Optimizer Statistics Advisor</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="sect4"><a id="GUID-9C219CD5-A781-4AC0-AEC8-974EE8F5DEA9" name="GUID-9C219CD5-A781-4AC0-AEC8-974EE8F5DEA9"></a><h5 id="TGSQL-GUID-9C219CD5-A781-4AC0-AEC8-974EE8F5DEA9" class="sect5"><span class="enumeration_section">18.2.6.1 </span>Implementing Actions Recommended by Optimizer Statistics Advisor
                     </h5>
                     <div>
                        <p>The <code class="codeph">DBMS_STATS.IMPLEMENT_ADVISOR_TASK</code> function implements the recommendations for a specified Optimizer Statistics Advisor task. If you do not specify an execution name, then Optimizer Statistics Advisor uses the most recent execution.
                        </p>
                        <div class="section">The simplest means of implementing recommendations is using <code class="codeph">DBMS_STATS.IMPLEMENT_ADVISOR_TASK</code>. In this case, no generation of a script is necessary. You can specify that the advisor ignore the existing filters <code class="codeph">(level=&gt;'ALL')</code> or use the default, which honors the existing filters <code class="codeph">(level=&gt;'TYPICAL')</code>.
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-9C219CD5-A781-4AC0-AEC8-974EE8F5DEA9__GUID-7F9BAFC7-F177-4F86-85D7-3C82182A3A6E">Prerequisites</p>
                           <p>To use <code class="codeph">DBMS_STATS.IMPLEMENT_ADVISOR_TASK</code>, you must meet the following prerequisites:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>To execute this subprogram, you must have the <code class="codeph">ADVISOR</code> privilege.
                                 </p>
                              </li>
                              <li>
                                 <p>You must be the owner of the task.</p>
                              </li>
                           </ul>
                           <div class="infoboxnote" id="GUID-9C219CD5-A781-4AC0-AEC8-974EE8F5DEA9__GUID-0C31112B-6466-4BAB-A73C-AD4D1253F696">
                              <p class="notep1">Note:</p>
                              <p>This subprogram executes using invoker's rights.</p>
                           </div>
                           <p>The results of performing this task depend on the privileges of the executing user:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">SYSTEM</code> level
                                 </p>
                                 <p>Only users with both the <code class="codeph">ANALYZE ANY</code> and <code class="codeph">ANALYZE ANY DICTIONARY</code> privileges can perform this task on system-level rules.
                                 </p>
                              </li>
                              <li>
                                 <p>Operation level</p>
                                 <p>The results depend on the following privileges:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>Users with both the <code class="codeph">ANALYZE ANY</code> and <code class="codeph">ANALYZE ANY DICTIONARY</code> privileges can perform this task for all statistics operations.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Users with the <code class="codeph">ANALYZE ANY</code> privilege but <span class="italic">not</span> the <code class="codeph">ANALYZE ANY DICTIONARY</code> privilege can perform this task for statistics operations related to any schema except <code class="codeph">SYS</code>.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Users with the <code class="codeph">ANALYZE ANY DICTIONARY</code> privilege but <span class="italic">not</span> the <code class="codeph">ANALYZE ANY</code> privilege can perform this task for statistics operations related to their own schema and the <code class="codeph">SYS</code> schema.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Users with neither the <code class="codeph">ANALYZE ANY</code> nor the <code class="codeph">ANALYZE ANY DICTIONARY</code> privilege can only perform this operation for statistics operations relating to their own schema.
                                       </p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>Object level</p>
                                 <p>Users can perform this task for any object for which they have statistics collection privileges.</p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-9C219CD5-A781-4AC0-AEC8-974EE8F5DEA9__GUID-1A3517EB-7145-4679-885F-565EFFC91DB4">To implement advisor actions:</p>
                           <ol>
                              <li>
                                 <p>In SQL*Plus, log in to the database as a user with the necessary privileges.</p>
                              </li>
                              <li>
                                 <p>Execute the <code class="codeph">DBMS_STATS.IMPLEMENT_ADVISOR_TASK</code> function in the following form, where the placeholders have the following definitions:
                                 </p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p><code class="codeph"><span class="codeinlineitalic">tname</span></code> is the name of the task.
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">result</code></span> is the CLOB variable that contains a list of the recommendations that have been successfully implemented.
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">filter_lvl</code></span> is the level of implementation: <code class="codeph">TYPICAL</code> (existing filters honored) or <code class="codeph">ALL</code> (filters ignored).
                                       </p>
                                    </li>
                                 </ul><pre class="pre codeblock"><code>EXECUTE <span class="italic">result</span> := DBMS_STATS.IMPLEMENT_ADVISOR_TASK('<span class="italic">tname</span>', level =&gt; <code class="codeph"><span class="codeinlineitalic">filter_lvl</span></code>);</code></pre><p>For example, to implement all recommendations for the task <code class="codeph">opt_adv_task1</code>, use the following code:
                                 </p><pre class="pre codeblock"><code>VARIABLE b_ret CLOB
DECLARE
  v_tname VARCHAR2(32767);
BEGIN
  v_tname := 'opt_adv_task1';
  :b_ret := DBMS_STATS.IMPLEMENT_ADVISOR_TASK(v_tname);
END;
/</code></pre></li>
                              <li>
                                 <p>Optionally, print the XML output to confirm the implemented actions.</p>
                                 <p>For example, to print the XML returned in the previous step, use the following code (sample output included):</p><pre class="pre codeblock"><code>SET LONG 10000
SELECT XMLType(:b_ret) AS imp_results FROM DUAL;</code></pre><pre class="pre codeblock"><code>IMP_RESULTS
------------------------------------
&lt;implementation_results&gt;
  &lt;rule NAME="AVOIDSETPROCEDURES"&gt;
    &lt;implemented&gt;yes&lt;/implemented&gt;
  &lt;/rule&gt;
  &lt;rule NAME="USEGATHERSCHEMASTATS"&gt;
    &lt;implemented&gt;yes&lt;/implemented&gt;
  &lt;/rule&gt;
  &lt;rule NAME="AVOIDSETPROCEDURES"&gt;
    &lt;implemented&gt;yes&lt;/implemented&gt;
  &lt;/rule&gt;
  &lt;rule NAME="USEGATHERSCHEMASTATS"&gt;
    &lt;implemented&gt;yes&lt;/implemented&gt;
  &lt;/rule&gt;
  &lt;rule NAME="USEDEFAULTPARAMS"&gt;
    &lt;implemented&gt;no&lt;/implemented&gt;
  &lt;/rule&gt;
  &lt;rule NAME="USEDEFAULTPARAMS"&gt;
    &lt;implemented&gt;yes&lt;/implemented&gt;
  &lt;/rule&gt;
  &lt;rule NAME="NOTUSEINCREMENTAL"&gt;
    &lt;implemented&gt;yes&lt;/implemented&gt;
  &lt;/rule&gt;
&lt;/implementation_results&gt;</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-9C219CD5-A781-4AC0-AEC8-974EE8F5DEA9__ORACLEDATABASEPLSQLPACKAGESANDTYPES-42008A13">
                           <p class="notep1">See Also:</p>
                           <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-B930CE9B-7461-4691-8AA9-7E424C3C2C8C" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about <code class="codeph">DBMS_STATS.IMPLEMENT_ADVISOR_TASK</code></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-10D99B9A-9FDB-4265-A2D1-043D7165D216" title="You can either implement all recommendations automatically using DBMS_STATS.IMPLEMENT_ADVISOR_TASK, or generate an editable script using DBMS_STATS.SCRIPT_ADVISOR_TASK.">Implementing Optimizer Statistics Advisor Recommendations</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-4FD4A77F-6967-4D30-BB64-01E8AF4F9A65" name="GUID-4FD4A77F-6967-4D30-BB64-01E8AF4F9A65"></a><h5 id="TGSQL-GUID-4FD4A77F-6967-4D30-BB64-01E8AF4F9A65" class="sect5"><span class="enumeration_section">18.2.6.2 </span>Generating a Script Using Optimizer Statistics Advisor
                     </h5>
                     <div>
                        <p>The <code class="codeph">DBMS_STATS.SCRIPT_ADVISOR_TASK</code> function generates an editable script with recommendations for a specified Optimizer Statistics Advisor task.
                        </p>
                        <div class="section">
                           <p>Unlike <code class="codeph">IMPLEMENT_ADVISOR_TASK</code>, the <code class="codeph">SCRIPT_ADVISOR_TASK</code> generates a script that you can edit before execution. The output script contains both comments and executable code. As with <code class="codeph">IMPLEMENT_ADVISOR_TASK</code>, you can specify that the advisor ignore the existing filters <code class="codeph">(level=&gt;'ALL')</code> or use the default, which honors the existing filters <code class="codeph">(level=&gt;'TYPICAL')</code>. You can specify that the function returns the script as a CLOB and file, or only a CLOB.
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-4FD4A77F-6967-4D30-BB64-01E8AF4F9A65__GUID-75DE0489-F46F-4D4B-B93B-947E4339C661">Prerequisites</p>
                           <p>To use the <code class="codeph">DBMS_STATS.SCRIPT_ADVISOR_TASK</code> function, you must meet the following prerequisites:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>To execute this subprogram, you must have the <code class="codeph">ADVISOR</code> privilege.
                                 </p>
                              </li>
                              <li>
                                 <p>You must be the owner of the task.</p>
                              </li>
                           </ul>
                           <div class="infoboxnote" id="GUID-4FD4A77F-6967-4D30-BB64-01E8AF4F9A65__GUID-1B1DD810-107F-4A7D-BCA1-E414709FD9BD">
                              <p class="notep1">Note:</p>
                              <p>This subprogram executes using invoker's rights.</p>
                           </div>
                           <p>The results of performing this task depend on the privileges of the executing user:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">SYSTEM</code> level
                                 </p>
                                 <p>Only users with both the <code class="codeph">ANALYZE ANY</code> and <code class="codeph">ANALYZE ANY DICTIONARY</code> privileges can perform this task on system-level rules.
                                 </p>
                              </li>
                              <li>
                                 <p>Operation level</p>
                                 <p>The results depend on the following privileges:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>Users with both the <code class="codeph">ANALYZE ANY</code> and <code class="codeph">ANALYZE ANY DICTIONARY</code> privileges can perform this task for all statistics operations.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Users with the <code class="codeph">ANALYZE ANY</code> privilege but <span class="italic">not</span> the <code class="codeph">ANALYZE ANY DICTIONARY</code> privilege can perform this task for statistics operations related to any schema except <code class="codeph">SYS</code>.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Users with the <code class="codeph">ANALYZE ANY DICTIONARY</code> privilege but <span class="italic">not</span> the <code class="codeph">ANALYZE ANY</code> privilege can perform this task for statistics operations related to their own schema and the <code class="codeph">SYS</code> schema.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Users with neither the <code class="codeph">ANALYZE ANY</code> nor the <code class="codeph">ANALYZE ANY DICTIONARY</code> privilege can only perform this operation for statistics operations relating to their own schema.
                                       </p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>Object level</p>
                                 <p>Users can perform this task for any object for which they have statistics collection privileges.</p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-4FD4A77F-6967-4D30-BB64-01E8AF4F9A65__GUID-D99CE6B8-81B2-4940-8534-3E6D3D1928B9">To generate an advisor script:</p>
                           <ol>
                              <li>
                                 <p>In SQL*Plus, log in to the database as a user with <code class="codeph">ADVISOR</code> privileges.
                                 </p>
                              </li>
                              <li>
                                 <p>Execute the <code class="codeph">DBMS_STATS.SCRIPT_ADVISOR_TASK</code> function in the following form, where the placeholders have the following definitions:
                                 </p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p><code class="codeph"><span class="codeinlineitalic">tname</span></code> is the name of the task.
                                       </p>
                                    </li>
                                    <li>
                                       <p><code class="codeph"><span class="codeinlineitalic">exec</span></code> is the name of the execution (default is null).
                                       </p>
                                    </li>
                                    <li>
                                       <p><code class="codeph"><span class="codeinlineitalic">dir</span></code> is the name of the directory (default is null).
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">result</code></span> is the CLOB variable that contains a list of the recommendations that have been successfully implemented.
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">filter_lvl</code></span> is the level of implementation: <code class="codeph">TYPICAL</code> (existing filters honored) or <code class="codeph">ALL</code> (filters ignored).
                                       </p>
                                    </li>
                                 </ul><pre class="pre codeblock"><code>EXEC <span class="italic">result</span> := DBMS_STATS.SCRIPT_ADVISOR_TASK('<span class="italic">tname</span>', execution_name =&gt; '<span class="italic">exec</span>', 
  dir_name =&gt; '<span class="italic">dir</span>', level =&gt; '<code class="codeph"><span class="codeinlineitalic">filter_lvl</span></code>');</code></pre><p>For example, to generate a script that contains recommendations for the task <code class="codeph">opt_adv_task1</code>, use the following code:
                                 </p><pre class="pre codeblock"><code>VARIABLE b_script CLOB
DECLARE
  v_tname VARCHAR2(32767);
BEGIN
  v_tname := 'opt_adv_task1';
  :b_script := DBMS_STATS.SCRIPT_ADVISOR_TASK(v_tname);
END;
/</code></pre><div class="infoboxnote" id="GUID-4FD4A77F-6967-4D30-BB64-01E8AF4F9A65__GUID-CD4D9BDD-8DD5-4136-9F04-B39DED906F84">
                                    <p class="notep1">Note:</p>
                                    <p> If you do not specify an execution name, then Optimizer Statistics Advisor uses the most recent execution.</p>
                                 </div>
                              </li>
                              <li>
                                 <p>Print the script.</p>
                                 <p>For example, to print the script returned in the previous step, use the following code (sample output included):</p><pre class="pre codeblock"><code>DECLARE
  v_len    NUMBER(10);
  v_offset NUMBER(10) :=1;
  v_amount NUMBER(10) :=10000;
BEGIN
  v_len := DBMS_LOB.getlength(:b_script);
  WHILE (v_offset &lt; v_len)
  LOOP
    DBMS_OUTPUT.PUT_LINE(DBMS_LOB.SUBSTR(:b_script,v_amount,v_offset));
    v_offset := v_offset + v_amount;
  END LOOP;
END;
/</code></pre><p>The following example shows a sample script:</p><pre class="pre codeblock"><code>-- Script generated for the recommendations from execution EXEC_23
-- in the statistics advisor task OPT_ADV_TASK1
-- Script version 12.2

-- No scripts will be provided for the rule AVOIDSETPROCEDURES.  Please check the report 
-- for more details.
-- No scripts will be provided for the rule USEGATHERSCHEMASTATS. Please check the report 
-- for more details.
-- No scripts will be provided for the rule AVOIDINEFFICIENTSTATSOPRSEQ. Please check the 
-- report for more details.
-- No scripts will be provided for the rule AVOIDUNNECESSARYSTATSCOLLECTION. Please check 
-- the report for more details.
-- No scripts will be provided for the rule GATHERSTATSAFTERBULKDML. Please check the 
-- report for more details.
-- No scripts will be provided for the rule AVOIDDROPRECREATE. Please check the report 
-- for more details.
-- No scripts will be provided for the rule AVOIDOUTOFRANGE. Please check the report 
-- for more details.
-- No scripts will be provided for the rule AVOIDANALYZETABLE. Please check the report 
-- for more details.
-- No scripts will be provided for the rule AVOIDSETPROCEDURES. Please check the report 
-- for more details.
-- No scripts will be provided for the rule USEGATHERSCHEMASTATS. Please check the report 
-- for more details.
-- No scripts will be provided for the rule AVOIDINEFFICIENTSTATSOPRSEQ. Please check the 
-- report for more details.
-- No scripts will be provided for the rule AVOIDUNNECESSARYSTATSCOLLECTION. Please check 
-- the report for more details.
-- No scripts will be provided for the rule GATHERSTATSAFTERBULKDML. Please check the 
-- report for more details.
-- No scripts will be provided for the rule AVOIDDROPRECREATE. Please check the report 
-- for more details.
-- No scripts will be provided for the rule AVOIDOUTOFRANGE. Please check the report 
-- for more details.
-- No scripts will be provided for the rule AVOIDANALYZETABLE. Please check the report 
-- for more details.

-- Scripts for rule USEDEFAULTPARAMS
-- Rule Description: Use Default Parameters in Statistics Collection Procedures
-- Use the default preference value for parameters

begin dbms_stats.set_global_prefs('PREFERENCE_OVERRIDES_PARAMETER', 'TRUE'); end;
/

-- Scripts for rule USEDEFAULTOBJECTPREFERENCE
-- Rule Description: Use Default Object Preference for statistics collection
-- Setting object-level preferences to default values
-- setting CASCADE to default value for object level preference
-- setting ESTIMATE_PERCENT to default value for object level preference
-- setting METHOD_OPT to default value for object level preference
-- setting GRANULARITY to default value for object level preference
-- setting NO_INVALIDATE to default value for object levelpreference

-- Scripts for rule USEINCREMENTAL
-- Rule Description: Statistics should be maintained incrementally when it is beneficial.
-- Turn on the incremental option for those objects for which using incremental is helpful.

-- Scripts for rule UNLOCKNONVOLATILETABLE
-- Rule Description: Statistics for objects with non-volatile should not be locked
-- Unlock statistics for objects that are not volatile.

-- Scripts for rule LOCKVOLATILETABLE
-- Rule Description: Statistics for objects with volatile data should be locked
-- Lock statistics for volatile objects.

-- Scripts for rule NOTUSEINCREMENTAL
-- Rule Description: Statistics should not be maintained incrementally when it is not
   beneficial
-- Turn off incremental option for those objects for which using incremental is not helpful.

begin dbms_stats.set_table_prefs('SH', 'CAL_MONTH_SALES_MV', 'INCREMENTAL', 'FALSE'); end;
/
begin dbms_stats.set_table_prefs('SH', 'CHANNELS', 'INCREMENTAL', 'FALSE'); end;
/
begin dbms_stats.set_table_prefs('SH', 'COUNTRIES', 'INCREMENTAL', 'FALSE'); end;
/
begin dbms_stats.set_table_prefs('SH', 'CUSTOMERS', 'INCREMENTAL', 'FALSE'); end;
/
begin dbms_stats.set_table_prefs('SH', 'DIMENSION_EXCEPTIONS', 'INCREMENTAL', 'FALSE'); end;
/
begin dbms_stats.set_table_prefs('SH', 'FWEEK_PSCAT_SALES_MV', 'INCREMENTAL', 'FALSE'); end;
/
begin dbms_stats.set_table_prefs('SH', 'PRODUCTS', 'INCREMENTAL', 'FALSE'); end;
/
begin dbms_stats.set_table_prefs('SH', 'PROMOTIONS', 'INCREMENTAL', 'FALSE'); end;
/
begin dbms_stats.set_table_prefs('SH', 'SUPPLEMENTARY_DEMOGRAPHICS', 'INCREMENTAL', 'FALSE'); end;
/
begin dbms_stats.set_table_prefs('SH', 'TIMES', 'INCREMENTAL', 'FALSE'); end;
/

-- Scripts for rule USEAUTODEGREE
-- Rule Description: Use Auto Degree for statistics collection
-- Turn on auto degree for those objects for which using auto degree is helpful.

-- Scripts for rule AVOIDSTALESTATS
-- Rule Description: Avoid objects with stale or no statistics
-- Gather statistics for those objcts that are missing or have no statistics.

-- Scripts for rule MAINTAINSTATSCONSISTENCY
-- Rule Description: Statistics of dependent objects should be consistent
-- Gather statistics for those objcts that are missing or have no statistics.
</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-4FD4A77F-6967-4D30-BB64-01E8AF4F9A65__ORACLEDATABASEPLSQLPACKAGESANDTYPES-420550B7">
                           <p class="notep1">See Also:</p>
                           <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-B930CE9B-7461-4691-8AA9-7E424C3C2C8C" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about <code class="codeph">DBMS_STATS.SCRIPT_ADVISOR_TASK</code></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="optimizer-statistics-advisor.html#GUID-10D99B9A-9FDB-4265-A2D1-043D7165D216" title="You can either implement all recommendations automatically using DBMS_STATS.IMPLEMENT_ADVISOR_TASK, or generate an editable script using DBMS_STATS.SCRIPT_ADVISOR_TASK.">Implementing Optimizer Statistics Advisor Recommendations</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>