<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="Some examples of using PL/SQL object types for JSON are presented.">
      <meta name="description" content="Some examples of using PL/SQL object types for JSON are presented.">
      <title>Using PL/SQL Object Types for JSON</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="JSON Developer's Guide">
      <meta property="og:description" content="Some examples of using PL/SQL object types for JSON are presented.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="JSON Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="json-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-02-22T10:58:31-08:00">
      <meta name="dcterms.title" content="JSON Developer's Guide">
      <meta name="dcterms.dateCopyrighted" content="2015, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96227-03">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="overview-of-pl-sql-object-types-for-json.html" title="Previous" type="text/html">
      <link rel="next" href="GeoJSON-geographic-data.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="ADJSN">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="overview-of-pl-sql-object-types-for-json.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="GeoJSON-geographic-data.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">JSON Developer's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="pl-sql-object-types-for-json.html" property="item" typeof="WebPage"><span property="name">PL/SQL Object Types for JSON</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Using PL/SQL Object Types for JSON</li>
            </ol>
            <a id="GUID-F0561593-D0B9-44EA-9C8C-ACB6AA9474EE" name="GUID-F0561593-D0B9-44EA-9C8C-ACB6AA9474EE"></a>
            
            <h2 id="ADJSN-GUID-F0561593-D0B9-44EA-9C8C-ACB6AA9474EE" class="sect2"><span class="enumeration_chapter">23 </span>Using PL/SQL Object Types for JSON
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>Some examples of using PL/SQL object types for JSON are
    presented.</p>
               <div class="section">
                  <div class="infoboxnotealso" id="GUID-F0561593-D0B9-44EA-9C8C-ACB6AA9474EE__GUID-F0DA707B-45F7-4C56-B959-6C225346547D">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="../arpls/json-types.html#ARPLS-GUID-69E61601-5533-418B-8C03-E591B4F7FE36" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for information about
              <code class="codeph">JSON_ARRAY_T</code></p>
                        </li>
                        <li>
                           <p><a href="../arpls/json-types.html#ARPLS-GUID-639D871E-D116-4793-888E-F7948E48F4DE" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for information about
                <code class="codeph">JSON_ELEMENT_T</code></p>
                        </li>
                        <li>
                           <p><a href="../arpls/json-types.html#ARPLS-GUID-10062646-E36F-48B1-9F24-751B613DFB5A" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for information about
                <code class="codeph">JSON_OBJECT_T</code></p>
                        </li>
                        <li>
                           <p><a href="../arpls/json-types.html#ARPLS-GUID-50692D34-FEAF-471E-BA22-17530E31D95D" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for information about
                <code class="codeph">JSON_KEY_LIST</code></p>
                        </li>
                     </ul>
                  </div>
               </div>
               <!-- class="section" -->
               <div class="example" id="GUID-F0561593-D0B9-44EA-9C8C-ACB6AA9474EE__GUID-4A962DA4-F04D-4698-8C54-BA983A0CEA6D">
                  <p class="titleinexample">Example 23-1 Constructing and Serializing an In-Memory
        JSON Object</p>
                  <p>This example uses function <code class="codeph">parse</code> to
        parse a string of JSON data that represents a JSON object with one field,
          <code class="codeph">name</code>, creating an instance <code class="codeph">je</code> of object type
          <code class="codeph">JSON_ELEMENT_T</code>. This instance is tested to see if it represents an
        object, using introspection method (predicate) <code class="codeph">is_object()</code>.
                  </p>
                  <p>If it represents an object (the predicate returns <code class="codeph">TRUE</code> for
          <code class="codeph">je</code>), it is cast to an instance of <code class="codeph">JSON_OBJECT_T</code> and
        assigned to variable <code class="codeph">jo</code>. Method <code class="codeph">put()</code> for object type
          <code class="codeph">JSON_OBJECT_T</code> is then used to add object field <code class="codeph">price</code>
        with value <code class="codeph">149.99</code>.
                  </p>
                  <p>Finally,
          <code class="codeph">JSON_ELEMENT_T</code> instance <code class="codeph">je</code> (which is the same data in
        memory as <code class="codeph">JSON_OBJECT_T</code> instance <code class="codeph">jo</code>) is serialized to a
        string using method <code class="codeph">to_string()</code>, and this string is printed out using
        procedure <code class="codeph">DBMS_OUTPUT.put_line</code>. The result printed out shows the updated
        object as <code class="codeph">{"name":"Radio-controlled plane","price":149.99}</code>. 
                  </p>
                  <p>The updated transient object <code class="codeph">je</code> is serialized here only to be
        printed out; the resulting text is not stored in the database. Sometime after the example
        code is executed, the memory allocated for object-type instances <code class="codeph">je</code> and
          <code class="codeph">jo</code> is reclaimed by the garbage
      collector.
                  </p><pre class="pre codeblock"><code>DECLARE
  <span class="bold">je</span> JSON_ELEMENT_T;
  <span class="bold">jo</span> JSON_OBJECT_T;
BEGIN
  je := JSON_ELEMENT_T.<span class="bold">parse</span>('{"name":"Radio controlled plane"}');
  IF (je.<span class="bold">is_Object</span>) THEN
    jo := <span class="bold">treat</span>(je AS JSON_OBJECT_T);
    jo.<span class="bold">put</span>('price', 149.99);
  END IF;
  DBMS_OUTPUT.put_line(je.<span class="bold">to_string</span>);
END;
/</code></pre></div>
               <!-- class="example" -->
               <div class="example" id="GUID-F0561593-D0B9-44EA-9C8C-ACB6AA9474EE__USINGMETHODGET_KEYSTOOBTAINALISTOFO-13B0AA0A">
                  <p class="titleinexample">Example 23-2 Using Method GET_KEYS() to Obtain a List
        of Object Fields</p>
                  <p>PL/SQL method <code class="codeph">get_keys()</code> is defined
        for PL/SQL object type <code class="codeph">JSON_OBJECT_T</code>. It returns an instance of PL/SQL
        object type <code class="codeph">JSON_KEY_LIST</code>, which is a varray of
          <code class="codeph">VARCHAR2(4000)</code>. The varray contains all of the field names for the given
          <code class="codeph">JSON_OBJECT_T</code> instance.
                  </p>
                  <p>This example iterates through
        the fields returned by <code class="codeph">get_keys()</code>, adding them to an instance of PL/SQL
        object type <code class="codeph">JSON_ARRAY_T</code>. It then uses method <code class="codeph">to_string()</code>
        to serialize that JSON array and then prints the resulting
        string.
                  </p><pre class="pre codeblock"><code>DECLARE
  jo          JSON_OBJECT_T;
  ja          JSON_ARRAY_T;
  keys        JSON_KEY_LIST;
  keys_string VARCHAR2(100);
BEGIN
  ja := new JSON_ARRAY_T;
  jo := JSON_OBJECT_T.parse('{"<span class="bold">name</span>":"Beda", 
                              "<span class="bold">jobTitle</span>":"codmonki", 
                              "<span class="bold">projects</span>":["json", "xml"]}');
  keys := jo.<span class="bold">get_keys</span>;
  FOR i IN 1..keys.COUNT LOOP
     ja.<span class="bold">append</span>(keys(i));
  END LOOP;
  keys_string := ja.<span class="bold">to_string</span>;
  DBMS_OUTPUT.put_line(keys_string);
END;
/
</code></pre><p>The printed output is
      <code class="codeph">["name","jobTitle","projects"]</code>.
                  </p>
               </div>
               <!-- class="example" -->
               <div class="example" id="GUID-F0561593-D0B9-44EA-9C8C-ACB6AA9474EE__GUID-1025CB40-0022-4EA9-B197-C2E3D2BF8B58">
                  <p class="titleinexample">Example 23-3 Using Method PUT() to Update Parts of JSON
        Documents</p>
                  <p>This example updates each purchase-order document in JSON
        column <code class="codeph">po_document</code> of table <code class="codeph">j_purchaseorder</code>. It iterates
        over the JSON array <code class="codeph">LineItems</code> in each document (variable
          <code class="codeph">li_arr</code>), calculating the total price and quantity for each line-item
        object (variable <code class="codeph">li_obj</code>), and it uses method <code class="codeph">put()</code> to add
        these totals to <code class="codeph">li_obj</code> as the values of new fields
          <code class="codeph">totalQuantity</code> and <code class="codeph">totalPrice</code>. This is done by
        user-defined function <code class="codeph">add_totals</code>. 
                  </p>
                  <p>The
          <code class="codeph">SELECT</code> statement here selects one of the documents that has been
        updated.
                  </p><pre class="pre codeblock"><code>CREATE OR REPLACE FUNCTION <span class="bold">add_totals</span>(purchaseOrder IN VARCHAR2) RETURN VARCHAR2 IS
  po_obj        JSON_OBJECT_T;
  li_arr        JSON_ARRAY_T;
  li_item       JSON_ELEMENT_T;
  li_obj        JSON_OBJECT_T;
  unitPrice     NUMBER;
  quantity      NUMBER;
  totalPrice    NUMBER := 0;
  totalQuantity NUMBER := 0;
BEGIN
  po_obj := JSON_OBJECT_T.<span class="bold">parse</span>(purchaseOrder);
  li_arr := po_obj.<span class="bold">get_Array</span>('LineItems');
  FOR i IN 0 .. li_arr.<span class="bold">get_size</span> - 1 LOOP
    li_obj := JSON_OBJECT_T(li_arr.<span class="bold">get</span>(i));
    quantity := li_obj.<span class="bold">get_Number</span>('Quantity');
    unitPrice := li_obj.<span class="bold">get_Object</span>('Part').<span class="bold">get_Number</span>('UnitPrice');
    totalPrice := totalPrice + (quantity * unitPrice);
    totalQuantity := totalQuantity + quantity;
  END LOOP;
  po_obj.<span class="bold">put</span>('totalQuantity', totalQuantity);
  po_obj.<span class="bold">put</span>('totalPrice', totalPrice);
  RETURN po_obj.<span class="bold">to_string</span>;
END;
/

<span class="bold">UPDATE</span> j_purchaseorder <span class="bold">SET</span> (po_document) = <span class="bold">add_totals</span>(po_document);

SELECT po_document FROM j_purchaseorder po WHERE po.po_document.PONumber = 1600;
</code></pre><p>That selects this updated
      document:</p><pre class="pre codeblock"><code>{"PONumber": 1600,
 "Reference": "ABULL-20140421",
 "Requestor": "Alexis Bull",
 "User": "ABULL",
 "CostCenter": "A50",
 "ShippingInstructions": {"name": "Alexis Bull",
                          "Address": {"street": "200 Sporting Green",
                                      "city": "South San Francisco",
                                      "state": "CA",
                                      "zipCode": 99236,
                                      "country": "United States of America"},
                          "Phone": [{"type": "Office", "number": "909-555-7307"},
                                    {"type": "Mobile", "number": "415-555-1234"}]},
 "Special Instructions": null,
 "AllowPartialShipment": true,
 "LineItems": [{"ItemNumber": 1,
                "Part": {"Description": "One Magic Christmas",
                         "UnitPrice": 19.95,
                         "UPCCode": 13131092899},
                "Quantity": 9.0},
               {"ItemNumber": 2,
                "Part": {"Description": "Lethal Weapon",
                         "UnitPrice": 19.95,
                         "UPCCode": 85391628927},
                "Quantity": 5.0}],
 <span class="bold">"totalQuantity": 14,</span>
 <span class="bold">"totalPrice": 279.3</span>}</code></pre></div>
               <!-- class="example" -->
            </div>
            <div>
               <div class="relinfo">
                  <p><strong>Related Topics</strong></p>
                  <ul>
                     <li><a href="overview-of-pl-sql-object-types-for-json.html#GUID-A22995AD-A144-4A5C-AB80-A17225A56E41" title="PL/SQL object types allow fine-grained programmatic construction and manipulation of In-Memory JSON data. You can introspect it, modify it, and serialize it back to textual JSON data.">Overview of PL/SQL Object Types for JSON</a></li>
                     <li><a href="updating-json-document-json-merge-patch.html#GUID-31F88F28-3D92-489B-9CCD-BD1931B91F1F" title="You can use Oracle SQL function json_mergepatch to update specific portions of a JSON document. You pass it a JSON Merge Patch document, which specifies the changes to make to a specified JSON document. JSON Merge Patch is an IETF standard.">Updating a JSON Document with JSON Merge Patch</a></li>
                  </ul>
               </div>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>Parent topic:</strong> <a href="pl-sql-object-types-for-json.html#GUID-C0C2A8C0-99BD-4770-9EA2-B7D53804FC18" title="You can use PL/SQL object types for JSON to read and write multiple fields of a JSON document. This can increase performance, in particular by avoiding multiple parses and serializations of the data.">PL/SQL Object Types for JSON</a></p>
                  </div>
               </div>
            </div>
            
         </div>
      </article>
   </body>
</html>