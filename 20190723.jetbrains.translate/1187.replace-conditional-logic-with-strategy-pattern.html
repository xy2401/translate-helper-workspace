<html lang="en-US" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></meta><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="../app/v2/analytics.js"></script><link rel="canonical" href="replace-conditional-logic-with-strategy-pattern.html"></link><meta charset="UTF-8"></meta><title>用策略模式替换条件逻辑 - 帮助| IntelliJ IDEA</title><link rel="stylesheet" href="../app/v2/app.css"></link></head><body dir="ltr" data-id="Tutorial._Replace_conditional_logic_with_strategy_pattern"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索IntelliJ IDEA帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="replace-conditional-logic-with-strategy-pattern.html#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>IntelliJ IDEA 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">键盘布局</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default" data-group="primary" selected="">Windows / Linux默认值</option><option value="primary_default_for_gnome" data-group="primary">GNOME</option><option value="primary_default_for_kde" data-group="primary">KDE</option><option value="primary_default_for_xwin" data-group="primary">XWin中</option><option value="primary_emacs" data-group="primary">Emacs的</option><option value="primary_jbuilder" data-group="primary">JBuilder的</option><option value="primary_visual_studio" data-group="primary">视觉工作室</option><option value="primary_netbeans" data-group="primary">NetBeans的</option><option value="primary_eclipse" data-group="primary">日食</option><option value="secondary_mac_os_x_10.5_" data-group="secondary">默认（Mac OS X 10.5+）</option><option value="secondary_mac_os_x" data-group="secondary">Mac OS X.</option><option value="secondary_eclipse_mac_os_x" data-group="secondary">Eclipse（Mac OS X）</option><option value="secondary_intellij_idea_classic_os_x" data-group="secondary">IntelliJ IDEA Classic（Mac OS X）</option><option value="secondary_xcode" data-group="secondary">Xcode中</option><option value="secondary_resharper" data-group="secondary">ReSharper的</option><option value="secondary_resharper_osx" data-group="secondary">ReSharper（Mac OS X）</option><option value="secondary_emacs" data-group="secondary">Emacs（Mac OS X）</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="active"><h1 id="Replace_Conditional_Logic_with_Strategy_Pattern.xml" data-toc="Tutorial._Replace_conditional_logic_with_strategy_pattern">用策略模式替换条件逻辑</h1>    <p id="7642686d">当你有一个包含大量条件逻辑的方法（即if语句）时，你会遇到麻烦。众所周知，条件逻辑很难管理，并且可能导致您在单个方法中创建整个状态机。</p>    <ul data-skip-index="skip"><li class="list__item"><a href="replace-conditional-logic-with-strategy-pattern.html#a49d7ca1">分析示例应用程序</a></li><li class="list__item"><a href="replace-conditional-logic-with-strategy-pattern.html#6845cce8">创建并运行测试</a></li><li class="list__item"><a href="replace-conditional-logic-with-strategy-pattern.html#1bd888a3">提取方法</a></li><li class="list__item"><a href="replace-conditional-logic-with-strategy-pattern.html#b3fdc89b">使用Extract Delegate重构</a></li><li class="list__item"><a href="replace-conditional-logic-with-strategy-pattern.html#562f6de2">微调</a></li><li class="list__item"><a href="replace-conditional-logic-with-strategy-pattern.html#73f56477">实现抽象类</a></li><li class="list__item"><a href="replace-conditional-logic-with-strategy-pattern.html#48ee0c67">好结局</a></li></ul><div class="chapter"><h2 id="a49d7ca1">分析示例应用程序</h2> <p id="44697fd7">这是一个简短的例子。比方说，有一种方法可以根据个人收入计算保险费用：</p><div class="code-block" data-lang="Java"><code class="code-block__wrapper"><span class="kn">包裹</span> <span class="nn">ifs</span> <span class="o">;</span> <span class="kd">公共</span> <span class="kd">类</span> <span class="nc">IfElseDemo</span> <span class="o">{</span> <span class="kd">public</span> <span class="kt">double</span> <span class="nf">calculateInsurance</span> <span class="o">（</span> <span class="kt">double</span> <span class="n">income</span> <span class="o">）</span> <span class="o">{</span> <span class="k">if</span> <span class="o">（</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="mi">10000</span> <span class="o">）</span> <span class="o">{</span> <span class="k">return</span> <span class="n">income</span> <span class="o">*</span> <span class="mf">0.365</span> <span class="o">;</span> <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">（</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="mi">30000</span> <span class="o">）</span> <span class="o">{</span> <span class="k">return</span> <span class="o">（</span> <span class="n">income</span> <span class="o">-</span> <span class="mi">10000</span> <span class="o">）*</span> <span class="mf">0.2</span> <span class="o">+</span> <span class="mi">35600</span> <span class="o">;</span> <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">（</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="mi">60000</span> <span class="o">）</span> <span class="o">{</span> <span class="k">return</span> <span class="o">（</span> <span class="n">income</span> <span class="o">-</span> <span class="mi">30000</span> <span class="o">）*</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mi">76500</span> <span class="o">;</span> <span class="o">}</span> <span class="k">else</span> <span class="o">{</span> <span class="k">return</span> <span class="o">（</span> <span class="n">income</span> <span class="o">-</span> <span class="mi">60000</span> <span class="o">）*</span> <span class="mf">0.02</span> <span class="o">+</span> <span class="mi">105600</span> <span class="o">;</span> <span class="o">}</span> <span class="o">}</span> <span class="o">}</span></code></div> <p id="84e25589">让我们分析这个例子。在这里，我们看到四个“收入带宽”，分为四个计算策略。一般来说，它们符合以下公式：</p><div class="code-block" data-lang="Java"><code class="code-block__wrapper"><span class="o">（</span> <span class="n">收入</span> <span class="o">-</span> <span class="n">调整</span> <span class="o">）</span> <span class="o">*</span> <span class="n">重量</span> <span class="o">+</span> <span class="n">常数</span></code></div><p id="f515a088">我们的目标是提供单独的类来计算每个策略，并转换原始类以使其更透明。</p></div><div class="chapter"><h2 id="6845cce8">创建并运行测试</h2>    <p id="e606f04f">首先，让我们确保该课程有效。为此，使用<a href="http://junit.org/" data-bypass="yes" target="_blank"><span>JUnit4</span></a>测试框架创建一个测试类。</p>    <p id="2bedfa58">将插入符号放在类名称上，然后按<kbd data-primary_default="Alt+Enter" data-primary_default_for_gnome="Alt+Enter" data-primary_default_for_kde="Alt+Enter" data-primary_default_for_xwin="Alt+Enter" data-primary_emacs="Alt+Enter" data-primary_jbuilder="Alt+Enter" data-primary_visual_studio="Alt+Enter" data-primary_netbeans="Alt+Enter" data-primary_eclipse="Alt+Enter" data-secondary_mac_os_x_10.5_="⌥⏎" data-secondary_mac_os_x="⌥⏎" data-secondary_eclipse_mac_os_x="⌘1" data-secondary_intellij_idea_classic_os_x="N/A" data-secondary_xcode="N/A" data-secondary_resharper="N/A" data-secondary_resharper_osx="N/A" data-secondary_emacs="⌥⏎">Alt + Enter</kbd> （或单击<img class="inline-icon-16" src="../img/idea/2019.1/icons.actions.intentionBulb.svg@2x.png" width="16" alt="图标动作intentBulb svg"> ）。从建议的意图操作列表中，选择<span class="control">Create Test</span> ：</p>    <figure><img alt="ifelse教程创建测试" title="ifelse教程创建测试" src="../img/idea/2019.1/ifelse_tutorial_create_test.png" id="4901ac32" width="365" height="230"></figure>    <p id="78696c95">在<a href="create-test.html"><span>Create Test</span></a>对话框中，从<span class="control">Testing library</span>下拉列表中选择JUnit4，如果没有JUnit库，单击<span class="control">Fix</span> ，然后单击<span class="control">OK</span> ：</p>    <figure><img alt="ifelse教程创建测试对话框" title="ifelse教程创建测试对话框" src="../img/idea/2019.1/ifelse_tutorial_create_test_dialog.png" id="ed6f9af3" width="444" height="547"></figure>    <p id="05b71628">存根测试类已创建。但是，您必须使用提供的快速修复程序提供一些有意义的代码（ <img class="inline-icon-16" src="../img/idea/2019.1/icons.actions.quickfixBulb.svg@2x.png" width="16" alt="图标动作quickfixBulb svg"> ）创建import语句：</p>    <div class="code-block" data-lang="Java"><code class="code-block__wrapper"><span class="kn">import</span> <span class="nn">org.junit。测试</span> <span class="o">;</span> <span class="kn">导入</span> <span class="nn">静态</span> <span class="n">组织</span> <span class="o">。</span> <span class="na">junit</span> <span class="o">。</span><span class="na">断言</span> <span class="o">。*;</span> <span class="kd">公共</span> <span class="kd">类</span> <span class="nc">IfElseDemoTest</span> <span class="o">{</span> <span class="nd">@Test</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">low</span> <span class="o">（）</span> <span class="o">{</span> <span class="n">assertEquals</span> <span class="o">（</span> <span class="mi">1825</span> <span class="o">，</span> <span class="n">insuranceFor</span> <span class="o">（</span> <span class="mi">5000</span> <span class="o">），</span> <span class="mf">0.01</span> <span class="o">）;</span> <span class="o">}</span> <span class="nd">@Test</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">medium</span> <span class="o">（）</span> <span class="o">{</span> <span class="n">assertEquals</span> <span class="o">（</span> <span class="mi">38600</span> <span class="o">，</span> <span class="n">insuranceFor</span> <span class="o">（</span> <span class="mi">25000</span> <span class="o">），</span> <span class="mf">0.01</span> <span class="o">）;</span> <span class="o">}</span> <span class="nd">@Test</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">high</span> <span class="o">（）</span> <span class="o">{</span> <span class="n">assertEquals</span> <span class="o">（</span> <span class="mi">78500</span> <span class="o">，</span> <span class="n">insuranceFor</span> <span class="o">（</span> <span class="mi">50000</span> <span class="o">），</span> <span class="mf">0.01</span> <span class="o">）;</span> <span class="o">}</span> <span class="nd">@Test</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">veryHigh</span> <span class="o">（）</span> <span class="o">{</span> <span class="n">assertEquals</span> <span class="o">（</span> <span class="mi">106400</span> <span class="o">，</span> <span class="n">insuranceFor</span> <span class="o">（</span> <span class="mi">100_000</span> <span class="o">），</span> <span class="mf">0.01</span> <span class="o">）;</span> <span class="o">}</span> <span class="kd">private</span> <span class="kt">double</span> <span class="nf">insurance</span> <span class="o">（</span> <span class="kt">double</span> <span class="n">income</span> <span class="o">）</span> <span class="o">{</span> <span class="k">return</span> <span class="k">new</span> <span class="n">IfElseDemo</span> <span class="o">（）。</span> <span class="na">calculateInsurance</span> <span class="o">（</span> <span class="n">income</span> <span class="o">）;</span> <span class="o">}</span> <span class="o">}</span></code></div>    <p id="2fd7c2e2">现在让我们通过单击运行按钮来运行此测试<img class="inline-icon-16" src="../img/idea/2019.1/icons.toolwindows.toolWindowRun.svg@2x.png" width="16" alt="icons toolwindows toolWindowRun svg">在左侧排水沟中，或按<kbd data-primary_default="Ctrl+Shift+F10" data-primary_default_for_gnome="Ctrl+Shift+F10" data-primary_default_for_kde="Ctrl+Shift+F10" data-primary_default_for_xwin="Ctrl+Shift+F10" data-primary_emacs="Ctrl+Shift+F10" data-primary_jbuilder="Ctrl+Shift+F10" data-primary_visual_studio="Ctrl+F9" data-primary_netbeans="Shift+Alt+F6" data-primary_eclipse="Ctrl+Shift+F10" data-secondary_mac_os_x_10.5_="⌃⇧R" data-secondary_mac_os_x="⌃⇧F10" data-secondary_eclipse_mac_os_x="⌃⇧R" data-secondary_intellij_idea_classic_os_x="N/A" data-secondary_xcode="N/A" data-secondary_resharper="N/A" data-secondary_resharper_osx="N/A" data-secondary_emacs="⌃⇧F10">Ctrl + Shift + F10</kbd> ：</p>    <figure><img alt="ifelse教程运行测试" title="ifelse教程运行测试" src="../img/idea/2019.1/ifelse_tutorial_run_test.png" id="0446d9c3" width="302" height="124"></figure>    <p id="cf4b786a">所有4项测试均通过：</p>    <figure><img alt="ifelse教程运行测试通过" title="ifelse教程运行测试通过" src="../img/idea/2019.1/ifelse_tutorial_run_test_pass.png" id="a5eadc66" width="618" height="178"></figure></div>    <div class="chapter"><h2 id="1bd888a3">提取方法</h2>        <p id="9cfc3d13">接下来，提出原始类，将插入符号放在表达式中</p>        <div class="code-block" data-lang="Java"><code class="code-block__wrapper"><span class="o">（</span> <span class="n">收入</span> <span class="o">-</span> <span class="mi">60000</span> <span class="o">）*</span> <span class="mf">0.02</span> <span class="o">+</span> <span class="mi">105600</span></code></div>        <p id="8b70c9be">并调用<a href="extract-method-dialog.html"><span>Extract Method Dialog</span></a>对话框（ <kbd data-primary_default="Ctrl+Alt+M" data-primary_default_for_gnome="Ctrl+Alt+M" data-primary_default_for_kde="Ctrl+Alt+M" data-primary_default_for_xwin="Ctrl+Alt+M" data-primary_emacs="Ctrl+Alt+M" data-primary_jbuilder="Ctrl+Shift+E" data-primary_visual_studio="Ctrl+Alt+M" data-primary_netbeans="Shift+Alt+M" data-primary_eclipse="Shift+Alt+M" data-secondary_mac_os_x_10.5_="⌥⌘M" data-secondary_mac_os_x="⌥⌘M" data-secondary_eclipse_mac_os_x="⌥⌘M" data-secondary_intellij_idea_classic_os_x="N/A" data-secondary_xcode="N/A" data-secondary_resharper="N/A" data-secondary_resharper_osx="N/A" data-secondary_emacs="⌃⌥M">Ctrl + Alt + M</kbd> ）：</p>        <figure><img alt="ifelse教程提取方法1" title="ifelse教程提取方法1" src="../img/idea/2019.1/ifelse_tutorial_extract_method1.png" id="f334a02d" width="461" height="421"></figure>        <p id="b4d35124">您将获得以下代码：</p>        <div class="code-block" data-lang="Java"><code class="code-block__wrapper"><span class="kn">包裹</span> <span class="nn">ifs</span> <span class="o">;</span> <span class="kd">class</span> <span class="nc">IfElseDemo</span> <span class="o">{</span> <span class="kd">public</span> <span class="kt">double</span> <span class="nf">calculateInsurance</span> <span class="o">（</span> <span class="kt">double</span> <span class="n">income</span> <span class="o">）</span> <span class="o">{</span> <span class="k">if</span> <span class="o">（</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="mi">10000</span> <span class="o">）</span> <span class="o">{</span> <span class="k">return</span> <span class="n">income</span> <span class="o">*</span> <span class="mf">0.365</span> <span class="o">;</span> <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">（</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="mi">30000</span> <span class="o">）</span> <span class="o">{</span> <span class="k">return</span> <span class="o">（</span> <span class="n">income</span> <span class="o">-</span> <span class="mi">10000</span> <span class="o">）*</span> <span class="mf">0.2</span> <span class="o">+</span> <span class="mi">35600</span> <span class="o">;</span> <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">（</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="mi">60000</span> <span class="o">）</span> <span class="o">{</span> <span class="k">return</span> <span class="o">（</span> <span class="n">income</span> <span class="o">-</span> <span class="mi">30000</span> <span class="o">）*</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mi">76500</span> <span class="o">;</span> <span class="o">}</span> <span class="k">else</span> <span class="o">{</span> <span class="k">return</span> <span class="n">calculateInsuranceVeryHigh</span> <span class="o">（</span> <span class="n">income</span> <span class="o">）;</span> <span class="o"><span class="o">}}</span></span> <span class="kd">公共</span> <span class="kt">双</span> <span class="nf"><span class="o">calculateInsuranceVeryHigh（</span></span> <span class="kt"><span class="n">双薪</span></span> <span class="o"><span class="o">）{</span></span> <span class="k">回报率</span> <span class="o">（</span> <span class="n">收入</span> <span class="o">-</span> <span class="mi"><span class="o">60000）*</span></span> <span class="mf">0.02</span> <span class="o">+</span> <span class="mi"><span class="o">105600;</span></span> <span class="o">}</span> <span class="o">}</span></code></div><p id="7b4fbcae">接下来，对<code class="code">getAdjustment</code>和<code class="code">getConstant</code>片段使用相同的Extract Method重构，并创建方法<code class="code">getAdjustment</code> ， <code class="code">getWeight</code>和<code class="code">getConstant</code> ：</p><div class="code-block" data-lang="Java"><code class="code-block__wrapper"><span class="kn">包裹</span> <span class="nn">ifs</span> <span class="o">;</span> <span class="kd">class</span> <span class="nc">IfElseDemo</span> <span class="o">{</span> <span class="kd">public</span> <span class="kt">double</span> <span class="nf">calculateInsurance</span> <span class="o">（</span> <span class="kt">double</span> <span class="n">income</span> <span class="o">）</span> <span class="o">{</span> <span class="k">if</span> <span class="o">（</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="mi">10000</span> <span class="o">）</span> <span class="o">{</span> <span class="k">return</span> <span class="n">income</span> <span class="o">*</span> <span class="mf">0.365</span> <span class="o">;</span> <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">（</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="mi">30000</span> <span class="o">）</span> <span class="o">{</span> <span class="k">return</span> <span class="o">（</span> <span class="n">income</span> <span class="o">-</span> <span class="mi">10000</span> <span class="o">）*</span> <span class="mf">0.2</span> <span class="o">+</span> <span class="mi">35600</span> <span class="o">;</span> <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">（</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="mi">60000</span> <span class="o">）</span> <span class="o">{</span> <span class="k">return</span> <span class="o">（</span> <span class="n">income</span> <span class="o">-</span> <span class="mi">30000</span> <span class="o">）*</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mi">76500</span> <span class="o">;</span> <span class="o">}</span> <span class="k">else</span> <span class="o">{</span> <span class="k">return</span> <span class="n">calculateInsuranceVeryHigh</span> <span class="o">（</span> <span class="n">income</span> <span class="o">）;</span> <span class="o">}</span> <span class="kd">公共</span> <span class="kt">双</span> <span class="nf"><span class="o">calculateInsuranceVeryHigh（</span></span> <span class="kt"><span class="n">双薪</span></span> <span class="o"><span class="o">）{</span></span> <span class="k">回报率</span> <span class="o">（</span> <span class="n">收入</span> <span class="o">-</span> <span class="n"><span class="o">getAdjustment（））*</span></span> <span class="n"><span class="o"><span class="o">getWeight（）+</span></span></span> <span class="n"><span class="o">getConstant（）;</span></span> <span class="o">}</span> <span class="kd">公众</span> <span class="kt">诠释</span> <span class="nf"><span class="o"><span class="o">getConstant（）{</span></span></span> <span class="k">返回</span> <span class="mi"><span class="o">105600;</span></span> <span class="o">}</span> <span class="kd">公共</span> <span class="kt">双</span> <span class="nf"><span class="o"><span class="o">getWeight（）{</span></span></span> <span class="k">返回</span> <span class="mf"><span class="o">0.02;</span></span> <span class="o">}</span> <span class="kd">公众</span> <span class="kt">诠释</span> <span class="nf"><span class="o"><span class="o">getAdjustment（）{</span></span></span> <span class="k">返回</span> <span class="mi"><span class="o">60000;</span></span> <span class="o">}</span> <span class="o">}</span></code></div>    </div>    <div class="chapter"><h2 id="b3fdc89b">使用Extract Delegate重构</h2>        <p id="2b62ca1a">接下来，选择上一章中创建的所有方法，并调用<a href="extract-into-class-refactorings.html#extract_delegate"><span>Extract委托示例</span></a>重构：</p><figure><a class="lightbox" href="https://www.jetbrains.com/help/img/idea/2019.1/ifelse_tutorial_extract_delegate_thumbnail.zoomed.png"><img alt="ifelse教程提取委托缩略图" title="ifelse教程提取委托缩略图" src="../img/idea/2019.1/ifelse_tutorial_extract_delegate_thumbnail.png" id="2fbbeec5" width="111" height="66"></a></figure>        <p id="ca6e7a1c">新创建的类名为<code class="code">InsuranceStrategyVeryHigh</code> 。</p>        <p id="5d643295">然后从类<code class="code">IfElseDemo</code>删除所有选定的方法。因此，您将获得以下两个类：</p>        <div class="code-block" data-lang="Java"><code class="code-block__wrapper"><span class="kn">包裹</span> <span class="nn">ifs</span> <span class="o">;</span> <span class="kd">class</span> <span class="nc">IfElseDemo</span> <span class="o">{</span> <span class="kd">private</span> <span class="kd">final</span> <span class="n">InsuranceStrategyVeryHigh</span> <span class="n">insuranceStrategyVeryHigh</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InsuranceStrategyVeryHigh</span> <span class="o">（）;</span> <span class="kd">public</span> <span class="kt">double</span> <span class="nf">calculateInsurance</span> <span class="o">（</span> <span class="kt">double</span> <span class="n">income</span> <span class="o">）</span> <span class="o">{</span> <span class="k">if</span> <span class="o">（</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="mi">10000</span> <span class="o">）</span> <span class="o">{</span> <span class="k">return</span> <span class="n">income</span> <span class="o">*</span> <span class="mf">0.365</span> <span class="o">;</span> <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">（</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="mi">30000</span> <span class="o">）</span> <span class="o">{</span> <span class="k">return</span> <span class="o">（</span> <span class="n">income</span> <span class="o">-</span> <span class="mi">10000</span> <span class="o">）*</span> <span class="mf">0.2</span> <span class="o">+</span> <span class="mi">35600</span> <span class="o">;</span> <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">（</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="mi">60000</span> <span class="o">）</span> <span class="o">{</span> <span class="k">return</span> <span class="o">（</span> <span class="n">income</span> <span class="o">-</span> <span class="mi">30000</span> <span class="o">）*</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mi">76500</span> <span class="o">;</span> <span class="o">}</span> <span class="k">else</span> <span class="o">{</span> <span class="k">return</span> <span class="n">insuranceStrategyVeryHigh</span> <span class="o">。</span> <span class="na">calculateInsuranceVeryHigh</span> <span class="o">（</span> <span class="n">收入</span> <span class="o">）;</span> <span class="o">}</span> <span class="o">}</span></code></div>        <p id="99fd9114">和</p>        <div class="code-block" data-lang="Java"><code class="code-block__wrapper"><span class="kn">包裹</span> <span class="nn">ifs</span> <span class="o">;</span> <span class="kd">公共</span> <span class="kd">类</span> <span class="nc">InsuranceStrategyVeryHigh</span> <span class="o">{</span> <span class="kd">public</span> <span class="nf">InsuranceStrategyVeryHigh</span> <span class="o">（）</span> <span class="o">{</span> <span class="o">}</span> <span class="kd">public</span> <span class="kt">double</span> <span class="nf">calculateInsuranceVeryHigh</span> <span class="o">（</span> <span class="kt">double</span> <span class="n">income</span> <span class="o">）</span> <span class="o">{</span> <span class="k">return</span> <span class="o">（</span> <span class="n">income</span> <span class="o">-</span> <span class="n">getAdjustment</span> <span class="o">（））</span> <span class="o">*</span> <span class="n">getWeight</span> <span class="o">（）</span> <span class="o">+</span> <span class="n">getConstant</span> <span class="o">（）;</span> <span class="o">}</span> <span class="kd">公众</span> <span class="kt">诠释</span> <span class="nf"><span class="o"><span class="o">getConstant（）{</span></span></span> <span class="k">返回</span> <span class="mi"><span class="o">105600;</span></span> <span class="o">}</span> <span class="kd">公共</span> <span class="kt">双</span> <span class="nf"><span class="o"><span class="o">getWeight（）{</span></span></span> <span class="k">返回</span> <span class="mf"><span class="o">0.02;</span></span> <span class="o">}</span> <span class="kd">公众</span> <span class="kt">诠释</span> <span class="nf"><span class="o"><span class="o">getAdjustment（）{</span></span></span> <span class="k">返回</span> <span class="mi"><span class="o">60000;</span></span> <span class="o">}</span> <span class="o">}</span></code></div>    </div><div class="chapter"><h2 id="562f6de2">微调</h2>    <p id="b66e3a7c">此代码需要一些修改。首先，让我们改变类<code class="code">IfElseDemo</code> ：</p>    <ul class="list _ul"><li class="list__item" id="1c7f05e8"><p>重命名（ <kbd data-primary_default="Shift+F6" data-primary_default_for_gnome="Shift+F6" data-primary_default_for_kde="Shift+F6" data-primary_default_for_xwin="Shift+F6" data-primary_emacs="Shift+F6" data-primary_jbuilder="Shift+F6" data-primary_visual_studio="Shift+F6" data-primary_netbeans="Ctrl+R" data-primary_eclipse="Shift+Alt+R" data-secondary_mac_os_x_10.5_="⇧F6" data-secondary_mac_os_x="⇧F6" data-secondary_eclipse_mac_os_x="⇧F6" data-secondary_intellij_idea_classic_os_x="N/A" data-secondary_xcode="N/A" data-secondary_resharper="N/A" data-secondary_resharper_osx="N/A" data-secondary_emacs="⇧F6">Shift + F6</kbd> ）字段<code class="code">insuranceStrategyVeryHigh</code>为<code class="code">strategy</code> </p></li><li class="list__item" id="253fb1c6"><p>使这个领域不是最终的。</p></li><li class="list__item" id="3eacb5bf"><p>使用意图操作，将其拆分为声明和初始化：</p><figure><img alt="ifelse教程拆分" title="ifelse教程拆分" src="../img/idea/2019.1/ifelse_tutorial_split.png" id="57613bba" width="635" height="411"></figure>        </li><li class="list__item" id="e75fc716"><p>将初始化向下移动到相应的<code class="code">if-else</code>分支。</p></li></ul><p id="ff49ef1a">获取以下代码：</p><div class="code-block" data-lang="Java"><code class="code-block__wrapper"><span class="kn">包裹</span> <span class="nn">ifs</span> <span class="o">;</span> <span class="kd">class</span> <span class="nc">IfElseDemo</span> <span class="o">{</span> <span class="kd">private</span> <span class="n">InsuranceStrategyVeryHigh</span> <span class="n">strategy</span> <span class="o">;</span> <span class="kd">public</span> <span class="kt">double</span> <span class="nf">calculateInsurance</span> <span class="o">（</span> <span class="kt">double</span> <span class="n">income</span> <span class="o">）</span> <span class="o">{</span> <span class="k">if</span> <span class="o">（</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="mi">10000</span> <span class="o">）</span> <span class="o">{</span> <span class="k">return</span> <span class="n">income</span> <span class="o">*</span> <span class="mf">0.365</span> <span class="o">;</span> <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">（</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="mi">30000</span> <span class="o">）</span> <span class="o">{</span> <span class="k">return</span> <span class="o">（</span> <span class="n">income</span> <span class="o">-</span> <span class="mi">10000</span> <span class="o">）*</span> <span class="mf">0.2</span> <span class="o">+</span> <span class="mi">35600</span> <span class="o">;</span> <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">（</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="mi">60000</span> <span class="o">）</span> <span class="o">{</span> <span class="k">return</span> <span class="o">（</span> <span class="n">income</span> <span class="o">-</span> <span class="mi">30000</span> <span class="o">）*</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mi">76500</span> <span class="o">;</span> <span class="o">}</span> <span class="k">else</span> <span class="o">{</span> <span class="n">strategy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InsuranceStrategyVeryHigh</span> <span class="o">（）;</span> <span class="k">回归</span> <span class="n">策略</span> <span class="o">。</span> <span class="na">calculateInsuranceVeryHigh</span> <span class="o">（</span> <span class="n">收入</span> <span class="o">）;</span> <span class="o">}</span> <span class="o">}</span> <span class="o">}</span></code></div>    <p id="7b1220b6">接下来，让我们修改类<code class="code">InsuranceStrategyVeryHigh</code> - 为它调用<a href="extract-superclass.html"><span>Extract Superclass</span></a>重构。</p>    <figure><img alt="ifelse教程提取超类" title="ifelse教程提取超类" src="../img/idea/2019.1/ifelse_tutorial_extract_superclass.png" id="74d9e52a" width="565" height="590"></figure>    <p id="ab873362">注意<a href="extract-superclass-dialog.html"><span>Extract Superclass Dialog</span></a>对话框中的设置：</p>    <ul class="list _ul"><li class="list__item" id="5af8eb17"><p>要生成的超类的名称是<code class="code">InsuranceStrategy</code> 。</p></li><li class="list__item" id="77066c66"><p>检查类<code class="code">InsuranceStrategyVeryHigh</code>所有方法 - 这意味着它们将包含在超类中。</p></li><li class="list__item" id="47bbfac6"><p><code class="code">calculateInsuranceStrategyVeryHigh</code>方法仍然是非抽象的;通过选择<span class="control">Make Abstract</span>复选框，所有其他方法都是抽象的。</p></li></ul>    <p id="b2fd082d">同意用超类替换<code class="code">InsuranceStrategyVeryHigh</code>类（在<code class="code">IfElseDemo</code>类中）的用法，并获得以下<code class="code">InsuranceStrategy</code>类：</p>    <div class="code-block" data-lang="Java"><code class="code-block__wrapper"><span class="kn">包裹</span> <span class="nn">ifs</span> <span class="o">;</span> <span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">InsuranceStrategy</span> <span class="o">{</span> <span class="kd">public</span> <span class="kt">double</span> <span class="nf">calculateInsuranceVeryHigh</span> <span class="o">（</span> <span class="kt">double</span> <span class="n">income</span> <span class="o">）</span> <span class="o">{</span> <span class="k">return</span> <span class="o">（</span> <span class="n">income</span> <span class="o">-</span> <span class="n">getAdjustment</span> <span class="o">（））</span> <span class="o">*</span> <span class="n">getWeight</span> <span class="o">（）</span> <span class="o">+</span> <span class="n">getConstant</span> <span class="o">（）;</span> <span class="o">}</span> <span class="kd">公共</span> <span class="kd">抽象</span> <span class="kt">INT</span> <span class="nf"><span class="o">getConstant（）;</span></span> <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">double</span> <span class="nf">getWeight</span> <span class="o">（）;</span> <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">int</span> <span class="nf">getAdjustment</span> <span class="o">（）;</span> <span class="o">}</span></code></div></div>    <div class="chapter"><h2 id="73f56477">实现抽象类</h2>        <p id="78391bdb">接下来，对于此抽象类，使用<span class="control">Implement Abstract Class</span>意图为所有策略创建实现：</p>        <figure><img alt="ifelse教程实现摘要" title="ifelse教程实现摘要" src="../img/idea/2019.1/ifelse_tutorial_implement_abstract.png" id="df0e4ea6" width="572" height="256"></figure>        <p id="29f9f989">将新实现类命名为<code class="code">InsuranceStrategyLow</code> ， <code class="code">InsuranceStrategyMedium</code>和<code class="code">InsuranceStrategyHigh</code> 。</p>        <p id="bcb76f0d">对于所有新实现，为方法<code class="code">getAdjustment()</code> ， <code class="code">getWeight()</code>和<code class="code">getConstant()</code>提供正确的<code class="code">return</code>语句。</p>        <p id="e3561c94">因此，所有实现类应该类似于<code class="code">InsuranceStrategyVeryHigh</code>类，但具有特定于策略的调整，权重和常量。例如：</p><div class="code-block" data-lang="Java"><code class="code-block__wrapper"><span class="kn">包裹</span> <span class="nn">ifs</span> <span class="o">;</span> <span class="kd">公共</span> <span class="kd">类</span> <span class="nc">InsuranceStrategyMedium</span> <span class="kd">延伸</span> <span class="n">InsuranceStrategy</span> <span class="nd"><span class="o">{@</span>覆盖</span> <span class="kd">公共</span> <span class="kt">INT</span> <span class="nf"><span class="o"><span class="o">getConstant（）{</span></span></span> <span class="k">返回</span> <span class="mi"><span class="o">35600;</span></span> <span class="o">}</span> <span class="nd">@Override</span> <span class="kd">public</span> <span class="kt">double</span> <span class="nf">getWeight</span> <span class="o">（）</span> <span class="o">{</span> <span class="k">return</span> <span class="mf">0.2</span> <span class="o">;</span> <span class="o">}</span> <span class="nd">@覆盖</span> <span class="kd">公共</span> <span class="kt">INT</span> <span class="nf"><span class="o"><span class="o">getAdjustment（）{</span></span></span> <span class="k">返回</span> <span class="mi"><span class="o">10000;</span></span> <span class="o">}</span> <span class="o">}</span></code></div>      <p id="6d29192c">请注意，在所有新创建的实现类中，类名称都是灰色的 - 到目前为止它们尚未使用。</p><p id="af2ddcec">接下来，提出类<code class="code">IfElseDemo</code> ，并修改所有分支<code class="code">IfElseDemo</code> ，以便初始化<code class="code">strategy</code>字段，就像在最后一个分支中一样：</p><div class="code-block" data-lang="Java"><code class="code-block__wrapper"><span class="kn">包裹</span> <span class="nn">ifs</span> <span class="o">;</span> <span class="kd">class</span> <span class="nc">IfElseDemo</span> <span class="o">{</span> <span class="kd">private</span> <span class="n">InsuranceStrategy</span> <span class="n">strategy</span> <span class="o">;</span> <span class="kd">public</span> <span class="kt">double</span> <span class="nf">calculateInsurance</span> <span class="o">（</span> <span class="kt">double</span> <span class="n">income</span> <span class="o">）</span> <span class="o">{</span> <span class="k">if</span> <span class="o">（</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="mi">10000</span> <span class="o">）</span> <span class="o">{</span> <span class="n">strategy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InsuranceStrategyLow</span> <span class="o">（）;</span> <span class="k">回归</span> <span class="n">策略</span> <span class="o">。</span> <span class="na">calculateInsuranceVeryHigh</span> <span class="o">（</span> <span class="n">收入</span> <span class="o">）;</span> <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">（</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="mi">30000</span> <span class="o">）</span> <span class="o">{</span> <span class="n">strategy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InsuranceStrategyMedium</span> <span class="o">（）;</span> <span class="k">回归</span> <span class="n">策略</span> <span class="o">。</span> <span class="na">calculateInsuranceVeryHigh</span> <span class="o">（</span> <span class="n">收入</span> <span class="o">）;</span> <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">（</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="mi">60000</span> <span class="o">）</span> <span class="o">{</span> <span class="n">strategy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InsuranceStrategyHigh</span> <span class="o">（）;</span> <span class="k">回归</span> <span class="n">策略</span> <span class="o">。</span> <span class="na">calculateInsuranceVeryHigh</span> <span class="o">（</span> <span class="n">收入</span> <span class="o">）;</span> <span class="o">}</span> <span class="k">else</span> <span class="o">{</span> <span class="n">strategy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InsuranceStrategyVeryHigh</span> <span class="o">（）;</span> <span class="k">回归</span> <span class="n">策略</span> <span class="o">。</span> <span class="na">calculateInsuranceVeryHigh</span> <span class="o">（</span> <span class="n">收入</span> <span class="o">）;</span> <span class="o">}</span> <span class="o">}</span> <span class="o">}</span></code></div>        <p id="236a1403">最后，重命名方法<code class="code">calculateInsuranceVeryHigh</code> ：提出类<code class="code">InsuranceStrategy</code> ，将插入符号放在方法名称并按<kbd data-primary_default="Shift+F6" data-primary_default_for_gnome="Shift+F6" data-primary_default_for_kde="Shift+F6" data-primary_default_for_xwin="Shift+F6" data-primary_emacs="Shift+F6" data-primary_jbuilder="Shift+F6" data-primary_visual_studio="Shift+F6" data-primary_netbeans="Ctrl+R" data-primary_eclipse="Shift+Alt+R" data-secondary_mac_os_x_10.5_="⇧F6" data-secondary_mac_os_x="⇧F6" data-secondary_eclipse_mac_os_x="⇧F6" data-secondary_intellij_idea_classic_os_x="N/A" data-secondary_xcode="N/A" data-secondary_resharper="N/A" data-secondary_resharper_osx="N/A" data-secondary_emacs="⇧F6">Shift + F6</kbd> 。应该<code class="code">calculate</code>新名称。</p>    </div><div class="chapter"><h2 id="48ee0c67">好结局</h2>    <p id="5810fecd">最后享受代码：</p>    <div class="code-block" data-lang="Java"><code class="code-block__wrapper"><span class="kn">包裹</span> <span class="nn">ifs</span> <span class="o">;</span> <span class="kd">class</span> <span class="nc">IfElseDemo</span> <span class="o">{</span> <span class="kd">private</span> <span class="n">InsuranceStrategy</span> <span class="n">strategy</span> <span class="o">;</span> <span class="kd">public</span> <span class="kt">double</span> <span class="nf">calculateInsurance</span> <span class="o">（</span> <span class="kt">double</span> <span class="n">income</span> <span class="o">）</span> <span class="o">{</span> <span class="k">if</span> <span class="o">（</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="mi">10000</span> <span class="o">）</span> <span class="o">{</span> <span class="n">strategy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InsuranceStrategyLow</span> <span class="o">（）;</span> <span class="k">回归</span> <span class="n">策略</span> <span class="o">。</span> <span class="na">计算</span> <span class="o">（</span> <span class="n">收入</span> <span class="o">）;</span> <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">（</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="mi">30000</span> <span class="o">）</span> <span class="o">{</span> <span class="n">strategy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InsuranceStrategyMedium</span> <span class="o">（）;</span> <span class="k">回归</span> <span class="n">策略</span> <span class="o">。</span> <span class="na">计算</span> <span class="o">（</span> <span class="n">收入</span> <span class="o">）;</span> <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">（</span> <span class="n">income</span> <span class="o">&lt;=</span> <span class="mi">60000</span> <span class="o">）</span> <span class="o">{</span> <span class="n">strategy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InsuranceStrategyHigh</span> <span class="o">（）;</span> <span class="k">回归</span> <span class="n">策略</span> <span class="o">。</span> <span class="na">计算</span> <span class="o">（</span> <span class="n">收入</span> <span class="o">）;</span> <span class="o">}</span> <span class="k">else</span> <span class="o">{</span> <span class="n">strategy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InsuranceStrategyVeryHigh</span> <span class="o">（）;</span> <span class="k">回归</span> <span class="n">策略</span> <span class="o">。</span> <span class="na">计算</span> <span class="o">（</span> <span class="n">收入</span> <span class="o">）;</span> <span class="o">}</span> <span class="o">}</span> <span class="o">}</span></code></div>    <p id="c26fe098">接下来，让我们再次运行测试类。所有测试都应该通过 - 我们已经重构了代码，但它仍然会产生相同的结果。</p></div><div class="last-modified" data-skip-index="skip">最后修改日期：2019年3月28日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="tutorial-introduction-to-refactoring.html">重构</a> <a class="navigation-links__next" href="todo-example.html">TODO示例</a> <a class="navigation-links__prev" href="tutorial-introduction-to-refactoring.html">简介</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="../app/v2/app.js"></script></body></html>