<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="../app/v2/analytics.js"></script><link rel="canonical" href="debug-asynchronous-code.html"><meta charset="UTF-8"><title>Debug asynchronous code - Help | IntelliJ IDEA</title><link rel="stylesheet" href="../app/v2/app.css"></head><body data-id="Debug_asynchronous_code"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search IntelliJ IDEA Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="debug-asynchronous-code.html#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>IntelliJ IDEA 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="primary_default" selected>Windows/Linux Default</option><option data-group="primary" value="primary_default_for_gnome">GNOME</option><option data-group="primary" value="primary_default_for_kde">KDE</option><option data-group="primary" value="primary_default_for_xwin">XWin</option><option data-group="primary" value="primary_emacs">Emacs</option><option data-group="primary" value="primary_jbuilder">JBuilder</option><option data-group="primary" value="primary_visual_studio">Visual Studio</option><option data-group="primary" value="primary_netbeans">NetBeans</option><option data-group="primary" value="primary_eclipse">Eclipse</option><option data-group="secondary" value="secondary_mac_os_x_10.5_">Default (Mac OS X 10.5+)</option><option data-group="secondary" value="secondary_mac_os_x">Mac OS X</option><option data-group="secondary" value="secondary_eclipse_mac_os_x">Eclipse (Mac OS X)</option><option data-group="secondary" value="secondary_intellij_idea_classic_os_x">IntelliJ IDEA Classic (Mac OS X)</option><option data-group="secondary" value="secondary_xcode">Xcode</option><option data-group="secondary" value="secondary_resharper">ReSharper</option><option data-group="secondary" value="secondary_resharper_osx">ReSharper (Mac OS X)</option><option data-group="secondary" value="secondary_emacs">Emacs (Mac OS X)</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="active"><h1 data-toc="Debug_asynchronous_code" id="Debug_asynchronous_code.xml">Debug asynchronous code</h1><p id="eaccb54e">        Debugging asynchronous code is a challenge as the execution jumps between frames and makes it harder to follow the code.        To help you look back from a specific point in the code, IntelliJ IDEA provides <span class="keyword">capture points</span>.</p>        <p id="b1ad8936">                A <span class="keyword">capture point</span> is a place in your code where the debugger captures stack traces to be used later                when you reach a specific point in the code (the insertion point) and want to see how you got there. A <span class="keyword">capture point</span>                is specified by the method name (and the containing class) and the key expression. When the debugger stops, it starts matching stack frames with the                <span class="keyword">insertion point</span>, which is another method and expression. If a match is found, the debugger evaluates the expression, and if the value                has some related stack information, it replaces the rest of the call stack with the captured stack. This helps you see what was happening at the                related capture point, and how you got to the present point.        </p>        <p id="fab3ac87">                Asynchronous stack traces are enabled by default (<span data-skip-index="skip" class="menupath">Settings/Preferences | Build, Execution, Deployment | Debugger | Async Stack Traces</span>).                The most common capture points are built in, so no configuration is required.        </p>        <p id="23f65d8c">To try async stack traces, debug the following example:</p>        <div class="code-block" data-lang="Java"><code class="code-block__wrapper"><span class="kn">import</span> <span class="nn">org.jetbrains.annotations.Async</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.concurrent.BlockingQueue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.LinkedBlockingQueue</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AsyncSchedulerExample</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">queue</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedBlockingQueue</span><span class="o">&lt;&gt;();</span>

        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
                <span class="k">new</span> <span class="n">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
                        <span class="k">try</span> <span class="o">{</span>
                                <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
                                        <span class="n">process</span><span class="o">(</span><span class="n">queue</span><span class="o">.</span><span class="na">take</span><span class="o">());</span>
                                <span class="o">}</span>
                        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                        <span class="o">}</span>
                <span class="o">}).</span><span class="na">start</span><span class="o">();</span>
                <span class="n">schedule</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
                <span class="n">schedule</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
                <span class="n">schedule</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
        <span class="o">}</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">schedule</span><span class="o">(</span><span class="nd">@Async.Schedule</span> <span class="n">Integer</span> <span class="n">i</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Scheduling &quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
        <span class="n">queue</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="nd">@Async.Execute</span> <span class="n">Integer</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Put a breakpoint here</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Processing &quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
<span class="o">}</span></code></div>        <div class="chapter"><h2 id="af6b7c91" data-toc="Debug_asynchronous_code#af6b7c91">Use async annotations</h2>                <p id="e154574b">                        If you need capture points that are not included in the default configuration, you can use                        annotations that can be referenced in your code.                </p>                <p id="c27898b4">                        <a href="maven-support.html#maven_dependencies">Add a dependency</a> to the                        <a href="https://mvnrepository.com/artifact/org.jetbrains/annotations/16.0.2" data-bypass="yes" target="_blank"><span>JetBrains Maven Java annotations repository</span></a> for your artifacts and                        use the <code class="code">@Async.Schedule</code> and <code class="code">@Async.Execute</code> annotations in your code.                </p>                <p id="38210f6b">                        When a point annotated with <code class="code">@Async.Schedule</code> is reached, the current stack is saved in a storage map. When a point annotated with                        <code class="code">@Async.Execute</code> is reached, the debugger tries to find the related stack in the storage map.                </p>                <p id="f24bd60b">                        You can annotate:                </p>                <ul class="list _bullet"><li class="list__item" id="3374dd90"><p>                                methods: <code class="code">this</code> value is used as a key                        </p></li><li class="list__item" id="d6d91d23"><p>                                parameters: the parameter value is used as a key                        </p></li></ul>                <section class="procedure-steps"><h2 id="custom_async_annotations">Define custom annotations</h2><p id="24f33c94">                                If for some reason you do not want to add the JetBrains Maven repository as a dependency for your project, you can define your own                                annotations and use them instead of the default ones.                        </p><ol class="list _decimal"><li class="list__item" id="5ed8d80d"><p>                                Create your own annotations for the capture point and the insertion point (you can use                                <a href="https://github.com/JetBrains/java-annotations/blob/master/common/src/main/java/org/jetbrains/annotations/Async.java" data-bypass="yes" target="_blank"><span>Async.java</span></a> for reference).                        </p></li><li class="list__item" id="2b70991b"><p>                                                In the <span class="control">Settings/Preferences</span> dialog (<kbd data-primary_default="Ctrl+Alt+S" data-primary_default_for_gnome="Ctrl+Alt+S" data-primary_default_for_kde="Ctrl+Alt+S" data-primary_default_for_xwin="Ctrl+Alt+S" data-primary_emacs="Ctrl+Alt+S" data-primary_jbuilder="N/A" data-primary_visual_studio="Alt+F7" data-primary_netbeans="Ctrl+Alt+S" data-primary_eclipse="Ctrl+Alt+S" data-secondary_mac_os_x_10.5_="⌘," data-secondary_mac_os_x="⌘," data-secondary_eclipse_mac_os_x="⌘," data-secondary_intellij_idea_classic_os_x="N/A" data-secondary_xcode="N/A" data-secondary_resharper="N/A" data-secondary_resharper_osx="N/A" data-secondary_emacs="⌃⌥S">Ctrl+Alt+S</kbd>), go to                                <span data-skip-index="skip" class="menupath">Build | Execution | Deployment | Debugger | Async Stack Traces</span> and click                                <span class="control">Configure annotations</span>.                        </p></li><li class="list__item" id="e6b7c080"><p>                              In the <span class="control">Async Annotations Configuration</span> dialog, click <img class="inline-icon-16" src="../img/idea/2019.1/icons.general.add@2x.png" width="16" alt="add"> to add your custom                                annotations to <span class="control">Async Schedule annotations</span> and <span class="control">Async Execute annotations</span>.                        </p></li></ol></section>        </div>        <div class="chapter"><h2 id="885a785f" data-toc="Debug_asynchronous_code#885a785f">Configure capture points manually</h2>                <p id="b6d1d037">                        If for some reason you cannot use annotations, or need to be able to capture local variables, you can configure capture points manually.                </p>                <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="4e97fa11"><p>                                                In the <span class="control">Settings/Preferences</span> dialog (<kbd data-primary_default="Ctrl+Alt+S" data-primary_default_for_gnome="Ctrl+Alt+S" data-primary_default_for_kde="Ctrl+Alt+S" data-primary_default_for_xwin="Ctrl+Alt+S" data-primary_emacs="Ctrl+Alt+S" data-primary_jbuilder="N/A" data-primary_visual_studio="Alt+F7" data-primary_netbeans="Ctrl+Alt+S" data-primary_eclipse="Ctrl+Alt+S" data-secondary_mac_os_x_10.5_="⌘," data-secondary_mac_os_x="⌘," data-secondary_eclipse_mac_os_x="⌘," data-secondary_intellij_idea_classic_os_x="N/A" data-secondary_xcode="N/A" data-secondary_resharper="N/A" data-secondary_resharper_osx="N/A" data-secondary_emacs="⌃⌥S">Ctrl+Alt+S</kbd>)     go to                                <span data-skip-index="skip" class="menupath">Build, Execution, Deployment | Debugger | Async Stack Traces</span>.                        </p></li><li class="list__item" id="6ae35580">                                Click <img class="inline-icon-16" src="../img/idea/2019.1/icons.general.add@2x.png" width="16" alt="add"> to add a new capture point, and enter the information related to the capture point and the insertion point.                                <p id="fc214fb0">                                        For example, <code class="code">javax.swing.SwingUtilities.invokeLater</code> with the <code class="code">doRun</code> key will capture all invocations of the                                        <code class="code">invokeLater</code> method and associate them with the <code class="code">Runnable</code> instance parameter.                                        <code class="code">java.awt.event.InvocationEvent.dispatch</code> with the <code class="code">runnable</code> insert key will insert the information captured                                        for <code class="code">invokeLater</code> to the place where <code class="code">Runnable</code> is executed.                                </p>                        </li><li class="list__item" id="d18c8368"><p>                                (Optional) If you also want to capture local variables (primitives and String values together with the call stack,                                select the <span class="control">Capture local variables</span> option. Note that this may slow down the debugging process, and that this option is                                unavailable if the <span class="control">Instrumenting Agent</span> is enabled.                        </p></li></ol></section>                <p id="ff876b68">                        You can download some additional capture settings from the following repository: <a href="https://github.com/JetBrains/capture-points" data-bypass="yes" target="_blank"><span>IntelliJ IDEA debugger Capture Points</span></a>                </p>                <aside class="note " data-title="" rel="ff876b68" id="d531d232">                        <p id="a11339a8">Evaluating key expressions may slow down your application, so we recommend using simple expressions, for example</p>                        <ul class="list _bullet"><li class="list__item" id="5c3e467a"><p>                                        this                                </p></li><li class="list__item" id="6e3007b4"><p>                                        method parameter name (you can use <code class="code">param_N</code> where N is a zero-based param number)                                </p></li><li class="list__item" id="d7bb06b4"><p>                                        local variable or field name                                </p></li></ul>                        <p id="ab81ce98">                                Method invocations are much slower and are not recommended.                        </p>                </aside>        </div>        <div class="chapter"><h2 id="4321e7f7" data-toc="Debug_asynchronous_code#4321e7f7">View Async Stack Traces in remote JVMs</h2>                <p id="c01293e1">                        If you are debugging a remote process, for example managed within a <a href="docker.html">Docker</a> container,                        you can still use the JVM Instrumenting Agent to display Async Stack Traces as if it were started from the IDE.                </p>                <p id="efe39af4">                        To use the agent remotely, do the following:                </p>                <ul class="list _bullet"><li class="list__item" id="9d267ec9"><p>                                copy &lt;IDEA installation folder&gt;/lib/rt/debugger-agent.jar to any location on the remote machine                        </p></li><li class="list__item" id="a2f8de48"><p>                                add <code class="code">-javaagent:&lt;path to debugger-agent.jar&gt;</code> to the remote JVM options                        </p></li></ul>        </div>        <div class="last-modified" data-skip-index="skip">Last modified: 28 March 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="analyze-java-stream-operations.html">Analyze Java Stream operations</a><a class="navigation-links__next" href="inline-debugging.html">Inline Values View</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="../app/v2/app.js"></script></body></html>

























