<html lang="en-US" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></meta><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="../app/v2/analytics.js"></script><meta name="description" content="How to create a web application using Flask, SQlite database, SQLAlchemy, and Jinja templates." data-skip-index="skip"></meta><link rel="canonical" href="creating-web-application-with-flask.html"></link><meta charset="UTF-8"></meta><title>使用Flask创建Web应用程序 - 帮助| PyCharm</title><link rel="stylesheet" href="../app/v2/app.css"></link></head><body dir="ltr" data-id="Creating_Web_Application_with_Flask"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索PyCharm帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="creating-web-application-with-flask.html#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>PyCharm 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">键盘布局</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default" data-group="primary" selected="">Windows / Linux默认值</option><option value="primary_default_for_gnome" data-group="primary">GNOME</option><option value="primary_default_for_kde" data-group="primary">KDE</option><option value="primary_default_for_xwin" data-group="primary">XWin中</option><option value="primary_emacs" data-group="primary">Emacs的</option><option value="primary_visual_studio" data-group="primary">视觉工作室</option><option value="primary_netbeans" data-group="primary">NetBeans的</option><option value="primary_eclipse" data-group="primary">日食</option><option value="secondary_mac_os_x_10.5_" data-group="secondary">默认（Mac OS X 10.5+）</option><option value="secondary_mac_os_x" data-group="secondary">Mac OS X.</option><option value="secondary_eclipse_mac_os_x" data-group="secondary">Eclipse（Mac OS X）</option><option value="secondary_intellij_idea_classic_os_x" data-group="secondary">IntelliJ IDEA Classic（Mac OS X）</option><option value="secondary_xcode" data-group="secondary">Xcode中</option><option value="secondary_visual_studio" data-group="secondary">视觉工作室</option><option value="secondary_resharper" data-group="secondary">ReSharper的</option><option value="secondary_resharper_osx" data-group="secondary">ReSharper（Mac OS X）</option><option value="secondary_emacs" data-group="secondary">Emacs（Mac OS X）</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="active"><h1 id="Creating_Web_Application_with_Flask.xml" data-toc="Creating_Web_Application_with_Flask">使用Flask创建Web应用程序</h1>                         <aside class="warning " rel="Creating_Web_Application_with_Flask.xml" id="7877690c" data-title=""><p>此功能仅在<b id="9ae40ec0" origin="intellij-platform">专业</b>版中受支持。此版本是商业版，它提供了一系列出色的功能：有关详细信息，请参阅<a href="https://www.jetbrains.com/pycharm/features/editions_comparison_matrix.html" data-bypass="yes" target="_blank"><span>比较矩阵</span></a> 。</p></aside>    <p id="d31f0ce9">本教程介绍如何使用Flask Web框架开发基于Web的应用程序。我们的MeteoMaster应用程序处理存储在数据库中的meteo数据，并以下列图表的形式呈现：</p>    <ul class="list _ul"><li class="list__item" id="95b16fa8"><p id="e4c1d182">散点图 - 布拉格，圣彼得堡，旧金山，巴黎和新加坡的年平均温度和湿度的累积报告。</p>        </li><li class="list__item" id="e3a0a2fe">            <p id="fc78682b">折线图 - 每个城市的月平均温度和湿度。</p>        </li></ul>    <figure id="d1c5013e" width="600" height="518"><img class="js-gif" src="../img/idea/2019.1/py_flask_demo.png" width="600" data-gif-src="/help/img/idea/2019.1/py_flask_demo.animated.gif" style="width:600px"></figure>    <div class="chapter"><h2 id="overview" data-toc="Creating_Web_Application_with_Flask#overview">保持在天气之上：应用程序概述</h2>        <p id="e0568942">您将使用各种Web技术来实现以下应用程序功能：</p>        <div class="table-wrapper"><table class="                 " width="100%" id="c491c900"><thead><tr id="f4630a0a" class="ijRowHead"><th id="1145e346"><p>功能</p></th><th id="626494c3"><p>技术</p></th></tr></thead><tbody><tr id="416df76d" class="ijRowOdd"><td id="67454cf8"><p>Meteo数据操作</p></td><td id="9f3ce002"><p><a href="https://www.sqlite.org/index.html" data-bypass="yes" target="_blank"><span>SQLite</span></a>数据库用于存储数据， <a href="https://www.sqlalchemy.org/" data-bypass="yes" target="_blank"><span>SQLAlchemy</span></a>包用Python代码执行数据库操作。</p></td></tr><tr id="70f50e41" class="ijRowEven"><td id="26a137dd"><p>图示</p></td><td id="e5b40d5e"><p><a href="https://matplotlib.org/" data-bypass="yes" target="_blank"><span>matplotlib</span></a>包绘制图。</p></td></tr><tr id="5410c8e5" class="ijRowOdd"><td id="8090954c"><p>查看和编辑内容</p></td><td id="757813a0"><p>用于创建页面视图的<a href="https://www.w3schools.com/html/" data-bypass="yes" target="_blank"><span>HTML</span></a>和用于创建智能模板的<a href="http://jinja.pocoo.org/" data-bypass="yes" target="_blank"><span>Jinja</span></a> 。</p></td></tr><tr id="ff6c84de" class="ijRowEven"><td id="65bc909b"><p>管理内容</p></td><td id="1a6e85f9"><p><a href="http://flask.pocoo.org/" data-bypass="yes" target="_blank"><span>Flask</span></a>来协调应用程序内容。</p></td></tr></tbody></table></div>        <p id="a77fb825">MeteoMaster是一个Web应用程序，包含以下组件：</p>        <figure><img alt="Flask Web应用程序的关键模块" title="Flask Web应用程序的关键模块" src="../img/idea/2019.1/py_flask_app_structure.png" id="04a44b09" width="600" height="440"></figure>        <dl><dt id="c571fa38">主页</dt><dd>                <p id="7f941136">应用程序入口点，用于呈现散点图并提供指向特定城市气候详细摘要的链接。</p>            </dd><dt id="31601b0d">市</dt><dd>                <p id="62b4cf2c">一系列页面，其中包含每个城市的气候详细信息。</p>            </dd><dt id="31cd7e3c">登录</dt><dd>                <p id="ebc95636">验证页面。需要输入有效凭据才能编辑气象数据。</p>            </dd><dt id="16f8f951">编辑</dt><dd>                <p id="92a21966">用于编辑城市特定数据的一系列页面。</p>            </dd></dl>        <p id="5af5ab0d">每个HTML页面都有一个用Python代码实现的相应Flask视图。</p>    </div>    <div class="chapter"><h2 id="f836515c" data-toc="Creating_Web_Application_with_Flask#f836515c">在PyCharm中创建Flask应用程序</h2>        <p id="ae9b1247">创建一个基本的Flask项目，如<a href="creating-flask-project.html"><span>创建</span></a> Flask项目中所述，以开始对应用程序进行原型设计。</p>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="73aee2f3">                <p id="ef62c2a9">在<span class="control">New Project</span>对话框中选择<span class="control">Flask</span> 。</p><figure><img alt="创建一个新的Flask项目" title="创建一个新的Flask项目" src="../img/idea/2019.1/py_flask_create_meteo_project.png" id="ab0dd3e9" width="600" height="869"></figure>                            </li><li class="list__item" id="b24c2f1c"><p id="7ced37e6">在“ <span class="control">位置”</span>字段中，提供项目位置的路径，并键入<span class="keyword">MeteoMaster</span>作为项目名称。保留其余设置的默认值并保存更改。</p>            </li><li class="list__item" id="38fdc871">                <p id="1462bacb">单击<kbd data-primary_default="Shift+F10" data-primary_default_for_gnome="Shift+F10" data-primary_default_for_kde="Shift+F10" data-primary_default_for_xwin="Shift+F10" data-primary_emacs="Shift+F10" data-primary_visual_studio="Ctrl+F5" data-primary_netbeans="F6" data-primary_eclipse="Shift+Alt+X" data-secondary_mac_os_x_10.5_="⌃R" data-secondary_mac_os_x="⇧F10" data-secondary_eclipse_mac_os_x="⇧⌘F11" data-secondary_intellij_idea_classic_os_x="N/A" data-secondary_xcode="N/A" data-secondary_visual_studio="⌃F5" data-secondary_resharper="N/A" data-secondary_resharper_osx="N/A" data-secondary_emacs="⇧F10">Shift + F10</kbd>以运行默认应用程序。在“ <span class="control">运行”</span>工具窗口中，单击超链接并预览目标页面。</p><figure><img alt="预览Hello World应用程序" title="预览Hello World应用程序" src="../img/idea/2019.1/py_flask_meteo_run_default.png" id="15aeffe1" width="700" height="366"></figure>                            </li><li class="list__item" id="29bba864">                <p id="eb5d058a">现在安装MeteoMaster应用程序所需的所有软件包。最简单的方法是使用项目依赖项（请参阅<a href="managing-dependencies.html"><span>使用requirements.txt管理依赖项</span></a> ）。右键单击项目根目录，然后选择“ <span class="menupath" data-skip-index="skip">新建”|</span>单击<span class="menupath" data-skip-index="skip">File</span> ，然后将<span class="keyword">requirements.txt</span>指定为文件名，并将以下依赖项列表添加到其中。</p><div class="code-block" data-lang="Plain Text"><code class="code-block__wrapper">Click == 7.0 cycler == 0.10.0 Flask == 1.0.2 Jinja2 == 2.10 kiwisolver == 1.0.1 MarkupSafe == 1.1.0 matplotlib == 3.0.2 numpy == 1.15.4 pyparsing == 2.3.0 python-dateutil == 2.7.5 six == 1.11.0 SQLAlchemy == 1.2.14 Werkzeug == 0.14.1</code></div>                                <p id="63235955">单击“ <span class="control">安装要求”</span>链接以继续安装软件包。</p><figure><img alt="安装应用程序所需的包" title="安装应用程序所需的包" src="../img/idea/2019.1/py_flask_meteo_requirements.png" id="55060f36" width="700" height="189"></figure>            </li></ol></section>    </div>    <div class="chapter"><h2 id="database" data-toc="Creating_Web_Application_with_Flask#database">设置数据库</h2>        <p id="20c5cdf2">现在，为您的应用程序设置数据源。使用PyCharm，它非常简单。</p>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="b2850814">                <p id="a3fc732c">从以下位置下载包含五个城市的meteo数据的预定义数据库：</p>                <p id="073f87d1"><a href="https://github.com/allaredko/flask-tutorial-demo/blob/master/user_database" data-bypass="yes" target="_blank"><span>https://github.com/allaredko/flask-tutorial-demo/blob/master/user_database</span></a></p>                 <p id="e32e4a92">将<span class="filepath">user_database</span>文件保存在项目根目录中。</p></li><li class="list__item" id="0cc7d7d9"><p id="5941e4b5">双击添加的文件，然后打开“ <a href="database-tool-window.html"><span>数据库工具”窗口</span></a> 。</p><figure><img alt="气象数据库" title="气象数据库" src="../img/idea/2019.1/py_flask_meteo_database.png" id="a4e4bb15" width="700" height="724"></figure>                    <p id="7f26f2bd">您应该在<code class="code">user_database</code>数据库中看到以下表： <code class="code">city</code>和<code class="code">meteo</code> 。双击每个表以预览数据。<code class="code">city</code>表有三列： <code class="code">city_id</code> ， <code class="code">city_name</code>和<code class="code">city_climate</code> （城市气候的简短文字说明）。<code class="code">meteo</code>表有四列： <code class="code">city_id</code> ， <code class="code">month</code> ， <code class="code">average_humidity</code>和<code class="code">average_temperature</code> 。为<code class="code">table</code>的<code class="code">city_id</code>列定义<span class="emphasis">外键</span>以设置两个表之间的关系。</p>                </li><li class="list__item" id="d44e8fea">                   <p id="f0fe4943">（可选）在“ <span class="control">数据库”</span>工具窗口中右键单击“ <span class="control">user_database”</span> ，然后选择“ <span class="menupath" data-skip-index="skip">属性”</span> 。在“ <span class="control">数据源和驱动程序”</span>对话框中，单击“ <span class="control">测试连接”</span>以确保已正确配置数据源。</p>                <figure><img alt="添加数据源" title="添加数据源" src="../img/idea/2019.1/py_flask_meteo_datasource.png" id="08aa6778" width="600" height="756"></figure></li><li class="list__item" id="6956fbb8">                <p id="d7081acb"><a href="creating-and-running-your-first-python-project.html#create-file">创建一个Python文件</a> <span class="filepath">user_database.py</span> ，以使用新创建的数据库。使用<a href="https://docs.sqlalchemy.org/en/latest/orm/extensions/declarative/basic_use.html" data-bypass="yes" target="_blank"><span>SQLAlchemy声明性基本</span></a>语法来描述数据库。</p><div class="code-block" data-lang="Python"><code class="code-block__wrapper"><span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span> <span class="p">（）</span> <span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span> <span class="p">（</span> <span class="s">'sqlite：/// user_database'</span> <span class="p">，</span> <span class="n">connect_args</span> <span class="o">=</span> <span class="p">{</span> <span class="s">'check_same_thread'</span> <span class="p">：</span> <span class="bp">False</span> <span class="p">}，</span> <span class="n">echo</span> <span class="o">=</span> <span class="bp">False</span> <span class="p">）</span> <span class="c">#echo = False</span> <span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span> <span class="p">（）</span> <span class="n">db_session</span> <span class="o">=</span> <span class="n">sessionmaker</span> <span class="p">（</span> <span class="n">bind</span> <span class="o">=</span> <span class="n">engine</span> <span class="p">）（ <span class="c">）＃</span></span> <span class="c">表<span class="k">市级</span></span> <span class="nc">城市</span> <span class="p">（</span> <span class="n">基地</span> <span class="p"><span class="n">）：__tablename__</span></span> <span class="o">=</span> <span class="s">'城市'</span> <span class="n">city_id</span> <span class="o">=</span> <span class="n">列</span> <span class="p">（</span> <span class="n">整数</span> <span class="p"><span class="n">，primary_key</span></span> <span class="o">=</span> <span class="bp">真</span> <span class="p"><span class="n">）CITY_NAME</span></span> <span class="o">=</span> <span class="n">列</span> <span class="p">（</span> <span class="n">串</span> <span class="p"><span class="n">）city_climate</span></span> <span class="o">=</span> <span class="n">列</span> <span class="p">（</span> <span class="n">串</span> <span class="p"><span class="n">）city_meteo_data</span></span> <span class="o">=</span> <span class="n">关系</span> <span class="p">（</span> <span class="s">“气象<span class="p"><span class="n">”，backref</span></span></span> <span class="o">=</span> <span class="s">“城市”</span> <span class="c"><span class="p">）＃</span>表气象</span> <span class="k">类</span> <span class="nc">气象</span> <span class="p">（</span> <span class="n">碱</span> <span class="p"><span class="n">）：__tablename__</span></span> <span class="o">=</span> <span class="s">'气象'</span> <span class="nb">ID</span> <span class="o">=</span> <span class="n">柱</span> <span class="p">（</span> <span class="n">整数</span> <span class="p"><span class="n">，primary_key</span></span> <span class="o">=</span> <span class="bp">真</span> <span class="p"><span class="n">）city_id</span></span> <span class="o">=</span> <span class="n">柱</span> <span class="n"><span class="p">（ForeignKey</span>的</span> <span class="p">（</span> <span class="s"><span class="p">'city.city_id'））</span></span> <span class="n">月</span> <span class="o">=</span> <span class="n">柱</span> <span class="p">（</span> <span class="n">字符串</span> <span class="p"><span class="n">）average_humidity</span></span> <span class="o">=</span> <span class="n">柱</span> <span class="p">（</span> <span class="n">整数</span> <span class="p">）</span> <span class="n">average_temperature</span> <span class="o">=</span> <span class="n">列</span> <span class="p">（</span> <span class="n">浮点</span> <span class="p">）</span></code></div>                                <p id="d896bdab">不要手动为代码片段添加import语句，而是应用建议的<a href="intention-actions.html">快速修复</a> ：只需单击灯泡图标（或按<kbd data-primary_default="Alt+Enter" data-primary_default_for_gnome="Alt+Enter" data-primary_default_for_kde="Alt+Enter" data-primary_default_for_xwin="Alt+Enter" data-primary_emacs="Alt+Enter" data-primary_visual_studio="Alt+Enter" data-primary_netbeans="Alt+Enter" data-primary_eclipse="Alt+Enter" data-secondary_mac_os_x_10.5_="⌥⏎" data-secondary_mac_os_x="⌥⏎" data-secondary_eclipse_mac_os_x="⌘1" data-secondary_intellij_idea_classic_os_x="N/A" data-secondary_xcode="N/A" data-secondary_visual_studio="⌥⏎" data-secondary_resharper="N/A" data-secondary_resharper_osx="N/A" data-secondary_emacs="⌥⏎">Alt + Enter</kbd> ）。</p><figure><img alt="为缺少的import语句应用快速修复" title="为缺少的import语句应用快速修复" src="../img/idea/2019.1/py_flask_meteo_import.png" id="1d5b7684" width="587" height="292"></figure>            </li><li class="list__item" id="6097fbd0">                <p id="39ae02e9">现在您已经定义了表及其关系，添加以下函数以从数据库中检索数据：</p>                <div class="code-block" data-lang="Python"><code class="code-block__wrapper"><span class="c">＃从数据库中检索数据</span> <span class="k">def</span> <span class="nf">get_cities</span> <span class="p">（）：</span> <span class="k">return</span> <span class="n">db_session</span> <span class="o">。</span> <span class="n">query</span> <span class="p">（</span> <span class="n">City</span> <span class="p">）</span> <span class="c">＃生成特定城市的平均温度值集</span> <span class="k">def</span> <span class="nf">get_city_temperature</span> <span class="p">（</span> <span class="n">city</span> <span class="p">）：</span> <span class="k">return</span> <span class="p">[</span> <span class="n">month</span> <span class="o">。</span> <span class="ow">在</span> <span class="n">城市</span> <span class="n">average_temperature</span> <span class="k">为</span> <span class="n">一个月</span> <span class="o">。</span> <span class="n">city_meteo_data</span> <span class="p">]</span> <span class="c">＃生成特定城市的平均湿度值集</span> <span class="k">def</span> <span class="nf">get_city_humidity</span> <span class="p">（</span> <span class="n">city</span> <span class="p">）：</span> <span class="k">return</span> <span class="p">[</span> <span class="n">month</span> <span class="o">。</span> <span class="n">average_humidity</span> <span class="k">为</span> <span class="n"><span class="ow">一个月</span></span> <span class="n">的城市</span> <span class="o">。</span> <span class="n">city_meteo_data</span> <span class="p">]</span> <span class="n">data</span> <span class="o">=</span> <span class="n">get_cities</span> <span class="p">（）</span> <span class="n">MONTHS</span> <span class="o">=</span> <span class="p">[</span> <span class="n">记录</span> <span class="o">。</span> <span class="n"><span class="k">每月</span></span> <span class="ow">在</span> <span class="n">数据</span> <span class="n">记录</span> <span class="p"><span class="mi"><span class="p"><span class="o">[0]。</span></span></span></span> <span class="n">city_meteo_data</span> <span class="p">]</span> <span class="n">CITIES</span> <span class="o">=</span> <span class="p">[</span> <span class="n">city</span> <span class="o">。</span> <span class="n">CITY_NAME</span> <span class="k"><span class="n">城市</span></span> <span class="ow"><span class="n">数据</span></span> <span class="p">]</span></code></div>            </li></ol><aside class="note " rel="6097fbd0" id="18106ec8" data-title=""><p id="ced66fa1">请参阅项目存储库中<a href="https://github.com/allaredko/flask-tutorial-demo/blob/master/user_database.py" data-bypass="yes" target="_blank"><span>user_database.py</span></a>文件的完整代码。</p></aside></section>    </div>    <div class="chapter"><h2 id="scatter_chart" data-toc="Creating_Web_Application_with_Flask#scatter_chart">绘制散点图</h2>        <p id="618eeef8">您已准备好检索数据并构建第一个图表 - 每个城市的年平均温度和湿度的散点图。使用<a href="https://matplotlib.org/" data-bypass="yes" target="_blank"><span>matplotlib</span></a>库设置图形并分配值。</p>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="94f3e34a">            <p id="5d1defe4"><a href="creating-and-running-your-first-python-project.html#create-file">创建另一个Python文件</a> <span class="filepath">charts.py</span> ，并粘贴以下代码片段：</p>            <div class="code-block" data-lang="Python"><code class="code-block__wrapper"><span class="kn">进口</span> <span class="nn">matplotlib.pyplot</span> <span class="kn"><span class="kn">从</span></span> <span class="nn">user_database</span> <span class="kn">导入</span> <span class="n">数据</span> <span class="nn"><span class="p"><span class="n"><span class="p"><span class="n"><span class="p">，get_city_temperature，get_city_humidity，PLT</span></span></span></span></span></span> <span class="n">市</span> <span class="n">yearly_temp</span> <span class="o">=</span> <span class="p">[]</span> <span class="n">yearly_hum</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">对于</span> <span class="n">城市</span> <span class="ow">中</span> <span class="n">的数据</span> <span class="p"><span class="n"><span class="o">：yearly_temp。</span></span></span> <span class="n">追加</span> <span class="p">（</span> <span class="nb">sum</span> <span class="p">（</span> <span class="n">get_city_temperature</span> <span class="p">（</span> <span class="n">city</span> <span class="p">））</span> <span class="o">/</span> <span class="mi">12</span> <span class="p">）</span> <span class="n">annual_hum</span> <span class="o">。</span> <span class="n">追加</span> <span class="p">（</span> <span class="nb">sum</span> <span class="p">（</span> <span class="n">get_city_humidity</span> <span class="p">（</span> <span class="n">city</span> <span class="p">））</span> <span class="o">/</span> <span class="mi">12</span> <span class="p">）</span> <span class="n">plt</span> <span class="o">。</span> <span class="n">clf</span> <span class="p">（）</span> <span class="n">plt</span> <span class="o">。</span> <span class="n">scatter</span> <span class="p">（</span> <span class="n">annual_hum</span> <span class="p">，</span> <span class="n">annual_temp</span> <span class="p">，</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="p">）</span> <span class="n">plt</span> <span class="o">。</span> <span class="n">标题</span> <span class="p">（</span> <span class="s">'年平均温度/湿度'</span> <span class="p">）</span> <span class="n">plt</span> <span class="o">。</span> <span class="n"><span class="p"><span class="mi"><span class="p"><span class="mi"><span class="p"><span class="n"><span class="o">XLIM（70，95）PLT。</span></span></span></span></span></span></span></span> <span class="n">ylabel</span> <span class="p">（</span> <span class="s">'年平均温度'</span> <span class="p">）</span> <span class="n">plt</span> <span class="o">。</span> <span class="n"><span class="p">xlabel（</span></span> <span class="s">'年平均相对湿度<span class="k"><span class="p">'），</span></span></span> <span class="k">其中</span> <span class="n"><span class="p">i，</span></span> <span class="ow">在</span> <span class="nb">枚举</span> <span class="p">（</span> <span class="n">市</span> <span class="n"><span class="p">）txt</span>中</span> <span class="p"><span class="n"><span class="o">：PLT。</span></span></span> <span class="n">annotate</span> <span class="p">（</span> <span class="n">txt</span> <span class="p">，</span> <span class="p">（</span> <span class="n">annual_hum</span> <span class="p">[</span> <span class="n">i</span> <span class="p">]，</span> <span class="n">annual_temp</span> <span class="p">[</span> <span class="n">i</span> <span class="p">]））</span> <span class="n">plt</span> <span class="o">。</span> <span class="n">show</span> <span class="p">（）</span></code></div>            </li><li class="list__item" id="867d221e"><p>预览图表的最快方法是使用<kbd data-primary_default="Shift+F10" data-primary_default_for_gnome="Shift+F10" data-primary_default_for_kde="Shift+F10" data-primary_default_for_xwin="Shift+F10" data-primary_emacs="Shift+F10" data-primary_visual_studio="Ctrl+F5" data-primary_netbeans="F6" data-primary_eclipse="Shift+Alt+X" data-secondary_mac_os_x_10.5_="⌃R" data-secondary_mac_os_x="⇧F10" data-secondary_eclipse_mac_os_x="⇧⌘F11" data-secondary_intellij_idea_classic_os_x="N/A" data-secondary_xcode="N/A" data-secondary_visual_studio="⌃F5" data-secondary_resharper="N/A" data-secondary_resharper_osx="N/A" data-secondary_emacs="⇧F10">Shift + F10</kbd>快捷键。PyCharm在<span class="control">SciView</span>工具窗口中渲染散点图。您可以使用“ <span class="control">图”</span>选项卡预览生成的图形。</p><figure><img alt="预览散点图" title="预览散点图" src="../img/idea/2019.1/py_flask_meteo_scatter_chart.png" id="e74066c4" width="800" height="877"></figure>            </li><li class="list__item" id="374767a6">                <p id="601b8811">现在将图表保存到图像中，以便将其添加到应用程序的主页面。将<code class="code">plt.show()</code>替换为使用<code class="code">savefig(img)</code>函数的片段：</p>                <div class="code-block" data-lang="Python"><code class="code-block__wrapper"><span class="kn">从</span> <span class="nn">IO</span> <span class="kn">进口</span> <span class="n">BytesIO</span> <span class="kn">进口</span> <span class="nn">matplotlib.pyplot</span> <span class="kn"><span class="kn">从</span></span> <span class="nn">user_database</span> <span class="kn">导入</span> <span class="n">数据</span> <span class="p">，</span> <span class="n">几个月</span> <span class="p"><span class="n"><span class="p"><span class="n">，get_city_temperature，get_city_humidity</span></span></span></span> <span class="nn"><span class="p">PLT，</span></span> <span class="n">城市</span> <span class="k">DEF</span> <span class="p"><span class="nf">get_main_image（）：</span></span> <span class="sd"><span class="p">“”</span> “渲染散点图” “”</span> <span class="n">yearly_temp</span> <span class="o">=</span> <span class="p">[]</span> <span class="n">yearly_hum</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">对于</span> <span class="n">城市</span> <span class="ow">中</span> <span class="n">的数据</span> <span class="p">：</span> <span class="n">annual_temp</span> <span class="o">。</span> <span class="n">追加</span> <span class="p">（</span> <span class="nb">sum</span> <span class="p">（</span> <span class="n">get_city_temperature</span> <span class="p">（</span> <span class="n">city</span> <span class="p">））</span> <span class="o">/</span> <span class="mi">12</span> <span class="p">）</span> <span class="n">annual_hum</span> <span class="o">。</span> <span class="n">追加</span> <span class="p">（</span> <span class="nb">sum</span> <span class="p">（</span> <span class="n">get_city_humidity</span> <span class="p">（</span> <span class="n">city</span> <span class="p">））</span> <span class="o">/</span> <span class="mi">12</span> <span class="p">）</span> <span class="n">plt</span> <span class="o">。</span> <span class="n">clf</span> <span class="p">（）</span> <span class="n">plt</span> <span class="o">。</span> <span class="n">scatter</span> <span class="p">（</span> <span class="n">annual_hum</span> <span class="p">，</span> <span class="n">annual_temp</span> <span class="p">，</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="p">）</span> <span class="n">plt</span> <span class="o">。</span> <span class="n">标题</span> <span class="p">（</span> <span class="s">'年平均温度/湿度'</span> <span class="p">）</span> <span class="n">plt</span> <span class="o">。</span> <span class="n"><span class="p"><span class="mi"><span class="p"><span class="mi"><span class="p"><span class="n"><span class="o">XLIM（70，95）PLT。</span></span></span></span></span></span></span></span> <span class="n">ylabel</span> <span class="p">（</span> <span class="s">'年平均温度'</span> <span class="p">）</span> <span class="n">plt</span> <span class="o">。</span> <span class="n"><span class="p">xlabel（</span></span> <span class="s">'年平均相对湿度<span class="k"><span class="p">'），</span></span></span> <span class="k">其中</span> <span class="n"><span class="p">i，</span></span> <span class="ow">在</span> <span class="nb">枚举</span> <span class="p">（</span> <span class="n">市</span> <span class="n"><span class="p">）txt</span>中</span> <span class="p"><span class="n"><span class="o">：PLT。</span></span></span> <span class="n">annotate</span> <span class="p">（</span> <span class="n">txt</span> <span class="p">，</span> <span class="p">（</span> <span class="n">annual_hum</span> <span class="p">[</span> <span class="n">i</span> <span class="p">]，</span> <span class="n">annual_temp</span> <span class="p">[</span> <span class="n">i</span> <span class="p">]））</span> <span class="n">img</span> <span class="o">=</span> <span class="n">BytesIO</span> <span class="p">（）</span> <span class="n">plt</span> <span class="o">。</span> <span class="n">savefig</span> <span class="p">（</span> <span class="n">img</span> <span class="p">）</span> <span class="n">img</span> <span class="o">。</span> <span class="n">寻求</span> <span class="p">（</span> <span class="mi">0</span> <span class="p">）</span> <span class="k">返回</span> <span class="n">img</span></code></div>            </li></ol></section>    </div>    <div class="chapter"><h2 id="main" data-toc="Creating_Web_Application_with_Flask#main">创建主页面</h2>        <p id="e5adfe8d">设置应用程序的主页面并为散点图创建视图。</p>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="a136871a">        <p id="04bc3f68">使用以下代码替换<span class="filepath">app.py</span>文件中的<code class="code">app.route()</code>代码片段：</p>        <div class="code-block" data-lang="Python"><code class="code-block__wrapper"><span class="nd">@ <span class="p">app.route（</span></span> <span class="s"><span class="p"><span class="k">'/'）DEF</span></span></span> <span class="nf">主</span> <span class="p">（）：</span> <span class="sd"><span class="p">“”，</span> “入口点;用于主网页的视图” “”</span> <span class="n">城市</span> <span class="o">=</span> <span class="p">[（</span> <span class="n">记录</span> <span class="n"><span class="p">city_id，</span></span> <span class="n">记录</span> <span class="o"><span class="o"><span class="n"><span class="p">CITY_NAME。），</span></span></span></span> <span class="k">用于</span> <span class="ow">在</span> <span class="n">数据</span> <span class="n">记录</span> <span class="p">]</span> <span class="k">返回</span> <span class="s"><span class="n"><span class="p">render_template（'</span></span> main.html'</span> <span class="p">，</span> <span class="n">cities</span> <span class="o">=</span> <span class="n">cities</span> <span class="p">）</span> <span class="nd">@ app.route</span> <span class="p">（</span> <span class="s">'/ main.png'</span> <span class="p">）</span> <span class="k">def</span> <span class="nf">main_plot</span> <span class="p">（）：</span> <span class="sd">“”“渲染散点图的视图”“”</span> <span class="n">img</span> <span class="o">=</span> <span class="n">get_main_image</span> <span class="p">（）</span> <span class="k">返回</span> <span class="n">send_file</span> <span class="p">（</span> <span class="n">img</span> <span class="p">，</span> <span class="n">mimetype</span> <span class="o">=</span> <span class="s">'image / png'</span> <span class="p">，</span> <span class="n">cache_timeout</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">）</span></code></div>        </li><li class="list__item" id="5354ee8e"><p id="af70ceb6">应用建议的快速修复程序以添加缺少的导入语句。</p>        </li><li class="list__item" id="038a352f">            <p id="ed0c4436">请注意，PyCharm会突出显示<span class="filepath">main.html，</span>因为您尚未创建此文件。</p><figure><img alt="代码检查" title="代码检查" src="../img/idea/2019.1/py_flask_meteo_code_inspection.png" id="4706632e" width="489" height="245"></figure>            <p id="423d536b">使用PyCharm意图操作，您可以快速创建缺少的模板文件。按<kbd data-primary_default="Alt+Enter" data-primary_default_for_gnome="Alt+Enter" data-primary_default_for_kde="Alt+Enter" data-primary_default_for_xwin="Alt+Enter" data-primary_emacs="Alt+Enter" data-primary_visual_studio="Alt+Enter" data-primary_netbeans="Alt+Enter" data-primary_eclipse="Alt+Enter" data-secondary_mac_os_x_10.5_="⌥⏎" data-secondary_mac_os_x="⌥⏎" data-secondary_eclipse_mac_os_x="⌘1" data-secondary_intellij_idea_classic_os_x="N/A" data-secondary_xcode="N/A" data-secondary_visual_studio="⌥⏎" data-secondary_resharper="N/A" data-secondary_resharper_osx="N/A" data-secondary_emacs="⌥⏎">Alt + Enter</kbd>并从上下文菜单中选择<span class="control">Create template main.html</span> 。确认模板文件的名称和位置，然后单击“ <span class="control">确定”</span> 。结果， <span class="filepath">main.html</span>将被添加到<span class="filepath">templates</span>目录中。打开新添加的文件并将以下代码粘贴到其中：</p>            <div class="code-block" data-lang="HTML"><code class="code-block__wrapper"><span class="cp">&lt;！DOCTYPE html&gt;</span> <span class="nt">&lt;html</span> <span class="na">lang =</span> <span class="s">“en”</span> <span class="nt">&gt;</span> <span class="nt">&lt;head&gt;</span> <span class="nt">&lt;meta</span> <span class="na">charset =</span> <span class="s">“UTF-8”</span> <span class="nt">&gt;</span> <span class="nt">&lt;link</span> <span class="na">href =</span> <span class="s">“../static/style.css”</span> <span class="na">rel =</span> <span class="s">“stylesheet”</span> <span class="na">type =</span> <span class="s">“text / css”</span> <span class="nt">&gt;</span> <span class="nt">&lt;title&gt;</span>典型气候<span class="nt">&lt;/ title&gt;</span> <span class="nt">&lt;/ head&gt;</span> <span class="nt">&lt;body&gt;</span> <span class="nt">&lt;div</span> <span class="na">id =</span> <span class="s">“element1”</span> <span class="nt">&gt;</span> <span class="nt">&lt;img</span> <span class="na">src =</span> <span class="s">“{{url_for（'main_plot'）}}”</span> <span class="na">alt =</span> <span class="s">“Image”</span> <span class="nt">&gt;</span> <span class="nt">&lt;/ div &gt;</span> <span class="nt">&lt;div</span> <span class="na">id =</span> <span class="s">“element2”</span> <span class="nt">&gt;</span> <span class="nt">&lt;p&gt;</span>哪个城市的气候最好？<span class="nt">&lt;/ p&gt;</span> <span class="nt">&lt;p&gt;</span>在计划旅行或度假时，您经常检查天气数据的湿度和温度。 <span class="nt">&lt;/ p&gt;</span> <span class="nt">&lt;p&gt;</span>下面是每年平均值的以下城市集合<span class="nt">：&lt;/ p&gt;</span> <span class="nt">&lt;UL&gt;</span> {％为city_id，CITY_NAME在城市％} <span class="nt">&lt;LI&gt; &lt;a</span> <span class="na">href=</span> <span class="s"><span class="nt">""&gt;</span></span> {{ city_name}} <span class="nt">&lt;/a&gt; &lt;/ li&gt;</span> {％endfor％} <span class="nt">&lt;/ ul&gt;</span> <span class="nt">&lt;/ div&gt;</span> <span class="nt">&lt;/ body&gt;</span> <span class="nt">&lt;/ html&gt;</span></code></div>            <p id="c8c04c5f">请注意，此片段中的<code class="code">{{ city_name }}</code>是一个<a href="http://jinja.pocoo.org/" data-bypass="yes" target="_blank"><span>Jinja2</span></a>模板变量，用于将<code class="code">city_name</code> Python变量传递给HTML模板。</p>        </li><li class="list__item" id="ec016a8d">            <p id="e5887d58">还可以创建样式表，为应用程序中的所有HTML页面设置字体和布局设置。右键单击<span class="control">静态</span>目录，然后选择<span class="menupath" data-skip-index="skip">New |样式表</span> ，然后指定<code class="code">.css</code>文件的名称， <span class="filepath">style.css</span> ，并粘贴以下样式定义：</p>            <div class="code-block" data-lang="CSS"><code class="code-block__wrapper"><span class="nt">body</span> <span class="p">{</span> <span class="k">font-family</span> <span class="o">：</span> <span class="s2">“Helvetica Neue”</span> <span class="o">，</span> <span class="n">Helvetica</span> <span class="o">，</span> <span class="n">Arial</span> <span class="o">，</span> <span class="k">sans-serif</span> <span class="p">;</span> <span class="p">}</span> <span class="nf">＃element1</span> <span class="p">{</span> <span class="k">display</span> <span class="o">：</span> <span class="k">inline</span> <span class="o">-</span> <span class="k">block</span> <span class="p">;</span> <span class="p">}</span> <span class="nf">＃element2</span> <span class="p">{</span> <span class="k">display</span> <span class="o">：</span> <span class="k">inline</span> <span class="o">-</span> <span class="k">block</span> <span class="p">;</span> <span class="k">vertical-align</span> <span class="o">：</span> <span class="k">top</span> <span class="p">;</span> <span class="k">margin-top</span> <span class="o">：</span> <span class="m">90px</span> <span class="p">;</span> <span class="n">对齐</span> <span class="o">：</span> <span class="k">左</span> <span class="p">;</span> <span class="k">宽度</span> <span class="o">：</span> <span class="m">25％</span> <span class="p">;</span> <span class="p">}</span></code></div>            <aside class="note " rel="e98b100a" id="025374e5" data-title=""><p id="0a7557d2">PyCharm将自动完成项目HTML文件中使用的标识符，例如<code class="code">#element1</code> 。</p></aside>        </li><li class="list__item" id="838aebab">            <p id="0c5367ab">当您第一次运行应用程序时，PyCharm会自动生成运行/调试配置。您可以在任何时候想要评估结果时使用它来运行修改后的应用程序。</p><figure><img alt="运行/调试配置" title="运行/调试配置" src="../img/idea/2019.1/py_flask_meteo_run_debug_configuration.png" id="0d44b3da" width="282" height="53"></figure>                        <p id="bd3bf753">点击<img class="inline-icon-16" src="../img/idea/2019.1/artwork.studio.icons.avd.run@2x.png" width="16" alt="运行按钮">并按照“ <span class="control">运行”</span>工具窗口中的<span class="filepath">http://127.0.0.1:5000/</span>链接进行操作。您应该会看到以下页面：</p><figure><img alt="MeteoMaster应用程序的主页面" title="MeteoMaster应用程序的主页面" src="../img/idea/2019.1/py_flask_meteo_main_page.png" id="3f52dbbc" width="700" height="569"></figure>                        <aside class="note " rel="bd3bf753" id="edbb7b29" data-title=""><p id="5f091972">您可以在任何代码更改时不断重新运行您的应用程序。单击可用配置列表，然后选择“ <span class="control">编辑配置”</span> 。在<a href="run-debug-configuration-flask-server.html">Flask Run / Debug配置</a>对话框中，选择<span class="control">FLASK_DEBUG</span>复选框。启用此模式后，每次保存代码更改时，PyCharm将重新启动正在运行的应用程序（ <kbd data-primary_default="Ctrl+S" data-primary_default_for_gnome="Ctrl+S" data-primary_default_for_kde="Ctrl+S" data-primary_default_for_xwin="Ctrl+S" data-primary_emacs="Ctrl+X, Ctrl+S" data-primary_visual_studio="Ctrl+S" data-primary_netbeans="Ctrl+S" data-primary_eclipse="Ctrl+S" data-secondary_mac_os_x_10.5_="⌘S" data-secondary_mac_os_x="⌘S" data-secondary_eclipse_mac_os_x="⌘S" data-secondary_intellij_idea_classic_os_x="N/A" data-secondary_xcode="N/A" data-secondary_visual_studio="⌃S" data-secondary_resharper="N/A" data-secondary_resharper_osx="N/A" data-secondary_emacs="⌃X, ⌃S">Ctrl + S</kbd> ）。</p>            </aside>        </li></ol></section>    </div>    <div class="chapter"><h2 id="line_charts" data-toc="Creating_Web_Application_with_Flask#line_charts">绘制折线图</h2>        <p id="e7826bc6">要向应用程序用户提供有关特定城市气候的详细信息，请使用相关信息呈现折线图。</p>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="ee102a4b"><p id="1d2eb881">通过添加<code class="code">get_city_image</code>函数修改charts.py文件：</p>            <div class="code-block" data-lang="Python"><code class="code-block__wrapper"><span class="k">def</span> <span class="nf">get_city_image</span> <span class="p">（</span> <span class="n">city_id</span> <span class="p">）：</span> <span class="sd">“”“使用城市特定数据渲染折线图”“”</span> <span class="n">city</span> <span class="o">=</span> <span class="n">data</span> <span class="o">。</span> <span class="n">get</span> <span class="p">（</span> <span class="n">city_id</span> <span class="p">）</span> <span class="n">city_temp</span> <span class="o">=</span> <span class="n">get_city_temperature</span> <span class="p">（</span> <span class="n">city</span> <span class="p">）</span> <span class="n">city_hum</span> <span class="o">=</span> <span class="n">get_city_humidity</span> <span class="p">（</span> <span class="n">city</span> <span class="p">）</span> <span class="n">plt</span> <span class="o">。</span> <span class="n">clf</span> <span class="p">（）</span> <span class="n">plt</span> <span class="o">。</span> <span class="n">plot</span> <span class="p">（</span> <span class="n">MONTHS</span> <span class="p">，</span> <span class="n">city_temp</span> <span class="p">，</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'blue'</span> <span class="p">，</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="p">，</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s">' - '</span> <span class="p">）</span> <span class="n">plt</span> <span class="o">。</span> <span class="n">ylabel</span> <span class="p">（</span> <span class="s">'平均每日温度'</span> <span class="p">，</span> <span class="n">颜色</span> <span class="o">=</span> <span class="s">'蓝色'</span> <span class="p">）</span> <span class="n">plt</span> <span class="o">。</span> <span class="n">yticks</span> <span class="p">（</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'blue'</span> <span class="p">）</span> <span class="n">plt</span> <span class="o">。</span> <span class="n">twinx</span> <span class="p">（）</span> <span class="n">plt</span> <span class="o">。</span> <span class="n">plot</span> <span class="p">（</span> <span class="n">MONTHS</span> <span class="p">，</span> <span class="n">city_hum</span> <span class="p">，</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'red'</span> <span class="p">，</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="p">，</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s">' - '</span> <span class="p">）</span> <span class="n">plt</span> <span class="o">。</span> <span class="n">ylabel</span> <span class="p">（</span> <span class="s">'平均相对湿度'</span> <span class="p">，</span> <span class="n">颜色</span> <span class="o">=</span> <span class="s">'红色'</span> <span class="p">）</span> <span class="n">plt</span> <span class="o">。</span> <span class="n">yticks</span> <span class="p">（</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'red'</span> <span class="p">）</span> <span class="n">plt</span> <span class="o">。</span> <span class="n">标题</span> <span class="p">（</span> <span class="n">市</span> <span class="o"><span class="n"><span class="p"><span class="n">，CITY_NAME）IMG</span></span></span></span> <span class="o">=</span> <span class="n"><span class="p"><span class="n"><span class="o">BytesIO（）PLT。</span></span></span></span> <span class="n">savefig</span> <span class="p">（</span> <span class="n">img</span> <span class="p">）</span> <span class="n">img</span> <span class="o">。</span> <span class="n">寻求</span> <span class="p">（</span> <span class="mi">0</span> <span class="p">）</span> <span class="k">返回</span> <span class="n">img</span></code></div>                <p id="e71cf14c">此功能绘制两个线性图表：每个城市的月<span class="keyword">平均每日温度</span>和<span class="keyword">平均相对湿度</span> 。与<code class="code">get_main_image</code>函数类似，它将图表保存在图像中。</p>            </li><li class="list__item" id="d56297f7">                <p id="85b4232f">再创建一个<code class="code">.html</code>文件以显示折线图。</p>                <p id="71b15ffe">右键单击项目根目录中的<span class="control">templates</span>目录，然后选择<span class="menupath" data-skip-index="skip">New | HTML文件</span> ，然后输入<span class="filepath">city.html</span>作为文件名，并将以下代码粘贴到新创建的文件中：</p>            </li><li class="list__item" id="9bd469d0"><p>                    </p><div class="code-block" data-lang="HTML"><code class="code-block__wrapper"><span class="cp">&lt;！DOCTYPE html&gt;</span> <span class="nt">&lt;html</span> <span class="na">lang =</span> <span class="s">“en”</span> <span class="nt">&gt;</span> <span class="nt">&lt;head&gt;</span> <span class="nt">&lt;meta</span> <span class="na">charset =</span> <span class="s">“UTF-8”</span> <span class="nt">&gt;</span> <span class="nt">&lt;link</span> <span class="na">href =</span> <span class="s">“../static/style.css”</span> <span class="na">rel =</span> <span class="s">“stylesheet”</span> <span class="na">type =</span> <span class="s">“text / css”</span> <span class="nt">&gt;</span> <span class="nt">&lt;title&gt;</span> {{city_name}} <span class="nt">&lt;/ title&gt;</span> <span class="nt">&lt;/ head&gt;</span> <span class="nt">&lt;body&gt;</span> <span class="nt">&lt;div</span> <span class="na">id =</span> <span class="s">“element1”</span> <span class="nt">&gt;</span> <span class="nt">&lt;img</span> <span class="na">src =</span> <span class="s">“{{url_for（'city_plot'，city_id = city_id）}}”</span> <span class="na">alt =</span> <span class="s">“Image”</span> <span class="nt">&gt;</span> <span class="nt">&lt;/ div&gt;</span> <span class="nt">&lt;div</span> <span class="na">id =</span> <span class="s">“element2”</span> <span class="nt">&gt;</span> <span class="nt">&lt;p&gt;</span>此图表显示{{city_name}}中的平均日温度和平均相对湿度。 <span class="nt">&lt;/ p&gt;</span> <span class="nt">&lt;p&gt;</span> {{city_climate}} <span class="nt">&lt;/ p&gt;</span> <span class="nt">&lt;HR /&gt;</span> <span class="nt">&lt;p&gt; &lt;a</span> <span class="na">href=</span> <span class="s"><span class="nt">"/"&gt;</span></span>回到主页<span class="nt">&lt;/a&gt; &lt;/ p&gt;</span> <span class="nt">&lt;/ DIV&gt;</span> <span class="nt">&lt;/ body&gt;</span> <span class="nt">&lt;/ html&gt;</span></code></div>                </li><li class="list__item" id="8d48f305">                 <p id="05bad764">剩下的步骤是使用<code class="code">Flask.route</code>函数创建另外两个视图。将以下代码片段添加到<span class="filepath">app.py</span>文件中：</p>                 <div class="code-block" data-lang="Python"><code class="code-block__wrapper"><span class="nd">@ app.route</span> <span class="p">（</span> <span class="s">'/ city / &lt;int：city_id&gt;'</span> <span class="p">）</span> <span class="k">def</span> <span class="nf">city</span> <span class="p">（</span> <span class="n">city_id</span> <span class="p">）：</span> <span class="sd">“”“城市详细信息的视图”“”</span> <span class="n">city_record</span> <span class="o">=</span> <span class="n">数据</span> <span class="o">。</span> <span class="n">得到</span> <span class="p"><span class="n"><span class="p">（city_id）</span></span></span> <span class="k">返回</span> <span class="n"><span class="p">render_template（</span></span> <span class="s"><span class="p"><span class="n">'city.html'，CITY_NAME</span></span></span> <span class="o">=</span> <span class="n"><span class="o"><span class="n"><span class="p"><span class="n">city_record。CITY_NAME，city_id</span></span></span></span></span> <span class="o">=</span> <span class="n"><span class="p"><span class="n">city_id，city_climate</span></span></span> <span class="o">=</span> <span class="nd"><span class="n"><span class="o"><span class="n"><span class="p">city_record。city_climate）@</span></span></span></span> <span class="p">app.route（</span></span> <span class="s"><span class="p">'/city&lt;int:city_id&gt;.png'）</span></span> <span class="k">高清</span> <span class="nf"><span class="p"><span class="n">city_plot（city_id</span></span></span> <span class="p">）：</span> <span class="sd">“”“用于渲染城市特定图表的视图”“”</span> <span class="n">img</span> <span class="o">=</span> <span class="n">get_city_image</span> <span class="p">（</span> <span class="n">city_id</span> <span class="p">）</span> <span class="k">返回</span> <span class="n">send_file</span> <span class="p">（</span> <span class="n">img</span> <span class="p">，</span> <span class="n">mimetype</span> <span class="o">=</span> <span class="s">'image / png'</span> <span class="p">，</span> <span class="n">cache_timeout</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">，）</span></code></div>                 <p id="24e87149">不要忘记使用快速修复（ <kbd data-primary_default="Alt+Enter" data-primary_default_for_gnome="Alt+Enter" data-primary_default_for_kde="Alt+Enter" data-primary_default_for_xwin="Alt+Enter" data-primary_emacs="Alt+Enter" data-primary_visual_studio="Alt+Enter" data-primary_netbeans="Alt+Enter" data-primary_eclipse="Alt+Enter" data-secondary_mac_os_x_10.5_="⌥⏎" data-secondary_mac_os_x="⌥⏎" data-secondary_eclipse_mac_os_x="⌘1" data-secondary_intellij_idea_classic_os_x="N/A" data-secondary_xcode="N/A" data-secondary_visual_studio="⌥⏎" data-secondary_resharper="N/A" data-secondary_resharper_osx="N/A" data-secondary_emacs="⌥⏎">Alt + Enter</kbd> ）添加缺少的导入语句。</p>             </li><li class="list__item" id="13d0a2b5">                 <p id="9b939128">现在修改<span class="filepath">main.html</span>文件以填充城市列表，其中包含指向相应<span class="filepath">城市/ *</span>页面的链接。将<code class="code">&lt;li&gt;&lt;a href=""&gt;{{ city_name }}&lt;/a&gt;&lt;/li&gt;</code>替换为<code class="code">&lt;li&gt;&lt;a href="{{ url_for('city', city_id=city_id) }}"&gt;{{ city_name }}&lt;/a&gt;&lt;/li&gt;</code> <code class="code">&lt;li&gt;&lt;a href=""&gt;{{ city_name }}&lt;/a&gt;&lt;/li&gt;</code> <code class="code">&lt;li&gt;&lt;a href="{{ url_for('city', city_id=city_id) }}"&gt;{{ city_name }}&lt;/a&gt;&lt;/li&gt;</code> 。</p>             </li></ol><p id="dcfefde2">重新运行Run / Debug配置以重新启动应用程序，然后单击指向Paris的链接。你应该期望导航到<span class="filepath">city / 2</span>页面。</p><figure><img alt="巴黎的详细天气信息" title="巴黎的详细天气信息" src="../img/idea/2019.1/py_flask_meteo_line_chart.png" id="67fdaf1e" width="800" height="829"></figure></section>    </div>    <div class="chapter"><h2 id="login" data-toc="Creating_Web_Application_with_Flask#login">创建登录表单</h2>        <p id="4e8440e2">到目前为止，您已经创建了一个功能齐全的应用程序，可以从数据库中检索meteo数据并将其显示为图表。但是，在现实生活中，您通常需要编辑数据。合理地，只允许授权用户进行编辑，因此，让我们创建一个登录表单。</p>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="c5a321a4"><p id="dab85c6d">右键单击项目根目录中的<span class="control">templates</span>目录，然后选择<span class="menupath" data-skip-index="skip">New | HTML文件</span> ，然后输入<span class="filepath">login.html</span>作为文件名，并将以下代码粘贴到新创建的文件中：</p>                <div class="code-block" data-lang="Python"><code class="code-block__wrapper"><span class="o">&lt;</span> <span class="err">！</span><span class="n">DOCTYPE</span> <span class="n">html</span> <span class="o">&gt;</span> <span class="o">&lt;</span> <span class="n">html</span> <span class="n">lang</span> <span class="o">=</span> <span class="s">“en”</span> <span class="o">&gt;</span> <span class="o">&lt;</span> <span class="n">head</span> <span class="o">&gt;</span> <span class="o">&lt;</span> <span class="n">meta</span> <span class="n">charset</span> <span class="o">=</span> <span class="s">“UTF-8”</span> <span class="o">&gt;</span> <span class="o">&lt;</span> <span class="n">link</span> <span class="n">rel</span> <span class="o">=</span> <span class="s">“stylesheet”</span> <span class="nb">type</span> <span class="o">=</span> <span class="s">“text / css”</span> <span class="n">href</span> <span class="o">=</span> <span class="s">“../static</span> <span class="s">/</span> <span class="s">style.css”</span> <span class="o">&gt;</span> <span class="o"><span class="n"><span class="o">&lt;TITLE&gt;</span></span></span> <span class="n">登录</span> <span class="n">表格</span> <span class="o">&lt;/</span> <span class="n"><span class="o">TITLE&gt;</span></span> <span class="o">&lt;/</span> <span class="n"><span class="o">HEAD&gt;</span></span> <span class="o"><span class="n"><span class="o">&lt;BODY&gt;</span></span></span> <span class="o"><span class="n"><span class="o">&lt;p&gt;</span></span></span> <span class="n">登录</span> <span class="n"><span class="n">编辑</span></span> <span class="n">的</span> <span class="n">气象</span> <span class="n">数据库</span> <span class="p"><span class="o">：&lt;/</span></span> <span class="n"><span class="o">p&gt;</span></span> <span class="o"><span class="n">&lt;DIV</span></span> <span class="n">类</span> <span class="o">=</span> <span class="s">“容器<span class="o">”&gt;</span></span> <span class="o">&lt;</span> <span class="n">形式</span> <span class="n">行动</span> <span class="o">=</span> <span class="s">“”</span> <span class="n">类</span> <span class="s"><span class="o">=“</span>形状配合inline“</span> <span class="n">method</span> <span class="o">=</span> <span class="s">”post“</span> <span class="o">&gt;</span> <span class="o">&lt;</span> <span class="nb">input</span> <span class="nb">type</span> <span class="o">=</span> <span class="s">”text“</span> <span class="n">class</span> <span class="o">=</span> <span class="s">”form-control“</span> <span class="n">placeholder</span> <span class="o">=</span> <span class="s">”Username“</span> <span class="n">name</span> <span class="o">=</span> <span class="s">”username“</span> <span class="n">value</span> <span class="o">=</span> <span class="s">”{{request.form.username}}“</span> <span class="o">&gt;</span> <span class="o">&lt;</span> <span class="nb">input</span> <span class="nb">type</span> <span class="o">=</span> <span class="s">“password”</span> <span class="n">class</span> <span class="o">=</span> <span class="s">“form-control”</span> <span class="n">placeholder</span> <span class="o">=</span> <span class="s">“Password”</span> <span class="n">name</span> <span class="o">=</span> <span class="s">“password”</span> <span class="n">value</span> <span class="o">=</span> <span class="s">“{{request.form.password}}”</span> <span class="o">&gt;</span> <span class="o">&lt;</span> <span class="nb">input</span> <span class="n">class</span> <span class="o">=</span> <span class="s">“btn btn-default”</span> <span class="nb">type</span> <span class="o">=</span> <span class="s">“submit”</span> <span class="n">value</span> <span class="o">=</span> <span class="s">“登录”</span> <span class="o">&gt;</span> <span class="o">&lt;/</span> <span class="n">form</span> <span class="o">&gt;</span> <span class="o">&lt;</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="p">{{</span> <span class="n">error</span> <span class="p">}}</span> <span class="o">&lt;/</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="o">&lt;/</span> <span class="n">div</span> <span class="o">&gt;</span> <span class="o">&lt;/</span> <span class="n">body</span> <span class="o">&gt;</span> <span class="o">&lt;/</span> <span class="n">html</span> <span class="o">&gt;</span></code></div>                <p id="b42b16ff">此代码使用“ <span class="control">用户名”</span>和“ <span class="control">密码”</span>字段实现典型的登录表单。</p>            </li><li class="list__item" id="e5eb69a5">                <p id="321bb5b1">将以下代码添加到<span class="filepath">app.py</span>文件中，以创建登录表单的Flask视图并控制登录会话。</p>                <div class="code-block" data-lang="Python"><code class="code-block__wrapper"><span class="nd">@ app.route</span> <span class="p">（</span> <span class="s">'/ login / &lt;int：city_id&gt;'</span> <span class="p">，</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span> <span class="s">“GET”</span> <span class="p">，</span> <span class="s">“POST”</span> <span class="p">]）</span> <span class="k">def</span> <span class="nf">login</span> <span class="p">（</span> <span class="n">city_id</span> <span class="p">）：</span> <span class="sd">“”“登录页面的视图”“”</span> <span class="n">city_record</span> <span class="o">=</span> <span class="n">data</span> <span class="o">。</span> <span class="n">get</span> <span class="p">（</span> <span class="n">city_id</span> <span class="p">）</span> <span class="k">try</span> <span class="p">：</span> <span class="n">error</span> <span class="o">=</span> <span class="s">''</span> <span class="k">if</span> <span class="n">request</span> <span class="o">。</span> <span class="n">method</span> <span class="o">==</span> <span class="s">“POST”</span> <span class="p">：</span> <span class="n">attempts_username</span> <span class="o">=</span> <span class="n">request</span> <span class="o">。</span> <span class="n">form</span> <span class="p">[</span> <span class="s">'username'</span> <span class="p">]</span> <span class="n">attempt_password</span> <span class="o">=</span> <span class="n">request</span> <span class="o">。</span> <span class="n">form</span> <span class="p">[</span> <span class="s">'password'</span> <span class="p">]</span> <span class="k">如果</span> <span class="n">attempt_username</span> <span class="o">==</span> <span class="s">'admin'</span> <span class="ow">和</span> <span class="n">attempts_password</span> <span class="o">==</span> <span class="n">os</span> <span class="o">。</span> <span class="n">environ</span> <span class="p">[</span> <span class="s">'USER_PASSWORD'</span> <span class="p">]：</span> <span class="n">session</span> <span class="p">[</span> <span class="s">'logged_in'</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="n">session</span> <span class="p">[</span> <span class="s">'username'</span> <span class="p">]</span> <span class="o">=</span> <span class="n">request</span> <span class="o">。</span> <span class="n">form</span> <span class="p">[</span> <span class="s">'username'</span> <span class="p">]</span> <span class="k">return</span> <span class="n">redirect</span> <span class="p">（</span> <span class="n">url_for</span> <span class="p">（</span> <span class="s">'edit_database'</span> <span class="p">，</span> <span class="n">city_id</span> <span class="o">=</span> <span class="n">city_id</span> <span class="p">））</span> <span class="k">else</span> <span class="p">：</span> <span class="k">print</span> <span class="p">（</span> <span class="s">'invalid credentials'</span> <span class="p">）</span> <span class="n">error</span> <span class="o">=</span> <span class="s">'凭证无效。请再试一次。'</span> <span class="k">返回</span> <span class="n"><span class="p">render_template（</span></span> <span class="s">'的<span class="p">login.html'，</span></span> <span class="n">误差</span> <span class="o">=</span> <span class="n">错误</span> <span class="p"><span class="n">，CITY_NAME</span></span> <span class="o">=</span> <span class="n">city_record</span> <span class="n"><span class="p"><span class="n">CITY_NAME，city_id</span></span></span> <span class="o">=</span> <span class="o"><span class="n"><span class="p">city_id。），</span></span></span> <span class="k">除了</span> <span class="ne">例外</span> <span class="k">为</span> <span class="n"><span class="p">e：</span></span> <span class="k">返回</span> <span class="n"><span class="p">render_template（</span></span> <span class="s">'的<span class="p">login.html'，</span></span> <span class="n">误差</span> <span class="o">=</span> <span class="n"><span class="nb"><span class="p"><span class="p">STR（e）</span></span></span>中</span> <span class="p"><span class="n">，CITY_NAME</span></span> <span class="o">=</span> <span class="n">city_record</span> <span class="n">CITY_NAME</span> <span class="p">，</span> <span class="n">city_id</span> <span class="o">=</span> <span class="n">city_id</span> <span class="p">）</span> <span class="k">def</span> <span class="nf">login_required</span> <span class="p">（</span> <span class="n">f</span> <span class="p">）：</span> <span class="nd">@ wraps</span> <span class="p">（</span> <span class="n">f</span> <span class="p">）</span> <span class="k">def</span> <span class="nf">wrap</span> <span class="p">（</span> <span class="o">*</span> <span class="n">args</span> <span class="p">，</span> <span class="o">**</span> <span class="n">kwargs</span> <span class="p">）：</span> <span class="sd">“”“login session”“”</span> <span class="k">如果</span> <span class="s">'session_in'</span> <span class="ow">在</span> <span class="n">会话中</span> <span class="p">：</span> <span class="k">return</span> <span class="n">f</span> <span class="p">（</span> <span class="o">*</span> <span class="n">args</span> <span class="p">，</span> <span class="o">**</span> <span class="n">kwargs</span> <span class="p">）</span> <span class="k">else</span> <span class="p">：</span> <span class="k">传递</span> <span class="k">return</span> <span class="n">redirect</span> <span class="p">（</span> <span class="n">url_for</span> <span class="p">（</span> <span class="s">'login'</span> <span class="p">））</span> <span class="k">return</span> <span class="n">wrap</span> <span class="n">app</span> <span class="o">。</span> <span class="n">secret_key</span> <span class="o">=</span> <span class="n">os</span> <span class="o">。</span> <span class="n">环境</span> <span class="p">[</span> <span class="s">'FLASK_WEB_APP_KEY'</span> <span class="p">]</span></code></div>                <p id="4e91402d">使用<kbd data-primary_default="Alt+Enter" data-primary_default_for_gnome="Alt+Enter" data-primary_default_for_kde="Alt+Enter" data-primary_default_for_xwin="Alt+Enter" data-primary_emacs="Alt+Enter" data-primary_visual_studio="Alt+Enter" data-primary_netbeans="Alt+Enter" data-primary_eclipse="Alt+Enter" data-secondary_mac_os_x_10.5_="⌥⏎" data-secondary_mac_os_x="⌥⏎" data-secondary_eclipse_mac_os_x="⌘1" data-secondary_intellij_idea_classic_os_x="N/A" data-secondary_xcode="N/A" data-secondary_visual_studio="⌥⏎" data-secondary_resharper="N/A" data-secondary_resharper_osx="N/A" data-secondary_emacs="⌥⏎">Alt + Enter</kbd>快捷键添加缺少的导入语句。请注意，此代码片段引入了两个环境变量： <code class="code">USER_PASSWORD</code>和<code class="code">FLASK_WEB_APP_KEY</code> 。</p>            </li><li class="list__item" id="f1677ede">                <p id="0d92241e">您可以在<span class="control">MeteoMaster</span>运行/调试配置中记录新创建的环境变量的值，因为这是存储安全敏感信息比在<span class="filepath">app.py</span>文件中对其进行硬编码更安全的方式。</p>                <p id="8a52404d">转到编辑器右上角的“运行/调试配置”列表，然后选择“ <span class="filepath">编辑配置”</span> 。点击<img class="inline-icon-16" src="../img/idea/2019.1/icons.actions.menu-open_dark.svg@2x.png" width="16" alt="编辑环境变量"> <span class="control">环境变量</span>字段中的图标并添加两个变量。</p>                <figure><img alt="添加环境变量" title="添加环境变量" src="../img/idea/2019.1/py_flask_meteo_env_variables.png" id="d76cdbcd" width="700" height="877"></figure>            </li><li class="list__item" id="2fdba48e">                <p id="a43d79dd">修改<span class="filepath">city.html</span>文件中的<code class="code">&lt;div id="element2"&gt;</code>元素以容纳登录工具：</p>                <div class="code-block" data-lang="Python"><code class="code-block__wrapper"><span class="o"><span class="n"><span class="o">&lt;p&gt;</span></span></span> <span class="n">此</span> <span class="n">图</span> <span class="n">显示</span> <span class="n">意味着</span> <span class="ow">在</span> <span class="n">每日</span> <span class="n">温度</span> <span class="ow">和</span> <span class="n">平均</span> <span class="n">相对</span> <span class="n">湿度</span> <span class="p"><span class="n"><span class="p">{{CITY_NAME}}</span></span></span> <span class="o">&lt;/</span> <span class="n"><span class="o">p&gt;</span></span> <span class="o"><span class="n"><span class="o">&lt;p&gt;</span></span></span> <span class="p"><span class="n"><span class="p">{{city_climate}}</span></span></span> <span class="o">&lt;/</span> <span class="n"><span class="o">P&gt;</span></span> <span class="p"><span class="o">{％</span></span> <span class="k">如果</span> <span class="n">会话</span> <span class="p">[</span> <span class="s"><span class="p"><span class="o"><span class="p">'LOGGED_IN']％}</span></span></span></span> <span class="o"><span class="n"><span class="o">&lt;P&gt;</span></span></span> <span class="n"><span class="n">要</span></span> <span class="n">添加</span> <span class="n">更多</span> <span class="n">的数据</span> <span class="err">？</span><span class="o">&lt;/</span> <span class="n"><span class="o">p&gt;</span></span> <span class="o"><span class="n"><span class="o">&lt;p&gt;</span></span></span> <span class="n">访问</span> <span class="ow">和</span> <span class="o"><span class="n">&lt;A</span></span> <span class="n">HREF</span> <span class="o">=</span> <span class="s">“{{url_for（ 'edit_database'，city_id = <span class="o">city_id）}}”&gt;</span></span> <span class="n">修改</span> <span class="o">&lt;/</span> <span class="n"><span class="o">A&gt;</span></span> <span class="n">的</span> <span class="n">气象</span> <span class="n">数据库</span> <span class="o">。&lt;/</span> <span class="n"><span class="o">P&gt;</span></span> <span class="p"><span class="o">{％</span></span> <span class="k">其他</span> <span class="o"><span class="p">％}</span></span> <span class="o"><span class="n">&lt;P</span></span> <span class="o">&gt;</span> <span class="n"><span class="n">要</span></span> <span class="n">编辑</span> <span class="n">气象</span> <span class="n">数据</span> <span class="err">？</span><span class="o">&lt;/</span> <span class="n"><span class="o">p&gt;</span></span> <span class="o"><span class="n"><span class="o">&lt;p&gt;</span></span></span> <span class="n">请</span> <span class="o"><span class="n">&lt;A</span></span> <span class="n">HREF</span> <span class="o">=</span> <span class="s">“{{url_for（ '登录'，city_id = <span class="o">city_id）}}”&gt;</span></span> <span class="n">登录</span> <span class="o">&lt;/</span> <span class="n"><span class="o">A&gt;</span></span> <span class="n">第一</span> <span class="o">&lt;/</span> <span class="n"><span class="o">P&gt;</span></span> <span class="p"><span class="o"><span class="n"><span class="o"><span class="p">{％ENDIF％}</span></span></span></span></span> <span class="o"><span class="n">&lt;HR</span></span> <span class="o">/&gt;</span> <span class="o">&lt;</span> <span class="o"><span class="n">p&gt;</span> <span class="n">&lt;A</span></span> <span class="n">HREF</span> <span class="o">=</span> <span class="s"><span class="o">“/”&gt;</span></span> <span class="n"><span class="n"><span class="n">回到</span></span></span> <span class="n">主</span> <span class="n">页</span> <span class="o">&lt;/</span> <span class="o"><span class="n">A&gt;</span> &lt;/</span> <span class="n"><span class="o">p&gt;</span></span></code></div>            </li><li class="list__item" id="9f860e88"><p id="2a70fcc1">重新启动应用程序并单击任何城市链接，然后单击“请先登录”句子中的<span class="control">登录</span>链接。您应该会看到登录表单。</p>            <figure><img alt="登录表格" title="登录表格" src="../img/idea/2019.1/py_flask_meteo_login_form.png" id="2f9d2506" width="438" height="277"></figure>            <p id="52b588d0">暂时，此表单无法启用编辑，因为您尚未实现相应的页面。同时，您可以尝试输入任何不正确的密码，以检查是否使用以下消息处理：“凭据无效。请再试一次。”</p></li></ol></section>    </div>    <div class="chapter"><h2 id="edit" data-toc="Creating_Web_Application_with_Flask#edit">编辑数据</h2>        <p id="3d8f82ad">最后剩下的步骤是启用编辑meteo数据。</p>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="a4ff9037"><p id="2b361a9b">右键单击项目根目录中的<span class="control">templates</span>目录，然后选择<span class="menupath" data-skip-index="skip">New | HTML文件</span> ，然后输入<span class="filepath">edit.html</span>作为文件名，并将以下代码粘贴到新创建的文件中：</p>                <div class="code-block" data-lang="HTML"><code class="code-block__wrapper"><span class="cp">&lt;！DOCTYPE html&gt;</span> <span class="nt">&lt;html</span> <span class="na">lang =</span> <span class="s">“en”</span> <span class="nt">&gt;</span> <span class="nt">&lt;head&gt;</span> <span class="nt">&lt;meta</span> <span class="na">charset =</span> <span class="s">“UTF-8”</span> <span class="nt">&gt;</span> <span class="nt">&lt;link</span> <span class="na">rel =</span> <span class="s">“stylesheet”</span> <span class="na">type =</span> <span class="s">“text / css”</span> <span class="na">href =</span> <span class="s">“../static</span> <span class="s">/</span> <span class="s">style.css”</span> <span class="nt">&gt;</span> <span class="nt">&lt;title&gt;</span>编辑{{city_name}}的meteo数据<span class="nt">&lt;/ title&gt;</span> <span class="nt">&lt;/ head&gt;</span> <span class="nt">&lt;body&gt;</span> <span class="nt">&lt;p&gt;根据需要</span>编辑{{city_name}}的数据： <span class="nt">&lt;/ p&gt;</span> <span class="nt">&lt;div</span> <span class="na">class =</span> <span class="s">“container”</span> <span class="nt">&gt;</span> <span class="nt">&lt;form</span> <span class="na">name =</span> <span class="s">“meteoInput”</span> <span class="na">action =</span> <span class="s">“”</span> <span class="na">class =</span> <span class="s">“form-inline”</span> <span class="na">method =</span> <span class="s">“post”</span> <span class="nt">&gt;</span> <span class="nt">&lt;table&gt;</span> <span class="nt">&lt;tr&gt;</span> <span class="nt">&lt;td&gt;</span> Month <span class="nt">&lt;/ td&gt;</span> <span class="nt">&lt;td</span> <span class="na">colspan =</span> <span class="s">“2”</span> <span class="na">align =</span> <span class="s">“center “</span> <span class="nt">&gt;</span>平均温度<span class="nt">&lt;/ td&gt;</span> <span class="nt">&lt;td</span> <span class="na">colspan =</span> <span class="s">”2“</span> <span class="na">align =</span> <span class="s">”center“</span> <span class="nt">&gt;</span>平均湿度<span class="nt">&lt;/ td&gt;</span> <span class="nt">&lt;/ tr&gt;</span> {％月份％}} <span class="nt">&lt;tr&gt;</span> <span class="nt">&lt;td&gt;</span> {{month}} <span class="nt">&lt;/ td&gt;</span> <span class="nt">&lt;td&gt;</span> <span class="nt">&lt;input</span> <span class="na">placeholder =</span> <span class="s">“20”</span> <span class="na">class =</span> <span class="s">“form-control”</span> <span class="na">name =</span> <span class="s">“temperature {{loop.index0}}”</span> <span class="na">value =</span> <span class="s">“{{meteo [0] [loop.index0]}}”</span> <span class="na">type =</span> <span class="s">“range”</span> <span class="na">min =</span> <span class="s">“ -</span> <span class="s">50.0</span> <span class="s">”</span> <span class="na">max =</span> <span class="s">“50.0”</span> <span class="na">step =</span> <span class="s">“0.01”</span> <span class="na">oninput =</span> <span class="s">“temp_output {{loop.index0}}。value = this.value”</span> <span class="nt">&gt;</span> <span class="nt">&lt;/ td&gt;</span> <span class="nt">&lt;td&gt;</span> <span class="nt">&lt;输出</span> <span class="na">名称=</span> <span class="s">“temp_output {{loop.index0}}”</span> <span class="nt">&gt;</span> {{'％0.2f'％meteo [0] [loop.index0] | float}} <span class="nt">&lt;/ output&gt;</span> <span class="nt">&lt;label&gt;</span> C <span class="nt">&lt;/ label&gt;</span> <span class="nt">&lt;/ td&gt;</span> <span class="nt">&lt; td&gt;</span> <span class="nt">&lt;input</span> <span class="na">placeholder =</span> <span class="s">“20”</span> <span class="na">class =</span> <span class="s">“form-control”</span> <span class="na">nam e =</span> <span class="s">“humidity {{loop.index0}}”</span> <span class="na">value =</span> <span class="s">“{{meteo [1] [loop.index0]}}”</span> <span class="na">type =</span> <span class="s">“range”</span> <span class="na">min =</span> <span class="s">“0”</span> <span class="na">max =</span> <span class="s">“100”</span> <span class="na">oninput =</span> <span class="s">“hum_output {{ loop.index0}}。value = this.value“</span> <span class="nt">&gt;</span> <span class="nt">&lt;/ td&gt;</span> <span class="nt">&lt;td&gt;</span> <span class="nt">&lt;output</span> <span class="na">name =</span> <span class="s">”hum_output {{loop.index0}}“</span> <span class="nt">&gt;</span> {{meteo [1] [loop.index0]}} <span class="nt">&lt;/ output&gt;</span> <span class="nt">&lt;label&gt;</span> ％ <span class="nt">&lt;/ label&gt;</span> <span class="nt">&lt;/ td&gt;</span> <span class="nt">&lt;/ tr&gt;</span> {％endfor％} <span class="nt">&lt;/ table&gt;</span> <span class="nt">&lt;input</span> <span class="na">class =</span> <span class="s">“btn btn-default”</span> <span class="na">type =</span> <span class="s">“submit”</span> <span class="na">value =</span> <span class="s">“Save”</span> <span class="nt">&gt;</span> <span class="nt">&lt;/表格&gt;</span> <span class="nt">&lt;p&gt;</span> {{error}} <span class="nt">&lt;/ p&gt;</span> <span class="nt">&lt;/ div&gt;</span> <span class="nt">&lt;/ body&gt;</span> <span class="nt">&lt;/ html&gt;</span></code></div>            <p id="75ae3b35">该片段还利用Jinjia2模板处理输入数据并将其传递给执行数据库提交的Python代码。</p>            </li><li class="list__item" id="77d0e583">                <p id="eb4bb6a3">将另外一个代码片段添加到<span class="filepath">app.py</span>文件中，该文件为编辑页面创建Flask视图，处理输入数据并更新数据库：</p>                <div class="code-block" data-lang="Python"><code class="code-block__wrapper"><span class="nd">@ app.route</span> <span class="p">（</span> <span class="s">'/ edit / &lt;int：city_id&gt;'</span> <span class="p">，</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span> <span class="s">“GET”</span> <span class="p">，</span> <span class="s">“POST”</span> <span class="p">]）</span> <span class="nd">@ logininquired</span> <span class="k">def</span> <span class="nf">edit_database</span> <span class="p">（</span> <span class="n">city_id</span> <span class="p">）：</span> <span class="sd">“”“用于编辑城市特定数据的视图”“”</span> <span class="n">month_temperature</span> <span class="o">=</span> <span class="p">[]</span> <span class="n">month_humidity</span> <span class="o">=</span> <span class="p">[]</span> <span class="n">city_record</span> <span class="o">=</span> <span class="n">数据</span> <span class="o">。</span> <span class="n">get</span> <span class="p">（</span> <span class="n">city_id</span> <span class="p">）</span> <span class="n">meteo</span> <span class="o">=</span> <span class="p">[</span> <span class="n">get_city_temperature</span> <span class="p">（</span> <span class="n">city_record</span> <span class="p">），</span> <span class="n">get_city_humidity</span> <span class="p">（</span> <span class="n">city_record</span> <span class="p">）]</span> <span class="k">尝试</span> <span class="p">：</span> <span class="k">if</span> <span class="n">request</span> <span class="o">。</span> <span class="n">方法</span> <span class="c"><span class="o"><span class="s"><span class="p">==“POST”：＃</span></span></span>获得从表单数据</span> <span class="k">为</span> <span class="n">i</span> <span class="ow">的</span> <span class="nb">范围</span> <span class="c"><span class="p"><span class="mi"><span class="p">（12）：＃</span></span></span>在生产应用程序我们应该验证输入数据</span> <span class="n"><span class="o">month_temperature。</span></span> <span class="n">追加</span> <span class="p">（</span> <span class="nb">浮动</span> <span class="p">（</span> <span class="n">请求</span> <span class="o">。</span> <span class="n">表格</span> <span class="p">[</span> <span class="n">f</span> <span class="s">'温度{i}'</span> <span class="p">]））</span> <span class="n">month_humidity</span> <span class="o">。</span> <span class="n">追加</span> <span class="p"><span class="nb"><span class="p">（INT（</span></span></span> <span class="n">请求</span> <span class="n">形成</span> <span class="p">并<span class="n">[f</span></span> <span class="s">'湿度<span class="c"><span class="o"><span class="p">{I}']）。）＃</span></span></span></span> <span class="c">数据库</span> <span class="k">对于</span> <span class="n">i</span> <span class="c">更新</span> <span class="p">，</span> <span class="n">每月</span> <span class="ow">在</span> <span class="nb">枚举</span> <span class="p"><span class="n">（city_record</span></span> <span class="o"><span class="n"><span class="p">city_meteo_data）：</span></span></span> <span class="n">一个月</span> <span class="o">。</span> <span class="n">average_temperature</span> <span class="o">=</span> <span class="n">month_temperature</span> <span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="n">月</span> <span class="o">。</span> <span class="n">average_humidity</span> <span class="o">=</span> <span class="n">month_humidity</span> <span class="p">[</span> <span class="n">i</span> <span class="p">]</span> <span class="n">db_session</span> <span class="o">。</span> <span class="n">提交</span> <span class="p">（）</span> <span class="k">的返回</span> <span class="n">重定向</span> <span class="p"><span class="n"><span class="p">（url_for（</span></span></span> <span class="s">'主<span class="p"><span class="n">'，city_id</span></span></span> <span class="o">=</span> <span class="n"><span class="p">city_id））</span></span> <span class="k">否则</span> <span class="p">：</span> <span class="k">返回</span> <span class="n"><span class="p">render_template（</span></span> <span class="s"><span class="p"><span class="n"><span class="o">'edit.html'，CITY_NAME</span></span></span></span> <span class="o">=</span> <span class="n">city_record</span> <span class="n"><span class="p"><span class="n">CITY_NAME，city_id</span></span></span> <span class="o">=</span> <span class="n"><span class="p">city_id，</span></span> <span class="n">月</span> <span class="o">=</span> <span class="n">月</span> <span class="p">，</span> <span class="n">气象</span> <span class="o">=</span> <span class="n">气象</span> <span class="p">），</span> <span class="k">除了</span> <span class="ne">异常</span> <span class="k">作为</span> <span class="n">误差</span> <span class="p">：</span> <span class="k">返回</span> <span class="n"><span class="p">render_template（</span></span> <span class="s"><span class="p"><span class="n">'edit.html'，CITY_NAME</span></span></span> <span class="o">=</span> <span class="n">city_record</span> <span class="n"><span class="p"><span class="n">CITY_NAME，city_id</span></span></span> <span class="o">=</span> <span class="n"><span class="p">city_id，</span></span> <span class="n">月</span> <span class="o">=</span> <span class="n">月</span> <span class="p">，</span> <span class="n">气象</span> <span class="o">=</span> <span class="n">气象</span> <span class="p">，</span> <span class="n">错误</span> <span class="o">=</span> <span class="n">错误</span> <span class="o"><span class="p">。）</span></span></code></div>                <p id="d7b52689">不要忘记添加缺少的import语句。请参阅项目存储库中<a href="https://github.com/allaredko/flask-tutorial-demo/blob/master/app.py" data-bypass="yes" target="_blank"><span>app.py</span></a>文件的完整代码。</p>            </li></ol><p id="c76a28b8">完成此步骤后，您已完成创建与数据库交互的基于Flask的应用程序的任务。现在你已经掌控了整个天气。转到并修改任何城市的气象数据，以便更改在图表上突出显示。然后预览更改。</p></section>    </div>- &gt;<div class="last-modified" data-skip-index="skip">最后修改日期：2019年3月28日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="creating-flask-project.html">创建Flask项目</a> <a class="navigation-links__next" href="pyramid.html">金字塔</a></div><section class="seealso" data-skip-index="skip"><div class="seealso__header"><h2>也可以看看</h2></div><div class="seealso__content"><div class="seealso__col" data-skip-index="skip"><h3>概念：</h3><ul class="list"><li class="list__item"><a href="project.html"><span>项目</span></a></li></ul></div></div></section></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="../app/v2/app.js"></script></body></html>