<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 在RHEL 8中开始使用虚拟化</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 在RHEL 8中开始使用虚拟化</h1></div></div></div><p>要<a class="link" href="configuring_and_managing_virtualization/#virtualization-in-rhel-8-an-overview_configuring-and-managing-virtualization">在RHEL 8中</a>开始使用<a class="link" href="configuring_and_managing_virtualization/#virtualization-in-rhel-8-an-overview_configuring-and-managing-virtualization">虚拟化</a> ，请执行以下步骤。默认方法是命令行界面（CLI），但为方便用户，可以<a class="link" href="using-the-rhel-8-web-console-for-managing-vms_configuring-and-managing-virtualization.html" title="Chapter 9. 使用RHEL 8 Web控制台管理虚拟机">在Web控制台GUI中</a>完成一些步骤。</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">启用虚拟化模块并安装虚拟化软件包 - 请参阅<a class="xref" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#enabling-virtualization-in-rhel8_virt-getting-started" title="在RHEL 8中启用虚拟化">“在RHEL 8中启用虚拟化”一节</a> 。
				</li><li class="listitem"><p class="simpara">创建来宾虚拟机：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">对于CLI，请参阅<a class="xref" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#creating-virtual-machines-using-the-command-line-interface_assembly_creating-virtual-machines" title="使用命令行界面创建虚拟机">“使用命令行界面创建虚拟机”一节</a> 。
						</li><li class="listitem">对于GUI，请参阅<a class="xref" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#creating-vms-using-the-rhel-8-web-console_assembly_creating-virtual-machines" title="使用RHEL 8 Web控制台创建虚拟机">“使用RHEL 8 Web控制台创建虚拟机”一节</a> 。
						</li></ul></div></li><li class="listitem"><p class="simpara">启动来宾虚拟机：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">对于CLI，请参阅<a class="xref" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#starting-a-virtual-machine-using-the-command-line-interface_assembly_starting-virtual-machines" title="使用命令行界面启动虚拟机">“使用命令行界面启动虚拟机”一节</a> 。
						</li><li class="listitem">对于GUI，请参阅<a class="xref" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#powering-up-vms-using-the-rhel-8-web-console_assembly_starting-virtual-machines" title="在RHEL 8 Web控制台中启动虚拟机">“在RHEL 8 Web控制台中启动虚拟机”一节</a> 。
						</li></ul></div></li><li class="listitem"><p class="simpara">连接到来宾虚拟机：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">对于CLI，请参阅<a class="xref" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#proc_connecting-to-a-virtual-machine-using-ssh_assembly_connecting-to-virtual-machines" title="使用SSH连接到虚拟机">“使用SSH连接到虚拟机”</a> <a class="xref" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#proc_opening-a-virtual-machine-graphical-console-using-virt-viewer_assembly_connecting-to-virtual-machines" title="Opening a virtual machine graphical console using Virt Viewer">一节</a>或<a class="xref" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#proc_opening-a-virtual-machine-graphical-console-using-virt-viewer_assembly_connecting-to-virtual-machines" title="使用Virt Viewer打开虚拟机图形控制台">“使用Virt Viewer打开虚拟机图形控制台”一节</a> 。
						</li><li class="listitem">对于GUI，请参阅<a class="xref" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#viewing-guest-graphical-console-in-the-rhel-8-web-console_assembly_connecting-to-virtual-machines" title="在RHEL 8 Web控制台中查看虚拟机图形控制台">“在RHEL 8 Web控制台中查看虚拟机图形控制台”一节</a> 。
						</li></ul></div></li></ol></div><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>Web控制台当前仅为虚拟机提供guest虚拟机管理功能的子集，因此建议使用命令行在RHEL 8中高级使用虚拟化。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="enabling-virtualization-in-rhel8_virt-getting-started"></a>在RHEL 8中启用虚拟化</h1></div></div></div><p>要在RHEL 8中使用虚拟化，您必须启用虚拟化模块，安装虚拟化软件包，并确保将系统配置为托管虚拟机。
			</p><h3><a id="prerequisites"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">必须在主机上<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/performing_a_standard_rhel_installation/index">安装并注册</a> Red Hat Enterprise Linux 8。
					</li><li class="listitem"><p class="simpara">您的系统必须满足以下硬件要求才能充当虚拟化主机：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">主机的体系结构<a class="link" href="feature-support-and-limitations-in-rhel8-virtualization_configuring-and-managing-virtualization.html#recommended-features-in-rhel8-virtualization_feature-support-and-limitations-in-rhel8-virtualization" title="RHEL 8虚拟化中的推荐功能">支持KVM虚拟化</a> 。
							</li><li class="listitem"><p class="simpara">可以使用以下系统资源：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">主机的6 GB可用磁盘空间，以及每个目标guest虚拟机的另外6 GB</li><li class="listitem">主机使用2 GB RAM，每个预定客户使用另外2 GB RAM</li></ul></div></li></ul></div></li></ul></div><h3><a id="procedure"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">在虚拟化模块中安装软件包：</p><pre class="literallayout"># <span class="strong"><strong>yum module install virt</strong></span></pre></li><li class="listitem"><p class="simpara">安装<code class="literal">virt-install</code>软件包：</p><pre class="literallayout"># <span class="strong"><strong>yum install virt-install</strong></span></pre></li><li class="listitem"><p class="simpara">验证您的系统是否已准备好成为虚拟化主机：</p><pre class="literallayout"># <span class="strong"><strong>virt-host-validate</strong></span>
[...]
QEMU: Checking for device assignment IOMMU support         : PASS
QEMU: Checking if IOMMU is enabled by kernel               : WARN (IOMMU appears to be disabled in kernel. Add intel_iommu=on to kernel cmdline arguments)
LXC: Checking for Linux &gt;= 2.6.26                          : PASS
[...]
LXC: Checking for cgroup 'blkio' controller mount-point    : PASS
LXC: Checking if device /sys/fs/fuse/connections exists    : FAIL (Load the 'fuse' module to enable /proc/ overrides)</pre></li><li class="listitem"><p class="simpara">如果所有<span class="strong"><strong>virt-host-validate</strong></span>检查都返回<code class="literal">PASS</code>值，则系统已准备好<a class="link" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#assembly_creating-virtual-machines_virt-getting-started" title="创建虚拟机">创建虚拟机</a> 。
					</p><p class="simpara">如果任何检查返回<code class="literal">FAIL</code>值，请按照显示的说明解决问题。
					</p><p class="simpara">如果任何检查返回<code class="literal">WARN</code>值，请考虑按照显示的说明来改进虚拟化功能。
					</p></li></ol></div><h3><a id="additional_information"></a>附加信息</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">请注意，如果主机CPU不支持虚拟化， <span class="strong"><strong>virt-host-validate将</strong></span>生成以下输出：</p><pre class="literallayout">QEMU: Checking for hardware virtualization: FAIL (Only emulated CPUs are available, performance will be significantly limited)</pre><p class="simpara">但是，尝试在此类主机系统上创建虚拟机将失败，而不是出现性能问题。
					</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_creating-virtual-machines_virt-getting-started"></a>创建虚拟机</h1></div></div></div><p>要在RHEL 8中创建虚拟机（VM），请使用<a class="link" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#creating-virtual-machines-using-the-command-line-interface_assembly_creating-virtual-machines" title="使用命令行界面创建虚拟机">命令行界面</a>或<a class="link" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#creating-vms-using-the-rhel-8-web-console_assembly_creating-virtual-machines" title="使用RHEL 8 Web控制台创建虚拟机">RHEL 8 Web控制台</a> 。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="prerequisites-assembly_creating-virtual-machines"></a>先决条件</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">必须在系统上<a class="link" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#enabling-virtualization-in-rhel8_virt-getting-started" title="在RHEL 8中启用虚拟化">安装并启用</a>虚拟化。
						</li><li class="listitem"><p class="simpara">在系统上创建VM之前，请考虑分配给VM所需的系统资源量，例如磁盘空间，RAM或CPU。根据VM的预期任务和工作负载，建议值可能会有很大差异。</p><div class="warning" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">警告</h3><p>在RHEL 8中无法从主机CD-ROM或DVD-ROM设备进行安装。如果在使用RHEL 8中提供的任何VM安装方法时选择CD-ROM或DVD-ROM作为安装源，则安装将失败。有关更多信息，请参阅<a class="link" href="https://access.redhat.com/solutions/1185913">Red Hat知识库</a> 。
							</p></div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-virtual-machines-using-the-command-line-interface_assembly_creating-virtual-machines"></a>使用命令行界面创建虚拟机</h2></div></div></div><p>要使用<code class="literal">virt-install</code>实用程序在RHEL 8主机上创建虚拟机（VM），请按照以下说明操作。
				</p><h4><a id="prerequisites_2"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">操作系统（OS）安装源，可以是以下之一，可以在本地或网络上使用：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">安装介质的ISO映像</li><li class="listitem">现有虚拟机安装的磁盘映像</li></ul></div></li><li class="listitem">或者，还可以提供Kickstart文件，以便更快，更轻松地配置安装。
						</li></ul></div><h4><a id="procedure_2"></a>程序</h4><p>要创建VM并启动其OS安装，请使用<code class="literal">virt-install</code>命令。在其论点中，至少指定：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">新机器的名称</li><li class="listitem">分配的内存量</li><li class="listitem">分配的虚拟CPU数（vCPU）</li><li class="listitem">分配存储的类型和大小</li><li class="listitem">操作系统安装源的类型和位置</li></ul></div><p>根据所选的安装方法，必要的选项和值可能会有所不同。见下面的例子：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">下面创建一个名为<span class="strong"><strong>demo-guest1</strong></span>的VM，它从本地存储在<span class="strong"><strong>/home/username/Downloads/Win10install.iso</strong></span>文件中的ISO映像安装Windows 10操作系统。此VM还分配有2048 MiB的RAM，2个vCPU，以及为VM自动配置的8 GiB qcow2虚拟磁盘。</p><pre class="literallayout"># <span class="strong"><strong>virt-install --name demo-guest1 --memory 2048 --vcpus 2 --disk size=8 --os-variant win10 --cdrom /home/username/Downloads/Win10install.iso</strong></span></pre></li><li class="listitem"><p class="simpara">下面创建一个名为<span class="strong"><strong>demo-guest2</strong></span>的VM，它使用<span class="strong"><strong>/home/username/Downloads/rhel8.iso</strong></span>映像从Live CD运行RHEL 8 OS。没有为此VM分配磁盘空间，因此不会保留在会话期间所做的更改。此外，VM分配有4096 MiB的RAM和4个vCPU。
						</p><pre class="literallayout"># <span class="strong"><strong>virt-install --name demo-guest2 --memory 4096 --vcpus 4 --disk none --livecd --os-variant rhel8.0 --cdrom /home/username/Downloads/rhel8.iso</strong></span></pre></li><li class="listitem"><p class="simpara">以下内容创建名为<span class="strong"><strong>demo-guest3</strong></span>的RHEL 8 VM连接到现有磁盘映像<span class="strong"><strong>/home/username/backup/disk.qcow2</strong></span> 。这类似于在机器之间物理移动硬盘驱动器，因此demo-guest3可用的操作系统和数据取决于之前处理图像的方式。此外，该VM分配有2048 MiB的RAM和2个vCPU。
						</p><pre class="literallayout"># <span class="strong"><strong>virt-install --name demo-guest3 --memory 2048 --vcpus 2 --os-variant rhel8.0 --import --disk /home/username/backup/disk.qcow2</strong></span></pre><p class="simpara">请注意，导入磁盘映像时强烈建议使用<code class="literal">--os-variant</code>选项。如果未提供，则创建的VM的性能将受到负面影响。
						</p></li><li class="listitem"><p class="simpara">以下内容创建了一个名为<span class="strong"><strong>demo-guest4</strong></span>的VM，它可以从<code class="literal"><a class="link" href="http://example.com/OS-install">http://example.com/OS-install</a></code> URL进行安装。要使安装成功启动，URL必须包含正在运行的操作系统安装树。此外，使用<span class="strong"><strong>/home/username/ks.cfg</strong></span> kickstart文件自动配置操作系统。此VM还分配有2048 MiB的RAM，2个vCPU和16 GiB qcow2虚拟磁盘。
						</p><pre class="literallayout"># <span class="strong"><strong>virt-install --name demo-guest4 --memory 2048 --vcpus 2 --disk size=16 --os-variant rhel8.0 --location http://example.com/OS-install --initrd-inject /home/username/ks.cfg --extra-args="ks=file:/ks.cfg console=tty0 console=ttyS0,115200n8"</strong></span></pre></li><li class="listitem"><p class="simpara">下面创建一个名为<span class="strong"><strong>demo-guest5</strong></span>的VM，它以纯文本模式从<code class="literal">RHEL8.iso</code>文件安装，没有图形。它将guest虚拟机控制台连接到串行控制台。VM具有16384 MiB内存，16个vCPU和280 GiB磁盘。通过慢速网络链接连接到主机时，此类安装非常有用。
						</p><pre class="literallayout"># <span class="strong"><strong>virt-install --name demo-guest5 --memory 16384 --vcpus 16 --disk size=280 --os-variant rhel8.0 --location RHEL8.iso --graphics none --extra-args='console=ttyS0'</strong></span></pre></li><li class="listitem"><p class="simpara">下面创建一个名为<span class="strong"><strong>demo-guest6</strong></span>的VM，它与demo-guest5具有相同的配置，但位于10.0.0.1远程主机上。
						</p><pre class="literallayout"># <span class="strong"><strong>virt-install --connect qemu+ssh://root@10.0.0.1/system --name demo-guest6 --memory 16384 --vcpus 16 --disk size=280 --os-variant rhel8.0 --location RHEL8.iso --graphics none --extra-args='console=ttyS0'</strong></span></pre></li></ul></div><p>如果成功创建VM，将打开<a class="link" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#proc_opening-a-virtual-machine-graphical-console-using-virt-viewer_assembly_connecting-to-virtual-machines" title="使用Virt Viewer打开虚拟机图形控制台">virt-viewer</a>窗口，其中包含VM的图形控制台并启动guest虚拟机操作系统安装。
				</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>可以为<span class="strong"><strong>virt-install</strong></span>指定许多其他选项，以进一步配置VM及其操作系统安装。有关详细信息，请参见<span class="strong"><strong>virt-install</strong></span>手册页。
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-vms-using-the-rhel-8-web-console_assembly_creating-virtual-machines"></a>使用RHEL 8 Web控制台创建虚拟机</h2></div></div></div><p>要在连接Web控制台的主机上创建VM，请按照以下说明操作。
				</p><h4><a id="prerequisites_3"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要能够使用RHEL 8 Web控制台管理虚拟机，必须安装Web控制台虚拟机插件。
						</p><p class="simpara">如果未安装Web控制台插件，请参阅<a class="xref" href="using-the-rhel-8-web-console-for-managing-vms_configuring-and-managing-virtualization.html#setting-up-the-rhel-8-web-console-to-manage-vms_using-the-rhel-8-web-console-for-managing-vms" title="设置RHEL 8 Web控制台以管理虚拟机">“设置RHEL 8 Web控制台以管理虚拟机”一节，</a>以获取有关安装Web控制台虚拟机插件的信息。
						</p></li><li class="listitem">在创建VM之前，请考虑分配给VM所需的系统资源量，例如磁盘空间，RAM或CPU。根据VM的预期任务和工作负载，建议值可能会有很大差异。</li><li class="listitem"><p class="simpara">本地可用的操作系统（OS）安装源，可以是以下之一：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">安装介质的ISO映像</li><li class="listitem">现有guest虚拟机安装的磁盘映像</li></ul></div></li></ul></div><h4><a id="procedure_3"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">单击RHEL 8 Web控制台的“虚拟机”界面中的“ <span class="strong"><strong><span class="guibutton">创建VM”</span></strong></span> 。
						</p><p class="simpara">将出现“创建新虚拟机”对话框。
						</p><div class="informalfigure"><div class="mediaobject"><img src="images/cockpit_create_new_vm.png" alt="驾驶舱创造新的vm"></div></div></li><li class="listitem"><p class="simpara">输入要创建的虚拟机的基本配置。
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									<span class="strong"><strong>连接</strong></span> - 与虚拟机使用的主机的连接。
								</li><li class="listitem">
									<span class="strong"><strong>名称</strong></span> - 虚拟机的名称。
								</li><li class="listitem">
									<span class="strong"><strong>安装源类型</strong></span> - <span class="strong"><strong>安装源的类型</strong></span> ：文件系统，URL</li><li class="listitem">
									<span class="strong"><strong>安装源</strong></span> - 指向<span class="strong"><strong>安装源</strong></span>的路径或URL。
								</li><li class="listitem">
									<span class="strong"><strong>OS Vendor</strong></span> - 虚拟机操作系统的供应商。
								</li><li class="listitem">
									<span class="strong"><strong>操作系统</strong></span> - 虚拟机的操作系统。
								</li><li class="listitem">
									<span class="strong"><strong>内存</strong></span> - 配置虚拟机的内存量。
								</li><li class="listitem">
									<span class="strong"><strong>存储大小</strong></span> - 用于配置虚拟机的存储空间量。
								</li><li class="listitem">
									<span class="strong"><strong>立即启动VM</strong></span> - 虚拟机是否在创建后立即启动。
								</li></ul></div></li><li class="listitem"><p class="simpara">单击“ <span class="guibutton">创建”</span>
						</p><p class="simpara">虚拟机已创建。如果选中“ <span class="strong"><strong>立即启动VM”</strong></span>复选框，VM将立即启动并开始安装客户机操作系统。
						</p></li></ol></div><p>您必须在第一次运行虚拟机时安装操作系统。
				</p><h4><a id="additional_resources"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关在虚拟机上安装操作系统的信息，请参阅<a class="xref" href="using-the-rhel-8-web-console-for-managing-vms_configuring-and-managing-virtualization.html#installing-an-os-using-the-rhel-8-web-console_creating-vms-and-installing-an-os-using-the-rhel-8-web-console" title="使用RHEL 8 Web控制台安装操作系统">“使用RHEL 8 Web控制台安装操作系统”一节</a> 。
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_starting-virtual-machines_virt-getting-started"></a>启动虚拟机</h1></div></div></div><p>要在RHEL 8中启动虚拟机（VM），可以使用<a class="link" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#starting-a-virtual-machine-using-the-command-line-interface_assembly_starting-virtual-machines" title="使用命令行界面启动虚拟机">命令行界面</a>或<a class="link" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#powering-up-vms-using-the-rhel-8-web-console_assembly_starting-virtual-machines" title="在RHEL 8 Web控制台中启动虚拟机">Web控制台GUI</a> 。</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="prerequisites-assembly_starting-virtual-machines"></a>先决条件</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">在可以启动VM之前，必须创建它并且理想情况下还要安装OS。有关执行此操作的说明，请参阅<a class="xref" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#assembly_creating-virtual-machines_virt-getting-started" title="创建虚拟机">“创建虚拟机”一节</a> 。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="starting-a-virtual-machine-using-the-command-line-interface_assembly_starting-virtual-machines"></a>使用命令行界面启动虚拟机</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要使用命令行界面启动本地VM，请使用<code class="literal">virsh start</code>命令：</p><pre class="literallayout"><span class="strong"><strong># virsh start demo-guest1</strong></span>
Domain demo-guest1 started</pre></li><li class="listitem"><p class="simpara">如果VM位于远程主机上，请使用QEMU + SSH连接到主机。例如，以下命令启动192.168.123.123主机上的<code class="literal">demo-guest1</code> VM：</p><pre class="literallayout"><span class="strong"><strong># virsh -c qemu+ssh://root@192.168.123.123/system start demo-guest1</strong></span>

root@192.168.123.123's password:
Last login: Mon Feb 18 07:28:55 2019

Domain demo-guest1 started</pre><p class="simpara">请注意，通过<a class="link" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#setting-up-easy-access-to-remote-virtualization-hosts_assembly_connecting-to-virtual-machines" title="设置对远程虚拟化主机的轻松访问">修改libvirt和SSH配置，</a>可以简化在远程主机上管理VM的过程。
						</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="powering-up-vms-using-the-rhel-8-web-console_assembly_starting-virtual-machines"></a>在RHEL 8 Web控制台中启动虚拟机</h2></div></div></div><p>如果VM处于<span class="strong"><strong>关闭</strong></span>状态，您可以使用RHEL 8 Web控制台启动它。
				</p><h4><a id="prerequisites_4"></a>先决条件</h4><p>要能够使用RHEL 8 Web控制台管理虚拟机，必须安装Web控制台虚拟机插件。
				</p><p>如果未安装Web控制台插件，请参阅<a class="xref" href="using-the-rhel-8-web-console-for-managing-vms_configuring-and-managing-virtualization.html#setting-up-the-rhel-8-web-console-to-manage-vms_using-the-rhel-8-web-console-for-managing-vms" title="设置RHEL 8 Web控制台以管理虚拟机">“设置RHEL 8 Web控制台以管理虚拟机”一节，</a>以获取有关安装Web控制台虚拟机插件的信息。
				</p><h4><a id="procedure_4"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem">单击包含要启动的虚拟机名称的行。<br>该行将展开以显示“概述”窗格，其中包含有关所选虚拟机的基本信息以及用于关闭和删除虚拟机的控件。
						</li><li class="listitem">单击<span class="guibutton">运行</span> 。<br>虚拟机启动。
						</li></ol></div><h4><a id="additional_resources_2"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关关闭虚拟机的信息，请参阅<a class="xref" href="using-the-rhel-8-web-console-for-managing-vms_configuring-and-managing-virtualization.html#powering-down-vms-using-the-rhel-8-web-console_powering-up-and-powering-down-vms-using-the-rhel-8-web-console" title="关闭RHEL 8 Web控制台中的虚拟机电源">“在RHEL 8 Web控制台中关闭虚拟机”一节</a> 。
						</li><li class="listitem">有关重新启动虚拟机的信息，请参阅<a class="xref" href="using-the-rhel-8-web-console-for-managing-vms_configuring-and-managing-virtualization.html#restarting-vms-using-the-rhel-8-web-console_powering-up-and-powering-down-vms-using-the-rhel-8-web-console" title="使用RHEL 8 Web控制台重新启动虚拟机">“使用RHEL 8 Web控制台重新启动虚拟机”一节</a> 。
						</li><li class="listitem">有关向虚拟机<a class="xref" href="using-the-rhel-8-web-console-for-managing-vms_configuring-and-managing-virtualization.html#sending-NMIs-to-vms-using-the-rhel-8-web-console_powering-up-and-powering-down-vms-using-the-rhel-8-web-console" title="Sending non-maskable interrupts to VMs using the RHEL 8 web console">发送不可屏蔽中断的信息</a> ，请参阅<a class="xref" href="using-the-rhel-8-web-console-for-managing-vms_configuring-and-managing-virtualization.html#sending-NMIs-to-vms-using-the-rhel-8-web-console_powering-up-and-powering-down-vms-using-the-rhel-8-web-console" title="使用RHEL 8 Web控制台向VM发送不可屏蔽中断">“使用RHEL 8 Web控制台向VM发送不可屏蔽中断”一节</a> 。
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_connecting-to-virtual-machines_virt-getting-started"></a>连接到虚拟机</h1></div></div></div><p>要与RHEL 8中的虚拟机（VM）进行交互，您需要通过执行以下操作之一来连接到它：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">使用RHEL 8 Web控制台界面时，请使用Web控制台界面中的“虚拟机”窗格。有关更多信息，请参阅<a class="xref" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#viewing-guest-graphical-console-in-the-rhel-8-web-console_assembly_connecting-to-virtual-machines" title="在RHEL 8 Web控制台中查看虚拟机图形控制台">“在RHEL 8 Web控制台中查看虚拟机图形控制台”一节</a>
					</li><li class="listitem">如果需要在不使用RHEL 8 Web控制台的情况下与VM图形显示进行交互，请使用Virt Viewer应用程序。有关详细信息，请参阅<a class="xref" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#proc_opening-a-virtual-machine-graphical-console-using-virt-viewer_assembly_connecting-to-virtual-machines" title="使用Virt Viewer打开虚拟机图形控制台">“使用Virt Viewer打开虚拟机图形控制台”一节</a>
					</li><li class="listitem">如果无法或不需要图形显示，请使用<a class="link" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#proc_connecting-to-a-virtual-machine-using-ssh_assembly_connecting-to-virtual-machines" title="使用SSH连接到虚拟机">SSH终端连接</a> 。
					</li><li class="listitem">如果使用网络无法从系统访问虚拟机，请使用<a class="link" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#proc_opening-a-virtual-machine-serial-console_assembly_connecting-to-virtual-machines" title="打开虚拟机串行控制台">virsh控制台</a> 。
					</li></ul></div><p>如果要连接的VM位于远程主机而不是本地VM上，则还可以选择配置系统以便<a class="link" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#setting-up-easy-access-to-remote-virtualization-hosts_assembly_connecting-to-virtual-machines" title="设置对远程虚拟化主机的轻松访问">更方便地访问远程主机</a> 。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="prerequisites-assembly_connecting-to-virtual-machines"></a>先决条件</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">将<a class="link" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#assembly_creating-virtual-machines_virt-getting-started" title="创建虚拟机">安装</a>并<a class="link" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#assembly_starting-virtual-machines_virt-getting-started" title="启动虚拟机">启动</a>要与之交互的VM。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="viewing-guest-graphical-console-in-the-rhel-8-web-console_assembly_connecting-to-virtual-machines"></a>在RHEL 8 Web控制台中查看虚拟机图形控制台</h2></div></div></div><p>您可以在RHEL 8 Web控制台中查看所选虚拟机的图形控制台。虚拟机控制台显示虚拟机的图形输出。
				</p><h4><a id="prerequisites_5"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要能够使用RHEL 8 Web控制台管理虚拟机，必须安装Web控制台虚拟机插件。
						</p><p class="simpara">如果未安装Web控制台插件，请参阅<a class="xref" href="using-the-rhel-8-web-console-for-managing-vms_configuring-and-managing-virtualization.html#setting-up-the-rhel-8-web-console-to-manage-vms_using-the-rhel-8-web-console-for-managing-vms" title="设置RHEL 8 Web控制台以管理虚拟机">“设置RHEL 8 Web控制台以管理虚拟机”一节，</a>以获取有关安装Web控制台虚拟机插件的信息。
						</p></li><li class="listitem">确保主机和VM都支持图形界面。
						</li></ul></div><h4><a id="procedure_5"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem">单击包含要查看其图形控制台的虚拟机名称的行。<br>该行将展开以显示“概述”窗格，其中包含有关所选虚拟机的基本信息以及用于关闭和删除虚拟机的控件。
						</li><li class="listitem">单击<span class="guibutton">控制台</span> 。<br>图形控制台显示在Web界面中。
						</li></ol></div><div class="informalfigure"><div class="mediaobject"><img src="images/cockpit_graphical_console_in_cockpit.png" alt="驾驶舱内的驾驶舱图形控制台"></div></div><p>您可以使用鼠标和键盘与虚拟机控制台进行交互，方式与您与真实机器交互的方式相同。虚拟机控制台中的显示反映了在虚拟机上执行的活动。
				</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>运行RHEL 8 Web控制台的服务器可以拦截特定的组合键，例如<span class="keycap"><strong>Ctrl</strong></span> + <span class="keycap"><strong>Alt</strong></span> + <span class="keycap"><strong>F1</strong></span> ，以防止它们被发送到虚拟机。
					</p><p>要发送此类组合键，请单击<span class="guibutton">发送键</span>菜单，然后选择要发送的键序列。
					</p><p>例如，要将<span class="keycap"><strong>Ctrl</strong></span> + <span class="keycap"><strong>Alt</strong></span> + <span class="keycap"><strong>F1</strong></span>组合发送到虚拟机，请单击<span class="guibutton">发送键</span>菜单，然后选择<span class="guibutton">Ctrl + Alt + F1</span>菜单项。
					</p></div><h4><a id="additional_resources_3"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关在远程查看器中查看图形控制台的详细信息，请参阅<a class="xref" href="using-the-rhel-8-web-console-for-managing-vms_configuring-and-managing-virtualization.html#viewing-vm-consoles-in-remote-viewers-using-the-rhel-8-web-console_viewing-vm-consoles-using-the-rhel-8-web-console" title="使用RHEL 8 Web控制台在远程查看器中查看虚拟机控制台">“使用RHEL 8 Web控制台在远程查看器中查看虚拟机控制台”一节</a> 。
						</li><li class="listitem">有关在RHEL 8 Web控制台中查看串行控制台的详细信息，请参阅<a class="xref" href="using-the-rhel-8-web-console-for-managing-vms_configuring-and-managing-virtualization.html#viewing-vm-serial-console-in-the-rhel-8-web-console_viewing-vm-consoles-using-the-rhel-8-web-console" title="在RHEL 8 Web控制台中查看虚拟机串行控制台">“在RHEL 8 Web控制台中查看虚拟机串行控制台”一节</a> 。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_opening-a-virtual-machine-graphical-console-using-virt-viewer_assembly_connecting-to-virtual-machines"></a>使用Virt Viewer打开虚拟机图形控制台</h2></div></div></div><p>要连接到KVM虚拟机（VM）的图形控制台并在<code class="literal">Virt Viewer</code>桌面应用程序中打开它，请按照以下步骤操作。
				</p><h4><a id="prerequisites_6"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">您的系统以及要连接的虚拟机必须支持图形显示。
						</li><li class="listitem">如果目标VM位于远程主机上，则需要对主机的连接和root访问权限。
						</li><li class="listitem">
							<span class="strong"><strong>[可选]</strong></span>如果目标VM位于远程主机上，请设置libvirt和SSH，以便<a class="link" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#setting-up-easy-access-to-remote-virtualization-hosts_assembly_connecting-to-virtual-machines" title="设置对远程虚拟化主机的轻松访问">更方便地访问远程主机</a> 。
						</li></ul></div><h4><a id="procedure_6"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要连接到本地VM，请使用以下命令并将<span class="emphasis"><em>guest-name</em></span>替换为要连接到的VM的名称：</p><pre class="literallayout"><span class="strong"><strong># virt-viewer guest-name</strong></span></pre></li><li class="listitem"><p class="simpara">要连接到远程VM，请使用带有SSH协议的<code class="literal">virt-viewer</code>命令。例如，以下命令以root用户身份连接到名为<span class="emphasis"><em>guest-name</em></span>的VM，该VM位于远程系统10.0.0.1上。该连接还需要10.0.0.1的root身份验证。
						</p><pre class="literallayout"><span class="strong"><strong># virt-viewer --direct --connect qemu+ssh://root@10.0.0.1/system guest-name</strong></span>
root@10.0.0.1's password:</pre></li></ul></div><p>如果连接正常，则VM显示将显示在<code class="literal">Virt Viewer</code>窗口中。
				</p><div class="informalfigure"><div class="mediaobject"><img src="images/virt-viewer-GUI.png" alt="Virt Viewer显示RHEL 7客户操作系统"></div></div><p>您可以使用鼠标和键盘与VM控制台进行交互，方式与您与真实机器交互的方式相同。VM控制台中的显示反映了VM上正在执行的活动。</p><h4><a id="additional_resources_4"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关使用Virt Viewer的更多信息，请参阅<code class="literal">virt-viewer</code>手册页。
						</li><li class="listitem">通过<a class="link" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#setting-up-easy-access-to-remote-virtualization-hosts_assembly_connecting-to-virtual-machines" title="设置对远程虚拟化主机的轻松访问">修改libvirt和SSH配置，</a>可以简化连接到远程主机上的VM的过程。
						</li><li class="listitem">要在RHEL 8中的交互式GUI中管理虚拟机，您可以使用Web控制台界面。有关更多信息，请参阅<a class="xref" href="using-the-rhel-8-web-console-for-managing-vms_configuring-and-managing-virtualization.html#viewing-vm-consoles-using-the-rhel-8-web-console_using-the-rhel-8-web-console-for-managing-vms" title="使用RHEL 8 Web控制台与虚拟机交互">“使用RHEL 8 Web控制台与虚拟机交互”一节</a> 。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_connecting-to-a-virtual-machine-using-ssh_assembly_connecting-to-virtual-machines"></a>使用SSH连接到虚拟机</h2></div></div></div><p>要使用SSH连接协议与虚拟机（VM）的终端进行交互，请执行以下步骤：</p><h4><a id="prerequisites_7"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">目标VM的网络连接和root访问权限。</li><li class="listitem"><p class="simpara">必须在VM的主机上安装并启用<code class="literal">libvirt-nss</code>组件。如果不是，请执行以下操作：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">安装<code class="literal">libvirt-nss</code>包：</p><pre class="literallayout"># <span class="strong"><strong>yum install libvirt-nss</strong></span></pre></li><li class="listitem"><p class="simpara">编辑<code class="literal">/etc/nsswitch.conf</code>文件并将<code class="literal">libvirt_guest</code>添加到<code class="literal">hosts</code>行：</p><pre class="literallayout">[...]
passwd:      compat
shadow:      compat
group:       compat
hosts:       files libvirt_guest dns
[...]</pre></li></ol></div></li><li class="listitem">如果目标VM位于远程主机上，则还需要对主机的连接和root访问权限。
						</li></ul></div><h4><a id="procedure_7"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							<span class="strong"><strong>可选</strong></span> ：连接到远程guest虚拟机时，首先SSH到其物理主机。以下示例演示如何使用其根凭据连接到主机10.0.0.1：</p><pre class="literallayout"><span class="strong"><strong># ssh root@10.0.0.1</strong></span>
root@10.0.0.1's password:
Last login: Mon Sep 24 12:05:36 2018
root~#</pre></li><li class="listitem"><p class="simpara">使用VM的名称和用户访问凭据连接到它。例如，以下使用其根凭据连接到“testguest1”VM：</p><pre class="literallayout"><span class="strong"><strong># ssh root@testguest1</strong></span>
root@testguest1's password:
Last login: Wed Sep 12 12:05:36 2018
root~]#</pre><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>如果您不知道虚拟机的名称，可以使用<code class="literal">virsh list --all</code>命令<code class="literal">virsh list --all</code>主机上可用的所有VM：</p><pre class="literallayout"># <span class="strong"><strong>virsh list --all</strong></span>
Id    Name                           State
----------------------------------------------------
2     testguest1                    running
-     testguest2                    shut off</pre></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_opening-a-virtual-machine-serial-console_assembly_connecting-to-virtual-machines"></a>打开虚拟机串行控制台</h2></div></div></div><p>使用<code class="literal">virsh console</code>命令，可以连接到虚拟机（VM）的串行控制台。
				</p><p>这在VM上很有用：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">不提供VNC或SPICE协议，因此不提供GUI工具的视频显示。
						</li><li class="listitem">没有网络连接，因此无法<a class="link" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#proc_connecting-to-a-virtual-machine-using-ssh_assembly_connecting-to-virtual-machines" title="使用SSH连接到虚拟机">使用SSH</a>进行交互。</li></ul></div><h4><a id="prerequisites_8"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">VM必须在其内核命令行中配置串行控制台。要验证这一点，VM上的<code class="literal">cat /proc/cmdline</code>命令输出应包括<span class="emphasis"><em>console = ttyS0</em></span> 。例如：</p><pre class="literallayout"><span class="strong"><strong># cat /proc/cmdline</strong></span>
BOOT_IMAGE=/vmlinuz-3.10.0-948.el7.x86_64 root=/dev/mapper/rhel-root ro console=tty0 console=ttyS0,9600n8 rd.lvm.lv=rhel/root rd.lvm.lv=rhel/swap rhgb</pre><p class="simpara">如果未在VM上正确设置串行控制台，则使用<span class="strong"><strong>virsh控制台</strong></span>连接到VM会将您连接到无响应的guest虚拟机控制台。但是，您仍然可以使用<span class="keycap"><strong>Ctrl +</strong></span> ]快捷方式退出无响应的控制台。
						</p></li><li class="listitem"><p class="simpara">要在VM上设置串行控制台，请执行以下操作：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">在VM上，编辑<code class="literal">/etc/default/grub</code>文件并将<span class="strong"><strong>console = ttyS0</strong></span>添加到以<span class="strong"><strong>GRUB_CMDLINE_LINUX</strong></span>开头的行。</li><li class="listitem"><p class="simpara">清除可能阻止更改生效的内核选项</p><pre class="literallayout"># <span class="strong"><strong>grub2-editenv - unset kernelopts</strong></span></pre></li><li class="listitem"><p class="simpara">重新加载Grub配置：</p><pre class="literallayout"><span class="strong"><strong># grub2-mkconfig -o /boot/grub2/grub.cfg</strong></span>
Generating grub configuration file ...
Found linux image: /boot/vmlinuz-3.10.0-948.el7.x86_64
Found initrd image: /boot/initramfs-3.10.0-948.el7.x86_64.img
[...]
done</pre></li><li class="listitem">重新启动VM。</li></ol></div></li></ul></div><h4><a id="procedure_8"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">在主机系统上，使用<code class="literal">virsh console</code>命令。如果libvirt驱动程序支持安全控制台处理，以下示例将连接到<span class="emphasis"><em>guest1</em></span>虚拟机：</p><pre class="literallayout"><span class="strong"><strong># virsh console guest1 --safe</strong></span>
Connected to domain guest1
Escape character is ^]

<span class="emphasis"><em>Subscription-name</em></span>
Kernel 3.10.0-948.el7.x86_64 on an x86_64

localhost login:</pre></li><li class="listitem">您可以使用与标准命令行界面相同的方式与virsh控制台进行交互。
						</li></ol></div><h4><a id="additional_resources_5"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关VM串行控制台的更多信息，请参见virsh手册页。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="setting-up-easy-access-to-remote-virtualization-hosts_assembly_connecting-to-virtual-machines"></a>设置对远程虚拟化主机的轻松访问</h2></div></div></div><p>使用libvirt实用程序管理远程主机系统上的VM时，建议使用<code class="literal">-c qemu+ssh://root@hostname/system</code>语法。例如，要在10.0.0.1主机上以root身份使用<code class="literal">virsh list</code>命令：</p><pre class="literallayout"># <span class="strong"><strong>virsh -c qemu+ssh://root@10.0.0.1/system list</strong></span>

root@10.0.0.1's password:
Last login: Mon Feb 18 07:28:55 2019

Id   Name              State
---------------------------------
1    remote-guest      running</pre><p>但是，为方便起见，您可以通过修改SSH和libvirt配置来完全指定连接详细信息。例如，您将能够：</p><pre class="literallayout"># <span class="strong"><strong>virsh -c remote-host list</strong></span>

root@10.0.0.1's password:
Last login: Mon Feb 18 07:28:55 2019

Id   Name              State
---------------------------------
1    remote-guest      running</pre><p>要启用此改进，请按照以下说明操作。
				</p><h4><a id="procedure_9"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">编辑或创建<code class="literal">~/.ssh/config</code>文件并向其添加以下内容，其中<span class="emphasis"><em>host-alias</em></span>是与特定远程主机关联的缩写名称， <span class="emphasis"><em>hosturl</em></span>是主机的URL地址。
						</p><pre class="literallayout">Host <span class="emphasis"><em>host-alias</em></span>
        User                    root
        Hostname                <span class="emphasis"><em>hosturl</em></span></pre><p class="simpara">例如，以下设置root@10.0.0.1的<span class="emphasis"><em>霸王龙</em></span>别名：</p><pre class="literallayout">Host tyrannosaurus
        User                    root
        Hostname                10.0.0.1</pre></li><li class="listitem"><p class="simpara">编辑或创建<code class="literal">/etc/libvirt/libvirt.conf</code>文件，并添加以下内容，其中<span class="emphasis"><em>qemu-host-alias</em></span>是QEMU和libvirt实用程序将与目标主机关联的主机别名：</p><pre class="literallayout">uri_aliases = [
  "<span class="emphasis"><em>qemu-host-alias</em></span>=qemu+ssh://<span class="emphasis"><em>host-alias</em></span>/system",
]</pre><p class="simpara">例如，以下使用上一步中配置的<span class="emphasis"><em>暴龙</em></span>别名来设置<span class="emphasis"><em>t-rex</em></span>别名，代表<code class="literal">qemu+ssh://10.0.0.1/system</code> ：</p><pre class="literallayout">uri_aliases = [
  "t-rex=qemu+ssh://tyrannosaurus/system",
]</pre></li><li class="listitem"><p class="simpara">因此，您可以通过在本地系统上使用基于libvirt的实用程序来管理远程VM，并在命令中添加add <code class="literal">-c <span class="emphasis"><em>qemu-host-alias</em></span></code> 。这会在远程主机上通过SSH自动执行命令。
						</p><p class="simpara">例如，以下列出10.0.0.1远程主机上的VM，其连接在前面的步骤中设置为<span class="emphasis"><em>t-rex</em></span> ：</p><pre class="literallayout">$ <span class="strong"><strong>virsh -c t-rex list</strong></span>

root@10.0.0.1's password:
Last login: Mon Feb 18 07:28:55 2019

Id   Name              State
---------------------------------
1    velociraptor      running</pre></li><li class="listitem"><p class="simpara">
							<span class="strong"><strong>[可选]</strong></span>如果要在单个远程主机上独占使用libvirt实用程序，还可以将特定连接设置为基于libvirt的实用程序的默认目标。为此，请编辑<code class="literal">/etc/libvirt/libvirt.conf</code>文件并将<code class="literal">uri_default</code>参数的值设置为<span class="emphasis"><em>qemu-host-alias</em></span> 。例如，以下使用前面步骤中设置的<span class="emphasis"><em>t-rex</em></span>主机别名作为默认的libvirt目标。
						</p><pre class="literallayout"># These can be used in cases when no URI is supplied by the application
# (@uri_default also prevents probing of the hypervisor driver).
#
uri_default = "t-rex"</pre><p class="simpara">因此，所有基于libvirt的命令将自动在指定的远程主机上执行。
						</p><pre class="literallayout">$ <span class="strong"><strong>virsh list</strong></span>
root@10.0.0.1's password:
Last login: Mon Feb 18 07:28:55 2019

Id   Name              State
---------------------------------
1    velociraptor      running</pre><p class="simpara">但是，如果您还想在本地主机或不同远程主机上管理VM，则不建议这样做。
						</p></li></ol></div><h4><a id="additional_resources_6"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">连接到远程主机时，还可以避免向远程系统提供root密码。为此，请执行以下一项或多项操作：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/getting-started-with-system-administration#sec-SSH">设置基于密钥的SSH访问远程主机</a> 。
								</li><li class="listitem">使用SSH连接多路复用连接到远程系统。
								</li><li class="listitem">在远程系统上设置kerberos身份验证票证。
								</li></ul></div></li><li class="listitem"><p class="simpara">可以使用上述<code class="literal">-c</code> （或<code class="literal">--connect</code> ）选项和远程主机访问配置的实用程序包括：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									<a class="link" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#creating-virtual-machines-using-the-command-line-interface_assembly_creating-virtual-machines" title="使用命令行界面创建虚拟机">VIRT安装</a>
								</li><li class="listitem">
									<a class="link" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#proc_opening-a-virtual-machine-graphical-console-using-virt-viewer_assembly_connecting-to-virtual-machines" title="使用Virt Viewer打开虚拟机图形控制台">VIRT-观众</a>
								</li><li class="listitem">的virsh</li><li class="listitem">virt-manager中</li></ul></div></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_shutting-down-virtual-machines_virt-getting-started"></a>关闭虚拟机</h1></div></div></div><p>要在Red Hat Enterprise Linux 8中关闭正在运行的虚拟机，请使用<a class="link" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#shutting-down-a-virtual-machine-using-the-command-line-interface_assembly_shutting-down-virtual-machines" title="使用命令行界面关闭虚拟机">命令行界面</a>或<a class="link" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#powering-down-vms-using-the-rhel-8-web-console_assembly_shutting-down-virtual-machines" title="关闭RHEL 8 Web控制台中的虚拟机电源">Web控制台GUI</a> 。</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="shutting-down-a-virtual-machine-using-the-command-line-interface_assembly_shutting-down-virtual-machines"></a>使用命令行界面关闭虚拟机</h2></div></div></div><p>要关闭响应式虚拟机（VM），请执行以下操作之一：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">在<a class="link" href="getting-started-with-virtualization-in-rhel-8_configuring-and-managing-virtualization.html#assembly_connecting-to-virtual-machines_virt-getting-started" title="连接到虚拟机">连接到</a> guest虚拟机时使用适用于guest虚拟机操作系统的shutdown命令
						</li><li class="listitem"><p class="simpara">在主机上使用<code class="literal">virsh shutdown</code>命令：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">如果VM位于本地主机上：</p><pre class="literallayout"><span class="strong"><strong># virsh shutdown demo-guest1</strong></span>
Domain demo-guest1 is being shutdown</pre></li><li class="listitem"><p class="simpara">如果VM位于远程主机上，则在此示例10.0.0.1中：</p><pre class="literallayout"><span class="strong"><strong># virsh -c qemu+ssh://root@10.0.0.1/system shutdown demo-guest1</strong></span>

root@10.0.0.1's password:
Last login: Mon Feb 18 07:28:55 2019
Domain demo-guest1 is being shutdown</pre></li></ul></div></li></ul></div><p>要强制guest <code class="literal">virsh destroy</code>关闭，例如，如果它没有响应，请在主机上使用<code class="literal">virsh destroy</code>命令：</p><pre class="literallayout"><span class="strong"><strong># virsh destroy demo-guest1</strong></span>
Domain demo-guest1 destroyed</pre><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p><code class="literal">virsh destroy</code>命令实际上不会删除或删除guest <code class="literal">virsh destroy</code>配置或磁盘映像。它只会破坏正在运行的guest实例。但是，在极少数情况下，此命令可能会导致guest <span class="strong"><strong>虚拟机</strong></span>文件系统损坏，因此仅在所有其他关闭方法都失败时才建议使用<span class="strong"><strong>virsh destroy</strong></span> 。
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="powering-down-vms-using-the-rhel-8-web-console_assembly_shutting-down-virtual-machines"></a>关闭RHEL 8 Web控制台中的虚拟机电源</h2></div></div></div><p>如果虚拟机处于<span class="strong"><strong>运行</strong></span>状态，则可以使用RHEL 8 Web控制台将其关闭。
				</p><h4><a id="prerequisites_9"></a>先决条件</h4><p>要能够使用RHEL 8 Web控制台管理虚拟机，必须安装Web控制台虚拟机插件。
				</p><p>如果未安装Web控制台插件，请参阅<a class="xref" href="using-the-rhel-8-web-console-for-managing-vms_configuring-and-managing-virtualization.html#setting-up-the-rhel-8-web-console-to-manage-vms_using-the-rhel-8-web-console-for-managing-vms" title="设置RHEL 8 Web控制台以管理虚拟机">“设置RHEL 8 Web控制台以管理虚拟机”一节，</a>以获取有关安装Web控制台虚拟机插件的信息。
				</p><h4><a id="procedure_10"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem">单击包含要关闭的虚拟机名称的行。<br>该行将展开以显示“概述”窗格，其中包含有关所选虚拟机的基本信息以及用于关闭和删除虚拟机的控件。
						</li><li class="listitem">单击<span class="guibutton">“关机”</span> 。<br>虚拟机关闭。
						</li></ol></div><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>如果虚拟机未关闭，请单击“ <span class="guibutton">关机”</span>按钮旁边的箭头，然后选择“ <span class="guimenu">强制关机”</span> 。
					</p></div><h4><a id="additional_resources_7"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关启动虚拟机的信息，请参阅<a class="xref" href="using-the-rhel-8-web-console-for-managing-vms_configuring-and-managing-virtualization.html#powering-up-vms-using-the-rhel-8-web-console_powering-up-and-powering-down-vms-using-the-rhel-8-web-console" title="在RHEL 8 Web控制台中启动虚拟机">“在RHEL 8 Web控制台中启动虚拟机”一节</a> 。
						</li><li class="listitem">有关重新启动虚拟机的信息，请参阅<a class="xref" href="using-the-rhel-8-web-console-for-managing-vms_configuring-and-managing-virtualization.html#restarting-vms-using-the-rhel-8-web-console_powering-up-and-powering-down-vms-using-the-rhel-8-web-console" title="使用RHEL 8 Web控制台重新启动虚拟机">“使用RHEL 8 Web控制台重新启动虚拟机”一节</a> 。
						</li><li class="listitem">有关向虚拟机<a class="xref" href="using-the-rhel-8-web-console-for-managing-vms_configuring-and-managing-virtualization.html#sending-NMIs-to-vms-using-the-rhel-8-web-console_powering-up-and-powering-down-vms-using-the-rhel-8-web-console" title="Sending non-maskable interrupts to VMs using the RHEL 8 web console">发送不可屏蔽中断的信息</a> ，请参阅<a class="xref" href="using-the-rhel-8-web-console-for-managing-vms_configuring-and-managing-virtualization.html#sending-NMIs-to-vms-using-the-rhel-8-web-console_powering-up-and-powering-down-vms-using-the-rhel-8-web-console" title="使用RHEL 8 Web控制台向VM发送不可屏蔽中断">“使用RHEL 8 Web控制台向VM发送不可屏蔽中断”一节</a> 。
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="related-information-virt-getting-started"></a>相关信息</h1></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">以上信息适用于AMD64和Intel 64架构。如果要在其他受支持的体系结构上使用RHEL8虚拟化，则需要不同的设置过程，并且某些功能可能受到限制或工作方式不同。有关详细信息，请参阅以下相应部分：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="xref" href="getting-started-with-virtualization-in-rhel-8-on-ibm-z_configuring-and-managing-virtualization.html" title="Chapter 9. 在IBM Z上的RHEL 8中开始使用虚拟化">第4章， <em>IBM Z上的RHEL 8中的虚拟化入门</em></a>
							</li><li class="listitem">
								<a class="xref" href="getting-started-with-virtualization-in-rhel-8-on-ibm-power_configuring-and-managing-virtualization.html" title="Chapter 9. 在IBM POWER上使用RHEL 8中的虚拟化入门">第3章， <em>在IBM POWER上的RHEL 8中开始使用虚拟化</em></a>
							</li></ul></div></li></ul></div></div></div></body></html>