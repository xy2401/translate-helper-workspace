<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 使用Kickstart安装Identity Management客户端</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 使用Kickstart安装Identity Management客户端</h1></div></div></div><p>在安装Red Hat Enterprise Linux时，Kickstart注册会自动将新系统添加到Identity Management域。
			</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="installing-a-client-with-kickstart"></a>使用Kickstart安装客户端</h1></div></div></div><p>此过程描述如何使用Kickstart文件来安装Identity Management客户端。
				</p><h3><a id="prerequisites_7"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">在kickstart注册之前不要启动<code class="literal">sshd</code>服务。在注册客户端之前启动<code class="literal">sshd</code>自动生成SSH密钥，但是<a class="xref" href="installing-an-ipa-client-with-kickstart_installing-identity-management.html#kickstart-file-for-client-installation" title="Kickstart file for client installation">“客户端安装</a>的Kickstart文件<a class="xref" href="installing-an-ipa-client-with-kickstart_installing-identity-management.html#kickstart-file-for-client-installation" title="用于客户端安装的Kickstart文件">”部分中的Kickstart文件</a>使用脚本用于相同目的，这是首选解决方案。
						</li></ul></div><h3><a id="procedure_14"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">在Identity Management服务器上预先创建主机条目，并为条目设置临时密码：</p><pre class="literallayout">$ <span class="strong"><strong>ipa host-add <span class="emphasis"><em>client.example.com</em></span> --password=<span class="emphasis"><em>secret</em></span></strong></span></pre><p class="simpara">Kickstart使用密码在客户端安装期间进行身份验证，并在第一次身份验证尝试后过期。成功安装客户端后，它将使用其keytab进行身份验证。
						</p></li><li class="listitem">使用<a class="xref" href="installing-an-ipa-client-with-kickstart_installing-identity-management.html#kickstart-file-for-client-installation" title="用于客户端安装的Kickstart文件">“客户端安装的Kickstart文件”一节中</a>描述的内容创建Kickstart文件。确保使用<code class="literal">network</code>命令在Kickstart文件中正确配置<code class="literal">network</code> 。
						</li><li class="listitem">使用Kickstart文件安装Identity Management客户端。
						</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="kickstart-file-for-client-installation"></a>用于客户端安装的Kickstart文件</h1></div></div></div><p>本节介绍可用于安装Identity Management客户端的kickstart文件的内容。
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">要安装的软件包列表中的<code class="literal">ipa-client</code>软件包</span></dt><dd><p class="simpara">将<code class="literal">ipa-client</code>软件包添加到kickstart文件的％packages部分。例如：</p><pre class="literallayout">%packages
...
<code class="literal">ipa-client</code>
...</pre></dd><dt><span class="term">Identity Management客户端的安装后说明</span></dt><dd><p class="simpara">安装后的说明必须包括：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">在注册之前生成用于确保SSH密钥的指令</li><li class="listitem"><p class="simpara">运行<code class="literal">ipa-client-install</code>实用程序的指令，同时指定：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">访问和配置Identity Management域服务所需的所有信息</li><li class="listitem">在Identity Management服务器上预创建客户端主机时设置的密码。在<a class="xref" href="installing-an-ipa-client-with-kickstart_installing-identity-management.html#installing-a-client-with-kickstart" title="使用Kickstart安装客户端">“使用Kickstart安装客户端”一节中</a> 。
											</li></ul></div></li></ul></div><p class="simpara">例如，使用一次性密码并从命令行而不是通过DNS检索所需选项的kickstart安装的安装后说明可能如下所示：</p><pre class="literallayout">%post --log=/root/ks-post.log

# Generate SSH keys; ipa-client-install uploads them to the IdM server by default
/usr/libexec/openssh/sshd-keygen

# Run the client install script
/usr/sbin/ipa-client-install --hostname=<span class="emphasis"><em>client.example.com</em></span> --domain=<span class="emphasis"><em>EXAMPLE.COM</em></span> --enable-dns-updates --mkhomedir -w <span class="emphasis"><em>secret</em></span> --realm=<span class="emphasis"><em>EXAMPLE.COM</em></span> --server=<span class="emphasis"><em>server.example.com</em></span></pre></dd></dl></div><p>或者，您还可以在Kickstart文件中包含其他选项，例如：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">对于非交互式安装，请将<code class="literal">--unattended</code>选项添加到<code class="literal">ipa-client-install</code> 。
						</li><li class="listitem"><p class="simpara">让客户端安装脚本请求机器的证书：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">将<code class="literal">--request-cert</code>选项添加到<code class="literal">ipa-client-install</code> 。
								</li><li class="listitem"><p class="simpara">在Kickstart <code class="literal">chroot</code>环境中为<code class="literal">getcert</code>和<code class="literal">ipa-client-install</code>实用程序设置系统总线地址为<code class="literal">/dev/null</code> 。为此，请在<code class="literal">ipa-client-install</code>指令之前将这些行添加到Kickstart文件中<code class="literal">ipa-client-install</code>说明：</p><pre class="literallayout"># env DBUS_SYSTEM_BUS_ADDRESS=unix:path=/dev/null getcert list
# env DBUS_SYSTEM_BUS_ADDRESS=unix:path=/dev/null ipa-client-install</pre></li></ul></div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="testing-an-ipa-client-client-kickstart"></a>测试Identity Management客户端</h1></div></div></div><p>命令行界面通知您<code class="literal">ipa-client-install</code>成功，但您也可以进行自己的测试。</p><p>要测试Identity Management客户端是否可以获取有关在服务器上定义的用户的信息，请检查您是否能够解析在服务器上定义的用户。例如，要检查默认<code class="literal">admin</code>用户：</p><pre class="literallayout">[user@client ~]$ <span class="strong"><strong>id admin</strong></span>
uid=1254400000(admin) gid=1254400000(admins) groups=1254400000(admins)</pre><p>要测试身份验证是否正常工作，请从非root用户<code class="literal">su</code>到root用户：</p><pre class="literallayout">[user@client ~]$ <span class="strong"><strong>su -</strong></span>
Last login: Thu Oct 18 18:39:11 CEST 2018 from 192.168.122.1 on pts/0
[root@client ~]#</pre></div></div></body></html>