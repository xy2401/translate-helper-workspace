<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. Mounting file systems</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_mounting-file-systems_managing-file-systems"/>Chapter 9. Mounting file systems</h1></div></div></div><p>
			As a system administrator, you can mount file systems on your system to access data on them.
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="the-linux-mount-mechanism_assembly_mounting-file-systems"/>The Linux mount mechanism</h1></div></div></div><p>
				This section explains basic concepts of mounting file systems on Linux.
			</p><p>
				On Linux, UNIX, and similar operating systems, file systems on different partitions and removable devices (CDs, DVDs, or USB flash drives for example) can be attached to a certain point (the mount point) in the directory tree, and then detached again. While a file system is mounted on a directory, the original content of the directory is not accessible.
			</p><p>
				Note that Linux does not prevent you from mounting a file system to a directory with a file system already attached to it.
			</p><p>
				When mounting, you can identify the device by:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						a universally unique identifier (UUID): for example, <code class="literal">UUID=34795a28-ca6d-4fd8-a347-73671d0c19cb</code>
					</li><li class="listitem">
						a volume label: for example, <code class="literal">LABEL=home</code>
					</li><li class="listitem">
						a full path to a non-persistent block device: for example, <code class="literal">/dev/sda3</code>
					</li></ul></div><p>
				When you mount a file system using the <code class="literal">mount</code> command without all required information, that is without the device name, the target directory, or the file system type, the <code class="literal">mount</code> utility reads the content of the <code class="literal">/etc/fstab</code> file to check if the given file system is listed there. The <code class="literal">/etc/fstab</code> file contains a list of device names and the directories in which the selected file systems are set to be mounted as well as the file system type and mount options. Therefore, when mounting a file system that is specified in <code class="literal">/etc/fstab</code>, the following command syntax is sufficient:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
						Mounting by the mount point:
					</p><pre class="screen"># mount <span class="emphasis"><em><span class="replaceable">directory</span></em></span></pre></li><li class="listitem"><p class="simpara">
						Mounting by the block device:
					</p><pre class="screen"># mount <span class="emphasis"><em><span class="replaceable">device</span></em></span></pre></li></ul></div><h3><a id="additional_resources_28"/>Additional resources</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						The <code class="literal">mount(8)</code> man page.
					</li><li class="listitem">
						For information on how to list persistent naming attributes such as the UUID, see <a class="xref" href="assembly_overview-of-persistent-naming-attributes_managing-file-systems.html#proc_listing-persistent-naming-attributes_assembly_overview-of-persistent-naming-attributes" title="Listing persistent naming attributes">the section called “Listing persistent naming attributes”</a>.
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="listing-currently-mounted-file-systems_assembly_mounting-file-systems"/>Listing currently mounted file systems</h1></div></div></div><p>
				This procedure describes how to list all currently mounted file systems on the command line.
			</p><h3><a id="procedure_30"/>Procedure</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
						To list all mounted file systems, use the <code class="literal">findmnt</code> utility:
					</p><pre class="screen">$ findmnt</pre></li><li class="listitem"><p class="simpara">
						To limit the listed file systems only to a certain file system type, add the <code class="literal">--types</code> option:
					</p><pre class="screen">$ findmnt --types <span class="emphasis"><em><span class="replaceable">fs-type</span></em></span></pre><p class="simpara">
						For example:
					</p><div class="example"><a id="idm139870536962640"/><p class="title"><strong>Example 9.1. Listing only XFS file systems</strong></p><div class="example-contents"><pre class="screen">$ findmnt --types xfs

TARGET  SOURCE                                                FSTYPE OPTIONS
/       /dev/mapper/luks-5564ed00-6aac-4406-bfb4-c59bf5de48b5 xfs    rw,relatime
├─/boot /dev/sda1                                             xfs    rw,relatime
└─/home /dev/mapper/luks-9d185660-7537-414d-b727-d92ea036051e xfs    rw,relatime</pre></div></div></li></ul></div><h3><a id="additional_resources_29"/>Additional resources</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						The <code class="literal">findmnt(8)</code> man page.
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="mounting-a-file-system-with-mount_assembly_mounting-file-systems"/>Mounting a file system with mount</h1></div></div></div><p>
				This procedure describes how to mount a file system using the <code class="literal">mount</code> utility.
			</p><h3><a id="prerequisites_13"/>Prerequisites</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
						Make sure that no file system is already mounted on your chosen mount point:
					</p><pre class="screen">$ findmnt <span class="emphasis"><em><span class="replaceable">mount-point</span></em></span></pre></li></ul></div><h3><a id="procedure_31"/>Procedure</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						To attach a certain file system, use the <code class="literal">mount</code> utility:
					</p><pre class="screen"># mount <span class="emphasis"><em><span class="replaceable">device</span></em></span> <span class="emphasis"><em><span class="replaceable">mount-point</span></em></span></pre><div class="example"><a id="idm139870476633088"/><p class="title"><strong>Example 9.2. Mounting an XFS file system</strong></p><div class="example-contents"><p>
							For example, to mount a local XFS file system identified by UUID:
						</p><pre class="screen"># mount UUID=ea74bbec-536d-490c-b8d9-5b40bbd7545b /mnt/data</pre></div></div></li><li class="listitem"><p class="simpara">
						If <code class="literal">mount</code> cannot recognize the file system type automatically, specify it using the <code class="literal">--types</code> option:
					</p><pre class="screen"># mount --types <span class="emphasis"><em><span class="replaceable">type</span></em></span> <span class="emphasis"><em><span class="replaceable">device</span></em></span> <span class="emphasis"><em><span class="replaceable">mount-point</span></em></span></pre><div class="example"><a id="idm139870476625600"/><p class="title"><strong>Example 9.3. Mounting an NFS file system</strong></p><div class="example-contents"><p>
							For example, to mount a remote NFS file system:
						</p><pre class="screen"># mount --types nfs4 host:/remote-export /mnt/nfs</pre></div></div></li></ol></div><h3><a id="additional_resources_30"/>Additional resources</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						The <code class="literal">mount(8)</code> man page.
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="moving-a-mount-point_assembly_mounting-file-systems"/>Moving a mount point</h1></div></div></div><p>
				This procedure describes how to change the mount point of a mounted file system to a different directory.
			</p><h3><a id="procedure_32"/>Procedure</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						To change the directory in which a file system is mounted:
					</p><pre class="screen"># mount --move <span class="emphasis"><em><span class="replaceable">old-directory</span></em></span> <span class="emphasis"><em><span class="replaceable">new-directory</span></em></span></pre><div class="example"><a id="idm139870476612416"/><p class="title"><strong>Example 9.4. Moving a home file system</strong></p><div class="example-contents"><p>
							For example, to move the file system mounted in the <code class="literal">/mnt/userdirs/</code> directory to the <code class="literal">/home/</code> mount point:
						</p><pre class="screen"># mount --move /mnt/userdirs /home</pre></div></div></li><li class="listitem"><p class="simpara">
						Verify that the file system has been moved as expected:
					</p><pre class="screen">$ findmnt
$ ls <span class="emphasis"><em><span class="replaceable">old-directory</span></em></span>
$ ls <span class="emphasis"><em><span class="replaceable">new-directory</span></em></span></pre></li></ol></div><h3><a id="additional_resources_31"/>Additional resources</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						The <code class="literal">mount(8)</code> man page.
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="unmounting-a-file-system-with-umount_assembly_mounting-file-systems"/>Unmounting a file system with umount</h1></div></div></div><p>
				This procedure describes how to unmount a file system using the <code class="literal">umount</code> utility.
			</p><h3><a id="procedure_33"/>Procedure</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						Try unmounting the file system using either of the following commands:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
								By mount point:
							</p><pre class="screen"># umount <span class="emphasis"><em><span class="replaceable">mount-point</span></em></span></pre></li><li class="listitem"><p class="simpara">
								By device:
							</p><pre class="screen"># umount <span class="emphasis"><em><span class="replaceable">device</span></em></span></pre></li></ul></div><p class="simpara">
						If the command fails with an error similar to the following, it means that the file system is in use because of a process is using resources on it:
					</p><pre class="screen">umount: <span class="emphasis"><em><span class="replaceable">/run/media/user/FlashDrive</span></em></span>: target is busy.</pre></li><li class="listitem"><p class="simpara">
						If the file system is in use, use the <code class="literal">fuser</code> utility to determine which processes are accessing it. For example:
					</p><pre class="screen">$ fuser --mount <span class="emphasis"><em><span class="replaceable">/run/media/user/FlashDrive</span></em></span>

<span class="emphasis"><em><span class="replaceable">/run/media/user/FlashDrive</span></em></span>: <span class="emphasis"><em><span class="replaceable">18351</span></em></span></pre><p class="simpara">
						Afterwards, terminate the processes using the file system and try unmounting it again.
					</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="common-mount-options_assembly_mounting-file-systems"/>Common mount options</h1></div></div></div><p>
				This section lists some commonly used options of the <code class="literal">mount</code> utility.
			</p><p>
				You can use these options in the following syntax:
			</p><pre class="screen"># mount --options <span class="emphasis"><em><span class="replaceable">option1,option2,option3</span></em></span> <span class="emphasis"><em><span class="replaceable">device</span></em></span> <span class="emphasis"><em><span class="replaceable">mount-point</span></em></span></pre><div class="table"><a id="idm139870465767344"/><p class="title"><strong>Table 9.1. Common mount options</strong></p><div class="table-contents"><table summary="Common mount options" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Option</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								<code class="literal">async</code>
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Enables asynchronous input and output operations on the file system.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								<code class="literal">auto</code>
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Enables the file system to be mounted automatically using the <code class="literal">mount -a</code> command.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								<code class="literal">defaults</code>
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Provides an alias for the <code class="literal">async,auto,dev,exec,nouser,rw,suid</code> options.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								<code class="literal">exec</code>
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Allows the execution of binary files on the particular file system.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								<code class="literal">loop</code>
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Mounts an image as a loop device.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								<code class="literal">noauto</code>
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Default behavior disables the automatic mount of the file system using the <code class="literal">mount -a</code> command.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								<code class="literal">noexec</code>
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Disallows the execution of binary files on the particular file system.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								<code class="literal">nouser</code>
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Disallows an ordinary user (that is, other than root) to mount and unmount the file system.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								<code class="literal">remount</code>
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Remounts the file system in case it is already mounted.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								<code class="literal">ro</code>
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Mounts the file system for reading only.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								<code class="literal">rw</code>
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Mounts the file system for both reading and writing.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								<code class="literal">user</code>
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Allows an ordinary user (that is, other than root) to mount and unmount the file system.
							</p>
							 </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sharing-a-mount-on-multiple-mount-points_assembly_mounting-file-systems"/>Sharing a mount on multiple mount points</h1></div></div></div><p>
				As a system administrator, you can duplicate mount points to make the file systems accessible from multiple directories.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="types-of-shared-mounts_sharing-a-mount-on-multiple-mount-points"/>Types of shared mounts</h2></div></div></div><p>
					There are multiple types of shared mounts that you can use. The difference between them is what happens when you mount another file system under one of the shared mount points. The shared mounts are implemented using the <span class="emphasis"><em>shared subtrees</em></span> functionality.
				</p><p>
					The types are:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Private mount</span></dt><dd><p class="simpara">
								This type does not receive or forward any propagation events.
							</p><p class="simpara">
								When you mount another file system under either the duplicate or the original mount point, it is not reflected in the other.
							</p></dd><dt><span class="term">Shared mount</span></dt><dd><p class="simpara">
								This type creates an exact replica of a given mount point.
							</p><p class="simpara">
								When a mount point is marked as a shared mount, any mount within the original mount point is reflected in it, and vice versa.
							</p><p class="simpara">
								This is the default mount type of the root file system.
							</p></dd><dt><span class="term">Slave mount</span></dt><dd><p class="simpara">
								This type creates a limited duplicate of a given mount point.
							</p><p class="simpara">
								When a mount point is marked as a slave mount, any mount within the original mount point is reflected in it, but no mount within a slave mount is reflected in its original.
							</p></dd><dt><span class="term">Unbindable mount</span></dt><dd>
								This type prevents the given mount point from being duplicated whatsoever.
							</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-a-private-mount-point-duplicate_sharing-a-mount-on-multiple-mount-points"/>Creating a private mount point duplicate</h2></div></div></div><p>
					This procedure duplicates a mount point as a private mount. File systems that you later mount under the duplicate or the original mount point are not reflected in the other.
				</p><h4><a id="procedure_34"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Create a virtual file system (VFS) node from the original mount point:
						</p><pre class="screen"># mount --bind <span class="emphasis"><em><span class="replaceable">original-dir</span></em></span> <span class="emphasis"><em><span class="replaceable">original-dir</span></em></span></pre></li><li class="listitem"><p class="simpara">
							Mark the original mount point as private:
						</p><pre class="screen"># mount --make-private <span class="emphasis"><em><span class="replaceable">original-dir</span></em></span></pre><p class="simpara">
							Alternatively, to change the mount type for the selected mount point and all mount points under it, use the <code class="literal">--make-rprivate</code> option instead of <code class="literal">--make-private</code>.
						</p></li><li class="listitem"><p class="simpara">
							Create the duplicate:
						</p><pre class="screen"># mount --bind <span class="emphasis"><em><span class="replaceable">original-dir</span></em></span> <span class="emphasis"><em><span class="replaceable">duplicate-dir</span></em></span></pre></li></ol></div><div class="example"><a id="idm139870589314704"/><p class="title"><strong>Example 9.5. Duplicating /media into /mnt as a private mount point</strong></p><div class="example-contents"><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Create a VFS node from the <code class="literal">/media</code> directory:
							</p><pre class="screen"># mount --bind /media /media</pre></li><li class="listitem"><p class="simpara">
								Mark the <code class="literal">/media</code> directory as private:
							</p><pre class="screen"># mount --make-private /media</pre></li><li class="listitem"><p class="simpara">
								Create its duplicate in <code class="literal">/mnt</code>:
							</p><pre class="screen"># mount --bind /media /mnt</pre></li><li class="listitem"><p class="simpara">
								It is now possible to verify that <code class="literal">/media</code> and <code class="literal">/mnt</code> share content but none of the mounts within <code class="literal">/media</code> appear in <code class="literal">/mnt</code>. For example, if the CD-ROM drive contains non-empty media and the <code class="literal">/media/cdrom/</code> directory exists, use:
							</p><pre class="screen"># mount /dev/cdrom /media/cdrom
# ls /media/cdrom
EFI  GPL  isolinux  LiveOS
# ls /mnt/cdrom
#</pre></li><li class="listitem"><p class="simpara">
								It is also possible to verify that file systems mounted in the <code class="literal">/mnt</code> directory are not reflected in <code class="literal">/media</code>. For instance, if a non-empty USB flash drive that uses the <code class="literal">/dev/sdc1</code> device is plugged in and the <code class="literal">/mnt/flashdisk/</code> directory is present, use:
							</p><pre class="screen"># mount /dev/sdc1 /mnt/flashdisk
# ls /media/flashdisk
# ls /mnt/flashdisk
en-US  publican.cfg</pre></li></ol></div></div></div><h4><a id="additional_resources_32"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">mount(8)</code> man page.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-a-shared-mount-point-duplicate_sharing-a-mount-on-multiple-mount-points"/>Creating a shared mount point duplicate</h2></div></div></div><p>
					This procedure duplicates a mount point as a shared mount. File systems that you later mount under the original directory or the duplicate are always reflected in the other.
				</p><h4><a id="procedure_35"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Create a virtual file system (VFS) node from the original mount point:
						</p><pre class="screen"># mount --bind <span class="emphasis"><em><span class="replaceable">original-dir</span></em></span> <span class="emphasis"><em><span class="replaceable">original-dir</span></em></span></pre></li><li class="listitem"><p class="simpara">
							Mark the original mount point as shared:
						</p><pre class="screen"># mount --make-shared <span class="emphasis"><em><span class="replaceable">original-dir</span></em></span></pre><p class="simpara">
							Alternatively, to change the mount type for the selected mount point and all mount points under it, use the <code class="literal">--make-rshared</code> option instead of <code class="literal">--make-shared</code>.
						</p></li><li class="listitem"><p class="simpara">
							Create the duplicate:
						</p><pre class="screen"># mount --bind <span class="emphasis"><em><span class="replaceable">original-dir</span></em></span> <span class="emphasis"><em><span class="replaceable">duplicate-dir</span></em></span></pre></li></ol></div><div class="example"><a id="idm139870478130240"/><p class="title"><strong>Example 9.6. Duplicating /media into /mnt as a shared mount point</strong></p><div class="example-contents"><p>
						To make the <code class="literal">/media</code> and <code class="literal">/mnt</code> directories share the same content:
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Create a VFS node from the <code class="literal">/media</code> directory:
							</p><pre class="screen"># mount --bind /media /media</pre></li><li class="listitem"><p class="simpara">
								Mark the <code class="literal">/media</code> directory as shared:
							</p><pre class="screen"># mount --make-shared /media</pre></li><li class="listitem"><p class="simpara">
								Create its duplicate in <code class="literal">/mnt</code>:
							</p><pre class="screen"># mount --bind /media /mnt</pre></li><li class="listitem"><p class="simpara">
								It is now possible to verify that a mount within <code class="literal">/media</code> also appears in <code class="literal">/mnt</code>. For example, if the CD-ROM drive contains non-empty media and the <code class="literal">/media/cdrom/</code> directory exists, use:
							</p><pre class="screen"># mount /dev/cdrom /media/cdrom
# ls /media/cdrom
EFI  GPL  isolinux  LiveOS
# ls /mnt/cdrom
EFI  GPL  isolinux  LiveOS</pre></li><li class="listitem"><p class="simpara">
								Similarly, it is possible to verify that any file system mounted in the <code class="literal">/mnt</code> directory is reflected in <code class="literal">/media</code>. For instance, if a non-empty USB flash drive that uses the <code class="literal">/dev/sdc1</code> device is plugged in and the <code class="literal">/mnt/flashdisk/</code> directory is present, use:
							</p><pre class="screen"># mount /dev/sdc1 /mnt/flashdisk
# ls /media/flashdisk
en-US  publican.cfg
# ls /mnt/flashdisk
en-US  publican.cfg</pre></li></ol></div></div></div><h4><a id="additional_resources_33"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">mount(8)</code> man page.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-a-slave-mount-point-duplicate_sharing-a-mount-on-multiple-mount-points"/>Creating a slave mount point duplicate</h2></div></div></div><p>
					This procedure duplicates a mount point as a slave mount. File systems that you later mount under the original mount point are reflected in the duplicate but not the other way around.
				</p><h4><a id="procedure_36"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Create a virtual file system (VFS) node from the original mount point:
						</p><pre class="screen"># mount --bind <span class="emphasis"><em><span class="replaceable">original-dir</span></em></span> <span class="emphasis"><em><span class="replaceable">original-dir</span></em></span></pre></li><li class="listitem"><p class="simpara">
							Mark the original mount point as shared:
						</p><pre class="screen"># mount --make-shared <span class="emphasis"><em><span class="replaceable">original-dir</span></em></span></pre><p class="simpara">
							Alternatively, to change the mount type for the selected mount point and all mount points under it, use the <code class="literal">--make-rshared</code> option instead of <code class="literal">--make-shared</code>.
						</p></li><li class="listitem"><p class="simpara">
							Create the duplicate and mark it as slave:
						</p><pre class="screen"># mount --bind <span class="emphasis"><em><span class="replaceable">original-dir</span></em></span> <span class="emphasis"><em><span class="replaceable">duplicate-dir</span></em></span>
# mount --make-slave <span class="emphasis"><em><span class="replaceable">duplicate-dir</span></em></span></pre></li></ol></div><div class="example"><a id="idm139870590377104"/><p class="title"><strong>Example 9.7. Duplicating /media into /mnt as a slave mount point</strong></p><div class="example-contents"><p>
						This example shows how to get the content of the <code class="literal">/media</code> directory to appear in <code class="literal">/mnt</code> as well, but without any mounts in the <code class="literal">/mnt</code> directory to be reflected in <code class="literal">/media</code>.
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Create a VFS node from the <code class="literal">/media</code> directory:
							</p><pre class="screen"># mount --bind /media /media</pre></li><li class="listitem"><p class="simpara">
								Mark the <code class="literal">/media</code> directory as shared:
							</p><pre class="screen"># mount --make-shared /media</pre></li><li class="listitem"><p class="simpara">
								Create its duplicate in <code class="literal">/mnt</code> and mark it as slave:
							</p><pre class="screen"># mount --bind /media /mnt
# mount --make-slave /mnt</pre></li><li class="listitem"><p class="simpara">
								Verify that a mount within <code class="literal">/media</code> also appears in <code class="literal">/mnt</code>. For example, if the CD-ROM drive contains non-empty media and the <code class="literal">/media/cdrom/</code> directory exists, use:
							</p><pre class="screen"># mount /dev/cdrom /media/cdrom
# ls /media/cdrom
EFI  GPL  isolinux  LiveOS
# ls /mnt/cdrom
EFI  GPL  isolinux  LiveOS</pre></li><li class="listitem"><p class="simpara">
								Also verify that file systems mounted in the <code class="literal">/mnt</code> directory are not reflected in <code class="literal">/media</code>. For instance, if a non-empty USB flash drive that uses the <code class="literal">/dev/sdc1</code> device is plugged in and the <code class="literal">/mnt/flashdisk/</code> directory is present, use:
							</p><pre class="screen"># mount /dev/sdc1 /mnt/flashdisk
# ls /media/flashdisk
# ls /mnt/flashdisk
en-US  publican.cfg</pre></li></ol></div></div></div><h4><a id="additional_resources_34"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">mount(8)</code> man page.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="preventing-a-mount-point-from-being-duplicated_sharing-a-mount-on-multiple-mount-points"/>Preventing a mount point from being duplicated</h2></div></div></div><p>
					This procedure marks a mount point as unbindable so that it is not possible to duplicate it in another mount point.
				</p><h4><a id="procedure_37"/>Procedure</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							To change the type of a mount point to an unbindable mount, use:
						</p><pre class="screen"># mount --bind <span class="emphasis"><em><span class="replaceable">mount-point</span></em></span> <span class="emphasis"><em><span class="replaceable">mount-point</span></em></span>
# mount --make-unbindable <span class="emphasis"><em><span class="replaceable">mount-point</span></em></span></pre><p class="simpara">
							Alternatively, to change the mount type for the selected mount point and all mount points under it, use the <code class="literal">--make-runbindable</code> option instead of <code class="literal">--make-unbindable</code>.
						</p><p class="simpara">
							Any subsequent attempt to make a duplicate of this mount fails with the following error:
						</p><pre class="screen"># mount --bind <span class="emphasis"><em><span class="replaceable">mount-point</span></em></span> <span class="emphasis"><em><span class="replaceable">duplicate-dir</span></em></span>

mount: wrong fs type, bad option, bad superblock on <span class="emphasis"><em><span class="replaceable">mount-point</span></em></span>,
missing codepage or helper program, or other error
In some cases useful info is found in syslog - try
dmesg | tail  or so</pre></li></ul></div><div class="example"><a id="idm139870473512256"/><p class="title"><strong>Example 9.8. Preventing /media from being duplicated</strong></p><div class="example-contents"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
								To prevent the <code class="literal">/media</code> directory from being shared, use:
							</p><pre class="screen"># mount --bind /media /media
# mount --make-unbindable /media</pre></li></ul></div></div></div><h4><a id="additional_resources_35"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">mount(8)</code> man page.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="related-information-sharing-a-mount-on-multiple-mount-points"/>Related information</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <span class="emphasis"><em>Shared subtrees</em></span> article on Linux Weekly News: <a class="link" href="https://lwn.net/Articles/159077/">https://lwn.net/Articles/159077/</a>.
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_persistently-mounting-file-systems_assembly_mounting-file-systems"/>Persistently mounting file systems</h1></div></div></div><p>
				As a system administrator, you can persistently mount file systems to configure non-removable storage.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="con_the-etc-fstab-file_assembly_persistently-mounting-file-systems"/>The /etc/fstab file</h2></div></div></div><p>
					This section describes the <code class="literal">/etc/fstab</code> configuration file, which controls persistent mount points of file systems. Using <code class="literal">/etc/fstab</code> is the recommended way to persistently mount file systems.
				</p><p>
					Each line in the <code class="literal">/etc/fstab</code> file defines a mount point of a file system. It includes six fields separated by white space:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							The block device identified by a persistent attribute or a path it the <code class="literal">/dev</code> directory.
						</li><li class="listitem">
							The directory where the device will be mounted.
						</li><li class="listitem">
							The file system on the device.
						</li><li class="listitem">
							Mount options for the file system. The option <code class="literal">defaults</code> means that the partition is mounted at boot time with default options. This section also recognizes <code class="literal">systemd</code> mount unit options in the <code class="literal">x-systemd.<span class="emphasis"><em><span class="replaceable">option</span></em></span></code> format.
						</li><li class="listitem">
							Backup option for the <code class="literal">dump</code> utility.
						</li><li class="listitem">
							Check order for the <code class="literal">fsck</code> utility.
						</li></ol></div><div class="example"><a id="idm139870477352560"/><p class="title"><strong>Example 9.9. The <code class="literal">/boot</code> file system in <code class="literal">/etc/fstab</code></strong></p><div class="example-contents"><div class="informaltable"><table border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/><col class="col_4"/><col class="col_5"/><col class="col_6"/></colgroup><thead><tr><th style="text-align: left" valign="top">Block device</th><th style="text-align: left" valign="top">Mount point</th><th style="text-align: left" valign="top">File system</th><th style="text-align: left" valign="top">Options</th><th style="text-align: left" valign="top">Backup</th><th style="text-align: left" valign="top">Check</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">UUID=ea74bbec-536d-490c-b8d9-5b40bbd7545b</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										<code class="literal">/boot</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										<code class="literal">xfs</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										<code class="literal">defaults</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										<code class="literal">0</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										<code class="literal">0</code>
									</p>
									 </td></tr></tbody></table></div></div></div><p>
					The <code class="literal">systemd</code> service automatically generates mount units from entries in <code class="literal">/etc/fstab</code>.
				</p><h4><a id="additional_resources_36"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">fstab(5)</code> man page.
						</li><li class="listitem">
							The <span class="emphasis"><em>fstab</em></span> section of the <code class="literal">systemd.mount(5)</code> man page.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="adding-a-file-system-to-etc-fstab_assembly_persistently-mounting-file-systems"/>Adding a file system to /etc/fstab</h2></div></div></div><p>
					This procedure describes how to configure persistent mount point for a file system in the <code class="literal">/etc/fstab</code> configuration file.
				</p><h4><a id="procedure_38"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Find out the UUID attribute of the file system:
						</p><pre class="screen">$ lsblk --fs <span class="emphasis"><em><span class="replaceable">storage-device</span></em></span></pre><p class="simpara">
							For example:
						</p><div class="example"><a id="idm139870576246400"/><p class="title"><strong>Example 9.10. Viewing the UUID of a partition</strong></p><div class="example-contents"><pre class="screen">$ lsblk --fs <span class="emphasis"><em><span class="replaceable">/dev/sda1</span></em></span>

NAME FSTYPE LABEL <span class="strong"><strong>UUID</strong></span>                                 MOUNTPOINT
sda1 xfs    Boot  <span class="strong"><strong>ea74bbec-536d-490c-b8d9-5b40bbd7545b</strong></span> /boot</pre></div></div></li><li class="listitem"><p class="simpara">
							If the mount point directory does not exist, create it:
						</p><pre class="screen"># mkdir --parents <span class="emphasis"><em><span class="replaceable">mount-point</span></em></span></pre></li><li class="listitem"><p class="simpara">
							As root, edit the <code class="literal">/etc/fstab</code> file and add a line for the file system, identified by the UUID.
						</p><p class="simpara">
							For example:
						</p><div class="example"><a id="idm139870576237872"/><p class="title"><strong>Example 9.11. The /boot mount point in /etc/fstab</strong></p><div class="example-contents"><pre class="screen">UUID=ea74bbec-536d-490c-b8d9-5b40bbd7545b /boot xfs defaults 0 0</pre></div></div></li><li class="listitem"><p class="simpara">
							Regenerate mount units so that your system registers the new configuration:
						</p><pre class="screen"># systemctl daemon-reload</pre></li><li class="listitem"><p class="simpara">
							Try mounting the file system to verify that the configuration works:
						</p><pre class="screen"># mount <span class="emphasis"><em><span class="replaceable">mount-point</span></em></span></pre></li></ol></div><h4><a id="additional_resources_37"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Other persistent attributes that you can use to identify the file system: <a class="xref" href="assembly_overview-of-persistent-naming-attributes_managing-file-systems.html#con_device-names-managed-by-the-udev-mechanism-in-dev-disk-_assembly_overview-of-persistent-naming-attributes" title="Device names managed by the udev mechanism in /dev/disk/">the section called “Device names managed by the udev mechanism in /dev/disk/”</a>
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_mounting-file-systems-on-demand_assembly_mounting-file-systems"/>Mounting file systems on demand</h1></div></div></div><p>
				As a system administrator, you can configure file systems, such as NFS, to mount automatically on demand.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="the-autofs-service_assembly_mounting-file-systems-on-demand"/>The autofs service</h2></div></div></div><p>
					This section explains the benefits and basic concepts of the <code class="literal">autofs</code> service, used to mount file systems on demand.
				</p><p>
					One drawback of permanent mounting using the <code class="literal">/etc/fstab</code> configuration is that, regardless of how infrequently a user accesses the mounted file system, the system must dedicate resources to keep the mounted file system in place. This might affect system performance when, for example, the system is maintaining NFS mounts to many systems at one time.
				</p><p>
					An alternative to <code class="literal">/etc/fstab</code> is to use the kernel-based <code class="literal">autofs</code> service. It consists of the following components:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							A kernel module that implements a file system, and
						</li><li class="listitem">
							A user-space service that performs all of the other functions.
						</li></ul></div><p>
					The <code class="literal">autofs</code> service can mount and unmount file systems automatically (on-demand), therefore saving system resources. It can be used to mount file systems such as NFS, AFS, SMBFS, CIFS, and local file systems.
				</p><h4><a id="additional_resources_38"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">autofs(8)</code> man page.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="the-autofs-configuration-files_assembly_mounting-file-systems-on-demand"/>The autofs configuration files</h2></div></div></div><p>
					This section describes the usage and syntax of configuration files used by the <code class="literal">autofs</code> service.
				</p><h4><a id="the_master_map_file"/>The master map file</h4><p>
					The <code class="literal">autofs</code> service uses <code class="literal">/etc/auto.master</code> (master map) as its default primary configuration file. This can be changed to use another supported network source and name using the <code class="literal">autofs</code> configuration in the <code class="literal">/etc/autofs.conf</code> configuration file in conjunction with the Name Service Switch (NSS) mechanism.
				</p><p>
					All on-demand mount points must be configured in the master map. Mount point, host name, exported directory, and options can all be specified in a set of files (or other supported network sources) rather than configuring them manually for each host.
				</p><p>
					The master map file lists mount points controlled by <code class="literal">autofs</code>, and their corresponding configuration files or network sources known as automount maps. The format of the master map is as follows:
				</p><pre class="screen"><span class="emphasis"><em><span class="replaceable">mount-point</span></em></span>  <span class="emphasis"><em><span class="replaceable">map-name</span></em></span>  <span class="emphasis"><em><span class="replaceable">options</span></em></span></pre><p>
					The variables used in this format are:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="emphasis"><em><span class="replaceable">mount-point</span></em></span></span></dt><dd>
								The <code class="literal">autofs</code> mount point; for example, <code class="literal">/mnt/data/</code>.
							</dd><dt><span class="term"><span class="emphasis"><em><span class="replaceable">map-file</span></em></span></span></dt><dd>
								The map source file, which contains a list of mount points and the file system location from which those mount points should be mounted.
							</dd><dt><span class="term"><span class="emphasis"><em><span class="replaceable">options</span></em></span></span></dt><dd>
								If supplied, these apply to all entries in the given map, if they do not themselves have options specified.
							</dd></dl></div><div class="example"><a id="idm139870578880928"/><p class="title"><strong>Example 9.12. The /etc/auto.master file</strong></p><div class="example-contents"><p>
						The following is a sample line from <code class="literal">/etc/auto.master</code> file:
					</p><pre class="screen">/mnt/data  /etc/auto.data</pre></div></div><h4><a id="map_files"/>Map files</h4><p>
					Map files configure the properties of individual on-demand mount points.
				</p><p>
					The automounter creates the directories if they do not exist. If the directories exist before the automounter was started, the automounter will not remove them when it exits. If a timeout is specified, the directory is automatically unmounted if the directory is not accessed for the timeout period.
				</p><p>
					The general format of maps is similar to the master map. However, the options field appears between the mount point and the location instead of at the end of the entry as in the master map:
				</p><pre class="screen"><span class="emphasis"><em><span class="replaceable">mount-point</span></em></span>  <span class="emphasis"><em><span class="replaceable">options</span></em></span>  <span class="emphasis"><em><span class="replaceable">location</span></em></span></pre><p>
					The variables used in this format are:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="emphasis"><em><span class="replaceable">mount-point</span></em></span></span></dt><dd>
								This refers to the <code class="literal">autofs</code> mount point. This can be a single directory name for an indirect mount or the full path of the mount point for direct mounts. Each direct and indirect map entry key (<span class="emphasis"><em><span class="replaceable">mount-point</span></em></span>) can be followed by a space separated list of offset directories (subdirectory names each beginning with <code class="literal">/</code>) making them what is known as a multi-mount entry.
							</dd><dt><span class="term"><span class="emphasis"><em><span class="replaceable">options</span></em></span></span></dt><dd>
								When supplied, these are the mount options for the map entries that do not specify their own options. This field is optional.
							</dd><dt><span class="term"><span class="emphasis"><em><span class="replaceable">location</span></em></span></span></dt><dd>
								This refers to the file system location such as a local file system path (preceded with the Sun map format escape character <code class="literal">:</code> for map names beginning with <code class="literal">/</code>), an NFS file system or other valid file system location.
							</dd></dl></div><div class="example"><a id="idm139870468458096"/><p class="title"><strong>Example 9.13. A map file</strong></p><div class="example-contents"><p>
						The following is a sample from a map file; for example, <code class="literal">/etc/auto.misc</code>:
					</p><pre class="screen">payroll  -fstype=nfs4  personnel:/dev/disk/by-uuid/52b94495-e106-4f29-b868-fe6f6c2789b1
sales    -fstype=xfs   :/dev/disk/by-uuid/5564ed00-6aac-4406-bfb4-c59bf5de48b5</pre><p>
						The first column in the map file indicates the <code class="literal">autofs</code> mount point: <code class="literal">sales</code> and <code class="literal">payroll</code> from the server called <code class="literal">personnel</code>. The second column indicates the options for the <code class="literal">autofs</code> mount. The third column indicates the source of the mount.
					</p><p>
						Following the given configuration, the <code class="literal">autofs</code> mount points will be <code class="literal">/home/payroll</code> and <code class="literal">/home/sales</code>. The <code class="literal">-fstype=</code> option is often omitted and is generally not needed for correct operation.
					</p><p>
						Using the given configuration, if a process requires access to an <code class="literal">autofs</code> unmounted directory such as <code class="literal">/home/payroll/2006/July.sxc</code>, the <code class="literal">autofs</code> service automatically mounts the directory.
					</p></div></div><h4><a id="the_amd_map_format"/>The amd map format</h4><p>
					The <code class="literal">autofs</code> service recognizes map configuration in the <code class="literal">amd</code> format as well. This is useful if you want to reuse existing automounter configuration written for the <code class="literal">am-utils</code> service, which has been removed from Red Hat Enterprise Linux.
				</p><p>
					However, Red Hat recommends using the simpler <code class="literal">autofs</code> format described in the previous sections.
				</p><h4><a id="additional_resources_39"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">autofs(5)</code>, <code class="literal">autofs.conf(5)</code>, and <code class="literal">auto.master(5)</code> man pages.
						</li><li class="listitem">
							For details on the <code class="literal">amd</code> map format, see the <code class="literal">/usr/share/doc/autofs/README.amd-maps</code> file, which is provided by the <code class="literal">autofs</code> package.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-autofs-mount-points_assembly_mounting-file-systems-on-demand"/>Configuring autofs mount points</h2></div></div></div><p>
					This procedure describes how to configure on-demand mount points using the <code class="literal">autofs</code> service.
				</p><h4><a id="prerequisites_14"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							Install the <code class="literal">autofs</code> package:
						</p><pre class="screen"># yum install autofs</pre></li><li class="listitem"><p class="simpara">
							Start and enable the <code class="literal">autofs</code> service:
						</p><pre class="screen"># systemctl enable --now autofs</pre></li></ul></div><h4><a id="procedure_39"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Create a map file for the on-demand mount point, located at <code class="literal">/etc/auto.<span class="emphasis"><em><span class="replaceable">identifier</span></em></span></code>. Replace <span class="emphasis"><em><span class="replaceable">identifier</span></em></span> with a name that identifies the mount point.
						</li><li class="listitem">
							In the map file, fill in the mount point, options, and location fields as described in <a class="xref" href="assembly_mounting-file-systems_managing-file-systems.html#the-autofs-configuration-files_assembly_mounting-file-systems-on-demand" title="The autofs configuration files">the section called “The autofs configuration files”</a>.
						</li><li class="listitem">
							Register the map file in the master map file, as described in <a class="xref" href="assembly_mounting-file-systems_managing-file-systems.html#the-autofs-configuration-files_assembly_mounting-file-systems-on-demand" title="The autofs configuration files">the section called “The autofs configuration files”</a>.
						</li><li class="listitem"><p class="simpara">
							Try accessing content in the on-demand directory:
						</p><pre class="screen">$ ls <span class="emphasis"><em><span class="replaceable">automounted-directory</span></em></span></pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="overriding-or-augmenting-autofs-site-configuration-files_assembly_mounting-file-systems-on-demand"/>Overriding or augmenting autofs site configuration files</h2></div></div></div><p>
					It is sometimes useful to override site defaults for a specific mount point on a client system.
				</p><div class="example"><a id="idm139870567139200"/><p class="title"><strong>Example 9.14. Initial conditions</strong></p><div class="example-contents"><p>
						For example, consider the following conditions:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
								Automounter maps are stored in NIS and the <code class="literal">/etc/nsswitch.conf</code> file has the following directive:
							</p><pre class="screen">automount:    files nis</pre></li><li class="listitem"><p class="simpara">
								The <code class="literal">auto.master</code> file contains:
							</p><pre class="screen">+auto.master</pre></li><li class="listitem"><p class="simpara">
								The NIS <code class="literal">auto.master</code> map file contains:
							</p><pre class="screen">/home auto.home</pre></li><li class="listitem"><p class="simpara">
								The NIS <code class="literal">auto.home</code> map contains:
							</p><pre class="screen">beth    fileserver.example.com:/export/home/beth
joe     fileserver.example.com:/export/home/joe
*       fileserver.example.com:/export/home/&amp;</pre></li><li class="listitem">
								The file map <code class="literal">/etc/auto.home</code> does not exist.
							</li></ul></div></div></div><h4><a id="procedure_40"/>Procedure</h4><div class="example"><a id="idm139870567125728"/><p class="title"><strong>Example 9.15. Mounting home directories from a different server</strong></p><div class="example-contents"><p>
						Given the preceding conditions, let’s assume that the client system needs to override the NIS map <code class="literal">auto.home</code> and mount home directories from a different server.
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
								In this case, the client needs to use the following <code class="literal">/etc/auto.master</code> map:
							</p><pre class="screen">/home ­/etc/auto.home
+auto.master</pre></li><li class="listitem"><p class="simpara">
								The <code class="literal">/etc/auto.home</code> map contains the entry:
							</p><pre class="screen">*    labserver.example.com:/export/home/&amp;</pre></li></ul></div><p>
						Because the automounter only processes the first occurrence of a mount point, the <code class="literal">/home</code> directory contains the content of <code class="literal">/etc/auto.home</code> instead of the NIS <code class="literal">auto.home</code> map.
					</p></div></div><div class="example"><a id="idm139870590083984"/><p class="title"><strong>Example 9.16. Augmenting auto.home with only selected entries</strong></p><div class="example-contents"><p>
						Alternatively, to augment the site-wide <code class="literal">auto.home</code> map with just a few entries:
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Create an <code class="literal">/etc/auto.home</code> file map, and in it put the new entries. At the end, include the NIS <code class="literal">auto.home</code> map. Then the <code class="literal">/etc/auto.home</code> file map looks similar to:
							</p><pre class="screen">mydir someserver:/export/mydir
+auto.home</pre></li><li class="listitem"><p class="simpara">
								With these NIS <code class="literal">auto.home</code> map conditions, listing the content of the <code class="literal">/home</code> directory outputs:
							</p><pre class="screen">$ ls /home

beth joe mydir</pre></li></ol></div><p>
						This last example works as expected because <code class="literal">autofs</code> does not include the contents of a file map of the same name as the one it is reading. As such, <code class="literal">autofs</code> moves on to the next map source in the <code class="literal">nsswitch</code> configuration.
					</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="using-ldap-to-store-automounter-maps_assembly_mounting-file-systems-on-demand"/>Using LDAP to store automounter maps</h2></div></div></div><p>
					This procedure configures <code class="literal">autofs</code> to store automounter maps in LDAP configuration rather than in <code class="literal">autofs</code> map files.
				</p><h4><a id="prerequisites_15"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							LDAP client libraries must be installed on all systems configured to retrieve automounter maps from LDAP. On Red Hat Enterprise Linux, the <code class="literal">openldap</code> package should be installed automatically as a dependency of the <code class="literal">autofs</code> package.
						</li></ul></div><h4><a id="procedure_41"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							To configure LDAP access, modify the <code class="literal">/etc/openldap/ldap.conf</code> file. Ensure that the <code class="literal">BASE</code>, <code class="literal">URI</code>, and <code class="literal">schema</code> options are set appropriately for your site.
						</li><li class="listitem"><p class="simpara">
							The most recently established schema for storing automount maps in LDAP is described by the <code class="literal">rfc2307bis</code> draft. To use this schema, set it in the <code class="literal">/etc/autofs.conf</code> configuration file by removing the comment characters from the schema definition. For example:
						</p><div class="example"><a id="idm139870590056864"/><p class="title"><strong>Example 9.17. Setting autofs configuration</strong></p><div class="example-contents"><pre class="screen">DEFAULT_MAP_OBJECT_CLASS="automountMap"
DEFAULT_ENTRY_OBJECT_CLASS="automount"
DEFAULT_MAP_ATTRIBUTE="automountMapName"
DEFAULT_ENTRY_ATTRIBUTE="automountKey"
DEFAULT_VALUE_ATTRIBUTE="automountInformation"</pre></div></div></li><li class="listitem"><p class="simpara">
							Ensure that all other schema entries are commented in the configuration. The <code class="literal">automountKey</code> attribute replaces the <code class="literal">cn</code> attribute in the <code class="literal">rfc2307bis</code> schema. Following is an example of an LDAP Data Interchange Format (LDIF) configuration:
						</p><div class="example"><a id="idm139870590052752"/><p class="title"><strong>Example 9.18. LDF Configuration</strong></p><div class="example-contents"><pre class="screen"># extended LDIF
#
# LDAPv3
# base &lt;&gt; with scope subtree
# filter: (&amp;(objectclass=automountMap)(automountMapName=auto.master))
# requesting: ALL
#

# auto.master, example.com
dn: automountMapName=auto.master,dc=example,dc=com
objectClass: top
objectClass: automountMap
automountMapName: auto.master

# extended LDIF
#
# LDAPv3
# base &lt;automountMapName=auto.master,dc=example,dc=com&gt; with scope subtree
# filter: (objectclass=automount)
# requesting: ALL
#

# /home, auto.master, example.com
dn: automountMapName=auto.master,dc=example,dc=com
objectClass: automount
cn: /home

automountKey: /home
automountInformation: auto.home

# extended LDIF
#
# LDAPv3
# base &lt;&gt; with scope subtree
# filter: (&amp;(objectclass=automountMap)(automountMapName=auto.home))
# requesting: ALL
#

# auto.home, example.com
dn: automountMapName=auto.home,dc=example,dc=com
objectClass: automountMap
automountMapName: auto.home

# extended LDIF
#
# LDAPv3
# base &lt;automountMapName=auto.home,dc=example,dc=com&gt; with scope subtree
# filter: (objectclass=automount)
# requesting: ALL
#

# foo, auto.home, example.com
dn: automountKey=foo,automountMapName=auto.home,dc=example,dc=com
objectClass: automount
automountKey: foo
automountInformation: filer.example.com:/export/foo

# /, auto.home, example.com
dn: automountKey=/,automountMapName=auto.home,dc=example,dc=com
objectClass: automount
automountKey: /
automountInformation: filer.example.com:/export/&amp;</pre></div></div></li></ol></div><h4><a id="additional_resources_40"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">rfc2307bis</code> draft: <a class="link" href="https://tools.ietf.org/html/draft-howard-rfc2307bis">https://tools.ietf.org/html/draft-howard-rfc2307bis</a>.
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="setting-read-only-permissions-for-the-root-file-system_assembly_mounting-file-systems"/>Setting read-only permissions for the root file system</h1></div></div></div><p>
				Sometimes, you need to mount the root file system (<code class="literal">/</code>) with read-only permissions. Example use cases include enhancing security or ensuring data integrity after an unexpected system power-off.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="files-and-directories-that-always-retain-write-permissions_setting-read-only-permissions-for-the-root-file-system"/>Files and directories that always retain write permissions</h2></div></div></div><p>
					For the system to function properly, some files and directories need to retain write permissions. When the root file system is mounted in read-only mode, these files are mounted in RAM using the <code class="literal">tmpfs</code> temporary file system.
				</p><p>
					The default set of such files and directories is read from the <code class="literal">/etc/rwtab</code> file, which contains:
				</p><pre class="screen">dirs	/var/cache/man
dirs	/var/gdm
<span class="emphasis"><em>&lt;content truncated&gt;</em></span>

empty	/tmp
empty	/var/cache/foomatic
<span class="emphasis"><em>&lt;content truncated&gt;</em></span>

files	/etc/adjtime
files	/etc/ntp.conf
<span class="emphasis"><em>&lt;content truncated&gt;</em></span></pre><p>
					Entries in the <code class="literal">/etc/rwtab</code> file follow this format:
				</p><pre class="screen"><span class="emphasis"><em><span class="replaceable">copy-method</span></em></span>    <span class="emphasis"><em><span class="replaceable">path</span></em></span></pre><p>
					In this syntax:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Replace <span class="emphasis"><em><span class="replaceable">copy-method</span></em></span> with one of the keywords specifying how the file or directory is copied to tmpfs.
						</li><li class="listitem">
							Replace <span class="emphasis"><em><span class="replaceable">path</span></em></span> with the path to the file or directory.
						</li></ul></div><p>
					The <code class="literal">/etc/rwtab</code> file recognizes the following ways in which a file or directory can be copied to <code class="literal">tmpfs</code>:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">empty</code></span></dt><dd><p class="simpara">
								An empty path is copied to <code class="literal">tmpfs</code>. For example:
							</p><pre class="screen">empty /tmp</pre></dd><dt><span class="term"><code class="literal">dirs</code></span></dt><dd><p class="simpara">
								A directory tree is copied to <code class="literal">tmpfs</code>, empty. For example:
							</p><pre class="screen">dirs /var/run</pre></dd><dt><span class="term"><code class="literal">files</code></span></dt><dd><p class="simpara">
								A file or a directory tree is copied to <code class="literal">tmpfs</code> intact. For example:
							</p><pre class="screen">files /etc/resolv.conf</pre></dd></dl></div><p>
					The same format applies when adding custom paths to <code class="literal">/etc/rwtab.d/</code>.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-the-root-file-system-to-mount-with-read-only-permissions-on-boot_setting-read-only-permissions-for-the-root-file-system"/>Configuring the root file system to mount with read-only permissions on boot</h2></div></div></div><p>
					With this procedure, the root file system is mounted read-only on all following boots.
				</p><h4><a id="procedure_42"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							In the <code class="literal">/etc/sysconfig/readonly-root</code> file, set the <code class="literal">READONLY</code> option to <code class="literal">yes</code>:
						</p><pre class="screen"># Set to 'yes' to mount the file systems as read-only.
READONLY=yes</pre></li><li class="listitem"><p class="simpara">
							Add the <code class="literal">ro</code> option in the root entry (<code class="literal">/</code>) in the <code class="literal">/etc/fstab</code> file:
						</p><pre class="screen">/dev/mapper/luks-c376919e...  /  xfs  x-systemd.device-timeout=0,<span class="strong"><strong>ro</strong></span>  1  1</pre></li><li class="listitem"><p class="simpara">
							Add the <code class="literal">ro</code> option to the <code class="literal">GRUB_CMDLINE_LINUX</code> directive in the <code class="literal">/etc/default/grub</code> file and ensure that the directive does not contain <code class="literal">rw</code>:
						</p><pre class="screen">GRUB_CMDLINE_LINUX="rhgb quiet... <span class="strong"><strong>ro</strong></span>"</pre></li><li class="listitem"><p class="simpara">
							Recreate the GRUB2 configuration file:
						</p><pre class="screen"># grub2-mkconfig -o /boot/grub2/grub.cfg</pre></li><li class="listitem"><p class="simpara">
							If you need to add files and directories to be mounted with write permissions in the <code class="literal">tmpfs</code> file system, create a text file in the <code class="literal">/etc/rwtab.d/</code> directory and put the configuration there.
						</p><p class="simpara">
							For example, to mount the <code class="literal">/etc/example/file</code> file with write permissions, add this line to the <code class="literal">/etc/rwtab.d/example</code> file:
						</p><pre class="screen">files /etc/example/file</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
								Changes made to files and directories in <code class="literal">tmpfs</code> do not persist across boots.
							</p></div></li><li class="listitem">
							Reboot the system to apply the changes.
						</li></ol></div><h4><a id="troubleshooting"/>Troubleshooting</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							If you mount the root file system with read-only permissions by mistake, you can remount it with read-and-write permissions again using the following command:
						</p><pre class="screen"># mount -o remount,rw /</pre></li></ul></div></div></div></div></body></html>