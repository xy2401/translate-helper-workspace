<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 使用Samba作为服务器</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 使用Samba作为服务器</h1></div></div></div><p>Samba在Red Hat Enterprise Linux中实现了服务器消息块（SMB）协议。SMB协议用于访问服务器上的资源，例如文件共享和共享打印机。此外，Samba还实现了Microsoft Windows使用的分布式计算环境远程过程调用（DCE RPC）协议。
		</p><p>您可以将Samba运行为：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Active Directory（AD）或NT4域成员</li><li class="listitem">独立服务器</li><li class="listitem"><p class="simpara">NT4主域控制器（PDC）或备份域控制器（BDC）</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>Red Hat仅在具有支持NT4域的Windows版本的现有安装中支持PDC和BDC模式。Red Hat建议不要设置新的Samba NT4域，因为Windows 7和Windows Server 2008 R2之后的Microsoft操作系统不支持NT4域。
					</p><p>Red Hat不支持将Samba作为AD域控制器（DC）运行。
					</p></div></li></ul></div><p>独立于安装模式，您可以选择共享目录和打印机。这使Samba可以充当文件和打印服务器。
		</p><h2><a id="prerequisites"></a>先决条件</h2><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Red Hat Enterprise Linux 8安装在服务器上。
				</li></ul></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="con_the-samba-services_assembly_using-samba-as-a-server"></a> Samba服务</h1></div></div></div><p>Samba提供以下服务：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">SMBD</code></span></dt><dd><p class="simpara">此服务使用SMB协议提供文件共享和打印服务。此外，该服务还负责资源锁定和连接用户的身份验证。<code class="literal">smb</code> <code class="literal">systemd</code>服务启动和停止<code class="literal">smbd</code>守护程序。
						</p><p class="simpara">要使用<code class="literal">smbd</code>服务，请安装<code class="literal">samba</code>软件包。
						</p></dd><dt><span class="term"><code class="literal">NMBD</code></span></dt><dd><p class="simpara">此服务使用NetBIOS over IPv4协议提供主机名和IP解析。除了名称解析之外， <code class="literal">nmbd</code>服务还可以浏览SMB网络以查找域，工作组，主机，文件共享和打印机。为此，服务要么直接将此信息报告给广播客户端，要么将其转发到本地或主浏览器。<code class="literal">nmb</code> <code class="literal">systemd</code>服务启动和停止<code class="literal">nmbd</code>守护程序。
						</p><p class="simpara">请注意，现代SMB网络使用DNS来解析客户端和IP地址。
						</p><p class="simpara">要使用<code class="literal">nmbd</code>服务，请安装<code class="literal">samba</code>软件包。
						</p></dd><dt><span class="term"><code class="literal">winbindd服务</code></span></dt><dd><p class="simpara">此服务为名称服务交换机（NSS）提供了一个接口，以便在本地系统上使用AD或NT4域用户和组。例如，这使域用户能够对Samba服务器上托管的服务或其他本地服务进行身份验证。<code class="literal">winbind</code> <code class="literal">systemd</code>服务启动和停止<code class="literal">winbindd</code>守护程序。
						</p><p class="simpara">如果将Samba设置为域成员， <code class="literal">winbindd</code>必须在<code class="literal">smbd</code>服务之前启动<code class="literal">winbindd</code> 。否则，域用户和组不可用于本地系统。
						</p><p class="simpara">要使用<code class="literal">winbindd</code>服务，请安装<code class="literal">samba-winbind</code>软件包。
						</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>Red Hat仅支持将Samba作为具有<code class="literal">winbindd</code>服务的服务器运行，以便将域用户和组提供给本地系统。由于某些限制，例如缺少Windows访问控制列表（ACL）支持和NT LAN Manager（NTLM）回退，因此不支持SSSD。
							</p></div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server"></a>使用testparm实用程序验证smb.conf文件</h1></div></div></div><p><code class="literal">testparm</code>实用程序验证<code class="literal">/etc/samba/smb.conf</code>文件中的Samba配置是否正确。该实用程序检测无效的参数和值，但也检测不正确的设置，例如ID映射。如果<code class="literal">testparm</code>报告没有问题，Samba服务将成功加载<code class="literal">/etc/samba/smb.conf</code>文件。请注意， <code class="literal">testparm</code>无法验证配置的服务是否可用或按预期工作。
			</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>Red Hat建议您在每次修改此文件后使用<code class="literal">testparm</code>验证<code class="literal">/etc/samba/smb.conf</code>文件。
				</p></div><h3><a id="procedure"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">以<code class="literal">root</code>用户身份运行<code class="literal">testparm</code>实用程序：</p><pre class="literallayout"># testparm
Load smb config files from /etc/samba/smb.conf
rlimit_max: increasing rlimit_max (1024) to minimum Windows limit (16384)
<span class="strong"><strong>Unknown parameter encountered: "log levell"</strong></span>
Processing section "[example_share]"
Loaded services file OK.
<span class="strong"><strong>ERROR: The idmap range for the domain * (tdb) overlaps with the range of DOMAIN (ad)!</strong></span>

Server role: ROLE_DOMAIN_MEMBER

Press enter to see a dump of your service definitions

# Global parameters
[global]
	...

[example_share]
	...</pre><p class="simpara">前面的示例输出报告不存在的参数和不正确的ID映射配置。
					</p></li><li class="listitem">如果<code class="literal">testparm</code>报告配置中的参数，值或其他错误不正确，请修复问题并再次运行该实用程序。
					</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="con_the-samba-security-services_assembly_using-samba-as-a-server"></a> Samba安全服务</h1></div></div></div><p><code class="literal">/etc/samba/smb.conf</code>文件的<code class="literal">[global]</code>部分中的<code class="literal">security</code>参数管理Samba如何验证连接到该服务的用户。根据您安装Samba的模式，参数必须设置为不同的值：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">在AD域成员上，设置<code class="literal">security = ads</code></span></dt><dd><p class="simpara">在此模式下，Samba使用Kerberos对AD用户进行身份验证。
						</p><p class="simpara">有关将Samba设置为域成员的详细信息，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-samba-as-a-domain-member-server_assembly_using-samba-as-a-server" title="将Samba设置为域成员服务器">“将Samba设置为域成员服务器”一节</a> 。
						</p></dd><dt><span class="term">在独立服务器上，设置<code class="literal">security = user</code></span></dt><dd><p class="simpara">在此模式下，Samba使用本地数据库对连接用户进行身份验证。
						</p><p class="simpara">有关将Samba设置为独立服务器的详细信息，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-samba-as-a-standalone-server_assembly_using-samba-as-a-server" title="将Samba设置为独立服务器">“将Samba设置为独立服务器”一节</a> 。
						</p></dd><dt><span class="term">在NT4 PDC或BDC上，设置<code class="literal">security = user</code></span></dt><dd>在此模式下，Samba将用户身份验证到本地或LDAP数据库。
						</dd><dt><span class="term">在NT4域成员上，设置<code class="literal">security = domain</code></span></dt><dd><p class="simpara">在此模式下，Samba验证将用户连接到NT4 PDC或BDC。您不能在AD域成员上使用此模式。
						</p><p class="simpara">有关将Samba设置为域成员的详细信息，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-samba-as-a-domain-member-server_assembly_using-samba-as-a-server" title="将Samba设置为域成员服务器">“将Samba设置为域成员服务器”一节</a> 。
						</p></dd></dl></div><h3><a id="additional_resources"></a>其他资源</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">请参见<code class="literal">smb.conf(5)</code>手册页中的<code class="literal">security</code>参数说明。
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_setting-up-samba-as-a-standalone-server_assembly_using-samba-as-a-server"></a>将Samba设置为独立服务器</h1></div></div></div><p>您可以将Samba设置为不是域成员的服务器。在此安装模式下，Samba将用户身份验证到本地数据库而不是中央DC。此外，您可以启用访客访问权限，以允许用户无需身份验证即可连接到一个或多个服务。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_setting-up-the-server-configuration-for-the-standalone-server_assembly_setting-up-samba-as-a-standalone-server"></a>设置独立服务器的服务器配置</h2></div></div></div><p>本节介绍如何为Samba独立服务器设置服务器配置。
				</p><h4><a id="procedure_2"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">安装<code class="literal">samba</code>包：</p><pre class="literallayout"># yum install samba</pre></li><li class="listitem"><p class="simpara">编辑<code class="literal">/etc/samba/smb.conf</code>文件并设置以下参数：</p><pre class="literallayout">[global]
	workgroup = <span class="emphasis"><em>Example-WG</em></span>
	netbios name = <span class="emphasis"><em>Server</em></span>
	security = user

	log file = /var/log/samba/%m.log
	log level = 1</pre><p class="simpara">此配置在<code class="literal">Example-WG</code>工作组中定义名为<code class="literal">Server</code>的独立服务器。此外，此配置允许在最低级别（ <code class="literal">1</code> ）上进行日志记录，并且日志文件将存储在<code class="literal">/var/log/samba/</code>目录中。Samba会将<code class="literal">log file</code>参数中的<code class="literal">%m</code>宏扩展为连接客户端的NetBIOS名称。这将为每个客户端启用单个日志文件。
						</p></li><li class="listitem"><p class="simpara">配置文件或打印机共享。看到：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_configuring-file-shares-on-a-samba-server_assembly_using-samba-as-a-server" title="在Samba服务器上配置文件共享">“在Samba服务器上配置文件共享”一节</a>
								</li><li class="listitem">
									<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-samba-as-a-print-server_assembly_using-samba-as-a-server" title="将Samba设置为打印服务器">“将Samba设置为打印服务器”一节</a>
								</li></ul></div></li><li class="listitem"><p class="simpara">验证<code class="literal">/etc/samba/smb.conf</code>文件：</p><pre class="literallayout"># testparm</pre></li><li class="listitem">如果设置需要身份验证的共享，请创建用户帐户。请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_creating-and-enabling-local-user-accounts_assembly_setting-up-samba-as-a-standalone-server" title="创建和启用本地用户帐户">“创建和启用本地用户帐户”一节</a> 。
						</li><li class="listitem"><p class="simpara">使用<code class="literal">firewall-cmd</code>实用程序打开所需的端口并重新加载防火墙配置：</p><pre class="literallayout"># firewall-cmd --permanent --add-port={139/tcp,445/tcp}
# firewall-cmd --reload</pre></li><li class="listitem"><p class="simpara">启动<code class="literal">smb</code>服务：</p><pre class="literallayout"># systemctl start smb</pre><p class="simpara">（可选）启用<code class="literal">smb</code>服务以在系统引导时自动启动：</p><pre class="literallayout"># systemctl enable smb</pre></li></ol></div><h4><a id="additional_resources_2"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关过程中使用的参数的更多详细信息，请参见<code class="literal">smb.conf(5)</code>手册页中的参数说明。
						</li><li class="listitem">
							<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="使用testparm实用程序验证smb.conf文件">“使用testparm实用程序验证smb.conf文件”一节</a>
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_creating-and-enabling-local-user-accounts_assembly_setting-up-samba-as-a-standalone-server"></a>创建和启用本地用户帐户</h2></div></div></div><p>要使用户在连接到共享时进行身份验证，您必须在操作系统和Samba数据库中的Samba主机上创建帐户。Samba要求操作系统帐户验证文件系统对象上的访问控制列表（ACL）和Samba帐户以验证连接用户。
				</p><p>如果使用<code class="literal">passdb backend = tdbsam</code>缺省设置，Samba会将用户帐户存储在<code class="literal">/var/lib/samba/private/passdb.tdb</code>数据库中。
				</p><p>本节中的过程描述如何创建名为<code class="literal">example</code>的本地Samba用户。
				</p><h4><a id="prerequisites_2"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Samba安装配置为独立服务器。
						</li></ul></div><h4><a id="procedure_3"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">创建操作系统帐户：</p><pre class="literallayout"># useradd -M -s /sbin/nologin example</pre><p class="simpara">此命令添加<code class="literal">example</code>帐户而不创建主目录。如果该帐户仅用于对Samba进行身份验证，请将<code class="literal">/sbin/nologin</code>命令指定为shell以防止该帐户在本地登录。
						</p></li><li class="listitem"><p class="simpara">设置操作系统帐户的密码以启用它：</p><pre class="literallayout"># passwd example
Enter new UNIX password: <span class="emphasis"><em>password</em></span>
Retype new UNIX password: <span class="emphasis"><em>password</em></span>
passwd: password updated successfully</pre><p class="simpara">Samba不使用操作系统帐户上设置的密码进行身份验证。但是，您需要设置密码才能启用该帐户。如果帐户被禁用，Samba将拒绝此用户连接时的访问权限。
						</p></li><li class="listitem"><p class="simpara">将用户添加到Samba数据库并为该帐户设置密码：</p><pre class="literallayout"># smbpasswd -a example
New SMB password: <span class="emphasis"><em>password</em></span>
Retype new SMB password: <span class="emphasis"><em>password</em></span>
Added user example.</pre><p class="simpara">使用此帐户连接到Samba共享时，请使用此密码进行身份验证。
						</p></li><li class="listitem"><p class="simpara">启用Samba帐户：</p><pre class="literallayout"># smbpasswd -e example
Enabled user example.</pre></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_setting-up-samba-as-a-domain-member-server_assembly_using-samba-as-a-server"></a>将Samba设置为域成员服务器</h1></div></div></div><p>如果您运行的是AD或NT4域，请使用Samba将您的Red Hat Enterprise Linux服务器作为成员添加到域中以获得以下信息：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">访问其他域成员的域资源</li><li class="listitem">将域用户身份验证为本地服务，例如<code class="literal">sshd</code>
					</li><li class="listitem">共享服务器上托管的目录和打印机，以充当文件和打印服务器</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_joining-samba-to-a-domain_assembly_setting-up-samba-as-a-domain-member-server"></a>将Samba加入域</h2></div></div></div><p>本节介绍如何将Red Hat Enterprise Linux系统加入域。
				</p><h4><a id="procedure_4"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">安装以下包：</p><pre class="literallayout"># yum install realmd oddjob-mkhomedir oddjob samba-winbind-clients \
       samba-winbind samba-common-tools samba</pre></li><li class="listitem"><p class="simpara">要在域成员上共享目录或打印机，请安装<code class="literal">samba</code>软件包：</p><pre class="literallayout"># yum install samba</pre></li><li class="listitem"><p class="simpara">如果要加入AD，请另外安装Winbind Kerberos定位器插件：</p><pre class="literallayout"># yum install samba-winbind-krb5-locator</pre><p class="simpara">此插件使Kerberos能够使用DNS服务记录找到基于AD站点的密钥分发中心（KDC）。
						</p></li><li class="listitem"><p class="simpara">（可选）出于备份目的，重命名现有的<code class="literal">/etc/samba/smb.conf</code> Samba配置文件：</p><pre class="literallayout"># mv /etc/samba/smb.conf /etc/samba/smb.conf.old</pre></li><li class="listitem"><p class="simpara">加入域名。例如，要加入名为<code class="literal">ad.example.com</code>的域：</p><pre class="literallayout"># realm join --client-software=winbind ad.example.com</pre><p class="simpara">使用上一个命令， <code class="literal">realm</code>实用程序自动：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">为<code class="literal">ad.example.com</code>域中的成员身份创建<code class="literal">/etc/samba/smb.conf</code>文件</li><li class="listitem">将用于用户和组查找的<code class="literal">winbind</code>模块添加到<code class="literal">/etc/nsswitch.conf</code>文件中</li><li class="listitem">更新<code class="literal">/etc/pam.d/</code>目录中的可插入验证模块（PAM）配置文件</li><li class="listitem">启动<code class="literal">winbind</code>服务并使服务在系统引导时启动</li></ul></div></li><li class="listitem">（可选）在<code class="literal">/etc/samba/smb.conf</code>文件中设置备用ID映射后端或自定义ID映射设置。有关详细信息，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_samba-id-mapping_assembly_setting-up-samba-as-a-domain-member-server" title="Samba ID映射">“Samba ID映射”一节</a> 。
						</li><li class="listitem">（可选）验证配置。请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-that-samba-was-correctly-joined-as-a-domain-member_assembly_setting-up-samba-as-a-domain-member-server" title="验证Samba是否已正确加入域成员">“验证Samba是否已正确加入域成员”一节</a> 。
						</li><li class="listitem"><p class="simpara">验证<code class="literal">winbind</code>服务是否正在运行：</p><pre class="literallayout"># systemctl status winbind
...
   Active: active (running) since Tue 2018-11-06 19:10:40 CET; 15s ago</pre><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>要使Samba能够查询域用户和组信息，必须在启动<code class="literal">smb</code>之前运行<code class="literal">winbind</code>服务。
							</p></div></li><li class="listitem"><p class="simpara">如果您安装了<code class="literal">samba</code>软件包以共享目录和打印机，请启动<code class="literal">smb</code>服务：</p><pre class="literallayout"># systemctl start smb</pre></li><li class="listitem">（可选）如果要对Active Directory的本地登录进行身份验证，请启用<code class="literal">winbind_krb5_localauth</code>插件。请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#using-the-local-authorization-plug-in-for-mit-kerberos_assembly_setting-up-samba-as-a-domain-member-server" title="使用MIT Kerberos的本地授权插件">“使用MIT Kerberos的本地授权插件”一节</a> 。
						</li></ol></div><h4><a id="additional_resources_3"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">有关<code class="literal">realm</code>实用程序的更多详细信息，请参阅</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">realm(8)</code>手册页</li></ul></div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_verifying-that-samba-was-correctly-joined-as-a-domain-member_assembly_setting-up-samba-as-a-domain-member-server"></a>验证Samba是否已正确加入域成员</h2></div></div></div><p>要验证您是否已将Red Hat Enterprise Linux正确添加到域中，请执行本节中有关域成员的测试。
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="verifying-that-the-operating-system-can-retrieve-domain-user-accounts-and-groups_assembly_setting-up-samba-as-a-domain-member-server"></a>验证操作系统是否可以检索域用户帐户和组</h3></div></div></div><p>使用<code class="literal">getent</code>和<code class="literal">chown</code>实用程序验证操作系统是否可以检索域用户和组</p><h5><a id="procedure_5"></a>程序</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要查询<code class="literal">AD</code>域中的<code class="literal">administrator</code>帐户：</p><pre class="literallayout"># getent passwd "AD\administrator"
AD\administrator:*:10000:10000::/home/administrator@AD:/bin/bash</pre></li><li class="listitem"><p class="simpara">要查询<code class="literal">AD</code>域中<code class="literal">Domain Users</code>组的成员，请执行以下操作：</p><pre class="literallayout"># getent group "AD\Domain Users"
AD\domain users:x:10000:<span class="emphasis"><em>user1</em></span>,<span class="emphasis"><em>user2</em></span></pre></li><li class="listitem"><p class="simpara">验证在设置文件和目录的权限时可以使用域用户和组。例如，要将<code class="literal">/srv/samba/example.txt</code>文件的所有者设置为<code class="literal">AD\administrator</code> ，将该组设置为<code class="literal">AD\Domain Users</code> ：</p><pre class="literallayout"># chown "AD\administrator":"AD\Domain Users" /srv/samba/example.txt</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="verifying-if-ad-domain-users-can-obtain-a-kerberos-ticket_assembly_setting-up-samba-as-a-domain-member-server"></a>验证AD域用户是否可以获取Kerberos票证</h3></div></div></div><p>在AD环境中，用户可以从DC获取Kerberos票证。</p><p>本节中的过程介绍了如何验证<code class="literal">administrator</code>用户是否可以获取Kerberos票证。
					</p><h5><a id="prerequisites_3"></a>先决条件</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">在Samba域成员上安装<code class="literal">krb5-workstation</code>软件包</li></ul></div><h5><a id="procedure_6"></a>程序</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">在AD域成员上，获取<a class="link" href="mailto:administrator@AD.EXAMPLE.COM">administrator@AD.EXAMPLE.COM</a>主体的票证：</p><pre class="literallayout"># kinit administrator@AD.EXAMPLE.COM</pre></li><li class="listitem"><p class="simpara">显示缓存的Kerberos票证：</p><pre class="literallayout"># klist
Ticket cache: KCM:0
Default principal: administrator@AD.EXAMPLE.COM

Valid starting       Expires              Service principal
01.11.2018 10:00:00  01.11.2018 20:00:00  krbtgt/AD.EXAMPLE.COM@AD.EXAMPLE.COM
        renew until 08.11.2018 05:00:00</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="listing-the-available-domains_assembly_setting-up-samba-as-a-domain-member-server"></a>列出可用的域</h3></div></div></div><p>使用<code class="literal">wbinfo</code>实用程序列出通过<code class="literal">winbindd</code>服务可用的所有域。
					</p><h5><a id="procedure_7"></a>程序</h5><pre class="literallayout"># wbinfo --all-domains</pre><p>如果Samba已成功加入域成员，则该命令将显示内置和本地主机名，以及域Samba是包含受信任域的成员。
					</p><div class="example"><a id="idm140241874389552"></a><p class="title"><strong>例2.1。显示可用域</strong></p><div class="example-contents"><p>以下是<code class="literal">wbinfo --all-domains</code>命令输出的示例：</p><pre class="literallayout"># wbinfo --all-domains
BUILTIN
SAMBA-SERVER
AD</pre></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="using-the-local-authorization-plug-in-for-mit-kerberos_assembly_setting-up-samba-as-a-domain-member-server"></a>使用MIT Kerberos的本地授权插件</h2></div></div></div><p><code class="literal">winbind</code>服务为域成员提供Active Directory用户。在某些情况下，管理员希望允许域用户对在域成员上运行的本地服务（例如SSH服务器）进行身份验证。使用Kerberos对域用户进行身份验证时，请启用<code class="literal">winbind_krb5_localauth</code>插件，以通过<code class="literal">winbind</code>服务将Kerberos主体正确映射到Active Directory帐户。
				</p><p>例如，如果Active Directory用户的<code class="literal">sAMAccountName</code>属性设置为<code class="literal">EXAMPLE</code>并且用户尝试使用小写的用户名进行记录，则Kerberos将以大写形式返回用户名。因此，条目与验证失败不匹配。
				</p><p>使用<code class="literal">winbind_krb5_localauth</code>插件，可以正确映射帐户名称。请注意，这仅适用于GSSAPI身份验证，而不适用于获取初始票证授予票证（TGT）。
				</p><h4><a id="prerequisites_4"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Samba配置为Active Directory的成员。
						</li><li class="listitem">Red Hat Enterprise Linux对针对Active Directory的登录尝试进行身份验证。
						</li><li class="listitem"><code class="literal">winbind</code>服务正在运行。
						</li></ul></div><h4><a id="procedure_8"></a>程序</h4><p>编辑<code class="literal">/etc/krb5.conf</code>文件并添加以下部分：</p><pre class="literallayout">[plugins]
localauth = {
     module = winbind:/usr/lib64/samba/krb5/winbind_krb5_localauth.so
     enable_only = winbind
}</pre><h4><a id="additional_resources_4"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">请参见<code class="literal">winbind_krb5_localauth(8)</code>手册页。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assembly_samba-id-mapping_assembly_setting-up-samba-as-a-domain-member-server"></a> Samba ID映射</h2></div></div></div><p>Windows域通过唯一的安全标识符（SID）区分用户和组。但是，Linux需要为每个用户和组提供唯一的UID和GID。如果您将Samba作为域成员运行，则<code class="literal">winbindd</code>服务负责向操作系统提供有关域用户和组的信息。
				</p><p>要使<code class="literal">winbindd</code>服务能够为用户和组提供Linux的唯一ID，您必须在<code class="literal">/etc/samba/smb.conf</code>文件中配置ID映射，以便：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">本地数据库（默认域）</li><li class="listitem">Samba服务器所属的AD或NT4域</li><li class="listitem">用户必须能够访问此Samba服务器上的资源的每个受信任域</li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="con_planning-samba-id-ranges_assembly_samba-id-mapping"></a>规划Samba ID范围</h3></div></div></div><p>无论您是在AD中存储Linux UID和GID，还是将Samba配置为生成它们，每个域配置都需要一个唯一的ID范围，该范围不得与任何其他域重叠。
					</p><div class="warning" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">警告</h3><p>如果设置重叠的ID范围，则Samba无法正常工作。
						</p></div><div class="example"><a id="idm140241853192928"></a><p class="title"><strong>例2.2。独特的ID范围</strong></p><div class="example-contents"><p>以下显示了默认（ <code class="literal">*</code> ）， <code class="literal">AD-DOM</code>和<code class="literal">TRUST-DOM</code>域的非重叠ID映射范围。
						</p><pre class="literallayout">[global]
...
idmap config * : backend = tdb
idmap config * : range = 10000-999999

idmap config AD-DOM:backend = rid
idmap config AD-DOM:range = 2000000-2999999

idmap config TRUST-DOM:backend = rid
idmap config TRUST-DOM:range = 4000000-4999999</pre></div></div><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>您只能为每个域分配一个范围。因此，在域范围之间留出足够的空间。这使您可以在以后增加域扩展范围。
						</p><p>如果稍后为域分配不同的范围，则以前由这些用户和组创建的文件和目录的所有权将丢失。
						</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="con_the-asterisk-default-domain_assembly_samba-id-mapping"></a> *默认域</h3></div></div></div><p>在域环境中，为以下各项添加一个ID映射配置：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Samba服务器所属的域</li><li class="listitem">应该能够访问Samba服务器的每个受信任域</li></ul></div><p>但是，对于所有其他对象，Samba会从默认域中分配ID。这包括：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">本地Samba用户和组</li><li class="listitem">Samba内置帐户和组，例如<code class="literal">BUILTIN\Administrators</code>
							</li></ul></div><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>您必须按照本节中的说明配置默认域，以使Samba正常运行。
						</p></div><p>默认域后端必须是可写的，以永久存储分配的ID。
					</p><p>对于默认域，您可以使用以下后端之一：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">TDB</code></span></dt><dd><p class="simpara">配置默认域以使用<code class="literal">tdb</code>后端时，请设置一个足够大的ID范围，以包括将来创建的对象，这些对象不是已定义的域ID映射配置的一部分。
								</p><p class="simpara">例如，在<code class="literal">/etc/samba/smb.conf</code>文件的<code class="literal">[global]</code>部分中设置以下内容：</p><pre class="literallayout">idmap config * : backend = tdb
idmap config * : range = 10000-999999</pre><p class="simpara">有关更多详细信息，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_using-the-tdb-id-mapping-back-end_assembly_the-different-samba-id-mapping-back-ends" title="使用tdb ID映射后端">“使用tdb ID映射后端”一节</a> 。
								</p></dd><dt><span class="term"><code class="literal">autorid</code></span></dt><dd><p class="simpara">将默认域配置为使用<code class="literal">autorid</code>后端时，为域添加其他ID映射配置是可选的。
								</p><p class="simpara">例如，在<code class="literal">/etc/samba/smb.conf</code>文件的<code class="literal">[global]</code>部分中设置以下内容：</p><pre class="literallayout">idmap config * : backend = autorid
idmap config * : range = 10000-999999</pre><p class="simpara">有关更多详细信息，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_using-the-autorid-id-mapping-back-end_assembly_the-different-samba-id-mapping-back-ends" title="使用autorid ID映射后端">“使用autorid ID映射后端”一节</a> 。
								</p></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assembly_the-different-samba-id-mapping-back-ends_assembly_setting-up-samba-as-a-domain-member-server"></a>不同的Samba ID映射后端结束</h2></div></div></div><p>Samba为特定配置提供不同的ID映射后端。最常用的后端是：</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th valign="top" style="text-align:left">后端</th><th valign="top" style="text-align:left">用例</th></tr></thead><tbody><tr><td valign="top" style="text-align:left"> <p>
									<code class="literal">TDB</code>
								</p>
								 </td><td valign="top" style="text-align:left"> <p>仅限<code class="literal">*</code>默认域</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>
									<code class="literal">广告</code>
								</p>
								 </td><td valign="top" style="text-align:left"> <p>仅限AD域</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>
									<code class="literal">摆脱</code>
								</p>
								 </td><td valign="top" style="text-align:left"> <p>AD和NT4域</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>
									<code class="literal">autorid</code>
								</p>
								 </td><td valign="top" style="text-align:left"> <p>AD，NT4和<code class="literal">*</code>默认域</p>
								 </td></tr></tbody></table></div><p>以下部分介绍了优点，推荐的使用后端的方案以及如何配置。
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_using-the-tdb-id-mapping-back-end_assembly_the-different-samba-id-mapping-back-ends"></a>使用tdb ID映射后端</h3></div></div></div><p><code class="literal">winbindd</code>服务默认使用可写<code class="literal">tdb</code> ID映射后端来存储安全标识符（SID），UID和GID映射表。这包括本地用户，组和内置主体。
					</p><p>仅将此后端用于<code class="literal">*</code>默认域。例如：</p><pre class="literallayout">idmap config * : backend = tdb
idmap config * : range = 10000-999999</pre><h5><a id="additional_resources_5"></a>其他资源</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#con_the-asterisk-default-domain_assembly_samba-id-mapping" title="*默认域">称为“*默认域”的部分</a> 。
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_using-the-ad-id-mapping-back-end_assembly_the-different-samba-id-mapping-back-ends"></a>使用广告ID映射后端</h3></div></div></div><p>本节介绍如何配置Samba AD成员以使用后端<code class="literal">ad</code> ID映射。
					</p><p><code class="literal">ad</code> ID映射后端实现了一个只读API，用于从AD读取帐户和组信息。这提供了以下好处：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">所有用户和组设置都集中存储在AD中。</li><li class="listitem">在使用此后端的所有Samba服务器上，用户和组ID是一致的。
							</li><li class="listitem">ID不存储在可能损坏的本地数据库中，因此文件所有权不会丢失。
							</li></ul></div><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p><code class="literal">ad</code> ID映射后端不支持具有单向信任的Active Directory域。如果使用单向信任在Active Directory中配置域成员，请使用以下ID映射后端之一： <code class="literal">tdb</code> ， <code class="literal">rid</code>或<code class="literal">autorid</code> 。
						</p></div><p>广告后端从AD读取以下属性：</p><div class="informaltable"><a id="table_proc_using-the-ad-id-mapping-back-end_assembly_the-different-samba-id-mapping-back-ends"></a><table border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th valign="top" style="text-align:left">AD属性名称</th><th valign="top" style="text-align:left">对象类型</th><th valign="top" style="text-align:left">映射到</th></tr></thead><tbody><tr><td valign="top" style="text-align:left"> <p>
										<code class="literal">sAMAccountName赋</code>
									</p>
									 </td><td valign="top" style="text-align:left"> <p>用户和组</p>
									 </td><td valign="top" style="text-align:left"> <p>用户名或组名，具体取决于对象</p>
									 </td></tr><tr><td valign="top" style="text-align:left"> <p>
										<code class="literal">uidNumber</code>
									</p>
									 </td><td valign="top" style="text-align:left"> <p>用户</p>
									 </td><td valign="top" style="text-align:left"> <p>用户ID（UID）</p>
									 </td></tr><tr><td valign="top" style="text-align:left"> <p>
										<code class="literal">的gidNumber</code>
									</p>
									 </td><td valign="top" style="text-align:left"> <p>组</p>
									 </td><td valign="top" style="text-align:left"> <p>组ID（GID）</p>
									 </td></tr><tr><td valign="top" style="text-align:left"> <p>
										<code class="literal">loginShell</code> <a href="#ftn.sambaloginshell" class="footnote" id="sambaloginshell"><sup class="footnote">[a]</sup></a>
									</p>
									 </td><td valign="top" style="text-align:left"> <p>用户</p>
									 </td><td valign="top" style="text-align:left"> <p>用户shell的路径</p>
									 </td></tr><tr><td valign="top" style="text-align:left"> <p>
										<code class="literal">unixHomeDirectory</code> <a href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#ftn.sambaloginshell" class="footnoteref"><sup class="footnoteref">[a]</sup></a>
									</p>
									 </td><td valign="top" style="text-align:left"> <p>用户</p>
									 </td><td valign="top" style="text-align:left"> <p>用户主目录的路径</p>
									 </td></tr><tr><td valign="top" style="text-align:left"> <p>
										<code class="literal">primaryGroupID</code> <a href="#ftn.samba_primarygroupid" class="footnote" id="samba_primarygroupid"><sup class="footnote">[b]</sup></a>
									</p>
									 </td><td valign="top" style="text-align:left"> <p>用户</p>
									 </td><td valign="top" style="text-align:left"> <p>主要组ID</p>
									 </td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div id="ftn.sambaloginshell" class="footnote"><p><a href="#sambaloginshell" class="simpara"><sup class="simpara">[a]</sup></a>如果设置了<code class="literal">idmap config <span class="emphasis"><em>DOMAIN</em></span> :unix_nss_info = yes</code>则Samba只读取此属性<code class="literal">idmap config <span class="emphasis"><em>DOMAIN</em></span> :unix_nss_info = yes</code> 。
										</p></div><div id="ftn.samba_primarygroupid" class="footnote"><p><a href="#samba_primarygroupid" class="simpara"><sup class="simpara">[b]</sup></a>如果设置了<code class="literal">idmap config <span class="emphasis"><em>DOMAIN</em></span> :unix_primary_group = yes</code> Samba只会读取此属性<code class="literal">idmap config <span class="emphasis"><em>DOMAIN</em></span> :unix_primary_group = yes</code> 。
										</p></div></td></tr></tbody></table></div><h5><a id="prerequisites_5"></a>先决条件</h5><p>要使用<code class="literal">ad</code> ID映射后端：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">用户和组都必须在AD中设置唯一ID，并且ID必须在<code class="literal">/etc/samba/smb.conf</code>文件中配置的范围内。ID超出范围的对象将无法在Samba服务器上使用。
							</li><li class="listitem">用户和组必须具有在AD中设置的所有必需属性。如果缺少必需的属性，则Samba服务器上将无法使用该用户或组。所需的属性取决于您的配置。
							</li></ul></div><h5><a id="procedure_9"></a>程序</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">编辑<code class="literal">/etc/samba/smb.conf</code>文件中的<code class="literal">[global]</code>部分：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">如果默认域（ <code class="literal">*</code> ）不存在，请添加ID映射配置。例如：</p><pre class="literallayout">idmap config * : backend = tdb
idmap config * : range = <span class="emphasis"><em>10000-999999</em></span></pre></li><li class="listitem"><p class="simpara">为AD域启用<code class="literal">ad</code> ID映射后端：</p><pre class="literallayout">idmap config <span class="emphasis"><em>DOMAIN</em></span> : backend = ad</pre></li><li class="listitem"><p class="simpara">设置分配给AD域中的用户和组的ID范围。例如：</p><pre class="literallayout">idmap config <span class="emphasis"><em>DOMAIN</em></span> : range = <span class="emphasis"><em>2000000-2999999</em></span></pre><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>该范围不得与此服务器上的任何其他域配置重叠。此外，必须将范围设置得足够大，以包括将来分配的所有ID。有关更多详细信息，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#con_planning-samba-id-ranges_assembly_samba-id-mapping" title="规划Samba ID范围">“规划Samba ID范围”一节</a> 。
										</p></div></li><li class="listitem"><p class="simpara">设置Samba在从AD读取属性时使用<a class="link" href="https://tools.ietf.org/html/rfc2307">RFC 2307</a>架构：</p><pre class="literallayout">idmap config <span class="emphasis"><em>DOMAIN</em></span> : schema_mode = rfc2307</pre></li><li class="listitem"><p class="simpara">要使Samba能够从相应的AD属性中读取登录shell和用户主目录的路径，请设置：</p><pre class="literallayout">idmap config <span class="emphasis"><em>DOMAIN</em></span> : unix_nss_info = yes</pre><p class="simpara">或者，您可以设置应用于所有用户的统一域范围的主目录路径和登录shell。例如：</p><pre class="literallayout">template shell = <span class="emphasis"><em>/bin/bash</em></span>
template homedir = <span class="emphasis"><em>/home/%U</em></span></pre></li><li class="listitem"><p class="simpara">默认情况下，Samba使用用户对象的<code class="literal">primaryGroupID</code>属性作为Linux上用户的主要组。或者，您可以将Samba配置为使用<code class="literal">gidNumber</code>属性中设置的值：</p><pre class="literallayout">idmap config <span class="emphasis"><em>DOMAIN</em></span> : unix_primary_group = yes</pre></li></ol></div></li><li class="listitem"><p class="simpara">验证<code class="literal">/etc/samba/smb.conf</code>文件：</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">重新加载Samba配置：</p><pre class="literallayout"># smbcontrol all reload-config</pre></li><li class="listitem">验证设置是否按预期工作。请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#verifying-that-the-operating-system-can-retrieve-domain-user-accounts-and-groups_assembly_setting-up-samba-as-a-domain-member-server" title="验证操作系统是否可以检索域用户帐户和组">“验证操作系统是否可以检索域用户帐户和组”一节</a> 。
							</li></ol></div><h5><a id="additional_resources_6"></a>其他资源</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#con_the-asterisk-default-domain_assembly_samba-id-mapping" title="*默认域">名为“*默认域名”的部分</a>
							</li><li class="listitem">有关过程中使用的参数的更多详细信息，请参见<code class="literal">smb.conf(5)</code>和<code class="literal">idmap_ad(8)</code>手册页。
							</li><li class="listitem">有关变量替换的详细信息，请参见<code class="literal">smb.conf(5)</code>手册页中的<code class="literal">VARIABLE SUBSTITUTIONS</code>部分。
							</li><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="使用testparm实用程序验证smb.conf文件">“使用testparm实用程序验证smb.conf文件”一节</a>
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_using-the-rid-id-mapping-back-end_assembly_the-different-samba-id-mapping-back-ends"></a>使用rid ID映射后端</h3></div></div></div><p>本节介绍如何配置Samba域成员以使用<code class="literal">rid</code> ID映射后端。
					</p><p>Samba可以使用Windows SID的相对标识符（RID）在Red Hat Enterprise Linux上生成ID。
					</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>RID是SID的最后一部分。例如，如果用户的SID是<code class="literal">S-1-5-21-5421822485-1151247151-421485315-30014</code> ，则<code class="literal">30014</code>是对应的RID。</p></div><p><code class="literal">rid</code> ID映射后端实现了一个只读API，用于根据AD和NT4域的算法映射方案计算帐户和组信息。配置后端时，必须在<code class="literal">idmap config <span class="emphasis"><em>DOMAIN</em></span> : <span class="emphasis"><em>range</em></span></code>参数中设置最低和最高RID。Samba不会映射RID低于或高于此参数中设置的用户或组。
					</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>作为只读后端， <code class="literal">rid</code>无法分配新ID，例如<code class="literal">BUILTIN</code>组。因此，请勿将此后端用于<code class="literal">*</code>默认域。
						</p></div><h5><a id="benefits_of_using_the_rid_back_end"></a>使用摆脱端的好处</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">具有配置范围内的RID的所有域用户和组在域成员上自动可用。
							</li><li class="listitem">您无需手动分配ID，主目录和登录shell。
							</li></ul></div><h5><a id="drawbacks_of_using_the_rid_back_end"></a>使用摆脱端的缺点</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">所有域用户都获得相同的登录shell和主目录。但是，您可以使用变量。
							</li><li class="listitem">如果所有使用具有相同ID范围设置的<code class="literal">rid</code> back end，则用户和组ID在Samba域成员中仅相同。
							</li><li class="listitem">您不能排除个人用户或组在域成员上的可用性。仅排除配置范围之外的用户和组。
							</li><li class="listitem">根据<code class="literal">winbindd</code>服务用于计算ID的公式，如果不同域中的对象具有相同的RID，则可以在多域环境中发生重复ID。</li></ul></div><h5><a id="procedure_10"></a>程序</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">编辑<code class="literal">/etc/samba/smb.conf</code>文件中的<code class="literal">[global]</code>部分：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">如果默认域（ <code class="literal">*</code> ）不存在，请添加ID映射配置。例如：</p><pre class="literallayout">idmap config * : backend = tdb
idmap config * : range = <span class="emphasis"><em>10000-999999</em></span></pre></li><li class="listitem"><p class="simpara">为域启用<code class="literal">rid</code> ID映射后端：</p><pre class="literallayout">idmap config <span class="emphasis"><em>DOMAIN</em></span> : backend = rid</pre></li><li class="listitem"><p class="simpara">设置一个足够大的范围，以包括将来分配的所有RID。例如：</p><pre class="literallayout">idmap config <span class="emphasis"><em>DOMAIN</em></span> : range = <span class="emphasis"><em>2000000-2999999</em></span></pre><p class="simpara">Samba忽略其域中的RID不在该范围内的用户和组。
									</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>该范围不得与此服务器上的任何其他域配置重叠。有关更多详细信息，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#con_planning-samba-id-ranges_assembly_samba-id-mapping" title="规划Samba ID范围">“规划Samba ID范围”一节</a> 。
										</p></div></li><li class="listitem"><p class="simpara">设置将分配给所有映射用户的shell和主目录路径。例如：</p><pre class="literallayout">template shell = <span class="emphasis"><em>/bin/bash</em></span>
template homedir = <span class="emphasis"><em>/home/%U</em></span></pre></li></ol></div></li><li class="listitem"><p class="simpara">验证<code class="literal">/etc/samba/smb.conf</code>文件：</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">重新加载Samba配置：</p><pre class="literallayout"># smbcontrol all reload-config</pre><p class="simpara">验证设置是否按预期工作。请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#verifying-that-the-operating-system-can-retrieve-domain-user-accounts-and-groups_assembly_setting-up-samba-as-a-domain-member-server" title="验证操作系统是否可以检索域用户帐户和组">“验证操作系统是否可以检索域用户帐户和组”一节</a> 。
							</p></li></ol></div><h5><a id="additional_resources_7"></a>其他资源</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#con_the-asterisk-default-domain_assembly_samba-id-mapping" title="*默认域">名为“*默认域名”的部分</a>
							</li><li class="listitem">有关变量替换的详细信息，请参见<code class="literal">smb.conf(5)</code>手册页中的<code class="literal">VARIABLE SUBSTITUTIONS</code>部分。
							</li><li class="listitem">有关Samba如何从RID计算本地ID的详细信息，请参阅<code class="literal">idmap_rid(8)</code>手册页。
							</li><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="使用testparm实用程序验证smb.conf文件">“使用testparm实用程序验证smb.conf文件”一节</a>
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_using-the-autorid-id-mapping-back-end_assembly_the-different-samba-id-mapping-back-ends"></a>使用autorid ID映射后端</h3></div></div></div><p>本节介绍如何配置Samba域成员以使用<code class="literal">autorid</code> ID映射后端。
					</p><p><code class="literal">autorid</code>后端的工作方式类似于<code class="literal">rid</code> ID映射后端，但可以自动为不同的域分配ID。这使您可以在以下情况下使用<code class="literal">autorid</code>后端：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">仅适用于<code class="literal">*</code>默认域</li><li class="listitem">对于<code class="literal">*</code>默认域和其他域，无需为每个其他域创建ID映射配置</li><li class="listitem">仅适用于特定域</li></ul></div><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>如果对默认域使用<code class="literal">autorid</code>则为域添加其他ID映射配置是可选的。
						</p></div><p>本节的部分内容是从Samba Wiki中发布的<a class="link" href="https://wiki.samba.org/index.php/Idmap_config_autorid">idmap config autorid</a>文档中采用的。许可证： <a class="link" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> 。作者和贡献者：请参阅Wiki页面上的<a class="link" href="https://wiki.samba.org/index.php?title=Idmap_config_autorid&amp;action=history">历史记录</a>选项卡。
					</p><h5><a id="benefits_of_using_the_autorid_back_end"></a>使用autorid后端的好处</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">计算的UID和GID在配置范围内的所有域用户和组在域成员上自动可用。
							</li><li class="listitem">您无需手动分配ID，主目录和登录shell。
							</li><li class="listitem">即使多域环境中的多个对象具有相同的RID，也没有重复的ID。</li></ul></div><h5><a id="drawbacks"></a>缺点</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Samba域成员中的用户和组ID不同。
							</li><li class="listitem">所有域用户都获得相同的登录shell和主目录。但是，您可以使用变量。
							</li><li class="listitem">您不能排除个人用户或组在域成员上的可用性。仅排除计算的UID或GID超出配置范围的用户和组。
							</li></ul></div><h5><a id="procedure_11"></a>程序</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">编辑<code class="literal">/etc/samba/smb.conf</code>文件中的<code class="literal">[global]</code>部分：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">为<code class="literal">*</code> default域启用<code class="literal">autorid</code> ID映射后端：</p><pre class="literallayout">idmap config * : backend = autorid</pre></li><li class="listitem"><p class="simpara">设置一个足够大的范围，以便为所有现有和将来的对象分配ID。例如：</p><pre class="literallayout">idmap config * : range = <span class="emphasis"><em>10000-999999</em></span></pre><p class="simpara">Samba忽略此域中计算的ID不在范围内的用户和组。
									</p><div class="warning" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">警告</h3><p>设置范围并且Samba开始使用它后，您只能增加范围的上限。对范围的任何其他更改都可能导致新的ID分配，从而导致丢失文件所有权。
										</p></div></li><li class="listitem"><p class="simpara">（可选）设置范围大小。例如：</p><pre class="literallayout">idmap config * : rangesize = <span class="emphasis"><em>200000</em></span></pre><p class="simpara">Samba为每个域的对象分配此数量的连续ID，直到获取<code class="literal">idmap config * : <span class="emphasis"><em>range</em></span></code>参数中设置的范围内的所有ID。
									</p></li><li class="listitem"><p class="simpara">设置将分配给所有映射用户的shell和主目录路径。例如：</p><pre class="literallayout">template shell = <span class="emphasis"><em>/bin/bash</em></span>
template homedir = <span class="emphasis"><em>/home/%U</em></span></pre></li><li class="listitem"><p class="simpara">（可选）为域添加其他ID映射配置。如果没有可用的单个域配置，Samba将使用先前配置的<code class="literal">*</code>默认域中的<code class="literal">autorid</code>后端设置计算ID。
									</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>如果为各个域配置其他后端，则所有ID映射配置的范围不得重叠。有关更多详细信息，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#con_planning-samba-id-ranges_assembly_samba-id-mapping" title="规划Samba ID范围">“规划Samba ID范围”一节</a> 。
										</p></div></li></ol></div></li><li class="listitem"><p class="simpara">验证<code class="literal">/etc/samba/smb.conf</code>文件：</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">重新加载Samba配置：</p><pre class="literallayout"># smbcontrol all reload-config</pre></li><li class="listitem">验证设置是否按预期工作。请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#verifying-that-the-operating-system-can-retrieve-domain-user-accounts-and-groups_assembly_setting-up-samba-as-a-domain-member-server" title="验证操作系统是否可以检索域用户帐户和组">“验证操作系统是否可以检索域用户帐户和组”一节</a> 。
							</li></ol></div><h5><a id="additional_resources_8"></a>其他资源</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关后端如何计算ID的详细信息，请参阅<code class="literal">idmap_autorid(8)</code>手册页中的<code class="literal">THE MAPPING FORMULAS</code>部分。
							</li><li class="listitem">有关使用<code class="literal">idmap config</code> <code class="literal">rangesize</code>参数的详细信息，请参阅<code class="literal">idmap_autorid(8)</code>手册页中的<code class="literal">rangesize</code>参数说明。
							</li><li class="listitem">有关变量替换的详细信息，请参见<code class="literal">smb.conf(5)</code>手册页中的<code class="literal">VARIABLE SUBSTITUTIONS</code>部分。
							</li><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="使用testparm实用程序验证smb.conf文件">“使用testparm实用程序验证smb.conf文件”一节</a>
							</li></ul></div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_configuring-file-shares-on-a-samba-server_assembly_using-samba-as-a-server"></a>在Samba服务器上配置文件共享</h1></div></div></div><p>要将Samba用作文件服务器，请将共享添加到独立服务器或域成员配置的<code class="literal">/etc/samba/smb.conf</code>文件中。
			</p><p>您可以添加使用以下任一项的共享：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">POSIX ACL。请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-a-share-that-uses-posix-acls_assembly_configuring-file-shares-on-a-samba-server" title="设置使用POSIX ACL的共享">“设置使用POSIX ACL的共享”一节</a> 。
					</li><li class="listitem">细粒度的Windows ACL。请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-a-share-that-uses-windows-acls_assembly_configuring-file-shares-on-a-samba-server" title="设置使用Windows ACL的共享">“设置使用Windows ACL的共享”一节</a> 。
					</li></ul></div><h3><a id="prerequisites-assembly_configuring-file-shares-on-a-samba-server"></a>先决条件</h3><p>Samba已设置为以下模式之一：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<a class="link" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-samba-as-a-standalone-server_assembly_using-samba-as-a-server" title="将Samba设置为独立服务器">独立服务器</a>
					</li><li class="listitem">
						<a class="link" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-samba-as-a-domain-member-server_assembly_using-samba-as-a-server" title="将Samba设置为域成员服务器">域成员</a>
					</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assembly_setting-up-a-share-that-uses-posix-acls_assembly_configuring-file-shares-on-a-samba-server"></a>设置使用POSIX ACL的共享</h2></div></div></div><p>作为Linux服务，Samba支持与POSIX ACL共享。它们使您能够使用实用程序（例如<code class="literal">chmod</code>在Samba服务器上本地管理权限。如果共享存储在支持扩展属性的文件系统上，则可以定义具有多个用户和组的ACL。
				</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>如果需要使用细粒度Windows ACL，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-a-share-that-uses-windows-acls_assembly_configuring-file-shares-on-a-samba-server" title="设置使用Windows ACL的共享">“设置使用Windows ACL的共享”一节</a> 。
					</p></div><p>本节的部分内容是从Samba Wiki中发布的<a class="link" href="https://wiki.samba.org/index.php/Setting_up_a_Share_Using_POSIX_ACLs">使用POSIX ACL设置共享</a>文档中采用的。许可证： <a class="link" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> 。作者和贡献者：请参阅Wiki页面上的<a class="link" href="https://wiki.samba.org/index.php?title=Setting_up_a_Share_Using_POSIX_ACLs&amp;action=history">历史记录</a>选项卡。
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_adding-a-share-that-uses-posix-acls_assembly_setting-up-a-share-that-uses-posix-acls"></a>添加使用POSIX ACL的共享</h3></div></div></div><p>本节介绍如何创建名为<code class="literal">example</code>的共享，该共享提供<code class="literal">/srv/samba/example/</code>目录的内容，并使用POSIX ACL。
					</p><h5><a id="procedure_12"></a>程序</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">如果该文件夹不存在，请创建该文件夹。例如：</p><pre class="literallayout"># mkdir -p /srv/samba/example/</pre></li><li class="listitem"><p class="simpara">如果在<code class="literal">enforcing</code>模式下运行SELinux，请在目录上设置<code class="literal">samba_share_t</code>上下文：</p><pre class="literallayout"># semanage fcontext -a -t samba_share_t "/srv/samba/example(/.*)?"
# restorecon -Rv /srv/samba/example/</pre></li><li class="listitem">在目录上设置文件系统ACL。请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-a-share-that-uses-posix-acls_assembly_configuring-file-shares-on-a-samba-server" title="设置使用POSIX ACL的共享">“设置使用POSIX ACL的共享”一节</a> 。
							</li><li class="listitem"><p class="simpara">将示例共享添加到<code class="literal">/etc/samba/smb.conf</code>文件中。例如，要添加共享写入启用：</p><pre class="literallayout">[example]
	path = /srv/samba/example/
	read only = no</pre><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>无论文件系统ACL如何;如果未设置<code class="literal">read only = no</code> ，Samba将以只读模式共享目录。
								</p></div></li><li class="listitem"><p class="simpara">验证<code class="literal">/etc/samba/smb.conf</code>文件：</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">打开所需的端口并使用<code class="literal">firewall-cmd</code>实用程序重新加载防火墙配置：</p><pre class="literallayout"># firewall-cmd --permanent --add-service=samba
# firewall-cmd --reload</pre></li><li class="listitem"><p class="simpara">重启<code class="literal">smb</code>服务：</p><pre class="literallayout"># systemctl restart smb</pre></li><li class="listitem"><p class="simpara">（可选）启用smb服务以在引导时自动启动：</p><pre class="literallayout"># systemctl enable smb</pre></li></ol></div><h5><a id="additional_resources_9"></a>其他资源</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="使用testparm实用程序验证smb.conf文件">“使用testparm实用程序验证smb.conf文件”一节</a>
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="assembly_setting-acls-on-a-share-that-uses-posix-acls_assembly_setting-up-a-share-that-uses-posix-acls"></a>在使用POSIX ACL的共享上设置ACL</h3></div></div></div><p>本节介绍如何在使用POSIX ACL的共享上设置ACL。
					</p><p>使用POSIX ACL的股票支持：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">标准Linux ACL。有关详细信息，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_setting-standard-linux-acls_assembly_setting-acls-on-a-share-that-uses-posix-acls" title="设置标准Linux ACL">“设置标准Linux ACL”一节</a> 。
							</li><li class="listitem">扩展ACL。有关详细信息，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_setting-extended-acls_assembly_setting-acls-on-a-share-that-uses-posix-acls" title="设置扩展ACL">“设置扩展ACL”一节</a> 。
							</li></ul></div><h5><a id="prerequisites-assembly_setting-acls-on-a-share-that-uses-posix-acls"></a>先决条件</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">已根据<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_adding-a-share-that-uses-posix-acls_assembly_setting-up-a-share-that-uses-posix-acls" title="Adding a share that uses POSIX ACLs">“添加使用POSIX ACL的共享”一节</a>设置了<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_adding-a-share-that-uses-posix-acls_assembly_setting-up-a-share-that-uses-posix-acls" title="添加使用POSIX ACL的共享">POSIX ACL的共享</a> 。
							</li></ul></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="proc_setting-standard-linux-acls_assembly_setting-acls-on-a-share-that-uses-posix-acls"></a>设置标准Linux ACL</h4></div></div></div><p>Linux上的标准ACL支持为一个所有者，一个组和所有其他未定义用户设置权限。您可以使用<code class="literal">chown</code> ， <code class="literal">chgrp</code>和<code class="literal">chmod</code>实用程序来更新ACL。如果需要精确控制，则使用更复杂的POSIX ACL，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_setting-extended-acls_assembly_setting-acls-on-a-share-that-uses-posix-acls" title="设置扩展ACL">“设置扩展ACL”一节</a> 。
						</p><p>以下过程将<code class="literal">/srv/samba/example/</code>目录的所有者设置为<code class="literal">root</code>用户，授予<code class="literal">Domain Users</code>组的读写权限，并拒绝所有其他用户的访问权限。
						</p><h6><a id="procedure_13"></a>程序</h6><pre class="literallayout"># chown root:"Domain Users" /srv/samba/example/
# chmod 2770 /srv/samba/example/</pre><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>在目录上启用set-group-ID（SGID）位会自动将所有新文件和子目录的默认组设置为目录组的默认组，而不是将其设置为创建该目录的用户的主组的通常行为。新目录条目。
							</p></div><h6><a id="additional_resources_10"></a>其他资源</h6><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关权限的更多详细信息，请参阅<code class="literal">chown(1)</code>和<code class="literal">chmod(1)</code>手册页。
								</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="proc_setting-extended-acls_assembly_setting-acls-on-a-share-that-uses-posix-acls"></a>设置扩展ACL</h4></div></div></div><p>如果存储共享目录的文件系统支持扩展ACL，则可以使用它们来设置复杂权限。扩展ACL可以包含多个用户和组的权限。
						</p><p>扩展POSIX ACL使您可以配置具有多个用户和组的复杂ACL。但是，您只能设置以下权限：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">无法访问</li><li class="listitem">读取权限</li><li class="listitem">写访问权限</li><li class="listitem">完全控制</li></ul></div><p>如果需要细粒度Windows权限（例如“ <code class="literal">Create folder / append data</code> ，请将共享配置为使用Windows ACL。请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-a-share-that-uses-windows-acls_assembly_configuring-file-shares-on-a-samba-server" title="设置使用Windows ACL的共享">“设置使用Windows ACL的共享”一节</a> 。
						</p><p>以下过程说明如何在共享上启用扩展ACL。此外，它还包含有关设置扩展ACL的示例。
						</p><h6><a id="procedure_14"></a>程序</h6><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">在<code class="literal">/etc/samba/smb.conf</code>文件的share's部分中启用以下参数以启用扩展ACL的ACL继承：</p><pre class="literallayout">inherit acls = yes</pre><p class="simpara">有关详细信息，请参阅<code class="literal">smb.conf(5</code> ）手册页中的参数说明。
								</p></li><li class="listitem"><p class="simpara">重启<code class="literal">smb</code>服务：</p><pre class="literallayout"># systemctl restart smb</pre></li><li class="listitem"><p class="simpara">在目录上设置ACL。例如：</p><div class="example"><a id="ex.setting-extended-acls_proc_setting-extended-acls_assembly_setting-acls-on-a-share-that-uses-posix-acls"></a><p class="title"><strong>例2.3。设置扩展ACL</strong></p><div class="example-contents"><p>以下过程为<code class="literal">Domain Admins</code>组设置读取，写入和执行权限，为<code class="literal">Domain Users</code>组设置读取和执行权限，并拒绝访问<code class="literal">/srv/samba/example/</code>目录中的所有其他人：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">禁用对主要用户帐户组的自动授予权限：</p><pre class="literallayout"># setfacl -m group::--- /srv/samba/example/
# setfacl -m default:group::--- /srv/samba/example/</pre><p class="simpara">该目录的主要组<code class="literal">CREATOR GROUP</code>映射到动态<code class="literal">CREATOR GROUP</code>主体。在Samba共享上使用扩展POSIX ACL时，会自动添加此主体，但您无法将其删除。
											</p></li><li class="listitem"><p class="simpara">设置目录的权限：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">授予<code class="literal">Domain Admins</code>组读取，写入和执行权限：</p><pre class="literallayout"># setfacl -m group:"<span class="emphasis"><em>DOMAIN</em></span>\Domain Admins":rwx /srv/samba/example/</pre></li><li class="listitem"><p class="simpara">授予<code class="literal">Domain Users</code>组的读取和执行权限：</p><pre class="literallayout"># setfacl -m group:"<span class="emphasis"><em>DOMAIN</em></span>\Domain Users":r-x /srv/samba/example/</pre></li><li class="listitem"><p class="simpara">设置<code class="literal">other</code> ACL条目的权限，拒绝访问与其他ACL条目不匹配的用户：</p><pre class="literallayout"># setfacl -R -m other::--- /srv/samba/example/</pre></li></ol></div><p class="simpara">这些设置仅适用于此目录。在Windows中，这些ACL映射到<code class="literal">This folder only</code>模式。
											</p></li><li class="listitem"><p class="simpara">要使在此目录中创建的新文件系统对象继承上一步中设置的权限，请执行以下操作：</p><pre class="literallayout"># setfacl -m default:group:"<span class="emphasis"><em>DOMAIN</em></span>\Domain Admins":rwx /srv/samba/example/
# setfacl -m default:group:"<span class="emphasis"><em>DOMAIN</em></span>\Domain Users":r-x /srv/samba/example/
# setfacl -m default:other::--- /srv/samba/example/</pre><p class="simpara">使用这些设置，主体的<code class="literal">This folder only</code>模式现在设置为此<code class="literal">This folder, subfolders, and files</code> 。
											</p></li></ol></div><p>Samba将过程中设置的权限映射到以下Windows ACL：</p><div class="informaltable"><a id="table_example_proc_setting-extended-acls_assembly_setting-acls-on-a-share-that-uses-posix-acls"></a><table border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th valign="top" style="text-align:left">主要</th><th valign="top" style="text-align:left">访问</th><th valign="top" style="text-align:left">适用于</th></tr></thead><tbody><tr><td valign="top" style="text-align:left"> <p>
														<span class="emphasis"><em>域</em></span> \域管理员</p>
													 </td><td valign="top" style="text-align:left"> <p>完全控制</p>
													 </td><td valign="top" style="text-align:left"> <p>此文件夹，子文件夹和文件</p>
													 </td></tr><tr><td valign="top" style="text-align:left"> <p>
														<span class="emphasis"><em>域</em></span> \域用户</p>
													 </td><td valign="top" style="text-align:left"> <p>阅读并执行</p>
													 </td><td valign="top" style="text-align:left"> <p>此文件夹，子文件夹和文件</p>
													 </td></tr><tr><td valign="top" style="text-align:left"> <p>
														<code class="literal">Everyone</code> <a href="#ftn.idm140241875041792" class="footnote" id="idm140241875041792"><sup class="footnote">[一]</sup></a>
													</p>
													 </td><td valign="top" style="text-align:left"> <p>没有</p>
													 </td><td valign="top" style="text-align:left"> <p>此文件夹，子文件夹和文件</p>
													 </td></tr><tr><td valign="top" style="text-align:left"> <p>
														<span class="emphasis"><em>所有者</em></span> （ <span class="emphasis"><em>Unix用户\所有者</em></span> ） <a href="#ftn.idm140241875034080" class="footnote" id="idm140241875034080"><sup class="footnote">[b]</sup></a>
													</p>
													 </td><td valign="top" style="text-align:left"> <p>完全控制</p>
													 </td><td valign="top" style="text-align:left"> <p>仅此文件夹</p>
													 </td></tr><tr><td valign="top" style="text-align:left"> <p>
														<span class="emphasis"><em>primary_group</em></span> （ <span class="emphasis"><em>Unix User \ primary_group</em></span> ） <a href="#ftn.idm140241875026848" class="footnote" id="idm140241875026848"><sup class="footnote">[</sup></a> <span class="emphasis"><em>E</em></span> <a href="#ftn.idm140241875026848" class="footnote" id="idm140241875026848"><sup class="footnote">]</sup></a>
													</p>
													 </td><td valign="top" style="text-align:left"> <p>没有</p>
													 </td><td valign="top" style="text-align:left"> <p>仅此文件夹</p>
													 </td></tr><tr><td valign="top" style="text-align:left"> <p>
														<code class="literal">CREATOR OWNER</code> <a href="#ftn.idm140241819071520" class="footnote" id="idm140241819071520"><sup class="footnote">[d]</sup></a> <a href="#ftn.sambawinaclcreatorowner" class="footnote" id="sambawinaclcreatorowner"><sup class="footnote">[e]</sup></a>
													</p>
													 </td><td valign="top" style="text-align:left"> <p>完全控制</p>
													 </td><td valign="top" style="text-align:left"> <p>仅限子文件夹和文件</p>
													 </td></tr><tr><td valign="top" style="text-align:left"> <p>
														<code class="literal">CREATOR GROUP</code> <a href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#ftn.sambawinaclcreatorowner" class="footnoteref"><sup class="footnoteref">[e]</sup></a> <a href="#ftn.idm140241819062592" class="footnote" id="idm140241819062592"><sup class="footnote">[f]</sup></a>
													</p>
													 </td><td valign="top" style="text-align:left"> <p>没有</p>
													 </td><td valign="top" style="text-align:left"> <p>仅限子文件夹和文件</p>
													 </td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div id="ftn.idm140241875041792" class="footnote"><p><a href="#idm140241875041792" class="simpara"><sup class="simpara">[a]</sup></a> Samba从<code class="literal">other</code> ACL条目映射此主体的权限。
														</p></div><div id="ftn.idm140241875034080" class="footnote"><p><a href="#idm140241875034080" class="simpara"><sup class="simpara">[b]</sup></a> Samba将目录的所有者映射到此条目。
														</p></div><div id="ftn.idm140241875026848" class="footnote"><p><a href="#idm140241875026848" class="simpara"><sup class="simpara">[c]</sup></a> Samba将目录的主要组映射到此条目。
														</p></div><div id="ftn.idm140241819071520" class="footnote"><p><a href="#idm140241819071520" class="simpara"><sup class="simpara">[d]</sup></a>在新文件系统对象上，创建者自动继承该主体的权限。
														</p></div><div id="ftn.sambawinaclcreatorowner" class="footnote"><p><a href="#sambawinaclcreatorowner" class="simpara"><sup class="simpara">[e]</sup></a>从使用POSIX ACL的共享不支持的ACL配置或删除这些主体。
														</p></div><div id="ftn.idm140241819062592" class="footnote"><p><a href="#idm140241819062592" class="simpara"><sup class="simpara">[f]</sup></a>在新文件系统对象上，创建者的主要组自动继承此主体的权限。
														</p></div></td></tr></tbody></table></div></div></div></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="assembly_setting-permissions-on-a-share-that-uses-posix-acls_assembly_setting-up-a-share-that-uses-posix-acls"></a>在使用POSIX ACL的共享上设置权限</h3></div></div></div><p>（可选）要限制或授予对Samba共享的访问权限，可以在<code class="literal">/etc/samba/smb.conf</code>文件的共享部分中设置某些参数。
					</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>如果用户，组或主机能够访问共享，则基于共享的权限进行管理。这些设置不会影响文件系统ACL。
						</p></div><p>使用基于共享的设置来限制对共享的访问，例如，拒绝来自特定主机的访问。
					</p><h5><a id="prerequisites-assembly_setting-permissions-on-a-share-that-uses-posix-acls"></a>先决条件</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">已根据<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_adding-a-share-that-uses-posix-acls_assembly_setting-up-a-share-that-uses-posix-acls" title="Adding a share that uses POSIX ACLs">“添加使用POSIX ACL的共享”一节</a>设置了<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_adding-a-share-that-uses-posix-acls_assembly_setting-up-a-share-that-uses-posix-acls" title="添加使用POSIX ACL的共享">POSIX ACL的共享</a> 。
							</li></ul></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="proc_configuring-user-and-group-based-share-access_assembly_setting-permissions-on-a-share-that-uses-posix-acls"></a>配置基于用户和组的共享访问</h4></div></div></div><p>通过基于用户和组的访问控制，您可以为某些用户和组授予或拒绝对共享的访问权限。
						</p><h6><a id="procedure_15"></a>程序</h6><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">例如，要允许<code class="literal">Domain Users</code>组的所有成员在拒绝<code class="literal">user</code>帐户访问时访问共享，请将以下参数添加到共享的配置中：</p><pre class="literallayout">valid users = +<span class="emphasis"><em>DOMAIN</em></span>\"Domain Users"
invalid users = <span class="emphasis"><em>DOMAIN</em></span>\user</pre><p class="simpara"><code class="literal">invalid users</code>参数的优先级高于<code class="literal">valid users</code>参数。例如，如果<code class="literal">user</code>帐户是<code class="literal">Domain Users</code>组的成员，则在使用上一个示例时，将拒绝访问此帐户。
								</p></li><li class="listitem"><p class="simpara">重新加载Samba配置：</p><pre class="literallayout"># smbcontrol all reload-config</pre></li></ol></div><h6><a id="additional_resources_11"></a>其他资源</h6><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关更多详细信息，请参阅<code class="literal">smb.conf(5)</code>手册页中的参数说明。
								</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="proc_configuring-host-based-share-access_assembly_setting-permissions-on-a-share-that-uses-posix-acls"></a>配置基于主机的共享访问</h4></div></div></div><p>基于主机的访问控制使您可以根据客户端的主机名，IP地址或IP范围授予或拒绝对共享的访问权限。
						</p><p>以下过程说明如何启用<code class="literal">127.0.0.1</code> IP地址， <code class="literal">192.0.2.0/24</code> IP范围和<code class="literal">client1.example.com</code>主机以访问共享，并另外拒绝访问<code class="literal">client2.example.com</code>主机：</p><h6><a id="procedure_16"></a>程序</h6><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">将以下参数添加到<code class="literal">/etc/samba/smb.conf</code>文件中共享的配置中：</p><pre class="literallayout">hosts allow = 127.0.0.1 192.0.2.0/24 client1.example.com
hosts deny = client2.example.com</pre><p class="simpara"><code class="literal">hosts deny</code>参数的优先级高于<code class="literal">hosts allow</code>优先级。例如，如果<code class="literal">client1.example.com</code>解析为<code class="literal">hosts allow</code>参数中列出的IP地址，则拒绝访问此主机。
								</p></li><li class="listitem"><p class="simpara">重新加载Samba配置：</p><pre class="literallayout"># smbcontrol all reload-config</pre></li></ol></div><h6><a id="additional_resources_12"></a>其他资源</h6><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关更多详细信息，请参阅<code class="literal">smb.conf(5)</code>手册页中的参数说明。
								</li></ul></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assembly_setting-up-a-share-that-uses-windows-acls_assembly_configuring-file-shares-on-a-samba-server"></a>设置使用Windows ACL的共享</h2></div></div></div><p>Samba支持在共享和文件系统对象上设置Windows ACL。这使您能够：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">使用细粒度Windows ACL</li><li class="listitem">使用Windows管理共享权限和文件系统ACL</li></ul></div><p>或者，您可以配置共享以使用POSIX ACL。有关详细信息，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-a-share-that-uses-posix-acls_assembly_configuring-file-shares-on-a-samba-server" title="设置使用POSIX ACL的共享">“设置使用POSIX ACL的共享”一节</a> 。
				</p><p>本节的部分内容是从Samba Wiki中发布的“ <a class="link" href="https://wiki.samba.org/index.php/Setting_up_a_Share_Using_Windows_ACLs">使用Windows ACL设置共享”</a>文档中采用的。许可证： <a class="link" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> 。作者和贡献者：请参阅Wiki页面上的<a class="link" href="https://wiki.samba.org/index.php?title=Setting_up_a_Share_Using_Windows_ACLs&amp;action=history">历史记录</a>选项卡。
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_granting-the-sediskoperatorprivilege-privilege_assembly_setting-up-a-share-that-uses-windows-acls"></a>授予SeDiskOperatorPrivilege权限</h3></div></div></div><p>只有授予<code class="literal">SeDiskOperatorPrivilege</code>权限的用户和组才能为使用Windows ACL的共享配置权限。
					</p><h5><a id="procedure_17"></a>程序</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">例如，要将<code class="literal">SeDiskOperatorPrivilege</code>权限授予<code class="literal"><span class="emphasis"><em>DOMAIN</em></span> \Domain Admins</code>组：</p><pre class="literallayout"># net rpc rights grant "<span class="emphasis"><em>DOMAIN</em></span>\Domain Admins" SeDiskOperatorPrivilege \
       -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrator's password:
Successfully granted rights.</pre><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>在域环境中，将<code class="literal">SeDiskOperatorPrivilege</code>授予域组。这使您可以通过更新用户的组成员身份来集中管理权限。
								</p></div></li><li class="listitem"><p class="simpara">列出已授予<code class="literal">SeDiskOperatorPrivilege</code>所有用户和组：</p><pre class="literallayout"># net rpc rights list privileges SeDiskOperatorPrivilege \
       -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
Enter administrator's password:
SeDiskOperatorPrivilege:
  BUILTIN\Administrators
  <span class="emphasis"><em>DOMAIN</em></span>\Domain Admins</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_enabling-windows-acl-support_assembly_setting-up-a-share-that-uses-windows-acls"></a>启用Windows ACL支持</h3></div></div></div><p>要配置支持Windows ACL的共享，必须在Samba中启用此功能。
					</p><h5><a id="prerequisites_6"></a>先决条件</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">在Samba服务器上配置用户共享。
							</li></ul></div><h5><a id="procedure_18"></a>程序</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要为所有共享全局启用它，请将以下设置添加到<code class="literal">/etc/samba/smb.conf</code>文件的<code class="literal">[global]</code>部分：</p><pre class="literallayout">vfs objects = acl_xattr
map acl inherit = yes
store dos attributes = yes</pre><p class="simpara">或者，您可以通过向共享的部分添加相同的参数来为单个共享启用Windows ACL支持。
							</p></li><li class="listitem"><p class="simpara">重启<code class="literal">smb</code>服务：</p><pre class="literallayout"># systemctl restart smb</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_adding-a-share-that-uses-windows-acls_assembly_setting-up-a-share-that-uses-windows-acls"></a>添加使用Windows ACL的共享</h3></div></div></div><p>本节介绍如何创建名为<code class="literal">example</code>的共享，该共享共享<code class="literal">/srv/samba/example/</code>目录的内容，并使用Windows ACL。
					</p><h5><a id="procedure_19"></a>程序</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">如果该文件夹不存在，请创建该文件夹。例如：</p><pre class="literallayout"># mkdir -p /srv/samba/example/</pre></li><li class="listitem"><p class="simpara">如果在<code class="literal">enforcing</code>模式下运行SELinux，请在目录上设置<code class="literal">samba_share_t</code>上下文：</p><pre class="literallayout"># semanage fcontext -a -t samba_share_t "/srv/samba/example(/.*)?"
# restorecon -Rv /srv/samba/example/</pre></li><li class="listitem"><p class="simpara">将示例共享添加到<code class="literal">/etc/samba/smb.conf</code>文件中。例如，要添加共享写入启用：</p><pre class="literallayout">[example]
	path = /srv/samba/example/
	read only = no</pre><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>无论文件系统ACL如何;如果未设置<code class="literal">read only = no</code> ，Samba将以只读模式共享目录。
								</p></div></li><li class="listitem"><p class="simpara">如果尚未在<code class="literal">[global]</code>部分中为所有共享启用Windows ACL支持，请将以下参数添加到<code class="literal">[example]</code>部分以为此共享启用此功能：</p><pre class="literallayout">vfs objects = acl_xattr
map acl inherit = yes
store dos attributes = yes</pre></li><li class="listitem"><p class="simpara">验证<code class="literal">/etc/samba/smb.conf</code>文件：</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">打开所需的端口并使用<code class="literal">firewall-cmd</code>实用程序重新加载防火墙配置：</p><pre class="literallayout"># firewall-cmd --permanent --add-service=samba
# firewall-cmd --reload</pre></li><li class="listitem"><p class="simpara">重启<code class="literal">smb</code>服务：</p><pre class="literallayout"># systemctl restart smb</pre></li></ol></div><h5><a id="additional_resources_13"></a>其他资源</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="使用testparm实用程序验证smb.conf文件">“使用testparm实用程序验证smb.conf文件”一节</a>
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_managing-share-permissions-and-file-system-acls-of-a-share-that-uses-windows-acls_assembly_setting-up-a-share-that-uses-windows-acls"></a>管理使用Windows ACL的共享的共享权限和文件系统ACL</h3></div></div></div><p>要在使用Windows ACL的Samba共享上管理共享权限和文件系统ACL，请使用Windows应用程序，例如“ <code class="literal">Computer Management</code> 。有关详细信息，请参阅Windows文档。或者，使用<code class="literal">smbcacls</code>实用程序来管理ACL。
					</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>要从Windows修改文件系统权限，必须使用具有<code class="literal">SeDiskOperatorPrivilege</code>权限的帐户。
						</p></div><h5><a id="additional_resources_14"></a>其他资源</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_managing-acls-on-an-smb-share-using-smbcacls_assembly_configuring-file-shares-on-a-samba-server" title="使用smbcacls管理SMB共享上的ACL">“使用smbcacls管理SMB共享上的ACL”一节</a>
							</li><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_granting-the-sediskoperatorprivilege-privilege_assembly_setting-up-a-share-that-uses-windows-acls" title="授予SeDiskOperatorPrivilege权限">“授予SeDiskOperatorPrivilege权限”一节</a>
							</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assembly_managing-acls-on-an-smb-share-using-smbcacls_assembly_configuring-file-shares-on-a-samba-server"></a>使用smbcacls管理SMB共享上的ACL</h2></div></div></div><p><code class="literal">smbcacls</code>实用程序可以列出，设置和删除存储在SMB共享中的文件和目录的ACL。您可以使用<code class="literal">smbcacls</code>来管理文件系统ACL：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">在使用高级Windows ACL或POSIX ACL的本地或远程Samba服务器上</li><li class="listitem">在Red Hat Enterprise Linux上远程管理Windows上托管的共享上的ACL</li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="con_access-control-entries_assembly_managing-acls-on-an-smb-share-using-smbcacls"></a>访问控制条目</h3></div></div></div><p>文件系统对象的每个ACL条目都包含以下格式的访问控制条目（ACE）：</p><pre class="literallayout"><span class="emphasis"><em>security_principal</em></span>:<span class="emphasis"><em>access_right</em></span>/<span class="emphasis"><em>inheritance_information</em></span>/<span class="emphasis"><em>permissions</em></span></pre><div class="example"><a id="idm140241865030336"></a><p class="title"><strong>例2.4。访问控制条目</strong></p><div class="example-contents"><p>如果<code class="literal">AD\Domain Users</code>组具有适用于Windows上<code class="literal">This folder, subfolders, and files</code> <code class="literal">Modify</code>权限，则ACL包含以下ACE：</p><pre class="literallayout">AD\Domain Users:ALLOWED/OI|CI/CHANGE</pre></div></div><p>ACE包含以下部分：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">安全负责人</span></dt><dd>安全主体是应用ACL中的权限的用户，组或SID。
								</dd><dt><span class="term">访问权</span></dt><dd>定义是否授予或拒绝对对象的访问。该值可以<code class="literal">ALLOWED</code>或<code class="literal">DENIED</code> 。</dd><dt><span class="term">继承信息</span></dt><dd><p class="simpara">存在以下值：</p><div class="table"><a id="idm140241860049392"></a><p class="title"><strong>表2.1。继承设置</strong></p><div class="table-contents"><table border="1" summary="Inheritance settings"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th valign="top" style="text-align:left">值</th><th valign="top" style="text-align:left">描述</th><th valign="top" style="text-align:left">地图到</th></tr></thead><tbody><tr><td valign="top" style="text-align:left"> <p>
													<code class="literal">OI</code>
												</p>
												 </td><td valign="top" style="text-align:left"> <p>对象继承</p>
												 </td><td valign="top" style="text-align:left"> <p>这个文件夹和文件</p>
												 </td></tr><tr><td valign="top" style="text-align:left"> <p>
													<code class="literal">CI</code>
												</p>
												 </td><td valign="top" style="text-align:left"> <p>容器继承</p>
												 </td><td valign="top" style="text-align:left"> <p>此文件夹和子文件夹</p>
												 </td></tr><tr><td valign="top" style="text-align:left"> <p>
													<code class="literal">IO</code>
												</p>
												 </td><td valign="top" style="text-align:left"> <p>仅继承</p>
												 </td><td valign="top" style="text-align:left"> <p>ACE不适用于当前文件或目录</p>
												 </td></tr><tr><td valign="top" style="text-align:left"> <p>
													<code class="literal">ID</code>
												</p>
												 </td><td valign="top" style="text-align:left"> <p>遗传</p>
												 </td><td valign="top" style="text-align:left"> <p>ACE是从父目录继承的</p>
												 </td></tr></tbody></table></div></div><p class="simpara">此外，值可以组合如下：</p><div class="table"><a id="idm140241860015776"></a><p class="title"><strong>表2.2。继承设置组合</strong></p><div class="table-contents"><table border="1" summary="Inheritance settings combinations"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th valign="top" style="text-align:left">价值组合</th><th valign="top" style="text-align:left">映射到Windows <code class="literal">Applies to</code>设置</th></tr></thead><tbody><tr><td valign="top" style="text-align:left"> <p>
													<code class="literal">OI | CI</code>
												</p>
												 </td><td valign="top" style="text-align:left"> <p>此文件夹，子文件夹和文件</p>
												 </td></tr><tr><td valign="top" style="text-align:left"> <p>
													<code class="literal">OI | CI | IO</code>
												</p>
												 </td><td valign="top" style="text-align:left"> <p>仅限子文件夹和文件</p>
												 </td></tr><tr><td valign="top" style="text-align:left"> <p>
													<code class="literal">CI | IO</code>
												</p>
												 </td><td valign="top" style="text-align:left"> <p>仅限子文件夹</p>
												 </td></tr><tr><td valign="top" style="text-align:left"> <p>
													<code class="literal">OI | IO</code>
												</p>
												 </td><td valign="top" style="text-align:left"> <p>仅限文件</p>
												 </td></tr></tbody></table></div></div></dd><dt><span class="term">权限</span></dt><dd><p class="simpara">此值可以是表示一个或多个Windows权限的十六进制值或<code class="literal">smbcacls</code>别名：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">十六进制值，表示一个或多个Windows权限。
										</p><p class="simpara">下表以十六进制格式显示高级Windows权限及其对应值：</p><div class="table"><a id="table_windows-permissions-hex-values_assembly_managing-acls-on-an-smb-share-using-smbcacls"></a><p class="title"><strong>表2.3。Windows权限及其对应的smbcacl值以十六进制格式表示</strong></p><div class="table-contents"><table border="1" summary="Windows permissions and their corresponding smbcacls value in hex format"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th valign="top" style="text-align:left">Windows权限</th><th valign="top" style="text-align:left">十六进制值</th></tr></thead><tbody><tr><td valign="top" style="text-align:left"> <p>完全控制</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x001F01FF</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>遍历文件夹/执行文件</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00100020</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>列出文件夹/读取数据</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00100001</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>读属性</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00100080</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>读扩展属性</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00100008</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>创建文件/写入数据</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00100002</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>创建文件夹/附加数据</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00100004</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>写属性</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00100100</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>写扩展属性</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00100010</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>删除子文件夹和文件</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00100040</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>删除</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00110000</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>读取权限</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00120000</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>更改权限</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00140000</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>取得所有权</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00180000</code>
														</p>
														 </td></tr></tbody></table></div></div><p class="simpara">可以使用逐位<code class="literal">OR</code>运算将多个权限组合为单个十六进制值。有关详细信息，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#con_ace-mask-calculation_assembly_managing-acls-on-an-smb-share-using-smbcacls" title="ACE掩码计算">“ACE掩码计算”一节</a> 。
										</p></li><li class="listitem"><p class="simpara"><code class="literal">smbcacls</code>别名。下表显示了可用的别名：</p><div class="table"><a id="table_smbcacls-aliases_assembly_managing-acls-on-an-smb-share-using-smbcacls"></a><p class="title"><strong>表2.4。现有的smbcacls别名及其相应的Windows权限</strong></p><div class="table-contents"><table border="1" summary="Existing smbcacls aliases and their corresponding Windows permission"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th valign="top" style="text-align:left"><code class="literal">smbcacls</code>别名</th><th valign="top" style="text-align:left">映射到Windows权限</th></tr></thead><tbody><tr><td valign="top" style="text-align:left"> <p>
															<code class="literal">[R</code>
														</p>
														 </td><td valign="top" style="text-align:left"> <p>读</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>
															<code class="literal">读</code>
														</p>
														 </td><td valign="top" style="text-align:left"> <p>阅读并执行</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>
															<code class="literal">w ^</code>
														</p>
														 </td><td valign="top" style="text-align:left"> <p>特别：</p>
														 <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">创建文件/写入数据</li><li class="listitem">创建文件夹/附加数据</li><li class="listitem">写属性</li><li class="listitem">写扩展属性</li><li class="listitem">读取权限</li></ul></div>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>
															<code class="literal">d</code>
														</p>
														 </td><td valign="top" style="text-align:left"> <p>删除</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>
															<code class="literal">P</code>
														</p>
														 </td><td valign="top" style="text-align:left"> <p>更改权限</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>
															<code class="literal">Ø</code>
														</p>
														 </td><td valign="top" style="text-align:left"> <p>取得所有权</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>
															<code class="literal">X</code>
														</p>
														 </td><td valign="top" style="text-align:left"> <p>遍历/执行</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>
															<code class="literal">更改</code>
														</p>
														 </td><td valign="top" style="text-align:left"> <p>修改</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>
															<code class="literal">充分</code>
														</p>
														 </td><td valign="top" style="text-align:left"> <p>完全控制</p>
														 </td></tr></tbody></table></div></div><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>设置权限时，可以组合单字母别名。例如，您可以设置<code class="literal">RD</code>以应用Windows权限<code class="literal">Read</code>和<code class="literal">Delete</code> 。但是，您既不能组合多个非单字母别名，也不能组合别名和十六进制值。
											</p></div></li></ul></div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_displaying-acls-using-smbcacls_assembly_managing-acls-on-an-smb-share-using-smbcacls"></a>使用smbcacls显示ACL</h3></div></div></div><p>要在SMB共享上显示ACL，请使用<code class="literal">smbcacls</code>实用程序。如果运行<code class="literal">smbcacls</code>而没有任何操作参数（例如<code class="literal">--add</code> ，该实用程序将显示文件系统对象的ACL。
					</p><h5><a id="procedure_20"></a>程序</h5><p>例如，要列出<code class="literal">//server/example</code>共享的根目录的ACL：</p><pre class="literallayout"># smbcacls //server/example / -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrator's password:
REVISION:1
CONTROL:SR|PD|DI|DP
OWNER:AD\Administrators
GROUP:AD\Domain Users
ACL:AD\Administrator:ALLOWED/OI|CI/FULL
ACL:AD\Domain Users:ALLOWED/OI|CI/CHANGE
ACL:AD\Domain Guests:ALLOWED/OI|CI/0x00100021</pre><p>该命令的输出显示：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<code class="literal">REVISION</code> ：安全描述符的内部Windows NT ACL修订版</li><li class="listitem">
								<code class="literal">CONTROL</code> ：安全描述符控制</li><li class="listitem">
								<code class="literal">OWNER</code> ：安全描述符<code class="literal">OWNER</code>名称或SID</li><li class="listitem">
								<code class="literal">GROUP</code> ：安全描述符组的名称或SID</li><li class="listitem">
								<code class="literal">ACL</code>条目。有关详细信息，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#con_access-control-entries_assembly_managing-acls-on-an-smb-share-using-smbcacls" title="访问控制条目">“访问控制条目”一节</a> 。
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="con_ace-mask-calculation_assembly_managing-acls-on-an-smb-share-using-smbcacls"></a> ACE掩码计算</h3></div></div></div><p>在大多数情况下，当您添加或更新ACE，您使用<code class="literal">smbcacls</code>中列出的别名<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#table_smbcacls-aliases_assembly_managing-acls-on-an-smb-share-using-smbcacls" title="表2.4。现有的smbcacls别名及其相应的Windows权限">表2.4，“现有smbcacls别名及其相应的Windows许可”</a> 。
					</p><p>但是，如果要设置<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#table_windows-permissions-hex-values_assembly_managing-acls-on-an-smb-share-using-smbcacls" title="表2.3。Windows权限及其对应的smbcacl值以十六进制格式表示">表2.3“Windows权限及其相应的smbcacls值以十六进制格式”中</a>列出的高级Windows权限，则必须使用按位<code class="literal">OR</code>运算来计算正确的值。您可以使用以下shell命令来计算值：</p><pre class="literallayout"># echo $(printf '0x%X' $(( hex_value_1 | hex_value_2 | ... )))</pre><div class="example"><a id="idm140241760990720"></a><p class="title"><strong>例2.5。计算ACE掩码</strong></p><div class="example-contents"><p>您想要设置以下权限：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">遍历文件夹/执行文件（0x00100020）</li><li class="listitem">列表文件夹/读取数据（0x00100001）</li><li class="listitem">读属性（0x00100080）</li></ul></div><p>要计算先前权限的十六进制值，请输入：</p><pre class="literallayout"># echo $(printf '0x%X' $(( 0x00100020 | 0x00100001 | 0x00100080 )))
<code class="literal">0x1000A1</code></pre><p>设置或更新ACE时使用返回的值。</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_adding-updating-and-removing-an-acl-using-smbcacls_assembly_managing-acls-on-an-smb-share-using-smbcacls"></a>使用smbcacls添加，更新和删除ACL</h3></div></div></div><p>根据传递给<code class="literal">smbcacls</code>实用程序的参数，您可以从文件或目录添加，更新和删除ACL。
					</p><h5><a id="adding_an_acl"></a>添加ACL</h5><p>要将ACL添加到<code class="literal">//server/example</code>共享的根目录，该共享权限<code class="literal">This folder, subfolders, and files</code> <code class="literal">CHANGE</code>权限授予<code class="literal">AD\Domain Users</code>组：</p><pre class="literallayout"># smbcacls //server/example / -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator \
       --add ACL:"AD\Domain Users":ALLOWED/OI|CI/CHANGE</pre><h5><a id="updating_an_acl"></a>更新ACL</h5><p>更新ACL与添加新ACL类似。您可以通过使用带有现有安全主体的<code class="literal">--modify</code>参数覆盖ACL来更新ACL。如果<code class="literal">smbcacls</code>在ACL列表中找到安全主体，则该实用程序将更新权限。否则命令失败并显示错误：</p><pre class="literallayout">ACL for SID <span class="emphasis"><em>principal_name</em></span> not found</pre><p>例如，要更新<code class="literal">AD\Domain Users</code>组的权限并将其设置为<code class="literal">READ</code> for <code class="literal">This folder, subfolders, and files</code> ：</p><pre class="literallayout"># smbcacls //server/example / -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator \
       --modify ACL:"AD\Domain Users":ALLOWED/OI|CI/READ</pre><h5><a id="deleting_an_acl"></a>删除ACL</h5><p>要删除ACL，请将带有确切ACL的<code class="literal">--delete</code>参数传递给<code class="literal">smbcacls</code>实用程序。例如：</p><pre class="literallayout"># smbcacls //server/example / -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator \
       --delete ACL:"AD\Domain Users":ALLOWED/OI|CI/READ</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assembly_enabling-users-to-share-directories-on-a-samba-server_assembly_configuring-file-shares-on-a-samba-server"></a>允许用户在Samba服务器上共享目录</h2></div></div></div><p>在Samba服务器上，您可以配置用户可以共享没有root权限的目录。
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_enabling-the-user-shares-feature_assembly_enabling-users-to-share-directories-on-a-samba-server"></a>启用用户共享功能</h3></div></div></div><p>在用户可以共享目录之前，管理员必须在Samba中启用用户共享。
					</p><p>例如，仅允许本地<code class="literal">example</code>组的成员创建用户共享。
					</p><h5><a id="procedure_21"></a>程序</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">创建本地<code class="literal">example</code>组（如果它不存在）：</p><pre class="literallayout"># groupadd example</pre></li><li class="listitem"><p class="simpara">准备Samba目录以存储用户共享定义并正确设置其权限。例如：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">创建目录：</p><pre class="literallayout"># mkdir -p /var/lib/samba/usershares/</pre></li><li class="listitem"><p class="simpara">设置<code class="literal">example</code>组的写入权限：</p><pre class="literallayout"># chgrp example /var/lib/samba/usershares/
# chmod 1770 /var/lib/samba/usershares/</pre></li><li class="listitem">设置粘滞位以防止用户重命名或删除此目录中其他用户存储的文件。
									</li></ol></div></li><li class="listitem"><p class="simpara">编辑<code class="literal">/etc/samba/smb.conf</code>文件并将以下内容添加到<code class="literal">[global]</code>部分：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">设置指定用于存储用户共享定义的目录的路径。例如：</p><pre class="literallayout">usershare path = /var/lib/samba/usershares/</pre></li><li class="listitem"><p class="simpara">设置允许在此服务器上创建Samba的用户份额。例如：</p><pre class="literallayout">usershare max shares = 100</pre><p class="simpara">如果对<code class="literal">usershare max shares</code>参数使用默认值<code class="literal">0</code> ，则禁用用户共享。
									</p></li><li class="listitem"><p class="simpara">（可选）设置绝对目录路径列表。例如，要配置Samba仅允许共享要共享的<code class="literal">/data</code>和<code class="literal">/srv</code>目录的子目录，请设置：</p><pre class="literallayout">usershare prefix allow list = /data /srv</pre></li></ol></div><p class="simpara">有关可以设置的其他用户共享相关参数的列表，请参阅<code class="literal">smb.conf(5)</code>手册页中的<code class="literal">USERSHARES</code>部分。
							</p></li><li class="listitem"><p class="simpara">验证<code class="literal">/etc/samba/smb.conf</code>文件：</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">重新加载Samba配置：</p><pre class="literallayout"># smbcontrol all reload-config</pre></li></ol></div><p>用户现在可以创建用户共享。有关详细信息，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_adding-a-user-share_assembly_enabling-users-to-share-directories-on-a-samba-server" title="添加用户共享">“添加用户共享”一节</a> 。
					</p><h5><a id="additional_resources_15"></a>其他资源</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="使用testparm实用程序验证smb.conf文件">“使用testparm实用程序验证smb.conf文件”一节</a>
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_adding-a-user-share_assembly_enabling-users-to-share-directories-on-a-samba-server"></a>添加用户共享</h3></div></div></div><p>根据<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_enabling-the-user-shares-feature_assembly_enabling-users-to-share-directories-on-a-samba-server" title="启用用户共享功能">“启用用户共享功能”一节</a>配置Samba后，用户可以通过运行<code class="literal">net usershare add</code>命令在没有<code class="literal">root</code>权限的情况下共享Samba服务器上的目录。
					</p><p><code class="literal">net usershare add</code>命令的概要：</p><p>
						<code class="literal">net usershare add</code> share_name path [[comment] | [ACLs]] [guest_ok = y | n]</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>如果在创建用户共享时设置ACL，则必须在ACL之前指定comment参数。要设置空注释，请在双引号中使用空字符串。
						</p></div><p>请注意，如果管理员在<code class="literal">/etc/samba/smb.conf</code>文件的<code class="literal">[global]</code>部分中设置<code class="literal">usershare allow guests = yes</code> ，则用户只能在用户共享上启用访客访问权限。
					</p><div class="example"><a id="idm140241856462176"></a><p class="title"><strong>例2.6。添加用户共享</strong></p><div class="example-contents"><p>用户想要在Samba服务器上共享<code class="literal">/srv/samba/</code>目录。共享应该命名为<code class="literal">example</code> ，没有注释集，并且guest用户应该可以访问。此外，共享权限应设置为<code class="literal">AD\Domain Users</code>组的完全访问权限和其他用户的读取权限。要添加此共享，请以用户身份运行：</p><pre class="literallayout">$ net usershare add example /srv/samba/ "" \
       "AD\Domain Users":F,Everyone:R guest_ok=yes</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_updating-settings-of-a-user-share_assembly_enabling-users-to-share-directories-on-a-samba-server"></a>更新用户共享的设置</h3></div></div></div><p>要更新用户共享的设置，请使用具有相同共享名称和新设置的<code class="literal">net usershare add</code>命令覆盖共享。请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_adding-a-user-share_assembly_enabling-users-to-share-directories-on-a-samba-server" title="添加用户共享">“添加用户共享”一节</a> 。
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_displaying-information-about-existing-user-shares_assembly_enabling-users-to-share-directories-on-a-samba-server"></a>显示有关现有用户共享的信息</h3></div></div></div><p>用户可以在Samba服务器上输入<code class="literal">net usershare info</code>命令以显示用户共享及其设置。
					</p><h5><a id="prerequisites_7"></a>先决条件</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">在Samba服务器上配置用户共享。
							</li></ul></div><h5><a id="procedure_22"></a>程序</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要显示任何用户创建的所有用户共享：</p><pre class="literallayout">$ net usershare info -l
[<span class="emphasis"><em>share_1</em></span>]
path=<span class="emphasis"><em>/srv/samba/</em></span>
comment=
usershare_acl=<span class="emphasis"><em>Everyone:R,host_name\user:F,</em></span>
guest_ok=<span class="emphasis"><em>y</em></span>
...</pre><p class="simpara">要仅列出运行该命令的用户创建的共享，请省略<code class="literal">-l</code>参数。
							</p></li><li class="listitem"><p class="simpara">要仅显示有关特定共享的信息，请将共享名称或通配符传递给该命令。例如，要显示名称以<code class="literal">share_</code>开头的共享信息：</p><pre class="literallayout">$ net usershare info -l share_*</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_listing-user-shares_assembly_enabling-users-to-share-directories-on-a-samba-server"></a>列出用户共享</h3></div></div></div><p>如果要在Samba服务器上仅列出可用的用户共享而不进行设置，请使用<code class="literal">net usershare list</code>命令。
					</p><h5><a id="prerequisites_8"></a>先决条件</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">在Samba服务器上配置用户共享。
							</li></ul></div><h5><a id="procedure_23"></a>程序</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">列出任何用户创建的共享：</p><pre class="literallayout">$ net usershare list -l
<span class="emphasis"><em>share_1</em></span>
<span class="emphasis"><em>share_2</em></span>
...</pre><p class="simpara">要仅列出运行该命令的用户创建的共享，请省略<code class="literal">-l</code>参数。
							</p></li><li class="listitem"><p class="simpara">要仅列出特定共享，请将共享名称或通配符传递给该命令。例如，要仅列出名称以<code class="literal">share_</code>开头的<code class="literal">share_</code> ：</p><pre class="literallayout">$ net usershare list -l share_*</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_deleting-a-user-share_assembly_enabling-users-to-share-directories-on-a-samba-server"></a>删除用户共享</h3></div></div></div><p>要删除用户共享，请使用命令<code class="literal">net usershare delete</code>命令作为创建共享的用户或<code class="literal">root</code>用户。
					</p><h5><a id="prerequisites_9"></a>先决条件</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">在Samba服务器上配置用户共享。
							</li></ul></div><h5><a id="procedure_24"></a>程序</h5><pre class="literallayout">$ net usershare delete <span class="emphasis"><em>share_name</em></span></pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_enabling-guest-access-to-a-share_assembly_configuring-file-shares-on-a-samba-server"></a>启用访客访问共享</h2></div></div></div><p>在某些情况下，您希望共享用户无需身份验证即可连接的目录。要配置此功能，请在共享上启用访客访问权限。
				</p><div class="warning" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">警告</h3><p>不需要身份验证的共享可能存在安全风险。
					</p></div><p>如果在共享上启用了访客访问，Samba会将访客连接映射到<code class="literal">guest account</code>参数中设置的操作系统<code class="literal">guest account</code> 。如果满足以下条件中的至少一个条件，访客用户可以访问此共享上的文件：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">该帐户列在文件系统ACL中</li><li class="listitem"><code class="literal">other</code>用户的POSIX权限允许它</li></ul></div><div class="example"><a id="idm140241858746336"></a><p class="title"><strong>例2.7。来宾共享权限</strong></p><div class="example-contents"><p>如果您将Samba配置为将来宾帐户映射到<code class="literal">nobody</code> （默认值），则以下示例中的ACL为：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">允许访客用户阅读<code class="literal">file1.txt</code>
							</li><li class="listitem">允许访客用户阅读和修改<code class="literal">file2.txt</code>
							</li><li class="listitem">阻止访客用户阅读或修改<code class="literal">file3.txt</code>
							</li></ul></div><pre class="literallayout">-rw-r--r--. 1 root       root      1024 1. Sep 10:00 file1.txt
-rw-r-----. 1 nobody     root      1024 1. Sep 10:00 file2.txt
-rw-r-----. 1 root       root      1024 1. Sep 10:00 file3.txt</pre></div></div><h4><a id="procedure_25"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">编辑<code class="literal">/etc/samba/smb.conf</code>文件：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">如果这是您在此服务器上设置的第一个访客共享：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">在<code class="literal">[global]</code>部分中将<code class="literal">map to guest = Bad User</code>设置<code class="literal">map to guest = Bad User</code> ：</p><pre class="literallayout">[global]
        ...
        map to guest = Bad User</pre><p class="simpara">使用此设置，Samba拒绝使用不正确密码的登录尝试，除非用户名不存在。如果指定的用户名不存在，并且在共享上启用了访客访问，则Samba会将该连接视为访客登录。
										</p></li><li class="listitem"><p class="simpara">默认情况下，Samba将来宾帐户映射到Red Hat Enterprise Linux上的<code class="literal">nobody</code>帐户。或者，您可以设置其他帐户。例如：</p><pre class="literallayout">[global]
        ...
        guest account = user_name</pre><p class="simpara">此参数中设置的帐户必须在Samba服务器上本地存在。出于安全原因，Red Hat建议使用未分配有效shell的帐户。
										</p></li></ol></div></li><li class="listitem"><p class="simpara">将<code class="literal">guest ok = yes</code>设置添加到<code class="literal">[example]</code> share部分：</p><pre class="literallayout">[example]
        ...
        guest ok = yes</pre></li></ol></div></li><li class="listitem"><p class="simpara">验证<code class="literal">/etc/samba/smb.conf</code>文件：</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">重新加载Samba配置：</p><pre class="literallayout"># smbcontrol all reload-config</pre></li></ol></div><h4><a id="additional_resources_16"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="使用testparm实用程序验证smb.conf文件">“使用testparm实用程序验证smb.conf文件”一节</a>
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_setting-up-samba-as-a-print-server_assembly_using-samba-as-a-server"></a>将Samba设置为打印服务器</h1></div></div></div><p>如果将Samba设置为打印服务器，则网络中的客户端可以使用Samba进行打印。此外，如果配置了Windows客户端，则可以从Samba服务器下载驱动程序。
			</p><p>本节的部分内容是从Samba Wiki中发布的<a class="link" href="https://wiki.samba.org/index.php/Setting_up_Samba_as_a_Print_Server">设置Samba作为打印服务器</a>文档中采用的。许可证： <a class="link" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> 。作者和贡献者：请参阅Wiki页面上的<a class="link" href="https://wiki.samba.org/index.php?title=Setting_up_Samba_as_a_Print_Server&amp;action=history">历史记录</a>选项卡。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="prerequisites-assembly_setting-up-samba-as-a-print-server"></a>先决条件</h2></div></div></div><p>Samba已设置为以下模式之一：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="link" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-samba-as-a-standalone-server_assembly_using-samba-as-a-server" title="将Samba设置为独立服务器">独立服务器</a>
						</li><li class="listitem">
							<a class="link" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-samba-as-a-domain-member-server_assembly_using-samba-as-a-server" title="将Samba设置为域成员服务器">域成员</a>
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_the-samba-spoolssd-service_assembly_setting-up-samba-as-a-print-server"></a> Samba spoolssd服务</h2></div></div></div><p>Samba <code class="literal">spoolssd</code>是一个集成到<code class="literal">smbd</code>服务中的服务。在Samba配置中启用<code class="literal">spoolssd</code>可显着提高具有大量作业或打印机的打印服务器的性能。
				</p><p>如果没有<code class="literal">spoolssd</code> ，Samba会<code class="literal">spoolssd</code> <code class="literal">smbd</code>进程并为每个打印作业初始化<code class="literal">printcap</code>缓存。在大量打印机的情况下， <code class="literal">smbd</code>服务在初始化缓存时可能会在多秒内无响应。<code class="literal">spoolssd</code>服务使您能够启动预先分叉的<code class="literal">smbd</code>进程，这些进程正在处理打印作业而没有任何延迟。主<code class="literal">spoolssd</code> <code class="literal">smbd</code>进程使用少量内存，并分叉和终止子进程。
				</p><p>以下过程说明了如何启用<code class="literal">spoolssd</code>服务。
				</p><h4><a id="procedure_26"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">编辑<code class="literal">/etc/samba/smb.conf</code>文件中的<code class="literal">[global]</code>部分：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">添加以下参数：</p><pre class="literallayout">rpc_server:spoolss = external
rpc_daemon:spoolssd = fork</pre></li><li class="listitem"><p class="simpara">（可选）您可以设置以下参数：</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th valign="top" style="text-align:left">参数</th><th valign="top" style="text-align:left">默认</th><th valign="top" style="text-align:left">描述</th></tr></thead><tbody><tr><td valign="top" style="text-align:left"> <p>
													<code class="literal">spoolssd：prefork_min_children</code>
												</p>
												 </td><td valign="top" style="text-align:left"> <p>五</p>
												 </td><td valign="top" style="text-align:left"> <p>最小子进程数</p>
												 </td></tr><tr><td valign="top" style="text-align:left"> <p>
													<code class="literal">spoolssd：prefork_max_children</code>
												</p>
												 </td><td valign="top" style="text-align:left"> <p>25</p>
												 </td><td valign="top" style="text-align:left"> <p>最大子进程数</p>
												 </td></tr><tr><td valign="top" style="text-align:left"> <p>
													<code class="literal">spoolssd：prefork_spawn_rate</code>
												</p>
												 </td><td valign="top" style="text-align:left"> <p>五</p>
												 </td><td valign="top" style="text-align:left"> <p>如果建立新连接， <code class="literal">spoolssd:prefork_max_children</code>此参数中设置的新子进程数，最多为<code class="literal">spoolssd:prefork_max_children</code>设置的值</p>
												 </td></tr><tr><td valign="top" style="text-align:left"> <p>
													<code class="literal">spoolssd：prefork_max_allowed_clients</code>
												</p>
												 </td><td valign="top" style="text-align:left"> <p>100</p>
												 </td><td valign="top" style="text-align:left"> <p>客户端数量，子进程服务</p>
												 </td></tr><tr><td valign="top" style="text-align:left"> <p>
													<code class="literal">spoolssd：prefork_child_min_life</code>
												</p>
												 </td><td valign="top" style="text-align:left"> <p>60</p>
												 </td><td valign="top" style="text-align:left"> <p>子进程的最短生存期（以秒为单位）。 60秒是最小的。
												</p>
												 </td></tr></tbody></table></div></li></ol></div></li><li class="listitem"><p class="simpara">验证<code class="literal">/etc/samba/smb.conf</code>文件：</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">重启<code class="literal">smb</code>服务：</p><pre class="literallayout"># systemctl restart smb</pre><p class="simpara">重新启动服务后，Samba会自动启动<code class="literal">smbd</code>子进程：</p><pre class="literallayout"># ps axf
...
30903 smbd
30912  \_ smbd
30913      \_ smbd
30914      \_ smbd
30915      \_ smbd
...</pre></li></ol></div><h4><a id="additional_resources_17"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="使用testparm实用程序验证smb.conf文件">“使用testparm实用程序验证smb.conf文件”一节</a>
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_enabling-print-server-support-in-samba_assembly_setting-up-samba-as-a-print-server"></a>在Samba中启用打印服务器支持</h2></div></div></div><p>本节介绍如何在Samba中启用打印服务器支持。
				</p><h4><a id="procedure_27"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">在Samba服务器上，设置CUPS并将打印机添加到CUPS后端。有关在CUPS中配置打印机的详细信息;请参阅打印服务器上CUPS Web控制台（https：// <span class="emphasis"><em>print_server_host_name</em></span> ：631 / help）中提供的文档。
						</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>如果在Samba打印服务器上本地安装了CUPS，Samba只能将打印作业转发到CUPS。
							</p></div></li><li class="listitem"><p class="simpara">编辑<code class="literal">/etc/samba/smb.conf</code>文件：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">如果要启用<code class="literal">spoolssd</code>服务，请将以下参数添加到<code class="literal">[global]</code>部分：</p><pre class="literallayout">rpc_server:spoolss = external
rpc_daemon:spoolssd = fork</pre></li><li class="listitem"><p class="simpara">要配置打印后端，请添加<code class="literal">[printers]</code>部分：</p><pre class="literallayout">[printers]
        comment = All Printers
        path = /var/tmp/
        printable = yes
        create mask = 0600</pre><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p><code class="literal">[printers]</code>共享名称是硬编码的，无法更改。
									</p></div></li></ol></div></li><li class="listitem"><p class="simpara">验证<code class="literal">/etc/samba/smb.conf</code>文件：</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">打开所需的端口并使用<code class="literal">firewall-cmd</code>实用程序重新加载防火墙配置：</p><pre class="literallayout"># firewall-cmd --permanent --add-service=samba
# firewall-cmd --reload</pre></li><li class="listitem"><p class="simpara">重启<code class="literal">smb</code>服务：</p><pre class="literallayout"># systemctl restart smb</pre></li></ol></div><p>重新启动服务后，Samba会自动共享CUPS后端中配置的所有打印机。如果要仅手动共享特定打印机，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_manually-sharing-specific-printers_assembly_setting-up-samba-as-a-print-server" title="手动共享特定的打印机">“手动共享特定打印机”一节</a> 。
				</p><h4><a id="additional_resources_18"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关您可以设置的更多详细信息和<code class="literal">spoolssd</code>参数，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_the-samba-spoolssd-service_assembly_setting-up-samba-as-a-print-server" title="Samba spoolssd服务">“Samba spoolssd服务”一节</a>
						</li><li class="listitem">
							<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="使用testparm实用程序验证smb.conf文件">“使用testparm实用程序验证smb.conf文件”一节</a>
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_manually-sharing-specific-printers_assembly_setting-up-samba-as-a-print-server"></a>手动共享特定的打印机</h2></div></div></div><p>如果将Samba配置为打印服务器，则默认情况下，Samba共享在CUPS后端配置的所有打印机。以下过程说明如何仅共享特定的打印机。
				</p><h4><a id="prerequisites_10"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Samba设置为打印服务器</li></ul></div><h4><a id="procedure_28"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">编辑<code class="literal">/etc/samba/smb.conf</code>文件：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">在<code class="literal">[global]</code>部分中，通过设置禁用自动打印机共享：</p><pre class="literallayout">load printers = no</pre></li><li class="listitem"><p class="simpara">为要共享的每台打印机添加一个部分。例如，要在CUPS后端共享名为<code class="literal">example</code>的打印机作为Samba中的<code class="literal">Example-Printer</code> ，请添加以下部分：</p><pre class="literallayout">[Example-Printer]
        path = /var/tmp/
        printable = yes
        printer name = example</pre><p class="simpara">每个打印机不需要单独的假脱机目录。您可以在<code class="literal">[printers]</code>部分中设置的打印机<code class="literal">path</code>参数中设置相同的假脱机目录。
								</p></li></ol></div></li><li class="listitem"><p class="simpara">验证<code class="literal">/etc/samba/smb.conf</code>文件：</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">重新加载Samba配置：</p><pre class="literallayout"># smbcontrol all reload-config</pre></li></ol></div><h4><a id="additional_resources_19"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="使用testparm实用程序验证smb.conf文件">“使用testparm实用程序验证smb.conf文件”一节</a>
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assembly_setting-up-automatic-printer-driver-downloads-for-windows-clients_assembly_setting-up-samba-as-a-print-server"></a>为Windows客户端设置自动打印机驱动程序下载</h2></div></div></div><p>如果您正在为Windows客户端运行Samba打印服务器，则可以上载驱动程序和预配置打印机。如果用户连接到打印机，Windows会自动在客户端上本地下载并安装驱动程序。用户不需要本地管理员权限进行安装。此外，Windows还会应用预配置的驱动程序设置，例如托盘数量。
				</p><p>本节的部分内容是从Samba Wiki中发布的<a class="link" href="https://wiki.samba.org/index.php/Setting_up_Automatic_Printer_Driver_Downloads_for_Windows_Clients">设置Windows客户端自动打印机驱动程序下载</a>文档中采用的。许可证： <a class="link" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> 。作者和贡献者：请参阅Wiki页面上的<a class="link" href="https://wiki.samba.org/index.php?title=Setting_up_Automatic_Printer_Driver_Downloads_for_Windows_Clients&amp;action=history">历史记录</a>选项卡。
				</p><h4><a id="prerequisites-assembly_setting-up-automatic-printer-driver-downloads-for-windows-clients"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Samba设置为打印服务器</li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="con_basic-information-about-printer-drivers_assembly_setting-up-automatic-printer-driver-downloads-for-windows-clients"></a>打印机驱动程序的基本信息</h3></div></div></div><p>本节提供有关打印机驱动程序的一般信息
					</p><h5><a id="supported_driver_model_version"></a>支持的驱动程序型号版</h5><p>Samba仅支持Windows 2000及更高版本以及Windows Server 2000及更高版本支持的打印机驱动程序模型版本3。Samba不支持Windows 8和Windows Server 2012中引入的驱动程序模型版本4。但是，这些以及后来的Windows版本也支持版本3驱动程序。
					</p><h5><a id="package_aware_drivers"></a>包感知驱动程序</h5><p>Samba不支持包感知驱动程序。
					</p><h5><a id="preparing_a_printer_driver_for_being_uploaded"></a>准备打印机驱动程序以进行上载</h5><p>在将驱动程序上载到Samba打印服务器之前：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">如果驱动程序以压缩格式提供，请解压缩驱动程序。
							</li><li class="listitem"><p class="simpara">某些驱动程序需要启动一个安装应用程序，该应用程序在Windows主机上本地安装驱动程序。在某些情况下，安装程序会在安装运行期间将各个文件提取到操作系统的临时文件夹中。要使用驱动程序文件进行上传：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">启动安装程序。
									</li><li class="listitem">将文件从临时文件夹复制到新位置。
									</li><li class="listitem">取消安装。
									</li></ol></div></li></ul></div><p>向打印机制造商咨询支持上传到打印服务器的驱动程序。
					</p><h5><a id="providing_32_bit_and_64_bit_drivers_for_a_printer_to_a_client"></a>为客户端提供打印机的32位和64位驱动程序</h5><p>要为32位和64位Windows客户端提供打印机驱动程序，必须为两种体系结构上载具有完全相同名称的驱动程序。例如，如果要上载名为<code class="literal">Example PostScript</code>的32位驱动程序和名为<code class="literal">Example PostScript (v1.0)</code>的64位驱动程序，则名称不匹配。因此，您只能将其中一个驱动程序分配给打印机，并且两个体系结构都不能使用该驱动程序。
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_enabling-users-to-upload-and-preconfigure-drivers_assembly_setting-up-automatic-printer-driver-downloads-for-windows-clients"></a>允许用户上载和预配置驱动程序</h3></div></div></div><p>为了能够上载和预配置打印机驱动程序，用户或组需要授予<code class="literal">SePrintOperatorPrivilege</code>权限。必须将用户添加到<code class="literal">printadmin</code>组中。安装<code class="literal">samba</code>软件包时，Red Hat Enterprise Linux会自动创建该组。<code class="literal">printadmin</code>组被分配了低于1000的最低可用动态系统GID。
					</p><h5><a id="procedure_29"></a>程序</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">例如，要将<code class="literal">SePrintOperatorPrivilege</code>权限授予<code class="literal">printadmin</code>组：</p><pre class="literallayout"># net rpc rights grant "printadmin" SePrintOperatorPrivilege \
       -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrator's password:
Successfully granted rights.</pre><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>在域环境中，将<code class="literal">SePrintOperatorPrivilege</code>授予域组。这使您可以通过更新用户的组成员身份来集中管理权限。
								</p></div></li><li class="listitem"><p class="simpara">列出已授予<code class="literal">SePrintOperatorPrivilege</code>所有用户和组：</p><pre class="literallayout"># net rpc rights list privileges SePrintOperatorPrivilege \
       -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
Enter administrator's password:
SePrintOperatorPrivilege:
  BUILTIN\Administrators
  <span class="emphasis"><em>DOMAIN</em></span>\printadmin</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_setting-up-the-print-share_assembly_setting-up-automatic-printer-driver-downloads-for-windows-clients"></a>设置打印$份额</h3></div></div></div><p>Windows操作系统从打印服务器的名为<code class="literal">print$</code>的共享中下载打印机驱动程序。此共享名称在Windows中是硬编码的，无法更改。
					</p><p>以下过程说明如何将<code class="literal">/var/lib/samba/drivers/</code>目录共享为<code class="literal">print$</code> ，并使本地<code class="literal">printadmin</code>组的成员能够上载打印机驱动程序。
					</p><h5><a id="procedure_30"></a>程序</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">将<code class="literal">[print$]</code>部分添加到<code class="literal">/etc/samba/smb.conf</code>文件中：</p><pre class="literallayout">[print$]
        path = /var/lib/samba/drivers/
        read only = no
        write list = @printadmin
        force group = @printadmin
        create mask = 0664
        directory mask = 2775</pre><p class="simpara">使用这些设置：</p><p class="simpara">只有<code class="literal">printadmin</code>组的成员才能将打印机驱动程序上载到共享。
							</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">新创建的文件和目录组将设置为<code class="literal">printadmin</code> 。
									</li><li class="listitem">新文件的权限将设置为<code class="literal">664</code> 。
									</li><li class="listitem">新目录的权限将设置为<code class="literal">2775</code> 。
									</li></ul></div></li><li class="listitem"><p class="simpara">要仅为打印机上载64位驱动程序，请在<code class="literal">/etc/samba/smb.conf</code>文件的<code class="literal">[global]</code>部分中包含此设置：</p><pre class="literallayout">spoolss: architecture = Windows x64</pre><p class="simpara">如果没有此设置，Windows仅显示至少已上载32位版本的驱动程序。
							</p></li><li class="listitem"><p class="simpara">验证<code class="literal">/etc/samba/smb.conf</code>文件：</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">重新加载Samba配置</p><pre class="literallayout"># smbcontrol all reload-config</pre></li><li class="listitem"><p class="simpara">如果<code class="literal">printadmin</code>组不存在，请创建它：</p><pre class="literallayout"># groupadd printadmin</pre></li><li class="listitem"><p class="simpara">将<code class="literal">SePrintOperatorPrivilege</code>权限授予<code class="literal">printadmin</code>组。
							</p><pre class="literallayout"># net rpc rights grant "printadmin" SePrintOperatorPrivilege \
       -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrator's password:
Successfully granted rights.</pre></li><li class="listitem"><p class="simpara">如果在<code class="literal">enforcing</code>模式下运行SELinux，请在目录上设置<code class="literal">samba_share_t</code>上下文：</p><pre class="literallayout"># semanage fcontext -a -t samba_share_t "/var/lib/samba/drivers(/.*)?"
# restorecon -Rv /var/lib/samba/drivers/</pre></li><li class="listitem"><p class="simpara">在<code class="literal">/var/lib/samba/drivers/</code>目录上设置权限：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">如果使用POSIX ACL，请设置：</p><pre class="literallayout"># chgrp -R "printadmin" /var/lib/samba/drivers/
# chmod -R 2775 /var/lib/samba/drivers/</pre></li><li class="listitem"><p class="simpara">如果使用Windows ACL，请设置：</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th valign="top" style="text-align:left">主要</th><th valign="top" style="text-align:left">访问</th><th valign="top" style="text-align:left">适用于</th></tr></thead><tbody><tr><td valign="top" style="text-align:left"> <p>
														<code class="literal">创造者所有者</code>
													</p>
													 </td><td valign="top" style="text-align:left"> <p>完全控制</p>
													 </td><td valign="top" style="text-align:left"> <p>仅限子文件夹和文件</p>
													 </td></tr><tr><td valign="top" style="text-align:left"> <p>
														<code class="literal">认证用户</code>
													</p>
													 </td><td valign="top" style="text-align:left"> <p>读取和执行，列出文件夹内容，读取</p>
													 </td><td valign="top" style="text-align:left"> <p>此文件夹，子文件夹和文件</p>
													 </td></tr><tr><td valign="top" style="text-align:left"> <p>
														<code class="literal">printadmin</code>
													</p>
													 </td><td valign="top" style="text-align:left"> <p>完全控制</p>
													 </td><td valign="top" style="text-align:left"> <p>此文件夹，子文件夹和文件</p>
													 </td></tr></tbody></table></div><p class="simpara">有关在Windows上设置ACL的详细信息，请参阅Windows文档。
									</p></li></ul></div></li></ol></div><h5><a id="additional_resources_20"></a>其他资源</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_enabling-users-to-upload-and-preconfigure-drivers_assembly_setting-up-automatic-printer-driver-downloads-for-windows-clients" title="允许用户上载和预配置驱动程序">“允许用户上传和预配置驱动程序”一节</a> 。
							</li><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="使用testparm实用程序验证smb.conf文件">“使用testparm实用程序验证smb.conf文件”一节</a>
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_creating-a-gpo-to-enable-clients-to-trust-the-samba-print-server_assembly_setting-up-automatic-printer-driver-downloads-for-windows-clients"></a>创建GPO以使客户端信任Samba打印服务器</h3></div></div></div><p>出于安全原因，最近的Windows操作系统会阻止客户端从不受信任的服务器下载不支持包的打印机驱动程序。如果您的打印服务器是AD中的成员，则可以在域中创建组策略对象（GPO）以信任Samba服务器。
					</p><h5><a id="prerequisites_11"></a>先决条件</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Samba打印服务器是AD域的成员。
							</li><li class="listitem">用于创建GPO的Windows计算机必须安装Windows远程服务器管理工具（RSAT）。有关详细信息，请参阅Windows文档。
							</li></ul></div><h5><a id="procedure_31"></a>程序</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem">使用允许编辑组策略的帐户登录Windows计算机，例如AD域<code class="literal">Administrator</code>用户。
							</li><li class="listitem">打开<code class="literal">Group Policy Management Console</code> 。
							</li><li class="listitem"><p class="simpara">右键单击您的AD域，然后选择<code class="literal">Create a GPO in this domain, and Link it here</code> 。
							</p><div class="informalfigure"><div class="mediaobject"><img src="images/samba_create_new_GPO.png" alt="samba创建新的GPO"></div></div></li><li class="listitem">输入GPO的名称，例如<code class="literal">Legacy Printer Driver Policy</code> ，然后单击“ <code class="literal">OK</code> 。新的GPO将显示在域条目下。
							</li><li class="listitem">右键单击新创建的GPO，然后选择“ <code class="literal">Edit</code>以打开“ <code class="literal">Group Policy Management Editor</code> 。
							</li><li class="listitem"><p class="simpara">导航到<span class="guimenu">计算机配置</span> → <span class="guisubmenu">策略</span> → <span class="guisubmenu">管理模板</span> → <span class="guimenuitem">打印机</span> 。
							</p><div class="informalfigure"><div class="mediaobject"><img src="images/samba_select_printer_GPO_group.png" alt="samba选择打印机GPO组"></div></div></li><li class="listitem"><p class="simpara">在窗口的右侧，双击“ <code class="literal">Point and Print Restriction</code>以编辑策略：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">启用策略并设置以下选项：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">选择<code class="literal">Users can only point and print to these servers</code> ，并将Samba打印服务器的完全限定域名（FQDN）输入到此选项旁边的字段。
											</li><li class="listitem"><p class="simpara">在“ <code class="literal">Security Prompts</code>下的两个复选框中，选择<code class="literal">Do not show warning or elevation prompt</code> 。
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/samba_GPO_point_and_print.png" alt="samba GPO指向和打印"></div></div></li></ol></div></li><li class="listitem">单击确定。</li></ol></div></li><li class="listitem"><p class="simpara">双击<code class="literal">Package Point and Print - Approved servers</code>以编辑策略：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">启用该策略，然后单击“ <code class="literal">Show</code>按钮。
									</li><li class="listitem"><p class="simpara">输入Samba打印服务器的FQDN。
									</p><div class="informalfigure"><div class="mediaobject"><img src="images/samba_GPO_approved_servers.png" alt="samba GPO批准的服务器"></div></div></li><li class="listitem">单击“ <code class="literal">OK</code>关闭“ <code class="literal">Show Contents</code>和策略的属性窗口。</li></ol></div></li><li class="listitem">关闭<code class="literal">Group Policy Management Editor</code> 。
							</li><li class="listitem">关闭<code class="literal">Group Policy Management Console</code> 。
							</li></ol></div><p>Windows域成员应用组策略后，当用户连接到打印机时，将自动从Samba服务器下载打印机驱动程序。
					</p><h5><a id="additional_resources_21"></a>其他资源</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关使用组策略的更多详细信息，请参阅Windows文档。
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_uploading-drivers-and-preconfiguring-printers_assembly_setting-up-automatic-printer-driver-downloads-for-windows-clients"></a>上传驱动程序和预配置打印机</h3></div></div></div><p>使用Windows客户端上的“ <code class="literal">Print Management</code>应用程序上载Samba打印服务器上托管的驱动程序和预配置打印机。有关更多详细信息，请参阅Windows文档。
					</p></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_tuning-the-performance-of-a-samba-server_assembly_using-samba-as-a-server"></a>调整Samba服务器的性能</h1></div></div></div><p>本章介绍了在某些情况下哪些设置可以提高Samba的性能，以及哪些设置可能会对性能产生负面影响。
			</p><p>本节的部分内容是从Samba Wiki中发布的<a class="link" href="https://wiki.samba.org/index.php/Performance_Tuning">性能调优</a>文档中采用的。许可证： <a class="link" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> 。作者和贡献者：请参阅Wiki页面上的<a class="link" href="https://wiki.samba.org/index.php?title=Performance_Tuning&amp;action=history">历史记录</a>选项卡。
			</p><h3><a id="prerequisites-assembly_tuning-the-performance-of-a-samba-server"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Samba设置为文件或打印服务器</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_setting-the-smb-protocol-version_assembly_tuning-the-performance-of-a-samba-server"></a>设置SMB协议版本</h2></div></div></div><p>每个新的SMB版本都会增加功能并提高协议的性能。最近的Windows和Windows Server操作系统始终支持最新的协议版本。如果Samba也使用最新的协议版本，连接到Samba的Windows客户端将从性能改进中受益。在Samba中，服务器最大协议的默认值设置为最新支持的稳定SMB协议版本。
				</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>要始终启用最新的稳定SMB协议版本，请不要设置<code class="literal">server max protocol</code>参数。如果手动设置参数，则需要使用每个新版本的SMB协议修改设置，以启用最新的协议版本。
					</p></div><p>以下过程说明如何使用<code class="literal">server max protocol</code>参数中的默认值。
				</p><h4><a id="procedure_32"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem">从<code class="literal">/etc/samba/smb.conf</code>文件的<code class="literal">[global]</code>部分中删除<code class="literal">server max protocol</code>参数。
						</li><li class="listitem"><p class="simpara">重新加载Samba配置</p><pre class="literallayout"># smbcontrol all reload-config</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_tuning-shares-with-directories-that-contain-a-large-number-of-files_assembly_tuning-the-performance-of-a-samba-server"></a>使用包含大量文件的目录调整共享</h2></div></div></div><p>Linux支持区分大小写的文件名。因此，在搜索或访问文件时，Samba需要扫描目录中的大写和小写文件名。您可以配置共享以仅以小写或大写形式创建新文件，从而提高性能。
				</p><h4><a id="prerequisites_12"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Samba配置为文件服务器</li></ul></div><h4><a id="procedure_33"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">将共享上的所有文件重命名为小写。
						</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>使用此过程中的设置，将不再显示名称不是小写的文件。
							</p></div></li><li class="listitem"><p class="simpara">在共享的部分中设置以下参数：</p><pre class="literallayout">case sensitive = true
default case = lower
preserve case = no
short preserve case = no</pre><p class="simpara">有关参数的详细信息，请参阅<code class="literal">smb.conf(5)</code>手册页中的说明。
						</p></li><li class="listitem"><p class="simpara">验证<code class="literal">/etc/samba/smb.conf</code>文件：</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">重新加载Samba配置：</p><pre class="literallayout"># smbcontrol all reload-config</pre></li></ol></div><p>应用这些设置后，此共享上所有新创建的文件的名称使用小写。由于这些设置，Samba不再需要扫描目录中的大写和小写，这样可以提高性能。
				</p><h4><a id="additional_resources_22"></a>其他资源</h4><p>samba文档</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="使用testparm实用程序验证smb.conf文件">“使用testparm实用程序验证smb.conf文件”一节</a>
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="con_settings-that-can-have-a-negative-performance-impact_assembly_tuning-the-performance-of-a-samba-server"></a>可能会对性能产生负面影响的设置</h2></div></div></div><p>默认情况下，Red Hat Enterprise Linux中的内核针对高网络性能进行了调整。例如，内核使用缓冲区大小的自动调整机制。在<code class="literal">/etc/samba/smb.conf</code>文件中设置<code class="literal">socket options</code>参数会覆盖这些内核设置。因此，在大多数情况下，设置此参数会降低Samba网络性能。
				</p><p>要使用内核中的优化设置，请从<code class="literal">/etc/samba/smb.conf</code>的<code class="literal">[global]</code>部分删除<code class="literal">socket options</code>参数。
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_frequently-used-samba-command-line-utilities_assembly_using-samba-as-a-server"></a>经常使用的Samba命令行实用程序</h1></div></div></div><p>本章介绍使用Samba服务器时经常使用的命令。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assembly_using-the-net-utility_assembly_frequently-used-samba-command-line-utilities"></a>使用net实用程序</h2></div></div></div><p><code class="literal">net</code>实用程序使您可以在Samba服务器上执行多个管理任务。本节介绍<code class="literal">net</code>实用程序最常用的子命令。
				</p><h4><a id="prerequisites_13"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">安装了<code class="literal">samba-common-tools</code>包。
						</li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_using-the-net-ads-join-and-net-rpc-join-commands_assembly_using-the-net-utility"></a>使用net ads join和net rpc join命令</h3></div></div></div><p>使用<code class="literal">net</code>实用程序的<code class="literal">join</code>子命令，可以将Samba加入AD或NT4域。要加入域，您必须手动创建<code class="literal">/etc/samba/smb.conf</code>文件，并可选择更新其他配置，例如PAM。</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>Red Hat建议使用<code class="literal">realm</code>实用程序加入域。<code class="literal">realm</code>实用程序会自动更新所有涉及的配置文件。有关详细信息，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_joining-samba-to-a-domain_assembly_setting-up-samba-as-a-domain-member-server" title="将Samba加入域">“将Samba加入域”一节</a> 。
						</p></div><h5><a id="procedure_34"></a>程序</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">使用以下设置手动创建<code class="literal">/etc/samba/smb.conf</code>文件：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">对于AD域成员：</p><pre class="literallayout">[global]
workgroup = <span class="emphasis"><em>domain_name</em></span>
security = ads
passdb backend = tdbsam
realm = <span class="emphasis"><em>AD_REALM</em></span></pre></li><li class="listitem"><p class="simpara">对于NT4域成员：</p><pre class="literallayout">[global]
workgroup = <span class="emphasis"><em>domain_name</em></span>
security = user
passdb backend = tdbsam</pre></li></ul></div></li><li class="listitem">为<code class="literal">*</code> default域和要加入的域添加ID映射配置到<code class="literal">/etc/samba/smb.conf</code>文件中的<code class="literal">[global</code> ]部分。有关详细信息，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_samba-id-mapping_assembly_setting-up-samba-as-a-domain-member-server" title="Samba ID映射">“Samba ID映射”一节</a> 。
							</li><li class="listitem"><p class="simpara">验证<code class="literal">/etc/samba/smb.conf</code>文件：</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">以域管理员身份加入域：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要加入AD域：</p><pre class="literallayout"># net ads join -U "DOMAIN\administrator"</pre></li><li class="listitem"><p class="simpara">要加入NT4域名：</p><pre class="literallayout"># net rpc join -U "DOMAIN\administrator"</pre></li></ul></div></li><li class="listitem"><p class="simpara">将<code class="literal">winbind</code>源附加到<code class="literal">/etc/nsswitch.conf</code>文件中的<code class="literal">passwd</code>和<code class="literal">group</code>数据库条目：</p><pre class="literallayout">passwd:     files <code class="literal">winbind</code>
group:      files <code class="literal">winbind</code></pre></li><li class="listitem"><p class="simpara">启用并启动<code class="literal">winbind</code>服务：</p><pre class="literallayout"># systemctl enable winbind
# systemctl start winbind</pre></li><li class="listitem"><p class="simpara">（可选）使用<code class="literal">authselect</code>实用程序配置PAM。
							</p><p class="simpara">有关详细信息，请参见<code class="literal">authselect(8)</code>手册页。
							</p></li><li class="listitem"><p class="simpara">（可选）对于AD环境，请配置Kerberos客户端。
							</p><p class="simpara">有关详细信息，请参阅Kerberos客户端的文档。
							</p></li></ol></div><h5><a id="additional_resources_23"></a>其他资源</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="使用testparm实用程序验证smb.conf文件">“使用testparm实用程序验证smb.conf文件”一节</a>
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_using-the-net-rpc-rights-command_assembly_using-the-net-utility"></a>使用net rpc rights命令</h3></div></div></div><p>在Windows中，您可以为帐户和组分配权限以执行特殊操作，例如在共享上设置ACL或上载打印机驱动程序。在Samba服务器上，您可以使用<code class="literal">net rpc rights</code>命令来管理权限。
					</p><h5><a id="listing_privileges_you_can_set"></a>列出您可以设置的权限</h5><p>要列出所有可用权限及其所有者，请使用<code class="literal">net rpc rights list</code>命令。例如：</p><pre class="literallayout">net rpc rights list -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrator's password:
     SeMachineAccountPrivilege  Add machines to domain
      SeTakeOwnershipPrivilege  Take ownership of files or other objects
             SeBackupPrivilege  Back up files and directories
            SeRestorePrivilege  Restore files and directories
     SeRemoteShutdownPrivilege  Force shutdown from a remote system
      SePrintOperatorPrivilege  Manage printers
           SeAddUsersPrivilege  Add users and groups to the domain
       SeDiskOperatorPrivilege  Manage disk shares
           SeSecurityPrivilege  System security</pre><h5><a id="granting_privileges"></a>授予权限</h5><p>要为帐户或组授予权限，请使用<code class="literal">net rpc rights grant</code>命令。
					</p><p>例如，将<code class="literal">SePrintOperatorPrivilege</code>权限授予<code class="literal"><span class="emphasis"><em>DOMAIN</em></span> \printadmin</code>组：</p><pre class="literallayout"># net rpc rights grant "<span class="emphasis"><em>DOMAIN</em></span>\printadmin" SePrintOperatorPrivilege \
       -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrator's password:
Successfully granted rights.</pre><h5><a id="revoking_privileges"></a>撤销特权</h5><p>要撤消帐户或组的权限，请使用<code class="literal">net rpc rights revoke</code>命令。
					</p><p>例如，要从<code class="literal"><span class="emphasis"><em>DOMAIN</em></span> \printadmin</code>组撤消<code class="literal">SePrintOperatorPrivilege</code>权限：</p><pre class="literallayout"># net rpc rights remoke "<span class="emphasis"><em>DOMAIN</em></span>\printadmin" SePrintOperatorPrivilege \
       -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrator's password:
Successfully revoked rights.</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_using-the-net-rpc-share-command_assembly_using-the-net-utility"></a>使用net rpc share命令</h3></div></div></div><p><code class="literal">net rpc share</code>命令提供在本地或远程Samba或Windows服务器上列出，添加和删除共享的功能。
					</p><h5><a id="listing_shares"></a>上市股票</h5><p>要列出SMB服务器上的<code class="literal">net rpc share list</code> ，请使用<code class="literal">net rpc share list</code>命令。（可选）将<code class="literal">-S <span class="emphasis"><em>server_name</em></span></code>参数传递给命令以列出远程服务器的共享。例如：</p><pre class="literallayout"># net rpc share list -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator" -S <span class="emphasis"><em>server_name</em></span>
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrator's password:
IPC$
<span class="emphasis"><em>share_1</em></span>
<span class="emphasis"><em>share_2</em></span>
...</pre><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>在<code class="literal">/etc/samba/smb.conf</code>文件的部分中具有<code class="literal">browseable = no</code> set的Samba服务器上托管的共享不会显示在输出中。
						</p></div><h5><a id="adding_a_share"></a>添加分享</h5><p><code class="literal">net rpc share add</code>命令可以将共享添加到SMB服务器。
					</p><p>例如，要在共享<code class="literal">C:\example\</code>目录的远程Windows服务器上添加名为<code class="literal">example</code>的共享：</p><pre class="literallayout"># net rpc share add example="C:\example" -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator" -S <span class="emphasis"><em>server_name</em></span></pre><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>指定Windows目录名时，必须省略路径中的尾部反斜杠。
						</p></div><p>要使用该命令将共享添加到Samba服务器：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">-U</code>参数中指定的用户必须在目标服务器上授予<code class="literal">SeDiskOperatorPrivilege</code>特权。
							</li><li class="listitem">您必须编写一个脚本，将共享部分添加到<code class="literal">/etc/samba/smb.conf</code>文件并重新加载Samba。必须在<code class="literal">/etc/samba/smb.conf</code>的<code class="literal">[global]</code>部分的<code class="literal">add share command</code>参数中设置该脚本。有关更多详细信息，请参阅<code class="literal">smb.conf(5)</code>手册页中的<code class="literal">add share command</code>说明。
							</li></ul></div><h5><a id="removing_a_share"></a>删除共享</h5><p><code class="literal">net rpc share delete</code>命令可以从SMB服务器中删除共享。
					</p><p>例如，要从远程Windows服务器中删除名为example的共享：</p><pre class="literallayout"># net rpc share delete example -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator" -S <span class="emphasis"><em>server_name</em></span></pre><p>要使用该命令从Samba服务器中删除共享：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">-U</code>参数中指定的用户必须具有<code class="literal">SeDiskOperatorPrivilege</code>权限。
							</li><li class="listitem">您必须编写一个脚本，从<code class="literal">/etc/samba/smb.conf</code>文件中删除共享部分并重新加载Samba。必须在<code class="literal">/etc/samba/smb.conf</code>的<code class="literal">[global]</code>部分的<code class="literal">delete share command</code>参数中设置该脚本。有关更多详细信息，请参见<code class="literal">smb.conf(5)</code>手册页中的<code class="literal">delete share command</code>说明。
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_using-the-net-user-command_assembly_using-the-net-utility"></a>使用net user命令</h3></div></div></div><p><code class="literal">net user</code>命令使您可以在AD DC或NT4 PDC上执行以下操作：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">列出所有用户帐户</li><li class="listitem">添加用户</li><li class="listitem">删除用户</li></ul></div><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>只有在列出域用户帐户时，才需要指定连接方法，例如AD域的<code class="literal">ads</code>或NT4域的<code class="literal">rpc</code> 。其他与用户相关的子命令可以自动检测连接方法。
						</p></div><p>将<code class="literal">-U <span class="emphasis"><em>user_name</em></span></code>参数传递给该命令，以指定允许执行请求的操作的用户。
					</p><h5><a id="listing_domain_user_accounts"></a>列出域用户帐户</h5><p>列出AD域中的所有用户：</p><pre class="literallayout"># net ads user -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"</pre><p>列出NT4域中的所有用户：</p><pre class="literallayout"># net rpc user -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"</pre><h5><a id="adding_a_user_account_to_the_domain"></a>将用户帐户添加到域</h5><p>在Samba域成员上，您可以使用<code class="literal">net user add</code>命令将用户帐户添加到域。
					</p><p>例如，将<code class="literal">user</code>帐户添加到域：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">添加帐户：</p><pre class="literallayout"># net user add <span class="emphasis"><em>user</em></span> <span class="emphasis"><em>password</em></span> -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
User <span class="emphasis"><em>user</em></span> added</pre></li><li class="listitem"><p class="simpara">（可选）使用远程过程调用（RPC）shell在AD DC或NT4 PDC上启用该帐户。例如：</p><pre class="literallayout"># net rpc shell -U <span class="emphasis"><em>DOMAIN</em></span>\administrator -S <span class="emphasis"><em>DC_or_PDC_name</em></span>
Talking to domain DOMAIN (<span class="emphasis"><em>S-1-5-21-1424831554-512457234-5642315751</em></span>)

net rpc&gt; user edit disabled <span class="emphasis"><em>user</em></span>: no
Set <span class="emphasis"><em>user</em></span>'s disabled flag from [yes] to [no]

net rpc&gt; exit</pre></li></ol></div><h5><a id="deleting_a_user_account_from_the_domain"></a>从域中删除用户帐户</h5><p>在Samba域成员上，您可以使用<code class="literal">net user delete</code>命令从域中删除用户帐户。
					</p><p>例如，要从域中删除<code class="literal">user</code>帐户：</p><pre class="literallayout"># net user delete <span class="emphasis"><em>user</em></span> -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
User <span class="emphasis"><em>user</em></span> deleted</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="assembly_using-the-net-usershare-command_assembly_using-the-net-utility"></a>使用net usershare命令</h3></div></div></div><p>在Samba服务器上，您可以配置用户可以共享没有root权限的目录。
					</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="proc_enabling-the-user-shares-feature_assembly_using-the-net-usershare-command"></a>启用用户共享功能</h4></div></div></div><p>在用户可以共享目录之前，管理员必须在Samba中启用用户共享。
						</p><p>例如，仅允许本地<code class="literal">example</code>组的成员创建用户共享。
						</p><h6><a id="procedure_35"></a>程序</h6><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">创建本地<code class="literal">example</code>组（如果它不存在）：</p><pre class="literallayout"># groupadd example</pre></li><li class="listitem"><p class="simpara">准备Samba目录以存储用户共享定义并正确设置其权限。例如：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">创建目录：</p><pre class="literallayout"># mkdir -p /var/lib/samba/usershares/</pre></li><li class="listitem"><p class="simpara">设置<code class="literal">example</code>组的写入权限：</p><pre class="literallayout"># chgrp example /var/lib/samba/usershares/
# chmod 1770 /var/lib/samba/usershares/</pre></li><li class="listitem">设置粘滞位以防止用户重命名或删除此目录中其他用户存储的文件。
										</li></ol></div></li><li class="listitem"><p class="simpara">编辑<code class="literal">/etc/samba/smb.conf</code>文件并将以下内容添加到<code class="literal">[global]</code>部分：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">设置指定用于存储用户共享定义的目录的路径。例如：</p><pre class="literallayout">usershare path = /var/lib/samba/usershares/</pre></li><li class="listitem"><p class="simpara">设置允许在此服务器上创建Samba的用户份额。例如：</p><pre class="literallayout">usershare max shares = 100</pre><p class="simpara">如果对<code class="literal">usershare max shares</code>参数使用默认值<code class="literal">0</code> ，则禁用用户共享。
										</p></li><li class="listitem"><p class="simpara">（可选）设置绝对目录路径列表。例如，要配置Samba仅允许共享要共享的<code class="literal">/data</code>和<code class="literal">/srv</code>目录的子目录，请设置：</p><pre class="literallayout">usershare prefix allow list = /data /srv</pre></li></ol></div><p class="simpara">有关可以设置的其他用户共享相关参数的列表，请参阅<code class="literal">smb.conf(5)</code>手册页中的<code class="literal">USERSHARES</code>部分。
								</p></li><li class="listitem"><p class="simpara">验证<code class="literal">/etc/samba/smb.conf</code>文件：</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">重新加载Samba配置：</p><pre class="literallayout"># smbcontrol all reload-config</pre></li></ol></div><p>用户现在可以创建用户共享。有关详细信息，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_adding-a-user-share_assembly_enabling-users-to-share-directories-on-a-samba-server" title="添加用户共享">“添加用户共享”一节</a> 。
						</p><h6><a id="additional_resources_24"></a>其他资源</h6><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="使用testparm实用程序验证smb.conf文件">“使用testparm实用程序验证smb.conf文件”一节</a>
								</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="proc_adding-a-user-share_assembly_using-the-net-usershare-command"></a>添加用户共享</h4></div></div></div><p>根据<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_enabling-the-user-shares-feature_assembly_enabling-users-to-share-directories-on-a-samba-server" title="启用用户共享功能">“启用用户共享功能”一节</a>配置Samba后，用户可以通过运行<code class="literal">net usershare add</code>命令在没有<code class="literal">root</code>权限的情况下共享Samba服务器上的目录。
						</p><p><code class="literal">net usershare add</code>命令的概要：</p><p>
							<code class="literal">net usershare add</code> share_name path [[comment] | [ACLs]] [guest_ok = y | n]</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>如果在创建用户共享时设置ACL，则必须在ACL之前指定comment参数。要设置空注释，请在双引号中使用空字符串。
							</p></div><p>请注意，如果管理员在<code class="literal">/etc/samba/smb.conf</code>文件的<code class="literal">[global]</code>部分中设置<code class="literal">usershare allow guests = yes</code> ，则用户只能在用户共享上启用访客访问权限。
						</p><div class="example"><a id="idm140241871132432"></a><p class="title"><strong>例2.8。添加用户共享</strong></p><div class="example-contents"><p>用户想要在Samba服务器上共享<code class="literal">/srv/samba/</code>目录。共享应该命名为<code class="literal">example</code> ，没有注释集，并且guest用户应该可以访问。此外，共享权限应设置为<code class="literal">AD\Domain Users</code>组的完全访问权限和其他用户的读取权限。要添加此共享，请以用户身份运行：</p><pre class="literallayout">$ net usershare add example /srv/samba/ "" \
       "AD\Domain Users":F,Everyone:R guest_ok=yes</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="proc_updating-settings-of-a-user-share_assembly_using-the-net-usershare-command"></a>更新用户共享的设置</h4></div></div></div><p>要更新用户共享的设置，请使用具有相同共享名称和新设置的<code class="literal">net usershare add</code>命令覆盖共享。请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_adding-a-user-share_assembly_enabling-users-to-share-directories-on-a-samba-server" title="添加用户共享">“添加用户共享”一节</a> 。
						</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="proc_displaying-information-about-existing-user-shares_assembly_using-the-net-usershare-command"></a>显示有关现有用户共享的信息</h4></div></div></div><p>用户可以在Samba服务器上输入<code class="literal">net usershare info</code>命令以显示用户共享及其设置。
						</p><h6><a id="prerequisites_14"></a>先决条件</h6><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">在Samba服务器上配置用户共享。
								</li></ul></div><h6><a id="procedure_36"></a>程序</h6><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要显示任何用户创建的所有用户共享：</p><pre class="literallayout">$ net usershare info -l
[<span class="emphasis"><em>share_1</em></span>]
path=<span class="emphasis"><em>/srv/samba/</em></span>
comment=
usershare_acl=<span class="emphasis"><em>Everyone:R,host_name\user:F,</em></span>
guest_ok=<span class="emphasis"><em>y</em></span>
...</pre><p class="simpara">要仅列出运行该命令的用户创建的共享，请省略<code class="literal">-l</code>参数。
								</p></li><li class="listitem"><p class="simpara">要仅显示有关特定共享的信息，请将共享名称或通配符传递给该命令。例如，要显示名称以<code class="literal">share_</code>开头的共享信息：</p><pre class="literallayout">$ net usershare info -l share_*</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="proc_listing-user-shares_assembly_using-the-net-usershare-command"></a>列出用户共享</h4></div></div></div><p>如果要在Samba服务器上仅列出可用的用户共享而不进行设置，请使用<code class="literal">net usershare list</code>命令。
						</p><h6><a id="prerequisites_15"></a>先决条件</h6><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">在Samba服务器上配置用户共享。
								</li></ul></div><h6><a id="procedure_37"></a>程序</h6><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">列出任何用户创建的共享：</p><pre class="literallayout">$ net usershare list -l
<span class="emphasis"><em>share_1</em></span>
<span class="emphasis"><em>share_2</em></span>
...</pre><p class="simpara">要仅列出运行该命令的用户创建的共享，请省略<code class="literal">-l</code>参数。
								</p></li><li class="listitem"><p class="simpara">要仅列出特定共享，请将共享名称或通配符传递给该命令。例如，要仅列出名称以<code class="literal">share_</code>开头的<code class="literal">share_</code> ：</p><pre class="literallayout">$ net usershare list -l share_*</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="proc_deleting-a-user-share_assembly_using-the-net-usershare-command"></a>删除用户共享</h4></div></div></div><p>要删除用户共享，请使用命令<code class="literal">net usershare delete</code>命令作为创建共享的用户或<code class="literal">root</code>用户。
						</p><h6><a id="prerequisites_16"></a>先决条件</h6><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">在Samba服务器上配置用户共享。
								</li></ul></div><h6><a id="procedure_38"></a>程序</h6><pre class="literallayout">$ net usershare delete <span class="emphasis"><em>share_name</em></span></pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_using-the-rpcclient-utility_assembly_frequently-used-samba-command-line-utilities"></a>使用rpcclient实用程序</h2></div></div></div><p><code class="literal">rpcclient</code>实用程序使您可以在本地或远程SMB服务器上手动执行客户端Microsoft远程过程调用（MS-RPC）功能。但是，大多数功能都集成到Samba提供的单独实用程序中。仅使用<code class="literal">rpcclient</code>测试MS-PRC功能。
				</p><h4><a id="prerequisites_17"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">安装了<code class="literal">samba-client</code>软件包。
						</li></ul></div><h4><a id="examples"></a>例子</h4><p>例如，您可以使用<code class="literal">rpcclient</code>实用程序：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">管理打印机假脱机子系统（SPOOLSS）。
						</p><div class="example"><a id="idm140241748059712"></a><p class="title"><strong>例2.9。将驱动程序分配给打印机</strong></p><div class="example-contents"><pre class="literallayout"># rpcclient <span class="emphasis"><em>server_name</em></span> -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator" \
       -c 'setdriver "<span class="emphasis"><em>printer_name</em></span>" "<span class="emphasis"><em>driver_name</em></span>"'
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrators password:
Successfully set <span class="emphasis"><em>printer_name</em></span> to driver <span class="emphasis"><em>driver_name</em></span>.</pre></div></div></li><li class="listitem"><p class="simpara">检索有关SMB服务器的信息。
						</p><div class="example"><a id="idm140241748053520"></a><p class="title"><strong>例2.10。列出所有文件共享和共享打印机</strong></p><div class="example-contents"><pre class="literallayout"># rpcclient <span class="emphasis"><em>server_name</em></span> -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator" -c 'netshareenum'
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrators password:
netname: <span class="emphasis"><em>Example_Share</em></span>
	remark:
	path:   <span class="emphasis"><em>C:\srv\samba\example_share\</em></span>
	password:
netname: <span class="emphasis"><em>Example_Printer</em></span>
	remark:
	path:   <span class="emphasis"><em>C:\var\spool\samba\</em></span>
	password:</pre></div></div></li><li class="listitem"><p class="simpara">使用安全帐户管理器远程（SAMR）协议执行操作。
						</p><div class="example"><a id="idm140241748047280"></a><p class="title"><strong>例2.11。在SMB服务器上列出用户</strong></p><div class="example-contents"><pre class="literallayout"># rpcclient <span class="emphasis"><em>server_name</em></span> -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator" -c 'enumdomusers'
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrators password:
user:[<span class="emphasis"><em>user1</em></span>] rid:[<span class="emphasis"><em>0x3e8</em></span>]
user:[<span class="emphasis"><em>user2</em></span>] rid:[<span class="emphasis"><em>0x3e9</em></span>]</pre></div></div><p class="simpara">如果对独立服务器或域成员运行该命令，则会列出本地数据库中的用户。对AD DC或NT4 PDC运行命令会列出域用户。
						</p></li></ul></div><h4><a id="additional_resources_25"></a>其他资源</h4><p>有关受支持的子命令的完整列表，请参阅<code class="literal">rpcclient(1)</code>手册页中的<code class="literal">COMMANDS</code>部分。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_using-the-samba-regedit-application_assembly_frequently-used-samba-command-line-utilities"></a>使用samba-regedit应用程序</h2></div></div></div><p>某些设置（如打印机配置）存储在Samba服务器的注册表中。您可以使用基于ncurses的<code class="literal">samba-regedit</code>应用程序来编辑Samba服务器的注册表。
				</p><p>
					<span class="inlinemediaobject"><img src="images/samba-regedit.png" alt="桑巴注册"></span>

				</p><h4><a id="prerequisites_18"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">安装了<code class="literal">samba-client</code>软件包。
						</li></ul></div><h4><a id="procedure_39"></a>程序</h4><p>要启动该应用程序，请输入：</p><pre class="literallayout"># samba-regedit</pre><p>使用以下键：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">光标向上和光标向下：浏览注册表树和值。
						</li><li class="listitem">
							<span class="keycap"><strong>输入</strong></span> ：打开键或编辑值。
						</li><li class="listitem">
							<span class="keycap"><strong>选项卡</strong></span> ：在“ <code class="literal">Key</code>和“ <code class="literal">Value</code>窗格之间切换。
						</li><li class="listitem">
							<span class="keycap"><strong>Ctrl</strong></span> + <span class="keycap"><strong>C</strong></span> ：关闭应用程序。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assembly_using-the-smbcacls-utility_assembly_frequently-used-samba-command-line-utilities"></a>使用smbcacls实用程序</h2></div></div></div><p><code class="literal">smbcacls</code>实用程序可以列出，设置和删除存储在SMB共享中的文件和目录的ACL。您可以使用<code class="literal">smbcacls</code>来管理文件系统ACL：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">在使用高级Windows ACL或POSIX ACL的本地或远程Samba服务器上</li><li class="listitem">在Red Hat Enterprise Linux上远程管理Windows上托管的共享上的ACL</li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="con_access-control-entries_assembly_using-the-smbcacls-utility"></a>访问控制条目</h3></div></div></div><p>文件系统对象的每个ACL条目都包含以下格式的访问控制条目（ACE）：</p><pre class="literallayout"><span class="emphasis"><em>security_principal</em></span>:<span class="emphasis"><em>access_right</em></span>/<span class="emphasis"><em>inheritance_information</em></span>/<span class="emphasis"><em>permissions</em></span></pre><div class="example"><a id="idm140241748007232"></a><p class="title"><strong>例2.12。访问控制条目</strong></p><div class="example-contents"><p>如果<code class="literal">AD\Domain Users</code>组具有适用于Windows上<code class="literal">This folder, subfolders, and files</code> <code class="literal">Modify</code>权限，则ACL包含以下ACE：</p><pre class="literallayout">AD\Domain Users:ALLOWED/OI|CI/CHANGE</pre></div></div><p>ACE包含以下部分：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">安全负责人</span></dt><dd>安全主体是应用ACL中的权限的用户，组或SID。
								</dd><dt><span class="term">访问权</span></dt><dd>定义是否授予或拒绝对对象的访问。该值可以<code class="literal">ALLOWED</code>或<code class="literal">DENIED</code> 。</dd><dt><span class="term">继承信息</span></dt><dd><p class="simpara">存在以下值：</p><div class="table"><a id="idm140241847111600"></a><p class="title"><strong>表2.5。继承设置</strong></p><div class="table-contents"><table border="1" summary="Inheritance settings"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th valign="top" style="text-align:left">值</th><th valign="top" style="text-align:left">描述</th><th valign="top" style="text-align:left">地图到</th></tr></thead><tbody><tr><td valign="top" style="text-align:left"> <p>
													<code class="literal">OI</code>
												</p>
												 </td><td valign="top" style="text-align:left"> <p>对象继承</p>
												 </td><td valign="top" style="text-align:left"> <p>这个文件夹和文件</p>
												 </td></tr><tr><td valign="top" style="text-align:left"> <p>
													<code class="literal">CI</code>
												</p>
												 </td><td valign="top" style="text-align:left"> <p>容器继承</p>
												 </td><td valign="top" style="text-align:left"> <p>此文件夹和子文件夹</p>
												 </td></tr><tr><td valign="top" style="text-align:left"> <p>
													<code class="literal">IO</code>
												</p>
												 </td><td valign="top" style="text-align:left"> <p>仅继承</p>
												 </td><td valign="top" style="text-align:left"> <p>ACE不适用于当前文件或目录</p>
												 </td></tr><tr><td valign="top" style="text-align:left"> <p>
													<code class="literal">ID</code>
												</p>
												 </td><td valign="top" style="text-align:left"> <p>遗传</p>
												 </td><td valign="top" style="text-align:left"> <p>ACE是从父目录继承的</p>
												 </td></tr></tbody></table></div></div><p class="simpara">此外，值可以组合如下：</p><div class="table"><a id="idm140241847078176"></a><p class="title"><strong>表2.6。继承设置组合</strong></p><div class="table-contents"><table border="1" summary="Inheritance settings combinations"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th valign="top" style="text-align:left">价值组合</th><th valign="top" style="text-align:left">映射到Windows <code class="literal">Applies to</code>设置</th></tr></thead><tbody><tr><td valign="top" style="text-align:left"> <p>
													<code class="literal">OI | CI</code>
												</p>
												 </td><td valign="top" style="text-align:left"> <p>此文件夹，子文件夹和文件</p>
												 </td></tr><tr><td valign="top" style="text-align:left"> <p>
													<code class="literal">OI | CI | IO</code>
												</p>
												 </td><td valign="top" style="text-align:left"> <p>仅限子文件夹和文件</p>
												 </td></tr><tr><td valign="top" style="text-align:left"> <p>
													<code class="literal">CI | IO</code>
												</p>
												 </td><td valign="top" style="text-align:left"> <p>仅限子文件夹</p>
												 </td></tr><tr><td valign="top" style="text-align:left"> <p>
													<code class="literal">OI | IO</code>
												</p>
												 </td><td valign="top" style="text-align:left"> <p>仅限文件</p>
												 </td></tr></tbody></table></div></div></dd><dt><span class="term">权限</span></dt><dd><p class="simpara">此值可以是表示一个或多个Windows权限的十六进制值或<code class="literal">smbcacls</code>别名：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">十六进制值，表示一个或多个Windows权限。
										</p><p class="simpara">下表以十六进制格式显示高级Windows权限及其对应值：</p><div class="table"><a id="table_windows-permissions-hex-values_assembly_using-the-smbcacls-utility"></a><p class="title"><strong>表2.7。Windows权限及其对应的smbcacl值以十六进制格式表示</strong></p><div class="table-contents"><table border="1" summary="Windows permissions and their corresponding smbcacls value in hex format"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th valign="top" style="text-align:left">Windows权限</th><th valign="top" style="text-align:left">十六进制值</th></tr></thead><tbody><tr><td valign="top" style="text-align:left"> <p>完全控制</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x001F01FF</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>遍历文件夹/执行文件</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00100020</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>列出文件夹/读取数据</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00100001</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>读属性</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00100080</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>读扩展属性</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00100008</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>创建文件/写入数据</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00100002</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>创建文件夹/附加数据</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00100004</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>写属性</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00100100</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>写扩展属性</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00100010</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>删除子文件夹和文件</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00100040</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>删除</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00110000</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>读取权限</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00120000</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>更改权限</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00140000</code>
														</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>取得所有权</p>
														 </td><td valign="top" style="text-align:left"> <p>
															<code class="literal">0x00180000</code>
														</p>
														 </td></tr></tbody></table></div></div><p class="simpara">可以使用逐位<code class="literal">OR</code>运算将多个权限组合为单个十六进制值。有关详细信息，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#con_ace-mask-calculation_assembly_managing-acls-on-an-smb-share-using-smbcacls" title="ACE掩码计算">“ACE掩码计算”一节</a> 。
										</p></li><li class="listitem"><p class="simpara"><code class="literal">smbcacls</code>别名。下表显示了可用的别名：</p><div class="table"><a id="table_smbcacls-aliases_assembly_using-the-smbcacls-utility"></a><p class="title"><strong>表2.8。现有的smbcacls别名及其相应的Windows权限</strong></p><div class="table-contents"><table border="1" summary="Existing smbcacls aliases and their corresponding Windows permission"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th valign="top" style="text-align:left"><code class="literal">smbcacls</code>别名</th><th valign="top" style="text-align:left">映射到Windows权限</th></tr></thead><tbody><tr><td valign="top" style="text-align:left"> <p>
															<code class="literal">[R</code>
														</p>
														 </td><td valign="top" style="text-align:left"> <p>读</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>
															<code class="literal">读</code>
														</p>
														 </td><td valign="top" style="text-align:left"> <p>阅读并执行</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>
															<code class="literal">w ^</code>
														</p>
														 </td><td valign="top" style="text-align:left"> <p>特别：</p>
														 <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">创建文件/写入数据</li><li class="listitem">创建文件夹/附加数据</li><li class="listitem">写属性</li><li class="listitem">写扩展属性</li><li class="listitem">读取权限</li></ul></div>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>
															<code class="literal">d</code>
														</p>
														 </td><td valign="top" style="text-align:left"> <p>删除</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>
															<code class="literal">P</code>
														</p>
														 </td><td valign="top" style="text-align:left"> <p>更改权限</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>
															<code class="literal">Ø</code>
														</p>
														 </td><td valign="top" style="text-align:left"> <p>取得所有权</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>
															<code class="literal">X</code>
														</p>
														 </td><td valign="top" style="text-align:left"> <p>遍历/执行</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>
															<code class="literal">更改</code>
														</p>
														 </td><td valign="top" style="text-align:left"> <p>修改</p>
														 </td></tr><tr><td valign="top" style="text-align:left"> <p>
															<code class="literal">充分</code>
														</p>
														 </td><td valign="top" style="text-align:left"> <p>完全控制</p>
														 </td></tr></tbody></table></div></div><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>设置权限时，可以组合单字母别名。例如，您可以设置<code class="literal">RD</code>以应用Windows权限<code class="literal">Read</code>和<code class="literal">Delete</code> 。但是，您既不能组合多个非单字母别名，也不能组合别名和十六进制值。
											</p></div></li></ul></div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_displaying-acls-using-smbcacls_assembly_using-the-smbcacls-utility"></a>使用smbcacls显示ACL</h3></div></div></div><p>要在SMB共享上显示ACL，请使用<code class="literal">smbcacls</code>实用程序。如果运行<code class="literal">smbcacls</code>而没有任何操作参数（例如<code class="literal">--add</code> ，该实用程序将显示文件系统对象的ACL。
					</p><h5><a id="procedure_40"></a>程序</h5><p>例如，要列出<code class="literal">//server/example</code>共享的根目录的ACL：</p><pre class="literallayout"># smbcacls //server/example / -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrator's password:
REVISION:1
CONTROL:SR|PD|DI|DP
OWNER:AD\Administrators
GROUP:AD\Domain Users
ACL:AD\Administrator:ALLOWED/OI|CI/FULL
ACL:AD\Domain Users:ALLOWED/OI|CI/CHANGE
ACL:AD\Domain Guests:ALLOWED/OI|CI/0x00100021</pre><p>该命令的输出显示：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<code class="literal">REVISION</code> ：安全描述符的内部Windows NT ACL修订版</li><li class="listitem">
								<code class="literal">CONTROL</code> ：安全描述符控制</li><li class="listitem">
								<code class="literal">OWNER</code> ：安全描述符<code class="literal">OWNER</code>名称或SID</li><li class="listitem">
								<code class="literal">GROUP</code> ：安全描述符组的名称或SID</li><li class="listitem">
								<code class="literal">ACL</code>条目。有关详细信息，请参阅<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#con_access-control-entries_assembly_managing-acls-on-an-smb-share-using-smbcacls" title="访问控制条目">“访问控制条目”一节</a> 。
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="con_ace-mask-calculation_assembly_using-the-smbcacls-utility"></a> ACE掩码计算</h3></div></div></div><p>在大多数情况下，当您添加或更新ACE，您使用<code class="literal">smbcacls</code>中列出的别名<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#table_smbcacls-aliases_assembly_managing-acls-on-an-smb-share-using-smbcacls" title="表2.4。现有的smbcacls别名及其相应的Windows权限">表2.4，“现有smbcacls别名及其相应的Windows许可”</a> 。
					</p><p>但是，如果要设置<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#table_windows-permissions-hex-values_assembly_managing-acls-on-an-smb-share-using-smbcacls" title="表2.3。Windows权限及其对应的smbcacl值以十六进制格式表示">表2.3“Windows权限及其相应的smbcacls值以十六进制格式”中</a>列出的高级Windows权限，则必须使用按位<code class="literal">OR</code>运算来计算正确的值。您可以使用以下shell命令来计算值：</p><pre class="literallayout"># echo $(printf '0x%X' $(( hex_value_1 | hex_value_2 | ... )))</pre><div class="example"><a id="idm140241755329040"></a><p class="title"><strong>例2.13。计算ACE掩码</strong></p><div class="example-contents"><p>您想要设置以下权限：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">遍历文件夹/执行文件（0x00100020）</li><li class="listitem">列表文件夹/读取数据（0x00100001）</li><li class="listitem">读属性（0x00100080）</li></ul></div><p>要计算先前权限的十六进制值，请输入：</p><pre class="literallayout"># echo $(printf '0x%X' $(( 0x00100020 | 0x00100001 | 0x00100080 )))
<code class="literal">0x1000A1</code></pre><p>设置或更新ACE时使用返回的值。</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_adding-updating-and-removing-an-acl-using-smbcacls_assembly_using-the-smbcacls-utility"></a>使用smbcacls添加，更新和删除ACL</h3></div></div></div><p>根据传递给<code class="literal">smbcacls</code>实用程序的参数，您可以从文件或目录添加，更新和删除ACL。
					</p><h5><a id="adding_an_acl_2"></a>添加ACL</h5><p>要将ACL添加到<code class="literal">//server/example</code>共享的根目录，该共享权限<code class="literal">This folder, subfolders, and files</code> <code class="literal">CHANGE</code>权限授予<code class="literal">AD\Domain Users</code>组：</p><pre class="literallayout"># smbcacls //server/example / -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator \
       --add ACL:"AD\Domain Users":ALLOWED/OI|CI/CHANGE</pre><h5><a id="updating_an_acl_2"></a>更新ACL</h5><p>更新ACL与添加新ACL类似。您可以通过使用带有现有安全主体的<code class="literal">--modify</code>参数覆盖ACL来更新ACL。如果<code class="literal">smbcacls</code>在ACL列表中找到安全主体，则该实用程序将更新权限。否则命令失败并显示错误：</p><pre class="literallayout">ACL for SID <span class="emphasis"><em>principal_name</em></span> not found</pre><p>例如，要更新<code class="literal">AD\Domain Users</code>组的权限并将其设置为<code class="literal">READ</code> for <code class="literal">This folder, subfolders, and files</code> ：</p><pre class="literallayout"># smbcacls //server/example / -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator \
       --modify ACL:"AD\Domain Users":ALLOWED/OI|CI/READ</pre><h5><a id="deleting_an_acl_2"></a>删除ACL</h5><p>要删除ACL，请将带有确切ACL的<code class="literal">--delete</code>参数传递给<code class="literal">smbcacls</code>实用程序。例如：</p><pre class="literallayout"># smbcacls //server/example / -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator \
       --delete ACL:"AD\Domain Users":ALLOWED/OI|CI/READ</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assembly_using-the-smbclient-utility_assembly_frequently-used-samba-command-line-utilities"></a>使用smbclient实用程序</h2></div></div></div><p>使用smbclient实用程序可以访问SMB服务器上的文件共享，类似于命令行FTP客户端。例如，您可以使用它来上传和下载共享文件。
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="prerequisites-assembly_using-the-smbclient-utility"></a>先决条件</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">安装了<code class="literal">samba-client</code>软件包。
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="con_how-the-smbclient-interactive-mode-works_assembly_using-the-smbclient-utility"></a> smbclient交互模式如何工作</h3></div></div></div><p>例如，要使用<code class="literal"><span class="emphasis"><em>DOMAIN\user</em></span></code>帐户对托管在<code class="literal">server</code>上的<code class="literal">example</code>共享进行身份验证：</p><pre class="literallayout"># smbclient -U "<span class="emphasis"><em>DOMAIN\user</em></span>" //<span class="emphasis"><em>server</em></span>/<span class="emphasis"><em>example</em></span>
Enter <span class="emphasis"><em>domain\user</em></span>'s password:
Try "help" to get a list of possible commands.
smb: \&gt;</pre><p>在<code class="literal">smbclient</code>成功连接到共享后，该实用程序进入交互模式并显示以下提示：</p><pre class="literallayout">smb: \&gt;</pre><p>要在交互式shell中显示所有可用命令，请输入：</p><pre class="literallayout">smb: \&gt; help</pre><p>要显示特定命令的帮助，请输入：</p><pre class="literallayout">smb: \&gt; help <span class="emphasis"><em>command_name</em></span></pre><h5><a id="additional_resources_26"></a>其他资源</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关交互式shell中可用命令的更多详细信息和说明，请参见<code class="literal">smbclient(1)</code>手册页。
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_using-smbclient-in-interactive-mode_assembly_using-the-smbclient-utility"></a>在交互模式下使用smbclient</h3></div></div></div><p>如果使用不带<code class="literal">-c</code>参数的<code class="literal">smbclient</code> ，该实用程序将进入交互模式。以下过程说明如何连接到SMB共享并从子目录下载文件。
					</p><h5><a id="procedure_41"></a>程序</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">连接到共享：</p><pre class="literallayout"># smbclient -U "<span class="emphasis"><em>DOMAIN\user_name</em></span>" //<span class="emphasis"><em>server_name</em></span>/<span class="emphasis"><em>share_name</em></span></pre></li><li class="listitem"><p class="simpara">转到<code class="literal">/example/</code>目录：</p><pre class="literallayout">smb: \&gt; cd /example/</pre></li><li class="listitem"><p class="simpara">列出目录中的文件：</p><pre class="literallayout">smb: \example\&gt; ls
  .                    D         0  Thu Nov 1 10:00:00 2018
  ..                   D         0  Thu Nov 1 10:00:00 2018
  example.txt          N   1048576  Thu Nov 1 10:00:00 2018

         9950208 blocks of size 1024. 8247144 blocks available</pre></li><li class="listitem"><p class="simpara">下载<code class="literal">example.txt</code>文件：</p><pre class="literallayout">smb: \example\&gt; get example.txt
getting file \directory\subdirectory\example.txt of size 1048576 as example.txt (511975,0 KiloBytes/sec) (average 170666,7 KiloBytes/sec)</pre></li><li class="listitem"><p class="simpara">断开与共享：</p><pre class="literallayout">smb: \example\&gt; exit</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_using-smbclient-in-scripting-mode_assembly_using-the-smbclient-utility"></a>在脚本模式下使用smbclient</h3></div></div></div><p>如果将<code class="literal">-c</code>参数传递给<code class="literal">smbclient</code> ，则可以自动执行远程SMB共享上的命令。这使您可以在脚本中使用<code class="literal">smbclient</code> 。
					</p><p>以下过程说明如何连接到SMB共享并从子目录下载文件。
					</p><h5><a id="procedure_42"></a>程序</h5><pre class="literallayout"># smbclient -U <span class="emphasis"><em>DOMAIN\user_name</em></span> //<span class="emphasis"><em>server_name</em></span>/<span class="emphasis"><em>share_name</em></span> \
       -c "cd /example/ ; get example.txt ; exit"</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_using-the-smbcontrol-utility_assembly_frequently-used-samba-command-line-utilities"></a>使用smbcontrol实用程序</h2></div></div></div><p><code class="literal">smbcontrol</code>实用程序使您可以将命令消息发送到<code class="literal">smbd</code> ， <code class="literal">nmbd</code> ， <code class="literal">winbindd</code>或所有这些服务。这些控制消息指示服务，例如，重新加载其配置。
				</p><p>本节中的过程说明如何通过将<code class="literal">reload-config</code>消息类型发送到<code class="literal">all</code>目标来重新加载<code class="literal">smbd</code> ， <code class="literal">nmbd</code> ， <code class="literal">winbindd</code>服务<code class="literal">reload-config</code> 。
				</p><h4><a id="prerequisites_19"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">安装了<code class="literal">samba-common-tools</code>包。
						</li></ul></div><h4><a id="procedure_43"></a>程序</h4><pre class="literallayout"># smbcontrol all reload-config</pre><h4><a id="additional_resources_27"></a>其他资源</h4><p>有关更多详细信息和可用命令消息类型的列表，请参见<code class="literal">smbcontrol(1)</code>手册页。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_using-the-smbpasswd-utility_assembly_frequently-used-samba-command-line-utilities"></a>使用smbpasswd实用程序</h2></div></div></div><p><code class="literal">smbpasswd</code>实用程序管理本地Samba数据库中的用户帐户和密码。
				</p><h4><a id="prerequisites_20"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">安装了<code class="literal">samba-common-tools</code>包。
						</li></ul></div><h4><a id="procedure_44"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">如果以用户身份运行该命令，则<code class="literal">smbpasswd</code>更改运行该命令的用户的Samba密码。例如：</p><pre class="literallayout">[user@server ~]$ smbpasswd
New SMB password: <span class="emphasis"><em>password</em></span>
Retype new SMB password: <span class="emphasis"><em>password</em></span></pre></li><li class="listitem"><p class="simpara">如果以<code class="literal">root</code>用户身份运行<code class="literal">smbpasswd</code> ，则可以使用该实用程序，例如：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">创建一个新用户：</p><pre class="literallayout">[root@server ~]# smbpasswd -a <span class="emphasis"><em>user_name</em></span>
New SMB password: <span class="emphasis"><em>password</em></span>
Retype new SMB password: <span class="emphasis"><em>password</em></span>
Added user <span class="emphasis"><em>user_name</em></span>.</pre><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>在将用户添加到Samba数据库之前，必须在本地操作系统中创建该帐户。请参阅“配置和管理系统管理指南”中的“ <a class="link" href="https://doc-stage.usersys.redhat.com/documentation/en-us/red_hat_enterprise_linux/8_test/html/getting_started_with_system_administration/managing-users-groups-permissions/#sec-users-tools-users-add">添加新用户”</a>部分。
									</p></div></li><li class="listitem"><p class="simpara">启用Samba用户：</p><pre class="literallayout">[root@server ~]# smbpasswd -e <span class="emphasis"><em>user_name</em></span>
Enabled user <span class="emphasis"><em>user_name</em></span>.</pre></li><li class="listitem"><p class="simpara">禁用Samba用户：</p><pre class="literallayout">[root@server ~]# smbpasswd -x <span class="emphasis"><em>user_name</em></span>
Disabled user <span class="emphasis"><em>ser_name</em></span></pre></li><li class="listitem"><p class="simpara">删除用户：</p><pre class="literallayout">[root@server ~]# smbpasswd -x <span class="emphasis"><em>user_name</em></span>
Deleted user <span class="emphasis"><em>user_name</em></span>.</pre></li></ul></div></li></ol></div><h4><a id="additional_resources_28"></a>其他资源</h4><p>有关更多详细信息，请参见<code class="literal">smbpasswd(8)</code>手册页。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_using-the-smbstatus-utility_assembly_frequently-used-samba-command-line-utilities"></a>使用smbstatus实用程序</h2></div></div></div><p><code class="literal">smbstatus</code>实用程序报告：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">每个<code class="literal">smbd</code>守护进程的每个PID到Samba服务器的连接。此报告包括用户名，主要组，SMB协议版本，加密和签名信息。
						</li><li class="listitem">每个Samba共享的连接数。此报告包括<code class="literal">smbd</code>守护程序的PID，连接计算机的IP，建立连接时的时间戳，加密和签名信息。
						</li><li class="listitem">锁定文件列表。报告条目包括更多详细信息，例如机会锁定（oplock）类型</li></ul></div><h4><a id="prerequisites_21"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">samba</code>包已安装。
						</li><li class="listitem"><code class="literal">smbd</code>服务正在运行。
						</li></ul></div><h4><a id="procedure_45"></a>程序</h4><pre class="literallayout"># smbstatus

Samba version 4.7.1
PID  Username              Group                Machine                            Protocol Version  Encryption  Signing
-----------------------------------------------------------------------------------------------------------------------------
963  <span class="emphasis"><em>DOMAIN</em></span>\administrator  <span class="emphasis"><em>DOMAIN</em></span>\domain users  client-pc  (ipv4:192.0.2.1:57786)  SMB3_02           -           AES-128-CMAC

Service  pid  Machine    Connected at                  Encryption  Signing:
-------------------------------------------------------------------------------
example  969  192.0.2.1  Thu Nov  1 10:00:00 2018 CEST  -           AES-128-CMAC

Locked files:
Pid  Uid    DenyMode   Access    R/W     Oplock      SharePath           Name      Time
------------------------------------------------------------------------------------------------------------
969  10000  DENY_WRITE 0x120089  RDONLY  LEASE(RWH)  /srv/samba/example  file.txt  Thu Nov  1 10:00:00 2018</pre><h4><a id="additional_resources_29"></a>其他资源</h4><p>有关更多详细信息，请参见<code class="literal">smbstatus(1)</code>手册页。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_using-the-smbtar-utility_assembly_frequently-used-samba-command-line-utilities"></a>使用smbtar实用程序</h2></div></div></div><p><code class="literal">smbtar</code>实用程序备份SMB共享的内容或其子目录，并将内容存储在<code class="literal">tar</code>存档中。或者，您可以将内容写入磁带设备。
				</p><p>本节中的过程介绍如何备份<code class="literal">//server/example/</code> share上的<code class="literal">demo</code>目录的内容，并将内容存储在<code class="literal">/root/example.tar</code>存档中。
				</p><h4><a id="prerequisites_22"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">安装了<code class="literal">samba-client</code>软件包。
						</li></ul></div><h4><a id="procedure_46"></a>程序</h4><pre class="literallayout"># smbtar -s <span class="emphasis"><em>server</em></span> -x <span class="emphasis"><em>example</em></span> -u <span class="emphasis"><em>user_name</em></span> -p <span class="emphasis"><em>password</em></span> -t <span class="emphasis"><em>/root/example.tar</em></span></pre><h4><a id="additional_resources_30"></a>其他资源</h4><p>有关更多详细信息，请参见<code class="literal">smbtar(1)</code>手册页。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_using-the-testparm-utility_assembly_frequently-used-samba-command-line-utilities"></a>使用testparm实用程序</h2></div></div></div><p><code class="literal">testparm</code>实用程序验证<code class="literal">/etc/samba/smb.conf</code>文件中的Samba配置是否正确。该实用程序检测无效的参数和值，但也检测不正确的设置，例如ID映射。如果<code class="literal">testparm</code>报告没有问题，Samba服务将成功加载<code class="literal">/etc/samba/smb.conf</code>文件。请注意， <code class="literal">testparm</code>无法验证配置的服务是否可用或按预期工作。
				</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>Red Hat建议您在每次修改此文件后使用<code class="literal">testparm</code>验证<code class="literal">/etc/samba/smb.conf</code>文件。
					</p></div><h4><a id="procedure_47"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">以<code class="literal">root</code>用户身份运行<code class="literal">testparm</code>实用程序：</p><pre class="literallayout"># testparm
Load smb config files from /etc/samba/smb.conf
rlimit_max: increasing rlimit_max (1024) to minimum Windows limit (16384)
<span class="strong"><strong>Unknown parameter encountered: "log levell"</strong></span>
Processing section "[example_share]"
Loaded services file OK.
<span class="strong"><strong>ERROR: The idmap range for the domain * (tdb) overlaps with the range of DOMAIN (ad)!</strong></span>

Server role: ROLE_DOMAIN_MEMBER

Press enter to see a dump of your service definitions

# Global parameters
[global]
	...

[example_share]
	...</pre><p class="simpara">前面的示例输出报告不存在的参数和不正确的ID映射配置。
						</p></li><li class="listitem">如果<code class="literal">testparm</code>报告配置中的参数，值或其他错误不正确，请修复问题并再次运行该实用程序。
						</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_using-the-wbinfo-utility_assembly_frequently-used-samba-command-line-utilities"></a>使用wbinfo实用程序</h2></div></div></div><p><code class="literal">wbinfo</code>实用程序查询并返回<code class="literal">winbindd</code>服务创建和使用的信息。
				</p><h4><a id="prerequisites_23"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">已安装<code class="literal">samba-winbind-clients</code>软件包。
						</li></ul></div><h4><a id="procedure_48"></a>程序</h4><p>例如，您可以使用<code class="literal">wbinfo</code> ：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">列出域用户：</p><pre class="literallayout"># wbinfo -u
AD\administrator
AD\guest
...</pre></li><li class="listitem"><p class="simpara">列出域组：</p><pre class="literallayout"># wbinfo -g
AD\domain computers
AD\domain admins
AD\domain users
...</pre></li><li class="listitem"><p class="simpara">显示用户的SID：</p><pre class="literallayout"># wbinfo --name-to-sid="AD\administrator"
<span class="emphasis"><em>S-1-5-21-1762709870-351891212-3141221786-500</em></span> SID_USER (1)</pre></li><li class="listitem"><p class="simpara">显示有关域和信任的信息：</p><pre class="literallayout"># wbinfo --trusted-domains --verbose
Domain Name   DNS Domain            Trust Type  Transitive  In   Out
BUILTIN                             None        Yes         Yes  Yes
<span class="emphasis"><em>server</em></span>                              None        Yes         Yes  Yes
<span class="emphasis"><em>DOMAIN1</em></span>       <span class="emphasis"><em>domain1.example.com</em></span>   None        Yes         Yes  Yes
<span class="emphasis"><em>DOMAIN2</em></span>       <span class="emphasis"><em>domain2.example.com</em></span>   External    No          Yes  Yes</pre></li></ul></div><h4><a id="additional_resources_31"></a>其他资源</h4><p>有关更多详细信息，请参见<code class="literal">wbinfo(1)</code>手册页。
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="related-information-assembly_using-samba-as-a-server"></a>相关信息</h1></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">Red Hat Samba软件包包括软件包安装的所有Samba命令和配置文件的手册页。例如，要显示<code class="literal">/etc/samba/smb.conf</code>文件的手册页，该手册解释了您可以在此文件中设置的所有配置参数：</p><pre class="literallayout"># man 5 smb.conf</pre></li><li class="listitem"><code class="literal">/usr/share/docs/samba-version/</code>目录包含Samba项目提供的一般文档，示例脚本和LDAP模式文件。
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_gluster_storage/3.3/html/administration_guide/sect-smb">“红帽群集存储管理指南”</a> ：提供有关设置Samba和群集普通数据库（CDTB）以共享存储在GlusterFS卷上的目录的信息。
					</li><li class="listitem">有关在Red Hat Enterprise Linux上安装SMB共享的详细信息，请参阅“ <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_and_managing_storage_and_filesystems/assembly_mounting-an-smb-share-on-red-hat-enterprise-linux_configuring-and-managing-storage-and-filesystems">配置和管理存储和文件系统”</a>文档中的相应部分。
					</li></ul></div></div></div></body></html>