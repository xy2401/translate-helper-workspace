<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 共享群集资源</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 共享群集资源</h1></div></div></div><p>要指定一个资源的位置取决于另一个资源的位置，请配置一个共置约束。
		</p><p>在两个资源之间创建共置约束会产生重要的副作用：它会影响将资源分配给节点的顺序。这是因为除非您知道资源B在哪里，否则您不能将资源A相对于资源B放置。因此，在创建共置约束时，考虑是否应将资源A与资源B或资源B与资源A共置是很重要的。</p><p>创建共置约束时要记住的另一件事是，假设资源A与资源B共处，群集在决定为资源B选择哪个节点时也会考虑资源A的首选项。</p><p>以下命令创建共置约束。
		</p><pre class="literallayout">pcs constraint colocation add [master|slave] <span class="emphasis"><em>source_resource</em></span> with [master|slave] <span class="emphasis"><em>target_resource</em></span> [<span class="emphasis"><em>score</em></span>] [<span class="emphasis"><em>options</em></span>]</pre><p>
			<a class="xref" href="assembly_colocating-cluster-resources.adoc_configuring-and-managing-high-availability-clusters.html#tb-colocationconstraint-options-HAAR" title="Table 12.1. Properties of a Colocation Constraint">表12.1“共置约束</a>的属性<a class="xref" href="assembly_colocating-cluster-resources.adoc_configuring-and-managing-high-availability-clusters.html#tb-colocationconstraint-options-HAAR" title="Table 12.1. Properties of a Colocation Constraint">”</a>总结了用于配置共<a class="xref" href="assembly_colocating-cluster-resources.adoc_configuring-and-managing-high-availability-clusters.html#tb-colocationconstraint-options-HAAR" title="表12.1。共置约束的属性">置约束</a>的属性和选项。
		</p><div class="table"><a id="tb-colocationconstraint-options-HAAR"></a><p class="title"><strong>表12.1。共置约束的属性</strong></p><div class="table-contents"><table border="1" summary="Properties of a Colocation Constraint"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th valign="top" style="text-align:left">领域</th><th valign="top" style="text-align:left">描述</th></tr></thead><tbody><tr><td valign="top" style="text-align:left"> <p>source_resource</p>
						 </td><td valign="top" style="text-align:left"> <p>托管来源。如果不能满足约束，则集群可能决定不允许资源运行。
						</p>
						 </td></tr><tr><td valign="top" style="text-align:left"> <p>target_resource</p>
						 </td><td valign="top" style="text-align:left"> <p>托管目标。群集将决定将此资源放在何处，然后决定放置源资源的位置。
						</p>
						 </td></tr><tr><td valign="top" style="text-align:left"> <p>得分了</p>
						 </td><td valign="top" style="text-align:left"> <p>正值表示资源应在同一节点上运行。负值表示资源不应在同一节点上运行。值+ <code class="literal">INFINITY</code> （默认值）表示<span class="emphasis"><em>source_resource</em></span>必须与<span class="emphasis"><em>target_resource</em></span>在同一节点上运行。值为<code class="literal">INFINITY</code>表示<span class="emphasis"><em>source_resource</em></span>不能与<span class="emphasis"><em>target_resource</em></span>在同一节点上运行。
						</p>
						 </td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="proc_specifying-mandatory-placement.adoc-colocating-cluster-resources"></a>指定强制放置资源</h1></div></div></div><p>只要约束的分数为<code class="literal">+INFINITY</code>或<code class="literal">-INFINITY</code>就会发生强制放置。在这种情况下，如果无法满足约束，则不允许运行<span class="emphasis"><em>source_resource</em></span> 。对于<code class="literal">score=INFINITY</code> ，这包括<span class="emphasis"><em>target_resource</em></span>未处于活动状态的情况。
			</p><p>如果您需要<code class="literal">myresource1</code>始终与<code class="literal">myresource2</code>在同一台机器上运行，您将添加以下约束：</p><pre class="literallayout"># <code class="literal">pcs constraint colocation add myresource1 with myresource2 score=INFINITY</code></pre><p>由于使用了<code class="literal">INFINITY</code> ，如果<code class="literal">myresource2</code>无法在任何群集节点上运行（无论出于何种原因），则<code class="literal">myresource1</code>运行。
			</p><p>或者，您可能希望配置相反的集群，其中<code class="literal">myresource1</code>无法在与<code class="literal">myresource2</code>相同的计算机上运行。在这种情况下，使用<code class="literal">score=-INFINITY</code>
			</p><pre class="literallayout"># <code class="literal">pcs constraint colocation add myresource1 with myresource2 score=-INFINITY</code></pre><p>同样，通过指定<code class="literal">-INFINITY</code> ，约束是绑定。因此，如果剩下要运行的唯一地方是<code class="literal">myresource2</code>已经存在，那么<code class="literal">myresource1</code>可能无法在任何地方运行。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="proc_specifying-advisory-placement.adoc-colocating-cluster-resources"></a>指定资源的咨询位置</h1></div></div></div><p>如果强制性安置是“必须”和“必须”，那么咨询安置是“我更愿意”的替代方案。对于分数大于<code class="literal">-INFINITY</code>且小于<code class="literal">INFINITY</code>约束，群集将尝试满足您的愿望，但如果替代方法是停止某些群集资源，则可能会忽略它们。咨询托管约束可以与配置的其他元素结合使用，就好像它们是必需的一样。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="proc_colocating-resource-sets.adoc-colocating-cluster-resources"></a>整理资源集</h1></div></div></div><p>如果您的配置要求您创建一组共存并按顺序启动的资源，则可以配置包含这些资源的资源组，如<a class="link" href="assembly_configuring-cluster-resources-configuring-and-managing-high-availability-clusters.html#assembly_resource-groups-configuring-cluster-resources" title="配置资源组">配置资源组中所述</a> 。但是，在某些情况下，配置需要作为资源组进行共处的资源是不合适的：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">您可能需要共置一组资源，但资源不一定需要按顺序启动。
					</li><li class="listitem">您可能拥有必须与资源A或B共存的资源C，但A和B之间没有关系。</li><li class="listitem">您可能拥有必须与资源A和B共存的资源C和D，但A和B之间或C和D之间没有关系。</li></ul></div><p>在这些情况下，您可以使用<code class="literal">pcs constraint colocation set</code>命令在一组或多组资源上创建共置<code class="literal">pcs constraint colocation set</code> 。
			</p><p>您可以使用<code class="literal">pcs constraint colocation set</code>命令为一组资源设置以下选项。
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
						<code class="literal">sequential</code> ，可以设置为<code class="literal">true</code>或<code class="literal">false</code>以指示集合的成员是否必须彼此共处。
					</p><p class="simpara">将<code class="literal">sequential</code>设置为<code class="literal">false</code>允许此set的成员与稍后在约束中列出的另一个set共置，无论此set的哪些成员处于活动状态。因此，只有在约束中的此列之后列出另一个集合时，此选项才有意义;否则，约束无效。
					</p></li><li class="listitem">
						<code class="literal">role</code> ，可以设置为<code class="literal">Stopped</code> ， <code class="literal">Started</code> ， <code class="literal">Master</code>或<code class="literal">Slave</code> 。
					</li></ul></div><p>您可以在<code class="literal">pcs constraint colocation set</code>命令的<code class="literal">setoptions</code>参数之后为一组资源设置以下约束选项。
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<code class="literal">id</code> ，为您定义的约束提供名称。
					</li><li class="listitem">
						<code class="literal">score</code> ，表示该约束的偏好程度。有关此选项的信息，请参阅<a class="link" href="assembly_determining-which-node-a-resource-runs-on-configuring-and-managing-high-availability-clusters.html#tb-locationconstraint-options-HAAR-determining-which-node-a-resource-runs-on" title="表10.1。位置约束选项">位置约束选项</a> 。
					</li></ul></div><p>列出集合的成员时，每个成员都与之前的成员共存。例如，“设置A B”表示“B与A共置”。但是，列出多个集合时，每个集合都与后面的集合相同。例如，“set CD sequential = false set A B”表示“设置CD（其中C和D彼此之间没有关系）与集合AB（其中B与A共处）”。
			</p><p>以下命令在一组或多组资源上创建共置约束。
			</p><pre class="literallayout">pcs constraint colocation set <span class="emphasis"><em>resource1 resource2</em></span> [<span class="emphasis"><em>resourceN</em></span>]... [<span class="emphasis"><em>options</em></span>] [set <span class="emphasis"><em>resourceX</em></span> <span class="emphasis"><em>resourceY</em></span> ... [<span class="emphasis"><em>options</em></span>]] [setoptions [<span class="emphasis"><em>constraint_options</em></span>]]</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="removing_colocation_constraints"></a>删除主机托管约束</h1></div></div></div><p>使用以下命令使用<span class="emphasis"><em>source_resource</em></span>删除共置约束。
			</p><pre class="literallayout">pcs constraint colocation remove <span class="emphasis"><em>source_resource</em></span> <span class="emphasis"><em>target_resource</em></span></pre></div></div></body></html>