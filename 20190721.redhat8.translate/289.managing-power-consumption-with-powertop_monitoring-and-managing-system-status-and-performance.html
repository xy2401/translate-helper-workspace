<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 使用PowerTOP管理功耗</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 使用PowerTOP管理功耗</h1></div></div></div><p>作为系统管理员，您可以使用<span class="strong"><strong><span class="application">PowerTOP</span></strong></span>工具分析和管理功耗。
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="the-purpose-of-powertop_managing-power-consumption-with-powertop"></a> PowerTOP的目的</h1></div></div></div><p>
				<span class="strong"><strong><span class="application">PowerTOP</span></strong></span>是一个诊断与功耗相关的问题的程序，并提供有关如何延长电池寿命的建议。
			</p><p><span class="strong"><strong><span class="application">PowerTOP</span></strong></span>工具可以估算系统的总功耗，以及每个进程，设备，内核工作器，定时器和中断处理程序的单独功耗。该工具还可以识别经常唤醒CPU的内核和用户空间应用程序的特定组件。</p><p>Red Hat Enterprise Linux 8使用<span class="strong"><strong><span class="application">PowerTOP的</span></strong></span> 2.x版。</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="using-powertop_managing-power-consumption-with-powertop"></a>使用PowerTOP</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="prerequisites-using-powertop"></a>先决条件</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">为了能够使用<span class="strong"><strong><span class="application">PowerTOP</span></strong></span> ，请确保已在系统上安装了<code class="literal">powertop</code>软件包：</p><pre class="screen"># yum install powertop</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="starting-powertop_using-powertop"></a>启动PowerTOP</h2></div></div></div><h4><a id="procedure_10"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要运行<span class="strong"><strong><span class="application">PowerTOP</span></strong></span> ，请使用以下命令：</p><pre class="literallayout"># powertop</pre></li></ul></div><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>运行<code class="literal">powertop</code>命令时，笔记本电脑应使用电池供电。
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="calibrating-powertop_using-powertop"></a>校准PowerTOP</h2></div></div></div><h4><a id="procedure_11"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">在笔记本电脑上，您可以通过运行以下命令来校准功耗估算引擎：</p><pre class="literallayout"># powertop --calibrate</pre></li><li class="listitem"><p class="simpara">在此过程中，让校准完成而不与机器相互作用。
						</p><p class="simpara">校准需要时间，因为该过程执行各种测试，循环亮度级别并打开和关闭设备。
						</p></li><li class="listitem"><p class="simpara">校准过程完成后， <span class="strong"><strong><span class="application">PowerTOP</span></strong></span>正常启动。让它运行大约一个小时来收集数据。
						</p><p class="simpara">收集到足够的数据后，功率估算数字将显示在输出表的第一列中。
						</p></li></ol></div><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>请注意， <code class="literal">powertop --calibrate</code>只能用于笔记本电脑。
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="setting-the-measuring-interval_using-powertop"></a>设置测量间隔</h2></div></div></div><p>默认情况下， <span class="strong"><strong><span class="application">PowerTOP</span></strong></span>以20秒的间隔进行测量。
				</p><p>如果要更改此测量频率，请使用以下步骤：</p><h4><a id="procedure_12"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">运行<code class="literal">powertop</code>用命令<code class="literal">--time</code>选项：</p><pre class="literallayout"># powertop --time=<span class="emphasis"><em><span class="replaceable">time in seconds</span></em></span></pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="related-information-using-powertop"></a>相关信息</h2></div></div></div><p>有关如何使用<span class="strong"><strong><span class="application">的PowerTOP</span></strong></span>更多详细信息，请参阅<code class="literal">powertop</code>手册页。
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="powertop-statistics_managing-power-consumption-with-powertop"></a> PowerTOP统计数据</h1></div></div></div><p>在运行时， <span class="strong"><strong><span class="application">PowerTOP</span></strong></span>从系统中收集统计信息。
			</p><p>
				<span class="strong"><strong><span class="application">PowerTOP</span></strong></span>的输出提供了多个选项卡：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<code class="literal">Overview</code>
					</li><li class="listitem">
						<code class="literal">Idle stats</code>
					</li><li class="listitem">
						<code class="literal">Frequency stats</code>
					</li><li class="listitem">
						<code class="literal">Device stats</code>
					</li><li class="listitem">
						<code class="literal">Tunables</code>
					</li></ul></div><p>您可以使用<code class="literal">Tab</code>和<code class="literal">Shift+Tab</code>键循环浏览这些选项卡。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="overview-tab_managing-power-consumption-with-powertop"></a> “概述”选项卡</h2></div></div></div><p>在<code class="literal">Overview</code>选项卡中，您可以查看最常将唤醒发送到CPU或消耗最多功率的组件列表。“ <code class="literal">Overview</code>选项卡中的项目（包括进程，中断，设备和其他资源）将根据其使用情况进行排序。
				</p><p>“ <code class="literal">Overview</code>选项卡中的相邻列提供以下信息：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">用法</span></dt><dd>关于如何使用资源的功率估计。
							</dd><dt><span class="term">事件/秒</span></dt><dd>每秒唤醒。每秒唤醒次数表示服务或内核的设备和驱动程序的执行效率。减少唤醒意味着消耗更少的电力。组件按其优化功耗的进一步排序。
							</dd><dt><span class="term">类别</span></dt><dd>组件的分类;例如进程，设备或计时器。
							</dd><dt><span class="term">描述</span></dt><dd>组件描述。
							</dd></dl></div><p>如果正确校准，则还会显示第一列中每个列出项目的功耗估算值。
				</p><p>除此之外，“ <code class="literal">Overview</code>选项卡还包含带有摘要统计信息的行，例如：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">总功耗</li><li class="listitem">剩余电池寿命（仅在适用的情况下）</li><li class="listitem">每秒总唤醒次数，每秒GPU操作次数和每秒虚拟文件系统操作次数的摘要</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idle-stats-tab_managing-power-consumption-with-powertop"></a>空闲统计选项卡</h2></div></div></div><p><code class="literal">Idle stats</code>选项卡显示所有处理器和内核的C状态使用情况，而<code class="literal">Frequency stats</code>选项卡显示P状态的使用情况，包括适用于所有处理器和内核的Turbo模式（如果适用）。C状态或P状态的持续时间表示CPU使用情况的优化程度。CPU保持在较高的C或P状态的时间越长（例如C4高于C3），CPU使用优化越好。理想情况下，当系统空闲时，驻留在最高C或P状态的90％或更多。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="device-stats-tab_managing-power-consumption-with-powertop"></a> “设备统计信息”选项卡</h2></div></div></div><p>“ <code class="literal">Device stats</code>选项卡提供与“ <code class="literal">Overview</code>选项卡类似但仅适用于设备的信息。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="tunables-tab_managing-power-consumption-with-powertop"></a> “可调参数”选项卡</h2></div></div></div><p>该<code class="literal">Tunables</code>选项卡包含用于优化系统以降低功耗的<span class="strong"><strong><span class="application">的PowerTOP</span></strong></span>建议。
				</p><p>使用<code class="literal">up</code>和<code class="literal">down</code>键移动建议，然后使用<code class="literal">enter</code>键切换建议的开启或关闭。
				</p><div class="figure"><a id="idm140217628546912"></a><p class="title"><strong>图5.1。PowerTOP输出</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/powertop_output_n.png" alt="powertop输出"></div></div></div><h3><a id="additional_resources_12"></a>其他资源</h3><p>有关<span class="strong"><strong><span class="application">的PowerTOP</span></strong></span>更多详细信息，请参阅<a class="link" href="https://01.org/powertop/">的PowerTOP的主页</a> 。
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="generating-an-html-output_managing-power-consumption-with-powertop"></a>生成HTML输出</h1></div></div></div><p>除了终端中<code class="literal">powertop’s</code>输出外，您还可以生成HTML报告。
			</p><h3><a id="procedure_13"></a>程序</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">使用<code class="literal">powertop</code>选项运行<code class="literal">--html</code>命令：</p><pre class="literallayout"># powertop --html=htmlfile.html</pre><p class="simpara">将<code class="literal">htmlfile.html</code>参数替换为输出文件的必需名称。
					</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="optimizing-power-consumption_managing-power-consumption-with-powertop"></a>优化功耗</h1></div></div></div><p>要优化功耗，您可以使用<code class="literal">powertop</code>服务或<code class="literal">powertop2tuned</code>实用程序。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="optimizing-power-consumption-using-the-powertop-service_optimizing-power-consumption"></a>使用powertop服务优化功耗</h2></div></div></div><p>您可以使用<code class="literal">powertop</code>服务自动启用从所有<span class="strong"><strong><span class="application">的PowerTOP</span></strong></span>的建议<code class="literal">Tunables</code>上的引导标签：</p><h4><a id="procedure_14"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">启用<code class="literal">powertop</code>服务：</p><pre class="literallayout"># systemctl enable powertop</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="powertop2tuned-utility_optimizing-power-consumption"></a> powertop2tuned实用程序</h2></div></div></div><p><code class="literal">powertop2tuned</code>实用程序允许您从<span class="strong"><strong><span class="application">PowerTOP</span></strong></span>建议创建自定义<span class="strong"><strong><span class="application">调谐</span></strong></span>配置文件。
				</p><p>默认情况下， <code class="literal">powertop2tuned</code>在<code class="literal">/etc/tuned/</code>目录中创建配置文件，并将自定义配置文件基于当前选定的<span class="strong"><strong><span class="application">Tuned</span></strong></span>配置文件。出于安全原因，最初在新配置文件中禁用所有<span class="strong"><strong><span class="application">PowerTOP</span></strong></span>调整。
				</p><p>要启用调整，您可以：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">在<code class="literal">/etc/tuned/profile_name/tuned.conf file</code>取消注释它们。
						</li><li class="listitem"><p class="simpara">使用<code class="literal">--enable</code>或<code class="literal">-e</code>选项生成一个新的配置文件，该配置文件支持<span class="strong"><strong><span class="application">PowerTOP</span></strong></span>建议的<span class="strong"><strong><span class="application">大多数调整</span></strong></span> 。</p><p class="simpara">某些可能存在问题的调整（例如USB自动挂起）在默认情况下处于禁用状态，需要手动取消注释。
						</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="optimizing-power-consumption-with-powertop2tuned_optimizing-power-consumption"></a>使用powertop2tuned实用程序优化功耗</h2></div></div></div><h4><a id="prerequisites_6"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara"><code class="literal">powertop2tuned</code>实用程序安装在系统上：</p><pre class="literallayout"># yum install tuned-utils</pre></li></ul></div><h4><a id="procedure_15"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">创建自定义配置文件：</p><pre class="literallayout"># powertop2tuned new_profile_name</pre></li><li class="listitem"><p class="simpara">激活新配置文件：</p><pre class="literallayout"># tuned-adm profile new_profile_name</pre></li></ol></div><h4><a id="additional_information"></a>附加信息</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">有关<code class="literal">powertop2tuned</code>支持的选项的完整列表，请使用：</p><pre class="literallayout">$ powertop2tuned --help</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="con_comparison-of-powertop-service-and-powertop2tuned_optimizing-power-consumption"></a> powertop.service和powertop2tuned的比较</h2></div></div></div><p>使用<code class="literal">powertop2tuned</code>优化功耗优于<code class="literal">powertop.service</code> ，原因如下：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">该<code class="literal">powertop2tuned</code>效用代表<span class="strong"><strong><span class="application">的PowerTOP</span></strong></span>的融入<span class="strong"><strong><span class="application">调谐</span></strong></span> ，使受益的两个工具的优势。
						</li><li class="listitem"><code class="literal">powertop2tuned</code>实用程序允许对启用的调整进行细粒度控制。
						</li><li class="listitem">使用<code class="literal">powertop2tuned</code> ，不会自动启用潜在的危险调整。
						</li><li class="listitem">使用<code class="literal">powertop2tuned</code> ，可以在不重启的情况下进行回滚。
						</li></ul></div></div></div></div></body></html>