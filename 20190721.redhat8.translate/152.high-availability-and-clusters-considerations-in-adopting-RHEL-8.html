<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 高可用性和集群</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 高可用性和集群</h1></div></div></div><p>在Red Hat Enterprise Linux 8中， <code class="literal">pcs</code>完全支持Corosync 3集群引擎和用于集群通信的Kronosnet（knet）网络抽象层。在规划从现有RHEL 7群集升级到RHEL 8群集时，必须考虑的一些注意事项如下：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
					<span class="strong"><strong>应用程序版本：</strong></span> RHEL 8集群需要哪个版本的高可用性应用程序？
				</li><li class="listitem">
					<span class="strong"><strong>应用程序流程顺序：应用程序</strong></span>的启动和停止过程中可能需要更改哪些内容？
				</li><li class="listitem">
					<span class="strong"><strong>群集基础架构：</strong></span>由于<code class="literal">pcs</code>支持RHEL 8中的多个网络连接，群集已知的NIC数量是否会发生变化？
				</li><li class="listitem">
					<span class="strong"><strong>需要的软件包：</strong></span>您是否需要在新集群上安装所有相同的软件包？
				</li></ul></div><p>由于在RHEL 8中运行Pacemaker集群的这些和其他注意事项，无法从RHEL 7到RHEL 8集群执行就地升级，您必须在RHEL 8中配置新集群。您无法运行包含同时运行RHEL 7和RHEL 8的节点的群集。
		</p><p>此外，在执行升级之前，您应该计划以下内容：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
					<span class="strong"><strong>最终转换：</strong></span>停止在旧集群上运行应用程序并在新集群上启动它以减少应用程序停机时间的过程是什么？
				</li><li class="listitem">
					<span class="strong"><strong>测试：</strong></span>是否可以在开发/测试环境中提前测试迁移策略？
				</li></ul></div><p>RHEL 7和RHEL 8之间的群集创建和管理的主要差异在以下部分中列出。
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="new_formats_for_literal_pcs_cluster_setup_literal_literal_pcs_cluster_node_add_literal_and_literal_pcs_cluster_node_remove_literal_commands"></a> <code class="literal">pcs cluster setup</code>新格式， <code class="literal">pcs cluster node add</code>和<code class="literal">pcs cluster node remove</code>命令</h1></div></div></div><p>在Red Hat Enterprise Linux 8中， <code class="literal">pcs</code>完全支持使用节点名称，这些节点名称现在是必需的，并且以节点标识符的角色替换节点地址。节点地址现在是可选的。
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">在<code class="literal">pcs host auth</code>命令中，节点地址默认为节点名称。
					</li><li class="listitem">在<code class="literal">pcs cluster setup</code>和<code class="literal">pcs cluster node add</code>命令中，节点地址默认为<code class="literal">pcs host auth</code>命令中指定的节点地址。
					</li></ul></div><p>通过这些更改，用于设置群集，向群集添加节点以及从群集中删除节点的命令格式已更改。有关这些新命令格式的信息，请参阅<code class="literal">pcs cluster setup</code>的帮助显示， <code class="literal">pcs cluster node add</code>和<code class="literal">pcs cluster node remove</code>命令。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="master_resources_renamed_to_promotable_clone_resources"></a>主资源重命名为可升级的克隆资源</h1></div></div></div><p>红帽企业Linux（RHEL）8支持Pacemaker 2.0，其中主/从资源不再是单独的资源类型，而是具有<code class="literal">promotable</code>提升元属性设置为<code class="literal">true</code>的标准克隆资源。为支持此更新，已实施以下更改：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">使用<code class="literal">pcs</code>命令不再可以创建主资源。相反，可以创建<code class="literal">promotable</code>克隆资源。相关的关键字和命令已从<code class="literal">master</code>更改为<code class="literal">promotable</code> 。
					</li><li class="listitem">所有现有主资源都显示为可升级克隆资源。
					</li><li class="listitem">在Web UI中管理RHEL7集群时，主资源仍称为master，因为RHEL7集群不支持可升级克隆。
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="new_commands_for_authenticating_nodes_in_a_cluster"></a>用于验证集群中节点的新命令</h1></div></div></div><p>红帽企业Linux（RHEL）8对用于验证群集中节点的命令进行了以下更改。
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">用于身份验证的新命令是<code class="literal">pcs host auth</code> 。此命令允许用户指定主机名，地址和<code class="literal">pcsd</code>端口。
					</li><li class="listitem"><code class="literal">pcs cluster auth</code>命令仅对本地群集中的节点进行身份验证，并且不接受节点列表</li><li class="listitem">现在可以为每个节点指定一个地址。然后， <code class="literal">pcs</code> / <code class="literal">pcsd</code>将使用指定的地址与每个节点通信。这些地址可能与<code class="literal">corosync</code>内部使用的地址不同。
					</li><li class="listitem"><code class="literal">pcs pcsd clear-auth</code>命令已被<code class="literal">pcs pcsd deauth</code>和<code class="literal">pcs host deauth</code>命令取代。新命令允许用户取消验证单个主机以及所有主机。
					</li><li class="listitem">以前，节点身份验证是双向的，并且运行<code class="literal">pcs cluster auth</code>命令会导致所有指定节点相互进行身份验证。但是， <code class="literal">pcs host auth</code>命令仅导致本地主机针对指定节点进行身份验证。这样可以在运行此命令时更好地控制对其他节点进行身份验证的节点。在群集设置本身以及添加节点时， <code class="literal">pcs</code>自动同步群集上的令牌，因此群集中的所有节点仍然会像以前一样自动进行身份验证，群集节点可以相互通信。
					</li></ul></div><p>请注意，这些更改不向后兼容。在RHEL 7系统上进行身份验证的节点需要再次进行身份验证。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="lvm_volumes_in_a_red_hat_high_availability_active_passive_cluster"></a> Red Hat高可用性主动/被动群集中的LVM卷</h1></div></div></div><p>在RHEL 8中将LVM卷配置为Red Hat HA主动/被动群集中的资源时，可以将卷配置为<code class="literal">LVM-activate</code>资源。在RHEL 7中，您将卷配置为<code class="literal">LVM</code>资源。有关在RHEL 8中将LVM卷配置为主动/被动群集中的资源的群集配置过程的示例，请参阅<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/configuring_and_managing_high_availability_clusters/index#assembly_configuring-active-passive-http-server-in-a-cluster-configuring-and-managing-high-availability-clusters">在Red Hat High Availability群集中配置主动/被动Apache HTTP服务器</a> 。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="shared_lvm_volumes_in_a_red_hat_high_availability_active_active_cluster"></a> Red Hat高可用性主动/主动群集中的共享LVM卷</h1></div></div></div><p>在Red Hat Enterprise Linux 8中，LVM使用LVM锁守护程序<code class="literal">lvmlockd</code>而不是<code class="literal">clvmd</code>来管理主动/主动群集中的共享存储设备。这要求您将装载GFS2文件系统的逻辑卷配置为共享逻辑卷。此外，这要求您使用<code class="literal">LVM-activate</code>资源代理来管理LVM卷，并使用<code class="literal">lvmlockd</code>资源代理来管理<code class="literal">lvmlockd</code>守护程序。有关使用共享逻辑卷<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/configuring_and_managing_high_availability_clusters/index#proc_configuring-gfs2-in-a-cluster.adoc-configuring-gfs2-cluster">配置</a>包含GFS2文件系统的RHEL 8 Pacemaker集群的完整过程，请参阅<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/configuring_and_managing_high_availability_clusters/index#proc_configuring-gfs2-in-a-cluster.adoc-configuring-gfs2-cluster">在集群中配置GFS2文件系统</a> 。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="gfs2_file_systems_in_a_rhel_8_pacemaker_cluster"></a> RHEL 8 Pacemaker集群中的GFS2文件系统</h1></div></div></div><p>在Red Hat Enterprise Linux 8中，LVM使用LVM锁守护程序<code class="literal">lvmlockd</code>而不是<code class="literal">clvmd</code>来管理主动/主动群集中的共享存储设备，如<a class="xref" href="file-systems-and-storage_considerations-in-adopting-RHEL-8.html#removal-of-clvmd-for-managing-shared-storage-devices_file-systems-and-storage" title="Removal of clvmd for managing shared storage devices">“删除用于管理共享存储设备的<code class="literal">clvmd</code> ”一节</a>中<a class="xref" href="file-systems-and-storage_considerations-in-adopting-RHEL-8.html#removal-of-clvmd-for-managing-shared-storage-devices_file-systems-and-storage" title="删除clvmd以管理共享存储设备">所述</a> 。
			</p><p>要使用在RHEL 8群集中的RHEL 7系统上创建的GFS2文件系统，必须在RHEL 8系统中将装入它们的逻辑卷配置为共享逻辑卷，并且必须开始锁定卷组。有关将现有RHEL 7逻辑卷配置为共享逻辑卷以在RHEL 8 Pacemaker集群中使用的过程示例，请参阅<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/configuring_and_managing_high_availability_clusters/index#proc_migrate-gfs2-rhel7-rhel8-configuring-gfs2-cluster">将GFS2文件系统从RHEL7迁移到RHEL8</a> 。
			</p></div></div></body></html>