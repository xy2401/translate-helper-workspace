<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 故障排除</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 故障排除</h1></div></div></div><p>本章列出了故障排除资源和提示。
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="troubleshooting-resources-upgrading-to-rhel-8"></a>资源故障排除</h1></div></div></div><h2><a id="console_output"></a>控制台输出</h2><p>默认情况下， <span class="strong"><strong><span class="application">Leapp</span></strong></span>实用程序仅将错误和关键日志级别消息打印到控制台输出。要更改日志级别，请在<code class="literal">--verbose</code>命令中使用<code class="literal">--debug</code>或<code class="literal">leapp upgrade</code>选项。
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">在<span class="emphasis"><em>详细</em></span>模式下， <span class="strong"><strong><span class="application">Leapp</span></strong></span>打印信息，警告，错误和关键消息。
					</li><li class="listitem">在<span class="emphasis"><em>调试</em></span>模式下， <span class="strong"><strong><span class="application">Leapp</span></strong></span>打印调试，信息，警告，错误和关键消息。
					</li></ul></div><h3><a id="logs"></a>日志</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">/var/log/leapp/dnf-debugdata/</code>目录包含事务调试数据。仅当使用<code class="literal">--debug</code>选项执行<span class="strong"><strong><span class="application">Leapp时</span></strong></span> ，才会显示此目录。
					</li><li class="listitem"><code class="literal">/var/log/leapp/leapp-upgrade.log</code>文件列出了initramfs阶段发现的问题。
					</li><li class="listitem"><span class="strong"><strong><span class="application">journalctl</span></strong></span>实用程序提供完整的日志。
					</li></ul></div><h3><a id="reports"></a>报告</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">/var/log/leapp/leapp-report.txt</code>文件列出了在升级前阶段发现的问题。
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="troubleshooting-tips-upgrading-to-rhel-8"></a>故障排除提示</h1></div></div></div><h3><a id="pre_upgrade_phase"></a>升级前阶段</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">验证您的系统是否满足<a class="xref" href="requirements-and-known-limitationsupgrading-to-rhel-8.html" title="Chapter 9. 要求和已知限制">第1章， <em>要求和已知限制中</em></a>列出的所有条件。例如，使用<code class="literal">df -h</code>命令查看系统是否在<code class="literal">/boot</code>分区中有足够的可用空间。
					</li><li class="listitem">确保已按照<a class="xref" href="preparing-a-rhel-7-system-for-the-upgrade_upgrading-to-rhel-8.html" title="Chapter 2. Preparing a RHEL 7 system for the upgrade">第2章“ <em>准备RHEL 7系统”中所述的</em></a>所有步骤<a class="xref" href="preparing-a-rhel-7-system-for-the-upgrade_upgrading-to-rhel-8.html" title="Chapter 9. 准备RHEL 7系统以进行升级"><em>进行升级</em></a> ，例如，系统不使用多个网络接口卡（NIC），其名称基于内核使用的前缀（ <code class="literal">eth</code> ）。
					</li><li class="listitem">调查<code class="literal">/var/log/leapp/leapp-report.txt</code>文件中的升级前报告以确定问题和建议的解决方案。
					</li><li class="listitem">如果在下载RPM软件包期间出现问题，请检查位于<code class="literal">/var/log/leapp/dnf-debugdata/</code>目录中的事务调试数据。
					</li></ul></div><h3><a id="initramfs_phase"></a> initramfs阶段</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">在此阶段，潜在的故障会将您重定向到dracut shell。查看期刊：</p><pre class="screen"># journalctl</pre><p class="simpara">或者，使用<code class="literal">reboot</code>命令从dracut shell重新启动系统，并检查<code class="literal">/var/log/leapp/leapp-upgrade.log</code>文件。
					</p></li></ul></div><h3><a id="post_upgrade_phase"></a>升级后阶段</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">如果您的系统似乎已成功升级但使用旧的RHEL 7内核启动，请重新启动系统并检查GRUB中默认条目的内核版本。</li><li class="listitem">确保已按照<a class="xref" href="verifying-the-post-upgrade-state-of-the-rhel-8-system_upgrading-to-rhel-8.html" title="Chapter 9. 验证RHEL 8系统的升级后状态">第4章“ <em>验证RHEL 8系统的升级后状态”中的</em></a>建议步骤进行操作。
					</li><li class="listitem"><p class="simpara">如果在将SELinux切换为强制模式后，您的应用程序或服务停止工作或行为不正确，请使用<span class="strong"><strong><span class="application">ausearch</span></strong></span> ， <span class="strong"><strong><span class="application">journalctl</span></strong></span>或<span class="strong"><strong><span class="application">dmesg</span></strong></span>实用程序搜索拒绝：</p><pre class="screen"># ausearch -m AVC,USER_AVC -ts recent
# journalctl -t setroubleshoot
# dmesg | grep -i -e selinux -e type=1400</pre><p class="simpara">最常见的问题是由不正确的标签引起的。有关详细信息，请参阅<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/using_selinux/troubleshooting-problems-related-to-selinux_using-selinux">排除与SELinux相关的问题</a> 。
					</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="known-issues-upgrading-to-rhel-8"></a>已知的问题</h1></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">在某些情况下，可能会发生类似于以下示例的回溯消息：</p><pre class="screen">2019-02-11T08:00:38Z CRITICAL Traceback (most recent call last):
  File "/usr/lib/python2.7/site-packages/dnf/yum/rpmtrans.py", line 272, in callback
  File "/usr/lib/python2.7/site-packages/dnf/yum/rpmtrans.py", line 356, in _uninst_progress
  File "/usr/lib/python2.7/site-packages/dnf/yum/rpmtrans.py", line 244, in _extract_cbkey
RuntimeError: TransactionItem not found for key: lz4</pre><p class="simpara">忽略此类消息是安全的，这些消息既不会中断也不会影响升级过程的结果。
					</p></li><li class="listitem">在禁用或未安装网络管理器时执行就地升级时，网络绑定当前不起作用。（BZ＃ <a class="link" href="https://bugzilla.redhat.com/show_bug.cgi?id=1717330">1717330</a> ）</li><li class="listitem">由于缺少对此通道的映射支持， <span class="strong"><strong><span class="application">Leapp</span></strong></span>实用程序当前无法从Supplementary通道升级软件包，例如<code class="literal">virtio-win</code>软件包。（BZ＃1621775）</li><li class="listitem">使用RPM丰富依赖项的RHEL 8程序包会在升级事务检查期间导致失败。到目前为止，已确定<code class="literal">redhat-rpm-config</code>及其依赖项和<code class="literal">tpm2-abrmd</code>会导致此类问题。<span class="strong"><strong><span class="application">Leapp</span></strong></span>在升级过程中删除了这些软件包。
					</li><li class="listitem">如果使用HTTP代理，则必须将Red Hat Subscription Manager配置为使用此类代理，或者必须使用<code class="literal">subscription-manager</code>选项执行<code class="literal">--proxy &lt;hostname&gt;</code>命令。否则，执行<code class="literal">subscription-manager</code>命令失败。如果使用<code class="literal">--proxy</code>选项而不是配置更改，则升级过程将失败，因为<span class="strong"><strong><span class="application">Leapp</span></strong></span>无法检测代理。要防止出现此问题，请按照<a class="link" href="https://access.redhat.com/solutions/57669">如何为Red Hat订阅管理配置HTTP代理中的说明</a>手动编辑<code class="literal">rhsm.conf</code>文件。（BZ＃ <a class="link" href="https://bugzilla.redhat.com/show_bug.cgi?id=1689294">1689294</a> ）。
					</li><li class="listitem">如果RHEL 7系统安装在FCoE逻辑单元号（LUN）上并连接到使用<code class="literal">bnx2fc</code>驱动程序的网卡，则升级后RHEL 8中不会检测到LUN。因此，升级后的系统无法启动。（BZ＃1718147）</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="obtaining-support-upgrading-to-rhel-8"></a>获得支持</h1></div></div></div><p>要打开支持案例，请选择<span class="emphasis"><em>RHEL 8</em></span>作为产品，并从系统中提供sosreport。要在系统上生成sosreport，请运行：</p><pre class="screen"># sosreport</pre><p>请注意，您可以将案例ID留空。
			</p><p>有关生成sosreport的详细信息，请参阅解决方案<a class="link" href="https://access.redhat.com/solutions/3592">什么是sosreport以及如何在Red Hat Enterprise Linux 4.6及更高版本中创建sosreport？</a> 。
			</p><p>有关在客户门户上打开和管理支持案例的更多信息，请参阅文章<a class="link" href="https://access.redhat.com/articles/38363">如何在客户门户上打开和管理支持案例？</a> 。
			</p></div></div></body></html>