<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 在Web UI中登录到IdM：使用Kerberos票证</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 在Web UI中登录到IdM：使用Kerberos票证</h1></div></div></div><p>以下部分描述了环境的初始配置，以使Kerberos能够登录到IdM Web UI并使用Kerberos身份验证访问IdM。
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="prerequisites-login-web-ui-krb"></a>先决条件</h1></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">在网络环境中安装了IdM服务器</p><p class="simpara">有关详细信息，请参阅<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_identity_management/index">在Red Hat Enterprise Linux 8中安装身份管理</a>
					</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="kerberos-authentication-in-identity-management_login-web-ui-krb"></a>身份管理中的Kerberos身份验证</h1></div></div></div><p>身份管理（IdM）使用Kerberos协议来支持单点登录。单点登录身份验证允许您只提供一次正确的用户名和密码，然后您可以访问身份管理服务，而系统不会再次提示输入凭据。
			</p><p>如果已正确配置DNS和证书设置，IdM服务器会在安装后立即提供Kerberos身份验证。有关详细信息，请参阅<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_identity_management/index">安装Identity Management</a> 。
			</p><p>要在主机上使用Kerberos身份验证，请安装：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">IdM客户端</p><p class="simpara">有关详细信息，请参阅<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_identity_management/index#preparing-the-system-for-ipa-client-installation_installing-identity-management">准备系统以进行Identity Management客户端安装</a> 。
					</p></li><li class="listitem">krb5conf包</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="using-kinit-to-log-in-to-ipa-login-web-ui-krb"></a>使用<span class="strong"><strong>kinit</strong></span>手动登录IdM</h1></div></div></div><p>此过程描述了使用<span class="strong"><strong>kinit</strong></span>实用程序手动向身份管理（IdM）环境进行身份验证。<span class="strong"><strong>kinit</strong></span>实用程序代表IdM用户获取并缓存Kerberos票证授予票证（TGT）。
			</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>如果您已销毁初始Kerberos TGT或已过期，则仅使用此过程。作为IdM用户，当您登录本地计算机时，您也会自动登录到IdM。这意味着登录后，您无需使用<span class="strong"><strong>kinit</strong></span>实用程序来访问IdM资源。
				</p></div><h3><a id="procedure_12"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">登录IdM</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">在当前登录本地系统的用户的用户名下，使用<span class="strong"><strong>kinit</strong></span>而不指定用户名。例如，如果您在本地系统上以<code class="literal">example_user</code>身份登录：</p><pre class="literallayout">[example_user@server ~]$ <span class="strong"><strong>kinit</strong></span>
Password for example_user@EXAMPLE.COM:
[example_user@server ~]$</pre><p class="simpara">如果本地用户的用户名与IdM中的任何用户条目都不匹配，则身份验证尝试将失败：</p><pre class="literallayout">[example_user@server ~]$ <span class="strong"><strong>kinit</strong></span>
kinit: Client 'example_user@EXAMPLE.COM' not found in Kerberos database while getting initial credentials</pre></li><li class="listitem"><p class="simpara">使用与本地用户名不对应的Kerberos主体，将所需的用户名传递给<code class="literal">kinit</code>实用程序。例如，以<code class="literal">admin</code>用户身份登录：</p><pre class="literallayout">[example_user@server ~]$ <span class="strong"><strong>kinit admin</strong></span>
Password for admin@EXAMPLE.COM:
[example_user@server ~]$</pre></li></ul></div></li><li class="listitem"><p class="simpara">（可选）要验证登录是否成功，请使用<span class="strong"><strong>klist</strong></span>实用程序显示缓存的TGT。在以下示例中，缓存包含<code class="literal">example_user</code>主体的票证，这意味着在此特定主机上，当前只允许<code class="literal">example_user</code>访问IdM服务：</p><pre class="literallayout">$ <span class="strong"><strong>klist</strong></span>
Ticket cache: KEYRING:persistent:0:0
Default principal: <span class="strong"><strong>example_user@EXAMPLE.COM</strong></span>

Valid starting     	Expires            	Service principal
11/10/2019 08:35:45  	11/10/2019 18:35:45  	krbtgt/EXAMPLE.COM@EXAMPLE.COM</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring-the-browser-for-kerberos-authentication-login-web-ui-krb"></a>配置浏览器以进行Kerberos身份验证</h1></div></div></div><p>要使用Kerberos票证启用身份验证，您可能需要浏览器配置。
			</p><p>以下步骤可帮助您支持Kerberos协商以访问IdM域。
			</p><p>每个浏览器都以不同的方式支持Kerberos，需要不同的设置。IdM Web UI包含以下浏览器的指南：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">火狐</li><li class="listitem">铬</li></ul></div><h3><a id="procedure_13"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem">在Web浏览器中打开IdM Web UI登录对话框。
					</li><li class="listitem"><p class="simpara">在Web UI登录屏幕上单击浏览器配置链接。
					</p><p class="simpara">
						<span class="inlinemediaobject"><img src="images/ipa_browser_config_link.png" alt="ipa浏览器配置链接"></span>

					</p></li><li class="listitem"><p class="simpara">按照配置页面上的步骤操作。
					</p><p class="simpara">
						<span class="inlinemediaobject"><img src="images/ipa_browser_config_page.png" alt="ipa浏览器配置页面"></span>

					</p></li></ol></div><p>完成设置后，返回IdM Web UI并单击“ <span class="strong"><strong>登录”</strong></span> 。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="logging-in-to-the-web-ui-with-a-kerberos-ticket-login-web-ui-krb"></a>使用Kerberos票证登录Web UI</h1></div></div></div><p>此过程描述使用Kerberos票证授予票证（TGT）登录IdM Web UI。
			</p><p>TGT在预定义的时间到期。默认时间间隔为24小时，您可以在IdM Web UI中更改它。</p><p>时间间隔到期后，您需要续订票证：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">使用kinit命令。
					</li><li class="listitem">在Web UI登录对话框中使用IdM登录凭据。
					</li></ul></div><h3><a id="procedure_14"></a>程序</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">打开IdM Web UI。</p><p class="simpara">如果Kerberos身份验证正常工作且您拥有有效故障单，则将自动进行身份验证并打开Web UI。
					</p><p class="simpara">如果故障单已过期，则必须先使用凭据对自己进行身份验证。但是，下次IdM Web UI将自动打开而不打开登录对话框。
					</p><p class="simpara">如果您看到“ <code class="literal">Authentication with Kerberos failed</code>的错误消息，请验证您的浏览器是否已配置为进行Kerberos身份验证。请参阅<a class="xref" href="logging-in-to-ipa-in-the-web-ui-using-a-kerberos-ticket.html#configuring-the-browser-for-kerberos-authentication-login-web-ui-krb" title="配置浏览器以进行Kerberos身份验证">“为浏览器配置Kerberos身份验证”一节</a> 。
					</p><div class="informalfigure"><div class="mediaobject"><img src="images/firefox_kerb_auth_failed.png" alt="firefox curb auth失败了"></div></div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring-an-external-system-for-kerberos-authentication-login-web-ui-krb"></a>配置外部系统以进行Kerberos身份验证</h1></div></div></div><p>本节介绍如何配置外部系统，以便Identity Management（IdM）用户可以使用其Kerberos凭据从外部系统登录到IdM。
			</p><p>当您的基础架构包含多个域或重叠域时，在外部系统上启用Kerberos身份验证尤其有用。如果系统尚未通过<code class="literal">ipa-client-install</code>注册到任何IdM域，这也很有用。
			</p><p>要从不是IdM域成员的系统启用对IdM的Kerberos身份验证，请在外部系统上定义特定于IdM的Kerberos配置文件。
			</p><h3><a id="prerequisites_5"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara"><code class="literal">krb5-workstation</code>软件包安装在外部系统上。
					</p><p class="simpara">要确定是否已安装软件包，请使用以下CLI命令：</p><pre class="literallayout"># <span class="strong"><strong>yum list installed krb5-workstation</strong></span>
Installed Packages
krb5-workstation.x86_64    1.16.1-19.el8     @BaseOS</pre></li></ul></div><h3><a id="procedure_15"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">将<code class="literal">/etc/krb5.conf</code>文件从IdM服务器复制到外部系统。例如：</p><pre class="literallayout"># <span class="strong"><strong>scp /etc/krb5.conf root@<span class="emphasis"><em>externalsystem.example.com</em></span>:/etc/krb5_ipa.conf</strong></span></pre><div class="warning" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">警告</h3><p>不要覆盖外部系统上现有的<code class="literal">krb5.conf</code>文件。
						</p></div></li><li class="listitem"><p class="simpara">在外部系统上，将终端会话设置为使用复制的IdM Kerberos配置文件：</p><pre class="literallayout">$ <span class="strong"><strong>export KRB5_CONFIG=/etc/krb5_ipa.conf</strong></span></pre><p class="simpara"><code class="literal">KRB5_CONFIG</code>变量仅在您注销之前暂时存在。要防止此丢失，请使用其他文件名导出变量。
					</p></li><li class="listitem">将Kerberos配置片段从<code class="literal">/etc/krb5.conf.d/</code>目录复制到外部系统。
					</li><li class="listitem">在外部系统上配置浏览器，如<a class="xref" href="logging-in-to-ipa-in-the-web-ui-using-a-kerberos-ticket.html#configuring-the-browser-for-kerberos-authentication-login-web-ui-krb" title="Configuring the browser for Kerberos authentication">“为Kerberos身份验证配置浏览器”一节</a>中<a class="xref" href="logging-in-to-ipa-in-the-web-ui-using-a-kerberos-ticket.html#configuring-the-browser-for-kerberos-authentication-login-web-ui-krb" title="配置浏览器以进行Kerberos身份验证">所述</a> 。
					</li></ol></div><p>外部系统上的用户现在可以使用<code class="literal">kinit</code>实用程序对IdM服务器进行身份验证。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="web-ui-login-for-ad-users-login-web-ui-krb"></a> Active Directory用户的Web UI登录</h1></div></div></div><p>要为Active Directory用户启用Web UI登录，请在默认信任视图中为每个Active Directory用户定义ID覆盖。例如：</p><pre class="literallayout">[admin@server ~]$ <span class="strong"><strong>ipa idoverrideuser-add 'Default Trust View' <span class="emphasis"><em>ad_user</em></span>@<span class="emphasis"><em>ad.example.com</em></span></strong></span></pre></div></div></body></html>