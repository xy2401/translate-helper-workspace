<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. Networking</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="networking_considerations-in-adopting-RHEL-8"/>Chapter 9. Networking</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="networkmanager_networking"/>NetworkManager</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="network_scripts_networking"/>Legacy network scripts support</h2></div></div></div><p>
					Network scripts are deprecated in Red Hat Enterprise Linux 8 and are no longer provided by default. The basic installation provides a new version of the <code class="literal">ifup</code> and <code class="literal">ifdown</code> scripts which call <span class="strong"><strong><span class="application">NetworkManager</span></strong></span> through the <span class="strong"><strong><span class="application">nmcli</span></strong></span> tool. In Red Hat Enterprise Linux 8, to run the <code class="literal">ifup</code> and the <code class="literal">ifdown</code> scripts, <span class="strong"><strong><span class="application">NetworkManager</span></strong></span> must be running.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						Custom commands in <code class="literal">/sbin/ifup-local</code>, <code class="literal">ifdown-pre-local</code> and <code class="literal">ifdown-local</code> scripts are not executed.
					</p><p>
						If any of these scripts are required, the installation of the deprecated network scripts in the system is still possible with the following command:
					</p><pre class="literallayout">~]# yum install network-scripts</pre><p>
						The <code class="literal">ifup</code> and the <code class="literal">ifdown</code> scripts link to the installed legacy network scripts.
					</p><p>
						Calling the legacy network scripts shows a warning about their deprecation.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="SR-IOV_functions_networking"/>NetworkManager supports SR-IOV virtual functions</h2></div></div></div><p>
					In Red Hat Enterprise Linux 8, <span class="strong"><strong>NetworkManager</strong></span> allows configuring the number of virtual functions (VF) for interfaces that support single-root I/O virtualization (SR-IOV). Additionally, <span class="strong"><strong>NetworkManager</strong></span> allows configuring some attributes of the VFs, such as the MAC address, VLAN, the <code class="literal">spoof checking</code> setting and allowed bitrates. Note that all properties related to SR-IOV are available in the <code class="literal">sriov</code> connection setting. For more details, see the <code class="literal">nm-settings(5)</code> man page.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="wildcard_interface_networking"/>NetworkManager supports a wildcard interface name match for connections</h2></div></div></div><p>
					Previously, it was possible to restrict a connection to a given interface using only an exact match on the interface name. With this update, connections have a new match.interface-name property which supports wildcards. This update enables users to choose the interface for a connection in a more flexible way using a wildcard pattern.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ethtool_offload_features_networking"/>NetworkManager supports configuring ethtool offload features</h2></div></div></div><p>
					With this enhancement, <code class="literal">NetworkManager</code> supports configuring <code class="literal">ethtool</code> offload features, and users no longer need to use init scripts or a <code class="literal">NetworkManager</code> dispatcher script. As a result, users can now configure the offload feature as a part of the connection profile using one of the following methods:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							By using the <code class="literal">nmcli</code> utility
						</li><li class="listitem">
							By editing key files in the <code class="literal">/etc/NetworkManager/system-connections/</code> directory
						</li><li class="listitem">
							By editing the <code class="literal">/etc/sysconfig/network-scripts/ifcfg-*</code> files
						</li></ul></div><p>
					Note that this feature is currently not supported in graphical interfaces and in the <code class="literal">nmtui</code> utility.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="dhcp_plugin_networking"/>NetworkManager now uses the internal DHCP plug-in by default</h2></div></div></div><p>
					<span class="strong"><strong>NetworkManager</strong></span> supports the <code class="literal">internal</code> and <code class="literal">dhclient</code> DHCP plug-ins. By default, <span class="strong"><strong>NetworkManager</strong></span> in Red Hat Enterprise Linux (RHEL) 7 uses the <code class="literal">dhclient</code> and RHEL 8 the <code class="literal">internal</code> plug-in. In certain situations, the plug-ins behave differently. For example, <code class="literal">dhclient</code> can use additional settings specified in the <code class="literal">/etc/dhcp/</code> directory.
				</p><p>
					If you upgrade from RHEL 7 to RHEL 8 and <span class="strong"><strong>NetworkManager</strong></span> behaves different, add the following setting to the <code class="literal">[main]</code> section in the <code class="literal">/etc/NetworkManager/NetworkManager.conf</code> file to use the <code class="literal">dhclient</code> plug-in:
				</p><pre class="screen">[main]
dhcp=dhclient</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="nm-config-server_networking"/>The NetworkManager-config-server package is not installed by default in RHEL 8</h2></div></div></div><p>
					The <code class="literal">NetworkManager-config-server</code> package is only installed by default if you select either the <code class="literal">Server</code> or <code class="literal">Server with GUI</code> base environment during the setup. If you selected a different environment, use the <code class="literal">yum install NetworkManager-config-server</code> command to install the package.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="packet-filtering_networking"/>Packet filtering</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="literal_nftables_literal_replaces_literal_iptables_literal_as_the_default_network_packet_filtering_framework"/><code class="literal">nftables</code> replaces <code class="literal">iptables</code> as the default network packet filtering framework</h2></div></div></div><p>
					The <code class="literal">nftables</code> framework provides packet classification facilities and it is the designated successor to the <code class="literal">iptables</code>, <code class="literal">ip6tables</code>, <code class="literal">arptables</code>, and <code class="literal">ebtables</code> tools. It offers numerous improvements in convenience, features, and performance over previous packet-filtering tools, most notably:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							lookup tables instead of linear processing
						</li><li class="listitem">
							a single framework for both the <code class="literal">IPv4</code> and <code class="literal">IPv6</code> protocols
						</li><li class="listitem">
							rules all applied atomically instead of fetching, updating, and storing a complete ruleset
						</li><li class="listitem">
							support for debugging and tracing in the ruleset (<code class="literal">nftrace</code>) and monitoring trace events (in the <code class="literal">nft</code> tool)
						</li><li class="listitem">
							more consistent and compact syntax, no protocol-specific extensions
						</li><li class="listitem">
							a Netlink API for third-party applications
						</li></ul></div><p>
					Similarly to <code class="literal">iptables</code>, <code class="literal">nftables</code> use tables for storing chains. The chains contain individual rules for performing actions. The <code class="literal">nft</code> tool replaces all tools from the previous packet-filtering frameworks. The <code class="literal">libnftables</code> library can be used for low-level interaction with <code class="literal">nftables</code> Netlink API over the <code class="literal">libmnl</code> library.
				</p><p>
					The <code class="literal">iptables</code>, <code class="literal">ip6tables</code>, <code class="literal">ebtables</code> and <code class="literal">arptables</code> tools are replaced by nftables-based drop-in replacements with the same name. While external behavior is identical to their legacy counterparts, internally they use <code class="literal">nftables</code> with legacy <code class="literal">netfilter</code> kernel modules through a compatibility interface where required.
				</p><p>
					Effect of the modules on the <code class="literal">nftables</code> ruleset can be observed using the <code class="literal">nft list ruleset</code> command. Since these tools add tables, chains, and rules to the <code class="literal">nftables</code> ruleset, be aware that <code class="literal">nftables</code> rule-set operations, such as the <code class="literal">nft flush ruleset</code> command, might affect rule sets installed using the formerly separate legacy commands.
				</p><p>
					To quickly identify which variant of the tool is present, version information has been updated to include the back-end name. In RHEL 8, the nftables-based <code class="literal">iptables</code> tool prints the following version string:
				</p><pre class="screen">$ iptables --version
iptables v1.8.0 (nf_tables)</pre><p>
					For comparison, the following version information is printed if legacy <code class="literal">iptables</code> tool is present:
				</p><pre class="screen">$ iptables --version
iptables v1.8.0 (legacy)</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="arptables-forward_networking"/><code class="literal">Arptables</code> FORWARD is removed from filter tables in RHEL 8</h2></div></div></div><p>
					The <code class="literal">arptables</code> FORWARD chain functionality has been removed in Red Hat Enterprise Linux (RHEL) 8. You can now use the FORWARD chain of the <code class="literal">ebtables</code> tool adding the rules into it.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ebtables-legacy_networking"/>Output of <code class="literal">iptables-ebtables</code> is not 100% compatible with <code class="literal">ebtables</code></h2></div></div></div><p>
					In RHEL 8, the <code class="literal">ebtables</code> command is provided by the <code class="literal">iptables-ebtables</code> package, which contains an <code class="literal">nftables</code>-based reimplementation of the tool. This tool has a different code base, and its output deviates in aspects, which are either negligible or deliberate design choices.
				</p><p>
					Consequently, when migrating your scripts parsing some <code class="literal">ebtables</code> output, adjust the scripts to reflect the following:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							MAC address formatting has been changed to be fixed in length. Where necessary, individual byte values contain a leading zero to maintain the format of two characters per octet.
						</li><li class="listitem">
							Formatting of IPv6 prefixes has been changed to conform with RFC 4291. The trailing part after the slash character no longer contains a netmask in the IPv6 address format but a prefix length. This change applies to valid (left-contiguous) masks only, while others are still printed in the old formatting.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="new_tools_iptables_nftables_networking"/>New tools to convert <code class="literal">iptables</code> to <code class="literal">nftables</code></h2></div></div></div><p>
					This update adds the <code class="literal">iptables-translate</code> and <code class="literal">ip6tables-translate</code> tools to convert the existing <code class="literal">iptables</code> or <code class="literal">ip6tables</code> rules into the equivalent ones for <code class="literal">nftables</code>. Note that some extensions lack translation support. If such an extension exists, the tool prints the untranslated rule prefixed with the <code class="literal">#</code> sign. For example:
				</p><pre class="screen">| % iptables-translate -A INPUT -j CHECKSUM --checksum-fill
| nft # -A INPUT -j CHECKSUM --checksum-fill</pre><p>
					Additionally, users can use the <code class="literal">iptables-restore-translate</code> and <code class="literal">ip6tables-restore-translate</code> tools to translate a dump of rules. Note that before that, users can use the <code class="literal">iptables-save</code> or <code class="literal">ip6tables-save</code> commands to print a dump of current rules. For example:
				</p><pre class="screen">| % sudo iptables-save &gt;/tmp/iptables.dump
| % iptables-restore-translate -f /tmp/iptables.dump
| # Translated by iptables-restore-translate v1.8.0 on Wed Oct 17 17:00:13 2018
| add table ip nat
| ...</pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="change_in_wpa_supplicant_networking"/>Changes in <code class="literal">wpa_supplicant</code></h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="wpa-supplicant-journalctl_networking"/><code class="literal">journalctl</code> can now read the <code class="literal">wpa_supplicant</code> log</h2></div></div></div><p>
					In Red Hat Enterprise Linux (RHEL) 8, the <code class="literal">wpa_supplicant</code> package is built with <code class="literal">CONFIG_DEBUG_SYSLOG</code> enabled. This allows reading the <code class="literal">wpa_supplicant</code> log using the <code class="literal">journalctl</code> utility instead of checking the contents of the <code class="literal">/var/log/wpa_supplicant.log</code> file.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="wpa-supplicant-wireless_networking"/>The compile-time support for wireless extensions in <code class="literal">wpa_supplicant</code> is disabled</h2></div></div></div><p>
					The <code class="literal">wpa_supplicant</code> package does not support wireless extensions. When a user is trying to use <code class="literal">wext</code> as a command-line argument, or trying to use it on old adapters which only support wireless extensions, will not be able to run the <code class="literal">wpa_supplicant</code> daemon.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sctp_networking"/>A new data chunk type, <code class="literal">I-DATA</code>, added to SCTP</h1></div></div></div><p>
				This update adds a new data chunk type, <code class="literal">I-DATA</code>, and stream schedulers to the Stream Control Transmission Protocol (SCTP). Previously, SCTP sent user messages in the same order as they were sent by a user. Consequently, a large SCTP user message blocked all other messages in any stream until completely sent. When using <code class="literal">I-DATA</code> chunks, the Transmission Sequence Number (TSN) field is not overloaded. As a result, SCTP now can schedule the streams in different ways, and <code class="literal">I-DATA</code> allows user messages interleaving (RFC 8260). Note that both peers must support the <code class="literal">I-DATA</code> chunk type.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="tcp_networking"/>Notable TCP features in RHEL 8</h1></div></div></div><p>
				Red Hat Enterprise Linux 8 is distributed with TCP networking stack version 4.18, which provides higher performances, better scalability, and more stability. Performances are boosted especially for busy TCP server with a high ingress connection rate.
			</p><p>
				Additionally, two new TCP congestion algorithms, <code class="literal">BBR</code> and <code class="literal">NV</code>, are available, offering lower latency, and better throughput than cubic in most scenarios.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="tcp_bbr_networking"/>TCP BBR support in RHEL 8</h2></div></div></div><p>
					A new TCP congestion control algorithm, Bottleneck Bandwidth and Round-trip time (BBR) is now supported in Red Hat Enterprise Linux (RHEL) 8. BBR attempts to determine the bandwidth of the bottleneck link and the Round-trip time (RTT). Most congestion algorithms are based on packet loss (including CUBIC, the default Linux TCP congestion control algorithm), which have problems on high-throughput links. BBR does not react to loss events directly, it adjusts the TCP pacing rate to match it with the available bandwidth. Users of TCP BBR should switch to the <code class="literal">fq</code> queueing setting on all the involved interfaces.
				</p><p>
					Note that users should explicitly use <code class="literal">fq</code> and not <code class="literal">fq_codel</code>.
				</p><p>
					For more details, see the <code class="literal">tc-fq</code> man page.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="vlan-related-changes_networking"/>VLAN-related changes</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ipvlan_network_drivers_networking"/>IPVLAN virtual network drivers are now supported</h2></div></div></div><p>
					In Red Hat Enterprise Linux 8.0, the kernel includes support for IPVLAN virtual network drivers. With this update, IPVLAN virtual Network Interface Cards (NICs) enable the network connectivity for multiple containers exposing a single MAC address to the local network. This allows a single host to have a lot of containers overcoming the possible limitation on the number of MAC addresses supported by the peer networking equipment.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="certain-network-adapters-require-a-firmware-update-to-fully-support-802.1ad-networking"/>Certain network adapters require a firmware update to fully support 802.1ad</h2></div></div></div><p>
					The firmware of certain network adapters does not fully support the 802.1ad standard, which is also called Q-in-Q or stacked virtual local area networks (VLANs). Contact your hardware vendor on details how to verify that your network adapter uses a firmware that supports the 802.1ad standard and how to update the firmware. As a result, with the correct firmware, configuring stacked VLANs on RHEL 8.0 work as expected.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="network-interface-names_networking"/>Network interface name changes</h1></div></div></div><p>
				In Red Hat Enterprise Linux 8, the same consistent network device naming scheme is used by default as in RHEL 7. However, certain kernel drivers, such as <code class="literal">e1000e</code>, <code class="literal">nfp</code>, <code class="literal">qede</code>, <code class="literal">sfc</code>, <code class="literal">tg3</code> and <code class="literal">bnxt_en</code> changed their consistent name on a fresh installation of RHEL 8. However, the names are preserved on upgrade from RHEL 7.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="tc-ok_networking"/>The <code class="literal">-ok</code> option of the <code class="literal">tc</code> command removed</h1></div></div></div><p>
				The <code class="literal">-ok</code> option of the <code class="literal">tc</code> command has been removed in Red Hat Enterprise Linux 8. As a workaround, users can implement code to communicate directly via netlink with the kernel. Response messages received, indicate completion and status of sent requests. An alternative way for less time-critical applications is to call <code class="literal">tc</code> for each command separately. This may happen with a custom script which simulates the <code class="literal">tc -batch</code> behavior by printing <code class="literal">OK</code> for each successful <code class="literal">tc</code> invocation.
			</p></div></div></body></html>