<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 联网</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 联网</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="networkmanager_networking"></a>网络管理器</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="network_scripts_networking"></a>传统网络脚本支持</h2></div></div></div><p>网络脚本在Red Hat Enterprise Linux 8中已弃用，默认情况下不再提供。基本安装提供了<code class="literal">ifup</code>和<code class="literal">ifdown</code>脚本的新版本，它通过<span class="strong"><strong><span class="application">nmcli</span></strong></span>工具调用<span class="strong"><strong><span class="application">NetworkManager</span></strong></span> 。在Red Hat Enterprise Linux 8中，要运行<code class="literal">ifup</code>和<code class="literal">ifdown</code>脚本，必须运行<span class="strong"><strong><span class="application">NetworkManager</span></strong></span> 。
				</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>不执行<code class="literal">/sbin/ifup-local</code> ， <code class="literal">ifdown-pre-local</code>和<code class="literal">ifdown-local</code>脚本中的自定义命令。
					</p><p>如果需要这些脚本中的任何一个，则仍可以使用以下命令在系统中安装已弃用的网络脚本：</p><pre class="literallayout">~]# yum install network-scripts</pre><p><code class="literal">ifup</code>和<code class="literal">ifdown</code>脚本链接到已安装的旧网络脚本。
					</p><p>调用旧网络脚本会显示有关其弃用的警告。
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="SR-IOV_functions_networking"></a> NetworkManager支持SR-IOV虚拟功能</h2></div></div></div><p>在Red Hat Enterprise Linux 8中， <span class="strong"><strong>NetworkManager</strong></span>允许为支持单根I / O虚拟化（SR-IOV）的接口配置虚拟功能（VF）的数量。此外， <span class="strong"><strong>NetworkManager</strong></span>允许配置<span class="strong"><strong>VF的</strong></span>某些属性，例如MAC地址，VLAN， <code class="literal">spoof checking</code>设置和允许的比特率。请注意， <code class="literal">sriov</code>连接设置中提供了与SR-IOV相关的所有属性。有关更多详细信息，请参见<code class="literal">nm-settings(5)</code>手册页。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="wildcard_interface_networking"></a> NetworkManager支持连接的通配符接口名称匹配</h2></div></div></div><p>以前，可以仅使用接口名称上的完全匹配来限制与给定接口的连接。通过此更新，连接具有一个新的match.interface-name属性，该属性支持通配符。此更新使用户能够使用通配符模式以更灵活的方式为连接选择接口。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ethtool_offload_features_networking"></a> NetworkManager支持配置ethtool卸载功能</h2></div></div></div><p>通过此增强功能， <code class="literal">NetworkManager</code>支持配置<code class="literal">ethtool</code>卸载功能，用户不再需要使用init脚本或<code class="literal">NetworkManager</code>调度程序脚本。因此，用户现在可以使用以下方法之一将卸载功能配置为连接配置文件的一部分：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">通过使用<code class="literal">nmcli</code>实用程序</li><li class="listitem">通过编辑<code class="literal">/etc/NetworkManager/system-connections/</code>目录中的密钥文件</li><li class="listitem">通过编辑<code class="literal">/etc/sysconfig/network-scripts/ifcfg-*</code>文件</li></ul></div><p>请注意，图形界面和<code class="literal">nmtui</code>实用程序当前不支持此功能。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="dhcp_plugin_networking"></a> NetworkManager现在默认使用内部DHCP插件</h2></div></div></div><p>
					<span class="strong"><strong>NetworkManager</strong></span>支持<code class="literal">internal</code>和<code class="literal">dhclient</code> DHCP插件。默认情况下，Red Hat Enterprise Linux（RHEL）7中的<span class="strong"><strong>NetworkManager</strong></span>使用<code class="literal">dhclient</code>和RHEL 8作为<code class="literal">internal</code>插件。在某些情况下，插件的行为会有所不同。例如， <code class="literal">dhclient</code>可以使用<code class="literal">/etc/dhcp/</code>目录中指定的其他设置。
				</p><p>如果从RHEL 7升级到RHEL 8并且<span class="strong"><strong>NetworkManager的</strong></span>行为不同，请将以下设置添加到<code class="literal">/etc/NetworkManager/NetworkManager.conf</code>文件的<code class="literal">[main]</code>部分以使用<code class="literal">dhclient</code>插件：</p><pre class="screen">[main]
dhcp=dhclient</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="nm-config-server_networking"></a>默认情况下，RHEL 8中未安装NetworkManager-config-server软件包</h2></div></div></div><p>如果在安装过程中选择<code class="literal">Server with GUI</code>基本环境的<code class="literal">Server</code>或<code class="literal">Server with GUI</code>则默认情况下仅安装<code class="literal">NetworkManager-config-server</code>软件包。如果选择了其他环境，请使用<code class="literal">yum install NetworkManager-config-server</code>命令安装该软件包。
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="packet-filtering_networking"></a>包过滤</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="literal_nftables_literal_replaces_literal_iptables_literal_as_the_default_network_packet_filtering_framework"></a> <code class="literal">nftables</code>将<code class="literal">iptables</code>替换为默认的网络包过滤框架</h2></div></div></div><p><code class="literal">nftables</code>框架提供了数据包分类工具，它是<code class="literal">iptables</code> ， <code class="literal">ip6tables</code> ， <code class="literal">arptables</code>和<code class="literal">ebtables</code>工具的指定后继者。与以前的数据包过滤工具相比，它在方便性，功能和性能方面提供了许多改进，最值得注意的是：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">查找表而不是线性处理</li><li class="listitem"><code class="literal">IPv4</code>和<code class="literal">IPv6</code>协议的单一框架</li><li class="listitem">所有规则都以原子方式应用，而不是获取，更新和存储完整的规则集</li><li class="listitem">支持在规则集（ <code class="literal">nftrace</code> ）中调试和跟踪以及监视跟踪事件（在<code class="literal">nft</code>工具中）</li><li class="listitem">更一致和紧凑的语法，没有特定于协议的扩展</li><li class="listitem">适用于第三方应用程序的Netlink API</li></ul></div><p>与<code class="literal">iptables</code>类似， <code class="literal">nftables</code>使用表来存储链。链包含执行操作的单独规则。<code class="literal">nft</code>工具取代了之前的数据包过滤框架中的所有工具。所述<code class="literal">libnftables</code>库可以被用于具有低级别的相互作用<code class="literal">nftables</code>网络链路API在<code class="literal">libmnl</code>库。
				</p><p><code class="literal">iptables</code> ， <code class="literal">ip6tables</code> ， <code class="literal">ebtables</code>和<code class="literal">arptables</code>工具被基于nftables的直接替换替换为同名。虽然外部行为与传统行为相同，但在内部，他们通过兼容性接口在需要时使用<code class="literal">nftables</code>和传统的<code class="literal">netfilter</code>内核模块。
				</p><p>可以使用<code class="literal">nftables</code> <code class="literal">nft list ruleset</code>命令观察模块对<code class="literal">nftables</code>规则<code class="literal">nft list ruleset</code> 。由于这些工具将表，链和规则添加到<code class="literal">nftables</code>规则集，请注意<code class="literal">nftables</code>规则集操作（例如<code class="literal">nftables</code> <code class="literal">nft flush ruleset</code>命令）可能会影响使用以前单独的旧命令安装的规则集。
				</p><p>要快速识别工具的哪个变体，版本信息已更新为包含后端名称。在RHEL 8中，基于nftables的<code class="literal">iptables</code>工具打印以下版本字符串：</p><pre class="screen">$ iptables --version
iptables v1.8.0 (nf_tables)</pre><p>为了进行比较，如果存在legacy <code class="literal">iptables</code>工具，则会打印以下版本信息：</p><pre class="screen">$ iptables --version
iptables v1.8.0 (legacy)</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="arptables-forward_networking"></a>从RHEL 8中的过滤表中删除了<code class="literal">Arptables</code> FORWARD</h2></div></div></div><p>红帽企业Linux（RHEL）8中已删除了<code class="literal">arptables</code> FORWARD链功能。您现在可以使用<code class="literal">ebtables</code>工具的FORWARD链将规则添加到其中。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ebtables-legacy_networking"></a>的输出<code class="literal">iptables-ebtables</code>是不是100％兼容<code class="literal">ebtables</code></h2></div></div></div><p>在RHEL 8中， <code class="literal">ebtables</code>命令由<code class="literal">iptables-ebtables</code>包提供，该包包含基于<code class="literal">nftables</code>的工具重新实现。此工具具有不同的代码库，其输出在方面有所不同，这些方面可忽略不计或有意设计选择。
				</p><p>因此，在迁移解析某些<code class="literal">ebtables</code>输出的脚本时，请调整脚本以反映以下内容：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">MAC地址格式已更改为固定长度。必要时，单个字节值包含前导零，以保持每个八位字节两个字符的格式。
						</li><li class="listitem">IPv6前缀的格式已更改为符合RFC 4291。斜杠字符后面的尾部不再包含IPv6地址格式的网络掩码，而是包含前缀长度。此更改仅适用于有效（左连续）蒙版，而其他更改仍以旧格式打印。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="new_tools_iptables_nftables_networking"></a>将<code class="literal">iptables</code>转换为<code class="literal">nftables</code>新工具</h2></div></div></div><p>此更新添加了<code class="literal">iptables-translate</code>和<code class="literal">ip6tables-translate</code>工具，将现有的<code class="literal">iptables</code>或<code class="literal">ip6tables</code>规则转换为<code class="literal">nftables</code>的等效规则。请注意，某些扩展缺少翻译支持。如果存在这样的扩展名，该工具将打印带有<code class="literal">#</code>符号前缀的未翻译规则。例如：</p><pre class="screen">| % iptables-translate -A INPUT -j CHECKSUM --checksum-fill
| nft # -A INPUT -j CHECKSUM --checksum-fill</pre><p>此外，用户可以使用<code class="literal">iptables-restore-translate</code>和<code class="literal">ip6tables-restore-translate</code>工具来转换规则转储。请注意，在此之前，用户可以使用<code class="literal">iptables-save</code>或<code class="literal">ip6tables-save</code>命令打印当前规则的转储。例如：</p><pre class="screen">| % sudo iptables-save &gt;/tmp/iptables.dump
| % iptables-restore-translate -f /tmp/iptables.dump
| # Translated by iptables-restore-translate v1.8.0 on Wed Oct 17 17:00:13 2018
| add table ip nat
| ...</pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="change_in_wpa_supplicant_networking"></a> <code class="literal">wpa_supplicant</code>变化</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="wpa-supplicant-journalctl_networking"></a> <code class="literal">journalctl</code>现在可以读取<code class="literal">wpa_supplicant</code>日志</h2></div></div></div><p>在Red Hat Enterprise Linux（RHEL）8中， <code class="literal">wpa_supplicant</code>包是在启用<code class="literal">CONFIG_DEBUG_SYSLOG</code>情况下构建的。这允许使用<code class="literal">journalctl</code>实用程序读取<code class="literal">wpa_supplicant</code>日志，而不是检查<code class="literal">/var/log/wpa_supplicant.log</code>文件的内容。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="wpa-supplicant-wireless_networking"></a> <code class="literal">wpa_supplicant</code>对无线扩展的编译时支持已禁用</h2></div></div></div><p><code class="literal">wpa_supplicant</code>包不支持无线扩展。当用户尝试将<code class="literal">wext</code>用作命令行参数，或尝试在仅支持无线扩展的旧适配器上使用它时，将无法运行<code class="literal">wpa_supplicant</code>守护程序。
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sctp_networking"></a>添加到SCTP的新数据块类型<code class="literal">I-DATA</code></h1></div></div></div><p>此更新将新的数据块类型， <code class="literal">I-DATA</code>和流调度程序添加到流控制传输协议（SCTP）。以前，SCTP以与用户发送的顺序相同的顺序发送用户消息。因此，大型SCTP用户消息会阻止任何流中的所有其他消息，直到完全发送。使用<code class="literal">I-DATA</code>块时，传输序列号（TSN）字段不会过载。因此，SCTP现在可以以不同的方式调度流，并且<code class="literal">I-DATA</code>允许用户消息交织（RFC 8260）。请注意，两个对等体必须支持<code class="literal">I-DATA</code>块类型。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="tcp_networking"></a> RHEL 8中值得注意的TCP功能</h1></div></div></div><p>红帽企业版Linux 8随TCP网络堆栈版本4.18一起发布，提供更高的性能，更好的可扩展性和更高的稳定性。特别是对于具有高入口连接速率的繁忙TCP服务器，性能得到提升。
			</p><p>此外，两种新的TCP拥塞算法<code class="literal">BBR</code>和<code class="literal">NV</code>可用，在大多数情况下提供比立方更低的延迟和更好的吞吐量。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="tcp_bbr_networking"></a> RHEL 8中的TCP BBR支持</h2></div></div></div><p>红帽企业Linux（RHEL）8现在支持新的TCP拥塞控制算法，瓶颈带宽和往返时间（BBR）。BBR尝试确定瓶颈链路的带宽和往返时间（RTT）。大多数拥塞算法都基于数据包丢失（包括CUBIC，默认的Linux TCP拥塞控制算法），这在高吞吐量链路上存在问题。BBR不会直接对丢失事件做出反应，它会调整TCP调步速率以使其与可用带宽相匹配。TCP BBR的用户应切换到所有相关接口上的<code class="literal">fq</code>队列设置。
				</p><p>请注意，用户应明确使用<code class="literal">fq</code>而不是<code class="literal">fq_codel</code> 。
				</p><p>有关更多详细信息，请参见<code class="literal">tc-fq</code>手册页。
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="vlan-related-changes_networking"></a>与VLAN相关的更改</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ipvlan_network_drivers_networking"></a>现在支持IPVLAN虚拟网络驱动程序</h2></div></div></div><p>在Red Hat Enterprise Linux 8.0中，内核包括对IPVLAN虚拟网络驱动程序的支持。通过此更新，IPVLAN虚拟网络接口卡（NIC）可为多个容器启用网络连接，从而将单个MAC地址暴露给本地网络。这允许单个主机具有许多容器，以克服对等网络设备支持的MAC地址数量的可能限制。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="certain-network-adapters-require-a-firmware-update-to-fully-support-802.1ad-networking"></a>某些网络适配器需要固件更新才能完全支持802.1ad</h2></div></div></div><p>某些网络适配器的固件不完全支持802.1ad标准，该标准也称为Q-in-Q或堆叠虚拟局域网（VLAN）。有关如何验证网络适配器是否使用支持802.1ad标准的固件以及如何更新固件的详细信息，请与硬件供应商联系。因此，使用正确的固件，在RHEL 8.0上配置堆叠VLAN可以按预期工作。
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="network-interface-names_networking"></a>网络接口名称更改</h1></div></div></div><p>在Red Hat Enterprise Linux 8中，默认情况下使用相同的一致网络设备命名方案，如RHEL 7中所示。但是，某些内核驱动程序（例如<code class="literal">e1000e</code> ， <code class="literal">nfp</code> ， <code class="literal">qede</code> ， <code class="literal">sfc</code> ， <code class="literal">tg3</code>和<code class="literal">bnxt_en</code>在全新安装的RHEL 8上更改了它们的一致名称。但是，从RHEL 7升级时会保留名称。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="tc-ok_networking"></a>删除了<code class="literal">tc</code>命令的<code class="literal">-ok</code>选项</h1></div></div></div><p>在Red Hat Enterprise Linux 8中删除了<code class="literal">tc</code>命令的<code class="literal">-ok</code>选项。作为一种解决方法，用户可以实现代码以通过netlink与内核直接通信。收到响应消息，指示已发送请求的完成和状态。对时间要求较低的应用程序的另一种方法是分别为每个命令调用<code class="literal">tc</code> 。这可能发生在自定义脚本中，该脚本通过为每个成功的<code class="literal">tc</code>调用打印<code class="literal">OK</code>来模拟<code class="literal">tc -batch</code>行为。
			</p></div></div></body></html>