<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>附录A. Kickstart脚本文件格式参考</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="appendix"><div class="titlepage"><div><div><h1 class="title"><a id="kickstart-script-file-format-reference_installing-rhel-as-an-experienced-user"></a>附录A. Kickstart脚本文件格式参考</h1></div></div></div><p>该参考资料详细描述了kickstart文件格式。
			</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="kickstart-file-format_kickstart-script-file-format-reference"></a> Kickstart文件格式</h1></div></div></div><p>Kickstart脚本是纯文本文件，包含安装程序识别的关键字，用作安装的指示。任何能够将文件保存为ASCII文本的文本编辑器（如Linux系统上的<code class="literal">Gedit</code>或<code class="literal">vim</code>或Windows系统上的<code class="literal">Notepad</code>都可用于创建和编辑Kickstart文件。Kickstart配置的文件名无关紧要;但是，建议使用简单名称，因为稍后需要在其他配置文件或对话框中指定此名称。
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">命令</span></dt><dd>命令是用作安装说明的关键字。每个命令必须在一行上。命令可以选择。指定命令和选项类似于在shell中使用Linux命令。
							</dd><dt><span class="term">第</span></dt><dd>某些以<code class="literal">%</code>字符开头的特殊命令会启动一个部分。部分中的命令解释与部分外部的命令不同。必须使用<code class="literal">%end</code>命令完成每个部分。
							</dd><dt><span class="term">部分类型</span></dt><dd><p class="simpara">可用的部分是：</p><div class="informalexample"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										<span class="strong"><strong>附加部分</strong></span> 。这些部分使用<code class="literal">%addon <span class="emphasis"><em>addon_name</em></span></code>命令。
									</li><li class="listitem">
										<span class="strong"><strong>包装选择部分</strong></span> 。从<code class="literal">%packages</code>开始。使用它列出要安装的包，包括间接方法，例如包组或模块。
									</li><li class="listitem">
										<span class="strong"><strong>脚本部分</strong></span> 。这些以<code class="literal">%pre</code> ， <code class="literal">%pre-install</code> ， <code class="literal">%post</code>和<code class="literal">%onerror</code>开头。这些部分不是必需的。
									</li></ul></div></div></dd><dt><span class="term">命令部分</span></dt><dd>命令部分是用于Kickstart文件中不属于任何脚本部分或“％packages”部分的命令的术语。
							</dd><dt><span class="term">脚本部分计数和排序</span></dt><dd>除命令部分之外的所有部分都是可选的，可以多次出现。当要评估特定类型的脚本部分时，Kickstart中存在的该类型的所有部分将按照外观的顺序进行评估：按照它们出现的顺序依次评估两个<code class="literal">%post</code>部分。但是，您不必按任何顺序指定各种类型的脚本部分： <code class="literal">%pre</code>部分之前是否有<code class="literal">%post</code>部分无关紧要。
							</dd></dl></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">评论</span></dt><dd>Kickstart注释是以hash <code class="literal">#</code>字符开头的行。安装程序会忽略这些行。
							</dd></dl></div><p>可以省略不需要的项目。省略任何所需项目会导致安装程序更改为交互模式，以便用户可以提供相关项目的答案，就像在常规交互式安装期间一样。也可以使用<code class="literal">cmdline</code>命令将kickstart脚本声明为非交互式脚本。在非交互模式下，任何缺少的答案都会中止安装过程。
				</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="package-selection-in-kickstart_kickstart-script-file-format-reference"></a> Kickstart中的包装选择</h1></div></div></div><p>Kickstart使用<code class="literal">%packages</code>命令启动的部分来选择要安装的软件包。您可以通过这种方式安装软件包，组，环境，模块流和模块配置文件。
				</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="package-selection-section_package-selection-in-kickstart"></a>包装选择部分</h2></div></div></div><p>使用<code class="literal">%packages</code>命令开始一个Kickstart部分，该部分描述了要安装的软件包。<code class="literal">%packages</code>部分必须以<code class="literal">%end</code>命令<code class="literal">%end</code> 。
					</p><p>您可以按环境，组，模块流，模块配置文件或其包名称指定包。定义了包含相关包的多个环境和组。请参阅<code class="literal"><span class="emphasis"><em>repository</em></span> /repodata/*-comps- <span class="emphasis"><em>repository</em></span> . <span class="emphasis"><em>architecture</em></span> .xml</code> Red Hat Enterprise Linux 8安装DVD上的<code class="literal"><span class="emphasis"><em>repository</em></span> /repodata/*-comps- <span class="emphasis"><em>repository</em></span> . <span class="emphasis"><em>architecture</em></span> .xml</code>文件，以获取环境和组的列表。
					</p><p><code class="literal">*-comps- <span class="emphasis"><em>repository</em></span> . <span class="emphasis"><em>architecture</em></span> .xml</code>文件包含描述可用环境（由<code class="literal">&lt;environment&gt;</code>标记标记）和组（ <code class="literal">&lt;group&gt;</code>标记）的结构。每个条目都有ID，用户可见性值，名称，描述和包列表。如果选择安装组，则始终安装包列表中标记为<code class="literal">mandatory</code>的包，如果未在其他位置明确排除，则会安装标记为<code class="literal">default</code>的包，并且即使选择了组，也必须将标记为<code class="literal">optional</code>的包特别包含在其他位置。
					</p><p>您可以使用其ID（ <code class="literal">&lt;id&gt;</code>标记）或名称（ <code class="literal">&lt;name&gt;</code>标记）指定包组或环境。
					</p><p>如果您不确定应安装哪个软件包，Red Hat建议您选择<span class="strong"><strong><span class="GUI">Minimal Install</span></strong></span>环境。<span class="strong"><strong><span class="GUI">Minimal Install</span></strong></span>仅提供运行Red Hat Enterprise Linux 8所必需的软件包。这将大大降低系统受漏洞影响的可能性。如有必要，可在安装后添加其他软件包。有关<span class="strong"><strong><span class="GUI">最小安装的</span></strong></span>更多详细信息，请参阅“ <span class="emphasis"><em>安全加固”</em></span>文档中的“ <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/security_hardening/index#Minimal_install_configuring-and-managing-security">安装所需的最小数量的软件包”</a>部分。请注意，从Kickstart文件安装系统后， <span class="strong"><strong><span class="GUI">初始安装程序</span></strong></span>无法运行，除非安装中包含桌面环境和X Window系统，并且启用了图形登录。
					</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>要在64位系统上安装32位软件包：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">为<code class="literal">%packages</code>部分指定<code class="literal">--multilib</code>选项</li><li class="listitem">将包名称附加到为其构建包的32位体系结构;例如， <code class="literal">glibc.i686</code>
								</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="package-selection-commands_package-selection-in-kickstart"></a>包选择命令</h2></div></div></div><p>这些命令可以在Kickstart文件的<code class="literal">%packages</code>部分中使用。
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">指定环境</span></dt><dd><p class="simpara">将要安装的整个环境指定为以<code class="literal">@^</code>符号开头的行：</p><pre class="screen">%packages
@^Infrastructure Server
%end</pre><p class="simpara">这将安装属于<code class="literal">Infrastructure Server</code>环境的所有软件包。<code class="literal"><span class="emphasis"><em>repository</em></span> /repodata/*-comps- <span class="emphasis"><em>repository</em></span> . <span class="emphasis"><em>architecture</em></span> .xml</code>中描述了所有可用的环境<code class="literal"><span class="emphasis"><em>repository</em></span> /repodata/*-comps- <span class="emphasis"><em>repository</em></span> . <span class="emphasis"><em>architecture</em></span> .xml</code> Red Hat Enterprise Linux 8安装DVD上的<code class="literal"><span class="emphasis"><em>repository</em></span> /repodata/*-comps- <span class="emphasis"><em>repository</em></span> . <span class="emphasis"><em>architecture</em></span> .xml</code>文件。</p><p class="simpara">在Kickstart文件中只应指定一个环境。如果指定了更多环境，则仅使用最后指定的环境。
								</p></dd><dt><span class="term">指定组</span></dt><dd><p class="simpara">指定组，一行的一个条目，以<code class="literal">@</code>符号开头，然后是<code class="literal">*-comps- <span class="emphasis"><em>repository</em></span> . <span class="emphasis"><em>architecture</em></span> .xml</code>给出的完整组名或组ID <code class="literal">*-comps- <span class="emphasis"><em>repository</em></span> . <span class="emphasis"><em>architecture</em></span> .xml</code>文件。例如：</p><pre class="screen">%packages
@X Window System
@Desktop
@Sound and Video
%end</pre><p class="simpara">始终选择<code class="literal">Core</code>组 - 不必在<code class="literal">%packages</code>部分中指定它。
								</p></dd><dt><span class="term">指定单个包</span></dt><dd><p class="simpara">按名称指定单个包，一行指定一行。您可以在包名称中使用星号字符（ <code class="literal">*</code> ）作为通配符。例如：</p><pre class="screen">%packages
sqlite
curl
aspell
docbook*
%end</pre><p class="simpara"><code class="literal">docbook*</code>条目包括与通配符表示的模式匹配的软件包<code class="literal">docbook-dtds</code>和<code class="literal">docbook-style</code> 。
								</p></dd><dt><span class="term">指定模块流的配置文件</span></dt><dd><p class="simpara">使用配置文件的语法指定模块流的配置文件，一行到一行：</p><pre class="screen">%packages
@module:stream/profile
%end</pre><p class="simpara">这将安装模块流的指定配置文件中列出的所有软件包。
								</p><div class="informalexample"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">当模块指定了默认流时，您可以将其保留。如果未指定默认流，则必须指定它。
										</li><li class="listitem">当模块流具有指定的默认配置文件时，您可以将其保留。如果未指定默认配置文件，则必须指定它。
										</li><li class="listitem">不能使用不同的流多次安装模块。
										</li><li class="listitem">可以安装相同模块和流的多个配置文件。
										</li></ul></div></div><p class="simpara">模块和组使用以<code class="literal">@</code>符号开头的相同语法。当模块和包组具有相同名称时，模块优先。
								</p><p class="simpara">在Red Hat Enterprise Linux 8中，模块仅存在于AppStream存储库中。要列出可用模块，请在已安装的Red Hat Enterprise Linux 8系统上使用<code class="literal">yum module list</code>命令。
								</p><p class="simpara">也可以使用<code class="literal">module</code> Kickstart命令启用模块流，然后通过直接命名来安装模块流中包含的包。
								</p></dd><dt><span class="term">排除环境，组或包</span></dt><dd><p class="simpara">使用前导短划线（ <code class="literal">-</code> ）指定要从安装中排除的包或组。例如：</p><pre class="screen">%packages
-@Graphical Administration Tools
-autofs
-ipa*compat
%end</pre></dd></dl></div><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>不支持在Kickstart文件中仅使用<code class="literal">*</code>安装所有可用软件包。
						</p></div><p>您可以使用多个选项更改<code class="literal">%packages</code>部分的默认行为。某些选项适用于整个包选择，其他选项仅适用于特定组。
					</p><div class="itemizedlist"><p class="title"><strong>其他资源</strong></p><ul class="itemizedlist"><li class="listitem">有关处理程序包的详细信息，请参阅“ <span class="emphasis"><em>配置基本系统设置”</em></span>文档中的“ <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/installing-software-with-yum_configuring-basic-system-settings">使用yum安装软件”</a>一章。
							</li><li class="listitem">有关模块和流的更多信息，请参阅“ <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/installing_managing_and_removing_user_space_components/index">安装，管理和删除用户空间组件”</a>文档。
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="common-package-selection-options_package-selection-in-kickstart"></a>常见的包装选择选项</h2></div></div></div><p>以下选项可用于<code class="literal">%packages</code>部分。要使用选项，请将其附加到包选择部分的开头。例如：</p><pre class="screen">%packages --multilib --ignoremissing</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">- 默认</code></span></dt><dd>安装默认的软件包集。这对应于在交互式安装期间在“ <span class="strong"><strong><span class="GUI">包选择”</span></strong></span>屏幕中未进行其他选择时将安装的包集。
								</dd><dt><span class="term"><code class="literal">--excludedocs</code></span></dt><dd>不要安装包中包含的任何文档。在大多数情况下，这会排除通常安装在<code class="literal">/usr/share/doc</code>目录中的所有文件，但要排除的特定文件取决于各个包。
								</dd><dt><span class="term"><code class="literal">--ignoremissing</code></span></dt><dd>忽略安装源中缺少的任何软件包，组，模块流，模块配置文件和环境，而不是暂停安装以询问是否应中止或继续安装。
								</dd><dt><span class="term"><code class="literal">--instLangs =</code></span></dt><dd>指定要安装的语言列表。请注意，这与程序包组级别选择不同。此选项不描述应安装哪些软件包组;相反，它设置RPM宏来控制应该安装来自各个包的翻译文件。
								</dd><dt><span class="term"><code class="literal">--multilib</code></span></dt><dd><p class="simpara">为multilib软件包配置已安装的系统（即，允许在64位系统上安装32位软件包）并安装本节中指定的软件包。
								</p><p class="simpara">通常，在AMD64和Intel 64系统上，只会安装此体系结构的程序包（标记为<code class="literal">x86_64</code> ）和所有体系结构的程序包（标记为<code class="literal">noarch</code> ）。使用此选项时，如果可用，还会自动安装32位AMD和Intel系统（标记为<code class="literal">i686</code> ）的软件包。
								</p><p class="simpara">这仅适用于<code class="literal">%packages</code>部分中明确指定的<code class="literal">%packages</code> 。仅作为依赖项安装而未在Kickstart文件中指定的软件包仅安装在需要它们的体系结构版本中，即使它们可用于更多体系结构。
								</p></dd><dt><span class="term"><code class="literal">--nocore</code></span></dt><dd><p class="simpara">禁用<code class="literal">@Core</code>软件包组的安装，否则默认情况下始终安装该组。禁用<code class="literal">@Core</code>包组应仅用于创建轻量级容器;使用<code class="literal">--nocore</code>安装桌面或服务器系统将导致系统无法使用。
								</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>使用<code class="literal">-@Core</code>排除<code class="literal">@Core</code>包组中的包不起作用。排除<code class="literal">@Core</code>包组的唯一方法是使用<code class="literal">--nocore</code>选项。
									</p></div></dd><dt><span class="term"><code class="literal">--excludeWeakdeps</code></span></dt><dd>禁用从弱依赖项安装软件包。这些是通过Recommends和Supplements标志链接到所选包的包。默认情况下，将安装弱依赖项。
								</dd><dt><span class="term"><code class="literal">--retries =</code></span></dt><dd>设置Yum尝试下载包（重试）的次数。默认值为10。此选项仅适用于安装期间，不会影响已安装系统上的Yum配置。
								</dd><dt><span class="term"><code class="literal">--timeout =</code></span></dt><dd>以秒为单位设置Yum超时。默认值为30。此选项仅适用于安装期间，不会影响已安装系统上的Yum配置。
								</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="options-for-specific-package-groups_package-selection-in-kickstart"></a>特定包组的选项</h2></div></div></div><p>此列表中的选项仅适用于单个包组。而不是在Kickstart文件中的<code class="literal">%packages</code>命令中使用它们，而是将它们附加到组名称。例如：</p><pre class="screen">%packages
@Graphical Administration Tools --optional
%end</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">--nodefaults</code></span></dt><dd>仅安装组的强制包，而不是默认选择。
								</dd><dt><span class="term"><code class="literal">- 可选的</code></span></dt><dd><p class="simpara">在<code class="literal">*-comps- <span class="emphasis"><em>repository</em></span> . <span class="emphasis"><em>architecture</em></span> .xml</code>中的组定义中安装标记为可选的包<code class="literal">*-comps- <span class="emphasis"><em>repository</em></span> . <span class="emphasis"><em>architecture</em></span> .xml</code>文件，除了安装默认选择。
								</p><p class="simpara">请注意，某些软件包组（例如<code class="literal">Scientific Support</code> ）没有指定任何强制或默认软件包 - 仅包含可选软件包。在这种情况下，必须始终使用<code class="literal">--optional</code>选项，否则不会安装此组中的软件包。
								</p></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="pre-installation-scripts-in-kickstart_kickstart-script-file-format-reference"></a> Kickstart中的预安装脚本</h1></div></div></div><p>安装前脚本会在安装开始之前立即运行。
				</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="pre-installation-script-section_pre-installation-scripts-in-kickstart"></a>预安装脚本部分</h2></div></div></div><p>在加载Kickstart文件之后立即在系统上运行<code class="literal">%pre</code>脚本，但在完全解析并开始安装之前。这些部分中的每一部分都必须以<code class="literal">%pre</code>开头，以<code class="literal">%end</code> 。
					</p><p><code class="literal">%pre</code>脚本可用于激活和配置网络和存储设备。也可以使用安装环境中提供的解释器来运行脚本。如果在继续安装之前具有需要特殊配置的网络和存储，或者具有可设置其他日志记录参数或环境变量的脚本，则添加<code class="literal">%pre</code>脚本非常有用。
					</p><p>使用<code class="literal">%pre</code>脚本调试问题可能很困难，因此建议仅在必要时使用<code class="literal">%pre</code>脚本。
					</p><p>除了安装环境<code class="literal">/sbin</code>和<code class="literal">/bin</code>目录中的大多数实用程序之外，还可以在<code class="literal">%pre</code>脚本中使用与网络，存储和文件系统相关的命令。
					</p><p>您可以在<code class="literal">%pre</code>部分中访问网络。但是，此时尚未配置名称服务，因此只有IP地址可用，而不是URL。</p><p><code class="literal">%pre</code>脚本忽略<code class="literal">%include</code>命令的丢失文件。这对于在<code class="literal">%pre</code>部分中生成包含的文件以及稍后加载它们非常有用。
					</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>与安装后脚本不同，预安装脚本不在chroot环境中运行。
						</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="pre-installation-kickstart-section-options_pre-installation-scripts-in-kickstart"></a>预安装Kickstart部分选项</h2></div></div></div><p>以下选项可用于更改预安装脚本的行为。要使用选项，请将其附加到脚本开头的<code class="literal">%pre</code>行。例如：</p><pre class="screen">%pre --interpreter=/usr/libexec/platform-python
-- Python script omitted --
%end</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">--interpreter =</code></span></dt><dd><p class="simpara">允许您指定其他脚本语言，例如Python。可以使用系统上可用的任何脚本语言;在大多数情况下，这些是<code class="literal">/usr/bin/sh</code> ， <code class="literal">/usr/bin/bash</code>和<code class="literal">/usr/libexec/platform-python</code> 。
								</p><p class="simpara">请注意， <code class="literal">platform-python</code>解释器使用Python 3.6版。您必须从以前的RHEL版本更改Python脚本以获取新路径和版本。另外， <code class="literal">platform-python</code>适用于系统工具：在安装环境之外使用<code class="literal">python36</code>软件包。有关Red Hat Enterprise Linux 8中Python的更多详细信息，请参阅<span class="emphasis"><em>配置基本系统设置中的</em></span> <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/using-python3_configuring-basic-system-settings#introduction-to-python_using-python3">Python简介</a> 。
								</p></dd><dt><span class="term"><code class="literal">--erroronfail</code></span></dt><dd>如果脚本失败，则显示错误并暂停安装。该错误消息将指示您记录失败原因的位置。
								</dd><dt><span class="term"><code class="literal">--log =</code></span></dt><dd><p class="simpara">将脚本的输出记录到指定的日志文件中。例如：</p><pre class="screen">%pre --log=/mnt/sysimage/root/ks-pre.log</pre></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="post-installation-scripts-in-kickstart_kickstart-script-file-format-reference"></a> Kickstart中的安装后脚本</h1></div></div></div><p>安装完成后，但在第一次重新引导系统之前，将运行安装后脚本。您可以使用此部分来运行系统订阅等任务。
				</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="post-installation-script-section_post-installation-scripts-in-kickstart"></a>安装后脚本部分</h2></div></div></div><p>安装完成后，您可以选择添加要在系统上运行的命令，但是在首次重新引导系统之前。此部分必须以<code class="literal">%post</code>开头，以<code class="literal">%end</code> 。
					</p><p><code class="literal">%post</code>部分对于安装其他软件或配置其他名称服务器等功能非常有用。安装后脚本在<code class="literal">chroot</code>环境中运行，因此，默认情况下，执行从安装介质复制脚本或RPM软件包等任务不起作用。您可以使用<code class="literal">--nochroot</code>选项更改此行为，如下所述。然后<code class="literal">%post</code>脚本将在安装环境中运行，而不是在已安装的目标系统上的<code class="literal">chroot</code>运行。
					</p><p>由于安装后脚本在<code class="literal">chroot</code>环境中运行，因此大多数<code class="literal">systemctl</code>命令将拒绝执行任何操作。有关更多信息，请参阅“ <span class="emphasis"><em>配置和管理系统管理”</em></span>文档<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/managing-services-with-systemd_configuring-basic-system-settings#behavior_of_systemctl_in_a_chroot_environment">的“chroot环境”</a>部分中的<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/managing-services-with-systemd_configuring-basic-system-settings#behavior_of_systemctl_in_a_chroot_environment">“systemctl</a>的<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/managing-services-with-systemd_configuring-basic-system-settings#behavior_of_systemctl_in_a_chroot_environment">行为”</a> 。
					</p><p>请注意，在执行<code class="literal">%post</code>部分期间，必须仍然插入安装介质。
					</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>如果您使用静态IP信息（包括名称服务器）配置网络，则可以访问网络并解析<code class="literal">%post</code>部分中的IP地址。如果您为DHCP配置了网络，则在安装执行<code class="literal">%post</code>部分时尚未完成<code class="literal">/etc/resolv.conf</code>文件。您可以访问网络，但无法解析IP地址。因此，如果您使用DHCP，则必须在<code class="literal">%post</code>部分中指定IP地址。
						</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="post-installation-kickstart-section-options_post-installation-scripts-in-kickstart"></a>安装后Kickstart部分选项</h2></div></div></div><p>以下选项可用于更改安装后脚本的行为。要使用选项，请将其附加到脚本开头的<code class="literal">%post</code>行。例如：</p><pre class="screen">%post --interpreter=/usr/libexec/platform-python
-- Python script omitted --
%end</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">--interpreter =</code></span></dt><dd><p class="simpara">允许您指定其他脚本语言，例如Python。例如：</p><pre class="screen">%post --interpreter=/usr/libexec/platform-python</pre><p class="simpara">可以使用系统上可用的任何脚本语言;在大多数情况下，这些是<code class="literal">/usr/bin/sh</code> ， <code class="literal">/usr/bin/bash</code>和<code class="literal">/usr/libexec/platform-python</code> 。
								</p><p class="simpara">请注意， <code class="literal">platform-python</code>解释器使用Python 3.6版。您必须从以前的RHEL版本更改Python脚本以获取新路径和版本。另外， <code class="literal">platform-python</code>适用于系统工具：在安装环境之外使用<code class="literal">python36</code>软件包。有关Red Hat Enterprise Linux 8中Python的更多详细信息，请参阅<span class="emphasis"><em>配置基本系统设置中的</em></span> <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/using-python3_configuring-basic-system-settings#introduction-to-python_using-python3">Python简介</a> 。
								</p></dd><dt><span class="term"><code class="literal">--nochroot</code></span></dt><dd><p class="simpara">允许您指定要在chroot环境之外运行的命令。
								</p><p class="simpara">以下示例将文件/etc/resolv.conf复制到刚刚安装的文件系统。
								</p><pre class="screen">%post --nochroot
cp /etc/resolv.conf /mnt/sysimage/etc/resolv.conf
%end</pre></dd><dt><span class="term"><code class="literal">--erroronfail</code></span></dt><dd>如果脚本失败，则显示错误并暂停安装。该错误消息将指示您记录失败原因的位置。
								</dd><dt><span class="term"><code class="literal">--log =</code></span></dt><dd><p class="simpara">将脚本的输出记录到指定的日志文件中。请注意，日志文件的路径必须考虑是否使用<code class="literal">--nochroot</code>选项。例如，没有<code class="literal">--nochroot</code> ：</p><pre class="screen">%post --log=/root/ks-post.log</pre><p class="simpara">和<code class="literal">--nochroot</code> ：</p><pre class="screen">%post --nochroot --log=/mnt/sysimage/root/ks-post.log</pre></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="example-mounting-nfs-in-a-post-install-script_post-installation-scripts-in-kickstart"></a>示例：在安装后脚本中挂载NFS</h2></div></div></div><p>这个<code class="literal">%post</code>部分的示例安装了一个NFS共享，并在共享上执行位于<code class="literal">/usr/new-machines/</code>名为<code class="literal">runme</code>的脚本。请注意，在Kickstart模式下不支持NFS文件锁定，因此需要<code class="literal">-o nolock</code>选项。
					</p><pre class="screen"># Start of the %post section with logging into /root/ks-post.log
%post --log=/root/ks-post.log

# Mount an NFS share
mkdir /mnt/temp
mount -o nolock 10.10.0.2:/usr/new-machines /mnt/temp
openvt -s -w -- /mnt/temp/runme
umount /mnt/temp

# End of the %post section
%end</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="example-running-subscription-manager-as-a-post-install-script_post-installation-scripts-in-kickstart"></a>示例：将subscription-manager作为安装后脚本运行</h2></div></div></div><p>Kickstart安装中安装后脚本的最常见用途之一是使用Red Hat Subscription Manager自动注册已安装的系统。以下是<code class="literal">%post</code>脚本中自动订阅的示例：</p><pre class="screen">%post --log=/root/ks-post.log
subscription-manager register --username=admin@example.com --password=secret --auto-attach
%end</pre><p>subscription-manager命令行脚本将系统注册到Red Hat订阅管理服务器（客户门户订阅管理，Satellite 6或CloudForms系统引擎）。此脚本还可用于将订阅自动分配或附加到与该系统最匹配的系统。注册客户门户时，请使用Red Hat Network登录凭据。注册到Satellite 6或CloudForms System Engine时，您可能还需要指定更多订阅管理器选项，如<code class="literal">--serverurl</code> ， - <code class="literal">--org</code> ， - <code class="literal">--environment</code>以及本地管理员提供的凭据。请注意，以<code class="literal">--org --activationkey</code>组合形式的凭据是避免在共享kickstart文件中公开<code class="literal">--username --password</code>值的好方法。
					</p><p>注册命令可以使用其他选项来设置系统的首选服务级别，并将具有扩展更新支持订阅的客户的更新和勘误限制为RHEL的特定次要版本，这些客户需要在旧流上保持固定。
					</p><p>另请参阅<a class="link" href="https://access.redhat.com/solutions/748313">如何在kickstart文件中使用subscription-manager？</a> 有关在Kickstart <code class="literal">%post</code>部分中使用<code class="literal">subscription-manager</code>其他信息，请参阅Red Hat客户门户网站上的文章。
					</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="anaconda-configuration-section_kickstart-script-file-format-reference"></a> Anaconda配置部分</h1></div></div></div><p>可以在Kickstart文件的<code class="literal">%anaconda</code>部分中配置其他安装选项。此部分控制安装系统的用户界面的行为。
				</p><p>在Kickstart命令之后，此部分必须放在Kickstart文件的末尾，并且必须以<code class="literal">%anaconda</code>开头并以<code class="literal">%end</code> 。
				</p><p>目前，可以在<code class="literal">%anaconda</code>部分中使用的唯一命令是<code class="literal">pwpolicy</code> 。
				</p><div class="example"><a id="idm139712675574224"></a><p class="title"><strong>例A.1。示例<code class="literal">%anaconda</code>脚本</strong></p><div class="example-contents"><p>以下是％anaconda部分的示例：</p><pre class="screen">%anaconda
pwpolicy root --minlen=10 --strict
%end</pre><p>此示例<code class="literal">%anaconda</code>部分设置密码策略，该策略要求root密码长度至少为10个字符，并严格禁止与此要求不匹配的密码。
					</p></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="kickstart-error-handling-section_kickstart-script-file-format-reference"></a> Kickstart错误处理部分</h1></div></div></div><p>从Red Hat Enterprise Linux 7开始，Kickstart安装可以包含在安装程序遇到致命错误时运行的自定义脚本。例如，已请求安装的程序包中的错误，指定时无法启动VNC或扫描存储设备时出错。发生此类错误后，安装无法继续。安装程序将按照Kickstart文件中提供的顺序运行所有<code class="literal">%onerror</code>脚本。此外，如果发生回溯，将运行<code class="literal">%onerror</code>脚本。
				</p><p>每个<code class="literal">%onerror</code>脚本都需要以<code class="literal">%end</code> 。
				</p><p>错误处理部分接受以下选项：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">--erroronfail</code></span></dt><dd>如果脚本失败，则显示错误并暂停安装。该错误消息将指示您记录失败原因的位置。
							</dd><dt><span class="term"><code class="literal">--interpreter =</code></span></dt><dd><p class="simpara">允许您指定其他脚本语言，例如Python。例如：</p><pre class="screen">%onerror --interpreter=/usr/libexec/platform-python</pre><p class="simpara">可以使用系统上可用的任何脚本语言;在大多数情况下，这些是<code class="literal">/usr/bin/sh</code> ， <code class="literal">/usr/bin/bash</code>和<code class="literal">/usr/libexec/platform-python</code> 。
							</p><p class="simpara">请注意， <code class="literal">platform-python</code>解释器使用Python 3.6版。您必须从以前的RHEL版本更改Python脚本以获取新路径和版本。另外， <code class="literal">platform-python</code>适用于系统工具：在安装环境之外使用<code class="literal">python36</code>软件包。有关Red Hat Enterprise Linux 8中Python的更多详细信息，请参阅<span class="emphasis"><em>配置基本系统设置中的</em></span> <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/using-python3_configuring-basic-system-settings#introduction-to-python_using-python3">Python简介</a> 。
							</p></dd><dt><span class="term"><code class="literal">--log =</code></span></dt><dd>将脚本的输出记录到指定的日志文件中。
							</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="kickstart-add-on-sections_kickstart-script-file-format-reference"></a> Kickstart附加部分</h1></div></div></div><p>从Red Hat Enterprise Linux 7开始，Kickstart安装支持附加组件。这些附加组件可以通过多种方式扩展基本的Kickstart（和Anaconda）功能。
				</p><p>要在Kickstart文件中使用加载项，请使用<code class="literal">%addon <span class="emphasis"><em>addon_name</em></span> <span class="emphasis"><em>options</em></span></code>命令，并使用<code class="literal">%end</code>语句完成命令，类似于安装前和安装后脚本部分。例如，如果要使用默认情况下随Anaconda一起分发的Kdump加载项，请使用以下命令：</p><pre class="screen">%addon com_redhat_kdump --enable --reserve-mb=auto
%end</pre><p><code class="literal">%addon</code>命令不包含任何自己的选项 - 所有选项都取决于实际的加载项。
				</p></div></div></body></html>