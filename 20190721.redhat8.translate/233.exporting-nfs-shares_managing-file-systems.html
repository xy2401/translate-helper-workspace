<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 3. Exporting NFS shares</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="exporting-nfs-shares_managing-file-systems"/>Chapter 3. Exporting NFS shares</h1></div></div></div><p>
			As a system administrator, you can use the NFS server to share a directory on your system over network.
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="introduction-to-nfs_exporting-nfs-shares"/>Introduction to NFS</h1></div></div></div><p>
				This section explains the basic concepts of the NFS service.
			</p><p>
				A Network File System (NFS) allows remote hosts to mount file systems over a network and interact with those file systems as though they are mounted locally. This enables you to consolidate resources onto centralized servers on the network.
			</p><p>
				The NFS server refers to the <code class="literal">/etc/exports</code> configuration file to determine whether the client is allowed to access any exported file systems. Once verified, all file and directory operations are available to the user.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="supported-nfs-versions_exporting-nfs-shares"/>Supported NFS versions</h1></div></div></div><p>
				This section lists versions of NFS supported in Red Hat Enterprise Linux and their features.
			</p><p>
				Currently, Red Hat Enterprise Linux 8 supports the following major versions of NFS:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						NFS version 3 (NFSv3) supports safe asynchronous writes and is more robust at error handling than the previous NFSv2; it also supports 64-bit file sizes and offsets, allowing clients to access more than 2 GB of file data.
					</li><li class="listitem">
						NFS version 4 (NFSv4) works through firewalls and on the Internet, no longer requires an <code class="literal">rpcbind</code> service, supports Access Control Lists (ACLs), and utilizes stateful operations.
					</li></ul></div><p>
				NFS version 2 (NFSv2) is no longer supported by Red Hat.
			</p><h3><a id="default_nfs_version_2"/>Default NFS version</h3><p>
				The default NFS version in Red Hat Enterprise Linux 8 is 4.2. NFS clients attempt to mount using NFSv4.2 by default, and fall back to NFSv4.1 when the server does not support NFSv4.2. The mount later falls back to NFSv4.0 and then to NFSv3.
			</p><h3><a id="features_of_minor_nfs_versions_2"/>Features of minor NFS versions</h3><p>
				Following are the features of NFSv4.2 in Red Hat Enterprise Linux 8:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Server-side copy</span></dt><dd>
							Enables the NFS client to efficiently copy data without wasting network resources using the <code class="literal">copy_file_range()</code> system call.
						</dd><dt><span class="term">Sparse files</span></dt><dd>
							Enables files to have one or more <span class="emphasis"><em>holes</em></span>, which are unallocated or uninitialized data blocks consisting only of zeroes. The <code class="literal">lseek()</code> operation in NFSv4.2 supports <code class="literal">seek_hole()</code> and <code class="literal">seek_data()</code>, which enables applications to map out the location of holes in the sparse file.
						</dd><dt><span class="term">Space reservation</span></dt><dd>
							Permits storage servers to reserve free space, which prohibits servers to run out of space. NFSv4.2 supports the <code class="literal">allocate()</code> operation to reserve space, the <code class="literal">deallocate()</code> operation to unreserve space, and the <code class="literal">fallocate()</code> operation to preallocate or deallocate space in a file.
						</dd><dt><span class="term">Labeled NFS</span></dt><dd>
							Enforces data access rights and enables SELinux labels between a client and a server for individual files on an NFS file system.
						</dd><dt><span class="term">Layout enhancements</span></dt><dd>
							Provides the <code class="literal">layoutstats()</code> operation, which enables some Parallel NFS (pNFS) servers to collect better performance statistics.
						</dd></dl></div><p>
				Following are the features of NFSv4.1:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						Enhances performance and security of network, and also includes client-side support for pNFS.
					</li><li class="listitem">
						No longer requires a separate TCP connection for callbacks, which allows an NFS server to grant delegations even when it cannot contact the client: for example, when NAT or a firewall interferes.
					</li><li class="listitem">
						Provides exactly once semantics (except for reboot operations), preventing a previous issue whereby certain operations sometimes returned an inaccurate result if a reply was lost and the operation was sent twice.
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="the-tcp-and-udp-protocols-in-nfsv3-and-nfsv4_exporting-nfs-shares"/>The TCP and UDP protocols in NFSv3 and NFSv4</h1></div></div></div><p>
				NFSv4 requires the Transmission Control Protocol (TCP) running over an IP network.
			</p><p>
				NFSv3 could also use the User Datagram Protocol (UDP) in earlier Red Hat Enterprise Linux versions. In Red Hat Enterprise Linux 8, NFS over UDP is no longer supported. By default, UDP is disabled in the NFS server.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="services-required-by-nfs_exporting-nfs-shares"/>Services required by NFS</h1></div></div></div><p>
				This section lists system services that are required for running an NFS server or mounting NFS shares. Red Hat Enterprise Linux starts these services automatically.
			</p><p>
				Red Hat Enterprise Linux uses a combination of kernel-level support and service processes to provide NFS file sharing. All NFS versions rely on Remote Procedure Calls (RPC) between clients and servers. To share or mount NFS file systems, the following services work together depending on which version of NFS is implemented:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">nfsd</code></span></dt><dd>
							The NFS server to service requests for shared NFS file systems.
						</dd><dt><span class="term"><code class="literal">rpcbind</code></span></dt><dd>
							Accepts port reservations from local RPC services. These ports are then made available (or advertised) so the corresponding remote RPC services can access them. The <code class="literal">rpcbind</code> service responds to requests for RPC services and sets up connections to the requested RPC service. This is not used with NFSv4.
						</dd><dt><span class="term"><code class="literal">rpc.mountd</code></span></dt><dd>
							This process is used by an NFS server to process <code class="literal">MOUNT</code> requests from NFSv3 clients. It checks that the requested NFS share is currently exported by the NFS server, and that the client is allowed to access it. If the mount request is allowed, the <code class="literal">nfs-mountd</code> service replies with a Success status and provides the File-Handle for this NFS share back to the NFS client.
						</dd><dt><span class="term"><code class="literal">rpc.nfsd</code></span></dt><dd>
							This process enables explicit NFS versions and protocols the server advertises to be defined. It works with the Linux kernel to meet the dynamic demands of NFS clients, such as providing server threads each time an NFS client connects. This process corresponds to the <code class="literal">nfs-server</code> service.
						</dd><dt><span class="term"><code class="literal">lockd</code></span></dt><dd>
							This is a kernel thread that runs on both clients and servers. It implements the Network Lock Manager (NLM) protocol, which enables NFSv3 clients to lock files on the server. It is started automatically whenever the NFS server is run and whenever an NFS file system is mounted.
						</dd><dt><span class="term"><code class="literal">rpc.statd</code></span></dt><dd>
							This process implements the Network Status Monitor (NSM) RPC protocol, which notifies NFS clients when an NFS server is restarted without being gracefully brought down. The <code class="literal">rpc-statd</code> service is started automatically by the <code class="literal">nfs-server</code> service, and does not require user configuration. This is not used with NFSv4.
						</dd><dt><span class="term"><code class="literal">rpc.rquotad</code></span></dt><dd>
							This process provides user quota information for remote users. The <code class="literal">rpc-rquotad</code> service is started automatically by the <code class="literal">nfs-server</code> service and does not require user configuration.
						</dd><dt><span class="term"><code class="literal">rpc.idmapd</code></span></dt><dd><p class="simpara">
							This process provides NFSv4 client and server upcalls, which map between on-the-wire NFSv4 names (strings in the form of <code class="literal"><span class="emphasis"><em>user</em></span>@<span class="emphasis"><em>domain</em></span></code>) and local UIDs and GIDs. For <code class="literal">idmapd</code> to function with NFSv4, the <code class="literal">/etc/idmapd.conf</code> file must be configured. At a minimum, the <code class="literal">Domain</code> parameter should be specified, which defines the NFSv4 mapping domain. If the NFSv4 mapping domain is the same as the DNS domain name, this parameter can be skipped. The client and server must agree on the NFSv4 mapping domain for ID mapping to function properly.
						</p><p class="simpara">
							Only the NFSv4 server uses <code class="literal">rpc.idmapd</code>, which is started by the <code class="literal">nfs-idmapd</code> service. The NFSv4 client uses the keyring-based <code class="literal">nfsidmap</code> utility, which is called by the kernel on-demand to perform ID mapping. If there is a problem with <code class="literal">nfsidmap</code>, the client falls back to using <code class="literal">rpc.idmapd</code>.
						</p></dd></dl></div><h3><a id="the_rpc_services_with_nfsv4_2"/>The RPC services with NFSv4</h3><p>
				The mounting and locking protocols have been incorporated into the NFSv4 protocol. The server also listens on the well-known TCP port 2049. As such, NFSv4 does not need to interact with <code class="literal">rpcbind</code>, <code class="literal">lockd</code>, and <code class="literal">rpc-statd</code> services. The <code class="literal">nfs-mountd</code> service is still required on the NFS server to set up the exports, but is not involved in any over-the-wire operations.
			</p><h3><a id="additional_resources_5"/>Additional resources</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						To configure an NFSv4-only server, which does not require <code class="literal">rpcbind</code>, see <a class="xref" href="exporting-nfs-shares_managing-file-systems.html#configuring-an-nfsv4-only-server_exporting-nfs-shares" title="Configuring an NFSv4-only server">the section called “Configuring an NFSv4-only server”</a>.
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="nfs-host-name-formats_exporting-nfs-shares"/>NFS host name formats</h1></div></div></div><p>
				This section describes different formats that you can use to specify a host when mounting or exporting an NFS share.
			</p><p>
				You can specify the host in the following formats:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Single machine</span></dt><dd><p class="simpara">
							Either of the following:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									A fully-qualified domain name (that can be resolved by the server)
								</li><li class="listitem">
									Host name (that can be resolved by the server)
								</li><li class="listitem">
									An IP address.
								</li></ul></div></dd><dt><span class="term">Series of machines specified with wildcards</span></dt><dd><p class="simpara">
							You can use the <code class="literal">*</code> or <code class="literal">?</code> characters to specify a string match.
						</p><p class="simpara">
							Wildcards are not to be used with IP addresses; however, they might accidentally work if reverse DNS lookups fail. When specifying wildcards in fully qualified domain names, dots (<code class="literal">.</code>) are not included in the wildcard. For example, <code class="literal">*.example.com</code> includes <code class="literal">one.example.com</code> but does not include <code class="literal">one.two.example.com</code>.
						</p></dd><dt><span class="term">IP networks</span></dt><dd><p class="simpara">
							Either of the following formats is valid:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									<span class="emphasis"><em><span class="replaceable"><code class="literal">a.b.c.d/z</code></span></em></span>, where <span class="emphasis"><em><span class="replaceable"><code class="literal">a.b.c.d</code></span></em></span> is the network and <span class="emphasis"><em><span class="replaceable"><code class="literal">z</code></span></em></span> is the number of bits in the netmask; for example <code class="literal">192.168.0.0/24</code>.
								</li><li class="listitem">
									<span class="emphasis"><em><span class="replaceable"><code class="literal">a.b.c.d/netmask</code></span></em></span>, where <span class="emphasis"><em><span class="replaceable"><code class="literal">a.b.c.d</code></span></em></span> is the network and <span class="emphasis"><em><span class="replaceable"><code class="literal">netmask</code></span></em></span> is the netmask; for example, <code class="literal">192.168.100.8/255.255.255.0</code>.
								</li></ul></div></dd><dt><span class="term">Netgroups</span></dt><dd>
							The <code class="literal">@<span class="emphasis"><em>group-name</em></span></code> format , where <span class="emphasis"><em><span class="replaceable"><code class="literal">group-name</code></span></em></span> is the NIS netgroup name.
						</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="nfs-server-configuration_exporting-nfs-shares"/>NFS server configuration</h1></div></div></div><p>
				This section describes the syntax and options of two ways to configure exports on an NFS server:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						Manually editing the <code class="literal">/etc/exports</code> configuration file
					</li><li class="listitem">
						Using the <code class="literal">exportfs</code> utility on the command line
					</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="the-etc-exports-configuration-file_exporting-nfs-shares"/>The /etc/exports configuration file</h2></div></div></div><p>
					The <code class="literal">/etc/exports</code> file controls which file systems are exported to remote hosts and specifies options. It follows the following syntax rules:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Blank lines are ignored.
						</li><li class="listitem">
							To add a comment, start a line with the hash mark (<code class="literal">#</code>).
						</li><li class="listitem">
							You can wrap long lines with a backslash (<code class="literal">\</code>).
						</li><li class="listitem">
							Each exported file system should be on its own individual line.
						</li><li class="listitem">
							Any lists of authorized hosts placed after an exported file system must be separated by space characters.
						</li><li class="listitem">
							Options for each of the hosts must be placed in parentheses directly after the host identifier, without any spaces separating the host and the first parenthesis.
						</li></ul></div><h4><a id="export_entry"/>Export entry</h4><p>
					Each entry for an exported file system has the following structure:
				</p><pre class="screen"><span class="emphasis"><em><span class="replaceable">export</span></em></span> <span class="emphasis"><em><span class="replaceable">host</span></em></span>(<span class="emphasis"><em><span class="replaceable">options</span></em></span>)</pre><p>
					It is also possible to specify multiple hosts, along with specific options for each host. To do so, list them on the same line as a space-delimited list, with each host name followed by its respective options (in parentheses), as in:
				</p><pre class="screen"><span class="emphasis"><em><span class="replaceable">export</span></em></span> <span class="emphasis"><em><span class="replaceable">host1</span></em></span>(<span class="emphasis"><em><span class="replaceable">options1</span></em></span>) <span class="emphasis"><em><span class="replaceable">host2</span></em></span>(<span class="emphasis"><em><span class="replaceable">options2</span></em></span>) <span class="emphasis"><em><span class="replaceable">host3</span></em></span>(<span class="emphasis"><em><span class="replaceable">options3</span></em></span>)</pre><p>
					In this structure:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="emphasis"><em><span class="replaceable">export</span></em></span></span></dt><dd>
								The directory being exported
							</dd><dt><span class="term"><span class="emphasis"><em><span class="replaceable">host</span></em></span></span></dt><dd>
								The host or network to which the export is being shared
							</dd><dt><span class="term"><span class="emphasis"><em><span class="replaceable">options</span></em></span></span></dt><dd>
								The options to be used for host
							</dd></dl></div><div class="example"><a id="idm139870592684128"/><p class="title"><strong>Example 3.1. A simple /etc/exports file</strong></p><div class="example-contents"><p>
						In its simplest form, the <code class="literal">/etc/exports</code> file only specifies the exported directory and the hosts permitted to access it:
					</p><pre class="screen">/exported/directory bob.example.com</pre><p>
						Here, <code class="literal">bob.example.com</code> can mount <code class="literal">/exported/directory/</code> from the NFS server. Because no options are specified in this example, NFS uses default options.
					</p></div></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						The format of the <code class="literal">/etc/exports</code> file is very precise, particularly in regards to use of the space character. Remember to always separate exported file systems from hosts and hosts from one another with a space character. However, there should be no other space characters in the file except on comment lines.
					</p><p>
						For example, the following two lines do not mean the same thing:
					</p><pre class="screen">/home bob.example.com(rw)
/home bob.example.com (rw)</pre><p>
						The first line allows only users from <code class="literal">bob.example.com</code> read and write access to the <code class="literal">/home</code> directory. The second line allows users from <code class="literal">bob.example.com</code> to mount the directory as read-only (the default), while the rest of the world can mount it read/write.
					</p></div><h4><a id="default_options"/>Default options</h4><p>
					The default options for an export entry are:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">ro</code></span></dt><dd>
								The exported file system is read-only. Remote hosts cannot change the data shared on the file system. To allow hosts to make changes to the file system (that is, read and write), specify the rw option.
							</dd><dt><span class="term"><code class="literal">sync</code></span></dt><dd>
								The NFS server will not reply to requests before changes made by previous requests are written to disk. To enable asynchronous writes instead, specify the option <code class="literal">async</code>.
							</dd><dt><span class="term"><code class="literal">wdelay</code></span></dt><dd>
								The NFS server will delay writing to the disk if it suspects another write request is imminent. This can improve performance as it reduces the number of times the disk must be accessed by separate write commands, thereby reducing write overhead. To disable this, specify the <code class="literal">no_wdelay</code> option, which is available only if the default sync option is also specified.
							</dd><dt><span class="term"><code class="literal">root_squash</code></span></dt><dd><p class="simpara">
								This prevents root users connected remotely (as opposed to locally) from having root privileges; instead, the NFS server assigns them the user ID <code class="literal">nfsnobody</code>. This effectively "squashes" the power of the remote root user to the lowest local user, preventing possible unauthorized writes on the remote server. To disable root squashing, specify the <code class="literal">no_root_squash</code> option.
							</p><p class="simpara">
								To squash every remote user (including root), use the <code class="literal">all_squash</code> option. To specify the user and group IDs that the NFS server should assign to remote users from a particular host, use the <code class="literal">anonuid</code> and <code class="literal">anongid</code> options, respectively, as in:
							</p><pre class="screen"><span class="emphasis"><em><span class="replaceable">export</span></em></span> <span class="emphasis"><em><span class="replaceable">host</span></em></span>(anonuid=<span class="emphasis"><em><span class="replaceable">uid</span></em></span>,anongid=<span class="emphasis"><em><span class="replaceable">gid</span></em></span>)</pre><p class="simpara">
								Here, <span class="emphasis"><em><span class="replaceable">uid</span></em></span> and <span class="emphasis"><em><span class="replaceable">gid</span></em></span> are user ID number and group ID number, respectively. The <code class="literal">anonuid</code> and <code class="literal">anongid</code> options enable you to create a special user and group account for remote NFS users to share.
							</p></dd></dl></div><p>
					By default, access control lists (ACLs) are supported by NFS under Red Hat Enterprise Linux. To disable this feature, specify the <code class="literal">no_acl</code> option when exporting the file system.
				</p><h4><a id="default_and_overridden_options"/>Default and overridden options</h4><p>
					Each default for every exported file system must be explicitly overridden. For example, if the <code class="literal">rw</code> option is not specified, then the exported file system is shared as read-only. The following is a sample line from <code class="literal">/etc/exports</code> which overrides two default options:
				</p><pre class="screen">/another/exported/directory 192.168.0.3(rw,async)</pre><p>
					In this example, <code class="literal">192.168.0.3</code> can mount <code class="literal">/another/exported/directory/</code> read and write, and all writes to disk are asynchronous.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="the-exportfs-utility_exporting-nfs-shares"/>The exportfs utility</h2></div></div></div><p>
					The <code class="literal">exportfs</code> utility enables the root user to selectively export or unexport directories without restarting the NFS service. When given the proper options, the <code class="literal">exportfs</code> utility writes the exported file systems to <code class="literal">/var/lib/nfs/xtab</code>. Because the <code class="literal">nfs-mountd</code> service refers to the <code class="literal">xtab</code> file when deciding access privileges to a file system, changes to the list of exported file systems take effect immediately.
				</p><h4><a id="common_exportfs_options"/>Common exportfs options</h4><p>
					The following is a list of commonly-used options available for <code class="literal">exportfs</code>:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">-r</code></span></dt><dd>
								Causes all directories listed in <code class="literal">/etc/exports</code> to be exported by constructing a new export list in <code class="literal">/etc/lib/nfs/xtab</code>. This option effectively refreshes the export list with any changes made to <code class="literal">/etc/exports</code>.
							</dd><dt><span class="term"><code class="literal">-a</code></span></dt><dd>
								Causes all directories to be exported or unexported, depending on what other options are passed to <code class="literal">exportfs</code>. If no other options are specified, <code class="literal">exportfs</code> exports all file systems specified in <code class="literal">/etc/exports</code>.
							</dd><dt><span class="term"><code class="literal">-o <span class="emphasis"><em><span class="replaceable">file-systems</span></em></span></code></span></dt><dd>
								Specifies directories to be exported that are not listed in <code class="literal">/etc/exports</code>. Replace <span class="emphasis"><em><span class="replaceable">file-systems</span></em></span> with additional file systems to be exported. These file systems must be formatted in the same way they are specified in <code class="literal">/etc/exports</code>. This option is often used to test an exported file system before adding it permanently to the list of exported file systems.
							</dd><dt><span class="term"><code class="literal">-i</code></span></dt><dd>
								Ignores <code class="literal">/etc/exports</code>; only options given from the command line are used to define exported file systems.
							</dd><dt><span class="term"><code class="literal">-u</code></span></dt><dd>
								Unexports all shared directories. The command <code class="literal">exportfs -ua</code> suspends NFS file sharing while keeping all NFS services up. To re-enable NFS sharing, use <code class="literal">exportfs -r</code>.
							</dd><dt><span class="term"><code class="literal">-v</code></span></dt><dd>
								Verbose operation, where the file systems being exported or unexported are displayed in greater detail when the <code class="literal">exportfs</code> command is executed.
							</dd></dl></div><p>
					If no options are passed to the <code class="literal">exportfs</code> utility, it displays a list of currently exported file systems.
				</p><h3><a id="additional_resources_6"/>Additional resources</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							For information on different methods for specifying host names, see <a class="xref" href="exporting-nfs-shares_managing-file-systems.html#nfs-host-name-formats_exporting-nfs-shares" title="NFS host name formats">the section called “NFS host name formats”</a>.
						</li><li class="listitem">
							For a complete list of export options, see the <code class="literal">exports(5)</code> man page.
						</li><li class="listitem">
							For more information about the <code class="literal">exportfs</code> utility, see the <code class="literal">exportfs(8)</code> man page.
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="nfs-and-rpcbind_exporting-nfs-shares"/>NFS and rpcbind</h1></div></div></div><p>
				This section explains the purpose of the <code class="literal">rpcbind</code> service, which is required by NFSv3.
			</p><p>
				The <code class="literal">rpcbind</code> service maps Remote Procedure Call (RPC) services to the ports on which they listen. RPC processes notify <code class="literal">rpcbind</code> when they start, registering the ports they are listening on and the RPC program numbers they expect to serve. The client system then contacts <code class="literal">rpcbind</code> on the server with a particular RPC program number. The <code class="literal">rpcbind</code> service redirects the client to the proper port number so it can communicate with the requested service.
			</p><p>
				Because RPC-based services rely on <code class="literal">rpcbind</code> to make all connections with incoming client requests, <code class="literal">rpcbind</code> must be available before any of these services start.
			</p><p>
				Access control rules for <code class="literal">rpcbind</code> affect all RPC-based services. Alternatively, it is possible to specify access control rules for each of the NFS RPC daemons.
			</p><h3><a id="additional_resources_7"/>Additional resources</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						For the precise syntax of access control rules, see the <code class="literal">rpc.mountd(8)</code> and <code class="literal">rpc.statd(8)</code> man pages.
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="installing-nfs_exporting-nfs-shares"/>Installing NFS</h1></div></div></div><p>
				This procedure installs all packages necessary to mount or export NFS shares.
			</p><h3><a id="procedure_4"/>Procedure</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
						Install the <code class="literal">nfs-utils</code> package:
					</p><pre class="screen"># yum install nfs-utils</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="starting-the-nfs-server_exporting-nfs-shares"/>Starting the NFS server</h1></div></div></div><p>
				This procedure describes how to start the NFS server, which is required to export NFS shares.
			</p><h3><a id="prerequisites"/>Prerequisites</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
						For servers that support NFSv2 or NFSv3 connections, the <code class="literal">rpcbind</code> service must be running. To verify that <code class="literal">rpcbind</code> is active, use the following command:
					</p><pre class="screen">$ systemctl status rpcbind</pre><p class="simpara">
						If the service is stopped, start and enable it:
					</p><pre class="screen">$ systemctl enable --now rpcbind</pre></li></ul></div><h3><a id="procedure_5"/>Procedure</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
						To start the NFS server and enable it to start automatically at boot, use the following command:
					</p><pre class="screen"># systemctl enable --now nfs-server</pre></li></ul></div><h3><a id="additional_resources_8"/>Additional resources</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						To configure an NFSv4-only server, which does not require <code class="literal">rpcbind</code>, see <a class="xref" href="exporting-nfs-shares_managing-file-systems.html#configuring-an-nfsv4-only-server_exporting-nfs-shares" title="Configuring an NFSv4-only server">the section called “Configuring an NFSv4-only server”</a>.
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="troubleshooting-nfs-and-rpcbind_exporting-nfs-shares"/>Troubleshooting NFS and rpcbind</h1></div></div></div><p>
				Because the <code class="literal">rpcbind</code> service provides coordination between RPC services and the port numbers used to communicate with them, it is useful to view the status of current RPC services using <code class="literal">rpcbind</code> when troubleshooting. The <code class="literal">rpcinfo</code> utility shows each RPC-based service with port numbers, an RPC program number, a version number, and an IP protocol type (TCP or UDP).
			</p><h3><a id="procedure_6"/>Procedure</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						To make sure the proper NFS RPC-based services are enabled for <code class="literal">rpcbind</code>, use the following command:
					</p><pre class="screen"># rpcinfo -p</pre><div class="example"><a id="idm139870535080784"/><p class="title"><strong>Example 3.2. rpcinfo -p command output</strong></p><div class="example-contents"><p>
							The following is sample output from this command:
						</p><pre class="screen">   program vers proto   port  service
    100000    4   tcp    111  portmapper
    100000    3   tcp    111  portmapper
    100000    2   tcp    111  portmapper
    100000    4   udp    111  portmapper
    100000    3   udp    111  portmapper
    100000    2   udp    111  portmapper
    100005    1   udp  20048  mountd
    100005    1   tcp  20048  mountd
    100005    2   udp  20048  mountd
    100005    2   tcp  20048  mountd
    100005    3   udp  20048  mountd
    100005    3   tcp  20048  mountd
    100024    1   udp  37769  status
    100024    1   tcp  49349  status
    100003    3   tcp   2049  nfs
    100003    4   tcp   2049  nfs
    100227    3   tcp   2049  nfs_acl
    100021    1   udp  56691  nlockmgr
    100021    3   udp  56691  nlockmgr
    100021    4   udp  56691  nlockmgr
    100021    1   tcp  46193  nlockmgr
    100021    3   tcp  46193  nlockmgr
    100021    4   tcp  46193  nlockmgr</pre></div></div><p class="simpara">
						If one of the NFS services does not start up correctly, <code class="literal">rpcbind</code> will be unable to map RPC requests from clients for that service to the correct port.
					</p></li><li class="listitem"><p class="simpara">
						In many cases, if NFS is not present in <code class="literal">rpcinfo</code> output, restarting NFS causes the service to correctly register with <code class="literal">rpcbind</code> and begin working:
					</p><pre class="screen"># systemctl restart nfs-server</pre></li></ol></div><h3><a id="additional_resources_9"/>Additional resources</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						For more information and a list of <code class="literal">rpcinfo</code> options, see the <code class="literal">rpcinfo(8)</code> man page.
					</li><li class="listitem">
						To configure an NFSv4-only server, which does not require <code class="literal">rpcbind</code>, see <a class="xref" href="exporting-nfs-shares_managing-file-systems.html#configuring-an-nfsv4-only-server_exporting-nfs-shares" title="Configuring an NFSv4-only server">the section called “Configuring an NFSv4-only server”</a>.
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring-the-nfs-server-to-run-behind-a-firewall_exporting-nfs-shares"/>Configuring the NFS server to run behind a firewall</h1></div></div></div><p>
				NFS requires the <code class="literal">rpcbind</code> service, which dynamically assigns ports for RPC services and can cause issues for configuring firewall rules. This procedure describes how to configure the NFS server to work behind a firewall.
			</p><h3><a id="procedure_7"/>Procedure</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						To allow clients to access NFS shares behind a firewall, set which ports the RPC services run on in the <code class="literal">[mountd]</code> section of the <code class="literal">/etc/nfs.conf</code> file:
					</p><pre class="screen">[mountd]

port=<span class="emphasis"><em><span class="replaceable">port-number</span></em></span></pre><p class="simpara">
						This adds the <code class="literal">-p <span class="emphasis"><em><span class="replaceable">port-number</span></em></span></code> option to the <code class="literal">rpc.mount</code> command line: <code class="literal">rpc.mount -p <span class="emphasis"><em><span class="replaceable">port-number</span></em></span></code>.
					</p></li><li class="listitem"><p class="simpara">
						To allow NFSv4.0 callbacks to pass through firewalls, set <code class="literal">/proc/sys/fs/nfs/nfs_callback_tcpport</code> and allow the server to connect to that port on the client.
					</p><p class="simpara">
						This step is not needed for NFSv4.1 or higher, and the other ports for <code class="literal">mountd</code>, <code class="literal">statd</code>, and <code class="literal">lockd</code> are not required in a pure NFSv4 environment.
					</p></li><li class="listitem">
						To specify the ports to be used by the RPC service <code class="literal">nlockmgr</code>, set the port number for the <code class="literal">nlm_tcpport</code> and <code class="literal">nlm_udpport</code> options in the <code class="literal">/etc/modprobe.d/lockd.conf</code> file.
					</li><li class="listitem"><p class="simpara">
						Restart the NFS server:
					</p><pre class="screen">#  systemctl restart nfs-server</pre><p class="simpara">
						If NFS fails to start, check <code class="literal">/var/log/messages</code>. Commonly, NFS fails to start if you specify a port number that is already in use.
					</p></li><li class="listitem"><p class="simpara">
						Confirm the changes have taken effect:
					</p><pre class="screen"># rpcinfo -p</pre></li></ol></div><h3><a id="additional_resources_10"/>Additional resources</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						To configure an NFSv4-only server, which does not require <code class="literal">rpcbind</code>, see <a class="xref" href="exporting-nfs-shares_managing-file-systems.html#configuring-an-nfsv4-only-server_exporting-nfs-shares" title="Configuring an NFSv4-only server">the section called “Configuring an NFSv4-only server”</a>.
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="exporting-rpc-quota-through-a-firewall_exporting-nfs-shares"/>Exporting RPC quota through a firewall</h1></div></div></div><p>
				If you export a file system that uses disk quotas, you can use the quota Remote Procedure Call (RPC) service to provide disk quota data to NFS clients.
			</p><h3><a id="procedure_8"/>Procedure</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						Enable and start the <code class="literal">rpc-rquotad</code> service:
					</p><pre class="screen"># systemctl enable --now rpc-rquotad</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							The <code class="literal">rpc-rquotad</code> service is, if enabled, started automatically after starting the nfs-server service.
						</p></div></li><li class="listitem"><p class="simpara">
						To make the quota RPC service accessible behind a firewall, the TCP (or UDP, if UDP is enabled) port 875 need to be open. The default port number is defined in the <code class="literal">/etc/services</code> file.
					</p><p class="simpara">
						You can override the default port number by appending <code class="literal">-p port-number</code> to the <code class="literal">RPCRQUOTADOPTS</code> variable in the <code class="literal">/etc/sysconfig/rpc-rquotad</code> file.
					</p></li><li class="listitem">
						By default, remote hosts can only read quotas. If you want to allow clients to set quotas, append the <code class="literal">-S</code> option to the <code class="literal">RPCRQUOTADOPTS</code> variable in the <code class="literal">/etc/sysconfig/rpc-rquotad</code> file.
					</li><li class="listitem"><p class="simpara">
						Restart <code class="literal">rpc-rquotad</code> for the changes in the <code class="literal">/etc/sysconfig/rpc-rquotad</code> file to take effect:
					</p><pre class="screen"># systemctl restart rpc-rquotad</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="enabling-nfs-over-rdma-nfsordma_exporting-nfs-shares"/>Enabling NFS over RDMA (NFSoRDMA)</h1></div></div></div><p>
				The remote direct memory access (RDMA) service works automatically in Red Hat Enterprise Linux 8 if there is RDMA-capable hardware present.
			</p><h3><a id="procedure_9"/>Procedure</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						Install the <code class="literal">rdma</code> and <code class="literal">rdma-core</code> packages:
					</p><pre class="screen"># yum install rdma rdma-core</pre></li><li class="listitem"><p class="simpara">
						To enable automatic loading of NFSoRDMA <span class="emphasis"><em>server</em></span> modules, add the <code class="literal">SVCRDMA_LOAD=yes</code> option on a new line in the <code class="literal">/etc/rdma/rdma.conf</code> configuration file.
					</p><p class="simpara">
						The <code class="literal">rdma=20049</code> option in the <code class="literal">[nfsd]</code> section of the <code class="literal">/etc/nfs.conf</code> file specifies the port number on which the NFSoRDMA service listens for clients. The RFC 5667 standard specifies that servers must listen on port <code class="literal">20049</code> when providing NFSv4 services over RDMA.
					</p><p class="simpara">
						The <code class="literal">/etc/rdma/rdma.conf</code> file contains a line that sets the <code class="literal">XPRTRDMA_LOAD=yes</code> option by default, which requests the <code class="literal">rdma</code> service to load the NFSoRDMA <span class="emphasis"><em>client</em></span> module.
					</p></li><li class="listitem"><p class="simpara">
						Restart the <code class="literal">nfs-server</code> service:
					</p><pre class="screen"># systemctl restart nfs-server</pre></li></ol></div><h3><a id="additional_resources_11"/>Additional resources</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						The RFC 5667 standard: <a class="link" href="https://tools.ietf.org/html/rfc5667">https://tools.ietf.org/html/rfc5667</a>.
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring-an-nfsv4-only-server_exporting-nfs-shares"/>Configuring an NFSv4-only server</h1></div></div></div><p>
				As an NFS server administrator, you can configure the NFS server to support only NFSv4, which minimizes the number of open ports and running services on the system.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="benefits-and-drawbacks-of-an-nfsv4-only-server_configuring-an-nfsv4-only-server"/>Benefits and drawbacks of an NFSv4-only server</h2></div></div></div><p>
					This section explains the benefits and drawbacks of configuring the NFS server to only support NFSv4.
				</p><p>
					By default, the NFS server supports NFSv2, NFSv3, and NFSv4 connections in Red Hat Enterprise Linux 8. However, you can also configure NFS to support only NFS version 4.0 and later. This minimizes the number of open ports and running services on the system, because NFSv4 does not require the <code class="literal">rpcbind</code> service to listen on the network.
				</p><p>
					When your NFS server is configured as NFSv4-only, clients attempting to mount shares using NFSv2 or NFSv3 fail with an error like the following:
				</p><pre class="screen">Requested NFS version or transport protocol is not supported.</pre><p>
					Optionally, you can also disable listening for the <code class="literal">RPCBIND</code>, <code class="literal">MOUNT</code>, and <code class="literal">NSM</code> protocol calls, which are not necessary in the NFSv4-only case.
				</p><p>
					The effects of disabling these additional options are:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Clients that attempt to mount shares from your server using NFSv2 or NFSv3 become unresponsive.
						</li><li class="listitem">
							The NFS server itself is unable to mount NFSv2 and NFSv3 file systems.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="nfs-and-rpcbind_configuring-an-nfsv4-only-server"/>NFS and rpcbind</h2></div></div></div><p>
					This section explains the purpose of the <code class="literal">rpcbind</code> service, which is required by NFSv3.
				</p><p>
					The <code class="literal">rpcbind</code> service maps Remote Procedure Call (RPC) services to the ports on which they listen. RPC processes notify <code class="literal">rpcbind</code> when they start, registering the ports they are listening on and the RPC program numbers they expect to serve. The client system then contacts <code class="literal">rpcbind</code> on the server with a particular RPC program number. The <code class="literal">rpcbind</code> service redirects the client to the proper port number so it can communicate with the requested service.
				</p><p>
					Because RPC-based services rely on <code class="literal">rpcbind</code> to make all connections with incoming client requests, <code class="literal">rpcbind</code> must be available before any of these services start.
				</p><p>
					Access control rules for <code class="literal">rpcbind</code> affect all RPC-based services. Alternatively, it is possible to specify access control rules for each of the NFS RPC daemons.
				</p><h4><a id="additional_resources_12"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							For the precise syntax of access control rules, see the <code class="literal">rpc.mountd(8)</code> and <code class="literal">rpc.statd(8)</code> man pages.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-the-nfs-server-to-support-only-nfsv4_configuring-an-nfsv4-only-server"/>Configuring the NFS server to support only NFSv4</h2></div></div></div><p>
					This procedure describes how to configure your NFS server to support only NFS version 4.0 and later.
				</p><h4><a id="procedure_10"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Disable NFSv2 and NFSv3 by adding the following lines to the <code class="literal">[nfsd]</code> section of the <code class="literal">/etc/nfs.conf</code> configuration file:
						</p><pre class="screen">[nfsd]

vers2=no
vers3=no</pre></li><li class="listitem"><p class="simpara">
							Optionally, disable listening for the <code class="literal">RPCBIND</code>, <code class="literal">MOUNT</code>, and <code class="literal">NSM</code> protocol calls, which are not necessary in the NFSv4-only case. Disable related services:
						</p><pre class="screen"># systemctl mask --now rpc-statd.service rpcbind.service rpcbind.socket</pre></li><li class="listitem"><p class="simpara">
							Restart the NFS server:
						</p><pre class="screen"># systemctl restart nfs-server</pre></li></ol></div><p>
					The changes take effect as soon as you start or restart the NFS server.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="verifying-the-nfsv4-only-configuration_configuring-an-nfsv4-only-server"/>Verifying the NFSv4-only configuration</h2></div></div></div><p>
					This procedure describes how to verify that your NFS server is configured in the NFSv4-only mode by using the <code class="literal">netstat</code> utility.
				</p><h4><a id="procedure_11"/>Procedure</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							Use the <code class="literal">netstat</code> utility to list services listening on the TCP and UDP protocols:
						</p><pre class="screen"># netstat --listening --tcp --udp</pre><div class="example"><a id="idm139870467981824"/><p class="title"><strong>Example 3.3. Output on an NFSv4-only server</strong></p><div class="example-contents"><p>
								The following is an example <code class="literal">netstat</code> output on an NFSv4-only server; listening for <code class="literal">RPCBIND</code>, <code class="literal">MOUNT</code>, and <code class="literal">NSM</code> is also disabled. Here, <code class="literal">nfs</code> is the only listening NFS service:
							</p><pre class="screen"># netstat --listening --tcp --udp

Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State
tcp        0      0 0.0.0.0:ssh             0.0.0.0:*               LISTEN
tcp        0      0 0.0.0.0:nfs             0.0.0.0:*               LISTEN
tcp6       0      0 [::]:ssh                [::]:*                  LISTEN
tcp6       0      0 [::]:nfs                [::]:*                  LISTEN
udp        0      0 localhost.locald:bootpc 0.0.0.0:*</pre></div></div><div class="example"><a id="idm139870576605664"/><p class="title"><strong>Example 3.4. Output before configuring an NFSv4-only server</strong></p><div class="example-contents"><p>
								In comparison, the <code class="literal">netstat</code> output before configuring an NFSv4-only server includes the <code class="literal">sunrpc</code> and <code class="literal">mountd</code> services:
							</p><pre class="screen"># netstat --listening --tcp --udp

Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address State
tcp        0      0 0.0.0.0:ssh             0.0.0.0:*       LISTEN
tcp        0      0 0.0.0.0:40189           0.0.0.0:*       LISTEN
tcp        0      0 0.0.0.0:46813           0.0.0.0:*       LISTEN
tcp        0      0 0.0.0.0:nfs             0.0.0.0:*       LISTEN
tcp        0      0 0.0.0.0:sunrpc          0.0.0.0:*       LISTEN
tcp        0      0 0.0.0.0:mountd          0.0.0.0:*       LISTEN
tcp6       0      0 [::]:ssh                [::]:*          LISTEN
tcp6       0      0 [::]:51227              [::]:*          LISTEN
tcp6       0      0 [::]:nfs                [::]:*          LISTEN
tcp6       0      0 [::]:sunrpc             [::]:*          LISTEN
tcp6       0      0 [::]:mountd             [::]:*          LISTEN
tcp6       0      0 [::]:45043              [::]:*          LISTEN
udp        0      0 localhost:1018          0.0.0.0:*
udp        0      0 localhost.locald:bootpc 0.0.0.0:*
udp        0      0 0.0.0.0:mountd          0.0.0.0:*
udp        0      0 0.0.0.0:46672           0.0.0.0:*
udp        0      0 0.0.0.0:sunrpc          0.0.0.0:*
udp        0      0 0.0.0.0:33494           0.0.0.0:*
udp6       0      0 [::]:33734              [::]:*
udp6       0      0 [::]:mountd             [::]:*
udp6       0      0 [::]:sunrpc             [::]:*
udp6       0      0 [::]:40243              [::]:*</pre></div></div></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="related-information-exporting-nfs-shares"/>Related information</h1></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						The Linux NFS wiki: <a class="link" href="https://linux-nfs.org">https://linux-nfs.org</a>
					</li></ul></div></div></div></body></html>