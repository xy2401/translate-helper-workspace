<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 12. Using and configuring firewalls</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="using-and-configuring-firewalls_configuring-and-managing-networking"/>Chapter 12. Using and configuring firewalls</h1></div></div></div><p>
			A <span class="emphasis"><em>firewall</em></span> is a way to protect machines from any unwanted traffic from outside. It enables users to control incoming network traffic on host machines by defining a set of <span class="emphasis"><em>firewall rules</em></span>. These rules are used to sort the incoming traffic and either block it or allow through.
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="getting-started-with-firewalld_using-and-configuring-firewalls"/>Getting started with <code class="literal">firewalld</code></h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="firewalld_getting-started-with-firewalld"/>firewalld</h2></div></div></div><p>
					<code class="literal">firewalld</code> is a firewall service daemon that provides a dynamic customizable host-based firewall with a <code class="literal">D-Bus</code> interface. Being dynamic, it enables creating, changing, and deleting the rules without the necessity to restart the firewall daemon each time the rules are changed.
				</p><p>
					<code class="literal">firewalld</code> uses the concepts of <span class="emphasis"><em>zones</em></span> and <span class="emphasis"><em>services</em></span>, that simplify the traffic management. Zones are predefined sets of rules. Network interfaces and sources can be assigned to a zone. The traffic allowed depends on the network your computer is connected to and the security level this network is assigned. Firewall services are predefined rules that cover all necessary settings to allow incoming traffic for a specific service and they apply within a zone.
				</p><p>
					Services use one or more <span class="emphasis"><em>ports</em></span> or <span class="emphasis"><em>addresses</em></span> for network communication. Firewalls filter communication based on ports. To allow network traffic for a service, its ports must be <span class="emphasis"><em>open</em></span>. <code class="literal">firewalld</code> blocks all traffic on ports that are not explicitly set as open. Some zones, such as <span class="emphasis"><em>trusted</em></span>, allow all traffic by default.
				</p><h4><a id="additional_resources_30"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">firewalld(1)</code> man page
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="firewalld-zones_getting-started-with-firewalld"/>Zones</h2></div></div></div><p>
					⁠<code class="literal">firewalld</code> can be used to separate networks into different zones according to the level of trust that the user has decided to place on the interfaces and traffic within that network. A connection can only be part of one zone, but a zone can be used for many network connections.
				</p><p>
					<code class="literal">NetworkManager</code> notifies <code class="literal">firewalld</code> of the zone of an interface. You can assign zones to interfaces with <code class="literal">NetworkManager</code>, with the <code class="literal">firewall-config</code> tool, or the <code class="literal">firewall-cmd</code> command-line tool. The latter two only edit the appropriate <code class="literal">NetworkManager</code> configuration files. If you change the zone of the interface using <code class="literal">firewall-cmd</code> or <code class="literal">firewall-config</code>, the request is forwarded to <code class="literal">NetworkManager</code> and is not handled by ⁠<code class="literal">firewalld</code>.
				</p><p>
					The predefined zones are stored in the <code class="literal">/usr/lib/firewalld/zones/</code> directory and can be instantly applied to any available network interface. These files are copied to the <code class="literal">/etc/firewalld/zones/</code> directory only after they are modified. The default settings of the predefined zones are as follows:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">block</code></span></dt><dd>
								Any incoming network connections are rejected with an icmp-host-prohibited message for <code class="literal">IPv4</code> and icmp6-adm-prohibited for <code class="literal">IPv6</code>. Only network connections initiated from within the system are possible.
							</dd><dt><span class="term"><code class="literal">dmz</code></span></dt><dd>
								For computers in your demilitarized zone that are publicly-accessible with limited access to your internal network. Only selected incoming connections are accepted.
							</dd><dt><span class="term"><code class="literal">drop</code></span></dt><dd>
								Any incoming network packets are dropped without any notification. Only outgoing network connections are possible.
							</dd><dt><span class="term"><code class="literal">external</code></span></dt><dd>
								For use on external networks with masquerading enabled, especially for routers. You do not trust the other computers on the network to not harm your computer. Only selected incoming connections are accepted.
							</dd><dt><span class="term"><code class="literal">home</code></span></dt><dd>
								For use at home when you mostly trust the other computers on the network. Only selected incoming connections are accepted.
							</dd><dt><span class="term"><code class="literal">internal</code></span></dt><dd>
								For use on internal networks when you mostly trust the other computers on the network. Only selected incoming connections are accepted.
							</dd><dt><span class="term"><code class="literal">public</code></span></dt><dd>
								For use in public areas where you do not trust other computers on the network. Only selected incoming connections are accepted.
							</dd><dt><span class="term"><code class="literal">trusted</code></span></dt><dd>
								All network connections are accepted.
							</dd><dt><span class="term"><code class="literal">work</code></span></dt><dd>
								For use at work where you mostly trust the other computers on the network. Only selected incoming connections are accepted.
							</dd></dl></div><p>
					One of these zones is set as the <span class="emphasis"><em>default</em></span> zone. When interface connections are added to <code class="literal">NetworkManager</code>, they are assigned to the default zone. On installation, the default zone in <code class="literal">firewalld</code> is set to be the <code class="literal">public</code> zone. The default zone can be changed.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The network zone names have been chosen to be self-explanatory and to allow users to quickly make a reasonable decision. To avoid any security problems, review the default zone configuration and disable any unnecessary services according to your needs and risk assessments.
					</p></div><h4><a id="additional_resources_31"/>Additional resources</h4><p>
					` <code class="literal">firewalld.zone(5)</code> man page
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="predefined-services_getting-started-with-firewalld"/>Predefined services</h2></div></div></div><p>
					A service can be a list of local ports, protocols, source ports, and destinations, as well as a list of firewall helper modules automatically loaded if a service is enabled. Using services saves users time because they can achieve several tasks, such as opening ports, defining protocols, enabling packet forwarding and more, in a single step, rather than setting up everything one after another.
				</p><p>
					Service configuration options and generic file information are described in the <code class="literal">firewalld.service(5)</code> man page. The services are specified by means of individual XML configuration files, which are named in the following format: <code class="literal"><span class="emphasis"><em>service-name</em></span>.xml</code>. Protocol names are preferred over service or application names in <code class="literal">firewalld</code>.
				</p><p>
					Services can be added and removed using the graphical <code class="literal">firewall-config</code> tool, <code class="literal">firewall-cmd</code>, and <code class="literal">firewall-offline-cmd</code>.
				</p><p>
					Alternatively, you can edit the XML files in the <code class="literal">/etc/firewalld/services/</code> directory. If a service is not added or changed by the user, then no corresponding XML file is found in <code class="literal">/etc/firewalld/services/</code>. The files in the <code class="literal">/usr/lib/firewalld/services/</code> directory can be used as templates if you want to add or change a service.
				</p><h4><a id="additional_resources_32"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">firewalld.service(5)</code> man page
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="installing-the-firewall-config-gui-configuration-tool_using-and-configuring-firewalls"/>Installing the <code class="literal">firewall-config</code> GUI configuration tool</h1></div></div></div><p>
				To use the <code class="literal">firewall-config</code> GUI configuration tool, install the <code class="literal">firewall-config</code> package.
			</p><h3><a id="procedure_44"/>Procedure</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						Enter the following command as <code class="literal">root</code>:
					</p><pre class="screen"># yum install firewall-config</pre><p class="simpara">
						Alternatively, in <code class="literal">GNOME, use the <span class="keycap"><strong>Super</strong></span> key and type `Software</code> to launch the <code class="literal">Software Sources</code> application. Type <code class="literal">firewall</code> to the search box, which appears after selecting the search button in the top-right corner. Select the <code class="literal">Firewall</code> item from the search results, and click on the <span class="guibutton">Install</span> button.
					</p></li><li class="listitem">
						To run <code class="literal">firewall-config</code>, use either the <code class="literal">firewall-config</code> command or press the <span class="keycap"><strong>Super</strong></span> key to enter the <code class="literal">Activities Overview</code>, type <code class="literal">firewall</code>, and press <span class="keycap"><strong>Enter</strong></span>.
					</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="viewing-the-current-status-and-settings-of-firewalld_using-and-configuring-firewalls"/>Viewing the current status and settings of <code class="literal">firewalld</code></h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="viewing-the-current-status-of-firewalld_viewing-the-current-status-and-settings-of-firewalld"/>Viewing the current status of <code class="literal">firewalld</code></h2></div></div></div><p>
					The firewall service, <code class="literal">firewalld</code>, is installed on the system by default. Use the <code class="literal">firewalld</code> CLI interface to check that the service is running.
				</p><h4><a id="procedure_45"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							To see the status of the service:
						</p><pre class="screen"># firewall-cmd --state</pre></li><li class="listitem"><p class="simpara">
							For more information about the service status, use the <code class="literal">systemctl status</code> sub-command:
						</p><pre class="screen"># systemctl status firewalld
firewalld.service - firewalld - dynamic firewall daemon
   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled; vendor pr
   Active: active (running) since Mon 2017-12-18 16:05:15 CET; 50min ago
     Docs: man:firewalld(1)
 Main PID: 705 (firewalld)
    Tasks: 2 (limit: 4915)
   CGroup: /system.slice/firewalld.service
           └─705 /usr/bin/python3 -Es /usr/sbin/firewalld --nofork --nopid</pre></li></ol></div><h4><a id="additional_resources_33"/>Additional resources</h4><p>
					It is important to know how <code class="literal">firewalld</code> is set up and which rules are in force before you try to edit the settings. To display the firewall settings, see <a class="xref" href="using-and-configuring-firewalls_configuring-and-managing-networking.html#viewing-current-firewalld-settings_viewing-the-current-status-and-settings-of-firewalld" title="Viewing current firewalld settings">the section called “Viewing current firewalld settings”</a>
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="viewing-current-firewalld-settings_viewing-the-current-status-and-settings-of-firewalld"/>Viewing current firewalld settings</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="viewing-allowed-services-using-GUI_viewing-the-current-status-and-settings-of-firewalld"/>Viewing allowed services using GUI</h3></div></div></div><p>
						To view the list of services using the graphical <span class="strong"><strong><span class="application">firewall-config</span></strong></span> tool, press the <span class="keycap"><strong>Super</strong></span> key to enter the Activities Overview, type <code class="literal">firewall</code>, and press <span class="keycap"><strong>Enter</strong></span>. The <span class="strong"><strong><span class="application">firewall-config</span></strong></span> tool appears. You can now view the list of services under the <code class="literal">Services</code> tab.
					</p><p>
						Alternatively, to start the graphical firewall configuration tool using the command-line, enter the following command:
					</p><pre class="screen">$ <code class="literal">firewall-config</code></pre><p>
						The <code class="literal">Firewall Configuration</code> window opens. Note that this command can be run as a normal user, but you are prompted for an administrator password occasionally.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="viewing-firewalld-settings-using-CLI_viewing-the-current-status-and-settings-of-firewalld"/>Viewing <code class="literal">firewalld</code> settings using CLI</h3></div></div></div><p>
						With the CLI client, it is possible to get different views of the current firewall settings. The <code class="literal">--list-all</code> option shows a complete overview of the <code class="literal">firewalld</code> settings.
					</p><p>
						<code class="literal">firewalld</code> uses zones to manage the traffic. If a zone is not specified by the <code class="literal">--zone</code> option, the command is effective in the default zone assigned to the active network interface and connection.
					</p><p>
						To list all the relevant information for the default zone:
					</p><pre class="screen"># firewall-cmd --list-all
public
  target: default
  icmp-block-inversion: no
  interfaces:
  sources:
  services: ssh dhcpv6-client
  ports:
  protocols:
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:</pre><p>
						To specify the zone for which to display the settings, add the <code class="literal">--zone=<span class="emphasis"><em>zone-name</em></span></code> argument to the <code class="literal">firewall-cmd --list-all</code> command, for example:
					</p><pre class="screen"># firewall-cmd --list-all --zone=home
home
  target: default
  icmp-block-inversion: no
  interfaces:
  sources:
  services: ssh mdns samba-client dhcpv6-client
... [trimmed for clarity]</pre><p>
						To see the settings for particular information, such as services or ports, use a specific option. See the <code class="literal">firewalld</code> manual pages or get a list of the options using the command help:
					</p><pre class="screen"># firewall-cmd --help

Usage: firewall-cmd [OPTIONS...]

General Options
  -h, --help           Prints a short help text and exists
  -V, --version        Print the version string of firewalld
  -q, --quiet          Do not print status messages

Status Options
  --state              Return and print firewalld state
  --reload             Reload firewall and keep state information
... [trimmed for clarity]</pre><p>
						For example, to see which services are allowed in the current zone:
					</p><pre class="screen"># firewall-cmd --list-services
ssh dhcpv6-client</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							Listing the settings for a certain subpart using the CLI tool can sometimes be difficult to interpret. For example, you allow the <code class="literal">SSH</code> service and <code class="literal">firewalld</code> opens the necessary port (22) for the service. Later, if you list the allowed services, the list shows the <code class="literal">SSH</code> service, but if you list open ports, it does not show any. Therefore, it is recommended to use the <code class="literal">--list-all</code> option to make sure you receive a complete information.
						</p></div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="starting-firewalld_using-and-configuring-firewalls"/>Starting firewalld</h1></div></div></div><h3><a id="procedure_46"/>Procedure</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						To start <code class="literal">firewalld</code>, enter the following command as <code class="literal">root</code>:
					</p><pre class="screen"># systemctl unmask firewalld
# systemctl start firewalld</pre></li><li class="listitem"><p class="simpara">
						To ensure <code class="literal">firewalld</code> starts automatically at system start, enter the following command as <code class="literal">root</code>:
					</p><pre class="screen"># systemctl enable firewalld</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="stopping-firewalld_using-and-configuring-firewalls"/>Stopping firewalld</h1></div></div></div><h3><a id="procedure_47"/>Procedure</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						To stop <code class="literal">firewalld</code>, enter the following command as <code class="literal">root</code>:
					</p><pre class="screen"># systemctl stop firewalld</pre></li><li class="listitem"><p class="simpara">
						To prevent <code class="literal">firewalld</code> from starting automatically at system start:
					</p><pre class="screen"># systemctl disable firewalld</pre></li><li class="listitem"><p class="simpara">
						To make sure firewalld is not started by accessing the <code class="literal">firewalld</code> <code class="literal">D-Bus</code> interface and also if other services require <code class="literal">firewalld</code>:
					</p><pre class="screen"># systemctl mask firewalld</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="runtime-and-permanent-settings_using-and-configuring-firewalls"/>Runtime and permanent settings</h1></div></div></div><p>
				Any changes committed in <span class="emphasis"><em>runtime</em></span> mode only apply while <code class="literal">firewalld</code> is running. When <code class="literal">firewalld</code> is restarted, the settings revert to their <span class="emphasis"><em>permanent</em></span> values.
			</p><p>
				To make the changes persistent across reboots, apply them again using the <code class="literal">--permanent</code> option. Alternatively, to make changes persistent while <code class="literal">firewalld</code> is running, use the <code class="literal">--runtime-to-permanent</code> <code class="literal">firewall-cmd</code> option.
			</p><p>
				If you set the rules while <code class="literal">firewalld</code> is running using only the <code class="literal">--permanent</code> option, they do not become effective before <code class="literal">firewalld</code> is restarted. However, restarting <code class="literal">firewalld</code> closes all open ports and stops the networking traffic.
			</p><div class="title"><strong>Modifying settings in runtime and permanent configuration using CLI</strong></div><p>
					Using the CLI, you do not modify the firewall settings in both modes at the same time. You only modify either runtime or permanent mode. To modify the firewall settings in the permanent mode, use the <code class="literal">--permanent</code> option with the <code class="literal">firewall-cmd</code> command.
				</p><pre class="screen"># firewall-cmd --permanent &lt;other options&gt;</pre><p>
				Without this option, the command modifies runtime mode.
			</p><p>
				To change settings in both modes, you can use two methods:
			</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						Change runtime settings and then make them permanent as follows:
					</p><pre class="screen"># firewall-cmd &lt;other options&gt;
# firewall-cmd --runtime-to-permanent</pre></li><li class="listitem"><p class="simpara">
						Set permanent settings and reload the settings into runtime mode:
					</p><pre class="screen"># firewall-cmd --permanent &lt;other options&gt;
# firewall-cmd --reload</pre></li></ol></div><p>
				The first method allows you to test the settings before you apply them to the permanent mode.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					It is possible, especially on remote systems, that an incorrect setting results in a user locking themselves out of a machine. To prevent such situations, use the <code class="literal">--timeout</code> option. After a specified amount of time, any change reverts to its previous state. Using this options excludes the <code class="literal">--permanent</code> option.
				</p><p>
					For example, to add the <code class="literal">SSH</code> service for 15 minutes:
				</p><pre class="screen"># firewall-cmd --add-service=ssh --timeout 15m</pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="controlling-network-traffic-using-firewalld_using-and-configuring-firewalls"/>Controlling network traffic using <code class="literal">firewalld</code></h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="disabling-all-traffic-in-case-of-emergency-using-cli_controlling-network-traffic-using-firewalld"/>Disabling all traffic in case of emergency using CLI</h2></div></div></div><p>
					In an emergency situation, such as a system attack, it is possible to disable all network traffic and cut off the attacker.
				</p><h4><a id="procedure_48"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							To immediately disable networking traffic, switch panic mode on:
						</p><pre class="screen"># firewall-cmd --panic-on</pre></li></ol></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						Enabling panic mode stops all networking traffic. From this reason, it should be used only when you have the physical access to the machine or if you are logged in using a serial console.
					</p></div><p>
					Switching off panic mode reverts the firewall to its permanent settings. To switch panic mode off:
				</p><pre class="screen"># firewall-cmd --panic-off</pre><p>
					To see whether panic mode is switched on or off, use:
				</p><pre class="screen"># firewall-cmd --query-panic</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="controlling-traffic-with-predefined-services-using-cli_controlling-network-traffic-using-firewalld"/>Controlling traffic with predefined services using CLI</h2></div></div></div><p>
					The most straightforward method to control traffic is to add a predefined service to <code class="literal">firewalld</code>. This opens all necessary ports and modifies other settings according to the <span class="emphasis"><em>service definition file</em></span>.
				</p><h4><a id="procedure_49"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Check that the service is not already allowed:
						</p><pre class="screen"># firewall-cmd --list-services
ssh dhcpv6-client</pre></li><li class="listitem"><p class="simpara">
							List all predefined services:
						</p><pre class="screen"># firewall-cmd --get-services
RH-Satellite-6 amanda-client amanda-k5-client bacula bacula-client bitcoin bitcoin-rpc bitcoin-testnet bitcoin-testnet-rpc ceph ceph-mon cfengine condor-collector ctdb dhcp dhcpv6 dhcpv6-client dns docker-registry ...
[trimmed for clarity]</pre></li><li class="listitem"><p class="simpara">
							Add the service to the allowed services:
						</p><pre class="screen"># firewall-cmd --add-service=&lt;service-name&gt;</pre></li><li class="listitem"><p class="simpara">
							Make the new settings persistent:
						</p><pre class="screen"># firewall-cmd --runtime-to-permanent</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="controlling-traffic-with-predefined-services-using-gui_controlling-network-traffic-using-firewalld"/>Controlling traffic with predefined services using GUI</h2></div></div></div><p>
					To enable or disable a predefined or custom service:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Start the <span class="strong"><strong><span class="application">firewall-config</span></strong></span> tool and select the network zone whose services are to be configured.
						</li><li class="listitem">
							Select the <code class="literal">Services</code> tab.
						</li><li class="listitem">
							Select the check box for each type of service you want to trust or clear the check box to block a service.
						</li></ol></div><p>
					To edit a service:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Start the <span class="strong"><strong><span class="application">firewall-config</span></strong></span> tool.
						</li><li class="listitem">
							Select <code class="literal">Permanent</code> from the menu labeled <code class="literal">Configuration</code>. Additional icons and menu buttons appear at the bottom of the <span class="guibutton">Services</span> window.
						</li><li class="listitem">
							Select the service you want to configure.
						</li></ol></div><p>
					The <code class="literal">Ports</code>, <code class="literal">Protocols</code>, and <code class="literal">Source Port</code> tabs enable adding, changing, and removing of ports, protocols, and source port for the selected service. The modules tab is for configuring <span class="strong"><strong><span class="application">Netfilter</span></strong></span> helper modules. The <code class="literal">Destination</code> tab enables limiting traffic to a particular destination address and Internet Protocol (<code class="literal">IPv4</code> or <code class="literal">IPv6</code>).
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						It is not possible to alter service settings in <code class="literal">Runtime</code> mode.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="adding-new-services_controlling-network-traffic-using-firewalld"/>Adding new services</h2></div></div></div><p>
					Services can be added and removed using the graphical <span class="strong"><strong><span class="application">firewall-config</span></strong></span> tool, <code class="literal">firewall-cmd</code>, and <code class="literal">firewall-offline-cmd</code>. Alternatively, you can edit the XML files in <code class="literal">/etc/firewalld/services/</code>. If a service is not added or changed by the user, then no corresponding XML file are found in <code class="literal">/etc/firewalld/services/</code>. The files <code class="literal">/usr/lib/firewalld/services/</code> can be used as templates if you want to add or change a service.
				</p><h4><a id="procedure_50"/>Procedure</h4><p>
					To add a new service in a terminal, use <code class="literal">firewall-cmd</code>, or <code class="literal">firewall-offline-cmd</code> in case of not active <code class="literal">firewalld</code>.
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Enter the following command to add a new and empty service:
						</p><pre class="screen">$ <code class="literal">firewall-cmd --new-service=<span class="emphasis"><em>service-name</em></span></code></pre></li><li class="listitem"><p class="simpara">
							To add a new service using a local file, use the following command:
						</p><pre class="screen">$ <code class="literal">firewall-cmd --new-service-from-file=<span class="emphasis"><em>service-name</em></span>.xml</code></pre><p class="simpara">
							You can change the service name with the additional <code class="literal">--name=<span class="emphasis"><em>service-name</em></span></code> option.
						</p></li><li class="listitem"><p class="simpara">
							As soon as service settings are changed, an updated copy of the service is placed into <code class="literal">/etc/firewalld/services/</code>.
						</p><p class="simpara">
							As <code class="literal">root</code>, you can enter the following command to copy a service manually:
						</p><pre class="screen"># cp /usr/lib/firewalld/services/service-name.xml /etc/firewalld/services/service-name.xml</pre></li></ol></div><p>
					<code class="literal">firewalld</code> loads files from <code class="literal">/usr/lib/firewalld/services</code> in the first place. If files are placed in <code class="literal">/etc/firewalld/services</code> and they are valid, then these will override the matching files from <code class="literal">/usr/lib/firewalld/services</code>. The overriden files in <code class="literal">/usr/lib/firewalld/services</code> are used as soon as the matching files in <code class="literal">/etc/firewalld/services</code> have been removed or if <code class="literal">firewalld</code> has been asked to load the defaults of the services. This applies to the permanent environment only. A reload is needed to get these fallbacks also in the runtime environment.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="controlling-ports-using-cli_controlling-network-traffic-using-firewalld"/>Controlling ports using CLI</h2></div></div></div><p>
					Ports are logical devices that enable an operating system to receive and distinguish network traffic and forward it accordingly to system services. These are usually represented by a daemon that listens on the port, that is it waits for any traffic coming to this port.
				</p><p>
					Normally, system services listen on standard ports that are reserved for them. The <code class="literal">httpd</code> daemon, for example, listens on port 80. However, system administrators by default configure daemons to listen on different ports to enhance security or for other reasons.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="opening-a-port_controlling-ports-using-cli"/>Opening a port</h3></div></div></div><p>
						Through open ports, the system is accessible from the outside, which represents a security risk. Generally, keep ports closed and only open them if they are required for certain services.
					</p><h5><a id="procedure_51"/>Procedure</h5><p>
						To get a list of open ports in the current zone:
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								List all allowed ports:
							</p><pre class="screen"># firewall-cmd --list-ports</pre></li><li class="listitem"><p class="simpara">
								Add a port to the allowed ports to open it for incoming traffic:
							</p><pre class="screen"># firewall-cmd --add-port=port-number/port-type</pre></li><li class="listitem"><p class="simpara">
								Make the new settings persistent:
							</p><pre class="screen"># firewall-cmd --runtime-to-permanent</pre></li></ol></div><p>
						The port types are either <code class="literal">tcp</code>, <code class="literal">udp</code>, <code class="literal">sctp</code>, or <code class="literal">dccp</code>. The type must match the type of network communication.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="closing-a-port_controlling-ports-using-cli"/>Closing a port</h3></div></div></div><p>
						When an open port is no longer needed, close that port in <code class="literal">firewalld</code>. It is highly recommended to close all unnecessary ports as soon as they are not used because leaving a port open represents a security risk.
					</p><h5><a id="procedure_52"/>Procedure</h5><p>
						To close a port, remove it from the list of allowed ports:
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								List all allowed ports:
							</p><pre class="screen"># firewall-cmd --list-ports
[WARNING]
====
This command will only give you a list of ports that have been opened as ports. You will not be able to see any open ports that have been opened as a service. Therefore, you should consider using the --list-all option instead of --list-ports.
====</pre></li><li class="listitem"><p class="simpara">
								Remove the port from the allowed ports to close it for the incoming traffic:
							</p><pre class="screen"># firewall-cmd --remove-port=port-number/port-type</pre></li><li class="listitem"><p class="simpara">
								Make the new settings persistent:
							</p><pre class="screen"># firewall-cmd --runtime-to-permanent</pre></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sec-Opening_Ports_using_GUI_controlling-network-traffic-using-firewalld"/>Opening ports using GUI</h2></div></div></div><p>
					To permit traffic through the firewall to a certain port:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Start the <span class="strong"><strong><span class="application">firewall-config</span></strong></span> tool and select the network zone whose settings you want to change.
						</li><li class="listitem">
							Select the <code class="literal">Ports</code> tab and click the <span class="guibutton">Add</span> button on the right-hand side. The <code class="literal">Port and Protocol</code> window opens.
						</li><li class="listitem">
							Enter the port number or range of ports to permit.
						</li><li class="listitem">
							Select <code class="literal">tcp</code> or <code class="literal">udp</code> from the list.
						</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sec-Controlling_Traffic_with_Protocols_using_GUI_controlling-network-traffic-using-firewalld"/>Controlling traffic with protocols using GUI</h2></div></div></div><p>
					To permit traffic through the firewall using a certain protocol:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Start the <span class="strong"><strong><span class="application">firewall-config</span></strong></span> tool and select the network zone whose settings you want to change.
						</li><li class="listitem">
							Select the <code class="literal">Protocols</code> tab and click the <code class="literal">Add</code> button on the right-hand side. The <code class="literal">Protocol</code> window opens.
						</li><li class="listitem">
							Either select a protocol from the list or select the <code class="literal">Other Protocol</code> check box and enter the protocol in the field.
						</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sec-Opening_Source_Ports_using_GUI_controlling-network-traffic-using-firewalld"/>Opening source ports using GUI</h2></div></div></div><p>
					To permit traffic through the firewall from a certain port:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Start the firewall-config tool and select the network zone whose settings you want to change.
						</li><li class="listitem">
							Select the <code class="literal">Source Port</code> tab and click the <code class="literal">Add</code> button on the right-hand side. The <code class="literal">Source Port</code> window opens.
						</li><li class="listitem">
							Enter the port number or range of ports to permit. Select <code class="literal">tcp</code> or <code class="literal">udp</code> from the list.
						</li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="working-with-firewalld-zones_using-and-configuring-firewalls"/>Working with firewalld zones</h1></div></div></div><p>
				Zones represent a concept to manage incoming traffic more transparently. The zones are connected to networking interfaces or assigned a range of source addresses. You manage firewall rules for each zone independently, which enables you to define complex firewall settings and apply them to the traffic.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="listing-zones_working-with-firewalld-zones"/>Listing zones</h2></div></div></div><h4><a id="procedure_53"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							To see which zones are available on your system:
						</p><pre class="screen"># firewall-cmd --get-zones</pre><p class="simpara">
							The <code class="literal">firewall-cmd --get-zones</code> command displays all zones that are available on the system, but it does not show any details for particular zones.
						</p></li><li class="listitem"><p class="simpara">
							To see detailed information for all zones:
						</p><pre class="screen"># firewall-cmd --list-all-zones</pre></li><li class="listitem"><p class="simpara">
							To see detailed information for a specific zone:
						</p><pre class="screen"># firewall-cmd --zone=zone-name --list-all</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="modifying-firewalld-settings-for-a-certain-zone_working-with-firewalld-zones"/>Modifying firewalld settings for a certain zone</h2></div></div></div><p>
					The <a class="xref" href="using-and-configuring-firewalls_configuring-and-managing-networking.html#controlling-traffic-with-predefined-services-using-cli_controlling-network-traffic-using-firewalld" title="Controlling traffic with predefined services using CLI">the section called “Controlling traffic with predefined services using CLI”</a> and <a class="xref" href="using-and-configuring-firewalls_configuring-and-managing-networking.html#controlling-ports-using-cli_controlling-network-traffic-using-firewalld" title="Controlling ports using CLI">the section called “Controlling ports using CLI”</a> explain how to add services or modify ports in the scope of the current working zone. Sometimes, it is required to set up rules in a different zone.
				</p><h4><a id="procedure_54"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							To work in a different zone, use the <code class="literal">--zone=<span class="emphasis"><em>zone-name</em></span></code> option. For example, to allow the <code class="literal">SSH</code> service in the zone <span class="emphasis"><em>public</em></span>:
						</li></ol></div><pre class="screen"># firewall-cmd --add-service=ssh --zone=public</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="changing-the-default-zone_working-with-firewalld-zones"/>Changing the default zone</h2></div></div></div><p>
					System administrators assign a zone to a networking interface in its configuration files. If an interface is not assigned to a specific zone, it is assigned to the default zone. After each restart of the <code class="literal">firewalld</code> service, <code class="literal">firewalld</code> loads the settings for the default zone and makes it active.
				</p><h4><a id="procedure_55"/>Procedure</h4><p>
					To set up the default zone:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Display the current default zone:
						</p><pre class="screen"># firewall-cmd --get-default-zone</pre></li><li class="listitem"><p class="simpara">
							Set the new default zone:
						</p><pre class="screen"># firewall-cmd --set-default-zone zone-name</pre></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						Following this procedure, the setting is a permanent setting, even without the <code class="literal">--permanent</code> option.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assigning-a-network-interface-to-a-zone_working-with-firewalld-zones"/>Assigning a network interface to a zone</h2></div></div></div><p>
					It is possible to define different sets of rules for different zones and then change the settings quickly by changing the zone for the interface that is being used. With multiple interfaces, a specific zone can be set for each of them to distinguish traffic that is coming through them.
				</p><h4><a id="procedure_56"/>Procedure</h4><p>
					To assign the zone to a specific interface:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							List the active zones and the interfaces assigned to them:
						</p><pre class="screen"># firewall-cmd --get-active-zones</pre></li><li class="listitem"><p class="simpara">
							Assign the interface to a different zone:
						</p><pre class="screen"># firewall-cmd --zone=zone-name --change-interface=&lt;interface-name&gt;</pre></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						You do not have to use the <code class="literal">--permanent</code> option to make the setting persistent across restarts. If you set a new default zone, the setting becomes permanent.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assigning-a-default-zone-to-a-network-connection_working-with-firewalld-zones"/>Assigning a default zone to a network connection</h2></div></div></div><p>
					When the connection is managed by <span class="strong"><strong><span class="application">NetworkManager</span></strong></span>, it must be aware of a zone that it uses. For every network connection, a zone can be specified, which provides the flexibility of various firewall settings according to the location of the computer with portable devices. Thus, zones and settings can be specified for different locations, such as company or home.
				</p><h4><a id="procedure_57"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							To set a default zone for an Internet connection, use either the <span class="strong"><strong><span class="application">NetworkManager</span></strong></span> GUI or edit the <code class="literal">/etc/sysconfig/network-scripts/ifcfg-<span class="emphasis"><em>connection-name</em></span></code> file and add a line that assigns a zone to this connection:
						</p><pre class="screen">ZONE=<span class="emphasis"><em>zone-name</em></span></pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-a-new-zone_working-with-firewalld-zones"/>Creating a new zone</h2></div></div></div><p>
					To use custom zones, create a new zone and use it just like a predefined zone. New zones require the <code class="literal">--permanent</code> option, otherwise the command does not work.
				</p><h4><a id="procedure_58"/>Procedure</h4><p>
					To create a new zone:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Create a new zone:
						</p><pre class="screen"># firewall-cmd --new-zone=zone-name</pre></li><li class="listitem"><p class="simpara">
							Check if the new zone is added to your permanent settings:
						</p><pre class="screen"># firewall-cmd --get-zones</pre></li><li class="listitem"><p class="simpara">
							Make the new settings persistent:
						</p><pre class="screen"># firewall-cmd --runtime-to-permanent</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="zone-configuration-files_working-with-firewalld-zones"/>Zone configuration files</h2></div></div></div><p>
					Zones can also be created using a <span class="emphasis"><em>zone configuration file</em></span>. This approach can be helpful when you need to create a new zone, but want to reuse the settings from a different zone and only alter them a little.
				</p><p>
					A <code class="literal">firewalld</code> zone configuration file contains the information for a zone. These are the zone description, services, ports, protocols, icmp-blocks, masquerade, forward-ports and rich language rules in an XML file format. The file name has to be <code class="literal"><span class="emphasis"><em>zone-name</em></span>.xml</code> where the length of <span class="emphasis"><em>zone-name</em></span> is currently limited to 17 chars. The zone configuration files are located in the <code class="literal">/usr/lib/firewalld/zones/</code> and <code class="literal">/etc/firewalld/zones/</code> directories.
				</p><p>
					The following example shows a configuration that allows one service (<code class="literal">SSH</code>) and one port range, for both the <code class="literal">TCP</code> and <code class="literal">UDP</code> protocols:
				</p><pre class="screen">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;zone&gt;
  &lt;short&gt;My zone&lt;/short&gt;
  &lt;description&gt;Here you can describe the characteristic features of the zone.&lt;/description&gt;
  &lt;service name="ssh"/&gt;
  &lt;port port="1025-65535" protocol="tcp"/&gt;
  &lt;port port="1025-65535" protocol="udp"/&gt;
&lt;/zone&gt;</pre><p>
					To change settings for that zone, add or remove sections to add ports, forward ports, services, and so on.
				</p><h4><a id="additional_resources_34"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							For more information, see the <code class="literal">firewalld.zone</code> manual pages.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="using-zone-targets-to-set-default-behavior-for-incoming-traffic_working-with-firewalld-zones"/>Using zone targets to set default behavior for incoming traffic</h2></div></div></div><p>
					For every zone, you can set a default behavior that handles incoming traffic that is not further specified. Such behaviour is defined by setting the target of the zone. There are three options - <code class="literal">default</code>, <code class="literal">ACCEPT</code>, <code class="literal">REJECT</code>, and <code class="literal">DROP</code>. By setting the target to <code class="literal">ACCEPT</code>, you accept all incoming packets except those disabled by a specific rule. If you set the target to <code class="literal">REJECT</code> or <code class="literal">DROP</code>, you disable all incoming packets except those that you have allowed in specific rules. When packets are rejected, the source machine is informed about the rejection, while there is no information sent when the packets are dropped.
				</p><h4><a id="procedure_59"/>Procedure</h4><p>
					To set a target for a zone:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							List the information for the specific zone to see the default target:
						</p><pre class="screen">$ <code class="literal">firewall-cmd --zone=<span class="emphasis"><em>zone-name</em></span> --list-all</code></pre></li><li class="listitem"><p class="simpara">
							Set a new target in the zone:
						</p><pre class="screen"># firewall-cmd --zone=zone-name --set-target=&lt;default|ACCEPT|REJECT|DROP&gt;</pre></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="using-zones-to-manage-incoming-traffic-depending-on-a-source_using-and-configuring-firewalls"/>Using zones to manage incoming traffic depending on a source</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sec-Using_Zones_to_Manage_Incoming_Traffic_Depending_on_Source_using-zones-to-manage-incoming-traffic-depending-on-a-source"/>Using zones to manage incoming traffic depending on a source</h2></div></div></div><p>
					You can use zones to manage incoming traffic based on its source. That enables you to sort incoming traffic and route it through different zones to allow or disallow services that can be reached by that traffic.
				</p><p>
					If you add a source to a zone, the zone becomes active and any incoming traffic from that source will be directed through it. You can specify different settings for each zone, which is applied to the traffic from the given sources accordingly. You can use more zones even if you only have one network interface.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="adding-a-source_using-zones-to-manage-incoming-traffic-depending-on-a-source"/>Adding a source</h2></div></div></div><p>
					To route incoming traffic into a specific source, add the source to that zone. The source can be an IP address or an IP mask in the Classless Inter-domain Routing (CIDR) notation.
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							To set the source in the current zone:
						</p><pre class="screen"># firewall-cmd --add-source=&lt;source&gt;</pre></li><li class="listitem"><p class="simpara">
							To set the source IP address for a specific zone:
						</p><pre class="screen"># firewall-cmd --zone=zone-name --add-source=&lt;source&gt;</pre></li></ul></div><p>
					The following procedure allows all incoming traffic from <span class="emphasis"><em>192.168.2.15</em></span> in the <code class="literal">trusted</code> zone:
				</p><h4><a id="procedure_60"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							List all available zones:
						</p><pre class="screen"># firewall-cmd --get-zones</pre></li><li class="listitem"><p class="simpara">
							Add the source IP to the trusted zone in the permanent mode:
						</p><pre class="screen"># firewall-cmd --zone=trusted --add-source=192.168.2.15</pre></li><li class="listitem"><p class="simpara">
							Make the new settings persistent:
						</p><pre class="screen"># firewall-cmd --runtime-to-permanent</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="removing-a-source_using-zones-to-manage-incoming-traffic-depending-on-a-source"/>Removing a source</h2></div></div></div><p>
					Removing a source from the zone cuts off the traffic coming from it.
				</p><h4><a id="procedure_61"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							List allowed sources for the required zone:
						</p><pre class="screen"># firewall-cmd --zone=zone-name --list-sources</pre></li><li class="listitem"><p class="simpara">
							Remove the source from the zone permanently:
						</p><pre class="screen"># firewall-cmd --zone=zone-name --remove-source=&lt;source&gt;</pre></li><li class="listitem"><p class="simpara">
							Make the new settings persistent:
						</p><pre class="screen"># firewall-cmd --runtime-to-permanent</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="adding-a-source-port_using-zones-to-manage-incoming-traffic-depending-on-a-source"/>Adding a source port</h2></div></div></div><p>
					To enable sorting the traffic based on a port of origin, specify a source port using the <code class="literal">--add-source-port</code> option. You can also combine this with the <code class="literal">--add-source</code> option to limit the traffic to a certain IP address or IP range.
				</p><h4><a id="procedure_62"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							To add a source port:
						</p><pre class="screen"># firewall-cmd --zone=zone-name --add-source-port=&lt;port-name&gt;/&lt;tcp|udp|sctp|dccp&gt;</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="removing-a-source-port_using-zones-to-manage-incoming-traffic-depending-on-a-source"/>Removing a source port</h2></div></div></div><p>
					By removing a source port you disable sorting the traffic based on a port of origin.
				</p><h4><a id="procedure_63"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							To remove a source port:
						</p><pre class="screen"># firewall-cmd --zone=zone-name --remove-source-port=&lt;port-name&gt;/&lt;tcp|udp|sctp|dccp&gt;</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="using-zones-and-sources-to-allow-a-service-for-only-a-specific-domain_using-zones-to-manage-incoming-traffic-depending-on-a-source"/>Using zones and sources to allow a service for only a specific domain</h2></div></div></div><p>
					To allow traffic from a specific network to use a service on a machine, use zones and source. The following procedure allows traffic from <span class="emphasis"><em>192.168.1.0/24</em></span> to be able to reach the <span class="emphasis"><em>HTTP</em></span> service while any other traffic is blocked.
				</p><h4><a id="procedure_64"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							List all available zones:
						</p><pre class="screen"># firewall-cmd --get-zones
block dmz drop external home internal public trusted work</pre></li><li class="listitem"><p class="simpara">
							Add the source to the trusted zone to route the traffic originating from the source through the zone:
						</p><pre class="screen"># firewall-cmd --zone=trusted --add-source=192.168.1.0/24</pre></li><li class="listitem"><p class="simpara">
							Add the <span class="emphasis"><em>http</em></span> service in the trusted zone:
						</p><pre class="screen"># firewall-cmd --zone=trusted -add-service=http</pre></li><li class="listitem"><p class="simpara">
							Make the new settings persistent:
						</p><pre class="screen"># firewall-cmd --runtime-to-permanent</pre></li><li class="listitem"><p class="simpara">
							Check that the trusted zone is active and that the service is allowed in it:
						</p><pre class="screen"># firewall-cmd --zone=trusted --list-all
trusted (active)
target: ACCEPT
sources: 192.168.1.0/24
services: http</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-traffic-accepted-by-a-zone-based-on-a-protocol_using-zones-to-manage-incoming-traffic-depending-on-a-source"/>Configuring traffic accepted by a zone based on a protocol</h2></div></div></div><p>
					You can allow incoming traffic to be accepted by a zone based on a protocol. All traffic using the specified protocol is accepted by a zone, in which you can apply further rules and filtering.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="adding-a-protocol-to-a-zone_configuring-traffic-accepted-by-a-zone-based-on-a-protocol"/>Adding a protocol to a zone</h3></div></div></div><p>
						By adding a protocol to a certain zone, you allow all traffic with this protocol to be accepted by this zone.
					</p><h5><a id="procedure_65"/>Procedure</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								To add a protocol to a zone:
							</p><pre class="screen"># firewall-cmd --zone=zone-name --add-protocol=port-name/tcp|udp|sctp|dccp|igmp</pre></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							To receive multicast traffic, use the <code class="literal">igmp</code> value with the <code class="literal">--add-protocol</code> option.
						</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="removing-a-protocol-from-a-zone_configuring-traffic-accepted-by-a-zone-based-on-a-protocol"/>Removing a protocol from a zone</h3></div></div></div><p>
						By removing a protocol from a certain zone, you stop accepting all traffic based on this protocol by the zone.
					</p><h5><a id="procedure_66"/>Procedure</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								To remove a protocol from a zone:
							</p><pre class="screen"># firewall-cmd --zone=zone-name --remove-protocol=port-name/tcp|udp|sctp|dccp|igmp</pre></li></ol></div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring-ip-address-masquerading_using-and-configuring-firewalls"/>Configuring IP address masquerading</h1></div></div></div><p>
				The following procedure describes how to enable IP masquerading on your system. IP masquerading hides individual machines behind a gateway when accessing the Internet.
			</p><h3><a id="procedure_67"/>Procedure</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						To check if IP masquerading is enabled (for example, for the <code class="literal">external</code> zone), enter the following command as <code class="literal">root</code>:
					</p><pre class="screen"># firewall-cmd --zone=external --query-masquerade</pre><p class="simpara">
						The command prints <code class="literal">yes</code> with exit status <code class="literal">0</code> if enabled. It prints <code class="literal">no</code> with exit status <code class="literal">1</code> otherwise. If <code class="literal">zone</code> is omitted, the default zone will be used.
					</p></li><li class="listitem"><p class="simpara">
						To enable IP masquerading, enter the following command as <code class="literal">root</code>:
					</p><pre class="screen"># firewall-cmd --zone=external --add-masquerade</pre></li><li class="listitem">
						To make this setting persistent, repeat the command adding the <code class="literal">--permanent</code> option.
					</li></ol></div><p>
				To disable IP masquerading, enter the following command as <code class="literal">root</code>:
			</p><pre class="screen"># firewall-cmd --zone=external --remove-masquerade --permanent</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="managing-icmp-requests_using-and-configuring-firewalls"/>Managing ICMP requests</h1></div></div></div><p>
				The <code class="literal">Internet Control Message Protocol</code> (<code class="literal">ICMP</code>) is a supporting protocol that is used by various network devices to send error messages and operational information indicating a connection problem, for example, that a requested service is not available. <code class="literal">ICMP</code> differs from transport protocols such as TCP and UDP because it is not used to exchange data between systems.
			</p><p>
				Unfortunately, it is possible to use the <code class="literal">ICMP</code> messages, especially <code class="literal">echo-request</code> and <code class="literal">echo-reply</code>, to reveal information about your network and misuse such information for various kinds of fraudulent activities. Therefore, <code class="literal">firewalld</code> enables blocking the <code class="literal">ICMP</code> requests to protect your network information.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="listing-and-blocking-icmp-requests_managing-icmp-requests"/>Listing and blocking ICMP requests</h2></div></div></div><div class="title"><strong>Listing <code class="literal">ICMP</code> requests</strong></div><p>
						The <code class="literal">ICMP</code> requests are described in individual XML files that are located in the <code class="literal">/usr/lib/firewalld/icmptypes/</code> directory. You can read these files to see a description of the request. The <code class="literal">firewall-cmd</code> command controls the <code class="literal">ICMP</code> requests manipulation.
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							To list all available <code class="literal">ICMP</code> types:
						</p><pre class="screen"># firewall-cmd --get-icmptypes</pre></li><li class="listitem"><p class="simpara">
							The <code class="literal">ICMP</code> request can be used by IPv4, IPv6, or by both protocols. To see for which protocol the <code class="literal">ICMP</code> request is used:
						</p><pre class="screen"># firewall-cmd --info-icmptype=&lt;icmptype&gt;</pre></li><li class="listitem"><p class="simpara">
							The status of an <code class="literal">ICMP</code> request shows <code class="literal">yes</code> if the request is currently blocked or <code class="literal">no</code> if it is not. To see if an <code class="literal">ICMP</code> request is currently blocked:
						</p><pre class="screen"># firewall-cmd --query-icmp-block=&lt;icmptype&gt;</pre></li></ul></div><div class="title"><strong>Blocking or unblocking <code class="literal">ICMP</code> requests</strong></div><p>
						When your server blocks <code class="literal">ICMP</code> requests, it does not provide the information that it normally would. However, that does not mean that no information is given at all. The clients receive information that the particular <code class="literal">ICMP</code> request is being blocked (rejected). Blocking the <code class="literal">ICMP</code> requests should be considered carefully, because it can cause communication problems, especially with IPv6 traffic.
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							To see if an <code class="literal">ICMP</code> request is currently blocked:
						</p><pre class="screen"># firewall-cmd --query-icmp-block=&lt;icmptype&gt;</pre></li><li class="listitem"><p class="simpara">
							To block an <code class="literal">ICMP</code> request:
						</p><pre class="screen"># firewall-cmd --add-icmp-block=&lt;icmptype&gt;</pre></li><li class="listitem"><p class="simpara">
							To remove the block for an <code class="literal">ICMP</code> request:
						</p><pre class="screen"># firewall-cmd --remove-icmp-block=&lt;icmptype&gt;</pre></li></ul></div><div class="title"><strong>Blocking <code class="literal">ICMP</code> requests without providing any information at all</strong></div><p>
						Normally, if you block <code class="literal">ICMP</code> requests, clients know that you are blocking it. So, a potential attacker who is sniffing for live IP addresses is still able to see that your IP address is online. To hide this information completely, you have to drop all <code class="literal">ICMP</code> requests.
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							To block and drop all <code class="literal">ICMP</code> requests:
						</li></ul></div><div class="informalexample"><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Set the target of your zone to <code class="literal">DROP</code>:
						</p><pre class="screen"># firewall-cmd --set-target=DROP</pre></li><li class="listitem"><p class="simpara">
							Make the new settings persistent:
						</p><pre class="screen"># firewall-cmd --runtime-to-permanent</pre></li></ol></div><p>
					Now, all traffic, including <code class="literal">ICMP</code> requests, is dropped, except traffic which you have explicitly allowed.
				</p></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							To block and drop certain <code class="literal">ICMP</code> requests and allow others:
						</li></ul></div><div class="informalexample"><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Set the target of your zone to <code class="literal">DROP</code>:
						</p><pre class="screen"># firewall-cmd --set-target=DROP</pre></li><li class="listitem"><p class="simpara">
							Add the ICMP block inversion to block all <code class="literal">ICMP</code> requests at once:
						</p><pre class="screen"># firewall-cmd --add-icmp-block-inversion</pre></li><li class="listitem"><p class="simpara">
							Add the ICMP block for those <code class="literal">ICMP</code> requests that you want to allow:
						</p><pre class="screen"># firewall-cmd --add-icmp-block=&lt;icmptype&gt;</pre></li><li class="listitem"><p class="simpara">
							Make the new settings persistent:
						</p><pre class="screen"># firewall-cmd --runtime-to-permanent</pre></li></ol></div><p>
					The <span class="emphasis"><em>block inversion</em></span> inverts the setting of the <code class="literal">ICMP</code> requests blocks, so all requests, that were not previously blocked, are blocked. Those that were blocked are not blocked. Which means that if you need to unblock a request, you must use the blocking command.
				</p></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							To revert the block inversion to a fully permissive setting:
						</li></ul></div><div class="informalexample"><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Set the target of your zone to <code class="literal">default</code> or <code class="literal">ACCEPT</code>:
						</p><pre class="screen"># firewall-cmd --set-target=default</pre></li><li class="listitem"><p class="simpara">
							Remove all added blocks for <code class="literal">ICMP</code> requests:
						</p><pre class="screen"># firewall-cmd --remove-icmp-block=&lt;icmptype&gt;</pre></li><li class="listitem"><p class="simpara">
							Remove the <code class="literal">ICMP</code> block inversion:
						</p><pre class="screen"># firewall-cmd --remove-icmp-block-inversion</pre></li><li class="listitem"><p class="simpara">
							Make the new settings persistent:
						</p><pre class="screen"># firewall-cmd --runtime-to-permanent</pre></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-the-icmp-filter-using-gui_managing-icmp-requests"/>Configuring the ICMP filter using GUI</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							To enable or disable an <code class="literal">ICMP</code> filter, start the <span class="strong"><strong><span class="application">firewall-config</span></strong></span> tool and select the network zone whose messages are to be filtered. Select the <code class="literal">ICMP Filter</code> tab and select the check box for each type of <code class="literal">ICMP</code> message you want to filter. Clear the check box to disable a filter. This setting is per direction and the default allows everything.
						</li><li class="listitem">
							To edit an <code class="literal">ICMP</code> type, start the <span class="strong"><strong><span class="application">firewall-config</span></strong></span> tool and select <code class="literal">Permanent</code> mode from the menu labeled <code class="literal">Configuration</code>. Additional icons appear at the bottom of the <span class="guibutton">Services</span> window. Select <span class="guibutton">Yes</span> in the following dialog to enable masquerading and to make forwarding to another machine working.
						</li><li class="listitem">
							To enable inverting the <code class="literal">ICMP Filter</code>, click the <code class="literal">Invert Filter</code> check box on the right. Only marked <code class="literal">ICMP</code> types are now accepted, all other are rejected. In a zone using the DROP target, they are dropped.
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="setting-and-controlling-ip-sets-using-firewalld_using-and-configuring-firewalls"/>Setting and controlling IP sets using <code class="literal">firewalld</code></h1></div></div></div><p>
				To see the list of IP set types supported by <code class="literal">firewalld</code>, enter the following command as root.
			</p><pre class="screen">~]# firewall-cmd --get-ipset-types
hash:ip hash:ip,mark hash:ip,port hash:ip,port,ip hash:ip,port,net hash:mac hash:net hash:net,iface hash:net,net hash:net,port hash:net,port,net</pre><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-ip-set-options-using-cli_setting-and-controlling-ip-sets-using-firewalld"/>Configuring IP set options using CLI</h2></div></div></div><p>
					IP sets can be used in <code class="literal">firewalld</code> zones as sources and also as sources in rich rules. In Red Hat Enterprise Linux, the preferred method is to use the IP sets created with <code class="literal">firewalld</code> in a direct rule.
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							To list the IP sets known to <code class="literal">firewalld</code> in the permanent environment, use the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --permanent --get-ipsets</pre></li><li class="listitem"><p class="simpara">
							To add a new IP set, use the following command using the permanent environment as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --permanent --new-ipset=test --type=hash:net
success</pre><p class="simpara">
							The previous command creates a new IP set with the name <span class="emphasis"><em>test</em></span> and the <code class="literal">hash:net</code> type for <code class="literal">IPv4</code>. To create an IP set for use with <code class="literal">IPv6</code>, add the <code class="literal">--option=family=inet6</code> option. To make the new setting effective in the runtime environment, reload <code class="literal">firewalld</code>.
						</p></li><li class="listitem"><p class="simpara">
							List the new IP set with the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --permanent --get-ipsets
test</pre></li><li class="listitem"><p class="simpara">
							To get more information about the IP set, use the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --permanent --info-ipset=test
test
type: hash:net
options:
entries:</pre><p class="simpara">
							Note that the IP set does not have any entries at the moment.
						</p></li><li class="listitem"><p class="simpara">
							To add an entry to the <span class="emphasis"><em>test</em></span> IP set, use the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --permanent --ipset=<span class="emphasis"><em>test</em></span> --add-entry=<span class="emphasis"><em>192.168.0.1</em></span>
success</pre><p class="simpara">
							The previous command adds the IP address <span class="emphasis"><em>192.168.0.1</em></span> to the IP set.
						</p></li><li class="listitem"><p class="simpara">
							To get the list of current entries in the IP set, use the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --permanent --ipset=test --get-entries
192.168.0.1</pre></li><li class="listitem"><p class="simpara">
							Generate a file containing a list of IP addresses, for example:
						</p><pre class="screen"># cat &gt; iplist.txt &lt;&lt;EOL
192.168.0.2
192.168.0.3
192.168.1.0/24
192.168.2.254
EOL</pre><p class="simpara">
							The file with the list of IP addresses for an IP set should contain an entry per line. Lines starting with a hash, a semi-colon, or empty lines are ignored.
						</p></li><li class="listitem"><p class="simpara">
							To add the addresses from the <span class="emphasis"><em>iplist.txt</em></span> file, use the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --permanent --ipset=<span class="emphasis"><em>test</em></span> --add-entries-from-file=<span class="emphasis"><em>iplist.txt</em></span>
success</pre></li><li class="listitem"><p class="simpara">
							To see the extended entries list of the IP set, use the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --permanent --ipset=<span class="emphasis"><em>test</em></span> --get-entries
192.168.0.1
192.168.0.2
192.168.0.3
192.168.1.0/24
192.168.2.254</pre></li><li class="listitem"><p class="simpara">
							To remove the addresses from the IP set and to check the updated entries list, use the following commands as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --permanent --ipset=<span class="emphasis"><em>test</em></span> --remove-entries-from-file=<span class="emphasis"><em>iplist.txt</em></span>
success
# firewall-cmd --permanent --ipset=test --get-entries
192.168.0.1</pre></li><li class="listitem"><p class="simpara">
							You can add the IP set as a source to a zone to handle all traffic coming in from any of the addresses listed in the IP set with a zone. For example, to add the <span class="emphasis"><em>test</em></span> IP set as a source to the <span class="emphasis"><em>drop</em></span> zone to drop all packets coming from all entries listed in the <span class="emphasis"><em>test</em></span> IP set, use the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --permanent --zone=drop --add-source=ipset:test
success</pre><p class="simpara">
							The <code class="literal">ipset:</code> prefix in the source shows <code class="literal">firewalld</code> that the source is an IP set and not an IP address or an address range.
						</p></li></ul></div><p>
					Only the creation and removal of IP sets is limited to the permanent environment, all other IP set options can be used also in the runtime environment without the <code class="literal">--permanent</code> option.
				</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
						Red Hat does not recommend using IP sets that are not managed through <code class="literal">firewalld</code>. To use such IP sets, a permanent direct rule is required to reference the set, and a custom service must be added to create these IP sets. This service needs to be started before firewalld starts, otherwise <code class="literal">firewalld</code> is not able to add the direct rules using these sets. You can add permanent direct rules with the <code class="literal">/etc/firewalld/direct.xml</code> file.
					</p></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring-firewall-lockdown_using-and-configuring-firewalls"/>Configuring firewall lockdown</h1></div></div></div><p>
				Local applications or services are able to change the firewall configuration if they are running as <code class="literal">root</code> (for example, <span class="strong"><strong><span class="application">libvirt</span></strong></span>). With this feature, the administrator can lock the firewall configuration so that either no applications or only applications that are added to the lockdown whitelist are able to request firewall changes. The lockdown settings default to disabled. If enabled, the user can be sure that there are no unwanted configuration changes made to the firewall by local applications or services.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-lockdown-with-the-command-line-client_configuring-firewall-lockdown"/>Configuring lockdown with using CLI</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							To query whether lockdown is enabled, use the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --query-lockdown</pre><p class="simpara">
							The command prints <code class="literal">yes</code> with exit status <code class="literal">0</code> if lockdown is enabled. It prints <code class="literal">no</code> with exit status <code class="literal">1</code> otherwise.
						</p></li><li class="listitem"><p class="simpara">
							To enable lockdown, enter the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --lockdown-on</pre></li><li class="listitem"><p class="simpara">
							To disable lockdown, use the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --lockdown-off</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-lockdown-whitelist-options-with-the-command-line-client_configuring-firewall-lockdown"/>Configuring lockdown whitelist options using CLI</h2></div></div></div><p>
					The lockdown whitelist can contain commands, security contexts, users and user IDs. If a command entry on the whitelist ends with an asterisk "*", then all command lines starting with that command will match. If the "*" is not there then the absolute command including arguments must match.
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							The context is the security (SELinux) context of a running application or service. To get the context of a running application use the following command:
						</p><pre class="screen">$ <code class="literal">ps -e --context</code></pre><p class="simpara">
							That command returns all running applications. Pipe the output through the <span class="strong"><strong><span class="application">grep</span></strong></span> tool to get the application of interest. For example:
						</p><pre class="screen">$ ps -e --context | grep example_program</pre></li><li class="listitem"><p class="simpara">
							To list all command lines that are on the whitelist, enter the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --list-lockdown-whitelist-commands</pre></li><li class="listitem"><p class="simpara">
							To add a command <span class="emphasis"><em>command</em></span> to the whitelist, enter the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --add-lockdown-whitelist-command='/usr/bin/python3 -Es /usr/bin/command'</pre></li><li class="listitem"><p class="simpara">
							To remove a command <span class="emphasis"><em>command</em></span> from the whitelist, enter the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --remove-lockdown-whitelist-command='/usr/bin/python3 -Es /usr/bin/command'</pre></li><li class="listitem"><p class="simpara">
							To query whether the command <span class="emphasis"><em>command</em></span> is on the whitelist, enter the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --query-lockdown-whitelist-command='/usr/bin/python3 -Es /usr/bin/command'</pre><p class="simpara">
							The command prints <code class="literal">yes</code> with exit status <code class="literal">0</code> if true. It prints <code class="literal">no</code> with exit status <code class="literal">1</code> otherwise.
						</p></li><li class="listitem"><p class="simpara">
							To list all security contexts that are on the whitelist, enter the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --list-lockdown-whitelist-contexts</pre></li><li class="listitem"><p class="simpara">
							To add a context <span class="emphasis"><em>context</em></span> to the whitelist, enter the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --add-lockdown-whitelist-context=context</pre></li><li class="listitem"><p class="simpara">
							To remove a context <span class="emphasis"><em>context</em></span> from the whitelist, enter the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --remove-lockdown-whitelist-context=context</pre></li><li class="listitem"><p class="simpara">
							To query whether the context <span class="emphasis"><em>context</em></span> is on the whitelist, enter the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --query-lockdown-whitelist-context=context</pre><p class="simpara">
							Prints <code class="literal">yes</code> with exit status <code class="literal">0</code>, if true, prints <code class="literal">no</code> with exit status <code class="literal">1</code> otherwise.
						</p></li><li class="listitem"><p class="simpara">
							To list all user IDs that are on the whitelist, enter the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --list-lockdown-whitelist-uids</pre></li><li class="listitem"><p class="simpara">
							To add a user ID <span class="emphasis"><em>uid</em></span> to the whitelist, enter the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --add-lockdown-whitelist-uid=uid</pre></li><li class="listitem"><p class="simpara">
							To remove a user ID <span class="emphasis"><em>uid</em></span> from the whitelist, enter the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --remove-lockdown-whitelist-uid=uid</pre></li><li class="listitem"><p class="simpara">
							To query whether the user ID <span class="emphasis"><em>uid</em></span> is on the whitelist, enter the following command:
						</p><pre class="screen">$ <code class="literal">firewall-cmd --query-lockdown-whitelist-uid=<span class="emphasis"><em>uid</em></span></code></pre><p class="simpara">
							Prints <code class="literal">yes</code> with exit status <code class="literal">0</code>, if true, prints <code class="literal">no</code> with exit status <code class="literal">1</code> otherwise.
						</p></li><li class="listitem"><p class="simpara">
							To list all user names that are on the whitelist, enter the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --list-lockdown-whitelist-users</pre></li><li class="listitem"><p class="simpara">
							To add a user name <span class="emphasis"><em>user</em></span> to the whitelist, enter the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --add-lockdown-whitelist-user=user</pre></li><li class="listitem"><p class="simpara">
							To remove a user name <span class="emphasis"><em>user</em></span> from the whitelist, enter the following command as <code class="literal">root</code>:
						</p><pre class="screen"># firewall-cmd --remove-lockdown-whitelist-user=user</pre></li><li class="listitem"><p class="simpara">
							To query whether the user name <span class="emphasis"><em>user</em></span> is on the whitelist, enter the following command:
						</p><pre class="screen">$ <code class="literal">firewall-cmd --query-lockdown-whitelist-user=<span class="emphasis"><em>user</em></span></code></pre><p class="simpara">
							Prints <code class="literal">yes</code> with exit status <code class="literal">0</code>, if true, prints <code class="literal">no</code> with exit status <code class="literal">1</code> otherwise.
						</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-lockdown-whitelist-options-with-configuration-files_configuring-firewall-lockdown"/>Configuring lockdown whitelist options using configuration files</h2></div></div></div><p>
					The default whitelist configuration file contains the <code class="literal">NetworkManager</code> context and the default context of <code class="literal">libvirt</code>. The user ID 0 is also on the list.
				</p><pre class="screen">&lt;?xml version="1.0" encoding="utf-8"?&gt;
	&lt;whitelist&gt;
	  &lt;selinux context="system_u:system_r:NetworkManager_t:s0"/&gt;
	  &lt;selinux context="system_u:system_r:virtd_t:s0-s0:c0.c1023"/&gt;
	  &lt;user id="0"/&gt;
	&lt;/whitelist&gt;</pre><p>
					Following is an example whitelist configuration file enabling all commands for the <code class="literal">firewall-cmd</code> utility, for a user called <span class="emphasis"><em>user</em></span> whose user ID is <code class="literal">815</code>:
				</p><pre class="screen">&lt;?xml version="1.0" encoding="utf-8"?&gt;
	&lt;whitelist&gt;
	  &lt;command name="/usr/libexec/platform-python -s /bin/firewall-cmd*"/&gt;
	  &lt;selinux context="system_u:system_r:NetworkManager_t:s0"/&gt;
	  &lt;user id="815"/&gt;
	  &lt;user name="user"/&gt;
	&lt;/whitelist&gt;</pre><p>
					This example shows both <code class="literal">user id</code> and <code class="literal">user name</code>, but only one option is required. Python is the interpreter and is prepended to the command line. You can also use a specific command, for example:
				</p><pre class="screen"><code class="literal">/usr/bin/python3 /bin/firewall-cmd --lockdown-on</code></pre><p>
					In that example, only the <code class="literal">--lockdown-on</code> command is allowed.
				</p><p>
					In Red Hat Enterprise Linux, all utilities are placed in the <code class="literal">/usr/bin/</code> directory and the <code class="literal">/bin/</code> directory is sym-linked to the <code class="literal">/usr/bin/</code> directory. In other words, although the path for <code class="literal">firewall-cmd</code> when entered as <code class="literal">root</code> might resolve to <code class="literal">/bin/firewall-cmd</code>, <code class="literal">/usr/bin/firewall-cmd</code> can now be used. All new scripts should use the new location. But be aware that if scripts that run as <code class="literal">root</code> are written to use the <code class="literal">/bin/firewall-cmd</code> path, then that command path must be whitelisted in addition to the <code class="literal">/usr/bin/firewall-cmd</code> path traditionally used only for non-<code class="literal">root</code> users.
				</p><p>
					The <code class="literal">*</code> at the end of the name attribute of a command means that all commands that start with this string match. If the <code class="literal">*</code> is not there then the absolute command including arguments must match.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="log-for-denied-packets_using-and-configuring-firewalls"/>Log for denied packets</h1></div></div></div><p>
				With the <code class="literal">LogDenied</code> option in the <code class="literal">firewalld</code>, it is possible to add a simple logging mechanism for denied packets. These are the packets that are rejected or dropped. To change the setting of the logging, edit the <code class="literal">/etc/firewalld/firewalld.conf</code> file or use the command-line or GUI configuration tool.
			</p><p>
				If <code class="literal">LogDenied</code> is enabled, logging rules are added right before the reject and drop rules in the INPUT, FORWARD and OUTPUT chains for the default rules and also the final reject and drop rules in zones. The possible values for this setting are: <code class="literal">all</code>, <code class="literal">unicast</code>, <code class="literal">broadcast</code>, <code class="literal">multicast</code>, and <code class="literal">off</code>. The default setting is <code class="literal">off</code>. With the <code class="literal">unicast</code>, <code class="literal">broadcast</code>, and <code class="literal">multicast</code> setting, the <code class="literal">pkttype</code> match is used to match the link-layer packet type. With <code class="literal">all</code>, all packets are logged.
			</p><p>
				To list the actual <code class="literal">LogDenied</code> setting with firewall-cmd, use the following command as <code class="literal">root</code>:
			</p><pre class="screen"># firewall-cmd --get-log-denied
off</pre><p>
				To change the <code class="literal">LogDenied</code> setting, use the following command as <code class="literal">root</code>:
			</p><pre class="screen"># firewall-cmd --set-log-denied=all
success</pre><p>
				To change the <code class="literal">LogDenied</code> setting with the <code class="literal">firewalld</code> GUI configuration tool, start <span class="strong"><strong><span class="application">firewall-config</span></strong></span>, click the <code class="literal">Options</code> menu and select <code class="literal">Change Log Denied</code>. The <code class="literal">LogDenied</code> window appears. Select the new <code class="literal">LogDenied</code> setting from the menu and click OK.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="related-information-using-and-configuring-firewalls"/>Related information</h1></div></div></div><p>
				The following sources of information provide additional resources regarding <code class="literal">firewalld</code>.
			</p><h3><a id="installed_documentation"/>Installed documentation</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<code class="literal">firewalld(1)</code> man page — describes command options for <code class="literal">firewalld</code>.
					</li><li class="listitem">
						<code class="literal">firewalld.conf(5)</code> man page — contains information to configure <code class="literal">firewalld</code>.
					</li><li class="listitem">
						<code class="literal">firewall-cmd(1)</code> man page — describes command options for the <code class="literal">firewalld</code> command-line client.
					</li><li class="listitem">
						<code class="literal">firewall-config(1)</code> man page — describes settings for the <span class="strong"><strong><span class="application">firewall-config</span></strong></span> tool.
					</li><li class="listitem">
						<code class="literal">firewall-offline-cmd(1)</code> man page — describes command options for the <code class="literal">firewalld</code> offline command-line client.
					</li><li class="listitem">
						<code class="literal">firewalld.icmptype(5)</code> man page — describes XML configuration files for <code class="literal">ICMP</code> filtering.
					</li><li class="listitem">
						<code class="literal">firewalld.ipset(5)</code> man page — describes XML configuration files for the <code class="literal">firewalld</code> <code class="literal">IP</code> sets.
					</li><li class="listitem">
						<code class="literal">firewalld.service(5)</code> man page — describes XML configuration files for <span class="strong"><strong><span class="application">firewalld service</span></strong></span>.
					</li><li class="listitem">
						<code class="literal">firewalld.zone(5)</code> man page — describes XML configuration files for <code class="literal">firewalld</code> zone configuration.
					</li><li class="listitem">
						<code class="literal">firewalld.direct(5)</code> man page — describes the <code class="literal">firewalld</code> direct interface configuration file.
					</li><li class="listitem">
						<code class="literal">firewalld.lockdown-whitelist(5)</code> man page — describes the <code class="literal">firewalld</code> lockdown whitelist configuration file.
					</li><li class="listitem">
						<code class="literal">firewalld.richlanguage(5)</code> man page — describes the <code class="literal">firewalld</code> rich language rule syntax.
					</li><li class="listitem">
						<code class="literal">firewalld.zones(5)</code> man page — general description of what zones are and how to configure them.
					</li><li class="listitem">
						<code class="literal">firewalld.dbus(5)</code> man page — describes the <code class="literal">D-Bus</code> interface of <code class="literal">firewalld</code>.
					</li></ul></div><h3><a id="online_documentation"/>Online documentation</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<a class="link" href="http://www.firewalld.org/">http://www.firewalld.org/</a> — <code class="literal">firewalld</code> home page.
					</li></ul></div></div></div></body></html>