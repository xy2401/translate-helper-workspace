<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 使用和配置防火墙</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 使用和配置防火墙</h1></div></div></div><p><span class="emphasis"><em>防火墙</em></span>是一种保护计算机免受来自外部的任何不需要的流量的方法。它使用户能够通过定义一组<span class="emphasis"><em>防火墙规则</em></span>来控制主机上的传入网络流量。这些规则用于对传入流量进行排序，并阻止或允许通过。
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="getting-started-with-firewalld_using-and-configuring-firewalls"></a> <code class="literal">firewalld</code>入门</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="firewalld_getting-started-with-firewalld"></a> firewalld</h2></div></div></div><p>
					<code class="literal">firewalld</code>是一个防火墙服务守护程序，它提供带有<code class="literal">D-Bus</code>接口的动态可定制的基于主机的防火墙。它是动态的，可以创建，更改和删除规则，而无需在每次更改规则时重新启动防火墙守护程序。
				</p><p>
					<code class="literal">firewalld</code>使用<span class="emphasis"><em>区域</em></span>和<span class="emphasis"><em>服务</em></span>的概念，简化了流量管理。区域是预定义的规则集。可以将网络接口和源分配给区域。允许的流量取决于计算机所连接的网络以及此网络的安全级别。防火墙服务是预定义的规则，涵盖了允许特定服务的传入流量并在区域内应用的所有必要设置。
				</p><p>服务使用一个或多个<span class="emphasis"><em>端口</em></span>或<span class="emphasis"><em>地址</em></span>进行网络通信。防火墙根据端口过滤通信。要允许服务的网络流量，必须<span class="emphasis"><em>打开</em></span>其端口。 <code class="literal">firewalld</code>阻止未明确设置为打开的端口上的所有流量。某些区域（如<span class="emphasis"><em>可信</em></span>区域）默认允许所有流量。
				</p><h4><a id="additional_resources_30"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">firewalld(1)</code>手册页</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="firewalld-zones_getting-started-with-firewalld"></a>区</h2></div></div></div><p>⁠ <code class="literal">firewalld</code>可用于根据信任用户已经决定将在该网络内的接口和业务水平，网络分离成不同的区域。连接只能是一个区域的一部分，但区域可用于许多网络连接。
				</p><p>
					<code class="literal">NetworkManager</code>通知接口区域的<code class="literal">firewalld</code> 。您可以使用<code class="literal">firewall-config</code>工具或<code class="literal">firewall-cmd</code>命令行工具为带有<code class="literal">NetworkManager</code>接口分配区域。后两者只编辑相应的<code class="literal">NetworkManager</code>配置文件。如果更改使用界面的带<code class="literal">firewall-cmd</code>或<code class="literal">firewall-config</code> ，将请求转发到<code class="literal">NetworkManager</code> ，而不是由⁠处理<code class="literal">firewalld</code> 。
				</p><p>预定义区域存储在<code class="literal">/usr/lib/firewalld/zones/</code>目录中，可以立即应用于任何可用的网络接口。只有在修改这些文件后，才会将这些文件复制到<code class="literal">/etc/firewalld/zones/</code>目录中。预定义区域的默认设置如下：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">块</code></span></dt><dd>任何传入的网络连接都会被拒绝，其中包含用于<code class="literal">IPv4</code>的icmp-host-prohibited消息和用于<code class="literal">IPv6</code> icmp6-adm-prohibited。只能从系统内启动网络连接。
							</dd><dt><span class="term"><code class="literal">DMZ</code></span></dt><dd>对于非军事区中的计算机，这些计算机可公开访问，并且对内部网络的访问权限有限。仅接受选定的传入连接。
							</dd><dt><span class="term"><code class="literal">下降</code></span></dt><dd>在没有任何通知的情况下丢弃任何传入网络数只能进行传出网络连接。
							</dd><dt><span class="term"><code class="literal">外部</code></span></dt><dd>用于在启用伪装的外部网络上使用，尤其适用于路由器。您不相信网络上的其他计算机不会损害您的计算机。仅接受选定的传入连接。
							</dd><dt><span class="term"><code class="literal">家</code></span></dt><dd>当您主要信任网络上的其他计算机时，可在家中使用。仅接受选定的传入连接。
							</dd><dt><span class="term"><code class="literal">内部</code></span></dt><dd>当您最信任网络上的其他计算机时，用于内部网络。仅接受选定的传入连接。
							</dd><dt><span class="term"><code class="literal">上市</code></span></dt><dd>用于您不信任网络上其他计算机的公共区域。仅接受选定的传入连接。
							</dd><dt><span class="term"><code class="literal">信任</code></span></dt><dd>接受所有网络连接。
							</dd><dt><span class="term"><code class="literal">工作</code></span></dt><dd>用于您最信任网络上其他计算机的工作。仅接受选定的传入连接。
							</dd></dl></div><p>其中一个区域设置为<span class="emphasis"><em>默认</em></span>区域。将接口连接添加到<code class="literal">NetworkManager</code> ， <code class="literal">NetworkManager</code>它们分配给默认区域。安装时， <code class="literal">firewalld</code>的默认区域将设置为<code class="literal">public</code>区域。可以更改默认区域。
				</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>选择网络区域名称是不言自明的，并允许用户快速做出合理的决定。要避免任何安全问题，请查看默认区域配置，并根据您的需求和风险评估禁用任何不必要的服务。
					</p></div><h4><a id="additional_resources_31"></a>其他资源</h4><p>` <code class="literal">firewalld.zone(5)</code>手册页</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="predefined-services_getting-started-with-firewalld"></a>预定义的服务</h2></div></div></div><p>服务可以是本地端口，协议，源端口和目标的列表，以及在启用服务时自动加载的防火墙帮助程序模块的列表。使用服务可以节省用户时间，因为他们可以一步完成多个任务，例如打开端口，定义协议，启用数据包转发等，而不是一个接一个地设置所有内容。
				</p><p><code class="literal">firewalld.service(5)</code>手册页中描述了服务配置选项和通用文件信息。这些服务是通过各个XML配置文件指定的，这些文件以下列格式命名： <code class="literal"><span class="emphasis"><em>service-name</em></span> .xml</code> 。协议名称优先于<code class="literal">firewalld</code>服务或应用程序名称。
				</p><p>可以使用图形<code class="literal">firewall-config</code>工具<code class="literal">firewall-cmd</code>和<code class="literal">firewall-offline-cmd</code>添加和删除服务。
				</p><p>或者，您可以编辑<code class="literal">/etc/firewalld/services/</code>目录中的XML文件。如果用户未添加或更改服务，则在<code class="literal">/etc/firewalld/services/</code>找不到相应的XML文件。如果要添加或更改服务，可以将<code class="literal">/usr/lib/firewalld/services/</code>目录中的文件用作模板。
				</p><h4><a id="additional_resources_32"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">firewalld.service(5)</code>手册页</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="installing-the-firewall-config-gui-configuration-tool_using-and-configuring-firewalls"></a>安装<code class="literal">firewall-config</code> GUI配置工具</h1></div></div></div><p>要使用<code class="literal">firewall-config</code> GUI配置工具，请安装<code class="literal">firewall-config</code>软件包。
			</p><h3><a id="procedure_44"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">以<code class="literal">root</code>身份输入以下命令：</p><pre class="screen"># yum install firewall-config</pre><p class="simpara">或者，在<code class="literal">GNOME, use the <span class="keycap"><strong>Super</strong></span> key and type `Software</code>以启动<code class="literal">Software Sources</code>应用程序。在搜索框中键入<code class="literal">firewall</code> ，该搜索框在选择右上角的搜索按钮后出现。从搜索结果中选择<code class="literal">Firewall</code>项，然后单击“ <span class="guibutton">安装”</span>按钮。
					</p></li><li class="listitem">要运行<code class="literal">firewall-config</code> ，请使用<code class="literal">firewall-config</code>命令或按<span class="keycap"><strong>Super</strong></span>键进入“ <code class="literal">Activities Overview</code> ，键入<code class="literal">firewall</code> ，然后按<span class="keycap"><strong>Enter键</strong></span> 。
					</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="viewing-the-current-status-and-settings-of-firewalld_using-and-configuring-firewalls"></a>查看<code class="literal">firewalld</code>的当前状态和设置</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="viewing-the-current-status-of-firewalld_viewing-the-current-status-and-settings-of-firewalld"></a>查看<code class="literal">firewalld</code>的当前状态</h2></div></div></div><p>默认情况下，防火墙服务<code class="literal">firewalld</code>安装在系统上。使用<code class="literal">firewalld</code> CLI界面检查服务是否正在运行。
				</p><h4><a id="procedure_45"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要查看服务的状态：</p><pre class="screen"># firewall-cmd --state</pre></li><li class="listitem"><p class="simpara">有关服务状态的更多信息，请使用<code class="literal">systemctl status</code>子命令：</p><pre class="screen"># systemctl status firewalld
firewalld.service - firewalld - dynamic firewall daemon
   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled; vendor pr
   Active: active (running) since Mon 2017-12-18 16:05:15 CET; 50min ago
     Docs: man:firewalld(1)
 Main PID: 705 (firewalld)
    Tasks: 2 (limit: 4915)
   CGroup: /system.slice/firewalld.service
           └─705 /usr/bin/python3 -Es /usr/sbin/firewalld --nofork --nopid</pre></li></ol></div><h4><a id="additional_resources_33"></a>其他资源</h4><p>在您尝试编辑设置之前，了解<code class="literal">firewalld</code>的设置以及规则是否有效非常重要。要显示防火墙设置，请参阅<a class="xref" href="using-and-configuring-firewalls_configuring-and-managing-networking.html#viewing-current-firewalld-settings_viewing-the-current-status-and-settings-of-firewalld" title="查看当前的firewalld设置">“查看当前防火墙设置”一节</a>
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="viewing-current-firewalld-settings_viewing-the-current-status-and-settings-of-firewalld"></a>查看当前的firewalld设置</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="viewing-allowed-services-using-GUI_viewing-the-current-status-and-settings-of-firewalld"></a>使用GUI查看允许的服务</h3></div></div></div><p>要使用图形<span class="strong"><strong><span class="application">防火墙配置</span></strong></span>工具查看服务列表，请按<span class="keycap"><strong>超级</strong></span>键进入活动概览，键入<code class="literal">firewall</code> ，然后按<span class="keycap"><strong>Enter键</strong></span> 。出现<span class="strong"><strong><span class="application">firewall-config</span></strong></span>工具。您现在可以在“ <code class="literal">Services</code>选项卡下查看服务列表。
					</p><p>或者，要使用命令行启动图形防火墙配置工具，请输入以下命令：</p><pre class="screen">$ <code class="literal">firewall-config</code></pre><p>“ <code class="literal">Firewall Configuration</code>窗口打开。请注意，此命令可以作为普通用户运行，但偶尔会提示您输入管理员密码。
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="viewing-firewalld-settings-using-CLI_viewing-the-current-status-and-settings-of-firewalld"></a>使用CLI查看<code class="literal">firewalld</code>设置</h3></div></div></div><p>使用CLI客户端，可以获得当前防火墙设置的不同视图。<code class="literal">--list-all</code>选项显示<code class="literal">firewalld</code>设置的完整概述。
					</p><p>
						<code class="literal">firewalld</code>使用区域来管理流量。如果<code class="literal">--zone</code>选项未指定区域，则该命令在分配给活动网络接口和连接的默认区域中有效。
					</p><p>列出默认区域的所有相关信息：</p><pre class="screen"># firewall-cmd --list-all
public
  target: default
  icmp-block-inversion: no
  interfaces:
  sources:
  services: ssh dhcpv6-client
  ports:
  protocols:
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:</pre><p>要指定要显示设置的区域，请将<code class="literal">--zone= <span class="emphasis"><em>zone-name</em></span></code>参数添加到<code class="literal">firewall-cmd --list-all</code>命令，例如：</p><pre class="screen"># firewall-cmd --list-all --zone=home
home
  target: default
  icmp-block-inversion: no
  interfaces:
  sources:
  services: ssh mdns samba-client dhcpv6-client
... [trimmed for clarity]</pre><p>要查看特定信息（如服务或端口）的设置，请使用特定选项。请参阅<code class="literal">firewalld</code>手册页或使用命令帮助获取选项列表：</p><pre class="screen"># firewall-cmd --help

Usage: firewall-cmd [OPTIONS...]

General Options
  -h, --help           Prints a short help text and exists
  -V, --version        Print the version string of firewalld
  -q, --quiet          Do not print status messages

Status Options
  --state              Return and print firewalld state
  --reload             Reload firewall and keep state information
... [trimmed for clarity]</pre><p>例如，要查看当前区域中允许哪些服务：</p><pre class="screen"># firewall-cmd --list-services
ssh dhcpv6-client</pre><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>使用CLI工具列出某个子部分的设置有时很难解释。例如，您允许<code class="literal">SSH</code>服务和<code class="literal">firewalld</code>打开服务所需的端口（22）。稍后，如果列出允许的服务，列表将显示<code class="literal">SSH</code>服务，但如果列出打开的端口，则不显示任何服务。因此，建议使用<code class="literal">--list-all</code>选项以确保您收到完整信息。
						</p></div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="starting-firewalld_using-and-configuring-firewalls"></a>启动firewalld</h1></div></div></div><h3><a id="procedure_46"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要启动<code class="literal">firewalld</code> ，请以<code class="literal">root</code>身份输入以下命令：</p><pre class="screen"># systemctl unmask firewalld
# systemctl start firewalld</pre></li><li class="listitem"><p class="simpara">要确保<code class="literal">firewalld</code>在系统启动时自动启动，请以<code class="literal">root</code>身份输入以下命令：</p><pre class="screen"># systemctl enable firewalld</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="stopping-firewalld_using-and-configuring-firewalls"></a>停止火警</h1></div></div></div><h3><a id="procedure_47"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要停止<code class="literal">firewalld</code> ，请以<code class="literal">root</code>身份输入以下命令：</p><pre class="screen"># systemctl stop firewalld</pre></li><li class="listitem"><p class="simpara">为了防止<code class="literal">firewalld</code>在系统启动时自动启动：</p><pre class="screen"># systemctl disable firewalld</pre></li><li class="listitem"><p class="simpara">要确保通过访问<code class="literal">firewalld</code> <code class="literal">D-Bus</code>接口以及其他服务需要<code class="literal">firewalld</code> ：</p><pre class="screen"># systemctl mask firewalld</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="runtime-and-permanent-settings_using-and-configuring-firewalls"></a>运行时和永久设置</h1></div></div></div><p>在<span class="emphasis"><em>运行时</em></span>模式下提交的任何更改仅在<code class="literal">firewalld</code>运行<span class="emphasis"><em>时</em></span>应用。当<code class="literal">firewalld</code>重新启动时，设置将恢复为其<span class="emphasis"><em>永久</em></span>值。
			</p><p>要使更改在重新引导后保持不变，请使用<code class="literal">--permanent</code>选项再次应用它们。或者，要在<code class="literal">firewalld</code>运行时进行持久更改，请使用<code class="literal">--runtime-to-permanent</code> <code class="literal">firewall-cmd</code>选项。
			</p><p>如果在<code class="literal">firewalld</code>仅使用<code class="literal">--permanent</code>选项运行时设置规则，则在重新启动<code class="literal">firewalld</code>之前它们不会生效。但是，重新启动<code class="literal">firewalld</code>关闭所有打开的端口并停止网络流量。
			</p><div class="title"><strong>使用CLI在运行时和永久配置中修改设置</strong></div><p>使用CLI，您不能同时在两种模式下修改防火墙设置。您只能修改运行时或永久模式。要在永久模式下修改防火墙设置，请在<code class="literal">firewall-cmd</code>命令中使用<code class="literal">--permanent</code>选项。
				</p><pre class="screen"># firewall-cmd --permanent &lt;other options&gt;</pre><p>如果没有此选项，该命令将修改运行时模式。
			</p><p>要在两种模式下更改设置，可以使用两种方法：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">更改运行时设置，然后将其永久化，如下所示：</p><pre class="screen"># firewall-cmd &lt;other options&gt;
# firewall-cmd --runtime-to-permanent</pre></li><li class="listitem"><p class="simpara">设置永久设置并将设置重新加载到运行时模式：</p><pre class="screen"># firewall-cmd --permanent &lt;other options&gt;
# firewall-cmd --reload</pre></li></ol></div><p>第一种方法允许您在将设置应用于永久模式之前测试设置。
			</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>特别是在远程系统上，不正确的设置可能导致用户将自己锁定在机器外。要防止出现这种情况，请使用<code class="literal">--timeout</code>选项。在指定的时间后，任何更改都将恢复为其先前的状态。使用此选项会排除<code class="literal">--permanent</code>选项。
				</p><p>例如，要添加<code class="literal">SSH</code>服务15分钟：</p><pre class="screen"># firewall-cmd --add-service=ssh --timeout 15m</pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="controlling-network-traffic-using-firewalld_using-and-configuring-firewalls"></a>使用<code class="literal">firewalld</code>控制网络流量</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="disabling-all-traffic-in-case-of-emergency-using-cli_controlling-network-traffic-using-firewalld"></a>使用CLI在紧急情况下禁用所有流量</h2></div></div></div><p>在紧急情况下，例如系统攻击，可以禁用所有网络流量并切断攻击者。
				</p><h4><a id="procedure_48"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要立即禁用网络流量，请打开恐慌模式：</p><pre class="screen"># firewall-cmd --panic-on</pre></li></ol></div><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>启用紧急模式会停止所有网络流量。因此，只有在您具有对计算机的物理访问权限或使用串行控制台登录时才应使用它。
					</p></div><p>关闭紧急模式会将防火墙恢复为永久设置。要关闭恐慌模式：</p><pre class="screen"># firewall-cmd --panic-off</pre><p>要查看是否打开或关闭应急模式，请使用：</p><pre class="screen"># firewall-cmd --query-panic</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="controlling-traffic-with-predefined-services-using-cli_controlling-network-traffic-using-firewalld"></a>使用CLI控制预定义服务的流量</h2></div></div></div><p>控制流量最直接的方法是向<code class="literal">firewalld</code>添加预定义的服务。这将打开所有必需的端口，并根据<span class="emphasis"><em>服务定义文件</em></span>修改其他设置。
				</p><h4><a id="procedure_49"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">检查是否已允许该服务：</p><pre class="screen"># firewall-cmd --list-services
ssh dhcpv6-client</pre></li><li class="listitem"><p class="simpara">列出所有预定义服务：</p><pre class="screen"># firewall-cmd --get-services
RH-Satellite-6 amanda-client amanda-k5-client bacula bacula-client bitcoin bitcoin-rpc bitcoin-testnet bitcoin-testnet-rpc ceph ceph-mon cfengine condor-collector ctdb dhcp dhcpv6 dhcpv6-client dns docker-registry ...
[trimmed for clarity]</pre></li><li class="listitem"><p class="simpara">将服务添加到允许的服务：</p><pre class="screen"># firewall-cmd --add-service=&lt;service-name&gt;</pre></li><li class="listitem"><p class="simpara">使新设置持久：</p><pre class="screen"># firewall-cmd --runtime-to-permanent</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="controlling-traffic-with-predefined-services-using-gui_controlling-network-traffic-using-firewalld"></a>使用GUI控制预定义服务的流量</h2></div></div></div><p>要启用或禁用预定义或自定义服务：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">启动<span class="strong"><strong><span class="application">firewall-config</span></strong></span>工具，选择要配置其服务的网络区域。
						</li><li class="listitem">选择“ <code class="literal">Services</code>选项卡。
						</li><li class="listitem">选中您要信任的每种服务类型的复选框，或清除该复选框以阻止服务。
						</li></ol></div><p>要编辑服务：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">启动<span class="strong"><strong><span class="application">firewall-config</span></strong></span>工具。
						</li><li class="listitem">从标有<code class="literal">Configuration</code>的菜单中选择<code class="literal">Permanent</code> 。其他图标和菜单按钮显示在“ <span class="guibutton">服务”</span>窗口的底部。
						</li><li class="listitem">选择要配置的服务。
						</li></ol></div><p>“ <code class="literal">Ports</code> ， <code class="literal">Protocols</code>和“ <code class="literal">Source Port</code>选项卡可以为所选服务添加，更改和删除端口，协议和源端口。模块选项卡用于配置<span class="strong"><strong><span class="application">Netfilter</span></strong></span>帮助程序模块。“ <code class="literal">Destination</code>选项卡可以将流量限制为特定目标地址和Internet协议（ <code class="literal">IPv4</code>或<code class="literal">IPv6</code> ）。
				</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>无法在<code class="literal">Runtime</code>模式下更改服务设置。
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="adding-new-services_controlling-network-traffic-using-firewalld"></a>添加新服务</h2></div></div></div><p>可以使用图形<span class="strong"><strong><span class="application">防火墙配置</span></strong></span>工具<code class="literal">firewall-cmd</code>和<code class="literal">firewall-offline-cmd</code>添加和删除服务。或者，您可以在<code class="literal">/etc/firewalld/services/</code>编辑XML文件。如果用户未添加或更改服务，则在<code class="literal">/etc/firewalld/services/</code>中找不到相应的XML文件。如果要添加或更改服务，可以将文件<code class="literal">/usr/lib/firewalld/services/</code>用作模板。
				</p><h4><a id="procedure_50"></a>程序</h4><p>要在终端中添加新服务，请在不活动的<code class="literal">firewalld</code>情况下使用<code class="literal">firewall-cmd</code>或<code class="literal">firewall-offline-cmd</code> 。
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">输入以下命令以添加新的空服务：</p><pre class="screen">$ <code class="literal">firewall-cmd --new-service=<span class="emphasis"><em>service-name</em></span></code></pre></li><li class="listitem"><p class="simpara">要使用本地文件添加新服务，请使用以下命令：</p><pre class="screen">$ <code class="literal">firewall-cmd --new-service-from-file=<span class="emphasis"><em>service-name</em></span>.xml</code></pre><p class="simpara">您可以使用附加的<code class="literal">--name= <span class="emphasis"><em>service-name</em></span></code>选项更改服务名称。
						</p></li><li class="listitem"><p class="simpara">更改服务设置后，服务的更新副本将放入<code class="literal">/etc/firewalld/services/</code> 。
						</p><p class="simpara">以<code class="literal">root</code>身份，您可以输入以下命令手动复制服务：</p><pre class="screen"># cp /usr/lib/firewalld/services/service-name.xml /etc/firewalld/services/service-name.xml</pre></li></ol></div><p>
					<code class="literal">firewalld</code>从<code class="literal">/usr/lib/firewalld/services</code>加载文件。如果文件放在<code class="literal">/etc/firewalld/services</code>并且它们有效，那么这些文件将覆盖<code class="literal">/usr/lib/firewalld/services</code>的匹配文件。只要删除了<code class="literal">/etc/firewalld/services</code>的匹配文件或者要求<code class="literal">firewalld</code>加载服务的默认值，就会使用<code class="literal">/usr/lib/firewalld/services</code>中的覆盖文件。这仅适用于永久环境。需要重新加载才能在运行时环境中获得这些回退。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="controlling-ports-using-cli_controlling-network-traffic-using-firewalld"></a>使用CLI控制端口</h2></div></div></div><p>端口是逻辑设备，使操作系统能够接收和区分网络流量并将其相应地转发给系统服务。这些通常由侦听端口的守护进程表示，即它等待进入此端口的任何流量。
				</p><p>通常，系统服务侦听为其保留的标准端口。例如， <code class="literal">httpd</code>守护程序侦听端口80。但是，系统管理员默认配置守护程序以侦听不同的端口以增强安全性或其他原因。
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="opening-a-port_controlling-ports-using-cli"></a>打开一个港口</h3></div></div></div><p>通过开放端口，可以从外部访问系统，这代表了安全风险。通常，保持端口关闭，只有在某些服务需要时才打开它们。
					</p><h5><a id="procedure_51"></a>程序</h5><p>要获取当前区域中的开放端口列表：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">列出所有允许的端口：</p><pre class="screen"># firewall-cmd --list-ports</pre></li><li class="listitem"><p class="simpara">将端口添加到允许的端口以打开传入流量：</p><pre class="screen"># firewall-cmd --add-port=port-number/port-type</pre></li><li class="listitem"><p class="simpara">使新设置持久：</p><pre class="screen"># firewall-cmd --runtime-to-permanent</pre></li></ol></div><p>端口类型是<code class="literal">tcp</code> ， <code class="literal">udp</code> ， <code class="literal">sctp</code>或<code class="literal">dccp</code> 。类型必须与网络通信的类型匹配。
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="closing-a-port_controlling-ports-using-cli"></a>关闭一个端口</h3></div></div></div><p>当不再需要打开端口时，关闭<code class="literal">firewalld</code>该端口。强烈建议在不使用时立即关闭所有不必要的端口，因为保持端口打开会带来安全风险。
					</p><h5><a id="procedure_52"></a>程序</h5><p>要关闭端口，请将其从允许的端口列表中删除：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">列出所有允许的端口：</p><pre class="screen"># firewall-cmd --list-ports
[WARNING]
====
This command will only give you a list of ports that have been opened as ports. You will not be able to see any open ports that have been opened as a service. Therefore, you should consider using the --list-all option instead of --list-ports.
====</pre></li><li class="listitem"><p class="simpara">从允许的端口中删除端口以关闭传入流量：</p><pre class="screen"># firewall-cmd --remove-port=port-number/port-type</pre></li><li class="listitem"><p class="simpara">使新设置持久：</p><pre class="screen"># firewall-cmd --runtime-to-permanent</pre></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sec-Opening_Ports_using_GUI_controlling-network-traffic-using-firewalld"></a>使用GUI打开端口</h2></div></div></div><p>允许通过防火墙的流量到某个端口：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">启动<span class="strong"><strong><span class="application">firewall-config</span></strong></span>工具，然后选择要更改其设置的网络区域。
						</li><li class="listitem">选择“ <code class="literal">Ports</code>选项卡，然后单击右侧的“ <span class="guibutton">添加”</span>按钮。“ <code class="literal">Port and Protocol</code>窗口打开。
						</li><li class="listitem">输入允许的端口号或端口范围。
						</li><li class="listitem">从列表中选择<code class="literal">tcp</code>或<code class="literal">udp</code> 。
						</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sec-Controlling_Traffic_with_Protocols_using_GUI_controlling-network-traffic-using-firewalld"></a>使用GUI通过协议控制流量</h2></div></div></div><p>使用特定协议允许通过防火墙的流量：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">启动<span class="strong"><strong><span class="application">firewall-config</span></strong></span>工具，然后选择要更改其设置的网络区域。
						</li><li class="listitem">选择<code class="literal">Protocols</code>选项卡，然后单击右侧的<code class="literal">Add</code>按钮。“ <code class="literal">Protocol</code>窗口打开。
						</li><li class="listitem">从列表中选择协议或选中“ <code class="literal">Other Protocol</code>复选框，然后在字段中输入协议。
						</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sec-Opening_Source_Ports_using_GUI_controlling-network-traffic-using-firewalld"></a>使用GUI打开源端口</h2></div></div></div><p>允许从某个端口通过防火墙的流量：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">启动firewall-config工具，然后选择要更改其设置的网络区域。
						</li><li class="listitem">选择“ <code class="literal">Source Port</code>选项卡，然后单击右侧的“ <code class="literal">Add</code>按钮。“ <code class="literal">Source Port</code>窗口打开。
						</li><li class="listitem">输入允许的端口号或端口范围。从列表中选择<code class="literal">tcp</code>或<code class="literal">udp</code> 。
						</li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="working-with-firewalld-zones_using-and-configuring-firewalls"></a>使用防火区</h1></div></div></div><p>区域代表一种更透明地管理传入流量的概念。区域连接到网络接口或分配一系列源地址。您可以独立管理每个区域的防火墙规则，这使您可以定义复杂的防火墙设置并将其应用于流量。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="listing-zones_working-with-firewalld-zones"></a>列出区域</h2></div></div></div><h4><a id="procedure_53"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要查看系统上可用的区域：</p><pre class="screen"># firewall-cmd --get-zones</pre><p class="simpara"><code class="literal">firewall-cmd --get-zones</code>命令显示系统上可用的所有区域，但不显示特定区域的任何详细信息。
						</p></li><li class="listitem"><p class="simpara">要查看所有区域的详细信息：</p><pre class="screen"># firewall-cmd --list-all-zones</pre></li><li class="listitem"><p class="simpara">要查看特定区域的详细信息：</p><pre class="screen"># firewall-cmd --zone=zone-name --list-all</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="modifying-firewalld-settings-for-a-certain-zone_working-with-firewalld-zones"></a>修改某个区域的firewalld设置</h2></div></div></div><p><a class="xref" href="using-and-configuring-firewalls_configuring-and-managing-networking.html#controlling-traffic-with-predefined-services-using-cli_controlling-network-traffic-using-firewalld" title="使用CLI控制预定义服务的流量">“使用CLI控制使用预定义服务的流量”</a> <a class="xref" href="using-and-configuring-firewalls_configuring-and-managing-networking.html#controlling-ports-using-cli_controlling-network-traffic-using-firewalld" title="Controlling ports using CLI">一节</a>和<a class="xref" href="using-and-configuring-firewalls_configuring-and-managing-networking.html#controlling-ports-using-cli_controlling-network-traffic-using-firewalld" title="使用CLI控制端口">“使用CLI控制端口”一节</a>介绍了如何在当前工作区范围内添加服务或修改端口。有时，需要在不同的区域中设置规则。
				</p><h4><a id="procedure_54"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem">要在其他区域中工作，请使用<code class="literal">--zone= <span class="emphasis"><em>zone-name</em></span></code>选项。例如，要允许区域<span class="emphasis"><em>public中</em></span>的<code class="literal">SSH</code>服务：</li></ol></div><pre class="screen"># firewall-cmd --add-service=ssh --zone=public</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="changing-the-default-zone_working-with-firewalld-zones"></a>更改默认区域</h2></div></div></div><p>系统管理员在其配置文件中将区域分配给网络接口。如果未将接口分配给特定区域，则会将其分配给默认区域。每次重新启动<code class="literal">firewalld</code>服务后， <code class="literal">firewalld</code>将加载默认区域的设置并使其处于活动状态。
				</p><h4><a id="procedure_55"></a>程序</h4><p>要设置默认区域：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">显示当前的默认区域：</p><pre class="screen"># firewall-cmd --get-default-zone</pre></li><li class="listitem"><p class="simpara">设置新的默认区域：</p><pre class="screen"># firewall-cmd --set-default-zone zone-name</pre></li></ol></div><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>按照此过程，即使没有<code class="literal">--permanent</code>选项，设置也是永久设置。
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assigning-a-network-interface-to-a-zone_working-with-firewalld-zones"></a>为区域分配网络接口</h2></div></div></div><p>可以为不同的区域定义不同的规则集，然后通过更改正在使用的接口的区域来快速更改设置。通过多个接口，可以为每个接口设置一个特定区域，以区分通过它们传输的流量。
				</p><h4><a id="procedure_56"></a>程序</h4><p>要将区域分配给特定接口：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">列出活动区域和分配给它们的接口：</p><pre class="screen"># firewall-cmd --get-active-zones</pre></li><li class="listitem"><p class="simpara">将接口分配给其他区域：</p><pre class="screen"># firewall-cmd --zone=zone-name --change-interface=&lt;interface-name&gt;</pre></li></ol></div><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>您不必使用<code class="literal">--permanent</code>选项在重新启动时使设置保持不变。如果设置新的默认区域，则该设置将成为永久设置。
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assigning-a-default-zone-to-a-network-connection_working-with-firewalld-zones"></a>将默认区域分配给网络连接</h2></div></div></div><p>当连接由<span class="strong"><strong><span class="application">NetworkManager管理时</span></strong></span> ，它必须知道它使用的区域。对于每个网络连接，可以指定一个区域，根据计算机与便携式设备的位置，可以灵活地设置各种防火墙设置。因此，可以为不同的位置指定区域和设置，例如公司或家庭。
				</p><h4><a id="procedure_57"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要为Internet连接设置默认区域，请使用<span class="strong"><strong><span class="application">NetworkManager</span></strong></span> GUI或编辑<code class="literal">/etc/sysconfig/network-scripts/ifcfg- <span class="emphasis"><em>connection-name</em></span></code>文件，并添加一个为此连接分配区域的行：</p><pre class="screen">ZONE=<span class="emphasis"><em>zone-name</em></span></pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-a-new-zone_working-with-firewalld-zones"></a>创建一个新区域</h2></div></div></div><p>要使用自定义区域，请创建一个新区域，并将其用作预定义区域。新区域需要<code class="literal">--permanent</code>选项，否则命令不起作用。
				</p><h4><a id="procedure_58"></a>程序</h4><p>要创建新区域：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">创建一个新区域：</p><pre class="screen"># firewall-cmd --new-zone=zone-name</pre></li><li class="listitem"><p class="simpara">检查新区域是否已添加到永久设置中：</p><pre class="screen"># firewall-cmd --get-zones</pre></li><li class="listitem"><p class="simpara">使新设置持久：</p><pre class="screen"># firewall-cmd --runtime-to-permanent</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="zone-configuration-files_working-with-firewalld-zones"></a>区域配置文件</h2></div></div></div><p>也可以使用<span class="emphasis"><em>区域配置文件</em></span>创建<span class="emphasis"><em>区域</em></span> 。当您需要创建新区域但希望重用其他区域中的设置并仅稍微改变它们时，此方法会很有用。
				</p><p><code class="literal">firewalld</code>区域配置文件包含区域的信息。这些是XML文件格式的区域描述，服务，端口，协议，icmp-blocks，伪装，转发端口和丰富的语言规则。文件名必须是<code class="literal"><span class="emphasis"><em>zone-name</em></span> .xml</code>其中<span class="emphasis"><em>区-名称</em></span>的长度目前仅限于17个字符。区域配置文件位于<code class="literal">/usr/lib/firewalld/zones/</code>和<code class="literal">/etc/firewalld/zones/</code>目录中。
				</p><p>以下示例显示了允许<code class="literal">TCP</code>和<code class="literal">UDP</code>协议的一个服务（ <code class="literal">SSH</code> ）和一个端口范围的配置：</p><pre class="screen">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;zone&gt;
  &lt;short&gt;My zone&lt;/short&gt;
  &lt;description&gt;Here you can describe the characteristic features of the zone.&lt;/description&gt;
  &lt;service name="ssh"/&gt;
  &lt;port port="1025-65535" protocol="tcp"/&gt;
  &lt;port port="1025-65535" protocol="udp"/&gt;
&lt;/zone&gt;</pre><p>要更改该区域的设置，请添加或删除部分以添加端口，转发端口，服务等。
				</p><h4><a id="additional_resources_34"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关更多信息，请参阅<code class="literal">firewalld.zone</code>手册页。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="using-zone-targets-to-set-default-behavior-for-incoming-traffic_working-with-firewalld-zones"></a>使用区域目标设置传入流量的默认行为</h2></div></div></div><p>对于每个区域，您可以设置一个默认行为来处理未进一步指定的传入流量。通过设置区域的目标来定义此类行为。有三个选项 - <code class="literal">default</code> ， <code class="literal">ACCEPT</code> ， <code class="literal">REJECT</code>和<code class="literal">DROP</code> 。通过将目标设置为<code class="literal">ACCEPT</code> ，您接受除特定规则禁用的所有传入数据包。如果将目标设置为<code class="literal">REJECT</code>或<code class="literal">DROP</code> ，则禁用除特定规则允许的所有传入数据包。当数据包被拒绝时，源计算机会被告知拒绝，而丢弃数据包时没有信息。
				</p><h4><a id="procedure_59"></a>程序</h4><p>要为区域设置目标：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">列出特定区域的信息以查看默认目标：</p><pre class="screen">$ <code class="literal">firewall-cmd --zone=<span class="emphasis"><em>zone-name</em></span> --list-all</code></pre></li><li class="listitem"><p class="simpara">在区域中设置新目标：</p><pre class="screen"># firewall-cmd --zone=zone-name --set-target=&lt;default|ACCEPT|REJECT|DROP&gt;</pre></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="using-zones-to-manage-incoming-traffic-depending-on-a-source_using-and-configuring-firewalls"></a>使用区域根据来源管理传入流量</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sec-Using_Zones_to_Manage_Incoming_Traffic_Depending_on_Source_using-zones-to-manage-incoming-traffic-depending-on-a-source"></a>使用区域根据来源管理传入流量</h2></div></div></div><p>您可以使用区域根据其来源管理传入流量。这使您可以对传入流量进行排序并将其路由到不同的区域，以允许或禁止该流量可以访问的服务。
				</p><p>如果您向区域添加源，则该区域将变为活动状态，并且来自该源的任何传入流量都将通过该区域进行定向。您可以为每个区域指定不同的设置，相应地应用于来自给定源的流量。即使您只有一个网络接口，也可以使用更多区域。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="adding-a-source_using-zones-to-manage-incoming-traffic-depending-on-a-source"></a>添加源</h2></div></div></div><p>要将传入流量路由到特定源，请将源添加到该区域。源可以是无类别域间路由（CIDR）表示法中的IP地址或IP掩码。
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要在当前区域中设置源：</p><pre class="screen"># firewall-cmd --add-source=&lt;source&gt;</pre></li><li class="listitem"><p class="simpara">设置特定区域的源IP地址：</p><pre class="screen"># firewall-cmd --zone=zone-name --add-source=&lt;source&gt;</pre></li></ul></div><p>以下过程允许<code class="literal">trusted</code>区域中来自<span class="emphasis"><em>192.168.2.15的</em></span>所有传入流量：</p><h4><a id="procedure_60"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">列出所有可用区域：</p><pre class="screen"># firewall-cmd --get-zones</pre></li><li class="listitem"><p class="simpara">在永久模式下将源IP添加到受信任区域：</p><pre class="screen"># firewall-cmd --zone=trusted --add-source=192.168.2.15</pre></li><li class="listitem"><p class="simpara">使新设置持久：</p><pre class="screen"># firewall-cmd --runtime-to-permanent</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="removing-a-source_using-zones-to-manage-incoming-traffic-depending-on-a-source"></a>删除源</h2></div></div></div><p>从区域中删除源会切断来自它的流量。
				</p><h4><a id="procedure_61"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">列出所需区域的允许来源：</p><pre class="screen"># firewall-cmd --zone=zone-name --list-sources</pre></li><li class="listitem"><p class="simpara">永久删除区域中的源：</p><pre class="screen"># firewall-cmd --zone=zone-name --remove-source=&lt;source&gt;</pre></li><li class="listitem"><p class="simpara">使新设置持久：</p><pre class="screen"># firewall-cmd --runtime-to-permanent</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="adding-a-source-port_using-zones-to-manage-incoming-traffic-depending-on-a-source"></a>添加源端口</h2></div></div></div><p>要启用基于源端口对流量进行排序，请使用<code class="literal">--add-source-port</code>选项指定源端口。您还可以将其与<code class="literal">--add-source</code>选项结合使用，以限制到特定IP地址或IP范围的流量。
				</p><h4><a id="procedure_62"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要添加源端口：</p><pre class="screen"># firewall-cmd --zone=zone-name --add-source-port=&lt;port-name&gt;/&lt;tcp|udp|sctp|dccp&gt;</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="removing-a-source-port_using-zones-to-manage-incoming-traffic-depending-on-a-source"></a>删除源端口</h2></div></div></div><p>通过删除源端口，您可以禁用基于源端口对流量进行排序。
				</p><h4><a id="procedure_63"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要删除源端口：</p><pre class="screen"># firewall-cmd --zone=zone-name --remove-source-port=&lt;port-name&gt;/&lt;tcp|udp|sctp|dccp&gt;</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="using-zones-and-sources-to-allow-a-service-for-only-a-specific-domain_using-zones-to-manage-incoming-traffic-depending-on-a-source"></a>使用区域和来源仅允许特定域的服务</h2></div></div></div><p>要允许来自特定网络的流量使用计算机上的服务，请使用区域和来源。以下过程允许来自<span class="emphasis"><em>192.168.1.0/24的</em></span>流量能够在阻止任何其他流量时访问<span class="emphasis"><em>HTTP</em></span>服务。
				</p><h4><a id="procedure_64"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">列出所有可用区域：</p><pre class="screen"># firewall-cmd --get-zones
block dmz drop external home internal public trusted work</pre></li><li class="listitem"><p class="simpara">将源添加到受信任区域，以通过区域路由源自源的流量：</p><pre class="screen"># firewall-cmd --zone=trusted --add-source=192.168.1.0/24</pre></li><li class="listitem"><p class="simpara">在受信任区域中添加<span class="emphasis"><em>http</em></span>服务：</p><pre class="screen"># firewall-cmd --zone=trusted -add-service=http</pre></li><li class="listitem"><p class="simpara">使新设置持久：</p><pre class="screen"># firewall-cmd --runtime-to-permanent</pre></li><li class="listitem"><p class="simpara">检查受信任区域是否处于活动状态并且允许该服务：</p><pre class="screen"># firewall-cmd --zone=trusted --list-all
trusted (active)
target: ACCEPT
sources: 192.168.1.0/24
services: http</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-traffic-accepted-by-a-zone-based-on-a-protocol_using-zones-to-manage-incoming-traffic-depending-on-a-source"></a>根据协议配置区域接受的流量</h2></div></div></div><p>您可以根据协议允许区域接受传入流量。使用指定协议的所有流量都被区域接受，您可以在其中应用进一步的规则和过滤。
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="adding-a-protocol-to-a-zone_configuring-traffic-accepted-by-a-zone-based-on-a-protocol"></a>将协议添加到区域</h3></div></div></div><p>通过将协议添加到某个区域，您可以允许此区域接受具有此协议的所有流量。
					</p><h5><a id="procedure_65"></a>程序</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要将协议添加到区域：</p><pre class="screen"># firewall-cmd --zone=zone-name --add-protocol=port-name/tcp|udp|sctp|dccp|igmp</pre></li></ol></div><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>要接收多播流量，请使用带有<code class="literal">--add-protocol</code>选项的<code class="literal">igmp</code>值。
						</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="removing-a-protocol-from-a-zone_configuring-traffic-accepted-by-a-zone-based-on-a-protocol"></a>从区域中删除协议</h3></div></div></div><p>通过从某个区域删除协议，您将停止接受该区域基于此协议的所有流量。
					</p><h5><a id="procedure_66"></a>程序</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要从区域中删除协议：</p><pre class="screen"># firewall-cmd --zone=zone-name --remove-protocol=port-name/tcp|udp|sctp|dccp|igmp</pre></li></ol></div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring-ip-address-masquerading_using-and-configuring-firewalls"></a>配置IP地址伪装</h1></div></div></div><p>以下过程介绍了如何在系统上启用IP伪装。IP伪装在访问Internet时隐藏网关后面的各个机器。
			</p><h3><a id="procedure_67"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要检查是否已启用IP伪装（例如，对于<code class="literal">external</code>区域），请以<code class="literal">root</code>身份输入以下命令：</p><pre class="screen"># firewall-cmd --zone=external --query-masquerade</pre><p class="simpara">该命令打印<code class="literal">yes</code>与退出状态<code class="literal">0</code> ，如果启用。它打印<code class="literal">no</code>带退出状态<code class="literal">1</code> ，否则。如果<code class="literal">zone</code>被省略，默认区域将被使用。
					</p></li><li class="listitem"><p class="simpara">要启用IP伪装，请以<code class="literal">root</code>身份输入以下命令：</p><pre class="screen"># firewall-cmd --zone=external --add-masquerade</pre></li><li class="listitem">要使此设置保持<code class="literal">--permanent</code> ，请重复添加<code class="literal">--permanent</code>选项的命令。
					</li></ol></div><p>要禁用IP伪装，请以<code class="literal">root</code>身份输入以下命令：</p><pre class="screen"># firewall-cmd --zone=external --remove-masquerade --permanent</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="managing-icmp-requests_using-and-configuring-firewalls"></a>管理ICMP请求</h1></div></div></div><p><code class="literal">Internet Control Message Protocol</code> （ <code class="literal">ICMP</code> ）是一种支持协议，其被各种网络设备用于发送指示连接问题的错误消息和操作信息，例如，所请求的服务不可用。<code class="literal">ICMP</code>与TCP和UDP等传输协议不同，因为它不用于在系统之间交换数据。
			</p><p>不幸的是，可以使用<code class="literal">ICMP</code>消息，尤其是<code class="literal">echo-request</code>和<code class="literal">echo-reply</code> ，来揭示有关您的网络的信息，并滥用此类信息用于各种欺诈活动。因此， <code class="literal">firewalld</code>可以阻止<code class="literal">ICMP</code>请求以保护您的网络信息。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="listing-and-blocking-icmp-requests_managing-icmp-requests"></a>列出并阻止ICMP请求</h2></div></div></div><div class="title"><strong>列出<code class="literal">ICMP</code>请求</strong></div><p><code class="literal">ICMP</code>请求在位于<code class="literal">/usr/lib/firewalld/icmptypes/</code>目录中的各个XML文件中描述。您可以阅读这些文件以查看请求的描述。 <code class="literal">firewall-cmd</code>命令控制<code class="literal">ICMP</code>请求操作。
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">列出所有可用的<code class="literal">ICMP</code>类型：</p><pre class="screen"># firewall-cmd --get-icmptypes</pre></li><li class="listitem"><p class="simpara"><code class="literal">ICMP</code>请求可以由IPv4，IPv6或两种协议使用。要查看使用<code class="literal">ICMP</code>请求的协议：</p><pre class="screen"># firewall-cmd --info-icmptype=&lt;icmptype&gt;</pre></li><li class="listitem"><p class="simpara">的状态<code class="literal">ICMP</code>请求显示<code class="literal">yes</code>如果请求当前被阻塞或<code class="literal">no</code> ，如果它不是。要查看当前是否阻止了<code class="literal">ICMP</code>请求：</p><pre class="screen"># firewall-cmd --query-icmp-block=&lt;icmptype&gt;</pre></li></ul></div><div class="title"><strong>阻止或取消阻止<code class="literal">ICMP</code>请求</strong></div><p>当您的服务器阻止<code class="literal">ICMP</code>请求时，它不会提供它通常会提供的信息。但是，这并不意味着根本没有提供任何信息。客户端接收特定<code class="literal">ICMP</code>请求被阻止（拒绝）的信息。应仔细考虑阻止<code class="literal">ICMP</code>请求，因为它可能导致通信问题，尤其是IPv6流量。
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要查看当前是否阻止了<code class="literal">ICMP</code>请求：</p><pre class="screen"># firewall-cmd --query-icmp-block=&lt;icmptype&gt;</pre></li><li class="listitem"><p class="simpara">阻止<code class="literal">ICMP</code>请求：</p><pre class="screen"># firewall-cmd --add-icmp-block=&lt;icmptype&gt;</pre></li><li class="listitem"><p class="simpara">要删除<code class="literal">ICMP</code>请求的块：</p><pre class="screen"># firewall-cmd --remove-icmp-block=&lt;icmptype&gt;</pre></li></ul></div><div class="title"><strong>阻止<code class="literal">ICMP</code>请求而不提供任何信息</strong></div><p>通常，如果您阻止<code class="literal">ICMP</code>请求，则客户端知道您正在阻止它。因此，嗅探实时IP地址的潜在攻击者仍然能够看到您的IP地址在线。要完全隐藏此信息，您必须删除所有<code class="literal">ICMP</code>请求。
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">阻止和删除所有<code class="literal">ICMP</code>请求：</li></ul></div><div class="informalexample"><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">将区域的目标设置为<code class="literal">DROP</code> ：</p><pre class="screen"># firewall-cmd --set-target=DROP</pre></li><li class="listitem"><p class="simpara">使新设置持久：</p><pre class="screen"># firewall-cmd --runtime-to-permanent</pre></li></ol></div><p>现在，除了您明确允许的流量之外，所有流量（包括<code class="literal">ICMP</code>请求）都将被删除。
				</p></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">阻止和删除某些<code class="literal">ICMP</code>请求并允许其他人：</li></ul></div><div class="informalexample"><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">将区域的目标设置为<code class="literal">DROP</code> ：</p><pre class="screen"># firewall-cmd --set-target=DROP</pre></li><li class="listitem"><p class="simpara">添加ICMP块反转以立即阻止所有<code class="literal">ICMP</code>请求：</p><pre class="screen"># firewall-cmd --add-icmp-block-inversion</pre></li><li class="listitem"><p class="simpara">为要允许的<code class="literal">ICMP</code>请求添加ICMP块：</p><pre class="screen"># firewall-cmd --add-icmp-block=&lt;icmptype&gt;</pre></li><li class="listitem"><p class="simpara">使新设置持久：</p><pre class="screen"># firewall-cmd --runtime-to-permanent</pre></li></ol></div><p><span class="emphasis"><em>块反转会</em></span>反转<code class="literal">ICMP</code>请求块的设置，因此阻止了先前未阻止的所有请求。那些被阻止的人不会受阻。这意味着如果您需要取消阻止请求，则必须使用blocking命令。
				</p></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">要将块反转恢复为完全许可设置：</li></ul></div><div class="informalexample"><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">将区域的目标设置为<code class="literal">default</code>或<code class="literal">ACCEPT</code> ：</p><pre class="screen"># firewall-cmd --set-target=default</pre></li><li class="listitem"><p class="simpara">删除所有添加的<code class="literal">ICMP</code>请求块：</p><pre class="screen"># firewall-cmd --remove-icmp-block=&lt;icmptype&gt;</pre></li><li class="listitem"><p class="simpara">删除<code class="literal">ICMP</code>块反转：</p><pre class="screen"># firewall-cmd --remove-icmp-block-inversion</pre></li><li class="listitem"><p class="simpara">使新设置持久：</p><pre class="screen"># firewall-cmd --runtime-to-permanent</pre></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-the-icmp-filter-using-gui_managing-icmp-requests"></a>使用GUI配置ICMP过滤器</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">要启用或禁用<code class="literal">ICMP</code>筛选器，请启动<span class="strong"><strong><span class="application">firewall-config</span></strong></span>工具并选择要筛选其邮件的网络区域。选择“ <code class="literal">ICMP Filter</code>选项卡，然后选中要筛选的每种<code class="literal">ICMP</code>消息的复选框。清除复选框以禁用过滤器。此设置是每个方向，默认允许一切。
						</li><li class="listitem">要编辑<code class="literal">ICMP</code>类型，请启动<span class="strong"><strong><span class="application">firewall-config</span></strong></span>工具，然后从标记为<code class="literal">Configuration</code>的菜单中选择<code class="literal">Permanent</code> mode。其他图标显示在“ <span class="guibutton">服务”</span>窗口的底部。在以下对话框中选择“ <span class="guibutton">是</span> ”以启用伪装并转发到另一台计算机。
						</li><li class="listitem">要启用反转<code class="literal">ICMP Filter</code> ，请单击右侧的“ <code class="literal">Invert Filter</code>复选框。现在只接受标记的<code class="literal">ICMP</code>类型，拒绝所有其他类型。在使用DROP目标的区域中，它们被删除。
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="setting-and-controlling-ip-sets-using-firewalld_using-and-configuring-firewalls"></a>使用<code class="literal">firewalld</code>设置和控制IP集</h1></div></div></div><p>要查看<code class="literal">firewalld</code>支持的IP集类型列表，请以root身份输入以下命令。
			</p><pre class="screen">~]# firewall-cmd --get-ipset-types
hash:ip hash:ip,mark hash:ip,port hash:ip,port,ip hash:ip,port,net hash:mac hash:net hash:net,iface hash:net,net hash:net,port hash:net,port,net</pre><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-ip-set-options-using-cli_setting-and-controlling-ip-sets-using-firewalld"></a>使用CLI配置IP设置选项</h2></div></div></div><p>IP集可以在<code class="literal">firewalld</code>区域中用作源，也可以用作丰富规则中的源。在Red Hat Enterprise Linux中，首选方法是在直接规则中使用使用<code class="literal">firewalld</code>创建的IP集。
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要列出永久环境中<code class="literal">firewalld</code>已知的IP集，请以<code class="literal">root</code>身份使用以下命令：</p><pre class="screen"># firewall-cmd --permanent --get-ipsets</pre></li><li class="listitem"><p class="simpara">要添加新IP集，请使用以<code class="literal">root</code>身份使用永久环境：</p><pre class="screen"># firewall-cmd --permanent --new-ipset=test --type=hash:net
success</pre><p class="simpara">上一个命令创建一个名为<span class="emphasis"><em>test</em></span>的新IP集，以及<code class="literal">IPv4</code>的<code class="literal">hash:net</code>类型。要创建用于<code class="literal">IPv6</code>的IP集，请添加<code class="literal">--option=family=inet6</code>选项。要使新设置在运行时环境中有效，请重新加载<code class="literal">firewalld</code> 。
						</p></li><li class="listitem"><p class="simpara">使用以下命令以<code class="literal">root</code>身份列出新IP集：</p><pre class="screen"># firewall-cmd --permanent --get-ipsets
test</pre></li><li class="listitem"><p class="simpara">要获取有关IP集的更多信息，请以<code class="literal">root</code>身份使用以下命令：</p><pre class="screen"># firewall-cmd --permanent --info-ipset=test
test
type: hash:net
options:
entries:</pre><p class="simpara">请注意，IP集目前没有任何条目。
						</p></li><li class="listitem"><p class="simpara">要向<span class="emphasis"><em>测试</em></span> IP集添加条目，请以<code class="literal">root</code>身份使用以下命令：</p><pre class="screen"># firewall-cmd --permanent --ipset=<span class="emphasis"><em>test</em></span> --add-entry=<span class="emphasis"><em>192.168.0.1</em></span>
success</pre><p class="simpara">上一个命令将IP地址<span class="emphasis"><em>192.168.0.1</em></span>添加到IP集。
						</p></li><li class="listitem"><p class="simpara">要获取IP集中的当前条目列表，请以<code class="literal">root</code>身份使用以下命令：</p><pre class="screen"># firewall-cmd --permanent --ipset=test --get-entries
192.168.0.1</pre></li><li class="listitem"><p class="simpara">生成包含IP地址列表的文件，例如：</p><pre class="screen"># cat &gt; iplist.txt &lt;&lt;EOL
192.168.0.2
192.168.0.3
192.168.1.0/24
192.168.2.254
EOL</pre><p class="simpara">具有IP集IP地址列表的文件应包含每行的条目。以哈希，分号或空行开头的行将被忽略。
						</p></li><li class="listitem"><p class="simpara">若要从<span class="emphasis"><em>iplist.txt</em></span>文件中添加地址，请使用以下命令<code class="literal">root</code> ：</p><pre class="screen"># firewall-cmd --permanent --ipset=<span class="emphasis"><em>test</em></span> --add-entries-from-file=<span class="emphasis"><em>iplist.txt</em></span>
success</pre></li><li class="listitem"><p class="simpara">要查看IP集的扩展条目列表，请以<code class="literal">root</code>身份使用以下命令：</p><pre class="screen"># firewall-cmd --permanent --ipset=<span class="emphasis"><em>test</em></span> --get-entries
192.168.0.1
192.168.0.2
192.168.0.3
192.168.1.0/24
192.168.2.254</pre></li><li class="listitem"><p class="simpara">要从IP集中删除地址并检查更新的条目列表，请以<code class="literal">root</code>身份使用以下命令：</p><pre class="screen"># firewall-cmd --permanent --ipset=<span class="emphasis"><em>test</em></span> --remove-entries-from-file=<span class="emphasis"><em>iplist.txt</em></span>
success
# firewall-cmd --permanent --ipset=test --get-entries
192.168.0.1</pre></li><li class="listitem"><p class="simpara">您可以将IP集作为源添加到区域，以处理来自IP区域中列出的任何地址的所有流量。例如，要将<span class="emphasis"><em>测试</em></span> IP集作为源添加到<span class="emphasis"><em>放置</em></span>区以丢弃来自<span class="emphasis"><em>测试</em></span> IP集中列出的所有条目的所有数据包，请以<code class="literal">root</code>身份使用以下命令：</p><pre class="screen"># firewall-cmd --permanent --zone=drop --add-source=ipset:test
success</pre><p class="simpara">源中的<code class="literal">ipset:</code>前缀显示<code class="literal">firewalld</code> ，即源是IP集，而不是IP地址或地址范围。
						</p></li></ul></div><p>只有IP集的创建和删除仅限于永久环境，所有其他IP集选项也可以在没有<code class="literal">--permanent</code>选项的运行时环境中使用。
				</p><div class="warning" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">警告</h3><p>Red Hat建议不要使用不通过<code class="literal">firewalld</code>管理的IP集。要使用此类IP集，需要永久直接规则来引用该集，并且必须添加自定义服务才能创建这些IP集。需要在firewalld启动之前启动此服务，否则<code class="literal">firewalld</code>无法使用这些集添加直接规则。您可以使用<code class="literal">/etc/firewalld/direct.xml</code>文件添加永久直接规则。
					</p></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring-firewall-lockdown_using-and-configuring-firewalls"></a>配置防火墙锁定</h1></div></div></div><p>如果本地应用程序或服务以<code class="literal">root</code>身份运行（例如， <span class="strong"><strong><span class="application">libvirt</span></strong></span> ），则它们可以更改防火墙配置。使用此功能，管理员可以锁定防火墙配置，以便没有应用程序或仅添加到锁定白名单的应用程序能够请求防火墙更改。锁定设置默认为禁用。如果启用，用户可以确保本地应用程序或服务不会对防火墙进行不必要的配置更改。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-lockdown-with-the-command-line-client_configuring-firewall-lockdown"></a>使用CLI配置锁定</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要查询是否已启用锁定，请以<code class="literal">root</code>身份使用以下命令：</p><pre class="screen"># firewall-cmd --query-lockdown</pre><p class="simpara">该命令打印<code class="literal">yes</code>与退出状态<code class="literal">0</code> ，如果锁定被启用。它打印<code class="literal">no</code>带退出状态<code class="literal">1</code> ，否则。
						</p></li><li class="listitem"><p class="simpara">要启用锁定，请以<code class="literal">root</code>身份输入以下命令：</p><pre class="screen"># firewall-cmd --lockdown-on</pre></li><li class="listitem"><p class="simpara">要禁用锁定，请以<code class="literal">root</code>身份使用以下命令：</p><pre class="screen"># firewall-cmd --lockdown-off</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-lockdown-whitelist-options-with-the-command-line-client_configuring-firewall-lockdown"></a>使用CLI配置锁定白名单选项</h2></div></div></div><p>锁定白名单可以包含命令，安全上下文，用户和用户ID。如果白名单上的命令条目以星号“*”结尾，则以该命令开头的所有命令行都将匹配。如果“*”不存在则包含参数的绝对命令必须匹配。
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">上下文是正在运行的应用程序或服务的安全性（SELinux）上下文。要获取正在运行的应用程序的上下文，请使用以下命令：</p><pre class="screen">$ <code class="literal">ps -e --context</code></pre><p class="simpara">该命令返回所有正在运行的应用通过<span class="strong"><strong><span class="application">grep</span></strong></span>工具管道输出以获得感兴趣的应用程序。例如：</p><pre class="screen">$ ps -e --context | grep example_program</pre></li><li class="listitem"><p class="simpara">要列出白名单中的所有命令行，请以<code class="literal">root</code>身份输入以下命令：</p><pre class="screen"># firewall-cmd --list-lockdown-whitelist-commands</pre></li><li class="listitem"><p class="simpara">要将命令<span class="emphasis"><em>命令</em></span>添加到白名单，请以<code class="literal">root</code>身份输入以下命令：</p><pre class="screen"># firewall-cmd --add-lockdown-whitelist-command='/usr/bin/python3 -Es /usr/bin/command'</pre></li><li class="listitem"><p class="simpara">要从白名单中删除命令<span class="emphasis"><em>命令</em></span> ，请以<code class="literal">root</code>身份输入以下命令：</p><pre class="screen"># firewall-cmd --remove-lockdown-whitelist-command='/usr/bin/python3 -Es /usr/bin/command'</pre></li><li class="listitem"><p class="simpara">要查询命令<span class="emphasis"><em>命令</em></span>是否在白名单中，请以<code class="literal">root</code>身份输入以下命令：</p><pre class="screen"># firewall-cmd --query-lockdown-whitelist-command='/usr/bin/python3 -Es /usr/bin/command'</pre><p class="simpara">如果为true，则命令输出<code class="literal">yes</code> ，退出状态为<code class="literal">0</code> 。它打印<code class="literal">no</code>带退出状态<code class="literal">1</code> ，否则。
						</p></li><li class="listitem"><p class="simpara">要列出白名单中的所有安全上下文，请以<code class="literal">root</code>身份输入以下命令：</p><pre class="screen"># firewall-cmd --list-lockdown-whitelist-contexts</pre></li><li class="listitem"><p class="simpara">要将上下文<span class="emphasis"><em>上下文</em></span>添加到白名单，请以<code class="literal">root</code>身份输入以下命令：</p><pre class="screen"># firewall-cmd --add-lockdown-whitelist-context=context</pre></li><li class="listitem"><p class="simpara">要从白名单中删除上下文<span class="emphasis"><em>上下文</em></span> ，请以<code class="literal">root</code>身份输入以下命令：</p><pre class="screen"># firewall-cmd --remove-lockdown-whitelist-context=context</pre></li><li class="listitem"><p class="simpara">要查询上下文<span class="emphasis"><em>上下文</em></span>是否在白名单中，请以<code class="literal">root</code>身份输入以下命令：</p><pre class="screen"># firewall-cmd --query-lockdown-whitelist-context=context</pre><p class="simpara">使用退出状态<code class="literal">0</code>打印<code class="literal">yes</code> ，如果为真，则打印<code class="literal">no</code> ，退出状态为<code class="literal">1</code> 。
						</p></li><li class="listitem"><p class="simpara">要列出白名单中的所有用户标识，请以<code class="literal">root</code>身份输入以下命令：</p><pre class="screen"># firewall-cmd --list-lockdown-whitelist-uids</pre></li><li class="listitem"><p class="simpara">要将用户标识<span class="emphasis"><em>uid</em></span>添加到白名单，请以<code class="literal">root</code>身份输入以下命令：</p><pre class="screen"># firewall-cmd --add-lockdown-whitelist-uid=uid</pre></li><li class="listitem"><p class="simpara">要从白名单中删除用户ID <span class="emphasis"><em>uid</em></span> ，请以<code class="literal">root</code>身份输入以下命令：</p><pre class="screen"># firewall-cmd --remove-lockdown-whitelist-uid=uid</pre></li><li class="listitem"><p class="simpara">要查询用户标识<span class="emphasis"><em>uid</em></span>是否在白名单中，请输入以下命令：</p><pre class="screen">$ <code class="literal">firewall-cmd --query-lockdown-whitelist-uid=<span class="emphasis"><em>uid</em></span></code></pre><p class="simpara">使用退出状态<code class="literal">0</code>打印<code class="literal">yes</code> ，如果为真，则打印<code class="literal">no</code> ，退出状态为<code class="literal">1</code> 。
						</p></li><li class="listitem"><p class="simpara">要列出白名单中的所有用户名，请以<code class="literal">root</code>身份输入以下命令：</p><pre class="screen"># firewall-cmd --list-lockdown-whitelist-users</pre></li><li class="listitem"><p class="simpara">要将用户名<span class="emphasis"><em>用户</em></span>添加到白名单，请以<code class="literal">root</code>身份输入以下命令：</p><pre class="screen"># firewall-cmd --add-lockdown-whitelist-user=user</pre></li><li class="listitem"><p class="simpara">要从白名单中删除用户名<span class="emphasis"><em>用户</em></span> ，请以<code class="literal">root</code>身份输入以下命令：</p><pre class="screen"># firewall-cmd --remove-lockdown-whitelist-user=user</pre></li><li class="listitem"><p class="simpara">要查询用户名<span class="emphasis"><em>用户</em></span>是否在白名单中，请输入以下命令：</p><pre class="screen">$ <code class="literal">firewall-cmd --query-lockdown-whitelist-user=<span class="emphasis"><em>user</em></span></code></pre><p class="simpara">使用退出状态<code class="literal">0</code>打印<code class="literal">yes</code> ，如果为真，则打印<code class="literal">no</code> ，退出状态为<code class="literal">1</code> 。
						</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-lockdown-whitelist-options-with-configuration-files_configuring-firewall-lockdown"></a>使用配置文件配置锁定白名单选项</h2></div></div></div><p>默认白名单配置文件包含<code class="literal">NetworkManager</code>上下文和<code class="literal">libvirt</code>的默认上下文。用户ID 0也在列表中。
				</p><pre class="screen">&lt;?xml version="1.0" encoding="utf-8"?&gt;
	&lt;whitelist&gt;
	  &lt;selinux context="system_u:system_r:NetworkManager_t:s0"/&gt;
	  &lt;selinux context="system_u:system_r:virtd_t:s0-s0:c0.c1023"/&gt;
	  &lt;user id="0"/&gt;
	&lt;/whitelist&gt;</pre><p>下面是一个示例的白名单的配置文件使为所有命令<code class="literal">firewall-cmd</code>效用，对于用户ID为用户被叫<span class="emphasis"><em>用户</em></span> <code class="literal">815</code> ：</p><pre class="screen">&lt;?xml version="1.0" encoding="utf-8"?&gt;
	&lt;whitelist&gt;
	  &lt;command name="/usr/libexec/platform-python -s /bin/firewall-cmd*"/&gt;
	  &lt;selinux context="system_u:system_r:NetworkManager_t:s0"/&gt;
	  &lt;user id="815"/&gt;
	  &lt;user name="user"/&gt;
	&lt;/whitelist&gt;</pre><p>此示例显示<code class="literal">user id</code>和<code class="literal">user name</code> ，但只需要一个选项。Python是解释器，并且在命令行之前。您还可以使用特定命令，例如：</p><pre class="screen"><code class="literal">/usr/bin/python3 /bin/firewall-cmd --lockdown-on</code></pre><p>在该示例中，仅允许使用<code class="literal">--lockdown-on</code>命令。
				</p><p>在Red Hat Enterprise Linux中，所有实用程序都放在<code class="literal">/usr/bin/</code>目录中，而<code class="literal">/bin/</code>目录是sym链接到<code class="literal">/usr/bin/</code>目录。换句话说，虽然以<code class="literal">root</code>身份输入时<code class="literal">firewall-cmd</code>的路径可能会解析为<code class="literal">/bin/firewall-cmd</code> ，但现在可以使用<code class="literal">/usr/bin/firewall-cmd</code> 。所有新脚本都应使用新位置。但请注意，如果编写以<code class="literal">root</code>身份运行的脚本以使用<code class="literal">/bin/firewall-cmd</code>路径，那么除了传统上仅用于非<code class="literal">root</code>的<code class="literal">/usr/bin/firewall-cmd</code>路径之外，该命令路径必须列入白名单用户。
				</p><p>命令的name属性末尾的<code class="literal">*</code>表示以此字符串开头的所有命令都匹配。如果<code class="literal">*</code>不存在那么包含参数的绝对命令必须匹配。
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="log-for-denied-packets_using-and-configuring-firewalls"></a>记录被拒绝的数据包</h1></div></div></div><p>使用<code class="literal">firewalld</code>的<code class="literal">LogDenied</code>选项，可以为拒绝的数据包添加简单的日志记录机制。这些是被拒绝或丢弃的数据包。要更改日志记录的设置，请编辑<code class="literal">/etc/firewalld/firewalld.conf</code>文件或使用命令行或GUI配置工具。
			</p><p>如果启用了<code class="literal">LogDenied</code> ，则会在拒绝之前添加日志记录规则，并在INPUT，FORWARD和OUTPUT链中添加规则以用于默认规则以及区域中的最终拒绝和删除规则。此设置的可能值包括： <code class="literal">all</code> ， <code class="literal">unicast</code> ， <code class="literal">broadcast</code> ， <code class="literal">multicast</code>和<code class="literal">off</code> 。默认设置为<code class="literal">off</code> 。通过<code class="literal">unicast</code> ， <code class="literal">broadcast</code>和<code class="literal">multicast</code>设置， <code class="literal">pkttype</code>匹配用于匹配链路层数据包类型。<code class="literal">all</code> ，所有数据包都会被记录。
			</p><p>要使用firewall-cmd列出实际的<code class="literal">LogDenied</code>设置，请以<code class="literal">root</code>身份使用以下命令：</p><pre class="screen"># firewall-cmd --get-log-denied
off</pre><p>要更改<code class="literal">LogDenied</code>设置，请以<code class="literal">root</code>身份使用以下命令：</p><pre class="screen"># firewall-cmd --set-log-denied=all
success</pre><p>要使用<code class="literal">firewalld</code> GUI配置工具更改<code class="literal">LogDenied</code>设置，请启动<span class="strong"><strong><span class="application">firewall-config</span></strong></span> ，单击“ <code class="literal">Options</code>菜单，然后选择“ <code class="literal">Change Log Denied</code> 。出现<code class="literal">LogDenied</code>窗口。从菜单中选择新的<code class="literal">LogDenied</code>设置，然后单击“确定”。</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="related-information-using-and-configuring-firewalls"></a>相关信息</h1></div></div></div><p>以下信息来源提供有关<code class="literal">firewalld</code>其他资源。
			</p><h3><a id="installed_documentation"></a>已安装的文档</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<code class="literal">firewalld(1)</code>手册页 - 描述<code class="literal">firewalld</code>命令选项。
					</li><li class="listitem">
						<code class="literal">firewalld.conf(5)</code>手册页 - 包含配置<code class="literal">firewalld</code>信息。
					</li><li class="listitem">
						<code class="literal">firewall-cmd(1)</code>手册页 - 介绍<code class="literal">firewalld</code>命令行客户端的命令选项。
					</li><li class="listitem">
						<code class="literal">firewall-config(1)</code>手册页 - 介绍<span class="strong"><strong><span class="application">firewall-config</span></strong></span>工具的设置。
					</li><li class="listitem">
						<code class="literal">firewall-offline-cmd(1)</code>手册页 - 介绍<code class="literal">firewalld</code>脱机命令行客户端的命令选项。
					</li><li class="listitem">
						<code class="literal">firewalld.icmptype(5)</code>手册页 - 描述<code class="literal">ICMP</code>过滤的XML配置文件。
					</li><li class="listitem">
						<code class="literal">firewalld.ipset(5)</code>手册页 - 描述<code class="literal">firewalld</code> <code class="literal">IP</code>集的XML配置文件。
					</li><li class="listitem">
						<code class="literal">firewalld.service(5)</code>手册页 - 描述<span class="strong"><strong><span class="application">firewalld服务的</span></strong></span> XML配置文件。
					</li><li class="listitem">
						<code class="literal">firewalld.zone(5)</code>手册页 - 描述<code class="literal">firewalld</code>区域配置的XML配置文件。
					</li><li class="listitem">
						<code class="literal">firewalld.direct(5)</code>手册页 - 介绍<code class="literal">firewalld</code>直接接口配置文件。
					</li><li class="listitem">
						<code class="literal">firewalld.lockdown-whitelist(5)</code>手册页 - 介绍<code class="literal">firewalld</code>锁定白名单配置文件。
					</li><li class="listitem">
						<code class="literal">firewalld.richlanguage(5)</code>手册页 - 描述了<code class="literal">firewalld</code>丰富的语言规则语法。
					</li><li class="listitem">
						<code class="literal">firewalld.zones(5)</code>手册页 - 有关哪些区域以及如何配置它们的一般说明。
					</li><li class="listitem">
						<code class="literal">firewalld.dbus(5)</code>手册页 - 描述了<code class="literal">firewalld</code>的<code class="literal">D-Bus</code>接口。
					</li></ul></div><h3><a id="online_documentation"></a>在线文档</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<a class="link" href="http://www.firewalld.org/">http://www.firewalld.org/</a> - <code class="literal">firewalld</code>主页。
					</li></ul></div></div></div></body></html>