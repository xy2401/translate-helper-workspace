<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 配置内核可调参数</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 配置内核可调参数</h1></div></div></div><p>作为系统管理员，您可以出于各种原因配置内核可调参数，例如提高系统性能。本节介绍如何使用<code class="literal">sysctl</code>命令以及修改<code class="literal">/etc/sysctl.d/</code>和<code class="literal">/proc/sys/</code>目录中的配置文件来配置内核可调参数。
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="what-are-kernel-tunables_configuring-kernel-tunables"></a>什么是内核可调参数</h1></div></div></div><p>内核可调参数是内核参数，可通过<code class="literal">sysctl</code>命令或安装在<code class="literal">/proc/sys/</code>目录下的虚拟文件系统进行寻址。也可以使用<code class="literal">/etc/sysctl.d/</code>目录中的配置文件来调整可调参数。可以在系统运行时调整内核参数。无需重新引导或重新编译内核以使更改生效。
			</p><p>可调参数由内核子系统分为类。Red Hat Enterprise Linux具有以下可调参数类：</p><div class="table"><a id="idm139880428236992"></a><p class="title"><strong>表4.1。sysctl类表</strong></p><div class="table-contents"><table border="1" summary="Table of sysctl classes"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th valign="top" style="text-align:left">可调课程</th><th valign="top" style="text-align:left">子系统</th></tr></thead><tbody><tr><td valign="top" style="text-align:left"> <p>ABI</p>
							 </td><td valign="top" style="text-align:left"> <p>执行域和个性</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>加密</p>
							 </td><td valign="top" style="text-align:left"> <p>加密接口</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>调试</p>
							 </td><td valign="top" style="text-align:left"> <p>内核调试接口</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>开发</p>
							 </td><td valign="top" style="text-align:left"> <p>特定于设备的信息</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>FS</p>
							 </td><td valign="top" style="text-align:left"> <p>全局和特定文件系统可调参数</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>核心</p>
							 </td><td valign="top" style="text-align:left"> <p>全局内核可调参数</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>净</p>
							 </td><td valign="top" style="text-align:left"> <p>网络可调参数</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>sunrpc</p>
							 </td><td valign="top" style="text-align:left"> <p>Sun远程过程调用（NFS）</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>用户</p>
							 </td><td valign="top" style="text-align:left"> <p>用户名空间限制</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>VM</p>
							 </td><td valign="top" style="text-align:left"> <p>调整和管理内存，缓冲区和缓存</p>
							 </td></tr></tbody></table></div></div><h3><a id="additional_resources_7"></a>其他资源</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关<code class="literal">sysctl</code>更多信息，请参见<code class="literal">sysctl(8)</code>手册页。
					</li><li class="listitem">有关<code class="literal">/etc/sysctl.d/</code>更多信息，请参阅<code class="literal">sysctl.d(5)</code>手册页。
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="setting-kernel-tunables_configuring-kernel-tunables"></a>设置内核可调参数</h1></div></div></div><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>在生产系统上配置内核可调参数需要仔细规划。计划外更改可能导致内核不稳定，需要重新启动系统。在更改任何内核值之前，请验证您是否使用了有效选项。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-kernel-tunables-temporarily-with-sysctl_setting-kernel-tunables"></a>使用sysctl临时配置内核可调参数</h2></div></div></div><p>以下过程描述如何使用<code class="literal">sysctl</code>命令临时设置内核可调参数。该命令对于列出和过滤可调参数也很有用。
				</p><h4><a id="prerequisites_4"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="link" href="configuring-kernel-tunables_managing-monitoring-and-updating-the-kernel.html#what-are-kernel-tunables_configuring-kernel-tunables" title="什么是内核可调参数">内核可调参数介绍</a>
						</li><li class="listitem">根权限</li></ul></div><h4><a id="procedure_6"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要列出所有可调参数，请使用以下命令：</p><pre class="literallayout"><code class="literal"># sysctl -a</code></pre><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>
								<code class="literal"># sysctl -a</code>显示内核可调参数，可在运行时和引导时进行调整。
							</p></div></li><li class="listitem"><p class="simpara">要临时配置可调参数，请使用以下示例中的命令：</p><pre class="literallayout"><code class="literal"># sysctl &lt;<span class="emphasis"><em>TUNABLE_CLASS</em></span>&gt;.&lt;<span class="emphasis"><em>TUNABLE</em></span>&gt;=&lt;<span class="emphasis"><em>TARGET_VALUE</em></span>&gt;</code></pre><p class="simpara">上面的示例命令在系统运行时更改可调参数值。更改立即生效，无需重新启动。
						</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>系统重新启动后，更改将恢复为默认值。
							</p></div></li></ol></div><h4><a id="additional_resources_8"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关<code class="literal">sysctl</code>更多信息，请参见<code class="literal">sysctl(8)</code>手册页。
						</li><li class="listitem">要永久修改内核可调参数，请使用<a class="link" href="configuring-kernel-tunables_managing-monitoring-and-updating-the-kernel.html#configuring-kernel-tunables-permanently-with-sysctl_setting-kernel-tunables" title="使用sysctl永久配置内核可调参数"><code class="literal">sysctl</code>命令</a>将值写入<code class="literal">/etc/sysctl.conf</code>文件，或手动更改<a class="link" href="configuring-kernel-tunables_managing-monitoring-and-updating-the-kernel.html#using-configuration-files-in-etc-sysctl-d-to-adjust-kernel-tunables_setting-kernel-tunables" title="使用/etc/sysctl.d/中的配置文件来调整内核可调参数"><code class="literal">/etc/sysctl.d/</code>目录中</a>的配置文件。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-kernel-tunables-permanently-with-sysctl_setting-kernel-tunables"></a>使用sysctl永久配置内核可调参数</h2></div></div></div><p>以下过程描述如何使用<code class="literal">sysctl</code>命令永久设置内核可调参数。
				</p><h4><a id="prerequisites_5"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="link" href="configuring-kernel-tunables_managing-monitoring-and-updating-the-kernel.html#what-are-kernel-tunables_configuring-kernel-tunables" title="什么是内核可调参数">内核可调参数介绍</a>
						</li><li class="listitem">根权限</li></ul></div><h4><a id="procedure_7"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要列出所有可调参数，请使用以下命令：</p><pre class="literallayout"><code class="literal"># sysctl -a</code></pre><p class="simpara">该命令显示可在运行时配置的所有内核可调参数。
						</p></li><li class="listitem"><p class="simpara">要永久配置可调参数：</p><pre class="literallayout"><code class="literal"># sysctl -w &lt;<span class="emphasis"><em>TUNABLE_CLASS</em></span>&gt;.&lt;<span class="emphasis"><em>TUNABLE</em></span>&gt;=&lt;<span class="emphasis"><em>TARGET_VALUE</em></span>&gt; &gt;&gt; /etc/sysctl.conf</code></pre><p class="simpara">sample命令更改可调参数值并将其写入<code class="literal">/etc/sysctl.conf</code>文件，该文件将覆盖内核可调参数的默认值。更改会立即生效，不需要重新启动。
						</p></li></ol></div><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>要永久修改内核可调参数，您还可以手动更改<code class="literal">/etc/sysctl.d/</code>目录中的配置文件。
					</p></div><h4><a id="additional_resources_9"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关<code class="literal">sysctl</code>更多信息，请参见<code class="literal">sysctl(8)</code>和<code class="literal">sysctl.conf(5)</code>手册页。
						</li><li class="listitem">有关使用<code class="literal">/etc/sysctl.d/</code>目录中的配置文件对内核可调参数进行永久性更改的更多信息，请参阅<a class="link" href="configuring-kernel-tunables_managing-monitoring-and-updating-the-kernel.html#using-configuration-files-in-etc-sysctl-d-to-adjust-kernel-tunables_setting-kernel-tunables" title="使用/etc/sysctl.d/中的配置文件来调整内核可调参数">使用/etc/sysctl.d/中的配置文件来调整内核可调参数</a>部分。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="using-configuration-files-in-etc-sysctl-d-to-adjust-kernel-tunables_setting-kernel-tunables"></a>使用/etc/sysctl.d/中的配置文件来调整内核可调参数</h2></div></div></div><p>以下过程介绍如何手动修改<code class="literal">/etc/sysctl.d/</code>目录中的配置文件以永久设置内核可调参数。
				</p><h4><a id="prerequisites_6"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="link" href="configuring-kernel-tunables_managing-monitoring-and-updating-the-kernel.html#what-are-kernel-tunables_configuring-kernel-tunables" title="什么是内核可调参数">内核可调参数介绍</a>
						</li><li class="listitem">根权限</li></ul></div><h4><a id="procedure_8"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">在<code class="literal">/etc/sysctl.d/</code>创建一个新的配置文件：</p><pre class="literallayout"><code class="literal"># vim /etc/sysctl.d/&lt;<span class="emphasis"><em>some_file.conf</em></span>&gt;</code></pre></li><li class="listitem"><p class="simpara">包括内核可调参数，每行一个，如下所示：</p><pre class="literallayout"><code class="literal">&lt;<span class="emphasis"><em>TUNABLE_CLASS</em></span>&gt;.&lt;<span class="emphasis"><em>TUNABLE</em></span>&gt;=&lt;<span class="emphasis"><em>TARGET_VALUE</em></span>&gt;</code>
<code class="literal">&lt;<span class="emphasis"><em>TUNABLE_CLASS</em></span>&gt;.&lt;<span class="emphasis"><em>TUNABLE</em></span>&gt;=&lt;<span class="emphasis"><em>TARGET_VALUE</em></span>&gt;</code></pre></li><li class="listitem">保存配置文件。
						</li><li class="listitem"><p class="simpara">重新启动计算机以使更改生效。
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">或者，要在不重新引导的情况下应用更改，请执</p><pre class="literallayout"><code class="literal"># sysctl -p /etc/sysctl.d/&lt;<span class="emphasis"><em>some_file.conf</em></span>&gt;</code></pre><p class="simpara">该命令使您可以从先前创建的配置文件中读取值。
								</p></li></ul></div></li></ol></div><h4><a id="additional_resources_10"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关<code class="literal">sysctl</code>更多信息，请参见<code class="literal">sysctl(8)</code>手册页。
						</li><li class="listitem">有关<code class="literal">/etc/sysctl.d/</code>更多信息，请参阅<code class="literal">sysctl.d(5)</code>手册页。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-kernel-tunables-temporarily-through-proc-sys_setting-kernel-tunables"></a>通过/ proc / sys /临时配置内核可调参数</h2></div></div></div><p>以下过程描述如何通过虚拟文件系统<code class="literal">/proc/sys/</code>目录中的文件临时设置内核可调参数。
				</p><h4><a id="prerequisites_7"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="link" href="configuring-kernel-tunables_managing-monitoring-and-updating-the-kernel.html#what-are-kernel-tunables_configuring-kernel-tunables" title="什么是内核可调参数">内核可调参数介绍</a>
						</li><li class="listitem">根权限</li></ul></div><h4><a id="procedure_9"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">确定要配置的内核可调参数：</p><pre class="literallayout"><code class="literal"># ls -l /proc/sys/&lt;<span class="emphasis"><em>TUNABLE_CLASS</em></span>&gt;/</code></pre><p class="simpara">该命令返回的可写文件可用于配置内核。具有只读权限的文件提供有关当前设置的反馈。
						</p></li><li class="listitem"><p class="simpara">将目标值分配给内核可调参数：</p><pre class="literallayout"><code class="literal"># echo &lt;<span class="emphasis"><em>TARGET_VALUE</em></span>&gt; &gt; /proc/sys/&lt;<span class="emphasis"><em>TUNABLE_CLASS</em></span>&gt;/&lt;<span class="emphasis"><em>TUNABLE</em></span>&gt;</code></pre><p class="simpara">该命令使配置更改在系统重新启动后将消失。
						</p></li><li class="listitem"><p class="simpara">（可选）验证新设置的内核可调参数的值：</p><pre class="literallayout"><code class="literal"># cat /proc/sys/&lt;<span class="emphasis"><em>TUNABLE_CLASS</em></span>&gt;/&lt;<span class="emphasis"><em>TUNABLE</em></span>&gt;</code></pre></li></ol></div><h4><a id="additional_resources_11"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">要永久修改内核可调参数，请使用<a class="link" href="configuring-kernel-tunables_managing-monitoring-and-updating-the-kernel.html#configuring-kernel-tunables-permanently-with-sysctl_setting-kernel-tunables" title="使用sysctl永久配置内核可调参数"><code class="literal">sysctl</code>命令</a>或手动更改<a class="link" href="configuring-kernel-tunables_managing-monitoring-and-updating-the-kernel.html#using-configuration-files-in-etc-sysctl-d-to-adjust-kernel-tunables_setting-kernel-tunables" title="使用/etc/sysctl.d/中的配置文件来调整内核可调参数"><code class="literal">/etc/sysctl.d/</code>目录中</a>的配置文件。
						</li></ul></div></div></div></div></body></html>