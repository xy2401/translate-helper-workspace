<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 使用eh_deadline配置存储错误恢复的最长时间</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 使用eh_deadline配置存储错误恢复的最长时间</h1></div></div></div><p>您可以配置恢复故障SCSI设备的最大允许时间。即使存储硬件由于故障而无响应，此配置也可确保I / O响应时间。
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="the-eh_deadline-parameter_configuring-maximum-time-for-storage-error-recovery-with-eh_deadline"></a> eh_deadline参数</h1></div></div></div><p>SCSI错误处理（EH）机制尝试在发生故障的SCSI设备上执行错误恢复。SCSI主机对象<code class="literal">eh_deadline</code>参数使您可以配置恢复的最长时间。配置的时间到期后，SCSI EH将停止并重置整个主机总线适配器（HBA）。
			</p><p>使用<code class="literal">eh_deadline</code>可以减少时间：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">关闭失败的路径，</li><li class="listitem">切换路径，或</li><li class="listitem">禁用RAID片。
					</li></ul></div><div class="warning" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">警告</h3><p>当<code class="literal">eh_deadline</code>到期时，SCSI EH会重置HBA，这会影响该HBA上的所有目标路径，而不仅仅是失败的路径。如果某些冗余路径由于其他原因而不可用，则可能发生I / O错误。仅当所有目标上都具有完全冗余的多路径配置时，才启用<code class="literal">eh_deadline</code> 。
				</p></div><h3><a id="scenarios_when_eh_deadline_is_useful"></a> eh_deadline有用的场景</h3><p>在大多数情况下，您无需启用<code class="literal">eh_deadline</code> 。在某些特定情况下使用<code class="literal">eh_deadline</code>非常有用，例如，如果光纤通道（FC）交换机与目标端口之间发生链路丢失，并且HBA未收到注册状态更改通知（RSCN）。在这种情况下，I / O请求和错误恢复命令都会超时，而不是遇到错误。在此环境中设置<code class="literal">eh_deadline</code>为恢复时间设置上限。这样可以通过DM Multipath在另一个可用路径上重试失败的I / O.
			</p><p>在以下情况下， <code class="literal">eh_deadline</code>功能不会带来额外的好处，因为I / O和错误恢复命令会立即失败，从而允许DM Multipath重试：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">如果启用了RSCN</li><li class="listitem">如果HBA未注册链接变为不可用</li></ul></div><h3><a id="possible_values"></a>可能的值</h3><p><code class="literal">eh_deadline</code>的值以秒为单位指定。
			</p><p>默认设置为<code class="literal">off</code> ，禁用时间限制并允许进行所有错误恢复。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="setting-the-eh_deadline-parameter_configuring-maximum-time-for-storage-error-recovery-with-eh_deadline"></a>设置eh_deadline参数</h1></div></div></div><p>此过程配置<code class="literal">eh_deadline</code>参数的值以限制最大SCSI恢复时间。
			</p><h3><a id="procedure_44"></a>程序</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">您可以使用以下任一方法配置<code class="literal">eh_deadline</code> ：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">sysfs</code></span></dt><dd>将秒数写入<code class="literal">/sys/class/scsi_host/host*/eh_deadline</code>文件。
								</dd><dt><span class="term">内核参数</span></dt><dd>使用<code class="literal">scsi_mod.eh_deadline</code>内核参数为所有SCSI HBA设置默认值。
								</dd></dl></div></li></ul></div><h3><a id="additional_resources_37"></a>其他资源</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<a class="link" href="https://access.redhat.com/solutions/3209481">如何使用udev规则持久设置eh_deadline和eh_timeout</a>
					</li></ul></div></div></div></body></html>