<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 高可用性附加组件概述</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 高可用性附加组件概述</h1></div></div></div><p>High Availability Add-On是一个集群系统，可为关键生产服务提供可靠性，可伸缩性和可用性。
		</p><p>群集是两个或多个协同工作以执行任务的计算机（称为<span class="emphasis"><em>节点</em></span>或<span class="emphasis"><em>成员</em></span> ）。集群可用于提供高可用性服务或资源。多台机器的冗余用于防止多种类型的故障。
		</p><p>高可用性集群通过消除单点故障以及在节点不起作用的情况下将服务从一个集群节点故障转移到另一个集群节点来提供高可用性服务。通常，高可用性集群中的服务读写数据（通过读写安装的文件系统）。因此，高可用性集群必须保持数据完整性，因为一个集群节点接管来自另一个集群节点的服务的控制。群集外的客户端无法看到高可用性群集中的节点故障。（高可用性集群有时称为故障转移集群。）高可用性附加组件通过其高可用性服务管理组件<code class="literal">Pacemaker</code>提供高可用性群集。
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="con_high-availability-add-on-concepts-overview-of-high-availability"></a>高可用性附加组件</h1></div></div></div><p>高可用性附加组件包含以下主要组件：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">群集基础结构 - 为节点提供基本功能，以便作为群集协同工作：配置文件管理，成员资格管理，锁定管理和防护。
					</li><li class="listitem">高可用性服务管理 - 在节点不起作用的情况下，提供从一个集群节点到另一个集群节点的服务故障转移。
					</li><li class="listitem">群集管理工具 - 用于设置，配置和管理高可用性附加组件的配置和管理工具。这些工具用于群集基础结构组件，高可用性和服务管理组件以及存储。
					</li></ul></div><p>您可以使用以下组件补充高可用性附加组件：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Red Hat GFS2（全局文件系统2） -  Resilient Storage Add-On的一部分，它提供了一个与高可用性附加组件一起使用的集群文件系统。GFS2允许多个节点在块级别共享存储，就好像存储在本地连接到每个群集节点一样。GFS2群集文件系统需要群集基础结构。
					</li><li class="listitem">LVM锁定守护程序（ <code class="literal">lvmlockd</code> ） - 弹性存储附加组件的一部分，它提供了群集存储的卷管理。 <code class="literal">lvmlockd</code>支持还需要集群基础结构。
					</li><li class="listitem">Load Balancer Add-On  - 在第4层（TCP）和第7层（HTTP，HTTPS）服务中提供高可用性负载平衡和故障转移的路由软件。Load Balancer Add-On在冗余虚拟路由器集群中运行，该冗余虚拟路由器使用加载算法将客户端请求分发到真实服务器，共同充当虚拟服务器。没有必要将Load Balancer Add-On与Pacemaker结合使用。
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="s1-Pacemakeroverview-HAAO"></a>起搏器概述</h1></div></div></div><p>Pacemaker是一个集群资源管理器。它通过利用群集基础结构的消息传递和成员资格功能来阻止和恢复节点和资源级故障，从而实现群集服务和资源的最大可用性。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="s2-Pacemakerarchitecture-HAAO"></a> Pacemaker架构组件</h2></div></div></div><p>使用Pacemaker配置的集群包括监视集群成员资格的单独组件守护程序，管理服务的脚本以及监视不同资源的资源管理子系统。
				</p><p>以下组件构成了Pacemaker架构：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">群集信息库（CIB）</span></dt><dd>Pacemaker信息守护程序，它在内部使用XML来分配和同步来自指定协调器（DC）的当前配置和状态信息 - 由Pacemaker分配的节点，用于通过CIB存储和分发集群状态和操作 - 到所有其他集群节点。
							</dd><dt><span class="term">群集资源管理守护程序（CRMd）</span></dt><dd><p class="simpara">Pacemaker群集资源操作通过此守护程序进行路由。CRMd管理的资源可以由客户端系统查询，移动，实例化，并在需要时进行更改。
							</p><p class="simpara">每个群集节点还包括本地资源管理器守护程序（LRMd），它充当CRMd和资源之间的接口。LRMd将命令从CRMd传递给代理，例如启动和停止以及中继状态信息。
							</p></dd><dt><span class="term">拍摄头部的其他节点（STONITH）</span></dt><dd>STONITH是Pacemaker击剑实施。它充当Pacemaker中的群集资源，用于处理围栅请求，强制关闭节点并将其从群集中移除以确保数据完整性。STONITH在CIB中配置，可以作为普通群集资源进行监视。有关防护的一般概述，请参阅<a class="xref" href="assembly_overview-of-high-availability-configuring-and-managing-high-availability-clusters.html#s1-fencing-HAAO" title="击剑概述">“防护概述”一节</a> 。
							</dd><dt><span class="term">corosync</span></dt><dd><p class="simpara">
								<code class="literal">corosync</code>是组件 - 以及同名守护程序 - 为高可用性集群提供核心成员资格和成员通信需求。高可用性附加组件需要它才能运行。
							</p><p class="simpara">除了那些成员资格和消息传递功能， <code class="literal">corosync</code>还：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">管理法定人数规则和决心。
									</li><li class="listitem">为跨多个集群成员协调或操作的应用程序提供消息传递功能，因此必须在实例之间传递有状态信息或其他信息。
									</li><li class="listitem">使用<code class="literal">kronosnet</code>库作为其网络传输，以提供多个冗余链接和自动故障转移。
									</li></ul></div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="s2-Pacemakertools-HAAO"></a>配置和管理工具</h2></div></div></div><p>高可用性附加组件具有两个用于集群部署，监视和管理的配置工具。
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">个</code></span></dt><dd><p class="simpara"><code class="literal">pcs</code>命令行界面控制和配置Pacemaker和<code class="literal">corosync</code>心跳守护进程。基于命令行的程序， <code class="literal">pcs</code>可以执行以下集群管理任务：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">创建和配置Pacemaker / Corosync集群</li><li class="listitem">在群集运行时修改群集的配置</li><li class="listitem">远程配置Pacemaker和Corosync，以及启动，停止和显示群集的状态信息</li></ul></div></dd><dt><span class="term"><code class="literal">pcsd</code> Web UI</span></dt><dd>用于创建和配置Pacemaker / Corosync集群的图形用户界面。
							</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="s1-configfileoverview-HAAR"></a>集群和起搏器配置文件</h2></div></div></div><p>Red Hat High Availability Add-On的配置文件是<code class="literal">corosync.conf</code>和<code class="literal">cib.xml</code> 。
				</p><p><code class="literal">corosync.conf</code>文件提供<code class="literal">corosync.conf</code>使用的集群参数， <code class="literal">corosync</code>是构建Pacemaker的集群管理器。通常，您不应直接编辑<code class="literal">corosync.conf</code> ，而应使用<code class="literal">pcs</code>或<code class="literal">pcsd</code>接口。但是，您可能需要直接编辑此文件。
				</p><p><code class="literal">cib.xml</code>文件是一个XML文件，它表示群集的配置和群集中所有资源的当前状态。该文件由Pacemaker的群集信息库（CIB）使用。CIB的内容在整个群集中自动保持同步。不要直接编辑<code class="literal">cib.xml</code>文件;请改用<code class="literal">pcs</code>或<code class="literal">pcsd</code>接口。
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="s1-fencing-HAAO"></a>击剑概述</h1></div></div></div><p>如果与群集中的单个节点的通信失败，则群集中的其他节点必须能够限制或释放对发生故障的群集节点可能访问的资源的访问权限。这不能通过联系群集节点本身来完成，因为群集节点可能没有响应。相反，您必须提供一个外部方法，称为fencing with fence agent。fence设备是一个外部设备，群集可以使用它来限制错误节点对共享资源的访问，或者在群集节点上发出硬重启。
			</p><p>如果未配置fence设备，则无法知道已断开连接的群集节点以前使用的资源是否已释放，这可能会阻止服务在任何其他群集节点上运行。相反，系统可能错误地假定群集节点已释放其资源，这可能导致数据损坏和数据丢失。如果没有配置fence设备，则无法保证数据完整性，并且不支持群集配置。
			</p><p>当防护正在进行时，不允许运行其他集群操作。在重新启动群集节点之后，在完成防护或群集节点重新加入群集之前，群集的正常操作无法恢复。
			</p><p>有关防护的更多信息，请参阅<a class="link" href="https://access.redhat.com/solutions/15575">Red Hat高可用性群集中的防护</a> 。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="s1-quorumoverview-HAAO"></a>法定人数概述</h1></div></div></div><p>为了维护集群的完整性和可用性，集群系统使用称为<span class="emphasis"><em>仲裁</em></span>的概念来防止数据损坏和丢失。当超过一半的群集节点在线时，群集具有仲裁。为了减少因故障导致数据损坏的可能性，如果群集没有仲裁，Pacemaker默认会停止所有资源。
			</p><p>仲裁是使用投票系统建立的。当群集节点不能正常工作或失去与群集其余部分的通信时，大多数工作节点可以投票隔离，并且如果需要，可以对节点进行隔离以进行服务。
			</p><p>例如，在6节点群集中，当至少4个群集节点正在运行时，将建立仲裁。如果大多数节点脱机或变为不可用，则群集不再具有仲裁，Pacemaker将停止群集服务。
			</p><p>Pacemaker中的法定人数功能可以防止所谓的<span class="emphasis"><em>裂脑</em></span> ，这种现象是群集与通信分离但每个部分继续作为单独的群集工作，可能写入相同的数据并可能导致损坏或丢失。有关处于裂脑状态的含义以及一般仲裁概念的更多信息，请参阅<a class="link" href="https://access.redhat.com/articles/2824071">探索RHEL高可用性群集的概念 - 仲裁</a> 。
			</p><p>红帽企业Linux高可用性附加组件使用<code class="literal">votequorum</code>服务与屏蔽相结合，以避免裂脑情况。为集群中的每个系统分配了多个投票，并且只有在存在大多数投票时才允许集群操作继续进行。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="s1-resourceoverview-HAAO"></a>资源概述</h1></div></div></div><p><span class="emphasis"><em>群集资源</em></span>是要由群集服务管理的程序，数据或应用程序的实例。这些资源由<span class="emphasis"><em>代理</em></span>提取，这些<span class="emphasis"><em>代理</em></span>提供用于管理群集环境中的资源的标准接口。
			</p><p>要确保资源保持健康，可以将监视操作添加到资源的定义中。如果未指定资源的监视操作，则默认添加一个。
			</p><p>您可以通过配置<span class="emphasis"><em>约束</em></span>来确定群集中资源的行为。您可以配置以下类别的约束：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">位置约束 - 位置约束确定资源可以在哪些节点上运行。
					</li><li class="listitem">排序约束 - 排序约束确定资源运行的顺序。
					</li><li class="listitem">共置约束 - 共置约束确定资源相对于其他资源的放置位置。
					</li></ul></div><p>群集中最常见的元素之一是需要一起定位，按顺序启动并以相反顺序停止的一组资源。为简化此配置，Pacemaker支持<span class="emphasis"><em>组</em></span>的概念。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="con_HA-lvm-shared-volumes-overview-of-high-availability"></a> Red Hat高可用性集群中的LVM逻辑卷</h1></div></div></div><p>红帽高可用性附加组件为两种不同的群集配置中的LVM卷提供支持：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">主动/被动故障切换配置中的高可用性LVM卷（HA-LVM），其中任何时候只有群集的单个节点访问存储。
					</li><li class="listitem">使用<code class="literal">lvmlockd</code>守护程序管理主动/主动配置中的存储设备的LVM卷，其中群集的多个节点需要同时访问存储。<code class="literal">lvmlockd</code>守护程序是Resilient Storage Add-On的一部分。
					</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="choosing_ha_lvm_or_shared_volumes"></a>选择HA-LVM或共享卷</h2></div></div></div><p>何时使用HA-LVM或由<code class="literal">lvmlockd</code>守护程序管理的共享逻辑卷应基于所部署的应用程序或服务的需要。
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">如果群集的多个节点需要同时对主动/主动系统中的LVM卷进行读/写访问，则必须使用<code class="literal">lvmlockd</code>守护程序并将卷配置为共享卷。<code class="literal">lvmlockd</code>守护程序提供了一个系统，用于同时协调跨群集节点的LVM卷的激活和更改。<code class="literal">lvmlockd</code>守护程序的锁定服务为LVM元数据提供保护，因为集群的各个节点与卷交互并更改其布局。此保护取决于将跨多个群集节点同时激活的任何卷组配置为共享卷。
						</li><li class="listitem">如果高可用性集群配置为以主动/被动方式管理共享资源，并且一次只有一个成员需要访问给定的LVM卷，则可以使用HA-LVM而不使用<code class="literal">lvmlockd</code>锁定服务。
						</li></ul></div><p>大多数应用程序在主动/被动配置中运行得更好，因为它们未经过设计或优化，无法与其他实例同时运行。选择在共享逻辑卷上运行不支持群集的应用程序可能会导致性能下降。这是因为在这些实例中逻辑卷本身存在集群通信开销。支持群集的应用程序必须能够实现高于群集文件系统和群集感知逻辑卷引入的性能损失的性能提升。某些应用程序和工作负载比其他应用程序和工作负载更容易实现。确定群集的要求以及优化主动/主动群集的额外工作是否会带来好处是在两种LVM变体之间进行选择的方法。大多数用户将使用HA-LVM获得最佳HA结果。</p><p>使用<code class="literal">lvmlockd</code> HA-LVM和共享逻辑卷的相似之处在于它们可以防止LVM元数据及其逻辑卷损坏，否则如果允许多台计算机进行重叠更改，则可能会发生这种情况。HA-LVM强制限制逻辑卷只能被激活;也就是说，一次只能在一台机器上激活。这意味着仅使用存储驱动程序的本地（非群集）实现。以这种方式避免集群协调开销可提高性能。使用<code class="literal">lvmlockd</code>的共享卷不会强加这些限制，用户可以自由地在集群中的所有计算机上激活逻辑卷。这迫使使用群集感知存储驱动程序，这允许将群集感知文件系统和应用程序放在首位。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_lvm_volumes_in_a_cluster"></a>在群集中配置LVM卷</h2></div></div></div><p>在Red Hat Enterprise Linux 8中，集群通过Pacemaker进行管理。HA-LVM和共享逻辑卷仅与Pacemaker群集一起受支持，并且必须配置为群集资源。
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">有关将HA-LVM卷配置为Pacemaker集群的一部分的过程示例，请参阅<a class="link" href="assembly_configuring-active-passive-http-server-in-a-cluster-configuring-and-managing-high-availability-clusters.html" title="Chapter 9. 在Red Hat High Availability集群中配置主动/被动Apache HTTP服务器">在Red Hat High Availability集群中配置主动/被动Apache HTTP服务器</a> 。和<a class="link" href="assembly_configuring-active-passive-nfs-server-in-a-cluster-configuring-and-managing-high-availability-clusters.html" title="Chapter 9. 在Red Hat High Availability集群中配置主动/被动NFS服务器">在Red Hat High Availability集群中配置主动/被动NFS服务器</a> 。
						</p><p class="simpara">请注意，这些过程包括以下步骤：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">确保只有群集能够激活卷组</li><li class="listitem">配置LVM逻辑卷</li><li class="listitem">将LVM卷配置为群集资源</li></ul></div></li><li class="listitem">有关配置使用<code class="literal">lvmlockd</code>守护程序管理主动/主动配置中的存储设备的共享LVM卷的过程，请参阅<a class="link" href="assembly_configuring-gfs2-in-a-cluster-configuring-and-managing-high-availability-clusters.html#proc_configuring-gfs2-in-a-cluster.adoc-configuring-gfs2-cluster" title="在群集中配置GFS2文件系统">在群集中配置GFS2文件系统</a>
						</li></ul></div></div></div></div></body></html>