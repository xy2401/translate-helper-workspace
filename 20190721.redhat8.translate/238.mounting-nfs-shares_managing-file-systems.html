<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 挂载NFS共享</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 挂载NFS共享</h1></div></div></div><p>作为系统管理员，您可以在系统上安装远程NFS共享以访问共享数据。
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="introduction-to-nfs_mounting-nfs-shares"></a> NFS简介</h1></div></div></div><p>本节介绍NFS服务的基本概念。
			</p><p>网络文件系统（NFS）允许远程主机通过网络安装文件系统，并与这些文件系统进行交互，就好像它们是本地安装的一样。这使您可以将资源整合到网络上的中央服务器上。
			</p><p>NFS服务器引用<code class="literal">/etc/exports</code>配置文件以确定是否允许客户端访问任何导出的文件系统。验证后，用户可以使用所有文件和目录操作。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="supported-nfs-versions_mounting-nfs-shares"></a>支持的NFS版本</h1></div></div></div><p>本节列出了Red Hat Enterprise Linux中支持的NFS版本及其功能。
			</p><p>目前，Red Hat Enterprise Linux 8支持以下主要版本的NFS：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">NFS版本3（NFSv3）支持安全的异步写入，并且在错误处理方面比以前的NFSv2更强大;它还支持64位文件大小和偏移，允许客户端访问超过2 GB的文件数据。
					</li><li class="listitem">NFS版本4（NFSv4）通过防火墙和Internet工作，不再需要<code class="literal">rpcbind</code>服务，支持访问控制列表（ACL），并利用有状态操作。
					</li></ul></div><p>Red Hat不再支持NFS版本2（NFSv2）。
			</p><h3><a id="default_nfs_version"></a>默认NFS版本</h3><p>Red Hat Enterprise Linux 8中的默认NFS版本是4.2。NFS客户端默认尝试使用NFSv4.2挂载，当服务器不支持NFSv4.2时，会回退到NFSv4.1。然后，mount将回退到NFSv4.0，然后再回到NFSv3。
			</p><h3><a id="features_of_minor_nfs_versions"></a>次要NFS版本的功能</h3><p>以下是Red Hat Enterprise Linux 8中NFSv4.2的功能：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">服务器端副本</span></dt><dd>使NFS服务器能够有效地复制数据，而不会使用<code class="literal">copy_file_range()</code>系统调用浪费网络资源。
						</dd><dt><span class="term">稀疏文件</span></dt><dd>允许文件具有一个或多个<span class="emphasis"><em>孔</em></span> ，这些<span class="emphasis"><em>孔</em></span>是未分配的或未初始化的数据块，仅包含零。NFSv4.2中的<code class="literal">lseek()</code>操作支持<code class="literal">seek_hole()</code>和<code class="literal">seek_data()</code> ，它使应用程序能够映射稀疏文件中的孔的位置。
						</dd><dt><span class="term">空间预订</span></dt><dd>允许存储服务器保留可用空间，从而禁止服务器空间不足。NFSv4.2支持使用<code class="literal">allocate()</code>操作来保留空间，使用<code class="literal">deallocate()</code>操作来保留空间，并使用<code class="literal">fallocate()</code>操作来预分配或释放文件中的空间。
						</dd><dt><span class="term">标记的NFS</span></dt><dd>强制实施数据访问权限，并在客户端和服务器之间为NFS文件系统上的单个文件启用SELinux标签。
						</dd><dt><span class="term">布局增强功能</span></dt><dd>提供<code class="literal">layoutstats()</code>操作，使某些并行NFS（pNFS）服务器能够收集更好的性能统计信息。
						</dd></dl></div><p>以下是NFSv4.1的功能：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">增强网络的性能和安全性，还包括对pNFS的客户端支持。</li><li class="listitem">不再需要单独的TCP连接用于回调，这允许NFS服务器即使在无法联系客户端时也授予授权：例如，当NAT或防火墙干扰时。
					</li><li class="listitem">提供一次语义（重启操作除外），防止以前的问题，如果回复丢失且操作发送两次，某些操作有时会返回不准确的结果。
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="services-required-by-nfs_mounting-nfs-shares"></a> NFS所需的服务</h1></div></div></div><p>本节列出了运行NFS服务器或挂载NFS共享所需的系统服务。红帽企业Linux自动启动这些服务。
			</p><p>红帽企业Linux使用内核级支持和服务进程的组合来提供NFS文件共享。所有NFS版本都依赖于客户端和服务器之间的远程过程调用（RPC）。要共享或装载NFS文件系统，以下服务将根据实现的NFS版本协同工作：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">nfsd</code></span></dt><dd>NFS服务器为共享NFS文件系统的请求提供服务。
						</dd><dt><span class="term"><code class="literal">rpcbind</code></span></dt><dd>接受来自本地RPC服务的端口预留。然后，这些端口可用（或通告），以便相应的远程RPC服务可以访问它们。<code class="literal">rpcbind</code>服务响应RPC服务请求并设置与请求的RPC服务的连接。这不适用于NFSv4。
						</dd><dt><span class="term"><code class="literal">rpc.mountd</code></span></dt><dd>NFS服务器使用此过程处理来自NFSv3客户端的<code class="literal">MOUNT</code>请求。它检查NFS服务器当前是否已导出所请求的NFS共享，并允许客户端访问它。如果允许装入请求，则<code class="literal">nfs-mountd</code>服务将回复成功状态，并将此NFS共享的文件句柄提供回NFS客户端。
						</dd><dt><span class="term"><code class="literal">rpc.nfsd</code></span></dt><dd>此过程可以定义服务器通告的显式NFS版本和协议。它与Linux内核一起使用以满足NFS客户端的动态需求，例如每次NFS客户端连接时提供服务器线程。此过程对应于<code class="literal">nfs-server</code>服务。
						</dd><dt><span class="term"><code class="literal">lockd</code></span></dt><dd>这是在客户端和服务器上运行的内核线程。它实现了网络锁管理器（NLM）协议，该协议使NFSv3客户端能够锁定服务器上的文件。无论何时运行NFS服务器以及何时挂载NFS文件系统，它都会自动启动。
						</dd><dt><span class="term"><code class="literal">rpc.statd</code></span></dt><dd>此过程实现网络状态监视器（NSM）RPC协议，该协议在NFS服务器重新启动时通知NFS客户端，而不会正常关闭。<code class="literal">rpc-statd</code>服务由<code class="literal">nfs-server</code>服务自动启动，不需要用户配置。这不适用于NFSv4。
						</dd><dt><span class="term"><code class="literal">rpc.rquotad</code></span></dt><dd>此过程为远程用户提供用户配额信息。<code class="literal">rpc-rquotad</code>服务由<code class="literal">nfs-server</code>服务自动启动，不需要用户配置。
						</dd><dt><span class="term"><code class="literal">rpc.idmapd</code></span></dt><dd><p class="simpara">此过程提供NFSv4客户端和服务器上行调用，它们在线上NFSv4名称（ <code class="literal"><span class="emphasis"><em>user</em></span>@<span class="emphasis"><em>domain</em></span></code>形式的字符串）与本地UID和GID之间进行映射。要使<code class="literal">idmapd</code>与NFSv4一起运行，必须配置<code class="literal">/etc/idmapd.conf</code>文件。至少应指定<code class="literal">Domain</code>参数，该参数定义NFSv4映射域。如果NFSv4映射域与DNS域名相同，则可以跳过此参数。客户端和服务器必须就NFSv4映射域达成一致，以使ID映射正常运行。
						</p><p class="simpara">只有NFSv4服务器使用<code class="literal">rpc.idmapd</code> ，它由<code class="literal">nfs-idmapd</code>服务启动。NFSv4客户端使用基于密钥环的<code class="literal">nfsidmap</code>实用程序，该实用程序由内核按需调用以执行ID映射。如果<code class="literal">nfsidmap</code>出现问题，客户端将回退到使用<code class="literal">rpc.idmapd</code> 。
						</p></dd></dl></div><h3><a id="the_rpc_services_with_nfsv4"></a>使用NFSv4的RPC服务</h3><p>安装和锁定协议已合并到NFSv4协议中。服务器还侦听众所周知的TCP端口2049。因此，NFSv4不需要与<code class="literal">rpcbind</code> ， <code class="literal">lockd</code>和<code class="literal">rpc-statd</code>服务进行交互。NFS服务器上仍然需要<code class="literal">nfs-mountd</code>服务来设置导出，但不涉及任何线上操作。
			</p><h3><a id="additional_resources"></a>其他资源</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">要配置不需要<code class="literal">rpcbind</code>的仅NFSv4服务器，请参阅<a class="xref" href="exporting-nfs-shares_managing-file-systems.html#configuring-an-nfsv4-only-server_exporting-nfs-shares" title="配置仅NFSv4服务器">“配置仅限NFSv4的服务器”一节</a> 。
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="nfs-host-name-formats_mounting-nfs-shares"></a> NFS主机名格式</h1></div></div></div><p>本节介绍在挂载或导出NFS共享时可用于指定主机的不同格式。
			</p><p>您可以使用以下格式指定主机：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">单机</span></dt><dd><p class="simpara">以下任一项：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">完全限定的域名（可由服务器解析）</li><li class="listitem">主机名（可以由服务器解析）</li><li class="listitem">一个IP地址。
								</li></ul></div></dd><dt><span class="term">使用通配符指定的系列机器</span></dt><dd><p class="simpara">你可以使用<code class="literal">*</code>或<code class="literal">?</code> 用于指定字符串匹配的字符。
						</p><p class="simpara">通配符不能与IP地址一起使用;但是，如果反向DNS查找失败，它们可能会意外地工作。在完全限定的域名中指定通配符时，通配符中不包含点（ <code class="literal">.</code> ）。例如， <code class="literal">*.example.com</code>包含<code class="literal">one.example.com</code>但不包含<code class="literal">one.two.example.com</code> 。
						</p></dd><dt><span class="term">IP网络</span></dt><dd><p class="simpara">以下任一格式均有效：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									<span class="emphasis"><em><span class="replaceable"><code class="literal">a.b.c.d/z</code></span></em></span> ，其中<span class="emphasis"><em><span class="replaceable"><code class="literal">a.b.c.d</code></span></em></span>是网络， <span class="emphasis"><em><span class="replaceable"><code class="literal">z</code></span></em></span>是网络掩码中的位数;例如<code class="literal">192.168.0.0/24</code> 。
								</li><li class="listitem">
									<span class="emphasis"><em><span class="replaceable"><code class="literal">a.b.c.d/netmask</code></span></em></span> ，其中<span class="emphasis"><em><span class="replaceable"><code class="literal">a.b.c.d</code></span></em></span>是网络， <span class="emphasis"><em><span class="replaceable"><code class="literal">netmask</code></span></em></span>是网络掩码;例如， <code class="literal">192.168.100.8/255.255.255.0</code> 。
								</li></ul></div></dd><dt><span class="term">网络组</span></dt><dd><code class="literal">@<span class="emphasis"><em>group-name</em></span></code>格式，其中<span class="emphasis"><em><span class="replaceable"><code class="literal">group-name</code></span></em></span>是NIS网络组名称。
						</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="installing-nfs_mounting-nfs-shares"></a>安装NFS</h1></div></div></div><p>此过程将安装装入或导出NFS共享所需的所有软件包。
			</p><h3><a id="procedure"></a>程序</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">安装<code class="literal">nfs-utils</code>包：</p><pre class="screen"># yum install nfs-utils</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="discovering-nfs-exports_mounting-nfs-shares"></a>发现NFS导出</h1></div></div></div><p>此过程可发现给定NFSv3或NFSv4服务器导出的文件系统。
			</p><h3><a id="procedure_2"></a>程序</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">对于任何支持NFSv3的服务器，请使用<code class="literal">showmount</code>实用程序：</p><pre class="screen">$ showmount --exports <span class="emphasis"><em><span class="replaceable">my-server</span></em></span>

Export list for <span class="emphasis"><em><span class="replaceable">my-server</span></em></span>
<span class="emphasis"><em><span class="replaceable">/exports/foo</span></em></span>
<span class="emphasis"><em><span class="replaceable">/exports/bar</span></em></span></pre></li><li class="listitem"><p class="simpara">对于任何支持NFSv4的服务器，安装根目录并环顾四周：</p><pre class="screen"># mount <span class="emphasis"><em><span class="replaceable">my-server</span></em></span>:/ /mnt/
# ls /mnt/

<span class="emphasis"><em><span class="replaceable">exports</span></em></span>

# ls /mnt/<span class="emphasis"><em><span class="replaceable">exports/</span></em></span>

<span class="emphasis"><em><span class="replaceable">foo</span></em></span>
<span class="emphasis"><em><span class="replaceable">bar</span></em></span></pre></li></ul></div><p>在支持NFSv4和NFSv3的服务器上，两种方法都可以工作并提供相同的结果。
			</p><h3><a id="additional_resources_2"></a>其他资源</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">showmount(8)</code>手册页。
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="mounting-an-nfs-share-with-mount_mounting-nfs-shares"></a>使用mount挂载NFS共享</h1></div></div></div><p>此过程使用<code class="literal">mount</code>实用程序安装从服务器导出的NFS共享。
			</p><h3><a id="procedure_3"></a>程序</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要挂载NFS共享，请使用以下命令：</p><pre class="screen"># mount -t nfs -o <span class="emphasis"><em><span class="replaceable">options</span></em></span> <span class="emphasis"><em><span class="replaceable">host</span></em></span>:<span class="emphasis"><em><span class="replaceable">/remote/export</span></em></span> <span class="emphasis"><em><span class="replaceable">/local/directory</span></em></span></pre><p class="simpara">此命令使用以下变量：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="emphasis"><em><span class="replaceable">选项</span></em></span></span></dt><dd>逗号分隔的挂载选项列表。
								</dd><dt><span class="term"><span class="emphasis"><em><span class="replaceable">主办</span></em></span></span></dt><dd>导出要装入的文件系统的服务器的主机名，IP地址或完全限定域名。
								</dd><dt><span class="term"><span class="emphasis"><em><span class="replaceable">/远程/出口</span></em></span></span></dt><dd>从服务器导出的文件系统或目录，即您要安装的目录。
								</dd><dt><span class="term"><span class="emphasis"><em><span class="replaceable">/ local /目录</span></em></span></span></dt><dd>安装<span class="emphasis"><em><span class="replaceable">/ remote / export</span></em></span>的客户端位置。
								</dd></dl></div></li></ul></div><h3><a id="additional_resources_3"></a>其他资源</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<a class="xref" href="mounting-nfs-shares_managing-file-systems.html#common-nfs-mount-options_mounting-nfs-shares" title="常见的NFS挂载选项">“常见NFS挂载选项”一节</a>
					</li><li class="listitem">
						<a class="xref" href="mounting-nfs-shares_managing-file-systems.html#nfs-host-name-formats_mounting-nfs-shares" title="NFS主机名格式">“NFS主机名格式”一节</a>
					</li><li class="listitem">
						<a class="xref" href="assembly_mounting-file-systems_managing-file-systems.html#mounting-a-file-system-with-mount_assembly_mounting-file-systems" title="使用mount挂载文件系统">“安装带挂载的文件系统”一节</a>
					</li><li class="listitem"><code class="literal">mount(8)</code>手册页</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="common-nfs-mount-options_mounting-nfs-shares"></a>常见的NFS挂载选项</h1></div></div></div><p>本节列出了挂载NFS共享时常用的选项。这些选项可与手动安装命令， <code class="literal">/etc/fstab</code>设置和<code class="literal">autofs</code> 。
			</p><div class="variablelist"><p class="title"><strong>常见的NFS挂载选项</strong></p><dl class="variablelist"><dt><span class="term"><code class="literal">lookupcache=<span class="emphasis"><em><span class="replaceable">mode</span></em></span></code></span></dt><dd>指定内核应如何管理给定安装点的目录条目缓存。<span class="emphasis"><em><span class="replaceable">模式的</span></em></span>有效参数是<code class="literal">all</code> ， <code class="literal">none</code>或<code class="literal">positive</code> 。
						</dd><dt><span class="term"><code class="literal">nfsvers=<span class="emphasis"><em><span class="replaceable">version</span></em></span></code></span></dt><dd><p class="simpara">指定NFS协议来使用，其中<span class="emphasis"><em><span class="replaceable">版本</span></em></span>是哪个版本<code class="literal">3</code> ， <code class="literal">4</code> ， <code class="literal">4.0</code> ， <code class="literal">4.1</code> ，或<code class="literal">4.2</code> 。这对于运行多个NFS服务器的主机很有用，或者禁用重试较低版本的安装。如果未指定版本，则NFS使用内核和<code class="literal">mount</code>实用程序支持的最高版本。
						</p><p class="simpara">选项<code class="literal">vers</code>与<code class="literal">nfsvers</code>相同，并且出于兼容性原因包含在此版本中。
						</p></dd><dt><span class="term"><code class="literal">noacl</code></span></dt><dd>关闭所有ACL处理。在与旧版本的Red Hat Enterprise Linux，Red Hat Linux或Solaris接口时可能需要这样做，因为最新的ACL技术与旧系统不兼容。
						</dd><dt><span class="term"><code class="literal">nolock</code></span></dt><dd>禁用文件锁定。连接到非常旧的NFS服务器时，有时需要此设置。
						</dd><dt><span class="term"><code class="literal">noexec</code></span></dt><dd>防止在已安装的文件系统上执行二进制文件。如果系统正在安装包含不兼容二进制文件的非Linux文件系统，则此选项非常有用。
						</dd><dt><span class="term"><code class="literal">nosuid</code></span></dt><dd>禁用<code class="literal">set-user-identifier</code>和<code class="literal">set-group-identifier</code>位。这可以防止远程用户通过运行<code class="literal">setuid</code>程序获得更高的权限。
						</dd><dt><span class="term"><code class="literal">port=<span class="emphasis"><em><span class="replaceable">num</span></em></span></code></span></dt><dd>指定NFS服务器端口的数值。如果<span class="emphasis"><em><span class="replaceable">num</span></em></span>为<code class="literal">0</code> （默认值），则<code class="literal">mount</code>在远程主机上查询<code class="literal">rpcbind</code>服务以获取要使用的端口号。如果远程主机上的NFS服务未向其<code class="literal">rpcbind</code>服务注册，则使用TCP 2049的标准NFS端口号。
						</dd><dt><span class="term"><code class="literal">rsize=<span class="emphasis"><em><span class="replaceable">num</span></em></span></code>和<code class="literal">wsize=<span class="emphasis"><em><span class="replaceable">num</span></em></span></code></span></dt><dd><p class="simpara">这些选项设置在单个NFS读取或写入操作中传输的最大字节数。
						</p><p class="simpara"><code class="literal">rsize</code>和<code class="literal">wsize</code>没有固定的默认值。默认情况下，NFS使用服务器和客户端支持的最大可能值。在Red Hat Enterprise Linux 8中，客户端和服务器最大值为1,048,576字节。有关更多详细信息，请参阅<a class="link" href="https://access.redhat.com/solutions/753853">使用NFS挂载的rsize和wsize的默认值和最大值是多少？</a> KBase文章。
						</p></dd><dt><span class="term"><code class="literal">sec=<span class="emphasis"><em><span class="replaceable">mode</span></em></span></code></span></dt><dd><p class="simpara">用于访问已装载导出文件的安全性风格。
						</p><p class="simpara">默认设置为<code class="literal">sec=sys</code> ，它使用本地UNIX UID和GID。这些使用<code class="literal">AUTH_SYS</code>来验证NFS操作。
						</p><p class="simpara">其他选择包括：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									<code class="literal">sec=krb5</code>使用Kerberos V5而不是本地UNIX UID和GID来验证用户。
								</li><li class="listitem">
									<code class="literal">sec=krb5i</code>使用Kerberos V5进行用户身份验证，并使用安全校验和执行NFS操作的完整性检查，以防止数据被篡改。
								</li><li class="listitem">
									<code class="literal">sec=krb5p</code>使用Kerberos V5进行用户身份验证，完整性检查以及加密NFS流量以防止流量嗅探。这是最安全的设置，但它也涉及最大的性能开销。
								</li></ul></div></dd><dt><span class="term"><code class="literal">tcp</code></span></dt><dd>指示NFS安装使用TCP协议。
						</dd></dl></div><h3><a id="additional_resources_4"></a>其他资源</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">mount(8)</code>手册页</li><li class="listitem"><code class="literal">nfs(5)</code>手册页</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="related-information-mounting-nfs-shares"></a>相关信息</h1></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Linux NFS wiki： <a class="link" href="https://linux-nfs.org">https</a> ： <a class="link" href="https://linux-nfs.org">//linux-nfs.org</a>
					</li><li class="listitem">要持久挂载NFS共享，请参阅<a class="xref" href="assembly_mounting-file-systems_managing-file-systems.html#assembly_persistently-mounting-file-systems_assembly_mounting-file-systems" title="持久安装文件系统">“永久挂载文件系统”一节</a> 。
					</li><li class="listitem">要按需安装NFS共享，请参阅<a class="xref" href="assembly_mounting-file-systems_managing-file-systems.html#assembly_mounting-file-systems-on-demand_assembly_mounting-file-systems" title="按需安装文件系统">“按需安装文件系统”一节</a> 。
					</li></ul></div></div></div></body></html>