<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 保护NFS</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 保护NFS</h1></div></div></div><p>要最大限度地降低NFS安全风险并保护服务器上的数据，请在服务器上导出NFS文件系统或将其安装在客户端上时，请考虑以下各节。
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="nfs-security-with-auth_sys-and-export-controls_securing-nfs"></a>使用AUTH_SYS和导出控件实现NFS安全性</h1></div></div></div><p>NFS提供以下传统选项以控制对导出文件的访问：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">服务器通过IP地址或主机名限制允许哪些主机装入哪些文件系统。
					</li><li class="listitem">服务器对NFS客户端上的用户执行文件系统权限的方式与本地用户相同。传统上，NFS使用<code class="literal">AUTH_SYS</code>调用消息（也称为<code class="literal">AUTH_UNIX</code> ）执行此操作，该消息依赖于客户端来声明用户的UID和GID。请注意，这意味着恶意或配置错误的客户端可能很容易出错，并允许用户访问不应该访问的文件。
					</li></ul></div><p>为了限制潜在风险，管理员通常将访问权限限制为只读或将用户权限压缩为普通用户和组ID。不幸的是，这些解决方案阻止了NFS共享以最初的方式使用。
			</p><p>此外，如果攻击者获得了导出NFS文件系统的系统所使用的DNS服务器的控制权，则他们可以将与特定主机名或完全限定域名相关联的系统指向未经授权的计算机。此时，未经授权的计算机<span class="emphasis"><em>是</em></span>允许挂载NFS共享的系统，因为没有交换用户名或密码信息来为NFS挂载提供额外的安全性。
			</p><p>通过NFS导出目录时，应谨慎使用通配符，因为通配符的范围可能包含比预期更多的系统。
			</p><h3><a id="additional_resources_13"></a>其他资源</h3><p>有关保护NFS和<code class="literal">rpcbind</code>更多信息，请参阅<code class="literal">iptables</code>手册页。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="nfs-security-with-auth_gss_securing-nfs"></a>使用<code class="literal">AUTH_GSS</code> NFS安全性</h1></div></div></div><p>所有版本的NFS都支持RPCSEC_GSS和Kerberos机制。
			</p><p>与AUTH_SYS不同，使用RPCSEC_GSS Kerberos机制，服务器不依赖于客户端来正确表示哪个用户正在访问该文件。相反，密码术用于对服务器的用户进行身份验证，从而防止恶意客户端在没有该用户的Kerberos凭据的情况下冒充用户。使用RPCSEC_GSS Kerberos机制是保护安装的最直接方法，因为在配置Kerberos后，无需进行其他设置。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-kerberos_securing-nfs"></a>配置Kerberos</h2></div></div></div><p>Kerberos是一种网络身份验证系统，允许客户端和服务器通过使用对称加密和受信任的第三方（KDC）相互进行身份验证。 Red Hat建议使用Identity Management（IdM）来设置Kerberos。
				</p><h4><a id="prerequisites_2"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">已安装和配置Kerberos密钥分发中心（ <code class="literal">KDC</code> ）。
						</li></ul></div><div class="orderedlist"><a id="proc-configuring-rpcses_gss-with-idm"></a><p class="title"><strong>为IdM配置NFS服务器和客户端以使用RPCSEC_GSS</strong></p><ol class="orderedlist"><li class="listitem"><p class="simpara">

						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">创建<code class="literal">nfs/hostname. <span class="emphasis"><em>domain@REALM</em></span></code> NFS服务器端的<code class="literal"><span class="emphasis"><em>nfs/hostname. domain@REALM</em></span></code>主体。
								</li><li class="listitem">创建<code class="literal">host/hostname. <span class="emphasis"><em>domain@REALM</em></span></code>服务器和客户端上的<code class="literal"><span class="emphasis"><em>host/hostname. domain@REALM</em></span></code>主体。
								</li><li class="listitem">将相应的密钥添加到客户端和服务器的keytabs中。
								</li></ul></div></li><li class="listitem"><p class="simpara">在服务器端，使用<code class="literal">sec=</code>选项启用所需的安全性风格。要启用所有安全性风格以及非加密安装：</p><pre class="literallayout">/export *(sec=sys:krb5:krb5i:krb5p)</pre><p class="simpara">与<code class="literal">sec=</code>选项一起使用的有效安全性风格是：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									<code class="literal">sys</code> ：没有加密保护，默认</li><li class="listitem">
									<code class="literal">krb5</code> ：仅限身份验证</li><li class="listitem">
									<code class="literal">krb5i</code> ：完整性保护</li><li class="listitem">
									<code class="literal">krb5p</code> ：隐私保护</li></ul></div></li><li class="listitem"><p class="simpara">在客户端，将<code class="literal">sec=krb5</code> （或<code class="literal">sec=krb5i</code> ，或<code class="literal">sec=krb5p</code> ，具体取决于设置）添加到挂载选项：</p><pre class="literallayout"># mount -o sec=krb5 server:/export /mnt</pre></li></ol></div><h4><a id="additional_resources_14"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关更多信息，请参见<span class="strong"><strong>exports</strong></span> （5）和<span class="strong"><strong>nfs</strong></span> （5）手册页。
						</li><li class="listitem">有关<code class="literal">RPCSEC_GSS</code>框架的更多信息，包括<code class="literal">gssproxy</code>和<code class="literal">rpc.gssd</code>如何互操作，请参阅<a class="link" href="http://www.citi.umich.edu/projects/nfsv4/gssd/">GSSD流程描述</a> 。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="nfsv4-security-options_securing-nfs"></a> NFSv4安全选项</h2></div></div></div><p>NFSv4包括基于Microsoft Windows NT模型的ACL支持，而不是POSIX模型，因为Microsoft Windows NT模型的功能和广泛部署。
				</p><p>NFSv4的另一个重要安全功能是删除使用<code class="literal">MOUNT</code>协议来安装文件系统。由于协议处理文件的处理方式， <code class="literal">MOUNT</code>协议存在安全风险。
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="file-permissions-on-mounted-nfs-exports_securing-nfs"></a>挂载的NFS导出的文件权限</h1></div></div></div><p>将NFS文件系统挂载为远程主机读取或读取和写入后，每个共享文件唯一的保护是其权限。如果共享相同用户标识值的两个用户在不同的客户端系统上安装相同的NFS文件系统，则可以修改彼此的文件。此外，在客户端系统上以root身份登录的任何人都可以使用<code class="literal">su -</code>命令访问具有NFS共享的任何文件。
			</p><p>默认情况下，红帽企业Linux下的NFS支持访问控制列表（ACL）。Red Hat建议启用此功能。
			</p><p>默认情况下，NFS在导出文件系统时使用<span class="emphasis"><em>root</em></span>压缩。这会将访问NFS共享的任何人的用户ID设置为本地计算机上的root用户为<code class="literal">nobody</code> 。Root压缩由默认选项<code class="literal">root_squash</code> ;有关此选项的更多信息，请参阅<a class="xref" href="exporting-nfs-shares_managing-file-systems.html#nfs-server-configuration_exporting-nfs-shares" title="NFS服务器配置">“NFS服务器配置”一节</a> 。
			</p><p>以只读方式导出NFS共享时，请考虑使用<code class="literal">all_squash</code>选项。此选项使访问导出文件系统的每个用户都获取<code class="literal">nfsnobody</code>用户的用户ID。
			</p></div></div></body></html>