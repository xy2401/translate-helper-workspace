<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. XFS入门</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. XFS入门</h1></div></div></div><p>这是如何创建和维护XFS文件系统的概述。
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="the-xfs-file-system_getting-started-with-xfs"></a> XFS文件系统</h1></div></div></div><p>XFS是一个高度可扩展，高性能，强大且成熟的64位日记文件系统，可在单个主机上支持非常大的文件和文件系统。它是Red Hat Enterprise Linux 8中的默认文件系统。XFS最初由SGI于20世纪90年代初开发，并且在超大型服务器和存储阵列上运行的历史悠久。
			</p><p>XFS的功能包括：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">可靠性</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">元数据日记，通过保留在重新启动系统并重新启动文件系统时可以重播的文件系统操作的记录，确保系统崩溃后的文件系统完整性</li><li class="listitem">广泛的运行时元数据一致性检查</li><li class="listitem">可扩展且快速的维修工具</li><li class="listitem">配额日记。这样可以避免在崩溃后进行冗长的配额一致性检查。
								</li></ul></div></dd><dt><span class="term">可扩展性和性能</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">支持的文件系统大小最高为1024 TiB</li><li class="listitem">能够支持大量并发操作</li><li class="listitem">B树索引，用于自由空间管理的可扩展性</li><li class="listitem">复杂的元数据预读算法</li><li class="listitem">流式视频工作负载的优化</li></ul></div></dd><dt><span class="term">分配方案</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">基于范围的分配</li><li class="listitem">条带感知分配策略</li><li class="listitem">延迟分配</li><li class="listitem">空间预分配</li><li class="listitem">动态分配的inode</li></ul></div></dd><dt><span class="term">其他特性</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">基于Reflink的文件副本（Red Hat Enterprise Linux 8中的新增功能）</li><li class="listitem">紧密集成的备份和还原实用程序</li><li class="listitem">在线碎片整理</li><li class="listitem">在线文件系统不断增长</li><li class="listitem">全面的诊断功能</li><li class="listitem">扩展属性（ <code class="literal">xattr</code> ）。这允许系统为每个文件关联几个附加的名称/值对。
								</li><li class="listitem">项目或目录配额。这允许对目录树进行配额限制。
								</li><li class="listitem">亚秒级时间戳</li></ul></div></dd></dl></div><h3><a id="performance_characteristics_3"></a>性能特点</h3><p>XFS在具有企业工作负载的大型系统上具有高性能。大型系统是具有相对较多CPU，多个HBA以及与外部磁盘阵列的连接的系统。XFS在具有多线程并行I / O工作负载的小型系统上也表现良好。
			</p><p>对于单线程，元数据密集型工作负载，XFS的性能相对较低：例如，在单个线程中创建或删除大量小文件的工作负载。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_creating-an-xfs-file-system-getting-started-with-xfs"></a>创建XFS文件系统</h1></div></div></div><p>作为系统管理员，您可以在块设备上创建XFS文件系统，以使其能够存储文件和目录。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_creating-an-xfs-file-system-with-mkfs-xfs-creating-an-xfs-file-system"></a>使用mkfs.xfs创建XFS文件系统</h2></div></div></div><p>此过程描述如何在块设备上创建XFS文件系统。
				</p><h4><a id="procedure_25"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要创建文件系统：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">如果设备是常规分区，LVM卷，MD卷，磁盘或类似设备，请使用以下命令：</p><pre class="screen"># mkfs.xfs <span class="emphasis"><em>block-device</em></span></pre><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">将<span class="emphasis"><em><span class="replaceable">块设备</span></em></span>替换为<span class="emphasis"><em><span class="replaceable">块设备</span></em></span>的路径。例如， <code class="literal">/dev/sdb1</code> ， <code class="literal">/dev/disk/by-uuid/05e99ec8-def1-4a5e-8a9d-5945339ceb2a</code> ，或<code class="literal">/dev/my-volgroup/my-lv</code> 。</li><li class="listitem">通常，默认选项是常用的最佳选项。
										</li><li class="listitem">在包含现有文件系统的块设备上使用<code class="literal">mkfs.xfs</code>时，请添加<code class="literal">-f</code>选项以覆盖该文件系统。
										</li></ul></div></li><li class="listitem"><p class="simpara">要在硬件RAID设备上创建文件系统，请检查系统是否正确检测到设备的条带几何：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">如果条带几何信息正确，则不需要其他选项。创建文件系统：</p><pre class="screen"># mkfs.xfs <span class="emphasis"><em>block-device</em></span></pre></li><li class="listitem"><p class="simpara">如果信息不正确，请使用<code class="literal">-d</code>选项的<code class="literal">su</code>和<code class="literal">sw</code>参数手动指定条带几何。<code class="literal">su</code>参数指定RAID块大小， <code class="literal">sw</code>参数指定RAID设备中的数据磁盘数。
										</p><p class="simpara">例如：</p><pre class="screen"># mkfs.xfs -d su=<span class="emphasis"><em>64k</em></span>,sw=<span class="emphasis"><em>4</em></span> <span class="emphasis"><em>/dev/sda3</em></span></pre></li></ul></div></li></ul></div></li><li class="listitem"><p class="simpara">使用以下命令等待系统注册新设备节点：</p><pre class="screen"># udevadm settle</pre></li></ol></div><h4><a id="additional_resources_20"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">mkfs.xfs(8)</code>手册页。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="additional-resources-creating-an-xfs-file-system"></a>其他资源</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">mkfs.xfs(8)</code>手册页。
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_backing-up-an-xfs-file-system-getting-started-with-xfs"></a>备份XFS文件系统</h1></div></div></div><p>作为系统管理员，您可以使用<code class="literal">xfsdump</code>将XFS文件系统备份到文件或磁带上。这提供了一种简单的备份机制。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="con_features-of-xfs-backup-backing-up-an-xfs-file-system"></a> XFS备份的功能</h2></div></div></div><p>本节介绍使用<code class="literal">xfsdump</code>实用程序备份XFS文件系统的关键概念和功能。
				</p><p>您可以使用<code class="literal">xfsdump</code>实用程序：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">执行备份到常规文件映像。
						</p><p class="simpara">只能将一个备份写入常规文件。
						</p></li><li class="listitem"><p class="simpara">执行磁带驱动器的备份。
						</p><p class="simpara"><code class="literal">xfsdump</code>实用程序还允许您将多个备份写入同一磁带。备份可以跨越多个磁带。
						</p><p class="simpara">要将多个文件系统备份到单个磁带设备，只需将备份写入已包含XFS备份的磁带即可。这会将新备份附加到上一个备份。默认情况下， <code class="literal">xfsdump</code>永远不会覆盖现有备份。
						</p></li><li class="listitem"><p class="simpara">创建增量备份。
						</p><p class="simpara"><code class="literal">xfsdump</code>实用程序使用转储级别来确定其他备份相对的基本备份。0到9之间的数字表示增加转储级别。增量备份仅备份自上次转储较低级别以来已更改的文件：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">要执行完整备份，请在文件系统上执行0级转储。
								</li><li class="listitem">1级转储是完全备份后的第一个增量备份。下一个增量备份将是级别2，它仅备份自上一级转储以来已更改的文件;依此类推，最高等级为9级。
								</li></ul></div></li><li class="listitem">使用大小，子树或inode标志从备份中排除文件以过滤它们。
						</li></ul></div><h4><a id="additional_resources_21"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">xfsdump(8)</code>手册页。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_backing-up-an-xfs-file-system-with-xfsdump-backing-up-an-xfs-file-system"></a>使用xfsdump备份XFS文件系统</h2></div></div></div><p>此过程描述如何将XFS文件系统的内容备份到文件或磁带中。
				</p><h4><a id="prerequisites_10"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">您可以备份的XFS文件系统。
						</li><li class="listitem">另一个文件系统或磁带驱动器，您可以在其中存储备份。
						</li></ul></div><h4><a id="procedure_26"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">使用以下命令备份XFS文件系统：</p><pre class="screen"># xfsdump -l <span class="emphasis"><em>level</em></span> [-L <span class="emphasis"><em>label</em></span>] \
          -f <span class="emphasis"><em>backup-destination</em></span> <span class="emphasis"><em>path-to-xfs-filesystem</em></span></pre><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">将<span class="emphasis"><em>级别</em></span>替换为备份的转储级别。使用<code class="literal">0</code>执行完整备份或使用<code class="literal">1</code>到<code class="literal">9</code>执行后续增量备份。
								</li><li class="listitem">将<span class="emphasis"><em>backup-destination</em></span>替换<span class="emphasis"><em>为</em></span>要存储备份的路径。目标可以是常规文件，磁带驱动器或远程磁带设备。例如，文件的<code class="literal">/backup-files/Data.xfsdump</code>或磁带驱动器的<code class="literal">/dev/st0</code> 。
								</li><li class="listitem">将<span class="emphasis"><em>path-to-xfs-filesystem</em></span>替换为要备份的XFS文件系统的挂载点。例如， <code class="literal">/mnt/data/</code> 。必须安装文件系统。
								</li><li class="listitem">备份多个文件系统并将其保存在单个磁带设备上时，使用<code class="literal">-L <span class="emphasis"><em>label</em></span></code>选项为每个备份添加会话标签，以便在还原时更容易识别它们。将<span class="emphasis"><em>标签</em></span>替换为备份的任何名称：例如， <code class="literal">backup_data</code> 。
								</li></ul></div></li></ul></div><div class="example"><a id="idm139870575209040"></a><p class="title"><strong>例8.1。备份多个XFS文件系统</strong></p><div class="example-contents"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要备份安装在<code class="literal">/boot/</code>和<code class="literal">/data/</code>目录中的XFS文件系统的内容，并将它们保存为<code class="literal">/backup-files/</code>目录中<code class="literal">/backup-files/</code> ：</p><pre class="screen"># xfsdump -l 0 -f <span class="emphasis"><em>/backup-files/boot.xfsdump</em></span> <span class="emphasis"><em>/boot</em></span>
# xfsdump -l 0 -f <span class="emphasis"><em>/backup-files/data.xfsdump</em></span> <span class="emphasis"><em>/data</em></span></pre></li><li class="listitem"><p class="simpara">要在单个磁带设备上备份多个文件系统，请使用<code class="literal">-L <span class="emphasis"><em>label</em></span></code>选项为每个备份添加会话标签：</p><pre class="screen"># xfsdump -l 0 -L <span class="emphasis"><em>"backup_boot"</em></span> -f <span class="emphasis"><em>/dev/st0</em></span> <span class="emphasis"><em>/boot</em></span>
# xfsdump -l 0 -L <span class="emphasis"><em>"backup_data"</em></span> -f <span class="emphasis"><em>/dev/st0</em></span> <span class="emphasis"><em>/data</em></span></pre></li></ul></div></div></div><h4><a id="additional_resources_22"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">xfsdump(8)</code>手册页。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="additional-resources-backing-up-an-xfs-file-system"></a>其他资源</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">xfsdump(8)</code>手册页。
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_recovering-an-xfs-file-system-from-backup-getting-started-with-xfs"></a>从备份还原XFS文件系统</h1></div></div></div><p>作为系统管理员，您可以使用<code class="literal">xfsrestore</code>工具来恢复与创建备份XFS <code class="literal">xfsdump</code>实用工具和存储在一个文件或磁带上。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="con_features-of-restoring-xfs-from-backup-restoring-an-xfs-file-system-from-backup"></a>从备份还原XFS的功能</h2></div></div></div><p>本节介绍使用<code class="literal">xfsrestore</code>实用程序从备份还原XFS文件系统的关键概念和功能。
				</p><p><code class="literal">xfsrestore</code>实用程序从<code class="literal">xfsdump</code>生成的备份还原文件系统。<code class="literal">xfsrestore</code>实用程序有两种模式：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>简单</strong></span>模式使用户能够从0级转储恢复整个文件系统。这是默认模式。
						</li><li class="listitem"><span class="strong"><strong>累积</strong></span>模式允许从增量备份恢复文件系统：即级别1到级别9。
						</li></ul></div><p>唯一的<span class="emphasis"><em>会话ID</em></span>或<span class="emphasis"><em>会话标签</em></span>标识每个备份。从包含多个备份的磁带还原备份需要其对应的会话ID或标签。
				</p><p>要从备份中提取，添加或删除特定文件，请进入<code class="literal">xfsrestore</code>交互模式。交互模式提供了一组操作备份文件的命令。
				</p><h4><a id="additional_resources_23"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">xfsrestore(8)</code>手册页。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_restoring-an-xfs-file-system-from-backup-with-xfsrestore-restoring-an-xfs-file-system-from-backup"></a>使用xfsrestore从备份还原XFS文件系统</h2></div></div></div><p>此过程描述如何从文件或磁带备份还原XFS文件系统的内容。
				</p><h4><a id="prerequisites_11"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">XFS文件系统的文件或磁带备份，如<a class="xref" href="assembly_getting-started-with-xfs-managing-file-systems.html#assembly_backing-up-an-xfs-file-system-getting-started-with-xfs" title="Backing up an XFS file system">“备份XFS文件系统”一节</a>中<a class="xref" href="assembly_getting-started-with-xfs-managing-file-systems.html#assembly_backing-up-an-xfs-file-system-getting-started-with-xfs" title="备份XFS文件系统">所述</a> 。
						</li><li class="listitem">可以还原备份的存储设备。
						</li></ul></div><h4><a id="procedure_27"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">还原备份的命令取决于您是从完全备份还是从增量备份还原，还是从单个磁带设备还原多个备份：</p><pre class="screen"># xfsrestore [-r] [-S session-id] [-L session-label] [-i]
             -f backup-location restoration-path</pre><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">将<span class="emphasis"><em><span class="replaceable">备份位置</span></em></span>替换为<span class="emphasis"><em><span class="replaceable">备份位置</span></em></span> 。这可以是常规文件，磁带驱动器或远程磁带设备。例如，文件的<code class="literal">/backup-files/Data.xfsdump</code>或磁带驱动器的<code class="literal">/dev/st0</code> 。
								</li><li class="listitem">将restore <span class="emphasis"><em><span class="replaceable">-path</span></em></span>替换为要还原文件系统的目录的路径。例如， <code class="literal">/mnt/data/</code> 。
								</li><li class="listitem">要从增量（级别1到级别9）备份还原文件系统，请添加<code class="literal">-r</code>选项。
								</li><li class="listitem"><p class="simpara">要从包含多个备份的磁带设备还原备份，请使用<code class="literal">-S</code>或<code class="literal">-L</code>选项指定备份。
								</p><p class="simpara"><code class="literal">-S</code>选项允许您通过其会话ID选择备份，而<code class="literal">-L</code>选项允许您通过会话标签进行选择。要获取会话ID和会话标签，请使用<code class="literal">xfsrestore -I</code>命令。
								</p><p class="simpara">将<span class="emphasis"><em><span class="replaceable">session-id</span></em></span>替换为备份的会话ID。例如， <code class="literal">b74a3586-e52e-4a4a-8775-c3334fa8ea2c</code> 。将<span class="emphasis"><em><span class="replaceable">session-label</span></em></span>替换为备份的会话标签。例如， <code class="literal">my_backup_session_label</code> 。
								</p></li><li class="listitem"><p class="simpara">要以交互方式使用<code class="literal">xfsrestore</code> ，请使用<code class="literal">-i</code>选项。
								</p><p class="simpara">在<code class="literal">xfsrestore</code>完成读取指定设备后，交互式对话框开始。交互式<code class="literal">xfsrestore</code> shell中的可用命令包括<code class="literal">cd</code> ， <code class="literal">ls</code> ， <code class="literal">add</code> ， <code class="literal">delete</code>和<code class="literal">extract</code> ;有关命令的完整列表，请使用<code class="literal">help</code>命令。
								</p></li></ul></div></li></ul></div><div class="example"><a id="idm139870584246688"></a><p class="title"><strong>例8.2。还原多个XFS文件系统</strong></p><div class="example-contents"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要还原XFS备份文件并将其内容保存到<code class="literal">/mnt/</code>下的目录中：</p><pre class="screen"># xfsrestore -f <span class="emphasis"><em>/backup-files/boot.xfsdump</em></span> <span class="emphasis"><em>/mnt/boot/</em></span>
# xfsrestore -f <span class="emphasis"><em>/backup-files/data.xfsdump</em></span> <span class="emphasis"><em>/mnt/data/</em></span></pre></li><li class="listitem"><p class="simpara">要从包含多个备份的磁带设备进行还原，请按其会话标签或会话ID指定每个备份：</p><pre class="screen"># xfsrestore -L <span class="emphasis"><em>"backup_boot"</em></span> -f <span class="emphasis"><em>/dev/st0</em></span> <span class="emphasis"><em>/mnt/boot/</em></span>
# xfsrestore -S <span class="emphasis"><em>"45e9af35-efd2-4244-87bc-4762e476cbab"</em></span> \
             -f <span class="emphasis"><em>/dev/st0</em></span> <span class="emphasis"><em>/mnt/data/</em></span></pre></li></ul></div></div></div><h4><a id="additional_resources_24"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">xfsrestore(8)</code>手册页。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="con_informational-messages-when-restoring-an-xfs-backup-from-a-tape-restoring-an-xfs-file-system-from-backup"></a>从磁带还原XFS备份时的参考消息</h2></div></div></div><p>从具有多个文件系统备份的磁带还原备份时， <code class="literal">xfsrestore</code>实用程序可能会发出消息。当<code class="literal">xfsrestore</code>按顺序检查磁带上的每个备份时，这些消息会通知您是否找到了所请求备份的匹配项。例如：</p><pre class="screen">xfsrestore: preparing drive
xfsrestore: examining media file 0
xfsrestore: inventory session uuid (8590224e-3c93-469c-a311-fc8f23029b2a) does not match the media header's session uuid (7eda9f86-f1e9-4dfd-b1d4-c50467912408)
xfsrestore: examining media file 1
xfsrestore: inventory session uuid (8590224e-3c93-469c-a311-fc8f23029b2a) does not match the media header's session uuid (7eda9f86-f1e9-4dfd-b1d4-c50467912408)
[...]</pre><p>信息性消息一直出现，直到找到匹配的备份。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="additional-resources-restoring-an-xfs-file-system-from-backup"></a>其他资源</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">xfsrestore(8)</code>手册页。
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_repairing-an-xfs-file-system_getting-started-with-xfs"></a>修复XFS文件系统</h1></div></div></div><p>作为系统管理员，您可以修复损坏的XFS文件系统。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="error-handling-mechanisms-in-xfs_assembly_repairing-an-xfs-file-system"></a> XFS中的错误处理机制</h2></div></div></div><p>本节介绍XFS如何处理文件系统中的各种错误。
				</p><h4><a id="unclean_unmounts"></a>不洁不干净</h4><p>Journalling维护文件系统上发生的元数据更改的事务记录。
				</p><p>如果发生系统崩溃，电源故障或其他不干净的卸载，XFS将使用日志（也称为日志）来恢复文件系统。内核在安装XFS文件系统时执行日志恢复。
				</p><h4><a id="corruption"></a>腐败</h4><p>在此上下文中， <span class="emphasis"><em>损坏</em></span>意味着文件系统上的错误，例如：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">硬件故障</li><li class="listitem">存储固件，设备驱动程序，软件堆栈或文件系统本身中的错误</li><li class="listitem">导致部分文件系统被文件系统外部的事物覆盖的问题</li></ul></div><p>当XFS检测到文件系统或文件系统元数据中的损坏时，它会关闭文件系统并在系统日志中报告事件。请注意，如果在托管<code class="literal">/var</code>目录的文件系统上发生损坏，则重新启动后这些日志将不可用。
				</p><div class="example"><a id="idm139870575589568"></a><p class="title"><strong>例8.3。报告XFS损坏的系统日志条目</strong></p><div class="example-contents"><pre class="screen"># dmesg --notime | tail -15

XFS (loop0): Mounting V5 Filesystem
XFS (loop0): Metadata CRC error detected at xfs_agi_read_verify+0xcb/0xf0 [xfs], xfs_agi block 0x2
XFS (loop0): Unmount and run xfs_repair
XFS (loop0): First 128 bytes of corrupted metadata buffer:
00000000027b3b56: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
000000005f9abc7a: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
000000005b0aef35: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
00000000da9d2ded: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
000000001e265b07: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
000000006a40df69: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
000000000b272907: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
00000000e484aac5: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
XFS (loop0): metadata I/O error in "xfs_trans_read_buf_map" at daddr 0x2 len 1 error 74
XFS (loop0): xfs_imap_lookup: xfs_ialloc_read_agi() returned error -117, agno 0
XFS (loop0): Failed to read root inode 0x80, error 11</pre></div></div><p>用户空间实用程序通常在尝试访问损坏的XFS文件系统时报告<span class="emphasis"><em>输入/输出错误</em></span>消息。使用损坏的日志挂载XFS文件系统会导致以下错误消息：</p><pre class="screen">mount: <span class="emphasis"><em><span class="replaceable">/mount-point</span></em></span>: mount(2) system call failed: Structure needs cleaning.</pre><p>您必须手动使用<code class="literal">xfs_repair</code>实用程序来修复损坏。与其他文件系统修复实用程序不同，即使未完全卸载XFS文件系统， <code class="literal">xfs_repair</code>也不会在引导时运行。如果发生不干净的卸载，XFS只需在挂载时重放日志，确保文件系统一致; <code class="literal">xfs_repair</code>无法使用脏日志修复XFS文件系统，而无需先重新安装。
				</p><h4><a id="additional_resources_25"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">xfs_repair(8)</code>手册页提供了XFS损坏检查的详细列表。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_repairing-an-xfs-file-system-with-xfs_repair_assembly_repairing-an-xfs-file-system"></a>使用xfs_repair修复XFS文件系统</h2></div></div></div><p>此过程使用<code class="literal">xfs_repair</code>实用程序修复损坏的XFS文件系统。
				</p><h4><a id="procedure_28"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">通过重新安装文件系统来清除日志：</p><pre class="screen"># mount <span class="emphasis"><em><span class="replaceable">file-system</span></em></span>
# umount <span class="emphasis"><em><span class="replaceable">file-system</span></em></span></pre></li><li class="listitem"><p class="simpara">使用<code class="literal">xfs_repair</code>实用程序修复卸载的文件系统：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">如果安装成功，则不需要其他选项：</p><pre class="screen"># xfs_repair <span class="emphasis"><em><span class="replaceable">block-device</span></em></span></pre></li><li class="listitem"><p class="simpara">如果安装失败并且<span class="emphasis"><em>结构需要清除</em></span>错误，则日志已损坏且无法重播。使用<code class="literal">-L</code>选项（ <span class="emphasis"><em>强制日志清零</em></span> ）清除日志：</p><div class="warning" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">警告</h3><p>此命令会导致崩溃时正在进行的所有元数据更新丢失，这可能会导致严重的文件系统损坏和数据丢失。这应该仅作为最后的手段使用。
									</p></div><pre class="screen"># xfs_repair -L <span class="emphasis"><em><span class="replaceable">block-device</span></em></span></pre></li></ul></div></li><li class="listitem"><p class="simpara">挂载文件系统：</p><pre class="screen"># mount <span class="emphasis"><em><span class="replaceable">file-system</span></em></span></pre></li></ol></div><h4><a id="additional_resources_26"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">xfs_repair(8)</code>手册页。
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_increasing-the-size-of-an-xfs-file-system_getting-started-with-xfs"></a>增加XFS文件系统的大小</h1></div></div></div><p>作为系统管理员，您可以增加XFS文件系统的大小以利用更大的存储容量。
			</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>目前无法减小XFS文件系统的大小。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_increasing-the-size-of-an-xfs-file-system-with-xfs_growfs_assembly_increasing-the-size-of-an-xfs-file-system"></a>使用xfs_growfs增加XFS文件系统的大小</h2></div></div></div><p>此过程描述如何使用<code class="literal">xfs_growfs</code>实用程序扩展XFS文件系统。
				</p><h4><a id="prerequisites_12"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">确保底层块设备的大小合适，以便以后保存已调整大小的文件系统。对受影响的块设备使用适当的调整大小方法。
						</li><li class="listitem">挂载XFS文件系统。
						</li></ul></div><h4><a id="procedure_29"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">在安装XFS文件系统时，使用<code class="literal">xfs_growfs</code>实用程序来增加其大小：</p><pre class="screen"># xfs_growfs <span class="emphasis"><em><span class="replaceable">file-system</span></em></span> -D <span class="emphasis"><em><span class="replaceable">new-size</span></em></span></pre><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">将<span class="emphasis"><em><span class="replaceable">文件系统</span></em></span>替换为XFS文件系统的安装点。
								</li><li class="listitem"><p class="simpara">使用<code class="literal">-D</code>选项，将<span class="emphasis"><em><span class="replaceable">new-size</span></em></span>替换为文件系统块数指定的文件系统的所需新大小。
								</p><p class="simpara">要找出给定XFS文件系统的块大小（KB），请使用<code class="literal">xfs_info</code>实用程序：</p><pre class="screen"># xfs_info <span class="emphasis"><em><span class="replaceable">block-device</span></em></span>

...
data     =              bsize=4096
...</pre></li><li class="listitem">如果没有<code class="literal">-D</code>选项， <code class="literal">xfs_growfs</code>文件系统增大到底层设备支持的最大大小。
								</li></ul></div></li></ul></div><h4><a id="additional_resources_27"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">xfs_growfs(8)</code>手册页。
						</li></ul></div></div></div></div></body></html>