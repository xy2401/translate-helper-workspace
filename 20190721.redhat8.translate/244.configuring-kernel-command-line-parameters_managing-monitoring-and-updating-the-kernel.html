<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 配置内核命令行参数</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 配置内核命令行参数</h1></div></div></div><p>作为系统管理员，您可以配置内核命令行参数，以确保尽快设置和加载它们。此外，某些内核命令行参数只能以这种方式调整。
		</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>在生产系统上配置内核命令行参数时要小心。Haphazard更改可能会导致内核不稳定，并可能导致系统无法在重新启动时为所有内核启动。因此，在尝试更改任何值之前，请务必了解并确保使用有效选项。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="what-are-boot-entries_configuring-kernel-command-line-parameters"></a>什么是引导条目</h1></div></div></div><p>引导条目是组合配置文件的选项集合，配置文件通常与特定内核版本相关联。实际上，您至少拥有与系统安装内核一样多的引导条目。引导条目配置文件位于<code class="literal">/boot/loader/entries/</code>目录中，如下所示：</p><pre class="screen">6f9cc9cb7d7845d49698c9537337cedc-4.18.0-5.el8.x86_64.conf</pre><p>上面的文件名包含存储在<code class="literal">/etc/machine-id</code>文件中的计算机ID和内核版本。
			</p><p>引导条目配置文件包含有关内核版本，初始ramdisk映像和<code class="literal">kernelopts</code>变量的信息，其中包含内核命令行参数。引导条目配置的内容如下所示：</p><pre class="screen">title Red Hat Enterprise Linux (4.18.0-74.el8.x86_64) 8.0 (Ootpa)
version 4.18.0-74.el8.x86_64
linux /vmlinuz-4.18.0-74.el8.x86_64
initrd /initramfs-4.18.0-74.el8.x86_64.img $tuned_initrd
options $kernelopts $tuned_params
id rhel-20190227183418-4.18.0-74.el8.x86_64
grub_users $grub_users
grub_arg --unrestricted
grub_class kernel</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="what-are-kernel-command-line-parameters_configuring-kernel-command-line-parameters"></a>什么是内核命令行参数</h1></div></div></div><p>该模块解释了内核命令行参数的概念及其在系统管理中的作用。
			</p><p>内核命令行参数（也称为内核参数）用于以下的引导时配置：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Linux内核</li><li class="listitem">最初的RAM磁盘</li><li class="listitem">用户空间功能</li></ul></div><p>内核命令行参数通常用于覆盖默认值，并用于通知内核有关内核在获取此类信息时遇到问题的硬件参数。
			</p><p>默认情况下，使用GRUB2引导加载程序的系统的内核命令行参数在<code class="literal">kernelopts</code>文件的<code class="literal">/boot/grub2/grubenv</code>变量中定义，用于所有内核引导条目。
			</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>对于IBM Z，内核命令行参数存储在引导条目配置文件中，因为zipl引导加载程序不支持环境变量。因此不能使用<code class="literal">kernelopts</code> 。
				</p></div><h3><a id="additional_resources_4"></a>其他资源</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关可以修改的内核命令行参数的更多信息，请安装<code class="literal">man-pages</code>包并查看<code class="literal">kernel-command-line(7)</code> ， <code class="literal">bootparam(7)</code>和<code class="literal">dracut.cmdline(7)</code>手册页。
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="what-is-grubby_configuring-kernel-command-line-parameters"></a>什么是肮脏的</h1></div></div></div><p>
				<code class="literal">grubby</code>是一个用于操作特定于引导加载程序的配置文件的实用程序。
			</p><p>您还可以使用<code class="literal">grubby</code>更改默认引导条目，以及从GRUB2菜单项添加/删除参数。
			</p><p>有关更多详细信息，请参阅<code class="literal">grubby(8)</code>手册页。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="setting-kernel-command-line-parameters_configuring-kernel-command-line-parameters"></a>设置内核命令行参数</h1></div></div></div><p>本节介绍如何在AMD64和Intel 64体系结构，64位ARM体系结构以及IBM Power Systems的little-endian变体上更改内核命令行参数。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="changing-kernel-command-line-parameters-for-all-boot-entries_setting-kernel-command-line-parameters"></a>更改所有引导条目的内核命令行参数</h2></div></div></div><p>此过程描述如何更改系统上所有引导条目的内核命令行参数。
				</p><h4><a id="prerequisites_2"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><a class="link" href="configuring-kernel-command-line-parameters_managing-monitoring-and-updating-the-kernel.html#what-are-kernel-command-line-parameters_configuring-kernel-command-line-parameters" title="什么是内核命令行参数">内核命令行参数</a>简介。
						</li></ul></div><h4><a id="procedure_4"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要添加新参数，请使用<code class="literal">grub2-editenv</code>命令，如以下示例所示：</p><pre class="literallayout"># grub2-editenv - set "$(grub2-editenv - list | grep kernelopts) &lt;<span class="emphasis"><em>NEW_PARAMETER</em></span>&gt;"</pre><p class="simpara">此命令将额外参数附加到全局变量<code class="literal">kernelopts</code>的整个参数列表中。因此，为系统上的所有引导条目设置内核命令行参数<span class="emphasis"><em>NEW_PARAMETER</em></span> 。
						</p></li><li class="listitem"><p class="simpara">要删除参数，请使用以下命令：</p><pre class="literallayout"># grub2-editenv - set "$(grub2-editenv - list | grep kernelopts | sed -e 's/&lt;<span class="emphasis"><em>PARAMETER_TO_REMOVE</em></span>&gt;//')"</pre></li><li class="listitem">重新启动系统以使更改生效。
						</li></ol></div><p>因此，将重新配置引导加载程序，并应用您指定的内核命令行参数。
				</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>更新内核命令行参数的另一种方法是编辑<code class="literal">GRUB_CMDLINE_LINUX</code>文件中的<code class="literal">/etc/default/grub</code>参数，并执行<code class="literal"># grub2-mkconfig -o /boot/grub2/grub.cfg</code>命令以更新GRUB2配置文件。
					</p></div><h4><a id="additional_resources_5"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关如何使用GRUB2配置文件修改内核参数的更多信息，请参阅<span class="emphasis"><em><span class="citetitle"><a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/system_administrators_guide/#sec-Editing_a_Menu_Entry">编辑菜单项</a></span></em></span> 。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="changing-kernel-command-line-parameters-for-a-single-boot-entry_setting-kernel-command-line-parameters"></a>更改单个引导条目的内核命令行参数</h2></div></div></div><p>此过程描述如何更改系统上单个引导条目的内核命令行参数。
				</p><h4><a id="prerequisites_3"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><a class="link" href="configuring-kernel-command-line-parameters_managing-monitoring-and-updating-the-kernel.html#what-are-kernel-command-line-parameters_configuring-kernel-command-line-parameters" title="什么是内核命令行参数">内核命令行参数</a>简介。
						</li><li class="listitem">
							<code class="literal">grubby(8)</code>手册页。
						</li></ul></div><h4><a id="procedure_5"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要添加参数，请执行以下命令：</p><pre class="literallayout"># grubby --update-kernel=/boot/vmlinuz-$(uname -r) --args="&lt;<span class="emphasis"><em>NEW_PARAMETER</em></span>&gt;"</pre></li><li class="listitem"><p class="simpara">要删除参数，请使用以下命令：</p><pre class="literallayout"># grubby --update-kernel=/boot/vmlinuz-$(uname -r) --remove-args="&lt;<span class="emphasis"><em>PARAMETER_TO_REMOVE</em></span>&gt;"</pre></li></ul></div><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>默认情况下，每个内核引导条目都有<code class="literal">options</code>参数，该参数设置为<code class="literal">kernelopts</code>变量。此变量在<code class="literal">/boot/grub2/grubenv</code>配置文件中定义。
					</p></div><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>修改特定引导条目时，已编辑的<code class="literal">kernelopts</code>的内容存储在<code class="literal">/boot/loader/entries/&lt;<span class="emphasis"><em>RELEVANT_KERNEL_BOOT_ENTRY.conf</em></span>&gt;</code>中的相关内核引导条目中，并且现在拥有自己的命令行。因此，对<code class="literal">kernelopts</code>任何其他更改都不会影响该特定内核引导条目。
					</p></div><h4><a id="additional_resources_6"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关如何使用<code class="literal">grubby</code>更多示例，请参阅<span class="emphasis"><em><span class="citetitle"><a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/sec-making_persistent_changes_to_a_grub_2_menu_using_the_grubby_tool">grubby工具</a></span></em></span> 。
						</li></ul></div></div></div></div></body></html>