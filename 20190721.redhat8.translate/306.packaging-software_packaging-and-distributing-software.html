<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 3. Packaging software</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="packaging-software_packaging-and-distributing-software"/>Chapter 3. Packaging software</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="rpm-packages_packaging-software"/>RPM packages</h1></div></div></div><p>
				This section covers the basics of the RPM packaging format.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="what-is-an-rpm_rpm-packages"/>What an RPM is</h2></div></div></div><p>
					An RPM package is a file containing other files and their metadata (information about the files that are needed by the system).
				</p><p>
					Specifically, an RPM package consists of the <code class="literal">cpio</code> archive.
				</p><p>
					The <code class="literal">cpio</code> archive contains:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Files
						</li><li class="listitem"><p class="simpara">
							RPM header (package metadata)
						</p><p class="simpara">
							The <code class="literal">rpm</code> package manager uses this metadata to determine dependencies, where to install files, and other information.
						</p></li></ul></div><h4><a id="types_of_rpm_packages"/>Types of RPM packages</h4><p>
					There are two types of RPM packages. Both types share the file format and tooling, but have different contents and serve different purposes:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							Source RPM (SRPM)
						</p><p class="simpara">
							An SRPM contains source code and a SPEC file, which describes how to build the source code into a binary RPM. Optionally, the patches to source code are included as well.
						</p></li><li class="listitem"><p class="simpara">
							Binary RPM
						</p><p class="simpara">
							A binary RPM contains the binaries built from the sources and patches.
						</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="rpm-packaging-tools_rpm-packages"/>Listing RPM packaging tool’s utilities</h2></div></div></div><p>
					The following procedures show how to list the utilities provided by the <code class="literal">rpmdevtools</code> package.
				</p><h4><a id="prerequisite"/>Prerequisite</h4><p>
					To be able to use the RPM packaging tools, you need to install the <code class="literal">rpmdevtools</code> package, which provides several utilities for packaging RPMs.
				</p><pre class="literallayout"># yum install rpmdevtools</pre><h4><a id="procedure_12"/>Procedure</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							List RPM packaging tool’s utilities:
						</li></ul></div><pre class="literallayout">$ rpm -ql rpmdevtools | grep bin</pre><p>
					For more information on the above utilities, see their manual pages or help dialogs.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="setting-up-rpm-packaging-workspace_rpm-packages"/>Setting up RPM packaging workspace</h2></div></div></div><p>
					This section describes how to set up a directory layout that is the RPM packaging workspace by using the <code class="literal">rpmdev-setuptree</code> utility.
				</p><h4><a id="prerequisites_4"/>Prerequisites</h4><p>
					The <code class="literal">rpmdevtools</code> package must be installed on your system:
				</p><pre class="literallayout"># yum install rpmdevtools</pre><h4><a id="procedure_13"/>Procedure</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Run the <code class="literal">rpmdev-setuptree</code> utility:
						</li></ul></div><pre class="literallayout">$ rpmdev-setuptree

$ tree ~/rpmbuild/
/home/user/rpmbuild/
|-- BUILD
|-- RPMS
|-- SOURCES
|-- SPECS
`-- SRPMS

5 directories, 0 files</pre><p>
					The created directories serve these purposes:
				</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><tbody><tr><td style="text-align: left" valign="top"> <p>
									Directory
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Purpose
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									BUILD
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									When packages are built, various <code class="literal">%buildroot</code> directories are created here. This is useful for investigating a failed build if the logs output do not provide enough information.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									RPMS
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Binary RPMs are created here, in subdirectories for different architectures, for example in subdirectories <code class="literal">x86_64</code> and <code class="literal">noarch</code>.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									SOURCES
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									Here, the packager puts compressed source code archives and patches. The <code class="literal">rpmbuild</code> command looks for them here.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									SPECS
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									The packager puts SPEC files here.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									SRPMS
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									When <code class="literal">rpmbuild</code> is used to build an SRPM instead of a binary RPM, the resulting SRPM is created here.
								</p>
								 </td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="what-is-a-spec-file_rpm-packages"/>What a SPEC file is</h2></div></div></div><p>
					You can understand a SPEC file as a recipe that the <code class="literal">rpmbuild</code> utility uses to build an RPM. A SPEC file provides necessary information to the build system by defining instructions in a series of sections. The sections are defined in the <span class="emphasis"><em>Preamble</em></span> and the <span class="emphasis"><em>Body</em></span> part. The <span class="emphasis"><em>Preamble</em></span> part contains a series of metadata items that are used in the <span class="emphasis"><em>Body</em></span> part. The <span class="emphasis"><em>Body</em></span> part represents the main part of the instructions.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="preamble-items"/>Preamble Items</h3></div></div></div><p>
						The table below presents some of the directives that are used frequently in the <span class="emphasis"><em>Preamble</em></span> section of the RPM SPEC file.
					</p><div class="table"><a id="idm140116090264384"/><p class="title"><strong>Table 3.1. Items used in the <code class="literal"><span class="emphasis"><em>Preamble</em></span></code> section of the RPM SPEC file</strong></p><div class="table-contents"><table summary="Items used in the Preamble section of the RPM SPEC file" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">SPEC Directive</th><th style="text-align: left" valign="top">Definition</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">Name</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										The base name of the package, which should match the SPEC file name.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">Version</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										The upstream version number of the software.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">Release</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										The number of times this version of the software was released. Normally, set the initial value to 1%{?dist}, and increment it with each new release of the package. Reset to 1 when a new <code class="literal">Version</code> of the software is built.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">Summary</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										A brief, one-line summary of the package.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">License</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										The license of the software being packaged.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">URL</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										The full URL for more information about the program. Most often this is the upstream project website for the software being packaged.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">Source0</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										Path or URL to the compressed archive of the upstream source code (unpatched, patches are handled elsewhere). This should point to an accessible and reliable storage of the archive, for example, the upstream page and not the packager’s local storage. If needed, more SourceX directives can be added, incrementing the number each time, for example: Source1, Source2, Source3, and so on.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">Patch</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										The name of the first patch to apply to the source code if necessary.
									</p>
									 <p>
										The directive can be applied in two ways: with or without numbers at the end of Patch.
									</p>
									 <p>
										If no number is given, one is assigned to the entry internally. It is also possible to give the numbers explicitly using Patch0, Patch1, Patch2, Patch3, and so on.
									</p>
									 <p>
										These patches can be applied one by one using the %patch0, %patch1, %patch2 macro and so on. The macros are applied within the %prep directive in the <span class="emphasis"><em>Body</em></span> section of the RPM SPEC file. Alternatively, you can use the %autopatch macro which automatically applies all patches in the order they are given in the SPEC file.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">BuildArch</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										If the package is not architecture dependent, for example, if written entirely in an interpreted programming language, set this to <code class="literal">BuildArch: noarch</code>. If not set, the package automatically inherits the Architecture of the machine on which it is built, for example <code class="literal">x86_64</code>.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">BuildRequires</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										A comma or whitespace-separated list of packages required for building the program written in a compiled language. There can be multiple entries of <code class="literal">BuildRequires</code>, each on its own line in the SPEC file.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">Requires</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										A comma- or whitespace-separated list of packages required by the software to run once installed. There can be multiple entries of <code class="literal">Requires</code>, each on its own line in the SPEC file.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">ExcludeArch</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										If a piece of software can not operate on a specific processor architecture, you can exclude that architecture here.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">Conflicts</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										<code class="literal">Conflicts</code> are inverse to <code class="literal">Requires</code>. If there is a package matching <code class="literal">Conflicts</code>, the package cannot be installed independently on whether the <code class="literal">Conflict</code> tag is on the package that has already been installed or on a package that is going to be installed.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">Obsoletes</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										This directive alters the way updates work depending on whether the <code class="literal">rpm</code> command is used directly on the command line or the update is performed by an updates or dependency solver. When used on a command line, RPM removes all packages matching obsoletes of packages being installed. When using an update or dependency resolver, packages containing matching <code class="literal">Obsoletes:</code> are added as updates and replace the matching packages.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">Provides</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										If <code class="literal">Provides</code> is added to a package, the package can be referred to by dependencies other than its name.
									</p>
									 </td></tr></tbody></table></div></div><p>
						The <code class="literal">Name</code>, <code class="literal">Version</code>, and <code class="literal">Release</code> directives comprise the file name of the RPM package. RPM package maintainers and system administrators often call these three directives <span class="strong"><strong>N-V-R</strong></span> or <span class="strong"><strong>NVR</strong></span>, because RPM package filenames have the <code class="literal">NAME-VERSION-RELEASE</code> format.
					</p><p>
						The following example shows how to obtain the <span class="strong"><strong>NVR</strong></span> information for a specific package by querying the <code class="literal">rpm</code> command.
					</p><div class="example"><a id="idm140115980533200"/><p class="title"><strong>Example 3.1. Querying rpm to provide the NVR information for the python package</strong></p><div class="example-contents"><pre class="literallayout"># rpm -q bash
bash-4.4.19-7.el8.x86_64</pre></div></div><p>
						Here, <code class="literal">bash</code> is the package name, <code class="literal">4.4.19</code> is the version, and <code class="literal">7.el8</code> is the release. The final marker is <code class="literal">x86_64</code>, which signals the architecture. Unlike the <span class="strong"><strong>NVR</strong></span>, the architecture marker is not under direct control of the RPM packager, but is defined by the <code class="literal">rpmbuild</code> build environment. The exception to this is the architecture-independent <code class="literal">noarch</code> package.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="body-items"/>Body Items</h3></div></div></div><p>
						The items used in the <code class="literal">Body section</code> of the RPM SPEC file are listed in the table below.
					</p><div class="table"><a id="idm140116095038896"/><p class="title"><strong>Table 3.2. Items used in the Body section of the RPM SPEC file</strong></p><div class="table-contents"><table summary="Items used in the Body section of the RPM SPEC file" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">SPEC Directive</th><th style="text-align: left" valign="top">Definition</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">%description</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										A full description of the software packaged in the RPM. This description can span multiple lines and can be broken into paragraphs.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">%prep</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										Command or series of commands to prepare the software to be built, for example, unpacking the archive in <code class="literal">Source0</code>. This directive can contain a shell script.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">%build</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										Command or series of commands for building the software into machine code (for compiled languages) or byte code (for some interpreted languages).
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">%install</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										Command or series of commands for copying the desired build artifacts from the <code class="literal">%builddir</code> (where the build happens) to the <code class="literal">%buildroot</code> directory (which contains the directory structure with the files to be packaged). This usually means copying files from <code class="literal">~/rpmbuild/BUILD</code> to <code class="literal">~/rpmbuild/BUILDROOT</code> and creating the necessary directories in <code class="literal">~/rpmbuild/BUILDROOT</code>. This is only run when creating a package, not when the end-user installs the package. See <a class="xref" href="packaging-software_packaging-and-distributing-software.html#working-with-spec-files" title="Working with SPEC files">the section called “Working with SPEC files”</a> for details.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">%check</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										Command or series of commands to test the software. This normally includes things such as unit tests.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">%files</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										The list of files that will be installed in the end user’s system.
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">%changelog</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										A record of changes that have happened to the package between different <code class="literal">Version</code> or <code class="literal">Release</code> builds.
									</p>
									 </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="advanced-items"/>Advanced items</h3></div></div></div><p>
						The SPEC file can also contain advanced items, such as <a class="link" href="advanced-topics.html#scriptlets_epoch-scriplets-and-triggers" title="The Scriptlets directives">Scriptlets</a> or <a class="link" href="advanced-topics.html#triggers_epoch-scriplets-and-triggers" title="The Triggers directives">Triggers</a>. They take effect at different points during the installation process on the end user’s system, not the build process.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="buildroots_rpm-packages"/>BuildRoots</h2></div></div></div><p>
					In the context of RPM packaging, <code class="literal">buildroot</code> is a chroot environment. This means that the build artifacts are placed here using the same file system hierarchy as the future hierarchy in end user’s system, with <code class="literal">buildroot</code> acting as the root directory. The placement of build artifacts should comply with the file system hierarchy standard of the end user’s system.
				</p><p>
					The files in <code class="literal">buildroot</code> are later put into a <code class="literal">cpio</code> archive, which becomes the main part of the RPM. When RPM is installed on the end user’s system, these files are extracted in the <code class="literal">root</code> directory, preserving the correct hierarchy.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						Starting from Red Hat Enterprise Linux 6, the <code class="literal">rpmbuild</code> program has its own defaults. Overriding these defaults leads to several problems; hence, Red Hat does not recommend to define your own value of this macro. You can use the <code class="literal">%{buildroot}</code> macro with the defaults from the <code class="literal">rpmbuild</code> directory.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="rpm-macros_rpm-packages"/>RPM macros</h2></div></div></div><p>
					An <a class="link" href="http://rpm.org/user_doc/macros.html">rpm macro</a> is a straight text substitution that can be conditionally assigned based on the optional evaluation of a statement when certain built-in functionality is used. Hence, RPM can perform text substitutions for you.
				</p><p>
					An example use is referencing the packaged software <span class="emphasis"><em>Version</em></span> multiple times in a SPEC file. You define <span class="emphasis"><em>Version</em></span> only once in the <code class="literal">%{version}</code> macro, and use this macro throughout the SPEC file. Every occurrence will be automatically substituted by <span class="emphasis"><em>Version</em></span> that you defined previously.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						If you see an unfamiliar macro, you can evaluate it with the following command:
					</p><pre class="literallayout">$ rpm --eval %{_MACRO}</pre><pre class="literallayout">$ rpm --eval %{_bindir}
/usr/bin

$ rpm --eval %{_libexecdir}
/usr/libexec</pre></div><p>
					On of the commonly-used macros is the <code class="literal">%{?dist}</code> macro, which signals which distribution is used for the build (distribution tag).
				</p><pre class="literallayout"># On a RHEL 8.x machine
$ rpm --eval %{?dist}
.el8</pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="working-with-spec-files"/>Working with SPEC files</h1></div></div></div><p>
				This section describes how to create and modify a SPEC file.
			</p><h3><a id="prerequisites_5"/>Prerequisites</h3><p>
				This section uses the three example implementations of the <code class="literal">Hello World!</code> program that were described in <a class="xref" href="preparing-software-for-rpm-packaging_packaging-and-distributing-software.html#source-code-examples" title="Source code examples">the section called “Source code examples”</a>.
			</p><p>
				Each of the programs is also fully described in the below table.
			</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><tbody><tr><td style="text-align: left" valign="top"> <p>
								Software Name
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Explanation of example
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								bello
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								A program written in a raw interpreted programming language. It demonstrates when the source code does not need to be built, but only needs to be installed. If a pre-compiled binary needs to be packaged, you can also use this method since the binary would also just be a file.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								pello
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								A program written in a byte-compiled interpreted programming language. It demonstrates byte-compiling the source code and installating the bytecode - the resulting pre-optimized files.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								cello
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								A program written in a natively compiled programming language. It demonstrates a common process of compiling the source code into machine code and installing the resulting executables.
							</p>
							 </td></tr></tbody></table></div><p>
				The implementations of <code class="literal">Hello World!</code> are:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<a class="link" href="https://github.com/redhat-developer/rpm-packaging-guide/raw/master/example-code/bello-0.1.tar.gz">bello-0.1.tar.gz</a>
					</li></ul></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<a class="link" href="https://github.com/redhat-developer/rpm-packaging-guide/raw/master/example-code/pello-0.1.2.tar.gz">pello-0.1.2.tar.gz</a>
					</li><li class="listitem"><p class="simpara">
						<a class="link" href="https://github.com/redhat-developer/rpm-packaging-guide/raw/master/example-code/cello-1.0.tar.gz">cello-1.0.tar.gz</a>
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="link" href="https://raw.githubusercontent.com/redhat-developer/rpm-packaging-guide/master/example-code/cello-output-first-patch.patch">cello-output-first-patch.patch</a>
							</li></ul></div></li></ul></div><p>
				As a prerequisite, these implementations need to be placed into the <code class="literal">~/rpmbuild/SOURCES</code> directory.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ways_to_create_a_new_spec_file"/>Ways to create a new SPEC file</h2></div></div></div><p>
					To package new software, you need to create a new SPEC file.
				</p><p>
					There are two to achieve this:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Writing the new SPEC file manually from scratch
						</li><li class="listitem"><p class="simpara">
							Use the <code class="literal">rpmdev-newspec</code> utility
						</p><p class="simpara">
							This utility creates an unpopulated SPEC file, and you fill in the necessary directives and fields.
						</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						Some programmer-focused text editors pre-populate a new <code class="literal">.spec</code> file with their own SPEC template. The <code class="literal">rpmdev-newspec</code> utility provides an editor-agnostic method.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-spec-files-with-rpmdev-newspec_working-with-spec-files"/>Creating a new SPEC file with rpmdev-newspec</h2></div></div></div><p>
					The following procedure shows how to create a SPEC file for each of the three aforementioned <code class="literal">Hello World!</code> programs using the <code class="literal">rpmdev-newspec</code> utility.
				</p><h4><a id="procedure_14"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Change to the <code class="literal">~/rpmbuild/SPECS</code> directory and use the <code class="literal">rpmdev-newspec</code> utility:
						</p><pre class="literallayout">$ cd ~/rpmbuild/SPECS

$ rpmdev-newspec bello
bello.spec created; type minimal, rpm version &gt;= 4.11.

$ rpmdev-newspec cello
cello.spec created; type minimal, rpm version &gt;= 4.11.

$ rpmdev-newspec pello
pello.spec created; type minimal, rpm version &gt;= 4.11.</pre><p class="simpara">
							The <code class="literal">~/rpmbuild/SPECS/</code> directory now contains three SPEC files named <code class="literal">bello.spec</code>, <code class="literal">cello.spec</code>, and <code class="literal">pello.spec</code>.
						</p></li></ol></div><p>
					fd. Examine the files:
				</p><p>
					+ The directives in the files represent those described in the <a class="xref" href="packaging-software_packaging-and-distributing-software.html#what-is-a-spec-file_rpm-packages" title="What a SPEC file is">the section called “What a SPEC file is”</a> section. In the following sections, you will populate particular section in the output files of <code class="literal">rpmdev-newspec</code>.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						The <code class="literal">rpmdev-newspec</code> utility does not use guidelines or conventions specific to any particular Linux distribution. However, this document targets Red Hat Enterprise Linux, so the <code class="literal">%{buildroot}</code> notation is preferred over the <code class="literal">$RPM_BUILD_ROOT</code> notation when referencing RPM’s Buildroot for consistency with all other defined or provided macros throughout the SPEC file.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="modifying-a-spec-file_working-with-spec-files"/>Modifying an original SPEC file for creating RPMs</h2></div></div></div><p>
					The following procedure shows how to modify the output SPEC file provided by <code class="literal">rpmdev-newspec</code> for creating the RPMs.
				</p><h4><a id="prerequisites_6"/>Prerequisites</h4><p>
					Make sure that:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The source code of the particular program has been placed into the <code class="literal">~/rpmbuild/SOURCES/</code> directory.
						</li><li class="listitem">
							The unpopulated SPEC file <code class="literal">~/rpmbuild/SPECS/&lt;name&gt;.spec</code> file has been created by the <code class="literal">rpmdev-newspec</code> utility.
						</li></ul></div><h4><a id="procedure_15"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Open the output template of the <code class="literal">~/rpmbuild/SPECS/&lt;name&gt;.spec</code> file provided by the <code class="literal">rpmdev-newspec</code> utility:
						</li><li class="listitem"><p class="simpara">
							Populate the first section of the SPEC file:
						</p><p class="simpara">
							The first section includes these directives that <code class="literal">rpmdev-newspec</code> grouped together:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									<code class="literal">Name</code>
								</li><li class="listitem">
									<code class="literal">Version</code>
								</li><li class="listitem">
									<code class="literal">Release</code>
								</li><li class="listitem"><p class="simpara">
									<code class="literal">Summary</code>
								</p><p class="simpara">
									The <code class="literal">Name</code> was already specified as an argument to <code class="literal">rpmdev-newspec</code>.
								</p><p class="simpara">
									Set the <code class="literal">Version</code> to match the upstream release version of the source code.
								</p><p class="simpara">
									The <code class="literal">Release</code> is automatically set to <code class="literal">1%{?dist}</code>, which is initially <code class="literal">1</code>. Increment the initial value whenever updating the package without a change in the upstream release <code class="literal">Version</code> - such as when including a patch. Reset <code class="literal">Release</code> to <code class="literal">1</code> when a new upstream release happens.
								</p><p class="simpara">
									The <code class="literal">Summary</code> is a short, one-line explanation of what this software is.
								</p></li></ul></div></li><li class="listitem"><p class="simpara">
							Populate the <code class="literal">License</code>, <code class="literal">URL</code>, and <code class="literal">Source0</code> directives:
						</p><p class="simpara">
							The <code class="literal">License</code> field is the Software License associated with the source code from the upstream release. The exact format for how to label the <code class="literal">License</code> in your SPEC file will vary depending on which specific RPM based Linux distribution guidelines you are following.
						</p><p class="simpara">
							For example, you can use <a class="link" href="https://www.gnu.org/licenses/quick-guide-gplv3.html">GPLv3+</a>.
						</p><p class="simpara">
							The <code class="literal">URL</code> field provides URL to the upstream software website. For consistency, utilize the RPM macro variable of <code class="literal">%{name}</code>, and use <code class="literal"><a class="link" href="https://example.com/%{name}">https://example.com/%{name}</a></code>.
						</p><p class="simpara">
							The <code class="literal">Source0</code> field provides URL to the upstream software source code. It should link directly to the specific version of software that is being packaged. Note that the example URLs given in this documentation include hard-coded values that are possible subject to change in the future. Similarly, the release version can change as well. To simplify these potential future changes, use the <code class="literal">%{name}</code> and <code class="literal">%{version}</code> macros. By using these, you need to update only one field in the SPEC file.
						</p></li><li class="listitem"><p class="simpara">
							Populate the <code class="literal">BuildRequires</code>, <code class="literal">Requires</code> and <code class="literal">BuildArch</code> directives:
						</p><p class="simpara">
							<code class="literal">BuildRequires</code> specifies build-time dependencies for the package.
						</p><p class="simpara">
							<code class="literal">Requires</code> specifies run-time dependencies for the package.
						</p><p class="simpara">
							This is a software written in an interpreted programming language with no natively compiled extensions. Hence, add the <code class="literal">BuildArch</code> directive with the <code class="literal">noarch</code> value. This tells RPM that this package does not need to be bound to the processor architecture on which it is built.
						</p></li><li class="listitem"><p class="simpara">
							Populate the <code class="literal">%description</code>, <code class="literal">%prep</code>, <code class="literal">%build</code>, <code class="literal">%install</code>, <code class="literal">%files</code>, and <code class="literal">%license</code> directives:
						</p><p class="simpara">
							These directives can be thought of as section headings, because they are directives that can define multi-line, multi-instruction, or scripted tasks to occur.
						</p><p class="simpara">
							The <code class="literal">%description</code> is a longer, fuller description of the software than <code class="literal">Summary</code>, containing one or more paragraphs.
						</p><p class="simpara">
							The <code class="literal">%prep</code> section specifies how to prepare the build environment. This usually involves expansion of compressed archives of the source code, application of patches, and, potentially, parsing of information provided in the source code for use in a later portion of the SPEC file. In this section you can use the built-in <code class="literal">%setup -q</code> macro.
						</p><p class="simpara">
							The <code class="literal">%build</code> section specifies how to build the software.
						</p><p class="simpara">
							The <code class="literal">%install</code> section contains instructions for <code class="literal">rpmbuild</code> on how to install the software, once it has been built, into the <code class="literal">BUILDROOT</code> directory.
						</p><p class="simpara">
							This directory is an empty chroot base directory, which resembles the end user’s root directory. Here you can create any directories that will contain the installed files. To create such directories, you can use the RPM macros without having to hardcode the paths.
						</p><p class="simpara">
							The <code class="literal">%files</code> section specifies the list of files provided by this RPM and their full path location on the end user’s system.
						</p><p class="simpara">
							Within this section, you can indicate the role of various files using built-in macros. This is useful for querying the package file manifest metadata using the command[]<code class="literal">rpm</code> command. For example, to indicate that the LICENSE file is a software license file, use the <code class="literal">%license</code> macro.
						</p></li><li class="listitem"><p class="simpara">
							The last section, <code class="literal">%changelog</code>, is a list of datestamped entries for each Version-Release of the package. They log packaging changes, not software changes. Examples of packaging changes: adding a patch, changing the build procedure in the <code class="literal">%build</code> section.
						</p><p class="simpara">
							Follow this format for the first line:
						</p><p class="simpara">
							Start with an <code class="literal">*</code> character followed by <code class="literal">Day-of-Week Month Day Year Name Surname &lt;email&gt; - Version-Release</code>
						</p><p class="simpara">
							Follow this format for the actual change entry:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									Each change entry can contain multiple items, one for each change.
								</li><li class="listitem">
									Each item starts on a new line.
								</li><li class="listitem">
									Each item begins with a <code class="literal">-</code> character.
								</li></ul></div></li></ol></div><p>
					You have now written an entire SPEC file for the required program.
				</p><p>
					For examples of SPEC file written in different programming languages, see:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="link" href="packaging-software_packaging-and-distributing-software.html#an-example-spec-file-for-bello_working-with-spec-files" title="An example SPEC file for a program written in bash">An example SPEC file for a program written in bash</a>
						</li><li class="listitem">
							<a class="link" href="packaging-software_packaging-and-distributing-software.html#an-example-spec-file-for-pello_working-with-spec-files" title="An example SPEC file for a program written in Python">An example SPEC file for a program written in Python</a>
						</li><li class="listitem">
							<a class="link" href="packaging-software_packaging-and-distributing-software.html#an-example-spec-file-for-cello_working-with-spec-files" title="An example SPEC file for a program written in C">An example SPEC file for a program written in C</a>
						</li></ul></div><p>
					Building the RPM from the SPEC file is described in <a class="xref" href="packaging-software_packaging-and-distributing-software.html#building-rpms_packaging-software" title="Building RPMs">the section called “Building RPMs”</a>.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="an-example-spec-file-for-bello_working-with-spec-files"/>An example SPEC file for a program written in bash</h2></div></div></div><p>
					This section shows an example SPEC file for the <span class="strong"><strong>bello</strong></span> program that was written in bash. For more information about <span class="strong"><strong>bello</strong></span>, see <a class="xref" href="preparing-software-for-rpm-packaging_packaging-and-distributing-software.html#source-code-examples" title="Source code examples">the section called “Source code examples”</a>.
				</p><div class="title"><strong>An example SPEC file for the <span class="strong"><strong>bello</strong></span> program written in bash</strong></div><p>
						
</p><pre class="literallayout">Name:           bello
Version:        0.1
Release:        1%{?dist}
Summary:        Hello World example implemented in bash script

License:        GPLv3+
URL:            <a class="link" href="https://www.example.com/%{name}">https://www.example.com/%{name}</a>
Source0:        <a class="link" href="https://www.example.com/%{name}/releases/%{name}-%{version}.tar.gz">https://www.example.com/%{name}/releases/%{name}-%{version}.tar.gz</a>

Requires:       bash

BuildArch:      noarch

%description
The long-tail description for our Hello World Example implemented in
bash script.

%prep
%setup -q

%build

%install

mkdir -p %{buildroot}/%{_bindir}

install -m 0755 %{name} %{buildroot}/%{_bindir}/%{name}

%files
%license LICENSE
%{_bindir}/%{name}

%changelog
* Tue May 31 2016 Adam Miller &lt;<a class="link" href="mailto:maxamillion@fedoraproject.org">maxamillion@fedoraproject.org</a>&gt; - 0.1-1
- First bello package
- Example second item in the changelog for version-release 0.1-1</pre><p>

					</p><p>
					The <code class="literal">BuildRequires</code> directive, which specifies build-time dependencies for the package, was deleted because there is no building step for <code class="literal">bello</code>. Bash is a raw interpreted programming language, and the files are just installed to their location on the system.
				</p><p>
					The <code class="literal">Requires</code> directive, which specifies run-time dependencies for the package, include only <code class="literal">bash</code>, because the <code class="literal">bello</code> script requires only the <code class="literal">bash</code> shell environment to execute.
				</p><p>
					The <code class="literal">%build</code> section, which specifies how to build the software, is blank, because a <code class="literal">bash</code> does not need to be built.
				</p><p>
					For installing <code class="literal">bello</code> you only need to create the destination directory and install the executable <code class="literal">bash</code> script file there. Hence, you can use the <code class="literal">install</code> command in the <code class="literal">%install</code> section. RPM macros allow to do this without hardcoding paths.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="an-example-spec-file-for-pello_working-with-spec-files"/>An example SPEC file for a program written in Python</h2></div></div></div><p>
					This section shows an example SPEC file for the <span class="strong"><strong>pello</strong></span> program written in the Python programming language. For more information about <span class="strong"><strong>pello</strong></span>, see <a class="xref" href="preparing-software-for-rpm-packaging_packaging-and-distributing-software.html#source-code-examples" title="Source code examples">the section called “Source code examples”</a>.
				</p><div class="title"><strong>An example SPEC file for the <span class="strong"><strong>pello</strong></span> program written in Python</strong></div><p>
						
</p><pre class="literallayout">Name:           pello
Version:        0.1.1
Release:        1%{?dist}
Summary:        Hello World example implemented in Python

License:        GPLv3+
URL:            <a class="link" href="https://www.example.com/%{name}">https://www.example.com/%{name}</a>
Source0:        <a class="link" href="https://www.example.com/%{name}/releases/%{name}-%{version}.tar.gz">https://www.example.com/%{name}/releases/%{name}-%{version}.tar.gz</a>

BuildRequires:  python
Requires:       python
Requires:       bash

BuildArch:      noarch

%description
The long-tail description for our Hello World Example implemented in Python.

%prep
%setup -q

%build

python -m compileall %{name}.py

%install

mkdir -p %{buildroot}/%{_bindir}
mkdir -p %{buildroot}/usr/lib/%{name}

cat &gt; %{buildroot}/%{_bindir}/%{name} &lt;←EOF
#!/bin/bash
/usr/bin/python /usr/lib/%{name}/%{name}.pyc
EOF

chmod 0755 %{buildroot}/%{_bindir}/%{name}

install -m 0644 %{name}.py* %{buildroot}/usr/lib/%{name}/

%files
%license LICENSE
%dir /usr/lib/%{name}/
%{_bindir}/%{name}
/usr/lib/%{name}/%{name}.py*

%changelog
* Tue May 31 2016 Adam Miller &lt;<a class="link" href="mailto:maxamillion@fedoraproject.org">maxamillion@fedoraproject.org</a>&gt; - 0.1.1-1
  - First pello package</pre><p>

					</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						The <span class="strong"><strong>pello</strong></span> program is written in a byte-compiled interpreted language. Hence, the shebang is not applicable because the resulting file does not contain the entry.
					</p><p>
						Because the shebang is not applicable, you may want to apply one of the following approaches:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								Create a non-byte-compiled shell script that will call the executable.
							</li><li class="listitem">
								Provide a small bit of the Python code that is not byte-compiled as the entry point into the program’s execution.
							</li></ul></div><p>
						These approaches are useful especially for large software projects with many thousands of lines of code, where the performance increase of pre-byte-compiled code is sizeable.
					</p></div><p>
					The <code class="literal">BuildRequires</code> directive, which specifies build-time dependencies for the package, includes two packages:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">python</code> package is needed to perform the byte-compile build process
						</li><li class="listitem">
							The <code class="literal">bash</code> package is needed to execute the small entry-point script
						</li></ul></div><p>
					The <code class="literal">Requires</code> directive, which specifies run-time dependencies for the package, includes only the <code class="literal">python</code> package. The <code class="literal">pello</code> program requires the <code class="literal">python</code> package to execute the byte-compiled code at runtime.
				</p><p>
					The <code class="literal">%build</code> section, which specifies how to build the software, corresponds to the fact that the software is byte-compiled.
				</p><p>
					To install <code class="literal">pello</code>, you need to create a wrapper script because the shebang is not applicable in byte-compiled languages. There are multiple options to accomplish this, such as:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Making a separate script and using that as a separate <code class="literal">SourceX</code> directive.
						</li><li class="listitem">
							Creating the file in-line in the SPEC file.
						</li></ul></div><p>
					This example shows creating a wrapper script in-line in the SPEC file to demonstrate that the SPEC file itself is scriptable. This wrapper script will execute the Python byte-compiled code by using a <code class="literal">here</code> document.
				</p><p>
					The <code class="literal">%install</code> section in this example also corresponds to the fact that you will need to install the byte-compiled file into a library directory on the system such that it can be accessed.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="an-example-spec-file-for-cello_working-with-spec-files"/>An example SPEC file for a program written in C</h2></div></div></div><p>
					This section shows an example SPEC file for the <span class="strong"><strong>cello</strong></span> program that was written in the C programming language. For more information about <span class="strong"><strong>cello</strong></span>, see <a class="xref" href="preparing-software-for-rpm-packaging_packaging-and-distributing-software.html#source-code-examples" title="Source code examples">the section called “Source code examples”</a>.
				</p><div class="title"><strong>An example SPEC file for the <span class="strong"><strong>cello</strong></span> program written in C</strong></div><p>
						
</p><pre class="literallayout">Name:           cello
Version:        1.0
Release:        1%{?dist}
Summary:        Hello World example implemented in C

License:        GPLv3+
URL:            <a class="link" href="https://www.example.com/%{name}">https://www.example.com/%{name}</a>
Source0:        <a class="link" href="https://www.example.com/%{name}/releases/%{name}-%{version}.tar.gz">https://www.example.com/%{name}/releases/%{name}-%{version}.tar.gz</a>

Patch0:         cello-output-first-patch.patch

BuildRequires:  gcc
BuildRequires:  make

%description
The long-tail description for our Hello World Example implemented in
C.

%prep
%setup -q

%patch0

%build
make %{?_smp_mflags}

%install
%make_install

%files
%license LICENSE
%{_bindir}/%{name}

%changelog
* Tue May 31 2016 Adam Miller &lt;<a class="link" href="mailto:maxamillion@fedoraproject.org">maxamillion@fedoraproject.org</a>&gt; - 1.0-1
- First cello package</pre><p>

					</p><p>
					The <code class="literal">BuildRequires</code> directive, which specifies build-time dependencies for the package, includes two packages that are needed to perform the compilation build process:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">gcc</code> package
						</li><li class="listitem">
							The <code class="literal">make</code> package
						</li></ul></div><p>
					The <code class="literal">Requires</code> directive, which specifies run-time dependencies for the package, is omitted in this example. All runtime requirements are handled by <code class="literal">rpmbuild</code>, and the <code class="literal">cello</code> program does not require anything outside of the core C standard libraries.
				</p><p>
					The <code class="literal">%build</code> section reflects the fact that in this example a <code class="literal">Makefile</code> for the <span class="strong"><strong>cello</strong></span> program was written, hence the <a class="link" href="http://www.gnu.org/software/make/">GNU make</a> command provided by the <code class="literal">rpmdev-newspec</code> utility can be used. However, you need to remove the call to <code class="literal">%configure</code> because you did not provide a configure script.
				</p><p>
					The installation of the <span class="strong"><strong>cello</strong></span> program can be accomplished by using the <code class="literal">%make_install</code> macro that was provided by the <code class="literal">rpmdev-newspec</code> command. This is possible because the <code class="literal">Makefile</code> for the <span class="strong"><strong>cello</strong></span> program is available.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="building-rpms_packaging-software"/>Building RPMs</h1></div></div></div><p>
				This section describes how to build an RPM after a SPEC file for a program has been created.
			</p><p>
				RPMs are built with the <code class="literal">rpmbuild</code> command. This command expects a certain directory and file structure, which is the same as the structure that was set up by the <code class="literal">rpmdev-setuptree</code> utility.
			</p><p>
				Different use cases and desired outcomes require different combinations of arguments to the <code class="literal">rpmbuild</code> command. This section describes the two main use cases:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<a class="xref" href="packaging-software_packaging-and-distributing-software.html#building-source-rpms" title="Building source RPMs">the section called “Building source RPMs”</a>
					</li><li class="listitem">
						<a class="xref" href="packaging-software_packaging-and-distributing-software.html#building-binary-rpms" title="Building binary RPMS">the section called “Building binary RPMS”</a>
					</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="building-source-rpms"/>Building source RPMs</h2></div></div></div><p>
					There are two main reasons to build source RPMs (SRPMs):
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							To preserve the exact source of a certain Name-Version-Release of the RPM that was deployed to an environment.
						</p><p class="simpara">
							This includes the exact SPEC file, the source code, and all relevant patches. Source RPMs are useful for looking back in history and for debugging.
						</p></li><li class="listitem">
							To be able to build a binary RPM on a different hardware platform or architecture.
						</li></ul></div><h4><a id="prerequisites_7"/>Prerequisites</h4><p>
					A SPEC file for the program that we want to package must already exist. For more information on creating SPEC files, see <a class="link" href="packaging-software_packaging-and-distributing-software.html#working-with-spec-files" title="Working with SPEC files">Working with SPEC files</a>.
				</p><h4><a id="procedure_16"/>Procedure</h4><p>
					The following procedure describes how to build a source RPM.
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							Run the <code class="literal">rpmbuild</code> command with the specified SPEC file:
						</p><pre class="literallayout">$ rpmbuild -bs <span class="emphasis"><em>SPECFILE</em></span></pre><p class="simpara">
							Substitute <span class="emphasis"><em>SPECFILE</em></span> with the SPEC file. The <code class="literal">-bs</code> option stands for the build source.
						</p></li></ul></div><p>
					The following example shows building source RPMs for the <code class="literal">bello</code>, <code class="literal">pello</code>, and <code class="literal">cello</code> projects.
				</p><div class="title"><strong>Building source RPMs for bello, pello, and cello.</strong></div><p>
						
</p><pre class="literallayout">$ cd ~/rpmbuild/SPECS/

8$ rpmbuild -bs bello.spec
Wrote: /home/admiller/rpmbuild/SRPMS/bello-0.1-1.el8.src.rpm

$ rpmbuild -bs pello.spec
Wrote: /home/admiller/rpmbuild/SRPMS/pello-0.1.2-1.el8.src.rpm

$ rpmbuild -bs cello.spec
Wrote: /home/admiller/rpmbuild/SRPMS/cello-1.0-1.el8.src.rpm</pre><p>

					</p><p>
					The resulting source RPMs are placed to the <code class="literal">rpmbuild/SRPMS</code> directory, which is a part of the structure expected by <code class="literal">rpmbuild</code>.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="building-binary-rpms"/>Building binary RPMS</h2></div></div></div><p>
					There are two methods for building binary RPMs:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="xref" href="packaging-software_packaging-and-distributing-software.html#rebuilding-binary" title="Rebuilding a binary RPM from a source RPM">the section called “Rebuilding a binary RPM from a source RPM”</a>
						</li><li class="listitem">
							<a class="xref" href="packaging-software_packaging-and-distributing-software.html#building-binary" title="Building a binary RPM from the SPEC file">the section called “Building a binary RPM from the SPEC file”</a>
						</li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="rebuilding-binary"/>Rebuilding a binary RPM from a source RPM</h3></div></div></div><p>
						The following procedure shows how to rebuild a binary RPM from a source RPM (SRPM).
					</p><h5><a id="procedure_17"/>Procedure</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
								To rebuild <code class="literal">bello</code>, <code class="literal">pello</code>, and <code class="literal">cello</code> from their SRPMs, run:
							</p><pre class="literallayout">$ rpmbuild --rebuild ~/rpmbuild/SRPMS/bello-0.1-1.el8.src.rpm
[output truncated]

$ rpmbuild --rebuild ~/rpmbuild/SRPMS/pello-0.1.2-1.el8.src.rpm
[output truncated]

$ rpmbuild --rebuild ~/rpmbuild/SRPMS/cello-1.0-1.el8.src.rpm
[output truncated]</pre></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							Invoking <code class="literal">rpmbuild --rebuild</code> involves:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									Installing the contents of the SRPM - the SPEC file and the source code - into the <code class="literal">~/rpmbuild/</code> directory.
								</li><li class="listitem">
									Building using the installed contents.
								</li><li class="listitem">
									Removing the SPEC file and the source code.
								</li></ul></div><p>
							To retain the SPEC file and the source code after building, you can:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									When building, use the <code class="literal">rpmbuild</code> command with the <code class="literal">--recompile</code> option instead of the <code class="literal">--rebuild</code> option.
								</li><li class="listitem"><p class="simpara">
									Install the SRPMs using these commands:
								</p><pre class="literallayout">$ rpm -Uvh ~/rpmbuild/SRPMS/bello-0.1-1.el8.src.rpm
Updating / installing…​
   1:bello-0.1-1.el8               [100%]

$ rpm -Uvh ~/rpmbuild/SRPMS/pello-0.1.2-1.el8.src.rpm
Updating / installing…​
…​1:pello-0.1.2-1.el8              [100%]

$ rpm -Uvh ~/rpmbuild/SRPMS/cello-1.0-1.el8.src.rpm
Updating / installing…​
…​1:cello-1.0-1.el8            [100%]</pre></li></ul></div></div><p>
						The output generated when creating a binary RPM is verbose, which is helpful for debugging. The output varies for different examples and corresponds to their SPEC files.
					</p><p>
						The resulting binary RPMs are in the <code class="literal">~/rpmbuild/RPMS/YOURARCH</code> directory where <code class="literal">YOURARCH</code> is your architecture or in the <code class="literal">~/rpmbuild/RPMS/noarch/</code> directory, if the package is not architecture-specific.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="building-binary"/>Building a binary RPM from the SPEC file</h3></div></div></div><p>
						The following procedure shows how to build <code class="literal">bello</code>, <code class="literal">pello</code>, and <code class="literal">cello</code> binary RPMs from their SPEC files.
					</p><h5><a id="procedure_18"/>Procedure</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
								Run the <code class="literal">rpmbuild</code> command with the <code class="literal">bb</code> option:
							</p><pre class="literallayout">$ rpmbuild -bb ~/rpmbuild/SPECS/bello.spec

$ rpmbuild -bb ~/rpmbuild/SPECS/pello.spec

$ rpmbuild -bb ~/rpmbuild/SPECS/cello.spec</pre></li></ul></div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="checking-rpms-for-sanity_packaging-software"/>Checking RPMs for sanity</h1></div></div></div><p>
				After creating a package, check the quality of the package.
			</p><p>
				The main tool for checking package quality is <a class="link" href="https://github.com/rpm-software-management/rpmlint">rpmlint</a>.
			</p><p>
				The <code class="literal">rpmlint</code> tool does the following:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						Improves RPM maintainability.
					</li><li class="listitem">
						Enables sanity checking by performing static analysis of the RPM.
					</li><li class="listitem">
						Enables error checking by performing static analysis of the RPM.
					</li></ul></div><p>
				The <code class="literal">rpmlint</code> tool can check binary RPMs, source RPMs (SRPMs), and SPEC files, so it is useful for all stages of packaging, as shown in the following examples.
			</p><p>
				Note that <code class="literal">rpmlint</code> has very strict guidelines; hence it is sometimes acceptable to skip some of its errors and warnings, as shown in the following examples.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					In the following examples, <code class="literal">rpmlint</code> is run without any options, which produces a non-verbose output. For detailed explanations of each error or warning, you can run <code class="literal">rpmlint -i</code> instead.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="checking-bello-for-sanity_checking-rpms-for-sanity"/>Checking bello for sanity</h2></div></div></div><p>
					This section shows possible warnings and errors that can occur when checking RPM sanity on the example of the bello SPEC file and bello binary RPM.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="checking-bello-spec-file"/>Checking the bello SPEC File</h3></div></div></div><div class="example"><a id="idm140116092523968"/><p class="title"><strong>Example 3.2. Output of running the <code class="literal">rpmlint</code> command on the SPEC file for bello</strong></p><div class="example-contents"><pre class="literallayout">$ rpmlint bello.spec
bello.spec: W: invalid-url Source0: <a class="link" href="https://www.example.com/bello/releases/bello-0.1.tar.gz">https://www.example.com/bello/releases/bello-0.1.tar.gz</a> HTTP Error 404: Not Found
0 packages and 1 specfiles checked; 0 errors, 1 warnings.</pre></div></div><p>
						For <code class="literal">bello.spec</code>, there is only one warning, which says that the URL listed in the <code class="literal">Source0</code> directive is unreachable. This is expected, because the specified <code class="literal">example.com</code> URL does not exist. Presuming that we expect this URL to work in the future, we can ignore this warning.
					</p><div class="example"><a id="idm140115981604176"/><p class="title"><strong>Example 3.3. Output of running the <code class="literal">rpmlint</code> command on the SRPM for bello</strong></p><div class="example-contents"><pre class="literallayout">$ rpmlint ~/rpmbuild/SRPMS/bello-0.1-1.el8.src.rpm
bello.src: W: invalid-url URL: <a class="link" href="https://www.example.com/bello">https://www.example.com/bello</a> HTTP Error 404: Not Found
bello.src: W: invalid-url Source0: <a class="link" href="https://www.example.com/bello/releases/bello-0.1.tar.gz">https://www.example.com/bello/releases/bello-0.1.tar.gz</a> HTTP Error 404: Not Found
1 packages and 0 specfiles checked; 0 errors, 2 warnings.</pre></div></div><p>
						For the <code class="literal">bello</code> SRPM, there is a new warning, which says that the URL specified in the <code class="literal">URL</code> directive is unreachable. Assuming the link will be working in the future, we can ignore this warning.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="checking-bello-binary-rpm"/>Checking the bello binary RPM</h3></div></div></div><p>
						When checking binary RPMs, <code class="literal">rpmlint</code> checks for the following items:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								Documentation
							</li><li class="listitem">
								Manual pages
							</li><li class="listitem">
								Consistent use of the filesystem hierarchy standard
							</li></ul></div><div class="example"><a id="idm140116089143344"/><p class="title"><strong>Example 3.4. Output of running the <code class="literal">rpmlint</code> command on the binary RPM for bello</strong></p><div class="example-contents"><pre class="literallayout">$ rpmlint ~/rpmbuild/RPMS/noarch/bello-0.1-1.el8.noarch.rpm
bello.noarch: W: invalid-url URL: <a class="link" href="https://www.example.com/bello">https://www.example.com/bello</a> HTTP Error 404: Not Found
bello.noarch: W: no-documentation
bello.noarch: W: no-manual-page-for-binary bello
1 packages and 0 specfiles checked; 0 errors, 3 warnings.</pre></div></div><p>
						The <code class="literal">no-documentation</code> and <code class="literal">no-manual-page-for-binary</code> warnings say that he RPM has no documentation or manual pages, because we did not provide any. Apart from the above warnings, the RPM passed <code class="literal">rpmlint</code> checks.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="checking-pello-for-sanity_checking-rpms-for-sanity"/>Checking pello for sanity</h2></div></div></div><p>
					This section shows possible warnings and errors that can occur when checking RPM sanity on the example of the pello SPEC file and pello binary RPM.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="checking-pello-spec-file"/>Checking the pello SPEC File</h3></div></div></div><div class="example"><a id="idm140116088499840"/><p class="title"><strong>Example 3.5. Output of running the <code class="literal">rpmlint</code> command on the SPEC file for pello</strong></p><div class="example-contents"><pre class="literallayout">$ rpmlint pello.spec
pello.spec:30: E: hardcoded-library-path in %{buildroot}/usr/lib/%{name}
pello.spec:34: E: hardcoded-library-path in /usr/lib/%{name}/%{name}.pyc
pello.spec:39: E: hardcoded-library-path in %{buildroot}/usr/lib/%{name}/
pello.spec:43: E: hardcoded-library-path in /usr/lib/%{name}/
pello.spec:45: E: hardcoded-library-path in /usr/lib/%{name}/%{name}.py*
pello.spec: W: invalid-url Source0: <a class="link" href="https://www.example.com/pello/releases/pello-0.1.2.tar.gz">https://www.example.com/pello/releases/pello-0.1.2.tar.gz</a> HTTP Error 404: Not Found
0 packages and 1 specfiles checked; 5 errors, 1 warnings.</pre></div></div><p>
						The <code class="literal">invalid-url Source0</code> warning says that the URL listed in the <code class="literal">Source0</code> directive is unreachable. This is expected, because the specified <code class="literal">example.com</code> URL does not exist. Presuming that this URL will work in the future, you can ignore this warning.
					</p><p>
						The <code class="literal">hardcoded-library-path</code> errors suggest to use the <code class="literal">%{_libdir}</code> macro instead of hard-coding the library path. For the sake of this example, you can safely ignore these errors. However, for packages going into production make sure to check all errors carefully.
					</p><div class="example"><a id="idm140116107510336"/><p class="title"><strong>Example 3.6. Output of running the <code class="literal">rpmlint</code> command on the SRPM for pello</strong></p><div class="example-contents"><pre class="literallayout">$ rpmlint ~/rpmbuild/SRPMS/pello-0.1.2-1.el8.src.rpm
pello.src: W: invalid-url URL: <a class="link" href="https://www.example.com/pello">https://www.example.com/pello</a> HTTP Error 404: Not Found
pello.src:30: E: hardcoded-library-path in %{buildroot}/usr/lib/%{name}
pello.src:34: E: hardcoded-library-path in /usr/lib/%{name}/%{name}.pyc
pello.src:39: E: hardcoded-library-path in %{buildroot}/usr/lib/%{name}/
pello.src:43: E: hardcoded-library-path in /usr/lib/%{name}/
pello.src:45: E: hardcoded-library-path in /usr/lib/%{name}/%{name}.py*
pello.src: W: invalid-url Source0: <a class="link" href="https://www.example.com/pello/releases/pello-0.1.2.tar.gz">https://www.example.com/pello/releases/pello-0.1.2.tar.gz</a> HTTP Error 404: Not Found
1 packages and 0 specfiles checked; 5 errors, 2 warnings.</pre></div></div><p>
						The new <code class="literal">invalid-url URL</code> error here is about the <code class="literal">URL</code> directive, which is unreachable. Assuming that the URL will be valid in the future, you can safely ignore this error.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="checking-pello-binary-rpm"/>Checking the pello binary RPM</h3></div></div></div><p>
						When checking binary RPMs, <code class="literal">rpmlint</code> checks for the following items:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								Documentation
							</li><li class="listitem">
								Manual pages
							</li><li class="listitem">
								Consistent use of the Filesystem Hierarchy Standard
							</li></ul></div><div class="example"><a id="idm140116086398208"/><p class="title"><strong>Example 3.7. Output of running the <code class="literal">rpmlint</code> command on the binary RPM for pello</strong></p><div class="example-contents"><pre class="literallayout">$ rpmlint ~/rpmbuild/RPMS/noarch/pello-0.1.2-1.el8.noarch.rpm
pello.noarch: W: invalid-url URL: <a class="link" href="https://www.example.com/pello">https://www.example.com/pello</a> HTTP Error 404: Not Found
pello.noarch: W: only-non-binary-in-usr-lib
pello.noarch: W: no-documentation
pello.noarch: E: non-executable-script /usr/lib/pello/pello.py 0644L /usr/bin/env
pello.noarch: W: no-manual-page-for-binary pello
1 packages and 0 specfiles checked; 1 errors, 4 warnings.</pre></div></div><p>
						The <code class="literal">no-documentation</code> and <code class="literal">no-manual-page-for-binary</code> warnings say that the RPM has no documentation or manual pages, because you did not provide any.
					</p><p>
						The <code class="literal">only-non-binary-in-usr-lib</code> warning says that you provided only non-binary artifacts in <code class="literal">/usr/lib/</code>. This directory is normally reserved for shared object files, which are binary files. Therefore, <code class="literal">rpmlint</code> expects at least one or more files in <code class="literal">/usr/lib/</code> directory to be binary.
					</p><p>
						This is an example of an <code class="literal">rpmlint</code> check for compliance with Filesystem Hierarchy Standard. Normally, use RPM macros to ensure the correct placement of files. For the sake of this example, you can safely ignore this warning.
					</p><p>
						The <code class="literal">non-executable-script</code> error warns that the <code class="literal">/usr/lib/pello/pello.py</code> file has no execute permissions. The <code class="literal">rpmlint</code> tool expects the file to be executable, because the file contains the shebang. For the purpose of this example, you can leave this file without execute permissions and ignore this error.
					</p><p>
						Apart from the above warnings and errors, the RPM passed <code class="literal">rpmlint</code> checks.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="checking-cello-for-sanity_checking-rpms-for-sanity"/>Checking cello for sanity</h2></div></div></div><p>
					This section shows possible warnings and errors that can occur when checking RPM sanity on the example of the cello SPEC file and pello binary RPM.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="checking-cello-spec-file"/>Checking the cello SPEC File</h3></div></div></div><div class="example"><a id="idm140116098152592"/><p class="title"><strong>Example 3.8. Output of running the <code class="literal">rpmlint</code> command on the SPEC file for cello</strong></p><div class="example-contents"><pre class="literallayout">$ rpmlint ~/rpmbuild/SPECS/cello.spec
/home/admiller/rpmbuild/SPECS/cello.spec: W: invalid-url Source0: <a class="link" href="https://www.example.com/cello/releases/cello-1.0.tar.gz">https://www.example.com/cello/releases/cello-1.0.tar.gz</a> HTTP Error 404: Not Found
0 packages and 1 specfiles checked; 0 errors, 1 warnings.</pre></div></div><p>
						For <code class="literal">cello.spec</code>, there is only one warning, which says that the URL listed in the <code class="literal">Source0</code> directive is unreachable. This is expected, because the specified <code class="literal">example.com</code> URL does not exist. Presuming that this URL will work in the future, you can ignore this warning.
					</p><div class="example"><a id="idm140116018190208"/><p class="title"><strong>Example 3.9. Output of running the <code class="literal">rpmlint</code> command on the SRPM for cello</strong></p><div class="example-contents"><pre class="literallayout">$ rpmlint ~/rpmbuild/SRPMS/cello-1.0-1.el8.src.rpm
cello.src: W: invalid-url URL: <a class="link" href="https://www.example.com/cello">https://www.example.com/cello</a> HTTP Error 404: Not Found
cello.src: W: invalid-url Source0: <a class="link" href="https://www.example.com/cello/releases/cello-1.0.tar.gz">https://www.example.com/cello/releases/cello-1.0.tar.gz</a> HTTP Error 404: Not Found
1 packages and 0 specfiles checked; 0 errors, 2 warnings.</pre></div></div><p>
						For the <code class="literal">cello</code> SRPM, there is a new warning, which says that the URL specified in the <code class="literal">URL</code> directive is unreachable. Assuming the link will be working in the future, you can ignore this warning.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="checking-cello-binary-rpm"/>Checking the cello binary RPM</h3></div></div></div><p>
						When checking binary RPMs, <code class="literal">rpmlint</code> checks for the following items:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								Documentation
							</li><li class="listitem">
								Manual pages
							</li><li class="listitem">
								Consistent use of the filesystem hierarchy standard
							</li></ul></div><div class="example"><a id="idm140116099915776"/><p class="title"><strong>Example 3.10. Output of running the <code class="literal">rpmlint</code> command on the binary RPM for cello</strong></p><div class="example-contents"><pre class="literallayout">$ rpmlint ~/rpmbuild/RPMS/x86_64/cello-1.0-1.el8.x86_64.rpm
cello.x86_64: W: invalid-url URL: <a class="link" href="https://www.example.com/cello">https://www.example.com/cello</a> HTTP Error 404: Not Found
cello.x86_64: W: no-documentation
cello.x86_64: W: no-manual-page-for-binary cello
1 packages and 0 specfiles checked; 0 errors, 3 warnings.</pre></div></div><p>
						The <code class="literal">no-documentation</code> and <code class="literal">no-manual-page-for-binary</code> warnings say that he RPM has no documentation or manual pages, because you did not provide any. Apart from the above warnings, the RPM passed <code class="literal">rpmlint</code> checks.
					</p></div></div></div></div></body></html>