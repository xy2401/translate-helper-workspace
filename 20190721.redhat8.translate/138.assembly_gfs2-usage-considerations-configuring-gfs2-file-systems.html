<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. GFS2使用建议</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. GFS2使用建议</h1></div></div></div><p>本节提供有关GFS2使用的一般建议。
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="con_atime-mount-options-gfs2-usage-considerations"></a>装载选项：noatime和nodiratime</h1></div></div></div><p>通常建议使用<code class="literal">noatime</code>和<code class="literal">nodiratime</code>参数挂载GFS2文件系统。这使得GFS2可以花更少的时间为每次访问更新磁盘inode。有关这些参数对GFS2文件系统性能影响的更多信息，请参阅<a class="link" href="assembly_gfs2-performance-creating-mounting-gfs2.html#proc_gfs2-node-locking-gfs2-performance" title="GFS2节点锁定">GFS2节点锁定</a> 。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="proc_configuring-atime-gfs2-usage-considerations"></a>配置<code class="literal">atime</code>更新</h1></div></div></div><p>每个文件inode和目录inode都有三个与之关联的时间戳：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<code class="literal">ctime</code> - 上次更改inode状态的时间</li><li class="listitem">
						<code class="literal">mtime</code> - 上次修改文件（或目录）数据的时间</li><li class="listitem">
						<code class="literal">atime</code> - 上次访问文件（或目录）数据的时间</li></ul></div><p>如果在GFS2和其他Linux文件系统上默认启用了<code class="literal">atime</code>更新，那么每次读取文件时，都需要更新其inode。
			</p><p>由于很少有应用程序使用<code class="literal">atime</code>提供的信息，因此这些更新可能需要大量不必要的写入流量和文件锁定流量。这种流量会降低性能;因此，最好关闭或减少<code class="literal">atime</code>更新的频率。
			</p><p>有两种减少<code class="literal">atime</code>更新效果的方法：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">使用<code class="literal">relatime</code> （相对atime）挂载，如果先前的<code class="literal">atime</code>更新早于<code class="literal">atime</code>或<code class="literal">mtime</code>更新，则更新<code class="literal">ctime</code> 。
					</li><li class="listitem">使用<code class="literal">noatime</code> ，禁用该文件系统上的<code class="literal">atime</code>更新。
					</li></ul></div><h3><a id="mount_with_literal_role_command_relatime_literal"></a>山与<code class="literal">relatime</code></h3><p>可以在装入文件系统时指定<code class="literal">relatime</code> （相对atime）Linux装入选项。这指定<code class="literal">atime</code>如果先前被更新<code class="literal">atime</code>更新比旧<code class="literal">mtime</code>或<code class="literal">ctime</code>更新。用法</p><pre class="literallayout">mount  <span class="emphasis"><em>BlockDevice</em></span> <span class="emphasis"><em>MountPoint</em></span> -o relatime</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">BlockDevice</code></span></dt><dd>指定GFS2文件系统所在的块设备。
						</dd><dt><span class="term"><code class="literal">MountPoint</code></span></dt><dd>指定应装入GFS2文件系统的目录。
						</dd></dl></div><p>示例在此示例中，GFS2文件系统驻留在<code class="literal">/dev/vg01/lvol0</code> ，并挂载在目录<code class="literal">/mygfs2</code> 。该<code class="literal">atime</code>只有以前的更新发生<code class="literal">atime</code>更新比旧<code class="literal">mtime</code>或<code class="literal">ctime</code>更新。
			</p><pre class="literallayout"># <code class="literal">mount /dev/vg01/lvol0 /mygfs2 -o relatime</code></pre><h3><a id="mount_with_literal_role_command_noatime_literal"></a>装有<code class="literal">noatime</code></h3><p>可以在装入文件系统时指定<code class="literal">noatime</code> Linux mount选项，该选项会禁用该文件系统上的<code class="literal">atime</code>更新。用法</p><pre class="literallayout">mount <span class="emphasis"><em>BlockDevice</em></span> <span class="emphasis"><em>MountPoint</em></span> -o noatime</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">BlockDevice</code></span></dt><dd>指定GFS2文件系统所在的块设备。
						</dd><dt><span class="term"><code class="literal">MountPoint</code></span></dt><dd>指定应装入GFS2文件系统的目录。
						</dd></dl></div><p>示例在此示例中，GFS2文件系统驻留在<code class="literal">/dev/vg01/lvol0</code> ，并挂载在目录<code class="literal">/mygfs2</code>并关闭了<code class="literal">atime</code> updates。
			</p><pre class="literallayout"># <code class="literal">mount /dev/vg01/lvol0 /mygfs2 -o noatime</code></pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="con_vfs-tuning-options-gfs2-usage-considerations"></a> VFS调整选项：研究和实验</h1></div></div></div><p>与所有Linux文件系统一样，GFS2位于名为虚拟文件系统（VFS）的层之上。您可以使用<code class="literal">sysctl</code> （8）命令调整VFS层以提高基础GFS2性能。例如， <code class="literal">dirty_background_ratio</code>和<code class="literal">vfs_cache_pressure</code>的值可能会根据您的具体情况进行调整。要获取当前值，请使用以下命令：</p><pre class="literallayout"># <code class="literal">sysctl -n vm.dirty_background_ratio</code>
# <code class="literal">sysctl -n vm.vfs_cache_pressure</code></pre><p>以下命令调整值：</p><pre class="literallayout"># <code class="literal">sysctl -w vm.dirty_background_ratio=20</code>
# <code class="literal">sysctl -w vm.vfs_cache_pressure=500</code></pre><p>您可以通过编辑<code class="literal">/etc/sysctl.conf</code>文件永久更改这些参数的值。
			</p><p>要为您的用例找到最佳值，请在部署到完整生产之前研究各种VFS选项并在测试集群上进行实验。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="con_selinux-on-gfs2-gfs2-usage-considerations"></a> SELinux在GFS2上</h1></div></div></div><p>使用安全增强型Linux（SELinux）和GFS2会导致性能损失很小。为了避免这种开销，即使在具有SELinux强制模式的系统上，您也可以选择不将SELinux与GFS2一起使用。安装GFS2文件系统时，可以确保SELinux不会尝试使用<code class="literal">seclabel</code> （8）手册页中所述的某个<code class="literal">context</code>选项来读取每个文件系统对象上的<code class="literal">mount</code>元素。 SELinux将假定文件系统中的所有内容都标有<code class="literal">seclabel</code>安装选项中提供的<code class="literal">context</code>元素。这也将加快处理速度，因为它避免了可能包含<code class="literal">seclabel</code>元素的扩展属性块的另一个磁盘读取。
			</p><p>例如，在SELinux处于强制执行模式的系统上，如果文件系统要包含Apache内容，则可以使用以下<code class="literal">mount</code>命令装入GFS2文件系统。此标签将适用于整个文件系统;它保留在内存中，不会写入磁盘。
			</p><pre class="literallayout"># <code class="literal">mount -t gfs2 -o context=system_u:object_r:httpd_sys_content_t:s0 /dev/mapper/xyz/mnt/gfs2</code></pre><p>如果您不确定文件系统是否包含Apache内容，则可以使用标签<code class="literal">public_content_rw_t</code>或<code class="literal">public_content_t</code> ，或者您可以完全定义新标签并围绕它定义策略。
			</p><p>请注意，在Pacemaker集群中，您应始终使用Pacemaker来管理GFS2文件系统。您可以在创建GFS2文件系统资源时指定装入选项。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="con_nfs-over-gfs2-gfs2-usage-considerations"></a>通过GFS2设置NFS</h1></div></div></div><p>由于GFS2锁定子系统的复杂性及其集群特性，在GFS2上设置NFS需要采取许多预防措施和仔细配置。本节介绍在GFS2文件系统上配置NFS服务时应注意的注意事项。
			</p><div class="warning" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">警告</h3><p>如果GFS2文件系统是NFS导出的，并且NFS客户端应用程序使用POSIX锁，则必须使用<code class="literal">localflocks</code>选项挂载文件系统。这样做的结果是强制每个服务器的POSIX锁和flocks都是本地的：非集群的，彼此独立。这是必要的，因为如果GFS2尝试跨群集节点从NFS实现POSIX锁，则存在许多问题。对于在NFS客户端上运行的应用程序，本地化POSIX锁意味着如果两个客户端从不同服务器挂载，则两个客户端可以同时持有相同的锁。因此，在GFS2上使用NFS时，最安全的方法是指定<code class="literal">-o localflocks</code>挂载选项，以便NFS可以在挂载NFS的所有客户端之间协调POSIX锁和flocks。</p><p>对于所有其他（非NFS）GFS2应用程序，请不要使用<code class="literal">localflocks</code>挂载文件系统，以便GFS2将管理群集中所有节点之间的POSIX锁定和群集（在群集范围内）。如果指定<code class="literal">localflocks</code>并且不使用NFS，则群集中的其他节点将不知道彼此的POSIX锁定和群集，从而使它们在群集环境中不安全</p></div><p>除了锁定注意事项之外，在通过GFS2文件系统配置NFS服务时还应考虑以下因素。
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">Red Hat仅支持使用NFSv3的Red Hat高可用性附加组件配置，并具有主动/被动配置锁定，具有以下特征：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">后端文件系统是在2到16个节点群集上运行的GFS2文件系统。
							</li><li class="listitem">NFSv3服务器定义为一次从单个群集节点导出整个GFS2文件系统的服务。
							</li><li class="listitem">NFS服务器可以从一个群集节点故障转移到另一个群集节点（主动/被动配置）。
							</li><li class="listitem"><span class="emphasis"><em>除</em></span> NFS服务器<span class="emphasis"><em>外</em></span> ，不允许访问GFS2文件系统。这包括本地GFS2文件系统访问以及通过Samba或Clustered Samba访问。
							</li><li class="listitem"><p class="simpara">系统上没有NFS配额支持。
							</p><p class="simpara">此配置为文件系统提供高可用性（HA）并减少系统停机时间，因为当NFS服务器从一个节点故障转移到另一个节点时，故障节点不会导致执行<code class="literal">fsck</code>命令的要求。
							</p></li></ul></div></li><li class="listitem">对于GFS2的NFS导出，必须使用<code class="literal">fsid=</code> NFS选项。
					</li><li class="listitem">如果群集出现问题（例如，群集变得不合理并且防护不成功），群集逻辑卷和GFS2文件系统将被冻结，并且在群集进行复存之前无法访问。在确定简单的故障转移解决方案（例如此过程中定义的故障转移解决方案）是否最适合您的系统时，应考虑这种可能性。
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="con_samba-over-gfs2-gfs2-usage-considerations"></a>通过GFS2提供的Samba（SMB或Windows）文件</h1></div></div></div><p>您可以使用带有CTDB的GFS2文件系统提供的Samba（SMB或Windows）文件，该文件允许主动/主动配置。
			</p><p>不支持从Samba外部同时访问Samba共享中的数据。目前不支持GFS2群集租约，这会降低Samba文件服务的速度。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="con_vms-for-gfs2-gfs2-usage-considerations"></a>为GFS2配置虚拟机</h1></div></div></div><p>将GFS2文件系统与虚拟机一起使用时，必须正确配置每个节点上的VM存储设置，以强制关闭缓存。例如，在<code class="literal">cache</code>域中包含<code class="literal">io</code>和<code class="literal">libvirt</code>这些设置应该允许GFS2按预期运行。
			</p><pre class="literallayout">&lt;driver name='qemu' type='raw' cache='none' io='native'/&gt;</pre><p>或者，您可以在device元素中配置<code class="literal">shareable</code>属性。这表明该设备应在域之间共享（只要管理程序和操作系统支持此设置）。如果使用了<code class="literal">shareable</code>则应该为该设备使用<code class="literal">cache='no'</code> 。
			</p></div></div></body></html>