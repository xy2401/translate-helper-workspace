<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 5. Getting started with iSCSI</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="getting-started-with-iscsi_managing-storage-devices"/>Chapter 5. Getting started with iSCSI</h1></div></div></div><p>
			Red Hat Enterprise Linux 8 uses the <code class="literal">targetcli</code> shell as a command-line interface to perform the following operations:
		</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
					Add, remove, view, and monitor iSCSI storage interconnects to utilize iSCSI hardware.
				</li><li class="listitem">
					Export local storage resources that are backed by either files, volumes, local SCSI devices, or by RAM disks to remote systems.
				</li></ul></div><p>
			The <code class="literal">targetcli</code> tool has a tree-based layout including built-in tab completion, auto-complete support, and inline documentation.
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="adding-an-iscsi-target_getting-started-with-iscsi"/>Adding an iSCSI target</h1></div></div></div><p>
				As a system administrator, you can add an iSCSI targets using the <code class="literal">targetcli</code> tool.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="installing-targetcli_adding-an-iscsi-target"/>Installing targetcli</h2></div></div></div><p>
					Install the <code class="literal">targetcli</code> tool to add, monitor, and remove iSCSI storage interconnects.
				</p><h4><a id="procedure_25"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Install <code class="literal">targetcli</code>:
						</p><pre class="screen"># yum install targetcli</pre></li><li class="listitem"><p class="simpara">
							Start the target service:
						</p><pre class="screen"># systemctl start target</pre></li><li class="listitem"><p class="simpara">
							Configure target to start at boot time:
						</p><pre class="screen"># systemctl enable target</pre></li><li class="listitem"><p class="simpara">
							Open port <code class="literal">3260</code> in the firewall and reload the firewall configuration:
						</p><pre class="screen"># firewall-cmd --permanent --add-port=3260/tcp
Success

# firewall-cmd --reload
Success</pre></li><li class="listitem"><p class="simpara">
							View the <code class="literal">targetcli</code> layout:
						</p><pre class="screen"># targetcli
/&gt; ls
o- /........................................[...]
  o- backstores.............................[...]
  | o- block.................[Storage Objects: 0]
  | o- fileio................[Storage Objects: 0]
  | o- pscsi.................[Storage Objects: 0]
  | o- ramdisk...............[Storage Objects: 0]
  o- iscsi...........................[Targets: 0]
  o- loopback........................[Targets: 0]</pre></li></ol></div><h4><a id="additional_resources_17"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">targetcli</code> man page.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-an-iscsi-target_adding-an-iscsi-target"/>Creating an iSCSI target</h2></div></div></div><p>
					Creating an iSCSI target enables the iSCSI initiator of the client to access the storage devices on the server. Both targets and initiators have unique identifying names.
				</p><h4><a id="prerequisites_13"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Installed and running <code class="literal">targetcli</code>. For more information, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#installing-targetcli_adding-an-iscsi-target" title="Installing targetcli">the section called “Installing targetcli”</a>.
						</li></ul></div><h4><a id="procedure_26"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Navigate to the iSCSI directory:
						</p><pre class="screen">/&gt; iscsi/</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								The <code class="literal">cd</code> command is used to change directories as well as to list the path to move into.
							</p></div></li><li class="listitem"><p class="simpara">
							Use one of the following options to create an iSCSI target:
						</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
									Creating an iSCSI target using a default target name:
								</p><pre class="screen">/iscsi&gt; create

Created target
iqn.2003-01.org.linux-iscsi.hostname.x8664:sn.78b473f296ff
Created TPG1</pre></li><li class="listitem"><p class="simpara">
									Creating an iSCSI target using a specific name:
								</p><pre class="screen">/iscsi&gt; create <span class="emphasis"><em>iqn.2006-04.com.example:444</em></span>

Created target iqn.2006-04.com.example:444
Created TPG1
Here <code class="literal">iqn.2006-04.com.example:444</code> is target_iqn_name</pre><p class="simpara">
									Replace <span class="emphasis"><em>iqn.2006-04.com.example:444</em></span> with the specific target name.
								</p></li></ol></div></li><li class="listitem"><p class="simpara">
							Verify the newly created target:
						</p><pre class="screen">/iscsi&gt; ls

o- iscsi.......................................[1 Target]
    o- iqn.2006-04.com.example:444................[1 TPG]
        o- tpg1...........................[enabled, auth]
           o- acls...............................[0 ACL]
            o- luns...............................[0 LUN]
           o- portals.........................[0 Portal]</pre></li></ol></div><h4><a id="additional_resources_18"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">targetcli</code> man page.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="iscsi-backstore_adding-an-iscsi-target"/>iSCSI Backstore</h2></div></div></div><p>
					An iSCSI backstore enables support for different methods of storing an exported LUN’s data on the local machine. Creating a storage object defines the resources that the backstore uses. An administrator can choose any of the following backstore devices that Linux-IO (LIO) supports:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">fileio</code> backstore: Create a <code class="literal">fileio</code> storage object if you are using regular files on the local file system as disk images. For creating a <code class="literal">fileio</code> backstore, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#creating-a-fileio-storage-object_adding-an-iscsi-target" title="Creating a fileio storage object">the section called “Creating a fileio storage object”</a>.
						</li><li class="listitem">
							<code class="literal">block</code> backstore: Create a <code class="literal">block</code> storage object if you are using any local block device and logical device. For creating a <code class="literal">block</code> backstore, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#creating-a-block-storage-object_adding-an-iscsi-target" title="Creating a block storage object">the section called “Creating a block storage object”</a>.
						</li><li class="listitem">
							<code class="literal">pscsi</code> backstore: Create a <code class="literal">pscsi</code> storage object if your storage object supports direct pass-through of SCSI commands. For creating a <code class="literal">pscsi</code> backstore, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#creating-a-pscsi-storage-object_adding-an-iscsi-target" title="Creating a pscsi storage object">the section called “Creating a pscsi storage object”</a>
						</li><li class="listitem">
							<code class="literal">ramdisk</code> backstore: Create a <code class="literal">ramdisk</code> storage object if you want to create a temporary RAM backed device. For creating a <code class="literal">ramdisk</code> backstore, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#creating-a-memory-copy-ram-disk-storage-object_adding-an-iscsi-target" title="Creating a Memory Copy RAM disk storage object">the section called “Creating a Memory Copy RAM disk storage object”</a>.
						</li></ul></div><h4><a id="additional_resources_19"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">targetcli</code> man page.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-a-fileio-storage-object_adding-an-iscsi-target"/>Creating a fileio storage object</h2></div></div></div><p>
					<code class="literal">fileio</code> storage objects can support either the <code class="literal">write_back</code> or <code class="literal">write_thru</code> operations. The <code class="literal">write_back</code> operation enables the local file system cache. This improves performance but increases the risk of data loss. It is recommended to use <code class="literal">write_back=false</code> to disable the <code class="literal">write_back</code> operation in favor of the <code class="literal">write_thru</code> operation.
				</p><h4><a id="prerequisites_14"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Installed and running <code class="literal">targetcli</code>. For more information, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#installing-targetcli_adding-an-iscsi-target" title="Installing targetcli">the section called “Installing targetcli”</a>.
						</li></ul></div><h4><a id="procedure_27"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Navigate to the backstores directory:
						</p><pre class="screen">/&gt; backstores/</pre></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">fileio</code> storage object:
						</p><pre class="screen">/&gt; backstores/fileio create <span class="emphasis"><em>file1 /tmp/disk1</em></span>.img <span class="emphasis"><em>200M</em></span> write_back=false

Created fileio file1 with size 209715200</pre></li><li class="listitem"><p class="simpara">
							Verify the created <code class="literal">fileio</code> storage object:
						</p><pre class="screen">/backstores&gt; ls</pre></li></ol></div><h4><a id="additional_resources_20"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">targetcli</code> man page.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-a-block-storage-object_adding-an-iscsi-target"/>Creating a block storage object</h2></div></div></div><p>
					The block driver allows the use of any block device that appears in the <code class="literal">/sys/block/</code> directory to be used with Linux-IO (LIO). This includes physical devices (for example, HDDs, SSDs, CDs, DVDs) and logical devices (for example, software or hardware RAID volumes, or LVM volumes).
				</p><h4><a id="prerequisites_15"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Installed and running <code class="literal">targetcli</code>. For more information, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#installing-targetcli_adding-an-iscsi-target" title="Installing targetcli">the section called “Installing targetcli”</a>.
						</li></ul></div><h4><a id="procedure_28"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Navigate to the backstores directory:
						</p><pre class="screen">/&gt; backstores/</pre></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">block</code> backstore:
						</p><pre class="screen">/&gt; backstores/block create name=<span class="emphasis"><em>block_backend</em></span> dev=/dev/<span class="emphasis"><em>sdb</em></span>

Generating a wwn serial.
Created block storage object block_backend using /dev/vdb.</pre></li><li class="listitem"><p class="simpara">
							Verify the created <code class="literal">block</code> storage object:
						</p><pre class="screen">/backstores&gt; ls</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								You can also create a block backstore on a logical volume.
							</p></div></li></ol></div><h4><a id="additional_resources_21"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">targetcli</code> man page.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-a-pscsi-storage-object_adding-an-iscsi-target"/>Creating a pscsi storage object</h2></div></div></div><p>
					You can configure, as a backstore, any storage object that supports direct pass-through of SCSI commands without SCSI emulation, and with an underlying SCSI device that appears with <code class="literal">lsscsi</code> in the <code class="literal">/proc/scsi/scsi</code> (such as a SAS hard drive) . SCSI-3 and higher is supported with this subsystem.
				</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
						<code class="literal">pscsi</code> should only be used by advanced users. Advanced SCSI commands such as for Asymmetric Logical Unit Assignment (ALUAs) or Persistent Reservations (for example, those used by VMware ESX, and vSphere) are usually not implemented in the device firmware and can cause malfunctions or crashes. When in doubt, use <code class="literal">block</code> backstore for production setups instead.
					</p></div><h4><a id="prerequisites_16"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Installed and running <code class="literal">targetcli</code>. For more information, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#installing-targetcli_adding-an-iscsi-target" title="Installing targetcli">the section called “Installing targetcli”</a>.
						</li></ul></div><h4><a id="procedure_29"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Navigate to the backstores directory:
						</p><pre class="screen">/&gt; backstores/</pre></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">pscsi</code> backstore for a physical SCSI device, a TYPE_ROM device using <code class="literal">/dev/sr0</code> in this example:
						</p><pre class="screen">/&gt; backstores/pscsi/ create name=<span class="emphasis"><em>pscsi_backend</em></span> dev=/dev/sr0

Generating a wwn serial.
Created pscsi storage object pscsi_backend using /dev/sr0</pre></li><li class="listitem"><p class="simpara">
							Verify the created <code class="literal">pscsi</code> storage object:
						</p><pre class="screen">/backstores&gt; ls</pre></li></ol></div><h4><a id="additional_resources_22"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">targetcli</code> man page.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-a-memory-copy-ram-disk-storage-object_adding-an-iscsi-target"/>Creating a Memory Copy RAM disk storage object</h2></div></div></div><p>
					Memory Copy RAM disks (<code class="literal">ramdisk</code>) provide RAM disks with full SCSI emulation and separate memory mappings using memory copy for initiators. This provides capability for multi-sessions and is particularly useful for fast and volatile mass storage for production purposes.
				</p><h4><a id="prerequisites_17"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Installed and running <code class="literal">targetcli</code>. For more information, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#installing-targetcli_adding-an-iscsi-target" title="Installing targetcli">the section called “Installing targetcli”</a>.
						</li></ul></div><h4><a id="procedure_30"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Navigate to the backstores directory:
						</p><pre class="screen">/&gt; backstores/</pre></li><li class="listitem"><p class="simpara">
							Create a 1GB RAM disk backstore:
						</p><pre class="screen">/&gt; backstores/ramdisk/ create name=<span class="emphasis"><em>rd_backend</em></span> size=<span class="emphasis"><em>1GB</em></span>

Generating a wwn serial.
Created rd_mcp ramdisk rd_backend with size 1GB.</pre></li><li class="listitem"><p class="simpara">
							Verify the created <code class="literal">ramdisk</code> storage object:
						</p><pre class="screen">/backstores&gt; ls</pre></li></ol></div><h4><a id="additional_resources_23"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">targetcli</code> man page.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-an-iscsi-portal_adding-an-iscsi-target"/>Creating an iSCSI portal</h2></div></div></div><p>
					Creating an iSCSI portal adds an IP address and a port to the target that keeps the target enabled.
				</p><h4><a id="prerequisites_18"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Installed and running <code class="literal">targetcli</code>. For more information, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#installing-targetcli_adding-an-iscsi-target" title="Installing targetcli">the section called “Installing targetcli”</a>.
						</li><li class="listitem">
							An iSCSI target associated with a Target Portal Groups (TPG). For more information, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#creating-an-iscsi-target_adding-an-iscsi-target" title="Creating an iSCSI target">the section called “Creating an iSCSI target”</a>.
						</li></ul></div><h4><a id="procedure_31"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Navigate to the TPG directory:
						</p><pre class="screen">/iscsi&gt; iqn.2006-04.example:444/tpg1/</pre></li><li class="listitem"><p class="simpara">
							Use one of the following options to create an iSCSI portal:
						</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
									Creating a default portal uses the default iSCSI port <code class="literal">3260</code> and allows the target to listen to all IP addresses on that port:
								</p><pre class="screen">/iscsi/iqn.20...mple:444/tpg1&gt; portals/ create

Using default IP port 3260
Binding to INADDR_Any (0.0.0.0)
Created network portal 0.0.0.0:3260</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
										When an iSCSI target is created, a default portal is also created. This portal is set to listen to all IP addresses with the default port number that is: <code class="literal">0.0.0.0:3260</code>.
									</p><p>
										To remove the default portal:
									</p><p>
										<code class="literal">/iscsi/iqn-name/tpg1/portals delete ip_address=0.0.0.0 ip_port=3260</code>
									</p></div></li><li class="listitem"><p class="simpara">
									Creating a portal using a specific IP address:
								</p><pre class="screen">/iscsi/iqn.20...mple:444/tpg1&gt; portals/ create <span class="emphasis"><em>192.168.122.137</em></span>

Using default IP port 3260
Created network portal 192.168.122.137:3260</pre></li></ol></div></li><li class="listitem"><p class="simpara">
							Verify the newly created portal:
						</p><pre class="screen">/iscsi/iqn.20...mple:444/tpg1&gt; ls

o- tpg.................................. [enambled, auth]
    o- acls ......................................[0 ACL]
    o- luns ......................................[0 LUN]
    o- portals ................................[1 Portal]
       o- 192.168.122.137:3260......................[OK]</pre></li></ol></div><h4><a id="additional_resources_24"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">targetcli</code> man page.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-an-iscsi-lun_adding-an-iscsi-target"/>Creating an iSCSI LUN</h2></div></div></div><p>
					Logical unit number (LUN) is a physical device that is backed by the iSCSI backstore. Each LUN has a unique number.
				</p><h4><a id="prerequisites_19"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Installed and running <code class="literal">targetcli</code>. For more information, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#installing-targetcli_adding-an-iscsi-target" title="Installing targetcli">the section called “Installing targetcli”</a>.
						</li><li class="listitem">
							An iSCSI target associated with a Target Portal Groups (TPG). For more information, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#creating-an-iscsi-target_adding-an-iscsi-target" title="Creating an iSCSI target">the section called “Creating an iSCSI target”</a>.
						</li><li class="listitem">
							Created storage objects. For more information, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#iscsi-backstore_adding-an-iscsi-target" title="iSCSI Backstore">the section called “iSCSI Backstore”</a>.
						</li></ul></div><h4><a id="procedure_32"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Create LUNs of already created storage objects:
						</p><pre class="screen">/iscsi/iqn.20...mple:444/tpg1&gt; luns/ create /backstores/ramdisk/rd_backend
Created LUN 0.

/iscsi/iqn.20...mple:444/tpg1&gt; luns/ create /backstores/block/block_backend
Created LUN 1.

/iscsi/iqn.20...mple:444/tpg1&gt; luns/ create /backstores/fileio/file1
Created LUN 2.</pre></li><li class="listitem"><p class="simpara">
							Verify the created LUNs:
						</p><pre class="screen">/iscsi/iqn.20...mple:444/tpg1&gt; ls

o- tpg.................................. [enambled, auth]
    o- acls ......................................[0 ACL]
    o- luns .....................................[3 LUNs]
    |  o- lun0.........................[ramdisk/ramdisk1]
    |  o- lun1.................[block/block1 (/dev/vdb1)]
    |  o- lun2...................[fileio/file1 (/foo.img)]
    o- portals ................................[1 Portal]
        o- 192.168.122.137:3260......................[OK]</pre><p class="simpara">
							Default LUN name starts at <code class="literal">0</code>.
						</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
								By default, LUNs are created with read-write permissions. If a new LUN is added after ACLs are created, LUN automatically maps to all available ACLs and can cause a security risk. To create a LUN with read-only permissions, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#creating-a-read-only-iscsi-lun_adding-an-iscsi-target" title="Creating a read-only iSCSI LUN">the section called “Creating a read-only iSCSI LUN”</a>.
							</p></div></li></ol></div><h4><a id="additional_resources_25"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">targetcli</code> man page.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-a-read-only-iscsi-lun_adding-an-iscsi-target"/>Creating a read-only iSCSI LUN</h2></div></div></div><p>
					By default, LUNs are created with read-write permissions. This procedure describes how to create a read-only LUN.
				</p><h4><a id="prerequisites_20"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Installed and running <code class="literal">targetcli</code>. For more information, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#installing-targetcli_adding-an-iscsi-target" title="Installing targetcli">the section called “Installing targetcli”</a>.
						</li><li class="listitem">
							An iSCSI target associated with a Target Portal Groups (TPG). For more information, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#creating-an-iscsi-target_adding-an-iscsi-target" title="Creating an iSCSI target">the section called “Creating an iSCSI target”</a>.
						</li><li class="listitem">
							Created storage objects. For more information, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#iscsi-backstore_adding-an-iscsi-target" title="iSCSI Backstore">the section called “iSCSI Backstore”</a>.
						</li></ul></div><h4><a id="procedure_33"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Set read-only permissions:
						</p><pre class="screen">/&gt; set global auto_add_mapped_luns=false

Parameter auto_add_mapped_luns is now 'false'.</pre><p class="simpara">
							This prevents the auto mapping of LUNs to existing ACLs allowing the manual mapping of LUNs.
						</p></li><li class="listitem"><p class="simpara">
							Create the LUN:
						</p><pre class="screen">/&gt; iscsi/target_iqn_name/tpg1/acls/initiator_iqn_name/ create mapped_lun=next_sequential_LUN_number tpg_lun_or_backstore=backstore write_protect=1</pre><p class="simpara">
							Example:
						</p><pre class="screen">/&gt; iscsi/iqn.2006-04.example:444/tpg1/acls/2006-04.com.example.foo:888/ create mapped_lun=1 tpg_lun_or_backstore=/backstores/block/block2 write_protect=1

Created LUN 1.
Created Mapped LUN 1.</pre></li><li class="listitem"><p class="simpara">
							Verify the created LUN:
						</p><pre class="screen">/&gt; ls

o- / ...................................................... [...]
  o- backstores ........................................... [...]
  &lt;snip&gt;
  o- iscsi ......................................... [Targets: 1]
  | o- iqn.2006-04.example:444 .................. [TPGs: 1]
  |   o- tpg1 ............................ [no-gen-acls, no-auth]
  |     o- acls ....................................... [ACLs: 2]
  |     | o- 2006-04.com.example.foo:888 .. [Mapped LUNs: 2]
  |     | | o- mapped_lun0 .............. [lun0 block/disk1 (rw)]
  |     | | o- mapped_lun1 .............. [lun1 block/disk2 (ro)]
  |     o- luns ....................................... [LUNs: 2]
  |     | o- lun0 ...................... [block/disk1 (/dev/vdb)]
  |     | o- lun1 ...................... [block/disk2 (/dev/vdc)]
  &lt;snip&gt;</pre><p class="simpara">
							The mapped_lun1 line now has (<code class="literal">ro</code>) at the end (unlike mapped_lun0’s (<code class="literal">rw</code>)) stating that it is read-only.
						</p></li></ol></div><h4><a id="additional_resources_26"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">targetcli</code> man page.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-an-iscsi-acl_adding-an-iscsi-target"/>Creating an iSCSI ACL</h2></div></div></div><p>
					In <code class="literal">targetcli</code>, Access Control Lists (ACLs) are used to define access rules and each initiator has exclusive access to a LUN. Both targets and initiators have unique identifying names. You must know the unique name of the initiator to configure ACLs. The iSCSI initiators can be found in the <code class="literal">/etc/iscsi/initiatorname.iscsi</code> file.
				</p><h4><a id="prerequisites_21"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Installed and running <code class="literal">targetcli</code>. For more information, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#installing-targetcli_adding-an-iscsi-target" title="Installing targetcli">the section called “Installing targetcli”</a>.
						</li><li class="listitem">
							An iSCSI target associated with a Target Portal Groups (TPG). For more information, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#creating-an-iscsi-target_adding-an-iscsi-target" title="Creating an iSCSI target">the section called “Creating an iSCSI target”</a>.
						</li></ul></div><h4><a id="procedure_34"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Navigate to the acls directory
						</p><pre class="screen">/iscsi/iqn.20...mple:444/tpg1&gt; acls/</pre></li><li class="listitem"><p class="simpara">
							Use one of the following options to create an ACL :
						</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
									Using the initiator name from <code class="literal">/etc/iscsi/initiatorname.iscsi</code> file on the initiator.
								</li><li class="listitem"><p class="simpara">
									Using a name that is easier to remember, see section <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#creating-an-iscsi-initiator_adding-an-iscsi-target" title="Creating an iSCSI initiator">the section called “Creating an iSCSI initiator”</a> to ensure ACL matches the initiator.
								</p><pre class="screen">/iscsi/iqn.20...444/tpg1/acls&gt; create iqn.2006-04.com.example.foo:888

Created Node ACL for iqn.2006-04.com.example.foo:888
Created mapped LUN 2.
Created mapped LUN 1.
Created mapped LUN 0.</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
										The global setting <code class="literal">auto_add_mapped_luns</code> used in the preceding example, automatically maps LUNs to any created ACL.
									</p></div><p class="simpara">
									You can set user-created ACLs within the TPG node on the target server:
								</p><pre class="screen">/iscsi/iqn.20...scsi:444/tpg1&gt; set attribute generate_node_acls=1</pre></li></ol></div></li><li class="listitem"><p class="simpara">
							Verify the created ACL:
						</p><pre class="screen">/iscsi/iqn.20...444/tpg1/acls&gt; ls

o- acls .................................................[1 ACL]
    o- iqn.2006-04.com.example.foo:888 ....[3 Mapped LUNs, auth]
        o- mapped_lun0 .............[lun0 ramdisk/ramdisk1 (rw)]
        o- mapped_lun1 .................[lun1 block/block1 (rw)]
        o- mapped_lun2 .................[lun2 fileio/file1 (rw)]</pre></li></ol></div><h4><a id="additional_resources_27"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">targetcli</code> man page.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-an-iscsi-initiator_adding-an-iscsi-target"/>Creating an iSCSI initiator</h2></div></div></div><p>
					An iSCSI initiator forms a session to connect to the iSCSI target. For more information on iSCSI target, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#creating-an-iscsi-target_adding-an-iscsi-target" title="Creating an iSCSI target">the section called “Creating an iSCSI target”</a>. By default, an iSCSI service is <code class="literal">lazily</code> started and the service starts after running the <code class="literal">iscsiadm</code> command. If root is not on an iSCSI device or there are no nodes marked with <code class="literal">node.startup = automatic</code> then the iSCSI service will not start until an <code class="literal">iscsiadm</code> command is executed that requires <code class="literal">iscsid</code> or the <code class="literal">iscsi</code> kernel modules to be started.
				</p><p>
					To force the <code class="literal">iscsid</code> daemon to run and iSCSI kernel modules to load:
				</p><pre class="screen"># systemctl start iscsid.service</pre><h4><a id="prerequisites_22"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Installed and running <code class="literal">targetcli</code> on a server machine. For more information, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#installing-targetcli_adding-an-iscsi-target" title="Installing targetcli">the section called “Installing targetcli”</a>.
						</li><li class="listitem">
							An iSCSI target associated with a Target Portal Groups (TPG) on a server machine. For more information, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#creating-an-iscsi-target_adding-an-iscsi-target" title="Creating an iSCSI target">the section called “Creating an iSCSI target”</a>.
						</li><li class="listitem">
							Created iSCSI ACL. For more information, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#creating-an-iscsi-acl_adding-an-iscsi-target" title="Creating an iSCSI ACL">the section called “Creating an iSCSI ACL”</a>.
						</li></ul></div><h4><a id="procedure_35"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Install <code class="literal">iscsi-initiator-utils</code> on client machine:
						</p><pre class="screen"># yum install iscsi-initiator-utils</pre></li><li class="listitem"><p class="simpara">
							Check the initiator name:
						</p><pre class="screen"># cat /etc/iscsi/initiatorname.iscsi

InitiatorName=2006-04.com.example.foo:888</pre></li><li class="listitem"><p class="simpara">
							If the ACL was given a custom name in <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#creating-an-iscsi-acl_adding-an-iscsi-target" title="Creating an iSCSI ACL">the section called “Creating an iSCSI ACL”</a>, modify the <code class="literal">/etc/iscsi/initiatorname.iscsi</code> file accordingly.
						</p><pre class="screen"># vi /etc/iscsi/initiatorname.iscsi</pre></li><li class="listitem"><p class="simpara">
							Discover the target and log in to the target with the displayed target IQN:
						</p><pre class="screen"># iscsiadm -m discovery -t st -p <span class="emphasis"><em>10.64.24.179</em></span>
    10.64.24.179:3260,1 iqn.2006-04.example:444

# iscsiadm -m node -T <span class="emphasis"><em>iqn.2006-04.example:444</em></span> -l
    Logging in to [iface: default, target: iqn.2006-04.example:444, portal: 10.64.24.179,3260] (multiple)
    Login to [iface: default, target: iqn.2006-04.example:444, portal: 10.64.24.179,3260] successful.</pre><p class="simpara">
							Replace <span class="emphasis"><em>10.64.24.179</em></span> with the target-ip-address.
						</p><p class="simpara">
							You can use this procedure for any number of initiators connected to the same target if their respective initiator names are added to the ACL as described in the <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#creating-an-iscsi-acl_adding-an-iscsi-target" title="Creating an iSCSI ACL">the section called “Creating an iSCSI ACL”</a>.
						</p></li><li class="listitem"><p class="simpara">
							Find the iSCSI disk name and create a file system on this iSCSI disk:
						</p><pre class="screen"># grep "Attached SCSI" /var/log/messages

# mkfs.ext4 /dev/<span class="emphasis"><em>disk_name</em></span></pre><p class="simpara">
							Replace <span class="emphasis"><em>disk_name</em></span> with the iSCSI disk name displayed in the <code class="literal">/var/log/messages</code> file.
						</p></li><li class="listitem"><p class="simpara">
							Mount the file system:
						</p><pre class="screen"># mkdir <span class="emphasis"><em>/mount/point</em></span>

# mount /dev/<span class="emphasis"><em>disk_name /mount/point</em></span></pre><p class="simpara">
							Replace <span class="emphasis"><em>/mount/point</em></span> with the mount point of the partition.
						</p></li><li class="listitem"><p class="simpara">
							Edit the <code class="literal">/etc/fstab</code> file to mount the file system automatically when the system boots:
						</p><pre class="screen"># vi /etc/fstab

/dev/<span class="emphasis"><em>disk_name /mount/point</em></span> ext4 _netdev 0 0</pre><p class="simpara">
							Replace <span class="emphasis"><em>disk_name</em></span> with the iSCSI disk name and <span class="emphasis"><em>/mount/point</em></span> with the mount point of the partition.
						</p></li></ol></div><h4><a id="additional_resources_28"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">targetcli</code> man page.
						</li><li class="listitem">
							The <code class="literal">iscsiadm</code> man page.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="setting-up-the-challenge-handshake-authentication-protocol-for-the-target_adding-an-iscsi-target"/>Setting up the Challenge-Handshake Authentication Protocol for the target</h2></div></div></div><p>
					The <code class="literal">Challenge-Handshake Authentication Protocol (CHAP)</code> allows the user to protect the target with a password. The initiator must be aware of this password to be able to connect to the target.
				</p><h4><a id="prerequisites_23"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Created iSCSI ACL. For more information, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#creating-an-iscsi-acl_adding-an-iscsi-target" title="Creating an iSCSI ACL">the section called “Creating an iSCSI ACL”</a>.
						</li></ul></div><h4><a id="procedure_36"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Set attribute authentication:
						</p><pre class="screen">/iscsi/iqn.20...mple:444/tpg1&gt; set attribute authentication=1

Parameter authentication is now '1'.</pre></li><li class="listitem"><p class="simpara">
							Set <code class="literal">userid</code> and <code class="literal">password</code>:
						</p><pre class="screen">/tpg1&gt; set auth userid=<span class="emphasis"><em>redhat</em></span>
Parameter userid is now '<span class="emphasis"><em>redhat</em></span>'.

/iscsi/iqn.20...689dcbb3/tpg1&gt; set auth password=<span class="emphasis"><em>redhat_passwd</em></span>
Parameter password is now '<span class="emphasis"><em>redhat_passwd</em></span>'.</pre></li></ol></div><h4><a id="additional_resources_29"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">targetcli</code> man page.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="setting-up-the-challenge-handshake-authentication-protocol-for-the-initiator_adding-an-iscsi-target"/>Setting up the Challenge-Handshake Authentication Protocol for the initiator</h2></div></div></div><p>
					The <code class="literal">Challenge-Handshake Authentication Protocol (CHAP)</code> allows the user to protect the target with a password. The initiator must be aware of this password to be able to connect to the target.
				</p><h4><a id="prerequisites_24"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Created iSCSI initiator. For more information, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#creating-an-iscsi-initiator_adding-an-iscsi-target" title="Creating an iSCSI initiator">the section called “Creating an iSCSI initiator”</a>.
						</li><li class="listitem">
							Set the <code class="literal">CHAP</code> for the target. For more information, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#setting-up-the-challenge-handshake-authentication-protocol-for-the-target_adding-an-iscsi-target" title="Setting up the Challenge-Handshake Authentication Protocol for the target">the section called “Setting up the Challenge-Handshake Authentication Protocol for the target”</a>.
						</li></ul></div><h4><a id="procedure_37"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Enable CHAP authentication in the <code class="literal">iscsid.conf</code> file:
						</p><pre class="screen"># vi /etc/iscsi/iscsid.conf

node.session.auth.authmethod = CHAP</pre><p class="simpara">
							By default, the <code class="literal">node.session.auth.authmethod</code> is set to <code class="literal">None</code>
						</p></li><li class="listitem"><p class="simpara">
							Add target <code class="literal">username</code> and <code class="literal">password</code> in the <code class="literal">iscsid.conf</code> file:
						</p><pre class="screen">node.session.auth.username = <span class="emphasis"><em>redhat</em></span>
node.session.auth.password = <span class="emphasis"><em>redhat_passwd</em></span></pre></li><li class="listitem"><p class="simpara">
							Start the <code class="literal">iscsid</code> daemon:
						</p><pre class="screen"># systemctl start iscsid.service</pre></li></ol></div><h4><a id="additional_resources_30"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">iscsiadm</code> man page
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="monitoring-an-iscsi-session_getting-started-with-iscsi"/>Monitoring an iSCSI session</h1></div></div></div><p>
				As a system administrator, you can monitor the iSCSI session using the <code class="literal">iscsiadm</code> utility.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="monitoring-an-iscsi-session-using-the-iscsiadm-utility_monitoring-an-iscsi-session"/>Monitoring an iSCSI session using the iscsiadm utility</h2></div></div></div><p>
					This procedure describes how to monitor the iscsi session using the <code class="literal">iscsiadm</code> utility.
				</p><p>
					By default, an iSCSI service is <code class="literal">lazily</code> started and the service starts after running the <code class="literal">iscsiadm</code> command. If root is not on an iSCSI device or there are no nodes marked with <code class="literal">node.startup = automatic</code> then the iSCSI service will not start until an <code class="literal">iscsiadm</code> command is executed that requires <code class="literal">iscsid</code> or the <code class="literal">iscsi</code> kernel modules to be started.
				</p><p>
					To force the <code class="literal">iscsid</code> daemon to run and iSCSI kernel modules to load:
				</p><pre class="screen"># systemctl start iscsid.service</pre><h4><a id="prerequisites_25"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							Installed iscsi-initiator-utils on client machine:
						</p><pre class="screen">yum install iscsi-initiator-utils</pre></li></ul></div><h4><a id="procedure_38"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Find information about the running sessions:
						</p><pre class="screen"># iscsiadm -m session -P 3</pre><p class="simpara">
							This command displays the session or device state, session ID (sid), some negotiated parameters, and the SCSI devices accessible through the session.
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
									For shorter output, for example, to display only the <code class="literal">sid-to-node</code> mapping, run:
								</p><pre class="screen"># iscsiadm -m session -P 0
        or
# iscsiadm -m session

tcp [2] 10.15.84.19:3260,2 iqn.1992-08.com.netapp:sn.33615311
tcp [3] 10.15.85.19:3260,3 iqn.1992-08.com.netapp:sn.33615311</pre><p class="simpara">
									These commands print the list of running sessions in the following format: <code class="literal">driver [sid] target_ip:port,target_portal_group_tag proper_target_name</code>.
								</p></li></ul></div></li></ol></div><h4><a id="additional_resources_31"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">/usr/share/doc/iscsi-initiator-utils-version/README</code> file.
						</li><li class="listitem">
							The <code class="literal">iscsiadm</code> man page.
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="removing-an-iscsi-target_getting-started-with-iscsi"/>Removing an iSCSI target</h1></div></div></div><p>
				As a system administrator, you can remove the iSCSI target.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="removing-an-iscsi-object-using-targetcli-tool_removing-an-iscsi-target"/>Removing an iSCSI object using targetcli tool</h2></div></div></div><p>
					This procedure describes how to remove the iSCSI objects using the <code class="literal">targetcli</code> tool.
				</p><h4><a id="procedure_39"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Log off from the target:
						</p><pre class="screen"># iscsiadm -m node -T <span class="emphasis"><em>iqn.2006-04.example:444</em></span> -u</pre><p class="simpara">
							For more information on how to log in to the target, see <a class="xref" href="getting-started-with-iscsi_managing-storage-devices.html#creating-an-iscsi-initiator_adding-an-iscsi-target" title="Creating an iSCSI initiator">the section called “Creating an iSCSI initiator”</a>.
						</p></li><li class="listitem"><p class="simpara">
							Remove the entire target, including all ACLs, LUNs, and portals:
						</p><pre class="screen">/&gt; iscsi/ delete <span class="emphasis"><em>iqn.2006-04.com.example:444</em></span></pre><p class="simpara">
							Replace <span class="emphasis"><em>iqn.2006-04.com.example:444</em></span> with the target_iqn_name.
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
									To remove an iSCSI backstore:
								</p><pre class="screen">/&gt; backstores/<span class="emphasis"><em>backstore-type</em></span>/ delete <span class="emphasis"><em>block_backend</em></span></pre><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
											Replace <span class="emphasis"><em>backstore-type</em></span> with either <code class="literal">fileio</code>, <code class="literal">block</code>, <code class="literal">pscsi</code>, or <code class="literal">ramdisk</code>.
										</li><li class="listitem">
											Replace <span class="emphasis"><em>block_backend</em></span> with the <span class="emphasis"><em>backstore-name</em></span> you want to delete.
										</li></ul></div></li><li class="listitem"><p class="simpara">
									To remove parts of an iSCSI target, such as an ACL:
								</p><pre class="screen">/&gt; /iscsi/iqn-name/tpg/acls/ delete <span class="emphasis"><em>iqn.2006-04.com.example:444</em></span></pre></li></ul></div></li><li class="listitem"><p class="simpara">
							View the changes:
						</p><pre class="screen">/&gt; iscsi/ ls</pre></li></ol></div><h4><a id="additional_resources_32"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">targetcli</code> man page.
						</li></ul></div></div></div></div></body></html>