<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 重命名Identity Management客户端系统</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 重命名Identity Management客户端系统</h1></div></div></div><p>以下部分介绍如何更改Identity Management客户端系统的主机名。
			</p><div class="warning" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">警告</h3><p>重命名客户端是一个手动过程。除非绝对需要更改主机名，否则不要执行它。
				</p></div><p>重命名Identity Management客户端涉及：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">准备主机。有关详细信息，请参阅<a class="xref" href="renaming-ipa-client-systems_installing-identity-management.html#prerequisites_renaming-clients" title="先决条件">“先决条件”一节</a>
					</li><li class="listitem">从主机卸载IdM客户端。有关详细信息，请参阅<a class="xref" href="renaming-ipa-client-systems_installing-identity-management.html#uninstalling-an-ipa-client-procedure_renaming-clients" title="卸载Identity Management客户端">“卸载Identity Management客户端”一节</a>
					</li><li class="listitem">重命名主机。有关详细信息，请参阅<a class="xref" href="renaming-ipa-client-systems_installing-identity-management.html#renaming-the-ipa-client-system_renaming-clients" title="重命名主机系统">“重命名主机系统”一节</a>
					</li><li class="listitem">使用新名称在主机上安装IdM客户端。有关详细信息，请参阅<a class="xref" href="renaming-ipa-client-systems_installing-identity-management.html#reinstalling-client" title="重新安装Identity Management客户端">“重新安装Identity Management客户端”一节</a>
					</li><li class="listitem">安装IdM客户端后配置主机。有关详细信息，请参阅<a class="xref" href="renaming-ipa-client-systems_installing-identity-management.html#re-adding-services-re-generating-certificates-and-re-adding-host-groups_renaming-clients" title="重新添加服务，重新生成证书以及重新添加主机组">“重新添加服务，重新生成证书和重新添加主机组”一节。</a>
					</li></ol></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="prerequisites_renaming-clients"></a>先决条件</h1></div></div></div><p>在卸载当前客户端之前，请记下客户端的某些设置。在使用新主机名重新注册计算机后，您将应用此配置。
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">确定计算机上正在运行的服务：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">使用<code class="literal">ipa service-find</code>命令，并在输出中标识带有证书的服务：</p><pre class="literallayout">$ <span class="strong"><strong>ipa service-find <span class="emphasis"><em>old-client-name.example.com</em></span></strong></span></pre></li><li class="listitem">此外，每个主机都有一个默认<span class="emphasis"><em>主机服务</em></span> ，该<span class="emphasis"><em>服务</em></span>不会出现在<code class="literal">ipa service-find</code>输出中。主机服务的服务主体（也称为<span class="emphasis"><em>主机主体</em></span> ）是<code class="literal">host/<span class="emphasis"><em>old-client-name.example.com</em></span></code> 。
								</li></ul></div></li><li class="listitem"><p class="simpara">对于<code class="literal">ipa service-find <span class="emphasis"><em>old-client-name.example.com</em></span></code>显示的所有服务主体，请确定<code class="literal"><span class="emphasis"><em>old-client-name.example.com</em></span></code>系统上相应keytabs的位置：</p><pre class="literallayout"># <span class="strong"><strong>find / -name "*.keytab"</strong></span></pre><p class="simpara">客户端系统上的每个服务都有一个Kerberos主体，格式为<span class="emphasis"><em>service_name / host_name @ REALM</em></span> ，例如<code class="literal">ldap/<span class="emphasis"><em>old-client-name.example.com@EXAMPLE.COM</em></span></code> 。</p></li><li class="listitem"><p class="simpara">标识计算机所属的所有主机组。
						</p><pre class="literallayout"># <span class="strong"><strong>ipa hostgroup-find <span class="emphasis"><em>old-client-name.example.com</em></span></strong></span></pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="uninstalling-an-ipa-client-procedure_renaming-clients"></a>卸载Identity Management客户端</h1></div></div></div><p>卸载客户端会从Identity Management域中删除客户端，以及系统服务的所有特定Identity Management配置，例如系统安全服务守护程序（SSSD）。这将恢复客户端系统的先前配置。
				</p><h3><a id="procedure_17"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">运行<code class="literal">ipa-client-install --uninstall</code>命令：</p><pre class="literallayout"># <span class="strong"><strong>ipa-client-install --uninstall</strong></span></pre></li><li class="listitem"><p class="simpara">从服务器手动删除客户端主机的DNS条目：</p><pre class="literallayout"># <span class="strong"><strong>ipa dnsrecord-del</strong></span>
Record name: old-client-name
Zone name: idm.example.com
No option to delete specific record provided.
Delete all? Yes/No (default No): yes
------------------------
Deleted record "old-client-name"</pre></li></ol></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">对于<code class="literal">/etc/krb5.keytab</code>以外的每个已识别的密钥表，删除旧的主体：</p><pre class="literallayout">[root@client ~]# ipa-rmkeytab -k <span class="emphasis"><em>/path/to/keytab</em></span> -r EXAMPLE.COM</pre><p class="simpara">请参阅TBD &lt;removed-keytabs &gt;&gt;。
						</p></li><li class="listitem"><p class="simpara">在IdM服务器上，删除主机条目。这将删除所有服务并撤消为该主机颁发的所有证书：</p><pre class="literallayout">[root@server ~]# ipa host-del client.example.com</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="renaming-the-ipa-client-system_renaming-clients"></a>重命名主机系统</h1></div></div></div><p>根据需要重命名机器。例如：</p><pre class="literallayout"># <span class="strong"><strong>hostnamectl set-hostname <span class="emphasis"><em>new-client-name.example.com</em></span></strong></span></pre><p>您现在可以使用新主机名将Identity Management客户端重新安装到Identity Management域。
				</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="reinstalling-client"></a>重新安装Identity Management客户端</h1></div></div></div><p>按照<a class="xref" href="installing-an-ipa-client-basic-scenario_installing-identity-management.html" title="Chapter 9. Installing an Identity Management client: Basic scenario">第9章， <em>安装Identity Management客户端：基本方案中</em></a>所述的过程在重命名的主机上<a class="xref" href="installing-an-ipa-client-basic-scenario_installing-identity-management.html" title="Chapter 9. 安装Identity Management客户端：基本方案"><em>安装客户端</em></a> 。
				</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="re-adding-services-re-generating-certificates-and-re-adding-host-groups_renaming-clients"></a>重新添加服务，重新生成证书以及重新添加主机组</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">在Identity Management服务器上，为<a class="xref" href="renaming-ipa-client-systems_installing-identity-management.html#prerequisites_renaming-clients" title="先决条件">“先决条件”部分中</a>标识的每个服务添加新的密钥表。
						</p><pre class="literallayout">[root@server ~]# ipa service-add <span class="emphasis"><em>service_name/new-client-name</em></span></pre></li><li class="listitem"><p class="simpara">为在<a class="xref" href="renaming-ipa-client-systems_installing-identity-management.html#prerequisites_renaming-clients" title="先决条件">“先决条件”部分中</a>分配了证书的服务生成证书。你可以这样做：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">使用Identity Management管理工具</li><li class="listitem">使用<code class="literal">certmonger</code>实用程序</li></ul></div></li><li class="listitem">将客户端重新添加到<a class="xref" href="renaming-ipa-client-systems_installing-identity-management.html#prerequisites_renaming-clients" title="先决条件">“先决条件”一节中</a>标识的主机组。
						</li></ol></div></div></div></body></html>