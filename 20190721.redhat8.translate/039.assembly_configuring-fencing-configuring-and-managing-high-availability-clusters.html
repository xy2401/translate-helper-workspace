<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 在Red Hat High Availability集群中配置防护</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 在Red Hat High Availability集群中配置防护</h1></div></div></div><p>无响应的节点可能仍在访问数据。确保数据安全的唯一方法是使用STONITH对节点进行限制。 STONITH是“在头部拍摄其他节点”的首字母缩写，它可以保护您的数据免受恶意节点或并发访问的破坏。使用STONITH，您可以确定节点在允许从另一个节点访问数据之前是真正脱机的。
		</p><p>如果无法停止集群服务，STONITH还可以发挥作用。在这种情况下，群集使用STONITH强制整个节点脱机，从而可以安全地在其他地方启动服务。
		</p><p>有关防护及其在Red Hat高可用性群集中的重要性的更完整的一般信息，请参阅Red Hat高可用性群集中的<a class="link" href="https://access.redhat.com/solutions/15575">防护</a> 。
		</p><p>通过为群集节点配置fence设备，可以在Pacemaker群集中实现STONITH。
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="proc_displaying-fence-agents-configuring-fencing"></a>显示可用的fence代理及其选项</h1></div></div></div><p>使用以下命令查看所有可用STONITH代理的列表。指定过滤器时，此命令仅显示与过滤器匹配的STONITH代理。
			</p><pre class="literallayout">pcs stonith list [<span class="emphasis"><em>filter</em></span>]</pre><p>使用以下命令查看指定STONITH代理的选项。
			</p><pre class="literallayout">pcs stonith describe <span class="emphasis"><em>stonith_agent</em></span></pre><p>例如，以下命令显示通过telnet / SSH进行APC的fence代理的选项。</p><pre class="literallayout"># <code class="literal">pcs stonith describe fence_apc</code>
Stonith options for: fence_apc
  ipaddr (required): IP Address or Hostname
  login (required): Login Name
  passwd: Login password or passphrase
  passwd_script: Script to retrieve password
  cmd_prompt: Force command prompt
  secure: SSH connection
  port (required): Physical plug number or name of virtual machine
  identity_file: Identity file for ssh
  switch: Physical switch number on device
  inet4_only: Forces agent to use IPv4 addresses only
  inet6_only: Forces agent to use IPv6 addresses only
  ipport: TCP port to use for connection with device
  action (required): Fencing Action
  verbose: Verbose mode
  debug: Write debug information to given file
  version: Display version information and exit
  help: Display help and exit
  separator: Separator for CSV created by operation list
  power_timeout: Test X seconds for status change after ON/OFF
  shell_timeout: Wait X seconds for cmd prompt after issuing command
  login_timeout: Wait X seconds for cmd prompt after login
  power_wait: Wait X seconds after issuing ON/OFF
  delay: Wait X seconds before fencing is started
  retry_on: Count of attempts to retry power on</pre><div class="warning" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">警告</h3><p>对于提供<code class="literal">method</code>选项的fence代理程序，不支持并且不应指定<code class="literal">cycle</code>的值，因为它可能导致数据损坏。
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="proc_creating-fence-devices-configuring-fencing"></a>创建一个fence设备</h1></div></div></div><p>以下命令创建一个stonith设备。有关其他可用选项，请参阅<code class="literal">pcs stonith -h</code>显示。
			</p><pre class="literallayout">pcs stonith create <span class="emphasis"><em>stonith_id</em></span> <span class="emphasis"><em>stonith_device_type</em></span> [<span class="emphasis"><em>stonith_device_options</em></span>] [op  <span class="emphasis"><em>operation_action</em></span> <span class="emphasis"><em>operation_options</em></span>]</pre><pre class="literallayout"># <code class="literal">pcs stonith create MyStonith fence_virt pcmk_host_list=f1 op monitor interval=30s</code></pre><p>如果对多个节点使用单个fence设备，则为每个节点使用不同的端口，则无需为每个节点单独创建设备。例如，以下命令创建一个名为<code class="literal">myapc-west-13</code>的单个防护设备，该设备使用名为<code class="literal">west-apc</code>的APC电源开关，并使用端口15作为节点<code class="literal">west-13</code> 。
			</p><pre class="literallayout"># <code class="literal">pcs stonith create myapc-west-13 fence_apc pcmk_host_list="west-13" ipaddr="west-apc" login="apc" passwd="apc" port="15"</code></pre><p>但是，下面的示例使用名为<code class="literal">west-apc</code>的APC电源开关，使用端口15对<code class="literal">west-13</code>进行栅栏节点，使用端口17对<code class="literal">west-14</code>进行栅极，使用端口18对<code class="literal">west-15</code>进行<code class="literal">west-apc</code>节点，使用端口19使用<code class="literal">west-16</code> 。
			</p><pre class="literallayout"># <code class="literal">pcs stonith create myapc fence_apc pcmk_host_list="west-13,west-14,west-15,west-16" ipaddr="west-apc" login="apc" passwd="apc"</code></pre><p>配置fence设备后，必须测试设备以确保其正常工作。有关测试fence设备的信息，请参阅<a class="link" href="assembly_configuring-fencing-configuring-and-managing-high-availability-clusters.html#proc_testing-fence-devices-configuring-fencing" title="测试围栏设备">测试fence设备</a> 。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="ref_general-fence-device-properties-configuring-fencing"></a>击剑装置的一般属性</h1></div></div></div><p>无论fence资源是启动还是停止，任何群集节点都可以使用任何fence设备围住任何其他群集节点。资源是否已启动仅控制设备的定期监视器，而不是是否可以使用，但以下情况除外：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">您可以通过运行<code class="literal">pcs stonith disable <span class="emphasis"><em>stonith_id</em></span></code>命令来禁用防护设备。这将阻止任何节点使用该设备。
					</li><li class="listitem">要阻止特定节点使用防护设备，可以使用<code class="literal">pcs constraint location …​ avoids</code>命令配置防护资源的位置约束。
					</li><li class="listitem">配置<code class="literal">stonith-enabled=false</code>将完全禁用fencing。但请注意，禁用防护时Red Hat不支持群集，因为它不适合生产环境。
					</li></ul></div><p>
				<a class="xref" href="assembly_configuring-fencing-configuring-and-managing-high-availability-clusters.html#tb-fencedevice-props-HAAR" title="Table 8.1. General Properties of Fencing Devices">表8.1“</a>屏蔽设备的常规属性<a class="xref" href="assembly_configuring-fencing-configuring-and-managing-high-availability-clusters.html#tb-fencedevice-props-HAAR" title="表8.1。击剑设备的一般属性">”</a>介绍了可以为屏蔽设备设置的常规属性。
			</p><div class="table"><a id="tb-fencedevice-props-HAAR"></a><p class="title"><strong>表8.1。击剑设备的一般属性</strong></p><div class="table-contents"><table border="1" summary="General Properties of Fencing Devices"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"><col class="col_4"></colgroup><thead><tr><th valign="top" style="text-align:left">领域</th><th valign="top" style="text-align:left">类型</th><th valign="top" style="text-align:left">默认</th><th valign="top" style="text-align:left">描述</th></tr></thead><tbody><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_host_map</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>串</p>
							 </td><td valign="top" style="text-align:left"> </td><td valign="top" style="text-align:left"> <p>主机名到端口号的映射，用于不支持主机名的设备。例如： <code class="literal">node1:1;node2:2,3</code>告诉集群将端口1用于node1，将端口2和3用于node2</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_host_list</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>串</p>
							 </td><td valign="top" style="text-align:left"> </td><td valign="top" style="text-align:left"> <p>由此设备控制的计算机列表（除非<code class="literal">pcmk_host_check=static-list</code>否则<code class="literal">pcmk_host_check=static-list</code>可选）。
							</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_host_check</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>串</p>
							 </td><td valign="top" style="text-align:left"> <p>* <code class="literal">static-list</code>如果设置了<code class="literal">pcmk_host_list</code>或<code class="literal">pcmk_host_map</code></p>
							 <p>*否则，如果fence设备支持<code class="literal">list</code>操作，则为<code class="literal">dynamic-list</code></p>
							 <p>*否则， <code class="literal">status</code>如果围栏设备支持的<code class="literal">status</code>动作</p>
							 <p>*否则， <code class="literal">none</code> 。
							</p>
							 </td><td valign="top" style="text-align:left"> <p>如何确定设备控制哪台机器。允许的值： <code class="literal">dynamic-list</code> （查询设备）， <code class="literal">static-list</code> （检查<code class="literal">pcmk_host_list</code>属性），none（假设每个设备都可以<code class="literal">pcmk_host_list</code>每台机器）</p>
							 </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="ref_advanced-fence-device-properties-configuring-fencing"></a>高级防护配置选项</h1></div></div></div><p>
				<a class="xref" href="assembly_configuring-fencing-configuring-and-managing-high-availability-clusters.html#tb-fencepropsadvanced-HAAR" title="Table 8.2. Advanced Properties of Fencing Devices">表8.2“</a>屏蔽设备的<a class="xref" href="assembly_configuring-fencing-configuring-and-managing-high-availability-clusters.html#tb-fencepropsadvanced-HAAR" title="表8.2。屏蔽设备的高级属性">高级属性”</a>总结了可以为屏蔽设备设置的其他属性。请注意，这些属性仅供高级用途使用。
			</p><div class="table"><a id="tb-fencepropsadvanced-HAAR"></a><p class="title"><strong>表8.2。屏蔽设备的高级属性</strong></p><div class="table-contents"><table border="1" summary="Advanced Properties of Fencing Devices"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"><col class="col_4"></colgroup><thead><tr><th valign="top" style="text-align:left">领域</th><th valign="top" style="text-align:left">类型</th><th valign="top" style="text-align:left">默认</th><th valign="top" style="text-align:left">描述</th></tr></thead><tbody><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_host_argument</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>串</p>
							 </td><td valign="top" style="text-align:left"> <p>港口</p>
							 </td><td valign="top" style="text-align:left"> <p>提供替代端口的备用参数。某些设备不支持标准端口参数或可能提供其他设备。使用此参数指定备用的，特定于设备的参数，该参数应指示要隔离的计算机。值<code class="literal">none</code>可用于告知群集不提供任何其他参数。
							</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_reboot_action</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>串</p>
							 </td><td valign="top" style="text-align:left"> <p>重启</p>
							 </td><td valign="top" style="text-align:left"> <p>另一个运行而不是<code class="literal">reboot</code>命令。某些设备不支持标准命令或可能提供其他设备。使用此选项指定实现重新引导操作的备用设备特定命令。
							</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_reboot_timeout</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>时间</p>
							 </td><td valign="top" style="text-align:left"> <p>60年代</p>
							 </td><td valign="top" style="text-align:left"> <p>指定用于重新引导操作而不是<code class="literal">stonith-timeout</code>的备用<code class="literal">stonith-timeout</code> 。有些设备比正常情况需要更多/更少的时间来完成。使用此选项可为重新启动操作指定备用的，特定于设备的超时。
							</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_reboot_retries</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>整数</p>
							 </td><td valign="top" style="text-align:left"> <p>2</p>
							 </td><td valign="top" style="text-align:left"> <p>在超时期限内重试<code class="literal">reboot</code>命令的最大次数。某些设备不支持多个连接。如果设备忙于其他任务，操作可能会失败，因此如果剩余时间，Pacemaker将自动重试该操作。使用此选项可以更改Pacemaker在放弃之前重试重启操作的次数。
							</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_off_action</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>串</p>
							 </td><td valign="top" style="text-align:left"> <p>离</p>
							 </td><td valign="top" style="text-align:left"> <p>另一个运行而不是<code class="literal">off</code>命令。某些设备不支持标准命令或可能提供其他设备。使用此选项指定实现off操作的备用设备特定命令。
							</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_off_timeout</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>时间</p>
							 </td><td valign="top" style="text-align:left"> <p>60年代</p>
							 </td><td valign="top" style="text-align:left"> <p>指定用于关闭操作而不是<code class="literal">stonith-timeout</code>的备用<code class="literal">stonith-timeout</code> 。有些设备比普通设备需要更多或更少的时间来完成。使用此选项可为关闭操作指定备用的，特定于设备的超时。
							</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_off_retries</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>整数</p>
							 </td><td valign="top" style="text-align:left"> <p>2</p>
							 </td><td valign="top" style="text-align:left"> <p>在超时期限内重试off命令的最大次数。某些设备不支持多个连接。如果设备忙于其他任务，操作可能会失败，因此如果剩余时间，Pacemaker将自动重试该操作。使用此选项可以更改Pacemaker在放弃之前重试操作的次数。
							</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_list_action</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>串</p>
							 </td><td valign="top" style="text-align:left"> <p>名单</p>
							 </td><td valign="top" style="text-align:left"> <p>另一个运行而不是<code class="literal">list</code>命令。某些设备不支持标准命令或可能提供其他设备。使用此选项指定实现列表操作的备用设备特定命令。
							</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_list_timeout</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>时间</p>
							 </td><td valign="top" style="text-align:left"> <p>60年代</p>
							 </td><td valign="top" style="text-align:left"> <p>指定用于列表操作的备用超时。有些设备比普通设备需要更多或更少的时间来完成。使用此选项可为列表操作指定备用的，特定于设备的超时。
							</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_list_retries</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>整数</p>
							 </td><td valign="top" style="text-align:left"> <p>2</p>
							 </td><td valign="top" style="text-align:left"> <p>在超时期限内重试<code class="literal">list</code>命令的最大次数。某些设备不支持多个连接。如果设备忙于其他任务，操作可能会失败，因此如果剩余时间，Pacemaker将自动重试该操作。使用此选项可以更改Pacemaker在放弃之前重试列表操作的次数。
							</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_monitor_action</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>串</p>
							 </td><td valign="top" style="text-align:left"> <p>监控</p>
							 </td><td valign="top" style="text-align:left"> <p>另一个运行而不是<code class="literal">monitor</code>命令。某些设备不支持标准命令或可能提供其他设备。使用此选项指定实现监视器操作的备用设备特定命令。
							</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_monitor_timeout</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>时间</p>
							 </td><td valign="top" style="text-align:left"> <p>60年代</p>
							 </td><td valign="top" style="text-align:left"> <p>指定用于监视器操作而不是<code class="literal">stonith-timeout</code>的备用<code class="literal">stonith-timeout</code> 。有些设备比普通设备需要更多或更少的时间来完成。使用此选项可为监视器操作指定备用的，特定于设备的超时。
							</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_monitor_retries</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>整数</p>
							 </td><td valign="top" style="text-align:left"> <p>2</p>
							 </td><td valign="top" style="text-align:left"> <p>在超时期限内重试<code class="literal">monitor</code>命令的最大次数。某些设备不支持多个连接。如果设备忙于其他任务，操作可能会失败，因此如果剩余时间，Pacemaker将自动重试该操作。使用此选项可更改Pacemaker在放弃之前重试监视操作的次数。
							</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_status_action</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>串</p>
							 </td><td valign="top" style="text-align:left"> <p>状态</p>
							 </td><td valign="top" style="text-align:left"> <p>另一个运行而不是<code class="literal">status</code>命令。某些设备不支持标准命令或可能提供其他设备。使用此选项可指定实现状态操作的备用设备特定命令。
							</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_status_timeout</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>时间</p>
							 </td><td valign="top" style="text-align:left"> <p>60年代</p>
							 </td><td valign="top" style="text-align:left"> <p>指定用于状态操作而不是<code class="literal">stonith-timeout</code>的备用<code class="literal">stonith-timeout</code> 。有些设备比普通设备需要更多或更少的时间来完成。使用此选项可为状态操作指定备用的，特定于设备的超时。
							</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_status_retries</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>整数</p>
							 </td><td valign="top" style="text-align:left"> <p>2</p>
							 </td><td valign="top" style="text-align:left"> <p>在超时期限内重试status命令的最大次数。某些设备不支持多个连接。如果设备忙于其他任务，操作可能会失败，因此如果剩余时间，Pacemaker将自动重试该操作。使用此选项可以更改Pacemaker在放弃之前重试状态操作的次数。
							</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_delay_base</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>时间</p>
							 </td><td valign="top" style="text-align:left"> <p>0</p>
							 </td><td valign="top" style="text-align:left"> <p>为stonith操作启用基本延迟并指定基本延迟值。在具有偶数节点的群集中，配置延迟可以帮助避免节点在偶数拆分中同时相互隔离。当相同的fence设备用于所有节点时，随机延迟可能很有用，并且当每个节点使用单独的设备时，不同的静态延迟在每个防护设备上都很有用整体延迟来自随机延迟值，添加此静态延迟使得总和保持在最大延迟之下。如果设置<code class="literal">pcmk_delay_base</code>但未设置<code class="literal">pcmk_delay_max</code> ，则延迟没有随机分量，它将是<code class="literal">pcmk_delay_base</code>的值。
							</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_delay_max</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>时间</p>
							 </td><td valign="top" style="text-align:left"> <p>0</p>
							 </td><td valign="top" style="text-align:left"> <p>为stonith操作启用随机延迟并指定随机延迟的最大值。在具有偶数节点的群集中，配置延迟可以帮助避免节点在偶数拆分中同时相互隔离。当相同的fence设备用于所有节点时，随机延迟可能很有用，并且当每个节点使用单独的设备时，不同的静态延迟在每个防护设备上都很有用整体延迟是从这个随机延迟值派生的，增加了一个静态延迟使得总和保持在最大延迟之下。如果设置<code class="literal">pcmk_delay_max</code>但未设置<code class="literal">pcmk_delay_base</code> ，则延迟没有静态组件。
							</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_action_limit</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>整数</p>
							 </td><td valign="top" style="text-align:left"> <p>1</p>
							 </td><td valign="top" style="text-align:left"> <p>可在此设备上并行执行的最大操作数。需要首先配置集群属性<code class="literal">concurrent-fencing=true</code> 。值-1不受限制。
							</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_on_action</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>串</p>
							 </td><td valign="top" style="text-align:left"> <p>上</p>
							 </td><td valign="top" style="text-align:left"> <p>仅限高级用途：运行而不是<code class="literal">on</code>的备用命令。某些设备不支持标准命令或可能提供其他设备。使用此选项指定实现<code class="literal">on</code>操作的备用设备特定命令。
							</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_on_timeout</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>时间</p>
							 </td><td valign="top" style="text-align:left"> <p>60年代</p>
							 </td><td valign="top" style="text-align:left"> <p>仅限高级用途：指定用于<code class="literal">on</code>操作而不是<code class="literal">stonith-timeout</code>的备用<code class="literal">stonith-timeout</code> 。有些设备比普通设备需要更多或更少的时间来完成。使用此选项可为<code class="literal">on</code>操作指定备用的，特定<code class="literal">on</code>设备的超时。
							</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>
								<code class="literal">pcmk_on_retries</code>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>整数</p>
							 </td><td valign="top" style="text-align:left"> <p>2</p>
							 </td><td valign="top" style="text-align:left"> <p>仅供高级使用：在超时期限内重试<code class="literal">on</code>命令的最大次数。某些设备不支持多个连接。如果设备忙于其他任务，操作可能会<code class="literal">fail</code> ，因此如果剩余时间，Pacemaker将自动重试该操作。使用此选项可改变心脏起搏器的重试次数<code class="literal">on</code>放弃之前的动作。
							</p>
							 </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="proc_testing-fence-devices-configuring-fencing"></a>测试围栏设备</h1></div></div></div><p>防护是Red Hat Cluster基础架构的基础部分，因此验证或测试防护是否正常工作非常重要。
			</p><p>使用以下过程测试fence设备。
			</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">使用ssh，telnet，HTTP或任何远程协议连接到设备以手动登录并测试fence设备或查看给出的输出。例如，如果要为启用IPMI的设备配置防护，请尝试使用<code class="literal">ipmitool</code>远程登录。记下手动登录时使用的选项，因为使用防护代理时可能需要这些选项。
					</p><p class="simpara">如果您无法登录fence设备，请验证设备是否可ping，没有防火墙配置阻止访问fence设备，防护设备上启用了远程访问，并且凭据是正确的。
					</p></li><li class="listitem"><p class="simpara">使用fence代理脚本手动运行fence代理。这不要求群集服务正在运行，因此您可以在群集中配置设备之前执行此步骤。这可以确保围栏设备在继续之前正确响应。
					</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>本节中的示例对iLO设备使用<code class="literal">fence_ipmilan</code> fence代理脚本。您将使用的实际fence代理程序以及调用该代理程序的命令将取决于您的服务器硬件。您应该查阅正在使用的fence代理的手册页，以确定要指定的选项。您通常需要知道fence设备的登录名和密码以及与fence设备相关的其他信息。
						</p></div><p class="simpara">以下示例显示了用于运行带有<code class="literal">-o status</code>参数的<code class="literal">fence_ipmilan</code> fence代理脚本的格式，以检查另一个节点上的fence设备接口的状态，而不实际对其进行隔离。这允许您在尝试重新启动节点之前测试设备并使其正常工作。运行此命令时，您可以指定具有iLO设备的开机和关机权限的iLO用户的名称和密码。
					</p><pre class="literallayout"># <code class="literal">fence_ipmilan -a ipaddress -l username -p password -o status</code></pre><p class="simpara">以下示例显示了使用<code class="literal">-o reboot</code>参数运行<code class="literal">fence_ipmilan</code> fence代理脚本的格式。在一个节点上运行此命令将重新引导此iLO设备管理的节点。
					</p><pre class="literallayout"># <code class="literal">fence_ipmilan -a ipaddress -l username -p password -o reboot</code></pre><p class="simpara">如果fence代理无法正确执行status，off，on或reboot操作，则应检查硬件，fence设备的配置以及命令的语法。此外，您可以在启用调试输出的情况下运行fence代理脚本。调试输出对于某些防护代理程序非常有用，可以查看防火代理程序脚本在登录fence设备时失败的事件顺序。
					</p><pre class="literallayout"># <code class="literal">fence_ipmilan -a ipaddress -l username -p password -o status -D /tmp/$(hostname)-fence_agent.debug</code></pre><p class="simpara">在诊断已发生的故障时，应确保手动登录到fence设备时指定的选项与使用fence代理脚本传递给fence代理的选项相同。
					</p><p class="simpara">对于支持加密连接的fence代理，您可能会因证书验证失败而看到错误，要求您信任主机或使用fence代理的<code class="literal">ssl-insecure</code>参数。同样，如果在目标设备上禁用了SSL / TLS，则在设置fence代理的SSL参数时可能需要考虑这一点。
					</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>如果正在测试的fence代理程序是<code class="literal">fence_drac</code> ， <code class="literal">fence_ilo</code>或继续失败的系统管理设备的某些其他防护代理程序，则返回尝试<code class="literal">fence_ipmilan</code> 。大多数系统管理卡支持IPMI远程登录，唯一受支持的防护代理是<code class="literal">fence_ipmilan</code> 。
						</p></div></li><li class="listitem"><p class="simpara">一旦在群集中配置了fence设备，并且具有手动工作并且已启动群集的相同选项，请使用来自任何节点的<code class="literal">pcs stonith fence</code>命令测试防护（甚至可以从不同节点多次），如下例所示。<code class="literal">pcs stonith fence</code>命令从CIB读取集群配置，并按配置调用fence代理以执行fence操作。这将验证群集配置是否正确。
					</p><pre class="literallayout"># <code class="literal">pcs stonith fence node_name</code></pre><p class="simpara">如果<code class="literal">pcs stonith fence</code>命令正常工作，则意味着在发生fence事件时，群集的防护配置应该可以正常工作。如果命令失败，则表示集群管理无法通过其检索到的配置调用fence设备。检查以下问题并根据需要更新群集配置。
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">检查围栏配置。例如，如果您使用了主机映射，则应确保系统可以使用您提供的主机名找到该节点。
							</li><li class="listitem">检查设备的密码和用户名是否包含可能被bash shell误解的任何特殊字符。确保输入用引号括起来的密码和用户名可以解决此问题。
							</li><li class="listitem">检查是否可以使用<code class="literal">pcs stonith</code>命令中指定的确切IP地址或主机名连接到设备。例如，如果您在stonith命令中指定主机名但使用IP地址进行测试，那么这不是有效的测试。</li><li class="listitem"><p class="simpara">如果您可以访问fence设备使用的协议，请使用该协议尝试连接到设备。例如，许多代理使用ssh或telnet。您应该尝试使用配置设备时提供的凭据连接到设备，以查看是否收到有效提示并可以登录设备。
							</p><p class="simpara">如果您确定所有参数都合适，但仍然无法连接到fence设备，则可以检查fence设备本身的日志记录，如果设备提供了该设置，将显示用户是否已连接以及用户使用了什么命令发行。您还可以在<code class="literal">/var/log/messages</code>文件中搜索stonith和error的实例，这可以了解正在发生的事情，但是某些代理可以提供其他信息。
							</p></li></ul></div></li><li class="listitem"><p class="simpara">一旦fence设备测试正常并且集群已启动并运行，请测试实际故障。为此，请在群集中执行应启动令牌丢失的操作。
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">取下网络。如何使用网络取决于您的具体配置。在许多情况下，您可以物理地将网络或电源线拉出主机。有关模拟网络故障的信息，请参阅<a class="link" href="https://access.redhat.com/solutions/79523/">在RHEL群集</a>上模拟网络故障<a class="link" href="https://access.redhat.com/solutions/79523/">的正确方法是什么？</a> 。
							</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>建议不要在本地主机上禁用网络接口而不是物理断开网络或电源线作为防护测试，因为它无法准确模拟典型的实际故障。
								</p></div></li><li class="listitem"><p class="simpara">使用本地防火墙阻止入站和出站的corosync流量。
							</p><p class="simpara">以下示例阻止corosync，假设使用默认corosync端口， <code class="literal">firewalld</code>用作本地防火墙，corosync使用的网络接口位于默认防火墙区域：</p><pre class="literallayout"># <code class="literal">firewall-cmd --direct --add-rule ipv4 filter OUTPUT 2 -p udp --dport=5405 -j DROP</code>
# <code class="literal">firewall-cmd --add-rich-rule='rule family="ipv4" port port="5405" protocol="udp" drop'</code></pre></li><li class="listitem"><p class="simpara">使用<code class="literal">sysrq-trigger</code>模拟崩溃并使机器发生混乱。但请注意，触发内核恐慌会导致数据丢失;建议您先禁用群集资源。
							</p><pre class="literallayout"># <code class="literal">echo c &gt; /proc/sysrq-trigger</code></pre></li></ul></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="proc_configuring-fencing-levels-configuring-fencing"></a>配置防护级别</h1></div></div></div><p>Pacemaker通过称为fencing拓扑的功能支持具有多个设备的防护节点。要实现拓扑，请按照常规方式创建单个设备，然后在配置中的防护拓扑部分中定义一个或多个防护级别。
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">从1开始，以升序数字顺序尝试每个级别。
					</li><li class="listitem">如果设备发生故障，则处理将终止当前级别。不再使用该级别的其他设备，而是尝试下一级别。
					</li><li class="listitem">如果所有设备都成功隔离，则该级别已成功，并且未尝试其他级别。
					</li><li class="listitem">当一个级别已经过去（成功）或者已经尝试了所有级别（失败）时，操作就结束了。
					</li></ul></div><p>使用以下命令将防护级别添加到节点。这些设备以逗号分隔的stonith id列表给出，这些列表是针对该级别的节点尝试的。
			</p><pre class="literallayout">pcs stonith level add <span class="emphasis"><em>level</em></span> <span class="emphasis"><em>node</em></span> <span class="emphasis"><em>devices</em></span></pre><p>以下命令列出了当前配置的所有防护级别。
			</p><pre class="literallayout">pcs stonith level</pre><p>在下面的例子中，存在被配置用于节点的两个栅栏设备<code class="literal">rh7-2</code> ：一个ILO栅栏设备称为<code class="literal">my_ilo</code>和称为APC fence设备<code class="literal">my_apc</code> 。这些命令设置了栅栏级别，以便如果设备<code class="literal">my_ilo</code>失败并且无法<code class="literal">my_ilo</code>节点，则Pacemaker将尝试使用设备<code class="literal">my_apc</code> 。此示例还显示了配置<code class="literal">pcs stonith level</code>后<code class="literal">pcs stonith level</code>命令的输出。
			</p><pre class="literallayout"># <code class="literal">pcs stonith level add 1 rh7-2 my_ilo</code>
# <code class="literal">pcs stonith level add 2 rh7-2 my_apc</code>
# <code class="literal">pcs stonith level</code>
 Node: rh7-2
  Level 1 - my_ilo
  Level 2 - my_apc</pre><p>以下命令将删除指定节点和设备的fence级别。如果未指定节点或设备，则从所有节点中删除指定的fence级别。
			</p><pre class="literallayout">pcs stonith level remove <span class="emphasis"><em>level</em></span> [<span class="emphasis"><em>node_id</em></span>] [<span class="emphasis"><em>stonith_id</em></span>] ... [<span class="emphasis"><em>stonith_id</em></span>]</pre><p>以下命令清除指定节点或stonith id上的fence级别。如果未指定节点或stonith标识，则清除所有栅栏级别。
			</p><pre class="literallayout">pcs stonith level clear [<span class="emphasis"><em>node</em></span>|<span class="emphasis"><em>stonith_id</em></span>(s)]</pre><p>如果指定多个stonith id，则必须用逗号分隔，不能有空格，如下例所示。
			</p><pre class="literallayout"># <code class="literal">pcs stonith level clear dev_a,dev_b</code></pre><p>以下命令验证是否存在在fence级别中指定的所有fence设备和节点。
			</p><pre class="literallayout">pcs stonith level verify</pre><p>您可以通过应用于节点名称的正则表达式以及节点属性及其值来指定防护拓扑中的节点。例如，以下命令将节点<code class="literal">node1</code> ， <code class="literal">node2</code>和<code class="literal">`node3</code>为使用fence设备<code class="literal">apc1</code>和<code class="literal">`apc2</code> ，节点<code class="literal">`node4</code> ， <code class="literal">node5</code>和<code class="literal">`node6</code>使用fence设备<code class="literal">apc3</code>和<code class="literal">`apc4</code> 。
			</p><pre class="literallayout">pcs stonith level add 1 "regexp%node[1-3]" apc1,apc2
pcs stonith level add 1 "regexp%node[4-6]" apc3,apc4</pre><p>以下命令通过使用节点属性匹配产生相同的结果。
			</p><pre class="literallayout">pcs node attribute node1 rack=1
pcs node attribute node2 rack=1
pcs node attribute node3 rack=1
pcs node attribute node4 rack=2
pcs node attribute node5 rack=2
pcs node attribute node6 rack=2
pcs stonith level add 1 attrib%rack=1 apc1,apc2
pcs stonith level add 1 attrib%rack=2 apc3,apc4</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="proc_configuring-fencing-for-redundant-power-configuring-fencing"></a>为冗余电源配置防护</h1></div></div></div><p>为冗余电源配置防护时，群集必须确保在尝试重新引导主机时，在重新打开电源之前关闭两个电源。
			</p><p>如果节点从未完全断电，则节点可能不会释放其资源。这开启了节点同时访问这些资源并破坏它们的可能性。
			</p><p>您只需要定义每个设备一次，并指定两者都需要屏蔽节点，如下例所示。
			</p><pre class="literallayout"># <code class="literal">pcs stonith create apc1 fence_apc_snmp ipaddr=apc1.example.com login=user passwd='7a4D#1j!pz864' pcmk_host_map="node1.example.com:1;node2.example.com:2"</code>

# <code class="literal">pcs stonith create apc2 fence_apc_snmp ipaddr=apc2.example.com login=user passwd='7a4D#1j!pz864' pcmk_host_map="node1.example.com:1;node2.example.com:2"</code>

# <code class="literal">pcs stonith level add 1 node1.example.com apc1,apc2</code>
# <code class="literal">pcs stonith level add 1 node2.example.com apc1,apc2</code></pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="proc_displaying-configuring-fence-devices-configuring-fencing"></a>显示配置的fence设备</h1></div></div></div><p>以下命令显示所有当前配置的fence设备。如果指定了<span class="emphasis"><em>stonith_id</em></span> ，则该命令仅显示该已配置的stonith设备的选项。如果指定了<code class="literal">--full</code>选项，则显示所有已配置的stonith选项。
			</p><pre class="literallayout">pcs stonith config [<span class="emphasis"><em>stonith_id</em></span>] [--full]</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="proc_modifying-fence-devices-configuring-fencing"></a>修改和删除fence设备</h1></div></div></div><p>使用以下命令修改或添加当前配置的防护设备的选项。
			</p><pre class="literallayout">pcs stonith update <span class="emphasis"><em>stonith_id</em></span> [<span class="emphasis"><em>stonith_device_options</em></span>]</pre><p>使用以下命令从当前配置中删除防护设备。
			</p><pre class="literallayout">pcs stonith delete <span class="emphasis"><em>stonith_id</em></span></pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="proc_manually-fencing-a-node-configuring-fencing"></a>手动屏蔽群集节点</h1></div></div></div><p>您可以使用以下命令手动阻止节点。如果你指定<code class="literal">--off</code>这将使用对stonith的<code class="literal">off</code> API调用，这将关闭节点而不是重新启动它。
			</p><pre class="literallayout">pcs stonith fence <span class="emphasis"><em>node</em></span> [--off]</pre><p>在没有stonith设备即使它不再活动的情况下也不能阻挡节点的情况下，集群可能无法恢复节点上的资源。如果发生这种情况，在手动确保节点断电后，您可以输入以下命令以向群集确认节点已关闭并释放其资源以进行恢复。
			</p><div class="warning" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">警告</h3><p>如果您指定的节点实际上没有关闭，但运行通常由群集控制的群集软件或服务，则会发生数据损坏/群集故障。
				</p></div><pre class="literallayout">pcs stonith confirm <span class="emphasis"><em>node</em></span></pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="proc_disabling-a-fence-device-configuring-fencing"></a>禁用fence设备</h1></div></div></div><p>要禁用防护设备/资源，请运行<code class="literal">pcs stonith disable</code>命令。
			</p><p>以下命令禁用fence设备<code class="literal">myapc</code> 。
			</p><pre class="literallayout"># <code class="literal">pcs stonith disable myapc</code></pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="proc_preventing-a-node-from-using-a-fence-device-configuring-fencing"></a>防止节点使用fence设备</h1></div></div></div><p>要防止特定节点使用防护设备，可以为防护资源配置位置约束。
			</p><p>以下示例可防止fence设备<code class="literal">node1-ipmi</code>在<code class="literal">node1</code>运行。
			</p><pre class="literallayout"># <code class="literal">pcs constraint location node1-ipmi avoids node1</code></pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="proc_configuring-acpi-for-fence-devices-configuring-fencing"></a>配置ACPI以与集成的fence设备一起使用</h1></div></div></div><p>如果您的群集使用集成的fence设备，则必须配置ACPI（高级配置和电源接口）以确保立即完成防护。
			</p><p>如果群集节点配置为由集成的fence设备隔离，请为该节点禁用ACPI Soft-Off。禁用ACPI Soft-Off允许集成的fence设备立即完全关闭节点，而不是尝试干净关闭（例如， <code class="literal">shutdown -h now</code> ）。否则，如果启用了ACPI Soft-Off，则集成的fence设备可能需要四秒或更长时间才能关闭节点（请参阅下面的注释）。此外，如果启用ACPI Soft-Off且节点在关机期间发生混乱或冻结，则集成的fence设备可能无法关闭节点。在这种情况下，击剑延迟或不成功。因此，当节点使用集成的fence设备进行隔离并且启用了ACPI Soft-Off时，群集恢复缓慢或需要管理干预才能恢复。
			</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>栅栏节点所需的时间取决于所使用的集成栅栏设备。一些集成的栅栏装置相当于按下并按住电源按钮;因此，围栏设备在四到五秒内关闭节点。其他集成的栅栏设备执行相当于暂时按下电源按钮，依靠操作系统关闭节点;因此，围栏设备在比4到5秒更长的时间跨度内关闭节点。
				</p></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">禁用ACPI Soft-Off的首选方法是将BIOS设置更改为“即时关闭”或等效设置，以便在没有延迟的情况下关闭节点，如<a class="xref" href="assembly_configuring-fencing-configuring-and-managing-high-availability-clusters.html#s2-bios-setting-CA" title="使用BIOS禁用ACPI Soft-Off">“使用BIOS禁用ACPI软关闭”一节中所述</a> 。
					</li></ul></div><p>某些系统可能无法使用BIOS禁用ACPI Soft-Off。如果使用BIOS禁用ACPI Soft-Off对群集不满意，可以使用以下备用方法之一禁用ACPI Soft-Off：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">在<code class="literal">/etc/systemd/logind.conf</code>文件中设置<code class="literal">HandlePowerKey=ignore</code> ，并在隔离时验证节点节点是否立即关闭，如<a class="xref" href="assembly_configuring-fencing-configuring-and-managing-high-availability-clusters.html#s2-acpi-disable-logind-CA" title="在logind.conf文件中禁用ACPI Soft-Off">“在logind.conf文件中禁用ACPI软关闭”一节中所述</a> 。这是禁用ACPI Soft-Off的第一种替代方法。</li><li class="listitem"><p class="simpara">将<code class="literal">acpi=off</code>附加到内核引导命令行，如<a class="xref" href="assembly_configuring-fencing-configuring-and-managing-high-availability-clusters.html#s2-acpi-disable-boot-CA" title="在GRUB 2文件中完全禁用ACPI">“在GRUB 2文件中完全禁用ACPI”一节中所述</a> 。如果首选或第一种备用方法不可用，这是禁用ACPI Soft-Off的第二种备用方法。
					</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>此方法完全禁用ACPI;如果完全禁用ACPI，则某些计算机无法正确引导。<span class="emphasis"><em>仅</em></span>当其他方法对群集无效时， <span class="emphasis"><em>才</em></span>使用此方法。
						</p></div></li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="s2-bios-setting-CA"></a>使用BIOS禁用ACPI Soft-Off</h2></div></div></div><p>您可以通过使用以下过程配置每个群集节点的BIOS来禁用ACPI Soft-Off。
				</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>使用BIOS禁用ACPI Soft-Off的过程可能因服务器系统而异。您应该使用硬件文档验证此过程。
					</p></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem">重新启动节点并启动<code class="literal">BIOS CMOS Setup Utility</code>程序。
						</li><li class="listitem">导航到“电源”菜单（或等效的电源管理菜单）。
						</li><li class="listitem"><p class="simpara">在Power菜单中，将<code class="literal">Soft-Off by PWR-BTTN</code>功能（或等效功能）设置为<code class="literal">Instant-Off</code> （或通过电源按钮无延迟关闭节点的等效设置）。<a class="xref" href="assembly_configuring-fencing-configuring-and-managing-high-availability-clusters.html#ex-bios-acpi-off-CA" title="BIOS CMOS设置实用程序："><code class="literal">BIOS CMOS Setup Utility</code> ：</a>显示一个Power菜单，其<code class="literal">ACPI Function</code>设置为<code class="literal">Enabled</code> ， <code class="literal">Soft-Off by PWR-BTTN</code>设置为<code class="literal">Instant-Off</code> 。</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p><code class="literal">ACPI Function</code>的等效项， <code class="literal">Soft-Off by PWR-BTTN</code>和<code class="literal">Instant-Off</code>可能因计算机而异。但是，此过程的目的是配置BIOS，以便通过电源按钮无延迟地关闭计算机。
							</p></div></li><li class="listitem">退出<code class="literal">BIOS CMOS Setup Utility</code>程序，保存BIOS配置。
						</li><li class="listitem">隔离时验证节点是否立即关闭。有关测试fence设备的信息，请参阅<a class="link" href="assembly_configuring-fencing-configuring-and-managing-high-availability-clusters.html#proc_testing-fence-devices-configuring-fencing" title="测试围栏设备">测试fence设备</a> 。
						</li></ol></div><p><a id="ex-bios-acpi-off-CA"></a></p><div class="title"><strong><code class="literal">BIOS CMOS Setup Utility</code> ：</strong></div><p>
						
</p><pre class="literallayout">`Soft-Off by PWR-BTTN` set to
`Instant-Off`</pre><p>

					</p><div class="informalexample"><pre class="literallayout">+---------------------------------------------|-------------------+
|    ACPI Function             [Enabled]      |    Item Help      |
|    ACPI Suspend Type         [S1(POS)]      |-------------------|
|  x Run VGABIOS if S3 Resume   Auto          |   Menu Level   *  |
|    Suspend Mode              [Disabled]     |                   |
|    HDD Power Down            [Disabled]     |                   |
|    Soft-Off by PWR-BTTN      [Instant-Off   |                   |
|    CPU THRM-Throttling       [50.0%]        |                   |
|    Wake-Up by PCI card       [Enabled]      |                   |
|    Power On by Ring          [Enabled]      |                   |
|    Wake Up On LAN            [Enabled]      |                   |
|  x USB KB Wake-Up From S3     Disabled      |                   |
|    Resume by Alarm           [Disabled]     |                   |
|  x  Date(of Month) Alarm       0            |                   |
|  x  Time(hh:mm:ss) Alarm       0 :  0 :     |                   |
|    POWER ON Function         [BUTTON ONLY   |                   |
|  x KB Power ON Password       Enter         |                   |
|  x Hot Key Power ON           Ctrl-F1       |                   |
|                                             |                   |
|                                             |                   |
+---------------------------------------------|-------------------+</pre><p>此示例显示<code class="literal">ACPI Function</code>设置为<code class="literal">Enabled</code> ，而<code class="literal">Soft-Off by PWR-BTTN</code>设置为<code class="literal">Instant-Off</code> 。</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="s2-acpi-disable-logind-CA"></a>在logind.conf文件中禁用ACPI Soft-Off</h2></div></div></div><p>要在<code class="literal">/etc/systemd/logind.conf</code>文件中禁用电源键处理，请使用以下过程。
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">在<code class="literal">/etc/systemd/logind.conf</code>文件中定义以下配置：</p><pre class="literallayout">HandlePowerKey=ignore</pre></li><li class="listitem"><p class="simpara">重新加载<code class="literal">systemd</code>配置：</p><pre class="literallayout"># <code class="literal">systemctl daemon-reload</code></pre></li><li class="listitem">隔离时验证节点是否立即关闭。有关测试fence设备的信息，请参阅<a class="link" href="assembly_configuring-fencing-configuring-and-managing-high-availability-clusters.html#proc_testing-fence-devices-configuring-fencing" title="测试围栏设备">测试fence设备</a> 。
						</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="s2-acpi-disable-boot-CA"></a>在GRUB 2文件中完全禁用ACPI</h2></div></div></div><p>您可以通过将<code class="literal">acpi=off</code>附加到内核的GRUB菜单项来禁用ACPI Soft-Off。
				</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>此方法完全禁用ACPI;如果完全禁用ACPI，则某些计算机无法正确引导。<span class="emphasis"><em>仅</em></span>当其他方法对群集无效时， <span class="emphasis"><em>才</em></span>使用此方法。
					</p></div><p>使用以下过程在GRUB 2文件中禁用ACPI：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">使用<code class="literal">--args</code>选项搭配的<code class="literal">--update-kernel</code>中的选项<code class="literal">grubby</code>工具来改变<code class="literal">grub.cfg</code>每个集群节点的文件，如下所示：</p><pre class="literallayout"># <code class="literal">grubby --args=acpi=off --update-kernel=ALL</code></pre></li><li class="listitem">重新启动节点。
						</li><li class="listitem">隔离时验证节点是否立即关闭。有关测试fence设备的信息，请参阅<a class="link" href="assembly_configuring-fencing-configuring-and-managing-high-availability-clusters.html#proc_testing-fence-devices-configuring-fencing" title="测试围栏设备">测试fence设备</a> 。
						</li></ol></div></div></div></div></body></html>