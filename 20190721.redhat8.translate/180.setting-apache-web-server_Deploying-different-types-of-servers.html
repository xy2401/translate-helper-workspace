<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 1. Setting up the Apache HTTP web server</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="setting-apache-web-server_Deploying-different-types-of-servers"/>Chapter 1. Setting up the Apache HTTP web server</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="apache-intro_setting-apache-web-server"/>Introduction to the Apache HTTP web server</h1></div></div></div><p>
				A <span class="emphasis"><em>web server</em></span> is a network service that serves content to a client over the web. This typically means web pages, but any other documents can be served as well. Web servers are also known as HTTP servers, as they use the <span class="emphasis"><em>hypertext transport protocol</em></span> (<span class="strong"><strong>HTTP</strong></span>).
			</p><p>
				The web servers available in Red Hat Enterprise Linux 8 are:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<span class="strong"><strong><span class="application">Apache HTTP Server</span></strong></span>
					</li><li class="listitem">
						<span class="strong"><strong><span class="application">nginx</span></strong></span>
					</li></ul></div><p>
				The <span class="strong"><strong><span class="application">Apache HTTP Server</span></strong></span>, <code class="literal">httpd</code>, is an open source web server developed by the <a class="link" href="http://www.apache.org/">Apache Software Foundation</a>.
			</p><p>
				If you are upgrading from a previous release of Red Hat Enterprise Linux, you will need to update the <code class="literal">httpd</code> service configuration accordingly. This section reviews some of the newly added features, and guides you through the update of prior configuration files.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="apache-changes-to-rhel7_setting-apache-web-server"/>Notable changes in the Apache HTTP Server</h1></div></div></div><p>
				The <span class="strong"><strong><span class="application">Apache HTTP Server</span></strong></span>, has been updated from version 2.4.6 to version 2.4.37 between RHEL 7 and RHEL 8. This updated version includes several new features, but maintains backwards compatibility with the RHEL 7 version at the level of configuration and Application Binary Interface (ABI) of external modules.
			</p><p>
				New features include:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<code class="literal">HTTP/2</code> support is now provided by the <code class="literal">mod_http2</code> package, which is a part of the <code class="literal">httpd</code> module.
					</li><li class="listitem">
						systemd socket activation is supported. See <code class="literal">httpd.socket(8)</code> man page for more details.
					</li></ul></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
						Multiple new modules have been added:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<code class="literal">mod_proxy_hcheck</code> - a proxy health-check module
							</li><li class="listitem">
								<code class="literal">mod_proxy_uwsgi</code> - a Web Server Gateway Interface (WSGI) proxy
							</li><li class="listitem">
								<code class="literal">mod_proxy_fdpass</code> - provides support for the passing the socket of the client to another process
							</li><li class="listitem">
								<code class="literal">mod_cache_socache</code> - an HTTP cache using, for example, memcache backend
							</li><li class="listitem">
								<code class="literal">mod_md</code> - an ACME protocol SSL/TLS certificate service
							</li></ul></div></li><li class="listitem"><p class="simpara">
						The following modules now load by default:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<code class="literal">mod_request</code>
							</li><li class="listitem">
								<code class="literal">mod_macro</code>
							</li><li class="listitem">
								<code class="literal">mod_watchdog</code>
							</li></ul></div></li><li class="listitem">
						A new subpackage, <code class="literal">httpd-filesystem</code>, has been added, which contains the basic directory layout for the <span class="strong"><strong><span class="application">Apache HTTP Server</span></strong></span> including the correct permissions for the directories.
					</li><li class="listitem">
						Instantiated service support, <code class="literal">httpd@.service</code> has been introduced. See the <code class="literal">httpd.service</code> man page for more information.
					</li></ul></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						A new <code class="literal">httpd-init.service</code> replaces the <code class="literal">%post script</code> to create a self-signed <code class="literal">mod_ssl</code> key pair.
					</li></ul></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						Automated TLS certificate provisioning and renewal using the Automatic Certificate Management Environment (ACME) protocol is now supported with the <code class="literal">mod_md</code> package (for use with certificate providers such as <code class="literal">Let’s Encrypt</code>).
					</li><li class="listitem">
						The <span class="strong"><strong><span class="application">Apache HTTP Server</span></strong></span> now supports loading TLS certificates and private keys from hardware security tokens directly from <code class="literal">PKCS#11</code> modules. As a result, a <code class="literal">mod_ssl</code> configuration can now use <code class="literal">PKCS#11</code> URLs to identify the TLS private key, and, optionally, the TLS certificate in the <code class="literal">SSLCertificateKeyFile</code> and <code class="literal">SSLCertificateFile</code> directives.
					</li><li class="listitem"><p class="simpara">
						A new <code class="literal">ListenFree</code> directive in the <code class="literal">/etc/httpd/conf/httpd.conf</code> file is now supported.
					</p><p class="simpara">
						Similarly to the <code class="literal">Listen</code> directive, <code class="literal">ListenFree</code> provides information about IP addresses, ports, or IP address-and-port combinations that the server listens to. However, with <code class="literal">ListenFree</code>, the <code class="literal">IP_FREEBIND</code> socket option is enabled by default. Hence, <code class="literal">httpd</code> is allowed to bind to a nonlocal IP address or to an IP address that does not exist yet. This allows <code class="literal">httpd</code> to listen on a socket without requiring the underlying network interface or the specified dynamic IP address to be up at the time when <code class="literal">httpd</code> is trying to bind to it.
					</p><p class="simpara">
						Note that the <code class="literal">ListenFree</code> directive is currently available only in RHEL 8.
					</p><p class="simpara">
						For more details on <code class="literal">ListenFree</code>, see the following table:
					</p><div class="table"><a id="idm140241845869328"/><p class="title"><strong>Table 1.1. ListenFree directive’s syntax, status, and modules</strong></p><div class="table-contents"><table summary="ListenFree directive’s syntax, status, and modules" border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">Syntax</th><th style="text-align: left" valign="top">Status</th><th style="text-align: left" valign="top">Modules</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
										ListenFree [IP-address:]portnumber [protocol]
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										MPM
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										event, worker, prefork, mpm_winnt, mpm_netware, mpmt_os2
									</p>
									 </td></tr></tbody></table></div></div></li></ul></div><p>
				Other notable changes include:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
						The following modules have been removed:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<code class="literal">mod_file_cache</code>
							</li><li class="listitem">
								<code class="literal">mod_nss</code>
							</li><li class="listitem">
								<code class="literal">mod_perl</code>
							</li></ul></div></li><li class="listitem">
						The default type of the DBM authentication database used by the <span class="strong"><strong><span class="application">Apache HTTP Server</span></strong></span> in RHEL 8 has been changed from <code class="literal">SDBM</code> to <code class="literal">db5</code>.
					</li><li class="listitem">
						The <code class="literal">mod_wsgi</code> module for the <span class="strong"><strong><span class="application">Apache HTTP Server</span></strong></span> has been updated to Python 3. WSGI applications are now supported only with Python 3, and must be migrated from Python 2.
					</li><li class="listitem"><p class="simpara">
						The multi-processing module (MPM) configured by default with the <span class="strong"><strong><span class="application">Apache HTTP Server</span></strong></span> has changed from a multi-process, forked model (known as <code class="literal">prefork</code>) to a high-performance multi-threaded model, <code class="literal">event</code>.
					</p><p class="simpara">
						Any third-party modules that are not thread-safe need to be replaced or removed. To change the configured MPM, edit the <code class="literal">/etc/httpd/conf.modules.d/00-mpm.conf</code> file. See the <code class="literal">httpd.service(8)</code> man page for more information.
					</p></li><li class="listitem">
						The minimum UID and GID allowed for users by suEXEC are now 1000 and 500, respectively (previously 100 and 100).
					</li><li class="listitem">
						The <code class="literal">/etc/sysconfig/httpd</code> file is no longer a supported interface for setting environment variables for the <code class="literal">httpd</code> service. The <code class="literal">httpd.service(8)</code> man page has been added for the systemd service.
					</li><li class="listitem">
						Stopping the <code class="literal">httpd</code> service now uses a “graceful stop” by default.
					</li><li class="listitem">
						The <code class="literal">mod_auth_kerb</code> module has been replaced by the <code class="literal">mod_auth_gssapi</code> module.
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="apache-updating-configuration_setting-apache-web-server"/>Updating the configuration</h1></div></div></div><p>
				To update the configuration files from the <span class="strong"><strong><span class="application">Apache HTTP Server</span></strong></span> version used in Red Hat Enterprise Linux 7, choose one of the following options:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						If <code class="literal">/etc/sysconfig/httpd</code> is used to set environment variables, create a systemd drop-in file instead.
					</li><li class="listitem">
						If any third-party modules are used, ensure they are compatible with a threaded MPM.
					</li><li class="listitem">
						If suexec is used, ensure user and group IDs meet the new minimums.
					</li></ul></div><p>
				You can check the configuration for possible errors by using the following command:
			</p><pre class="literallayout">~]# apachectl configtest
Syntax OK</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="running-httpd-service_setting-apache-web-server"/>Running the httpd service</h1></div></div></div><p>
				This section describes how to start, stop, restart, and check the current status of the <span class="strong"><strong><span class="application">Apache HTTP Server</span></strong></span>. To be able to use the <code class="literal">httpd</code> service, make sure you have the <code class="literal">httpd</code> package installed:
			</p><pre class="literallayout">~]# yum install httpd</pre><p>
				On Red Hat Enterprise Linux 8, the <span class="strong"><strong><span class="application">Apache HTTP Server</span></strong></span> can be installed also through the <code class="literal">httpd</code> module, which is available in the Application stream.
			</p><p>
				To install the <code class="literal">httpd</code> module, run the following command as <code class="literal">root</code>:
			</p><pre class="literallayout">~]# yum module install httpd</pre><p>
				Note, that this command will install also the <code class="literal">mod_ssl</code> module, which provides the SSL/TLS support.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sec-apache-running-starting"/>Starting the service</h2></div></div></div><p>
					To run the <code class="literal">httpd</code> service, type the following at a shell prompt as <code class="literal">root</code>:
				</p><pre class="literallayout">~]# systemctl start httpd.service</pre><p>
					If you want the service to start automatically at boot time, use the following command:
				</p><pre class="literallayout">~]# systemctl enable httpd.service
Created symlink from /etc/systemd/system/multi-user.target.wants/httpd.service to /usr/lib/systemd/system/httpd.service.</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						If running the <span class="strong"><strong><span class="application">Apache HTTP Server</span></strong></span> as a secure server, a password is required after the machine boots if using an encrypted private SSL key.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sec-apache-running-stopping"/>Stopping the service</h2></div></div></div><p>
					To stop the running <code class="literal">httpd</code> service, type the following at a shell prompt as <code class="literal">root</code>:
				</p><pre class="literallayout">~]# systemctl stop httpd.service</pre><p>
					To prevent the service from starting automatically at boot time, type:
				</p><pre class="literallayout">~]# systemctl disable httpd.service
Removed symlink /etc/systemd/system/multi-user.target.wants/httpd.service.</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sec-apache-running-restarting"/>Restarting the service</h2></div></div></div><p>
					There are two ways to restart a running <code class="literal">httpd</code> service:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							To restart the service completely, enter the following command as <code class="literal">root</code>:
						</p><pre class="literallayout">~]# systemctl restart httpd.service</pre><p class="simpara">
							This stops the running <code class="literal">httpd</code> service and immediately starts it again. Use this command after installing or removing a dynamically loaded module such as PHP.
						</p></li><li class="listitem"><p class="simpara">
							To reload the configuration without affecting active requests, enter the following command as <code class="literal">root</code>:
						</p><pre class="literallayout">~]# systemctl reload httpd.service</pre><p class="simpara">
							This causes the running <code class="literal">httpd</code> service to reload its configuration file. Any requests currently being processed will continue to use the old configuration.
						</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sec-apache-running-status"/>Verifying the Service Status</h2></div></div></div><p>
					To verify that the <code class="literal">httpd</code> service is running, type the following at a shell prompt:
				</p><pre class="literallayout">~]# systemctl is-active httpd.service
active</pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="editing-configuration-files_setting-apache-web-server"/>Editing the configuration files</h1></div></div></div><p>
				When the <code class="literal">httpd</code> service is started, by default, it reads the configuration from locations that are listed in <a class="xref" href="setting-apache-web-server_Deploying-different-types-of-servers.html#table-apache-editing-files" title="Table 1.2. The httpd service configuration files">Table 1.2, “The httpd service configuration files”</a>.
			</p><div class="table"><a id="table-apache-editing-files"/><p class="title"><strong>Table 1.2. The httpd service configuration files</strong></p><div class="table-contents"><table summary="The httpd service configuration files" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Path</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								<code class="literal">/etc/httpd/conf/httpd.conf</code>
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								The main configuration file.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								<code class="literal">/etc/httpd/conf.d/</code>
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								An auxiliary directory for configuration files that are included in the main configuration file.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								<code class="literal">/etc/httpd/conf.modules.d/</code>
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								An auxiliary directory for configuration files which load installed dynamic modules packaged in Red Hat Enterprise Linux. In the default configuration, these configuration files are processed first.
							</p>
							 </td></tr></tbody></table></div></div><p>
				Although, the default configuration is suitable for most situations, you can use also other configuration options. For any changes to take effect, restart the web server first. See <a class="xref" href="setting-apache-web-server_Deploying-different-types-of-servers.html#sec-apache-running-restarting" title="Restarting the service">the section called “Restarting the service”</a> for more information on how to restart the <code class="literal">httpd</code> service.
			</p><p>
				To check the configuration for possible errors, type the following at a shell prompt:
			</p><pre class="literallayout">~]# apachectl configtest
Syntax OK</pre><p>
				To make the recovery from mistakes easier, make a copy of the original file before editing it.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="working-with-modules_setting-apache-web-server"/>Working with modules</h1></div></div></div><p>
				Being a modular application, the <code class="literal">httpd</code> service is distributed along with a number of <span class="emphasis"><em>Dynamic Shared Objects</em></span> (<span class="strong"><strong>DSO</strong></span>s), which can be dynamically loaded or unloaded at runtime as necessary. These modules are located in the <code class="literal">/usr/lib64/httpd/modules/</code> directory.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sec-apache-dso-loading"/>Loading a module</h2></div></div></div><p>
					To load a particular DSO module, use the <code class="literal">LoadModule</code> directive. Note that modules provided by a separate package often have their own configuration file in the <code class="literal">/etc/httpd/conf.modules.d/</code> directory.
				</p><div class="example"><a id="example-apache-dso-loading"/><p class="title"><strong>Example 1.1. Loading the mod_ssl DSO</strong></p><div class="example-contents"><pre class="literallayout">LoadModule ssl_module modules/mod_ssl.so</pre></div></div><p>
					After loading the module, restart the web server to reload the configuration. See <a class="xref" href="setting-apache-web-server_Deploying-different-types-of-servers.html#sec-apache-running-restarting" title="Restarting the service">the section called “Restarting the service”</a> for more information on how to restart the <code class="literal">httpd</code> service.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sec-apache-dso-writing"/>Writing a module</h2></div></div></div><p>
					To create a new DSO module, make sure you have the <code class="literal">httpd-devel</code> package installed. To do so, enter the following command as <code class="literal">root</code>:
				</p><pre class="literallayout">~]# yum install httpd-devel</pre><p>
					This package contains the include files, the header files, and the <span class="strong"><strong><span class="application">APache eXtenSion</span></strong></span> (<code class="literal">apxs</code>) utility required to compile a module.
				</p><p>
					Once written, you can build the module with the following command:
				</p><pre class="literallayout">~]# apxs -i -a -c module_name.c</pre><p>
					If the build was successful, you should be able to load the module the same way as any other module that is distributed with the <span class="strong"><strong><span class="application">Apache HTTP Server</span></strong></span>.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="setting-up-virtual-hosts_setting-apache-web-server"/>Setting up virtual hosts</h1></div></div></div><p>
				The <span class="strong"><strong><span class="application">Apache HTTP Server’s</span></strong></span> built in virtual hosting allows the server to provide different information based on which IP address, host name, or port is being requested.
			</p><p>
				To create a name-based virtual host, copy the example configuration file <code class="literal">/usr/share/doc/httpd/httpd-vhosts.conf</code> into the <code class="literal">/etc/httpd/conf.d/</code> directory. Customize the options according to your requirements as shown in <a class="xref" href="setting-apache-web-server_Deploying-different-types-of-servers.html#example-apache-virtualhosts-config" title="Example 1.2. Example virtual host configuration">Example 1.2, “Example virtual host configuration”</a>.
			</p><div class="example"><a id="example-apache-virtualhosts-config"/><p class="title"><strong>Example 1.2. Example virtual host configuration</strong></p><div class="example-contents"><pre class="literallayout">&lt;VirtualHost *:80&gt;
    ServerAdmin <a class="link" href="mailto:webmaster@penguin.example.com">webmaster@penguin.example.com</a>
    DocumentRoot "/www/docs/penguin.example.com"
    ServerName penguin.example.com
    ServerAlias www.penguin.example.com
    ErrorLog "/var/log/httpd/dummy-host.example.com-error_log"
    CustomLog "/var/log/httpd/dummy-host.example.com-access_log" common
&lt;/VirtualHost&gt;</pre></div></div><p>
				Note that <code class="literal">ServerName</code> must be a valid DNS name assigned to the machine. The <code class="literal">&lt;VirtualHost&gt;</code> container is highly customizable, and accepts most of the directives available within the main server configuration. Directives that are <span class="strong"><strong>not</strong></span> supported within this container include <code class="literal">User</code> and <code class="literal">Group</code>, which were replaced by <code class="literal">SuexecUserGroup</code>.
			</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
					If you configure a virtual host to listen on a non-default port, make sure you update the <code class="literal">Listen</code> directive in the global settings section of the <code class="literal">/etc/httpd/conf/httpd.conf</code> file accordingly.
				</p></div><p>
				To activate a newly created virtual host, restart the web server first. See <a class="xref" href="setting-apache-web-server_Deploying-different-types-of-servers.html#sec-apache-running-restarting" title="Restarting the service">the section called “Restarting the service”</a> for more information on how to restart the <code class="literal">httpd</code> service.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="setting-up-ssl-server_setting-apache-web-server"/>Setting up an SSL server</h1></div></div></div><p>
				<span class="emphasis"><em>Secure Sockets Layer</em></span> (<span class="strong"><strong>SSL</strong></span>) is a cryptographic protocol that allows a server and a client to communicate securely. Along with its extended and improved version called <span class="emphasis"><em>Transport Layer Security</em></span> (<span class="strong"><strong>TLS</strong></span>), it ensures both privacy and data integrity. The <span class="strong"><strong><span class="application">Apache HTTP Server</span></strong></span> in combination with <code class="literal">mod_ssl</code>, a module that uses the OpenSSL toolkit to provide the SSL/TLS support, is commonly referred to as the <span class="emphasis"><em>SSL server</em></span>.
			</p><p>
				Unlike an HTTP connection that can be read and possibly modified by anybody who is able to intercept it, the use of SSL/TLS over HTTP, referred to as HTTPS, prevents any inspection or modification of the transmitted content. This section provides basic information on how to enable this module in the <span class="strong"><strong><span class="application">Apache HTTP Server</span></strong></span> configuration, and guides you through the process of generating private keys and self-signed certificates.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="overview-certificates-security_setting-apache-web-server"/>An overview of certificates and security</h2></div></div></div><p>
					Secure communication is based on the use of keys. In conventional or <span class="emphasis"><em>symmetric cryptography</em></span>, both ends of the transaction have the same key they can use to decode each other’s transmissions. On the other hand, in public or <span class="emphasis"><em>asymmetric cryptography</em></span>, two keys co-exist: a <span class="emphasis"><em>private key</em></span> that is kept a secret, and a <span class="emphasis"><em>public key</em></span> that is usually shared with the public. While the data encoded with the public key can only be decoded with the private key, data encoded with the private key can in turn only be decoded with the public key.
				</p><p>
					To provide secure communications using SSL, an SSL server must use a digital certificate signed by a <span class="emphasis"><em>Certificate Authority</em></span> (<span class="strong"><strong>CA</strong></span>). The certificate lists various attributes of the server (that is, the server host name, the name of the company, its location, etc.), and the signature produced using the CA’s private key. This signature ensures that a particular certificate authority has signed the certificate, and that the certificate has not been modified in any way.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="certificates-security-web-servers_setting-apache-web-server"/>Certificates and security for web servers</h2></div></div></div><p>
					When a web browser establishes a new SSL connection, it checks the certificate provided by the web server. If the certificate does not have a signature from a trusted CA, or if the host name listed in the certificate does not match the host name used to establish the connection, it refuses to communicate with the server and usually presents a user with an appropriate error message.
				</p><p>
					By default, most web browsers are configured to trust a set of widely used certificate authorities. Because of this, an appropriate CA should be chosen when setting up a secure server, so that target users can trust the connection, otherwise they will be presented with an error message, and will have to accept the certificate manually. Since encouraging users to override certificate errors can allow an attacker to intercept the connection, you should use a trusted CA whenever possible. For more information, see <a class="xref" href="setting-apache-web-server_Deploying-different-types-of-servers.html#table-apache-mod_ssl-certificates-authorities" title="Table 1.3. Information about CA lists used by common web browsers">Table 1.3, “Information about CA lists used by common web browsers”</a>.
				</p><div class="table"><a id="table-apache-mod_ssl-certificates-authorities"/><p class="title"><strong>Table 1.3. Information about CA lists used by common web browsers</strong></p><div class="table-contents"><table summary="Information about CA lists used by common web browsers" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Web Browser</th><th style="text-align: left" valign="top">Link</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="application">Mozilla Firefox</span></strong></span>
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									<a class="link" href="http://www.mozilla.org/projects/security/certs/included/">Mozilla root CA list</a>.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="application">Opera</span></strong></span>
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									<a class="link" href="http://www.opera.com/docs/ca/">Information on root certificates used by Opera</a>.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="application">Internet Explorer</span></strong></span>
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									<a class="link" href="http://support.microsoft.com/kb/931125">Information on root certificates used by Microsoft Windows</a>.
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									<span class="strong"><strong><span class="application">Chromium</span></strong></span>
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									<a class="link" href="http://www.chromium.org/Home/chromium-security/root-ca-policy">Information on root certificates used by the Chromium project</a>.
								</p>
								 </td></tr></tbody></table></div></div><p>
					When setting up an SSL server, generate a certificate request and a private key, and then send the certificate request, proof of the company’s identity, and payment to a certificate authority. Once the CA verifies the certificate request and your identity, it will send you a signed certificate you can use with your server. Alternatively, you can create a self-signed certificate that does not contain a CA signature, and thus should be used for testing purposes only.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="enabling-mod-ssl-module_setting-apache-web-server"/>Enabling the mod_ssl module</h1></div></div></div><p>
				If you intend to set up a TLS (SSL) server using <code class="literal">mod_ssl</code>, you <span class="strong"><strong>cannot</strong></span> have another application or module configured to use the same port. Port <code class="literal">443</code> is the default port for HTTPS.
			</p><p>
				To set up an SSL server using the <code class="literal">mod_ssl</code> module and the OpenSSL toolkit, install the <code class="literal">mod_ssl</code> and <code class="literal">openssl</code> packages. Enter the following command as <code class="literal">root</code>:
			</p><pre class="literallayout">~]# yum install mod_ssl openssl</pre><p>
				This will create the <code class="literal">mod_ssl</code> configuration file at <code class="literal">/etc/httpd/conf.d/ssl.conf</code>, which is included in the main <span class="strong"><strong><span class="application">Apache HTTP Server</span></strong></span> configuration file by default. For the module to be loaded, restart the <code class="literal">httpd</code> service as described in <a class="xref" href="setting-apache-web-server_Deploying-different-types-of-servers.html#sec-apache-running-restarting" title="Restarting the service">the section called “Restarting the service”</a>.
			</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					Implementations of the SSLv2 and SSLv3 protocol versions have been removed from OpenSSL (and hence <code class="literal">mod_ssl</code>) because these are no longer considered secure.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sec-apache-Enabling_and_Disabling_SSL_and_TLS_in_mod_ssl"/>Enabling different versions of TLS in mod_ssl</h2></div></div></div><p>
					The default <code class="literal">httpd</code> installation in RHEL 8 has the <code class="literal">SSLProtocol</code> directive commented out. Therefore, <code class="literal">httpd</code> will follow the system-wide cryptographic policy, and only TLS 1.2 and TLS 1.3 connections are allowed. See <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/security_hardening/index#using-the-system-wide-cryptographic-policies_security-hardening">Using system-wide cryptographic policies</a> for details.
				</p><p>
					Specific versions of the TLS protocol can be enabled or disabled either globally or per site:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							To specify protocol versions globally, add the <code class="literal">SSLProtocol</code> directive in the <span class="emphasis"><em>SSL Global Context</em></span> section of the configuration file and remove it everywhere else.
						</li><li class="listitem">
							To specify protocol version for one site, edit the default entry under <span class="emphasis"><em>SSL Protocol support</em></span> in the appropriate <span class="emphasis"><em>VirtualHost</em></span> sections. If you do not specify the protocol version in the per-site <span class="emphasis"><em>VirtualHost</em></span> section, the site will inherit the settings from the global section.
						</li></ul></div><p>
					To make sure that a particular protocol version is being enabled, the administrator should either <span class="strong"><strong>only</strong></span> specify <code class="literal">SSLProtocol</code> in the <span class="emphasis"><em>SSL Global Context</em></span> section, or specify it in <span class="strong"><strong>all</strong></span> per-site <span class="emphasis"><em>VirtualHost</em></span> sections.
				</p><p><a id="proc-Enagling-specific-versions-of-TLSv1_x"/></p><div class="title"><strong>Enabling specific versions of TLSv1.x</strong></div><p>
						To enable only specific TLSv1.x protocol versions, proceed as follows:
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							As <code class="literal">root</code>, open the <code class="literal">/etc/httpd/conf.d/ssl.conf</code> file and search for <span class="strong"><strong>all</strong></span> instances of <code class="literal">SSLProtocol</code> directive. By default the file contains one section that looks as follows:
						</p><pre class="literallayout">~]# vi /etc/httpd/conf.d/ssl.conf
#   List the protocol versions which clients are allowed to connect with.
#   The OpenSSL system profile is used by default.  See
#   update-crypto-policies(8) for more details.
#SSLProtocol all -SSLv3
#SSLProxyProtocol all -SSLv3</pre></li><li class="listitem"><p class="simpara">
							To set, for example, the TLS protocol to version 1.3, edit the <code class="literal">SSLProtocol</code> line as follows:
						</p><pre class="literallayout">SSLProtocol -all +TLSv1.3</pre><p class="simpara">
							Save and close the file.
						</p></li><li class="listitem"><p class="simpara">
							Verify the change as follows:
						</p><pre class="literallayout">~]# grep SSLProtocol /etc/httpd/conf.d/ssl.conf
<span class="strong"><strong>SSLProtocol</strong></span> -all +TLSv1.3</pre></li><li class="listitem"><p class="simpara">
							Restart the Apache daemon as follows:
						</p><pre class="literallayout">~]# systemctl restart httpd</pre><p class="simpara">
							Note that any sessions will be interrupted.
						</p></li></ol></div><p><a id="proc-testing_the_status_of_the_TLS_protocol"/></p><div class="title"><strong>Testing the status of the TLS protocol</strong></div><p>
						To check which versions of TLS are enabled or disabled, make use of the <code class="literal">openssl s_client -connect</code> command. The command has the following form:
					</p><pre class="literallayout">openssl s_client -connect <span class="emphasis"><em>hostname</em></span>:<span class="emphasis"><em>port</em></span> -<span class="emphasis"><em>protocol</em></span></pre><p>
					Where <span class="emphasis"><em>port</em></span> is the port to test and <span class="emphasis"><em>protocol</em></span> is the protocol version to test for. To test the SSL server running locally, use <code class="literal">localhost</code> as the host name.
				</p><p>
					The <code class="literal">openssl s_client</code> command options are documented in the <code class="literal">s_client(1)</code> manual page.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sec-apache-Automated-TLS-certificate_provisioning-and-renewal"/>Automated TLS certificate provisioning and renewal</h2></div></div></div><p>
					Automated TLS certificate provisioning and renewal using the Automatic Certificate Management Environment (ACME) protocol is now supported with the <code class="literal">mod_md</code> package (for use with certificate providers such as <span class="emphasis"><em>Let’s Encrypt</em></span>).
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="using-existing-key-and-certificate_setting-apache-web-server"/>Using an existing key and certificate</h1></div></div></div><p>
				If you have a previously created key and certificate, you can configure the SSL server to use these files instead of generating new ones. There are only two situations where this is not possible:
			</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						<span class="strong"><strong>You are changing the IP address or domain name.</strong></span>
					</p><p class="simpara">
						Certificates are issued for a particular IP address and domain name pair. If one of these values changes, the certificate becomes invalid.
					</p></li><li class="listitem"><p class="simpara">
						<span class="strong"><strong>You have a certificate from VeriSign, and you are changing the server software.</strong></span>
					</p><p class="simpara">
						VeriSign, a widely used certificate authority, issues certificates for a particular software product, IP address, and domain name. Changing the software product renders the certificate invalid.
					</p></li></ol></div><p>
				In either of the above cases, you will need to obtain a new certificate.
			</p><p>
				If you want to use an existing key and certificate, move the relevant files to the <code class="literal">/etc/pki/tls/private/</code> and <code class="literal">/etc/pki/tls/certs/</code> directories by issuing the following commands as <code class="literal">root</code>:
			</p><pre class="literallayout">~]# mv <code class="literal">key_file.key</code> <code class="literal">/etc/pki/tls/private/hostname.key</code>
~]# mv <code class="literal">certificate.crt</code> <code class="literal">/etc/pki/tls/certs/hostname.crt</code></pre><p>
				Then add the following lines to the <code class="literal">/etc/httpd/conf.d/ssl.conf</code> configuration file:
			</p><pre class="literallayout">SSLCertificateFile /etc/pki/tls/certs/<span class="emphasis"><em>hostname</em></span>.crt
SSLCertificateKeyFile /etc/pki/tls/private/<span class="emphasis"><em>hostname</em></span>.key</pre><p>
				To load the updated configuration, restart the <code class="literal">httpd</code> service as described in <a class="xref" href="setting-apache-web-server_Deploying-different-types-of-servers.html#sec-apache-running-restarting" title="Restarting the service">the section called “Restarting the service”</a>.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configure-firewall-for-http-and-https_setting-apache-web-server"/>Configure the firewall for HTTP and HTTPS using the command line</h1></div></div></div><p>
				Red Hat Enterprise Linux does not allow <code class="literal">HTTP</code> and <code class="literal">HTTPS</code> traffic by default. To enable the system to act as a web server, make use of <code class="literal">firewalld</code>'s supported services to enable <code class="literal">HTTP</code> and <code class="literal">HTTPS</code> traffic to pass through the firewall as required.
			</p><p>
				To enable <code class="literal">HTTP</code> using the command line, issue the following command as <code class="literal">root</code>:
			</p><pre class="literallayout">~]# firewall-cmd --add-service http
 success</pre><p>
				To enable <code class="literal">HTTPS</code> using the command line, issue the following command as <code class="literal">root</code>:
			</p><pre class="literallayout">~]# firewall-cmd --add-service https
 success</pre><p>
				Note that these changes does not persist after the next system start. To make permanent changes to the firewall, repeat the commands adding the <code class="literal">--permanent</code> option.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sec-Checking_Network_Access_for_Incoming_HTTP_and_HTTPS_CLI"/>Checking network access for incoming HTTPS and HTTPS using the command line</h2></div></div></div><p>
					To check what services the firewall is configured to allow, using the command line, issue the following command as <code class="literal">root</code>:
				</p><pre class="literallayout">~]# firewall-cmd --list-all
public (default, active)
  interfaces: em1
  sources:
  services: dhcpv6-client ssh
<span class="emphasis"><em>output truncated</em></span></pre><p>
					In this example taken from a default installation, the firewall is enabled but <code class="literal">HTTP</code> and <code class="literal">HTTPS</code> have not been allowed to pass through.
				</p><p>
					Once the <code class="literal">HTTP</code> and <code class="literal">HTTP</code> firewall services are enabled, the <code class="literal">services</code> line will appear similar to the following:
				</p><pre class="literallayout">services: dhcpv6-client http https ssh</pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="apache-additional-resources_setting-apache-web-server"/>Additional resources</h1></div></div></div><p>
				To learn more about the <span class="strong"><strong><span class="application">Apache HTTP Server</span></strong></span>, see the following resources.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sec-The_Apache_HTTP_Server-Installed_Documentation"/>Installed documentation</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">httpd(8)</code> — The manual page for the <code class="literal">httpd</code> service containing the complete list of its command-line options.
						</li><li class="listitem">
							<code class="literal">httpd.service(8)</code> — The manual page for the <code class="literal">httpd.service</code> unit file, describing how to customize and enhance the service.
						</li><li class="listitem">
							<code class="literal">httpd.conf(5)</code> — The manual page for <code class="literal">httpd</code> configuration, describing the structure and location of the <code class="literal">httpd</code> configuration files.
						</li><li class="listitem">
							<code class="literal">apachectl(8)</code> — The manual page for the <span class="strong"><strong><span class="application">Apache HTTP Server</span></strong></span> Control Interface.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sec-The_Apache_HTTP_Server-Installable_Documentation"/>Installable documentation</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							<a class="link" href="http://localhost/manual/">http://localhost/manual/</a> — The official documentation for the <span class="strong"><strong><span class="application">Apache HTTP Server</span></strong></span> with the full description of its directives and available modules. Note that in order to access this documentation, you must have the <code class="literal">httpd-manual</code> package installed, and the web server must be running.
						</p><p class="simpara">
							Before accessing the documentation, issue the following commands as <code class="literal">root</code>:
						</p><pre class="literallayout">~]# yum install httpd-manual
~]# apachectl graceful</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sec-The_Apache_HTTP_Server-Online_Documentation"/>Online documentation</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="link" href="http://httpd.apache.org/">http://httpd.apache.org/</a> — The official website for the <span class="strong"><strong><span class="application">Apache HTTP Server</span></strong></span> with documentation on all the directives and default modules.
						</li><li class="listitem">
							<a class="link" href="http://www.openssl.org/">http://www.openssl.org/</a> — The OpenSSL home page containing further documentation, frequently asked questions, links to the mailing lists, and other useful resources.
						</li></ul></div></div></div></div></body></html>