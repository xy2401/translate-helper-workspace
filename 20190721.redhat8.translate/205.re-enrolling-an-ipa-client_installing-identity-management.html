<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 重新注册Identity Management客户端</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 重新注册Identity Management客户端</h1></div></div></div><p>如果客户端虚拟机已被销毁且与Identity Management（IdM）服务器断开连接（例如，由于客户端的硬件故障），并且您仍具有其密钥表，则可以重新注册客户端。在这种情况下，您希望使用相同的主机名将客户端返回到IdM环境中。
			</p><p>在重新注册期间，客户端生成新证书，但LDAP数据库中客户端的标识保持不变。重新注册后，在机器与IdM服务器失去连接之前，主机将其密钥和其他信息放在同一个LDAP对象中，并使用与之前相同的<code class="literal">fqdn</code> 。
			</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>您只能重新注册其域条目仍处于活动状态的客户端。如果卸载了客户端（使用<code class="literal">ipa-client-install --uninstall</code> ）或禁用了其主机条目（使用<code class="literal">ipa host-disable</code> ），则无法重新注册它。
				</p></div><p>重命名后，您无法重新注册客户端。这是因为在Identity Management中，LDAP中客户端条目的关键属性是客户端的主机名，即<code class="literal">fqdn</code> 。与重新注册客户端相反，在此期间客户端的LDAP对象保持不变，重命名客户端的结果是客户端将其密钥和其他信息放在具有新fqdn的不同LDAP对象中。因此，重命名客户端的唯一方法是从IdM卸载主机，更改主机的主机名，并将其安装为具有新名称的IdM客户端。有关如何重命名客户端的详细信息，请参阅<a class="xref" href="renaming-ipa-client-systems_installing-identity-management.html" title="Chapter 9. 重命名Identity Management客户端系统">第13章， <em>重命名Identity Management客户端系统</em></a> 。
			</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="what-happens-during-client-re-enrollment_installing-identity-management"></a>在客户重新注册期间会发生什么</h1></div></div></div><p>在重新注册期间，身份管理：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">撤消原始主机证书</li><li class="listitem">生成新的主机证书</li><li class="listitem">创建新的SSH密钥</li><li class="listitem">生成新的密钥表</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="re-enrolling-a-client-by-using-user-credentials-interactive-re-enrollment_installing-identity-management"></a>使用用户凭据重新注册客户端：交互式重新注册</h1></div></div></div><p>此过程描述了使用授权用户的凭据以交互方式重新注册Identity Management客户端。
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">使用相同的主机名重新创建客户端计算机。
						</li><li class="listitem"><p class="simpara">在客户端计算机上运行<code class="literal">ipa-client-install --force-join</code>命令：</p><pre class="literallayout"># <span class="strong"><strong>ipa-client-install --force-join</strong></span></pre></li><li class="listitem"><p class="simpara">该脚本会提示用户的身份将用于重新注册客户端。例如，这可能是具有注册管理员角色的<code class="literal">hostadmin</code>用户：</p><pre class="literallayout">User authorized to enroll computers: <code class="literal">hostadmin</code>
Password for <code class="literal">hostadmin</code>@<code class="literal">EXAMPLE.COM</code>:</pre></li></ol></div><h3><a id="additional_resources_10"></a>其他资源</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关使用授权用户的凭据注册客户端的更详细过程，请参阅<a class="xref" href="installing-an-ipa-client-basic-scenario_installing-identity-management.html#installing-client-basic-installing-a-client-by-using-user-credentials-interactive-installation" title="使用用户凭据安装客户端：交互式安装">“使用用户凭据安装客户端：交互式安装”一节</a> 。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="re-enrolling-idm-client-using-keytab-non-interactive_installing-identity-management"></a>使用客户端密钥表重新注册客户端：非交互式重新注册</h1></div></div></div><h3><a id="prerequisites_8"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">备份原始客户机密钥表文件，例如在<code class="literal">/tmp</code>或<code class="literal">/root</code>目录中。
						</li></ul></div><h3><a id="procedure_15"></a>程序</h3><p>此过程描述了使用客户端系统的keytab以非交互方式重新注册Identity Management客户端。例如，使用客户端密钥表重新注册适用于自动安装。
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">使用相同的主机名重新创建客户端计算机。
						</li><li class="listitem">将keytab文件从备份位置复制到重新创建的客户端计算机上的<code class="literal">/etc/</code>目录。
						</li><li class="listitem"><p class="simpara">使用<code class="literal">ipa-client-install</code>实用程序重新注册客户端，并使用<code class="literal">--keytab</code>选项指定keytab位置：</p><pre class="literallayout"># <span class="strong"><strong>ipa-client-install --keytab /etc/krb5.keytab</strong></span></pre><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p><code class="literal">--keytab</code>选项中指定的keytab仅在进行身份验证以启动注册时使用。在重新注册期间，IdM为客户端生成新的密钥表。
							</p></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="testing-an-ipa-client-re-enrolling-client"></a>测试Identity Management客户端</h1></div></div></div><p>命令行界面通知您<code class="literal">ipa-client-install</code>成功，但您也可以进行自己的测试。</p><p>要测试Identity Management客户端是否可以获取有关在服务器上定义的用户的信息，请检查您是否能够解析在服务器上定义的用户。例如，要检查默认<code class="literal">admin</code>用户：</p><pre class="literallayout">[user@client ~]$ <span class="strong"><strong>id admin</strong></span>
uid=1254400000(admin) gid=1254400000(admins) groups=1254400000(admins)</pre><p>要测试身份验证是否正常工作，请从非root用户<code class="literal">su</code>到root用户：</p><pre class="literallayout">[user@client ~]$ <span class="strong"><strong>su -</strong></span>
Last login: Thu Oct 18 18:39:11 CEST 2018 from 192.168.122.1 on pts/0
[root@client ~]#</pre></div></div></body></html>