<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 使用nmcli配置网络</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 使用nmcli配置网络</h1></div></div></div><p>以下部分提供了如何使用<span class="strong"><strong><span class="application">nmcli</span></strong></span>配置网络接口。
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Getting-started-with-nmcli_Configuring-Networking-with-nmcli"></a> nmcli入门</h1></div></div></div><p>
				<span class="strong"><strong><span class="application">nmcli</span></strong></span> （NetworkManager命令行界面）是用于通过<span class="strong"><strong>NetworkManager</strong></span>配置网络的命令行实用程序。 <span class="strong"><strong><span class="application">nmcli</span></strong></span>用于创建，显示，编辑，删除，激活和停用网络连接，以及控制和显示网络设备状态。
			</p><p>用户和脚本都可以使用<span class="strong"><strong><span class="application">nmcli</span></strong></span>实用程序：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">对于服务器，无头机器和终端， <span class="strong"><strong><span class="application">nmcli</span></strong></span>可用于直接控制<span class="strong"><strong><span class="application">NetworkManager</span></strong></span> ，无需GUI。</li><li class="listitem">对于脚本， <span class="strong"><strong><span class="application">nmcli</span></strong></span>支持将输出更改为更适合脚本处理的格式的选项。
					</li></ul></div><p>每个网络设备对应一个<span class="strong"><strong><span class="application">NetworkManager</span></strong></span>设备。网络设备的配置完全存储在单个<span class="strong"><strong>NetworkManager</strong></span>连接中。您可以执行将<span class="strong"><strong>NetworkManager</strong></span>连接应用于<span class="strong"><strong>NetworkManager</strong></span>设备的网络配置。
			</p><p>要开始使用<span class="strong"><strong>nmcli</strong></span> ，最常见的<span class="strong"><strong>nmcli</strong></span>命令是<code class="literal">nmcli device</code>和<code class="literal">nmcli connection</code> ：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">nmcli device</code>命令列出系统中的可用网络设备。
					</li></ul></div><p>设备可以是：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
						<code class="literal">managed</code> - 在<span class="strong"><strong>NetworkManager</strong></span>控件下。可以<code class="literal">connected</code> <code class="literal">managed</code>设备，这意味着它被激活和配置或<code class="literal">disconnected</code> ，这意味着它未配置但准备再次激活。
					</li><li class="listitem">
						<code class="literal">unmanaged</code> - <span class="strong"><strong>NetworkManager</strong></span>不控制它。
					</li></ol></div><p>有关设置<code class="literal">managed</code>或非<code class="literal">unmanaged</code>设备的更多详细信息，请参阅<a class="xref" href="Configuring-Networking-with-nmcli_configuring-and-managing-networking.html#Setting-a-device-managed-or-unmanaged-with-nmcli_Configuring-Networking-with-nmcli" title="Setting a device managed or unmanaged with nmcli">“使用nmcli</a>设置<code class="literal">managed</code>或不<code class="literal">unmanaged</code>设备<a class="xref" href="Configuring-Networking-with-nmcli_configuring-and-managing-networking.html#Setting-a-device-managed-or-unmanaged-with-nmcli_Configuring-Networking-with-nmcli" title="使用nmcli设置托管或非托管的设备">”一节</a> 。
			</p><p><code class="literal">nmcli device</code>命令可以采用许多参数。最值得注意的是： <code class="literal">status</code> ， <code class="literal">show</code> ， <code class="literal">set</code> ， <code class="literal">connect</code> ， <code class="literal">disconnect</code> ， <code class="literal">modify</code> ， <code class="literal">delete</code> ， <code class="literal">wifi</code> 。输入<code class="literal">nmcli device help</code>命令以查看完整列表。
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">nmcli connection</code>命令列出<span class="strong"><strong>NetworkManager</strong></span>中的可用连接配置文件。
					</li></ul></div><p>每个处于活动状态的连接都会在列表顶部显示为绿色。非活动连接显示为白色。DEVICE字段标识应用连接的设备。
			</p><p><code class="literal">nmcli connection</code>命令可以使用许多参数来管理连接配置文件。最值得注意的是： <code class="literal">show</code> ， <code class="literal">up</code> ， <code class="literal">down</code> ， <code class="literal">add</code> ， <code class="literal">modify</code> ， <code class="literal">delete</code> 。输入<code class="literal">nmcli connection help</code>命令以查看完整列表。
			</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>如果使用<span class="strong"><strong>nmcli</strong></span>命令，建议键入partial <span class="strong"><strong>nmcli</strong></span>命令，然后按<span class="keycap"><strong>Tab</strong></span>键自动完成命令序列。如果可以进行多次完成，则<span class="keycap"><strong>Tab</strong></span>会将它们全部列出。这有助于用户更快，更轻松地键入命令。要启用<span class="strong"><strong>nmcli</strong></span>自动完成功能，请确保安装<code class="literal">bash-completion</code>包：</p><pre class="literallayout">~]# yum install bash-completion</pre><p>软件包安装后，下次登录控制台时将提供<code class="literal">nmcli auto-complete</code> 。要在当前控制台中激活它，请输入：</p><pre class="literallayout">~]$ source /etc/profile.d/bash_completion.sh</pre></div><p>使用<span class="strong"><strong>nmcli</strong></span>的基本格式是：</p><pre class="literallayout">nmcli [OPTIONS] OBJECT { COMMAND | help }</pre><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">其中[OPTIONS]可以是可选选项，例如：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-t，简洁</span></dt><dd><p class="simpara">此模式可用于计算机脚本处理，因为您可以看到仅显示值的简洁输出。
								</p><div class="example"><a id="ex-Viewing_a_terse_output_for_scripts"></a><p class="title"><strong>例6.1。查看简洁的输出</strong></p><div class="example-contents"><pre class="literallayout">~]$ <code class="literal">nmcli -t device</code>
ens3:ethernet:connected:Profile 1
lo:loopback:unmanaged:</pre></div></div></dd><dt><span class="term">-f，田野</span></dt><dd><p class="simpara">此选项指定可在输出中显示的字段。例如，NAME，UUID，TYPE，AUTOCONNECT，ACTIVE，DEVICE，STATE。您可以使用一个或多个字段。如果要使用更多，请不要在逗号后使用空格来分隔字段。
								</p><div class="example"><a id="ex-Specifying_Fields_in_the_output"></a><p class="title"><strong>例6.2。在输出中指定字段</strong></p><div class="example-contents"><pre class="literallayout">~]$ <code class="literal">nmcli -f DEVICE,TYPE device</code>
DEVICE  TYPE
ens3    ethernet
lo      loopback</pre><p>甚至更好的脚本：</p><pre class="literallayout">~]$ <code class="literal">nmcli -t -f DEVICE,TYPE device</code>
ens3:ethernet
lo:loopback</pre></div></div></dd><dt><span class="term">-p，漂亮</span></dt><dd><p class="simpara">此选项使<span class="strong"><strong><span class="application">nmcli</span></strong></span>生成人类可读的输出。例如，对齐值并打印标题。
								</p><div class="example"><a id="ex-Viewing_an_output_in_pretty_Mode"></a><p class="title"><strong>例6.3。以漂亮模式查看输出</strong></p><div class="example-contents"><pre class="literallayout">~]$ <code class="literal">nmcli -p device</code>
=====================
  Status of devices
=====================
DEVICE  TYPE      STATE      CONNECTION
--------------------------------------------------------------
ens3    ethernet  connected  Profile 1
lo      loopback  unmanaged  --</pre></div></div></dd><dt><span class="term">-h，帮忙</span></dt><dd>打印帮助信息。
								</dd></dl></div></li><li class="listitem">其中OBJECT可以是以下选项之一： <code class="literal">general</code> ， <code class="literal">networking</code> ， <code class="literal">radio</code> ， <code class="literal">connection</code> ， <code class="literal">device</code> ， <code class="literal">agent</code>和<code class="literal">monitor</code> 。
					</li></ul></div><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>您可以在命令中使用上述选项的任何前缀。例如， <code class="literal">nmcli con help</code> ， <code class="literal">nmcli c help</code> ， <code class="literal">nmcli connection help</code>生成相同的输出。
				</p></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">其中COMMAND，所需的<span class="strong"><strong>nmcli</strong></span>命令。
					</li><li class="listitem"><span class="emphasis"><em>帮助</em></span>是列出与指定对象相关的可用操作：</li></ul></div><pre class="literallayout">~]$ <code class="literal">nmcli <span class="emphasis"><em>OBJECT</em></span> help</code></pre><p>例如，</p><pre class="literallayout">~]$ <code class="literal">nmcli c help</code></pre><h3><a id="additional_resources_10"></a>其他资源</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<a class="xref" href="getting-started-with-managing-networking-with-NetworkManager_configuring-and-managing-networking.html#NetworkManager-tools_getting-started-with-networking-devices-with-NetworkManager" title="NetworkManager工具">名为“NetworkManager工具”的部分</a>
					</li><li class="listitem"><span class="emphasis"><em><span class="citetitle"><span class="strong"><strong>nmcli</strong></span> （1）</span></em></span>手册页。
					</li><li class="listitem">
						<a class="xref" href="Configuring-Networking-with-nmcli_configuring-and-managing-networking.html#Brief-Selection-of-nmcli-commands_Configuring-Networking-with-nmcli" title="简要选择nmcli命令">“ <span class="strong"><strong>nmcli</strong></span>命令的简要选择”一节</a>
					</li><li class="listitem">
						<a class="xref" href="Configuring-Networking-with-nmcli_configuring-and-managing-networking.html#Creating-a-connection-profile-with-nmcli_Configuring-Networking-with-nmcli" title="使用nmcli创建连接配置文件">“使用nmcli创建连接配置文件”一节</a>
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Overview-of-nmcli-property-names-and-aliases_Configuring-Networking-with-nmcli"></a> nmcli属性名称和别名概述</h1></div></div></div><h3><a id="prerequisites_5"></a>先决条件</h3><p>
				<code class="literal">Property</code>名称是<span class="strong"><strong>NetworkManager</strong></span>用于标识公共选项的特定名称。以下是一些重要的<span class="strong"><strong><span class="application">nmcli</span></strong></span> <code class="literal">property</code>名称：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">连接类型</code></span></dt><dd>一种特定的连接。允许的值为： <span class="strong"><strong>adsl，bond，bond-slave，bridge，bridge-slave，bluetooth，cdma，ethernet，gsm，infiniband，olpc-mesh，team，team-slave，vlan，wifi，wimax</strong></span> 。每种连接类型都有特定于类型的命令选项。您可以在<span class="emphasis"><em><span class="citetitle"><span class="strong"><strong>nmcli</strong></span> （1）</span></em></span>手册页中看到<code class="literal">TYPE_SPECIFIC_OPTIONS</code>列表。例如， <code class="literal">gsm</code>连接需要在<code class="literal">apn</code>指定的访问点名称。<code class="literal">wifi</code>设备需要<code class="literal">ssid</code>指定的服务集标识符。
						</dd><dt><span class="term"><code class="literal">connection.interface名</code></span></dt><dd>与连接相关的设备名称。例如， <span class="emphasis"><em>eth0</em></span> 。
						</dd><dt><span class="term"><code class="literal">connection.id</code></span></dt><dd><p class="simpara">用于连接配置文件的名称。如果未指定连接名称，将生成如下连接名称：</p><pre class="literallayout"><span class="emphasis"><em>connection.type -connection.interface-name</em></span></pre><p class="simpara"><code class="literal">connection.id</code>是<span class="emphasis"><em>连接配置文件</em></span>的名称，不应与表示设备的接口名称（ <code class="literal">wlan0</code> ， <code class="literal">ens3</code> ， <code class="literal">em1</code> ） <code class="literal">ens3</code> 。但是，用户可以在接口之后命名连接，但它们不是同一个东西。可以为设备提供多个连接配置文件。这对于移动设备或在不同设备之间来回切换网络电缆特别有用。而不是编辑配置，创建不同的配置文件并根据需要将它们应用于界面。<code class="literal">id</code>选项还引用连接配置文件名称。
						</p></dd></dl></div><p><span class="strong"><strong><span class="application">nmcli</span></strong></span>命令最重要的选项，如<code class="literal">show</code> ， <code class="literal">up</code> ， <code class="literal">down</code>是：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">ID</code></span></dt><dd>用户分配给连接配置文件的标识字符串。可以在<span class="strong"><strong>nmcli</strong></span>连接命令中使用Id来标识连接。命令输出中的NAME字段始终表示连接ID。它引用了con-name所使用的相同连接配置文件名称。
						</dd><dt><span class="term"><code class="literal">UUID</code></span></dt><dd>系统为连接配置文件分配的唯一标识字符串。可以在<code class="literal">nmcli connection</code>命令中使用<code class="literal">uuid</code>来标识连接。
						</dd></dl></div><p><a id="tabl-Aliases-and-property-names"></a></p><div class="title"><strong>别名和属性名称</strong></div><p><code class="literal">alias</code>是<code class="literal">property</code>名称的替代名称 - 别名在<span class="strong"><strong>nmcli</strong></span>内部转换为属性。<code class="literal">Aliases</code>更具可读性，但最好使用<code class="literal">property names</code> 。两者都可以互换使用。
				</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"><col class="col_4"><col class="col_5"></colgroup><thead><tr><th valign="top" style="text-align:left">别号</th><th valign="top" style="text-align:left">例</th><th valign="top" style="text-align:left">属性</th><th valign="top" style="text-align:left">例</th><th valign="top" style="text-align:left">定义</th></tr></thead><tbody><tr><td valign="top" style="text-align:left"> <p>类型</p>
							 </td><td valign="top" style="text-align:left"> <p>
								<span class="strong"><strong>键入</strong></span> <span class="emphasis"><em>债券</em></span>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>连接类型</p>
							 </td><td valign="top" style="text-align:left"> <p>
								<span class="strong"><strong>connection.type</strong></span> <span class="emphasis"><em>bond</em></span>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>特定连接的类型。一些连接类型是： <span class="strong"><strong>bond，bridge，ethernet，wifi，infiniband，vlan</strong></span>
							</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>IFNAME</p>
							 </td><td valign="top" style="text-align:left"> <p>
								<span class="strong"><strong>ifname</strong></span> <span class="emphasis"><em>eth0</em></span>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>connection.interface名</p>
							 </td><td valign="top" style="text-align:left"> <p>
								<span class="strong"><strong>connection.interface-name</strong></span> <span class="emphasis"><em>eth0</em></span>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>连接所属的设备的名称</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>CON-名</p>
							 </td><td valign="top" style="text-align:left"> <p>
								<span class="strong"><strong>同名</strong></span> <span class="emphasis"><em>“我的联系人”</em></span>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>connection.id</p>
							 </td><td valign="top" style="text-align:left"> <p>
								<span class="strong"><strong>connection.id</strong></span> <span class="emphasis"><em>“我的连接”</em></span>
							</p>
							 </td><td valign="top" style="text-align:left"> <p>连接的名称</p>
							 </td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Brief-Selection-of-nmcli-commands_Configuring-Networking-with-nmcli"></a>简要选择<span class="strong"><strong>nmcli</strong></span>命令</h1></div></div></div><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>如果使用<span class="strong"><strong>nmcli</strong></span>命令，建议键入partial <span class="strong"><strong>nmcli</strong></span>命令，然后按<span class="keycap"><strong>Tab</strong></span>键自动完成命令序列。如果可以进行多次完成，则<span class="keycap"><strong>Tab</strong></span>会将它们全部列出。这有助于用户更快，更轻松地键入命令。要启用<span class="strong"><strong>nmcli</strong></span>自动完成功能，请确保安装<code class="literal">bash-completion</code>包：</p><pre class="literallayout">~]# yum install bash-completion</pre><p>软件包安装后，下次登录控制台时将提供<code class="literal">nmcli auto-complete</code> 。要在当前控制台中激活它，请输入：</p><pre class="literallayout">~]$ source /etc/profile.d/bash_completion.sh</pre></div><p>以下示例显示如何在特定用例中使用<span class="strong"><strong><span class="application">nmcli</span></strong></span> ：</p><div class="example"><a id="idm139932819182304"></a><p class="title"><strong>例6.4。查看所有连接</strong></p><div class="example-contents"><pre class="literallayout">~]$ <code class="literal">nmcli connection show</code>
  NAME       UUID                                  TYPE      DEVICE
Profile 1  db1060e9-c164-476f-b2b5-caec62dc1b05  ethernet    ens3
bond0       aaf6eb56-73e5-4746-9037-eed42caa8a65  ethernet    --</pre></div></div><div class="example"><a id="idm139932819179600"></a><p class="title"><strong>例6.5。仅查看当前活动的连接</strong></p><div class="example-contents"><pre class="literallayout">~]$ <code class="literal">nmcli connection show --active</code>
  NAME       UUID                                  TYPE      DEVICE
Profile 1  db1060e9-c164-476f-b2b5-caec62dc1b05  ethernet     ens3</pre></div></div><div class="example"><a id="idm139932819177024"></a><p class="title"><strong>例6.6。激活连接</strong></p><div class="example-contents"><p>使用<span class="strong"><strong>up</strong></span>参数激活连接。
				</p><pre class="literallayout">~]$ <code class="literal">nmcli connection show</code>
  NAME       UUID                                  TYPE      DEVICE
Profile 1  db1060e9-c164-476f-b2b5-caec62dc1b05  ethernet    ens3
bond0       aaf6eb56-73e5-4746-9037-eed42caa8a65  ethernet    --</pre><pre class="literallayout">~]$ <code class="literal">nmcli connection up id <span class="emphasis"><em>bond0</em></span></code>
Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/4)</pre><pre class="literallayout">~]$ <code class="literal">nmcli connection show</code>
NAME       UUID                                  TYPE      DEVICE
Profile 1  db1060e9-c164-476f-b2b5-caec62dc1b05  ethernet    ens3
bond0       aaf6eb56-73e5-4746-9037-eed42caa8a65  ethernet   bond0</pre></div></div><div class="example"><a id="idm139932819169360"></a><p class="title"><strong>例6.7。停用特定的活动连接</strong></p><div class="example-contents"><p>使用<span class="strong"><strong>down</strong></span>参数可以停用特定的活动连接：</p><pre class="literallayout">~]$ <code class="literal">nmcli connection down id <span class="emphasis"><em>bond0</em></span></code></pre><pre class="literallayout">~]$ <code class="literal">nmcli connection show</code>
  NAME       UUID                                  TYPE      DEVICE
Profile 1  db1060e9-c164-476f-b2b5-caec62dc1b05  ethernet    ens3
bond0      aaf6eb56-73e5-4746-9037-eed42caa8a65  ethernet    --</pre></div></div><div class="example"><a id="idm139932819163760"></a><p class="title"><strong>例6.8。断开设备连接，防止设备再次自动启动</strong></p><div class="example-contents"><pre class="literallayout">~]$ <code class="literal">nmcli device disconnect id <span class="emphasis"><em>bond0</em></span></code></pre></div></div><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p><code class="literal">nmcli connection down</code>命令用于停用设备的连接，而不会阻止设备进一步自动激活。<code class="literal">nmcli device disconnect</code>命令，断开<code class="literal">nmcli device disconnect</code>并防止设备自动激活更多连接，无需人工干预。如果连接将<code class="literal">connection.autoconnect</code>标志设置为<code class="literal">yes</code> ，则连接将再次自动在断开连接的设备上启动。在这种情况下，请使用<code class="literal">nmcli device disconnect</code>命令而不是<code class="literal">nmcli connection down</code>命令。
				</p></div><div class="example"><a id="idm139932819155104"></a><p class="title"><strong>例6.9。仅查看<span class="strong"><span class="application">NetworkManager</span></span>识别的设备及其状态</strong></p><div class="example-contents"><pre class="literallayout">~]$ <code class="literal">nmcli device status</code>
DEVICE  TYPE      STATE      CONNECTION
ens3    ethernet  connected  Profile 1
lo      loopback  unmanaged  --</pre></div></div><div class="example"><a id="idm139932723646528"></a><p class="title"><strong>例6.10。查看设备的常规信息</strong></p><div class="example-contents"><pre class="literallayout">~]$ <code class="literal">nmcli device show</code>
GENERAL.DEVICE:                         ens3
GENERAL.TYPE:                           ethernet
GENERAL.HWADDR:                         52:54:00:0A:2F:ED
GENERAL.MTU:                            1500
GENERAL.STATE:                          100 (connected)
GENERAL.CONNECTION:                     ens3
[...]</pre></div></div><div class="example"><a id="idm139932723643744"></a><p class="title"><strong>例6.11。检查<span class="strong">NetworkManager</span>的整体状态</strong></p><div class="example-contents"><pre class="literallayout">~]$ <code class="literal">nmcli general status</code>
STATE      CONNECTIVITY  WIFI-HW  WIFI     WWAN-HW  WWAN
connected  full          enabled  enabled  enabled  enabled</pre><p>在简洁模式：</p><pre class="literallayout">~]$ <code class="literal">nmcli -t -f STATE general</code>
connected</pre></div></div><div class="example"><a id="idm139932723638544"></a><p class="title"><strong>例6.12。查看NetworkManager日志记录状态</strong></p><div class="example-contents"><pre class="literallayout">~]$ <code class="literal">nmcli general logging</code>
  LEVEL  DOMAINS
  INFO   PLATFORM,RFKILL,ETHER,WIFI,BT,MB,DHCP4,DHCP6,PPP,WIFI_SCAN,IP4,IP6,A
UTOIP4,DNS,VPN,SHARING,SUPPLICANT,AGENTS,SETTINGS,SUSPEND,CORE,DEVICE,OLPC,
WIMAX,INFINIBAND,FIREWALL,ADSL,BOND,VLAN,BRIDGE,DBUS_PROPS,TEAM,CONCHECK,DC
B,DISPATCH</pre></div></div><p>您还可以使用<span class="strong"><strong><span class="application">nmcli</span></strong></span>命令的以下缩写：</p><div class="table"><a id="tabl-nmcli_examples"></a><p class="title"><strong>表6.1。某些nmcli命令的缩写</strong></p><div class="table-contents"><table border="1" summary="Abbreviations of some nmcli commands"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th valign="top" style="text-align:left">nmcli命令</th><th valign="top" style="text-align:left">缩写</th></tr></thead><tbody><tr><td valign="top" style="text-align:left"> <p>nmcli一般状态</p>
							 </td><td valign="top" style="text-align:left"> <p>nmcli g</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>nmcli一般日志记录</p>
							 </td><td valign="top" style="text-align:left"> <p>nmcli g log</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>nmcli连接显示</p>
							 </td><td valign="top" style="text-align:left"> <p>nmcli con show或nmcli c</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>nmcli连接显示 - 活动</p>
							 </td><td valign="top" style="text-align:left"> <p>nmcli con show -a或nmcli c -a</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>nmcli设备状态</p>
							 </td><td valign="top" style="text-align:left"> <p>nmcli dev或nmcli d</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>nmcli设备展示</p>
							 </td><td valign="top" style="text-align:left"> <p>nmcli dev show或nmcli d显示</p>
							 </td></tr></tbody></table></div></div><h3><a id="additional_resources_11"></a>其他资源</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关<span class="strong"><strong>nmcli</strong></span>选项综合列表的更多信息，请参见<span class="emphasis"><em><span class="citetitle"><span class="strong"><strong>nmcli</strong></span> （1）</span></em></span>手册页。
					</li><li class="listitem">有关更多示例，请参见<span class="emphasis"><em><span class="citetitle"><span class="strong"><strong>nmcli-examples</strong></span> （5）</span></em></span>手册页。
					</li><li class="listitem">
						<a class="xref" href="Configuring-Networking-with-nmcli_configuring-and-managing-networking.html#Creating-a-connection-profile-with-nmcli_Configuring-Networking-with-nmcli" title="使用nmcli创建连接配置文件">“使用nmcli创建连接配置文件”一节</a>
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Setting-a-device-managed-or-unmanaged-with-nmcli_Configuring-Networking-with-nmcli"></a>使用nmcli设置托管或非托管的设备</h1></div></div></div><h3><a id="prerequisites_6"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<a class="xref" href="Configuring-Networking-with-nmcli_configuring-and-managing-networking.html#Getting-started-with-nmcli_Configuring-Networking-with-nmcli" title="nmcli入门">“nmcli入门”一节</a>
					</li><li class="listitem">
						<a class="xref" href="Configuring-Networking-with-nmcli_configuring-and-managing-networking.html#Overview-of-nmcli-property-names-and-aliases_Configuring-Networking-with-nmcli" title="nmcli属性名称和别名概述">名为“nmcli属性名称和别名概述”的部分</a>
					</li></ul></div><h3><a id="procedure_4"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">列出当前可用的网络连接：</p><pre class="literallayout">~]$ <code class="literal">nmcli con show</code>
NAME              UUID                                  TYPE            DEVICE
Auto Ethernet     9b7f2511-5432-40ae-b091-af2457dfd988  802-3-ethernet  --
ens3              fb157a65-ad32-47ed-858c-102a48e064a2  802-3-ethernet  ens3
MyWiFi            91451385-4eb8-4080-8b82-720aab8328dd  802-11-wireless wlan0</pre><p class="simpara">请注意，输出中的<code class="literal">NAME</code>字段始终表示<span class="strong"><strong>连接ID</strong></span> （名称）。它不是接口名称，即使它看起来可能相同。在上面显示的第二个连接中， <code class="literal">NAME</code>字段中的<span class="emphasis"><em>ens3</em></span>是用户给应用于接口<span class="emphasis"><em>ens3</em></span>的配置文件的<span class="strong"><strong>连接ID</strong></span> 。在所示的最后一个连接中，用户已将连接ID <span class="emphasis"><em>MyWiFi</em></span>分配给接口<span class="emphasis"><em>wlan0</em></span> 。
					</p><p class="simpara">添加以太网连接意味着创建配置配置文件，然后将其分配给设备。在创建新配置文件之前，请按以下方式查看可用设备：</p><pre class="literallayout">~]$ <code class="literal">nmcli device status</code>
DEVICE  TYPE      STATE         CONNECTION
ens3    ethernet  disconnected  --
ens9    ethernet  disconnected  --
lo      loopback  unmanaged     --</pre></li><li class="listitem"><p class="simpara">要将设备设置为不受<span class="strong"><strong><span class="application">NetworkManager管理</span></strong></span> ：</p><pre class="literallayout">~]$ <code class="literal">nmcli device set <span class="emphasis"><em>ifname</em></span> managed no</code></pre></li></ol></div><p>例如，要设置<span class="emphasis"><em>eth2</em></span> unmanaged：</p><pre class="literallayout">~]$ <code class="literal">nmcli device status</code>
DEVICE      TYPE      STATE      CONNECTION
bond0       bond      connected  bond0
virbr0      bridge    connected  virbr0
eth1        ethernet  connected  bond-slave-eth1
eth2        ethernet  connected  bond-slave-eth2
eth0        ethernet  unmanaged  --</pre><pre class="literallayout">~]$ <code class="literal">nmcli device set <span class="emphasis"><em>eth2</em></span> managed no</code></pre><pre class="literallayout">~]$ <code class="literal">nmcli device status</code>
DEVICE      TYPE      STATE      CONNECTION
bond0       bond      connected  bond0
virbr0      bridge    connected  virbr0
eth1        ethernet  connected  bond-slave-eth1
eth2        ethernet  unmanaged  --
eth0        ethernet  unmanaged  --</pre><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>当您将设备设置为非托管时， <span class="strong"><strong><span class="application">NetworkManager</span></strong></span>不会对其进行控制。如果要配置的设备列为非托管设备，则no <span class="strong"><strong>nmcli</strong></span>命令对此设备没有任何影响。但是，设备仍然连接。
				</p></div><h3><a id="additional_resources_12"></a>其他资源</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关更多信息，请参见<span class="emphasis"><em><span class="citetitle"><span class="strong"><strong>nmcli</strong></span> （1）</span></em></span>手册页。
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Creating-a-connection-profile-with-nmcli_Configuring-Networking-with-nmcli"></a>使用nmcli创建连接配置文件</h1></div></div></div><p>您可以创建与设备关联的连接配置文件。
			</p><h3><a id="prerequisites_7"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<a class="xref" href="Configuring-Networking-with-nmcli_configuring-and-managing-networking.html#Getting-started-with-nmcli_Configuring-Networking-with-nmcli" title="nmcli入门">“nmcli入门”一节</a>
					</li><li class="listitem">
						<a class="xref" href="Configuring-Networking-with-nmcli_configuring-and-managing-networking.html#Overview-of-nmcli-property-names-and-aliases_Configuring-Networking-with-nmcli" title="nmcli属性名称和别名概述">名为“nmcli属性名称和别名概述”的部分</a>
					</li></ul></div><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>如果使用<span class="strong"><strong>nmcli</strong></span>命令，建议键入partial <span class="strong"><strong>nmcli</strong></span>命令，然后按<span class="keycap"><strong>Tab</strong></span>键自动完成命令序列。如果可以进行多次完成，则<span class="keycap"><strong>Tab</strong></span>会将它们全部列出。这有助于用户更快，更轻松地键入命令。要启用<span class="strong"><strong>nmcli</strong></span>自动完成功能，请确保安装<code class="literal">bash-completion</code>包：</p><pre class="literallayout">~]# yum install bash-completion</pre><p>软件包安装后，下次登录控制台时将提供<code class="literal">nmcli auto-complete</code> 。要在当前控制台中激活它，请输入：</p><pre class="literallayout">~]$ source /etc/profile.d/bash_completion.sh</pre></div><h3><a id="procedure_5"></a>程序</h3><p>使用<span class="strong"><strong><span class="application">nmcli</span></strong></span>为<span class="strong"><strong><span class="application">NetworkManager</span></strong></span> <span class="strong"><strong>创建</strong></span>新配置文件的基本格式：</p><pre class="literallayout"><code class="literal">nmcli c add {COMMON_OPTIONS} [IP_OPTIONS]/[NETMASK] [GATEWAY]</code></pre><div class="orderedlist"><ol class="orderedlist"><li class="listitem">其中<code class="literal">{COMMON_OPTIONS}</code>是别名或属性名称，请参阅<a class="link" href="Configuring-Networking-with-nmcli_configuring-and-managing-networking.html#tabl-Aliases-and-property-names" title="别名和属性名称">别名和属性名称</a> 。
					</li><li class="listitem"><p class="simpara">其中<code class="literal">[IP_OPTIONS]</code>是IP地址：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">对于IPv4地址： <code class="literal">ip4</code>
							</li><li class="listitem">对于IPv6地址： <code class="literal">ip6</code>
							</li></ul></div></li><li class="listitem">其中<code class="literal">[NETMASK]</code>是网络掩码宽度。例如， <code class="literal">255.255.255.0</code>是前缀<span class="emphasis"><em>198.51.100.0</em></span> / <code class="literal">24</code>的网络掩码。
					</li><li class="listitem"><p class="simpara">其中<code class="literal">[GATEWAY]</code>是网关信息：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">对于IPv4地址： <code class="literal">gw4</code>
							</li><li class="listitem">对于IPv6地址： <code class="literal">gw6</code>
							</li></ul></div></li></ol></div><pre class="literallayout"><code class="literal">nmcli connection add</code> <span class="strong"><strong>type</strong></span> ethernet <span class="strong"><strong>con-name</strong></span> <span class="emphasis"><em>connection-name</em></span> <span class="strong"><strong>ifname</strong></span> <span class="emphasis"><em>interface-name</em></span> <span class="strong"><strong>ip4</strong></span> <span class="emphasis"><em>address</em></span>/<span class="emphasis"><em>network mask</em></span> <span class="strong"><strong>gw4</strong></span> <span class="emphasis"><em>address</em></span></pre><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要使用IPv4地址创建连接配置文件：</p><pre class="literallayout">~]$ <code class="literal">nmcli c add type <span class="emphasis"><em>ethernet</em></span> ifname <span class="emphasis"><em>eth0</em></span> con-name <span class="emphasis"><em>"My Connection"</em></span> ip4 192.168.2.100/24 gw4 192.168.2.1</code>
Connection 'new-ens33' (f0c23472-1aec-4e84-8f1b-be8a2ecbeade) successfully added.</pre></li><li class="listitem"><p class="simpara">要激活创建的连接：</p><pre class="literallayout">~]$ <code class="literal">nmcli c up _"My Connection"</code></pre></li><li class="listitem"><p class="simpara">要查看已创建的连接：</p><pre class="literallayout">~]$ <code class="literal">nmcli c show <span class="emphasis"><em>"My Connection"</em></span></code></pre></li></ol></div><p>请注意， <span class="strong"><strong>nmcli c show <span class="emphasis"><em>con-name</em></span></strong></span>命令显示连接中存在的所有属性，即使是空的或具有默认值的属性。如果输出长于终端页面， <span class="strong"><strong>nmcli会</strong></span>生成一个寻呼机，以便在输出上轻松导航。在寻呼机中，使用箭头上下移动，使用<span class="keycap"><strong>q</strong></span>键退出。
			</p><p>要更紧凑地显示连接，请使用<code class="literal">-o</code>选项：</p><pre class="literallayout">~]$ <code class="literal">nmcli -o c show <span class="emphasis"><em>"My Connection"</em></span></code></pre><p><span class="strong"><strong>nmcli -oc show <span class="emphasis"><em>con-name</em></span></strong></span>命令仍显示连接内容，但省略空属性或设置为默认值的属性。这通常会导致输出更短，更易读。
			</p><h3><a id="additional_resources_13"></a>其他资源</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关属性及其设置的更多信息，请参见<code class="literal">nm-settings(5)</code>手册页。
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Using-the-nmcli-Interactive-Connection-Editor_Configuring-Networking-with-nmcli"></a>使用nmcli交互式连接编辑器</h1></div></div></div><p><span class="strong"><strong><span class="application">nmcli</span></strong></span>工具有一个交互式连接编辑器。它允许您根据需要更改连接参数。要使用它：</p><pre class="literallayout">~]$ <code class="literal">nmcli con edit</code></pre><p>您应该从显示的列表中输入有效的<span class="strong"><strong>连接类型</strong></span> 。然后，您可以修改其参数。
			</p><pre class="literallayout">~]$ <code class="literal">nmcli con edit</code>
Valid connection types: generic, 802-3-ethernet (ethernet), pppoe, 802-11-wireless (wifi), wimax, gsm, cdma, infiniband, adsl, bluetooth, vpn, 802-11-olpc-mesh (olpc-mesh), vlan, bond, team, bridge, bond-slave, team-slave, bridge-slave, no-slave, tun, ip-tunnel, macsec, macvlan, vxlan, dummy
Enter connection type: <code class="literal">ethernet</code>

===| nmcli interactive connection editor |===

Adding a new '802-11-wireless' connection

Type 'help' or '?' for available commands.
Type 'describe [&lt;setting&gt;.&lt;prop&gt;]' for detailed property description.

You may edit the following settings: connection, 802-11-wireless (wifi), 802-11-wireless-security (wifi-sec), 802-1x, ipv4, ipv6, proxy
nmcli&gt;</pre><p>现在可以编辑<code class="literal">ethernet</code>连接设置。要获取可用命令列表，请键入<code class="literal">help</code>或<code class="literal">?</code> ：</p><pre class="literallayout">nmcli&gt; <code class="literal">?</code>
------------------------------------------------------------------------------
---[ Main menu ]---
goto     [&lt;setting&gt; | &lt;prop&gt;]        :: go to a setting or property
remove   &lt;setting&gt;[.&lt;prop&gt;] | &lt;prop&gt; :: remove setting or reset property value
set      [&lt;setting&gt;.&lt;prop&gt; &lt;value&gt;]  :: set property value
describe [&lt;setting&gt;.&lt;prop&gt;]          :: describe property
print    [all | &lt;setting&gt;[.&lt;prop&gt;]]  :: print the connection
verify   [all | fix]                 :: verify the connection
save     [persistent|temporary]      :: save the connection
activate [&lt;ifname&gt;] [/&lt;ap&gt;|&lt;nsp&gt;]    :: activate the connection
back                                 :: go one level up (back)
help/?   [&lt;command&gt;]                 :: print this help
nmcli    &lt;conf-option&gt; &lt;value&gt;       :: nmcli configuration
quit                                 :: exit nmcli
------------------------------------------------------------------------------
nmcli&gt;</pre><p>要退出，请输入<code class="literal">quit</code>命令。
			</p><div class="example"><a id="idm139932836212528"></a><p class="title"><strong>例6.13。使用<span class="strong">nmcli</span>交互式连接编辑器添加新的<code class="literal">Ethernet</code>连接</strong></p><div class="example-contents"><pre class="literallayout">~]$ <code class="literal">nmcli con edit</code>
Valid connection types: generic, 802-3-ethernet (ethernet), pppoe, 802-11-wireless (wifi), wimax, gsm, cdma, infiniband, adsl, bluetooth, vpn, 802-11-olpc-mesh (olpc-mesh), vlan, bond, team, bridge, bond-slave, team-slave, bridge-slave, no-slave, tun, ip-tunnel, macsec, macvlan, vxlan, dummy
Enter connection type: <code class="literal">ethernet</code>

===| nmcli interactive connection editor |===

Adding a new '802-3-ethernet' connection

Type 'help' or '?' for available commands.
Type 'describe [&lt;setting&gt;.&lt;prop&gt;]' for detailed property description.

You may edit the following settings: connection, 802-3-ethernet (ethernet), 802-1x, dcb, ipv4, ipv6, proxy
nmcli&gt; <code class="literal">set connection.id <span class="emphasis"><em>new_eth1</em></span></code>
nmcli&gt; <code class="literal">set connection.interface-name <span class="emphasis"><em>eth1</em></span></code>
nmcli&gt; <code class="literal">set connection.autoconnect yes</code>
nmcli&gt; <code class="literal">save</code>
Saving the connection with 'autoconnect=yes'. That might result in an immediate activation of the connection.
Do you still want to save? (yes/no) [yes] <code class="literal">yes</code>
Connection 'new_eth1' (34ac8f9a-e9d8-4e0b-9751-d5dc87cc0467) successfully saved.
nmcli&gt; <code class="literal">quit</code></pre></div></div><p>在<code class="literal">/etc/sysconfig/network-scripts</code>目录中创建新的网络接口配置文件：</p><pre class="literallayout">~]# <code class="literal">ls -lrt /etc/sysconfig/network-scripts/ifcfg*</code>
-rw-r--r--. 1 root root 254 Aug 15  2017 /etc/sysconfig/network-scripts/ifcfg-lo
-rw-r--r--. 1 root root 304 Apr 26 22:14 /etc/sysconfig/network-scripts/ifcfg-ens3
-rw-r--r--. 1 root root 266 Aug  6 11:03 /etc/sysconfig/network-scripts/ifcfg-new_eth1</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Modifying-a-connection-profile-with-nmcli_Configuring-Networking-with-nmcli"></a>使用nmcli修改连接配置文件</h1></div></div></div><p>您可以修改连接配置文件的现有配置。
			</p><h3><a id="prerequisites_8"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<a class="xref" href="Configuring-Networking-with-nmcli_configuring-and-managing-networking.html#Getting-started-with-nmcli_Configuring-Networking-with-nmcli" title="nmcli入门">“nmcli入门”一节</a>
					</li><li class="listitem">
						<a class="xref" href="Configuring-Networking-with-nmcli_configuring-and-managing-networking.html#Overview-of-nmcli-property-names-and-aliases_Configuring-Networking-with-nmcli" title="nmcli属性名称和别名概述">名为“nmcli属性名称和别名概述”的部分</a>
					</li><li class="listitem">
						<a class="xref" href="Configuring-Networking-with-nmcli_configuring-and-managing-networking.html#Creating-a-connection-profile-with-nmcli_Configuring-Networking-with-nmcli" title="使用nmcli创建连接配置文件">“使用nmcli创建连接配置文件”一节</a>
					</li></ul></div><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>如果使用<span class="strong"><strong>nmcli</strong></span>命令，建议键入partial <span class="strong"><strong>nmcli</strong></span>命令，然后按<span class="keycap"><strong>Tab</strong></span>键自动完成命令序列。如果可以进行多次完成，则<span class="keycap"><strong>Tab</strong></span>会将它们全部列出。这有助于用户更快，更轻松地键入命令。要启用<span class="strong"><strong>nmcli</strong></span>自动完成功能，请确保安装<code class="literal">bash-completion</code>包：</p><pre class="literallayout">~]# yum install bash-completion</pre><p>软件包安装后，下次登录控制台时将提供<code class="literal">nmcli auto-complete</code> 。要在当前控制台中激活它，请输入：</p><pre class="literallayout">~]$ source /etc/profile.d/bash_completion.sh</pre></div><h3><a id="procedure_6"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要修改连接配置文件的一个或多个属性，请使用以下命令：</p><pre class="literallayout">~]$ <code class="literal">nmcli c modify</code></pre><p class="simpara">例如，要将<span class="strong"><strong>connection.id</strong></span>从<span class="emphasis"><em>“我的连接”</em></span>更改为<span class="emphasis"><em>“我最喜欢的连接”</em></span> ，将<span class="strong"><strong>connection.interface-name</strong></span>更改为<span class="emphasis"><em>eth1</em></span> ：</p><pre class="literallayout">~]$ <code class="literal">nmcli c modify <span class="emphasis"><em>"My Connection"</em></span> connection.id <span class="emphasis"><em>"My favorite connection"</em></span> connection.interface-name <span class="emphasis"><em>eth1</em></span></code></pre></li><li class="listitem"><p class="simpara">要在使用<span class="strong"><strong>nmcli</strong></span>修改连接后<span class="strong"><strong>应用</strong></span>更改，请通过输入以下命令再次激活连接：</p><pre class="literallayout">~]$ <code class="literal">nmcli con up "My favorite connection"</code>
Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/16)</pre></li><li class="listitem">要查看已修改的连接，请输入<code class="literal">nmcli con show <span class="emphasis"><em>con-name</em></span></code>命令。
					</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Configuring-a-Static-Ethernet-Connection_Configuring-Networking-with-nmcli"></a>配置静态以太网连接</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_a_static_ethernet_connection_with_emphasis_role_strong_nmcli_emphasis"></a>使用<span class="strong"><strong>nmcli</strong></span>配置静态以太网连接</h2></div></div></div><h3><a id="prerequisites_9"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="xref" href="Configuring-Networking-with-nmcli_configuring-and-managing-networking.html#Getting-started-with-nmcli_Configuring-Networking-with-nmcli" title="nmcli入门">“nmcli入门”一节</a>
						</li><li class="listitem">
							<a class="xref" href="Configuring-Networking-with-nmcli_configuring-and-managing-networking.html#Creating-a-connection-profile-with-nmcli_Configuring-Networking-with-nmcli" title="使用nmcli创建连接配置文件">“使用nmcli创建连接配置文件”一节</a>
						</li></ul></div><h3><a id="procedure_7"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">设置两个<code class="literal">IPv4</code> <code class="literal">DNS</code>服务器地址：</p><pre class="literallayout">~]$ <code class="literal">nmcli con mod <span class="emphasis"><em>test-lab</em></span> ipv4.dns "8.8.8.8 8.8.4.4"</code></pre><p class="simpara">请注意，这将替换任何以前设置的<code class="literal">DNS</code>服务器。
						</p><p class="simpara">或者，设置两个<code class="literal">IPv6</code> <code class="literal">DNS</code>服务器地址：</p><pre class="literallayout">~]$ <code class="literal">nmcli con mod <span class="emphasis"><em>test-lab</em></span> ipv6.dns "2001:4860:4860::8888 2001:4860:4860::8844"</code></pre><p class="simpara">请注意，这将替换任何以前设置的<code class="literal">DNS</code>服务器。
						</p></li><li class="listitem"><p class="simpara">要将其他<code class="literal">DNS</code>服务器添加到任何先前设置，请使用<code class="literal">+</code>前缀：</p><pre class="literallayout">~]$ <code class="literal">nmcli con mod <span class="emphasis"><em>test-lab</em></span> +ipv4.dns "8.8.8.8 8.8.4.4"</code></pre><pre class="literallayout">~]$ nmcli con mod <span class="emphasis"><em>test-lab</em></span> +ipv6.dns "2001:4860:4860::8888 2001:4860:4860::8844"</pre></li><li class="listitem"><p class="simpara">要激活新的<span class="strong"><strong>以太网</strong></span>连接：</p><pre class="literallayout">~]$ <code class="literal">nmcli con up <span class="emphasis"><em>test-lab</em></span> <span class="strong"><strong>ifname</strong></span> <span class="emphasis"><em>ens9</em></span></code>
Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/6)</pre></li><li class="listitem"><p class="simpara">要查看设备和连接的状态：</p><pre class="literallayout">~]$ <code class="literal">nmcli device status</code>
DEVICE  TYPE      STATE      CONNECTION
ens3    ethernet  connected  my-office
ens9    ethernet  connected  test-lab
lo      loopback  unmanaged  --</pre></li><li class="listitem">要查看有关新配置连接的详细信息：</li></ol></div><pre class="literallayout">~]$ <code class="literal">nmcli -p con show <span class="emphasis"><em>test-lab</em></span></code>
===============================================================================
                     Connection profile details (test-lab)
===============================================================================
connection.id:                          test-lab
connection.uuid:                        05abfd5e-324e-4461-844e-8501ba704773
connection.interface-name:              ens9
connection.type:                        802-3-ethernet
connection.autoconnect:                 yes
connection.timestamp:                   1410428968
connection.read-only:                   no
connection.permissions:
connection.zone:                        --
connection.master:                      --
connection.slave-type:                  --
connection.secondaries:
connection.gateway-ping-timeout:        0
<span class="emphasis"><em>[output truncated]</em></span></pre><p>使用<code class="literal">-p, --pretty</code>选项会在输出中添加标题横幅和分节符。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_a_static_ethernet_connection_using_the_nmcli_interactive_editor"></a>使用nmcli交互式编辑器配置静态以太网连接</h2></div></div></div><p>要使用<span class="strong"><strong>nmcli</strong></span>交互式编辑器配置静态以太网连接：</p><pre class="literallayout">~]$ <code class="literal">nmcli con edit <span class="strong"><strong>type</strong></span> ethernet <span class="strong"><strong>con-name</strong></span> <span class="emphasis"><em>ens3</em></span></code>

===| nmcli interactive connection editor |===

Adding a new '802-3-ethernet' connection

Type 'help' or '?' for available commands.
Type 'describe [&gt;setting&lt;.&gt;prop&lt;]' for detailed property description.

You may edit the following settings: connection, 802-3-ethernet (ethernet), 802-1x, ipv4, ipv6, dcb
nmcli&gt; <code class="literal">set ipv4.addresses 192.168.122.88/24</code>
Do you also want to set 'ipv4.method' to 'manual'? [yes]: <code class="literal">yes</code>
nmcli&gt; <code class="literal">save temporary</code>
Saving the connection with 'autoconnect=yes'. That might result in an immediate activation of the connection.
Do you still want to save? [yes] <code class="literal">yes</code>
Connection 'ens3' (704a5666-8cbd-4d89-b5f9-fa65a3dbc916) successfully saved.
nmcli&gt; <code class="literal">quit</code></pre><p>默认操作是将连接配置文件保存为持久性。如果需要，可以通过<code class="literal">save temporary</code>命令将配置文件保留在内存中，直到下次重新启动。
				</p><h3><a id="additional_resources_14"></a>其他资源</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关属性及其设置的更多信息，请参见<code class="literal">nm-settings(5)</code>手册页。
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="Configuring-a-Dynamic-Ethernet-Connection_Configuring-Networking-with-nmcli"></a>配置动态以太网连接</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_a_dynamic_ethernet_connection_with_emphasis_role_strong_nmcli_emphasis"></a>使用<span class="strong"><strong>nmcli</strong></span>配置动态以太网连接</h2></div></div></div><h3><a id="prerequisites_10"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="xref" href="Configuring-Networking-with-nmcli_configuring-and-managing-networking.html#Getting-started-with-nmcli_Configuring-Networking-with-nmcli" title="nmcli入门">“nmcli入门”一节</a>
						</li><li class="listitem">
							<a class="xref" href="Configuring-Networking-with-nmcli_configuring-and-managing-networking.html#Creating-a-connection-profile-with-nmcli_Configuring-Networking-with-nmcli" title="使用nmcli创建连接配置文件">“使用nmcli创建连接配置文件”一节</a>
						</li></ul></div><h3><a id="procedure_8"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要将主机发送的主机名更改为<code class="literal">DHCP</code>服务器，请修改<code class="literal">dhcp-hostname</code>属性：</p><pre class="literallayout">~]$ <code class="literal">nmcli con modify my-office <span class="emphasis"><em>my-office</em></span> ipv4.dhcp-hostname <span class="emphasis"><em>host-name</em></span> ipv6.dhcp-hostname <span class="emphasis"><em>host-name</em></span></code></pre></li><li class="listitem"><p class="simpara">要将主机发送的<code class="literal">IPv4</code>客户端ID更改为<code class="literal">DHCP</code>服务器，请修改<code class="literal">dhcp-client-id</code>属性：</p><pre class="literallayout">~]$ <code class="literal">nmcli con modify my-office <span class="emphasis"><em>my-office</em></span> ipv4.dhcp-client-id <span class="emphasis"><em>client-ID-string</em></span></code></pre><p class="simpara">没有<code class="literal">dhcp-client-id</code>属性<code class="literal">IPv6</code> <span class="strong"><strong><span class="application">，dhclient的</span></strong></span>创建标识符<code class="literal">IPv6</code> 。有关详细信息，请参见<code class="literal">dhclient(8)</code>手册页。
						</p></li><li class="listitem"><p class="simpara">要忽略<code class="literal">DHCP</code>服务器发送给主机的<code class="literal">DNS</code>服务器，请修改<code class="literal">ignore-auto-dns</code>属性：</p><pre class="literallayout">~]$ <code class="literal">nmcli con modify my-office <span class="emphasis"><em>my-office</em></span> ipv4.ignore-auto-dns <span class="emphasis"><em>yes</em></span> ipv6.ignore-auto-dns <span class="emphasis"><em>yes</em></span></code></pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_a_dynamic_ethernet_connection_using_the_interactive_editor"></a>使用交互式编辑器配置动态以太网连接</h2></div></div></div><p>要使用交互式编辑器配置动态以太网连接：</p><pre class="literallayout">~]$ <code class="literal">nmcli con edit type ethernet con-name <span class="emphasis"><em>ens3</em></span></code>

===| nmcli interactive connection editor |===

Adding a new '802-3-ethernet' connection

Type 'help' or '?' for available commands.
Type 'describe [&lt;setting&gt;.&lt;prop&gt;]' for detailed property description.

You may edit the following settings: connection, 802-3-ethernet (ethernet), 802-1x, ipv4, ipv6, dcb
nmcli&gt; <code class="literal">describe ipv4.method</code>

=== [method] ===
[NM property description]
IPv4 configuration method.  If 'auto' is specified then the appropriate automatic method (DHCP, PPP, etc) is used for the interface and most other properties can be left unset.  If 'link-local' is specified, then a link-local address in the 169.254/16 range will be assigned to the interface.  If 'manual' is specified, static IP addressing is used and at least one IP address must be given in the 'addresses' property.  If 'shared' is specified (indicating that this connection will provide network access to other computers) then the interface is assigned an address in the 10.42.x.1/24 range and a DHCP and forwarding DNS server are started, and the interface is NAT-ed to the current default network connection.  'disabled' means IPv4 will not be used on this connection.  This property must be set.

nmcli&gt; <code class="literal">set ipv4.method auto</code>
nmcli&gt; <code class="literal">save</code>
Saving the connection with 'autoconnect=yes'. That might result in an immediate activation of the connection.
Do you still want to save? [yes] <code class="literal">yes</code>
Connection 'ens3' (090b61f7-540f-4dd6-bf1f-a905831fc287) successfully saved.
nmcli&gt; <code class="literal">quit</code></pre><p>默认操作是将连接配置文件保存为持久性。如果需要，可以通过<code class="literal">save temporary</code>命令将配置文件保留在内存中，直到下次重新启动。
				</p><h3><a id="additional_resources_15"></a>其他资源</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关属性及其设置的更多信息，请参见<code class="literal">nm-settings(5)</code>手册页。
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="how-to-use-the-nmcli-command-to-configure-a-static-route_Configuring-Networking-with-nmcli"></a>如何使用nmcli命令配置静态路由</h1></div></div></div><p>要配置静态路由，请使用<code class="literal">nmcli</code>实用程序，语法如下：</p><pre class="literallayout">$ <code class="literal">nmcli connection modify <span class="emphasis"><em>connection_name</em></span> ipv4.routes "<span class="emphasis"><em>ip</em></span>[/<span class="emphasis"><em>prefix</em></span>] [<span class="emphasis"><em>next_hop</em></span>] [<span class="emphasis"><em>metric</em></span>] [<span class="emphasis"><em>attribute</em></span>=<span class="emphasis"><em>value</em></span>] [<span class="emphasis"><em>attribute</em></span>=<span class="emphasis"><em>value</em></span>] ..."</code></pre><p>该命令支持以下路由属性：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<code class="literal">table = <span class="emphasis"><em>n</em></span></code>
					</li><li class="listitem">
						<code class="literal">src = <span class="emphasis"><em>地址</em></span></code>
					</li><li class="listitem">
						<code class="literal">tos = <span class="emphasis"><em>n</em></span></code>
					</li><li class="listitem">
						<code class="literal">onlink = TRUE | FALSE</code>
					</li><li class="listitem">
						<code class="literal">window = <span class="emphasis"><em>n</em></span></code>
					</li><li class="listitem">
						<code class="literal">cwnd = <span class="emphasis"><em>n</em></span></code>
					</li><li class="listitem">
						<code class="literal">mtu = <span class="emphasis"><em>n</em></span></code>
					</li><li class="listitem">
						<code class="literal">锁定窗口= TRUE | FALSE</code>
					</li><li class="listitem">
						<code class="literal">锁定cwdn = TRUE | FALSE</code>
					</li><li class="listitem">
						<code class="literal">锁定MTU = TRUE | FALSE</code>
					</li></ul></div><p>如果使用<code class="literal">ipv4.routes</code>子命令， <code class="literal">nmcli</code>覆盖此参数的所有当前设置。要添加其他路由，请使用<code class="literal">nmcli connection modify <span class="emphasis"><em>connection_name</em></span> +ipv4.routes "…​"</code>命令。以类似的方式，您可以使用<code class="literal">nmcli connection modify <span class="emphasis"><em>connection_name</em></span> -ipv4.routes "…​"</code>来删除特定路由。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring-a-static-route-using-a-nmcli-command_Configuring-Networking-with-nmcli"></a>使用nmcli命令配置静态路由</h1></div></div></div><p>您可以使用<code class="literal">nmcli connection modify</code>命令将静态路由添加到网络连接的配置中。
			</p><p>本节中的过程介绍如何将路由添加到使用<code class="literal">198.51.100.1</code>运行的网关的<code class="literal">192.0.2.0/24</code>网络，该网关可通过<code class="literal">example</code>连接访问。
			</p><h3><a id="prerequisites_11"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">网络已配置</li><li class="listitem">必须可以在接口上直接访问静态路由的网关。
					</li><li class="listitem">如果用户在物理控制台上登录，则用户权限就足够了。否则，该命令需要<code class="literal">root</code>权限。
					</li></ul></div><h3><a id="procedure_9"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">将静态路由添加到<code class="literal">example</code>连接：</p><pre class="literallayout">$ <code class="literal">sudo nmcli connection modify <span class="emphasis"><em>example</em></span> +ipv4.routes "192.0.2.0/24 198.51.100.1"</code></pre><p class="simpara">要一步设置多个路由，请将逗号分隔的各个路由传递给该命令。例如，要添加到<code class="literal">192.0.2.0/24</code>和<code class="literal">203.0.113.0/24</code>网络的路由，两者都通过<code class="literal">198.51.100.1</code>网关路由，请输入：</p><pre class="literallayout">$ <code class="literal">sudo nmcli connection modify <span class="emphasis"><em>example</em></span> +ipv4.routes "192.0.2.0/24 198.51.100.1, 203.0.113.0/24 198.51.100.1"</code></pre></li><li class="listitem"><p class="simpara">（可选）验证路由是否已正确添加到配置中：</p><pre class="literallayout">$ <code class="literal">nmcli connection show <span class="emphasis"><em>example</em></span></code>
...
ipv4.routes:        { ip = 192.0.2.1/24, nh = 198.51.100.1 }
...</pre></li><li class="listitem"><p class="simpara">重启网络连接：</p><pre class="literallayout">$ <code class="literal">sudo nmcli connection up <span class="emphasis"><em>example</em></span></code></pre><div class="warning" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">警告</h3><p>重新启动连接会短暂中断该接口上的连接。
						</p></div></li><li class="listitem"><p class="simpara">（可选）验证路由是否处于活动状态：</p><pre class="literallayout">$ <code class="literal">ip route</code>
...
192.0.2.0/24 via 198.51.100.1 dev <span class="emphasis"><em>example</em></span> proto static metric 100</pre></li></ol></div><h3><a id="additional_resources_16"></a>其他资源</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关<code class="literal">nmcli</code>更多详细信息，请参见<code class="literal">nmcli(1)</code>手册页。
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring-a-static-route-using-the-nmcli-interactive-mode_Configuring-Networking-with-nmcli"></a>使用nmcli交互模式配置静态路由</h1></div></div></div><p>您可以使用<code class="literal">nmcli</code>实用程序的交互模式将静态路由添加到网络连接的配置中。
			</p><p>本节中的过程介绍如何将路由添加到使用<code class="literal">198.51.100.1</code>运行的网关的<code class="literal">192.0.2.0/24</code>网络，该网关可通过<code class="literal">example</code>连接访问。
			</p><h3><a id="prerequisites_12"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">网络已配置</li><li class="listitem">必须可以在接口上直接访问静态路由的网关。
					</li><li class="listitem">如果用户在物理控制台上登录，则用户权限就足够了。否则，该命令需要<code class="literal">root</code>权限。
					</li></ul></div><h3><a id="procedure_10"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">打开<code class="literal">example</code>连接的<code class="literal">nmcli</code>交互模式：</p><pre class="literallayout">$ <code class="literal">sudo nmcli connection edit <span class="emphasis"><em>example</em></span></code></pre></li><li class="listitem"><p class="simpara">添加静态路由：</p><pre class="literallayout">nmcli&gt; <code class="literal">set ipv4.routes 192.0.2.0/24 198.51.100.1</code></pre></li><li class="listitem"><p class="simpara">（可选）验证路由是否已正确添加到配置中：</p><pre class="literallayout">nmcli&gt; <code class="literal">print</code>
...
ipv4.routes:        { ip = 192.0.2.1/24, nh = 198.51.100.1 }
...</pre><p class="simpara"><code class="literal">ip</code>属性显示要路由的网络和网关的<code class="literal">nh</code>属性（下一跳）。
					</p></li><li class="listitem"><p class="simpara">保存配置：</p><pre class="literallayout">nmcli&gt; <code class="literal">save persistent</code></pre></li><li class="listitem"><p class="simpara">重启网络连接：</p><pre class="literallayout">nmcli&gt; <code class="literal">activate <span class="emphasis"><em>example</em></span></code></pre><div class="warning" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">警告</h3><p>重新启动连接时，将暂时中断当前使用此连接的所有连接。
						</p></div></li><li class="listitem"><p class="simpara">离开<code class="literal">nmcli</code>交互模式：</p><pre class="literallayout">nmcli&gt; <code class="literal">quit</code></pre></li><li class="listitem"><p class="simpara">（可选）验证路由是否处于活动状态：</p><pre class="literallayout">$ <code class="literal">ip route</code>
...
192.0.2.0/24 via 198.51.100.1 dev <span class="emphasis"><em>example</em></span> proto static metric 100</pre></li></ol></div><h3><a id="additional_resources_17"></a>其他资源</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关交互模式中可用命令的列表，请在交互式shell中输入<code class="literal">help</code> 。
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="setting-the-default-gateway-on-an-existing-connection-using-nmcli_Configuring-Networking-with-nmcli"></a>使用nmcli在现有连接上设置默认网关</h1></div></div></div><p>在大多数情况下，管理员在创建连接时设置默认网关，例如， <a class="xref" href="Configuring-Networking-with-nmcli_configuring-and-managing-networking.html#configuring_a_static_ethernet_connection_with_emphasis_role_strong_nmcli_emphasis" title="使用nmcli配置静态以太网连接">“使用<span class="strong"><strong>nmcli</strong></span>配置静态以太网连接”一节中所述</a> 。
			</p><p>本节介绍如何使用<code class="literal">nmcli</code>实用程序在先前创建的连接上设置或更新默认网关。
			</p><h3><a id="prerequisites_13"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">必须在将设置默认网关的连接上至少配置一个静态IP地址。
					</li><li class="listitem">如果用户在物理控制台上登录，则用户权限就足够了。否则，用户必须具有<code class="literal">root</code>权限。
					</li></ul></div><h3><a id="procedure_11"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">设置默认网关的IP地址。
					</p><p class="simpara">例如，要将<code class="literal"><span class="emphasis"><em>example</em></span></code>连接上的默认网关的IPv4地址设置为<code class="literal">192.0.2.1</code> ：</p><pre class="literallayout">$ <code class="literal">sudo nmcli connection modify <span class="emphasis"><em>example</em></span> ipv4.gateway "192.0.2.1"</code></pre><p class="simpara">例如，要将<code class="literal"><span class="emphasis"><em>example</em></span></code>连接上的默认网关的IPv6地址设置为<code class="literal">2001:db8::1</code> ：</p><pre class="literallayout">$ <code class="literal">sudo nmcli connection modify <span class="emphasis"><em>example</em></span> ipv6.gateway "2001:db8::1"</code></pre></li><li class="listitem"><p class="simpara">重新启动网络连接以使更改生效。例如，要使用命令行重新启动<code class="literal"><span class="emphasis"><em>example</em></span></code>连接：</p><pre class="literallayout">$ <code class="literal">sudo nmcli connection up <span class="emphasis"><em>example</em></span></code></pre><div class="warning" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">警告</h3><p>当前使用此网络连接的所有连接在重新启动期间暂时中断。
						</p></div></li><li class="listitem"><p class="simpara">（可选）验证路由是否处于活动状态。
					</p><p class="simpara">要显示IPv4默认网关：</p><pre class="literallayout">$ <code class="literal">ip -4 route</code>
default via 192.0.2.1 dev <span class="emphasis"><em>example</em></span> proto static metric 100</pre><p class="simpara">要显示IPv6默认网关：</p><pre class="literallayout">$ <code class="literal">ip -6 route</code>
default via 2001:db8::1 dev <span class="emphasis"><em>example</em></span> proto static metric 100 pref medium</pre></li></ol></div><h3><a id="additional_resources_18"></a>其他资源</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<a class="xref" href="Configuring-Networking-with-nmcli_configuring-and-managing-networking.html#configuring_a_static_ethernet_connection_with_emphasis_role_strong_nmcli_emphasis" title="使用nmcli配置静态以太网连接">“使用<span class="strong"><strong>nmcli</strong></span>配置静态以太网连接”一节</a>
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="setting-the-default-gateway-on-an-existing-connection-using-the-nmcli-interactive-mode_Configuring-Networking-with-nmcli"></a>使用nmcli交互模式在现有连接上设置默认网关</h1></div></div></div><p>在大多数情况下，管理员在创建连接时设置默认网关，例如， <a class="xref" href="Configuring-Networking-with-nmcli_configuring-and-managing-networking.html#configuring_a_static_ethernet_connection_using_the_nmcli_interactive_editor" title="使用nmcli交互式编辑器配置静态以太网连接">“使用nmcli交互式编辑器配置静态以太网连接”一节中所述</a> 。
			</p><p>本节介绍如何使用<code class="literal">nmcli</code>实用程序的交互模式在先前创建的连接上设置或更新默认网关。
			</p><h3><a id="prerequisites_14"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">必须在将设置默认网关的连接上至少配置一个静态IP地址。
					</li><li class="listitem">如果用户在物理控制台上登录，则用户权限就足够了。否则，用户必须具有<code class="literal">root</code>权限。
					</li></ul></div><h3><a id="procedure_12"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">打开所需连接的<code class="literal">nmcli</code>交互模式。例如，要打开<span class="emphasis"><em>示例</em></span>连接的<code class="literal">nmcli</code>交互模式：</p><pre class="literallayout">$ <code class="literal">sudo nmcli connection edit <span class="emphasis"><em>example</em></span></code></pre></li><li class="listitem"><p class="simpara">设置默认网关。
					</p><p class="simpara">例如，要将<code class="literal"><span class="emphasis"><em>example</em></span></code>连接上的默认网关的IPv4地址设置为<code class="literal">192.0.2.1</code> ：</p><pre class="literallayout">nmcli&gt; <code class="literal">set ipv4.gateway 192.0.2.1</code></pre><p class="simpara">例如，要将<code class="literal"><span class="emphasis"><em>example</em></span></code>连接上的默认网关的IPv6地址设置为<code class="literal">2001:db8::1</code> ：</p><pre class="literallayout">nmcli&gt; <code class="literal">set ipv6.gateway 2001:db8::1</code></pre></li><li class="listitem"><p class="simpara">（可选）验证是否已正确设置默认网关：</p><pre class="literallayout">nmcli&gt; <code class="literal">print</code>
...
ipv4.gateway:                           192.0.2.1
...
ipv6.gateway:                           2001:db8::1
...</pre></li><li class="listitem"><p class="simpara">保存配置：</p><pre class="literallayout">nmcli&gt; <code class="literal">save persistent</code></pre></li><li class="listitem"><p class="simpara">重新启动网络连接以使更改生效：</p><pre class="literallayout">nmcli&gt; <code class="literal">activate <span class="emphasis"><em>example</em></span></code></pre><div class="warning" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">警告</h3><p>当前使用此网络连接的所有连接在重新启动期间暂时中断。
						</p></div></li><li class="listitem"><p class="simpara">离开<code class="literal">nmcli</code>交互模式：</p><pre class="literallayout">nmcli&gt; <code class="literal">quit</code></pre></li><li class="listitem"><p class="simpara">（可选）验证路由是否处于活动状态。
					</p><p class="simpara">要显示IPv4默认网关：</p><pre class="literallayout">$ <code class="literal">ip -4 route</code>
default via 192.0.2.1 dev <span class="emphasis"><em>example</em></span> proto static metric 100</pre><p class="simpara">要显示IPv6默认网关：</p><pre class="literallayout">$ <code class="literal">ip -6 route</code>
default via 2001:db8::1 dev <span class="emphasis"><em>example</em></span> proto static metric 100 pref medium</pre></li></ol></div><h3><a id="additional_resources_19"></a>其他资源</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<a class="xref" href="Configuring-Networking-with-nmcli_configuring-and-managing-networking.html#configuring_a_static_ethernet_connection_using_the_nmcli_interactive_editor" title="使用nmcli交互式编辑器配置静态以太网连接">“使用nmcli交互式编辑器配置静态以太网连接”一节</a>
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="connecting-a-Wi-Fi-connection-with-nmcli_Configuring-Networking-with-nmcli"></a>使用nmcli连接Wi-Fi连接</h1></div></div></div><p>此过程描述如何使用<span class="strong"><strong>nmcli</strong></span>实用程序连接到<code class="literal">wireless</code>连接。
			</p><h3><a id="prerequisites_15"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">要安装的<span class="strong"><strong>nmcli</strong></span>实用程序。
					</li><li class="listitem">确保WiFi无线电已打开（默认）：</li></ul></div><pre class="literallayout">~]$ <code class="literal">nmcli radio wifi on</code></pre><h3><a id="procedure_13"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要刷新可用的Wi-Fi连接列表：</p><pre class="literallayout">~]$ <code class="literal">nmcli device wifi rescan</code></pre></li><li class="listitem"><p class="simpara">要查看可用的Wi-Fi接入点：</p><pre class="literallayout">~]$ <code class="literal">nmcli dev wifi list</code>

IN-USE  SSID      MODE   CHAN  RATE        SIGNAL  BARS  SECURITY
...
        MyCafe    Infra  3     405 Mbit/s  85      ▂▄▆█  WPA1 WPA2</pre></li><li class="listitem">要使用<span class="strong"><strong>nmcli</strong></span>连接到Wi-Fi连接：</li></ol></div><pre class="literallayout">~]$ `nmcli dev wifi connect _SSID-Name_ password _wireless-password_`</pre><p>例如：</p><pre class="literallayout">~]$ <code class="literal">nmcli dev wifi connect MyCafe password <span class="emphasis"><em>wireless-password</em></span></code></pre><p>请注意，如果要禁用Wi-Fi状态：</p><pre class="literallayout">~]$ <code class="literal">nmcli radio wifi off</code></pre><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-a-wifi-using-nmcli_Configuring-Networking-with-nmcli"></a>使用nmcli配置Wi-Fi连接</h2></div></div></div><h3><a id="prerequisites_16"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">要安装的<span class="strong"><strong>nmcli</strong></span>实用程序。
						</li><li class="listitem">确保WiFi无线电已打开（默认）：</li></ul></div><pre class="literallayout">~]$ <code class="literal">nmcli radio wifi on</code></pre><h3><a id="procedure_14"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要使用静态<code class="literal">IP</code>配置创建Wi-Fi连接配置文件：</p><pre class="literallayout">~]$ <code class="literal">nmcli con add con-name <span class="emphasis"><em>MyCafe</em></span> ifname wlan0 type wifi ssid MyCafe ` `ip4 192.168.100.101/24 gw4 192.168.100.1</code></pre></li><li class="listitem"><p class="simpara">要检查特定属性，例如<code class="literal">mtu</code> ：</p><pre class="literallayout">~]$ <code class="literal">nmcli connection show id <span class="emphasis"><em>MyCafe</em></span> | grep mtu</code>
802-11-wireless.mtu:                     auto</pre></li><li class="listitem"><p class="simpara">要更改设置的属性：</p><pre class="literallayout">~]$ <code class="literal">nmcli connection modify id <span class="emphasis"><em>MyCafe</em></span> 802-11-wireless.mtu 1350</code></pre></li><li class="listitem"><p class="simpara">要验证更改：</p><pre class="literallayout">~]$ <code class="literal">nmcli connection show id <span class="emphasis"><em>MyCafe</em></span> | grep mtu</code>
802-11-wireless.mtu:                     1350</pre><h3><a id="additional_resources_20"></a>其他资源</h3></li></ol></div><p>有关属性及其设置的更多信息，请参见<code class="literal">nm-settings(5)</code>手册页。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_connecting-to-a-hidden-network-using-nmcli_Configuring-Networking-with-nmcli"></a>使用nmcli连接到隐藏网络</h2></div></div></div><p>所有接入点都有一个服务集标识符（SSID）来识别它们。但是，接入点可能配置为不广播其SSID，在这种情况下它是隐藏的，并且不会显示在<span class="strong"><strong>NetworkManager的</strong></span>可用网络列表中。
				</p><p>此过程说明如何使用<span class="strong"><strong>nmcli</strong></span>工具连接到隐藏网络。
				</p><h3><a id="prerequisites_17"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">要安装的<span class="strong"><strong>nmcli</strong></span>实用程序。*</li><li class="listitem">了解<code class="literal">Wi-Fi</code>连接的SSID和密码。
						</li><li class="listitem">确保WiFi无线电已打开（默认）：</li></ul></div><pre class="literallayout">~]$ <code class="literal">nmcli radio wifi on</code></pre><h3><a id="procedure_15"></a>程序</h3><p>连接到隐藏的SSID：</p><pre class="literallayout">~]$ <code class="literal">nmcli dev wifi connect <span class="emphasis"><em>SSID_Name</em></span> password <span class="emphasis"><em>wireless_password</em></span> hidden yes</code></pre></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="sec-Configuring_802.3_Link_Settings"></a>配置802.3链接设置</h1></div></div></div><p>您可以通过修改以下配置参数来配置以太网连接的802.3链路设置：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<code class="literal">802-3-ethernet.auto协商</code>
					</li><li class="listitem">
						<code class="literal">802-3-ethernet.speed</code>
					</li><li class="listitem">
						<code class="literal">802-3-ethernet.duplex</code>
					</li></ul></div><p>您可以将802.3链接设置配置为以下主要模式：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">忽略链接协商</li><li class="listitem">执行自动协商激活</li><li class="listitem">手动设置<code class="literal">speed</code>和<code class="literal">duplex</code>链路设置</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring-802-3-link-settings-with-nmcli-tool_Configuring-Networking-with-nmcli"></a>使用nmcli工具配置802.3链接设置</h1></div></div></div><p>此过程描述如何使用<code class="literal">nmcli</code>工具配置802.3链接设置。
			</p><h3><a id="prerequisites_18"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">必须安装并运行<span class="strong"><strong><span class="application">NetworkManager</span></strong></span> 。
					</li></ul></div><h3><a id="procedure_16"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要忽略链接协商，请设置以下参数：</p><pre class="literallayout">~]# nmcli connection modify <span class="emphasis"><em>connection_name</em></span> 802-3-ethernet.auto-negotiate no 802-3-ethernet.speed 0 802-3-ethernet.duplex ""</pre><p class="simpara">请注意，即使未设置速度和双工参数且自动协商参数设置为no，也不会禁用自动协商参数。
					</p></li><li class="listitem"><p class="simpara">要强制执行自动协商激活，请输入以下命令：</p><pre class="literallayout">~]# nmcli connection modify <span class="emphasis"><em>connection_name</em></span> 802-3-ethernet.auto-negotiate yes 802-3-ethernet.speed 0 802-3-ethernet.duplex ""</pre><p class="simpara">这允许协商NIC支持的所有可用速度和双工模式。</p><p class="simpara">您还可以在广告时启用自动协商，并且仅允许一种速度/双工模式。如果要强制执行<code class="literal">1000BASE-T</code>和<code class="literal">10GBASE-T</code>以太网链路配置，这可能很有用，因为这些标准要求启用自动协商。执行<code class="literal">1000BASE-T</code>标准：</p><pre class="literallayout">~]# nmcli connection modify <span class="emphasis"><em>connection_name</em></span> 802-3-ethernet.auto-negotiate yes 802-3-ethernet.speed 1000 802-3-ethernet.duplex full</pre></li><li class="listitem"><p class="simpara">要手动设置速度和双工链路设置，请输入以下命令：</p><pre class="literallayout">~]# nmcli connection modify <span class="emphasis"><em>connection_name</em></span> 802-3-ethernet.auto-negotiate no 802-3-ethernet.speed [speed in Mbit/s] 802-3-ethernet.duplex [full|half]</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring-802-1x-security-for-wi-fi-and-wired-with-nmcli_Configuring-Networking-with-nmcli"></a>为Wi-Fi配置802.1X安全性并使用nmcli进行连线</h1></div></div></div><p>此过程描述如何使用<span class="strong"><strong>nmcli</strong></span>实用程序在<code class="literal">wireless</code>或<code class="literal">Wired</code>连接中设置网络安全设置。
			</p><h3><a id="prerequisites_19"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">安装了<span class="strong"><strong>nmcli</strong></span>实用程序。
					</li></ul></div><h3><a id="procedure_17"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem">对于<code class="literal">wireless</code>连接，请设置经过身份验证的<code class="literal">key-mgmt</code> （密钥管理）协议。它配置了用于安全<code class="literal">wifi</code>连接的键控机制。
					</li><li class="listitem">配置802-1x验证设置。
					</li></ol></div><div class="table"><a id="tabl-802-1x_authentication_settings"></a><p class="title"><strong>表6.2。802-1x身份验证设置</strong></p><div class="table-contents"><table border="1" summary="The 802-1x authentication settings"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th valign="top" style="text-align:left">802-1x验证设置</th><th valign="top" style="text-align:left">名称</th></tr></thead><tbody><tr><td valign="top" style="text-align:left"> <p>802-1x.identity</p>
							 </td><td valign="top" style="text-align:left"> <p>身分</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>802-1x.ca证书</p>
							 </td><td valign="top" style="text-align:left"> <p>CA证书</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>802-1x.client证书</p>
							 </td><td valign="top" style="text-align:left"> <p>用户证书</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>802-1x.private键</p>
							 </td><td valign="top" style="text-align:left"> <p>私钥</p>
							 </td></tr><tr><td valign="top" style="text-align:left"> <p>802-1x.private密钥密码</p>
							 </td><td valign="top" style="text-align:left"> <p>私钥密码</p>
							 </td></tr></tbody></table></div></div><p>例如，要使用EAP-TLS身份验证方法配置WPA2 Enterprise，请应用以下设置：</p><pre class="screen">~]$ nmcli c add type wifi ifname <span class="emphasis"><em>wlan0</em></span> con-name <span class="emphasis"><em>'My Wifi Network'</em></span> \
      802-11-wireless.ssid <span class="emphasis"><em>'My Wifi'</em></span> \
      802-11-wireless-security.key-mgmt <span class="emphasis"><em>wpa-eap</em></span> \
      802-1x.eap tls \
      802-1x.identity <span class="emphasis"><em>identity@example.com</em></span> \
      802-1x.ca-cert /etc/pki/my-wifi/ca.crt \
      802-1x.client-cert /etc/pki/my-wifi/client.crt \
      802-1x.private-key /etc/pki/my-wifi/client.key \
      802-1x.private-key-password s3cr3t</pre><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>要使用<span class="strong"><strong><span class="application">nmcli</span></strong></span>工具配置<code class="literal">wired</code>连接，请遵循与<code class="literal">wireless</code>连接相同的步骤，但<code class="literal">802-11-wireless.ssid</code>和<code class="literal">802-11-wireless-security</code> key-mgmt设置除外。
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring-network-bonding-using-nmcli_Configuring-Networking-with-nmcli"></a>使用nmcli配置网络绑定</h1></div></div></div><p>本节介绍网络绑定的基础知识，绑定和组合之间的区别，以及如何使用<code class="literal">nmcli</code>实用程序在Red Hat Enterprise Linux 8上配置网络绑定。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="understanding-network-bonding_configuring-network-bonding-using-nmcli"></a>了解网络绑定</h2></div></div></div><p>网络绑定是一种组合或聚合网络接口的方法，以提供具有更高吞吐量或冗余的逻辑接口。
				</p><p><code class="literal">active-backup</code> ， <code class="literal">balance-tlb</code>和<code class="literal">balance-alb</code>模式不需要网络交换机的任何特定配置。但是，其他绑定模式需要配置交换机以聚合链路。例如，Cisco交换机要求<code class="literal">EtherChannel</code>用于模式0,2和3，但对于模式4，则需要链路聚合控制协议（LACP）和<code class="literal">EtherChannel</code> 。
				</p><p>有关详细信息，请参阅交换机的文档和<a class="link" href="https://www.kernel.org/doc/Documentation/networking/bonding.txt">https://www.kernel.org/doc/Documentation/networking/bonding.txt</a> 。</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>某些网络绑定功能（例如故障转移机制）不支持没有网络交换机的直接电缆连接。有关更多详细信息，请参阅<a class="link" href="https://access.redhat.com/solutions/202583">使用交叉电缆直接连接是否支持粘接？</a> KCS解决方案。
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="understanding-the-default-behavior-of-master-and-slave-interfaces_configuring-network-bonding-using-nmcli"></a>了解主接口和从接口的默认行为</h2></div></div></div><p>在使用<code class="literal">NetworkManager</code>服务管理或修复团队或绑定端口接口时，请考虑以下默认行为：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">启动主接口不会自动启动端口接口。
						</li><li class="listitem">启动端口接口始终启动主接口。
						</li><li class="listitem">停止主接口也会停止端口接口。
						</li><li class="listitem">没有端口的主设备可以启动静态IP连接。
						</li><li class="listitem">启动DHCP连接时，没有端口的主站等待端口。
						</li><li class="listitem">添加端口与运营商时，具有等待端口的DHCP连接的主设备完成。
						</li><li class="listitem">当您添加没有运营商的端口时，具有等待端口的DHCP连接的主设备将继续等待。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="comparison-of-network-teaming-and-bonding-features_configuring-network-bonding-using-nmcli"></a>网络组合和绑定功能的比较</h2></div></div></div><p>下表比较了网络团队和网络绑定中支持的功能：</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th valign="top" style="text-align:left">特征</th><th valign="top" style="text-align:left">网络债券</th><th valign="top" style="text-align:left">网络团队</th></tr></thead><tbody><tr><td valign="top" style="text-align:left"> <p>广播Tx政策</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>循环Tx政策</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>主动备份Tx策略</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>LACP（802.3ad）支持</p>
								 </td><td valign="top" style="text-align:left"> <p>是（仅限活动）</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>基于哈希的Tx策略</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>用户可以设置哈希函数</p>
								 </td><td valign="top" style="text-align:left"> <p>没有</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>Tx负载平衡支持（TLB）</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>LACP哈希端口选择</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>LACP支持的负载平衡</p>
								 </td><td valign="top" style="text-align:left"> <p>没有</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>Ethtool链接监控</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>ARP链接监控</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>NS / NA（IPv6）链路监控</p>
								 </td><td valign="top" style="text-align:left"> <p>没有</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>端口上/下延迟</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>端口优先级和粘性（“主要”选项增强）</p>
								 </td><td valign="top" style="text-align:left"> <p>没有</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>单独的每端口链路监控设置</p>
								 </td><td valign="top" style="text-align:left"> <p>没有</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>多链路监控设置</p>
								 </td><td valign="top" style="text-align:left"> <p>有限</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>无锁Tx / Rx路径</p>
								 </td><td valign="top" style="text-align:left"> <p>不（rwlock）</p>
								 </td><td valign="top" style="text-align:left"> <p>是（RCU）</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>VLAN支持</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>用户空间运行时控制</p>
								 </td><td valign="top" style="text-align:left"> <p>有限</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>用户空间中的逻辑</p>
								 </td><td valign="top" style="text-align:left"> <p>没有</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>可扩展性</p>
								 </td><td valign="top" style="text-align:left"> <p>硬</p>
								 </td><td valign="top" style="text-align:left"> <p>简单</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>模块化设计</p>
								 </td><td valign="top" style="text-align:left"> <p>没有</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>性能开销</p>
								 </td><td valign="top" style="text-align:left"> <p>低</p>
								 </td><td valign="top" style="text-align:left"> <p>非常低</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>D-Bus接口</p>
								 </td><td valign="top" style="text-align:left"> <p>没有</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>多个设备堆叠</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>使用LLDP进行零配置</p>
								 </td><td valign="top" style="text-align:left"> <p>没有</p>
								 </td><td valign="top" style="text-align:left"> <p>（在计划中）</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>NetworkManager支持</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-a-network-bond-using-nmcli-commands_configuring-network-bonding-using-nmcli"></a>使用nmcli命令配置网络绑定</h2></div></div></div><p>本节介绍如何使用<code class="literal">nmcli</code>命令配置网络绑定。
				</p><h4><a id="prerequisites_20"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">服务器中安装了两个或多个网卡。
						</li><li class="listitem">网卡连接到交换机。
						</li></ul></div><h4><a id="procedure_18"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">创建绑定接口。例如，要创建使用<code class="literal">active-backup</code>模式的绑定接口，并且接口和连接都命名为<code class="literal">bond0</code> ，请输入：</p><pre class="literallayout"># nmcli connection add type bond con-name bond0 ifname bond0 bond.options "mode=active-backup"</pre><p class="simpara">要另外设置媒体独立接口（MII）监视间隔，请将<code class="literal">miimon= <span class="emphasis"><em>interval</em></span></code>选项添加到<code class="literal">bond.options</code>属性。例如，要使用相同的命令，但另外将MII监视间隔设置为<code class="literal">1000</code>毫秒（1秒），请输入：</p><pre class="literallayout"># nmcli connection add type bond con-name bond0 ifname bond0 bond.options "mode=active-backup,miimon=1000"</pre></li><li class="listitem"><p class="simpara">配置IPv4设置。例如，要将static IPv4地址，网络掩码，默认网关和DNS服务器设置为<code class="literal">bond0</code>连接，请输入：</p><pre class="literallayout"># nmcli connection modify bond0 ipv4.addresses '192.0.2.1/24'
# nmcli connection modify bond0 ipv4.gateway '192.0.2.254'
# nmcli connection modify bond0 ipv4.dns '192.0.2.253'
# nmcli connection modify bond0 ipv4.method manual</pre></li><li class="listitem"><p class="simpara">配置IPv6设置。例如，要设置<code class="literal">bond0</code>连接的静态IPv6地址，网络掩码，默认网关和DNS服务器，请输入：</p><pre class="literallayout"># nmcli connection modify bond0 ipv6.addresses '2001:db8::1/32
# nmcli connection modify bond0 ipv6.gateway '2001:db8::fffe'
# nmcli connection modify bond0 ipv6.dns '2001:db8::fffd'
# nmcli connection modify bond0 ipv6.method manual</pre></li><li class="listitem"><p class="simpara">（可选）显示网络接口，并记下计划添加到绑定的接口的名称：</p><pre class="literallayout"># # nmcli device
DEVICE  TYPE      STATE         CONNECTION
enp1s0  ethernet  connected     enp1s0
enp7s0  ethernet  disconnected  --
enp8s0  ethernet  disconnected  --
lo      loopback  unmanaged     --</pre></li><li class="listitem"><p class="simpara">将端口接口分配给绑定的连接。例如，要将名为<code class="literal">enp7s0</code>和<code class="literal">enp8s0</code>的接口添加到<code class="literal">bond0</code>连接：</p><pre class="literallayout"># nmcli connection add type ethernet slave-type bond con-name bond0-port1 ifname enp7s0 master bond0
# nmcli connection add type ethernet slave-type bond con-name bond0-port2 ifname enp8s0 master bond0</pre></li><li class="listitem"><p class="simpara">激活连接。例如，要激活<code class="literal">bond0</code>连接：</p><pre class="literallayout"># nmcli connection up bond0</pre></li><li class="listitem"><p class="simpara">验证从设备是否已连接， <code class="literal">CONNECTION</code>列显示从属设备的连接名称：</p><pre class="literallayout"># nmcli device
DEVICE   TYPE      STATE      CONNECTION
...
enp7s0   ethernet  connected  bond0-port1
enp8s0   ethernet  connected  bond0-port2</pre><p class="simpara">红帽企业Linux在系统启动时激活主设备和从设备。通过激活任何从属连接，也可以激活主站。但是，在这种情况下，只激活一个从属连接。默认情况下，激活主站不会自动激活从站。但是，您可以通过设置以下方式启用此行为：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">启用绑定连接的<code class="literal">connection.autoconnect-slaves</code>参数：</p><pre class="literallayout"># nmcli connection modify bond0 connection.autoconnect-slaves 1</pre></li><li class="listitem"><p class="simpara">重新激活桥：</p><pre class="literallayout"># nmcli connection up bond0</pre></li></ol></div></li><li class="listitem"><p class="simpara">（可选）显示债券的状态：</p><pre class="literallayout"># cat /proc/net/bonding/<span class="emphasis"><em>bond0</em></span>
Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011)

Bonding Mode: fault-tolerance (active-backup)
Primary Slave: None
Currently Active Slave: enp7s0
MII Status: up
MII Polling Interval (ms): 100
Up Delay (ms): 0
Down Delay (ms): 0

Slave Interface: enp7s0
MII Status: up
Speed: Unknown
Duplex: Unknown
Link Failure Count: 0
Permanent HW addr: 52:54:00:d5:e0:fb
Slave queue ID: 0

Slave Interface: enp8s0
MII Status: up
Speed: Unknown
Duplex: Unknown
Link Failure Count: 0
Permanent HW addr: 52:54:00:b2:e2:63
Slave queue ID: 0</pre><p class="simpara">在该示例中，两个端口都已启动。
						</p></li></ol></div><h4><a id="additional_resources_21"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关<code class="literal">nmcli</code>示例，请参见<code class="literal">nmcli-examples(7)</code>手册页。
						</li><li class="listitem">有关可在创建绑定时在<code class="literal">nmcli</code>命令的<code class="literal">bond.options</code>参数中设置的选项列表，请参阅<a class="link" href="https://www.kernel.org/doc/Documentation/networking/bonding.txt">https://www.kernel.org/doc/Documentation/networking/bonding.txt</a> 。</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring-a-network-bridge-using-nmcli-commands_Configuring-Networking-with-nmcli"></a>使用nmcli命令配置网桥</h1></div></div></div><p>本节介绍如何使用<code class="literal">nmcli</code>实用程序配置网桥。
			</p><p>网桥是一种链路层设备，它根据MAC地址在网络之间转发流量。桥设备基于MAC地址表决定转发包。网桥通过监听网络流量来构建MAC地址表，从而了解哪些主机连接到每个网络。
			</p><p>例如，您可以在Red Hat Enterprise Linux 8主机上使用软件桥：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">模拟硬件桥</li><li class="listitem">在虚拟化环境中，将虚拟机（VM）集成到与主机相同的网络中</li></ul></div><p>由于IEEE 802.11标准规定在Wi-Fi中使用3地址帧以有效使用通话时间，因此无法在Ad-Hoc或Infrastructure模式下运行的Wi-Fi网络上配置网桥。
			</p><h3><a id="prerequisites_21"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">服务器中安装了两个或多个物理或虚拟网络设备。
					</li><li class="listitem">您以<code class="literal">root</code>用户身份登录。
					</li></ul></div><h3><a id="procedure_19"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">创建桥接接口。例如，要创建名为<code class="literal">bridge0</code>的桥接接口，请输入：</p><pre class="literallayout"># nmcli connection add type bridge con-name bridge0 ifname bridge0</pre></li><li class="listitem"><p class="simpara">配置IPv4设置。例如，要设置<code class="literal">bridge0</code>连接的静态IPv4地址，网络掩码，默认网关和DNS服务器，请输入：</p><pre class="literallayout"># nmcli connection modify bridge0 ipv4.addresses '192.0.2.1/24'
# nmcli connection modify bridge0 ipv4.gateway '192.0.2.254'
# nmcli connection modify bridge0 ipv4.dns '192.0.2.253'
# nmcli connection modify bridge0 ipv4.method manual</pre></li><li class="listitem"><p class="simpara">配置IPv6设置。例如，要设置<code class="literal">bridge0</code>连接的静态IPv6地址，网络掩码，默认网关和DNS服务器，请输入：</p><pre class="literallayout"># nmcli connection modify bridge0 ipv6.addresses '2001:db8::1/32'
# nmcli connection modify bridge0 ipv6.gateway '2001:db8::fffe'
# nmcli connection modify bridge0 ipv6.dns '2001:db8::fffd'
# nmcli connection modify bridge0 ipv6.method manual</pre></li><li class="listitem"><p class="simpara">（可选）配置网桥的其他属性。例如，要将<code class="literal">bridge0</code>的生成树协议（STP）优先级设置为<code class="literal">16384</code> ，请输入：</p><pre class="literallayout"># nmcli connection modify bridge0 bridge.priority '16384'</pre><p class="simpara">默认情况下，启用STP。
					</p></li><li class="listitem"><p class="simpara">（可选）显示网络接口，并在下一步中记下要作为从属设备添加到网桥的接口的名称：</p><pre class="literallayout"># nmcli device
DEVICE  TYPE      STATE         CONNECTION
enp1s0  ethernet  connected     enp1s0
enp7s0  ethernet  disconnected  --
enp8s0  ethernet  disconnected  --
lo      loopback  unmanaged     --</pre></li><li class="listitem"><p class="simpara">将端口接口分配给网桥的连接。例如，要将名为<code class="literal">enp7s0</code>和<code class="literal">enp8s0</code>的接口添加到<code class="literal">bridge0</code>连接，请输入：</p><pre class="literallayout"># nmcli connection add type ethernet slave-type bridge con-name bridge0-port1 ifname enp7s0 master bridge0
# nmcli connection add type ethernet slave-type bridge con-name bridge0-port2 ifname enp8s0 master bridge0</pre></li><li class="listitem"><p class="simpara">激活连接。例如，要激活<code class="literal">bridge0</code>连接，请输入：</p><pre class="literallayout"># nmcli connection up bridge0</pre></li><li class="listitem"><p class="simpara">验证从设备是否已连接， <code class="literal">CONNECTION</code>列显示从属设备的连接名称：</p><pre class="literallayout"># nmcli  device
DEVICE   TYPE      STATE      CONNECTION
...
enp7s0   ethernet  connected  bridge0-port1
enp8s0   ethernet  connected  bridge0-port2</pre><p class="simpara">红帽企业Linux在系统启动时激活主设备和从设备。通过激活任何从属连接，也可以激活主站。但是，在这种情况下，只激活一个从属连接。默认情况下，激活主站不会自动激活从站。但是，您可以通过设置以下方式启用此行为：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">启用网桥连接的<code class="literal">connection.autoconnect-slaves</code>参数：</p><pre class="literallayout"># nmcli connection modify bridge0 connection.autoconnect-slaves 1</pre></li><li class="listitem"><p class="simpara">重新激活桥：</p><pre class="literallayout"># nmcli connection up bridge0</pre></li></ol></div></li><li class="listitem"><p class="simpara">（可选）使用以下命令显示网桥的状态：</p><pre class="literallayout"># bridge link show bridge0
3: enp7s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 master bridge0 state forwarding priority 32 cost 100
4: enp8s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 master bridge0 state listening priority 32 cost 100</pre></li></ol></div><h3><a id="additional_resources_22"></a>其他资源</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关<code class="literal">nmcli</code>示例，请参见<code class="literal">nmcli-examples(7)</code>手册页。
					</li><li class="listitem">有关您可以设置的所有网桥属性，请参阅<code class="literal">nm-settings(5)</code>手册页中的<code class="literal">bridge settings</code>部分。
					</li><li class="listitem">有关您可以设置的所有桥接端口属性，请参阅<code class="literal">nm-settings(5)</code>手册页中的<code class="literal">bridge-port settings</code>部分。
					</li><li class="listitem">有关<code class="literal">bridge</code>实用程序的详细信息，请参见<code class="literal">bridge(8)</code>手册页。
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring-network-teaming-using-nmcli_Configuring-Networking-with-nmcli"></a>使用nmcli配置网络组合</h1></div></div></div><p>本节介绍网络组合的基础知识，绑定和组合之间的差异，以及如何使用<code class="literal">nmcli</code>实用程序在Red Hat Enterprise Linux 8上配置网络团队。
			</p><h3><a id="prerequisites_22"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">安装了Red Hat Enterprise Linux 8。
					</li><li class="listitem">系统已分配有效订阅。
					</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="understanding-network-teaming_configuring-network-teaming-using-nmcli"></a>了解网络组合</h2></div></div></div><p>网络组合是一种组合或聚合网络接口的功能，可提供具有更高吞吐量或冗余的逻辑接口。
				</p><p>网络组合使用内核驱动程序来实现数据包流的快速处理，以及用于其他任务的用户空间库和服务。通过这种方式，网络组合是一种易于扩展且可扩展的解决方案，可用于负载平衡和冗余要求。
				</p><p>请注意，在网络组合的上下文中，术语<code class="literal">port</code>也称为<code class="literal">slave</code> 。在<code class="literal">teamd</code>服务中，术语<code class="literal">port</code>是首选，而在<code class="literal">NetworkManager</code>服务中，术语<code class="literal">slave</code>是指创建团队的接口。
				</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>某些网络组合功能（例如故障转移机制）不支持没有网络交换机的直接电缆连接。有关更多详细信息，请参阅<a class="link" href="https://access.redhat.com/solutions/202583">使用交叉电缆直接连接是否支持绑定？</a>
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="understanding-the-default-behavior-of-master-and-slave-interfaces_configuring-network-teaming-using-nmcli"></a>了解主接口和从接口的默认行为</h2></div></div></div><p>在使用<code class="literal">NetworkManager</code>服务管理或修复团队或绑定端口接口时，请考虑以下默认行为：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">启动主接口不会自动启动端口接口。
						</li><li class="listitem">启动端口接口始终启动主接口。
						</li><li class="listitem">停止主接口也会停止端口接口。
						</li><li class="listitem">没有端口的主设备可以启动静态IP连接。
						</li><li class="listitem">启动DHCP连接时，没有端口的主站等待端口。
						</li><li class="listitem">添加端口与运营商时，具有等待端口的DHCP连接的主设备完成。
						</li><li class="listitem">当您添加没有运营商的端口时，具有等待端口的DHCP连接的主设备将继续等待。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="comparison-of-network-teaming-and-bonding-features_configuring-network-teaming-using-nmcli"></a>网络组合和绑定功能的比较</h2></div></div></div><p>下表比较了网络团队和网络绑定中支持的功能：</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th valign="top" style="text-align:left">特征</th><th valign="top" style="text-align:left">网络债券</th><th valign="top" style="text-align:left">网络团队</th></tr></thead><tbody><tr><td valign="top" style="text-align:left"> <p>广播Tx政策</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>循环Tx政策</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>主动备份Tx策略</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>LACP（802.3ad）支持</p>
								 </td><td valign="top" style="text-align:left"> <p>是（仅限活动）</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>基于哈希的Tx策略</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>用户可以设置哈希函数</p>
								 </td><td valign="top" style="text-align:left"> <p>没有</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>Tx负载平衡支持（TLB）</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>LACP哈希端口选择</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>LACP支持的负载平衡</p>
								 </td><td valign="top" style="text-align:left"> <p>没有</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>Ethtool链接监控</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>ARP链接监控</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>NS / NA（IPv6）链路监控</p>
								 </td><td valign="top" style="text-align:left"> <p>没有</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>端口上/下延迟</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>端口优先级和粘性（“主要”选项增强）</p>
								 </td><td valign="top" style="text-align:left"> <p>没有</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>单独的每端口链路监控设置</p>
								 </td><td valign="top" style="text-align:left"> <p>没有</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>多链路监控设置</p>
								 </td><td valign="top" style="text-align:left"> <p>有限</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>无锁Tx / Rx路径</p>
								 </td><td valign="top" style="text-align:left"> <p>不（rwlock）</p>
								 </td><td valign="top" style="text-align:left"> <p>是（RCU）</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>VLAN支持</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>用户空间运行时控制</p>
								 </td><td valign="top" style="text-align:left"> <p>有限</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>用户空间中的逻辑</p>
								 </td><td valign="top" style="text-align:left"> <p>没有</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>可扩展性</p>
								 </td><td valign="top" style="text-align:left"> <p>硬</p>
								 </td><td valign="top" style="text-align:left"> <p>简单</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>模块化设计</p>
								 </td><td valign="top" style="text-align:left"> <p>没有</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>性能开销</p>
								 </td><td valign="top" style="text-align:left"> <p>低</p>
								 </td><td valign="top" style="text-align:left"> <p>非常低</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>D-Bus接口</p>
								 </td><td valign="top" style="text-align:left"> <p>没有</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>多个设备堆叠</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>使用LLDP进行零配置</p>
								 </td><td valign="top" style="text-align:left"> <p>没有</p>
								 </td><td valign="top" style="text-align:left"> <p>（在计划中）</p>
								 </td></tr><tr><td valign="top" style="text-align:left"> <p>NetworkManager支持</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td><td valign="top" style="text-align:left"> <p>是</p>
								 </td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="understanding-the-teamd-service-runners-and-link-watchers_configuring-network-teaming-using-nmcli"></a>了解团队服务，跑步者和链接观察者</h2></div></div></div><p><code class="literal">teamd</code>团队服务控制团队驱动程序的一个实例。此驱动程序实例添加硬件设备驱动程序的实例以形成网络接口团队。团队驱动程序向内核提供网络接口，例如<code class="literal">team0</code> 。
				</p><p><code class="literal">teamd</code>服务实现了所有团队合作方法的通用逻辑。这些功能是唯一的不同负载共享和备份的方法，如循环，并且通过被称为单独的代码单元实现<code class="literal">runners</code> 。管理员以JavaScript Object Notation（JSON）格式指定运行程序，并在创建实例时将JSON代码编译为<code class="literal">teamd</code>的实例。或者，使用<code class="literal">NetworkManager</code> ，可以在<code class="literal">team.runner</code>参数中设置runner， <code class="literal">NetworkManager</code>自动创建相应的JSON代码。
				</p><p>以下跑步者可用：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">broadcast</code> ：通过所有端口传输数据。
						</li><li class="listitem">
							<code class="literal">roundrobin</code> ：依次通过所有端口传输数据。
						</li><li class="listitem">
							<code class="literal">activebackup</code> ：通过一个端口传输数据，而其他端口保留为备份。
						</li><li class="listitem">
							<code class="literal">loadbalance</code> ：通过主动Tx负载均衡和基于Berkeley Packet Filter（BPF）的Tx端口选择器在所有端口上传输数据。
						</li><li class="listitem">
							<code class="literal">random</code> ：在随机选择的端口上传输数据。
						</li><li class="listitem">
							<code class="literal">lacp</code> ：实现802.3ad链路聚合控制协议（LACP）。
						</li></ul></div><p><code class="literal">teamd</code>服务使用链接监视器来监视从属设备的状态。以下链接观察者可用：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">ethtool</code> ： <code class="literal">libteam</code>库使用<code class="literal">ethtool</code>实用程序来监视链接状态更改。这是默认的链接监视器。
						</li><li class="listitem">
							<code class="literal">arp_ping</code> ： <code class="literal">libteam</code>库使用<code class="literal">arp_ping</code>实用程序使用地址解析协议（ARP）监视远端硬件地址的存在。
						</li><li class="listitem">
							<code class="literal">nsna_ping</code> ：在IPv6连接上， <code class="literal">libteam</code>库使用IPv6邻居发现协议中的Neighbor Advertisement和Neighbor Solicitation功能来监视邻居接口的存在。
						</li></ul></div><p>每个跑步者都可以使用任何链接观察者，但<code class="literal">lacp</code>除外。此跑步者只能使用<code class="literal">ethtool</code>链接观察者。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="installing-the-teamd-service_configuring-network-teaming-using-nmcli"></a>安装teamd服务</h2></div></div></div><p>要在<code class="literal">NetworkManager</code>配置网络团队，您需要<code class="literal">teamd</code>服务和<code class="literal">NetworkManager</code>的团队插件。两者都默认安装在Red Hat Enterprise Linux 8上。本节介绍如何在删除所需软件包时安装所需软件包。
				</p><h4><a id="prerequisites_23"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">已为主机分配活动的Red Hat订阅。
						</li></ul></div><h4><a id="procedure_20"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">安装<code class="literal">teamd</code>和<code class="literal">NetworkManager-team</code>软件包：</p><pre class="literallayout"># yum install teamd NetworkManager-team</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-a-network-team-using-nmcli-commands_configuring-network-teaming-using-nmcli"></a>使用nmcli命令配置网络团队</h2></div></div></div><p>本节介绍如何使用<code class="literal">nmcli</code>命令配置网络组。
				</p><h4><a id="prerequisites_24"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">服务器中安装了两个或多个网卡。
						</li><li class="listitem">网卡连接到交换机。
						</li></ul></div><h4><a id="procedure_21"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">创建团队界面。例如，要创建使用<code class="literal">activebackup</code> runner以及名为<code class="literal">team0</code>的接口和连接的团队接口，请输入：</p><pre class="literallayout"># nmcli connection add type team con-name team0 ifname team0 team.runner activebackup</pre></li><li class="listitem"><p class="simpara">（可选）设置链接监视器。例如，要设置<code class="literal">ethtool</code>链接观察程序，请修改<code class="literal">team0</code>连接：</p><pre class="literallayout"># nmcli connection modify team0 team.link-watchers "name=ethtool"</pre><p class="simpara">链接观察者支持不同的参数。要为链接监视器设置参数，请在<code class="literal">name</code>属性中以空格分隔它们。请注意，name属性必须用引号括起来。例如，要使用<code class="literal">ethtool</code>链接观察程序并将其<code class="literal">delay-up</code>参数设置为<code class="literal">2500</code>毫秒（2.5秒）：</p><pre class="literallayout"># nmcli connection modify team0 team.link-watchers "name=ethtool delay-up=2500"</pre><p class="simpara">要设置多个链接监视器，并且每个链接监视器都具有特定参数，链接监视器必须用逗号分隔。以下示例使用<code class="literal">delay-up</code>参数设置<code class="literal">ethtool</code>链接监视器，使用<code class="literal">source-host</code>和<code class="literal">target-host</code>参数设置<code class="literal">arp_ping</code>链接监视器：</p><pre class="literallayout"># nmcli connection modify team0 team.link-watchers "name=ethtool delay-up=2, name=arp_ping source-host=192.0.2.1 target-host=192.0.2.2"</pre></li><li class="listitem"><p class="simpara">配置IPv4设置。例如，要设置<code class="literal">team0</code>连接的静态IPv4地址，网络掩码，默认网关和DNS服务器，请输入：</p><pre class="literallayout"># nmcli connection modify team0 ipv4.addresses '192.0.2.1/24'
# nmcli connection modify team0 ipv4.gateway '192.0.2.254'
# nmcli connection modify team0 ipv4.dns '192.0.2.253'
# nmcli connection modify team0 ipv4.method manual</pre></li><li class="listitem"><p class="simpara">配置IPv6设置。例如，要设置<code class="literal">team0</code>连接的静态IPv6地址，网络掩码，默认网关和DNS服务器，请输入：</p><pre class="literallayout"># nmcli connection modify team0 ipv6.addresses '2001:db8::1/32'
# nmcli connection modify team0 ipv6.gateway '2001:db8::fffe'
# nmcli connection modify team0 ipv6.dns '2001:db8::fffd'
# nmcli connection modify team0 ipv6.method manual</pre></li><li class="listitem"><p class="simpara">（可选）显示网络接口，并在下一步中记下要添加到团队的接口的名称：</p><pre class="literallayout"># nmcli device
DEVICE  TYPE      STATE         CONNECTION
enp1s0  ethernet  connected     enp1s0
enp7s0  ethernet  disconnected  --
enp8s0  ethernet  disconnected  --
lo      loopback  unmanaged     --</pre><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>您只能在团队中使用未分配给任何连接的网络接口。在上面的示例中，您只能使用<code class="literal">enp7s0</code>和<code class="literal">enp8s0</code>接口。
							</p></div></li><li class="listitem"><p class="simpara">将端口接口分配给团队的连接。例如，要将名为<code class="literal">enp7s0</code>和<code class="literal">enp8s0</code>的接口添加到<code class="literal">team0</code>连接：</p><pre class="literallayout"># nmcli connection add type ethernet slave-type team con-name team0-port1 ifname enp7s0 master team0
# nmcli connection add type ethernet slave-type team con-name team0-port2 ifname enp8s0 master team0</pre></li><li class="listitem"><p class="simpara">激活连接。例如，要激活<code class="literal">team0</code>连接：</p><pre class="literallayout"># nmcli connection up team0</pre></li><li class="listitem"><p class="simpara">（可选）显示团队的状态：</p><pre class="literallayout"># teamdctl team0 state
setup:
  runner: activebackup
ports:
  enp7s0
    link watches:
      link summary: up
      instance[link_watch_0]:
        name: ethtool
        link: up
        down count: 0
  enp8s0
    link watches:
      link summary: up
      instance[link_watch_0]:
        name: ethtool
        link: up
        down count: 0
runner:
  active port: enp7s0</pre><p class="simpara">在该示例中，两个端口都已启动。
						</p></li></ol></div><h4><a id="additional_resources_23"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="xref" href="Configuring-Networking-with-nmcli_configuring-and-managing-networking.html#understanding-the-teamd-service-runners-and-link-watchers_configuring-network-teaming-using-nmcli" title="了解团队服务，跑步者和链接观察者">“理解团队服务，跑步者和链接观察者”一节</a> 。
						</li><li class="listitem">有关<code class="literal">nmcli</code>示例，请参见<code class="literal">nmcli-examples(7)</code>手册页。
						</li><li class="listitem">对于您可以设置的所有团队属性，请参阅<code class="literal">nm-settings(5)</code>手册页中的<code class="literal">team</code>部分。
						</li><li class="listitem">有关可以在JSON配置中设置的参数以及JSON示例，请参见<code class="literal">teamd.conf(5)</code>手册页。
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring-vlan-tagging-using-nmcli-commands_Configuring-Networking-with-nmcli"></a>使用nmcli命令配置VLAN标记</h1></div></div></div><p>本节介绍如何使用<code class="literal">nmcli</code>命令配置虚拟局域网（VLAN）标记。VLAN是物理网络中的逻辑网络。VLAN接口在通过接口时标记具有VLAN ID的数据包，并删除返回数据包的标记。
			</p><p>您可以在另一个接口（如以太网，绑定，团队或网桥）之上创建VLAN接口。此接口称为<code class="literal">parent interface</code> 。
			</p><h3><a id="prerequisites_25"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">您计划用作虚拟VLAN接口的父接口的接口支持VLAN标记。
					</li><li class="listitem"><p class="simpara">如果在绑定接口之上配置VLAN：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">债券的奴隶正在兴起。
							</li><li class="listitem">未使用<code class="literal">fail_over_mac=follow</code>选项配置<code class="literal">fail_over_mac=follow</code> 。VLAN虚拟设备无法更改其MAC地址以匹配父级的新MAC地址。在这种情况下，流量仍将与当时不正确的源MAC地址一起发送。
							</li></ul></div></li><li class="listitem">主机连接的交换机配置为支持VLAN标记。有关详细信息，请参阅交换机的文档。
					</li></ul></div><h3><a id="procedure_22"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">（可选）显示可用的网络接口：</p><pre class="literallayout"># ip address show
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: enp1s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 52:54:00:d5:e0:fb brd ff:ff:ff:ff:ff:ff</pre></li><li class="listitem"><p class="simpara">创建VLAN接口例如，创建一个VLAN接口名为<code class="literal">vlan10</code>使用<code class="literal">enp1s0</code>作为其父接口和标签用VLAN ID的报文<code class="literal">10</code> ，请输入：</p><pre class="literallayout"># nmcli connection add type vlan con-name vlan10 ifname vlan10 vlan.parent enp1s0 vlan.id 10</pre><p class="simpara">请注意，VLAN必须在<code class="literal">0</code>到<code class="literal">4094</code>的范围内。
					</p></li><li class="listitem"><p class="simpara">默认情况下，VLAN连接从父接口继承最大传输单元（MTU）。（可选）设置不同的MTU值：</p><pre class="literallayout"># nmcli connection modify vlan10 802-3-ethernet.mtu <span class="emphasis"><em>2000</em></span></pre></li><li class="listitem"><p class="simpara">配置IPv4设置。例如，要将静态IPv4地址，网络掩码，默认网关和DNS服务器设置为<code class="literal">vlan10</code>连接，请输入：</p><pre class="literallayout"># nmcli connection modify vlan10 ipv4.addresses '192.0.2.1/24'
# nmcli connection modify vlan10 ipv4.gateway '192.0.2.254'
# nmcli connection modify vlan10 ipv4.dns '192.0.2.253'
# nmcli connection modify vlan10 ipv4.method manual</pre></li><li class="listitem"><p class="simpara">配置IPv6设置。例如，要将静态IPv6地址，网络掩码，默认网关和DNS服务器设置为<code class="literal">vlan10</code>连接，请输入：</p><pre class="literallayout"># nmcli connection modify vlan10 ipv6.addresses '2001:db8::1/32'
# nmcli connection modify vlan10 ipv6.gateway '2001:db8::fffe'
# nmcli connection modify vlan10 ipv6.dns '2001:db8::fffd'
# nmcli connection modify vlan10 ipv6.method manual</pre></li><li class="listitem"><p class="simpara">（可选）验证设置：</p><pre class="literallayout"># ip -d addr show <span class="emphasis"><em>vlan10</em></span>
4: vlan10@enp1s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 52:54:00:d5:e0:fb brd ff:ff:ff:ff:ff:ff promiscuity 0
    vlan protocol 802.1Q id 10 &lt;REORDER_HDR&gt; numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535
    inet 192.0.2.1/24 brd 192.0.2.255 scope global noprefixroute vlan10
       valid_lft forever preferred_lft forever
    inet6 fe80::8dd7:9030:6f8e:89e6/64 scope link noprefixroute
       valid_lft forever preferred_lft forever</pre></li></ol></div><h3><a id="additional_resources_24"></a>其他资源</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关<code class="literal">nmcli</code>示例，请参见<code class="literal">nmcli-examples(7)</code>手册页。
					</li><li class="listitem">有关您可以设置的所有vlan属性，请参阅<code class="literal">nm-settings(5)</code>手册页中的<code class="literal">vlan setting</code>部分。
					</li></ul></div></div></div></body></html>