<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 维护VDO</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 维护VDO</h1></div></div></div><p>部署VDO卷后，您可以执行某些任务来维护或优化它。VDO卷的正常运行需要执行以下某些任务。
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="prerequisites-maintaining-vdo"></a>先决条件</h1></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">已安装和部署VDO。请参见<a class="xref" href="deploying-vdo_deduplicating-and-compressing-storage.html" title="Chapter 9. 部署VDO">第1章， <em>部署VDO</em></a> 。</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="managing-free-space-on-vdo-volumes_maintaining-vdo"></a>管理VDO卷上的可用空间</h1></div></div></div><p>VDO是精简配置的块存储目标。因此，您必须主动监视和管理VDO卷上的空间使用情况。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="thin-provisioning-in-vdo_managing-free-space-on-vdo-volumes"></a> VDO中的精简配置</h2></div></div></div><p>VDO是精简配置的块存储目标。VDO卷使用的物理空间量可能与呈现给存储用户的卷大小不同。
				</p><p>您可以利用这种差异来节省存储成本。如果写入的数据未达到预期的优化速率，请注意避免意外耗尽存储空间。
				</p><p>每当逻辑块（虚拟存储）的数量超过物理块的数量（实际存储）时，文件系统和应用程序就可能意外地耗尽空间。因此，使用VDO的存储系统必须为您提供监视VDO卷上空闲池大小的方法。
				</p><p>您可以使用<code class="literal">vdostats</code>实用程序确定此空闲池的大小。此实用程序的默认输出以类似于Linux <code class="literal">df</code>实用程序的格式列出所有正在运行的VDO卷的信息。例如：</p><pre class="screen">Device              1K-blocks   Used        Available   Use%
/dev/mapper/my-vdo  211812352   105906176   105906176     50%</pre><p>当VDO卷的物理存储容量几乎已满时，VDO会在系统日志中报告警告，类似于以下内容：</p><pre class="screen">Oct  2 17:13:39 system lvm[13863]: Monitoring VDO pool my-vdo.
Oct  2 17:27:39 system lvm[13863]: WARNING: VDO pool my-vdo is now 80.69% full.
Oct  2 17:28:19 system lvm[13863]: WARNING: VDO pool my-vdo is now 85.25% full.
Oct  2 17:29:39 system lvm[13863]: WARNING: VDO pool my-vdo is now 90.64% full.
Oct  2 17:30:29 system lvm[13863]: WARNING: VDO pool my-vdo is now 96.07% full.</pre><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>仅当<code class="literal">lvm2-monitor</code>服务正在运行时，才会显示这些警告消息。它默认启用。
					</p></div><p>如果空闲池的大小低于某个级别，您可以通过以下方式采取措施：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">删除数据。每当删除的数据不重复时，这将回收空间。删除数据仅在丢弃发布后释放空间。
						</li><li class="listitem">添加物理存储</li><li class="listitem">删除VDO之上的LUN</li></ul></div><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>监视VDO卷上的物理空间以防止出现空间不足的情况。耗尽物理块可能会导致VDO卷上最近写入的未经确认的数据丢失。
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_monitoring-vdo_managing-free-space-on-vdo-volumes"></a>监控VDO</h2></div></div></div><p>此过程描述如何从VDO卷获取使用率和效率信息。
				</p><h4><a id="prerequisites_4"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">安装VDO软件。请参阅<a class="xref" href="deploying-vdo_deduplicating-and-compressing-storage.html#proc_installing-vdo-deploying-vdo" title="安装VDO">“安装VDO”一节</a> 。
						</li></ul></div><h4><a id="procedure_6"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">使用<code class="literal">vdostats</code>实用程序获取有关VDO卷的信息：</p><pre class="screen"># vdostats --human-readable

Device                   1K-blocks    Used     Available    Use%    Space saving%
/dev/mapper/node1osd1    926.5G       21.0G    905.5G       2%      73%
/dev/mapper/node1osd2    926.5G       28.2G    898.3G       3%      64%</pre></li></ul></div><h4><a id="additional_resources_6"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">vdostats(8)</code>手册页。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="reclaiming-space-for-vdo-on-file-systems_managing-free-space-on-vdo-volumes"></a>在文件系统上回收VDO的空间</h2></div></div></div><p>此过程回收承载文件系统的VDO卷上的存储空间。
				</p><p>VDO无法回收空间，除非文件系统使用<code class="literal">DISCARD</code> ， <code class="literal">TRIM</code>或<code class="literal">UNMAP</code>命令通信这些块是空闲的。
				</p><h4><a id="procedure_7"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">如果VDO卷上的文件系统支持丢弃操作，请启用它们。请参阅<a class="xref" href="discarding-unused-blocks_deduplicating-and-compressing-storage.html" title="Chapter 9. 丢弃未使用的块">第3章， <em>丢弃未使用的块</em></a> 。
						</li><li class="listitem">对于不使用<code class="literal">DISCARD</code> ， <code class="literal">TRIM</code>或<code class="literal">UNMAP</code>文件系统，您可以手动回收可用空间。存储包含二进制零的文件，然后删除该文件。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="reclaiming-space-for-vdo-without-a-file-system_managing-free-space-on-vdo-volumes"></a>在没有文件系统的情况下回收VDO的空间</h2></div></div></div><p>此过程回收VDO卷上的存储空间，该VDO卷用作没有文件系统的块存储目标。
				</p><h4><a id="procedure_8"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">使用<code class="literal">blkdiscard</code>实用程序。
						</p><p class="simpara">例如，通过在其上部署LVM，可以将单个VDO卷划分为多个子卷。在取消配置逻辑卷之前，请使用<code class="literal">blkdiscard</code>实用程序释放该逻辑卷以前使用的空间。
						</p><p class="simpara">LVM支持<code class="literal">REQ_DISCARD</code>命令，并将请求转发到适当的逻辑块地址的VDO，以释放空间。如果使用其他卷管理器，则还需要支持<code class="literal">REQ_DISCARD</code> ，或者等效地，支持用于SCSI设备的<code class="literal">UNMAP</code>或用于ATA设备的<code class="literal">TRIM</code> 。
						</p></li></ul></div><h4><a id="additional_resources_7"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">blkdiscard(8)</code>手册页</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="reclaiming-space-for-vdo-on-fibre-channel-or-ethernet-network_managing-free-space-on-vdo-volumes"></a>回收光纤通道或以太网上的VDO空间</h2></div></div></div><p>此过程回收使用SCSI目标框架（如LIO或SCST）配置到光纤通道存储结构或以太网网络上的主机的VDO卷（或卷的某些部分）上的存储空间。</p><h4><a id="procedure_9"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">SCSI启动器可以使用<code class="literal">UNMAP</code>命令释放精简配置的存储目标上的空间，但需要配置SCSI目标框架以通告对此命令的支持。这通常通过在这些卷上启用精简配置来完成。
						</p><p class="simpara">通过运行以下命令验证对基于Linux的SCSI启动器上的<code class="literal">UNMAP</code>支持：</p><pre class="screen"># sg_vpd --page=0xb0 /dev/<span class="emphasis"><em><span class="replaceable">device</span></em></span></pre><p class="simpara">在输出中，验证<span class="emphasis"><em>Maximum unmap LBA计</em></span>数值是否大于零。
						</p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="starting-or-stopping-vdo-volumes_maintaining-vdo"></a>启动或停止VDO卷</h1></div></div></div><p>您可以启动或停止给定的VDO卷或所有VDO卷及其关联的UDS索引。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="started-and-activated-vdo-volumes_starting-or-stopping-vdo-volumes"></a>启动并激活VDO卷</h2></div></div></div><p>在系统引导期间， <code class="literal">vdo</code> <code class="literal">systemd</code>单元自动<span class="emphasis"><em>启动</em></span>配置为已<span class="emphasis"><em>激活的</em></span>所有VDO设备。
				</p><p>安装<code class="literal">vdo</code>软件包时，默认情况下会安装并启用<code class="literal">vdo</code> <code class="literal">systemd</code>单元。此单元在系统启动时自动运行<code class="literal">vdo start --all</code>命令以显示所有已激活的VDO卷。
				</p><p>您还可以通过向<code class="literal">--activate=disabled</code> <code class="literal">vdo create</code>命令添加<code class="literal">--activate=disabled</code>选项来<code class="literal">vdo create</code>不会自动启动的VDO卷。
				</p><p>某些系统可能将LVM卷置于VDO卷之上且低于VDO卷之下。在这些系统上，有必要以正确的顺序启动服务：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">LVM的下层必须首先启动。在大多数系统中，安装LVM软件包时会自动配置启动此层。
						</li><li class="listitem">然后必须启动<code class="literal">vdo</code> <code class="literal">systemd</code>单元。
						</li><li class="listitem">最后，必须运行其他脚本才能在运行的VDO卷之上启动LVM卷或其他服务。
						</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="starting-a-vdo-volume_starting-or-stopping-vdo-volumes"></a>启动VDO卷</h2></div></div></div><p>此过程将启动系统上的给定VDO卷或所有VDO卷。
				</p><h4><a id="procedure_10"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要启动给定的VDO卷，请使用：</p><pre class="screen"># vdo start --name=<span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span></pre></li><li class="listitem"><p class="simpara">要启动所有VDO卷，请使用：</p><pre class="screen"># vdo start --all</pre></li></ul></div><h4><a id="additional_resources_8"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">vdo(8)</code>手册页</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="stopping-a-vdo-volume_starting-or-stopping-vdo-volumes"></a>停止VDO卷</h2></div></div></div><p>此过程将停止系统上的给定VDO卷或所有VDO卷。
				</p><h4><a id="procedure_11"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要停止给定的VDO卷，请使用：</p><pre class="screen"># vdo stop --name=<span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span></pre></li><li class="listitem"><p class="simpara">要停止所有VDO卷，请使用：</p><pre class="screen"># vdo stop --all</pre></li></ul></div><h4><a id="additional_resources_9"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">vdo(8)</code>手册页</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="related-information-starting-or-stopping-vdo-volumes"></a>相关信息</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">如果在不正常关闭后重新启动，则VDO会执行重建以验证其元数据的一致性，并在必要时进行修复。有关重建过程的详细信息，请参阅<a class="xref" href="maintaining-vdo_deduplicating-and-compressing-storage.html#recovering-a-vdo-volume-after-an-unclean-shutdown_maintaining-vdo" title="在不干净关闭后恢复VDO卷">“在不正常关闭后恢复VDO卷”一节</a> 。
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="automatically-starting-vdo-volumes-at-system-boot_maintaining-vdo"></a>在系统引导时自动启动VDO卷</h1></div></div></div><p>您可以配置VDO卷，以便它们在系统引导时自动启动。您也可以禁用自动启动。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="started-and-activated-vdo-volumes_automatically-starting-vdo-volumes-at-system-boot"></a>启动并激活VDO卷</h2></div></div></div><p>在系统引导期间， <code class="literal">vdo</code> <code class="literal">systemd</code>单元自动<span class="emphasis"><em>启动</em></span>配置为已<span class="emphasis"><em>激活的</em></span>所有VDO设备。
				</p><p>安装<code class="literal">vdo</code>软件包时，默认情况下会安装并启用<code class="literal">vdo</code> <code class="literal">systemd</code>单元。此单元在系统启动时自动运行<code class="literal">vdo start --all</code>命令以显示所有已激活的VDO卷。
				</p><p>您还可以通过向<code class="literal">--activate=disabled</code> <code class="literal">vdo create</code>命令添加<code class="literal">--activate=disabled</code>选项来<code class="literal">vdo create</code>不会自动启动的VDO卷。
				</p><p>某些系统可能将LVM卷置于VDO卷之上且低于VDO卷之下。在这些系统上，有必要以正确的顺序启动服务：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">LVM的下层必须首先启动。在大多数系统中，安装LVM软件包时会自动配置启动此层。
						</li><li class="listitem">然后必须启动<code class="literal">vdo</code> <code class="literal">systemd</code>单元。
						</li><li class="listitem">最后，必须运行其他脚本才能在运行的VDO卷之上启动LVM卷或其他服务。
						</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="activating-a-vdo-volume_automatically-starting-vdo-volumes-at-system-boot"></a>激活VDO卷</h2></div></div></div><p>此过程激活VDO卷以使其自动启动。
				</p><h4><a id="procedure_12"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要激活特定卷：</p><pre class="screen"># vdo activate --name=<span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span></pre></li><li class="listitem"><p class="simpara">要激活所有卷：</p><pre class="screen"># vdo activate --all</pre></li></ul></div><h4><a id="additional_resources_10"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">vdo(8)</code>手册页</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="deactivating-a-vdo-volume_automatically-starting-vdo-volumes-at-system-boot"></a>停用VDO卷</h2></div></div></div><p>此过程将停用VDO卷以防止其自动启动。
				</p><h4><a id="procedure_13"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要停用特定卷：</p><pre class="screen"># vdo deactivate --name=<span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span></pre></li><li class="listitem"><p class="simpara">要停用所有卷：</p><pre class="screen"># vdo deactivate --all</pre></li></ul></div><h4><a id="additional_resources_11"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">vdo(8)</code>手册页</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="selecting-a-vdo-write-mode_maintaining-vdo"></a>选择VDO写入模式</h1></div></div></div><p>您可以根据底层块设备的要求为VDO卷配置写入模式。默认情况下，VDO自动选择写入模式。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="vdo-write-modes_selecting-a-vdo-write-mode"></a> VDO写入模式</h2></div></div></div><p>VDO支持以下写入模式：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">同步</code></span></dt><dd><p class="simpara">当VDO处于<code class="literal">sync</code>模式时，其上方的层假定写入命令将数据写入持久存储。因此，例如，文件系统或应用程序不必发出FLUSH或强制单元访问（FUA）请求以使数据在关键点处变得持久。
							</p><p class="simpara">仅当基础存储保证在写入命令完成时将数据写入永久存储器时，才必须将VDO设置为<code class="literal">sync</code>模式。也就是说，存储必须要么没有易失性写高速缓存，要么具有直写高速缓存。
							</p></dd><dt><span class="term"><code class="literal">异步</code></span></dt><dd><p class="simpara">当VDO处于<code class="literal">async</code>模式时，VDO不保证在确认写入命令时将数据写入永久存储器。文件系统或应用程序必须发出FLUSH或FUA请求，以确保每个事务中关键点的数据持久性。
							</p><p class="simpara">如果底层存储无法保证在write命令完成时将数据写入持久存储，则必须将VDO设置为<code class="literal">async</code>模式;也就是说，当存储具有易失性写回缓存时。
							</p><div class="warning" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">警告</h3><p>当VDO以<code class="literal">async</code>模式运行时，它不符合原子性，一致性，隔离，持久性（ACID）。如果应用程序或文件系统假定在VDO卷之上符合ACID，则<code class="literal">async</code>模式可能会导致意外数据丢失。
								</p></div></dd><dt><span class="term"><code class="literal">汽车</code></span></dt><dd><code class="literal">auto</code>模式根据每个设备的特性自动选择<code class="literal">sync</code>或<code class="literal">async</code> 。这是默认选项。
							</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="the-internal-processing-of-vdo-write-modes_selecting-a-vdo-write-mode"></a> VDO写入模式的内部处理</h2></div></div></div><p>本节提供有关<code class="literal">sync</code>和<code class="literal">async</code> VDO写入模式如何操作的详细信息。
				</p><p>如果<code class="literal">kvdo</code>模块以同步模式运行：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">它暂时将请求中的数据写入分配的块，然后确认请求。</li><li class="listitem">确认完成后，尝试通过计算块数据的MurmurHash-3签名来对块进行重复数据删除，该签名被发送到VDO索引。
						</li><li class="listitem">如果VDO索引包含具有相同签名的块的条目，则<code class="literal">kvdo</code>读取指示的块并对这两个块进行逐字节比较以验证它们是否相同。
						</li><li class="listitem">如果它们确实相同，则<code class="literal">kvdo</code>更新其块映射，以便逻辑块指向相应的物理块并释放分配的物理块。
						</li><li class="listitem">如果VDO索引不包含正在写入的块的签名的条目，或者指示的块实际上不包含相同的数据，则<code class="literal">kvdo</code>更新其块映射以使临时物理块永久化。
						</li></ol></div><p>如果<code class="literal">kvdo</code>在异步模式下运行：</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">它将立即确认该请求，而不是写入数据。</li><li class="listitem">然后，它将尝试以与上述相同的方式对块进行重复删除。
						</li><li class="listitem">如果该块变为重复，则<code class="literal">kvdo</code>更新其块映射并释放分配的块。否则，它将请求中的数据写入分配的块并更新块映射以使物理块永久化。
						</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="checking-the-write-mode-on-a-vdo-volume_selecting-a-vdo-write-mode"></a>检查VDO卷上的写入模式</h2></div></div></div><p>此过程列出了所选VDO卷上的活动写入模式。
				</p><h4><a id="procedure_14"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">使用以下命令查看VDO卷使用的写入模式：</p><pre class="screen"># vdo status --name=<span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span></pre><p class="simpara">输出列表：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="emphasis"><em>配置的写入策略</em></span> ，是从<code class="literal">sync</code> ， <code class="literal">async</code>或<code class="literal">auto</code>选择的选项
								</li><li class="listitem"><span class="emphasis"><em>写策略</em></span> ，是VDO应用的特定写入模式，即<code class="literal">sync</code>或<code class="literal">async</code>
								</li></ul></div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="checking-for-a-volatile-cache_selecting-a-vdo-write-mode"></a>检查易失性缓存</h2></div></div></div><p>此过程确定块设备是否具有易失性高速缓存。您可以使用该信息在<code class="literal">sync</code>和<code class="literal">async</code> VDO写入模式之间进行选择。
				</p><h4><a id="procedure_15"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">使用以下任一方法确定设备是否具有写回缓存：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">读取<code class="literal">/sys/block/ <span class="emphasis"><em><span class="replaceable">block-device</span></em></span> /device/scsi_disk/ <span class="emphasis"><em><span class="replaceable">identifier</span></em></span> /cache_type</code> <code class="literal">sysfs</code>文件。例如：</p><pre class="screen">$ cat '/sys/block/sda/device/scsi_disk/7:0:0:0/cache_type'

write back</pre><pre class="screen">$ cat '/sys/block/sdb/device/scsi_disk/1:2:0:0/cache_type'

None</pre></li><li class="listitem"><p class="simpara">或者，您可以在内核引导日志中找到上述设备是否具有写入缓存：</p><pre class="screen">sd 7:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA
sd 1:2:0:0: [sdb] Write cache: disabled, read cache: disabled, supports DPO and FUA</pre></li></ul></div></li><li class="listitem"><p class="simpara">在前面的例子中：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">设备<code class="literal">sda</code>表示它<span class="emphasis"><em>具有</em></span>写回缓存。使用<code class="literal">async</code>模式。
								</li><li class="listitem">设备<code class="literal">sdb</code>表示它<span class="emphasis"><em>没有</em></span>写回缓存。使用<code class="literal">sync</code>模式。
								</li></ul></div><p class="simpara">您应该配置VDO使用<code class="literal">sync</code> ，如果写模式<code class="literal">cache_type</code>值是<code class="literal">None</code>或<code class="literal">write through</code> 。
						</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="setting-a-vdo-write-mode_selecting-a-vdo-write-mode"></a>设置VDO写入模式</h2></div></div></div><p>此过程为VDO卷设置写入模式，既可以是现有卷，也可以是创建新卷。
				</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>使用不正确的写入模式可能会在电源故障，系统崩溃或任何意外丢失与磁盘的联系后导致数据丢失。
					</p></div><h4><a id="prerequisites_5"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">确定您的设备的写入模式是否正确。请参阅<a class="xref" href="maintaining-vdo_deduplicating-and-compressing-storage.html#checking-for-a-volatile-cache_selecting-a-vdo-write-mode" title="检查易失性缓存">“检查易失性缓存”一节</a> 。
						</li></ul></div><h4><a id="procedure_16"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">您可以在现有VDO卷上或创建新卷时设置写入模式：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要修改现有VDO卷，请使用：</p><pre class="screen"># vdo changeWritePolicy --writePolicy=<span class="emphasis"><em><span class="replaceable">sync|async|auto</span></em></span> \
                        --name=<span class="emphasis"><em><span class="replaceable">vdo-name</span></em></span></pre></li><li class="listitem">要在创建VDO卷时指定写入模式，请在<code class="literal">--writePolicy= <span class="emphasis"><em><span class="replaceable">sync|async|auto</span></em></span></code> <code class="literal">vdo create</code>命令中添加<code class="literal">--writePolicy= <span class="emphasis"><em><span class="replaceable">sync|async|auto</span></em></span></code>选项。
								</li></ul></div></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="recovering-a-vdo-volume-after-an-unclean-shutdown_maintaining-vdo"></a>在不干净关闭后恢复VDO卷</h1></div></div></div><p>您可以在不干净关闭后恢复VDO卷，以使其能够继续运行。任务主要是自动化的。此外，由于进程失败，您可以在VDO卷创建失败后进行清理。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="vdo-write-modes_recovering-a-vdo-volume-after-an-unclean-shutdown"></a> VDO写入模式</h2></div></div></div><p>VDO支持以下写入模式：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">同步</code></span></dt><dd><p class="simpara">当VDO处于<code class="literal">sync</code>模式时，其上方的层假定写入命令将数据写入持久存储。因此，例如，文件系统或应用程序不必发出FLUSH或强制单元访问（FUA）请求以使数据在关键点处变得持久。
							</p><p class="simpara">仅当基础存储保证在写入命令完成时将数据写入永久存储器时，才必须将VDO设置为<code class="literal">sync</code>模式。也就是说，存储必须要么没有易失性写高速缓存，要么具有直写高速缓存。
							</p></dd><dt><span class="term"><code class="literal">异步</code></span></dt><dd><p class="simpara">当VDO处于<code class="literal">async</code>模式时，VDO不保证在确认写入命令时将数据写入永久存储器。文件系统或应用程序必须发出FLUSH或FUA请求，以确保每个事务中关键点的数据持久性。
							</p><p class="simpara">如果底层存储无法保证在write命令完成时将数据写入持久存储，则必须将VDO设置为<code class="literal">async</code>模式;也就是说，当存储具有易失性写回缓存时。
							</p><div class="warning" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">警告</h3><p>当VDO以<code class="literal">async</code>模式运行时，它不符合原子性，一致性，隔离，持久性（ACID）。如果应用程序或文件系统假定在VDO卷之上符合ACID，则<code class="literal">async</code>模式可能会导致意外数据丢失。
								</p></div></dd><dt><span class="term"><code class="literal">汽车</code></span></dt><dd><code class="literal">auto</code>模式根据每个设备的特性自动选择<code class="literal">sync</code>或<code class="literal">async</code> 。这是默认选项。
							</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="vdo-volume-recovery_recovering-a-vdo-volume-after-an-unclean-shutdown"></a> VDO卷恢复</h2></div></div></div><p>在不正常关闭后重新启动VDO卷时，VDO会执行以下操作：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">验证卷上元数据的一致性。
						</li><li class="listitem">如有必要，重建部分元数据以进行修复。
						</li></ul></div><p>重建是自动的，不需要用户干预。
				</p><p>VDO可能会根据活动写入模式重建不同的写入：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">同步</code></span></dt><dd>如果VDO在同步存储上运行且写入策略设置为<code class="literal">sync</code> ，则写入卷的所有数据都将完全恢复。
							</dd><dt><span class="term"><code class="literal">异步</code></span></dt><dd>如果写入策略是<code class="literal">async</code> ，则如果某些写入不是持久的，则可能无法恢复。这是通过向VDO发送<code class="literal">FLUSH</code>命令或用FUA（强制单元访问）标记标记的写I / O来完成的。您可以通过调用<code class="literal">fsync</code> ， <code class="literal">fdatasync</code> ， <code class="literal">sync</code>或<code class="literal">umount</code>等数据完整性操作从用户模式完成此操作。
							</dd></dl></div><p>在任一模式下，某些未确认或未执行刷新的写入也可能会重建。
				</p><h4><a id="online_recovery"></a>在线恢复</h4><p>通常，在VDO卷重新联机后，VDO可以完成重建不洁VDO卷的大部分工作。VDO在卷处理读写请求时执行重建。
				</p><p>在线恢复会导致临时限制：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">最初，卷上可用于写入请求的空间量可能会受到限制。随着更多元数据的恢复，更多可用空间变得可用。
						</li><li class="listitem">VDO卷恢复时写入的数据可能无法对崩溃前写入的数据进行重复数据删除，如果该数据位于尚未恢复的卷的一部分中。VDO可以在恢复音量时压缩数据。您仍然可以读取或覆盖压缩块。
						</li><li class="listitem">在联机恢复期间，某些统计信息不可用：例如， <span class="emphasis"><em>正在使用的</em></span> <span class="emphasis"><em>块</em></span>和<span class="emphasis"><em>可用的块</em></span> 。重建完成后，这些统计信息可用。
						</li></ul></div><h4><a id="forced_rebuild"></a>强迫重建</h4><p>如果VDO无法成功恢复VDO卷，则会将卷置于只读模式，该模式会在卷重新启动后保持不变。
				</p><p>卷处于只读模式后，无法保证数据没有丢失或损坏。在这种情况下，Red Hat建议将数据从只读卷中复制出来，并可能从备份中恢复卷。
				</p><p>如果数据损坏的风险可以接受，则可以强制脱机重建VDO卷元数据，以便可以使卷恢复联机并使其可用。无法保证重建数据的完整性。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="recovering-a-vdo-volume-online_recovering-a-vdo-volume-after-an-unclean-shutdown"></a>在线恢复VDO卷</h2></div></div></div><p>此过程在VDO卷上执行联机恢复，以在不正常关闭后恢复元数据。
				</p><h4><a id="procedure_17"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">如果尚未启动VDO卷，请启动它：</p><pre class="screen"># vdo start --name=<span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span></pre><p class="simpara">无需其他步骤。恢复在后台运行。
						</p></li><li class="listitem">如果您依赖于<span class="emphasis"><em>正在使用的</em></span> <span class="emphasis"><em>块</em></span>和<span class="emphasis"><em>块免费的</em></span>卷统计信息，请等待它们可用。
						</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="forcing-an-offline-rebuild-of-a-vdo-volume-metadata_recovering-a-vdo-volume-after-an-unclean-shutdown"></a>强制脱机重建VDO卷元数据</h2></div></div></div><p>此过程执行VDO卷元数据的强制脱机重建，以在不正常关闭后恢复。
				</p><div class="warning" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">警告</h3><p>此过程可能会导致卷上的数据丢失。
					</p></div><h4><a id="prerequisites_6"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">VDO卷已启动。
						</li></ul></div><h4><a id="procedure_18"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">检查卷是否处于只读模式。请参阅命令输出中的<span class="emphasis"><em>操作模式</em></span>属性：</p><pre class="screen"># vdo status --name=<span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span></pre><p class="simpara">如果卷不是只读模式，则无需强制进行脱机重建。执行在线恢复，如<a class="xref" href="maintaining-vdo_deduplicating-and-compressing-storage.html#recovering-a-vdo-volume-online_recovering-a-vdo-volume-after-an-unclean-shutdown" title="Recovering a VDO volume online">“在线恢复VDO卷”一节</a>中<a class="xref" href="maintaining-vdo_deduplicating-and-compressing-storage.html#recovering-a-vdo-volume-online_recovering-a-vdo-volume-after-an-unclean-shutdown" title="在线恢复VDO卷">所述</a> 。
						</p></li><li class="listitem"><p class="simpara">如果卷正在运行，请停止该卷：</p><pre class="screen"># vdo stop --name=<span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span></pre></li><li class="listitem"><p class="simpara">使用<code class="literal">--forceRebuild</code>选项重新启动卷：</p><pre class="screen"># vdo start --name=<span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span> --forceRebuild</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="removing-an-unsuccessfully-created-vdo-volume_recovering-a-vdo-volume-after-an-unclean-shutdown"></a>删除未成功创建的VDO卷</h2></div></div></div><p>此过程清除处于中间状态的VDO卷。如果在创建卷时发生故障，则卷将处于中间状态。例如，这可能发生在：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">系统崩溃了</li><li class="listitem">电源故障</li><li class="listitem">管理员中断正在运行的<code class="literal">vdo create</code>命令</li></ul></div><h4><a id="procedure_19"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要清理，请使用<code class="literal">--force</code>选项删除未成功创建的卷：</p><pre class="screen"># vdo remove --force --name=<span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span></pre><p class="simpara"><code class="literal">--force</code>选项是必需的，因为管理员可能通过更改系统配置而导致冲突，因为卷创建失败。
						</p><p class="simpara">如果没有<code class="literal">--force</code>选项，则<code class="literal">vdo remove</code>命令将失败，并显示以下消息：</p><pre class="screen">[...]
A previous operation failed.
Recovery from the failure either failed or was interrupted.
Add '--force' to 'remove' to perform the following cleanup.
Steps to clean up VDO <span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span>:
umount -f /dev/mapper/<span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span>
udevadm settle
dmsetup remove <span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span>
vdo: ERROR - VDO volume <span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span> previous operation (create) is incomplete</pre></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="optimizing-the-uds-index_maintaining-vdo"></a>优化UDS指数</h1></div></div></div><p>您可以配置UDS索引的某些设置以在系统上对其进行优化。
			</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>创建VDO卷<span class="emphasis"><em>后</em></span> ，无法更改UDS索引的属性。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="the-uds-index_optimizing-the-uds-index"></a> UDS指数</h2></div></div></div><p>VDO使用称为UDS的高性能重复数据删除索引来检测存储时的重复数据块。
				</p><p>UDS索引提供了VDO产品的基础。对于每个新数据，它可以快速确定该部分是否与先前存储的任何数据相同。如果索引找到匹配，则存储系统可以在内部引用现有项目以避免多次存储相同的信息。
				</p><p>UDS索引在内核中作为<code class="literal">uds</code>内核模块运行。
				</p><p><span class="emphasis"><em>重复数据删除窗口</em></span>是索引记住的先前写入的块的数量。重复数据删除窗口的大小是可配置的。对于给定的窗口大小，索引需要特定数量的RAM和特定数量的磁盘空间。窗口的大小通常通过使用<code class="literal">--indexMem=size</code>选项指定索引内存的大小来确定。然后，VDO确定自动使用的磁盘空间量。
				</p><p>UDS指数由两部分组成：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">在存储器中使用紧凑表示，每个唯一块最多包含一个条目。
						</li><li class="listitem">磁盘上的组件，按顺序记录在索引发生时显示的相关块名称。
						</li></ul></div><p>UDS在内存中每个条目平均使用4个字节，包括缓存。
				</p><p>磁盘上组件维护传递给UDS的有限数据历史记录。 UDS为属于此重复数据删除窗口的数据提供重复数据删除建议，其中包含最近看到的块的名称。重复数据删除窗口允许UDS尽可能有效地索引数据，同时限制索引大型数据存储库所需的内存量。尽管重复数据删除窗口具有有限的性质，但大多数具有高重复数据删除级别的数据集也表现出高度的时间局部性 - 换句话说，大多数重复数据删除发生在几乎同时写入的块集之间。此外，通常，正在写入的数据更可能复制最近写入的数据而不是很久以前写入的数据。因此，对于给定时间间隔内的给定工作负载，无论UDS仅索引最新数据还是所有数据，重复数据删除率通常都是相同的。
				</p><p>由于重复数据往往表现出时间局部性，因此很少需要索引存储系统中的每个块。如果不是这样，索引内存的成本将超过重复数据删除所节省的存储成本。索引大小要求与数据摄取率更密切相关。例如，考虑一个总容量为100 TB但每周摄取率为1 TB的存储系统。通过4 TB的重复数据删除窗口，UDS可以检测上个月内写入的数据中的大多数冗余。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="recommended-uds-index-configuration_optimizing-the-uds-index"></a>推荐的UDS索引配置</h2></div></div></div><p>本节根据您的预期用例介绍了与UDS索引一起使用的建议选项。
				</p><p>通常，Red Hat建议对所有生产用例使用<span class="strong"><strong>稀疏</strong></span> UDS索引。这是一种非常有效的索引数据结构，在重复数据删除窗口中每块需要大约十分之一字节的DRAM。在磁盘上，每个块大约需要72个字节的磁盘空间。此索引的最低配置使用256 MB的DRAM和大约25 GB的磁盘空间。
				</p><p>要使用此配置，请为<code class="literal">--sparseIndex=enabled --indexMem=0.25</code> <code class="literal">vdo create</code>命令指定<code class="literal">--sparseIndex=enabled --indexMem=0.25</code>选项。此配置导致重复数据删除窗口为2.5 TB（这意味着它将记住2.5 TB的历史记录）。对于大多数用例，2.5 TB的重复数据删除窗口适用于重复数据删除大小达10 TB的存储池。
				</p><p>但是，索引的默认配置是使用<span class="strong"><strong>密集</strong></span>索引。该指数在DRAM中的效率相当低（10倍），但它具有更低的（也是10倍）所需的最小磁盘空间，使得在受限环境中进行评估更加方便。
				</p><p>通常，重复数据删除窗口是VDO卷物理大小的四分之一是推荐配置。但是，这不是实际要求。即使是小型重复数据删除窗口（与物理存储量相比），在许多用例中也会发现大量重复数据。也可以使用更大的窗户，但在大多数情况下，这样做几乎没有额外的好处。
				</p><h4><a id="additional_resources_12"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">请与您的红帽技术客户经理代表联系，获取有关调整此重要系统参数的其他指导。
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="enabling-or-disabling-deduplication-in-vdo_maintaining-vdo"></a>在VDO中启用或禁用重复数据删除</h1></div></div></div><p>在某些情况下，您可能希望暂时禁用正在写入VDO卷的数据的重复数据删除，同时仍保留读取和写入卷的功能。禁用重复数据删除可防止后续写入被重复数据删除，但已经过重复数据删除的数据仍然如此。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="deduplication-in-vdo_enabling-or-disabling-deduplication-in-vdo"></a> VDO中的重复数据删除</h2></div></div></div><p>重复数据删除是一种通过消除重复块的多个副本来减少存储资源消耗的技术。
				</p><p>VDO不是一次写入相同的数据，而是检测每个重复的块并将其记录为对原始块的引用。VDO维护从VDO上方的存储层使用的逻辑块地址到VDO下的存储层使用的物理块地址的映射。</p><p>在重复数据删除之后，可以将多个逻辑块地址映射到相同的物理块地址。这些被称为共享块。块共享对于存储的用户是不可见的，如果VDO不存在，则读取和写入块。
				</p><p>当覆盖共享块时，VDO分配用于存储新块数据的新物理块，以确保不修改映射到共享物理块的其他逻辑块地址。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="enabling-deduplication-on-a-vdo-volume_enabling-or-disabling-deduplication-in-vdo"></a>在VDO卷上启用重复数据删除</h2></div></div></div><p>此过程将重新启动关联的UDS索引，并通知VDO卷重复数据删除再次处于活动状态。
				</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>默认情况下启用重复数据删除。
					</p></div><h4><a id="procedure_20"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要在VDO卷上重新启动重复数据删除，请使用以下命令：</p><pre class="screen"># vdo enableDeduplication <span class="emphasis"><em><span class="replaceable">--name=my-vdo</span></em></span></pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="disabling-deduplication-on-a-vdo-volume_enabling-or-disabling-deduplication-in-vdo"></a>禁用VDO卷上的重复数据删除</h2></div></div></div><p>此过程将停止关联的UDS索引，并通知VDO卷重复数据删除不再处于活动状态。
				</p><h4><a id="procedure_21"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要停止VDO卷上的重复数据删除，请使用以下命令：</p><pre class="screen"># vdo disableDeduplication <span class="emphasis"><em><span class="replaceable">--name=my-vdo</span></em></span></pre></li><li class="listitem">您还可以通过在<code class="literal">--deduplication=disabled</code> <code class="literal">vdo create</code>命令中添加<code class="literal">--deduplication=disabled</code>选项来创建新的VDO卷时禁用重复数据删除。
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="enabling-or-disabling-compression-in-vdo_maintaining-vdo"></a>在VDO中启用或禁用压缩</h1></div></div></div><p>VDO提供数据压缩。您可以禁用它以最大限度地提高性能或加速处理不太可能压缩的数据，或重新启用它以增加空间节省。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="compression-in-vdo_enabling-or-disabling-compression-in-vdo"></a> VDO中的压缩</h2></div></div></div><p>除块级重复数据删除外，VDO还使用HIOPS Compression™技术提供内联块级压缩。
				</p><p>默认情况下，VDO卷压缩已启用。
				</p><p>虽然重复数据删除是虚拟机环境和备份应用程序的最佳解决方案，但压缩对于通常不会出现块级冗余的结构化和非结构化文件格式（例如日志文件和数据库）非常有效。
				</p><p>压缩对尚未识别为重复的块进行操作。当VDO第一次看到唯一数据时，它会压缩数据。已经存储的后续数据副本将进行重复数据删除，无需额外的压缩步骤。
				</p><p>压缩功能基于并行打包算法，使其能够同时处理多个压缩操作。在首次存储块并响应请求者之后，最适合的打包算法找到多个块，当压缩时，这些块可以适合单个物理块。在确定特定物理块不可能保持附加压缩块之后，将其写入存储器并释放和重用未压缩块。
				</p><p>通过在已经响应请求者之后执行压缩和打包操作，使用压缩会产生最小的延迟惩罚。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="enabling-compression-on-a-vdo-volume_enabling-or-disabling-compression-in-vdo"></a>在VDO卷上启用压缩</h2></div></div></div><p>此过程可在VDO卷上进行压缩，从而节省空间。
				</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>默认情况下启用压缩。
					</p></div><h4><a id="procedure_22"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要再次启动它，请使用以下命令：</p><pre class="screen"># vdo enableCompression --name=<span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span></pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="disabling-compression-on-a-vdo-volume_enabling-or-disabling-compression-in-vdo"></a>禁用VDO卷上的压缩</h2></div></div></div><p>此过程将停止VDO卷上的压缩，以最大限度地提高性能或加速处理不太可能压缩的数据。
				</p><h4><a id="procedure_23"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要在现有VDO卷上停止压缩，请使用以下命令：</p><pre class="screen"># vdo disableCompression --name=<span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span></pre></li><li class="listitem">或者，您可以通过在创建新卷时向<code class="literal">vdo create</code>命令添加<code class="literal">--compression=disabled</code>选项来禁用压缩。
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="increasing-the-size-of-a-vdo-volume_maintaining-vdo"></a>增加VDO卷的大小</h1></div></div></div><p>您可以增加VDO卷的物理大小以利用更多底层存储容量，或使用逻辑大小来提供卷上的更多容量。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="thin-provisioning-in-vdo_increasing-the-size-of-a-vdo-volume"></a> VDO中的精简配置</h2></div></div></div><p>VDO是精简配置的块存储目标。VDO卷使用的物理空间量可能与呈现给存储用户的卷大小不同。
				</p><p>您可以利用这种差异来节省存储成本。如果写入的数据未达到预期的优化速率，请注意避免意外耗尽存储空间。
				</p><p>每当逻辑块（虚拟存储）的数量超过物理块的数量（实际存储）时，文件系统和应用程序就可能意外地耗尽空间。因此，使用VDO的存储系统必须为您提供监视VDO卷上空闲池大小的方法。
				</p><p>您可以使用<code class="literal">vdostats</code>实用程序确定此空闲池的大小。此实用程序的默认输出以类似于Linux <code class="literal">df</code>实用程序的格式列出所有正在运行的VDO卷的信息。例如：</p><pre class="screen">Device              1K-blocks   Used        Available   Use%
/dev/mapper/my-vdo  211812352   105906176   105906176     50%</pre><p>当VDO卷的物理存储容量几乎已满时，VDO会在系统日志中报告警告，类似于以下内容：</p><pre class="screen">Oct  2 17:13:39 system lvm[13863]: Monitoring VDO pool my-vdo.
Oct  2 17:27:39 system lvm[13863]: WARNING: VDO pool my-vdo is now 80.69% full.
Oct  2 17:28:19 system lvm[13863]: WARNING: VDO pool my-vdo is now 85.25% full.
Oct  2 17:29:39 system lvm[13863]: WARNING: VDO pool my-vdo is now 90.64% full.
Oct  2 17:30:29 system lvm[13863]: WARNING: VDO pool my-vdo is now 96.07% full.</pre><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>仅当<code class="literal">lvm2-monitor</code>服务正在运行时，才会显示这些警告消息。它默认启用。
					</p></div><p>如果空闲池的大小低于某个级别，您可以通过以下方式采取措施：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">删除数据。每当删除的数据不重复时，这将回收空间。删除数据仅在丢弃发布后释放空间。
						</li><li class="listitem">添加物理存储</li><li class="listitem">删除VDO之上的LUN</li></ul></div><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>监视VDO卷上的物理空间以防止出现空间不足的情况。耗尽物理块可能会导致VDO卷上最近写入的未经确认的数据丢失。
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="increasing-the-logical-size-of-a-vdo-volume_increasing-the-size-of-a-vdo-volume"></a>增加VDO卷的逻辑大小</h2></div></div></div><p>此过程会增加给定VDO卷的逻辑大小。它使您能够最初创建具有足够小的逻辑大小的VDO卷，以防止空间不足。经过一段时间后，您可以评估实际的数据减少速率，如果足够，您可以增加VDO卷的逻辑大小，以利用空间节省。
				</p><p>无法减小VDO卷的逻辑大小。
				</p><h4><a id="procedure_24"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要增加逻辑大小，请使用：</p><pre class="screen"># vdo growLogical --name=<span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span> \
                  --vdoLogicalSize=<span class="emphasis"><em><span class="replaceable">new-logical-size</span></em></span></pre><p class="simpara">当逻辑大小增加时，VDO会在新大小的卷上通知任何设备或文件系统。
						</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="increasing-the-physical-size-of-a-vdo-volume_increasing-the-size-of-a-vdo-volume"></a>增加VDO卷的物理大小</h2></div></div></div><p>此过程会增加VDO卷可用的物理存储量。
				</p><p>以这种方式缩小VDO卷是不可能的。
				</p><h4><a id="prerequisites_7"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">底层块设备的容量大于VDO卷的当前物理大小。
						</p><p class="simpara">如果没有，您可以尝试增加设备的大小。确切的过程取决于设备的类型。例如，要调整MBR或GPT分区的<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/managing_storage_devices/assembly_getting-started-with-partitions_managing-storage-devices#assembly_resizing-a-partition_assembly_getting-started-with-partitions">大小</a> ，请参阅“ <span class="emphasis"><em>管理存储设备”</em></span>指南中的“ <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/managing_storage_devices/assembly_getting-started-with-partitions_managing-storage-devices#assembly_resizing-a-partition_assembly_getting-started-with-partitions">调整分区大小”</a>部分。
						</p></li></ul></div><h4><a id="procedure_25"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">将新的物理存储空间添加到VDO卷：</p><pre class="screen"># vdo growPhysical --name=<span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span></pre></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="removing-vdo-volumes_maintaining-vdo"></a>删除VDO卷</h1></div></div></div><p>您可以删除系统上的现有VDO卷。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="removing-a-working-vdo-volume_removing-vdo-volumes"></a>删除正在运行的VDO卷</h2></div></div></div><p>此过程将删除VDO卷及其关联的UDS索引。
				</p><h4><a id="procedure_26"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem">卸载文件系统并停止使用VDO卷上的存储的应用程序。
						</li><li class="listitem"><p class="simpara">要从系统中删除VDO卷，请使用：</p><pre class="screen"># vdo remove --name=<span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span></pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="removing-an-unsuccessfully-created-vdo-volume_removing-vdo-volumes"></a>删除未成功创建的VDO卷</h2></div></div></div><p>此过程清除处于中间状态的VDO卷。如果在创建卷时发生故障，则卷将处于中间状态。例如，这可能发生在：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">系统崩溃了</li><li class="listitem">电源故障</li><li class="listitem">管理员中断正在运行的<code class="literal">vdo create</code>命令</li></ul></div><h4><a id="procedure_27"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要清理，请使用<code class="literal">--force</code>选项删除未成功创建的卷：</p><pre class="screen"># vdo remove --force --name=<span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span></pre><p class="simpara"><code class="literal">--force</code>选项是必需的，因为管理员可能通过更改系统配置而导致冲突，因为卷创建失败。
						</p><p class="simpara">如果没有<code class="literal">--force</code>选项，则<code class="literal">vdo remove</code>命令将失败，并显示以下消息：</p><pre class="screen">[...]
A previous operation failed.
Recovery from the failure either failed or was interrupted.
Add '--force' to 'remove' to perform the following cleanup.
Steps to clean up VDO <span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span>:
umount -f /dev/mapper/<span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span>
udevadm settle
dmsetup remove <span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span>
vdo: ERROR - VDO volume <span class="emphasis"><em><span class="replaceable">my-vdo</span></em></span> previous operation (create) is incomplete</pre></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="related-information-maintaining-vdo"></a>相关信息</h1></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">您可以使用<span class="strong"><strong>Ansible</strong></span>工具自动执行VDO部署和管理。有关详情，请参阅：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Ansible文档： <a class="link" href="https://docs.ansible.com/">https</a> ：//docs.ansible.com/
							</li><li class="listitem">VDO Ansible模块文档： <a class="link" href="https://docs.ansible.com/ansible/latest/modules/vdo_module.html">https</a> ：//docs.ansible.com/ansible/latest/modules/vdo_module.html
							</li></ul></div></li></ul></div></div></div></body></html>