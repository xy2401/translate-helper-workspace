<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 使用Stratis管理分层本地存储</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 使用Stratis管理分层本地存储</h1></div></div></div><p>您可以轻松设置和管理Stratis高级系统集成的复杂存储配置。
		</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>Stratis可作为技术预览版提供。有关Red Hat <a class="link" href="https://access.redhat.com/support/offerings/techpreview">技术预览功能支持范围的</a>信息，请参阅<a class="link" href="https://access.redhat.com/support/offerings/techpreview">技术预览功能支持范围</a>文档。
			</p><p>鼓励部署Stratis的客户向Red Hat提供反馈。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="setting-up-stratis-file-systems_managing-layered-local-storage-with-stratis"></a>设置Stratis文件系统</h1></div></div></div><p>作为系统管理员，您可以在系统上启用和设置Stratis卷管理文件系统，以轻松管理分层存储。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="the-purpose-and-features-of-stratis_setting-up-stratis-file-systems"></a> Stratis的目的和特点</h2></div></div></div><p>Stratis是Linux的本地存储管理解决方案。它专注于简单性和易用性，并允许您访问高级存储功能。
				</p><p>Stratis使以下活动更容易：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">存储的初始配置</li><li class="listitem">稍后进行更改</li><li class="listitem">使用高级存储功能</li></ul></div><p>Stratis是一个混合的用户和内核本地存储管理系统，支持高级存储功能。Stratis的核心概念是存储<span class="emphasis"><em>池</em></span> 。此池是从一个或多个本地磁盘或分区创建的，并且从池中创建卷。
				</p><p>该池支持许多有用的功能，例如：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">文件系统快照</li><li class="listitem">精简配置</li><li class="listitem">分层</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="components-of-a-stratis-volume_setting-up-stratis-file-systems"></a> Stratis卷的组成部分</h2></div></div></div><p>在外部，Stratis在命令行界面和API中显示以下卷组件：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">blockdev</code></span></dt><dd>阻止设备，例如磁盘或磁盘分区。
							</dd><dt><span class="term"><code class="literal">pool</code></span></dt><dd><p class="simpara">由一个或多个块设备组成。
							</p><p class="simpara">池具有固定的总大小，等于块设备的大小。
							</p><p class="simpara">该池包含大多数Stratis层，例如使用<code class="literal">dm-cache</code>目标的非易失性数据缓存。
							</p><p class="simpara">Stratis为每个池创建一个<code class="literal">/stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/</code>目录。此目录包含指向池中Stratis文件系统的设备的链接。
							</p></dd></dl></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">filesystem</code></span></dt><dd><p class="simpara">每个池可以包含一个或多个存储文件的文件系统。
							</p><p class="simpara">文件系统是精简配置的，并且没有固定的总大小。文件系统的实际大小随着存储在其上的数据而增长。如果数据大小接近文件系统的虚拟大小，Stratis会自动增大精简卷和文件系统。
							</p><p class="simpara">文件系统使用XFS格式化。</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>Stratis跟踪有关使用XFS不知道的Stratis创建的文件系统的信息，使用XFS进行的更改不会自动在Stratis中创建更新。用户不得重新格式化或重新配置由Stratis管理的XFS文件系统。
								</p></div><p class="simpara">Stratis在<code class="literal">/stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs</span></em></span></code>路径创建指向文件系统的链接。
							</p></dd></dl></div><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>Stratis使用许多Device Mapper设备，这些设备显示在<code class="literal">dmsetup</code>列表和<code class="literal">/proc/partitions</code>文件中。同样， <code class="literal">lsblk</code>命令输出反映了Stratis的内部工作和层。
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="block-devices-usable-with-stratis_setting-up-stratis-file-systems"></a>块设备可与Stratis一起使用</h2></div></div></div><p>本节列出了可用于Stratis的存储设备。
				</p><h4><a id="supported_devices"></a>支持的设备</h4><p>Stratis池已经过测试，适用于这些类型的块设备：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">LUKS</li><li class="listitem">LVM逻辑卷</li><li class="listitem">MDRAID</li><li class="listitem">DM多路径</li><li class="listitem">iSCSI的</li><li class="listitem">硬盘驱动器和固态硬盘</li><li class="listitem">NVMe设备</li></ul></div><div class="warning" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">警告</h3><p>在当前版本中，Stratis不处理硬盘驱动器或其他硬件中的故障。如果在多个硬件设备上创建Stratis池，则会增加数据丢失的风险，因为必须有多个设备才能访问数据。
					</p></div><h4><a id="unsupported_devices"></a>不支持的设备</h4><p>由于Stratis包含精简配置层，因此Red Hat不建议将Stratis池放置在已经精简配置的块设备上。
				</p><h4><a id="additional_resources_43"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">对于需要网络的iSCSI和其他块设备，请参见<code class="literal">systemd.mount(5)</code>手册页以获取有关<code class="literal">_netdev</code>挂载选项的信息。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="installing-stratis_setting-up-stratis-file-systems"></a>安装Stratis</h2></div></div></div><p>此过程将安装使用Stratis所需的所有软件包。
				</p><h4><a id="procedure_46"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">安装提供Stratis服务和命令行实用程序的包：</p><pre class="screen"># yum install stratisd stratis-cli</pre></li><li class="listitem"><p class="simpara">确保已启用<code class="literal">stratisd</code>服务：</p><pre class="screen"># systemctl enable --now stratisd</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-a-stratis-pool_setting-up-stratis-file-systems"></a>创建一个Stratis池</h2></div></div></div><p>此过程从一个或多个块设备创建Stratis池。
				</p><h4><a id="prerequisites_17"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Stratis已安装。请参阅<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="安装Stratis">“安装Stratis”一节</a> 。
						</li><li class="listitem"><code class="literal">stratisd</code>服务正在运行。
						</li><li class="listitem">您正在创建Stratis池的块设备未使用且未安装。
						</li><li class="listitem">您在其上创建Stratis池的块设备的大小至少为1 GiB。
						</li><li class="listitem"><p class="simpara">在IBM Z体系结构中，必须对<code class="literal">/dev/dasd*</code>块设备进行分区。使用Stratis池中的分区。
						</p><p class="simpara">有关分区DASD设备的信息，请参阅<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/performing_a_standard_rhel_installation/configuring-a-linux-instance-on-ibm-z_installing-rhel">在IBM Z上配置Linux实例</a> 。</p></li></ul></div><h4><a id="procedure_47"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">如果所选块设备包含文件系统，分区表或RAID签名，请将其擦除：</p><pre class="screen"># wipefs --all <span class="emphasis"><em><span class="replaceable">block-device</span></em></span></pre><p class="simpara">将<span class="emphasis"><em><span class="replaceable">块设备</span></em></span>替换为<span class="emphasis"><em><span class="replaceable">块设备</span></em></span>的路径，例如<code class="literal">/dev/sdb</code> 。
						</p></li><li class="listitem"><p class="simpara">要在块设备上创建Stratis池，请使用：</p><pre class="screen"># stratis pool create <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> <span class="emphasis"><em><span class="replaceable">block-device</span></em></span></pre><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">用<span class="emphasis"><em><span class="replaceable">池</span></em></span>的任意名称替换<span class="emphasis"><em><span class="replaceable">my-</span></em></span> pool。
								</li><li class="listitem">将<span class="emphasis"><em><span class="replaceable">块设备</span></em></span>替换为空块或擦除块设备的路径，例如<code class="literal">/dev/sdb</code> 。
								</li></ul></div><p class="simpara">要从多个块设备创建池，请在命令行中列出所有池：</p><pre class="screen"># stratis pool create <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> <span class="emphasis"><em><span class="replaceable">device-1</span></em></span> <span class="emphasis"><em><span class="replaceable">device-2</span></em></span> <span class="emphasis"><em><span class="replaceable">device-n</span></em></span></pre></li><li class="listitem"><p class="simpara">要验证，请列出系统上的所有池：</p><pre class="screen"># stratis pool list</pre></li></ol></div><h4><a id="additional_resources_44"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">stratis(8)</code>手册页</li></ul></div><h4><a id="next_steps_2"></a>下一步</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">在池上创建Stratis文件系统。请参阅<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#creating-a-stratis-file-system_setting-up-stratis-file-systems" title="创建Stratis文件系统">“创建Stratis文件系统”一节</a> 。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-a-stratis-file-system_setting-up-stratis-file-systems"></a>创建Stratis文件系统</h2></div></div></div><p>此过程在现有Stratis池上创建Stratis文件系统。
				</p><h4><a id="prerequisites_18"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Stratis已安装。请参阅<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="安装Stratis">“安装Stratis”一节</a> 。
						</li><li class="listitem"><code class="literal">stratisd</code>服务正在运行。
						</li><li class="listitem">您已经创建了一个Stratis池。请参阅<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#creating-a-stratis-pool_setting-up-stratis-file-systems" title="创建一个Stratis池">“创建Stratis池”一节</a> 。
						</li></ul></div><h4><a id="procedure_48"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要在池上创建Stratis文件系统，请使用：</p><pre class="screen"># stratis fs create <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs</span></em></span></pre><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">将<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>替换为现有Stratis池的名称。
								</li><li class="listitem">用文件系统的任意名称替换<span class="emphasis"><em><span class="replaceable">my-fs</span></em></span> 。
								</li></ul></div></li><li class="listitem"><p class="simpara">要验证，请列出池中的文件系统：</p><pre class="screen"># stratis fs list <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span></pre></li></ol></div><h4><a id="additional_resources_45"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">stratis(8)</code>手册页</li></ul></div><h4><a id="next_steps_3"></a>下一步</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">挂载Stratis文件系统。请参阅<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#mounting-a-stratis-file-system_setting-up-stratis-file-systems" title="安装Stratis文件系统">“安装Stratis文件系统”一节</a> 。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mounting-a-stratis-file-system_setting-up-stratis-file-systems"></a>安装Stratis文件系统</h2></div></div></div><p>此过程安装现有的Stratis文件系统以访问内容。
				</p><h4><a id="prerequisites_19"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Stratis已安装。请参阅<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="安装Stratis">“安装Stratis”一节</a> 。
						</li><li class="listitem"><code class="literal">stratisd</code>服务正在运行。
						</li><li class="listitem">您已经创建了一个Stratis文件系统。请参阅<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#creating-a-stratis-file-system_setting-up-stratis-file-systems" title="创建Stratis文件系统">“创建Stratis文件系统”一节</a> 。
						</li></ul></div><h4><a id="procedure_49"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要安装文件系统，请使用Stratis在<code class="literal">/stratis/</code>目录中维护的条目：</p><pre class="screen"># mount /stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs</span></em></span> <span class="emphasis"><em><span class="replaceable">mount-point</span></em></span></pre></li></ul></div><p>文件系统现在已安装在<span class="emphasis"><em><span class="replaceable">mount-point</span></em></span>目录中并可供使用。
				</p><h4><a id="additional_resources_46"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">mount(8)</code>手册页</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="persistently-mounting-a-stratis-file-system_setting-up-stratis-file-systems"></a>持久安装Stratis文件系统</h2></div></div></div><p>此过程持久地安装Stratis文件系统，以便在引导系统后自动可用。
				</p><h4><a id="prerequisites_20"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Stratis已安装。请参阅<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="安装Stratis">“安装Stratis”一节</a> 。
						</li><li class="listitem"><code class="literal">stratisd</code>服务正在运行。
						</li><li class="listitem">您已经创建了一个Stratis文件系统。请参阅<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#creating-a-stratis-file-system_setting-up-stratis-file-systems" title="创建Stratis文件系统">“创建Stratis文件系统”一节</a> 。
						</li></ul></div><h4><a id="procedure_50"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">确定文件系统的UUID属性：</p><pre class="screen">$ lsblk --output=UUID /stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs</span></em></span></pre><p class="simpara">例如：</p><div class="example"><a id="idm139870473138560"></a><p class="title"><strong>例11.1。查看Stratis文件系统的UUID</strong></p><div class="example-contents"><pre class="screen">$ lsblk --output=UUID /stratis/my-pool/fs1

UUID
a1f0b64a-4ebb-4d4e-9543-b1d79f600283</pre></div></div></li><li class="listitem"><p class="simpara">如果挂载点目录不存在，请创建它：</p><pre class="screen"># mkdir --parents <span class="emphasis"><em><span class="replaceable">mount-point</span></em></span></pre></li><li class="listitem"><p class="simpara">以root用户身份编辑<code class="literal">/etc/fstab</code>文件，并为UUID标识的文件系统添加一行。使用<code class="literal">xfs</code>作为文件系统类型，并添加<code class="literal">x-systemd.requires=stratisd.service</code>选项。
						</p><p class="simpara">例如：</p><div class="example"><a id="idm139870473131568"></a><p class="title"><strong>例11.2。/ etc / fstab中的/ fs1挂载点</strong></p><div class="example-contents"><pre class="screen">UUID=a1f0b64a-4ebb-4d4e-9543-b1d79f600283 /fs1 xfs defaults,x-systemd.requires=stratisd.service 0 0</pre></div></div></li><li class="listitem"><p class="simpara">重新生成装载单元，以便系统注册新配置：</p><pre class="screen"># systemctl daemon-reload</pre></li><li class="listitem"><p class="simpara">尝试安装文件系统以验证配置是否有效：</p><pre class="screen"># mount <span class="emphasis"><em><span class="replaceable">mount-point</span></em></span></pre></li></ol></div><h4><a id="additional_resources_47"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="xref" href="assembly_mounting-file-systems_managing-file-systems.html#assembly_persistently-mounting-file-systems_assembly_mounting-file-systems" title="持久安装文件系统">“永久挂载文件系统”一节</a>
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="related-information-setting-up-stratis-file-systems"></a>相关信息</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="emphasis"><em>Stratis Storage</em></span>网站： <a class="link" href="https://stratis-storage.github.io/">https</a> ： <span class="emphasis"><em>//stratis-storage.github.io/</em></span>
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="extending-a-stratis-volume-with-additional-block-devices_managing-layered-local-storage-with-stratis"></a>使用其他块设备扩展Stratis卷</h1></div></div></div><p>您可以将其他块设备附加到Stratis池，以便为Stratis文件系统提供更多存储容量。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="components-of-a-stratis-volume_extending-a-stratis-volume-with-additional-block-devices"></a> Stratis卷的组成部分</h2></div></div></div><p>在外部，Stratis在命令行界面和API中显示以下卷组件：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">blockdev</code></span></dt><dd>阻止设备，例如磁盘或磁盘分区。
							</dd><dt><span class="term"><code class="literal">pool</code></span></dt><dd><p class="simpara">由一个或多个块设备组成。
							</p><p class="simpara">池具有固定的总大小，等于块设备的大小。
							</p><p class="simpara">该池包含大多数Stratis层，例如使用<code class="literal">dm-cache</code>目标的非易失性数据缓存。
							</p><p class="simpara">Stratis为每个池创建一个<code class="literal">/stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/</code>目录。此目录包含指向池中Stratis文件系统的设备的链接。
							</p></dd></dl></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">filesystem</code></span></dt><dd><p class="simpara">每个池可以包含一个或多个存储文件的文件系统。
							</p><p class="simpara">文件系统是精简配置的，并且没有固定的总大小。文件系统的实际大小随着存储在其上的数据而增长。如果数据大小接近文件系统的虚拟大小，Stratis会自动增大精简卷和文件系统。
							</p><p class="simpara">文件系统使用XFS格式化。</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>Stratis跟踪有关使用XFS不知道的Stratis创建的文件系统的信息，使用XFS进行的更改不会自动在Stratis中创建更新。用户不得重新格式化或重新配置由Stratis管理的XFS文件系统。
								</p></div><p class="simpara">Stratis在<code class="literal">/stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs</span></em></span></code>路径创建指向文件系统的链接。
							</p></dd></dl></div><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>Stratis使用许多Device Mapper设备，这些设备显示在<code class="literal">dmsetup</code>列表和<code class="literal">/proc/partitions</code>文件中。同样， <code class="literal">lsblk</code>命令输出反映了Stratis的内部工作和层。
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="adding-block-devices-to-a-stratis-pool_extending-a-stratis-volume-with-additional-block-devices"></a>将块设备添加到Stratis池</h2></div></div></div><p>此过程将一个或多个块设备添加到Stratis池，以供Stratis文件系统使用。
				</p><h4><a id="prerequisites_21"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Stratis已安装。请参阅<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="安装Stratis">“安装Stratis”一节</a> 。
						</li><li class="listitem"><code class="literal">stratisd</code>服务正在运行。
						</li><li class="listitem">要添加到Stratis池的块设备未使用且未安装。
						</li><li class="listitem">要添加到Stratis池的块设备的大小至少为1 GiB。
						</li></ul></div><h4><a id="procedure_51"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要将一个或多个块设备添加到池中，请使用：</p><pre class="screen"># stratis pool add-data <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> <span class="emphasis"><em><span class="replaceable">device-1</span></em></span> <span class="emphasis"><em><span class="replaceable">device-2</span></em></span> <span class="emphasis"><em><span class="replaceable">device-n</span></em></span></pre></li></ul></div><h4><a id="additional_resources_48"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">stratis(8)</code>手册页</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="related-information-extending-a-stratis-volume-with-additional-block-devices"></a>相关信息</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="emphasis"><em>Stratis Storage</em></span>网站： <a class="link" href="https://stratis-storage.github.io/">https</a> ： <span class="emphasis"><em>//stratis-storage.github.io/</em></span>
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="monitoring-stratis-file-systems_managing-layered-local-storage-with-stratis"></a>监视Stratis文件系统</h1></div></div></div><p>作为Stratis用户，您可以在系统上查看有关Stratis卷的信息，以监控其状态和可用空间。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="stratis-sizes-reported-by-different-utilities_monitoring-stratis-file-systems"></a>不同公用事业公司报告的Stratis尺寸</h2></div></div></div><p>本节介绍标准实用程序（如<code class="literal">df</code>和<code class="literal">stratis</code>实用程序报告的Stratis大小之间的差异。
				</p><p>标准Linux实用程序（如<code class="literal">df</code>报告Stratis上XFS文件系统层的大小，即1 TiB。这不是有用的信息，因为由于精简配置而导致Stratis的实际存储使用率较低，并且还因为当XFS层接近满时Stratis会自动增长文件系统。
				</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>定期监视写入Stratis文件系统的数据量，并将其报告为“ <span class="emphasis"><em>物理总使用</em></span>量”值。确保它不超过<span class="emphasis"><em>总物理尺寸</em></span>值。
					</p></div><h4><a id="additional_resources_49"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">stratis(8)</code>手册页</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="displaying-information-about-stratis-volumes_monitoring-stratis-file-systems"></a>显示有关Stratis卷的信息</h2></div></div></div><p>此过程列出有关Stratis卷的统计信息，例如属于池的总数，已用数和可用大小或文件系统和块设备。
				</p><h4><a id="prerequisites_22"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Stratis已安装。请参阅<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="安装Stratis">“安装Stratis”一节</a> 。
						</li><li class="listitem"><code class="literal">stratisd</code>服务正在运行。
						</li></ul></div><h4><a id="procedure_52"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要显示有关系统上用于Stratis的所有<span class="strong"><strong>块设备的</strong></span>信息，请执行以下操作：</p><pre class="screen"># stratis blockdev

Pool Name  Device Node    Physical Size   State  Tier
<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>    <span class="emphasis"><em><span class="replaceable">/dev/sdb</span></em></span>            <span class="emphasis"><em><span class="replaceable">9.10 TiB</span></em></span>  <span class="emphasis"><em><span class="replaceable">In-use</span></em></span>  <span class="emphasis"><em><span class="replaceable">Data</span></em></span></pre></li><li class="listitem"><p class="simpara">要显示有关系统上所有Stratis <span class="strong"><strong>池的信息</strong></span> ，请执行以下操作：</p><pre class="screen"># stratis pool

Name    Total Physical Size  Total Physical Used
<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>            <span class="emphasis"><em><span class="replaceable">9.10 TiB</span></em></span>              <span class="emphasis"><em><span class="replaceable">598 MiB</span></em></span></pre></li><li class="listitem"><p class="simpara">要显示有关<span class="strong"><strong>系统</strong></span>上所有Stratis <span class="strong"><strong>文件系统的</strong></span>信息：</p><pre class="screen"># stratis filesystem

Pool Name  Name  Used     Created            Device
<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>    <span class="emphasis"><em><span class="replaceable">my-fs</span></em></span> <span class="emphasis"><em><span class="replaceable">546 MiB</span></em></span>  <span class="emphasis"><em><span class="replaceable">Nov 08 2018 08:03</span></em></span>  /stratis/<span class="emphasis"><em><span class="replaceable">my-pool/my-fs</span></em></span></pre></li></ul></div><h4><a id="additional_resources_50"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">stratis(8)</code>手册页</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="related-information-monitoring-stratis-file-systems"></a>相关信息</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="emphasis"><em>Stratis Storage</em></span>网站： <a class="link" href="https://stratis-storage.github.io/">https</a> ： <span class="emphasis"><em>//stratis-storage.github.io/</em></span>
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="using-snapshots-on-stratis-file-systems_managing-layered-local-storage-with-stratis"></a>在Stratis文件系统上使用快照</h1></div></div></div><p>您可以在Stratis文件系统上使用快照在任意时间捕获文件系统状态，并在将来恢复它。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="characteristics-of-stratis-snapshots_using-snapshots-on-stratis-file-systems"></a> Stratis快照的特征</h2></div></div></div><p>本节介绍Stratis上文件系统快照的属性和限制。
				</p><p>在Stratis中，快照是作为另一个Stratis文件系统的副本创建的常规Stratis文件系统。快照最初包含与原始文件系统相同的文件内容，但可以在修改快照时更改。您对快照所做的任何更改都不会反映在原始文件系统中。
				</p><p>Stratis中的当前快照实现具有以下特征：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">文件系统的快照是另一个文件系统。
						</li><li class="listitem">快照及其来源在生命周期中不会链接。快照文件系统的活动时间可能长于创建它的文件系统。
						</li><li class="listitem">无需安装文件系统即可从中创建快照。
						</li><li class="listitem">每个快照使用大约半千兆字节的实际后备存储，这是XFS日志所需的。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-a-stratis-snapshot_using-snapshots-on-stratis-file-systems"></a>创建Stratis快照</h2></div></div></div><p>此过程将Stratis文件系统创建为现有Stratis文件系统的快照。
				</p><h4><a id="prerequisites_23"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Stratis已安装。请参阅<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="安装Stratis">“安装Stratis”一节</a> 。
						</li><li class="listitem"><code class="literal">stratisd</code>服务正在运行。
						</li><li class="listitem">您已经创建了一个Stratis文件系统。请参阅<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#creating-a-stratis-file-system_setting-up-stratis-file-systems" title="创建Stratis文件系统">“创建Stratis文件系统”一节</a> 。
						</li></ul></div><h4><a id="procedure_53"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要创建Stratis快照，请使用：</p><pre class="screen"># stratis fs snapshot <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs-snapshot</span></em></span></pre></li></ul></div><h4><a id="additional_resources_51"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">stratis(8)</code>手册页</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="accessing-the-content-of-a-stratis-snapshot_using-snapshots-on-stratis-file-systems"></a>访问Stratis快照的内容</h2></div></div></div><p>此过程将安装Stratis文件系统的快照，以使其可以进行读写操作。
				</p><h4><a id="prerequisites_24"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Stratis已安装。请参阅<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="安装Stratis">“安装Stratis”一节</a> 。
						</li><li class="listitem"><code class="literal">stratisd</code>服务正在运行。
						</li><li class="listitem">您已创建Stratis快照。请参阅<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#creating-a-stratis-snapshot_using-snapshots-on-stratis-file-systems" title="创建Stratis快照">“创建Stratis快照”一节</a> 。
						</li></ul></div><h4><a id="procedure_54"></a>程序</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要访问快照，请将其作为常规文件系统从<code class="literal">/stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/</code>目录安装：</p><pre class="screen"># mount /stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs-snapshot</span></em></span> <span class="emphasis"><em><span class="replaceable">mount-point</span></em></span></pre></li></ul></div><h4><a id="additional_resources_52"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#mounting-a-stratis-file-system_setting-up-stratis-file-systems" title="安装Stratis文件系统">“安装Stratis文件系统”一节</a>
						</li><li class="listitem"><code class="literal">mount(8)</code>手册页</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="reverting-a-stratis-file-system-to-a-previous-snapshot_using-snapshots-on-stratis-file-systems"></a>将Stratis文件系统还原为以前的快照</h2></div></div></div><p>此过程将Stratis文件系统的内容还原为Stratis快照中捕获的状态。
				</p><h4><a id="prerequisites_25"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Stratis已安装。请参阅<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="安装Stratis">“安装Stratis”一节</a> 。
						</li><li class="listitem"><code class="literal">stratisd</code>服务正在运行。
						</li><li class="listitem">您已创建Stratis快照。请参阅<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#creating-a-stratis-snapshot_using-snapshots-on-stratis-file-systems" title="创建Stratis快照">“创建Stratis快照”一节</a> 。
						</li></ul></div><h4><a id="procedure_55"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">（可选）备份文件系统的当前状态，以便以后可以访问它：</p><pre class="screen"># stratis filesystem snapshot <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs-backup</span></em></span></pre></li><li class="listitem"><p class="simpara">卸载并删除原始文件系统：</p><pre class="screen"># umount /stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs</span></em></span>
# stratis filesystem destroy <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs</span></em></span></pre></li><li class="listitem"><p class="simpara">在原始文件系统的名称下创建快照的副本：</p><pre class="screen"># stratis filesystem snapshot <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs-snapshot</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs</span></em></span></pre></li><li class="listitem"><p class="simpara">挂载快照，现在可以使用与原始文件系统相同的名称访问快照：</p><pre class="screen"># mount /stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs</span></em></span> <span class="emphasis"><em><span class="replaceable">mount-point</span></em></span></pre></li></ol></div><p>名为<span class="emphasis"><em><span class="replaceable">my-fs</span></em></span>的文件系统的内容现在与快照<span class="emphasis"><em><span class="replaceable">my-fs-snapshot相同</span></em></span> 。
				</p><h4><a id="additional_resources_53"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">stratis(8)</code>手册页</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="removing-a-stratis-snapshot_using-snapshots-on-stratis-file-systems"></a>删除Stratis快照</h2></div></div></div><p>此过程从池中删除Stratis快照。快照数据丢失。
				</p><h4><a id="prerequisites_26"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Stratis已安装。请参阅<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="安装Stratis">“安装Stratis”一节</a> 。
						</li><li class="listitem"><code class="literal">stratisd</code>服务正在运行。
						</li><li class="listitem">您已创建Stratis快照。请参阅<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#creating-a-stratis-snapshot_using-snapshots-on-stratis-file-systems" title="创建Stratis快照">“创建Stratis快照”一节</a> 。
						</li></ul></div><h4><a id="procedure_56"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">卸载快照：</p><pre class="screen"># umount /stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs-snapshot</span></em></span></pre></li><li class="listitem"><p class="simpara">销毁快照：</p><pre class="screen"># stratis filesystem destroy <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs-snapshot</span></em></span></pre></li></ol></div><h4><a id="additional_resources_54"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">stratis(8)</code>手册页</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="related-information-using-snapshots-on-stratis-file-systems"></a>相关信息</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="emphasis"><em>Stratis Storage</em></span>网站： <a class="link" href="https://stratis-storage.github.io/">https</a> ： <span class="emphasis"><em>//stratis-storage.github.io/</em></span>
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="removing-stratis-file-systems_managing-layered-local-storage-with-stratis"></a>删除Stratis文件系统</h1></div></div></div><p>您可以删除现有的Stratis文件系统或Stratis池，从而销毁它们上的数据。
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="components-of-a-stratis-volume_removing-stratis-file-systems"></a> Stratis卷的组成部分</h2></div></div></div><p>在外部，Stratis在命令行界面和API中显示以下卷组件：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">blockdev</code></span></dt><dd>阻止设备，例如磁盘或磁盘分区。
							</dd><dt><span class="term"><code class="literal">pool</code></span></dt><dd><p class="simpara">由一个或多个块设备组成。
							</p><p class="simpara">池具有固定的总大小，等于块设备的大小。
							</p><p class="simpara">该池包含大多数Stratis层，例如使用<code class="literal">dm-cache</code>目标的非易失性数据缓存。
							</p><p class="simpara">Stratis为每个池创建一个<code class="literal">/stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/</code>目录。此目录包含指向池中Stratis文件系统的设备的链接。
							</p></dd></dl></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">filesystem</code></span></dt><dd><p class="simpara">每个池可以包含一个或多个存储文件的文件系统。
							</p><p class="simpara">文件系统是精简配置的，并且没有固定的总大小。文件系统的实际大小随着存储在其上的数据而增长。如果数据大小接近文件系统的虚拟大小，Stratis会自动增大精简卷和文件系统。
							</p><p class="simpara">文件系统使用XFS格式化。</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>Stratis跟踪有关使用XFS不知道的Stratis创建的文件系统的信息，使用XFS进行的更改不会自动在Stratis中创建更新。用户不得重新格式化或重新配置由Stratis管理的XFS文件系统。
								</p></div><p class="simpara">Stratis在<code class="literal">/stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs</span></em></span></code>路径创建指向文件系统的链接。
							</p></dd></dl></div><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>Stratis使用许多Device Mapper设备，这些设备显示在<code class="literal">dmsetup</code>列表和<code class="literal">/proc/partitions</code>文件中。同样， <code class="literal">lsblk</code>命令输出反映了Stratis的内部工作和层。
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="removing-a-stratis-file-system_removing-stratis-file-systems"></a>删除Stratis文件系统</h2></div></div></div><p>此过程将删除现有的Stratis文件系统。存储在其上的数据将丢失。
				</p><h4><a id="prerequisites_27"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Stratis已安装。请参阅<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="安装Stratis">“安装Stratis”一节</a> 。
						</li><li class="listitem"><code class="literal">stratisd</code>服务正在运行。
						</li><li class="listitem">您已经创建了一个Stratis文件系统。请参阅<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#creating-a-stratis-file-system_setting-up-stratis-file-systems" title="创建Stratis文件系统">“创建Stratis文件系统”一节</a> 。
						</li></ul></div><h4><a id="procedure_57"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">卸载文件系统：</p><pre class="screen"># umount /stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs</span></em></span></pre></li><li class="listitem"><p class="simpara">销毁文件系统：</p><pre class="screen"># stratis filesystem destroy <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs</span></em></span></pre></li><li class="listitem"><p class="simpara">验证文件系统不再存在：</p><pre class="screen"># stratis filesystem list <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span></pre></li></ol></div><h4><a id="additional_resources_55"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">stratis(8)</code>手册页</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="removing-a-stratis-pool_removing-stratis-file-systems"></a>删除Stratis池</h2></div></div></div><p>此过程将删除现有的Stratis池。存储在其上的数据将丢失。
				</p><h4><a id="prerequisites_28"></a>先决条件</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Stratis已安装。请参阅<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="安装Stratis">“安装Stratis”一节</a> 。
						</li><li class="listitem"><code class="literal">stratisd</code>服务正在运行。
						</li><li class="listitem">您已经创建了一个Stratis池。请参阅<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#creating-a-stratis-pool_setting-up-stratis-file-systems" title="创建一个Stratis池">“创建Stratis池”一节</a> 。
						</li></ul></div><h4><a id="procedure_58"></a>程序</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">列出池中的文件系统：</p><pre class="screen"># stratis filesystem list <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span></pre></li><li class="listitem"><p class="simpara">卸载池上的所有文件系统：</p><pre class="screen"># umount /stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs-1</span></em></span> \
         /stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs-2</span></em></span> \
         /stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs-n</span></em></span></pre></li><li class="listitem"><p class="simpara">销毁文件系统：</p><pre class="screen"># stratis filesystem destroy <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs-1</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs-2</span></em></span></pre></li><li class="listitem"><p class="simpara">摧毁游泳池：</p><pre class="screen"># stratis pool destroy <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span></pre></li><li class="listitem"><p class="simpara">验证池不再存在：</p><pre class="screen"># stratis pool list</pre></li></ol></div><h4><a id="additional_resources_56"></a>其他资源</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">stratis(8)</code>手册页</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="related-information-removing-stratis-file-systems"></a>相关信息</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="emphasis"><em>Stratis Storage</em></span>网站： <a class="link" href="https://stratis-storage.github.io/">https</a> ： <span class="emphasis"><em>//stratis-storage.github.io/</em></span>
						</li></ul></div></div></div></div></body></html>