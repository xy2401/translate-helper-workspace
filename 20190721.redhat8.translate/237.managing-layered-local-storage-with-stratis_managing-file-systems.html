<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 11. Managing layered local storage with Stratis</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="managing-layered-local-storage-with-stratis_managing-file-systems"/>Chapter 11. Managing layered local storage with Stratis</h1></div></div></div><p>
			You can easily set up and manage complex storage configurations integrated by the Stratis high-level system.
		</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
				Stratis is available as a Technology Preview. For information on Red Hat scope of support for Technology Preview features, see the <a class="link" href="https://access.redhat.com/support/offerings/techpreview">Technology Preview Features Support Scope</a> document.
			</p><p>
				Customers deploying Stratis are encouraged to provide feedback to Red Hat.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="setting-up-stratis-file-systems_managing-layered-local-storage-with-stratis"/>Setting up Stratis file systems</h1></div></div></div><p>
				As a system administrator, you can enable and set up the Stratis volume-managing file system on your system to easily manage layered storage.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="the-purpose-and-features-of-stratis_setting-up-stratis-file-systems"/>The purpose and features of Stratis</h2></div></div></div><p>
					Stratis is a local storage-management solution for Linux. It is focused on simplicity and ease of use, and gives you access to advanced storage features.
				</p><p>
					Stratis makes the following activities easier:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Initial configuration of storage
						</li><li class="listitem">
							Making changes later
						</li><li class="listitem">
							Using advanced storage features
						</li></ul></div><p>
					Stratis is a hybrid user-and-kernel local storage management system that supports advanced storage features. The central concept of Stratis is a storage <span class="emphasis"><em>pool</em></span>. This pool is created from one or more local disks or partitions, and volumes are created from the pool.
				</p><p>
					The pool enables many useful features, such as:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							File system snapshots
						</li><li class="listitem">
							Thin provisioning
						</li><li class="listitem">
							Tiering
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="components-of-a-stratis-volume_setting-up-stratis-file-systems"/>Components of a Stratis volume</h2></div></div></div><p>
					Externally, Stratis presents the following volume components in the command-line interface and the API:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">blockdev</code></span></dt><dd>
								Block devices, such as a disk or a disk partition.
							</dd><dt><span class="term"><code class="literal">pool</code></span></dt><dd><p class="simpara">
								Composed of one or more block devices.
							</p><p class="simpara">
								A pool has a fixed total size, equal to the size of the block devices.
							</p><p class="simpara">
								The pool contains most Stratis layers, such as the non-volatile data cache using the <code class="literal">dm-cache</code> target.
							</p><p class="simpara">
								Stratis creates a <code class="literal">/stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/</code> directory for each pool. This directory contains links to devices that represent Stratis file systems in the pool.
							</p></dd></dl></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">filesystem</code></span></dt><dd><p class="simpara">
								Each pool can contain one or more file systems, which store files.
							</p><p class="simpara">
								File systems are thinly provisioned and do not have a fixed total size. The actual size of a file system grows with the data stored on it. If the size of the data approaches the virtual size of the file system, Stratis grows the thin volume and the file system automatically.
							</p><p class="simpara">
								The file systems are formatted with XFS.
							</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
									Stratis tracks information about file systems created using Stratis that XFS is not aware of, and changes made using XFS do not automatically create updates in Stratis. Users must not reformat or reconfigure XFS file systems that are managed by Stratis.
								</p></div><p class="simpara">
								Stratis creates links to file systems at the <code class="literal">/stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs</span></em></span></code> path.
							</p></dd></dl></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						Stratis uses many Device Mapper devices, which show up in <code class="literal">dmsetup</code> listings and the <code class="literal">/proc/partitions</code> file. Similarly, the <code class="literal">lsblk</code> command output reflects the internal workings and layers of Stratis.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="block-devices-usable-with-stratis_setting-up-stratis-file-systems"/>Block devices usable with Stratis</h2></div></div></div><p>
					This section lists storage devices that you can use for Stratis.
				</p><h4><a id="supported_devices"/>Supported devices</h4><p>
					Stratis pools have been tested to work on these types of block devices:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							LUKS
						</li><li class="listitem">
							LVM logical volumes
						</li><li class="listitem">
							MDRAID
						</li><li class="listitem">
							DM Multipath
						</li><li class="listitem">
							iSCSI
						</li><li class="listitem">
							HDDs and SSDs
						</li><li class="listitem">
							NVMe devices
						</li></ul></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
						In the current version, Stratis does not handle failures in hard drives or other hardware. If you create a Stratis pool over multiple hardware devices, you increase the risk of data loss because multiple devices must be operational to access the data.
					</p></div><h4><a id="unsupported_devices"/>Unsupported devices</h4><p>
					Because Stratis contains a thin-provisioning layer, Red Hat does not recommend placing a Stratis pool on block devices that are already thinly-provisioned.
				</p><h4><a id="additional_resources_43"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							For iSCSI and other block devices requiring network, see the <code class="literal">systemd.mount(5)</code> man page for information on the <code class="literal">_netdev</code> mount option.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="installing-stratis_setting-up-stratis-file-systems"/>Installing Stratis</h2></div></div></div><p>
					This procedure installs all packages necessary to use Stratis.
				</p><h4><a id="procedure_46"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Install packages that provide the Stratis service and command-line utilities:
						</p><pre class="screen"># yum install stratisd stratis-cli</pre></li><li class="listitem"><p class="simpara">
							Make sure that the <code class="literal">stratisd</code> service is enabled:
						</p><pre class="screen"># systemctl enable --now stratisd</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-a-stratis-pool_setting-up-stratis-file-systems"/>Creating a Stratis pool</h2></div></div></div><p>
					This procedure creates a Stratis pool from one or more block devices.
				</p><h4><a id="prerequisites_17"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Stratis is installed. See <a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="Installing Stratis">the section called “Installing Stratis”</a>.
						</li><li class="listitem">
							The <code class="literal">stratisd</code> service is running.
						</li><li class="listitem">
							The block devices on which you are creating a Stratis pool are not in use and not mounted.
						</li><li class="listitem">
							The block devices on which you are creating a Stratis pool are at least 1 GiB in size each.
						</li><li class="listitem"><p class="simpara">
							On the IBM Z architecture, the <code class="literal">/dev/dasd*</code> block devices must to be partitioned. Use the partition in the Stratis pool.
						</p><p class="simpara">
							For information on partitioning DASD devices, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/performing_a_standard_rhel_installation/configuring-a-linux-instance-on-ibm-z_installing-rhel">Configuring a Linux instance on IBM Z</a>.
						</p></li></ul></div><h4><a id="procedure_47"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							If the selected block device contains file system, partition table, or RAID signatures, erase them:
						</p><pre class="screen"># wipefs --all <span class="emphasis"><em><span class="replaceable">block-device</span></em></span></pre><p class="simpara">
							Replace <span class="emphasis"><em><span class="replaceable">block-device</span></em></span> with the path to a block device, such as <code class="literal">/dev/sdb</code>.
						</p></li><li class="listitem"><p class="simpara">
							To create a Stratis pool on the block device, use:
						</p><pre class="screen"># stratis pool create <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> <span class="emphasis"><em><span class="replaceable">block-device</span></em></span></pre><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									Replace <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> with an arbitrary name for the pool.
								</li><li class="listitem">
									Replace <span class="emphasis"><em><span class="replaceable">block-device</span></em></span> with the path to the empty or wiped block device, such as <code class="literal">/dev/sdb</code>.
								</li></ul></div><p class="simpara">
							To create a pool from more than one block device, list them all on the command line:
						</p><pre class="screen"># stratis pool create <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> <span class="emphasis"><em><span class="replaceable">device-1</span></em></span> <span class="emphasis"><em><span class="replaceable">device-2</span></em></span> <span class="emphasis"><em><span class="replaceable">device-n</span></em></span></pre></li><li class="listitem"><p class="simpara">
							To verify, list all pools on your system:
						</p><pre class="screen"># stratis pool list</pre></li></ol></div><h4><a id="additional_resources_44"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">stratis(8)</code> man page
						</li></ul></div><h4><a id="next_steps_2"/>Next steps</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Create a Stratis file system on the pool. See <a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#creating-a-stratis-file-system_setting-up-stratis-file-systems" title="Creating a Stratis file system">the section called “Creating a Stratis file system”</a>.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-a-stratis-file-system_setting-up-stratis-file-systems"/>Creating a Stratis file system</h2></div></div></div><p>
					This procedure creates a Stratis file system on an existing Stratis pool.
				</p><h4><a id="prerequisites_18"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Stratis is installed. See <a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="Installing Stratis">the section called “Installing Stratis”</a>.
						</li><li class="listitem">
							The <code class="literal">stratisd</code> service is running.
						</li><li class="listitem">
							You have created a Stratis pool. See <a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#creating-a-stratis-pool_setting-up-stratis-file-systems" title="Creating a Stratis pool">the section called “Creating a Stratis pool”</a>.
						</li></ul></div><h4><a id="procedure_48"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							To create a Stratis file system on a pool, use:
						</p><pre class="screen"># stratis fs create <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs</span></em></span></pre><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									Replace <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> with the name of your existing Stratis pool.
								</li><li class="listitem">
									Replace <span class="emphasis"><em><span class="replaceable">my-fs</span></em></span> with an arbitrary name for the file system.
								</li></ul></div></li><li class="listitem"><p class="simpara">
							To verify, list file systems within the pool:
						</p><pre class="screen"># stratis fs list <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span></pre></li></ol></div><h4><a id="additional_resources_45"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">stratis(8)</code> man page
						</li></ul></div><h4><a id="next_steps_3"/>Next steps</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Mount the Stratis file system. See <a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#mounting-a-stratis-file-system_setting-up-stratis-file-systems" title="Mounting a Stratis file system">the section called “Mounting a Stratis file system”</a>.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mounting-a-stratis-file-system_setting-up-stratis-file-systems"/>Mounting a Stratis file system</h2></div></div></div><p>
					This procedure mounts an existing Stratis file system to access the content.
				</p><h4><a id="prerequisites_19"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Stratis is installed. See <a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="Installing Stratis">the section called “Installing Stratis”</a>.
						</li><li class="listitem">
							The <code class="literal">stratisd</code> service is running.
						</li><li class="listitem">
							You have created a Stratis file system. See <a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#creating-a-stratis-file-system_setting-up-stratis-file-systems" title="Creating a Stratis file system">the section called “Creating a Stratis file system”</a>.
						</li></ul></div><h4><a id="procedure_49"/>Procedure</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							To mount the file system, use the entries that Stratis maintains in the <code class="literal">/stratis/</code> directory:
						</p><pre class="screen"># mount /stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs</span></em></span> <span class="emphasis"><em><span class="replaceable">mount-point</span></em></span></pre></li></ul></div><p>
					The file system is now mounted on the <span class="emphasis"><em><span class="replaceable">mount-point</span></em></span> directory and ready to use.
				</p><h4><a id="additional_resources_46"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">mount(8)</code> man page
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="persistently-mounting-a-stratis-file-system_setting-up-stratis-file-systems"/>Persistently mounting a Stratis file system</h2></div></div></div><p>
					This procedure persistently mounts a Stratis file system so that it is available automatically after booting the system.
				</p><h4><a id="prerequisites_20"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Stratis is installed. See <a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="Installing Stratis">the section called “Installing Stratis”</a>.
						</li><li class="listitem">
							The <code class="literal">stratisd</code> service is running.
						</li><li class="listitem">
							You have created a Stratis file system. See <a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#creating-a-stratis-file-system_setting-up-stratis-file-systems" title="Creating a Stratis file system">the section called “Creating a Stratis file system”</a>.
						</li></ul></div><h4><a id="procedure_50"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Determine the UUID attribute of the file system:
						</p><pre class="screen">$ lsblk --output=UUID /stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs</span></em></span></pre><p class="simpara">
							For example:
						</p><div class="example"><a id="idm139870473138560"/><p class="title"><strong>Example 11.1. Viewing the UUID of Stratis file system</strong></p><div class="example-contents"><pre class="screen">$ lsblk --output=UUID /stratis/my-pool/fs1

UUID
a1f0b64a-4ebb-4d4e-9543-b1d79f600283</pre></div></div></li><li class="listitem"><p class="simpara">
							If the mount point directory does not exist, create it:
						</p><pre class="screen"># mkdir --parents <span class="emphasis"><em><span class="replaceable">mount-point</span></em></span></pre></li><li class="listitem"><p class="simpara">
							As root, edit the <code class="literal">/etc/fstab</code> file and add a line for the file system, identified by the UUID. Use <code class="literal">xfs</code> as the file system type and add the <code class="literal">x-systemd.requires=stratisd.service</code> option.
						</p><p class="simpara">
							For example:
						</p><div class="example"><a id="idm139870473131568"/><p class="title"><strong>Example 11.2. The /fs1 mount point in /etc/fstab</strong></p><div class="example-contents"><pre class="screen">UUID=a1f0b64a-4ebb-4d4e-9543-b1d79f600283 /fs1 xfs defaults,x-systemd.requires=stratisd.service 0 0</pre></div></div></li><li class="listitem"><p class="simpara">
							Regenerate mount units so that your system registers the new configuration:
						</p><pre class="screen"># systemctl daemon-reload</pre></li><li class="listitem"><p class="simpara">
							Try mounting the file system to verify that the configuration works:
						</p><pre class="screen"># mount <span class="emphasis"><em><span class="replaceable">mount-point</span></em></span></pre></li></ol></div><h4><a id="additional_resources_47"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="xref" href="assembly_mounting-file-systems_managing-file-systems.html#assembly_persistently-mounting-file-systems_assembly_mounting-file-systems" title="Persistently mounting file systems">the section called “Persistently mounting file systems”</a>
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="related-information-setting-up-stratis-file-systems"/>Related information</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <span class="emphasis"><em>Stratis Storage</em></span> website: <a class="link" href="https://stratis-storage.github.io/">https://stratis-storage.github.io/</a>
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="extending-a-stratis-volume-with-additional-block-devices_managing-layered-local-storage-with-stratis"/>Extending a Stratis volume with additional block devices</h1></div></div></div><p>
				You can attach additional block devices to a Stratis pool to provide more storage capacity for Stratis file systems.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="components-of-a-stratis-volume_extending-a-stratis-volume-with-additional-block-devices"/>Components of a Stratis volume</h2></div></div></div><p>
					Externally, Stratis presents the following volume components in the command-line interface and the API:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">blockdev</code></span></dt><dd>
								Block devices, such as a disk or a disk partition.
							</dd><dt><span class="term"><code class="literal">pool</code></span></dt><dd><p class="simpara">
								Composed of one or more block devices.
							</p><p class="simpara">
								A pool has a fixed total size, equal to the size of the block devices.
							</p><p class="simpara">
								The pool contains most Stratis layers, such as the non-volatile data cache using the <code class="literal">dm-cache</code> target.
							</p><p class="simpara">
								Stratis creates a <code class="literal">/stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/</code> directory for each pool. This directory contains links to devices that represent Stratis file systems in the pool.
							</p></dd></dl></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">filesystem</code></span></dt><dd><p class="simpara">
								Each pool can contain one or more file systems, which store files.
							</p><p class="simpara">
								File systems are thinly provisioned and do not have a fixed total size. The actual size of a file system grows with the data stored on it. If the size of the data approaches the virtual size of the file system, Stratis grows the thin volume and the file system automatically.
							</p><p class="simpara">
								The file systems are formatted with XFS.
							</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
									Stratis tracks information about file systems created using Stratis that XFS is not aware of, and changes made using XFS do not automatically create updates in Stratis. Users must not reformat or reconfigure XFS file systems that are managed by Stratis.
								</p></div><p class="simpara">
								Stratis creates links to file systems at the <code class="literal">/stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs</span></em></span></code> path.
							</p></dd></dl></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						Stratis uses many Device Mapper devices, which show up in <code class="literal">dmsetup</code> listings and the <code class="literal">/proc/partitions</code> file. Similarly, the <code class="literal">lsblk</code> command output reflects the internal workings and layers of Stratis.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="adding-block-devices-to-a-stratis-pool_extending-a-stratis-volume-with-additional-block-devices"/>Adding block devices to a Stratis pool</h2></div></div></div><p>
					This procedure adds one or more block devices to a Stratis pool to be usable by Stratis file systems.
				</p><h4><a id="prerequisites_21"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Stratis is installed. See <a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="Installing Stratis">the section called “Installing Stratis”</a>.
						</li><li class="listitem">
							The <code class="literal">stratisd</code> service is running.
						</li><li class="listitem">
							The block devices that you are adding to the Stratis pool are not in use and not mounted.
						</li><li class="listitem">
							The block devices that you are adding to the Stratis pool are at least 1 GiB in size each.
						</li></ul></div><h4><a id="procedure_51"/>Procedure</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							To add one or more block devices to the pool, use:
						</p><pre class="screen"># stratis pool add-data <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> <span class="emphasis"><em><span class="replaceable">device-1</span></em></span> <span class="emphasis"><em><span class="replaceable">device-2</span></em></span> <span class="emphasis"><em><span class="replaceable">device-n</span></em></span></pre></li></ul></div><h4><a id="additional_resources_48"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">stratis(8)</code> man page
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="related-information-extending-a-stratis-volume-with-additional-block-devices"/>Related information</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <span class="emphasis"><em>Stratis Storage</em></span> website: <a class="link" href="https://stratis-storage.github.io/">https://stratis-storage.github.io/</a>
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="monitoring-stratis-file-systems_managing-layered-local-storage-with-stratis"/>Monitoring Stratis file systems</h1></div></div></div><p>
				As a Stratis user, you can view information about Stratis volumes on your system to monitor their state and free space.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="stratis-sizes-reported-by-different-utilities_monitoring-stratis-file-systems"/>Stratis sizes reported by different utilities</h2></div></div></div><p>
					This section explains the difference between Stratis sizes reported by standard utilities such as <code class="literal">df</code> and the <code class="literal">stratis</code> utility.
				</p><p>
					Standard Linux utilities such as <code class="literal">df</code> report the size of the XFS file system layer on Stratis, which is 1 TiB. This is not useful information, because the actual storage usage of Stratis is less due to thin provisioning, and also because Stratis automatically grows the file system when the XFS layer is close to full.
				</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						Regularly monitor the amount of data written to your Stratis file systems, which is reported as the <span class="emphasis"><em>Total Physical Used</em></span> value. Make sure it does not exceed the <span class="emphasis"><em>Total Physical Size</em></span> value.
					</p></div><h4><a id="additional_resources_49"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">stratis(8)</code> man page
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="displaying-information-about-stratis-volumes_monitoring-stratis-file-systems"/>Displaying information about Stratis volumes</h2></div></div></div><p>
					This procedure lists statistics about your Stratis volumes, such as the total, used, and free size or file systems and block devices belonging to a pool.
				</p><h4><a id="prerequisites_22"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Stratis is installed. See <a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="Installing Stratis">the section called “Installing Stratis”</a>.
						</li><li class="listitem">
							The <code class="literal">stratisd</code> service is running.
						</li></ul></div><h4><a id="procedure_52"/>Procedure</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							To display information about all <span class="strong"><strong>block devices</strong></span> used for Stratis on your system:
						</p><pre class="screen"># stratis blockdev

Pool Name  Device Node    Physical Size   State  Tier
<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>    <span class="emphasis"><em><span class="replaceable">/dev/sdb</span></em></span>            <span class="emphasis"><em><span class="replaceable">9.10 TiB</span></em></span>  <span class="emphasis"><em><span class="replaceable">In-use</span></em></span>  <span class="emphasis"><em><span class="replaceable">Data</span></em></span></pre></li><li class="listitem"><p class="simpara">
							To display information about all Stratis <span class="strong"><strong>pools</strong></span> on your system:
						</p><pre class="screen"># stratis pool

Name    Total Physical Size  Total Physical Used
<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>            <span class="emphasis"><em><span class="replaceable">9.10 TiB</span></em></span>              <span class="emphasis"><em><span class="replaceable">598 MiB</span></em></span></pre></li><li class="listitem"><p class="simpara">
							To display information about all Stratis <span class="strong"><strong>file systems</strong></span> on your system:
						</p><pre class="screen"># stratis filesystem

Pool Name  Name  Used     Created            Device
<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>    <span class="emphasis"><em><span class="replaceable">my-fs</span></em></span> <span class="emphasis"><em><span class="replaceable">546 MiB</span></em></span>  <span class="emphasis"><em><span class="replaceable">Nov 08 2018 08:03</span></em></span>  /stratis/<span class="emphasis"><em><span class="replaceable">my-pool/my-fs</span></em></span></pre></li></ul></div><h4><a id="additional_resources_50"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">stratis(8)</code> man page
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="related-information-monitoring-stratis-file-systems"/>Related information</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <span class="emphasis"><em>Stratis Storage</em></span> website: <a class="link" href="https://stratis-storage.github.io/">https://stratis-storage.github.io/</a>
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="using-snapshots-on-stratis-file-systems_managing-layered-local-storage-with-stratis"/>Using snapshots on Stratis file systems</h1></div></div></div><p>
				You can use snapshots on Stratis file systems to capture file system state at arbitrary times and restore it in the future.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="characteristics-of-stratis-snapshots_using-snapshots-on-stratis-file-systems"/>Characteristics of Stratis snapshots</h2></div></div></div><p>
					This section describes the properties and limitations of file system snapshots on Stratis.
				</p><p>
					In Stratis, a snapshot is a regular Stratis file system created as a copy of another Stratis file system. The snapshot initially contains the same file content as the original file system, but can change as the snapshot is modified. Whatever changes you make to the snapshot will not be reflected in the original file system.
				</p><p>
					The current snapshot implementation in Stratis is characterized by the following:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							A snapshot of a file system is another file system.
						</li><li class="listitem">
							A snapshot and its origin are not linked in lifetime. A snapshotted file system can live longer than the file system it was created from.
						</li><li class="listitem">
							A file system does not have to be mounted to create a snapshot from it.
						</li><li class="listitem">
							Each snapshot uses around half a gigabyte of actual backing storage, which is needed for the XFS log.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="creating-a-stratis-snapshot_using-snapshots-on-stratis-file-systems"/>Creating a Stratis snapshot</h2></div></div></div><p>
					This procedure creates a Stratis file system as a snapshot of an existing Stratis file system.
				</p><h4><a id="prerequisites_23"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Stratis is installed. See <a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="Installing Stratis">the section called “Installing Stratis”</a>.
						</li><li class="listitem">
							The <code class="literal">stratisd</code> service is running.
						</li><li class="listitem">
							You have created a Stratis file system. See <a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#creating-a-stratis-file-system_setting-up-stratis-file-systems" title="Creating a Stratis file system">the section called “Creating a Stratis file system”</a>.
						</li></ul></div><h4><a id="procedure_53"/>Procedure</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							To create a Stratis snapshot, use:
						</p><pre class="screen"># stratis fs snapshot <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs-snapshot</span></em></span></pre></li></ul></div><h4><a id="additional_resources_51"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">stratis(8)</code> man page
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="accessing-the-content-of-a-stratis-snapshot_using-snapshots-on-stratis-file-systems"/>Accessing the content of a Stratis snapshot</h2></div></div></div><p>
					This procedure mounts a snapshot of a Stratis file system to make it accessible for read and write operations.
				</p><h4><a id="prerequisites_24"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Stratis is installed. See <a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="Installing Stratis">the section called “Installing Stratis”</a>.
						</li><li class="listitem">
							The <code class="literal">stratisd</code> service is running.
						</li><li class="listitem">
							You have created a Stratis snapshot. See <a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#creating-a-stratis-snapshot_using-snapshots-on-stratis-file-systems" title="Creating a Stratis snapshot">the section called “Creating a Stratis snapshot”</a>.
						</li></ul></div><h4><a id="procedure_54"/>Procedure</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							To access the snapshot, mount it as a regular file system from the <code class="literal">/stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/</code> directory:
						</p><pre class="screen"># mount /stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs-snapshot</span></em></span> <span class="emphasis"><em><span class="replaceable">mount-point</span></em></span></pre></li></ul></div><h4><a id="additional_resources_52"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#mounting-a-stratis-file-system_setting-up-stratis-file-systems" title="Mounting a Stratis file system">the section called “Mounting a Stratis file system”</a>
						</li><li class="listitem">
							The <code class="literal">mount(8)</code> man page
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="reverting-a-stratis-file-system-to-a-previous-snapshot_using-snapshots-on-stratis-file-systems"/>Reverting a Stratis file system to a previous snapshot</h2></div></div></div><p>
					This procedure reverts the content of a Stratis file system to the state captured in a Stratis snapshot.
				</p><h4><a id="prerequisites_25"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Stratis is installed. See <a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="Installing Stratis">the section called “Installing Stratis”</a>.
						</li><li class="listitem">
							The <code class="literal">stratisd</code> service is running.
						</li><li class="listitem">
							You have created a Stratis snapshot. See <a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#creating-a-stratis-snapshot_using-snapshots-on-stratis-file-systems" title="Creating a Stratis snapshot">the section called “Creating a Stratis snapshot”</a>.
						</li></ul></div><h4><a id="procedure_55"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Optionally, back up the current state of the file system to be able to access it later:
						</p><pre class="screen"># stratis filesystem snapshot <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs-backup</span></em></span></pre></li><li class="listitem"><p class="simpara">
							Unmount and remove the original file system:
						</p><pre class="screen"># umount /stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs</span></em></span>
# stratis filesystem destroy <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs</span></em></span></pre></li><li class="listitem"><p class="simpara">
							Create a copy of the snapshot under the name of the original file system:
						</p><pre class="screen"># stratis filesystem snapshot <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs-snapshot</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs</span></em></span></pre></li><li class="listitem"><p class="simpara">
							Mount the snapshot, which is now accessible with the same name as the original file system:
						</p><pre class="screen"># mount /stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs</span></em></span> <span class="emphasis"><em><span class="replaceable">mount-point</span></em></span></pre></li></ol></div><p>
					The content of the file system named <span class="emphasis"><em><span class="replaceable">my-fs</span></em></span> is now identical to the snapshot <span class="emphasis"><em><span class="replaceable">my-fs-snapshot</span></em></span>.
				</p><h4><a id="additional_resources_53"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">stratis(8)</code> man page
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="removing-a-stratis-snapshot_using-snapshots-on-stratis-file-systems"/>Removing a Stratis snapshot</h2></div></div></div><p>
					This procedure removes a Stratis snapshot from a pool. Data on the snapshot are lost.
				</p><h4><a id="prerequisites_26"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Stratis is installed. See <a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="Installing Stratis">the section called “Installing Stratis”</a>.
						</li><li class="listitem">
							The <code class="literal">stratisd</code> service is running.
						</li><li class="listitem">
							You have created a Stratis snapshot. See <a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#creating-a-stratis-snapshot_using-snapshots-on-stratis-file-systems" title="Creating a Stratis snapshot">the section called “Creating a Stratis snapshot”</a>.
						</li></ul></div><h4><a id="procedure_56"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Unmount the snapshot:
						</p><pre class="screen"># umount /stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs-snapshot</span></em></span></pre></li><li class="listitem"><p class="simpara">
							Destroy the snapshot:
						</p><pre class="screen"># stratis filesystem destroy <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs-snapshot</span></em></span></pre></li></ol></div><h4><a id="additional_resources_54"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">stratis(8)</code> man page
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="related-information-using-snapshots-on-stratis-file-systems"/>Related information</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <span class="emphasis"><em>Stratis Storage</em></span> website: <a class="link" href="https://stratis-storage.github.io/">https://stratis-storage.github.io/</a>
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="removing-stratis-file-systems_managing-layered-local-storage-with-stratis"/>Removing Stratis file systems</h1></div></div></div><p>
				You can remove an existing Stratis file system or a Stratis pool, destroying data on them.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="components-of-a-stratis-volume_removing-stratis-file-systems"/>Components of a Stratis volume</h2></div></div></div><p>
					Externally, Stratis presents the following volume components in the command-line interface and the API:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">blockdev</code></span></dt><dd>
								Block devices, such as a disk or a disk partition.
							</dd><dt><span class="term"><code class="literal">pool</code></span></dt><dd><p class="simpara">
								Composed of one or more block devices.
							</p><p class="simpara">
								A pool has a fixed total size, equal to the size of the block devices.
							</p><p class="simpara">
								The pool contains most Stratis layers, such as the non-volatile data cache using the <code class="literal">dm-cache</code> target.
							</p><p class="simpara">
								Stratis creates a <code class="literal">/stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/</code> directory for each pool. This directory contains links to devices that represent Stratis file systems in the pool.
							</p></dd></dl></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">filesystem</code></span></dt><dd><p class="simpara">
								Each pool can contain one or more file systems, which store files.
							</p><p class="simpara">
								File systems are thinly provisioned and do not have a fixed total size. The actual size of a file system grows with the data stored on it. If the size of the data approaches the virtual size of the file system, Stratis grows the thin volume and the file system automatically.
							</p><p class="simpara">
								The file systems are formatted with XFS.
							</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
									Stratis tracks information about file systems created using Stratis that XFS is not aware of, and changes made using XFS do not automatically create updates in Stratis. Users must not reformat or reconfigure XFS file systems that are managed by Stratis.
								</p></div><p class="simpara">
								Stratis creates links to file systems at the <code class="literal">/stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs</span></em></span></code> path.
							</p></dd></dl></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						Stratis uses many Device Mapper devices, which show up in <code class="literal">dmsetup</code> listings and the <code class="literal">/proc/partitions</code> file. Similarly, the <code class="literal">lsblk</code> command output reflects the internal workings and layers of Stratis.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="removing-a-stratis-file-system_removing-stratis-file-systems"/>Removing a Stratis file system</h2></div></div></div><p>
					This procedure removes an existing Stratis file system. Data stored on it are lost.
				</p><h4><a id="prerequisites_27"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Stratis is installed. See <a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="Installing Stratis">the section called “Installing Stratis”</a>.
						</li><li class="listitem">
							The <code class="literal">stratisd</code> service is running.
						</li><li class="listitem">
							You have created a Stratis file system. See <a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#creating-a-stratis-file-system_setting-up-stratis-file-systems" title="Creating a Stratis file system">the section called “Creating a Stratis file system”</a>.
						</li></ul></div><h4><a id="procedure_57"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Unmount the file system:
						</p><pre class="screen"># umount /stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs</span></em></span></pre></li><li class="listitem"><p class="simpara">
							Destroy the file system:
						</p><pre class="screen"># stratis filesystem destroy <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs</span></em></span></pre></li><li class="listitem"><p class="simpara">
							Verify that the file system no longer exists:
						</p><pre class="screen"># stratis filesystem list <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span></pre></li></ol></div><h4><a id="additional_resources_55"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">stratis(8)</code> man page
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="removing-a-stratis-pool_removing-stratis-file-systems"/>Removing a Stratis pool</h2></div></div></div><p>
					This procedure removes an existing Stratis pool. Data stored on it are lost.
				</p><h4><a id="prerequisites_28"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Stratis is installed. See <a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#installing-stratis_setting-up-stratis-file-systems" title="Installing Stratis">the section called “Installing Stratis”</a>.
						</li><li class="listitem">
							The <code class="literal">stratisd</code> service is running.
						</li><li class="listitem">
							You have created a Stratis pool. See <a class="xref" href="managing-layered-local-storage-with-stratis_managing-file-systems.html#creating-a-stratis-pool_setting-up-stratis-file-systems" title="Creating a Stratis pool">the section called “Creating a Stratis pool”</a>.
						</li></ul></div><h4><a id="procedure_58"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							List file systems on the pool:
						</p><pre class="screen"># stratis filesystem list <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span></pre></li><li class="listitem"><p class="simpara">
							Unmount all file systems on the pool:
						</p><pre class="screen"># umount /stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs-1</span></em></span> \
         /stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs-2</span></em></span> \
         /stratis/<span class="emphasis"><em><span class="replaceable">my-pool</span></em></span>/<span class="emphasis"><em><span class="replaceable">my-fs-n</span></em></span></pre></li><li class="listitem"><p class="simpara">
							Destroy the file systems:
						</p><pre class="screen"># stratis filesystem destroy <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs-1</span></em></span> <span class="emphasis"><em><span class="replaceable">my-fs-2</span></em></span></pre></li><li class="listitem"><p class="simpara">
							Destroy the pool:
						</p><pre class="screen"># stratis pool destroy <span class="emphasis"><em><span class="replaceable">my-pool</span></em></span></pre></li><li class="listitem"><p class="simpara">
							Verify that the pool no longer exists:
						</p><pre class="screen"># stratis pool list</pre></li></ol></div><h4><a id="additional_resources_56"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">stratis(8)</code> man page
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="related-information-removing-stratis-file-systems"/>Related information</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <span class="emphasis"><em>Stratis Storage</em></span> website: <a class="link" href="https://stratis-storage.github.io/">https://stratis-storage.github.io/</a>
						</li></ul></div></div></div></div></body></html>