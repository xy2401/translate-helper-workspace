<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 从命令行登录Identity Management</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 从命令行登录Identity Management</h1></div></div></div><p>身份管理（IdM）使用Kerberos协议来支持单点登录。单点登录意味着用户只输入一次正确的用户名和密码，然后访问IdM服务，而系统不会再次提示输入凭据。
		</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>在IdM中，系统安全服务后台程序（SSSD）在用户使用相应的Kerberos主体名称成功登录到具有相应Kerberos主体名称的IdM客户端计算机上的桌面环境后，自动获取用户的票证授予票证（TGT）。这意味着在登录后，用户无需使用<span class="strong"><strong>kinit</strong></span>实用程序来访问IdM资源。
			</p></div><p>如果已清除Kerberos凭据缓存或Kerberos TGT已过期，则需要手动请求Kerberos票证以访问IdM资源。以下部分介绍在IdM中使用Kerberos时的基本用户操作。</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="using-kinit-to-log-in-to-ipa-login-cli"></a>使用<span class="strong"><strong>kinit</strong></span>手动登录IdM</h1></div></div></div><p>此过程描述了使用<span class="strong"><strong>kinit</strong></span>实用程序手动向身份管理（IdM）环境进行身份验证。<span class="strong"><strong>kinit</strong></span>实用程序代表IdM用户获取并缓存Kerberos票证授予票证（TGT）。
			</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>如果您已销毁初始Kerberos TGT或已过期，则仅使用此过程。作为IdM用户，当您登录本地计算机时，您也会自动登录到IdM。这意味着登录后，您无需使用<span class="strong"><strong>kinit</strong></span>实用程序来访问IdM资源。
				</p></div><h3><a id="procedure"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">登录IdM</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">在当前登录本地系统的用户的用户名下，使用<span class="strong"><strong>kinit</strong></span>而不指定用户名。例如，如果您在本地系统上以<code class="literal">example_user</code>身份登录：</p><pre class="literallayout">[example_user@server ~]$ <span class="strong"><strong>kinit</strong></span>
Password for example_user@EXAMPLE.COM:
[example_user@server ~]$</pre><p class="simpara">如果本地用户的用户名与IdM中的任何用户条目都不匹配，则身份验证尝试将失败：</p><pre class="literallayout">[example_user@server ~]$ <span class="strong"><strong>kinit</strong></span>
kinit: Client 'example_user@EXAMPLE.COM' not found in Kerberos database while getting initial credentials</pre></li><li class="listitem"><p class="simpara">使用与本地用户名不对应的Kerberos主体，将所需的用户名传递给<code class="literal">kinit</code>实用程序。例如，以<code class="literal">admin</code>用户身份登录：</p><pre class="literallayout">[example_user@server ~]$ <span class="strong"><strong>kinit admin</strong></span>
Password for admin@EXAMPLE.COM:
[example_user@server ~]$</pre></li></ul></div></li><li class="listitem"><p class="simpara">（可选）要验证登录是否成功，请使用<span class="strong"><strong>klist</strong></span>实用程序显示缓存的TGT。在以下示例中，缓存包含<code class="literal">example_user</code>主体的票证，这意味着在此特定主机上，当前只允许<code class="literal">example_user</code>访问IdM服务：</p><pre class="literallayout">$ <span class="strong"><strong>klist</strong></span>
Ticket cache: KEYRING:persistent:0:0
Default principal: <span class="strong"><strong>example_user@EXAMPLE.COM</strong></span>

Valid starting     	Expires            	Service principal
11/10/2019 08:35:45  	11/10/2019 18:35:45  	krbtgt/EXAMPLE.COM@EXAMPLE.COM</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="destroying-the-users-active-kerberos-ticket-idm_login-cli"></a>销毁用户的活动Kerberos票证</h1></div></div></div><p>本节介绍如何清除包含用户的活动Kerberos票证的凭据缓存。
			</p><h3><a id="procedure_2"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要销毁您的Kerberos票证：</p><pre class="literallayout">[example_user@server ~]$ <span class="strong"><strong>kdestroy</strong></span></pre></li><li class="listitem"><p class="simpara">（可选）检查Kerberos票证是否已被销毁：</p><pre class="literallayout">[example_user@server ~]$ <span class="strong"><strong>klist</strong></span>
<span class="strong"><strong>klist: Credentials cache keyring 'persistent:0:0' not found</strong></span></pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring-an-external-system-for-kerberos-authentication-login-cli"></a>配置外部系统以进行Kerberos身份验证</h1></div></div></div><p>本节介绍如何配置外部系统，以便Identity Management（IdM）用户可以使用其Kerberos凭据从外部系统登录到IdM。
			</p><p>当您的基础架构包含多个域或重叠域时，在外部系统上启用Kerberos身份验证尤其有用。如果系统尚未通过<code class="literal">ipa-client-install</code>注册到任何IdM域，这也很有用。
			</p><p>要从不是IdM域成员的系统启用对IdM的Kerberos身份验证，请在外部系统上定义特定于IdM的Kerberos配置文件。
			</p><h3><a id="prerequisites"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara"><code class="literal">krb5-workstation</code>软件包安装在外部系统上。
					</p><p class="simpara">要确定是否已安装软件包，请使用以下CLI命令：</p><pre class="literallayout"># <span class="strong"><strong>yum list installed krb5-workstation</strong></span>
Installed Packages
krb5-workstation.x86_64    1.16.1-19.el8     @BaseOS</pre></li></ul></div><h3><a id="procedure_3"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">将<code class="literal">/etc/krb5.conf</code>文件从IdM服务器复制到外部系统。例如：</p><pre class="literallayout"># <span class="strong"><strong>scp /etc/krb5.conf root@<span class="emphasis"><em>externalsystem.example.com</em></span>:/etc/krb5_ipa.conf</strong></span></pre><div class="warning" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">警告</h3><p>不要覆盖外部系统上现有的<code class="literal">krb5.conf</code>文件。
						</p></div></li><li class="listitem"><p class="simpara">在外部系统上，将终端会话设置为使用复制的IdM Kerberos配置文件：</p><pre class="literallayout">$ <span class="strong"><strong>export KRB5_CONFIG=/etc/krb5_ipa.conf</strong></span></pre><p class="simpara"><code class="literal">KRB5_CONFIG</code>变量仅在您注销之前暂时存在。要防止此丢失，请使用其他文件名导出变量。
					</p></li><li class="listitem">将Kerberos配置片段从<code class="literal">/etc/krb5.conf.d/</code>目录复制到外部系统。
					</li></ol></div><p>外部系统上的用户现在可以使用<code class="literal">kinit</code>实用程序对IdM服务器进行身份验证。
			</p><h2><a id="additional_resources"></a>其他资源</h2><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关Kerberos的详细信息，请参阅<code class="literal">krb5.conf(5)</code> ， <code class="literal">kinit(1)</code> ， <code class="literal">klist(1)</code>和<code class="literal">kdestroy(1)</code>手册页。
					</li></ul></div></div></div></body></html>