<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 调整Samba服务器的性能</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 调整Samba服务器的性能</h1></div></div></div><p>本章介绍了在某些情况下哪些设置可以提高Samba的性能，以及哪些设置可能会对性能产生负面影响。
		</p><p>本节的部分内容是从Samba Wiki中发布的<a class="link" href="https://wiki.samba.org/index.php/Performance_Tuning">性能调优</a>文档中采用的。许可证： <a class="link" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> 。作者和贡献者：请参阅Wiki页面上的<a class="link" href="https://wiki.samba.org/index.php?title=Performance_Tuning&amp;action=history">历史记录</a>选项卡。
		</p><h2><a id="prerequisites-assembly_tuning-the-performance-of-a-samba-server"></a>先决条件</h2><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">Samba设置为文件或打印服务器</p><p class="simpara">请参阅<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/deploying_different_types_of_servers/assembly_using-samba-as-a-server_deploying-different-types-of-servers">将Samba用作服务器</a> 。
				</p></li></ul></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="proc_setting-the-smb-protocol-version_assembly_tuning-the-performance-of-a-samba-server"></a>设置SMB协议版本</h1></div></div></div><p>每个新的SMB版本都会增加功能并提高协议的性能。最近的Windows和Windows Server操作系统始终支持最新的协议版本。如果Samba也使用最新的协议版本，连接到Samba的Windows客户端将从性能改进中受益。在Samba中，服务器最大协议的默认值设置为最新支持的稳定SMB协议版本。
			</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>要始终启用最新的稳定SMB协议版本，请不要设置<code class="literal">server max protocol</code>参数。如果手动设置参数，则需要使用每个新版本的SMB协议修改设置，以启用最新的协议版本。
				</p></div><p>以下过程说明如何使用<code class="literal">server max protocol</code>参数中的默认值。
			</p><h3><a id="procedure_8"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem">从<code class="literal">server max protocol</code>文件的<code class="literal">[global]</code>部分中删除<code class="literal">/etc/samba/smb.conf</code>参数。
					</li><li class="listitem"><p class="simpara">重新加载Samba配置</p><pre class="literallayout"># smbcontrol all reload-config</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="proc_tuning-shares-with-directories-that-contain-a-large-number-of-files_assembly_tuning-the-performance-of-a-samba-server"></a>使用包含大量文件的目录调整共享</h1></div></div></div><p>Linux支持区分大小写的文件名。因此，在搜索或访问文件时，Samba需要扫描目录中的大写和小写文件名。您可以配置共享以仅以小写或大写形式创建新文件，从而提高性能。
			</p><h3><a id="prerequisites_5"></a>先决条件</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Samba配置为文件服务器</li></ul></div><h3><a id="procedure_9"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">将共享上的所有文件重命名为小写。
					</p><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>使用此过程中的设置，将不再显示名称不是小写的文件。
						</p></div></li><li class="listitem"><p class="simpara">在共享的部分中设置以下参数：</p><pre class="literallayout">case sensitive = true
default case = lower
preserve case = no
short preserve case = no</pre><p class="simpara">有关参数的详细信息，请参阅<code class="literal">smb.conf(5)</code>手册页中的说明。
					</p></li><li class="listitem"><p class="simpara">验证<code class="literal">/etc/samba/smb.conf</code>文件：</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">重新加载Samba配置：</p><pre class="literallayout"># smbcontrol all reload-config</pre></li></ol></div><p>应用这些设置后，此共享上所有新创建的文件的名称使用小写。由于这些设置，Samba不再需要扫描目录中的大写和小写，这样可以提高性能。
			</p><h3><a id="additional_resources_11"></a>其他资源</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/deploying_different_types_of_servers/assembly_using-samba-as-a-server_deploying-different-types-of-servers#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server">使用testparm实用程序验证smb.conf文件</a>
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="con_settings-that-can-have-a-negative-performance-impact_assembly_tuning-the-performance-of-a-samba-server"></a>可能会对性能产生负面影响的设置</h1></div></div></div><p>默认情况下，Red Hat Enterprise Linux中的内核针对高网络性能进行了调整。例如，内核使用缓冲区大小的自动调整机制。在<code class="literal">socket options</code>文件中设置<code class="literal">/etc/samba/smb.conf</code>参数会覆盖这些内核设置。因此，在大多数情况下，设置此参数会降低Samba网络性能。
			</p><p>要使用内核中的优化设置，请从<code class="literal">socket options</code>的<code class="literal">[global]</code>部分删除<code class="literal">/etc/samba/smb.conf</code>参数。
			</p></div></div></body></html>