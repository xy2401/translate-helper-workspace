<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 文件系统和存储</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 文件系统和存储</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="file-systems_file-systems-and-storage"></a>文件系统</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="btrfs-has-been-removed_file-systems-and-storage"></a> Btrfs已被删除</h2></div></div></div><p>红帽企业版Linux 8中已删除Btrfs文件系统。这包括以下组件：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">btrfs.ko</code>内核模块</li><li class="listitem"><code class="literal">btrfs-progs</code>包</li><li class="listitem"><code class="literal">snapper</code>包</li></ul></div><p>您无法再在Red Hat Enterprise Linux 8中的Btrfs文件系统上创建，装载或安装。Anaconda安装程序和Kickstart命令不再支持Btrfs。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="xfs-now-supports-shared-copy-on-write-data-extents_file-systems-and-storage"></a> XFS现在支持共享的写时复制数据范围</h2></div></div></div><p>XFS文件系统支持共享的写时复制数据扩展功能。此功能允许两个或多个文件共享一组公共数据块。当共享公共块的任一文件发生更改时，XFS会断开与公共块的链接并创建新文件。这类似于其他文件系统中的写时复制（COW）功能。
				</p><p>共享的写时复制数据范围是：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">快速</span></dt><dd>创建共享副本不使用磁盘I / O.</dd><dt><span class="term">空间高效</span></dt><dd>共享块不会占用额外的磁盘空间。
							</dd><dt><span class="term">透明</span></dt><dd>共享公共块的文件就像常规文件一样。
							</dd></dl></div><p>用户空间实用程序可以使用共享的写时复制数据范围：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">高效的文件克隆，例如使用<code class="literal">cp --reflink</code>命令</li><li class="listitem">每个文件的快照</li></ul></div><p>内核子系统（如Overlayfs和NFS）也使用此功能来实现更高效的操作。
				</p><p>现在，在创建XFS文件系统时，默认情况下会启用共享的写时复制数据扩展区，从<code class="literal">xfsprogs</code>软件包版本<code class="literal">4.17.0-2.el8</code> 。
				</p><p>请注意，Direct Access（DAX）设备当前不支持具有共享写时复制数据范围的XFS。要创建没有此功能的XFS文件系统，请使用以下命令：</p><pre class="screen"># mkfs.xfs -m reflink=0 <span class="emphasis"><em>block-device</em></span></pre><p>Red Hat Enterprise Linux 7只能以只读模式安装具有共享写时复制数据扩展区的XFS文件系统。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="the-ext4-file-system-now-supports-metadata-checksums_file-systems-and-storage"></a> ext4文件系统现在支持元数据校验和</h2></div></div></div><p>通过此更新，ext4元数据受校验和保护。这使文件系统能够识别损坏的元数据，从而避免损坏并提高文件系统的弹性。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="the-etc-sysconfig-nfs-file-and-legacy-nfs-service-names-are-no-longer-available_file-systems-and-storage"></a> <code class="literal">/etc/sysconfig/nfs</code>文件和旧NFS服务名称不再可用</h2></div></div></div><p>在Red Hat Enterprise Linux 8.0中，NFS配置已从<code class="literal">/etc/sysconfig/nfs</code>配置文件（在Red Hat Enterprise Linux 7中使用）移至<code class="literal">/etc/nfs.conf</code> 。
				</p><p><code class="literal">/etc/nfs.conf</code>文件使用不同的语法。从Red Hat Enterprise Linux 7升级时，Red Hat Enterprise Linux 8会尝试自动将<code class="literal">/etc/sysconfig/nfs</code>所有选项转换为<code class="literal">/etc/nfs.conf</code> 。
				</p><p>Red Hat Enterprise Linux 7支持这两种配置文件。Red Hat建议您使用新的<code class="literal">/etc/nfs.conf</code>文件在与自动配置系统兼容的所有Red Hat Enterprise Linux版本中进行NFS配置。
				</p><p>此外，以下NFS服务别名已被删除并替换为其上游名称：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">nfs.service</code> ，替换为<code class="literal">nfs-server.service</code>
						</li><li class="listitem">
							<code class="literal">nfs-secure.service</code> ，替换为<code class="literal">rpc-gssd.service</code>
						</li><li class="listitem">
							<code class="literal">rpcgssd.service</code> ，替换为<code class="literal">rpc-gssd.service</code>
						</li><li class="listitem">
							<code class="literal">nfs-idmap.service</code> ，替换为<code class="literal">nfs-idmapd.service</code>
						</li><li class="listitem">
							<code class="literal">rpcidmapd.service</code> ，替换为<code class="literal">nfs-idmapd.service</code>
						</li><li class="listitem">
							<code class="literal">nfs-lock.service</code> ，替换为<code class="literal">rpc-statd.service</code>
						</li><li class="listitem">
							<code class="literal">nfslock.service</code> ，替换为<code class="literal">rpc-statd.service</code>
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="storage_file-systems-and-storage"></a>存储</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="the-boom-boot-manager-simplifies-the-process-of-creating-boot-entries_file-systems-and-storage"></a> BOOM启动管理器简化了创建启动条目的过程</h2></div></div></div><p>BOOM是Linux系统的启动管理器，它使用支持引导入口配置的BootLoader规范的引导加载程序。它支持灵活的引导配置，并简化了新的或修改的引导条目的创建：例如，引导使用LVM创建的系统的快照映像。</p><p>BOOM不会修改现有的引导加载程序配置，只会插入其他条目。维护现有配置，并且任何分发集成（例如内核安装和更新脚本）将继续像以前一样运行。
				</p><p>BOOM具有简化的命令行界面（CLI）和API，可简化创建引导条目的任务。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="stratis-is-available_file-systems-and-storage"></a> Stratis现已上市</h2></div></div></div><p>Stratis是一位新的本地存储经理。它在存储池之上提供托管文件系统，并为用户提供其他功能。
				</p><p>Stratis使您可以更轻松地执行存储任务，例如：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">管理快照和精简配置</li><li class="listitem">根据需要自动增大文件系统大小</li><li class="listitem">维护文件系统</li></ul></div><p>要管理Stratis存储，请使用<code class="literal">stratis</code>实用程序，该实用程序与<code class="literal">stratisd</code>后台服务进行通信。
				</p><p>Stratis作为技术预览版提供。
				</p><p>有关更多信息，请参阅Stratis文档： <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/managing_file_systems/managing-layered-local-storage-with-stratis_managing-file-systems">使用Stratis管理分层本地存储</a> 。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="luks2-is-now-the-default-format-for-encrypting-volumes_file-systems-and-storage"></a> LUKS2现在是加密卷的默认格式</h2></div></div></div><p>在RHEL 8中，LUKS版本2（LUKS2）格式取代了传统的LUKS（LUKS1）格式。<code class="literal">dm-crypt</code>子系统和<code class="literal">cryptsetup</code>工具现在使用LUKS2作为加密卷的默认格式。LUKS2为部分元数据损坏事件提供元数据冗余和自动恢复的加密卷。
				</p><p>由于内部灵活的布局，LUKS2也是未来功能的推动者。它支持通过<code class="literal">libcryptsetup</code>中内置的通用内核密钥环令牌自动解锁，允许用户使用存储在内核密钥环保留服务中的密码来解锁LUKS2卷。
				</p><p>其他值得注意的增强功能包括：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">使用包装密钥密码方案的受保护密钥设置。
						</li><li class="listitem">更容易与基于策略的解密（Clevis）集成。
						</li><li class="listitem">最多32个密钥插槽 -  LUKS1仅提供8个密钥插槽。
						</li></ul></div><p>有关更多详细信息，请参阅<code class="literal">cryptsetup(8)</code>和<code class="literal">cryptsetup-reencrypt(8)</code>手册页。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="multiqueue-scheduling-on-block-devices_file-systems-and-storage"></a>块设备上的多队列调度</h2></div></div></div><p>块设备现在在Red Hat Enterprise Linux 8中使用多队列调度。这使得块层性能可以通过快速固态驱动器（SSD）和多核系统很好地扩展。
				</p><p>SCSI Multiqueue（ <code class="literal">scsi-mq</code> ）驱动程序现在默认启用，内核使用<code class="literal">scsi_mod.use_blk_mq=Y</code>选项启动。此更改与上游Linux内核一致。
				</p><p>Device Mapper Multipath（DM Multipath）要求<code class="literal">scsi-mq</code>驱动程序处于活动状态。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="vdo-now-supports-all-architectures_file-systems-and-storage"></a> VDO现在支持所有体系结构</h2></div></div></div><p>虚拟数据优化器（VDO）现在可用于RHEL 8支持的所有体系结构。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="vdo-no-longer-supports-read-cache_file-systems-and-storage"></a> VDO不再支持读取缓存</h2></div></div></div><p>已从虚拟数据优化程序（VDO）中删除了读取缓存功能。读取高速缓存总是在VDO卷不起作用，你可以使用不再启用<code class="literal">--readCache</code>的备选方案<code class="literal">vdo</code>效用。
				</p><p>Red Hat可能会在后来的Red Hat Enterprise Linux版本中使用不同的实现重新引入VDO读取缓存。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="the-dmraid-package-has-been-removed_file-systems-and-storage"></a> <code class="literal">dmraid</code>包已被删除</h2></div></div></div><p><code class="literal">dmraid</code>软件包已从Red Hat Enterprise Linux 8中删除。需要支持组合硬件和软件RAID主机总线适配器（HBA）的用户应使用<code class="literal">mdadm</code>实用程序，该实用程序支持本机MD软件RAID，SNIA RAID通用磁盘数据格式（DDF）和Intel®MatrixStorage Manager（IMSM）格式。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="software-fcoe-and-fibre-channel-no-longer-support-the-target-mode_file-systems-and-storage"></a>软件FCoE和光纤通道不再支持目标模式</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">软件FCoE：NIC软件FCoE目标功能在Red Hat Enterprise Linux 8.0中被删除。
						</li><li class="listitem">光纤通道不再支持目标模式。红帽企业版Linux 8.0中的<code class="literal">qla2xxx</code> QLogic光纤通道驱动程序禁用了目标模式。
						</li></ul></div><p>有关更多信息，请参阅<a class="xref" href="hardware-enablement_considerations-in-adopting-RHEL-8.html#fcoe-sw-removal_hardware-enablement" title="FCoE软件删除">“FCoE软件删除”一节</a> 。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="the-detection-of-marginal-paths-in-dm-multipath-has-been-improved_file-systems-and-storage"></a> DM Multipath中边缘路径的检测得到了改进</h2></div></div></div><p><code class="literal">multipathd</code>服务现在支持改进的边缘路径检测。这有助于多路径设备避免可能重复失败的路径，并提高性能。边际路径是具有持久但间歇性I / O错误的路径。
				</p><p><code class="literal">/etc/multipath.conf</code>文件中的以下选项控制边际路径行为：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">marginal_path_double_failed_time</code>
						</li><li class="listitem">
							<code class="literal">marginal_path_err_sample_time</code>
						</li><li class="listitem">
							<code class="literal">marginal_path_err_rate_threshold</code>
						</li><li class="listitem">
							<code class="literal">marginal_path_err_recheck_gap_time</code>
						</li></ul></div><p>DM Multipath禁用路径并使用重复的I / O对配置的采样时间进行测试，如果：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">列出的<code class="literal">multipath.conf</code>选项已设置，</li><li class="listitem">路径在配置的时间内失败两次，并且</li><li class="listitem">其他路径可用。
						</li></ul></div><p>如果在此测试期间路径的配置错误率超过配置的错误率，则DM Multipath会在配置的间隔时间内忽略它，然后重新测试它以查看它是否运行良好以便恢复。
				</p><p>有关更多信息，请参见<code class="literal">multipath.conf</code>手册页。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="new-overrides-section-of-the-dm-multipath-configuration-file_file-systems-and-storage"></a> DM Multipath配置文件的新<code class="literal">overrides</code>部分</h2></div></div></div><p><code class="literal">/etc/multipath.conf</code>文件现在包含一个<code class="literal">overrides</code>部分，允许您为所有设备设置配置值。DM Multipath将这些属性用于所有设备，除非它们被<code class="literal">/etc/multipath.conf</code>文件的<code class="literal">multipaths</code>部分中指定的属性覆盖，以包含设备的路径。此功能替换配置文件的<code class="literal">devices</code>部分的<code class="literal">all_devs</code>参数，该参数不再受支持。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="nvme-fc-is-fully-supported-on-broadcom-emulex-and-marvell-qlogic-fibre-channel-adapters_file-systems-and-storage"></a> Broadcom Emulex和Marvell Qlogic光纤通道适配器完全支持NVMe / FC</h2></div></div></div><p>当与Broadcom Emulex和具有NVMe支持的Marvell Qlogic光纤通道32Gbit适配器一起使用时，NVMe over Fibre Channel（NVMe / FC）传输类型现在在Initiator模式下得到完全支持。
				</p><p>除了之前在Red Hat Enterprise Linux中引入的远程直接内存访问（RDMA）协议之外，NVMe over Fibre Channel是非易失性存储器快速（NVMe）协议的附加结构传输类型。
				</p><p>启用NVMe / FC：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">要在<code class="literal">lpfc</code>驱动程序中启用NVMe / FC，请编辑<code class="literal">/etc/modprobe.d/lpfc.conf</code>文件并添加以下选项：</p><pre class="screen">lpfc_enable_fc4_type=3</pre></li><li class="listitem"><p class="simpara">要在<code class="literal">qla2xxx</code>驱动程序中启用NVMe / FC，请编辑<code class="literal">/etc/modprobe.d/qla2xxx.conf</code>文件并添加以下选项：</p><pre class="screen">qla2xxx.ql2xnvmeenable=1</pre></li></ul></div><p>附加限制：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">NVMe / FC不支持多路径。</li><li class="listitem">NVMe / FC不支持NVMe群集。</li><li class="listitem">使用Marvell Qlogic适配器，Red Hat Enterprise Linux不支持同时在启动器端口上使用NVMe / FC和SCSI / FC。
						</li><li class="listitem">
							NVMe / FC不支持<code class="literal">kdump</code> 。</li><li class="listitem">从存储区域网络（SAN）引导NVMe / FC不受支持。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="support-for-data-integrity-field-data-integrity-extension-dif-dix_file-systems-and-storage"></a>支持数据完整性字段/数据完整性扩展（DIF / DIX）</h2></div></div></div><p>DIF / DIX是SCSI标准的补充。它保留在所有HBA和存储阵列的技术预览中，但特别列为支持的那些除外。
				</p><p>DIF / DIX将常用的512字节磁盘块的大小从512增加到520字节，添加了数据完整性字段（DIF）。DIF存储数据块的校验和值，该值由主机总线适配器（HBA）在发生写入时计算。然后，存储设备在接收时确认校验和，并存储数据和校验和。相反，当发生读取时，校验和可以由存储设备和接收HBA验证。</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="lvm_file-systems-and-storage"></a> LVM</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="removal-of-clvmd-for-managing-shared-storage-devices_file-systems-and-storage"></a>删除<code class="literal">clvmd</code>以管理共享存储设备</h2></div></div></div><p>LVM不再使用<code class="literal">clvmd</code> （cluster lvm守护程序）来管理共享存储设备。相反，LVM现在使用<code class="literal">lvmlockd</code> （lvm lock daemon）。
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">有关使用<code class="literal">lvmlockd</code>详细信息，请参见<code class="literal">lvmlockd(8)</code>手册页。有关一般使用共享存储的详细信息，请参见<code class="literal">lvmsystemid(7)</code>手册页。
						</li><li class="listitem">有关在Pacemaker集群中使用LVM的信息，请参阅<code class="literal">LVM-activate</code>资源代理的帮助屏幕。
						</li><li class="listitem">有关在Red Hat High Availability集群中配置共享逻辑卷的过程示例，请参阅<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/configuring_and_managing_high_availability_clusters/#assembly_configuring-gfs2-in-a-cluster-configuring-and-managing-high-availability-clusters">在集群中配置GFS2文件系统</a> 。
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="removal-of-lvmetad-daemon_file-systems-and-storage"></a>删除<code class="literal">lvmetad</code>守护进程</h2></div></div></div><p>LVM不再使用<code class="literal">lvmetad</code>守护程序缓存元数据，并始终从磁盘读取元数据。LVM磁盘读取已减少，这降低了缓存的好处。
				</p><p>以前，逻辑卷的自动<code class="literal">use_lvmetad</code>间接与<code class="literal">lvm.conf</code>配置文件中的<code class="literal">use_lvmetad</code>设置相关联。禁用自动激活的正确方法是继续在<code class="literal">lvm.conf</code>文件中设置<code class="literal">auto_activation_volume_list</code> 。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="lvm-can-no-longer-manage-devices-formatted-with-the-gfs-pool-volume-manager-or-the-lvm1-metadata-format_file-systems-and-storage"></a> LVM无法再管理使用GFS池卷管理器或<code class="literal">lvm1</code>元数据格式格式化的设备。</h2></div></div></div><p>LVM无法再管理使用GFS池卷管理器或`lvm1`元数据格式格式化的设备。如果您在引入Red Hat Enterprise Linux 4之前创建了逻辑卷，那么这可能会对您产生影响。应使用<code class="literal">vgconvert</code>命令将使用<code class="literal">lvm1</code>格式的卷组转换为<code class="literal">lvm2</code>格式。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="lvm-libraries-and-lvm-python-bindings-have-been-removed_file-systems-and-storage"></a> LVM库和LVM Python绑定已被删除</h2></div></div></div><p>由<code class="literal">lvm2-python-libs</code>包提供的<code class="literal">lvm2app</code>库和LVM Python绑定已被删除。红帽推荐以下解决方案：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">LVM D-Bus API与<code class="literal">lvm2-dbusd</code>服务相结合。这需要使用Python版本3。
						</li><li class="listitem">具有JSON格式的LVM命令行实用程序;自<code class="literal">lvm2</code>软件包版本2.02.158以来，此格式化已可用。
						</li><li class="listitem">包含在AppStream中的<code class="literal">libblockdev</code>库，用于C / C ++</li></ul></div><p>在升级到Red Hat Enterprise Linux 8之前，必须使用已删除的库和绑定到D-Bus API来移植任何应用程序。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="the-ability-to-mirror-the-log-for-lvm-mirrors-has-been-removed_file-systems-and-storage"></a>已删除镜像LVM镜像日志的功能</h2></div></div></div><p>已删除镜像LVM卷的镜像日志功能。红帽企业Linux（RHEL）8不再支持使用镜像镜像日志创建或激活LVM卷。
				</p><p>推荐的替代品是：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">RAID1 LVM卷。RAID1卷的主要优点是即使在降级模式下也能工作，并在瞬态故障后恢复。
						</li><li class="listitem">磁盘镜像日志。要将镜像镜像日志转换为磁盘镜像日志，请使用以下命令： <code class="literal">lvconvert --mirrorlog disk my_vg/my_lv</code> 。</li></ul></div></div></div></div></body></html>