<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 在RHEL上部署会话记录</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 在RHEL上部署会话记录</h1></div></div></div><p>在本节中，我们将介绍如何在Red Hat Enterprise Linux系统上部署会话记录解决方案。
		</p><div class="title"><strong>先决条件</strong></div><p>为了能够部署会话记录解决方案，您需要安装以下软件包： <code class="literal">tlog</code> ，SSSD， <code class="literal">cockpit-session-recording</code> 。
			</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="installing-tlog-deploying-session-recording"></a>安装tlog</h1></div></div></div><p>安装<code class="literal">tlog</code>包。
			</p><h3><a id="procedure"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem">跑</li></ol></div><pre class="literallayout"># yum install tlog</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="installing-cockpit-session-recording-deploying-session-recording"></a>安装<code class="literal">cockpit-session-recording</code></h1></div></div></div><p>默认情况下，基本Web控制台软件包是Red Hat Enterprise Linux 8的一部分。为了能够使用会话记录解决方案，您必须安装<code class="literal">cockpit-session-recording</code>软件包并启动或启用系统上的Web控制台：</p><h3><a id="procedure_2"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">安装<code class="literal">cockpit-session-recording</code> 。
					</p><pre class="literallayout"># yum install cockpit-session-recording</pre></li><li class="listitem"><p class="simpara">启动或启用系统上的Web控制台：</p><pre class="literallayout"># systemctl start cockpit.socket</pre><p class="simpara">要么</p><pre class="literallayout"># systemctl enable cockpit.socket --now</pre></li></ol></div><p>如果安装了所有必需的软件包，则可以继续配置录制参数。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring-recorded-users-or-user-groups-with-sssd-from-cli-deploying-session-recording"></a>从CLI配置带SSSD的录制用户或用户组</h1></div></div></div><p>如果您选择使用SSSD管理录制的用户或用户组，这是推荐的选项，则将保留每个用户的原始shell。
			</p><h3><a id="procedure_3"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">要从命令行界面（CLI）指定要记录的用户或用户组，请修改打开<code class="literal">sssd-session-recording.conf</code>配置文件：</p><pre class="literallayout"># vi /etc/sssd/conf.d/sssd-session-recording.conf</pre><div class="note" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><p>在Web控制台界面中打开配置页面后，将自动创建<code class="literal">sssd-session-recording.conf</code>文件。
						</p></div></li><li class="listitem"><p class="simpara">指定记录的用户或用户组的范围，输入：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<code class="literal">none</code>记录没有会话。
							</li><li class="listitem">
								<code class="literal">some</code>只记录指定的会话。
							</li><li class="listitem">
								<code class="literal">all</code>记录所有会话。
							</li></ul></div></li><li class="listitem">如果您选择<code class="literal">some</code>作为录制用户或组的范围，请将其名称除以逗号添加到文件中。
					</li></ol></div><div class="example"><a id="idm140186683961712"></a><p class="title"><strong>例2.1。SSSD配置</strong></p><div class="example-contents"><p>在以下示例中，用户<code class="literal">example1</code>和<code class="literal">example2</code>以及组<code class="literal">examples</code>启用了会话记录。
				</p><pre class="literallayout">[session_recording]
scope = some
users = example1, example2
groups = examples</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuring-recorded-users-or-user-groups-with-sssd-from-webui-deploying-session-recording"></a>使用Web UI从SSN配置录制的用户或用户组</h1></div></div></div><p>使用SSSD指定记录用户或用户组的第二个选项是直接在RHEL 8 Web控制台中列出它们。
			</p><h3><a id="procedure_4"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem">通过输入<code class="literal">localhost:9090</code>或在浏览器中输入您的IP地址<code class="literal">&lt;IP_ADDRESS&gt;:9090</code> ，在本地连接到RHEL 8 Web控制台。
					</li><li class="listitem"><p class="simpara">登录RHEL 8 Web控制台。
					</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>您的用户必须具有管理员权限才能查看记录的会话。
						</p></div></li><li class="listitem">转到界面左侧菜单中的Session Recording页面。
					</li><li class="listitem"><p class="simpara">单击右上角的齿轮按钮。
					</p><div class="informalfigure"><div class="mediaobject"><img src="images/session-recording-config.png" alt="SSSD配置按钮"></div></div></li><li class="listitem"><p class="simpara">在SSSD配置表中设置参数。“用户和组”列表中的名称应以逗号分隔。
					</p><div class="example"><a id="idm140186683782896"></a><p class="title"><strong>例2.2。使用SSSD配置录制的用户</strong></p><div class="example-contents"><div class="informalfigure"><div class="mediaobject"><img src="images/session-recording-sssd-conf.png" alt="SSSD配置"></div></div></div></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="configuration-of-recorded-users-or-user-groups-without-sssd-deploying-session-recording"></a>配置没有SSSD的录制用户或用户组</h1></div></div></div><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>请注意，建议不要使用此做法。首选项是通过SSSD从命令行界面或直接从RHEL 8 Web控制台配置录制的用户。
				</p></div><p>如果选择手动更改用户的shell，则其工作shell将是<code class="literal">tlog-rec-session.conf</code>配置文件中列出的<code class="literal">tlog-rec-session.conf</code> 。
			</p><p>如果您不想使用SSSD指定记录的用户或用户组，则可以直接将要记录的用户的shell更改为<code class="literal">/usr/bin/tlog-rec-session</code> ：</p><pre class="literallayout"># chsh &lt;user_name&gt;
Changing shell for &lt;user_name&gt;.
New shell [&lt;/old/shell/location&gt;]</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="exporting-recorded-sessions-to-a-file-deploying-session-recording"></a>将记录的会话导出到文件</h1></div></div></div><p>您可以导出录制的会话及其日志并进行复制。
			</p><p>以下过程说明如何在本地系统上导出录制的会话。
			</p><div class="title"><strong>先决条件</strong></div><p>安装<code class="literal">systemd-journal-remote</code>软件包。
				</p><pre class="literallayout"># yum install systemd-journal-remote</pre><h3><a id="procedure_5"></a>程序</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">运行<code class="literal">journalctl -o export</code>命令：</p><pre class="literallayout"># <code class="literal">journalctl -o export | systemd-journal-remote -o /tmp/dir/example.journal -</code></pre></li></ul></div><p>这将从系统日志及其所有实体创建导出文件。然后，您可以将导出的文件复制到任何其他主机上的<code class="literal">/var/log/journal/</code>目录中。为方便起见，您还可以为远程主机的导出文件创建<code class="literal">/var/log/journal/remote/</code>目录。
			</p></div></div></body></html>