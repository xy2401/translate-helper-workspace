<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 锁定所选任务</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 锁定所选任务</h1></div></div></div><p>本节介绍如何锁定用户以下任务：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">印花</li><li class="listitem">文件保存在磁盘上</li><li class="listitem">重新分区</li><li class="listitem">用户注销和用户切换</li></ul></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="locking-down-printing_locking-down-selected-tasks"></a>锁定打印</h1></div></div></div><p>您可以禁止将打印对话框显示给用户。如果您要临时访问用户或者不希望用户打印到网络打印机，这可能很有用。
			</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>该功能仅适用于支持它的应用程序。并非所有GNOME和第三方应用程序都启用了此功能。这些更改对不支持此功能的应用程序没有影响。
				</p></div><p>要阻止打印应用程序，请锁定<code class="literal">org.gnome.desktop.lockdown.disable-printing</code>键：</p><h3><a id="procedure_30"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">在<code class="literal">/etc/dconf/profile/user</code>创建用户配置文件，除非它已经存在：</p><pre class="literallayout">user-db:user
system-db:local</pre></li><li class="listitem"><p class="simpara">在<code class="literal">etc/dconf/db/local.d/00-lockdown</code>文件中为机器范围的设置创建本地数据库：</p><pre class="literallayout">[org/gnome/desktop/lockdown]

# Prevent applications from printing
disable-printing=true</pre></li><li class="listitem"><p class="simpara">覆盖用户的设置并阻止用户在<code class="literal">/etc/dconf/db/local.d/locks/lockdown</code>文件中更改它：</p><pre class="literallayout"># List the keys used to configure lockdown
/org/gnome/desktop/lockdown/disable-printing</pre></li><li class="listitem"><p class="simpara">更新系统数据库：</p><pre class="literallayout"># dconf update</pre></li></ol></div><p>完成这些步骤后，支持此锁定键的应用程序（如<span class="strong"><strong><span class="application">Evolution</span></strong></span> ， <span class="strong"><strong><span class="application">Evince</span></strong></span>或<span class="strong"><strong><span class="application">Gedit</span></strong></span> ）将禁用打印。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="locking-file-saving-on-disk_locking-down-selected-tasks"></a>锁定磁盘上的文件保存</h1></div></div></div><p>您可以禁用“ <code class="literal">Save</code>和“ <code class="literal">Save As</code>对话框。如果您要临时访问用户，或者您不希望用户将文件保存到计算机，这可能很有用。
			</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>该功能仅适用于支持它的应用程序。并非所有GNOME和第三方应用程序都启用了此功能。更改将不会对不支持此功能的应用程序产生影响。
				</p></div><p>要阻止应用程序保存文件，请锁定<code class="literal">org.gnome.desktop.lockdown.disable-save-to-disk</code>密钥：</p><h3><a id="procedure_31"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">在<code class="literal">/etc/dconf/profile/user</code>创建用户配置文件，除非它已经存在：</p><pre class="literallayout">user-db:user
system-db:local</pre></li><li class="listitem"><p class="simpara">在<code class="literal">/etc/dconf/db/local.d/00-lockdown</code>文件中为机器范围的设置创建本地数据库：</p><pre class="literallayout">[org/gnome/desktop/lockdown]

# Prevent the user from saving files on disk
disable-save-to-disk=true</pre></li><li class="listitem"><p class="simpara">覆盖用户的设置并阻止用户在<code class="literal">/etc/dconf/db/local.d/locks/lockdown</code>文件中更改它：</p><pre class="literallayout"># Lock this key to disable saving files on disk
/org/gnome/desktop/lockdown/disable-save-to-disk</pre></li><li class="listitem"><p class="simpara">更新系统数据库：</p><pre class="literallayout"># dconf update</pre></li></ol></div><p>完成这些步骤后，支持此锁定键的应用程序（例如<span class="strong"><strong><span class="application">视频</span></strong></span> ， <span class="strong"><strong><span class="application">图像查看器</span></strong></span> ， <span class="strong"><strong><span class="application">Evolution</span></strong></span> ， <span class="strong"><strong><span class="application">文档查看器</span></strong></span>或<span class="strong"><strong><span class="application">GNOME Shell</span></strong></span> ）将禁用其“ <code class="literal">Save As</code>对话框。
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="locking-repartitioning_locking-down-selected-tasks"></a>锁定重新分区</h1></div></div></div><p>
				<code class="literal">polkit</code>使您可以为各个操作设置权限。对于磁盘管理服务实用程序<span class="strong"><strong><span class="application">udisks2</span></strong></span> ，配置位于<code class="literal">/usr/share/polkit-1/actions/org.freedesktop.udisks2.policy</code> 。此文件包含一组操作和默认值，可由系统管理员覆盖。
			</p><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>
					存储在<code class="literal">polkit</code> <code class="literal">/etc</code>配置会覆盖<code class="literal">/usr/share/</code>软件包提供的配置。
				</p></div><h3><a id="procedure_32"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">创建一个与<code class="literal">/usr/share/polkit-1/actions/org.freedesktop.udisks2.policy</code>相同内容的文件：</p><pre class="literallayout">cp /usr/share/polkit-1/actions/org.freedesktop.udisks2.policy /etc/share/polkit-1/actions/org.freedesktop.udisks2.policy</pre><p class="simpara">不要更改<code class="literal">/usr/share/polkit-1/actions/org.freedesktop.udisks2.policy</code>文件，您的更改将被下一个包更新覆盖。
					</p></li><li class="listitem"><p class="simpara">删除不需要的操作，并将以下行添加到<code class="literal">/etc/polkit-1/actions/org.freedesktop.udisks2.policy</code>文件中：</p><pre class="literallayout">&lt;action id="org.freedesktop.udisks2.modify-device"&gt;
  &lt;message&gt;Authentication is required to modify the disks settings&lt;/message&gt;
     &lt;defaults&gt;
        &lt;allow_any&gt;no&lt;/allow_any&gt;
        &lt;allow_inactive&gt;no&lt;/allow_inactive&gt;
        &lt;allow_active&gt;yes&lt;/allow_active&gt;
      &lt;/defaults&gt;
 &lt;/action&gt;</pre><p class="simpara">如果要确保只有<code class="literal">no</code>用户能够执行操作，请使用<code class="literal">auth_admin</code>替换<code class="literal">root</code> 。
					</p></li><li class="listitem">保存更改。
					</li></ol></div><p>当用户尝试更改磁盘设置时，将返回以下消息：</p><pre class="literallayout">Authentication is required to modify the disks settings.</pre></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="locking-down-user-logout-and-user-switching_locking-down-selected-tasks"></a>锁定用户注销和用户切换</h1></div></div></div><p>要防止用户注销，请使用以下过程。
			</p><h3><a id="procedure_33"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">创建<code class="literal">/etc/dconf/profile/user</code>配置文件，其中包含以下行：</p><pre class="literallayout">user-db:user
system-db:local</pre><p class="simpara">其中<code class="literal">local</code>是dconf数据库的名称</p></li><li class="listitem">如果目录尚不存在，请创建<code class="literal">/etc/dconf/db/local.d/</code>目录。
					</li><li class="listitem"><p class="simpara">创建<code class="literal">/etc/dconf/db/local.d/00-logout</code>密钥文件以提供本地数据库的信息：</p><pre class="literallayout">[org/gnome/desktop/lockdown]
# Prevent the user from user switching
disable-log-out=true</pre></li><li class="listitem"><p class="simpara">覆盖用户的设置，并阻止用户在<code class="literal">/etc/dconf/db/local.d/locks/lockdown</code>文件中更改它：</p><pre class="literallayout"># Lock this key to disable user logout
/org/gnome/desktop/lockdown/disable-log-out</pre></li><li class="listitem"><p class="simpara">更新系统数据库：</p><pre class="literallayout"># dconf update</pre></li><li class="listitem">在系统范围的设置生效之前，用户必须先注销并重新登录。
					</li></ol></div><div class="important" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">重要</h3><p>用户可以通过切换到其他用户来规避注销锁定。要防止出现这种情况，请同时锁定用户swithcing。
				</p></div><p>要锁定用户切换，请使用以下过程：</p><h3><a id="procedure_34"></a>程序</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">创建<code class="literal">/etc/dconf/profile/user</code>配置文件，其中包含以下行：</p><pre class="literallayout">user-db:user
system-db:local</pre><p class="simpara">其中<code class="literal">local</code>是dconf数据库的名称</p></li><li class="listitem">如果目录尚不存在，请创建<code class="literal">/etc/dconf/db/local.d/</code>目录。
					</li><li class="listitem"><p class="simpara">创建<code class="literal">/etc/dconf/db/local.d/00-user-switching</code>密钥文件以提供本地数据库的信息：</p><pre class="literallayout">[org/gnome/desktop/lockdown]
# Prevent the user from user switching
disable-user-switching=true</pre></li><li class="listitem"><p class="simpara">覆盖用户的设置，并阻止用户在<code class="literal">/etc/dconf/db/local.d/locks/lockdown</code>文件中更改它：</p><pre class="literallayout"># Lock this key to disable user switching
/org/gnome/desktop/lockdown/disable-user-switching</pre></li><li class="listitem"><p class="simpara">更新系统数据库：</p><pre class="literallayout"># dconf update</pre></li><li class="listitem">在系统范围的设置生效之前，用户必须先注销并重新登录。
					</li></ol></div></div></div></body></html>