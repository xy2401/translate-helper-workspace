<html  xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 9. 核心</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"></head><body ><div class="chapter"><div class="titlepage"><div><div><h1 class="title">Chapter 9. 核心</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="resource-control_kernel"></a>资源控制</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="control_group_v2_available_as_a_technology_preview_in_rhel_8"></a>控制组v2在RHEL 8中作为技术预览版提供</h2></div></div></div><p>
					<span class="strong"><strong>控制组v2</strong></span>机制是统一的层次控制组。<span class="strong"><strong>控制组v2</strong></span>按层次组织流程，并以受控和可配置的方式沿层次结构分配系统资源。
				</p><p>与以前的版本不同， <span class="strong"><strong>控制组v2</strong></span>只有一个层次结构。这个单一的层次结构使Linux内核能够：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">根据所有者的角色对流程进行分类。
						</li><li class="listitem">消除多个层次结构的冲突策略的问题。
						</li></ul></div><p>
					<span class="strong"><strong>控制组v2</strong></span>支持多个控制器：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">CPU控制器调节CPU周期的分布。该控制器实现：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">正常调度策略的权重和绝对带宽限制模型。
								</li><li class="listitem">实时调度策略的绝对带宽分配模型。
								</li></ul></div></li><li class="listitem"><p class="simpara">内存控制器调节内存分配。目前，跟踪以下类型的内存使用情况：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Userland内存 - 页面缓存和匿名内存。
								</li><li class="listitem">内核数据结构，例如dentries和inode。
								</li><li class="listitem">TCP套接字缓冲区。
								</li></ul></div></li><li class="listitem">I / O控制器调节I / O资源的分配。
						</li><li class="listitem">远程直接内存访问（RDMA）控制器限制某些进程可以使用的RDMA / IB特定资源。这些过程通过RDMA控制器进行分组。
						</li><li class="listitem">进程号控制器使控制组能够在某个限制之后阻止任何新任务成为<code class="literal">fork()</code>或<code class="literal">clone()</code> 。
						</li><li class="listitem">写回控制器充当一种机制，可以平衡I / O和内存控制器之间的冲突。
						</li></ul></div><p>以上信息基于<span class="emphasis"><em><span class="citetitle"><a class="link" href="https://www.kernel.org/doc/Documentation/cgroup-v2.txt">cgroups-v2在线文档</a></span></em></span> 。您可以参考相同的链接以获取有关特定<span class="strong"><strong>控制组v2</strong></span>控制器的更多信息。
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="memory-management_kernel"></a>内存管理</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="fifty-two_bit_pa_for_64_bit_arm_available"></a>可用于64位ARM的52位PA</h2></div></div></div><p>通过此更新，可以支持64位ARM体系结构的52位物理寻址（PA）。这提供了比以前的48位PA更大的物理地址空间。</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="five_level_page_tables_x86_64"></a> 5级页表x86_64</h2></div></div></div><p>在Red Hat Enterprise Linux 7中，现有内存总线具有48/46位的虚拟/物理内存寻址能力，而Linux内核实现了4级页表来管理这些虚拟地址到物理地址。物理总线寻址线将物理内存上限容量设置为64 TB。</p><p>这些限制已扩展到57/52位虚拟/物理内存寻址，具有128 PiB的虚拟地址空间（64PB用户/ 64PB内核）和4 PB的物理内存容量。
				</p><p>通过扩展的地址范围，Red Hat Enterprise Linux 8中的内存管理增加了对5级页表实现的支持，以便能够处理扩展的地址范围。默认情况下，即使在支持此功能的系统上，RHEL8也会禁用5级页表支持。这是因为如果不需要扩展的虚拟或物理地址空间，则在使用5级页表时可能会降低性能。引导参数将使具有支持此功能的硬件的系统能够使用它。
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="performance-analysis-and-observability-tools_kernel"></a>绩效分析和可观察性工具</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="bpftool_added_to_kernel"></a> bpftool添加到内核</h2></div></div></div><p><code class="literal">bpftool</code>实用程序已添加到Linux内核中，该实用程序用于检查和简单操作基于扩展Berkeley数据包过滤（eBPF）的程序和映射。 <code class="literal">bpftool</code>是内核源代码树的一部分，由<span class="strong"><strong>bpftool</strong></span>包提供，该包作为<span class="strong"><strong>内核</strong></span>包的子包包含在内。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ebpf_available_as_a_technology_preview"></a> eBPF可用作技术预览版</h2></div></div></div><p><span class="strong"><strong>扩展的Berkeley数据包过滤（eBPF）</strong></span>功能可用作网络和跟踪的技术预览。 <span class="strong"><strong>eBPF</strong></span>使用户空间能够将自定义程序附加到各种点（套接字，跟踪点，数据包接收）以接收和处理数据。该功能包括一个新的系统调用<code class="literal">bpf()</code> ，它支持创建各种类型的映射，还可以将各种类型的程序插入到内核中。请注意， <code class="literal">bpf()</code>系统调用只能由具有<code class="literal">CAP_SYS_ADMIN</code>功能的<code class="literal">CAP_SYS_ADMIN</code> （例如root用户<code class="literal">bpf()</code>成功使用。有关更多信息，请参见<code class="literal">bpf</code> （2）手册页。
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="bcc_is_available_as_a_technology_preview"></a> BCC可用作技术预览版</h2></div></div></div><p>
					<code class="literal">BPF Compiler Collection (BCC)</code>是一个用户空间工具包，用于创建高效的内核跟踪和操作程序，可作为Red Hat Enterprise Linux 8中的技术预览版提供。<code class="literal">BCC</code>使用<code class="literal">extended Berkeley Packet Filtering (eBPF)</code>为Linux操作系统提供I / O分析，联网和监控工具。
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="booting-process_kernel"></a>启动过程</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="how_to_install_and_boot_custom_kernels_in_rhel_8"></a>如何在RHEL 8中安装和引导自定义内核</h2></div></div></div><p>引导加载程序规范（BLS）定义了一种方案和文件格式，用于管理drop-in目录中每个引导选项的引导加载程序配置。无需操作各个插入配置文件。这个前提在Red Hat Enterprise Linux 8中尤为重要，因为并非所有架构都使用相同的引导加载程序：</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							带有开放固件的<code class="literal">x86_64</code> ， <code class="literal">aarch64</code>和<code class="literal">ppc64le</code>使用<code class="literal">GRUB2</code>
						</li><li class="listitem">
							<code class="literal">ppc64le</code>与打开电源抽象层（OPAL）使用<code class="literal">Petitboot</code>
						</li><li class="listitem">
							<code class="literal">s390x</code>使用<code class="literal">zipl</code>
						</li></ul></div><p>每个引导加载程序都有不同的配置文件和格式，在安装或删除新内核时必须对其进行修改。在以前版本的Red Hat Enterprise Linux中，允许这项工作的组件是<code class="literal">grubby</code>实用程序。但是，对于Red Hat Enterprise Linux 8，引导加载程序配置通过实现BLS文件格式进行了标准化，其中<code class="literal">grubby</code>作为BLS操作的瘦包装器。
				</p></div></div></div></body></html>