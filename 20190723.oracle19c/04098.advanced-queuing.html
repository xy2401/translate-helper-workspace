<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Oracle Advanced Queuing</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="JDBC Developer's Guide">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="JDBC Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="jdbc-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-02-13T13:20:37-08:00">
      <meta name="dcterms.title" content="JDBC Developer's Guide">
      <meta name="dcterms.dateCopyrighted" content="1999, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96471-02">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="database-sharding.html" title="Previous" type="text/html">
      <link rel="next" href="continuos-query-notification.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="JJDBC">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="database-sharding.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="continuos-query-notification.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">JDBC Developer's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="performance-and-scalability.html" property="item" typeof="WebPage"><span property="name"> Performance and Scalability</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Oracle Advanced Queuing </li>
            </ol>
            <a id="GUID-2031547B-6E72-4C75-A75A-AD0D3A31AE76" name="GUID-2031547B-6E72-4C75-A75A-AD0D3A31AE76"></a><a id="JJDBC28801"></a>
            
            <h2 id="JJDBC-GUID-2031547B-6E72-4C75-A75A-AD0D3A31AE76" class="sect2"><span class="enumeration_chapter">26 </span> Oracle Advanced Queuing 
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>Oracle Advanced Queuing (AQ) provides database-integrated message queuing functionality. It is built on top of Oracle Streams and optimizes the functions of Oracle Database so that messages can be stored persistently, propagated between queues on different computers and databases, and transmitted using Oracle Net Services, HTTP, and HTTPS. Because Oracle AQ is implemented in database tables, all operational benefits of high availability, scalability, and reliability are also applicable to queue data. This chapter provides information about the Java interface to Oracle AQ.</p>
               <div class="infoboxnote" id="GUID-2031547B-6E72-4C75-A75A-AD0D3A31AE76__GUID-34BB8418-B244-4E82-808D-CEBFCFEF70F9">
                  <p class="notep1">Note:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Oracle Advanced Queuing (AQ) is a feature of the Oracle JDBC Thin driver and is not supported by JDBC OCI driver.</p>
                     </li>
                     <li>
                        <p>In Oracle Database 12<span class="italic">c </span>Release 1 (12.1), support for <code class="codeph">XMLType</code> queues has been added. Till Oracle Database 11<span class="italic">g</span> Release 1, supported queue types were <code class="codeph">RAW</code>, <code class="codeph">ADT</code>, and <code class="codeph">ANYDATA</code> queue types.
                        </p>
                     </li>
                  </ul>
               </div>
               <div class="infoboxnotealso" id="GUID-2031547B-6E72-4C75-A75A-AD0D3A31AE76__GUID-2305924F-E1C2-4EAA-B769-17FF66E86CD1">
                  <p class="notep1">See Also:</p>
                  <p><a href="../adque/aq-introduction.html#ADQUE-GUID-9714FE10-9721-4C78-93C6-0A3C4D9F5CBD" target="_blank"><span><cite>Oracle Database Advanced Queuing User's Guide</cite></span></a></p>
               </div>
               <p>This chapters covers the following topics:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="advanced-queuing.html#GUID-270EF1FE-F9C1-4767-86C9-DC798B7DA213">Functionality and Framework of Oracle Advanced Queuing</a></p>
                  </li>
                  <li>
                     <p><a href="advanced-queuing.html#GUID-F97B8E25-C394-468B-97BF-41ECE8C42AC5">Making Changes to the Database</a></p>
                  </li>
                  <li>
                     <p><a href="advanced-queuing.html#GUID-54F01AE4-0C8E-4A94-8C26-93F60B9C1B71">AQ Asynchronous Event Notification</a></p>
                  </li>
                  <li>
                     <p><a href="advanced-queuing.html#GUID-CCEF5E83-7338-4EF5-B9DE-27E468AC59B5">About Creating Messages</a></p>
                  </li>
                  <li>
                     <p><a href="advanced-queuing.html#GUID-CF24AC0C-FC14-4062-A9C0-CAB96F1C8D3E">Enqueuing Messages</a></p>
                  </li>
                  <li>
                     <p><a href="advanced-queuing.html#GUID-163B54F8-B3CF-41EE-9910-47D06F3A7D7A">Dequeuing Messages</a></p>
                  </li>
                  <li>
                     <p><a href="advanced-queuing.html#GUID-A74A1FDD-8984-411C-9706-19A0A6FF0429">Examples: Enqueuing and Dequeuing</a></p>
                  </li>
               </ul>
            </div><a id="JJDBC28802"></a><div class="props_rev_3"><a id="GUID-270EF1FE-F9C1-4767-86C9-DC798B7DA213" name="GUID-270EF1FE-F9C1-4767-86C9-DC798B7DA213"></a><h3 id="JJDBC-GUID-270EF1FE-F9C1-4767-86C9-DC798B7DA213" class="sect3"><span class="enumeration_section">26.1 </span>Functionality and Framework of Oracle Advanced Queuing
               </h3>
               <div>
                  <div class="section">
                     <p>The Oracle JDBC package <code class="codeph">oracle.jdbc.aq</code> provides a fast Java interface to AQ. This package contains the following:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Classes</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">AQDequeueOptions</code></p>
                                 <p>Specifies the options available for the dequeue operation</p>
                              </li>
                              <li>
                                 <p><code class="codeph">AQEnqueueOptions</code></p>
                                 <p>Specifies the options available for the enqueue operation</p>
                              </li>
                              <li>
                                 <p><code class="codeph">AQFactory</code></p>
                                 <p>Is a factory class for AQ</p>
                              </li>
                              <li>
                                 <p><code class="codeph">AQNotificationEvent</code></p>
                                 <p>Is created whenever a new message is enqueued in a queue for which you have registered your interest</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>Interfaces</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">AQAgent</code></p>
                                 <p>Used to represent and identify a user of the queue or a producer or consumer of the message</p>
                              </li>
                              <li>
                                 <p><code class="codeph">AQMessage</code></p>
                                 <p>Represents a message that is enqueued or dequeued</p>
                              </li>
                              <li>
                                 <p><code class="codeph">AQMessageProperties</code></p>
                                 <p>Contains message properties such as Correlation, Sender, Delay and Expiration, Recipients, and Priority and Ordering</p>
                              </li>
                              <li>
                                 <p><code class="codeph">AQNotificationListener</code></p>
                                 <p>Is a listener interface for receiving AQ notification events</p>
                              </li>
                              <li>
                                 <p><code class="codeph">AQNotificationRegistration</code></p>
                                 <p>Represents your interest in being notified when a new message is enqueued in a particular queue</p>
                              </li>
                           </ul>
                        </li>
                     </ul>
                     <p>These classes and interfaces enable you to access an existing queue, create messages, and enqueue and dequeue messages.</p>
                     <div class="infoboxnote" id="GUID-270EF1FE-F9C1-4767-86C9-DC798B7DA213__GUID-C77741C2-0650-440F-A2E6-9846C859C01C">
                        <p class="notep1">Note:</p>
                        <p>Oracle JDBC drivers do <span class="italic">not</span> provide any API to create a queue. Queues must be created through the <code class="codeph">DBMS_AQADM</code> PL/SQL package.
                        </p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-270EF1FE-F9C1-4767-86C9-DC798B7DA213__GUID-5BEAB762-C001-4C2C-A288-DAB61E1549E1">
                        <p class="notep1">See Also:</p>
                        <p>For more information about the APIs, refer to <a href="../jajdb/index.html" target="_blank"><span class="italic">Oracle Database JDBC Java API Reference</span></a>.
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDBC28803"></a><div class="props_rev_3"><a id="GUID-F97B8E25-C394-468B-97BF-41ECE8C42AC5" name="GUID-F97B8E25-C394-468B-97BF-41ECE8C42AC5"></a><h3 id="JJDBC-GUID-F97B8E25-C394-468B-97BF-41ECE8C42AC5" class="sect3"><span class="enumeration_section">26.2 </span>Making Changes to the Database
               </h3>
               <div>
                  <div class="section">
                     <p>The code snippets used in this chapter assume that user <code class="codeph">HR</code> is connecting to the database. Therefore, in the database, you must grant the following privileges to <code class="codeph">HR</code>:
                     </p><pre class="oac_no_warn" dir="ltr">GRANT EXECUTE ON DBMS_AQ to HR;
GRANT EXECUTE ON DBMS_AQADM to HR;
GRANT AQ_ADMINISTRATOR_ROLE TO HR;
GRANT ADMINISTER DATABASE TRIGGER TO HR;
</pre><p>Before you start enqueuing and dequeuing messages, you must have queues in the Database. For this, you must perform the following:</p>
                     <ol>
                        <li>
                           <p>Create a queue table in the following way:</p><pre class="oac_no_warn" dir="ltr">BEGIN
    DBMS_AQADM.CREATE_QUEUE_TABLE(
            QUEUE_TABLE =&gt;'HR.RAW_SINGLE_QUEUE_TABLE',
            QUEUE_PAYLOAD_TYPE =&gt;'RAW',
            COMPATIBLE =&gt; '10.0');
END;
</pre></li>
                        <li>
                           <p>Create a queue in the following way:</p><pre class="oac_no_warn" dir="ltr">BEGIN
    DBMS_AQADM.CREATE_QUEUE(
            QUEUE_NAME =&gt;'HR.RAW_SINGLE_QUEUE',
            QUEUE_TABLE =&gt;'HR.RAW_SINGLE_QUEUE_TABLE',
END;
</pre></li>
                        <li>
                           <p>Start the queue in the following way:</p><pre class="oac_no_warn" dir="ltr">BEGIN
    DBMS_AQADM.START_QUEUE(
 'HR.RAW_SINGLE_QUEUE',
END;
</pre></li>
                     </ol>
                     <p>It is a good practice to stop the queue and remove the queue tables from the database. You can perform this in the following way:</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>Stop the queue in the following way:</span><div><pre class="oac_no_warn" dir="ltr">BEGIN
    DBMS_AQADM.STOP_QUEUE(
 HR.RAW_SINGLE_QUEUE',
END;
</pre></div>
                     </li>
                     <li class="stepexpand"><span>Remove the queue tables from the database in the following way:</span><div><pre class="oac_no_warn" dir="ltr">BEGIN
    DBMS_AQADM.DROP_QUEUE_TABLE(
            QUEUE_TABLE =&gt;'HR.RAW_SINGLE_QUEUE_TABLE',
            FORCE =&gt; TRUE
END;
</pre></div>
                     </li>
                  </ol>
               </div>
            </div><a id="JJDBC28804"></a><div class="props_rev_3"><a id="GUID-54F01AE4-0C8E-4A94-8C26-93F60B9C1B71" name="GUID-54F01AE4-0C8E-4A94-8C26-93F60B9C1B71"></a><h3 id="JJDBC-GUID-54F01AE4-0C8E-4A94-8C26-93F60B9C1B71" class="sect3"><span class="enumeration_section">26.3 </span>AQ Asynchronous Event Notification
               </h3>
               <div>
                  <p>A JDBC application can do the following:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Register to the AQ namespace and receive notification when an enqueue occurs. This can be performed in the following way:</p><pre class="oac_no_warn" dir="ltr"> public AQNotificationRegistration registerForAQEvents(
    OracleConnection conn,
    String queueName) throws SQLException
  {
    Properties globalOptions = new Properties();
    String[] queueNameArr = new String[1];
    queueNameArr[0] = queueName;
    Properties[] opt = new Properties[1];
    opt[0] = new Properties();
    opt[0].setProperty(OracleConnection.NTF_AQ_PAYLOAD,"true");
    AQNotificationRegistration[] regArr = conn.registerAQNotification(queueNameArr,opt,globalOptions);
    AQNotificationRegistration reg = regArr[0];
    return reg;
  }
</pre></li>
                     <li>
                        <p>Register subscriptions to database events and receive notifications when the events are triggered</p>
                        <p>Registered clients are notified asynchronously when events are triggered or on an explicit AQ enqueue (or a new message is enqueued in a queue for which you have registered your interest). Clients do not need to be connected to a database.</p>
                        <p>The following code snippet shows how to subscribe to database events and receive notifications when the events are triggered:</p><pre class="oac_no_warn" dir="ltr">class DemoAQRawQueueListener implements AQNotificationListener
{
  OracleConnection conn;
  String queueName;
  String typeName;
  int eventsCount = 0;
  
  public DemoAQRawQueueListener(String _queueName, String _typeName)
   throws SQLException
  {
   queueName = _queueName;
   typeName = _typeName;
   conn = (OracleConnection)DriverManager.getConnection 
     (DemoAQRawQueue.URL, DemoAQRawQueue.USERNAME, DemoAQRawQueue.PASSWORD);
  }
  
  public void onAQNotification(AQNotificationEvent e)
  {
    try
    {
     AQDequeueOptions deqopt = new AQDequeueOptions();
     deqopt.setRetrieveMessageId(true);
     if(e.getConsumerName() != null)
       deqopt.setConsumerName(e.getConsumerName());
     if((e.getMessageProperties()).getDeliveryMode() 
        == AQMessageProperties.DeliveryMode.BUFFERED)
     {
       deqopt.setDeliveryMode(AQDequeueOptions.DEQUEUE_BUFFERED);
       deqopt.setVisibility(AQDequeueOptions.DEQUEUE_IMMEDIATE);
     }
     AQMessage msg = conn.dequeue(queueName,deqopt,typeName);
     byte[] msgId = msg.getMessageId();
     if(msgId != null)
     {
       String mesgIdStr = DemoAQRawQueue.byteBufferToHexString(msgId,20);
       System.out.println("ID of message dequeued = "+mesgIdStr);
     }
     System.out.println(msg.getMessageProperties().toString());
     byte[] payload = msg.getPayload();
     if(typeName.equals("RAW"))
     {
       String payloadStr = new String(payload,0,10);
       System.out.println("payload.length="+payload.length+", value="+payloadStr);
     }
    }
    catch(SQLException sqlex)
    {
     System.out.println(sqlex.getMessage());
    }
    eventsCount++; 
  }
  public int getEventsCount()
  {
    return eventsCount;
  }
  public void closeConnection() throws SQLException
  {
    conn.close();
  }
}
</pre></li>
                     <li>
                        <p>Register to the listener in the following way:</p><pre class="oac_no_warn" dir="ltr">AQNotificationRegistration reg = registerForAQEvents(conn,queueName+":BLUE");
DemoAQRawQueueListener demo_li = new DemoAQRawQueueListener(queueName,queueType);
reg.addListener(demo_li);
</pre></li>
                  </ul>
               </div>
            </div><a id="JJDBC28805"></a><div class="props_rev_3"><a id="GUID-CCEF5E83-7338-4EF5-B9DE-27E468AC59B5" name="GUID-CCEF5E83-7338-4EF5-B9DE-27E468AC59B5"></a><h3 id="JJDBC-GUID-CCEF5E83-7338-4EF5-B9DE-27E468AC59B5" class="sect3"><span class="enumeration_section">26.4 </span>About Creating Messages
               </h3>
               <div>
                  <p>This section describes the following concepts:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="advanced-queuing.html#GUID-0A322480-9372-4B14-A4C0-16883BBCAC26">Creating Messages</a></p>
                     </li>
                     <li>
                        <p><a href="advanced-queuing.html#GUID-1BEFE9AF-BC7F-4A22-A1F9-1E3225B113DC">AQ Message Properties</a></p>
                     </li>
                     <li>
                        <p><a href="advanced-queuing.html#GUID-44FE0646-6E73-475C-BCD3-0DF199E1A130">AQ Message Payload</a></p>
                     </li>
                  </ul>
               </div>
               <div class="props_rev_3"><a id="GUID-0A322480-9372-4B14-A4C0-16883BBCAC26" name="GUID-0A322480-9372-4B14-A4C0-16883BBCAC26"></a><h4 id="JJDBC-GUID-0A322480-9372-4B14-A4C0-16883BBCAC26" class="sect4"><span class="enumeration_section">26.4.1 </span>Creating Messages
                  </h4>
                  <div>
                     <div class="section">
                        <p>Before you enqueue a message, you must create the message. An instance of a class implementing the <code class="codeph">AQMessage</code> interface represents an AQ message. An AQ message contains properties (metadata) and a payload (data). Perform the following to create an AQ message:
                        </p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Create an instance of <code class="codeph">AQMessageProperties</code> in the following way:</span><div><pre class="oac_no_warn" dir="ltr">AQMessageProperties msgprop = AQFactory.createAQMessageProperties();
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Set the property attributes in the following way:</span><div><pre class="oac_no_warn" dir="ltr">msgprop.setCorrelation("mycorrelation");
msgprop.setExceptionQueue("MY_EXCEPTION_QUEUE");
msgprop.setExpiration(0);
msgprop.setPriority(1);
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Create the AQ message using the <code class="codeph">AQMessageProperties</code> object in the following way:</span><div><pre class="oac_no_warn" dir="ltr">AQMessage mesg = AQFactory.createAQMessage(msgprop);
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Set the payload in the following way:</span><div><pre class="oac_no_warn" dir="ltr">byte[] rawPayload = "Example_Payload".getBytes();
mesg.setPayload(new oracle.sql.RAW(rawPayload));
</pre></div>
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-1BEFE9AF-BC7F-4A22-A1F9-1E3225B113DC" name="GUID-1BEFE9AF-BC7F-4A22-A1F9-1E3225B113DC"></a><h4 id="JJDBC-GUID-1BEFE9AF-BC7F-4A22-A1F9-1E3225B113DC" class="sect4"><span class="enumeration_section">26.4.2 </span>AQ Message Properties
                  </h4>
                  <div>
                     <div class="section">
                        <p>The properties of the AQ message are represented by an instance of the <code class="codeph">AQMessageProperties</code> interface. You can set or get the following message properties:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Dequeue Attempts Count: Specifies the number of attempts that have been made to dequeue the message. This property cannot be set.</p>
                           </li>
                           <li>
                              <p>Correlation: Is an identifier supplied by the producer of the message at the time of enqueuing the message.</p>
                           </li>
                           <li>
                              <p>Delay: Is the number of seconds for which the message is in the <code class="codeph">WAITING</code> state. After the specified delay, the message is in the <code class="codeph">READY</code> state and available for dequeuing. Dequeuing a message by using the message ID (msgid) overrides the delay specification.
                              </p>
                              <div class="infoboxnote" id="GUID-1BEFE9AF-BC7F-4A22-A1F9-1E3225B113DC__GUID-4FB3C6C8-6E62-4C12-99F6-8922EC59F765">
                                 <p class="notep1">Note:</p>
                                 <p>Delay is not supported with buffered messaging.</p>
                              </div>
                           </li>
                           <li>
                              <p>Delivery Mode: Specifies whether the message is a buffered message or a persistent message. This property cannot be set.</p>
                           </li>
                           <li>
                              <p>Enqueue Time: Specifies the time at which the message was enqueued. This value is determined by the system and cannot be set by the user.</p>
                           </li>
                           <li>
                              <p>Exception Queue: Specifies the name of the queue into which the message is moved if it cannot be processed successfully. Messages are moved in two cases:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>The number of unsuccessful dequeue attempts has exceeded <code class="codeph">max_retries</code>.
                                    </p>
                                 </li>
                                 <li>
                                    <p>The message has expired.</p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>Expiration: Is the number of seconds during which the message is available for dequeuing, starting from when the message reaches the <code class="codeph">READY</code> state. If the message is not dequeued before it expires, then it is moved to the exception queue in the <code class="codeph">EXPIRED</code> state.
                              </p>
                           </li>
                           <li>
                              <p>Message State: Specifies the state of the message at the time of dequeuing the message. This property cannot be set.</p>
                           </li>
                           <li>
                              <p>Previous Queue Message ID: Is the ID of the message in the last queue that generated the current message. When a message is propagated from one queue to another, this attribute identifies the ID of the queue from which it was last propagated. This property cannot be set.</p>
                           </li>
                           <li>
                              <p>Priority: Specifies the priority of the message. It can be any integer including negative integers; the smaller the value, the higher the priority.</p>
                           </li>
                           <li>
                              <p>Recipient list: Is a list of <code class="codeph">AQAgent</code> objects that represent the recipients. The default recipients are the queue subscribers. This parameter is valid only for multiple-consumer queues.
                              </p>
                           </li>
                           <li>
                              <p>Sender: Is an identifier specified by the producer at the time of enqueuing the message. It is an instance of <code class="codeph">AQAgent</code>.
                              </p>
                           </li>
                           <li>
                              <p>Transaction group: Specifies the transaction group of the message for transaction-grouped queues. It is set after a successful call to the <code class="codeph">dequeueArray</code> method.
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-44FE0646-6E73-475C-BCD3-0DF199E1A130" name="GUID-44FE0646-6E73-475C-BCD3-0DF199E1A130"></a><h4 id="JJDBC-GUID-44FE0646-6E73-475C-BCD3-0DF199E1A130" class="sect4"><span class="enumeration_section">26.4.3 </span>AQ Message Payload
                  </h4>
                  <div>
                     <div class="section">
                        <p>Depending on the type of the queue, the payload of the AQ message can be specified using the <code class="codeph">setPayload</code> method of the <code class="codeph">AQMessage</code> interface. The following code snippet illustrates how to set the payload:
                        </p><pre class="oac_no_warn" dir="ltr">...
byte[] rawPayload = "Example_Payload".getBytes();
mesg.setPayload(new oracle.sql.RAW(rawPayload));
...</pre><p>You can retrieve the payload of an AQ message using the <code class="codeph">getPayload</code> method or the appropriate <code class="codeph">get</code><span class="italic"><code class="codeph">XXX</code></span><code class="codeph">Payload</code> method in the following way:
                        </p><pre class="oac_no_warn" dir="ltr">byte[] payload = mesg.getPayload();
</pre><p>These methods are defined in the <code class="codeph">AQMessage</code> interface.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="JJDBC28809"></a><a id="JJDBC28808"></a><div class="props_rev_3"><a id="GUID-67510B08-91FB-4132-8138-68A6ED0DD21F" name="GUID-67510B08-91FB-4132-8138-68A6ED0DD21F"></a><h3 id="JJDBC-GUID-67510B08-91FB-4132-8138-68A6ED0DD21F" class="sect3"><span class="enumeration_section">26.5 </span>Example: Creating a Message and Setting a Payload
               </h3>
               <div>
                  <div class="section">
                     <p>This section provides an example that illustrates how to create a message and set a payload.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-67510B08-91FB-4132-8138-68A6ED0DD21F__GUID-12D6619B-EEF5-4D4E-9330-56C91939F887">
                     <p class="titleinexample">Example 26-1 Creating a Message and Setting a Payload</p>
                     <p>This example shows how to Create an instance of <code class="codeph">AQMessageProperties</code>, set the property attributes, create the AQ message, and set the payload.
                     </p><pre class="oac_no_warn" dir="ltr"> AQMessageProperties msgprop = AQFactory.createAQMessageProperties();
    msgprop.setCorrelation("mycorrelation");
    msgprop.setExceptionQueue("MY_EXCEPTION_QUEUE");
    AQAgent ag = AQFactory.createAQAgent();
    ag.setName("MY_SENDER_AGENT_NAME");
    ag.setAddress("MY_SENDER_AGENT_ADDRESS");
    msgprop.setSender(ag);
    <span class="bold">// handle multi consumer case:</span>
    if(recipients != null)
      msgprop.setRecipientList(recipients);
    System.out.println(msgprop.toString());
    AQMessage mesg = AQFactory.createAQMessage(msgprop);
byte[] rawPayload = "Example_Payload".getBytes();
mesg.setPayload(new oracle.sql.RAW(rawPayload));
</pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="JJDBC28810"></a><div class="props_rev_3"><a id="GUID-CF24AC0C-FC14-4062-A9C0-CAB96F1C8D3E" name="GUID-CF24AC0C-FC14-4062-A9C0-CAB96F1C8D3E"></a><h3 id="JJDBC-GUID-CF24AC0C-FC14-4062-A9C0-CAB96F1C8D3E" class="sect3"><span class="enumeration_section">26.6 </span>Enqueuing Messages
               </h3>
               <div>
                  <div class="section">
                     <p>After you create a message and set the message properties and payload, you can enqueue the message using the <code class="codeph">enqueue</code> method of the <code class="codeph">OracleConnection</code> interface. Before you enqueue the message, you can specify some enqueue options. The <code class="codeph">AQEnqueueOptions</code> class enables you to specify the following enqueue options:
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Delivery mode: Specifies the delivery mode. Delivery mode can be set to either persistent (<code class="codeph">ENQUEUE_PERSISTENT</code>) or buffered (<code class="codeph">ENQUEUE_BUFFERED</code>).
                           </p>
                        </li>
                        <li>
                           <p>Retrieve Message ID: Specifies whether or not the message ID has to be retrieved from the server when the message has been enqueued. By default, the message ID is not retrieved.</p>
                        </li>
                        <li>
                           <p>Transformation: Specifies a transformation that will be applied before enqueuing the message. The return type of the transformation function must match the type of the queue.</p>
                           <div class="infoboxnote" id="GUID-CF24AC0C-FC14-4062-A9C0-CAB96F1C8D3E__GUID-F832569C-0F4D-4F4A-A6A0-AB6538308468">
                              <p class="notep1">Note:</p>
                              <p>Transformations must be created in PL/SQL using <code class="codeph">DBMS_TRANSFORM.CREATE_TRANSFORMATION(...)</code>.
                              </p>
                           </div>
                        </li>
                        <li>
                           <p>Visibility: Specifies the transactional behavior of the enqueue request. The default value for this option is <code class="codeph">ENQUEUE_ON_COMMIT</code>. It indicates that the enqueue operation is part of the current transaction. <code class="codeph">ENQUEUE_IMMEDIATE</code> indicates that the enqueue operation is an autonomous transaction, which commits at the end of the operation. For buffered messaging, you must use <code class="codeph">ENQUEUE_IMMEDIATE</code>.
                           </p>
                        </li>
                     </ul>
                     <p>The following code snippet illustrates how to set the enqueue options and enqueue the message:</p><pre class="oac_no_warn" dir="ltr">...
AQEnqueueOptions opt = new AQEnqueueOptions();opt.setRetrieveMessageId(true);
conn.enqueue(queueName, opt, mesg);
...
</pre></div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDBC28811"></a><div class="props_rev_3"><a id="GUID-163B54F8-B3CF-41EE-9910-47D06F3A7D7A" name="GUID-163B54F8-B3CF-41EE-9910-47D06F3A7D7A"></a><h3 id="JJDBC-GUID-163B54F8-B3CF-41EE-9910-47D06F3A7D7A" class="sect3"><span class="enumeration_section">26.7 </span>Dequeuing Messages
               </h3>
               <div>
                  <div class="section">
                     <p>Enqueued messages can be dequeued using the <code class="codeph">dequeue</code> method of the <code class="codeph">OracleConnection</code> interface. Before you dequeue a message you must set the dequeue options. The <code class="codeph">AQDequeueOptions</code> class enables you to specify the following dequeue options:
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Condition: Specifies a conditional expression based on the message properties, the message data properties, and PL/SQL functions. A dequeue condition is specified as a <code class="codeph">Boolean</code> expression using syntax similar to the <code class="codeph">WHERE</code> clause of a SQL query.
                           </p>
                        </li>
                        <li>
                           <p>Consumer name: If specified, only the messages matching the consumer name are accessed.</p>
                           <div class="infoboxnote" id="GUID-163B54F8-B3CF-41EE-9910-47D06F3A7D7A__GUID-F7FD005C-5C5F-49F4-9979-6F8F5BD5C062">
                              <p class="notep1">Note:</p>
                              <p>If the queue is a single-consumer queue, do <span class="italic">not</span> set this option.
                              </p>
                           </div>
                        </li>
                        <li>
                           <p>Correlation: Specifies a correlation criterion (or search criterion) for the dequeue operation.</p>
                        </li>
                        <li>
                           <p>Delivery Filter: Specifies the type of message to be dequeued. You dequeue buffered messages only (<code class="codeph">DEQUEUE_BUFFERED</code>) or persistent messages only (<code class="codeph">DEQUEUE_PERSISTENT</code>), which is the default, or both (<code class="codeph">DEQUEUE_PERSISTENT_OR_BUFFERED</code>).
                           </p>
                        </li>
                        <li>
                           <p>Dequeue Message ID: Specifies the message identifier of the message to be dequeued. This can be used to dequeue a unique message whose ID is known.</p>
                        </li>
                        <li>
                           <p>Dequeue mode: Specifies the locking behavior associated with the dequeue operation. It can take one of the following values:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">DequeueMode.BROWSE</code>: Message is dequeued without acquiring any lock.
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">DequeueMode.LOCKED</code>: Message is dequeued with a write lock that lasts for the duration of the transaction.
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">DequeueMode.REMOVE</code>: (default) Message is dequeued and deleted. The message can be retained in the queue based on the retention properties.
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">DequeueMode.REMOVE_NO_DATA</code>: Message is marked as updated or deleted.
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>Maximum Buffer Length: Specifies the maximum number of bytes that will be allocated when dequeuing a message from a <code class="codeph">RAW</code> queue. The default maximum is <code class="codeph">DEFAULT_MAX_PAYLOAD_LENGTH</code> but it can be changed to any other nonzero value. If the buffer is not large enough to contain the entire message, then the exceeding bytes will be silently ignored.
                           </p>
                        </li>
                        <li>
                           <p>Navigation: Specifies the position of the message that will be retrieved. It can take one of the following values:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">NavigationOption.FIRST_MESSAGE</code>: The first available message matching the search criteria is dequeued.
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">NavigationOption.NEXT_MESSAGE</code>: (default) The next available message matching the search criteria is dequeued. If the previous message belongs to a message group, then the next available message matching the search criteria in the message group is dequeued.
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">NavigationOption.NEXT_TRANSACTION</code>: Messages in the current transaction group are skipped, and the first message of the next transaction group is dequeued. This setting can be used <span class="italic">only </span>if message grouping is enabled for the queue.
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>Retrieve Message ID: Specifies whether or not the message identifier of the dequeued message needs to be retrieved. By default, it is not retrieved.</p>
                        </li>
                        <li>
                           <p>Transformation: Specifies a transformation that will be applied after dequeuing the message. The source type of the transformation must match the type of the queue.</p>
                           <div class="infoboxnote" id="GUID-163B54F8-B3CF-41EE-9910-47D06F3A7D7A__GUID-32168A0A-F921-4E2F-9D85-38BDCFAD2EC5">
                              <p class="notep1">Note:</p>
                              <p>Transformations must be created in PL/SQL using <code class="codeph">DBMS_TRANSFORM.CREATE_TRANSFORMATION(...)</code>.
                              </p>
                           </div>
                        </li>
                        <li>
                           <p>Visibility: Specifies whether or not the message is dequeued as part of the current transaction. It can take one of the following values:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">VisibilityOption.ON_COMMIT</code>: (default) The dequeue operation is part of the current transaction.
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">VisibilityOption.IMMEDIATE</code>: The dequeue operation is an autonomous transaction that commits at the end of the operation.
                                 </p>
                              </li>
                           </ul>
                           <div class="infoboxnote" id="GUID-163B54F8-B3CF-41EE-9910-47D06F3A7D7A__GUID-1BCB28F5-A177-4F04-9CE1-7A66F948B2F4">
                              <p class="notep1">Note:</p>
                              <p>The Visibility option is ignored in the <code class="codeph">DequeueMode.BROWSE</code> dequeue mode. If the delivery filter is <code class="codeph">DEQUEUE_BUFFERED</code> or <code class="codeph">DEQUEUE_PERSISTENT_OR_BUFFERED</code>, then this option <span class="italic">must</span> be set to <code class="codeph">VisibilityOption.IMMEDIATE</code>.
                              </p>
                           </div>
                        </li>
                        <li>
                           <p>Wait: Specifies the wait time for the dequeue operation, if none of the messages matches the search criteria. The default value is <code class="codeph">DEQUEUE_WAIT_FOREVER</code> indicating that the operation waits forever. If set to <code class="codeph">DEQUEUE_NO_WAIT</code>, then the operation does not wait. If a number is specified, then the dequeue operation waits for the specified number of seconds.
                           </p>
                           <div class="infoboxnote" id="GUID-163B54F8-B3CF-41EE-9910-47D06F3A7D7A__GUID-F1072B0E-37BD-4348-A620-5A002EFCFD93">
                              <p class="notep1">Note:</p>
                              <p>If you use <code class="codeph">DEQUEUE_WAIT_FOREVER</code>, then the dequeue operation will not return until a message that matches the search criterion is available in the queue. However, you can interrupt the dequeue operation by calling the <code class="codeph">cancel</code> method on the <code class="codeph">OracleConnection</code> object.
                              </p>
                           </div>
                        </li>
                     </ul>
                     <p>The following code snippet illustrates how to set the dequeue options and dequeue the message:</p><pre class="oac_no_warn" dir="ltr">...
AQDequeueOptions deqopt = new AQDequeueOptions();
deqopt.setRetrieveMessageId(true);
deqopt.setConsumerName(consumerName);
AQMessage msg = conn.dequeue(queueName,deqopt,queueType);
</pre></div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDBC28813"></a><a id="JJDBC28814"></a><a id="JJDBC28812"></a><div class="props_rev_3"><a id="GUID-A74A1FDD-8984-411C-9706-19A0A6FF0429" name="GUID-A74A1FDD-8984-411C-9706-19A0A6FF0429"></a><h3 id="JJDBC-GUID-A74A1FDD-8984-411C-9706-19A0A6FF0429" class="sect3"><span class="enumeration_section">26.8 </span>Examples: Enqueuing and Dequeuing
               </h3>
               <div>
                  <div class="section">
                     <p>This section provides a few examples that illustrate how to enqueue and dequeue messages.</p>
                     <p><a href="advanced-queuing.html#GUID-A74A1FDD-8984-411C-9706-19A0A6FF0429__BABJCHGG">Example 26-2</a> illustrates how to enqueue a message, and <a href="advanced-queuing.html#GUID-A74A1FDD-8984-411C-9706-19A0A6FF0429__BABGEEGE">Example 26-3</a> illustrates how to dequeue a message.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-A74A1FDD-8984-411C-9706-19A0A6FF0429__BABJCHGG">
                     <p class="titleinexample">Example 26-2 Enqueuing a Single Message</p>
                     <p>This example illustrates how to obtain access to a queue, create a message, and enqueue it.</p><pre class="oac_no_warn" dir="ltr">AQMessageProperties msgprop = AQFactory.createAQMessageProperties();
msgprop.setPriority(1);
msgprop.setExceptionQueue("EXCEPTION_QUEUE");
msgprop.setExpiration(0);
AQAgent agent = AQFactory.createAQAgent();
agent.setName("AGENTNAME");
agent.setAddress("AGENTADDRESS");
msgprop.setSender(agent);
AQMessage mesg = AQFactory.createAQMessage(msgprop);
mesg.setPayload(buffer); // where buffer is a byte array (for a RAW queue)
AQEnqueueOptions options = new AQEnqueueOptions();
conn.enqueue("HR.MY_QUEUE", options, mesg);
</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-A74A1FDD-8984-411C-9706-19A0A6FF0429__BABGEEGE">
                     <p class="titleinexample">Example 26-3 Dequeuing a Single Message</p>
                     <p>This example illustrates how to obtain access to a queue, set the dequeue options, and dequeue the message.</p><pre class="oac_no_warn" dir="ltr">AQDequeueOptions options = new AQDequeueOptions();
options.setDeliveryFilter(AQDequeueOptions.DeliveryFilter.BUFFERED);
AQMessage mesg = conn.dequeue("HR.MY_QUEUE", options, "RAW");
</pre></div>
                  <!-- class="example" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>