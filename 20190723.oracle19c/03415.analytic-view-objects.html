<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="An analytic view is a type of view that you can use to easily extend the content of a star schema, snowflake schema, or a flat (denormalized) fact table with aggregated data, measure calculations and descriptive metadata, and to simplify the SQL needed to access data.">
      <meta name="description" content="An analytic view is a type of view that you can use to easily extend the content of a star schema, snowflake schema, or a flat (denormalized) fact table with aggregated data, measure calculations and descriptive metadata, and to simplify the SQL needed to access data.">
      <title>Analytic View Objects</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Data Warehousing Guide">
      <meta property="og:description" content="An analytic view is a type of view that you can use to easily extend the content of a star schema, snowflake schema, or a flat (denormalized) fact table with aggregated data, measure calculations and descriptive metadata, and to simplify the SQL needed to access data.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Data Warehousing Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="database-data-warehousing-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-09T00:20:13-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2001, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96243-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="analytic-view-attribute-dimensions.html" title="Previous" type="text/html">
      <link rel="next" href="glossary.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Data Warehousing Guide">
    <meta name="dcterms.isVersionOf" content="DWHSG">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="analytic-view-attribute-dimensions.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="glossary.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Data Warehousing Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-analytic-views.html" property="item" typeof="WebPage"><span property="name">Analytic Views</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Analytic View Objects</li>
            </ol>
            <a id="GUID-3FF2F855-ACB3-43A3-9D7B-C319F821B601" name="GUID-3FF2F855-ACB3-43A3-9D7B-C319F821B601"></a><a id="RESOURCEID-18623-7EE84997"></a>
            
            <h2 id="DWHSG-GUID-3FF2F855-ACB3-43A3-9D7B-C319F821B601" class="sect2"><span class="enumeration_chapter">26 </span>Analytic View Objects
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>An analytic view is a type of view that you can use to easily extend the content of a star schema, snowflake schema, or a flat (denormalized) fact table with aggregated data, measure calculations and descriptive metadata, and to simplify the SQL needed to access data.</p>
               <p>Analytic views are described in the following topics.</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="analytic-view-objects.html#GUID-EE854CA8-9BE5-4BF8-AFC9-C3B020B06DE2" title="Analytic views layer a hierarchical/dimensional model over data.">About Analytic Views</a></p>
                  </li>
                  <li>
                     <p><a href="analytic-view-objects.html#GUID-E6A33251-56D4-4F3D-9C00-BB1160CBBC03" title="Analytic view measures specify fact data and the calculations or other operations to perform on the data.">Measures of Analytic Views</a></p>
                  </li>
                  <li>
                     <p><a href="analytic-view-objects.html#GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B" title="In creating an analytic view, you specify one or more hierarchies and a fact table that has at least one measure column that can join to each hierarchy.">Create Analytic Views</a></p>
                  </li>
                  <li>
                     <p><a href="analytic-view-objects.html#GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529" title="Calculated measures are expressions you add to a MEASURES clause of an analytic view in the form of measure_name AS (expression).">Examples of Calculated Measures</a></p>
                  </li>
                  <li>
                     <p><a href="analytic-view-objects.html#GUID-8EFF4827-208C-40B0-AFA2-6838BFFEB2C1" title="You can use any attribute of an attribute dimension in a hierarchy and aggregate data for it in an analytic view.">Attribute Reporting</a></p>
                  </li>
                  <li>
                     <p><a href="analytic-view-objects.html#GUID-BEE5DB77-C00D-46F7-8543-F4EE3356BCE2" title="Queries that SELECT from analytic views may include the FILTER FACT keywords to filter the fact data accessed by the analytic view prior to any calculations and the ADD MEASURES keywords to define additional calculated measures for the query.">Analytic View Queries with Filtered Facts and Added Measures</a></p>
                  </li>
               </ul>
            </div><a id="RESOURCEID-186323-7FDC9206"></a><div class="sect2"><a id="GUID-EE854CA8-9BE5-4BF8-AFC9-C3B020B06DE2" name="GUID-EE854CA8-9BE5-4BF8-AFC9-C3B020B06DE2"></a><h3 id="DWHSG-GUID-EE854CA8-9BE5-4BF8-AFC9-C3B020B06DE2" class="sect3"><span class="enumeration_section">26.1 </span>About Analytic Views
               </h3>
               <div>
                  <div><span>Analytic views layer a hierarchical/dimensional model over data.</span> 
                  </div>
                  <p>Analytic views are defined over the dimension tables and the fact table of a star or snowflake schema. You can also define an analytic view over a denormalized table, in which dimension attributes and fact data are in the same table. Hierarchies are defined over dimension tables. An analytic view references hierarchies and a fact table.</p>
                  <p>Even though an analytic view is defined over data modeled as a star schema, the data does not need to be stored in a star schema. You can use views to represent other forms of stored data to an analytic view. Generally, if the tables or views perform well with a star style query they work well with analytic views. Smaller data sets might work well with views. Larger data sets might perform better with tables in a star schema. The most performant schema is a star schema loaded into the in-memory column store, using the Oracle Database In-Memory Option.</p>
                  <p>When used with the in-memory column store, analytic views optimize the SQL execution plan to take advantage of In-Memory Aggregation (that is, the vector transform execution plan). Analytic views can take advantage of materialized views to further accelerate aggregate level queries (note that materialized views can be loaded into the in-memory column store).</p>
                  <p>The minimum requirements for an analytic view include the following:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>A dimension table (or view). This table should have a primary key that provides a unique list of values and that joins to the fact table.</p>
                     </li>
                     <li>
                        <p>A fact table with at least one fact (measure) column and a key column that joins to the primary key of the dimension table.</p>
                     </li>
                  </ul>
                  <p>More typically, an analytic view has the following characteristics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Is defined over using two or more dimension tables, which enables the ability to slice and dice data.</p>
                     </li>
                     <li>
                        <p>One or more of the dimension tables contain data at different levels of aggregation (for example: days, months, quarters, and years).</p>
                     </li>
                  </ul>
                  <p>Analytic views comprise three types of objects: attribute dimensions, hierarchies, and analytic views.</p>
                  <p>An attribute dimension is a metadata object that references tables or views and organizes columns into higher-level objects such as attributes and levels. Most metadata related to dimensions and hierarchies is defined in the attribute dimension object.</p>
                  <p>A hierarchy is a type of view. Hierarchies reference attribute dimension objects. Hierarchies organize data using hierarchical relationships between the hierarchy members. Queries of a hierarchy return detail and aggregate-level keys ("hierarchy values") and attributes of those values.</p>
                  <p>An analytic view is a type of view that returns fact data. Analytic views reference both fact tables and hierarchies. Both hierarchy and measure data is selected from analytic views.</p>
               </div>
            </div><a id="RESOURCEID-186623-7FDCA04F"></a><div class="sect2"><a id="GUID-E6A33251-56D4-4F3D-9C00-BB1160CBBC03" name="GUID-E6A33251-56D4-4F3D-9C00-BB1160CBBC03"></a><h3 id="DWHSG-GUID-E6A33251-56D4-4F3D-9C00-BB1160CBBC03" class="sect3"><span class="enumeration_section">26.2 </span>Measures of Analytic Views
               </h3>
               <div>
                  <p>Analytic view measures specify fact data and the calculations or other operations to perform on the data. </p>
                  <p>In an analytic view definition, you may specify one or more base measures and calculated measures.</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-E6A33251-56D4-4F3D-9C00-BB1160CBBC03__GUID-DF23721B-8262-4567-AE16-ACEC7AB69CB8">Base Measures</p>
                     <p>A base measure is a reference to a column in a fact table. You may optionally specify a <code class="codeph">meas_aggregate_clause</code>, which overrides the default aggregation method of the analytic view. Each base measure may specify a default aggregation. The aggregation may be a simple operation like <code class="codeph">SUM</code> or <code class="codeph">AVG</code>, or a complex nesting of operations that vary by attribute dimension.
                     </p>
                     <p>You can use the <code class="codeph">default_aggregate_clause</code> to specify a default aggregation method for base measures that don't have a <code class="codeph">meas_aggregate_clause</code>. The default value of the <code class="codeph">default_aggregate_clause</code> is <code class="codeph">SUM</code>.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-E6A33251-56D4-4F3D-9C00-BB1160CBBC03__GUID-746CECAD-9DBE-4A96-9211-B61A3B623334">Calculated Measures</p>
                     <p>A calculated measure is an expression that can be a user-defined expression or one of the many pre-defined analytic calculations. A calculated measure expression may include other measures, row functions, and hierarchy functions. Hierarchy functions allow computations based on identifying and processing related members in a hierarchy. The expression may reference other measures in the analytic view, but may not reference fact columns. Because a calculation can refer to other measures, you can easily build complex calculations through nesting.</p>
                     <p>In defining a calculated measure expression, you may use any other measure in the analytic view, irrespective of the order in which you defined the measures of the analytic view. The only restriction is that no cycles may be introduced in the calculations.</p>
                     <p>In addition to using calculated measures in the definition of an analytic view, you can add calculated measures in a <code class="codeph">SELECT</code> statement that queries an analytic view. To do so, you use the <code class="codeph">ADD</code> <code class="codeph">MEASURES</code> keywords in the <code class="codeph">WITH</code> or <code class="codeph">FROM</code> clauses of the statement. The syntax of a calculated measure is the same whether it is in the definition of the analytic view or in a <code class="codeph">SELECT</code> statement.
                     </p>
                     <p>Categories of calculated measure expressions are the following:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Analytic view measure expressions</p>
                        </li>
                        <li>
                           <p>Analytic view hierarchical expressions</p>
                        </li>
                        <li>
                           <p>Simple expressions</p>
                        </li>
                        <li>
                           <p>Single row function expressions</p>
                        </li>
                        <li>
                           <p>Compound expressions</p>
                        </li>
                        <li>
                           <p>Datetime expressions</p>
                        </li>
                        <li>
                           <p>Interval expressions</p>
                        </li>
                     </ul>
                     <p>Analytic view measure expressions include the following operations:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Lead and lag</p>
                        </li>
                        <li>
                           <p>Qualified data reference (QDR)</p>
                        </li>
                        <li>
                           <p>Rank</p>
                        </li>
                        <li>
                           <p>Related member</p>
                        </li>
                        <li>
                           <p>Share of</p>
                        </li>
                        <li>
                           <p>Window calculations</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="analytic-view-objects.html#GUID-36131726-9188-465F-9C35-69D3F657D080">Analytic View Query with Added Measures</a></li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B" name="GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B"></a><h3 id="DWHSG-GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B" class="sect3"><span class="enumeration_section">26.3 </span>Create Analytic Views
               </h3>
               <div>
                  <p>In creating an analytic view, you specify one or more hierarchies and a fact table that has at least one measure column that can join to each hierarchy.</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B__GUID-1D668795-E27B-49A6-BBB4-30B3055039D3">Create a Simple Analytic View</p>
                     <p>An analytic view must have a reference to a fact table and a measure that can join to a hierarchy.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B__GUID-3E323FF9-5FED-4485-8E1C-E92857E78508">
                     <p class="titleinexample">Example 26-1 Creating a Simple Analytic View</p>
                     <p>This analytic view uses the TIME_HIER hierarchy and the SALE_FACT table.  It contains a single measure, SALES.</p><pre class="pre codeblock"><code>CREATE OR REPLACE ANALYTIC VIEW sales_av
USING sales_fact                      -- Refers to the SALES_FACT table
DIMENSION BY                          -- List of attribute dimensions
  (time_attr_dim                      -- TIME_ATTR_DIM attribute dimension
    KEY month_id REFERENCES month_id  -- Dimension key joins to fact column
    HIERARCHIES (                     -- List of hierarchies that use 
      time_hier DEFAULT))             -- the attribute dimension
MEASURES                              -- List of measures
 (sales FACT sales)                   -- SALES measure references SALES column
DEFAULT MEASURE SALES;                -- Default measure of the analytic view
</code></pre><p>A query that selects from an analytic view that does not include filters has the potential of returning large numbers of rows. However, in this query, the SALES_AV analytic view includes a single hierarchy that returns only 86 rows.</p><pre class="pre codeblock"><code>SELECT *
  FROM sales_av HIERARCHIES(time_hier)
  ORDER BY time_hier.hier_order;</code></pre><p>This is a excerpt of the returned values.</p><img src="img/simple_av_sel.png" alt="Description of simple_av_sel.png follows" title="Description of simple_av_sel.png follows" longdesc="img_text/simple_av_sel.html"><br><a href="img_text/simple_av_sel.html">Description of the illustration simple_av_sel.png</a></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B__GUID-B6CB1896-ED1C-494A-A344-B5503999D6DD">Add Another Base Measure</p>
                     <p>To add another base measure to an analytic view, include the measure in the <code class="codeph">MEASURES</code> list.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B__GUID-7527476C-452D-4D6A-AC84-9D397589D0AA">
                     <p class="titleinexample">Example 26-2 Adding a Base Measure to an Analytic View</p><pre class="pre codeblock"><code>CREATE OR REPLACE ANALYTIC VIEW sales_av
USING sales_fact
DIMENSION BY
  (time_attr_dim
    KEY month_id REFERENCES month_id
    HIERARCHIES (
      time_hier DEFAULT))
MEASURES
 (sales FACT sales,
  units FACT units)                   -- Add the UNITS base measure
DEFAULT MEASURE SALES;</code></pre><p>Because a query of the analytic view could return a great many rows, a query typically uses filters to limit the results. In the <code class="codeph">WHERE</code> clause, this query filters the time periods to those in the YEAR level, so it returns only SALES and UNITS data at that level.
                     </p><pre class="pre codeblock"><code>SELECT time_hier.member_name as TIME,
 sales,
 units
FROM
 sales_av HIERARCHIES(time_hier)
WHERE time_hier.level_name = 'YEAR'
ORDER BY time_hier.hier_order;
</code></pre><p>These are the returned values.</p><img src="img/av_sel_2measures.png" alt="Description of av_sel_2measures.png follows" title="Description of av_sel_2measures.png follows" longdesc="img_text/av_sel_2measures.html"><br><a href="img_text/av_sel_2measures.html">Description of the illustration av_sel_2measures.png</a></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B__GUID-95D07451-A0C4-4BB9-80CF-0EE4656B998C">Add Hierarchies to an Analytic View</p>
                     <p>Typically, an analytic view has more than one hierarchy using one or more attribute dimensions.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B__GUID-C7978C62-E297-4C66-9301-56C4BE1ED427">
                     <p class="titleinexample">Example 26-3 Adding Hierarchies to an Analytic View</p>
                     <p>This example adds attribute dimensions and hierarchies to the <code class="codeph">DIMENSION</code> <code class="codeph">BY</code> list of the analytic view.
                     </p><pre class="pre codeblock"><code>CREATE OR REPLACE ANALYTIC VIEW sales_av
USING sales_fact
DIMENSION BY
  (time_attr_dim
    KEY month_id REFERENCES month_id
    HIERARCHIES (
      time_hier DEFAULT),
   product_attr_dim
    KEY category_id REFERENCES category_id
    HIERARCHIES (
      product_hier DEFAULT),
   geography_attr_dim
    KEY state_province_id 
    REFERENCES state_province_id
    HIERARCHIES (
      geography_hier DEFAULT)
   )
MEASURES
 (sales FACT sales,
  units FACT units
  )
DEFAULT MEASURE sales;</code></pre><p>The following query adds the PRODUCT_HIER and GEOGRAPHY_HIER hierarchies to the <code class="codeph">HIERARCHIES</code> phrase of the <code class="codeph">FROM</code> clause.
                     </p><pre class="pre codeblock"><code>SELECT time_hier.member_name AS Time,
 product_hier.member_name AS Product,
 geography_hier.member_name AS Geography,
 sales,
 units
FROM
 sales_av HIERARCHIES (time_hier, product_hier, geography_hier)
WHERE time_hier.level_name in ('YEAR')
  AND product_hier.level_name in ('DEPARTMENT')
  AND geography_hier.level_name in ('REGION')
ORDER BY time_hier.hier_order,
  product_hier.hier_order,
  geography_hier.hier_order;</code></pre><p>The query returns 50 rows. The following image shows only the first 20 rows.</p><img src="img/av_sel_all_hiers.png" alt="Description of av_sel_all_hiers.png follows" title="Description of av_sel_all_hiers.png follows" longdesc="img_text/av_sel_all_hiers.html"><br><a href="img_text/av_sel_all_hiers.html">Description of the illustration av_sel_all_hiers.png</a></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p>You can view and run SQL scripts that create the tables, the analytic view component objects, and the queries used in the examples from the Oracle Live SQL website at <a href="https://livesql.oracle.com/apex/livesql/file/index.html" target="_blank">https://livesql.oracle.com/apex/livesql/file/index.html</a>.
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529" name="GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529"></a><h3 id="DWHSG-GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529" class="sect3"><span class="enumeration_section">26.4 </span>Examples of Calculated Measures
               </h3>
               <div>
                  <p>Calculated measures are expressions you add to a <code class="codeph">MEASURES</code> clause of an analytic view in the form of <span class="italic"><code class="codeph">measure_name</code></span> <code class="codeph">AS</code> <code class="codeph">(<span class="codeinlineitalic">expression</span>)</code>.
                  </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529__GUID-AB000187-1756-4FAD-8F04-08963A988D73">Add a LAG Expression</p>
                     <p>This example adds a calculated measure that uses a <code class="codeph">LAG</code> operation to the SALES_AV analytic view.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529__GUID-7F1BE548-BECB-4589-85EA-AA1B72A54EAA">
                     <p class="titleinexample">Example 26-4 Adding a LAG Expression</p><pre class="pre codeblock"><code>CREATE OR REPLACE ANALYTIC VIEW sales_av
USING sales_fact
DIMENSION BY
  (time_attr_dim
    KEY month_id REFERENCES month_id
    HIERARCHIES (
      time_hier DEFAULT),
   product_attr_dim
    KEY category_id REFERENCES category_id
    HIERARCHIES (
      product_hier DEFAULT),
   geography_attr_dim
    KEY state_province_id REFERENCES state_province_id
    HIERARCHIES (
      geography_hier DEFAULT)
   )
MEASURES
 (sales FACT sales,
  units FACT units,
  sales_prior_period AS       -- Add a calculated measure.
    (LAG(sales) OVER (HIERARCHY time_hier OFFSET 1))
  )
DEFAULT MEASURE SALES;</code></pre><p>Select the SALES and SALES_PRIOR_PERIOD measures at the YEAR and QUARTER levels.</p><pre class="pre codeblock"><code>SELECT time_hier.member_name as TIME,
 sales,
 sales_prior_period
FROM
 sales_av HIERARCHIES(time_hier)
WHERE time_hier.level_name IN ('YEAR','QUARTER')
ORDER BY time_hier.hier_order;
</code></pre><p>In this excerpt from the query results, note that the <code class="codeph">LAG</code> expression returns prior periods within the same level.
                     </p><img src="img/av_calc_meas_lag.png" alt="Description of av_calc_meas_lag.png follows" title="Description of av_calc_meas_lag.png follows" longdesc="img_text/av_calc_meas_lag.html"><br><a href="img_text/av_calc_meas_lag.html">Description of the illustration av_calc_meas_lag.png</a></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529__GUID-C6EDDFE8-AF2B-44AD-A6A9-520303E37F71">SHARE OF Expressions</p>
                     <p>Share of measures calculate the ratio of a current row to a parent row, ancestor row, or all rows in the current level; for example, the ratio of a geography member to the parent of the member.  Share of measures are specified using the <code class="codeph">SHARE</code> <code class="codeph">OF</code> expression.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529__GUID-015E9CA4-DFBF-4467-9AE9-DB8104E4019D">
                     <p class="titleinexample">Example 26-5 Using SHARE OF Expressions</p>
                     <p>This example adds calculated measures that use <code class="codeph">SHARE</code> <code class="codeph">OF</code> operations to the SALES_AV analytic view.
                     </p><pre class="pre codeblock"><code>CREATE OR REPLACE ANALYTIC VIEW sales_av
USING sales_fact
DIMENSION BY
  (time_attr_dim
    KEY month_id REFERENCES month_id
    HIERARCHIES (
      time_hier DEFAULT),
   product_attr_dim
    KEY category_id REFERENCES category_id
    HIERARCHIES (
      product_hier DEFAULT),
   geography_attr_dim
    KEY state_province_id REFERENCES state_province_id
    HIERARCHIES (
      geography_hier DEFAULT)
   )
MEASURES
 (sales FACT sales,
  units FACT units,
  -- Share of calculations
 sales_shr_parent_prod AS
   (SHARE_OF(sales HIERARCHY product_hier PARENT)),
 sales_shr_parent_geog AS
   (SHARE_OF(sales HIERARCHY geography_hier PARENT)),
 sales_shr_region AS
   (SHARE_OF(sales HIERARCHY geography_hier LEVEL REGION)) 
  )
DEFAULT MEASURE SALES;</code></pre><p>The SALES_SHR_PARENT_PROD measure calculates the ratio of a SALES value at the CATEGORY or DEPARTMENT level to SALES of the parent in the PRODUCT_HIER hierarchy, such as the ratio of SALES for Total Server Computers to Computers.</p>
                     <p>This query selects SALES and SALES_SHR_PARENT_PROD measure for CY2014 at each level of the PRODUCT_HIER hierarchy.</p><pre class="pre codeblock"><code>SELECT time_hier.member_name AS Time,
 product_hier.member_name    AS Product,
 product_hier.level_name     AS Prod_Level,
 sales,
 ROUND(sales_shr_parent_prod,2) AS sales_shr_parent_prod 
FROM
 sales_av HIERARCHIES (time_hier, product_hier)
WHERE time_hier.year_name = 'CY2014'
AND time_hier.level_name = 'YEAR'
ORDER BY product_hier.hier_order;
</code></pre><p>The results of the query are:</p><img src="img/av_calc_meas_share.png" alt="Description of av_calc_meas_share.png follows" title="Description of av_calc_meas_share.png follows" longdesc="img_text/av_calc_meas_share.html"><br><a href="img_text/av_calc_meas_share.html">Description of the illustration av_calc_meas_share.png</a><p>The SALE_SHR_REGION measure calculates the share of SALES at the STATE or COUNTRY levels to SALES at the REGION level, for example, the ratio of SALES for California &#x2013; US to SALES for North America.</p>
                     <p>This query returns the values for the SALES and SALES_SHR_REGION measures for year CY2014 and states in the United States.</p><pre class="pre codeblock"><code>SELECT time_hier.member_name AS Time,
 geography_hier.member_name  AS Geography,
 geography_hier.level_name   AS Geog_Level,
 sales,
 ROUND(sales_shr_region,2)   AS sales_shr_region 
FROM
 sales_av HIERARCHIES (time_hier, geography_hier)
WHERE time_hier.year_name = 'CY2014'
AND time_hier.level_name = 'YEAR'
AND geography_hier.country_name = 'United States'
AND geography_hier.level_name = 'STATE_PROVINCE'
ORDER BY geography_hier.hier_order;
</code></pre><p>This is the result of the query.</p><img src="img/av_calc_meas_share_region.png" alt="Description of av_calc_meas_share_region.png follows" title="Description of av_calc_meas_share_region.png follows" longdesc="img_text/av_calc_meas_share_region.html"><br><a href="img_text/av_calc_meas_share_region.html">Description of the illustration av_calc_meas_share_region.png</a></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529__GUID-DD175022-14B7-4A52-B144-8D14A9270EEE">QDR Expressions</p>
                     <p>A <code class="codeph">qdr_expression</code> uses the <code class="codeph">QUALIFY</code> keyword to limit the values of a measure to those for a single dimension member. An example is Sales for the year CY2011 or the percent difference in SALES between the current time period and CY2011.  The <code class="codeph">QUALIFY</code> expression refers to a <code class="codeph">KEY</code> attribute value. 
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529__GUID-7E0C2ECF-9CBC-45CF-BB16-FB34A405CAC9">
                     <p class="titleinexample">Example 26-6 Using QUALIFY Expressions</p>
                     <p>Create the SALES_AV analytic view with the SALES_2011 and SALES_PCT_CHG_2011 measures.</p><pre class="pre codeblock"><code>CREATE OR REPLACE ANALYTIC VIEW sales_av
USING sales_fact
DIMENSION BY
  (time_attr_dim
    KEY month_id REFERENCES month_id
    HIERARCHIES (
      time_hier DEFAULT),
   product_attr_dim
    KEY category_id REFERENCES category_id
    HIERARCHIES (
      product_hier DEFAULT),
   geography_attr_dim
    KEY state_province_id REFERENCES state_province_id
    HIERARCHIES (
      geography_hier DEFAULT)
   )
MEASURES
 (sales FACT sales,
  units FACT units,
 -- Sales for CY2011
 sales_2011 AS
    (QUALIFY (sales, time_hier = year['11'])),
  -- Sales percent change from 2011.
  sales_pct_chg_2011 AS
    ((sales - (QUALIFY (sales, time_hier = year['11']))) /
    (QUALIFY (sales, time_hier = year['11'])))
  )
DEFAULT MEASURE SALES;</code></pre><p>Regardless of filters in the query, the SALES_2011 measure always returns data for the year CY2011. The SALES_PCT_CHG_2011 measure calculates the percent difference between the current time period and CY2011.</p>
                     <p>This query selects SALES, SALES_2011 and SALES_PCT_CHG_2011 at the YEAR and REGION levels.</p><pre class="pre codeblock"><code>SELECT time_hier.member_name   AS Time,
 geography_hier.member_name    AS Geography,
 sales,
 sales_2011,
 ROUND(sales_pct_chg_2011,2) as sales_pct_chg_2011
FROM
 sales_av HIERARCHIES (time_hier, geography_hier)
WHERE time_hier.level_name = 'YEAR'
AND geography_hier.level_name = 'REGION'
ORDER BY geography_hier.hier_order,
 time_hier.hier_order;</code></pre><p>This is an excerpt from the query results. Note that for each row SALES_2011 returns SALES for CY2011.</p><img src="img/av_calc_meas_qualify.png" alt="Description of av_calc_meas_qualify.png follows" title="Description of av_calc_meas_qualify.png follows" longdesc="img_text/av_calc_meas_qualify.html"><br><a href="img_text/av_calc_meas_qualify.html">Description of the illustration av_calc_meas_qualify.png</a></div>
                  <!-- class="example" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-8EFF4827-208C-40B0-AFA2-6838BFFEB2C1" name="GUID-8EFF4827-208C-40B0-AFA2-6838BFFEB2C1"></a><h3 id="DWHSG-GUID-8EFF4827-208C-40B0-AFA2-6838BFFEB2C1" class="sect3"><span class="enumeration_section">26.5 </span>Attribute Reporting
               </h3>
               <div>
                  <p>You can use any attribute of an attribute dimension in a hierarchy and aggregate data for it in an analytic view.</p>
                  <p>You can use attributes to filter data or to display in a report.  You can also break out (aggregate) data by an attribute. You can create calculated measures in an analytic view using the attribute; the analytic view then provides the aggregate rows for the attribute.</p>
                  <div class="example" id="GUID-8EFF4827-208C-40B0-AFA2-6838BFFEB2C1__GUID-F4434745-B5D1-4B59-91EF-8DEC18202516">
                     <p class="titleinexample">Example 26-7 Using the SEASON Attribute</p>
                     <p>This example first creates an attribute dimension that has SEASON and SEASON_ORDER as attributes. This allows a hierarchy and an analytic view to reuse some metadata of those attributes and to relate the attributes to other levels. For example, SEASON is determined by MONTH values.</p><pre class="pre codeblock"><code>-- Create a time attribute dimension with a SEASON attribute.
CREATE OR REPLACE ATTRIBUTE DIMENSION time_attr_dim
DIMENSION TYPE TIME
USING time_dim
ATTRIBUTES
 (year_id,
  year_name,
  year_end_date,
  quarter_id,
  quarter_name,
  quarter_end_date,
  month_id,
  month_name,
  month_long_name,
  month_end_date,
  season,
  season_order)
LEVEL month
  LEVEL TYPE MONTHS
  KEY month_id
  MEMBER NAME month_name
  MEMBER CAPTION month_name
  MEMBER DESCRIPTION month_long_name
  ORDER BY month_end_date
  DETERMINES (quarter_id, season, season_order)
LEVEL quarter
  LEVEL TYPE QUARTERS
  KEY quarter_id
  MEMBER NAME quarter_name
  MEMBER CAPTION quarter_name
  MEMBER DESCRIPTION quarter_name
  ORDER BY quarter_end_date
  DETERMINES (year_id)
LEVEL year
  LEVEL TYPE YEARS
  KEY year_id
  MEMBER NAME year_name
  MEMBER CAPTION year_name
  MEMBER DESCRIPTION year_name
  ORDER BY year_end_date
LEVEL season
  LEVEL TYPE QUARTERS
  KEY season
  MEMBER NAME season
  MEMBER CAPTION season
  MEMBER DESCRIPTION season
  ORDER BY season_order;</code></pre><p>Create a hierarchy in which MONTH is a child of SEASON.</p><pre class="pre codeblock"><code>CREATE OR REPLACE HIERARCHY time_season_hier
USING time_attr_dim 
  (month CHILD OF
   season);
</code></pre><p>Select data from the TIME_SEASON_HIER hierarchy.</p><pre class="pre codeblock"><code>SELECT member_name,
  member_unique_name,
  level_name,
  hier_order
FROM time_season_hier
ORDER BY hier_order;
</code></pre><p>In the results of the query, the TIME_SEASON_HIER hierarchy returns rows for the ALL level, SEASONS, and MONTHS. This image captures the first twenty of the rows returned.</p><img src="img/av_calc_meas_attr_report.png" alt="Description of av_calc_meas_attr_report.png follows" title="Description of av_calc_meas_attr_report.png follows" longdesc="img_text/av_calc_meas_attr_report.html"><br><a href="img_text/av_calc_meas_attr_report.html">Description of the illustration av_calc_meas_attr_report.png</a><p> The example next creates an analytic view that provides aggregate data for SEASON.</p><pre class="pre codeblock"><code>CREATE OR REPLACE ANALYTIC VIEW sales_av
USING sales_fact
DIMENSION BY
  (time_attr_dim
    KEY month_id REFERENCES month_id
    HIERARCHIES (
      time_hier DEFAULT,
      time_season_hier),
   product_attr_dim
    KEY category_id REFERENCES category_id
    HIERARCHIES (
      product_hier DEFAULT),
   geography_attr_dim
    KEY state_province_id 
    REFERENCES state_province_id
    HIERARCHIES (
      geography_hier DEFAULT)
   )
MEASURES
 (sales FACT sales,
  units FACT units
  )
DEFAULT MEASURE SALES;</code></pre><p>You can now select SALES by YEAR and SEASON directly from the analytic view. This query selects from the TIME_HIER and TIME_SEASON_HIER hierarchies at the YEAR and SEASON levels.</p><pre class="pre codeblock"><code>SELECT  time_hier.member_name      AS Time, 
 time_season_hier.member_name      AS Season,
 ROUND(sales)                      AS Sales
FROM sales_av HIERARCHIES (time_hier, time_season_hier)
WHERE time_hier.level_name = 'YEAR'
  AND time_season_hier.level_name = 'SEASON'
ORDER BY time_hier.hier_order, 
  time_season_hier.hier_order;</code></pre><p>This excerpt from the query results shows the first twelve rows returned.</p><img src="img/av_calc_meas_season_sales.png" alt="Description of av_calc_meas_season_sales.png follows" title="Description of av_calc_meas_season_sales.png follows" longdesc="img_text/av_calc_meas_season_sales.html"><br><a href="img_text/av_calc_meas_season_sales.html">Description of the illustration av_calc_meas_season_sales.png</a></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p>You can view and run the SQL scripts that create the tables, the analytic view component objects, and the queries used in the examples from the Oracle Live SQL website at <a href="https://livesql.oracle.com/apex/livesql/file/index.html" target="_blank">https://livesql.oracle.com/apex/livesql/file/index.html</a>.
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-BEE5DB77-C00D-46F7-8543-F4EE3356BCE2" name="GUID-BEE5DB77-C00D-46F7-8543-F4EE3356BCE2"></a><h3 id="DWHSG-GUID-BEE5DB77-C00D-46F7-8543-F4EE3356BCE2" class="sect3"><span class="enumeration_section">26.6 </span>Analytic View Queries with Filtered Facts and Added Measures
               </h3>
               <div>
                  <p>Queries that <code class="codeph">SELECT</code> from analytic views may include the <code class="codeph">FILTER</code> <code class="codeph">FACT</code> keywords to filter the fact data accessed by the analytic view prior to any calculations and the <code class="codeph">ADD</code> <code class="codeph">MEASURES</code> keywords to define additional calculated measures for the query. 
                  </p>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="analytic-view-objects.html#GUID-CBB7C952-7331-4532-8627-6F27F96F327A">Analytic View Query with Filtered Facts</a></li>
                        <li><a href="analytic-view-objects.html#GUID-36131726-9188-465F-9C35-69D3F657D080">Analytic View Query with Added Measures</a></li>
                        <li><a href="analytic-view-objects.html#GUID-E5DD2E53-995F-4B45-B9D9-BDFE0DC53A05">Analytic View Query with Filtered Facts and Multiple Added Measures</a></li>
                     </ul>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-CBB7C952-7331-4532-8627-6F27F96F327A" name="GUID-CBB7C952-7331-4532-8627-6F27F96F327A"></a><h4 id="DWHSG-GUID-CBB7C952-7331-4532-8627-6F27F96F327A" class="sect4"><span class="enumeration_section">26.6.1 </span>Analytic View Query with Filtered Facts
                  </h4>
                  <div>
                     <p>In a query of an analytic view, you can filter the fact data before the analytic view aggregates the data for higher-level hierarchy members.</p>
                     <p></p>
                     <p>The values of aggregate records returned by an analytic view are determined by the hierarchies of the analytic view, the aggregation operators, and the rows contained in the fact table. A predicate in a <code class="codeph">SELECT</code> statement that queries an analytic view restricts the rows returned by the analytic view but does not affect the computation of aggregate records.
                     </p>
                     <p>By using the <code class="codeph">FILTER</code> <code class="codeph">FACT</code> keywords in a <code class="codeph">SELECT</code> statement, you can filter fact records before the data is aggregated by the analytic view, which produces aggregate values only for the specified hierarchy members.
                     </p>
                     <div class="example" id="GUID-CBB7C952-7331-4532-8627-6F27F96F327A__GUID-E3097227-29F2-4331-9725-2B3512ECD433">
                        <p class="titleinexample">Example 26-8 Queries With and Without Filter-Before Aggregation Predicates</p>
                        <p>The following query selects hierarchy member names and sales values from the sales_av analytic view. The query predicate limits the hierarchy members to those in the YEAR level. The filtering does not affect the aggregation of the measure values.</p><pre class="pre codeblock"><code>SELECT time_hier.member_name, TO_CHAR(sales, '999,999,999,999') AS sales 
  FROM sales_av HIERARCHIES(time_hier)
  WHERE time_hier.level_name = 'YEAR'
  ORDER BY time_hier.hier_order;</code></pre><p>The result of the query is the following. The result includes the aggregated measure values for hierarchy members at the YEAR level.</p><pre class="pre codeblock"><code>MEMBER_NAME          SALES
-----------  -------------
CY2011       6,755,115,981
CY2012       6,901,682,399
CY2013       7,240,938,718
CY2014       7,579,746,353
CY2015       7,941,102,885
</code></pre><p>The following query defines an inline analytic view that the filters the hierarchy members before aggregation.</p><pre class="pre codeblock"><code>SELECT time_hier.member_name, TO_CHAR(sales, '999,999,999,999') AS sales
  FROM ANALYTIC VIEW (                      -- inline analytic view
  USING sales_av HIERARCHIES(time_hier)
  FILTER FACT (time_hier TO level_name = 'MONTH'
               AND TO_CHAR(month_end_date, 'Q') IN (1, 2)
               )
  )
  WHERE time_hier.level_name = 'YEAR')
  ORDER BY time_hier.hier_order;</code></pre><p>The result of the query is the following. The <code class="codeph">FILTER FACT</code> clause of the inline analytic view filters out all but the months that are in the first two quarters. The result includes the aggregated values at the YEAR level for those quarters. The aggregations do not include the third and fourth quarter values.
                        </p><pre class="pre codeblock"><code>MEMBER_NAME          SALES
-----------  -------------
CY2011       3,340,459,835
CY2012       3,397,271,965
CY2013       3,564,557,290
CY2014       3,739,283,051
CY2015       3,926,231,605
</code></pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="analytic-view-objects.html#GUID-E5DD2E53-995F-4B45-B9D9-BDFE0DC53A05">Analytic View Query with Filtered Facts and Multiple Added Measures</a></li>
                        </ul>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-36131726-9188-465F-9C35-69D3F657D080" name="GUID-36131726-9188-465F-9C35-69D3F657D080"></a><h4 id="DWHSG-GUID-36131726-9188-465F-9C35-69D3F657D080" class="sect4"><span class="enumeration_section">26.6.2 </span>Analytic View Query with Added Measures
                  </h4>
                  <div>
                     <p>With the <code class="codeph">ADD</code> <code class="codeph">MEASURES</code> keywords, you can add measure calculations to a query of an analytic view.
                     </p>
                     <div class="example" id="GUID-36131726-9188-465F-9C35-69D3F657D080__GUID-EF46DA67-C961-4ED8-90D4-C23F0A8F1B16">
                        <p class="titleinexample">Example 26-9 Calculation Adding a Measure in the FROM Clause</p>
                        <p>This example has an inline analytic view that adds the calculated measure share_sales to a query using the sales_av analytic view.</p><pre class="pre codeblock"><code>SELECT time_hier.member_name AS "Member", 
       TO_CHAR(sales, '999,999,999,999') AS "Sales", 
       ROUND(share_sales, 2) AS "Share of Sales" 
  FROM ANALYTIC VIEW (
    USING sales_av HIERARCHIES (time_hier)
    ADD MEASURES (
      share_sales as (SHARE_OF(sales HIERARCHY time_hier PARENT))
    )
  )
  WHERE time_hier.level_name IN ('ALL', 'YEAR')
  ORDER BY time_hier.hier_order;</code></pre><p>The following is the result of the query.</p><pre class="pre codeblock"><code>Member          Sales   Share of Sales
------  --------------  --------------
ALL     36,418,586,336
CY2011   6,755,115,981            0.19
CY2012   6,901,682,399            0.19
CY2013   7,240,938,718            0.2
CY2014   7,579,746,353            0.21
CY2015   7,941,102,885            0.22</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-36131726-9188-465F-9C35-69D3F657D080__GUID-D3EB5701-F0F4-4572-B17D-CC8B1D9A5DC6">
                        <p class="titleinexample">Example 26-10 Calculation Adding a Measure in the WITH Clause</p>
                        <p>This example defines the same analytic view as in the previous example but it does so in the <code class="codeph">WITH</code> clause of the <code class="codeph">SELECT</code> statement.
                        </p><pre class="pre codeblock"><code>WITH my_av ANALYTIC VIEW AS (
  USING sales_av HIERARCHIES (time_hier)
  ADD MEASURES (
    share_sales as (SHARE_OF(sales HIERARCHY time_hier PARENT))
  )
)
SELECT time_hier.member_name AS "Member",
       TO_CHAR(sales, '999,999,999,999') AS "Sales", 
       ROUND(share_sales, 2) AS "Share of Sales"
  FROM my_av
  WHERE time_hier.level_name IN ('ALL', 'YEAR')
  ORDER BY time_hier.hier_order;</code></pre><p>The result of the query are the same as the previous example.</p><pre class="pre codeblock"><code>Member          Sales   Share of Sales
------  --------------  --------------
ALL     36,418,586,336
CY2011   6,755,115,981            0.19
CY2012   6,901,682,399            0.19
CY2013   7,240,938,718            0.2
CY2014   7,579,746,353            0.21
CY2015   7,941,102,885            0.22</code></pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="analytic-view-objects.html#GUID-E5DD2E53-995F-4B45-B9D9-BDFE0DC53A05">Analytic View Query with Filtered Facts and Multiple Added Measures</a></li>
                        </ul>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-E5DD2E53-995F-4B45-B9D9-BDFE0DC53A05" name="GUID-E5DD2E53-995F-4B45-B9D9-BDFE0DC53A05"></a><h4 id="DWHSG-GUID-E5DD2E53-995F-4B45-B9D9-BDFE0DC53A05" class="sect4"><span class="enumeration_section">26.6.3 </span>Analytic View Query with Filtered Facts and Multiple Added Measures
                  </h4>
                  <div>
                     <p>In a query of an analytic view, you can specify pre-aggregation filters and added measures.</p>
                     <div class="example" id="GUID-E5DD2E53-995F-4B45-B9D9-BDFE0DC53A05__GUID-342E220C-0D43-409D-A31B-67A898119742">
                        <p class="titleinexample">Example 26-11 Query Using Filter Facts and Multiple Calculated Measures</p>
                        <p>The analytic view in the <code class="codeph">WITH</code> clause in this query is based on the sales_av analytic view. The my_av analytic view filters the time_hier hierarchy members to the first and second quarters of the QUARTER level and the geography_hier hierarchy members to the countries Mexico and Canada of the COUNTRY level. It adds calculated measures that compute sales for the prior period and the percent change of the difference between sales and the prior period sales. 
                        </p><pre class="pre codeblock"><code>WITH my_av ANALYTIC VIEW AS (
  USING sales_av HIERARCHIES (time_hier, geography_hier)
  FILTER FACT (time_hier TO level_name = 'QUARTER' 
               AND (quarter_name LIKE 'Q1%' OR quarter_name LIKE 'Q2%'),
               geography_hier TO level_name = 'COUNTRY'
               AND country_name IN ('Mexico', 'Canada'))
  ADD MEASURES (sales_pp AS
                  (LAG(sales) OVER (HIERARCHY time_hier OFFSET 1)),
                sales_pp_pct_change AS 
                  (LAG_DIFF_PERCENT(sales) OVER (HIERARCHY time_hier OFFSET 1)))
  )
 SELECT time_hier.member_name AS time,
   geography_hier.member_name AS geography,
   sales,
   sales_pp,
   ROUND(sales_pp_pct_change,3) AS "Change"
 FROM my_av HIERARCHIES (time_hier, geography_hier)
 WHERE time_hier.level_name IN ('YEAR') AND
        geography_hier.level_name = 'REGION'
 ORDER BY time_hier.hier_order;</code></pre><p>The result is the following.</p><pre class="pre codeblock"><code>TIME    GEOGRAPHY           SALES    SALES_PP     Change
------  -------------  ------------  -----------  ------
CY2011  North America  229,884,616
CY2012  North America  233,688,485   229,884,616    .017
CY2013  North America  245,970,470   233,688,485    .053
CY2014  North America  256,789,511   245,970,470    .044
CY2015  North America  270,469,199   256,789,511    .053</code></pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="analytic-view-objects.html#GUID-CBB7C952-7331-4532-8627-6F27F96F327A">Analytic View Query with Filtered Facts</a></li>
                           <li><a href="analytic-view-objects.html#GUID-36131726-9188-465F-9C35-69D3F657D080">Analytic View Query with Added Measures</a></li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>