<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="Oracle Database optimizer statistics describe details about the database and its objects.">
      <meta name="description" content="Oracle Database optimizer statistics describe details about the database and its objects.">
      <title>Optimizer Statistics Concepts</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="SQL Tuning Guide">
      <meta property="og:description" content="Oracle Database optimizer statistics describe details about the database and its objects.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="SQL Tuning Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="sql-tuning-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-31T14:57:08-08:00">
      <meta name="dcterms.title" content="SQL Tuning Guide">
      <meta name="dcterms.dateCopyrighted" content="2013, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96095-03">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="optimizer-statistics.html" title="Previous" type="text/html">
      <link rel="next" href="histograms.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TGSQL">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="optimizer-statistics.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="histograms.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">SQL Tuning Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="optimizer-statistics.html" property="item" typeof="WebPage"><span property="name">Optimizer Statistics</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Optimizer Statistics Concepts</li>
            </ol>
            <a id="GUID-C0E74ACE-2706-48A1-97A2-33F52207166A" name="GUID-C0E74ACE-2706-48A1-97A2-33F52207166A"></a><a id="TGSQL336"></a>
            
            <h2 id="TGSQL-GUID-C0E74ACE-2706-48A1-97A2-33F52207166A" class="sect2"><span class="enumeration_chapter">10 </span>Optimizer Statistics Concepts
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>Oracle Database <strong class="term">optimizer statistics</strong> describe details about the database and its objects.
               </p>
               <p>This chapter includes the following topics:</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-AEE74FB8-98BD-416B-8EA0-32CD605DF64E">Introduction to Optimizer Statistics</a><br>The optimizer <span class="bold">cost model</span> relies on statistics collected about the objects involved in a query, and the database and host where the query runs. 
                  </li>
                  <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-BE4DF838-0E65-40AE-B69A-94669F30BE7C">About Optimizer Statistics Types</a><br>The optimizer collects statistics on different types of database objects and characteristics of the database environment.
                  </li>
                  <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-3ED2DA31-F61B-4E8F-9166-79FB01392B1D">How the Database Gathers Optimizer Statistics</a><br>Oracle Database provides several mechanisms to gather statistics.
                  </li>
                  <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-13E8BD68-B8A1-4937-8774-3EF82FB8FB47">When the Database Gathers Optimizer Statistics</a><br>The database collects optimizer statistics at various times and from various sources.
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>Parent topic:</strong> <a href="optimizer-statistics.html#GUID-0A2F3D52-A135-43E1-9CAB-55BFE068A297" title="The accuracy of an execution plan depends on the quality of the optimizer statistics.">Optimizer Statistics</a></p>
                  </div>
               </div>
            </div>
            <a id="TGSQL338"></a><a id="TGSQL337"></a><div class="props_rev_3"><a id="GUID-AEE74FB8-98BD-416B-8EA0-32CD605DF64E" name="GUID-AEE74FB8-98BD-416B-8EA0-32CD605DF64E"></a><h3 id="TGSQL-GUID-AEE74FB8-98BD-416B-8EA0-32CD605DF64E" class="sect3"><span class="enumeration_section">10.1 </span>Introduction to Optimizer Statistics
               </h3>
               <div>
                  <p>The optimizer <span class="bold">cost model</span> relies on statistics collected about the objects involved in a query, and the database and host where the query runs. 
                  </p>
                  <p>The optimizer uses statistics to get an estimate of the number of rows (and number of bytes) retrieved from a table, partition, or index. The optimizer estimates the cost for the access, determines the cost for possible plans, and then picks the <a href="glossary.html#GUID-800F2BE7-A383-4FF3-A9A6-FCE786AABA3B"><span class="xrefglossterm">execution plan</span></a> with the lowest cost.
                  </p>
                  <p>Optimizer statistics include the following:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Table statistics</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Number of rows</p>
                           </li>
                           <li>
                              <p>Number of blocks</p>
                           </li>
                           <li>
                              <p>Average row length</p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>Column statistics</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Number of distinct values (NDV) in a column</p>
                           </li>
                           <li>
                              <p>Number of nulls in a column</p>
                           </li>
                           <li>
                              <p>Data distribution (histogram)</p>
                           </li>
                           <li>
                              <p>Extended statistics</p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>Index statistics</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Number of leaf blocks</p>
                           </li>
                           <li>
                              <p>Number of levels</p>
                           </li>
                           <li>
                              <p>Index clustering factor</p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>System statistics</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>I/O performance and utilization</p>
                           </li>
                           <li>
                              <p>CPU performance and utilization</p>
                           </li>
                        </ul>
                     </li>
                  </ul>
                  <p>As shown in <a href="optimizer-statistics-concepts.html#GUID-AEE74FB8-98BD-416B-8EA0-32CD605DF64E__CHDCACBD">Figure 10-1</a>, the database stores optimizer statistics for tables, columns, indexes, and the system in the data dictionary. You can access these statistics using data dictionary views.
                  </p>
                  <div class="infoboxnote" id="GUID-AEE74FB8-98BD-416B-8EA0-32CD605DF64E__GUID-3402AAA7-FBB3-4CFA-ACF6-CC7C7BCF7504">
                     <p class="notep1">Note:</p>
                     <p>The optimizer statistics are different from the performance statistics visible through <code class="codeph">V$</code> views.
                     </p>
                  </div>
                  <div class="figure" id="GUID-AEE74FB8-98BD-416B-8EA0-32CD605DF64E__CHDCACBD">
                     <p class="titleinfigure">Figure 10-1 Optimizer Statistics</p><img src="img/tgsql_vm_009.png" alt="Description of Figure 10-1 follows" title="Description of Figure 10-1 follows" longdesc="img_text/tgsql_vm_009.html"><br><a href="img_text/tgsql_vm_009.html">Description of "Figure 10-1 Optimizer Statistics"</a></div>
                  <!-- class="figure" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-C0E74ACE-2706-48A1-97A2-33F52207166A" title="Oracle Database optimizer statistics describe details about the database and its objects.">Optimizer Statistics Concepts</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="TGSQL351"></a><div class="props_rev_3"><a id="GUID-BE4DF838-0E65-40AE-B69A-94669F30BE7C" name="GUID-BE4DF838-0E65-40AE-B69A-94669F30BE7C"></a><h3 id="TGSQL-GUID-BE4DF838-0E65-40AE-B69A-94669F30BE7C" class="sect3"><span class="enumeration_section">10.2 </span>About Optimizer Statistics Types
               </h3>
               <div>
                  <p>The optimizer collects statistics on different types of database objects and characteristics of the database environment.</p>
                  <p>This section contains the following topics:</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-60281E3A-8A64-4072-A7F6-719BF9D51260">Table Statistics</a><br>Table statistics contain metadata that the optimizer uses when developing an execution plan.
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-CAD8B1D9-9732-44C2-BF84-ABD82AB1ABC3">Column Statistics</a><br>Column statistics track information about column values and data distribution. 
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-5D96E789-9297-49F1-B304-FFEA335CF678">Index Statistics</a><br>The <strong class="term">index statistics</strong> include information about the number of index levels, the number of index blocks, and the relationship between the index and the data blocks. The optimizer uses these statistics to determine the cost of index scans.
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-FE339C05-E7A4-4953-89C4-D5C69F0C08BA">System Statistics</a><br>The <span class="bold">system statistics</span> describe hardware characteristics such as I/O and CPU performance and utilization. 
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-184A744A-2F2F-4C4C-88E6-107EAD1D517E">User-Defined Optimizer Statistics</a><br>The <strong class="term">extensible optimizer</strong> enables authors of user-defined functions and indexes to create statistics collection, selectivity, and cost functions. 
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-C0E74ACE-2706-48A1-97A2-33F52207166A" title="Oracle Database optimizer statistics describe details about the database and its objects.">Optimizer Statistics Concepts</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-60281E3A-8A64-4072-A7F6-719BF9D51260" name="GUID-60281E3A-8A64-4072-A7F6-719BF9D51260"></a><h4 id="TGSQL-GUID-60281E3A-8A64-4072-A7F6-719BF9D51260" class="sect4"><span class="enumeration_section">10.2.1 </span>Table Statistics
                  </h4>
                  <div>
                     <p>Table statistics contain metadata that the optimizer uses when developing an execution plan.</p>
                     <p>This section contains the following topics:</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-BCFD6363-8860-41AE-9920-60EB695C7374">Permanent Table Statistics</a><br>In Oracle Database, <span class="bold">table statistics</span> include information about rows and blocks. 
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-094E2608-A1CB-46B6-A329-99C6B497A106">Temporary Table Statistics</a><br><code class="codeph">DBMS_STATS</code> can gather statistics for both permanent and global temporary tables, but additional considerations apply to the latter.
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-BE4DF838-0E65-40AE-B69A-94669F30BE7C" title="The optimizer collects statistics on different types of database objects and characteristics of the database environment.">About Optimizer Statistics Types</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL354"></a><a id="TGSQL352"></a><div class="props_rev_3"><a id="GUID-BCFD6363-8860-41AE-9920-60EB695C7374" name="GUID-BCFD6363-8860-41AE-9920-60EB695C7374"></a><h5 id="TGSQL-GUID-BCFD6363-8860-41AE-9920-60EB695C7374" class="sect5"><span class="enumeration_section">10.2.1.1 </span>Permanent Table Statistics
                     </h5>
                     <div>
                        <p>In Oracle Database, <span class="bold">table statistics</span> include information about rows and blocks. 
                        </p>
                        <p>The optimizer uses these statistics to determine the cost of table scans and table joins. The database tracks all relevant statistics about permanent tables. For example, table statistics stored in <code class="codeph">DBA_TAB_STATISTICS</code> track the following:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Number of rows</p>
                              <p>The database uses the row count stored in <code class="codeph">DBA_TAB_STATISTICS</code> when determining <a href="glossary.html#GUID-FE541AF8-DCAB-4B00-8015-04BDCB295A85"><span class="xrefglossterm">cardinality</span></a>.
                              </p>
                           </li>
                           <li>Average row length</li>
                           <li>
                              <p>Number of data blocks</p>
                              <p>The optimizer uses the number of data blocks with the <code class="codeph">DB_FILE_MULTIBLOCK_READ_COUNT</code> initialization parameter to determine the base table access cost.
                              </p>
                           </li>
                           <li>
                              <p>Number of empty data blocks</p>
                           </li>
                        </ul>
                        <p> <code class="codeph">DBMS_STATS.GATHER_TABLE_STATS</code> commits before gathering statistics on permanent tables. 
                        </p>
                        <div class="example" id="GUID-BCFD6363-8860-41AE-9920-60EB695C7374__GUID-C96C12AE-3199-4028-A208-52F90E56C4EE">
                           <p class="titleinexample">Example 10-1 Table Statistics</p>
                           <p>This example queries table statistics for the <code class="codeph">sh.customers</code> table.
                           </p><pre class="pre codeblock"><code>SELECT NUM_ROWS, AVG_ROW_LEN, BLOCKS, 
       EMPTY_BLOCKS, LAST_ANALYZED
FROM   DBA_TAB_STATISTICS
WHERE  OWNER='SH'
AND    TABLE_NAME='CUSTOMERS';
</code></pre><p>Sample output appears as follows:</p><pre class="pre codeblock"><code>  NUM_ROWS AVG_ROW_LEN     BLOCKS EMPTY_BLOCKS LAST_ANAL
---------- ----------- ---------- ------------ ---------
     55500         189       1517            0 25-MAY-17
</code></pre></div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-BCFD6363-8860-41AE-9920-60EB695C7374__GUID-8710CA0D-00B0-48DA-857F-38BE63C5EAA2">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="q">"<a href="influencing-the-optimizer.html#GUID-C1C85DEA-3583-40FE-B5BB-6AC8F76FFE34" title="Oracle Database provides initialization parameters to influence various aspects of optimizer behavior, including cursor sharing, adaptive optimization, and the optimizer mode.">About Optimizer Initialization Parameters</a>"</span></p>
                              </li>
                              <li>
                                 <p><span class="q">"<a href="gathering-optimizer-statistics.html#GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D" title="Use GATHER_TABLE_STATS to collect table statistics, and GATHER_SCHEMA_STATS to collect statistics for all objects in a schema.">Gathering Schema and Table Statistics</a>"</span></p>
                              </li>
                              <li>
                                 <p> <a href="../refrn/DBA_TAB_STATISTICS.html#REFRN23376" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> for a description of the <code class="codeph">DBA_TAB_STATISTICS</code> view and the <code class="codeph">DB_FILE_MULTIBLOCK_READ_COUNT</code> initialization parameter
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-60281E3A-8A64-4072-A7F6-719BF9D51260" title="Table statistics contain metadata that the optimizer uses when developing an execution plan.">Table Statistics</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL355"></a><div class="props_rev_3"><a id="GUID-094E2608-A1CB-46B6-A329-99C6B497A106" name="GUID-094E2608-A1CB-46B6-A329-99C6B497A106"></a><h5 id="TGSQL-GUID-094E2608-A1CB-46B6-A329-99C6B497A106" class="sect5"><span class="enumeration_section">10.2.1.2 </span>Temporary Table Statistics
                     </h5>
                     <div>
                        <p><code class="codeph">DBMS_STATS</code> can gather statistics for both permanent and global temporary tables, but additional considerations apply to the latter.
                        </p>
                        <p>This section contains the following topics:</p>
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-C0F7F290-8430-442F-8E7D-0371834E9917">Types of Temporary Tables</a><br>Temporary tables are classified as global, private, or cursor-duration.
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-630486FC-9175-48BA-9649-E35D377F816F">Statistics for Global Temporary Tables</a><br><code class="codeph">DBMS_STATS</code> collects the same types of statistics for global temporary tables as for permanent tables.
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-1355E1A8-DB82-4C6F-943F-3028ECEA4333">Shared and Session-Specific Statistics for Global Temporary Tables</a><br>Starting in <span>Oracle Database 12c</span>, you can set the table-level preference <code class="codeph">GLOBAL_TEMP_TABLE_STATS</code> to make statistics on a global temporary table shared (<code class="codeph">SHARED</code>) or session-specific (<code class="codeph">SESSION</code>).
                           </li>
                        </ul>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-60281E3A-8A64-4072-A7F6-719BF9D51260" title="Table statistics contain metadata that the optimizer uses when developing an execution plan.">Table Statistics</a></p>
                           </div>
                        </div>
                     </div>
                     
                     <div class="sect5"><a id="GUID-C0F7F290-8430-442F-8E7D-0371834E9917" name="GUID-C0F7F290-8430-442F-8E7D-0371834E9917"></a><h6 id="TGSQL-GUID-C0F7F290-8430-442F-8E7D-0371834E9917" class="sect6"><span class="enumeration_section">10.2.1.2.1 </span>Types of Temporary Tables
                        </h6>
                        <div>
                           <p>Temporary tables are classified as global, private, or cursor-duration.</p>
                           <p>In all types of temporary table, the data is only visible to the session that inserts it. The tables differ as follows:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>A <strong class="term">global temporary table</strong> is an explicitly created persistent object that stores intermediate session-private data for a specific duration.
                                 </p>
                                 <p>The table is global because the definition is visible to all sessions. The <code class="codeph">ON COMMIT</code> clause of <code class="codeph">CREATE GLOBAL TEMPORARY TABLE</code> indicates whether the table is transaction-specific (<code class="codeph">DELETE ROWS</code>) or session-specific (<code class="codeph">PRESERVE ROWS</code>). Optimizer statistics for global temporary tables can be shared or session-specific.
                                 </p>
                              </li>
                              <li>
                                 <p>A <strong class="term">private temporary table</strong> is an explicitly created object, defined by private memory-only metadata, that stores intermediate session-private data for a specific duration.
                                 </p>
                                 <p>The table is private because the definition is visible only to the session that created the table. The <code class="codeph">ON COMMIT</code> clause of <code class="codeph">CREATE PRIVATE TEMPORARY TABLE</code> indicates whether the table is transaction-specific (<code class="codeph">DROP DEFINITION</code>) or session-specific (<code class="codeph">PRESERVE DEFINITION</code>).
                                 </p>
                              </li>
                              <li>
                                 <p>A <strong class="term">cursor-duration temporary table</strong> is an implicitly created memory-only object that is associated with a cursor.
                                 </p>
                                 <p>Unlike global and private temporary tables, <code class="codeph">DBMS_STATS</code> cannot gather statistics for cursor-duration temporary tables.
                                 </p>
                              </li>
                           </ul>
                           <p>The tables differ in where they store data, how they are created and dropped, and in the duration and visibility of metadata. Note that the database allocates storage space when a session first inserts data into a global temporary table, not at table creation.</p>
                           <div class="tblformal" id="GUID-C0F7F290-8430-442F-8E7D-0371834E9917__GUID-4250B181-AA2C-4D43-8ADC-DB295FE21D86">
                              <p class="titleintable">Table 10-1 Important Characteristics of Temporary Tables</p>
                              <table cellpadding="4" cellspacing="0" class="Formal" title="Important Characteristics of Temporary Tables" summary="This table describes the characteristics of global temporary tables, private temporary tables, and cursor-duration temporary tables" frame="hsides" border="1" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="20%" id="d60325e1212">Characteristic</th>
                                       <th align="left" valign="bottom" width="20%" id="d60325e1214">Global Temporary Table</th>
                                       <th align="left" valign="bottom" width="20%" id="d60325e1216">Private Temporary Table</th>
                                       <th align="left" valign="bottom" width="20%" id="d60325e1218">Cursor-Duration Temporary Table</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d60325e1222" headers="d60325e1212 ">Visibility of Data</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1222 d60325e1214 ">Session inserting data</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1222 d60325e1216 ">Session inserting data</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1222 d60325e1218 ">Session inserting data</td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d60325e1231" headers="d60325e1212 ">Storage of Data</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1231 d60325e1214 ">Persistent</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1231 d60325e1216 ">Memory or tempfiles, but only for the duration of the session or transaction</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1231 d60325e1218 ">Only in memory</td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d60325e1240" headers="d60325e1212 ">Visibility of Metadata</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1240 d60325e1214 ">All sessions</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1240 d60325e1216 ">Session that created table (in <code class="codeph">USER_PRIVATE_TEMP_TABLES</code> view, which is based on a <code class="codeph">V$</code> view)
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1240 d60325e1218 ">Session executing cursor</td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d60325e1255" headers="d60325e1212 ">Duration of Metadata</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1255 d60325e1214 ">Until table is explicitly dropped</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1255 d60325e1216 ">Until table is explicitly dropped, or end of session (<code class="codeph">PRESERVE DEFINITION</code>) or transaction (<code class="codeph">DROP DEFINITION</code>)
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1255 d60325e1218 ">Until cursor ages out of shared pool</td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d60325e1270" headers="d60325e1212 ">Creation of Table</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1270 d60325e1214 "><code class="codeph">CREATE GLOBAL TEMPORARY TABLE</code> (supports <code class="codeph">AS SELECT</code>)
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1270 d60325e1216 "><code class="codeph">CREATE PRIVATE TEMPORARY TABLE</code> (supports <code class="codeph">AS SELECT</code>)
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1270 d60325e1218 ">Implicitly created when optimizer considers it useful</td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d60325e1289" headers="d60325e1212 ">Effect of Creation on Existing Transactions</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1289 d60325e1214 ">No implicit commit</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1289 d60325e1216 ">No implicit commit</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1289 d60325e1218 ">No implicit commit</td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d60325e1298" headers="d60325e1212 ">Naming Rules</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1298 d60325e1214 ">Same as for permanent tables</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1298 d60325e1216 ">Must begin with <code class="codeph">ORA$PTT_</code></td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1298 d60325e1218 ">Internally generated unique name</td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d60325e1309" headers="d60325e1212 ">Dropping of Table</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1309 d60325e1214 "><code class="codeph">DROP GLOBAL TEMPORARY TABLE</code></td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1309 d60325e1216 "><code class="codeph">DROP PRIVATE TEMPORARY TABLE</code>, or implicitly dropped at end of session (<code class="codeph">PRESERVE DEFINITION</code>) or transaction (<code class="codeph">DROP DEFINITION</code>)
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1309 d60325e1218 ">Implicitly dropped at end of session</td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-C0F7F290-8430-442F-8E7D-0371834E9917__GUID-A9B4EC93-5BFD-4125-AF8E-B30E149C57E9">
                              <p class="notep1">See Also:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><span class="q">"<a href="query-transformations.html#GUID-C1AE164B-E99F-418A-9B2A-1ADB036048DF" title="To materialize the intermediate results of a query, Oracle Database may implicitly create a cursor-duration temporary table in memory during query compilation.">Cursor-Duration Temporary Tables</a>"</span></p>
                                 </li>
                                 <li>
                                    <p><a href="../admin/managing-tables.html#ADMIN-GUID-A48CB362-FC15-4A26-8386-906A55F6788E" target="_blank"><span><cite>Oracle Database Administrator’s Guide</cite></span></a> to learn how to manage temporary tables
                                    </p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-094E2608-A1CB-46B6-A329-99C6B497A106" title="DBMS_STATS can gather statistics for both permanent and global temporary tables, but additional considerations apply to the latter.">Temporary Table Statistics</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL95329"></a><div class="props_rev_3"><a id="GUID-630486FC-9175-48BA-9649-E35D377F816F" name="GUID-630486FC-9175-48BA-9649-E35D377F816F"></a><h6 id="TGSQL-GUID-630486FC-9175-48BA-9649-E35D377F816F" class="sect6"><span class="enumeration_section">10.2.1.2.2 </span>Statistics for Global Temporary Tables
                        </h6>
                        <div>
                           <p><code class="codeph">DBMS_STATS</code> collects the same types of statistics for global temporary tables as for permanent tables.
                           </p>
                           <div class="infoboxnote" id="GUID-630486FC-9175-48BA-9649-E35D377F816F__GUID-64080EBB-877A-4DAE-8A7B-584551E3014C">
                              <p class="notep1">Note:</p>
                              <p>You cannot collect statistics for private temporary tables.</p>
                           </div>
                           <p>The following table shows how global temporary tables differ in how they gather and store optimizer statistics, depending on whether the tables are scoped to a transaction or session. </p>
                           <div class="tblformal" id="GUID-630486FC-9175-48BA-9649-E35D377F816F__GUID-3F667E8A-91B7-4905-81B9-D80BEA63E193">
                              <p class="titleintable">Table 10-2 Optimizer Statistics for Global Temporary Tables</p>
                              <table cellpadding="4" cellspacing="0" class="Formal" title="Optimizer Statistics for Global Temporary Tables" summary="This table describes the characteristics of global temporary tables." frame="hsides" border="1" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="20%" id="d60325e1480">Characteristic</th>
                                       <th align="left" valign="bottom" width="20%" id="d60325e1482">Transaction-Specific</th>
                                       <th align="left" valign="bottom" width="20%" id="d60325e1484">Session-Specific</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d60325e1488" headers="d60325e1480 ">Effect of <code class="codeph">DBMS_STATS</code> collection
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1488 d60325e1482 ">Does not commit</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1488 d60325e1484 ">Commits</td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d60325e1498" headers="d60325e1480 ">Storage of statistics</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1498 d60325e1482 ">Memory only</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1498 d60325e1484 ">Dictionary tables</td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d60325e1505" headers="d60325e1480 ">Histogram creation</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1505 d60325e1482 ">Not supported</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1505 d60325e1484 ">Supported</td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <p>The following procedures do not commit for transaction-specific temporary tables, so that rows in these tables are not deleted:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">GATHER_TABLE_STATS</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">DELETE_<span class="codeinlineitalic">obj</span>_STATS</code>, where <span class="italic"><code class="codeph">obj</code></span> is <code class="codeph">TABLE</code>, <code class="codeph">COLUMN</code>, or <code class="codeph">INDEX</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">SET_<span class="codeinlineitalic">obj</span>_STATS</code>, where <span class="italic"><code class="codeph">obj</code></span> is <code class="codeph">TABLE</code>, <code class="codeph">COLUMN</code>, or <code class="codeph">INDEX</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">GET_<span class="codeinlineitalic">obj</span>_STATS</code>, where <span class="italic"><code class="codeph">obj</code></span> is <code class="codeph">TABLE</code>, <code class="codeph">COLUMN</code>, or <code class="codeph">INDEX</code></p>
                              </li>
                           </ul>
                           <p>The preceding program units observe the <code class="codeph">GLOBAL_TEMP_TABLE_STATS</code> statistics preference. For example, if the table preference is set to <code class="codeph">SESSION</code>, then <code class="codeph">SET_TABLE_STATS</code> sets the session statistics, and <code class="codeph">GATHER_TABLE_STATS</code> <span class="italic">preserves</span> all rows in a transaction-specific temporary table. If the table preference is set to <code class="codeph">SHARED</code>, however, then <code class="codeph">SET_TABLE_STATS</code> sets the shared statistics, and <code class="codeph">GATHER_TABLE_STATS</code> <span class="italic">deletes</span> all rows from a transaction-specific temporary table. 
                           </p>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-630486FC-9175-48BA-9649-E35D377F816F__GUID-9F5EFD7E-069E-4032-B1DC-B98F7A3FE99A">
                              <p class="notep1">See Also:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><span class="q">"<a href="gathering-optimizer-statistics.html#GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D" title="Use GATHER_TABLE_STATS to collect table statistics, and GATHER_SCHEMA_STATS to collect statistics for all objects in a schema.">Gathering Schema and Table Statistics</a>"</span></p>
                                 </li>
                                 <li>
                                    <p><a href="../cncpt/tables-and-table-clusters.html#CNCPT88820" target="_blank"><span><cite>Oracle Database Concepts</cite></span></a> to learn about global temporary tables
                                    </p>
                                 </li>
                                 <li>
                                    <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-CA6A56B9-0540-45E9-B1D7-D78769B7714C" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_STATS.GATHER_TABLE_STATS</code> procedure
                                    </p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-094E2608-A1CB-46B6-A329-99C6B497A106" title="DBMS_STATS can gather statistics for both permanent and global temporary tables, but additional considerations apply to the latter.">Temporary Table Statistics</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL95328"></a><div class="props_rev_3"><a id="GUID-1355E1A8-DB82-4C6F-943F-3028ECEA4333" name="GUID-1355E1A8-DB82-4C6F-943F-3028ECEA4333"></a><h6 id="TGSQL-GUID-1355E1A8-DB82-4C6F-943F-3028ECEA4333" class="sect6"><span class="enumeration_section">10.2.1.2.3 </span>Shared and Session-Specific Statistics for Global Temporary Tables
                        </h6>
                        <div>
                           <p>Starting in <span>Oracle Database 12c</span>, you can set the table-level preference <code class="codeph">GLOBAL_TEMP_TABLE_STATS</code> to make statistics on a global temporary table shared (<code class="codeph">SHARED</code>) or session-specific (<code class="codeph">SESSION</code>).
                           </p>
                           <p>When <code class="codeph">GLOBAL_TEMP_TABLE_STATS</code> is <code class="codeph">SESSION</code>, you can gather optimizer statistics for a global temporary table in one session, and then use the statistics for this session only. Meanwhile, users can continue to maintain a shared version of the statistics. During optimization, the optimizer first checks whether a global temporary table has session-specific statistics. If yes, then the optimizer uses them. Otherwise, the optimizer uses shared statistics if they exist.
                           </p>
                           <div class="infoboxnote" id="GUID-1355E1A8-DB82-4C6F-943F-3028ECEA4333__GUID-4EF16686-D410-48D5-AF08-1E3F5D7E721D">
                              <p class="notep1">Note:</p>
                              <p>In releases before <span>Oracle Database 12c</span>, the database did not maintain optimizer statistics for global temporary tables and non-global temporary tables differently. The database maintained one version of the statistics shared by all sessions, even though data in different sessions could differ.
                              </p>
                           </div>
                           <p>Session-specific optimizer statistics have the following characteristics:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Dictionary views that track statistics show both the shared statistics and the session-specific statistics in the current session.</p>
                                 <p>The views are <code class="codeph">DBA_TAB_STATISTICS</code>, <code class="codeph">DBA_IND_STATISTICS</code>, <code class="codeph">DBA_TAB_HISTOGRAMS</code>, and <code class="codeph">DBA_TAB_COL_STATISTICS</code> (each view has a corresponding <code class="codeph">USER_</code> and <code class="codeph">ALL_</code> version). The <code class="codeph">SCOPE</code> column shows whether statistics are session-specific or shared. Session-specific statistics must be stored in the data dictionary so that multiple processes can access them in Oracle RAC.
                                 </p>
                              </li>
                              <li>
                                 <p></p>
                                 <p><code class="codeph">CREATE ... AS SELECT</code> automatically gathers optimizer statistics. When <code class="codeph">GLOBAL_TEMP_TABLE_STATS</code> is set to <code class="codeph">SHARED</code>, however, you must gather statistics manually using <code class="codeph">DBMS_STATS</code>.
                                 </p>
                              </li>
                              <li>
                                 <p>Pending statistics are not supported.</p>
                              </li>
                              <li>
                                 <p>Other sessions do not share a cursor that uses the session-specific statistics. </p>
                                 <p>Different sessions can share a cursor that uses <span class="italic">shared</span> statistics, as in releases earlier than <span>Oracle Database 12c</span>. The same session can share a cursor that uses session-specific statistics.
                                 </p>
                              </li>
                              <li>
                                 <p>By default, <code class="codeph">GATHER_TABLE_STATS</code> for the temporary table immediately invalidates previous cursors compiled in the same session. However, this procedure does not invalidate cursors compiled in other sessions.
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-1355E1A8-DB82-4C6F-943F-3028ECEA4333__GUID-A5678D7A-5DFE-4154-AB9C-DC9744E401FB">
                              <p class="notep1">See Also:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-CDAA4742-5398-4A64-B871-E39F38D0021F" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the  <code class="codeph">GLOBAL_TEMP_TABLE_STATS</code> preference
                                    </p>
                                 </li>
                                 <li>
                                    <p><a href="../refrn/DBA_TAB_STATISTICS.html#REFRN-GUID-03D846F8-5906-42FE-983B-E3434F5545A7" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> for a description of the <code class="codeph">DBA_TAB_STATISTICS</code> view
                                    </p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-094E2608-A1CB-46B6-A329-99C6B497A106" title="DBMS_STATS can gather statistics for both permanent and global temporary tables, but additional considerations apply to the latter.">Temporary Table Statistics</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div>
               </div><a id="TGSQL356"></a><div class="props_rev_3"><a id="GUID-CAD8B1D9-9732-44C2-BF84-ABD82AB1ABC3" name="GUID-CAD8B1D9-9732-44C2-BF84-ABD82AB1ABC3"></a><h4 id="TGSQL-GUID-CAD8B1D9-9732-44C2-BF84-ABD82AB1ABC3" class="sect4"><span class="enumeration_section">10.2.2 </span>Column Statistics
                  </h4>
                  <div>
                     <p>Column statistics track information about column values and data distribution. </p>
                     <p>The optimizer uses column statistics to generate accurate <span class="bold">cardinality</span> estimates and make better decisions about index usage, join orders, join methods, and so on. For example, statistics in <code class="codeph">DBA_TAB_COL_STATISTICS</code> track the following:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Number of distinct values</p>
                        </li>
                        <li>
                           <p>Number of nulls</p>
                        </li>
                        <li>
                           <p>High and low values</p>
                        </li>
                        <li>
                           <p>Histogram-related information</p>
                        </li>
                     </ul>
                     <p>The optimizer can use <a href="glossary.html#GUID-0171CA72-03D5-4A7E-9EA1-1C08455799C2"><span class="xrefglossterm">extended statistics</span></a>, which are a special type of column statistics. These statistics are useful for informing the optimizer of logical relationships among columns.
                     </p>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-CAD8B1D9-9732-44C2-BF84-ABD82AB1ABC3__GUID-3C267BA8-99F3-4C5A-B6CB-C852BB073605">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="q">"<a href="histograms.html#GUID-BE10EBFC-FEFC-4530-90DF-1443D9AD9B64" title="A histogram is a special type of column statistic that provides more detailed information about the data distribution in a table column. A histogram sorts values into "buckets," as you might sort coins into buckets.">Histograms</a>"</span></p>
                           </li>
                           <li>
                              <p><span class="q">"<a href="managing-extended-statistics.html#GUID-858E0BDA-06C6-471F-B9E8-888C3AD29673" title="Individual column statistics are useful for determining the selectivity of a single predicate in a WHERE clause.">About Statistics on Column Groups</a>"</span></p>
                           </li>
                           <li>
                              <p><a href="../refrn/DBA_TAB_STATISTICS.html#REFRN23376" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> for a description of the <code class="codeph">DBA_TAB_COL_STATISTICS</code> view
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-BE4DF838-0E65-40AE-B69A-94669F30BE7C" title="The optimizer collects statistics on different types of database objects and characteristics of the database environment.">About Optimizer Statistics Types</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL357"></a><div class="props_rev_3"><a id="GUID-5D96E789-9297-49F1-B304-FFEA335CF678" name="GUID-5D96E789-9297-49F1-B304-FFEA335CF678"></a><h4 id="TGSQL-GUID-5D96E789-9297-49F1-B304-FFEA335CF678" class="sect4"><span class="enumeration_section">10.2.3 </span>Index Statistics
                  </h4>
                  <div>
                     <p>The <strong class="term">index statistics</strong> include information about the number of index levels, the number of index blocks, and the relationship between the index and the data blocks. The optimizer uses these statistics to determine the cost of index scans.
                     </p>
                     <p>This section contains the following topics:</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-CE899A61-1922-48E6-88DE-A7278C247E8C">Types of Index Statistics</a><br>The <code class="codeph">DBA_IND_STATISTICS</code> view tracks index statistics.
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-84A4914F-10C5-49BE-92AF-F26DEC5D060F">Index Clustering Factor</a><br>For a B-tree index, the <strong class="term">index clustering factor</strong> measures the physical grouping of rows in relation to an index value, such as last name. 
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-5677EA51-E2DD-4562-B44C-336E329D5288">Effect of Index Clustering Factor on Cost: Example</a><br>This example illustrates how the index clustering factor can influence the cost of table access.
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-BE4DF838-0E65-40AE-B69A-94669F30BE7C" title="The optimizer collects statistics on different types of database objects and characteristics of the database environment.">About Optimizer Statistics Types</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL358"></a><div class="props_rev_3"><a id="GUID-CE899A61-1922-48E6-88DE-A7278C247E8C" name="GUID-CE899A61-1922-48E6-88DE-A7278C247E8C"></a><h5 id="TGSQL-GUID-CE899A61-1922-48E6-88DE-A7278C247E8C" class="sect5"><span class="enumeration_section">10.2.3.1 </span>Types of Index Statistics
                     </h5>
                     <div>
                        <p>The <code class="codeph">DBA_IND_STATISTICS</code> view tracks index statistics.
                        </p>
                        <p>Statistics include the following:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Levels</p>
                              <p>The <code class="codeph">BLEVEL</code> column shows the number of blocks required to go from the root block to a leaf block. A B-tree index has two types of blocks: branch blocks for searching and leaf blocks that store values. See <a href="../cncpt/indexes-and-index-organized-tables.html#CNCPT1170" target="_blank"><span><cite>Oracle Database Concepts</cite></span></a> for a conceptual overview of B-tree indexes.
                              </p>
                           </li>
                           <li>
                              <p>Distinct keys</p>
                              <p>This columns tracks the number of distinct indexed values. If a unique constraint is defined, and if no <code class="codeph">NOT NULL</code> constraint is defined, then this value equals the number of non-null values.
                              </p>
                           </li>
                           <li>
                              <p>Average number of leaf blocks for each distinct indexed key</p>
                           </li>
                           <li>
                              <p>Average number of data blocks pointed to by each distinct indexed key</p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-CE899A61-1922-48E6-88DE-A7278C247E8C__GUID-6405DE23-9762-4FEC-86DE-FE143BA48FA4">
                           <p class="notep1">See Also:</p>
                           <p> <a href="../refrn/DBA_TAB_STATISTICS.html#REFRN23376" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> for a description of the <code class="codeph">DBA_IND_STATISTICS</code> view
                           </p>
                        </div>
                        <div class="example" id="GUID-CE899A61-1922-48E6-88DE-A7278C247E8C__GUID-A8636D14-18A5-46EF-8962-B849995E509E">
                           <p class="titleinexample">Example 10-2 Index Statistics</p>
                           <p>This example queries some index statistics for the <code class="codeph">cust_lname_ix</code> and <code class="codeph">customers_pk</code> indexes on the <code class="codeph">sh.customers</code> table (sample output included):
                           </p><pre class="pre codeblock"><code>SELECT INDEX_NAME, BLEVEL, LEAF_BLOCKS AS "LEAFBLK", DISTINCT_KEYS AS "DIST_KEY",
       AVG_LEAF_BLOCKS_PER_KEY AS "LEAFBLK_PER_KEY",
       AVG_DATA_BLOCKS_PER_KEY AS "DATABLK_PER_KEY"
FROM   DBA_IND_STATISTICS
WHERE  OWNER = 'SH'
AND    INDEX_NAME IN ('CUST_LNAME_IX','CUSTOMERS_PK');

INDEX_NAME     BLEVEL LEAFBLK DIST_KEY LEAFBLK_PER_KEY DATABLK_PER_KEY
-------------- ------ ------- -------- --------------- ---------------
CUSTOMERS_PK        1     115    55500               1               1
CUST_LNAME_IX       1     141      908               1              10</code></pre></div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-5D96E789-9297-49F1-B304-FFEA335CF678" title="The index statistics include information about the number of index levels, the number of index blocks, and the relationship between the index and the data blocks. The optimizer uses these statistics to determine the cost of index scans.">Index Statistics</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL94859"></a><a id="TGSQL359"></a><div class="props_rev_3"><a id="GUID-84A4914F-10C5-49BE-92AF-F26DEC5D060F" name="GUID-84A4914F-10C5-49BE-92AF-F26DEC5D060F"></a><h5 id="TGSQL-GUID-84A4914F-10C5-49BE-92AF-F26DEC5D060F" class="sect5"><span class="enumeration_section">10.2.3.2 </span>Index Clustering Factor
                     </h5>
                     <div>
                        <p>For a B-tree index, the <strong class="term">index clustering factor</strong> measures the physical grouping of rows in relation to an index value, such as last name. 
                        </p>
                        <p>The index clustering factor helps the optimizer decide whether an index scan or full table scan is more efficient for certain queries). A low clustering factor indicates an efficient index scan.</p>
                        <p>A clustering factor that is close to the number of <span class="italic">blocks</span> in a table indicates that the rows are physically ordered in the table blocks by the index key. If the database performs a <a href="glossary.html#GUID-DCAD1CDB-8714-4900-9CB3-8C26802D3B63"><span class="xrefglossterm">full table scan</span></a>, then the database tends to retrieve the rows as they are stored on disk sorted by the index key. A clustering factor that is close to the number of <span class="italic">rows</span> indicates that the rows are scattered randomly across the database blocks in relation to the index key. If the database performs a full table scan, then the database would not retrieve rows in any sorted order by this index key.
                        </p>
                        <p>The clustering factor is a property of a specific index, not a table. If multiple indexes exist on a table, then the clustering factor for one index might be small while the factor for another index is large. An attempt to reorganize the table to improve the clustering factor for one index may degrade the clustering factor of the other index.</p>
                        <div class="example" id="GUID-84A4914F-10C5-49BE-92AF-F26DEC5D060F__GUID-65782998-E754-4EEC-B1B2-0D271145218D">
                           <p class="titleinexample">Example 10-3 Index Clustering Factor</p>
                           <p>This example shows how the optimizer uses the index clustering factor to determine whether using an index is more effective than a full table scan.</p>
                           <ol>
                              <li>
                                 <p>Start SQL*Plus and connect to a database as <code class="codeph">sh</code>, and then query the number of rows and blocks in the <code class="codeph">sh.customers</code> table (sample output included):
                                 </p><pre class="pre codeblock"><code>SELECT  table_name, num_rows, blocks
FROM    user_tables
WHERE   table_name='CUSTOMERS';
 
TABLE_NAME                       NUM_ROWS     BLOCKS
------------------------------ ---------- ----------
CUSTOMERS                           55500       1486
</code></pre></li>
                              <li>
                                 <p>Create an index on the <code class="codeph">customers.cust_last_name</code> column.
                                 </p>
                                 <p>For example, execute the following statement:</p><pre class="pre codeblock"><code>CREATE INDEX CUSTOMERS_LAST_NAME_IDX ON customers(cust_last_name);
</code></pre></li>
                              <li>
                                 <p>Query the index clustering factor of the newly created index.</p>
                                 <p>The following query shows that the <code class="codeph">customers_last_name_idx</code> index has a high clustering factor because the clustering factor is significantly more than the number of blocks in the table:
                                 </p><pre class="pre codeblock"><code>SELECT index_name, blevel, leaf_blocks, clustering_factor
FROM   user_indexes
WHERE  table_name='CUSTOMERS'
AND    index_name= 'CUSTOMERS_LAST_NAME_IDX';
 
INDEX_NAME                         BLEVEL LEAF_BLOCKS CLUSTERING_FACTOR
------------------------------ ---------- ----------- -----------------
CUSTOMERS_LAST_NAME_IDX                 1         141              <span class="bold">9859</span>
</code></pre></li>
                              <li>
                                 <p>Create a new copy of the <code class="codeph">customers</code> table, with rows ordered by <code class="codeph">cust_last_name</code>.
                                 </p>
                                 <p>For example, execute the following statements:</p><pre class="pre codeblock"><code>DROP TABLE customers3 PURGE;
CREATE TABLE customers3 AS 
  SELECT * 
  FROM   customers 
  ORDER BY cust_last_name;
</code></pre></li>
                              <li>
                                 <p>Gather statistics on the <code class="codeph">customers3</code> table.
                                 </p>
                                 <p>For example, execute the <code class="codeph">GATHER_TABLE_STATS</code> procedure as follows:
                                 </p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_STATS.GATHER_TABLE_STATS(null,'CUSTOMERS3');
</pre></li>
                              <li>
                                 <p>Query the number of rows and blocks in the <code class="codeph">customers3</code> table .
                                 </p>
                                 <p>For example, enter the following query (sample output included):</p><pre class="pre codeblock"><code>SELECT    TABLE_NAME, NUM_ROWS, BLOCKS
FROM      USER_TABLES
WHERE     TABLE_NAME='CUSTOMERS3';
 
TABLE_NAME                       NUM_ROWS     BLOCKS
------------------------------ ---------- ----------
CUSTOMERS3                          55500       1485 
</code></pre></li>
                              <li>
                                 <p>Create an index on the <code class="codeph">cust_last_name</code> column of <code class="codeph">customers3</code>.
                                 </p>
                                 <p>For example, execute the following statement:</p><pre class="pre codeblock"><code>CREATE INDEX CUSTOMERS3_LAST_NAME_IDX ON customers3(cust_last_name);
</code></pre></li>
                              <li>
                                 <p>Query the index clustering factor of the <code class="codeph">customers3_last_name_idx</code> index.
                                 </p>
                                 <p>The following query shows that the <code class="codeph">customers3_last_name_idx</code> index has a lower clustering factor:
                                 </p><pre class="pre codeblock"><code>SELECT INDEX_NAME, BLEVEL, LEAF_BLOCKS, CLUSTERING_FACTOR
FROM   USER_INDEXES
WHERE  TABLE_NAME = 'CUSTOMERS3'
AND    INDEX_NAME = 'CUSTOMERS3_LAST_NAME_IDX';
 
INDEX_NAME                         BLEVEL LEAF_BLOCKS CLUSTERING_FACTOR
------------------------------ ---------- ----------- -----------------
CUSTOMERS3_LAST_NAME_IDX                1         141              <span class="bold">1455</span>
</code></pre><p>The table <code class="codeph">customers3</code> has the same data as the original <code class="codeph">customers</code> table, but the index on <code class="codeph">customers3</code> has a much lower clustering factor because the data in the table is ordered by the <code class="codeph">cust_last_name</code>. The clustering factor is now about 10 times the number of blocks instead of 70 times.
                                 </p>
                              </li>
                              <li>
                                 <p>Query the <code class="codeph">customers</code> table.
                                 </p>
                                 <p>For example, execute the following query (sample output included):</p><pre class="pre codeblock"><code>SELECT cust_first_name, cust_last_name
FROM   customers
WHERE  cust_last_name BETWEEN 'Puleo' AND 'Quinn';
 
CUST_FIRST_NAME      CUST_LAST_NAME
-------------------- ----------------------------------------
Vida                 Puleo
Harriett             Quinlan
Madeleine            Quinn
Caresse              Puleo 
</code></pre></li>
                              <li>
                                 <p>Display the cursor for the query.</p>
                                 <p>For example, execute the following query (partial sample output included):</p><pre class="pre codeblock"><code>SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR());

-------------------------------------------------------------------------------
| Id | Operation                 | Name      | Rows |Bytes|Cost (%CPU)| Time  |
-------------------------------------------------------------------------------
|   0| SELECT STATEMENT          |           |      |     | 405 (100)|        |
|*  1|  TABLE ACCESS STORAGE FULL| CUSTOMERS |  2335|35025| 405   (1)|00:00:01|
-------------------------------------------------------------------------------
</code></pre><p>The preceding plan shows that the optimizer did not use the index on the original <code class="codeph">customers</code> tables.
                                 </p>
                              </li>
                              <li>
                                 <p>Query the <code class="codeph">customers3</code> table.
                                 </p>
                                 <p>For example, execute the following query (sample output included):</p><pre class="pre codeblock"><code>SELECT cust_first_name, cust_last_name
FROM   customers3
WHERE  cust_last_name BETWEEN 'Puleo' AND 'Quinn';
 
CUST_FIRST_NAME      CUST_LAST_NAME
-------------------- ----------------------------------------
Vida                 Puleo
Harriett             Quinlan
Madeleine            Quinn
Caresse              Puleo 
</code></pre></li>
                              <li>
                                 <p>Display the cursor for the query.</p>
                                 <p>For example, execute the following query (partial sample output included):</p><pre class="pre codeblock"><code>SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR());

---------------------------------------------------------------------------------------
|Id| Operation                   | Name                   |Rows|Bytes|Cost(%CPU)| Time|
---------------------------------------------------------------------------------------
| 0| SELECT STATEMENT            |                        |    |     |69(100)|        |
| 1|  TABLE ACCESS BY INDEX ROWID|CUSTOMERS3              |2335|35025|69(0)  |00:00:01|
|*2|   INDEX RANGE SCAN          |CUSTOMERS3_LAST_NAME_IDX|2335|     |7(0)   |00:00:01|
---------------------------------------------------------------------------------------
</code></pre><p>The result set is the same, but the optimizer chooses the index. The plan cost is much less than the cost of the plan used on the original <code class="codeph">customers</code> table.
                                 </p>
                              </li>
                              <li>
                                 <p>Query <code class="codeph">customers</code> with a hint that forces the optimizer to use the index.
                                 </p>
                                 <p>For example, execute the following query (partial sample output included):</p><pre class="pre codeblock"><code>SELECT /*+ index (Customers CUSTOMERS_LAST_NAME_IDX) */ cust_first_name, 
       cust_last_name 
FROM   customers 
WHERE  cust_last_name BETWEEN 'Puleo' and 'Quinn';
 
CUST_FIRST_NAME      CUST_LAST_NAME
-------------------- ----------------------------------------
Vida                 Puleo
Caresse              Puleo
Harriett             Quinlan
Madeleine            Quinn 
</code></pre></li>
                              <li>
                                 <p>Display the cursor for the query.</p>
                                 <p>For example, execute the following query (partial sample output included):</p><pre class="pre codeblock"><code>SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR());

-----------------------------------------------------------------------------------------
| Id  | Operation                | Name                  |Rows|Bytes|Cost(%CPU)| Time   |
-----------------------------------------------------------------------------------------
| 0| SELECT STATEMENT            |                       |    |     | 422(100) |        |
| 1|  TABLE ACCESS BY INDEX ROWID|CUSTOMERS              |335 |35025| 422(0)   |00:00:01|
|*2|   INDEX RANGE SCAN          |CUSTOMERS_LAST_NAME_IDX|2335|     | 7(0)     |00:00:01|
-----------------------------------------------------------------------------------------</code></pre><p>The preceding plan shows that the cost of using the index on <code class="codeph">customers</code> is higher than the cost of a full table scan. Thus, using an index does not necessarily improve performance. The index clustering factor is a measure of whether an index scan is more effective than a full table scan.
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-5D96E789-9297-49F1-B304-FFEA335CF678" title="The index statistics include information about the number of index levels, the number of index blocks, and the relationship between the index and the data blocks. The optimizer uses these statistics to determine the cost of index scans.">Index Statistics</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL363"></a><a id="TGSQL364"></a><a id="TGSQL362"></a><div class="props_rev_3"><a id="GUID-5677EA51-E2DD-4562-B44C-336E329D5288" name="GUID-5677EA51-E2DD-4562-B44C-336E329D5288"></a><h5 id="TGSQL-GUID-5677EA51-E2DD-4562-B44C-336E329D5288" class="sect5"><span class="enumeration_section">10.2.3.3 </span>Effect of Index Clustering Factor on Cost: Example
                     </h5>
                     <div>
                        <p>This example illustrates how the index clustering factor can influence the cost of table access.</p>
                        <p>Consider the following scenario:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>A table contains 9 rows that are stored in 3 data blocks.</p>
                           </li>
                           <li>
                              <p>The <code class="codeph">col1</code> column currently stores the values <code class="codeph">A</code>, <code class="codeph">B</code>, and <code class="codeph">C</code>.
                              </p>
                           </li>
                           <li>
                              <p>A nonunique index named <code class="codeph">col1_idx</code> exists on <code class="codeph">col1</code> for this table.
                              </p>
                           </li>
                        </ul>
                        <div class="example" id="GUID-5677EA51-E2DD-4562-B44C-336E329D5288__CHDHIBIF">
                           <p class="titleinexample">Example 10-4 Collocated Data</p>
                           <p>Assume that the rows are stored in the data blocks as follows:</p><pre class="pre codeblock"><code>Block 1       Block 2        Block 3
-------       -------        -------
A  A  A       B  B  B        C  C  C
</code></pre><p>In this example, the index clustering factor for <code class="codeph">col1_idx</code> is low. The rows that have the same indexed column values for <code class="codeph">col1</code> are in the same data blocks in the table. Thus, the cost of using an index range scan to return all rows with value <code class="codeph">A</code> is low because only one block in the table must be read.
                           </p>
                        </div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-5677EA51-E2DD-4562-B44C-336E329D5288__CHDJIHFC">
                           <p class="titleinexample">Example 10-5 Scattered Data</p>
                           <p>Assume that the same rows are scattered across the data blocks as follows:</p><pre class="pre codeblock"><code>Block 1       Block 2        Block 3
-------       -------        -------
A  B  C       A  C  B        B  A  C
</code></pre><p>In this example, the index clustering factor for <code class="codeph">col1_idx</code> is higher. The database must read all three blocks in the table to retrieve all rows with the value <code class="codeph">A</code> in <code class="codeph">col1</code>.
                           </p>
                        </div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-5677EA51-E2DD-4562-B44C-336E329D5288__GUID-DF04940D-0FF7-46B8-9F08-ACF75863FF00">
                           <p class="notep1">See Also:</p>
                           <p> <a href="../refrn/DBA_TAB_STATISTICS.html#REFRN23376" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> for a description of the <code class="codeph">DBA_INDEXES</code> view
                           </p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-5D96E789-9297-49F1-B304-FFEA335CF678" title="The index statistics include information about the number of index levels, the number of index blocks, and the relationship between the index and the data blocks. The optimizer uses these statistics to determine the cost of index scans.">Index Statistics</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="TGSQL365"></a><div class="props_rev_3"><a id="GUID-FE339C05-E7A4-4953-89C4-D5C69F0C08BA" name="GUID-FE339C05-E7A4-4953-89C4-D5C69F0C08BA"></a><h4 id="TGSQL-GUID-FE339C05-E7A4-4953-89C4-D5C69F0C08BA" class="sect4"><span class="enumeration_section">10.2.4 </span>System Statistics
                  </h4>
                  <div>
                     <p>The <span class="bold">system statistics</span> describe hardware characteristics such as I/O and CPU performance and utilization. 
                     </p>
                     <p>System statistics enable the query optimizer to more accurately estimate I/O and CPU costs when choosing execution plans. The database does not invalidate previously parsed SQL statements when updating system statistics. The database parses all new SQL statements using new statistics.</p>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-FE339C05-E7A4-4953-89C4-D5C69F0C08BA__GUID-3569065F-3476-45CB-9653-3E17BE692E35">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="q">"<a href="gathering-optimizer-statistics.html#GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31" title="System statistics describe hardware characteristics, such as I/O and CPU performance and utilization, to the optimizer.">Gathering System Statistics Manually</a>"</span></p>
                           </li>
                           <li>
                              <p><a href="../tgdba/measuring-database-performance.html#TGDBA-GUID-3FEB7C53-D5B3-4540-BD67-8FCBB2917695" target="_blank"><span><cite>Oracle Database Reference</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-BE4DF838-0E65-40AE-B69A-94669F30BE7C" title="The optimizer collects statistics on different types of database objects and characteristics of the database environment.">About Optimizer Statistics Types</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL94581"></a><div class="props_rev_3"><a id="GUID-184A744A-2F2F-4C4C-88E6-107EAD1D517E" name="GUID-184A744A-2F2F-4C4C-88E6-107EAD1D517E"></a><h4 id="TGSQL-GUID-184A744A-2F2F-4C4C-88E6-107EAD1D517E" class="sect4"><span class="enumeration_section">10.2.5 </span>User-Defined Optimizer Statistics
                  </h4>
                  <div>
                     <p>The <strong class="term">extensible optimizer</strong> enables authors of user-defined functions and indexes to create statistics collection, selectivity, and cost functions. 
                     </p>
                     <p>The optimizer cost model is extended to integrate information supplied by the user to assess CPU and the I/O cost. Statistics types act as interfaces for user-defined functions that influence the choice of execution plan. However, to use a statistics type, the optimizer requires a mechanism to bind the type to a database object such as a column, standalone function, object type, index, indextype, or package. The SQL statement <a href="../sqlrf/ASSOCIATE-STATISTICS.html#SQLRF01106" target="_blank"><code class="codeph">ASSOCIATE STATISTICS</code></a> allows this binding to occur.
                     </p>
                     <p>Functions for user-defined statistics are relevant for columns that use both standard SQL data types and object types, and for domain indexes. When you associate a statistics type with a column or domain index, the database calls the statistics collection method in the statistics type whenever <code class="codeph">DBMS_STATS</code> gathers statistics.
                     </p>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-184A744A-2F2F-4C4C-88E6-107EAD1D517E__GUID-E44808AE-F2D8-41BA-8517-E099A823ED92">
                        <p class="notep1">See Also:</p>
                        <p><span class="q">"<a href="gathering-optimizer-statistics.html#GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D" title="Use GATHER_TABLE_STATS to collect table statistics, and GATHER_SCHEMA_STATS to collect statistics for all objects in a schema.">Gathering Schema and Table Statistics</a>"</span></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-BE4DF838-0E65-40AE-B69A-94669F30BE7C" title="The optimizer collects statistics on different types of database objects and characteristics of the database environment.">About Optimizer Statistics Types</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL339"></a><div class="props_rev_3"><a id="GUID-3ED2DA31-F61B-4E8F-9166-79FB01392B1D" name="GUID-3ED2DA31-F61B-4E8F-9166-79FB01392B1D"></a><h3 id="TGSQL-GUID-3ED2DA31-F61B-4E8F-9166-79FB01392B1D" class="sect3"><span class="enumeration_section">10.3 </span>How the Database Gathers Optimizer Statistics
               </h3>
               <div>
                  <p>Oracle Database provides several mechanisms to gather statistics.</p>
                  <p>This section contains the following topics:</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-CA59EF6A-66D2-4BF8-B1F9-85EC5CA3C81F">DBMS_STATS Package</a><br>The <code class="codeph">DBMS_STATS</code> PL/SQL package collects and manages optimizer statistics.
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-620CB826-10A2-4937-8DAD-2B41475AE47F">Supplemental Dynamic Statistics</a><br>By default, when optimizer statistics are missing, stale, or insufficient, the database automatically gathers <span class="bold">dynamic statistics</span> during a parse. The database uses <span class="bold">recursive SQL</span> to scan a small random sample of table blocks. 
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-FEEF0915-FE19-4C10-BED0-EB8ED90529A4">Online Statistics Gathering</a><br>In some circumstances, DDL and DML operations automatically trigger online statistics gathering.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-C0E74ACE-2706-48A1-97A2-33F52207166A" title="Oracle Database optimizer statistics describe details about the database and its objects.">Optimizer Statistics Concepts</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL340"></a><div class="props_rev_3"><a id="GUID-CA59EF6A-66D2-4BF8-B1F9-85EC5CA3C81F" name="GUID-CA59EF6A-66D2-4BF8-B1F9-85EC5CA3C81F"></a><h4 id="TGSQL-GUID-CA59EF6A-66D2-4BF8-B1F9-85EC5CA3C81F" class="sect4"><span class="enumeration_section">10.3.1 </span>DBMS_STATS Package
                  </h4>
                  <div>
                     <p>The <code class="codeph">DBMS_STATS</code> PL/SQL package collects and manages optimizer statistics.
                     </p>
                     <p>This package enables you to control what and how statistics are collected, including the degree of parallelism, sampling methods, and granularity of statistics collection in partitioned tables.</p>
                     <div class="infoboxnote" id="GUID-CA59EF6A-66D2-4BF8-B1F9-85EC5CA3C81F__GUID-A89BD918-23C1-401B-849F-F3E65F9CBBB1">
                        <p class="notep1">Note:</p>
                        <p>Do not use the <code class="codeph">COMPUTE</code> and <code class="codeph">ESTIMATE</code> clauses of the <code class="codeph">ANALYZE</code> statement to collect optimizer statistics. These clauses have been deprecated. Instead, use <code class="codeph">DBMS_STATS</code>.
                        </p>
                     </div>
                     <p>Statistics gathered with the <code class="codeph">DBMS_STATS</code> package are required for the creation of accurate execution plans. For example, table statistics gathered by <code class="codeph">DBMS_STATS</code> include the number of rows, number of blocks, and average row length.
                     </p>
                     <p>By default, Oracle Database uses <a href="glossary.html#GUID-0F3149AF-5916-4674-8ED4-FE473C7252CC"><span class="xrefglossterm">automatic optimizer statistics collection</span></a>. In this case, the database automatically runs <code class="codeph">DBMS_STATS</code> to collect optimizer statistics for all schema objects for which statistics are missing or stale. The process eliminates many manual tasks associated with managing the optimizer, and significantly reduces the risks of generating suboptimal execution plans because of missing or stale statistics. You can also update and manage optimizer statistics by manually executing <code class="codeph">DBMS_STATS</code>.
                     </p>
                     <p><span><span>Oracle Database 19c</span> introduces <span>high-frequency automatic optimizer statistics collection</span>. This lightweight task periodically gathers statistics for stale objects. The default interval is 15 minutes. In contrast to the automated statistics collection job, the high-frequency task does not perform actions such as purging statistics for non-existent objects or invoking Optimizer Statistics Advisor.</span> You can set preferences for the high-frequency task using the <code class="codeph">DBMS_STATS.SET_GLOBAL_PREFS</code> procedure, and view metadata using <code class="codeph">DBA_AUTO_STAT_EXECUTIONS</code>.
                     </p>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-CA59EF6A-66D2-4BF8-B1F9-85EC5CA3C81F__GUID-EF6075AA-0C63-4C9A-B83E-9CA8D3EA75BE">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="q">"<a href="gathering-optimizer-statistics.html#GUID-F007E78A-9967-4921-8046-D8F59A9272B4" title="Oracle Database can gather optimizer statistics automatically.">Configuring Automatic Optimizer Statistics Collection</a>"</span></p>
                           </li>
                           <li>
                              <p><span class="q">"<a href="gathering-optimizer-statistics.html#GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" title="As an alternative or supplement to automatic statistics gathering, you can use the DBMS_STATS package to gather optimizer statistics manually.">Gathering Optimizer Statistics Manually</a>"</span></p>
                           </li>
                           <li>
                              <p><a href="../admin/managing-automated-database-maintenance-tasks.html#ADMIN12331" target="_blank"><span><cite>Oracle Database Administrator’s Guide</cite></span></a> to learn more about automated maintenance tasks
                              </p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS059" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about <code class="codeph">DBMS_STATS</code></p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-3ED2DA31-F61B-4E8F-9166-79FB01392B1D" title="Oracle Database provides several mechanisms to gather statistics.">How the Database Gathers Optimizer Statistics</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL341"></a><div class="props_rev_3"><a id="GUID-620CB826-10A2-4937-8DAD-2B41475AE47F" name="GUID-620CB826-10A2-4937-8DAD-2B41475AE47F"></a><h4 id="TGSQL-GUID-620CB826-10A2-4937-8DAD-2B41475AE47F" class="sect4"><span class="enumeration_section">10.3.2 </span>Supplemental Dynamic Statistics
                  </h4>
                  <div>
                     <p>By default, when optimizer statistics are missing, stale, or insufficient, the database automatically gathers <span class="bold">dynamic statistics</span> during a parse. The database uses <span class="bold">recursive SQL</span> to scan a small random sample of table blocks. 
                     </p>
                     <div class="infoboxnote" id="GUID-620CB826-10A2-4937-8DAD-2B41475AE47F__GUID-249594F8-2FD5-4A0A-9B7A-6333620E3FE1">
                        <p class="notep1">Note:</p>
                        <p>Dynamic statistics <span class="italic">augment</span> statistics rather than providing an alternative to them.
                        </p>
                     </div>
                     <p>Dynamic statistics supplement optimizer statistics such as table and index block counts, table and join cardinalities (estimated number of rows), join column statistics, and <code class="codeph">GROUP BY</code> statistics. This information helps the optimizer improve plans by making better estimates for predicate cardinality. 
                     </p>
                     <p>Dynamic statistics are beneficial in the following situations:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>An execution plan is suboptimal because of complex predicates. </p>
                        </li>
                        <li>
                           <p>The sampling time is a small fraction of total execution time for the query.</p>
                        </li>
                        <li>
                           <p>The query executes many times so that the sampling time is amortized.</p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-3ED2DA31-F61B-4E8F-9166-79FB01392B1D" title="Oracle Database provides several mechanisms to gather statistics.">How the Database Gathers Optimizer Statistics</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-FEEF0915-FE19-4C10-BED0-EB8ED90529A4" name="GUID-FEEF0915-FE19-4C10-BED0-EB8ED90529A4"></a><h4 id="TGSQL-GUID-FEEF0915-FE19-4C10-BED0-EB8ED90529A4" class="sect4"><span class="enumeration_section">10.3.3 </span>Online Statistics Gathering
                  </h4>
                  <div>
                     <p>In some circumstances, DDL and DML operations automatically trigger online statistics gathering.</p>
                     <p>This section contains the following topics:</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B">Online Statistics Gathering for Bulk Loads</a><br>The database can gather table and index statistics automatically during the following types of bulk loads: <code class="codeph">INSERT INTO ... SELECT</code> using a direct path insert, and <code class="codeph">CREATE TABLE AS SELECT</code>.
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-EBE36EE3-21E3-4189-ADF9-E4C235AF4234">Online Statistics Gathering for Partition Maintenance Operations</a><br>Oracle Database provides analogous support for online statistics during specific partition maintenance operations.
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-769E609D-0312-43A7-9581-3F3EACF10BA9">Real-Time Statistics</a><br>Starting in <span>Oracle Database 19c</span>, the database automatically gathers <span>real-time statistics</span> during conventional DML operations.
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-3ED2DA31-F61B-4E8F-9166-79FB01392B1D" title="Oracle Database provides several mechanisms to gather statistics.">How the Database Gathers Optimizer Statistics</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL344"></a><div class="props_rev_3"><a id="GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B" name="GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B"></a><h5 id="TGSQL-GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B" class="sect5"><span class="enumeration_section">10.3.3.1 </span>Online Statistics Gathering for Bulk Loads
                     </h5>
                     <div>
                        <p>The database can gather table and index statistics automatically during the following types of bulk loads: <code class="codeph">INSERT INTO ... SELECT</code> using a direct path insert, and <code class="codeph">CREATE TABLE AS SELECT</code>.
                        </p>
                        <p>By default, a parallel insert uses a direct path insert. You can force a direct path insert by using the <code class="codeph">/*+APPEND*/</code> hint.
                        </p>
                        <div class="infoboxnote" id="GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B__GUID-A55B97ED-06D2-4DAA-898C-AFD8806A5DC7">
                           <p class="notep1">Note:</p>
                           <p>In releases prior to <span>Oracle Database 19c</span>, only table statistics were gathered—not index statistics or histograms. In <span>Oracle Database 19c</span>, the database maintains existing histograms but does not create new histograms.
                           </p>
                           <p>In releases prior to <span>Oracle Database 19c</span>, bulk loads only gathered online statistics when the table was empty. Starting in <span>Oracle Database 19c</span>, if the table is not empty, then bulk loads gather statistics when the following conditions are met:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The table preference <code class="codeph">INCREMENTAL</code> is set to <code class="codeph">TRUE</code>. If the table is empty, then this condition is not required.
                                 </p>
                              </li>
                              <li>
                                 <p>For non-partitioned tables, <code class="codeph">INCREMENTAL_LEVEL</code> must be set to <code class="codeph">TABLE</code>.
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <p>This section contains the following topics:</p>
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-2712B321-9BC2-4B64-93BA-C93F23907033">Purpose of Online Statistics Gathering for Bulk Loads</a><br>Data warehouse applications typically load large amounts of data into the database. For example, a sales data warehouse might load data every day, week, or month.
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-0B027A47-087D-4D7B-ABD4-2210D4C37ECB">Global Statistics During Inserts into Partitioned Tables</a><br>When inserting rows into a partitioned table, the database gathers global statistics during the insert. 
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-2DB44BD0-345A-40C7-8787-9FB4F80C6DC8">Histogram Creation After Bulk Loads</a><br>After gathering online statistics, the database does not automatically create histograms.
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-CDDB5A54-0991-4E68-A9D7-2305777B608B">Restrictions for Online Statistics Gathering for Bulk Loads</a><br>Sometimes optimizer statistics gathering does not occur automatically for bulk loads.
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-76103CD0-5566-4E4A-836D-F9D9DECFF36E">User Interface for Online Statistics Gathering for Bulk Loads</a><br>By default, the database gathers statistics during bulk loads.
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B__GUID-9F28BECD-BCF2-468C-8886-F5A1BFAEC21F">
                           <p class="notep1">See Also:</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=DWHSG8382" target="_blank"><span><cite>Oracle Database Data Warehousing Guide</cite></span></a> to learn more about bulk loads
                           </p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-FEEF0915-FE19-4C10-BED0-EB8ED90529A4" title="In some circumstances, DDL and DML operations automatically trigger online statistics gathering.">Online Statistics Gathering</a></p>
                           </div>
                        </div>
                     </div>
                     <a id="TGSQL95244"></a><div class="props_rev_3"><a id="GUID-2712B321-9BC2-4B64-93BA-C93F23907033" name="GUID-2712B321-9BC2-4B64-93BA-C93F23907033"></a><h6 id="TGSQL-GUID-2712B321-9BC2-4B64-93BA-C93F23907033" class="sect6"><span class="enumeration_section">10.3.3.1.1 </span>Purpose of Online Statistics Gathering for Bulk Loads
                        </h6>
                        <div>
                           <p>Data warehouse applications typically load large amounts of data into the database. For example, a sales data warehouse might load data every day, week, or month.</p>
                           <p>In releases earlier than <span>Oracle Database 12c</span>, the best practice was to gather statistics manually after a bulk load. However, many applications did not gather statistics after the load because of negligence or because they waited for the maintenance window to initiate collection. Missing statistics are the leading cause of suboptimal execution plans.
                           </p>
                           <p>Automatic statistics gathering during bulk loads has the following benefits:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Improved performance</p>
                                 <p>Gathering statistics during the load avoids an additional table scan to gather table statistics.</p>
                              </li>
                              <li>
                                 <p>Improved manageability</p>
                                 <p>No user intervention is required to gather statistics after a bulk load.</p>
                              </li>
                           </ul>
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B" title="The database can gather table and index statistics automatically during the following types of bulk loads: INSERT INTO ... SELECT using a direct path insert, and CREATE TABLE AS SELECT.">Online Statistics Gathering for Bulk Loads</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL95245"></a><div class="props_rev_3"><a id="GUID-0B027A47-087D-4D7B-ABD4-2210D4C37ECB" name="GUID-0B027A47-087D-4D7B-ABD4-2210D4C37ECB"></a><h6 id="TGSQL-GUID-0B027A47-087D-4D7B-ABD4-2210D4C37ECB" class="sect6"><span class="enumeration_section">10.3.3.1.2 </span>Global Statistics During Inserts into Partitioned Tables
                        </h6>
                        <div>
                           <p>When inserting rows into a partitioned table, the database gathers global statistics during the insert. </p>
                           <p>For example, if <code class="codeph">sales</code> is a partitioned table, and if you run <code class="codeph">INSERT INTO sales SELECT</code>, then the database gathers global statistics. However, the database does not gather partition-level statistics.
                           </p>
                           <p>Assume a different case in which you use partition-extended syntax to insert rows into a specific partition or subpartition. The database gathers statistics on the partition during the insert. However, the database does not gather global statistics.</p>
                           <p>Assume that you run <code class="codeph">INSERT INTO sales PARTITION (sales_q4_2000) SELECT</code>. The database gathers statistics during the insert. If the <code class="codeph">INCREMENTAL</code> preference is enabled for <code class="codeph">sales</code>, then the database also gathers a <a href="glossary.html#GUID-8F1BBA0D-2424-4D78-8DC7-1D8C19FA7C1F"><span class="xrefglossterm">synopsis</span></a> for <code class="codeph">sales_q4_2000</code>. Statistics are immediately available after the insert. However, if you roll back the transaction, then the database automatically deletes statistics gathered during the bulk load.
                           </p>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-0B027A47-087D-4D7B-ABD4-2210D4C37ECB__GUID-B88A1428-AAB9-4F71-B5DD-39F327F3E2D6">
                              <p class="notep1">See Also:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><span class="q">"<a href="gathering-optimizer-statistics.html#GUID-C4BFFEEB-28D2-420C-A864-305C4334183B" title="Enabling incremental statistics maintenance has several consequences.">Considerations for Incremental Statistics Maintenance</a>"</span></p>
                                 </li>
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=SQLRF01604" target="_blank"><span><cite>Oracle Database SQL Language Reference</cite></span></a> for <code class="codeph">INSERT</code> syntax and semantics
                                    </p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B" title="The database can gather table and index statistics automatically during the following types of bulk loads: INSERT INTO ... SELECT using a direct path insert, and CREATE TABLE AS SELECT.">Online Statistics Gathering for Bulk Loads</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL95246"></a><div class="props_rev_3"><a id="GUID-2DB44BD0-345A-40C7-8787-9FB4F80C6DC8" name="GUID-2DB44BD0-345A-40C7-8787-9FB4F80C6DC8"></a><h6 id="TGSQL-GUID-2DB44BD0-345A-40C7-8787-9FB4F80C6DC8" class="sect6"><span class="enumeration_section">10.3.3.1.3 </span>Histogram Creation After Bulk Loads
                        </h6>
                        <div>
                           <p>After gathering online statistics, the database does not automatically create histograms.</p>
                           <p>If histograms are required, then after the bulk load Oracle recommends running <code class="codeph">DBMS_STATS.GATHER_TABLE_STATS</code> with <code class="codeph">options=&gt;GATHER AUTO</code>. For example, the following program gathers statistics for the <code class="codeph">myt</code> table:
                           </p><pre class="pre codeblock"><code>EXEC DBMS_STATS.GATHER_TABLE_STATS(user, 'MYT', options=&gt;'GATHER AUTO');
</code></pre><p>The preceding PL/SQL program only gathers missing or stale statistics. The database does not gather table and basic column statistics collected during the bulk load.</p>
                           <div class="infoboxnote" id="GUID-2DB44BD0-345A-40C7-8787-9FB4F80C6DC8__GUID-4E200DE3-1046-48C0-9532-3E051D11ADFD">
                              <p class="notep1">Note:</p>
                              <p>You can set the table preference <code class="codeph">options</code> to <code class="codeph">GATHER AUTO</code> on the tables that you plan to bulk load. In this way, you need not explicitly set the <code class="codeph">options</code> parameter when running <code class="codeph">GATHER_TABLE_STATS</code>.
                              </p>
                           </div>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-2DB44BD0-345A-40C7-8787-9FB4F80C6DC8__GUID-E44EDC1D-6D37-4B3F-8C6E-B17C6848CAEE">
                              <p class="notep1">See Also:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><span class="q">"<a href="gathering-optimizer-statistics.html#GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D" title="Use GATHER_TABLE_STATS to collect table statistics, and GATHER_SCHEMA_STATS to collect statistics for all objects in a schema.">Gathering Schema and Table Statistics</a>"</span></p>
                                 </li>
                                 <li>
                                    <p><a href="../dwhsg/loading-transformation-date-warehouses.html#DWHSG-GUID-0C48B004-54C8-48A3-BBF8-6C69BB19F15E" target="_blank"><span><cite>Oracle Database Data Warehousing Guide</cite></span></a> to learn more about bulk loads
                                    </p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B" title="The database can gather table and index statistics automatically during the following types of bulk loads: INSERT INTO ... SELECT using a direct path insert, and CREATE TABLE AS SELECT.">Online Statistics Gathering for Bulk Loads</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL95247"></a><div class="props_rev_3"><a id="GUID-CDDB5A54-0991-4E68-A9D7-2305777B608B" name="GUID-CDDB5A54-0991-4E68-A9D7-2305777B608B"></a><h6 id="TGSQL-GUID-CDDB5A54-0991-4E68-A9D7-2305777B608B" class="sect6"><span class="enumeration_section">10.3.3.1.4 </span>Restrictions for Online Statistics Gathering for Bulk Loads
                        </h6>
                        <div>
                           <p>Sometimes optimizer statistics gathering does not occur automatically for bulk loads.</p>
                           <p>Specifically, bulk loads do <span class="italic">not</span> gather statistics automatically when any of the following conditions applies to the target table, partition, or subpartition:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>It is in an Oracle-owned schema such as <code class="codeph">SYS</code>.
                                 </p>
                              </li>
                              <li>
                                 <p>It is one of the following types of tables: nested table, index-organized table (IOT), external table, or global temporary table defined as <code class="codeph">ON COMMIT DELETE ROWS</code>.
                                 </p>
                                 <div class="infoboxnote" id="GUID-CDDB5A54-0991-4E68-A9D7-2305777B608B__GUID-B6243B61-6426-4B4D-9B59-7B28ED3501BB">
                                    <p class="notep1">Note:</p>
                                    <p>The database <span class="italic">does</span> gather online statistics automatically for the <span class="italic">internal</span> partitions of a <a href="glossary.html#GUID-9BAA7917-D479-4DCF-85B2-5B4BE0F891EE"><span class="xrefglossterm">hybrid partitioned table</span></a>.
                                    </p>
                                 </div>
                              </li>
                              <li>
                                 <p>It has a <code class="codeph">PUBLISH</code> preference set to <code class="codeph">FALSE</code>.
                                 </p>
                              </li>
                              <li>
                                 <p>Its statistics are locked.</p>
                              </li>
                              <li>
                                 <p>It is loaded using a multitable <code class="codeph">INSERT</code> statement.
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-CDDB5A54-0991-4E68-A9D7-2305777B608B__GUID-570CBCFA-87F1-4F28-BA9F-3DC0C3B092A0">
                              <p class="notep1">See Also:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><span class="q">"<a href="gathering-optimizer-statistics.html#GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D" title="Use GATHER_TABLE_STATS to collect table statistics, and GATHER_SCHEMA_STATS to collect statistics for all objects in a schema.">Gathering Schema and Table Statistics</a>"</span></p>
                                 </li>
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS-GUID-CDAA4742-5398-4A64-B871-E39F38D0021F" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about <code class="codeph">DBMS_STATS.SET_TABLE_PREFS</code></p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B" title="The database can gather table and index statistics automatically during the following types of bulk loads: INSERT INTO ... SELECT using a direct path insert, and CREATE TABLE AS SELECT.">Online Statistics Gathering for Bulk Loads</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL95248"></a><div class="props_rev_3"><a id="GUID-76103CD0-5566-4E4A-836D-F9D9DECFF36E" name="GUID-76103CD0-5566-4E4A-836D-F9D9DECFF36E"></a><h6 id="TGSQL-GUID-76103CD0-5566-4E4A-836D-F9D9DECFF36E" class="sect6"><span class="enumeration_section">10.3.3.1.5 </span>User Interface for Online Statistics Gathering for Bulk Loads
                        </h6>
                        <div>
                           <p>By default, the database gathers statistics during bulk loads.</p>
                           <p>You can enable the feature at the statement level by using the <code class="codeph">GATHER_OPTIMIZER_STATISTICS</code> hint. You can disable the feature at the statement level by using the <code class="codeph">NO_GATHER_OPTIMIZER_STATISTICS</code> hint. For example, the following statement disables online statistics gathering for bulk loads:
                           </p><pre class="pre codeblock"><code>CREATE TABLE employees2 AS
  SELECT /*+NO_GATHER_OPTIMIZER_STATISTICS*/ * FROM employees</code></pre></div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-76103CD0-5566-4E4A-836D-F9D9DECFF36E__GUID-FC92718C-28FE-4881-B519-BD4310966BE7">
                              <p class="notep1">See Also:</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=SQLRF56406" target="_blank"><span><cite>Oracle Database SQL Language Reference</cite></span></a> to learn about the <code class="codeph">GATHER_OPTIMIZER_STATISTICS</code> and <code class="codeph">NO_GATHER_OPTIMIZER_STATISTICS</code> hints
                              </p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B" title="The database can gather table and index statistics automatically during the following types of bulk loads: INSERT INTO ... SELECT using a direct path insert, and CREATE TABLE AS SELECT.">Online Statistics Gathering for Bulk Loads</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-EBE36EE3-21E3-4189-ADF9-E4C235AF4234" name="GUID-EBE36EE3-21E3-4189-ADF9-E4C235AF4234"></a><h5 id="TGSQL-GUID-EBE36EE3-21E3-4189-ADF9-E4C235AF4234" class="sect5"><span class="enumeration_section">10.3.3.2 </span>Online Statistics Gathering for Partition Maintenance Operations
                     </h5>
                     <div>
                        <p>Oracle Database provides analogous support for online statistics during specific partition maintenance operations.</p>
                        <p>Specifically, the database maintains the following:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Global statistics for partition exchange operations. These statistics include basic statistics, the synopsis, and histograms. After the exchange, the global statistics are an aggregate of the statistics for the incoming table and the statistics for the destination table.</p>
                           </li>
                           <li>
                              <p>Global and partition-level statistics, including incremental statistics, for the following partition operations:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><code class="codeph">MOVE</code></p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">MERGE</code></p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">COALESCE</code></p>
                                 </li>
                              </ul>
                              <p>The database does not maintain partition-level statistics for maintenance operations that have multiple destination segments.</p>
                           </li>
                        </ul>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-EBE36EE3-21E3-4189-ADF9-E4C235AF4234__GUID-C490987D-65D8-47D3-9755-FAD7D3C45D8E">
                           <p class="notep1">See Also:</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=GUID-A226B597-BCF1-49E2-8284-739A99D3F9ED" target="_blank"><span><cite>Oracle Database VLDB and Partitioning Guide</cite></span></a> to learn more about partition maintenance operations
                           </p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-FEEF0915-FE19-4C10-BED0-EB8ED90529A4" title="In some circumstances, DDL and DML operations automatically trigger online statistics gathering.">Online Statistics Gathering</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-769E609D-0312-43A7-9581-3F3EACF10BA9" name="GUID-769E609D-0312-43A7-9581-3F3EACF10BA9"></a><h5 id="TGSQL-GUID-769E609D-0312-43A7-9581-3F3EACF10BA9" class="sect5"><span class="enumeration_section">10.3.3.3 </span><span>Real-Time Statistics</span></h5>
                     <div>
                        <p>Starting in <span>Oracle Database 19c</span>, the database automatically gathers <span>real-time statistics</span> during conventional DML operations.
                        </p>
                        <p>This section contains the following topics:</p>
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-D98D891C-0D07-4902-BA1B-8231447ADA22">Purpose of Real-Time Statistics</a><br>Online statistics, whether for bulk loads or conventional DML, aim to reduce the possibility of the optimizer being misled by stale statistics.
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-972CC658-D615-4071-86BB-371D43D9CF95">How Real-Time Statistics Work</a><br>When a DML operation is currently modifying a table, Oracle Database dynamically computes values for the most essential statistics.
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-5AD8A9CF-36FB-4756-B7CE-9B8320FB860C">User Interface for Real-Time Statistics</a><br>You can use manage and access <span>real-time statistics</span> through PL/SQL packages, data dictionary views, and hints.
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-D55D673B-1FD9-45C9-A109-F440B7E96E62">Real-Time Statistics: Example</a><br>In this example, a conventional <code class="codeph">INSERT</code> statement triggers the collection of <span>real-time statistics</span>.
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-769E609D-0312-43A7-9581-3F3EACF10BA9__GUID-2884B0A5-E1BA-4B9A-925F-0201A77A6BEE">
                           <p class="notep1">See Also:</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=%20DBLIC-GUID-0F9EB85D-4610-4EDF-89C2-4916A0E7AC87" target="_blank"><span><cite>Oracle Database Licensing Information User Manual</cite></span></a> for details on which features are supported for different editions and services
                           </p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-FEEF0915-FE19-4C10-BED0-EB8ED90529A4" title="In some circumstances, DDL and DML operations automatically trigger online statistics gathering.">Online Statistics Gathering</a></p>
                           </div>
                        </div>
                     </div>
                     
                     <div class="sect5"><a id="GUID-D98D891C-0D07-4902-BA1B-8231447ADA22" name="GUID-D98D891C-0D07-4902-BA1B-8231447ADA22"></a><h6 id="TGSQL-GUID-D98D891C-0D07-4902-BA1B-8231447ADA22" class="sect6"><span class="enumeration_section">10.3.3.3.1 </span>Purpose of <span>Real-Time Statistics</span></h6>
                        <div>
                           <p>Online statistics, whether for bulk loads or conventional DML, aim to reduce the possibility of the optimizer being misled by stale statistics.</p>
                           <p><span>Oracle Database 12c</span> introduced online statistics gathering for <code class="codeph">CREATE TABLE AS SELECT</code> statements and direct-path inserts. <span>Oracle Database 19c</span> introduces <span>real-time statistics</span>, which extend online support to conventional DML statements. Because statistics can go stale between <code class="codeph">DBMS_STATS</code> jobs, <span>real-time statistics</span> helps the optimizer generate more optimal plans.
                           </p>
                           <p>Whereas bulk load operations gather all necessary statistics, <span>real-time statistics</span> <span class="italic">augment</span> rather than replace traditional statistics. For this reason, you must continue to gather statistics regularly using <code class="codeph">DBMS_STATS</code>, preferably using the AutoTask job.
                           </p>
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-769E609D-0312-43A7-9581-3F3EACF10BA9" title="Starting in Oracle Database 19c, the database automatically gathers real-time statistics during conventional DML operations.">Real-Time Statistics</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-972CC658-D615-4071-86BB-371D43D9CF95" name="GUID-972CC658-D615-4071-86BB-371D43D9CF95"></a><h6 id="TGSQL-GUID-972CC658-D615-4071-86BB-371D43D9CF95" class="sect6"><span class="enumeration_section">10.3.3.3.2 </span>How <span>Real-Time Statistics</span> Work
                        </h6>
                        <div>
                           <p>When a DML operation is currently modifying a table, Oracle Database dynamically computes values for the most essential statistics.</p>
                           <p>Consider a scenario in which a transaction is currently adding tens of thousands of rows to the <code class="codeph">oe.orders</code> table. <span>Real-time statistics</span> keep track of the increasing row count as rows are being inserted. If the optimizer performs a hard parse of a new query, then the optimizer can use the <span>real-time statistics</span> to obtain a more accurate cost estimate.
                           </p>
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-769E609D-0312-43A7-9581-3F3EACF10BA9" title="Starting in Oracle Database 19c, the database automatically gathers real-time statistics during conventional DML operations.">Real-Time Statistics</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-5AD8A9CF-36FB-4756-B7CE-9B8320FB860C" name="GUID-5AD8A9CF-36FB-4756-B7CE-9B8320FB860C"></a><h6 id="TGSQL-GUID-5AD8A9CF-36FB-4756-B7CE-9B8320FB860C" class="sect6"><span class="enumeration_section">10.3.3.3.3 </span>User Interface for <span>Real-Time Statistics</span></h6>
                        <div>
                           <p>You can use manage and access <span>real-time statistics</span> through PL/SQL packages, data dictionary views, and hints.
                           </p>
                           <div class="section">
                              <p class="subhead3" id="GUID-5AD8A9CF-36FB-4756-B7CE-9B8320FB860C__GUID-6BBEE65F-D022-4612-93E1-D11EC103D9A3">DBMS_STATS</p>
                              <p>By default, <code class="codeph">DBMS_STATS</code> subprograms include <span>real-time statistics</span>. You can also specify parameters to include only these statistics.
                              </p>
                              <div class="tblformal" id="GUID-5AD8A9CF-36FB-4756-B7CE-9B8320FB860C__GUID-0697CB5B-F10B-4BDC-9E88-3A3D6F4C1A83">
                                 <p class="titleintable">Table 10-3 Subprograms for <span>Real-Time Statistics</span></p>
                                 <table cellpadding="4" cellspacing="0" class="Formal" title="Subprograms for Real-Time Statistics" summary="These subprograms enables you to manage real-time statistics." frame="hsides" border="1" rules="rows">
                                    <thead>
                                       <tr align="left" valign="top">
                                          <th align="left" valign="bottom" id="d60325e5695">Subprogram</th>
                                          <th align="left" valign="bottom" id="d60325e5697">Description</th>
                                       </tr>
                                    </thead>
                                    <tbody>
                                       <tr align="left" valign="top">
                                          <td align="left" valign="top" id="d60325e5701" headers="d60325e5695 ">
                                             <p><code class="codeph">EXPORT_TABLE_STATS</code> and <code class="codeph">EXPORT_SCHEMA_STATS</code></p>
                                          </td>
                                          <td align="left" valign="top" headers="d60325e5701 d60325e5697 ">
                                             <p>These subprograms enable you to export statistics. By default, the <code class="codeph">stat_category</code> parameter includes <span>real-time statistics</span>. The <code class="codeph">REALTIME_STATS</code> value specifies only <span>real-time statistics</span>.
                                             </p>
                                          </td>
                                       </tr>
                                       <tr align="left" valign="top">
                                          <td align="left" valign="top" id="d60325e5724" headers="d60325e5695 ">
                                             <p><code class="codeph">IMPORT_TABLE_STATS</code> and <code class="codeph">IMPORT_SCHEMA_STATS</code></p>
                                          </td>
                                          <td align="left" valign="top" headers="d60325e5724 d60325e5697 ">
                                             <p>These subprograms enable you to import statistics. By default, the <code class="codeph">stat_category</code> parameter includes <span>real-time statistics</span>. The <code class="codeph">REALTIME_STATS</code> value specifies only <span>real-time statistics</span>.
                                             </p>
                                          </td>
                                       </tr>
                                       <tr align="left" valign="top">
                                          <td align="left" valign="top" id="d60325e5747" headers="d60325e5695 ">
                                             <p><code class="codeph">DELETE_TABLE_STATS</code> and <code class="codeph">DELETE_SCHEMA_STATS</code></p>
                                          </td>
                                          <td align="left" valign="top" headers="d60325e5747 d60325e5697 ">
                                             <p>These subprograms enable you to delete statistics. By default, the <code class="codeph">stat_category</code> parameter includes <span>real-time statistics</span>. The <code class="codeph">REALTIME_STATS</code> value specifies only <span>real-time statistics</span>.
                                             </p>
                                          </td>
                                       </tr>
                                       <tr align="left" valign="top">
                                          <td align="left" valign="top" id="d60325e5770" headers="d60325e5695 ">
                                             <p><code class="codeph">DIFF_TABLE_STATS_IN_STATTAB</code></p>
                                          </td>
                                          <td align="left" valign="top" headers="d60325e5770 d60325e5697 ">
                                             <p>This function compares table statistics from two sources. The statistics always include <span>real-time statistics</span>.
                                             </p>
                                          </td>
                                       </tr>
                                       <tr align="left" valign="top">
                                          <td align="left" valign="top" id="d60325e5781" headers="d60325e5695 ">
                                             <p><code class="codeph">DIFF_TABLE_STATS_IN_HISTORY</code></p>
                                          </td>
                                          <td align="left" valign="top" headers="d60325e5781 d60325e5697 ">
                                             <p>This function compares statistics for a table as of two specified timestamps. The statistics always include <span>real-time statistics</span>.
                                             </p>
                                          </td>
                                       </tr>
                                    </tbody>
                                 </table>
                              </div>
                              <!-- class="inftblhruleinformal" -->
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3" id="GUID-5AD8A9CF-36FB-4756-B7CE-9B8320FB860C__GUID-A788416F-D1D5-44B4-B4C8-7D0344B133A5">Views</p>
                              <p>If <span>real-time statistics</span> are available, then you can access them using the views in the following table. Note that partition-level statistics are not supported, so the only table-level views show <span>real-time statistics</span>. The <code class="codeph">DBA_*</code> views have <code class="codeph">ALL_*</code> and <code class="codeph">USER_*</code> versions.
                              </p>
                              <div class="tblformal" id="GUID-5AD8A9CF-36FB-4756-B7CE-9B8320FB860C__GUID-944611C3-9BF5-42D2-BC5A-84E4164C11B1">
                                 <p class="titleintable">Table 10-4 Views for <span>Real-Time Statistics</span></p>
                                 <table cellpadding="4" cellspacing="0" class="Formal" title="Views for Real-Time Statistics" summary="Describes the views that show real-time statistics: DBA_TAB_COL_STATISTICS and DBA_TAB_STATISTICS." frame="hsides" border="1" rules="rows">
                                    <thead>
                                       <tr align="left" valign="top">
                                          <th align="left" valign="bottom" width="20%" id="d60325e5826">View</th>
                                          <th align="left" valign="bottom" width="20%" id="d60325e5828">Description</th>
                                       </tr>
                                    </thead>
                                    <tbody>
                                       <tr align="left" valign="top">
                                          <td align="left" valign="top" width="20%" id="d60325e5832" headers="d60325e5826 ">
                                             <p><code class="codeph">DBA_TAB_COL_STATISTICS</code></p>
                                          </td>
                                          <td align="left" valign="top" width="20%" headers="d60325e5832 d60325e5828 ">
                                             <p>This view displays column statistics and histogram information extracted from <code class="codeph">DBA_TAB_COLUMNS</code>. <span>Real-time statistics are indicated by <code class="codeph">STATS_ON_CONVENTIONAL_DML</code> in the <code class="codeph">NOTES</code> column and <code class="codeph">SHARED</code> in the <code class="codeph">SCOPE</code> column.</span></p>
                                          </td>
                                       </tr>
                                       <tr align="left" valign="top">
                                          <td align="left" valign="top" width="20%" id="d60325e5857" headers="d60325e5826 ">
                                             <p><code class="codeph">DBA_TAB_STATISTICS</code></p>
                                          </td>
                                          <td align="left" valign="top" width="20%" headers="d60325e5857 d60325e5828 ">
                                             <p>This view displays optimizer statistics for the tables accessible to the current user. <span>Real-time statistics are indicated by <code class="codeph">STATS_ON_CONVENTIONAL_DML</code> in the <code class="codeph">NOTES</code> column and <code class="codeph">SHARED</code> in the <code class="codeph">SCOPE</code> column.</span></p>
                                          </td>
                                       </tr>
                                    </tbody>
                                 </table>
                              </div>
                              <!-- class="inftblhruleinformal" -->
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3" id="GUID-5AD8A9CF-36FB-4756-B7CE-9B8320FB860C__GUID-01FE48B3-22B3-4578-9F52-99B59BAA47DB">Hints</p>
                              <p>The <code class="codeph">NO_GATHER_OPTIMIZER_STATISTICS</code> hint prevents the collection of <span>real-time statistics</span>.
                              </p>
                           </div>
                           <!-- class="section" -->
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-5AD8A9CF-36FB-4756-B7CE-9B8320FB860C__GUID-9CE830AD-4605-4C9D-A475-593BAFBFD71E">
                              <p class="notep1">See Also:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><span class="q">"<a href="transporting-optimizer-statistics.html#GUID-7F8EE1CC-A173-4B87-AA2E-CD22198EF4F8" title="You can export and import optimizer statistics from the data dictionary to user-defined statistics tables. You can also copy statistics from one database to another database.">Importing and Exporting Optimizer Statistics</a>"</span></p>
                                 </li>
                                 <li>
                                    <p><a href="../arpls/DBMS_STATS.html#GUID-B930CE9B-7461-4691-8AA9-7E424C3C2C8C" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about <code class="codeph">DBMS_STATS</code> subprograms
                                    </p>
                                 </li>
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=GUID-40AC6263-089D-4471-B2E2-EBCA15BC4C65" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">ALL_TAB_COL_STATISTICS</code> view
                                    </p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-769E609D-0312-43A7-9581-3F3EACF10BA9" title="Starting in Oracle Database 19c, the database automatically gathers real-time statistics during conventional DML operations.">Real-Time Statistics</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-D55D673B-1FD9-45C9-A109-F440B7E96E62" name="GUID-D55D673B-1FD9-45C9-A109-F440B7E96E62"></a><h6 id="TGSQL-GUID-D55D673B-1FD9-45C9-A109-F440B7E96E62" class="sect6"><span class="enumeration_section">10.3.3.3.4 </span><span>Real-Time Statistics</span>: Example
                        </h6>
                        <div>
                           <p>In this example, a conventional <code class="codeph">INSERT</code> statement triggers the collection of <span>real-time statistics</span>.
                           </p>
                           <div class="example" id="GUID-D55D673B-1FD9-45C9-A109-F440B7E96E62__GUID-4C57FD9A-1D78-4C52-9207-7CD3C8272212">
                              <p>This example assumes that the <code class="codeph">sh</code> user has been granted the DBA role, and you have logged in to the database as <code class="codeph">sh</code>. You perform the following steps:
                              </p>
                              <ol>
                                 <li>
                                    <p>Gather statistics for the <code class="codeph">sales</code> table:
                                    </p><pre class="pre codeblock"><code>BEGIN
 DBMS_STATS.GATHER_TABLE_STATS('SH', 'SALES', METHOD_OPT=&gt;'FOR ALL COLUMNS SIZE 2');
END;
/</code></pre></li>
                                 <li>
                                    <p>Query the column-level statistics for <code class="codeph">sales</code>:
                                    </p><pre class="pre codeblock"><code>SET PAGESIZE 5000
SET LINESIZE 200
COL COLUMN_NAME FORMAT a13 
COL LOW_VALUE FORMAT a14
COL HIGH_VALUE FORMAT a14
COL NOTES FORMAT a5
COL PARTITION_NAME FORMAT a13

SELECT COLUMN_NAME, LOW_VALUE, HIGH_VALUE, SAMPLE_SIZE, NOTES
FROM   USER_TAB_COL_STATISTICS
WHERE  TABLE_NAME = 'SALES'
ORDER BY 1, 5;</code></pre><p>The <code class="codeph">Notes</code> fields are blank, meaning that <span>real-time statistics</span> have not been gathered:
                                    </p><pre class="pre codeblock"><code>COLUMN_NAME   LOW_VALUE      HIGH_VALUE     SAMPLE_SIZE NOTES
------------- -------------- -------------- ----------- -----
AMOUNT_SOLD   C10729         C2125349              5594
CHANNEL_ID    C103           C10A                918843
CUST_ID       C103           C30B0B                5595
PROD_ID       C10E           C20231                5593
PROMO_ID      C122           C20A64              918843
QUANTITY_SOLD C102           C102                  5593
TIME_ID       77C60101010101 78650C1F010101        5593

7 rows selected.
</code></pre></li>
                                 <li>
                                    <p>Query the table-level statistics for <code class="codeph">sales</code>:
                                    </p><pre class="pre codeblock"><code>SELECT NVL(PARTITION_NAME, 'GLOBAL') PARTITION_NAME, NUM_ROWS, BLOCKS, NOTES 
FROM   USER_TAB_STATISTICS
WHERE  TABLE_NAME = 'SALES'
ORDER BY 1, 4;</code></pre><p>The <code class="codeph">Notes</code> fields are blank, meaning that <span>real-time statistics</span> have not been gathered:
                                    </p><pre class="pre codeblock"><code>PARTITION_NAM   NUM_ROWS     BLOCKS NOTES
------------- ---------- ---------- -----
GLOBAL            918843       3315
SALES_1995             0          0
SALES_1996             0          0
SALES_H1_1997          0          0
SALES_H2_1997          0          0
SALES_Q1_1998      43687        162
SALES_Q1_1999      64186        227
SALES_Q1_2000      62197        222
SALES_Q1_2001      60608        222
SALES_Q1_2002          0          0
SALES_Q1_2003          0          0
SALES_Q2_1998      35758        132
SALES_Q2_1999      54233        187
SALES_Q2_2000      55515        197
SALES_Q2_2001      63292        227
SALES_Q2_2002          0          0
SALES_Q2_2003          0          0
SALES_Q3_1998      50515        182
SALES_Q3_1999      67138        232
SALES_Q3_2000      58950        212
SALES_Q3_2001      65769        242
SALES_Q3_2002          0          0
SALES_Q3_2003          0          0
SALES_Q4_1998      48874        192
SALES_Q4_1999      62388        217
SALES_Q4_2000      55984        202
SALES_Q4_2001      69749        260
SALES_Q4_2002          0          0
SALES_Q4_2003          0          0

29 rows selected.
</code></pre></li>
                                 <li>
                                    <p>Load 918,843 rows into <code class="codeph">sales</code> by using a conventional <code class="codeph">INSERT</code> statement:
                                    </p><pre class="pre codeblock"><code>INSERT INTO sales(prod_id, cust_id, time_id, channel_id, promo_id, 
                  quantity_sold, amount_sold)
  SELECT prod_id, cust_id, time_id, channel_id, promo_id, 
         quantity_sold * 2, amount_sold * 2 
  FROM   sales;
COMMIT;</code></pre></li>
                                 <li>
                                    <p>Obtain the execution plan from the cursor:</p><pre class="pre codeblock"><code>SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR(format=&gt;'TYPICAL'));</code></pre><p>The following plan shows <code class="codeph">LOAD TABLE CONVENTIONAL</code> in Step 1, which means that the database gathered <span>real-time statistics</span> while performing the insert:
                                    </p><pre class="pre codeblock"><code>
---------------------------------------------------------------------------------------
|Id| Operation                        | Name|Rows|Bytes|Cost (%CPU)|Time| Pstart|Pstop|
---------------------------------------------------------------------------------------
| 0| INSERT STATEMENT                 |     |    |     |910 (100)|        |     |     |
| 1|  <span class="bold">LOAD TABLE CONVENTIONAL</span>         |SALES|    |     |         |        |     |     |
| 2|   OPTIMIZER STATISTICS GATHERING |     |918K|  25M|910   (2)|00:00:01|     |     |
| 3|    PARTITION RANGE ALL           |     |918K|  25M|910   (2)|00:00:01|   1 |  28 |
| 4|     TABLE ACCESS FULL            |SALES|918K|  25M|910   (2)|00:00:01|   1 |  28 |
---------------------------------------------------------------------------------------</code></pre></li>
                                 <li>
                                    <p>Query the column-level statistics for <code class="codeph">sales</code>.
                                    </p><pre class="pre codeblock"><code>SET PAGESIZE 5000
SET LINESIZE 200
COL COLUMN_NAME FORMAT a13 
COL LOW_VALUE FORMAT a14
COL HIGH_VALUE FORMAT a14
COL NOTES FORMAT a25
COL PARTITION_NAME FORMAT a13

SELECT COLUMN_NAME, LOW_VALUE, HIGH_VALUE, SAMPLE_SIZE, NOTES
FROM   USER_TAB_COL_STATISTICS
WHERE  TABLE_NAME = 'SALES'
ORDER BY 1, 5;</code></pre><p>Now the <code class="codeph">Notes</code> fields show <code class="codeph">STATS_ON_CONVENTIONAL_DML</code>, meaning that the database gathered <span>real-time statistics</span> during the insert:
                                    </p><pre class="pre codeblock"><code>COLUMN_NAME   LOW_VALUE      HIGH_VALUE     SAMPLE_SIZE NOTES
------------- -------------- -------------- ----------- -------------------------
AMOUNT_SOLD   C10729         C224422D              9073 STATS_ON_CONVENTIONAL_DML
AMOUNT_SOLD   C10729         C2125349              5702
CHANNEL_ID    C103           C10A                  9073 STATS_ON_CONVENTIONAL_DML
CHANNEL_ID    C103           C10A                918843
CUST_ID       C103           C30B0B                9073 STATS_ON_CONVENTIONAL_DML
CUST_ID       C103           C30B0B                5702
PROD_ID       C10E           C20231                9073 STATS_ON_CONVENTIONAL_DML
PROD_ID       C10E           C20231                5701
PROMO_ID      C122           C20A64                9073 STATS_ON_CONVENTIONAL_DML
PROMO_ID      C122           C20A64              918843
QUANTITY_SOLD C102           C103                  9073 STATS_ON_CONVENTIONAL_DML
QUANTITY_SOLD C102           C102                  5701
TIME_ID       77C60101010101 78650C1F010101        9073 STATS_ON_CONVENTIONAL_DML
TIME_ID       77C60101010101 78650C1F010101        5701</code></pre><p>The sample size is 9073, which is roughly 1% of the 918,843 rows inserted. In <code class="codeph">QUANTITY_SOLD</code> and <code class="codeph">AMOUNT_SOLD</code>, the high and low values combine the manually gathered statistics and the <span>real-time statistics</span>.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Force the database to write optimizer statistics to the data dictionary.</p><pre class="pre codeblock"><code>EXEC DBMS_STATS.FLUSH_DATABASE_MONITORING_INFO;</code></pre></li>
                                 <li>
                                    <p>Query the table-level statistics for <code class="codeph">sales</code>.
                                    </p><pre class="pre codeblock"><code>SELECT NVL(PARTITION_NAME, 'GLOBAL') PARTITION_NAME, NUM_ROWS, BLOCKS, NOTES 
FROM   USER_TAB_STATISTICS
WHERE  TABLE_NAME = 'SALES'
ORDER BY 1, 4;</code></pre><p>The <code class="codeph">Notes</code> field shows that <span>real-time statistics</span> have been gathered at the global level, showing the number of rows as 1,837,686:
                                    </p><pre class="pre codeblock"><code>PARTITION_NAM   NUM_ROWS     BLOCKS NOTES
------------- ---------- ---------- -------------------------
GLOBAL           1837686       3315 STATS_ON_CONVENTIONAL_DML
GLOBAL            918843       3315
SALES_1995             0          0
SALES_1996             0          0
SALES_H1_1997          0          0
SALES_H2_1997          0          0
SALES_Q1_1998      43687        162
SALES_Q1_1999      64186        227
SALES_Q1_2000      62197        222
SALES_Q1_2001      60608        222
SALES_Q1_2002          0          0
SALES_Q1_2003          0          0
SALES_Q2_1998      35758        132
SALES_Q2_1999      54233        187
SALES_Q2_2000      55515        197
SALES_Q2_2001      63292        227
SALES_Q2_2002          0          0
SALES_Q2_2003          0          0
SALES_Q3_1998      50515        182
SALES_Q3_1999      67138        232
SALES_Q3_2000      58950        212
SALES_Q3_2001      65769        242
SALES_Q3_2002          0          0
SALES_Q3_2003          0          0
SALES_Q4_1998      48874        192
SALES_Q4_1999      62388        217
SALES_Q4_2000      55984        202
SALES_Q4_2001      69749        260
SALES_Q4_2002          0          0
SALES_Q4_2003          0          0</code></pre></li>
                                 <li>
                                    <p>Query the <code class="codeph">quantity_sold</code> column:
                                    </p><pre class="pre codeblock"><code>SELECT COUNT(*) FROM sales WHERE quantity_sold &gt; 50;
</code></pre></li>
                                 <li>
                                    <p>Obtain the execution plan from the cursor:</p><pre class="pre codeblock"><code>SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR(format=&gt;'TYPICAL'));</code></pre><p>The <code class="codeph">Note</code> field shows that the query used the <span>real-time statistics</span>.
                                    </p><pre class="pre codeblock"><code>Plan hash value: 3519235612

------------------------------------------------------------------------
|Id| Operation           |Name|Rows|Bytes|Cost (%CPU)|Time|Pstart|Pstop|
------------------------------------------------------------------------
| 0| SELECT STATEMENT     |       |    |   |921 (100)|        |   |    |
| 1|  SORT AGGREGATE      |       |   1|  3|         |        |   |    |
| 2|   PARTITION RANGE ALL|       |   1|  3|921   (3)|00:00:01| 1 | 28 |
|*3|    TABLE ACCESS FULL | SALES |   1|  3|921   (3)|00:00:01| 1 | 28 |
------------------------------------------------------------------------

Predicate Information (identified by operation id):
---------------------------------------------------

   3 - filter("QUANTITY_SOLD"&gt;50)

Note
-----
<span class="bold">   - dynamic statistics used: stats for conventional DML</span></code></pre></li>
                              </ol>
                           </div>
                           <!-- class="example" -->
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-D55D673B-1FD9-45C9-A109-F440B7E96E62__GUID-5D75B9C2-07BC-4FEF-8B60-EE7ECB73CF66">
                              <p class="notep1">See Also:</p>
                              <p><span><cite>Oracle Database Reference</cite></span> to learn about <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=GUID-4FF4364B-29D0-4365-AA0F-ABD17CE298EC" target="_blank"><code class="codeph">USER_TAB_COL_STATISTICS</code></a>and <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=GUID-736A4F76-14F0-4CDD-93A0-33B59B103A0B" target="_blank"><code class="codeph">USER_TAB_STATISTICS</code></a>.
                              </p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-769E609D-0312-43A7-9581-3F3EACF10BA9" title="Starting in Oracle Database 19c, the database automatically gathers real-time statistics during conventional DML operations.">Real-Time Statistics</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div>
               </div>
            </div><a id="TGSQL345"></a><div class="props_rev_3"><a id="GUID-13E8BD68-B8A1-4937-8774-3EF82FB8FB47" name="GUID-13E8BD68-B8A1-4937-8774-3EF82FB8FB47"></a><h3 id="TGSQL-GUID-13E8BD68-B8A1-4937-8774-3EF82FB8FB47" class="sect3"><span class="enumeration_section">10.4 </span>When the Database Gathers Optimizer Statistics
               </h3>
               <div>
                  <p>The database collects optimizer statistics at various times and from various sources.</p>
                  <p>This section contains the following topics:</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-16C4B770-1783-493D-A0F6-3F8A9E075766">Sources for Optimizer Statistics</a><br>The optimizer uses several different sources for optimizer statistics.
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-F8F25E31-7113-4B91-BD81-BE6082983192">SQL Plan Directives</a><br>A <strong class="term">SQL plan directive</strong> is additional information and instructions that the optimizer can use to generate a more optimal plan. 
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-E932F5B4-9BDB-4EE4-934C-7F1979CC62A9">When the Database Samples Data</a><br>Starting in <span>Oracle Database 12c</span>, the optimizer automatically decides whether dynamic statistics are useful and which sample size to use for all SQL statements.
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-3A50D0D5-5494-43EE-B03D-10569B4D8BF8">How the Database Samples Data</a><br>At the beginning of optimization, when deciding whether a table is a candidate for dynamic statistics, the optimizer checks for the existence of persistent SQL plan directives on the table. 
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-C0E74ACE-2706-48A1-97A2-33F52207166A" title="Oracle Database optimizer statistics describe details about the database and its objects.">Optimizer Statistics Concepts</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="props_rev_3"><a id="GUID-16C4B770-1783-493D-A0F6-3F8A9E075766" name="GUID-16C4B770-1783-493D-A0F6-3F8A9E075766"></a><h4 id="TGSQL-GUID-16C4B770-1783-493D-A0F6-3F8A9E075766" class="sect4"><span class="enumeration_section">10.4.1 </span>Sources for Optimizer Statistics
                  </h4>
                  <div>
                     <p>The optimizer uses several different sources for optimizer statistics.</p>
                     <p>The sources are as follows:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><code class="codeph">DBMS_STATS</code> execution, automatic or manual
                           </p>
                           <p>This PL/SQL package is the primary means of gathering optimizer statistics.</p>
                        </li>
                        <li>
                           <p>SQL compilation</p>
                           <p>During <a href="glossary.html#GUID-F9233BE0-9CB9-4673-A705-174924AE3B18"><span class="xrefglossterm">SQL compilation</span></a>, the database can augment the statistics previously gathered by <code class="codeph">DBMS_STATS</code>. In this stage, the database runs additional queries to obtain more accurate information on how many rows in the tables satisfy the <code class="codeph">WHERE</code> clause predicates in the SQL statement.
                           </p>
                        </li>
                        <li>
                           <p>SQL execution</p>
                           <p>During execution, the database can further augment previously gathered statistics. In this stage, Oracle Database collects the number of rows produced by every row source during the execution of a SQL statement. At the end of execution, the optimizer determines whether the estimated number of rows is inaccurate enough to warrant reparsing at the next statement execution. If the cursor is marked for reparsing, then the optimizer uses actual row counts from the previous execution instead of estimates.</p>
                        </li>
                        <li>
                           <p>SQL profiles</p>
                           <p>A <a href="glossary.html#GUID-79F91289-6DD0-49BC-AEA2-3427F5D52F41"><span class="xrefglossterm">SQL profile</span></a> is a collection of auxiliary statistics on a query. The profile stores these supplemental statistics in the data dictionary. The optimizer uses SQL profiles during optimization to determine the most optimal plan.
                           </p>
                        </li>
                     </ul>
                     <p>The database stores optimizer statistics in the data dictionary and updates or replaces them as needed. You can query statistics in data dictionary views.</p>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-16C4B770-1783-493D-A0F6-3F8A9E075766__GUID-0824D866-91FE-4A5B-816A-A345BA4D9336">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p> <span class="q">"<a href="optimizer-statistics-concepts.html#GUID-E932F5B4-9BDB-4EE4-934C-7F1979CC62A9" title="Starting in Oracle Database 12c, the optimizer automatically decides whether dynamic statistics are useful and which sample size to use for all SQL statements.">When the Database Samples Data</a>"</span></p>
                           </li>
                           <li>
                              <p><span class="q">"<a href="managing-sql-profiles.html#GUID-1AC3C45E-331A-4016-8FE8-7FEFFD8D7220" title="A SQL profile is a database object that contains auxiliary statistics specific to a SQL statement.">About SQL Profiles</a>"</span></p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS-GUID-CA6A56B9-0540-45E9-B1D7-D78769B7714C" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_STATS.GATHER_TABLE_STATS</code> procedure
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-13E8BD68-B8A1-4937-8774-3EF82FB8FB47" title="The database collects optimizer statistics at various times and from various sources.">When the Database Gathers Optimizer Statistics</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL347"></a><div class="props_rev_3"><a id="GUID-F8F25E31-7113-4B91-BD81-BE6082983192" name="GUID-F8F25E31-7113-4B91-BD81-BE6082983192"></a><h4 id="TGSQL-GUID-F8F25E31-7113-4B91-BD81-BE6082983192" class="sect4"><span class="enumeration_section">10.4.2 </span>SQL Plan Directives
                  </h4>
                  <div>
                     <p>A <strong class="term">SQL plan directive</strong> is additional information and instructions that the optimizer can use to generate a more optimal plan. 
                     </p>
                     <p>The directive is a “note to self” by the optimizer that it is misestimating cardinalities of certain types of predicates, and also a reminder to <code class="codeph">DBMS_STATS</code> to gather statistics needed to correct the misestimates in the future. For example, when joining two tables that have a data skew in their join columns, a SQL plan directive can direct the optimizer to use dynamic statistics to obtain a more accurate join cardinality estimate.
                     </p>
                     <p>This section contains the following topics:</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-5A4B57DE-A005-4D57-BB29-9A87B902D034">When the Database Creates SQL Plan Directives</a><br>The database creates SQL plan directives automatically based on information learned during automatic reoptimization. If a cardinality misestimate occurs during SQL execution, then the database creates SQL plan directives.
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-C336BE11-6785-45AC-BBD0-2BA3D766E641">How the Database Uses SQL Plan Directives</a><br>When compiling a SQL statement, if the optimizer sees a directive, then it obeys the directive by gathering additional information.
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-5587E29D-6B1D-4886-8DD9-5D4CFABC4526">SQL Plan Directive Maintenance</a><br>The database automatically creates SQL plan directives. You cannot create them manually. 
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-C8E00C0A-2DC3-4331-9319-696A6DECE716">How the Optimizer Uses SQL Plan Directives: Example</a><br>This example shows how the database automatically creates and uses SQL plan directives for SQL statements.
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA">How the Optimizer Uses Extensions and SQL Plan Directives: Example</a><br>The example shows how the database uses a SQL plan directive until the optimizer verifies that an extension exists and the statistics are applicable. 
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-13E8BD68-B8A1-4937-8774-3EF82FB8FB47" title="The database collects optimizer statistics at various times and from various sources.">When the Database Gathers Optimizer Statistics</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="props_rev_3"><a id="GUID-5A4B57DE-A005-4D57-BB29-9A87B902D034" name="GUID-5A4B57DE-A005-4D57-BB29-9A87B902D034"></a><h5 id="TGSQL-GUID-5A4B57DE-A005-4D57-BB29-9A87B902D034" class="sect5"><span class="enumeration_section">10.4.2.1 </span>When the Database Creates SQL Plan Directives
                     </h5>
                     <div>
                        <p>The database creates SQL plan directives automatically based on information learned during automatic reoptimization. If a cardinality misestimate occurs during SQL execution, then the database creates SQL plan directives.</p>
                        <p> For each new directive, the <code class="codeph">DBA_SQL_PLAN_DIRECTIVES.STATE</code> column shows the value <code class="codeph">USABLE</code>. This value indicates that the database can use the directive to correct misestimates.
                        </p>
                        <p>The optimizer defines a SQL plan directive on a query expression, for example, filter predicates on two columns being used together. A directive is not tied to a specific SQL statement or SQL ID. For this reason, the optimizer can use directives for statements that are not identical. For example, directives can help the optimizer with queries that use similar patterns, such as queries that are identical except for a select list item.</p>
                        <p>The Notes section of the execution plan indicates the number of SQL plan directives used for a statement. Obtain more information about the directives by querying the <code class="codeph">DBA_SQL_PLAN_DIRECTIVES</code> and <code class="codeph">DBA_SQL_PLAN_DIR_OBJECTS</code> views.
                        </p>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-5A4B57DE-A005-4D57-BB29-9A87B902D034__GUID-CA18210C-906E-4F11-97BA-8B666813BA23">
                           <p class="notep1">See Also:</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=REFRN-GUID-70035A22-E031-4975-A51C-871AE1F2F260" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn more about <code class="codeph">DBA_SQL_PLAN_DIRECTIVES</code></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-F8F25E31-7113-4B91-BD81-BE6082983192" title="A SQL plan directive is additional information and instructions that the optimizer can use to generate a more optimal plan.">SQL Plan Directives</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL95089"></a><div class="props_rev_3"><a id="GUID-C336BE11-6785-45AC-BBD0-2BA3D766E641" name="GUID-C336BE11-6785-45AC-BBD0-2BA3D766E641"></a><h5 id="TGSQL-GUID-C336BE11-6785-45AC-BBD0-2BA3D766E641" class="sect5"><span class="enumeration_section">10.4.2.2 </span>How the Database Uses SQL Plan Directives
                     </h5>
                     <div>
                        <p>When compiling a SQL statement, if the optimizer sees a directive, then it obeys the directive by gathering additional information.</p>
                        <p>The optimizer uses directives in the following ways:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Dynamic statistics</p>
                              <p>The optimizer uses dynamic statistics whenever it does not have sufficient statistics corresponding to the directive. For example, the cardinality estimates for a query whose predicate contains a specific pair of columns may be significantly wrong. A SQL plan directive indicates that the whenever a query that contains these columns is parsed, the optimizer needs to use dynamic sampling to avoid a serious cardinality misestimate.</p>
                              <p>Dynamic statistics have some performance overhead. Every time the optimizer hard parses a query to which a dynamic statistics directive applies, the database must perform the extra sampling.</p>
                              <p>Starting in <span>Oracle Database 12c</span> Release 2 (12.2), the database writes statistics from <a href="glossary.html#GUID-75E99BE4-8426-4D61-A52E-9C301121CA42"><span class="xrefglossterm">adaptive dynamic sampling</span></a> to the SQL plan directives store, making them available to other queries.
                              </p>
                           </li>
                           <li>
                              <p>Column groups</p>
                              <p>The optimizer examines the query corresponding to the directive. If there is a missing <a href="glossary.html#GUID-0179FA30-A218-4642-9CB7-566ABEEA8128"><span class="xrefglossterm">column group</span></a>, and if the <code class="codeph">DBMS_STATS</code> preference <code class="codeph">AUTO_STAT_EXTENSIONS</code> is set to <code class="codeph">ON</code> (the default is <code class="codeph">OFF</code>) for the affected table, then the optimizer automatically creates this column group the next time <code class="codeph">DBMS_STATS</code> gathers statistics on the table. Otherwise, the optimizer does not automatically create the column group.
                              </p>
                              <p>If a column group exists, then the next time this statement executes, the optimizer uses the <a href="glossary.html#GUID-FB763B43-B5C7-47D0-8B0D-47CED4922501"><span class="xrefglossterm">column group statistics</span></a> in place of the SQL plan directive when possible (equality predicates, <code class="codeph">GROUP BY</code>, and so on). In subsequent executions, the optimizer may create additional SQL plan directives to address other problems in the plan, such as join or <code class="codeph">GROUP BY</code> cardinality misestimates.
                              </p>
                              <div class="infoboxnote" id="GUID-C336BE11-6785-45AC-BBD0-2BA3D766E641__GUID-D742CA39-2872-4DAA-AD16-55DA70666555">
                                 <p class="notep1">Note:</p>Currently, the optimizer monitors only column groups. The optimizer does not create an extension on expressions. 
                              </div>
                           </li>
                        </ul>
                        <p>When the problem that occasioned a directive is solved, either because a better directive exists or because a histogram or extension exists, the <code class="codeph">DBA_SQL_PLAN_DIRECTIVES.STATE</code> value changes from <code class="codeph">USABLE</code> to <code class="codeph">SUPERSEDED</code>. More information about the directive state is exposed in the <code class="codeph">DBA_SQL_PLAN_DIRECTIVES.NOTES</code> column.
                        </p>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-C336BE11-6785-45AC-BBD0-2BA3D766E641__GUID-6D00E503-A5A4-42CB-BF43-BA14E2CB24A4">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="q">"<a href="managing-extended-statistics.html#GUID-BD0F0B71-DD8B-44A0-888E-495830FC09A4" title="DBMS_STATS enables you to collect extended statistics, which are statistics that can improve cardinality estimates when multiple predicates exist on different columns of a table, or when predicates use expressions.">Managing Extended Statistics</a>"</span></p>
                              </li>
                              <li>
                                 <p><span class="q">"<a href="managing-extended-statistics.html#GUID-858E0BDA-06C6-471F-B9E8-888C3AD29673" title="Individual column statistics are useful for determining the selectivity of a single predicate in a WHERE clause.">About Statistics on Column Groups</a>"</span></p>
                              </li>
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS-GUID-F993ADFE-85A9-4939-84D1-CC7A6E5C56D2" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about the <code class="codeph">AUTO_STAT_EXTENSIONS</code> preference for <code class="codeph">DBMS_STATS.SET_TABLE_STATS</code></p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-F8F25E31-7113-4B91-BD81-BE6082983192" title="A SQL plan directive is additional information and instructions that the optimizer can use to generate a more optimal plan.">SQL Plan Directives</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="props_rev_3"><a id="GUID-5587E29D-6B1D-4886-8DD9-5D4CFABC4526" name="GUID-5587E29D-6B1D-4886-8DD9-5D4CFABC4526"></a><h5 id="TGSQL-GUID-5587E29D-6B1D-4886-8DD9-5D4CFABC4526" class="sect5"><span class="enumeration_section">10.4.2.3 </span>SQL Plan Directive Maintenance
                     </h5>
                     <div>
                        <p>The database automatically creates SQL plan directives. You cannot create them manually. </p>
                        <p>The database initially creates directives in the shared pool. The database periodically writes the directives to the <code class="codeph">SYSAUX</code> tablespace. The database automatically purges any SQL plan directive that is not used after the specified number of weeks (<code class="codeph">SPD_RETENTION_WEEKS</code>), which is 53 by default.
                        </p>
                        <p>You can manage directives by using the <code class="codeph">DBMS_SPD</code> package. For example, you can:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Enable and disable SQL plan directives (<code class="codeph">ALTER_SQL_PLAN_DIRECTIVE</code>)
                              </p>
                           </li>
                           <li>
                              <p>Change the retention period for SQL plan directives (<code class="codeph">SET_PREFS</code>)
                              </p>
                           </li>
                           <li>
                              <p>Export a directive to a staging table (<code class="codeph">PACK_STGTAB_DIRECTIVE</code>)
                              </p>
                           </li>
                           <li>
                              <p>Drop a directive (<code class="codeph">DROP_SQL_PLAN_DIRECTIVE</code>)
                              </p>
                           </li>
                           <li>
                              <p>Force the database to write directives to disk (<code class="codeph">FLUSH_SQL_PLAN_DIRECTIVE</code>)
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-5587E29D-6B1D-4886-8DD9-5D4CFABC4526__GUID-6D00E503-A5A4-42CB-BF43-BA14E2CB24A4">
                           <p class="notep1">See Also:</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS73856" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_SPD</code> package
                           </p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-F8F25E31-7113-4B91-BD81-BE6082983192" title="A SQL plan directive is additional information and instructions that the optimizer can use to generate a more optimal plan.">SQL Plan Directives</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL95091"></a><a id="TGSQL95092"></a><a id="TGSQL95093"></a><a id="TGSQL95094"></a><a id="TGSQL95090"></a><div class="props_rev_3"><a id="GUID-C8E00C0A-2DC3-4331-9319-696A6DECE716" name="GUID-C8E00C0A-2DC3-4331-9319-696A6DECE716"></a><h5 id="TGSQL-GUID-C8E00C0A-2DC3-4331-9319-696A6DECE716" class="sect5"><span class="enumeration_section">10.4.2.4 </span>How the Optimizer Uses SQL Plan Directives: Example
                     </h5>
                     <div>
                        <p>This example shows how the database automatically creates and uses SQL plan directives for SQL statements.</p>
                        <div class="section">
                           <p class="subhead3" id="GUID-C8E00C0A-2DC3-4331-9319-696A6DECE716__GUID-B9FD851F-B222-46A6-B909-8DC60F66F094">Assumptions</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>You plan to run queries against the <code class="codeph">sh</code> schema, and you have privileges on this schema and on data dictionary and <code class="codeph">V$</code> views.
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-C8E00C0A-2DC3-4331-9319-696A6DECE716__GUID-E2D6DD2D-3371-43A3-AE97-B972CF4654A9">To see how the database uses a SQL plan directive:</p>
                           <ol>
                              <li>
                                 <p>Query the <code class="codeph">sh.customers</code> table.
                                 </p><pre class="pre codeblock"><code>SELECT /*+gather_plan_statistics*/ * 
FROM   customers 
WHERE  cust_state_province='CA' 
AND    country_id='US';
</code></pre><p>The <code class="codeph">gather_plan_statistics</code> hint shows the actual number of rows returned from each operation in the plan. Thus, you can compare the optimizer estimates with the actual number of rows returned.
                                 </p>
                              </li>
                              <li>
                                 <p>Query the plan for the preceding query.</p>
                                 <p>The following example shows the execution plan (sample output included):</p><pre class="pre codeblock"><code>SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR(FORMAT=&gt;'ALLSTATS LAST'));
 
PLAN_TABLE_OUTPUT
-------------------------------------
SQL_ID  b74nw722wjvy3, child number 0
-------------------------------------
select /*+gather_plan_statistics*/ * from customers where
CUST_STATE_PROVINCE='CA' and country_id='US'
 
Plan hash value: 1683234692
--------------------------------------------------------------------------------------------
| Id| Operation         | Name      | Starts |E-Rows| A-Rows |   A-Time   |Buffers | Reads |
--------------------------------------------------------------------------------------------
| 0 | SELECT STATEMENT  |           |      1 |      |     29 |00:00:00.01 |     17 |    14 |
|*1 |  TABLE ACCESS FULL| CUSTOMERS |      1 |    8 |     29 |00:00:00.01 |     17 |    14 |
--------------------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------
 
   1 - filter(("CUST_STATE_PROVINCE"='CA' AND "COUNTRY_ID"='US'))
</code></pre><p>The actual number of rows (<code class="codeph">A-Rows</code>) returned by each operation in the plan varies greatly from the estimates (<code class="codeph">E-Rows</code>). This statement is a candidate for <a href="glossary.html#GUID-70FBCF66-F29E-4ADE-BEA8-F328917A2986"><span class="xrefglossterm">automatic reoptimization</span></a>.
                                 </p>
                              </li>
                              <li>
                                 <p>Check whether the <code class="codeph">customers</code> query can be reoptimized.
                                 </p>
                                 <p>The following statement queries the <code class="codeph">V$SQL.IS_REOPTIMIZABLE</code> value (sample output included):
                                 </p><pre class="pre codeblock"><code>SELECT SQL_ID, CHILD_NUMBER, SQL_TEXT, IS_REOPTIMIZABLE
FROM   V$SQL
WHERE  SQL_TEXT LIKE 'SELECT /*+gather_plan_statistics*/%';
 
SQL_ID        CHILD_NUMBER SQL_TEXT    I
------------- ------------ ----------- -
b74nw722wjvy3            0 select /*+g Y
                           ather_plan_
                           statistics*
                           / * from cu
                           stomers whe
                           re CUST_STA
                           TE_PROVINCE
                           ='CA' and c
                           ountry_id='
                           US'
</code></pre><p>The <code class="codeph">IS_REOPTIMIZABLE</code> column is marked <code class="codeph">Y</code>, so the database will perform a hard parse of the <code class="codeph">customers</code> query on the next execution. The optimizer uses the execution statistics from this initial execution to determine the plan. The database persists the information learned from reoptimization as a SQL plan directive.
                                 </p>
                              </li>
                              <li>
                                 <p>Display the directives for the <code class="codeph">sh</code> schema.
                                 </p>
                                 <p> The following example uses <code class="codeph">DBMS_SPD</code> to write the SQL plan directives to disk, and then shows the directives for the <code class="codeph">sh</code> schema only:
                                 </p><pre class="pre codeblock"><code>EXEC DBMS_SPD.FLUSH_SQL_PLAN_DIRECTIVE;
 
SELECT TO_CHAR(d.DIRECTIVE_ID) dir_id, o.OWNER AS "OWN", o.OBJECT_NAME AS "OBJECT", 
       o.SUBOBJECT_NAME col_name, o.OBJECT_TYPE, d.TYPE, d.STATE, d.REASON
FROM   DBA_SQL_PLAN_DIRECTIVES d, DBA_SQL_PLAN_DIR_OBJECTS o
WHERE  d.DIRECTIVE_ID=o.DIRECTIVE_ID
AND    o.OWNER IN ('SH')
ORDER BY 1,2,3,4,5;

DIR_ID              OWN OBJECT    COL_NAME    OBJECT TYPE             STATE  REASON
------------------- --- --------- ----------- ------ ---------------- ------ ------------
1484026771529551585 SH  CUSTOMERS COUNTRY_ID  COLUMN DYNAMIC_SAMPLING USABLE SINGLE TABLE
                                                                             CARDINALITY
                                                                             MISESTIMATE
1484026771529551585 SH  CUSTOMERS CUST_STATE_ COLUMN DYNAMIC_SAMPLING USABLE SINGLE TABLE
                                  PROVINCE                                   CARDINALITY
                                                                             MISESTIMATE       
1484026771529551585 SH  CUSTOMERS             TABLE  DYNAMIC_SAMPLING USABLE SINGLE TABLE
                                                                             CARDINALITY
                                                                             MISESTIMATE
</code></pre><p>Initially, the database stores SQL plan directives in memory, and then writes them to disk every 15 minutes. Thus, the preceding example calls <code class="codeph">DBMS_SPD.FLUSH_SQL_PLAN_DIRECTIVE</code> to force the database to write the directives to the <code class="codeph">SYSAUX</code> tablespace.
                                 </p>
                                 <p>Monitor directives using the views <code class="codeph">DBA_SQL_PLAN_DIRECTIVES</code> and <code class="codeph">DBA_SQL_PLAN_DIR_OBJECTS</code>. Three entries appear in the views, one for the <code class="codeph">customers</code> table itself, and one for each of the correlated columns. Because the <code class="codeph">customers</code> query has the <code class="codeph">IS_REOPTIMIZABLE</code> value of <code class="codeph">Y</code>, if you reexecute the statement, then the database will hard parse it again, and then generate a plan based on the previous execution statistics.
                                 </p>
                              </li>
                              <li>
                                 <p>Query the <code class="codeph">customers</code> table again.
                                 </p>
                                 <p>For example, enter the following statement:</p><pre class="pre codeblock"><code>SELECT /*+gather_plan_statistics*/ * 
FROM   customers 
WHERE  cust_state_province='CA' 
AND    country_id='US';
</code></pre></li>
                              <li>
                                 <p>Query the plan in the cursor.</p>
                                 <p>The following example shows the execution plan (sample output included):</p><pre class="pre codeblock"><code>SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR(FORMAT=&gt;'ALLSTATS LAST'));

PLAN_TABLE_OUTPUT
-------------------------------------
SQL_ID  b74nw722wjvy3, child number 1
-------------------------------------
select /*+gather_plan_statistics*/ * from customers where
CUST_STATE_PROVINCE='CA' and country_id='US'
 
Plan hash value: 1683234692
---------------------------------------------------------------------------
|Id | Operation         |Name     |Start|E-Rows|A-Rows|   A-Time  |Buffers|
---------------------------------------------------------------------------
|  0| SELECT STATEMENT  |         |    1|      |    29|00:00:00.01|     17|
|* 1|  TABLE ACCESS FULL|CUSTOMERS|    1|    29|    29|00:00:00.01|     17|
---------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------
 
   1 - filter(("CUST_STATE_PROVINCE"='CA' AND "COUNTRY_ID"='US'))
 
Note
-----
   - <span class="bold">cardinality feedback used for this statement</span>
</code></pre><p>The <code class="codeph">Note</code> section indicates that the database used reoptimization for this statement. The estimated number of rows (<code class="codeph">E-Rows</code>) is now correct. The SQL plan directive has not been used yet.
                                 </p>
                              </li>
                              <li>
                                 <p>Query the cursors for the <code class="codeph">customers</code> query.
                                 </p>
                                 <p>For example, run the following query (sample output included):</p><pre class="pre codeblock"><code>SELECT SQL_ID, CHILD_NUMBER, SQL_TEXT, IS_REOPTIMIZABLE
FROM   V$SQL
WHERE  SQL_TEXT LIKE 'SELECT /*+gather_plan_statistics*/%';
 
SQL_ID        CHILD_NUMBER SQL_TEXT    I
------------- ------------ ----------- -
b74nw722wjvy3            0 select /*+g Y
                           ather_plan_
                           statistics*
                           / * from cu
                           stomers whe
                           re CUST_STA
                           TE_PROVINCE
                           ='CA' and c
                           ountry_id='
                           US'
 
b74nw722wjvy3            1 select /*+g N
                           ather_plan_
                           statistics*
                           / * from cu
                           stomers whe
                           re CUST_STA
                           TE_PROVINCE
                           ='CA' and c
                           ountry_id='
                           US'
</code></pre><p>A new plan exists for the <code class="codeph">customers</code> query, and also a new child cursor. 
                                 </p>
                              </li>
                              <li>
                                 <p>Confirm that a SQL plan directive exists and is usable for other statements.</p>
                                 <p>For example, run the following query, which is similar but not identical to the original <code class="codeph">customers</code> query (the state is <code class="codeph">MA</code> instead of <code class="codeph">CA</code>):
                                 </p><pre class="pre codeblock"><code>SELECT /*+gather_plan_statistics*/ CUST_EMAIL
FROM   CUSTOMERS
WHERE  CUST_STATE_PROVINCE='MA'
AND    COUNTRY_ID='US';
</code></pre></li>
                              <li>
                                 <p>Query the plan in the cursor.</p>
                                 <p>The following statement queries the cursor (sample output included).:</p><pre class="pre codeblock"><code>SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR(FORMAT=&gt;'ALLSTATS LAST'));

PLAN_TABLE_OUTPUT
-------------------------------------
SQL_ID  3tk6hj3nkcs2u, child number 0
-------------------------------------
Select /*+gather_plan_statistics*/ cust_email From   customers Where
cust_state_province='MA' And    country_id='US'
 
Plan hash value: 1683234692

---------------------------------------------------------------------------
|Id | Operation         | Name      |Starts|E-Rows|A-Rows| A-Time |Buffers|
---------------------------------------------------------------------------
| 0 | SELECT STATEMENT  |           |    1 |      |  2 |00:00:00.01|   16 |
|*1 |  TABLE ACCESS FULL| CUSTOMERS |    1 |    2 |  2 |00:00:00.01|   16 |
---------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------
 
   1 - filter(("CUST_STATE_PROVINCE"='MA' AND "COUNTRY_ID"='US'))
 
Note
-----
   - dynamic sampling used for this statement (level=2)
   - 1 Sql Plan Directive used for this statement
</code></pre><p>The <code class="codeph">Note</code> section of the plan shows that the optimizer used the SQL directive for this statement, and also used dynamic statistics.
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-C8E00C0A-2DC3-4331-9319-696A6DECE716__GUID-6B1FEAA5-D35B-4BA3-92E4-B3BCCED418A9">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p> <span class="q">"<a href="query-optimizer-concepts.html#GUID-D23F8328-A4CF-4211-8C9B-79B826F34A32" title="In automatic reoptimization, the optimizer changes a plan on subsequent executions after the initial execution.">Automatic Reoptimization</a>"</span></p>
                              </li>
                              <li>
                                 <p><span class="q">"<a href="options-for-optimizer-statistics-gathering.html#GUID-67E635AA-F168-47D7-9DC9-CE8803464B6E" title="A SQL plan directive is additional information and instructions that the optimizer can use to generate a more optimal plan.">Managing SQL Plan Directives</a>"</span></p>
                              </li>
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=REFRN23823" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about <code class="codeph">DBA_SQL_PLAN_DIRECTIVES</code>, <code class="codeph">V$SQL</code>, and other database views
                                 </p>
                              </li>
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS73856" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about <code class="codeph">DBMS_SPD</code></p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-F8F25E31-7113-4B91-BD81-BE6082983192" title="A SQL plan directive is additional information and instructions that the optimizer can use to generate a more optimal plan.">SQL Plan Directives</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL95097"></a><a id="TGSQL95098"></a><a id="TGSQL95099"></a><a id="TGSQL95100"></a><a id="TGSQL95101"></a><a id="TGSQL95096"></a><div class="props_rev_3"><a id="GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA" name="GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA"></a><h5 id="TGSQL-GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA" class="sect5"><span class="enumeration_section">10.4.2.5 </span>How the Optimizer Uses Extensions and SQL Plan Directives: Example
                     </h5>
                     <div>
                        <p>The example shows how the database uses a SQL plan directive until the optimizer verifies that an extension exists and the statistics are applicable. </p>
                        <p>At this point, the directive changes its status to <code class="codeph">SUPERSEDED</code>. Subsequent compilations use the statistics instead of the directive.
                        </p>
                        <div class="section">
                           <p class="subhead3" id="GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA__GUID-A64A2645-5FA0-4BAD-8753-338BEFA08937">Assumptions</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>This example assumes you have already followed the steps in <span class="q">"<a href="optimizer-statistics-concepts.html#GUID-C8E00C0A-2DC3-4331-9319-696A6DECE716" title="This example shows how the database automatically creates and uses SQL plan directives for SQL statements.">How the Optimizer Uses SQL Plan Directives: Example</a>"</span>.
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA__GUID-8230F8EB-96F6-4733-90B4-1D3855AF7341">To see how the optimizer uses an extension and SQL plan directive:</p>
                           <ol>
                              <li>
                                 <p>Gather statistics for the <code class="codeph">sh.customers</code> table.
                                 </p>
                                 <p>For example, execute the following PL/SQL program:</p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.GATHER_TABLE_STATS('SH','CUSTOMERS');
END;
/
</code></pre></li>
                              <li>
                                 <p>Check whether an extension exists on the <code class="codeph">customers</code> table.
                                 </p>
                                 <p>For example, execute the following query (sample output included):</p><pre class="pre codeblock"><code>SELECT TABLE_NAME, EXTENSION_NAME, EXTENSION 
FROM   DBA_STAT_EXTENSIONS
WHERE  OWNER='SH' 
AND    TABLE_NAME='CUSTOMERS';
 
TABLE_NAM EXTENSION_NAME                 EXTENSION
--------- ------------------------------ -----------------------
CUSTOMERS SYS_STU#S#WF25Z#QAHIHE#MOFFMM_ ("CUST_STATE_PROVINCE",
                                         "COUNTRY_ID")
</code></pre><p>The preceding output indicates that a column group extension exists on the <code class="codeph">cust_state_province</code> and <code class="codeph">country_id</code> columns.
                                 </p>
                              </li>
                              <li>
                                 <p>Query the state of the SQL plan directive.</p>
                                 <p><a href="optimizer-statistics-concepts.html#GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA__BABDHAAE">Example 10-6</a> queries the data dictionary for information about the directive.
                                 </p>
                                 <p>Although column group statistics exist, the directive has a state of <code class="codeph">USABLE</code> because the database has not yet recompiled the statement. During the next compilation, the optimizer verifies that the statistics are applicable. If they are applicable, then the status of the directive changes to <code class="codeph">SUPERSEDED</code>. Subsequent compilations use the statistics instead of the directive.
                                 </p>
                              </li>
                              <li>
                                 <p>Query the <code class="codeph">sh.customers</code> table.
                                 </p><pre class="pre codeblock"><code>SELECT /*+gather_plan_statistics*/ * 
FROM   customers 
WHERE  cust_state_province='CA' 
AND    country_id='US';
</code></pre></li>
                              <li>
                                 <p>Query the plan in the cursor.</p>
                                 <p><a href="optimizer-statistics-concepts.html#GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA__BABFEBDD">Example 10-7</a> shows the execution plan (sample output included).
                                 </p>
                                 <p>The <code class="codeph">Note</code> section shows that the optimizer used the directive and not the extended statistics. During the compilation, the database verified the extended statistics.
                                 </p>
                              </li>
                              <li>
                                 <p>Query the state of the SQL plan directive.</p>
                                 <p><a href="optimizer-statistics-concepts.html#GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA__BABGCHFF">Example 10-8</a> queries the data dictionary for information about the directive.
                                 </p>
                                 <p>The state of the directive, which has changed to <code class="codeph">SUPERSEDED</code>, indicates that the corresponding column or groups have an extension or histogram, or that another SQL plan directive exists that can be used for the directive.
                                 </p>
                              </li>
                              <li>
                                 <p>Query the <code class="codeph">sh.customers</code> table again, using a slightly different form of the statement.
                                 </p>
                                 <p>For example, run the following query:</p><pre class="pre codeblock"><code>SELECT /*+gather_plan_statistics*/ /* force reparse */ * 
FROM   customers 
WHERE  cust_state_province='CA' 
AND    country_id='US';
</code></pre><p>If the cursor is in the shared SQL area, then the database typically shares the cursor. To force a reparse, this step changes the SQL text slightly by adding a comment.</p>
                              </li>
                              <li>
                                 <p>Query the plan in the cursor.</p>
                                 <p><a href="optimizer-statistics-concepts.html#GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA__BABFBDEF">Example 10-9</a> shows the execution plan (sample output included).
                                 </p>
                                 <p>The absence of a <code class="codeph">Note</code> shows that the optimizer used the extended statistics instead of the SQL plan directive. If the directive is not used for 53 weeks, then the database automatically purges it.
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <div class="infoboxnotealso" id="GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA__GUID-6F1D7ACC-8143-41D2-B6B1-B9FC2BA40C14">
                              <p class="notep1">See Also:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><span class="q">"<a href="options-for-optimizer-statistics-gathering.html#GUID-67E635AA-F168-47D7-9DC9-CE8803464B6E" title="A SQL plan directive is additional information and instructions that the optimizer can use to generate a more optimal plan.">Managing SQL Plan Directives</a>"</span></p>
                                 </li>
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=REFRN23823" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about <code class="codeph">DBA_SQL_PLAN_DIRECTIVES</code>, <code class="codeph">V$SQL</code>, and other database views
                                    </p>
                                 </li>
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS73856" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about <code class="codeph">DBMS_SPD</code></p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA__BABDHAAE">
                           <p class="titleinexample">Example 10-6 Display Directives for sh Schema</p><pre class="pre codeblock"><code>EXEC DBMS_SPD.FLUSH_SQL_PLAN_DIRECTIVE;
 
SELECT TO_CHAR(d.DIRECTIVE_ID) dir_id, o.OWNER, o.OBJECT_NAME, 
       o.SUBOBJECT_NAME col_name, o.OBJECT_TYPE, d.TYPE, d.STATE, d.REASON
FROM   DBA_SQL_PLAN_DIRECTIVES d, DBA_SQL_PLAN_DIR_OBJECTS o
WHERE  d.DIRECTIVE_ID=o.DIRECTIVE_ID
AND    o.OWNER IN ('SH')
ORDER BY 1,2,3,4,5;
 
DIR_ID              OWN OBJECT_NA COL_NAME   OBJECT  TYPE             STATE  REASON
------------------- --- --------- ---------- ------- ---------------- ------ ------------
1484026771529551585  SH CUSTOMERS COUNTRY_ID  COLUMN DYNAMIC_SAMPLING USABLE SINGLE TABLE 
                                                                             CARDINALITY 
                                                                             MISESTIMATE
1484026771529551585  SH CUSTOMERS CUST_STATE_ COLUMN DYNAMIC_SAMPLING USABLE SINGLE TABLE 
                                  PROVINCE                                   CARDINALITY
                                                                             MISESTIMATE
1484026771529551585  SH CUSTOMERS              TABLE DYNAMIC_SAMPLING USABLE SINGLE TABLE 
                                                                             CARDINALITY
                                                                             MISESTIMATE
</code></pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA__BABFEBDD">
                           <p class="titleinexample">Example 10-7 Execution Plan</p><pre class="pre codeblock"><code>SQL&gt; SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR(FORMAT=&gt;'ALLSTATS LAST'));
 
PLAN_TABLE_OUTPUT
-------------------------------------
SQL_ID  b74nw722wjvy3, child number 0
-------------------------------------
select /*+gather_plan_statistics*/ * from customers where
CUST_STATE_PROVINCE='CA' and country_id='US'
 
Plan hash value: 1683234692
 
-----------------------------------------------------------------------------------------
| Id  | Operation         | Name      | Starts | E-Rows | A-Rows |   A-Time   | Buffers |
-----------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT  |           |      1 |        |     29 |00:00:00.01 |      16 |
|*  1 |  TABLE ACCESS FULL| CUSTOMERS |      1 |     29 |     29 |00:00:00.01 |      16 |
-----------------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------
 
   1 - filter(("CUST_STATE_PROVINCE"='CA' AND "COUNTRY_ID"='US'))
 
Note
-----
   - dynamic sampling used for this statement (level=2)
   - <span class="bold">1 Sql Plan Directive used for this statement</span></code></pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA__BABGCHFF">
                           <p class="titleinexample">Example 10-8 Display Directives for sh Schema</p><pre class="pre codeblock"><code>EXEC DBMS_SPD.FLUSH_SQL_PLAN_DIRECTIVE;
 
SELECT TO_CHAR(d.DIRECTIVE_ID) dir_id, o.OWNER, o.OBJECT_NAME, 
       o.SUBOBJECT_NAME col_name, o.OBJECT_TYPE, d.TYPE, d.STATE, d.REASON
FROM   DBA_SQL_PLAN_DIRECTIVES d, DBA_SQL_PLAN_DIR_OBJECTS o
WHERE  d.DIRECTIVE_ID=o.DIRECTIVE_ID
AND    o.OWNER IN ('SH')
ORDER BY 1,2,3,4,5;
 
DIR_ID              OWN OBJECT_NA  COL_NAME    OBJECT TYPE     STATE      REASON
------------------- --- ---------  ----------  ------ -------- ---------  ------------
1484026771529551585  SH CUSTOMERS  COUNTRY_ID  COLUMN DYNAMIC_ SUPERSEDED SINGLE TABLE  
                                                      SAMPLING            CARDINALITY 
                                                                          MISESTIMATE
1484026771529551585  SH CUSTOMERS  CUST_STATE_ COLUMN DYNAMIC_ SUPERSEDED SINGLE TABLE 
                                   PROVINCE           SAMPLING            CARDINALITY 
                                                                          MISESTIMATE
1484026771529551585  SH CUSTOMERS               TABLE DYNAMIC_ SUPERSEDED SINGLE TABLE
                                                      SAMPLING            CARDINALITY
                                                                          MISESTIMATE</code></pre><pre class="oac_no_warn" dir="ltr"></pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA__BABFBDEF">
                           <p class="titleinexample">Example 10-9 Execution Plan</p><pre class="pre codeblock"><code>SQL&gt; SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR(FORMAT=&gt;'ALLSTATS LAST'));
 
PLAN_TABLE_OUTPUT
-------------------------------------
SQL_ID  b74nw722wjvy3, child number 0
-------------------------------------
select /*+gather_plan_statistics*/ * from customers where
CUST_STATE_PROVINCE='CA' and country_id='US'
 
Plan hash value: 1683234692
 
-----------------------------------------------------------------------------------------
| Id  | Operation         | Name      | Starts | E-Rows | A-Rows |   A-Time   | Buffers |
-----------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT  |           |      1 |        |     29 |00:00:00.01 |      17 |
|*  1 |  TABLE ACCESS FULL| CUSTOMERS |      1 |     29 |     29 |00:00:00.01 |      17 |
-----------------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------
 
   1 - filter(("CUST_STATE_PROVINCE"='CA' AND "COUNTRY_ID"='US'))
 
19 rows selected.
</code></pre></div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-F8F25E31-7113-4B91-BD81-BE6082983192" title="A SQL plan directive is additional information and instructions that the optimizer can use to generate a more optimal plan.">SQL Plan Directives</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="TGSQL349"></a><a id="TGSQL348"></a><div class="props_rev_3"><a id="GUID-E932F5B4-9BDB-4EE4-934C-7F1979CC62A9" name="GUID-E932F5B4-9BDB-4EE4-934C-7F1979CC62A9"></a><h4 id="TGSQL-GUID-E932F5B4-9BDB-4EE4-934C-7F1979CC62A9" class="sect4"><span class="enumeration_section">10.4.3 </span>When the Database Samples Data
                  </h4>
                  <div>
                     <p>Starting in <span>Oracle Database 12c</span>, the optimizer automatically decides whether dynamic statistics are useful and which sample size to use for all SQL statements.
                     </p>
                     <div class="infoboxnote" id="GUID-E932F5B4-9BDB-4EE4-934C-7F1979CC62A9__GUID-05453854-B6F5-4DC4-B7DA-27154509AB27">
                        <p class="notep1">Note:</p>
                        <p>In earlier releases, dynamic statistics were called <span class="italic">dynamic sampling</span>.
                        </p>
                     </div>
                     <p>The primary factor in the decision to use dynamic statistics is whether available statistics are sufficient to generate an optimal plan. If statistics are insufficient, then the optimizer uses dynamic statistics.</p>
                     <p>Automatic dynamic statistics are enabled when the <code class="codeph">OPTIMIZER_DYNAMIC_SAMPLING</code> initialization parameter is not set to <code class="codeph">0</code>. By default, the <a href="glossary.html#GUID-AD21414C-F385-4CA1-A1A5-79707D747D42"><span class="xrefglossterm">dynamic statistics level</span></a> is set to <code class="codeph">2</code>.
                     </p>
                     <p>In general, the optimizer uses default statistics rather than dynamic statistics to compute statistics needed during optimizations on tables, indexes, and columns. The optimizer decides whether to use dynamic statistics based on several factors, including the following:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The SQL statement uses parallel execution.</p>
                        </li>
                        <li>
                           <p>A SQL plan directive exists.</p>
                           <p></p>
                        </li>
                     </ul>
                     <p>The following diagram illustrates the process of gathering dynamic statistics.</p>
                     <div class="figure" id="GUID-E932F5B4-9BDB-4EE4-934C-7F1979CC62A9__BABCEJAH">
                        <p class="titleinfigure">Figure 10-2 Dynamic Statistics</p><img src="img/tgsql_vm_018.png" alt="Description of Figure 10-2 follows" title="Description of Figure 10-2 follows" longdesc="img_text/tgsql_vm_018.html"><br><a href="img_text/tgsql_vm_018.html">Description of "Figure 10-2 Dynamic Statistics"</a></div>
                     <!-- class="figure" -->
                     <p>As shown in <a href="optimizer-statistics-concepts.html#GUID-E932F5B4-9BDB-4EE4-934C-7F1979CC62A9__BABCEJAH">Figure 10-2</a>, the optimizer automatically gathers dynamic statistics in the following cases:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Missing statistics</p>
                           <p>When tables in a query have no statistics, the optimizer gathers basic statistics on these tables before optimization. Statistics can be missing because the application creates new objects without a follow-up call to <code class="codeph">DBMS_STATS</code> to gather statistics, or because statistics were locked on an object before statistics were gathered.
                           </p>
                           <p>In this case, the statistics are not as high-quality or as complete as the statistics gathered using the <code class="codeph">DBMS_STATS</code> package. This trade-off is made to limit the impact on the compile time of the statement.
                           </p>
                        </li>
                        <li>
                           <p>Insufficient statistics</p>
                           <p>Statistics can be insufficient whenever the optimizer estimates the selectivity of predicates (filter or join) or the <code class="codeph">GROUP BY</code> clause without taking into account correlation between columns, skew in the column data distribution, statistics on expressions, and so on. 
                           </p>
                           <p>Extended statistics help the optimizer obtain accurate quality cardinality estimates for complex predicate expressions. The optimizer can use dynamic statistics to compensate for the lack of extended statistics or when it cannot use extended statistics, for example, for non-equality predicates.</p>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-E932F5B4-9BDB-4EE4-934C-7F1979CC62A9__GUID-B7DFBE78-ED18-418E-AA20-9DEE43FFB60F">
                        <p class="notep1">Note:</p>
                        <p>The database does not use dynamic statistics for queries that contain the <code class="codeph">AS OF</code> clause.
                        </p>
                     </div>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-E932F5B4-9BDB-4EE4-934C-7F1979CC62A9__GUID-502D5190-38EF-478F-A681-30748DA1E009">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="q">"<a href="options-for-optimizer-statistics-gathering.html#GUID-F1C666DC-5450-4F92-83AA-607327DB5FD8" title="Dynamic statistics are an optimization technique in which the database uses recursive SQL to scan a small random sample of the blocks in a table.">Configuring Options for Dynamic Statistics</a>"</span></p>
                           </li>
                           <li>
                              <p><span class="q">"<a href="managing-extended-statistics.html#GUID-858E0BDA-06C6-471F-B9E8-888C3AD29673" title="Individual column statistics are useful for determining the selectivity of a single predicate in a WHERE clause.">About Statistics on Column Groups</a>"</span></p>
                           </li>
                           <li>
                              <p><a href="../refrn/OPTIMIZER_DYNAMIC_SAMPLING.html#REFRN10140" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">OPTIMIZER_DYNAMIC_SAMPLING</code> initialization parameter
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-13E8BD68-B8A1-4937-8774-3EF82FB8FB47" title="The database collects optimizer statistics at various times and from various sources.">When the Database Gathers Optimizer Statistics</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL350"></a><div class="props_rev_3"><a id="GUID-3A50D0D5-5494-43EE-B03D-10569B4D8BF8" name="GUID-3A50D0D5-5494-43EE-B03D-10569B4D8BF8"></a><h4 id="TGSQL-GUID-3A50D0D5-5494-43EE-B03D-10569B4D8BF8" class="sect4"><span class="enumeration_section">10.4.4 </span>How the Database Samples Data
                  </h4>
                  <div>
                     <p>At the beginning of optimization, when deciding whether a table is a candidate for dynamic statistics, the optimizer checks for the existence of persistent SQL plan directives on the table. </p>
                     <p>For each directive, the optimizer registers a statistics expression that the optimizer computes when determining the cardinality of a predicate involving the table. In <a href="optimizer-statistics-concepts.html#GUID-E932F5B4-9BDB-4EE4-934C-7F1979CC62A9__BABCEJAH">Figure 10-2</a>, the database issues a <a href="glossary.html#GUID-4BBB2EED-7E8C-4BAF-A3B3-B1CEF98342AC"><span class="xrefglossterm">recursive SQL</span></a> statement to scan a small random sample of the table blocks. The database applies the relevant single-table predicates and joins to estimate predicate cardinalities.
                     </p>
                     <p>The database persists the results of dynamic statistics as sharable statistics. The database can share the results during the <a href="glossary.html#GUID-F9233BE0-9CB9-4673-A705-174924AE3B18"><span class="xrefglossterm">SQL compilation</span></a> of one query with recompilations of the same query. The database can also reuse the results for queries that have the same patterns.
                     </p>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-3A50D0D5-5494-43EE-B03D-10569B4D8BF8__GUID-79EB0E26-32DE-42BD-B837-5BFC0AE7B2C6">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="q">"<a href="options-for-optimizer-statistics-gathering.html#GUID-F1C666DC-5450-4F92-83AA-607327DB5FD8" title="Dynamic statistics are an optimization technique in which the database uses recursive SQL to scan a small random sample of the blocks in a table.">Configuring Options for Dynamic Statistics</a>"</span> to learn how to set the dynamic statistics level
                              </p>
                           </li>
                           <li>
                              <p><a href="../refrn/OPTIMIZER_DYNAMIC_SAMPLING.html#REFRN10140" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> for details about the <code class="codeph">OPTIMIZER_DYNAMIC_SAMPLING</code> initialization parameter
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="optimizer-statistics-concepts.html#GUID-13E8BD68-B8A1-4937-8774-3EF82FB8FB47" title="The database collects optimizer statistics at various times and from various sources.">When the Database Gathers Optimizer Statistics</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>