<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="Use these options to rerun upgrades.">
      <meta name="description" content="Use these options to rerun upgrades.">
      <title>Rerunning Upgrades for Oracle Database</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Database Upgrade Guide">
      <meta property="og:description" content="Use these options to rerun upgrades.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Database Upgrade Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="database-upgrade-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-04-25T08:26:31-07:00">
      <meta name="dcterms.title" content="Database Upgrade Guide">
      <meta name="dcterms.dateCopyrighted" content="1996, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96252-05">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="troubleshooting-oracle-database-upgrade.html" title="Previous" type="text/html">
      <link rel="next" href="restarting-upgrade-specific-phase-that-failed-using-p.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="UPGRD">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="troubleshooting-oracle-database-upgrade.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="restarting-upgrade-specific-phase-that-failed-using-p.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Database Upgrade Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="upgrading-oracle-database.html" property="item" typeof="WebPage"><span property="name">Upgrading Oracle Database</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Rerunning Upgrades for Oracle Database</li>
            </ol>
            <a id="GUID-190D00A4-BE9A-4139-B3FC-A29C2BFBE91B" name="GUID-190D00A4-BE9A-4139-B3FC-A29C2BFBE91B"></a><a id="UPGRD12412"></a>
            
            <h2 id="UPGRD-GUID-190D00A4-BE9A-4139-B3FC-A29C2BFBE91B" class="sect2">Rerunning Upgrades for Oracle Database</h2>
         </header>
         <div class="ind">
            <div>
               <p>Use these options to rerun upgrades. </p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="rerunning-upgrades-oracle-database.html#GUID-6E157C6B-879D-49B2-82A3-E5A4C375D48F">About Rerunning Upgrades for Oracle Database</a><br>Oracle provides the features listed here to rerun or restart Oracle Database upgrades, including after failed phases.
                  </li>
                  <li class="ulchildlink"><a href="rerunning-upgrades-oracle-database.html#GUID-E281A34F-DCC4-4F4C-B7EF-03E694BB0CFF">Rerunning Upgrades with the Upgrade (catctl.pl) Script</a><br>You can fix upgrade issues and then rerun the upgrade with the <code>catctl.pl</code> script, or the <code>dbupgrade</code> shell command. 
                  </li>
                  <li class="ulchildlink"><a href="rerunning-upgrades-oracle-database.html#GUID-CF18A968-0C0E-4223-AA9F-37B39F31ACBA">Options for Rerunning the Upgrade for Multitenant Databases (CDBs)</a><br>There are four options you can use to rerun upgrades on multitenant database architecture (CDBs) for Oracle Database 12c release 2 (12.2).
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>Parent topic:</strong> <a href="upgrading-oracle-database.html#GUID-CC88F262-3370-4FFA-8604-EDA9F20F56D9" title="Oracle provides a comprehensive set of tools for upgrading Oracle Database with minimal downtime and for migrating your applications to the new release.">Upgrading Oracle Database</a></p>
                  </div>
               </div>
            </div>
            
            <div class="sect2"><a id="GUID-6E157C6B-879D-49B2-82A3-E5A4C375D48F" name="GUID-6E157C6B-879D-49B2-82A3-E5A4C375D48F"></a><h3 id="UPGRD-GUID-6E157C6B-879D-49B2-82A3-E5A4C375D48F" class="sect3">About Rerunning Upgrades for Oracle Database</h3>
               <div>
                  <p>Oracle provides the features listed here to rerun or restart Oracle Database upgrades, including after failed phases.</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-6E157C6B-879D-49B2-82A3-E5A4C375D48F__GUID-D1FCBADB-1DCA-472A-A912-F18427F91D36">Parallel Upgrade Utility and Restarts or Reruns</p>
                     <p>You can re-run or restart Oracle Database upgrade phases by using either Database Upgrade Assistant (DBUA), or by using the Parallel Upgrade Utility (<code class="codeph">catctl.pl</code>) script. You can also run commands on PDBs that failed to upgrade in an initial attempt, so that you can complete the upgrade.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-6E157C6B-879D-49B2-82A3-E5A4C375D48F__GUID-D4199F17-E082-433F-9FD1-45CA83123592">Parallel Upgrade Utility Resume Option</p>
                     <p>Oracle Database 12<span class="italic">c</span> release 2 (12.2) includes a new Resume option for Parallel Upgrade Utility. This option is available for both CDBs and Non-CDBs. You are not required to identify failed or incomplete phases when you rerun or restart the upgrade. When you use the Parallel Upgrade Utility using the resume option (<code class="codeph">-R</code>), the utility automatically detects phases from the previous upgrade that are not completed successfully. The Parallel Upgrade Utility then reruns or restarts just these phases that did not complete successfully, so that the upgrade is completed. Bypassing steps that already completed successfully reduces the amount of time it takes to rerun the upgrade.
                     </p>
                     <p>To use the Resume option, run the Parallel Upgrade Utility using the -R parameter. For example: </p><pre class="pre codeblock"><code>$ORACLE_HOME/perl/bin/perl catctl.pl -L plist.txt -n 4 -N 2 -R -l $ORACLE_HOME/cfgtoollogs catupgrd.sql</code></pre><p>You can rerun the entire upgrade at any time, regardless of which phase you encountered a failure in your upgrade. If you plan to rerun the entire upgrade, instead of rerunning only failed phases, then run the Parallel Upgrade Utility without using the Resume (<code class="codeph">-R</code>) option. 
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="rerunning-upgrades-oracle-database.html#GUID-190D00A4-BE9A-4139-B3FC-A29C2BFBE91B" title="Use these options to rerun upgrades.">Rerunning Upgrades for Oracle Database</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="UPGRD52809"></a><div class="props_rev_3"><a id="GUID-E281A34F-DCC4-4F4C-B7EF-03E694BB0CFF" name="GUID-E281A34F-DCC4-4F4C-B7EF-03E694BB0CFF"></a><h3 id="UPGRD-GUID-E281A34F-DCC4-4F4C-B7EF-03E694BB0CFF" class="sect3">Rerunning Upgrades with the Upgrade (catctl.pl) Script</h3>
               <div>
                  <p>You can fix upgrade issues and then rerun the upgrade with the <code>catctl.pl</code> script, or the <code>dbupgrade</code> shell command. 
                  </p>
                  <div class="infoboxnote" id="GUID-E281A34F-DCC4-4F4C-B7EF-03E694BB0CFF__GUID-C3876793-A7D6-4D98-8C4E-6B79DA4403FF">
                     <p class="notep1">Note:</p>
                     <p>Starting with Oracle Database 12c, Release 1 (12.1), non-CDB architecture is deprecated. It can be desupported in a future release.</p>
                  </div>
                  <ol>
                     <li>
                        <p>Shut down the database. For a non-CDB and a CDB, the syntax is the same.</p><pre class="pre codeblock"><code>SQL&gt; SHUTDOWN IMMEDIATE
</code></pre></li>
                     <li>
                        <p>Restart the database in <code>UPGRADE</code> mode.
                        </p>
                        <p>For a non-CDB:</p><pre class="pre codeblock"><code>SQL&gt; STARTUP UPGRADE
</code></pre><p>For a CDB:</p><pre class="pre codeblock"><code>SQL&gt; STARTUP UPGRADE 
SQL&gt; alter pluggable database all open upgrade;
</code></pre></li>
                     <li>
                        <p>Rerun the Parallel Upgrade utility (<code>catctl.pl</code>, or <code>dbupgrade</code> shell command).
                        </p>
                        <p>You can rerun the Parallel Upgrade Utility as many times as necessary.</p>
                        <p>With CDBs, you can use the Resume option (<code class="codeph">-R</code>) to rerun the Parallel Upgrade Utility. The script resumes the upgrades from failed phases. 
                        </p>
                        <p>For example:</p><pre class="pre codeblock"><code>$ORACLE_HOME/perl/bin/perl catctl.pl -n 4 -R -l $ORACLE_HOME/cfgtoollogs catupgrd.sql</code></pre><p>You can also provide the name of one or more specific PDBs on which you want to rerun the upgrade. </p>
                        <p>For example, this command reruns the upgrade on the PDB named <code class="codeph">cdb1_pdb1</code>:
                        </p><pre class="pre codeblock"><code>$ORACLE_HOME/perl/bin/perl catctl.pl -n 4 -R -l $ORACLE_HOME/cfgtoollogs -c 'cdb1_pdb1' catupgrd.sql</code></pre><p>You can use the <code>dbupgrade</code> shell command to run the same commands:
                        </p><pre class="pre codeblock"><code>dbupgrade -n 4 -R -l $ORACLE_HOME/diagnostics 
dbupgrade -n 4 -R -l $ORACLE_HOME/diagnostics -c 'cdb1_pdb1'  </code></pre></li>
                     <li>
                        <p>Run <code>utlusts.sql</code>, the Post-Upgrade Status Tool, which provides a summary of the status of the upgrade in the spool log. You can run <code>utlusts.sql</code> any time before or after you complete the upgrade, but not during the upgrade.
                        </p>
                        <p>In a non-CDB:</p><pre class="pre codeblock"><code>SQL&gt; @$ORACLE_HOME/rdbms/admin/utlusts.sql
</code></pre><p>In a CDB:</p><pre class="pre codeblock"><code>$ORACLE_HOME/perl/bin/perl catcon.pl -n 1 -e -b utlu122s -d '''.''' utlusts.sql
</code></pre><p>If the <code class="codeph">utlusts.sql</code> script returns errors or shows components that are not <code class="codeph">VALID</code> or not the most recent release, then follow troubleshooting procedures for more information.
                        </p>
                     </li>
                     <li>
                        <p>Run <code>utlrp.sql</code> to recompile any remaining stored PL/SQL and Java code.
                        </p><pre class="pre codeblock"><code>$ORACLE_HOME/perl/bin/perl catcon.pl -n 1 -e -b utlrp -d '''.''' utlrp.sql
</code></pre><p>The script generates the log file <code class="codeph">utlrp0.log</code> , which shows the results of the re-compilations.
                        </p>
                        <p>Use the following SQL commands to verify that all expected packages and classes are valid,</p>
                        <p>In a single PDB (<code class="codeph">cdb1_pdb1</code> in this example), open the PDB in normal mode as follows:
                        </p><pre class="pre codeblock"><code>alter pluggable database cdb1_pdb1 open;
</code></pre><p>Run <code class="codeph">catcon.pl</code> to start<code class="codeph">utlrp.sql</code> in the PDB to recompile any remaining stored PL/SQL and Java code. Use the following syntax:
                        </p><pre class="pre codeblock"><code>$ORACLE_HOME/perl/bin/perl catcon.pl -n 1 -e -b utlrp -d '''.''' -c 'cdb1_pdb1'
 utlrp.sql
</code></pre><p>In a non-CDB:</p><pre class="pre codeblock"><code>SQL&gt; SELECT count(*) FROM dba_invalid_objects;
SQL&gt; SELECT distinct object_name FROM dba_invalid_objects;
</code></pre><p>In an entire CDB:</p><pre class="pre codeblock"><code>SQL&gt; ALTER SESSION SET CONTAINER = "CDB$ROOT"
SQL&gt; SELECT count(*) FROM dba_invalid_objects;
SQL&gt; SELECT distinct object_name FROM dba_invalid_objects;
SQL&gt; ALTER SESSION SET CONTAINER = "PDB$SEED"
SQL&gt; SELECT count(*) FROM dba_invalid_objects;
SQL&gt; SELECT distinct object_name FROM dba_invalid_objects;
SQL&gt; ALTER SESSION SET CONTAINER = "cdb1_pdb1"
SQL&gt; SELECT count(*) FROM dba_invalid_objects;
SQL&gt; SELECT distinct object_name FROM dba_invalid_objects;
</code></pre></li>
                     <li>
                        <p>Run <code>utlusts.sql</code> again to verify that all issues have been fixed.
                        </p>
                        <p>In a non-CDB:</p><pre class="pre codeblock"><code>SQL&gt; @$ORACLE_HOME/rdbms/admin/utlusts.sql
</code></pre><p>In a CDB:</p><pre class="pre codeblock"><code>$ORACLE_HOME/perl/bin/perl catcon.pl -n 1 -e -b utlu122s -d '''.''' utlusts.sql
</code></pre></li>
                     <li>
                        <p>Exit SQL*Plus.</p>
                     </li>
                     <li>
                        <p>If you are upgrading a cluster database from Release 11.2, then upgrade the database configuration in Oracle Clusterware using the following command syntax, where <code class="codeph"><span class="variable" translate="no">db-unique-name</span></code> is the database name assigned to it (not the instance name), and <code class="codeph"><span class="variable" translate="no">Oracle_home</span></code> is the Oracle home location in which the database is being upgraded.
                        </p><pre class="pre codeblock"><code>$ srvctl upgrade database -d <span class="variable" translate="no">db-unique-name</span> -o <span class="variable" translate="no">Oracle_home</span>
</code></pre></li>
                  </ol>
                  <div class="section">
                     <p>Your database is now upgraded. You are ready to complete post-upgrade tasks for Oracle Database.</p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="rerunning-upgrades-oracle-database.html#GUID-CF18A968-0C0E-4223-AA9F-37B39F31ACBA">Options for Rerunning the Upgrade for a Multitenant Database (CDB)</a></li>
                        <li><a href="troubleshooting-oracle-database-upgrade.html#GUID-474BFAA2-0CD6-4672-8A7A-BF640F4FBFB2">Troubleshooting the Upgrade for Oracle Database</a></li>
                        <li><a href="post-upgrade-tasks-oracle-database.html#GUID-637ADBD0-866B-4B64-9513-4C7CDE84895C"> Post-Upgrade Tasks for Oracle Database </a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="rerunning-upgrades-oracle-database.html#GUID-190D00A4-BE9A-4139-B3FC-A29C2BFBE91B" title="Use these options to rerun upgrades.">Rerunning Upgrades for Oracle Database</a></p>
                     </div>
                  </div>
               </div>
            </div>
            <div class="props_rev_3"><a id="GUID-CF18A968-0C0E-4223-AA9F-37B39F31ACBA" name="GUID-CF18A968-0C0E-4223-AA9F-37B39F31ACBA"></a><h3 id="UPGRD-GUID-CF18A968-0C0E-4223-AA9F-37B39F31ACBA" class="sect3">Options for Rerunning the Upgrade for Multitenant Databases (CDBs)</h3>
               <div>
                  <p>There are four options you can use to rerun upgrades on multitenant database architecture (CDBs) for Oracle Database 12c release 2 (12.2).</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="rerunning-upgrades-oracle-database.html#GUID-AA02C085-6155-467E-AFF3-FB409C69E3B1">Rerun the Entire Upgrade for the CDB</a><br>If several different issues occur during the first upgrade attempt, then use this procedure to re-run the entire upgrade. 
                     </li>
                     <li class="ulchildlink"><a href="rerunning-upgrades-oracle-database.html#GUID-226F1EBA-3272-4BD2-A5FA-D08ED1BA5808">Rerun the Upgrade Only on Specified CDBs</a><br>You can rerun upgrades on specified multitenant containers by running the Parallel Upgrade Utility with either the Resume option (<code class="codeph">-R</code>), or with the exclusion list option (<code class="codeph">-C</code>).
                     </li>
                     <li class="ulchildlink"><a href="rerunning-upgrades-oracle-database.html#GUID-BC8D35BA-2FDE-434C-936B-E7432B2F00AA">Rerun the Upgrade While Other PDBs Are Online</a><br>You can rerun PDB upgrades by using the Parallel Upgrade Utility Resume option, or by explicitly including or excluding online PDBs using with inclusion or exclusion lists.
                     </li>
                     <li class="ulchildlink"><a href="rerunning-upgrades-oracle-database.html#GUID-B8C68634-CB6B-415D-BB31-E8E11EBAF742">Rerun the Upgrade Using an Inclusion List to Specify a CDB or PDBs</a><br>Use this example as a model for rerunning an upgrade on a PDB by using an inclusion list. 
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="rerunning-upgrades-oracle-database.html#GUID-190D00A4-BE9A-4139-B3FC-A29C2BFBE91B" title="Use these options to rerun upgrades.">Rerunning Upgrades for Oracle Database</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="props_rev_3"><a id="GUID-AA02C085-6155-467E-AFF3-FB409C69E3B1" name="GUID-AA02C085-6155-467E-AFF3-FB409C69E3B1"></a><h4 id="UPGRD-GUID-AA02C085-6155-467E-AFF3-FB409C69E3B1" class="sect4">Rerun the Entire Upgrade for the CDB</h4>
                  <div>
                     <p>If several different issues occur during the first upgrade attempt, then use this procedure to re-run the entire upgrade. </p>
                     <p>This example demonstrates running the upgrade again on the <code class="codeph">CDB$ROOT</code>, <code class="codeph">PDB$SEED</code> and all PDBs after correcting for a problem occurring during the initial upgrade attempt, such as running out of shared pool.
                     </p>
                     <ol>
                        <li>
                           <p>Start the upgrade again. For example:</p><pre class="pre codeblock"><code>SQL&gt; startup upgrade;
alter pluggable database all open upgrade;
</code></pre></li>
                        <li>
                           <p>Run the Parallel Upgrade Utility (<code>catctl.pl</code>, or the <code>dbupgrade</code> shell script. For example:
                           </p> <pre class="pre codeblock"><code>cd $ORACLE_HOME/bin/
./dbupgrade -d $ORACLE_HOME/rdbms/admin -l $ORACLE_HOME/rdbms/log </code></pre><p>The upgrade runs again on all the containers, including <code class="codeph">CDB$ROOT</code> , <code class="codeph">PDB$SEED</code>, and all PDBs in the CDB. 
                           </p>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="rerunning-upgrades-oracle-database.html#GUID-CF18A968-0C0E-4223-AA9F-37B39F31ACBA" title="There are four options you can use to rerun upgrades on multitenant database architecture (CDBs) for Oracle Database 12c release 2 (12.2).">Options for Rerunning the Upgrade for Multitenant Databases (CDBs)</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="props_rev_3"><a id="GUID-226F1EBA-3272-4BD2-A5FA-D08ED1BA5808" name="GUID-226F1EBA-3272-4BD2-A5FA-D08ED1BA5808"></a><h4 id="UPGRD-GUID-226F1EBA-3272-4BD2-A5FA-D08ED1BA5808" class="sect4">Rerun the Upgrade Only on Specified CDBs</h4>
                  <div>
                     <p>You can rerun upgrades on specified multitenant containers by running the Parallel Upgrade Utility with either the Resume option (<code class="codeph">-R</code>), or with the exclusion list option (<code class="codeph">-C</code>).
                     </p>
                     <p>In both the examples that follow, the multitenant container database contains five PDBs. All upgrades ran successfully except for <code class="codeph">CDB1_PDB1</code> and <code class="codeph">CDB1_PDB2</code>, which failed with an upgrade error. To run the upgrade on these two containers, you shut down the entire multitenant database and restart only the PDBs you want to upgrade.
                     </p>
                     <div class="infoboxnote" id="GUID-226F1EBA-3272-4BD2-A5FA-D08ED1BA5808__GUID-55112014-622E-47E2-8E6C-C59D19B603FF">
                        <p class="notep1">Note:</p>
                        <p>Parallel Upgrade Utility parameters are case-sensitive. </p>
                     </div>
                     <div class="example" id="GUID-226F1EBA-3272-4BD2-A5FA-D08ED1BA5808__GUID-B75DB6FC-5DE9-4982-B5DA-FDF139B8A4C0">
                        <p class="titleinexample">Example 4-40 Rerunning Upgrades With the Resume Option</p>
                        <p>You can use the Parallel Upgrade Utility Resume parameter option <code>-R</code> to rerun the upgrade only on one or more multitenant containers (CDBs).
                        </p>
                        <p>In the following example, the upgrade script detects that it should run on <code class="codeph">CDB1_PDB1</code> and <code class="codeph">CDB1_PDB2</code> containers only. 
                        </p>
                        <ol>
                           <li>
                              <p>Shut down the multitenant database, start up the database in upgrade mode, and then start up the PDBs on which the upgrade did not complete. For example:</p><pre class="pre codeblock"><code>SQL&gt; shutdown immediate;
      startup upgrade;
      alter pluggable database CDB1_PDB1 open upgrade;
      alter pluggable database CDB1_PDB2 open upgrade;
</code></pre></li>
                           <li>
                              <p>Show the CDB and PDB status:</p><pre class="pre codeblock"><code> SQL&gt; show pdbs
 
       CON_ID CON_NAME                       OPEN MODE  RESTRICTED
       ---------- ------------------------------ ---------- ----------
           2 PDB$SEED                       MIGRATE    YES
           3 CDB1_PDB1                      MIGRATE    YES
           4 CDB1_PDB2                      MIGRATE    YES
           5 CDB1_PDB3                      MOUNTED
           6 CDB1_PDB4                      MOUNTED
           7 CDB1_PDB5                      MOUNTED
</code></pre></li>
                           <li>
                              <p>Rerun the upgrade. The upgrade automatically detects from the previous upgrade logs that CDB$ROOT and PDB$SEED are upgraded successfully. The upgrade bypasses CDB$ROOT and PDB$SEED, and only runs on CDB1_PDB1 and CDB_PDB2. The command example here is for Linux/UNIX systems:</p><pre class="pre codeblock"><code>cd $ORACLE_HOME/bin
./dbupgrade -d $ORACLE_HOME/rdbms/admin -l $ORACLE_HOME/cfgtoollogs -R</code></pre></li>
                        </ol>
                        <p>The Parallel Upgrade Utility completes the upgrade on <code class="codeph">CDB1_PDB1</code> and <code class="codeph">CDB1_PDB2</code>.
                        </p>
                     </div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-226F1EBA-3272-4BD2-A5FA-D08ED1BA5808__GUID-128F4B45-EE79-40B5-A847-E7084AB33384">
                        <p class="titleinexample">Example 4-41 Rerunning Upgrades With an Exclusion List</p>
                        <p>An exclusion list contains containers that you do not want to upgrade. An exclusion list uses the Parallel Upgrade Utility <code>-C</code> parameter option. Run the Parallel Upgrade utility by changing directory to <code><span class="variable" translate="no">Oracle_home</span>/rdbms/admin/</code> and running the utility in Perl using <code>catctl.pl</code>, or by changing directory to <code><span class="variable" translate="no">Oracle_home</span>/bin</code> and running the command-line script, <code>dbupgrade -C</code>. This method is useful when you have many PDBs on which you want to rerun the upgrade.
                        </p>
                        <p>In this following example, you provide an exclusion list to exclude the upgrade script from running on containers where you do not require it to run. </p>
                        <ol>
                           <li>
                              <p>Shut down the multitenant database, start up the database in upgrade mode, and then start up the PDBs on which the upgrade did not complete. For example:</p><pre class="pre codeblock"><code>SQL&gt; shutdown immediate;
      startup upgrade;
      alter pluggable database CDB1_PDB1 open upgrade;
      alter pluggable database CDB1_PDB2 open upgrade;
</code></pre></li>
                           <li>
                              <p>Show the CDB and PDB status:</p><pre class="pre codeblock"><code> SQL&gt; show pdbs
 
       CON_ID CON_NAME                       OPEN MODE  RESTRICTED
       ---------- ------------------------------ ---------- ----------
           2 PDB$SEED                       MIGRATE    YES
           3 CDB1_PDB1                      MIGRATE    YES
           4 CDB1_PDB2                      MIGRATE    YES
           5 CDB1_PDB3                      MOUNTED
           6 CDB1_PDB4                      MOUNTED
           7 CDB1_PDB5                      MOUNTED
</code></pre></li>
                           <li>
                              <p>Rerun the upgrade, excluding <code class="codeph">CDB$ROOT</code> and <code class="codeph">PDB$SEED</code> from the upgrade in a space-delimited exclusion list that you specify with single quote marks. The command example here is for Linux/UNIX systems: 
                              </p><pre class="pre codeblock"><code>$ORACLE_HOME/bin/dbupgrade -d $ORACLE_HOME/rdbms/admin -l $ORACLE_HOME/rdbms/log -C 'CDB$ROOT PDB$SEED'</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="example" -->
                     <p>The upgrade reruns, and completes on <code class="codeph">CDB1_PDB1</code> and <code class="codeph">CDB1_PDB2</code>.
                     </p>
                     <div class="infoboxnote" id="GUID-226F1EBA-3272-4BD2-A5FA-D08ED1BA5808__GUID-5C0750DB-9D77-4EC5-A370-B15FC92E9ED8">
                        <p class="notep1">Note:</p>
                        <p>For Windows, you must specify the <code class="codeph">-C</code> option exclusion list by using with double quote marks to specify the exclusion list. For example:
                        </p><pre class="pre codeblock"><code>... -C "CDB$ROOT PDB$SEED"</code></pre></div>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="rerunning-upgrades-oracle-database.html#GUID-CF18A968-0C0E-4223-AA9F-37B39F31ACBA" title="There are four options you can use to rerun upgrades on multitenant database architecture (CDBs) for Oracle Database 12c release 2 (12.2).">Options for Rerunning the Upgrade for Multitenant Databases (CDBs)</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="props_rev_3"><a id="GUID-BC8D35BA-2FDE-434C-936B-E7432B2F00AA" name="GUID-BC8D35BA-2FDE-434C-936B-E7432B2F00AA"></a><h4 id="UPGRD-GUID-BC8D35BA-2FDE-434C-936B-E7432B2F00AA" class="sect4">Rerun the Upgrade While Other PDBs Are Online</h4>
                  <div>
                     <p>You can rerun PDB upgrades by using the Parallel Upgrade Utility Resume option, or by explicitly including or excluding online PDBs using with inclusion or exclusion lists.</p>
                     <p>Use these examples as a model for running upgrades on PDBs, where you want to rerun upgrades on some PDBs while other PDBs are open. </p>
                     <p>In the examples, the upgrade failed in containers <code class="codeph">CDB1_PDB1</code> and <code class="codeph">CDB1_PDB2</code>, but succeeded in containers <code class="codeph">CDB1_PDB3</code>, <code class="codeph">CDB1_PDB4</code>, and <code class="codeph">CDB1_PDB5</code>. 
                     </p>
                     <p>You start up <code class="codeph">CDB$ROOT</code> in normal mode. You find that the following containers are online: <code class="codeph">CDB1_PDB3</code>, <code class="codeph">CDB1_PDB4</code>, and <code class="codeph">CDB1_PDB5</code> . You review the upgrade logs for <code class="codeph">CDB1_PDB3</code>, <code class="codeph">CDB1_PDB4</code>, and <code class="codeph">CDB1_PDB5</code> and bring these containers online.
                     </p>
                     <p></p>
                     <div class="example" id="GUID-BC8D35BA-2FDE-434C-936B-E7432B2F00AA__GUID-E28BE9B3-BE6B-45AA-8C58-1B34A27275FB">
                        <p class="titleinexample">Example 4-42 Rerunning Upgrades on PDBs Using the Resume Option</p>
                        <p>The following example shows how to complete the upgrade for <code class="codeph">CDB1_PDB1</code> and <code class="codeph">CDB1_PDB2</code> by using the Parallel Upgrade Utility Resume option. The Resume option excludes PDBs that are already upgraded:
                        </p>
                        <ol>
                           <li>
                              <p>Bring up <code class="codeph">CDB$ROOT</code> in normal mode, and open <code class="codeph">CDB1_PDB1</code> and <code class="codeph">CDB1_PDB2</code> in upgrade mode. <code class="codeph">CDB1_PDB3</code>, <code class="codeph">CDB1_PDB4</code>, <code class="codeph">CDB1_PDB5</code> are in normal mode. For example:
                              </p><pre class="oac_no_warn" dir="ltr">SQL&gt; startup;
      alter pluggable database CDB1_PDB1 open upgrade;
      alter pluggable database CDB1_PDB2 open upgrade;
      alter pluggable database cdb1_pdb3 open;
      alter pluggable database cdb1_pdb4 open;
      alter pluggable database cdb1_pdb5 open;
</pre></li>
                           <li>
                              <p>Use the SQL command <code>show pdbs</code> to show the status of PDBs. For example:
                              </p><pre class="oac_no_warn" dir="ltr">SQL&gt; show pdbs

        CON_ID CON_NAME                       OPEN MODE  RESTRICTED
        ---------- ------------------------------ ---------- ----------
             2 PDB$SEED                       READ ONLY  NO
             3 CDB1_PDB1                      MIGRATE    YES
             4 CDB1_PDB2                      MIGRATE    YES
             5 CDB1_PDB3                      READ WRITE NO
             6 CDB1_PDB4                      READ WRITE NO
             7 CDB1_PDB5                      READ WRITE NO
</pre></li>
                           <li>
                              <p>Rerun the upgrade, excluding <code class="codeph">CDB$ROOT</code> from the upgrade, using the Parallel Upgrade Utility command-line script <code>dbupgrade</code>.
                              </p><pre class="pre codeblock"><code>cd $ORACLE_HOME/bin
./dbupgrade -d $ORACLE_HOME/rdbms/admin/ -l $ORACLE_HOME/cfgtoollogs -R</code></pre><p>Because you run the upgrade using the Resume option, the Parallel Upgrade Utility checks the logs and identifies that <code class="codeph">CDB1_PDB1</code> and <code class="codeph">CDB1_PDB2</code> are the only two containers in <code class="codeph">CDB1</code> that are not upgraded. The upgrade script runs on just those two PDBs. The upgrade does not rerun on <code class="codeph">PDB$SEED</code>, <code class="codeph">CDB$ROOT</code>, <code class="codeph">CDB_PDB3</code>, <code class="codeph">CDB_PDB4</code>, and <code class="codeph">CDB_PDB5</code>. 
                              </p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-BC8D35BA-2FDE-434C-936B-E7432B2F00AA__GUID-07447E6C-9536-4DD9-9BF2-A52327B34F76">
                        <p class="titleinexample">Example 4-43 Rerunning Upgrades on PDBs Using Exclusion Lists</p>
                        <p>The following example shows how to complete the upgrade for <code class="codeph">CDB1_PDB1</code> and <code class="codeph">CDB1_PDB2</code> by using an exclusion list to exclude the PDBs on which you do not want the upgrade script to run:
                        </p>
                        <ol>
                           <li>
                              <p>Bring up <code class="codeph">CDB$ROOT</code> in normal mode, and open <code class="codeph">CDB1_PDB1</code> and <code class="codeph">CDB1_PDB2</code> in upgrade mode. <code class="codeph">CDB1_PDB3</code>, <code class="codeph">CDB1_PDB4</code>, <code class="codeph">CDB1_PDB5</code> are in normal mode. For example:
                              </p><pre class="oac_no_warn" dir="ltr">SQL&gt; startup;
      alter pluggable database CDB1_PDB1 open upgrade;
      alter pluggable database CDB1_PDB2 open upgrade;
      alter pluggable database cdb1_pdb3 open;
      alter pluggable database cdb1_pdb4 open;
      alter pluggable database cdb1_pdb5 open;
</pre></li>
                           <li>
                              <p>Use the SQL command <code>show pdbs</code> to show the status of PDBs. For example:
                              </p><pre class="oac_no_warn" dir="ltr">SQL&gt; show pdbs

        CON_ID CON_NAME                       OPEN MODE  RESTRICTED
        ---------- ------------------------------ ---------- ----------
             2 PDB$SEED                       READ ONLY  NO
             3 CDB1_PDB1                      MIGRATE    YES
             4 CDB1_PDB2                      MIGRATE    YES
             5 CDB1_PDB3                      READ WRITE NO
             6 CDB1_PDB4                      READ WRITE NO
             7 CDB1_PDB5                      READ WRITE NO
</pre></li>
                           <li>
                              <p>Rerun the upgrade, excluding <code class="codeph">CDB$ROOT</code> from the upgrade, using the Parallel Upgrade Utility command-line script <code>dbupgrade</code>:
                              </p><pre class="pre codeblock"><code>cd $ORACLE_HOME/bin
./dbupgrade -d $ORACLE_HOME/rdbms/admin -l $ORACLE_HOME/cfgtoollogs -R -C 'CDB$ROOT'</code></pre><p>The Parallel Upgrade Utility runs with the Resume option (<code class="codeph">-R</code>), and identifies from the logs that CDB1_PDB1 and
                              </p>
                              <p>CDB1_PDB2 have not completed the upgrade. Because the Parallel Upgrade Utility runs with the Exclude option (-C), and you specify that <code class="codeph">CDB$ROOT</code> is excluded, the upgrade script is also explicitly excluded from running on <code class="codeph">CDB$ROOT</code>. 
                              </p>
                              <p>For Windows, when you run the Parallel Upgrade Utility with the Exclude option (<code class="codeph">-C</code>), you must specify the targets <code>-C</code> option using double quotes around the CDB root name and PDB seed name. For example:
                              </p><pre class="pre codeblock"><code>. . . -C "CDB$ROOT PDB$SEED"</code></pre></li>
                           <li>
                              <p>The upgrade reruns and completes on <code class="codeph">CDB1_PDB1</code> and <code class="codeph">CDB1_PDB2</code>.
                              </p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="rerunning-upgrades-oracle-database.html#GUID-CF18A968-0C0E-4223-AA9F-37B39F31ACBA" title="There are four options you can use to rerun upgrades on multitenant database architecture (CDBs) for Oracle Database 12c release 2 (12.2).">Options for Rerunning the Upgrade for Multitenant Databases (CDBs)</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="props_rev_3"><a id="GUID-B8C68634-CB6B-415D-BB31-E8E11EBAF742" name="GUID-B8C68634-CB6B-415D-BB31-E8E11EBAF742"></a><h4 id="UPGRD-GUID-B8C68634-CB6B-415D-BB31-E8E11EBAF742" class="sect4">Rerun the Upgrade Using an Inclusion List to Specify a CDB or PDBs</h4>
                  <div>
                     <p>Use this example as a model for rerunning an upgrade on a PDB by using an inclusion list. </p>
                     <p>You can use an inclusion list to specify a list of CDBs and PDBs where you want to re-run an upgrade, and exclude nodes not on the inclusion list. Specify the inclusion list by running the Parallel Upgrade Utility with the inclusion option (<code class="codeph">-c</code>), followed by a space-delimited list designated by single quotes of the containers that you want to upgrade. 
                     </p>
                     <p>In the examples, the upgrade failed in containers CDB1_PDB1 and CDB1_PDB2, but succeeded in containers CDB1_PDB3, CDB1_PDB4, and CDB1_PDB5. You start up CDB$ROOT in normal mode. You find that the following containers are online: CDB1_PDB3, CDB1_PDB4, and CDB1_PDB5 . You review the upgrade logs for CDB1_PDB3, CDB1_PDB4, and CDB1_PDB5 and bring these containers online.</p>
                     <div class="example" id="GUID-B8C68634-CB6B-415D-BB31-E8E11EBAF742__GUID-DCE99A6B-AEAA-41E9-AD83-5B4643B2A229">
                        <p class="titleinexample">Example 4-44 Rerunning Upgrades on PDBs Using an Inclusion List</p>
                     </div>
                     <!-- class="example" -->
                     <p>For example: </p>
                     <ol>
                        <li>
                           <p>Bring up <code class="codeph">CDB$ROOT</code> in normal mode, and open <code class="codeph">CDB1_PDB1</code> and <code class="codeph">CDB1_PDB2</code> in upgrade mode. <code class="codeph">CDB1_PDB3</code>, <code class="codeph">CDB1_PDB4</code>, <code class="codeph">CDB1_PDB5</code> are in normal mode. For example:
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; startup;
      alter pluggable database CDB1_PDB1 open upgrade;
      alter pluggable database CDB1_PDB2 open upgrade;
      alter pluggable database cdb1_pdb3 open;
      alter pluggable database cdb1_pdb4 open;
      alter pluggable database cdb1_pdb5 open;
</pre></li>
                        <li>
                           <p>Use the SQL command <code>show pdbs</code> to show the status of PDBs. For example:
                           </p><pre class="oac_no_warn" dir="ltr">SQL&gt; show pdbs

        CON_ID CON_NAME                       OPEN MODE  RESTRICTED
        ---------- ------------------------------ ---------- ----------
             2 PDB$SEED                       READ ONLY  NO
             3 CDB1_PDB1                      MIGRATE    YES
             4 CDB1_PDB2                      MIGRATE    YES
             5 CDB1_PDB3                      READ WRITE NO
             6 CDB1_PDB4                      READ WRITE NO
             7 CDB1_PDB5                      READ WRITE NO
</pre></li>
                        <li>
                           <p>Rerun the Parallel Upgrade Utility with the inclusion (-c) option, followed by a space-delimited inclusion list that you specify with single quote marks. This option runs the upgrade only on the PDBs that you list in the inclusion list.</p>
                           <p>For example:</p><pre class="pre codeblock"><code>cd $ORACLE_HOME/bin
./dbupgrade -d $ORACLE_HOME/rdbms/admin -l ORACLE_HOME/cfgtoollogs -R -c 'CDB1_PDB1 CDB1_PDB2'</code></pre><p>For Windows, when you run the Parallel Upgrade Utility with the inclusion option, you must specify the <code class="codeph">-c</code> option targets by using double quotes around the inclusion list. For example:
                           </p><pre class="pre codeblock"><code>. . . -C "CDB1_PDB1 CDB1_PDB2"</code></pre></li>
                        <li>
                           <p>The upgrade reruns and completes on <code class="codeph">CDB1_PDB1</code> and <code class="codeph">CDB1_PDB2</code>.
                           </p>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="rerunning-upgrades-oracle-database.html#GUID-CF18A968-0C0E-4223-AA9F-37B39F31ACBA" title="There are four options you can use to rerun upgrades on multitenant database architecture (CDBs) for Oracle Database 12c release 2 (12.2).">Options for Rerunning the Upgrade for Multitenant Databases (CDBs)</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>