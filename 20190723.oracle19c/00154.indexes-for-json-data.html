<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="You can index JSON data as you would any data of the type you use to store it. In addition, you can define a JSON search index, which is useful for both ad hoc structural queries and full-text queries.">
      <meta name="description" content="You can index JSON data as you would any data of the type you use to store it. In addition, you can define a JSON search index, which is useful for both ad hoc structural queries and full-text queries.">
      <title>Indexes for JSON Data</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="JSON Developer's Guide">
      <meta property="og:description" content="You can index JSON data as you would any data of the type you use to store it. In addition, you can define a JSON search index, which is useful for both ad hoc structural queries and full-text queries.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="JSON Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="json-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-02-22T10:58:31-08:00">
      <meta name="dcterms.title" content="JSON Developer's Guide">
      <meta name="dcterms.dateCopyrighted" content="2015, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96227-03">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="overview-of-performance-improvement-for-json.html" title="Previous" type="text/html">
      <link rel="next" href="in-memory-json-data.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="ADJSN">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="overview-of-performance-improvement-for-json.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="in-memory-json-data.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">JSON Developer's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="performance-tuning-for-json-data.html" property="item" typeof="WebPage"><span property="name">Performance Tuning for JSON</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Indexes for JSON Data</li>
            </ol>
            <a id="GUID-8A1B098E-D4FE-436E-A715-D8B465655C0D" name="GUID-8A1B098E-D4FE-436E-A715-D8B465655C0D"></a>
            
            <h2 id="ADJSN-GUID-8A1B098E-D4FE-436E-A715-D8B465655C0D" class="sect2"><span class="enumeration_chapter">26 </span>Indexes for JSON Data
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>You can index JSON data as you would any data of the type you use to store it. In addition, you can define a JSON search index, which is useful for both ad hoc structural queries and full-text queries.</p>
               <div class="section"></div>
               <!-- class="section" -->
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="indexes-for-json-data.html#GUID-257BD1FC-410E-4C15-8C42-84F93EB61FCA">Overview of Indexing JSON Data</a><br>There is no dedicated SQL data type for JSON data, so you can index it in the usual ways. In addition, you can index it in a general way, with a JSON search index, for ad hoc structural queries and full-text queries.
                  </li>
                  <li class="ulchildlink"><a href="indexes-for-json-data.html#GUID-7DD291FB-F22C-4AB9-ABDD-9D55CFB6CCAD">How To Tell Whether a Function-Based Index for JSON Data Is Picked Up</a><br>To determine whether a given query picks up a given function-based index, look for the index name in the execution plan for the query. 
                  </li>
                  <li class="ulchildlink"><a href="indexes-for-json-data.html#GUID-DD0EE42E-7670-4AF8-8342-7BE97835F866">Creating Bitmap Indexes for SQL/JSON Condition JSON_EXISTS</a><br>You can create a bitmap index for the value returned by <code class="codeph">json_exists</code>. This is the right kind of index to use for <code class="codeph">json_exists</code>, because there are only two possible return values for a condition (true and false).
                  </li>
                  <li class="ulchildlink"><a href="indexes-for-json-data.html#GUID-FEE83855-780A-424B-9916-B899BFF2077B">Creating JSON_VALUE Function-Based Indexes</a><br>You can create a function-based index for SQL/JSON function <code class="codeph">json_value</code>. You can use the standard syntax for this, explicitly specifying function <code class="codeph">json_value</code>, or you can use the simple dot-notation syntax. Indexes created in either of these ways can be used with both dot-notation queries and <code class="codeph">json_value</code> queries.
                  </li>
                  <li class="ulchildlink"><a href="indexes-for-json-data.html#GUID-7CEAFFC2-C7B8-4223-BAD9-870858990939">Using a JSON_VALUE Function-Based Index with JSON_TABLE Queries</a><br>An index created using <code class="codeph">json_value</code> with <code class="codeph">ERROR ON ERROR</code> can be used for a query involving <code class="codeph">json_table</code>, if the <code class="codeph">WHERE</code> clause refers to a column projected by <code class="codeph">json_table</code>, and the effective SQL/JSON path that targets that column matches the indexed path expression. 
                  </li>
                  <li class="ulchildlink"><a href="indexes-for-json-data.html#GUID-E3721DDA-23C9-4859-B13B-FAA8544C32F8">Using a JSON_VALUE Function-Based Index with JSON_EXISTS Queries</a><br>An index created using SQL/JSON function <code class="codeph">json_value</code> with       <code class="codeph">ERROR ON ERROR</code> can be used for a query involving SQL/JSON condition       <code class="codeph">json_exists</code>, provided the query path expression has a filter expression that     contains only a <span class="italic">path-expression comparison</span> or multiple such comparisons separated by       <code class="codeph">&amp;&amp;</code>.
                  </li>
                  <li class="ulchildlink"><a href="indexes-for-json-data.html#GUID-90D76388-F022-444C-B5CD-0A7C27FEE30D">Data Type Considerations for JSON_VALUE Indexing and Querying</a><br>By default, SQL/JSON function <code class="codeph">json_value</code> returns a <code class="codeph">VARCHAR2</code> value. When you create a function-based index using <code class="codeph">json_value</code>, unless you use a <code class="codeph">RETURNING</code> clause to specify a different return data type, the index is not picked up for a query that expects a non-<code class="codeph">VARCHAR2</code> value. 
                  </li>
                  <li class="ulchildlink"><a href="indexes-for-json-data.html#GUID-47CEF6AA-0FCF-40D2-90E0-C57C0B0E816F">Indexing Multiple JSON Fields Using a Composite B-Tree Index</a><br>To index multiple fields of a JSON object, you first create virtual columns for them. Then you create a composite B-tree index on the virtual columns. 
                  </li>
                  <li class="ulchildlink"><a href="indexes-for-json-data.html#GUID-D7A604E1-F617-4C92-A9D9-00B6AB78EFD8">JSON Search Index: Ad Hoc Queries and Full-Text Search</a><br>A JSON search index is a <span class="italic">general</span> index. It can improve the     performance of both (1) ad hoc structural queries, that is, queries that you might not     anticipate or use regularly, and (2) full-text search. It is an Oracle Text index that is     designed specifically for use with JSON data.
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>Parent topic:</strong> <a href="performance-tuning-for-json-data.html#GUID-D3A3F17B-8372-43A7-83A3-E37C22E9011E" title="To tune query performance you can index JSON fields in several ways, store their values in the In-Memory Column Store (IM column store), or expose them as non-JSON data using materialized views.">Performance Tuning for JSON</a></p>
                  </div>
               </div>
            </div>
            
            <div class="sect2"><a id="GUID-257BD1FC-410E-4C15-8C42-84F93EB61FCA" name="GUID-257BD1FC-410E-4C15-8C42-84F93EB61FCA"></a><h3 id="ADJSN-GUID-257BD1FC-410E-4C15-8C42-84F93EB61FCA" class="sect3"><span class="enumeration_section">26.1 </span>Overview of Indexing JSON Data
               </h3>
               <div>
                  <p>There is no dedicated SQL data type for JSON data, so you can index it in the usual ways. In addition, you can index it in a general way, with a JSON search index, for ad hoc structural queries and full-text queries.</p>
                  <p>You can index JSON data as you would any data of the type that you use to store it. In particular, you can use a B-tree index or a bitmap index for SQL/JSON function <code class="codeph">json_value</code>, and you can use a bitmap index for SQL/JSON conditions <code class="codeph">is json</code>, <code class="codeph">is not json</code>, and <code class="codeph">json_exists</code>.
                  </p>
                  <p>(More generally, a bitmap index can be appropriate wherever the number of possible values for the function is small. For example, you can use a bitmap index for function <code class="codeph">json_value</code> if the value is expected to be Boolean or otherwise one of a small number of string values.)
                  </p>
                  <p>As always, such function-based indexing is appropriate for queries that target particular functions, which in the context of SQL/JSON functions means particular SQL/JSON <span class="italic">path expressions</span>. It is not very helpful for queries that are ad hoc, that is, arbitrary. Define a function-based index if you know that you will often query a particular path expression.
                  </p>
                  <p>If you query in an ad hoc manner then define a <strong class="term">JSON search index</strong>. This is a general index, <span class="italic">not targeted</span> to any specific path expression. It is appropriate for <span class="italic">structural</span> queries, such as looking for a JSON field with a particular value, and for <span class="italic">full-text</span> queries using SQL/JSON condition <code class="codeph">json_textcontains</code>, such as looking for a particular word among various string values.
                  </p>
                  <p>You can of course define both function-based indexes and a JSON search index for the same JSON column.</p>
                  <p>A JSON search index is an Oracle Text (full-text) index designed specifically for use with JSON data.</p>
                  <div class="infoboxnote" id="GUID-257BD1FC-410E-4C15-8C42-84F93EB61FCA__GUID-C7569A37-C693-4C3A-9BC4-765D99432FD3">
                     <p class="notep1">Note:</p>
                     <p>Oracle recommends that you use AL32UTF8 as the database character set. Automatic character-set conversion can take place when creating or applying an index. Such conversion can be lossy, which can mean that some data that you might expect to be returned by a query is not returned. See <a href="json-character-sets-and-encoding.html#GUID-2BD7911A-0201-4BEC-906E-D174267B438A" title="JSON data always uses the Unicode character set. In this respect, JSON data is simpler to use than XML data. This is an important part of the JSON Data Interchange Format (RFC 4627). For JSON data processed by Oracle Database, any needed character-set conversions are performed automatically.">Character Sets and Character Encoding for JSON Data</a>.
                     </p>
                  </div>
                  <div class="section"></div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="using-GeoJSON-geographic-data.html#GUID-2AD827B4-871E-4652-87F3-AC33FE7839AE" title="GeoJSON objects are JSON objects that represent geographic data. Examples are provided of creating GeoJSON data, indexing it, and querying it.">Using GeoJSON Geographic Data</a></li>
                        <li><a href="indexes-for-json-data.html#GUID-D7A604E1-F617-4C92-A9D9-00B6AB78EFD8" title="A JSON search index is a general index. It can improve the performance of both (1) ad hoc structural queries, that is, queries that you might not anticipate or use regularly, and (2) full-text search. It is an Oracle Text index that is designed specifically for use with JSON data.">JSON Search Index: Ad Hoc Queries and Full-Text Search</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="indexes-for-json-data.html#GUID-8A1B098E-D4FE-436E-A715-D8B465655C0D" title="You can index JSON data as you would any data of the type you use to store it. In addition, you can define a JSON search index, which is useful for both ad hoc structural queries and full-text queries.">Indexes for JSON Data</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB6394"></a><div class="props_rev_3"><a id="GUID-7DD291FB-F22C-4AB9-ABDD-9D55CFB6CCAD" name="GUID-7DD291FB-F22C-4AB9-ABDD-9D55CFB6CCAD"></a><h3 id="ADJSN-GUID-7DD291FB-F22C-4AB9-ABDD-9D55CFB6CCAD" class="sect3"><span class="enumeration_section">26.2 </span>How To Tell Whether a Function-Based Index for JSON Data Is Picked Up
               </h3>
               <div>
                  <p>To determine whether a given query picks up a given function-based index, look for the index name in the execution plan for the query. </p>
                  <div class="section">
                     <p>For example, given the index defined in <a href="indexes-for-json-data.html#GUID-FEE83855-780A-424B-9916-B899BFF2077B__CACFJJDA">Example 26-4</a>, an execution plan for the <code class="codeph">json_value</code> query of <a href="simple-dot-notation-access-to-json-data.html#GUID-7249417B-A337-4854-8040-192D5CEFD576__CACGDHDB">Example 12-1</a> references an index scan with index <code class="codeph">po_num_id1</code>.
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="indexes-for-json-data.html#GUID-8A1B098E-D4FE-436E-A715-D8B465655C0D" title="You can index JSON data as you would any data of the type you use to store it. In addition, you can define a JSON search index, which is useful for both ad hoc structural queries and full-text queries.">Indexes for JSON Data</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB6271"></a><a id="ADXDB6396"></a><a id="ADXDB6395"></a><div class="props_rev_3"><a id="GUID-DD0EE42E-7670-4AF8-8342-7BE97835F866" name="GUID-DD0EE42E-7670-4AF8-8342-7BE97835F866"></a><h3 id="ADJSN-GUID-DD0EE42E-7670-4AF8-8342-7BE97835F866" class="sect3"><span class="enumeration_section">26.3 </span>Creating Bitmap Indexes for SQL/JSON Condition JSON_EXISTS
               </h3>
               <div>
                  <p>You can create a bitmap index for the value returned by <code class="codeph">json_exists</code>. This is the right kind of index to use for <code class="codeph">json_exists</code>, because there are only two possible return values for a condition (true and false).
                  </p>
                  <div class="section">
                     <p>This is illustrated by <a href="indexes-for-json-data.html#GUID-DD0EE42E-7670-4AF8-8342-7BE97835F866__CACCCEBD">Example 26-1</a>. 
                     </p>
                     <p><a href="indexes-for-json-data.html#GUID-DD0EE42E-7670-4AF8-8342-7BE97835F866__CACEIFEE">Example 26-2</a> creates a bitmap index for a value returned by <code class="codeph">json_value</code>. This is an appropriate index to use <span class="italic">if</span> there are only few possible values for field <code class="codeph">CostCenter</code> in your data.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-DD0EE42E-7670-4AF8-8342-7BE97835F866__CACCCEBD">
                     <p class="titleinexample">Example 26-1 Creating a Bitmap Index for JSON_EXISTS</p><pre class="pre codeblock"><code>CREATE BITMAP INDEX has_zipcode_idx
  ON j_purchaseorder (<span class="bold">json_exists</span>(po_document, 
                                  '$.ShippingInstructions.Address.zipCode'));
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-DD0EE42E-7670-4AF8-8342-7BE97835F866__CACEIFEE">
                     <p class="titleinexample">Example 26-2 Creating a Bitmap Index for JSON_VALUE</p><pre class="pre codeblock"><code>CREATE BITMAP INDEX cost_ctr_idx
  ON j_purchaseorder (<span class="bold">json_value</span>(po_document, '$.CostCenter'));
</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="indexes-for-json-data.html#GUID-8A1B098E-D4FE-436E-A715-D8B465655C0D" title="You can index JSON data as you would any data of the type you use to store it. In addition, you can define a JSON search index, which is useful for both ad hoc structural queries and full-text queries.">Indexes for JSON Data</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB6267"></a><a id="ADXDB6398"></a><a id="ADXDB6397"></a><div class="props_rev_3"><a id="GUID-FEE83855-780A-424B-9916-B899BFF2077B" name="GUID-FEE83855-780A-424B-9916-B899BFF2077B"></a><h3 id="ADJSN-GUID-FEE83855-780A-424B-9916-B899BFF2077B" class="sect3"><span class="enumeration_section">26.4 </span>Creating JSON_VALUE Function-Based Indexes
               </h3>
               <div>
                  <p>You can create a function-based index for SQL/JSON function <code class="codeph">json_value</code>. You can use the standard syntax for this, explicitly specifying function <code class="codeph">json_value</code>, or you can use the simple dot-notation syntax. Indexes created in either of these ways can be used with both dot-notation queries and <code class="codeph">json_value</code> queries.
                  </p>
                  <div class="section">
                     <p><a href="indexes-for-json-data.html#GUID-FEE83855-780A-424B-9916-B899BFF2077B__CACFJJDA">Example 26-4</a> creates a function-based index for <code class="codeph">json_value</code> on field <code class="codeph">PONumber</code> of the object that is in column <code class="codeph">po_document</code> of table <code class="codeph">j_purchaseorder</code>. The object is passed as the path-expression context item.
                     </p>
                     <p>The use of <code class="codeph">ERROR ON ERROR</code> here means that if the data contains a record that has <span class="italic">no</span> <code class="codeph">PONumber</code> field, has <span class="italic">more than one</span> <code class="codeph">PONumber</code> field, or has a <code class="codeph">PONumber</code> field with a <span class="italic">non-number</span> value then index creation fails. And if the index exists then trying to insert such a record fails.
                     </p>
                     <p>An alternative is to create an index using the simplified syntax described in <a href="simple-dot-notation-access-to-json-data.html#GUID-7249417B-A337-4854-8040-192D5CEFD576" title="Dot notation is designed for easy, general use and common use cases. Queries of JSON data that use dot-notation syntax return JSON values whenever possible.">Simple Dot-Notation Access to JSON Data</a>. <a href="indexes-for-json-data.html#GUID-FEE83855-780A-424B-9916-B899BFF2077B__CACHAAIA">Example 26-3</a> illustrates this; it indexes both scalar and non-scalar results, corresponding to what a dot-notation query can return.
                     </p>
                     <p>The indexes created in both <a href="indexes-for-json-data.html#GUID-FEE83855-780A-424B-9916-B899BFF2077B__CACFJJDA">Example 26-4</a> and <a href="indexes-for-json-data.html#GUID-FEE83855-780A-424B-9916-B899BFF2077B__CACHAAIA">Example 26-3</a> can be picked up for either a query that uses dot-notation syntax or a query that uses <code class="codeph">json_value</code>. 
                     </p>
                     <p>If the index of <a href="indexes-for-json-data.html#GUID-FEE83855-780A-424B-9916-B899BFF2077B__CACHAAIA">Example 26-3</a> is picked up for a <code class="codeph">json_value</code> query then filtering is applied after index pickup, to test for the correct field value. Non-scalar values can be stored in this index, since dot-notation queries can return such values, but a <code class="codeph">json_value</code> query cannot, so such values are filtered out after index pickup.
                     </p>
                     <p>If you want to allow indexing of data that might be missing the field targeted by a <code class="codeph">json_value</code> expression, then use a <code class="codeph">NULL ON EMPTY</code> clause, together with an <code class="codeph">ERROR ON ERROR</code> clause. <a href="indexes-for-json-data.html#GUID-FEE83855-780A-424B-9916-B899BFF2077B__GUID-A257EAA2-C71C-4F6B-A76F-CA539EACD555">Example 26-5</a> illustrates this.
                     </p>
                     <p>Oracle <span class="italic">recommends</span> that you create a function-based index for <code class="codeph">json_value</code> using one of these forms:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Dot-notation syntax</p>
                           <p>The indexed values correspond to the flexible behavior of dot-notation queries, which return JSON values whenever possible. They can include non-scalar JSON values (JSON objects and arrays). They can match dot-notation queries in addition to <code class="codeph">json_value</code> queries. The index is used to come up with an initial set of matches, which are then filtered according to the specifics of the query. For example, any indexed values that are not JSON scalars are filtered out.
                           </p>
                        </li>
                        <li>
                           <p>A <code class="codeph">json_value</code> expression that specifies a <span class="bold"><code class="codeph">RETURNING</code></span> data type, uses <span class="bold"><code class="codeph">ERROR ON ERROR</code></span> (and optionally uses <code class="codeph">NULL ON EMPTY</code>).
                           </p>
                           <p>The indexed values are only (non-<code class="codeph">null</code>) scalar values of the specified data type. The index can nevertheless be used in dot-notation queries that lead to such a scalar result.
                           </p>
                        </li>
                     </ul>
                     <p>Indexes created in either of these ways can thus be used with both dot-notation queries and <code class="codeph">json_value</code> queries. 
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-FEE83855-780A-424B-9916-B899BFF2077B__CACHAAIA">
                     <p class="titleinexample">Example 26-3 Creating a Function-Based Index for a JSON Field: Dot Notation</p><pre class="pre codeblock"><code>CREATE UNIQUE INDEX po_num_idx2 ON j_purchaseorder po (po.po_document.<span class="bold">PONumber</span>);
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-FEE83855-780A-424B-9916-B899BFF2077B__CACFJJDA">
                     <p class="titleinexample">Example 26-4 Creating a Function-Based Index for a JSON Field: JSON_VALUE</p><pre class="pre codeblock"><code>CREATE UNIQUE INDEX po_num_idx1
  ON j_purchaseorder (<span class="bold">json_value</span>(po_document, '$.<span class="bold">PONumber</span>' 
                                 <span class="bold">RETURNING NUMBER</span> <span class="bold">ERROR ON ERROR</span>));
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-FEE83855-780A-424B-9916-B899BFF2077B__GUID-A257EAA2-C71C-4F6B-A76F-CA539EACD555">
                     <p class="titleinexample">Example 26-5 Specifying NULL ON EMPTY for a JSON_VALUE Function-Based Index</p>
                     <p>Because of clause <code class="codeph">NULL ON EMPTY</code>, index <code class="codeph">po_ref_idx1</code> can index JSON documents that have no <code class="codeph">Reference</code> field.
                     </p><pre class="pre codeblock"><code>CREATE UNIQUE INDEX po_ref_idx1
  ON j_purchaseorder (json_value(po_document, '$.Reference'
                                 RETURNING VARCHAR2(200) ERROR ON ERROR
                                 <span class="bold">NULL ON EMPTY</span>));</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="clauses-used-in-functions-and-conditions-for-json.html#GUID-3176ECEA-BBCE-4C7C-AB24-7FCE250B8443" title="SQL/JSON query functions json_value, json_query, and json_table accept an optional ON EMPTY clause, which specifies the handling to use when a targeted JSON field is absent from the data queried. This clause and the default behavior (no ON EMPTY clause) are described here.">Empty-Field Clause for SQL/JSON Query Functions</a></li>
                        <li><a href="using-GeoJSON-geographic-data.html#GUID-2AD827B4-871E-4652-87F3-AC33FE7839AE" title="GeoJSON objects are JSON objects that represent geographic data. Examples are provided of creating GeoJSON data, indexing it, and querying it.">Using GeoJSON Geographic Data</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="indexes-for-json-data.html#GUID-8A1B098E-D4FE-436E-A715-D8B465655C0D" title="You can index JSON data as you would any data of the type you use to store it. In addition, you can define a JSON search index, which is useful for both ad hoc structural queries and full-text queries.">Indexes for JSON Data</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB6400"></a><a id="ADXDB6399"></a><div class="props_rev_3"><a id="GUID-7CEAFFC2-C7B8-4223-BAD9-870858990939" name="GUID-7CEAFFC2-C7B8-4223-BAD9-870858990939"></a><h3 id="ADJSN-GUID-7CEAFFC2-C7B8-4223-BAD9-870858990939" class="sect3"><span class="enumeration_section">26.5 </span>Using a JSON_VALUE Function-Based Index with JSON_TABLE Queries
               </h3>
               <div>
                  <p>An index created using <code class="codeph">json_value</code> with <code class="codeph">ERROR ON ERROR</code> can be used for a query involving <code class="codeph">json_table</code>, if the <code class="codeph">WHERE</code> clause refers to a column projected by <code class="codeph">json_table</code>, and the effective SQL/JSON path that targets that column matches the indexed path expression. 
                  </p>
                  <div class="section">
                     <p>The index acts as a constraint on the indexed path, to ensure that only one (non-<code class="codeph">null</code>) scalar JSON value is projected for each item in the JSON collection. 
                     </p>
                     <p>The query in <a href="indexes-for-json-data.html#GUID-7CEAFFC2-C7B8-4223-BAD9-870858990939__CACBJDFA">Example 26-6</a> thus makes use of the index created in <a href="indexes-for-json-data.html#GUID-FEE83855-780A-424B-9916-B899BFF2077B__CACFJJDA">Example 26-4</a>.
                     </p>
                     <div class="infoboxnote" id="GUID-7CEAFFC2-C7B8-4223-BAD9-870858990939__GUID-5973FB45-8522-43DA-905D-E56D1D9D8EE6">
                        <p class="notep1">Note:</p>
                        <p>A function-based index created using a <code class="codeph">json_value</code> expression or dot notation can be picked up for a corresponding occurrence in a query <code class="codeph">WHERE</code> clause only if the occurrence is used in a SQL <span class="italic">comparison</span> condition, such as <code class="codeph">&gt;=</code>. In particular, it is not picked up for an occurrence used in condition <code class="codeph">IS NULL</code> or <code class="codeph">IS NOT NULL</code>.
                        </p>
                        <p>See <a href="../sqlrf/Comparison-Conditions.html#SQLRF52105" target="_blank"><span><cite>Oracle Database SQL Language Reference</cite></span></a> for information about SQL comparison conditions.
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-7CEAFFC2-C7B8-4223-BAD9-870858990939__CACBJDFA">
                     <p class="titleinexample">Example 26-6 Use of a JSON_VALUE Function-Based Index with a JSON_TABLE Query</p><pre class="pre codeblock"><code>SELECT jt.*
  FROM j_purchaseorder po,
       json_table(po.po_document, '$'
         COLUMNS po_number  NUMBER(5) PATH '$.<span class="bold">PONumber</span>',
                 reference  VARCHAR2(30 CHAR) PATH '$.Reference',
                 requestor  VARCHAR2(32 CHAR) PATH '$.Requestor',
                 userid     VARCHAR2(10 CHAR) PATH '$.User',
                 costcenter VARCHAR2(16 CHAR) PATH '$.CostCenter') jt
  <span class="bold">WHERE po_number = 1600;</span>
</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="indexes-for-json-data.html#GUID-8A1B098E-D4FE-436E-A715-D8B465655C0D" title="You can index JSON data as you would any data of the type you use to store it. In addition, you can define a JSON search index, which is useful for both ad hoc structural queries and full-text queries.">Indexes for JSON Data</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-E3721DDA-23C9-4859-B13B-FAA8544C32F8" name="GUID-E3721DDA-23C9-4859-B13B-FAA8544C32F8"></a><h3 id="ADJSN-GUID-E3721DDA-23C9-4859-B13B-FAA8544C32F8" class="sect3"><span class="enumeration_section">26.6 </span>Using a JSON_VALUE Function-Based Index with
    JSON_EXISTS Queries
               </h3>
               <div>
                  <p>An index created using SQL/JSON function <code class="codeph">json_value</code> with
      <code class="codeph">ERROR ON ERROR</code> can be used for a query involving SQL/JSON condition
      <code class="codeph">json_exists</code>, provided the query path expression has a filter expression that
    contains only a <span class="italic">path-expression comparison</span> or multiple such comparisons separated by
      <code class="codeph">&amp;&amp;</code>.
                  </p>
                  <div class="section">
                     <p>In order for a <code class="codeph">json_value</code> function-based index to be picked up for one of
        the comparisons of the query, the type of that comparison must be the same as the returning
        SQL data type for the index. The SQL data types used are those mentioned for item methods
          <code class="codeph">double()</code>, <code class="codeph">number()</code>, <code class="codeph">timestamp()</code>,
          <code class="codeph">date()</code>, and <code class="codeph">string()</code> — see <a href="json-path-expressions.html#GUID-8656CAB9-C293-4A99-BB62-F38F3CFC4C13" title="The Oracle item methods available for a SQL/JSON path expression are described.">SQL/JSON Path Expression Item Methods</a>.
                     </p>
                     <p>For example, if the index returns a number then the
        comparison type must also be number. If the query filter expression contains more than one
        comparison that matches a <code class="codeph">json_value</code> index, the optimizer chooses one of
        the indexes.
                     </p>
                     <p>The <span class="italic">type of a comparison</span> is determined as
        follows:
                     </p>
                     <ol>
                        <li>
                           <p>If the SQL data types of the two comparison terms (sides of
            the comparison) are different then the type of the comparison is <span class="italic">unknown</span>, and the
            index is not picked up. Otherwise, the types are the same, and this type is the type of
            the comparison.
                           </p>
                        </li>
                        <li>
                           <p>If a comparison term is of SQL data type <span class="italic">string</span> (a
            text literal) then the type of the comparison is the <span class="italic">type of the other comparison
              term</span>.
                           </p>
                        </li>
                        <li>
                           <p>If a comparison term is a <span class="italic">path expression</span> with a
            function step whose <span class="italic">item method imposes a SQL match type</span> then that is also the
            type of that comparison term. The item methods that impose a SQL match type are
              <code class="codeph">double()</code>, <code class="codeph">number()</code>, <code class="codeph">timestamp()</code>,
              <code class="codeph">date()</code>, and <code class="codeph">string()</code>.
                           </p>
                        </li>
                        <li>
                           <p>If a comparison term is a <span class="italic">path expression</span> with
              <span class="italic">no</span> such function step then its type is SQL <span class="italic">string</span> (text
          literal).
                           </p>
                        </li>
                     </ol>
                     <p><a href="indexes-for-json-data.html#GUID-FEE83855-780A-424B-9916-B899BFF2077B__CACFJJDA">Example 26-4</a> creates a function-based index for <code class="codeph">json_value</code> on field <code class="codeph">PONumber</code>. The index return type is <code class="codeph">NUMBER</code>. 
                     </p>
                     <p>Each of the queries <a href="indexes-for-json-data.html#GUID-E3721DDA-23C9-4859-B13B-FAA8544C32F8__JSON_EXISTSQUERYTARGETINGFIELDCOMPA-3BEE8DDC">Example 26-7</a>, <a href="indexes-for-json-data.html#GUID-E3721DDA-23C9-4859-B13B-FAA8544C32F8__JSON_EXISTSQUERYTARGETINGFIELDCOMPA-3BEE906B">Example 26-8</a>, and <a href="indexes-for-json-data.html#GUID-E3721DDA-23C9-4859-B13B-FAA8544C32F8__JSON_EXISTSQUERYTARGETINGFIELDCASTT-3BEE923D">Example 26-9</a> can make use of this index when evaluating its
          <code class="codeph">json_exists</code> condition. Each of these queries uses a comparison that
        involves a simple path expression that is relative to the absolute path expression
          <code class="codeph">$.PONumber</code>. The relative simple path expression in each case targets the
        current filter item, <code class="codeph">@</code>, but in the case of <a href="indexes-for-json-data.html#GUID-E3721DDA-23C9-4859-B13B-FAA8544C32F8__JSON_EXISTSQUERYTARGETINGFIELDCASTT-3BEE923D">Example 26-9</a> it transforms (casts) the matching data to SQL data type
          <code class="codeph">NUMBER</code>.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section"></div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-E3721DDA-23C9-4859-B13B-FAA8544C32F8__JSON_EXISTSQUERYTARGETINGFIELDCOMPA-3BEE8DDC">
                     <p class="titleinexample">Example 26-7 JSON_EXISTS Query Targeting Field Compared
        to Literal Number</p>
                     <p>This query makes use of the index because:</p>
                     <ol>
                        <li>
                           <p>One comparison term is a path expression with no function
            step, so its type is SQL <span class="italic">string</span> (text literal).
                           </p>
                        </li>
                        <li>
                           <p>Because one comparison term is of type string, the comparison
            has the type of the other term, which is <span class="italic">number</span> (the other term is a
            numeral).
                           </p>
                        </li>
                        <li>
                           <p>The type of the (lone) comparison is the same as the type
            returned by the index: <span class="italic">number</span>.
                           </p>
                        </li>
                     </ol><pre class="pre codeblock"><code>SELECT count(*) FROM j_purchaseorder 
  WHERE json_exists(po_document, '$.PONumber?(<span class="bold">@ &gt; 1500</span>)');</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-E3721DDA-23C9-4859-B13B-FAA8544C32F8__JSON_EXISTSQUERYTARGETINGFIELDCOMPA-3BEE906B">
                     <p class="titleinexample">Example 26-8 JSON_EXISTS Query Targeting Field Compared
        to Variable Value</p>
                     <p>This query can make use of the index
        because:</p>
                     <ol>
                        <li>
                           <p>One comparison term is a path expression with no function
            step, so its type is SQL <span class="italic">string</span> (text literal).
                           </p>
                        </li>
                        <li>
                           <p>Because one comparison term is of type string, the comparison
            has the type of the other term, which is <span class="italic">number</span> (the other term is a variable
            that is bound to a number).
                           </p>
                        </li>
                        <li>
                           <p>The type of the (lone) comparison is the same as the type
            returned by the index: <span class="italic">number</span>.
                           </p>
                        </li>
                     </ol><pre class="pre codeblock"><code>SELECT count(*) FROM j_purchaseorder 
  WHERE json_exists(po_document, '$.PONumber?(<span class="bold">@ &gt; $d</span>)'
                    <span class="bold">PASSING 1500 AS "d"</span>);</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-E3721DDA-23C9-4859-B13B-FAA8544C32F8__JSON_EXISTSQUERYTARGETINGFIELDCASTT-3BEE923D">
                     <p class="titleinexample">Example 26-9 JSON_EXISTS Query Targeting Field Cast to
        Number Compared to Variable Value</p>
                     <p>This query can make use of the
        index because:</p>
                     <ol>
                        <li>
                           <p>One comparison term is a path expression with a function
            step whose item method (<code class="codeph">number()</code>) transforms the matching data to a
              <span class="italic">number</span>, so the type of that comparison term is SQL <span class="italic">number</span>. 
                           </p>
                        </li>
                        <li>
                           <p>The other comparison term is a numeral, which has SQL type
              <span class="italic">number</span>. The types of the comparison terms match, so the comparison has this
            same type, <span class="italic">number</span>.
                           </p>
                        </li>
                        <li>
                           <p>The type of the (lone) comparison is the same as the type
            returned by the index: <span class="italic">number</span>.
                           </p>
                        </li>
                     </ol><pre class="pre codeblock"><code>SELECT count(*) FROM j_purchaseorder 
  WHERE json_exists(po_document, '$.PONumber?(<span class="bold">@.number() &gt; $d</span>)'
                    <span class="bold">PASSING 1500 AS "d"</span>);</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-E3721DDA-23C9-4859-B13B-FAA8544C32F8__JSON_EXISTSQUERYTARGETINGACONJUNCTI-3DEFBDBD">
                     <p class="titleinexample">Example 26-10 JSON_EXISTS Query Targeting a Conjunction
        of Field Comparisons</p>
                     <p>Just as for <a href="indexes-for-json-data.html#GUID-E3721DDA-23C9-4859-B13B-FAA8544C32F8__JSON_EXISTSQUERYTARGETINGFIELDCOMPA-3BEE8DDC">Example 26-7</a>, this query can make use of the index on field
          <code class="codeph">PONumber</code>. If a <code class="codeph">json_value</code> index is also defined for
        field <code class="codeph">Reference</code> then the optimizer chooses which index to use for this
        query.
                     </p><pre class="pre codeblock"><code>SELECT count(*) FROM j_purchaseorder
  WHERE json_exists(po_document, '$?(@.PONumber &gt; 1500
                                     <span class="bold">&amp;&amp;</span> @.Reference == "ABULL-20140421")');</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="indexes-for-json-data.html#GUID-FEE83855-780A-424B-9916-B899BFF2077B" title="You can create a function-based index for SQL/JSON function json_value. You can use the standard syntax for this, explicitly specifying function json_value, or you can use the simple dot-notation syntax. Indexes created in either of these ways can be used with both dot-notation queries and json_value queries.">Creating JSON_VALUE Function-Based Indexes</a></li>
                        <li><a href="json-path-expressions.html#GUID-2DC05D71-3D62-4A14-855F-76E054032494" title="Oracle Database provides SQL access to JSON data using SQL/JSON path expressions.">SQL/JSON Path Expressions</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="indexes-for-json-data.html#GUID-8A1B098E-D4FE-436E-A715-D8B465655C0D" title="You can index JSON data as you would any data of the type you use to store it. In addition, you can define a JSON search index, which is useful for both ad hoc structural queries and full-text queries.">Indexes for JSON Data</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB6402"></a><a id="ADXDB6403"></a><a id="ADXDB6404"></a><a id="ADXDB6401"></a><div class="props_rev_3"><a id="GUID-90D76388-F022-444C-B5CD-0A7C27FEE30D" name="GUID-90D76388-F022-444C-B5CD-0A7C27FEE30D"></a><h3 id="ADJSN-GUID-90D76388-F022-444C-B5CD-0A7C27FEE30D" class="sect3"><span class="enumeration_section">26.7 </span>Data Type Considerations for JSON_VALUE Indexing and Querying
               </h3>
               <div>
                  <p>By default, SQL/JSON function <code class="codeph">json_value</code> returns a <code class="codeph">VARCHAR2</code> value. When you create a function-based index using <code class="codeph">json_value</code>, unless you use a <code class="codeph">RETURNING</code> clause to specify a different return data type, the index is not picked up for a query that expects a non-<code class="codeph">VARCHAR2</code> value. 
                  </p>
                  <p>For example, in the query of <a href="indexes-for-json-data.html#GUID-90D76388-F022-444C-B5CD-0A7C27FEE30D__CACCHJHD">Example 26-11</a>, <code class="codeph">json_value</code> uses <code class="codeph">RETURNING NUMBER</code>. The index created in <a href="indexes-for-json-data.html#GUID-FEE83855-780A-424B-9916-B899BFF2077B__CACFJJDA">Example 26-4</a> can be picked up for this query, because the indexed <code class="codeph">json_value</code> expression specifies a return type of <code class="codeph">NUMBER</code>. 
                  </p>
                  <p>But the index created in <a href="indexes-for-json-data.html#GUID-FEE83855-780A-424B-9916-B899BFF2077B__CACHAAIA">Example 26-3</a> does not use <code class="codeph">RETURNING NUMBER</code> (the return type is <code class="codeph">VARCHAR2(4000)</code>, by default), so it cannot be picked up for a such a query. 
                  </p>
                  <p>Now consider the queries in <a href="indexes-for-json-data.html#GUID-90D76388-F022-444C-B5CD-0A7C27FEE30D__CACHECBI">Example 26-12</a> and <a href="indexes-for-json-data.html#GUID-90D76388-F022-444C-B5CD-0A7C27FEE30D__CACIDDIF">Example 26-13</a>, which use <code class="codeph">json_value</code> without a <code class="codeph">RETURNING</code> clause, so that the value returned is of type <code class="codeph">VARCHAR2</code>.
                  </p>
                  <p>In <a href="indexes-for-json-data.html#GUID-90D76388-F022-444C-B5CD-0A7C27FEE30D__CACHECBI">Example 26-12</a>, SQL function <code class="codeph">to_number</code> explicitly converts the <code class="codeph">VARCHAR2</code> value returned by <code class="codeph">json_value</code> to a number. Similarly, in <a href="indexes-for-json-data.html#GUID-90D76388-F022-444C-B5CD-0A7C27FEE30D__CACIDDIF">Example 26-13</a>, comparison condition &gt; (greater-than) implicitly converts the value to a number. 
                  </p>
                  <p>Neither of the indexes of <a href="indexes-for-json-data.html#GUID-FEE83855-780A-424B-9916-B899BFF2077B__CACFJJDA">Example 26-4</a> and <a href="indexes-for-json-data.html#GUID-FEE83855-780A-424B-9916-B899BFF2077B__CACHAAIA">Example 26-3</a> is picked up for either of these queries. The queries might return the right results in each case, because of type-casting, but the indexes cannot be used to evaluate the queries. 
                  </p>
                  <p>Consider also what happens if some of the data cannot be converted to a particular data type. For example, given the queries in <a href="indexes-for-json-data.html#GUID-90D76388-F022-444C-B5CD-0A7C27FEE30D__CACCHJHD">Example 26-11</a>, <a href="indexes-for-json-data.html#GUID-90D76388-F022-444C-B5CD-0A7C27FEE30D__CACHECBI">Example 26-12</a>, and <a href="indexes-for-json-data.html#GUID-90D76388-F022-444C-B5CD-0A7C27FEE30D__CACIDDIF">Example 26-13</a>, what happens to a <code class="codeph">PONumber</code> value such as <code class="codeph">"alpha"</code>? 
                  </p>
                  <p>For <a href="indexes-for-json-data.html#GUID-90D76388-F022-444C-B5CD-0A7C27FEE30D__CACHECBI">Example 26-12</a> and <a href="indexes-for-json-data.html#GUID-90D76388-F022-444C-B5CD-0A7C27FEE30D__CACIDDIF">Example 26-13</a>, the query stops in error because of the attempt to cast the value to a number. For <a href="indexes-for-json-data.html#GUID-90D76388-F022-444C-B5CD-0A7C27FEE30D__CACCHJHD">Example 26-11</a>, however, because the default error handling behavior is <code class="codeph">NULL ON ERROR</code>, the non-number value <code class="codeph">"alpha"</code> is simply filtered out. The value is indexed, but it is ignored for the query. 
                  </p>
                  <p>Similarly, if the query used, say, <code class="codeph">DEFAULT '1000' ON ERROR</code>, that is, if it specified a numeric default value, then no error would be raised for the value <code class="codeph">"alpha"</code>: the default value of <code class="codeph">1000</code> would be used.
                  </p>
                  <div class="example" id="GUID-90D76388-F022-444C-B5CD-0A7C27FEE30D__CACCHJHD">
                     <p class="titleinexample">Example 26-11 JSON_VALUE Query with Explicit RETURNING NUMBER</p><pre class="pre codeblock"><code>SELECT count(*) FROM j_purchaseorder po
  WHERE json_value(po_document, '$.PONumber' <span class="bold">RETURNING NUMBER</span>) &gt; 1500;
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-90D76388-F022-444C-B5CD-0A7C27FEE30D__CACHECBI">
                     <p class="titleinexample">Example 26-12 JSON_VALUE Query with Explicit Numerical Conversion</p><pre class="pre codeblock"><code>SELECT count(*) FROM j_purchaseorder po
  WHERE <span class="bold">to_number(</span>json_value(po_document, '$.PONumber')<span class="bold">)</span> &gt; 1500;</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-90D76388-F022-444C-B5CD-0A7C27FEE30D__CACIDDIF">
                     <p class="titleinexample">Example 26-13 JSON_VALUE Query with Implicit Numerical Conversion</p><pre class="pre codeblock"><code>SELECT count(*) FROM j_purchaseorder po
  WHERE json_value(po_document, '$.PONumber') &gt; 1500;
</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="indexes-for-json-data.html#GUID-8A1B098E-D4FE-436E-A715-D8B465655C0D" title="You can index JSON data as you would any data of the type you use to store it. In addition, you can define a JSON search index, which is useful for both ad hoc structural queries and full-text queries.">Indexes for JSON Data</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB6268"></a><a id="ADXDB6269"></a><a id="ADXDB6270"></a><a id="ADXDB6405"></a><div class="props_rev_3"><a id="GUID-47CEF6AA-0FCF-40D2-90E0-C57C0B0E816F" name="GUID-47CEF6AA-0FCF-40D2-90E0-C57C0B0E816F"></a><h3 id="ADJSN-GUID-47CEF6AA-0FCF-40D2-90E0-C57C0B0E816F" class="sect3"><span class="enumeration_section">26.8 </span>Indexing Multiple JSON Fields Using a Composite B-Tree Index
               </h3>
               <div>
                  <p>To index multiple fields of a JSON object, you first create virtual columns for them. Then you create a composite B-tree index on the virtual columns. </p>
                  <div class="section">
                     <p><a href="indexes-for-json-data.html#GUID-47CEF6AA-0FCF-40D2-90E0-C57C0B0E816F__CACCEFDD">Example 26-14</a> and <a href="indexes-for-json-data.html#GUID-47CEF6AA-0FCF-40D2-90E0-C57C0B0E816F__CACFADBF">Example 26-15</a> illustrate this. <a href="indexes-for-json-data.html#GUID-47CEF6AA-0FCF-40D2-90E0-C57C0B0E816F__CACCEFDD">Example 26-14</a> creates virtual columns <code class="codeph">userid</code> and <code class="codeph">costcenter</code> for JSON object fields <code class="codeph">User</code> and <code class="codeph">CostCenter</code>, respectively.
                     </p>
                     <p><a href="indexes-for-json-data.html#GUID-47CEF6AA-0FCF-40D2-90E0-C57C0B0E816F__CACFADBF">Example 26-15</a> creates a composite B-tree index on the virtual columns of <a href="indexes-for-json-data.html#GUID-47CEF6AA-0FCF-40D2-90E0-C57C0B0E816F__CACCEFDD">Example 26-14</a>.
                     </p>
                     <p>A SQL query that references either the virtual columns or the corresponding JSON data (object fields) picks up the composite index. This is the case for both of the queries in <a href="indexes-for-json-data.html#GUID-47CEF6AA-0FCF-40D2-90E0-C57C0B0E816F__CACGFJBE">Example 26-16</a>.
                     </p>
                     <p>These two queries have the same effect, including the same performance. However, the first query form does not target the JSON data itself; it targets the virtual columns that are used to index that data. </p>
                     <p>The data does not depend logically on any indexes implemented to improve query performance. If you want this independence from implementation to be reflected in your code, then use the second query form. Doing that ensures that the query behaves the same functionally with or without the index — the index serves only to improve performance.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-47CEF6AA-0FCF-40D2-90E0-C57C0B0E816F__CACCEFDD">
                     <p class="titleinexample">Example 26-14 Creating Virtual Columns For JSON Object Fields</p><pre class="pre codeblock"><code>ALTER TABLE j_purchaseorder ADD (<span class="bold">userid</span> VARCHAR2(20)
  <span class="bold">GENERATED ALWAYS AS</span> (json_value(po_document, '$.<span class="bold">User</span>' RETURNING VARCHAR2(20))));

ALTER TABLE j_purchaseorder ADD (<span class="bold">costcenter</span> VARCHAR2(6)
  <span class="bold">GENERATED ALWAYS AS</span> (json_value(po_document, '$.<span class="bold">CostCenter</span>'
                       RETURNING VARCHAR2(6))));
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-47CEF6AA-0FCF-40D2-90E0-C57C0B0E816F__CACFADBF">
                     <p class="titleinexample">Example 26-15 Creating a Composite B-tree Index For JSON Object Fields</p><pre class="pre codeblock"><code>CREATE INDEX user_cost_ctr_idx on j_purchaseorder(<span class="bold">userid</span>, <span class="bold">costcenter</span>);
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-47CEF6AA-0FCF-40D2-90E0-C57C0B0E816F__CACGFJBE">
                     <p class="titleinexample">Example 26-16 Two Ways to Query JSON Data Indexed With a Composite Index</p><pre class="pre codeblock"><code>SELECT po_document FROM j_purchaseorder WHERE <span class="bold">userid</span>      = 'ABULL'
                                          AND <span class="bold">costcenter</span>  = 'A50';

SELECT po_document
  FROM j_purchaseorder WHERE <span class="bold">json_value</span>(po_document, <span class="bold">'$.User'</span>)       = 'ABULL'
                         AND <span class="bold">json_value</span>(po_document, <span class="bold">'$.CostCenter'</span>) = 'A50';
</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="indexes-for-json-data.html#GUID-8A1B098E-D4FE-436E-A715-D8B465655C0D" title="You can index JSON data as you would any data of the type you use to store it. In addition, you can define a JSON search index, which is useful for both ad hoc structural queries and full-text queries.">Indexes for JSON Data</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="props_rev_3"><a id="GUID-D7A604E1-F617-4C92-A9D9-00B6AB78EFD8" name="GUID-D7A604E1-F617-4C92-A9D9-00B6AB78EFD8"></a><h3 id="ADJSN-GUID-D7A604E1-F617-4C92-A9D9-00B6AB78EFD8" class="sect3"><span class="enumeration_section">26.9 </span>JSON Search Index: Ad Hoc Queries and
    Full-Text Search
               </h3>
               <div>
                  <p>A JSON search index is a <span class="italic">general</span> index. It can improve the
    performance of both (1) ad hoc structural queries, that is, queries that you might not
    anticipate or use regularly, and (2) full-text search. It is an Oracle Text index that is
    designed specifically for use with JSON data.
                  </p>
                  <div class="infoboxnote" id="GUID-D7A604E1-F617-4C92-A9D9-00B6AB78EFD8__GUID-F67A434C-6AB5-4091-B8D9-CC0B6D0CACF6">
                     <p class="notep1">Note:</p>
                     <p>If you created a JSON search
        index using Oracle Database 12c Release 1 (12.1.0.2) then Oracle recommends that you
          <span class="italic">drop</span> that index and <span class="italic">create a new search index</span> for use with later releases,
        using <code class="codeph">CREATE SEARCH INDEX</code> as shown here.
        
                     </p>
                  </div>
                  <div class="section">
                     <p class="subhead2" id="GUID-D7A604E1-F617-4C92-A9D9-00B6AB78EFD8__GUID-96A4B938-C0CD-4CC2-993D-C15452D4C754">Introduction to JSON
        Search Indexes</p>
                     <p>You create a JSON search index using <code class="codeph">CREATE
          SEARCH INDEX</code> with the keywords <code class="codeph">FOR JSON</code>. <a href="indexes-for-json-data.html#GUID-D7A604E1-F617-4C92-A9D9-00B6AB78EFD8__GUID-5DC9D338-2D42-46B1-ADAA-793B6DA0CF3A">Example 26-17</a> illustrates this. 
                     </p>
                     <p>If the name of your
        JSON search index is present in the execution plan for your query, then you know that the
        index was in fact picked up for that query. You will see a line similar to that shown in
          <a href="indexes-for-json-data.html#GUID-D7A604E1-F617-4C92-A9D9-00B6AB78EFD8__CACIDIJG">Example 26-18</a>.
                     </p>
                     <p>You can specify a
          <code class="codeph">PARAMETERS</code> clause to override the default settings of certain
        configurable options. By default (no <code class="codeph">PARAMETERS</code> clause), the index is
        synchronized on commit and both text and numeric ranges are indexed.
                     </p>
                     <p>A
        JSON search index is maintained asynchronously, on demand. You can thus defer the cost of
        index maintenance, performing it at commit time only or at some time when database load is
        reduced. This can improve DML performance. It can also improve index maintenance performance
        by enabling bulk loading of unsynchronized index rows when an index is synchronized. On the
        other hand, asynchronous maintenance of an index means that until it is synchronized the
        index is not used for data that has been modified or newly inserted.</p>
                     <p>If
        your queries that make use of a JSON search index never involve numeric ranges then you can
        save some index maintenance time and some disk space by specifying <code class="codeph">TEXT</code> for
        parameter <code class="codeph">SEARCH_ON</code>. The default value of <code class="codeph">SEARCH_ON</code> is
          <code class="codeph">TEXT_VALUE</code>, which means index numeric ranges as well as text. 
                     </p>
                     <div class="infoboxnote" id="GUID-D7A604E1-F617-4C92-A9D9-00B6AB78EFD8__GUID-16D5C6A3-35C8-4178-9DAB-565B20423EBF">
                        <p class="notep1">Note:</p>
                        <p>To alter a JSON search index <code class="codeph">j_s_idx</code>, you use <code class="codeph">ALTER
            INDEX j_s_idx REBUILD ...</code> (<span class="italic">not</span>
                           <code class="codeph">ALTER SEARCH INDEX j_s_idx ...</code>).
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-D7A604E1-F617-4C92-A9D9-00B6AB78EFD8__GUID-5DC9D338-2D42-46B1-ADAA-793B6DA0CF3A">
                     <p class="titleinexample">Example 26-17 Creating a JSON Search
      Index</p><pre class="pre codeblock"><code>CREATE <span class="bold">SEARCH</span> INDEX po_search_idx ON j_purchaseorder (po_document) <span class="bold">FOR JSON</span>;</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-D7A604E1-F617-4C92-A9D9-00B6AB78EFD8__CACIDIJG">
                     <p class="titleinexample">Example 26-18 Execution Plan
        Indication that a JSON Search Index Is
      Used</p><pre class="pre codeblock"><code>|* 2|   DOMAIN INDEX     | <span class="bold">PO_SEARCH_IDX</span> |     |     |     4 (0)
</code></pre></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-D7A604E1-F617-4C92-A9D9-00B6AB78EFD8__GUID-436882B8-F84F-4B25-B295-D5A644507C09">Full-Text Search of
        JSON Data</p>
                     <p>You can use SQL/JSON condition
            <span class="bold"><code class="codeph">json_textcontains</code></span> in a <code class="codeph">CASE</code> expression or the
          <code class="codeph">WHERE</code> clause of a <code class="codeph">SELECT</code> statement to perform a
        full-text search of JSON data that is stored in a <code class="codeph">VARCHAR2</code>,
          <code class="codeph">BLOB</code>, or <code class="codeph">CLOB</code> column.
                     </p>
                     <p>Oracle Text
        technology underlies SQL condition <code class="codeph">json_textcontains</code>. This means, for
        instance, that you can query for text that is near some other text, or query use fuzzy
        pattern-matching.
                     </p>
                     <p>To be able to use condition
          <code class="codeph">json_textcontains</code>, you first must create a JSON search index. If you do
        not, then an error is raised when <code class="codeph">json_textcontains</code> is used.
                     </p>
                     <p><a href="indexes-for-json-data.html#GUID-D7A604E1-F617-4C92-A9D9-00B6AB78EFD8__CACJJDFE">Example 26-19</a> shows a full-text query that finds purchase-order documents
        that contain the keyword <code class="codeph">Magic</code> in any of the line-item part
        descriptions.
                     </p>
                     <div class="infoboxnote" id="GUID-D7A604E1-F617-4C92-A9D9-00B6AB78EFD8__GUID-C9C60357-17D6-494B-8A74-75B535256EA3">
                        <p class="notep1">Note:</p>
                        <p>For powerful full-text search, use Oracle SQL function <code class="codeph">json_textcontains</code>, which requires that you create a JSON search index. As a less-powerful alternative, if you do not create a JSON search index, and you just want simple string pattern-matching in a filter condition, you can use any of the pattern-matching comparisons: <code class="codeph">has substring</code>, <code class="codeph">starts with</code>, <code class="codeph">like</code>, <code class="codeph">like_regex</code>, or <code class="codeph">eq_regex</code>.
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-D7A604E1-F617-4C92-A9D9-00B6AB78EFD8__CACJJDFE">
                     <p class="titleinexample">Example 26-19 Full-Text Query of
        JSON
      Data</p><pre class="pre codeblock"><code>SELECT po_document FROM j_purchaseorder
  WHERE <span class="bold">json_textcontains</span>(po_document, '$.LineItems.Part.Description', '<span class="bold">Magic</span>');
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-D7A604E1-F617-4C92-A9D9-00B6AB78EFD8__GUID-11AFF04C-8A07-4045-AA66-3118583E2188">
                     <p class="titleinexample">Example 26-20 Full-Text Query of JSON Data, with Escaped
        Search Pattern</p>
                     <p>If the third argument to condition
          <code class="codeph">json_textcontains</code> contains a character or a word that is <span class="italic">reserved</span>
        with respect to Oracle Text search then you must <span class="italic">escape</span> that character or word.
                     </p>
                     <p>The queries here search for documents where the part description contains both
          <code class="codeph">Magic</code> and <code class="codeph">Christmas</code>. They use the Oracle Text query
        operators <code class="codeph">&amp;</code> and <code class="codeph">and</code>, which are reserved with respect
        to Oracle Text search.
                     </p>
                     <p>The first query escapes the single character
          <code class="codeph">&amp;</code>, using backslash (<code class="codeph"><span class="bold">\</span></code>). The second escapes
        the entire search pattern, using braces (<code class="codeph"><span class="bold">{</span></code>,
          <code class="codeph"><span class="bold">}</span></code>), because it contains the reserved word <code class="codeph">and</code>.
        (It could alternatively use <code class="codeph">{and}</code> to escape only the characters in operator
          <code class="codeph">and</code>).
                     </p><pre class="pre codeblock"><code>SELECT po_document FROM j_purchaseorder
  WHERE json_textcontains(po_document, '$.LineItems.Part.Description', 'Magic <span class="bold">\&amp;</span> Christmas');</code></pre><pre class="pre codeblock"><code>SELECT po_document FROM j_purchaseorder
  WHERE json_textcontains(po_document, '$.LineItems.Part.Description', '<span class="bold">{</span>Magic <span class="bold">and</span>  Christmas<span class="bold">}</span>');</code></pre></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-D7A604E1-F617-4C92-A9D9-00B6AB78EFD8__GUID-D74F3A3E-1203-4722-BC93-759932061042">Ad Hoc Queries of
        JSON Data</p>
                     <p><a href="indexes-for-json-data.html#GUID-D7A604E1-F617-4C92-A9D9-00B6AB78EFD8__CACGJADE">Example 26-21</a> shows some <span class="italic">non</span> full-text queries of JSON data that
        also make use of the JSON search index created in <a href="indexes-for-json-data.html#GUID-D7A604E1-F617-4C92-A9D9-00B6AB78EFD8__GUID-5DC9D338-2D42-46B1-ADAA-793B6DA0CF3A">Example 26-17</a>.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-D7A604E1-F617-4C92-A9D9-00B6AB78EFD8__CACGJADE">
                     <p class="titleinexample">Example 26-21 Some Ad Hoc JSON
        Queries</p>
                     <p>This query selects documents that contain a shipping
        instructions address that includes a
        country.</p><pre class="pre codeblock"><code>SELECT po_document FROM j_purchaseorder
  WHERE json_exists(po_document, '$.ShippingInstructions.Address.country');
</code></pre><p>This query selects documents that contain user <code class="codeph">AKHOO</code> where
        there are more than 8 items ordered. It takes advantage of numeric-range
        indexing.
                     </p><pre class="pre codeblock"><code>SELECT po_document FROM j_purchaseorder
  WHERE json_exists(po_document, '$?(@.User == "AKHOO"
                                     &amp;&amp; @.LineItems.Quantity &gt; 8)');
</code></pre><p>This query selects documents where the user is <code class="codeph">AKHOO</code>. It uses
          <code class="codeph">json_value</code> instead of <code class="codeph">json_exists</code> in the
          <code class="codeph">WHERE</code>
      clause.
                     </p><pre class="pre codeblock"><code>SELECT po_document FROM j_purchaseorder
  WHERE json_value(po_document, '$.User') = 'ABULL';
</code></pre></div>
                  <!-- class="example" -->
                  <div class="section"></div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="indexes-for-json-data.html#GUID-8A1B098E-D4FE-436E-A715-D8B465655C0D" title="You can index JSON data as you would any data of the type you use to store it. In addition, you can define a JSON search index, which is useful for both ad hoc structural queries and full-text queries.">Indexes for JSON Data</a></li>
                        <li><a href="json-dataguide.html#GUID-219FC30E-89A7-4189-BC36-7B961A24067C" title="A JSON data guide lets you discover information about the structure and content of JSON documents stored in Oracle Database.">JSON Data Guide</a></li>
                     </ul>
                  </div>
                  <div class="infoboxnotealso" id="GUID-D7A604E1-F617-4C92-A9D9-00B6AB78EFD8__GUID-4B8408A2-8425-4B94-91CE-A84B3DCD2243">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="../sqlrf/SQL-JSON-Conditions.html#SQLRF56963" target="_blank"><span><cite>Oracle Database SQL Language Reference</cite></span></a> for information about condition
                <code class="codeph">json_textcontains</code></p>
                        </li>
                        <li>
                           <p><a href="../ccref/oracle-text-SQL-statements-and-operators.html#CCREF-GUID-10013D4C-AB6A-44EB-B8B3-AD318EDE33A9" target="_blank"><span><cite>Oracle Text Reference</cite></span></a> for
              information about the <code class="codeph">PARAMETERS</code> clause for <code class="codeph">CREATE SEARCH
                INDEX</code></p>
                        </li>
                        <li>
                           <p><a href="../ccref/oracle-text-SQL-statements-and-operators.html#GUID-47E60252-C731-46A8-B587-AE30C1634F48__I996850" target="_blank"><span><cite>Oracle Text Reference</cite></span></a> for information about the <code class="codeph">PARAMETERS</code>
              clause for <code class="codeph">ALTER INDEX</code> ... <code class="codeph">REBUILD</code></p>
                        </li>
                        <li>
                           <p><a href="../ccref/oracle-text-SQL-statements-and-operators.html#CCREF23731" target="_blank"><span><cite>Oracle Text Reference</cite></span></a> for information about synchronizing a JSON search
              index
                           </p>
                        </li>
                        <li>
                           <p><a href="../ccapp/maintaining-oracle-text-indexes.html#CCAPP-GUID-9960D8E4-0AE8-48B0-82D5-B203695463DE" target="_blank"><span><cite>Oracle Text Application Developer's Guide</cite></span></a> for guidance about optimizing and tuning the performance
              of a JSON search index
                           </p>
                        </li>
                        <li>
                           <p><a href="../ccref/special-characters-in-oracle-text-queries.html#CCREF-GUID-4639581C-7F65-4C9E-96CE-0A7EAA10086F" target="_blank"><span><cite>Oracle Text Reference</cite></span></a> for
              information about the words and characters that are reserved with respect to Oracle
              Text search, and <a href="../ccref/special-characters-in-oracle-text-queries.html#CCREF-GUID-F94D663C-6CE6-4FB0-AA4A-3AAEFF2E66D3" target="_blank"><span><cite>Oracle Text Reference</cite></span></a> for
              information about how to escape them.
                           </p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="indexes-for-json-data.html#GUID-8A1B098E-D4FE-436E-A715-D8B465655C0D" title="You can index JSON data as you would any data of the type you use to store it. In addition, you can define a JSON search index, which is useful for both ad hoc structural queries and full-text queries.">Indexes for JSON Data</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>