<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>CONTEXT Query Application</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Application Developer's Guide ">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Application Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="text-application-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-07T01:45:16-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2001, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96275-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="migrating-oracle-text-applications.html" title="Previous" type="text/html">
      <link rel="next" href="CATSEARCH-query-application.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Text Application Developer's Guide">
    <meta name="dcterms.isVersionOf" content="CCAPP">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="migrating-oracle-text-applications.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="CATSEARCH-query-application.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Application Developer's Guide </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> CONTEXT Query Application</li>
            </ol>
            <a id="GUID-1F1B44E8-ACCA-446A-84EA-67FA692476BA" name="GUID-1F1B44E8-ACCA-446A-84EA-67FA692476BA"></a><a id="CCAPP3000"></a>
            
            <h2 id="CCAPP-GUID-1F1B44E8-ACCA-446A-84EA-67FA692476BA" class="sect2"><span class="enumeration_chapter">A </span> CONTEXT Query Application
            </h2>
         </header>
         <div class="ind">
            <div>
               <p><a id="d40230e61" class="indexterm-anchor"></a><a id="d40230e65" class="indexterm-anchor"></a><a id="d40230e67" class="indexterm-anchor"></a><a id="d40230e71" class="indexterm-anchor"></a>This appendix describes how to build a simple web search application by using the <code class="codeph">CONTEXT</code> index type.
               </p>
               <p>This appendix contains the following topics:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="CONTEXT-query-application.html#GUID-D58C935C-301F-44F4-BF28-050B83EA2ACE">Web Query Application Overview</a></p>
                  </li>
                  <li>
                     <p><a href="CONTEXT-query-application.html#GUID-02600A05-F136-464F-A683-0504F6809388">The PL/SQL Server Pages (PSP) Web Application</a></p>
                  </li>
                  <li>
                     <p><a href="CONTEXT-query-application.html#GUID-DEABF1DC-7C2E-436D-A83F-D036260B0B32">The Java Server Pages (JSP) Web Application</a></p>
                  </li>
               </ul>
            </div><a id="CCAPP9528"></a><a id="CCAPP9529"></a><a id="CCAPP9371"></a><div class="props_rev_3"><a id="GUID-D58C935C-301F-44F4-BF28-050B83EA2ACE" name="GUID-D58C935C-301F-44F4-BF28-050B83EA2ACE"></a><h3 id="CCAPP-GUID-D58C935C-301F-44F4-BF28-050B83EA2ACE" class="sect3"><span class="enumeration_section">A.1 </span>Web Query Application Overview
               </h3>
               <div>
                  <p>A common use of Oracle Text is to index HTML files on websites and provide search capabilities to users. The sample application in this appendix indexes a set of HTML files stored in the database. It also uses a web server connected to Oracle Database to provide the search service.</p>
                  <p>This appendix describes two versions of the Web query application: </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>One using PL/SQL Server Pages (<span class="bold">PSP</span>)
                        </p>
                     </li>
                     <li>
                        <p>One using Java Server Pages (<span class="bold">JSP</span>)
                        </p>
                     </li>
                  </ul>
                  <p><a href="CONTEXT-query-application.html#GUID-D58C935C-301F-44F4-BF28-050B83EA2ACE__CHDIHHGG">Figure A-1</a> shows the JSP version of the text query application.
                  </p>
                  <div class="figure" id="GUID-D58C935C-301F-44F4-BF28-050B83EA2ACE__CHDIHHGG">
                     <p class="titleinfigure">Figure A-1 The Text Query Application</p><img src="img/search01b.png" width="557" alt="Description of Figure A-1 follows" title="Description of Figure A-1 follows" longdesc="img_text/search01b.html"><br><a href="img_text/search01b.html">Description of "Figure A-1 The Text Query Application"</a></div>
                  <!-- class="figure" -->
                  <p><a href="CONTEXT-query-application.html#GUID-D58C935C-301F-44F4-BF28-050B83EA2ACE__CHDGCBIC">Figure A-2</a> shows the results of the text query.
                  </p>
                  <div class="figure" id="GUID-D58C935C-301F-44F4-BF28-050B83EA2ACE__CHDGCBIC">
                     <p class="titleinfigure">Figure A-2 Text Query Application with Results</p><img src="img/search02b.png" width="557" alt="Description of Figure A-2 follows" title="Description of Figure A-2 follows" longdesc="img_text/search02b.html"><br><a href="img_text/search02b.html">Description of "Figure A-2 Text Query Application with Results"</a></div>
                  <!-- class="figure" -->
                  <p>The application returns links to documents containing the search term. Each document has four links:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>The <span class="bold">HTML</span> link displays the document.
                        </p>
                        <p>Graphics are not displayed in the filtered document.</p>
                     </li>
                     <li>
                        <p>The <span class="bold">Highlight</span> link displays the document with the search term highlighted. 
                        </p>
                     </li>
                     <li>
                        <p>The <span class="bold">Theme</span> link shows the top 50 themes associated with the document.
                        </p>
                        <p>The <span class="bold">Gist</span> link displays a short summary of the document.
                        </p>
                     </li>
                  </ul>
               </div>
            </div><a id="CCAPP9530"></a><a id="CCAPP9372"></a><div class="props_rev_3"><a id="GUID-02600A05-F136-464F-A683-0504F6809388" name="GUID-02600A05-F136-464F-A683-0504F6809388"></a><h3 id="CCAPP-GUID-02600A05-F136-464F-A683-0504F6809388" class="sect3"><span class="enumeration_section">A.2 </span>The PL/SQL Server Pages (PSP) Web Application
               </h3>
               <div>
                  <p>The PSP web application is based on PL/SQL server pages. <a href="CONTEXT-query-application.html#GUID-02600A05-F136-464F-A683-0504F6809388__CACJEDFE">Figure A-3</a> illustrates how the browser calls the PSP-stored procedure on Oracle Database through a web server.
                  </p>
                  <p>This section contains the following topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="CONTEXT-query-application.html#GUID-0D3EACC2-9FBC-480F-A742-F7F402905BB8">PSP Web Application Prerequisites</a></p>
                     </li>
                     <li>
                        <p><a href="CONTEXT-query-application.html#GUID-03558FFB-EFEF-4B43-92CA-E9ABB5EC0E6B">Building the PSP Web Application</a></p>
                     </li>
                     <li>
                        <p><a href="CONTEXT-query-application.html#GUID-5399C5D7-77E6-4BD9-AAD8-21D63279E630">PSP Web Application Sample Code</a></p>
                     </li>
                  </ul>
                  <div class="figure" id="GUID-02600A05-F136-464F-A683-0504F6809388__CACJEDFE">
                     <p class="titleinfigure">Figure A-3 The PSP Web Application</p><img src="img/ccapp012.gif" width="596" alt="Description of Figure A-3 follows" title="Description of Figure A-3 follows" longdesc="img_text/ccapp012.html"><br><a href="img_text/ccapp012.html">Description of "Figure A-3 The PSP Web Application"</a></div>
                  <!-- class="figure" -->
               </div><a id="CCAPP9373"></a><div class="props_rev_3"><a id="GUID-0D3EACC2-9FBC-480F-A742-F7F402905BB8" name="GUID-0D3EACC2-9FBC-480F-A742-F7F402905BB8"></a><h4 id="CCAPP-GUID-0D3EACC2-9FBC-480F-A742-F7F402905BB8" class="sect4"><span class="enumeration_section">A.2.1 </span>PSP Web Application Prerequisites
                  </h4>
                  <div>
                     <p>This application has the following requirements:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Your Oracle Database must be up and running.</p>
                        </li>
                        <li>
                           <p>You unlocked the SCOTT account is unlocked with its password, and the account has <code class="codeph">CREATE,</code> <code class="codeph">RESOURCE,</code> and <code class="codeph">CTXAPP</code> privileges.
                           </p>
                        </li>
                        <li>
                           <p>The Oracle PL/SQL gateway must be running.</p>
                        </li>
                        <li>
                           <p>A web server such as Apache is up and running and is correctly configured to send requests to Oracle Database.</p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-0D3EACC2-9FBC-480F-A742-F7F402905BB8__GUID-A6C42CA6-B81B-45E8-AB98-D34D38E601BB">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="../jsqlj/key-programming-considerations.html#JSQLJ196" target="_blank"><span class="italic">Oracle Database SQLJ Developer's Guide</span></a> for a connection example
                              </p>
                           </li>
                           <li>
                              <p><a href="../adfns/web-applications.html#ADFNS015" target="_blank"><span class="italic">Oracle Database Development Guide</span></a> for complete information about setting up the PL/SQL gateway and developing PL/SQL web applications
                              </p>
                           </li>
                           <li>
                              <p><span class="italic">Oracle Database 2 Day + PHP Developer's Guide</span> for information about installing Apache HTTP Server
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="CCAPP9374"></a><div class="props_rev_3"><a id="GUID-03558FFB-EFEF-4B43-92CA-E9ABB5EC0E6B" name="GUID-03558FFB-EFEF-4B43-92CA-E9ABB5EC0E6B"></a><h4 id="CCAPP-GUID-03558FFB-EFEF-4B43-92CA-E9ABB5EC0E6B" class="sect4"><span class="enumeration_section">A.2.2 </span>Building the PSP Web Application
                  </h4>
                  <div>
                     <div class="section">
                        <p>To create PSP web application:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Create your text tables.</span><div>
                              <p>You must create text tables with the <code class="codeph">CREATE</code> <code class="codeph">TABLE</code> command to store your HTML files. These examples create the <code class="codeph">output_table,</code> <code class="codeph">gist_table,</code> and <code class="codeph">theme_table</code> tables:
                              </p><pre class="oac_no_warn" dir="ltr">CREATE TABLE output_table  (query_id NUMBER, document CLOB);
CREATE TABLE gist_table  (query_id NUMBER, pov VARCHAR2(80), gist CLOB);
CREATE TABLE theme_table  (query_id NUMBER, theme VARCHAR2(2000), weight NUMBER);
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Load HTML documents into the table by using SQL*Loader.</span><div>
                              <p>You must load the text tables with the HTML files. This example uses the <a href="CONTEXT-query-application.html#GUID-D4D8B356-1F41-4927-8984-8195C0A05EB9">loader.ctl</a> control file to load the files named in <a href="CONTEXT-query-application.html#GUID-C9175A31-89FE-4B66-99A5-D60E6E7C4EB6">loader.dat</a>. The SQL*Loader statement is as follows:
                              </p><pre class="oac_no_warn" dir="ltr">% sqlldr userid=scott/<span class="italic">password</span> control=loader.ctl 
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Create the <code class="codeph">CONTEXT</code> index.<a id="d40230e553" class="indexterm-anchor"></a><a id="d40230e557" class="indexterm-anchor"></a><a id="d40230e561" class="indexterm-anchor"></a><a id="d40230e565" class="indexterm-anchor"></a></span><div>
                              <p>Index the HTML files by creating a <code class="codeph">CONTEXT</code> index on the text column, as shown here. Because you are indexing HTML, this example uses the <code class="codeph">NULL_FILTER</code> preference type for no filtering, and it uses the <code class="codeph">HTML_SECTION_GROUP</code> type, as follows:
                              </p><pre class="oac_no_warn" dir="ltr">create index idx_search_table on search_table(text)
  indextype is ctxsys.context parameters
  ('filter ctxsys.null_filter section group CTXSYS.HTML_SECTION_GROUP');
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Compile the <code class="codeph">search_htmlservices</code> package in Oracle Database.</span><div>
                              <p>The application must present selected documents to the user. To do so, Oracle Database must read the documents from the character large object <code class="codeph">(CLOB)</code> in <code class="codeph">search_table</code> and output the result for viewing. To do that, call procedures in the <code class="codeph">search_htmlservices</code> package. Compile the file <a href="CONTEXT-query-application.html#GUID-6F1889D2-689F-4548-8B0A-D6ED37ECC092">search_htmlservices.sql</a> file at the SQL*Plus prompt as follows:
                              </p><pre class="oac_no_warn" dir="ltr">SQL&gt; @search_htmlservices.sql

Package created.
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Compile the <code class="codeph">search_html</code> PSP page with loadpsp.</span><div>
                              <p>The search page is invoked by calling <a href="CONTEXT-query-application.html#GUID-B82F1C3B-2EAC-4036-9584-ED7384D9CB80">search_html.psp</a> from a browser. You compile search_html in Oracle Database with the <code class="codeph">loadpsp</code> command-line program as follows:
                              </p><pre class="oac_no_warn" dir="ltr">% loadpsp -replace -user scott/<span class="italic">password</span> search_html.psp
</pre><p>The output appears as:</p><pre class="oac_no_warn" dir="ltr">"search_html.psp": procedure "search_html" created.</pre><div class="infoboxnotealso" id="GUID-03558FFB-EFEF-4B43-92CA-E9ABB5EC0E6B__GUID-0F0008F6-A5EC-4701-B3B4-7A95072258D8">
                                 <p class="notep1">See Also:</p>
                                 <p>Oracle Database 11g Release 2 (11.2) of Oracle Database Development Guide for more information about using PSP</p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Configure your web server.</span><div>
                              <p>You must configure your web server to accept client PSP requests as a URL. Your web server forwards these requests to Oracle Database and returns server output to the browser. See <a href="CONTEXT-query-application.html#GUID-02600A05-F136-464F-A683-0504F6809388__CACJEDFE">Figure A-3</a>.
                              </p>
                              <p>You can use the Oracle WebDB web listener or Oracle Application Server, which includes the Apache web server.</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Enter the query from a browser.</span><div>
                              <p>You can access the query application from a browser by using a URL. You configure the URL with your web server. An example URL might look like the following:</p><pre class="oac_no_warn" dir="ltr">http://server.example.com:7777/mypath/search_html
</pre><p>The application displays a query entry box in your browser and returns the query results as a list of HTML links, as shown in <a href="CONTEXT-query-application.html#GUID-D58C935C-301F-44F4-BF28-050B83EA2ACE__CHDIHHGG">Figure A-1</a> and <a href="CONTEXT-query-application.html#GUID-D58C935C-301F-44F4-BF28-050B83EA2ACE__CHDGCBIC">Figure A-2</a>.
                              </p>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div><a id="CCAPP9375"></a><div class="props_rev_3"><a id="GUID-5399C5D7-77E6-4BD9-AAD8-21D63279E630" name="GUID-5399C5D7-77E6-4BD9-AAD8-21D63279E630"></a><h4 id="CCAPP-GUID-5399C5D7-77E6-4BD9-AAD8-21D63279E630" class="sect4"><span class="enumeration_section">A.2.3 </span>PSP Web Application Sample Code
                  </h4>
                  <div>
                     <p>This section lists the code used to build the example Web application. It includes the following files:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="CONTEXT-query-application.html#GUID-D4D8B356-1F41-4927-8984-8195C0A05EB9">loader.ctl</a></p>
                        </li>
                        <li>
                           <p><a href="CONTEXT-query-application.html#GUID-C9175A31-89FE-4B66-99A5-D60E6E7C4EB6">loader.dat</a></p>
                        </li>
                        <li>
                           <p><a href="CONTEXT-query-application.html#GUID-6F1889D2-689F-4548-8B0A-D6ED37ECC092">search_htmlservices.sql</a></p>
                        </li>
                        <li>
                           <p><a href="CONTEXT-query-application.html#GUID-B82F1C3B-2EAC-4036-9584-ED7384D9CB80">search_html.psp</a></p>
                        </li>
                     </ul>
                  </div><a id="CCAPP9376"></a><div class="props_rev_3"><a id="GUID-D4D8B356-1F41-4927-8984-8195C0A05EB9" name="GUID-D4D8B356-1F41-4927-8984-8195C0A05EB9"></a><h5 id="CCAPP-GUID-D4D8B356-1F41-4927-8984-8195C0A05EB9" class="sect5"><span class="enumeration_section">A.2.3.1 </span>loader.ctl
                     </h5>
                     <div>
                        <div class="section">
                           <p>This example shows a sample <code class="codeph">loader.ctl</code> file. It is used by <code class="codeph">sqlldr</code> to load the <code class="codeph">loader.dat</code> data file.
                           </p><pre class="oac_no_warn" dir="ltr">LOAD DATA 
        INFILE 'loader.dat'
        INTO TABLE search_table 
        REPLACE 
        FIELDS TERMINATED BY ';'
        (tk             INTEGER,
         title          CHAR,
         text_file      FILLER CHAR,
         text           LOBFILE(text_file) TERMINATED BY EOF)</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="CCAPP9377"></a><div class="props_rev_3"><a id="GUID-C9175A31-89FE-4B66-99A5-D60E6E7C4EB6" name="GUID-C9175A31-89FE-4B66-99A5-D60E6E7C4EB6"></a><h5 id="CCAPP-GUID-C9175A31-89FE-4B66-99A5-D60E6E7C4EB6" class="sect5"><span class="enumeration_section">A.2.3.2 </span>loader.dat
                     </h5>
                     <div>
                        <div class="section">
                           <p>This example shows a sample <code class="codeph">loader.dat</code> file. Each row contains three fields: a reference number for the document, a label (or "title"), and the name of the HTML document to load into the text column of <code class="codeph">search_table.</code> The file has been truncated for this example.
                           </p><pre class="oac_no_warn" dir="ltr">1;   Pizza Shredder;Pizza.html
2;   Refrigerator w/ Front-Door Auto Cantaloupe Dispenser;Cantaloupe.html
3;   Self-Tipping Couch;Couch.html
4;   Home Air Dirtier;Mess.html
5;   Set of Pet Magnets;Pet.html
6;   Esteem-Building Talking Pillow;Snooze.html</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="CCAPP9668"></a><a id="CCAPP9669"></a><a id="CCAPP9670"></a><a id="CCAPP9671"></a><a id="CCAPP9672"></a><a id="CCAPP9673"></a><a id="CCAPP9674"></a><a id="CCAPP9667"></a><div class="props_rev_3"><a id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382" name="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382"></a><h5 id="CCAPP-GUID-19B22A53-0B88-483E-9909-49EC1FAF1382" class="sect5"><span class="enumeration_section">A.2.3.3 </span>HTML Files for loader.dat Example
                     </h5>
                     <div>
                        <p>The HTML files that are named and loaded into <code class="codeph">loader.dat</code> are included here for your reference as follows:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="CONTEXT-query-application.html#GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIADFIGC">Pizza.html</a></p>
                           </li>
                           <li>
                              <p><a href="CONTEXT-query-application.html#GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIABDAHF">Cantaloupe.html</a></p>
                           </li>
                           <li>
                              <p><a href="CONTEXT-query-application.html#GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIAFFBAB">Couch.html</a></p>
                           </li>
                           <li>
                              <p><a href="CONTEXT-query-application.html#GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIADDBJJ">Mess.html</a></p>
                           </li>
                           <li>
                              <p><a href="CONTEXT-query-application.html#GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIAHJBBD">Pet.html</a></p>
                           </li>
                           <li>
                              <p><a href="CONTEXT-query-application.html#GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIADIEFD">Snooze.html</a></p>
                           </li>
                        </ul>
                        <div class="section" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIADFIGC">
                           <p class="subhead3" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__GUID-33B5C08D-1D1E-4BD2-9333-7FD27846FCC1">Pizza.html</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section"><pre class="oac_no_warn" dir="ltr">&lt;html&gt;
&lt;header&gt;
&lt;title&gt;The Pizza Shredder&lt;/title&gt;
&lt;/header&gt;
&lt;body&gt;
 
&lt;h2&gt;The Pizza Shredder&lt;/h2&gt;
&lt;h4&gt;Keeping your pizza preferences secure&lt;/h4&gt;
 
So it's the end of a long evening. Beer has been drunk, pizza has been eaten.
&lt;p&gt;
But there's leftover pizza - what are you going to do with it?
 
&lt;p&gt;
You could save it for the morning, or you could feed it to your pet.  But if neither of those appeal (maybe you don't have a pet?) then 
you'll be throwing it in the trash.
 
&lt;p&gt;
But wait a minute - anybody could look through your trash, and figure out what kind of pizza you've been eating! "No big deal," I hear you 
say. But it is! After they've figured out that your favorite pizza is pepperoni, then it's only a short step to figuring out that 
your top-secret online banking password is "pepperoni_pizza."
 
&lt;p&gt;
Get one over the dumpster-divers with our new patent-pending "Mk III Pizza Shredder." Cross-cut blades ensure that your pizza will be rendered 
unreadable, and nobody will be able to identify the original toppings. Also doubles as a lettuce-shredder and may also be used for removing 
unwanted fingertips.
 
&lt;h2&gt;Model Comparison&lt;/h2&gt;
 
&lt;table border="1"&gt;
  &lt;tr&gt;&lt;th&gt;Model&lt;/th&gt;&lt;th&gt;Blades0&lt;/th&gt;&lt;th&gt;Pizza Thickness&lt;/th&gt;&lt;th&gt;Price&lt;/th&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;Mk I&lt;/td&gt;&lt;td&gt;Plastic&lt;/td&gt;&lt;td&gt;1/2 inch (Thin Crust)&lt;/td&gt;&lt;td&gt;$69.99&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;Mk II&lt;/td&gt;&lt;td&gt;Brass&lt;/td&gt;&lt;td&gt;1 inch (Deep Pan)&lt;/td&gt;&lt;td&gt;$99.99&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;Mk III&lt;/td&gt;&lt;td&gt;Carbon Steel&lt;/td&gt;&lt;td&gt;2 inch (Calzoni)&lt;/td&gt;&lt;td&gt;$129.99&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;
 
&lt;/body&gt;
&lt;/html&gt;</pre></div>
                        <!-- class="section" -->
                        <div class="section" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIABDAHF">
                           <p class="subhead3" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__GUID-D36AB4E7-152C-4078-8767-C8421B294D2D">Cantaloupe.html</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section"><pre class="oac_no_warn" dir="ltr">&lt;html&gt;
&lt;header&gt;
&lt;title&gt;The Fridge with a Cantaloupe Dispenser&lt;/title&gt;
&lt;/header&gt;
&lt;body&gt;
&lt;h2&gt;The Fridge with a Cantaloupe Dispenser&lt;/h2&gt;
&lt;h4&gt;A nice cold melon at the touch of a button&lt;/h4&gt;
 
Does your refrigerator only have a boring water dispenser in the door?
 
&lt;p&gt;
When you're hungry for a cantaloupe, do you have to expend valuable energy opening the fridge door and fishing around amongst the half-used
 packets of pet food?
 
&lt;p&gt;
Do your friends complain that they wish there was an effortless way to get cantaloupes from your fridge? Do you overhear them saying they're 
tired of always having to rummage through your moldy leftovers and seal-a-meals to get to the cold melons?
 
&lt;p&gt;
What you need is the convenience of a built-in cantaloupe dispenser.
 
&lt;p&gt;
Impress your friends. Win praise from your neighbors. Become a legendary host!
 
&lt;p&gt;
&lt;b&gt;Try our new &lt;i&gt;Melonic 2000&lt;/i&gt; model!&lt;/b&gt;
 
&lt;p&gt;
Works with honeydews and small crenshaws too.
 
&lt;p&gt;
Let the &lt;i&gt;Melonic 2000&lt;/i&gt; go to work for you. Order one now at your local store.
 
&lt;/body&gt;
&lt;/html&gt;</pre></div>
                        <!-- class="section" -->
                        <div class="section" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIAFFBAB">
                           <p class="subhead3" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__GUID-9C11CD5F-2665-41EB-B3C4-981C16145826">Couch.html</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section"><pre class="oac_no_warn" dir="ltr">&lt;html&gt;
&lt;header&gt;
&lt;title&gt;The Self-Tipping Couch&lt;/title&gt;
&lt;/header&gt;
&lt;body&gt;
&lt;h2&gt;The Self-Tipping Couch&lt;/h2&gt;
 
&lt;h4&gt;Sometimes it's hard work to get off the couch&lt;/h4&gt;
 
&lt;p&gt;
Sometimes it's hard work to get your partner, or your pet, off the couch.
 
&lt;p&gt;
The &lt;b&gt;Self-Tipping Couch&lt;/b&gt; solves these problems for you. At the touch of a button it will deposit the contents of the couch onto the
 floor in front of it. 
 
&lt;p&gt;
The &lt;b&gt;Self-Tipping Couch&lt;/b&gt; has been proven to boost communication with stubborn spouses, children, and relatives. 
 
&lt;p&gt;
You will never again need to yell, "Get off the couch!" Simply press a button and all those couch hoggers are gently 
dumped onto your carpet.
 
&lt;p&gt;
Get your own &lt;b&gt;Self-Tipping Couch&lt;/b&gt; TODAY!
 
&lt;/body&gt;
&lt;/html&gt;</pre></div>
                        <!-- class="section" -->
                        <div class="section" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIADDBJJ">
                           <p class="subhead3" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__GUID-66105F44-D4CD-4B2A-8B8A-3EE6EFEC87C2">Mess.html</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section"><pre class="oac_no_warn" dir="ltr">&lt;html&gt;
&lt;header&gt;
&lt;title&gt;Home Air Dirtier&lt;/title&gt;
&lt;/header&gt;
&lt;body&gt;
&lt;h2&gt;Home Air Dirtier&lt;/h2&gt;
&lt;h4&gt;Missing your home in the middle of the city?&lt;/h4&gt;
 
&lt;p&gt;
Like many ex-city-dwellers, you might be finding that the air in the countryside is just too clean.
 
&lt;p&gt;
You can remedy this right now with the &lt;i&gt;UltraAppliance&lt;/i&gt; &lt;b&gt;Home Air Dirtier&lt;/b&gt;. 
 
&lt;p&gt;
Simply insert our patented &lt;i&gt;CityFilth&lt;/i&gt; cartridge, and soon you'll be enjoying the aromas of vehicle fumes and decaying garbage that 
you're used to from home.
 
&lt;p&gt;
&lt;b&gt;Please note:&lt;/b&gt; Decaying garbage smells may confuse your pet. No matter how much he hunts, he will not be able to find the garbage he can 
smell. 
We recommend adding genuine garbage to your environment if this is a concern.
 
&lt;/body&gt;
&lt;/html&gt;</pre></div>
                        <!-- class="section" -->
                        <div class="section" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIAHJBBD">
                           <p class="subhead3" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__GUID-641EA50F-16B0-4319-89E7-B2DA86514E99">Pet.html</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section"><pre class="oac_no_warn" dir="ltr">&lt;html&gt;
&lt;header&gt;
&lt;title&gt;The Pet Magnet&lt;/title&gt;
&lt;/header&gt;
&lt;body&gt;
&lt;h2&gt;The Pet Magnet&lt;/h2&gt;
 
&lt;h4&gt;Every pet owner loves to let his or her pet run free, but that's not always possible&lt;/h4&gt;
 
&lt;p&gt;
Sometimes local laws require pets to be on leashes. Sometimes a free-roaming pet will ruin a flower bed, leave a "calling card" on the 
sidewalk, or chew through another pet. In the case of extremely smart pets, like chimpanzees or dolphins, the unattended pet may get 
away and run up hundreds of dollars of long-distance charges on your phone.
 
&lt;p&gt;
But leashes aren't always a practical answer. They can be too confining, or too big, or can tug uncomfortably at the pet's neck. They 
may get tangled, or wrapped around poles or passersby. Pets may chew through the leash, or, again, in the case of extremely smart pets, 
burn through it with an acetylene torch. In the case of cats, leashes simply look ridiculous, as though the pet owner really wanted to 
own a dog but got confused at the pet store.
 
&lt;p&gt; 
The &lt;b&gt;Hold 'Em 2000 Pet Magnet&lt;/b&gt; from &lt;i&gt;UltraAppliance&lt;/i&gt; is the answer. Instead of old-fashioned leashes, the 
&lt;b&gt;Hold 'Em 2000 Pet Magnet&lt;/b&gt; keeps your pet under control in a humane and simple way.
 
&lt;p&gt;
Here's how it works. Dozens of small magnets are placed underneath the coat of your pet, where they remain painlessly invisible. Any time 
you need to recall your animal, you merely activate the handy, massive Hold 'Em 2000 Pet Magnet electromagnet (fits inside any extremely 
oversized purse) and your pet is gently and painlessly dragged to you from up to 100 yards. It's a must-have for any pet owner!
 
&lt;p&gt;
 
&lt;blockquote&gt;
&lt;i&gt;
"The &lt;b&gt;Hold 'Em 2000 Pet Magnet&lt;/b&gt; not only keeps my dog from running away, but the electromagnet also comes in very handy if I need to 
find a needle in a haystack"&lt;/i&gt;
-- Anonymous Celebrity
&lt;/blockquote&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div>
                        <!-- class="section" -->
                        <div class="section" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__CIADIEFD">
                           <p class="subhead3" id="GUID-19B22A53-0B88-483E-9909-49EC1FAF1382__GUID-E18900F8-5F54-4D95-8762-10FFD019F719">Snooze.html</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section"><pre class="oac_no_warn" dir="ltr">&lt;html&gt;
&lt;header&gt;
&lt;title&gt;Esteem-building Talking Pillow&lt;/title&gt;
&lt;/header&gt;
&lt;body&gt;
&lt;h2&gt;Esteem-building Talking Pillow&lt;/h2&gt;
&lt;h4&gt;Do you feel less than your true potential when you wake up in the morning?&lt;/h4&gt;
 
&lt;p&gt;
We searched for a way to capture the wasted time spent sleeping and to use this precious time to build motivation, character, and self-esteem.
 
&lt;p&gt;
We are proud to announce the &lt;b&gt;Esteem-building Talking Pillow&lt;/b&gt;. Our pride in this wonderful invention glows even more because: 
&lt;i&gt;We use our own invention every night!&lt;/i&gt;
 
&lt;p&gt;
Only you will know that you are sleeping with the &lt;b&gt;Esteem-building Talking Pillow&lt;/b&gt; because only you can hear the soothing 
affirmations that gently enter your brain through the discreet speaker.
 
&lt;p&gt;
You will wake up refreshed and raring to go with a new sense of pride and enthusiasm for any task the day may bring. 
 
&lt;p&gt;
Be the first to own the &lt;b&gt;Esteem-building Talking Pillow&lt;/b&gt;! Your friends and fellow workers will be amazed when you no longer 
cower in the corner. Now you will join in every conversation.
 
&lt;p&gt;
&lt;b&gt;Disclaimer:&lt;/b&gt; Not responsible for narcissism and hyberbolic statements. May cause extreme behavior with overuse.
 
&lt;/body&gt;
&lt;/html&gt;</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="CCAPP9378"></a><div class="props_rev_3"><a id="GUID-6F1889D2-689F-4548-8B0A-D6ED37ECC092" name="GUID-6F1889D2-689F-4548-8B0A-D6ED37ECC092"></a><h5 id="CCAPP-GUID-6F1889D2-689F-4548-8B0A-D6ED37ECC092" class="sect5"><span class="enumeration_section">A.2.3.4 </span>search_htmlservices.sql
                     </h5>
                     <div>
                        <div class="section"><pre class="oac_no_warn" dir="ltr">set define off
 
create or replace package search_htmlServices as
  procedure showHTMLDoc (p_id in numeric);
  procedure showDoc  (p_id in varchar2, p_query in varchar2);
end search_htmlServices;
/
show errors;
 
create or replace package body search_htmlServices as
 
  procedure showHTMLDoc (p_id in numeric) is
    v_clob_selected   CLOB;
    v_read_amount     integer;
    v_read_offset     integer;
    v_buffer          varchar2(32767);
   begin
 
     select text into v_clob_selected from search_table where tk = p_id;
     v_read_amount := 32767;
     v_read_offset := 1;
   begin
    loop
      dbms_lob.read(v_clob_selected,v_read_amount,v_read_offset,v_buffer);
      htp.print(v_buffer);
      v_read_offset := v_read_offset + v_read_amount;
      v_read_amount := 32767;
    end loop;
   exception
   when no_data_found then
     null;
   end;
 end showHTMLDoc;
 
procedure showDoc (p_id in varchar2, p_query in varchar2) is
 
 v_clob_selected   CLOB;
 v_read_amount     integer;
 v_read_offset     integer;
 v_buffer          varchar2(32767);
 v_query           varchar(2000);
 v_cursor          integer;
 
 begin
   htp.p('&lt;html&gt;&lt;title&gt;HTML version with highlighted terms&lt;/title&gt;');
   htp.p('&lt;body bgcolor="#ffffff"&gt;');
   htp.p('&lt;b&gt;HTML version with highlighted terms&lt;/b&gt;');
 
   begin
     ctx_doc.markup (index_name =&gt; 'idx_search_table',
                     textkey    =&gt; p_id,
                     text_query =&gt; p_query,
                     restab     =&gt; v_clob_selected,
                     starttag   =&gt; '&lt;i&gt;&lt;font color=red&gt;',
                     endtag     =&gt; '&lt;/font&gt;&lt;/i&gt;');
 
     v_read_amount := 32767;
     v_read_offset := 1;
     begin
      loop
        dbms_lob.read(v_clob_selected,v_read_amount,v_read_offset,v_buffer);
        htp.print(v_buffer);
        v_read_offset := v_read_offset + v_read_amount;
        v_read_amount := 32767;
      end loop;
     exception
      when no_data_found then
         null;
     end;
 
     exception
      when others then
        null; --showHTMLdoc(p_id);
   end;
end showDoc;
end search_htmlServices; 
/
show errors
 
set define on</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="CCAPP9379"></a><div class="props_rev_3"><a id="GUID-B82F1C3B-2EAC-4036-9584-ED7384D9CB80" name="GUID-B82F1C3B-2EAC-4036-9584-ED7384D9CB80"></a><h5 id="CCAPP-GUID-B82F1C3B-2EAC-4036-9584-ED7384D9CB80" class="sect5"><span class="enumeration_section">A.2.3.5 </span>search_html.psp
                     </h5>
                     <div>
                        <div class="section"><pre class="oac_no_warn" dir="ltr">&lt;%@ plsql procedure="search_html" %&gt;
&lt;%@ plsql parameter="query" default="null" %&gt;
&lt;%! v_results number := 0; %&gt;
 
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;search_html Search &lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
 
&lt;%
 
IF query IS NULL THEN
%&gt;
 
  &lt;center&gt;
    &lt;form method="post" action="search_html"&gt;
     &lt;b&gt;Search for: &lt;/b&gt;
     &lt;input type="text" name="query" size="30"&gt;&amp;nbsp;
     &lt;input type="submit" value="Search"&gt;
  &lt;/center&gt;
&lt;hr&gt;
 
&lt;% 
  ELSE
%&gt;
 
   &lt;p&gt;
   &lt;%!
      color varchar2(6) := 'ffffff';
   %&gt;
 
   &lt;center&gt;
     &lt;form method="post" action="search_html"&gt;
      &lt;b&gt;Search for:&lt;/b&gt;
      &lt;input type="text" name="query" size="30" value="&lt;%= query %&gt;"&gt;
      &lt;input type="submit" value="Search"&gt;
     &lt;/form&gt;
   &lt;/center&gt;
   &lt;hr&gt;
   &lt;p&gt;
 
   &lt;%
     -- select statement 
    FOR DOC IN (
                SELECT /*+ DOMAIN_INDEX_SORT */ rowid, tk, title, score(1) scr
                FROM search_table
                WHERE CONTAINS(text, query,1) &gt;0
                ORDER BY score(1) DESC
               ) 
         LOOP
           v_results := v_results + 1;
           IF v_results = 1 THEN
 
   %&gt;
 
             &lt;center&gt;
              &lt;table border="0"&gt;
                &lt;tr bgcolor="#6699CC"&gt;
                  &lt;th&gt;Score&lt;/th&gt;
                  &lt;th&gt;Title&lt;/th&gt;
                &lt;/tr&gt;
 
  &lt;%      END IF; %&gt;
          &lt;tr bgcolor="#&lt;%= color %&gt;"&gt;
           &lt;td&gt; &lt;%= doc.scr %&gt;% &lt;/td&gt;
           &lt;td&gt; &lt;%= doc.title %&gt;
           [&lt;a href="search_htmlServices.showHTMLDoc?p_id=
                  &lt;%= doc.tk %&gt;"&gt;HTML&lt;/a&gt;]
           [&lt;a href="search_htmlServices.showDoc?p_id=
                  &lt;%= doc.tk %&gt;&amp;p_query=&lt;%= query %&gt;"&gt;Highlight&lt;/a&gt;]
           &lt;/td&gt;
         &lt;/tr&gt;
 
   &lt;%
          IF (color = 'ffffff') THEN
               color := 'eeeeee';
             ELSE
               color := 'ffffff';
          END IF;
 
     END LOOP; 
   %&gt;
 
    &lt;/table&gt;
   &lt;/center&gt;
 
&lt;% 
  END IF;
%&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div><a id="CCAPP9380"></a><div class="props_rev_3"><a id="GUID-DEABF1DC-7C2E-436D-A83F-D036260B0B32" name="GUID-DEABF1DC-7C2E-436D-A83F-D036260B0B32"></a><h3 id="CCAPP-GUID-DEABF1DC-7C2E-436D-A83F-D036260B0B32" class="sect3"><span class="enumeration_section">A.3 </span>The Java Server Pages (JSP) Web Application
               </h3>
               <div>
                  <p>Creating the JSP-based web application involves most of the same steps as those used in building the PSP-based application. See <span class="q">"<a href="CONTEXT-query-application.html#GUID-03558FFB-EFEF-4B43-92CA-E9ABB5EC0E6B">Building the PSP Web Application</a>"</span> for more information. You can use the same <code class="codeph">loader.dat</code> and <code class="codeph">loader.ctl</code> files. However, with the JSP-based application, you do not need to do the following:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Compile the <code class="codeph">search_htmlservices</code> package
                        </p>
                     </li>
                     <li>
                        <p>Compile the <code class="codeph">search_html</code> PSP page with <code class="codeph">loadpsp</code></p>
                     </li>
                  </ul>
                  <p>This section contains the following topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="CONTEXT-query-application.html#GUID-3749D0FF-0B93-4224-AD99-0AC17FDF4A01">JSP Web Application Prerequisites</a></p>
                     </li>
                     <li>
                        <p><a href="CONTEXT-query-application.html#GUID-CC35F085-B0A1-450D-B5C5-1E16C747AF0A">JSP Web Application Sample Code</a></p>
                     </li>
                  </ul>
               </div><a id="CCAPP9381"></a><div class="props_rev_3"><a id="GUID-3749D0FF-0B93-4224-AD99-0AC17FDF4A01" name="GUID-3749D0FF-0B93-4224-AD99-0AC17FDF4A01"></a><h4 id="CCAPP-GUID-3749D0FF-0B93-4224-AD99-0AC17FDF4A01" class="sect4"><span class="enumeration_section">A.3.1 </span>JSP Web Application Prerequisites
                  </h4>
                  <div>
                     <p>The JSP web application has the following requirements:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Your Oracle Database must be up and running.</p>
                        </li>
                        <li>
                           <p>You have a web server such as Apache Tomcat, which can run JavaServer Pages (JSP) scripts that connect to the Oracle Database by using Java Database Connectivity (JDBC).</p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-3749D0FF-0B93-4224-AD99-0AC17FDF4A01__GUID-0BB76621-754C-47F3-B3BD-A0AE6787D5CC">
                        <p class="notep1">See Also:</p>
                        <p><span class="italic">Oracle Database 2 Day + PHP Developer's Guide</span> for information about installing Apache HTTP Server
                        </p>
                     </div>
                  </div>
               </div><a id="CCAPP9382"></a><div class="props_rev_3"><a id="GUID-CC35F085-B0A1-450D-B5C5-1E16C747AF0A" name="GUID-CC35F085-B0A1-450D-B5C5-1E16C747AF0A"></a><h4 id="CCAPP-GUID-CC35F085-B0A1-450D-B5C5-1E16C747AF0A" class="sect4"><span class="enumeration_section">A.3.2 </span>JSP Web Application Sample Code
                  </h4>
                  <div>
                     <p>This section lists the Java code used to build the example web application, as shown in the <code class="codeph">TextSearchApp.jsp</code> file. 
                     </p><pre class="oac_no_warn" dir="ltr">&lt;%@page language="java" pageEncoding="utf-8" contentType="text/html; charset=utf-8" %&gt;
&lt;%@ page import="java.sql.*, java.util.*, java.net.*, 
   oracle.jdbc.*, oracle.sql.*, oracle.jsp.dbutil.*" %&gt;
 
&lt;%
// Change these details to suit your database and user details
 
String connStr = "jdbc:oracle:thin:@//servername:1521/pdb1";
String dbUser  = "scott";
String dbPass  = "tiger";
 
// The table we're running queries against is called SEARCH_TABLE.
// It must have columns:
//  tk     number  primary key,     (primary key is important for document services)
//  title  varchar2(2000),
//  text   clob
// There must be a CONTEXT index called IDX_SEARCH_TABLE on the text column
 
request.setCharacterEncoding("UTF-8");
 
java.util.Properties info=new java.util.Properties();
Connection conn  = null;
ResultSet rset   = null;
OracleCallableStatement callStmt = null;
Statement stmt   = null;
String userQuery = null;
String myQuery   = null;
String action    = null;
String theTk     = null;
URLEncoder myEncoder;
int count=0;
int loopNum=0;
int startNum=0;
 
userQuery     =   request.getParameter("query");
action        =   request.getParameter("action");
theTk         =   request.getParameter("tk");
 
if (action == null)  action = "";
 
// Connect to database
 
try {
  DriverManager.registerDriver(new oracle.jdbc.driver.OracleDriver() );
  info.put ("user",     dbUser);
  info.put ("password", dbPass);
  conn      = DriverManager.getConnection(connStr,info);
}
  catch (SQLException e) {
%&gt;    &lt;b&gt;Error: &lt;/b&gt; &lt;%= e %&gt;&lt;p&gt;  &lt;%
  } 
 
if ( action.equals("doHTML") ) {
  // Directly display the text of the document
  try {
 
    // not attempting to share the output table for this example, we'll truncate it each time
    conn.createStatement().execute("truncate table OUTPUT_TABLE");
 
    String sql = "{ call ctx_doc.filter( index_name=&gt;'IDX_SEARCH_TABLE', textkey=&gt; '" + theTk + "', restab=&gt;'OUTPUT_TABLE', 
                  plaintext=&gt;false ) }";
    PreparedStatement s = conn.prepareCall( sql );
    s.execute();
 
    sql = "select document from output_table where rownum = 1";
    stmt = conn.createStatement();
    rset = stmt.executeQuery(sql);
 
    rset.next();
    oracle.sql.CLOB res = (oracle.sql.CLOB) rset.getClob(1);
    // should fetch from clob piecewise, but to keep it simple we'll just fetch 32K to a string
    String txt = res.getSubString(1, 32767);
    out.println(txt);
  }
  catch (SQLException e) {
%&gt;    &lt;b&gt;Error: &lt;/b&gt; &lt;%= e %&gt;&lt;p&gt; &lt;%
  }
}
else if ( action.equals("doHighlight") ) {
  // Display the text of the document with highlighting from the "markup" function
  try {
 
    // not attempting to share the output table for this example, we'll truncate it each time
    conn.createStatement().execute("truncate table OUTPUT_TABLE");
 
    String sql = "{ call ctx_doc.markup( index_name=&gt;'IDX_SEARCH_TABLE', textkey=&gt; '" + theTk + "', text_query =&gt; '" + userQuery + "', 
                  restab=&gt;'OUTPUT_TABLE', plaintext=&gt;false, starttag =&gt; '&lt;i&gt;&lt;font color=\"red\"&gt;', endtag =&gt; '&lt;/font&gt;&lt;/i&gt;' ) }";
    PreparedStatement s = conn.prepareCall( sql );
    s.execute();
 
    sql = "select document from output_table where rownum = 1";
    stmt = conn.createStatement();
    rset = stmt.executeQuery(sql);
 
    rset.next();
    oracle.sql.CLOB res = (oracle.sql.CLOB) rset.getClob(1);
    // should fetch from clob piecewise, but to keep it simple we'll just fetch 32K to a string
    String txt = res.getSubString(1, 32767);
    out.println(txt);
  }
  catch (SQLException e) {
%&gt;    &lt;b&gt;Error: &lt;/b&gt; &lt;%= e %&gt;&lt;p&gt; &lt;%
  }
}
 
else if ( action.equals("doThemes") ) {
  // Display the text of the document with highlighting from the "markup" function
  try {
 
    // not attempting to share the output table for this example, we'll truncate it each time
    conn.createStatement().execute("truncate table THEME_TABLE");
 
    String sql = "{ call ctx_doc.themes( index_name=&gt;'IDX_SEARCH_TABLE', textkey=&gt; '" + theTk + "', restab=&gt;'THEME_TABLE') }";
    PreparedStatement s = conn.prepareCall( sql );
    s.execute();
 
    sql = "select * from ( select theme, weight from theme_table order by weight desc ) where rownum &lt;= 20";
    stmt = conn.createStatement();
    rset = stmt.executeQuery(sql);
    int    weight = 0;
    String theme  = "";
%&gt;
    &lt;h2&gt;The top 20 themes of the document&lt;/h2&gt;
    &lt;table BORDER=1 CELLSPACING=0 CELLPADDING=0"
       &lt;tr bgcolor="#CCCC99"&gt;
       &lt;th&gt;&lt;font face="arial" color="#336699"&gt;Theme&lt;/th&gt;
       &lt;th&gt;&lt;font face="arial" color="#336699"&gt;Weight&lt;/th&gt;
       &lt;/tr&gt;
&lt;%
    while ( rset.next() ) {
 
      theme  = rset.getString(1); 
      weight = (int)rset.getInt(2);
%&gt;
       &lt;tr bgcolor="ffffe0"&gt;
         &lt;td align="center"&gt;&lt;font face="arial"&gt;&lt;b&gt; &lt;%= theme  %&gt; &lt;/b&gt;&lt;/font&gt;&lt;/td&gt;
         &lt;td align="center"&gt;&lt;font face="arial"&gt; &lt;%= weight %&gt;&lt;/font&gt;&lt;/td&gt;
       &lt;/tr&gt;
&lt;%
    }
 
%&gt;
&lt;/table&gt;
&lt;%
  }
  catch (SQLException e) {
%&gt;    &lt;b&gt;Error: &lt;/b&gt; &lt;%= e %&gt;&lt;p&gt; &lt;%
  }
}
else if ( action.equals("doGists") ) {
  // Display the text of the document with highlighting from the "markup" function
  try {
 
    // not attempting to share the output table for this example, we'll truncate it each time
    conn.createStatement().execute("truncate table GIST_TABLE");
 
    String sql = "{ call ctx_doc.gist( index_name=&gt;'IDX_SEARCH_TABLE', textkey=&gt; '" + theTk + "', restab=&gt;'GIST_TABLE', query_id=&gt;1) }";
    PreparedStatement s = conn.prepareCall( sql );
    s.execute();
 
    sql = "select pov, gist from gist_table where pov = 'GENERIC' and query_id = 1";
    stmt = conn.createStatement();
    rset = stmt.executeQuery(sql);
    String pov   = "";
    String gist  = "";
 
    while ( rset.next() ) {
 
      pov   = rset.getString(1); 
      oracle.sql.CLOB gistClob = (oracle.sql.CLOB) rset.getClob(2);
 
      out.println("&lt;h3&gt;Document Gist for Point of View: " + pov + "&lt;/h3&gt;");
      gist = gistClob.getSubString(1, 32767);
      out.println(gist);
 
    }
 
%&gt;
&lt;/table&gt;
&lt;%
  }
  catch (SQLException e) {
%&gt;    &lt;b&gt;Error: &lt;/b&gt; &lt;%= e %&gt;&lt;p&gt; &lt;%
  }
}
 
if ( (action.equals("")) &amp;&amp; ( (userQuery == null) || (userQuery.length() == 0) ) ) {
%&gt;
  &lt;html&gt;
    &lt;title&gt;Text Search&lt;/title&gt;
    &lt;body&gt;
      &lt;table width="100%"&gt;
        &lt;tr bgcolor="#336699"&gt;
          &lt;td&gt;&lt;font face="arial" align="left" 
          color="#CCCC99" size="+2"&gt;Text Search&lt;/td&gt;
        &lt;/tr&gt;
      &lt;/table&gt;
    &lt;center&gt;
      &lt;form method = post&gt;
      Search for:
      &lt;input type="text" name="query" size = "30"&gt;
      &lt;input type="submit" value="Search"&gt;
      &lt;/form&gt;
    &lt;/center&gt;
    &lt;/body&gt;
  &lt;/html&gt;
&lt;%
}
else if (action.equals("") ) {
%&gt;
  &lt;html&gt;
    &lt;title&gt;Text Search Result Page&lt;/title&gt;
    &lt;body text="#000000" bgcolor="#FFFFFF" link="#663300" 
          vlink="#996633" alink="#ff6600"&gt;
      &lt;table width="100%"&gt;
        &lt;tr bgcolor="#336699"&gt;
          &lt;td&gt;&lt;font face="arial" align="left" 
                 color="#CCCC99" size=+2&gt;Text Search&lt;/td&gt;
        &lt;/tr&gt;
      &lt;/table&gt;
    &lt;center&gt;
      &lt;form method = post action="TextSearchApp.jsp"&gt;
      Search for:
      &lt;input type=text name="query" value="&lt;%= userQuery %&gt;" size = 30&gt;
      &lt;input type=submit value="Search"&gt;
      &lt;/form&gt;
    &lt;/center&gt;
&lt;%
  myQuery   =   URLEncoder.encode(userQuery);
  try {
 
    stmt      = conn.createStatement();
 
    String numStr =   request.getParameter("sn");
    if(numStr!=null)
      startNum=Integer.parseInt(numStr);
    String theQuery =   translate(userQuery);
 
    callStmt =(OracleCallableStatement)conn.prepareCall("begin "+
         "?:=ctx_query.count_hits(index_name=&gt;'IDX_SEARCH_TABLE', "+
         "text_query=&gt;?"+
         "); " +
         "end; ");
    callStmt.setString(2,theQuery);
    callStmt.registerOutParameter(1, OracleTypes.NUMBER);
    callStmt.execute();
    count=((OracleCallableStatement)callStmt).getNUMBER(1).intValue();
    if(count&gt;=(startNum+20)){
%&gt;
    &lt;font color="#336699" FACE="Arial" SIZE=+1&gt;Results
           &lt;%=startNum+1%&gt; - &lt;%=startNum+20%&gt; of &lt;%=count%&gt; matches
&lt;%
    }
    else if(count&gt;0){
%&gt;
    &lt;font color="#336699" FACE="Arial" SIZE=+1&gt;Results
           &lt;%=startNum+1%&gt; - &lt;%=count%&gt; of &lt;%=count%&gt; matches
&lt;%
    }
    else {
%&gt;
    &lt;font color="#336699" FACE="Arial" SIZE=+1&gt;No match found
&lt;%
    }
%&gt;
  &lt;table width="100%"&gt;
  &lt;TR ALIGN="RIGHT"&gt;
&lt;%
  if((startNum&gt;0)&amp;(count&lt;=startNum+20))
  {
%&gt;
    &lt;TD ALIGN="RIGHT"&gt;
    &lt;a href="TextSearchApp.jsp?sn=&lt;%=startNum-20 %&gt;&amp;query=
            &lt;%=myQuery %&gt;"&gt;previous20&lt;/a&gt;
    &lt;/TD&gt;
&lt;%
  }
  else if((count&gt;startNum+20)&amp;(startNum==0))
  {
%&gt;
    &lt;TD ALIGN="RIGHT"&gt;
    &lt;a href="TextSearchApp.jsp?sn=&lt;%=startNum+20 
          %&gt;&amp;query=&lt;%=myQuery %&gt;"&gt;next20&lt;/a&gt;
    &lt;/TD&gt;
&lt;%
  }
  else if((count&gt;startNum+20)&amp;(startNum&gt;0))
  {
%&gt;
    &lt;TD ALIGN="RIGHT"&gt;
    &lt;a href="TextSearchApp.jsp?sn=&lt;%=startNum-20 %&gt;&amp;query=
              &lt;%=myQuery %&gt;"&gt;previous20&lt;/a&gt;
    &lt;a href="TextSearchApp.jsp?sn=&lt;%=startNum+20 %&gt;&amp;query=
              &lt;%=myQuery %&gt;"&gt;next20&lt;/a&gt;
    &lt;/TD&gt;
&lt;%
  }
%&gt;
  &lt;/TR&gt;
  &lt;/table&gt;
&lt;%
    String ctxQuery = 
        " select /*+ FIRST_ROWS */ " + 
        "   tk, TITLE, score(1) scr, " +
        "   ctx_doc.snippet ('IDX_SEARCH_TABLE', tk, '" + theQuery + "') " + 
        " from search_table " + 
        " where contains(TEXT, '"+theQuery+"',1 ) &gt; 0 " +
        " order by score(1) desc"; 
    rset = stmt.executeQuery(ctxQuery);
    String   tk           = null;
    String[] colToDisplay = new String[1];
    int      myScore      = 0;
    String   snippet      = "";
    int      items        = 0;
    while (rset.next()&amp;&amp;items&lt; 20) {
      if(loopNum&gt;=startNum)
      {
        tk = rset.getString(1);
        colToDisplay[0] = rset.getString(2);
        myScore         = (int)rset.getInt(3);
        snippet         = rset.getString(4);
        items++;
        if (items == 1) {
%&gt;
        &lt;center&gt;
          &lt;table BORDER=1 CELLSPACING=0 CELLPADDING=0 width="100%"
            &lt;tr bgcolor="#CCCC99"&gt;
              &lt;th&gt;&lt;font face="arial" color="#336699"&gt;Score&lt;/th&gt;
              &lt;th&gt;&lt;font face="arial" color="#336699"&gt;TITLE&lt;/th&gt;
              &lt;th&gt;&lt;font face="arial" color="#336699"&gt;Snippet&lt;/th&gt;
              &lt;th&gt; &lt;font face="arial" 
                       color="#336699"&gt;Document Services&lt;/th&gt;
            &lt;/tr&gt;
&lt;%   } %&gt;
      &lt;tr bgcolor="#FFFFE0"&gt;
        &lt;td ALIGN="CENTER"&gt; &lt;%= myScore %&gt;%&lt;/td&gt;
        &lt;td&gt; &lt;%= colToDisplay[0] %&gt; &lt;/td&gt;
        &lt;td&gt; &lt;%= snippet %&gt; &lt;/td&gt;
        &lt;td&gt;
          &lt;a href="TextSearchApp.jsp?action=doHTML&amp;tk=&lt;%= tk %&gt;"&gt;HTML&lt;/a&gt; &amp;nbsp;
          &lt;a href="TextSearchApp.jsp?action=doHighlight&amp;tk=&lt;%= tk %&gt;&amp;query=&lt;%= theQuery %&gt;"&gt;Highlight&lt;/a&gt; &amp;nbsp;
          &lt;a href="TextSearchApp.jsp?action=doThemes&amp;tk=&lt;%= tk %&gt;&amp;query=&lt;%= theQuery %&gt;"&gt;Themes&lt;/a&gt; &amp;nbsp;
          &lt;a href="TextSearchApp.jsp?action=doGists&amp;tk=&lt;%= tk %&gt;"&gt;Gist&lt;/a&gt; &amp;nbsp;
        &lt;/td&gt;
      &lt;/tr&gt;
&lt;%
      }
      loopNum++;
    }
} catch (SQLException e) {
%&gt;
    &lt;b&gt;Error: &lt;/b&gt; &lt;%= e %&gt;&lt;p&gt;
&lt;%
} finally {
  if (conn != null) conn.close();
  if (stmt != null) stmt.close();
  if (rset != null) rset.close();
  }
%&gt;
  &lt;/table&gt;
  &lt;/center&gt;
  &lt;table width="100%"&gt;
  &lt;TR ALIGN="RIGHT"&gt;
&lt;%
  if((startNum&gt;0)&amp;(count&lt;=startNum+20))
  {
%&gt;
    &lt;TD ALIGN="RIGHT"&gt;
    &lt;a href="TextSearchApp.jsp?sn=&lt;%=startNum-20 %&gt;&amp;query=
               &lt;%=myQuery %&gt;"&gt;previous20&lt;/a&gt;
    &lt;/TD&gt;
&lt;%
  }
  else if((count&gt;startNum+20)&amp;(startNum==0))
  {
%&gt;
    &lt;TD ALIGN="RIGHT"&gt;
    &lt;a href="TextSearchApp.jsp?sn=&lt;%=startNum+20 %&gt;&amp;query=
          &lt;%=myQuery %&gt;"&gt;next20&lt;/a&gt;
    &lt;/TD&gt;
&lt;%
  }
  else if((count&gt;startNum+20)&amp;(startNum&gt;0))
  {
%&gt;
    &lt;TD ALIGN="RIGHT"&gt;
    &lt;a href="TextSearchApp.jsp?sn=&lt;%=startNum-20 %&gt;&amp;query=
          &lt;%=myQuery %&gt;"&gt;previous20&lt;/a&gt;
    &lt;a href="TextSearchApp.jsp?sn=&lt;%=startNum+20 %&gt;&amp;query=
          &lt;%=myQuery %&gt;"&gt;next20&lt;/a&gt;
    &lt;/TD&gt;
&lt;%
  }
%&gt;
  &lt;/TR&gt;
  &lt;/table&gt;
  &lt;/body&gt;&lt;/html&gt;
&lt;%}
 
%&gt;
&lt;%!
   public String translate (String input)
   {
      Vector reqWords = new Vector();
      StringTokenizer st = new StringTokenizer(input, " '", true);
      while (st.hasMoreTokens())
      {
        String token = st.nextToken();
        if (token.equals("'"))
        {
           String phrase = getQuotedPhrase(st);
           if (phrase != null)
           {
              reqWords.addElement(phrase);
           }
        }
        else if (!token.equals(" "))
        {
           reqWords.addElement(token);
        }
      }
      return getQueryString(reqWords);
   }
 
   private String getQuotedPhrase(StringTokenizer st)
   {
      StringBuffer phrase = new StringBuffer();
      String token = null;
      while (st.hasMoreTokens() &amp;&amp; (!(token = st.nextToken()).equals("'")))
      {
        phrase.append(token);
      }
      return phrase.toString();
   }
  
   private String getQueryString(Vector reqWords)
   {
      StringBuffer query = new StringBuffer("");
      int length = (reqWords == null) ? 0 : reqWords.size();
      for (int ii=0; ii &lt; length; ii++)
      {
         if (ii != 0)
         {
           query.append(" &amp; ");
         }
         query.append("{");
         query.append(reqWords.elementAt(ii));
         query.append("}");
      }
      return query.toString();
   }
%&gt;</pre></div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>