<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>About Fast Connection Failover</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Universal Connection Pool Developer's Guide ">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Universal Connection Pool Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="universal-connection-pool-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-02-13T06:57:38-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="1999, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96473-02">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="overview-Oracle-RAC-features.html" title="Previous" type="text/html">
      <link rel="next" href="run-time-connection-load-balancing.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Universal Connection Pool Developer's Guide">
    <meta name="dcterms.isVersionOf" content="JJUCP">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="overview-Oracle-RAC-features.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="run-time-connection-load-balancing.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Universal Connection Pool Developer's Guide </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="using-Oracle-RAC-features.html" property="item" typeof="WebPage"><span property="name">Using Oracle RAC Features</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">About Fast Connection Failover</li>
            </ol>
            <a id="GUID-126F8C9B-C0B3-426B-B07D-4B127BBDD867" name="GUID-126F8C9B-C0B3-426B-B07D-4B127BBDD867"></a><a id="JJUCP08100"></a>
            
            <h2 id="JJUCP-GUID-126F8C9B-C0B3-426B-B07D-4B127BBDD867" class="sect2"><span class="enumeration_section">9.2 </span>About Fast Connection Failover
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>This section contains the following subsections:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="fast-connection-failover.html#GUID-B8D3EAED-A8D8-47C9-9ECC-296B9D988763">Overview of Fast Connection Failover</a></p>
                  </li>
                  <li>
                     <p><a href="fast-connection-failover.html#GUID-1777BFF1-1FDB-4D3C-BA68-8DD165733F69">What is Fast Connection Failover</a></p>
                  </li>
                  <li>
                     <p><a href="fast-connection-failover.html#GUID-DEBA115B-9B14-4C4C-83EB-7D09F9F48970">Fast Connection Failover Prerequisites</a></p>
                  </li>
                  <li>
                     <p><a href="fast-connection-failover.html#GUID-18F60DC2-A4C2-43D7-9BCB-628D09A1AC0F">Example of Fast Connection Failover Configuration</a></p>
                  </li>
                  <li>
                     <p><a href="fast-connection-failover.html#GUID-A85462D1-A4F1-43DC-869E-721AE30B7E78">Enabling Fast Connection Failover</a></p>
                  </li>
                  <li>
                     <p><a href="fast-connection-failover.html#GUID-F361FE59-9D12-47F9-B5DC-F5D996809AF4">What is ONS</a></p>
                  </li>
                  <li>
                     <p><a href="fast-connection-failover.html#GUID-C54F3D4D-9973-41EA-B62B-E574DE94970F">Configuring the Connection URL</a></p>
                  </li>
               </ul>
            </div><a id="JJUCP8203"></a><a id="JJUCP8204"></a><a id="JJUCP8205"></a><a id="JJUCP8269"></a><div class="props_rev_3"><a id="GUID-B8D3EAED-A8D8-47C9-9ECC-296B9D988763" name="GUID-B8D3EAED-A8D8-47C9-9ECC-296B9D988763"></a><h3 id="JJUCP-GUID-B8D3EAED-A8D8-47C9-9ECC-296B9D988763" class="sect3"><span class="enumeration_section">9.2.1 </span>Overview of Fast Connection Failover
               </h3>
               <div>
                  <p><a id="d8155e109" class="indexterm-anchor"></a><a id="d8155e111" class="indexterm-anchor"></a><a id="d8155e115" class="indexterm-anchor"></a>The Fast Connection Failover (FCF) feature is a Fast Application Notification (FAN) client implemented through the connection pool. The feature requires the use of an Oracle JDBC driver and an Oracle RAC database or an Oracle Restart on a single instance database.
                  </p>
                  <div class="infoboxnote" id="GUID-B8D3EAED-A8D8-47C9-9ECC-296B9D988763__GUID-EE02456E-B8FE-4E2C-B661-11EE24F52479">
                     <p class="notep1">Note:</p>
                     <p>This section only describes the steps that an application must perform when using FCF with Oracle RAC.</p>
                  </div>
                  <div class="infoboxnotealso" id="GUID-B8D3EAED-A8D8-47C9-9ECC-296B9D988763__GUID-657D6D96-11B8-47FE-9501-08F3E034E69D">
                     <p class="notep1">See Also:</p>
                     <p><a href="../racad/introduction-to-oracle-rac.html#RACAD-GUID-3FE2D3E6-EC1C-4478-A9E4-3751F7A47C9E" target="_blank"><span><cite>Oracle Real Application Clusters Administration and Deployment Guide</cite></span></a> for more information on setting up an Oracle RAC database, or consult an Oracle database administrator.
                     </p>
                  </div>
                  <p><a id="d8155e130" class="indexterm-anchor"></a>FCF manages pooled connections for high availability and provides the following features:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>FCF supports unplanned outages. Dead connections are rapidly detected and then the connections are aborted and removed from the pool. Connection removal relies on abort to rapidly sever socket connections in order to prevent hangs. Borrowed and in-use connections are interrupted only for unplanned outages.</p>
                     </li>
                     <li>
                        <p>FCF supports planned outages. Borrowed or in-use connections are not interrupted and closed until work is done and control of the connection is returned to the pool.</p>
                     </li>
                     <li>
                        <p>FCF encapsulates fatal connection errors and exceptions into the <code class="codeph">isValid</code> API for robust and efficient retries.
                        </p>
                     </li>
                     <li>
                        <p>FCF recognizes new nodes that join an Oracle RAC cluster and places new connections on that node appropriately in order to deliver maximum quality of service to applications at run time. This facilitates middle-tier integration of Oracle RAC node joins and work-request routing from the application tier.</p>
                     </li>
                     <li>
                        <p>FCF distributes run-time work requests to all active Oracle RAC instances.</p>
                     </li>
                  </ul>
                  <div class="section">
                     <p class="subhead2" id="GUID-B8D3EAED-A8D8-47C9-9ECC-296B9D988763__GUID-3B4C12DF-5416-46E0-8347-1CAFADA48E1A">Unplanned Shutdown Scenarios</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>FCF supports unplanned shutdown scenarios by detecting and removing stale connections to an Oracle RAC cluster. Stale connections include connections that do not have a service available on any instance in an Oracle RAC cluster due to service-down and node-down events. Borrowed connections and available connections that are stale are detected, and their network connection is severed before removing them from the pool. These removed connections are not replaced by the pool. Instead, the application must retry connections before performing any work with a connection.</p>
                     <div class="infoboxnote" id="GUID-B8D3EAED-A8D8-47C9-9ECC-296B9D988763__GUID-CF4EBDED-EAB9-4F2B-A4E2-797C21C43C74">
                        <p class="notep1">Note:</p>
                        <p>Borrowed connections are immediately aborted and closed during unplanned shutdown scenarios. Any on-going transactions immediately receive an exception.</p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section" id="GUID-B8D3EAED-A8D8-47C9-9ECC-296B9D988763__BABGFIFI">
                     <p class="subhead2" id="GUID-B8D3EAED-A8D8-47C9-9ECC-296B9D988763__GUID-7952931A-59EC-4C88-ACA7-C82C40E45D4E">Planned Shutdown Scenarios</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>FCF supports planned shutdown scenarios where an Oracle RAC service can be gracefully shutdown. In such scenarios, stale borrowed connections are marked and will only be aborted and removed after they are returned to the pool. Any on-going transactions do not see any difference and proceed to complete.</p>
                     <p>The primary difference between unplanned and planned shutdown scenarios is how borrowed connections are handled. Stale connections that are idle in the pool (not borrowed) are removed in the same manner as the unplanned shutdown scenario.</p>
                     <p>Starting from Oracle Database 12<span class="italic">c</span> Release 1 (12.1.0.2), UCP supports graceful connection draining from any planned-down Oracle RAC instance. Affected borrowed connections are removed smoothly over a grace period, instead of immediate removal upon their return to the pool. This helps in avoiding throughput impact and logon storms during any service relocation.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-B8D3EAED-A8D8-47C9-9ECC-296B9D988763__GUID-EC296D45-D419-40E5-AF46-9C4E109073CD">Oracle RAC Instance Rejoin and New Instance Scenarios</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>FCF supports scenarios where an Oracle RAC cluster adds instances that provide a service of interest. The instance may be new to the cluster or may have been restarted after a down event. In both cases, UCP recognizes the new instance and creates connections to the node as required.</p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="validating-ucp-connections.html#GUID-39E5A876-8C54-423F-B6A7-5E827DE202C7">Checking If a Connection Is Valid</a></li>
                        <li><a href="fast-connection-failover.html#GUID-A85462D1-A4F1-43DC-869E-721AE30B7E78">Enabling Fast Connection Failover</a></li>
                     </ul>
                  </div>
               </div>
               
            </div><a id="JJUCP8270"></a><div class="props_rev_3"><a id="GUID-1777BFF1-1FDB-4D3C-BA68-8DD165733F69" name="GUID-1777BFF1-1FDB-4D3C-BA68-8DD165733F69"></a><h3 id="JJUCP-GUID-1777BFF1-1FDB-4D3C-BA68-8DD165733F69" class="sect3"><span class="enumeration_section">9.2.2 </span>What is Fast Connection Failover?
               </h3>
               <div>
                  <p>After Fast Connection Failover is enabled, the mechanism is automatic; no application intervention is needed. This section discusses how a connection failover is presented to an application and what steps the application takes to recover, in the following sections:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="fast-connection-failover.html#GUID-AF352305-6B8F-47A9-BD73-1C7479E467BB">What the Application Sees</a></p>
                     </li>
                     <li>
                        <p><a href="fast-connection-failover.html#GUID-BD32FED1-6EE1-4148-A4C0-87A0A5E1DA85">How FCF Works</a></p>
                     </li>
                  </ul>
               </div><a id="JJUCP8271"></a><div class="props_rev_3"><a id="GUID-AF352305-6B8F-47A9-BD73-1C7479E467BB" name="GUID-AF352305-6B8F-47A9-BD73-1C7479E467BB"></a><h4 id="JJUCP-GUID-AF352305-6B8F-47A9-BD73-1C7479E467BB" class="sect4"><span class="enumeration_section">9.2.2.1 </span>What the Application Sees
                  </h4>
                  <div>
                     <p>By the time an Oracle RAC service failure is propagated to the JDBC application, the database already rolls back the local transaction. The cache manager then cleans up all invalid connections. When an application holding an invalid connection tries to do work through that connection, it is possible to receive <code class="codeph">SQLException, ORA-17008, Closed Connection</code>.
                     </p>
                     <p>When an application receives a <code class="codeph">Closed Connection</code> error message, it should do the following:
                     </p>
                     <ol>
                        <li>
                           <p>Retry the connection request. This is essential, because the old connection is no longer open.</p>
                        </li>
                        <li>
                           <p>Replay the transaction. All work done before the connection was closed has been lost.</p>
                        </li>
                     </ol>
                     <div class="infoboxnote" id="GUID-AF352305-6B8F-47A9-BD73-1C7479E467BB__GUID-92DFE648-F63A-4ABE-8FE7-906C62EAF721">
                        <p class="notep1">Note:</p>
                        <p>The application should not try to roll back the transaction. The transaction was already rolled back in the database by the time the application received the exception.</p>
                     </div>
                  </div>
               </div><a id="JJUCP8272"></a><div class="props_rev_3"><a id="GUID-BD32FED1-6EE1-4148-A4C0-87A0A5E1DA85" name="GUID-BD32FED1-6EE1-4148-A4C0-87A0A5E1DA85"></a><h4 id="JJUCP-GUID-BD32FED1-6EE1-4148-A4C0-87A0A5E1DA85" class="sect4"><span class="enumeration_section">9.2.2.2 </span>How FCF Works
                  </h4>
                  <div>
                     <p>Under Fast Connection Failover, each connection in the cache maintains a mapping to a service, instance, database, and host name.</p>
                     <p>When a database generates an Oracle RAC event, that event is forwarded to the JVM in which JDBC is running. A daemon thread inside the JVM receives the Oracle RAC event and passes it on to the Connection Cache Manager. The Connection Cache Manager then throws SQL exceptions to the applications affected by the Oracle RAC event. </p>
                     <p>A typical failover scenario may work like the following:</p>
                     <ol>
                        <li>
                           <p>A database instance fails, leaving several stale connections in the cache.</p>
                        </li>
                        <li>
                           <p>The Oracle RAC mechanism in the database generates an Oracle RAC event which is sent to the JVM containing JDBC.</p>
                        </li>
                        <li>
                           <p>The daemon thread inside the JVM finds all the connections affected by the Oracle RAC event, notifies them of the closed connection through SQL exceptions, and rolls back any open transactions.</p>
                        </li>
                        <li>
                           <p>Each individual connection receives a SQL exception and must retry.</p>
                        </li>
                     </ol>
                  </div>
               </div>
            </div><a id="JJUCP8273"></a><div class="props_rev_3"><a id="GUID-DEBA115B-9B14-4C4C-83EB-7D09F9F48970" name="GUID-DEBA115B-9B14-4C4C-83EB-7D09F9F48970"></a><h3 id="JJUCP-GUID-DEBA115B-9B14-4C4C-83EB-7D09F9F48970" class="sect3"><span class="enumeration_section">9.2.3 </span>Fast Connection Failover Prerequisites
               </h3>
               <div>
                  <div class="section">
                     <p><a id="d8155e386" class="indexterm-anchor"></a>Fast Connection Failover is available under the following circumstances:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The Universal Connection Pool is enabled.</p>
                           <p>Fast Connection Failover works in conjunction with the JDBC connection caching mechanism. This helps applications manage connections to ensure high availability.</p>
                        </li>
                        <li>
                           <p>The application uses service names to connect to the database.</p>
                           <p>The application cannot use service identifiers.</p>
                        </li>
                        <li>
                           <p>The underlying database has Oracle Database 12<span class="italic">c</span> Release 1 (12.1) or later Real Application Clusters (Oracle RAC) capability or Oracle Data Guard configured with either single instance Databases or Oracle RAC.
                           </p>
                           <p>If failover events are not propagated, then connection failover cannot occur.</p>
                        </li>
                        <li>
                           <p>Oracle Notification Service (ONS) is configured and available on the node where JDBC is running.</p>
                           <p>JDBC depends on ONS to propagate database events and notify JDBC of them.</p>
                        </li>
                        <li>
                           <p>The Java Virtual Machine (JVM) in which your JDBC instance is running must have <code class="codeph">oracle.ons.oraclehome</code> set to point to your <span class="italic"><code class="codeph">ORACLE_HOME</code></span>.
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJUCP8207"></a><a id="JJUCP8206"></a><div class="props_rev_3"><a id="GUID-18F60DC2-A4C2-43D7-9BCB-628D09A1AC0F" name="GUID-18F60DC2-A4C2-43D7-9BCB-628D09A1AC0F"></a><h3 id="JJUCP-GUID-18F60DC2-A4C2-43D7-9BCB-628D09A1AC0F" class="sect3"><span class="enumeration_section">9.2.4 </span>Example of Fast Connection Failover Configuration
               </h3>
               <div>
                  <p><a id="d8155e462" class="indexterm-anchor"></a><a id="d8155e466" class="indexterm-anchor"></a>The following example demonstrates a connection pool that uses the FCF feature. FCF is configured through a pool-enabled data source. The example includes enabling FCF, configuring the Oracle Notification Service (ONS) and configuring a connection URL. These topics are discussed after the example.
                  </p>
                  <p>The <code class="codeph">isValid</code> method of the <code class="codeph">oracle.ucp.jdbc.ValidConnection</code> interface is typically used in conjunction with the FCF feature and is used to check if a borrowed connection is still usable after an SQL exception has been thrown due to an Oracle RAC down event. For example:
                  </p><pre class="oac_no_warn" dir="ltr">try {  conn = pds.getConnection;  ...}catch (SQLException sqlexc)
{
   if (conn == null || !((ValidConnection) conn).isValid())
        
   // take the appropriate action
   
...
conn.close();
}
</pre><div class="example" id="GUID-18F60DC2-A4C2-43D7-9BCB-628D09A1AC0F__CHDEEBAJ">
                     <p class="titleinexample">Example 9-1 Fast Connection Failover Configuration Example</p><pre class="oac_no_warn" dir="ltr">PoolDataSource  pds = PoolDataSourceFactory.getPoolDataSource();

pds.setConnectionPoolName("FCFSamplePool");
pds.setFastConnectionFailoverEnabled(true);
pds.setONSConfiguration("nodes=racnode1:4200,racnode2:4200\nwalletfile=
/oracle11/onswalletfile");
pds.setConnectionFactoryClassName("oracle.jdbc.pool.OracleDataSource");
pds.setURL("jdbc:oracle:thin@(DESCRIPTION= "+
   "(LOAD_BALANCE=on)"+
   "(ADDRESS=(PROTOCOL=TCP)(HOST=racnode1) (PORT=1521))"+
   "(ADDRESS=(PROTOCOL=TCP)(HOST=racnode2) (PORT=1521))"+
   "(CONNECT_DATA=(SERVICE_NAME=service_name)))");
...
</pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="validating-ucp-connections.html#GUID-39E5A876-8C54-423F-B6A7-5E827DE202C7">Checking If a Connection Is Valid</a></li>
                     </ul>
                  </div>
               </div>
               
            </div><a id="JJUCP8274"></a><a id="JJUCP8208"></a><div class="props_rev_3"><a id="GUID-A85462D1-A4F1-43DC-869E-721AE30B7E78" name="GUID-A85462D1-A4F1-43DC-869E-721AE30B7E78"></a><h3 id="JJUCP-GUID-A85462D1-A4F1-43DC-869E-721AE30B7E78" class="sect3"><span class="enumeration_section">9.2.5 </span>Enabling Fast Connection Failover
               </h3>
               <div>
                  <div class="section">
                     <p><a id="d8155e535" class="indexterm-anchor"></a><a id="d8155e539" class="indexterm-anchor"></a><a id="d8155e541" class="indexterm-anchor"></a>The FCF pool property is used to enable and disable FCF. FCF is disabled by default. The following example demonstrates enabling FCF as shown in <a href="fast-connection-failover.html#GUID-18F60DC2-A4C2-43D7-9BCB-628D09A1AC0F__CHDEEBAJ">Example 9-1</a>.
                     </p><pre class="oac_no_warn" dir="ltr">
pds.setFastConnectionFailoverEnabled(true);
</pre><div class="infoboxnote" id="GUID-A85462D1-A4F1-43DC-869E-721AE30B7E78__GUID-27E76B4E-1D85-4718-AB9D-374C7F0E9716">
                        <p class="notep1">Note:</p>
                        <p>Starting from Oracle Database 12<span class="italic">c</span> Release 1 (12.1.0.2), UCP supports the <code class="codeph">oracle.ucp.PlannedDrainingPeriod</code> system property. It specifies the grace time period (in integer seconds) over which the pool smoothly drains the borrowed connections affected by a planned shut down. Draining starts when the same Database service becomes available on another instance different from the one that is going down.
                        </p>
                        <p>When this property is not set, or set to <code class="codeph">0</code>, then the pool closes any affected borrowed connection immediately when it is returned to the pool.
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-A85462D1-A4F1-43DC-869E-721AE30B7E78__GUID-9F37273B-B6E5-4865-A14B-09410599C158">Querying Fast Connection Failover Status</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>An application determines if Fast Connection Failover is enabled by calling <code class="codeph">OracleDataSource.getFastConnectionFailoverEnabled</code>, which returns <code class="codeph">true</code> if failover is enabled, <code class="codeph">false</code> otherwise.
                     </p>
                     <div class="infoboxnote" id="GUID-A85462D1-A4F1-43DC-869E-721AE30B7E78__GUID-7E85EAB0-7719-427A-A33F-9153055DAD8B">
                        <p class="notep1">Note:</p>
                        <p>FCF must also be enabled to use run-time connection load balancing and connection affinity. These features are discussed later in this chapter.</p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJUCP8209"></a><div class="props_rev_3"><a id="GUID-F361FE59-9D12-47F9-B5DC-F5D996809AF4" name="GUID-F361FE59-9D12-47F9-B5DC-F5D996809AF4"></a><h3 id="JJUCP-GUID-F361FE59-9D12-47F9-B5DC-F5D996809AF4" class="sect3"><span class="enumeration_section">9.2.6 </span>What is ONS?
               </h3>
               <div>
                  <p><a id="d8155e621" class="indexterm-anchor"></a><a id="d8155e625" class="indexterm-anchor"></a><a id="d8155e627" class="indexterm-anchor"></a><a id="d8155e629" class="indexterm-anchor"></a><a id="d8155e631" class="indexterm-anchor"></a><a id="d8155e635" class="indexterm-anchor"></a>FCF relies on the Oracle Notification Service (ONS) to propagate database events between the connection pool and the Oracle RAC database. At run time, the connection pool must be able to setup an ONS environment. ONS (<code class="codeph">ons.jar</code>) is included as part of the Oracle Client software. ONS can be configured using either remote configuration or client-side ONS daemon configuration. Remote configuration is the preferred configuration for standalone client applications. This section discusses the following topics:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="fast-connection-failover.html#GUID-0D8CD8C4-734F-49F7-8737-9AC03173C73F">Overview of ONS Configuration File</a></p>
                     </li>
                     <li>
                        <p><a href="fast-connection-failover.html#GUID-C8D5FF91-6333-4E7F-BC81-CF7B93D56BEE">Remote Configuration of ONS</a></p>
                     </li>
                     <li>
                        <p><a href="fast-connection-failover.html#GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63">Configuration of Client-Side ONS Daemon</a></p>
                     </li>
                  </ul>
               </div><a id="JJUCP8276"></a><a id="JJUCP8277"></a><a id="JJUCP8275"></a><div class="props_rev_3"><a id="GUID-0D8CD8C4-734F-49F7-8737-9AC03173C73F" name="GUID-0D8CD8C4-734F-49F7-8737-9AC03173C73F"></a><h4 id="JJUCP-GUID-0D8CD8C4-734F-49F7-8737-9AC03173C73F" class="sect4"><span class="enumeration_section">9.2.6.1 </span>Overview of ONS Configuration File
                  </h4>
                  <div>
                     <p>ONS configuration is controlled by the ONS configuration file, <span class="italic"><code class="codeph">ORACLE_HOME</code></span><code class="codeph">/opmn/conf/ons.config</code>. This file tells the ONS daemon how it should behave. Configuration information within <code class="codeph">ons.config</code> is defined in simple name and value pairs.
                     </p>
                     <p>Some parameters in the <code class="codeph">ons.config</code> file are required and some are optional. <a href="fast-connection-failover.html#GUID-0D8CD8C4-734F-49F7-8737-9AC03173C73F__BABFBABC" title="This table lists the required parameters in the ons.config file.">Table 9-2</a> lists the required ONS configuration parameters and <a href="fast-connection-failover.html#GUID-0D8CD8C4-734F-49F7-8737-9AC03173C73F__BABDHGCD" title="This table lists the optional parameters in the ons.config file.">Table 9-3</a> lists the optional ONS configuration parameters. ONS must be refreshed after updating the <code class="codeph">ons.config</code> file.
                     </p>
                     <div class="tblformal" id="GUID-0D8CD8C4-734F-49F7-8737-9AC03173C73F__BABFBABC">
                        <p class="titleintable">Table 9-2 Required ONS Configuration Parameters</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="Required ONS Configuration Parameters" summary="This table lists the required parameters in the ons.config file." width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="20%" id="d8155e733">Parameter</th>
                                 <th align="left" valign="bottom" width="80%" id="d8155e736">Explanation</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d8155e741" headers="d8155e733 ">
                                    <p><code class="codeph">localport</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d8155e741 d8155e736 ">
                                    <p>Specifies the port that ONS binds to on the local host interface to talk to local clients.</p>
                                    <p>For example, <code class="codeph">localport=4100</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d8155e753" headers="d8155e733 ">
                                    <p><code class="codeph">remoteport</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d8155e753 d8155e736 ">
                                    <p>Specifies the port that ONS binds to on all interfaces for talking to other ONS daemons.</p>
                                    <p>For example, <code class="codeph">remoteport=4200</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d8155e765" headers="d8155e733 ">
                                    <p><code class="codeph">nodes</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d8155e765 d8155e736 ">
                                    <p>Specifies a list of other ONS daemons to talk to. Node values are given as a comma-delimited list of either host names or IP addresses plus ports. The port value that is given is the remote port that each ONS instance is listening on. In order to maintain an identical file on all nodes, the <code class="codeph">host:port</code> of the current ONS node can also be listed in the nodes list. It will be ignored when reading the list.
                                    </p>
                                    <p>For example, <code class="codeph">nodes=myhost.example.com:4200,123.123.123.123:4200</code></p>
                                    <p>The nodes listed in the nodes line correspond to the individual nodes in the Oracle RAC instance. Listing the nodes ensures that the middle-tier node can communicate with the Oracle RAC nodes. At least one middle-tier node and one node in the Oracle RAC instance must be configured to see one another. As long as one node on each side is aware of the other, all nodes are visible. You need not list every single cluster and middle-tier node in the ONS configuration file of each Oracle RAC node. In particular, if one ONS configuration file cluster node is aware of the middle tier, then all nodes in the cluster are aware of it.</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="tblformal" id="GUID-0D8CD8C4-734F-49F7-8737-9AC03173C73F__BABDHGCD">
                        <p class="titleintable">Table 9-3 Optional ONS Configuration Parameters</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="Optional ONS Configuration Parameters" summary="This table lists the optional parameters in the ons.config file." width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="20%" id="d8155e791">Parameter</th>
                                 <th align="left" valign="bottom" width="80%" id="d8155e794">Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d8155e799" headers="d8155e791 ">
                                    <p><code class="codeph">logcomp</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d8155e799 d8155e794 ">
                                    <p>Specifies the ONS components to log. The format is as follows:</p><pre class="oac_no_warn" dir="ltr">&lt;component&gt;[&lt;subcomponent&gt;,...];&lt;component&gt;[&lt;subcomponent&gt;,...];...
</pre><p>If no subcomponents need to be specified, then do not include the brackets ([]) after the component name. To exclude messages from a subcomponent, precede the subcomponent name with an exclamation mark (!). For example, to exclude messages from the <code class="codeph">topology</code> subcomponent, you use the following format:
                                    </p><pre class="oac_no_warn" dir="ltr">[all,!topology]
</pre><p>Note that before specifying a subcomponent from which you want to exclude messages, you must first ensure that the subcomponent includes the messages.</p>
                                    <p>Following are the valid values for components:</p>
                                    <ul style="list-style-type: disc;">
                                       <li>
                                          <p><code class="codeph">internal</code></p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">ons</code></p>
                                       </li>
                                    </ul>
                                    <p>If you specify the component as <code class="codeph">internal</code>, then there are no valid values for subcomponent. If you specify the component as <code class="codeph">ons</code>, then you can specify the following values for subcomponent:
                                    </p>
                                    <ul style="list-style-type: disc;">
                                       <li>
                                          <p><code class="codeph">all</code>: Specifies all messages
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">ons</code>: ONS local information
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">listener</code>: ONS listener information
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">discover</code>: ONS discover (server or multicast) information
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">servers</code>: ONS remote servers currently up and connected to the cluster
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">topology</code>: ONS current cluster wide server connection topology
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">server</code>: ONS remote server connection information
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">client</code>: ONS client connection information
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">connect</code>: ONS generic connection information
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">subscribe</code>: ONS client subscription information
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">message</code>: ONS notification receiving and processing information
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">deliver</code>: ONS notification delivery information
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">special</code>: ONS special notification processing
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">internal</code>: ONS internal resource information
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">secure</code>: ONS SSL operation information
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">workers</code>: ONS worker threads
                                          </p>
                                       </li>
                                    </ul>
                                    <p>The following example shows that you want to log messages for all the subcomponents under <code class="codeph">ons</code>, except the <code class="codeph">secure</code> subcomponent:
                                    </p><pre class="oac_no_warn" dir="ltr">logcomp=ons[all,!secure]
</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d8155e929" headers="d8155e791 ">
                                    <p><code class="codeph">logfile</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d8155e929 d8155e794 ">
                                    <p>Specifies a log file that ONS should use for logging messages. The default value for log file is <code class="codeph">$ORACLE_HOME/opmn/logs/ons.log</code>.
                                    </p>
                                    <p>For example, <code class="codeph">logfile=/private/oraclehome/opmn/logs/myons.log</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d8155e944" headers="d8155e791 ">
                                    <p><code class="codeph">walletfile</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d8155e944 d8155e794 ">
                                    <p>Specifies the wallet file used by the Oracle Secure Sockets Layer (SSL) to store SSL certificates. If a wallet file is specified to ONS, then it uses SSL when communicating with other ONS instances and require SSL certificate authentication from all ONS instances that try to connect to it. This means that if you want to turn on SSL for one ONS instance, then you must turn it on for all instances that are connected. This value should point to the directory where your <code class="codeph">ewallet.p12</code> file is located.
                                    </p>
                                    <p>For example, <code class="codeph">walletfile=/private/oraclehome/opmn/conf/ssl.wlt/default</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d8155e959" headers="d8155e791 ">
                                    <p><code class="codeph">useocr</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d8155e959 d8155e794 ">
                                    <p>Specifies the value, reserved for use on the server-side, to indicate ONS whether it should store all Oracle RAC nodes and port numbers in Oracle Cluster Registry (OCR) instead of the ONS configuration file or not. A value of <code class="codeph">useocr=on</code> is used to store all Oracle RAC nodes and port numbers in Oracle Cluster Registry (OCR).
                                    </p>
                                    <p>Do not use this option on the client-side.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d8155e972" headers="d8155e791 ">
                                    <p><code class="codeph">allowgroup</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d8155e972 d8155e794 ">
                                    <p>Specifies the ONS setting to indicate the user group connecting to the <code class="codeph">localport</code>. When set to <code class="codeph">true</code>, ONS allows users within the same OS group to connect to its local port. When set to <code class="codeph">false</code>, ONS only allows the same user running the ONS daemon to access its local port. The default value of this parameter is <code class="codeph">false</code>. When using remote ONS configuration, there is no need to set this parameter.
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>The <code class="codeph">ons.config</code> file allows blank lines and comments on lines that begin with the number sign (<code class="codeph">#</code>).
                     </p>
                  </div>
               </div><a id="JJUCP8210"></a><div class="props_rev_3"><a id="GUID-C8D5FF91-6333-4E7F-BC81-CF7B93D56BEE" name="GUID-C8D5FF91-6333-4E7F-BC81-CF7B93D56BEE"></a><h4 id="JJUCP-GUID-C8D5FF91-6333-4E7F-BC81-CF7B93D56BEE" class="sect4"><span class="enumeration_section">9.2.6.2 </span>Remote Configuration of ONS
                  </h4>
                  <div>
                     <p>UCP supports remote configuration of ONS through the <code class="codeph">ONSConfiguration</code> pool property. The <code class="codeph">ONSConfiguration</code> pool property value is a string that closely resembles the content of the <code class="codeph">ons.config</code> file. The string contains a list of <code class="codeph">name=value</code> pairs separated by a new line character (<code class="codeph">\n</code>). You can set this pool property in the following two ways:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The name can be one of the following: <code class="codeph">nodes</code>, <code class="codeph">walletfile</code>, or <code class="codeph">walletpassword</code>. The parameter string should at least specify the ONS configuration <code class="codeph">nodes</code> attribute as a list of <code class="codeph">host:port</code> pairs separated by a comma. SSL is used when the <code class="codeph">walletfile</code> attribute is specified as an Oracle wallet file.
                           </p>
                           <p>The following example demonstrates an ONS configuration string as shown in <a href="fast-connection-failover.html#GUID-18F60DC2-A4C2-43D7-9BCB-628D09A1AC0F__CHDEEBAJ">Example 9-1</a>:
                           </p><pre class="oac_no_warn" dir="ltr">...
pds.setONSConfiguration("nodes=racnode1:4200,racnode2:4200\nwalletfile=/oracle11/onswalletfile");
...
</pre></li>
                        <li>
                           <p>The name can be only <code class="codeph">propertiesfile</code>. The value is the location of an ONS-specific Java properties file. This file must contain the <code class="codeph">oracle.ons.nodes</code> property, and one or both of the following ONS Java properties:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">oracle.ons.walletfile</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">oracle.ons.walletpassword</code></p>
                                 <p>The following example illustrates such an <code class="codeph">ONSConfiguration</code> string:
                                 </p><pre class="oac_no_warn" dir="ltr">pds.setONSConfiguration("propertiesfile=/usr/ons/ons.properties");
</pre><p>The following is an example of the content of the Java properties <code class="codeph">ons.properties</code> file:
                                 </p><pre class="oac_no_warn" dir="ltr">oracle.ons.nodes=racnode1:4200,racnode2:4200
oracle.ons.walletfile=/oracle11/onswalletfile
</pre></li>
                           </ul>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-C8D5FF91-6333-4E7F-BC81-CF7B93D56BEE__GUID-200D4E8D-7170-40DA-8B69-14A09588092E">
                        <p class="notep1">Note:</p>
                        <p>The parameters in the configuration string must match those for the Oracle RAC Database. In addition, if you are using Oracle Application Server, then you must configure ONS using procedures that are applicable to the server.</p>
                        <p>For standalone Java applications, you must configure ONS using the <code class="codeph">setONSConfiguration</code> method. However, if your application meets the following requirements, then you no longer need to call the <code class="codeph">setONSConfiguration</code> method for enabling FCF:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Your application is using Oracle Database 12<span class="italic">c</span> Release 1 (12.1) or later UCP and Oracle RAC Database 12<span class="italic">c</span> Release 1 (12.1) or later
                              </p>
                           </li>
                           <li>
                              <p>Your application does not require ONS wallet or keystore</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="JJUCP8279"></a><a id="JJUCP8280"></a><a id="JJUCP8278"></a><a id="JJUCP8211"></a><div class="props_rev_3"><a id="GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63" name="GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63"></a><h4 id="JJUCP-GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63" class="sect4"><span class="enumeration_section">9.2.6.3 </span>Configuration of Client-Side ONS Daemon
                  </h4>
                  <div>
                     <p>Client-side ONS daemon configuration is typical of applications that run on a middle-tier server such as the Oracle Application Server. Clients in this scenario directly configure ONS by updating the <code class="codeph">ons.config</code> file. The location of the file may be different depending on the platform. <a href="fast-connection-failover.html#GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63__BABIIAHB">Example 9-2</a> demonstrates an <code class="codeph">ons.config</code> file for <a href="fast-connection-failover.html#GUID-18F60DC2-A4C2-43D7-9BCB-628D09A1AC0F__CHDEEBAJ">Example 9-1</a>:
                     </p>
                     <div class="infoboxnote" id="GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63__GUID-D3CFF3F5-C855-4FEB-864C-17B9ABF9B78C">
                        <p class="notep1">Note:</p>
                        <p>For client-side ONS daemon configuration, if the operating system (OS) user that starts the connection pool and the OS user that starts the client-side daemon are different, then they both <span class="italic">must</span> belong to the same OS group. Also, the value of the <code class="codeph">allowgroup</code> parameter must be set to <code class="codeph">true</code> in the <code class="codeph">ons.config</code> file.
                        </p>
                     </div>
                     <p>After configuring ONS, you start the ONS daemon with the <code class="codeph">onsctl</code> command. You <span class="italic">must</span> make sure that an ONS daemon is running at all times.
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63__GUID-D0D267BD-7839-440A-89F9-9115EA3B2088">Using the onsctl Command</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>After configuring, use <span class="italic"><code class="codeph">ORACLE_HOME</code></span><code class="codeph">/opmn/bin/onsctl</code> to start, stop, reconfigure, and monitor the ONS daemon. <a href="fast-connection-failover.html#GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63__BABEBDBA" title="table">Table 9-4</a> is a summary of the commands that <code class="codeph">onsctl</code> supports.
                        </p>
                        <div class="tblformal" id="GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63__BABEBDBA">
                           <p class="titleintable">Table 9-4 onsctl Commands</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="onsctl Commands" summary="table" width="100%" frame="hsides" border="1" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="16%" id="d8155e1253">Command</th>
                                    <th align="left" valign="bottom" width="34%" id="d8155e1256">Effect</th>
                                    <th align="left" valign="bottom" width="50%" id="d8155e1259">Output</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="16%" id="d8155e1264" headers="d8155e1253 ">
                                       <p><code class="codeph">start</code></p>
                                    </td>
                                    <td align="left" valign="top" width="34%" headers="d8155e1264 d8155e1256 ">
                                       <p>Starts the ONS daemon</p>
                                    </td>
                                    <td align="left" valign="top" width="50%" headers="d8155e1264 d8155e1259 ">
                                       <p><code class="codeph">onsctl: ons started</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="16%" id="d8155e1276" headers="d8155e1253 ">
                                       <p><code class="codeph">stop</code></p>
                                    </td>
                                    <td align="left" valign="top" width="34%" headers="d8155e1276 d8155e1256 ">
                                       <p>Stops the ONS daemon</p>
                                    </td>
                                    <td align="left" valign="top" width="50%" headers="d8155e1276 d8155e1259 ">
                                       <p><code class="codeph">onsctl: shutting down ons daemon...</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="16%" id="d8155e1288" headers="d8155e1253 ">
                                       <p><code class="codeph">ping</code></p>
                                    </td>
                                    <td align="left" valign="top" width="34%" headers="d8155e1288 d8155e1256 ">
                                       <p>Verifies whether or not the ONS daemon is running</p>
                                    </td>
                                    <td align="left" valign="top" width="50%" headers="d8155e1288 d8155e1259 ">
                                       <p><code class="codeph">ons is running ...</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="16%" id="d8155e1300" headers="d8155e1253 ">
                                       <p><code class="codeph">reconfig</code></p>
                                    </td>
                                    <td align="left" valign="top" width="34%" headers="d8155e1300 d8155e1256 ">
                                       <p>Triggers a reload of the ONS configuration without shutting down the ONS daemon </p>
                                    </td>
                                    <td align="left" valign="top" width="50%" headers="d8155e1300 d8155e1259 ">&nbsp;</td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="16%" id="d8155e1309" headers="d8155e1253 ">
                                       <p><code class="codeph">help</code></p>
                                    </td>
                                    <td align="left" valign="top" width="34%" headers="d8155e1309 d8155e1256 ">
                                       <p>Prints a help summary message for onsctl</p>
                                    </td>
                                    <td align="left" valign="top" width="50%" headers="d8155e1309 d8155e1259 ">&nbsp;</td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="16%" id="d8155e1318" headers="d8155e1253 ">
                                       <p><code class="codeph">detailed</code></p>
                                    </td>
                                    <td align="left" valign="top" width="34%" headers="d8155e1318 d8155e1256 ">
                                       <p>Prints a detailed help message for onsctl</p>
                                    </td>
                                    <td align="left" valign="top" width="50%" headers="d8155e1318 d8155e1259 ">&nbsp;</td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <div class="infoboxnotealso" id="GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63__GUID-F31529FB-E316-489F-91FB-6D56753620F1">
                           <p class="notep1">See Also:</p>
                           <p><a href="../racad/adding-and-deleting-oracle-rac-from-nodes-on-linux-and-unix-systems.html#RACAD0067" target="_blank"><span class="italic">Oracle Real Application Clusters Administration and Deployment Guide</span></a></p>
                        </div>
                        <div class="infoboxnote" id="GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63__GUID-83B2CEFD-E3B5-43C3-8A54-9B14825AA94D">
                           <p class="notep1">Note:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The Java Virtual Machine (JVM), in which your JDBC instance is running, must have the <code class="codeph">oracle.ons.oraclehome</code> system property set to the location of <code class="codeph">ORACLE_HOME</code> before starting the application. For example:
                                 </p><pre class="oac_no_warn" dir="ltr">java -Doracle.ons.oraclehome=$ORACLE_HOME ...
</pre></li>
                              <li>
                                 <p>Oracle recommends remote configuration of ONS for UCP.</p>
                              </li>
                           </ul>
                        </div>
                        <div class="infoboxnote" id="GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63__GUID-FC0815E1-7A68-4F89-8468-FAB6C7536552">
                           <p class="notep1">Note:</p>
                           <p>In Oracle RAC 12.1.0.2.0, by default, server installation requires the value of the <code class="codeph">walletfile</code> ONS parameter to be set, and enforces the use of SSL for all ONS connections.
                           </p>
                           <p>If you have a UCP application that is already using the <code class="codeph">walletfile</code> parameter in the ONS remote configuration string or local configuration file, then the only requirement is that, for the same topology, the wallet file on the client side must have the same content as the wallet file on the server side. You can make a copy of the server-side file and make it available on the client side.
                           </p>
                           <p>For UCP applications that are using Oracle RAC features without setting the <code class="codeph">walletfile</code> parameter, you must perform one of the following:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Add the walletfile parameter setting to the ONS remote configuration string or local configuration file, as shown in <a href="fast-connection-failover.html#GUID-18F60DC2-A4C2-43D7-9BCB-628D09A1AC0F__CHDEEBAJ">Example 9-1</a>. Keep in mind that, for the same topology, the wallet file on the client side must have the same content as the wallet file on the Oracle RAC server side.
                                 </p>
                              </li>
                              <li>
                                 <p>Run the following command to remove the <code class="codeph">walletfile</code> parameter setting from both client and server ONS configuration string and the local configuration file:
                                 </p><pre class="oac_no_warn" dir="ltr">srvctl modify nodeapps -clientdata
</pre></li>
                           </ul>
                           <p>For secure communication, the ONS auto-configuration in Oracle RAC 12.1.x no longer works when Oracle RAC 12.1.0.2.0 is first installed or patched. Applications have to use explicit ONS configuration (remote or local) instead, and make one of the changes previously discussed.</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-A78715A2-9F5A-4779-AFD7-5FDEC258DA63__BABIIAHB">
                        <p class="titleinexample">Example 9-2 Example of a Sample ons.config File</p><pre class="oac_no_warn" dir="ltr"># This is an example ons.config file
#
# The first three values are required
localport=4100
remoteport=4200
nodes=racnode1.example.com:4200,racnode2.example.com:4200
</pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div><a id="JJUCP8213"></a><a id="JJUCP8212"></a><div class="props_rev_3"><a id="GUID-C54F3D4D-9973-41EA-B62B-E574DE94970F" name="GUID-C54F3D4D-9973-41EA-B62B-E574DE94970F"></a><h3 id="JJUCP-GUID-C54F3D4D-9973-41EA-B62B-E574DE94970F" class="sect3"><span class="enumeration_section">9.2.7 </span>Configuring the Connection URL
               </h3>
               <div>
                  <div class="section">
                     <p><a id="d8155e1423" class="indexterm-anchor"></a><a id="d8155e1427" class="indexterm-anchor"></a><a id="d8155e1429" class="indexterm-anchor"></a>The connection URL of a connection factory must use the service name syntax when using FCF. The service name is used to map the connection pool to the service. In addition, the factory class must be an Oracle factory class. The following example demonstrates configuring the connection URL as shown in <a href="fast-connection-failover.html#GUID-18F60DC2-A4C2-43D7-9BCB-628D09A1AC0F__CHDEEBAJ">Example 9-1</a>:
                     </p><pre class="oac_no_warn" dir="ltr">...
pds.setConnectionFactoryClassName("oracle.jdbc.pool.OracleDataSource");
pds.setURL("jdbc:oracle:thin@//host:port/service_name");
...
</pre><div class="infoboxnote" id="GUID-C54F3D4D-9973-41EA-B62B-E574DE94970F__GUID-BF84AC3C-CF73-44E5-AAF7-C6149968791A">
                        <p class="notep1">Note:</p>
                        <p>An exception is thrown if a service identifier (SID) is specified for the connection URL when FCF is enabled.</p>
                     </div>
                     <p>The following examples demonstrate valid connection URL syntax when connecting to an Oracle RAC database. Examples for both the Oracle JDBC thin and Oracle OCI driver are included. Notice that the URL can be used to explicitly enable load balancing among Oracle RAC nodes:<a id="d8155e1441" class="indexterm-anchor"></a></p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-C54F3D4D-9973-41EA-B62B-E574DE94970F__GUID-90B76114-F8BC-4A8C-B914-E124DBBD9D5E">Valid Connection URL Usage</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section"><pre class="oac_no_warn" dir="ltr">pds.setURL("jdbc:oracle:thin@//host:port/service_name"); 

pds.setURL("jdbc:oracle:thin@//cluster-alias:port/service_name"); 

pds.setURL("jdbc:oracle:thin:@(DESCRIPTION= "+
   "(LOAD_BALANCE=on)"+
   "(ADDRESS=(PROTOCOL=TCP)(HOST=host1)(PORT=1521))"+
   "(ADDRESS=(PROTOCOL=TCP)(HOST=host2)(PORT=1521))"+
   "(CONNECT_DATA=(SERVICE_NAME=service_name)))");

pds.setURL("jdbc:oracle:thin:@(DESCRIPTION= "+
   "(ADDRESS=(PROTOCOL=TCP)(HOST=cluster_alias) (PORT=1521)) "+
   "(CONNECT_DATA=(SERVICE_NAME=service_name)))");

pds.setURL("jdbc:oracle:oci:@TNS_ALIAS");

pds.setURL("jdbc:oracle:oci:@(DESCRIPTION= "+
   "(LOAD_BALANCE=on) "+
   "(ADDRESS=(PROTOCOL=TCP)(HOST=host1) (PORT=1521)) "+
   "(ADDRESS=(PROTOCOL=TCP)(HOST=host2)(PORT=1521)) "+
   "(CONNECT_DATA=(SERVICE_NAME=service_name)))"); 

pds.setURL("jdbc:oracle:oci:@(DESCRIPTION= "+
   "(ADDRESS=(PROTOCOL=TCP)(HOST=cluster_alias) (PORT=1521)) "+
   "(CONNECT_DATA=(SERVICE_NAME=service_name)))");
</pre></div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>