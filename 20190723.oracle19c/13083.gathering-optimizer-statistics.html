<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="This chapter explains how to use the DBMS_STATS.GATHER_*_STATS program units.">
      <meta name="description" content="This chapter explains how to use the DBMS_STATS.GATHER_*_STATS program units.">
      <title>Gathering Optimizer Statistics</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="SQL Tuning Guide">
      <meta property="og:description" content="This chapter explains how to use the DBMS_STATS.GATHER_*_STATS program units.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="SQL Tuning Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="sql-tuning-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-31T14:57:08-08:00">
      <meta name="dcterms.title" content="SQL Tuning Guide">
      <meta name="dcterms.dateCopyrighted" content="2013, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96095-03">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="options-for-optimizer-statistics-gathering.html" title="Previous" type="text/html">
      <link rel="next" href="managing-extended-statistics.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TGSQL">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="options-for-optimizer-statistics-gathering.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="managing-extended-statistics.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">SQL Tuning Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="optimizer-statistics.html" property="item" typeof="WebPage"><span property="name">Optimizer Statistics</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Gathering Optimizer Statistics</li>
            </ol>
            <a id="GUID-245F23B2-24AF-44D8-9F12-99FD1215E878" name="GUID-245F23B2-24AF-44D8-9F12-99FD1215E878"></a><a id="TGSQL389"></a>
            
            <h2 id="TGSQL-GUID-245F23B2-24AF-44D8-9F12-99FD1215E878" class="sect2"><span class="enumeration_chapter">13 </span>Gathering Optimizer Statistics
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>This chapter explains how to use the <code class="codeph">DBMS_STATS.GATHER_*_STATS</code> program units.
               </p>
               <p>This chapter contains the following topics:</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-F007E78A-9967-4921-8046-D8F59A9272B4">Configuring Automatic Optimizer Statistics Collection</a><br>Oracle Database can gather optimizer statistics automatically.
                  </li>
                  <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-374ACB86-2512-4658-9170-8505B3EACF7D">Configuring High-Frequency Automatic Optimizer Statistics Collection</a><br>This lightweight task supplements standard automatic statistics collection.
                  </li>
                  <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B">Gathering Optimizer Statistics Manually</a><br>As an alternative or supplement to automatic statistics gathering, you can use the <code class="codeph">DBMS_STATS</code> package to gather optimizer statistics manually.
                  </li>
                  <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31">Gathering System Statistics Manually</a><br>System statistics describe hardware characteristics, such as I/O and CPU performance and utilization, to the optimizer.
                  </li>
                  <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-4274A976-0185-4113-844F-1F818CD916CA">Running Statistics Gathering Functions in Reporting Mode</a><br>You can run the <code class="codeph">DBMS_STATS</code> statistics gathering procedures in reporting mode.
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-245F23B2-24AF-44D8-9F12-99FD1215E878__GUID-665B8F0B-5D1A-43E1-ABA3-725E02DF4C33">
                  <p class="notep1">See Also:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><span class="q">"<a href="optimizer-statistics-concepts.html#GUID-C0E74ACE-2706-48A1-97A2-33F52207166A" title="Oracle Database optimizer statistics describe details about the database and its objects.">Optimizer Statistics Concepts</a>"</span></p>
                     </li>
                     <li>
                        <p><span class="q">"<a href="query-optimizer-concepts.html#GUID-06129ACE-36B2-4534-AE68-EDFCAEBB3B5D" title="This chapter describes the most important concepts relating to the query optimizer, including its principal components.">Query Optimizer Concepts</a>"</span></p>
                     </li>
                     <li>
                        <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-CA6A56B9-0540-45E9-B1D7-D78769B7714C" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about <code class="codeph">DBMS_STATS.GATHER_TABLE_STATS</code></p>
                     </li>
                  </ul>
               </div>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>Parent topic:</strong> <a href="optimizer-statistics.html#GUID-0A2F3D52-A135-43E1-9CAB-55BFE068A297" title="The accuracy of an execution plan depends on the quality of the optimizer statistics.">Optimizer Statistics</a></p>
                  </div>
               </div>
            </div>
            <a id="TGSQL395"></a><div class="props_rev_3"><a id="GUID-F007E78A-9967-4921-8046-D8F59A9272B4" name="GUID-F007E78A-9967-4921-8046-D8F59A9272B4"></a><h3 id="TGSQL-GUID-F007E78A-9967-4921-8046-D8F59A9272B4" class="sect3"><span class="enumeration_section">13.1 </span>Configuring Automatic Optimizer Statistics Collection
               </h3>
               <div>
                  <p>Oracle Database can gather optimizer statistics automatically.</p>
                  <p>This section contains the following topics:</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-E4EFD512-EAF9-4AF3-943F-FDEC7E47B23C">About Automatic Optimizer Statistics Collection</a><br>The automated maintenance tasks infrastructure (known as AutoTask) schedules tasks to run automatically in Oracle Scheduler windows known as maintenance windows.
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-3D546E00-5DC0-4350-80F8-68205008FCEA">Configuring Automatic Optimizer Statistics Collection Using Cloud Control</a><br>You can enable and disable all automatic maintenance tasks, including automatic optimizer statistics collection, using Cloud Control.
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-3DEDE019-8E77-42E9-B692-ECD11F5FBA9C">Configuring Automatic Optimizer Statistics Collection from the Command Line</a><br>If you do not use Cloud Control to configure automatic optimizer statistics collection, then you must use the command line.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-245F23B2-24AF-44D8-9F12-99FD1215E878" title="This chapter explains how to use the DBMS_STATS.GATHER_*_STATS program units.">Gathering Optimizer Statistics</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="props_rev_3"><a id="GUID-E4EFD512-EAF9-4AF3-943F-FDEC7E47B23C" name="GUID-E4EFD512-EAF9-4AF3-943F-FDEC7E47B23C"></a><h4 id="TGSQL-GUID-E4EFD512-EAF9-4AF3-943F-FDEC7E47B23C" class="sect4"><span class="enumeration_section">13.1.1 </span>About Automatic Optimizer Statistics Collection
                  </h4>
                  <div>
                     <p>The automated maintenance tasks infrastructure (known as AutoTask) schedules tasks to run automatically in Oracle Scheduler windows known as maintenance windows.</p>
                     <p> By default, one window is scheduled for each day of the week. Automatic optimizer statistics collection runs as part of AutoTask. By default, the collection runs in all predefined maintenance windows.</p>
                     <div class="infoboxnote" id="GUID-E4EFD512-EAF9-4AF3-943F-FDEC7E47B23C__GUID-ACEA21D5-E9D3-4BA2-870D-BE3300013F53">
                        <p class="notep1">Note:</p>
                        <p>Data visibility and privilege requirements may differ when using automatic optimizer statistics collection with pluggable databases.</p>
                     </div>
                     <p>To collect the optimizer statistics, the database calls an internal procedure that operates similarly to the <code class="codeph">GATHER_DATABASE_STATS</code> procedure with the <code class="codeph">GATHER AUTO</code> option. Automatic statistics collection honors all preferences set in the database. 
                     </p>
                     <p>The principal difference between manual and automatic collection is that the latter prioritizes database objects that need statistics. Before the maintenance window closes, automatic collection assesses all objects and prioritizes objects that have no statistics or very old statistics.</p>
                     <div class="infoboxnote" id="GUID-E4EFD512-EAF9-4AF3-943F-FDEC7E47B23C__GUID-784706EE-7783-448A-B3A6-35D59EF97D6D">
                        <p class="notep1">Note:</p>
                        <p> When gathering statistics manually, you can reproduce the object prioritization of automatic collection by using the <code class="codeph">DBMS_AUTO_TASK_IMMEDIATE</code> package. This package runs the same statistics gathering job that is executed during the automatic nightly statistics gathering job.
                        </p>
                     </div>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-E4EFD512-EAF9-4AF3-943F-FDEC7E47B23C__GUID-5CA45A75-AEBE-4FF1-AA09-D16AD61938F1">
                        <p class="notep1">See Also:</p>
                        <p> <a href="../multi/administering-a-cdb-with-sql-plus.html#ADMIN13885" target="_blank"><span><cite>Oracle Database Administrator’s Guide</cite></span></a> for a table that summarizes how manageability features work in a container database (CDB)
                        </p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-F007E78A-9967-4921-8046-D8F59A9272B4" title="Oracle Database can gather optimizer statistics automatically.">Configuring Automatic Optimizer Statistics Collection</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL396"></a><div class="props_rev_3"><a id="GUID-3D546E00-5DC0-4350-80F8-68205008FCEA" name="GUID-3D546E00-5DC0-4350-80F8-68205008FCEA"></a><h4 id="TGSQL-GUID-3D546E00-5DC0-4350-80F8-68205008FCEA" class="sect4"><span class="enumeration_section">13.1.2 </span>Configuring Automatic Optimizer Statistics Collection Using Cloud Control
                  </h4>
                  <div>
                     <p>You can enable and disable all automatic maintenance tasks, including automatic optimizer statistics collection, using Cloud Control.</p>
                     <div class="section">
                        <p>The default window timing works well for most situations. However, you may have operations such as bulk loads that occur during the window. In such cases, to avoid potential conflicts that result from operations occurring at the same time as automatic statistics collection, Oracle recommends that you change the window accordingly.</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-3D546E00-5DC0-4350-80F8-68205008FCEA__GUID-ADC48AC9-AF98-4398-A835-46AC86666207">Prerequisites</p>
                        <p>Access the Database Home page, as described in <span class="q">"<a href="options-for-optimizer-statistics-gathering.html#GUID-15511441-3164-4233-A0F8-54A8DF44AC6D" title="Oracle Enterprise Manager Cloud Control enables you to manage multiple databases within a single GUI-based framework.">Accessing the Database Home Page in Cloud Control</a>."</span></p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-3D546E00-5DC0-4350-80F8-68205008FCEA__GUID-2153DDB6-A13B-4993-B24D-DC474C2D18F6">To control automatic optimizer statistics collection using Cloud Control:</p>
                        <ol>
                           <li>
                              <p>From the <span class="bold">Administration</span> menu, select <span class="bold">Oracle Scheduler</span>, then <span class="bold">Automated Maintenance Tasks</span>.
                              </p>
                              <p>The Automated Maintenance Tasks page appears.</p>
                              <p>This page shows the predefined tasks. To retrieve information about each task, click the corresponding link for the task.</p>
                           </li>
                           <li>
                              <p>Click <span class="bold">Configure</span>.
                              </p>
                              <p>The Automated Maintenance Tasks Configuration page appears.</p>
                              <p>By default, automatic optimizer statistics collection executes in all predefined maintenance windows in <code class="codeph">MAINTENANCE_WINDOW_GROUP</code>.
                              </p>
                           </li>
                           <li>
                              <p>Perform the following steps:</p>
                              <ol type="a">
                                 <li>
                                    <p>In the Task Settings section for Optimizer Statistics Gathering, select either <span class="bold">Enabled</span> or <span class="bold">Disabled</span> to enable or disable an automated task.
                                    </p>
                                    <div class="infoboxnote" id="GUID-3D546E00-5DC0-4350-80F8-68205008FCEA__GUID-18208DB9-4038-49A9-BB1D-72CD2F1559F6">
                                       <p class="notep1">Note:</p>
                                       <p>Oracle strongly recommends that you not disable automatic statistics gathering because it is critical for the optimizer to generate optimal plans for queries against dictionary and user objects. If you disable automatic collection, ensure that you have a good manual statistics collection strategy for dictionary and user schemas.</p>
                                    </div>
                                 </li>
                                 <li>
                                    <p>To disable statistics gathering for specific days in the week, check the appropriate box next to the window name.</p>
                                 </li>
                                 <li>
                                    <p>To change the characteristics of a window group, click <span class="bold">Edit Window Group</span>.
                                    </p>
                                 </li>
                                 <li>
                                    <p>To change the times for a window, click the name of the window (for example, <span class="bold">MONDAY_WINDOW</span>), and then in the Schedule section, click <span class="bold">Edit</span>.
                                    </p>
                                    <p>The Edit Window page appears.</p>
                                    <div class="figure" id="GUID-3D546E00-5DC0-4350-80F8-68205008FCEA__GUID-8AE3F5E7-6AE1-433A-A1AA-48DE99791589"><img src="img/edit_window.jpg" alt="Description of edit_window.jpg follows" title="Description of edit_window.jpg follows" longdesc="img_text/edit_window.html"><br><a href="img_text/edit_window.html">Description of the illustration edit_window.jpg</a></div>
                                    <!-- class="figure" -->
                                    <p>In this page, you can change the parameters such as duration and start time for window execution.</p>
                                 </li>
                                 <li>
                                    <p>Click <span class="bold">Apply</span>.
                                    </p>
                                 </li>
                              </ol>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section"></div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-3D546E00-5DC0-4350-80F8-68205008FCEA__GUID-B6D8768F-CE59-4BD3-A5C9-7E1DA6D70FDC">
                        <p class="notep1">See Also:</p>
                        <p>Online Help for Oracle Enterprise Manager Cloud Control</p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-F007E78A-9967-4921-8046-D8F59A9272B4" title="Oracle Database can gather optimizer statistics automatically.">Configuring Automatic Optimizer Statistics Collection</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL397"></a><div class="props_rev_3"><a id="GUID-3DEDE019-8E77-42E9-B692-ECD11F5FBA9C" name="GUID-3DEDE019-8E77-42E9-B692-ECD11F5FBA9C"></a><h4 id="TGSQL-GUID-3DEDE019-8E77-42E9-B692-ECD11F5FBA9C" class="sect4"><span class="enumeration_section">13.1.3 </span>Configuring Automatic Optimizer Statistics Collection from the Command Line
                  </h4>
                  <div>
                     <p>If you do not use Cloud Control to configure automatic optimizer statistics collection, then you must use the command line.</p>
                     <div class="section">
                        <p>You have the following options:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Run the <code class="codeph">ENABLE</code> or <code class="codeph">DISABLE</code> procedure in the <code class="codeph">DBMS_AUTO_TASK_ADMIN</code> PL/SQL package.
                              </p>
                              <p>This package is the recommended command-line technique. For both the <code class="codeph">ENABLE</code> and <code class="codeph">DISABLE</code> procedures, you can specify a particular maintenance window with the <code class="codeph">window_name</code> parameter.
                              </p>
                           </li>
                           <li>
                              <p>Set the <code class="codeph">STATISTICS_LEVEL</code> initialization level to <code class="codeph">BASIC</code> to disable collection of <span class="italic">all</span> advisories and statistics, including Automatic SQL Tuning Advisor.
                              </p>
                              <div class="infoboxnote" id="GUID-3DEDE019-8E77-42E9-B692-ECD11F5FBA9C__GUID-65EEDF7F-64AC-4C22-9AD7-D4E61E8A5A68">
                                 <p class="notep1">Note:</p>
                                 <p>Because monitoring and many automatic features are disabled, Oracle strongly recommends that you do not set <code class="codeph">STATISTICS_LEVEL</code> to <code class="codeph">BASIC</code>.
                                 </p>
                              </div>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-3DEDE019-8E77-42E9-B692-ECD11F5FBA9C__GUID-42BB12D2-F9A6-4B42-9D5C-AC4F2EF23BD6">To control automatic statistics collection using DBMS_AUTO_TASK_ADMIN:</p>
                        <ol>
                           <li>
                              <p id="GUID-3DEDE019-8E77-42E9-B692-ECD11F5FBA9C__d5e32">In SQL*Plus or SQL Developer, log in to the database as a user with administrative privileges.</p>
                           </li>
                           <li>
                              <p>Do one of the following:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>To enable the automated task, execute the following PL/SQL block:</p><pre class="pre codeblock"><code>BEGIN
  DBMS_AUTO_TASK_ADMIN.ENABLE (  
    client_name  =&gt; 'auto optimizer stats collection'
,   operation    =&gt; NULL
,   window_name  =&gt; NULL 
);
END;
/
</code></pre></li>
                                 <li>
                                    <p>To disable the automated task, execute the following PL/SQL block:</p><pre class="pre codeblock"><code>BEGIN
  DBMS_AUTO_TASK_ADMIN.DISABLE (  
    client_name  =&gt; 'auto optimizer stats collection'
,   operation    =&gt; NULL
,   window_name  =&gt; NULL 
);
END;
/
</code></pre></li>
                              </ul>
                           </li>
                           <li>
                              <p>Query the data dictionary to confirm the change.</p>
                              <p>For example, query <code class="codeph">DBA_AUTOTASK_CLIENT</code> as follows:
                              </p><pre class="pre codeblock"><code>COL CLIENT_NAME FORMAT a31

SELECT CLIENT_NAME, STATUS
FROM   DBA_AUTOTASK_CLIENT
WHERE  CLIENT_NAME = 'auto optimizer stats collection';
</code></pre><p>Sample output appears as follows:</p><pre class="pre codeblock"><code>CLIENT_NAME                     STATUS
------------------------------- --------
auto optimizer stats collection ENABLED
</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-3DEDE019-8E77-42E9-B692-ECD11F5FBA9C__GUID-81EB6620-BBE6-40B9-B060-896FDF5CCD86">To change the window attributes for automatic statistics collection:</p>
                        <ol>
                           <li>
                              <p>Connect SQL*Plus to the database with administrator privileges.</p>
                           </li>
                           <li>
                              <p>Change the attributes of the maintenance window as needed.</p>
                              <p>For example, to change the Monday maintenance window so that it starts at 5 a.m., execute the following PL/SQL program:</p><pre class="pre codeblock"><code>BEGIN 
  DBMS_SCHEDULER.SET_ATTRIBUTE (
    'MONDAY_WINDOW'
,   'repeat_interval'
,   'freq=daily;byday=MON;byhour=05;byminute=0;bysecond=0'
);
END;
/</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-3DEDE019-8E77-42E9-B692-ECD11F5FBA9C__GUID-E9901D00-61F9-4F20-B7B2-55E0F6063E76">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="../arpls/DBMS_AUTO_TASK_ADMIN.html#ARPLS-GUID-8CD58D39-436B-4642-BAEB-00C651DE8A8F" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_AUTO_TASK_ADMIN</code> package
                              </p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=REFRN-GUID-16B23F95-8644-407A-A6C8-E85CADFA61FF" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">STATISTICS_LEVEL</code> initialization parameter
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-F007E78A-9967-4921-8046-D8F59A9272B4" title="Oracle Database can gather optimizer statistics automatically.">Configuring Automatic Optimizer Statistics Collection</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
            <div class="sect2"><a id="GUID-374ACB86-2512-4658-9170-8505B3EACF7D" name="GUID-374ACB86-2512-4658-9170-8505B3EACF7D"></a><h3 id="TGSQL-GUID-374ACB86-2512-4658-9170-8505B3EACF7D" class="sect3"><span class="enumeration_section">13.2 </span>Configuring <span>High-Frequency Automatic Optimizer Statistics Collection</span></h3>
               <div>
                  <p>This lightweight task supplements standard automatic statistics collection.</p>
                  <p>This section contains the following topics:</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-02415AC0-CA76-42F3-A10D-5B431215DD61">About High-Frequency Automatic Optimizer Statistics Collection</a><br>You can configure automatic statistics collection to occur more frequently.
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-401A1202-B7DB-45EA-8278-E1481ED7642F">Setting Preferences for High-Frequency Automatic Optimizer Statistics Collection</a><br>To enable and disable the task, use <code class="codeph">DBMS_STATS.SET_GLOBAL_PREFS</code>.
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-933EC241-11D2-47B0-B7E1-E68CDC9E9277">High-Frequency Automatic Optimizer Statistics Collection: Example</a><br>In this example, you enable run DML statements, and then enable the high-frequency statistics collection job.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-245F23B2-24AF-44D8-9F12-99FD1215E878" title="This chapter explains how to use the DBMS_STATS.GATHER_*_STATS program units.">Gathering Optimizer Statistics</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-02415AC0-CA76-42F3-A10D-5B431215DD61" name="GUID-02415AC0-CA76-42F3-A10D-5B431215DD61"></a><h4 id="TGSQL-GUID-02415AC0-CA76-42F3-A10D-5B431215DD61" class="sect4"><span class="enumeration_section">13.2.1 </span>About <span>High-Frequency Automatic Optimizer Statistics Collection</span></h4>
                  <div>
                     <p>You can configure automatic statistics collection to occur more frequently.</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-02415AC0-CA76-42F3-A10D-5B431215DD61__GUID-86AA1214-845B-4FFC-8445-BBED68B2F244">Purpose of <span>High-Frequency Automatic Optimizer Statistics Collection</span></p>
                        <p>AutoTask schedules tasks to run automatically in maintenance windows. By default, one window is scheduled for each day of the week. Automatic optimizer statistics collection (<code class="codeph">DBMS_STATS</code>) runs in all predefined maintenance windows.
                        </p>
                        <p>Statistics can go stale between two consecutive statistics collection tasks. If data changes frequently, the stale statistics could cause performance problems. For example, a brokerage company might receive tremendous data during trading hours, leading the optimizer to use stale statistics for queries executed during this period.</p>
                        <p><span>High-frequency automatic optimizer statistics collection</span> complements the standard statistics collection job. By default, the collection occurs every 15 minutes, meaning that statistics have less time in which to be stale.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-02415AC0-CA76-42F3-A10D-5B431215DD61__GUID-63441E4F-0749-4E9B-96ED-9FC2779818B6">How <span>High-Frequency Automatic Optimizer Statistics Collection</span> Works
                        </p>
                        <p>To enable and disable the high-frequency task, set the execution interval, and set the maximum run time, use the <code class="codeph">DBMS_STATS.SET_GLOBAL_PREFS</code> procedure. The high-frequency task is “lightweight” and only gathers stale statistics. It does not perform actions such as purging statistics for non-existent objects or invoking Optimizer Statistics Advisor. The standard automated job performs these additional tasks.
                        </p>
                        <p>Automatic statistics collection jobs that run in the maintenance window are not affected by the high-frequency jobs. The high-frequency tasks do not start during the maintenance window, so only one statistics task runs at a time. You can monitor the tasks by querying <code class="codeph">DBA_AUTO_STAT_EXECUTIONS</code>.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-374ACB86-2512-4658-9170-8505B3EACF7D" title="This lightweight task supplements standard automatic statistics collection.">Configuring High-Frequency Automatic Optimizer Statistics Collection</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-401A1202-B7DB-45EA-8278-E1481ED7642F" name="GUID-401A1202-B7DB-45EA-8278-E1481ED7642F"></a><h4 id="TGSQL-GUID-401A1202-B7DB-45EA-8278-E1481ED7642F" class="sect4"><span class="enumeration_section">13.2.2 </span>Setting Preferences for <span>High-Frequency Automatic Optimizer Statistics Collection</span></h4>
                  <div>
                     <p>To enable and disable the task, use <code class="codeph">DBMS_STATS.SET_GLOBAL_PREFS</code>.
                     </p>
                     <div class="section">
                        <p>You can use <code class="codeph">DBMS_STATS.SET_GLOBAL_PREFS</code> to set preferences to any of the following values:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">AUTO_TASK_STATUS</code></p>
                              <p>Enables or disables the <span>high-frequency automatic optimizer statistics collection</span>. Values are:
                              </p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><code class="codeph">ON</code> — Enables <span>high-frequency automatic optimizer statistics collection</span>.
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">OFF</code> — Disables <span>high-frequency automatic optimizer statistics collection</span>. This is the default.
                                    </p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p><code class="codeph">AUTO_TASK_MAX_RUN_TIME</code></p>
                              <p>Configures the maximum run time in seconds of an execution of <span>high-frequency automatic optimizer statistics collection</span>. The maximum value is <code class="codeph">3600</code> (equal to 1 hour), which is the default.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">AUTO_TASK_INTERVAL</code></p>
                              <p>Specifies the interval in seconds between executions of <span>high-frequency automatic optimizer statistics collection</span>. The minimum value is <code class="codeph">60</code>. The default is <code class="codeph">900</code> (equal to 15 minutes).
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="p">To configure the high-frequency task, you must have administrator privileges.</div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-401A1202-B7DB-45EA-8278-E1481ED7642F__GUID-072A9C06-A264-4171-901C-C709B7090A00">To configure the high-frequency task:</p>
                        <ol>
                           <li>
                              <p>Log in to the database as a user with administrator privileges.</p>
                           </li>
                           <li>
                              <p>To enable the high-frequency task, set the <code class="codeph">AUTO_TASK_STATUS</code> preference to <code class="codeph">ON</code>.
                              </p>
                              <p>The following example enables the automatic task:</p><pre class="pre codeblock"><code>EXEC DBMS_STATS.SET_GLOBAL_PREFS('AUTO_TASK_STATUS','ON');</code></pre></li>
                           <li>
                              <p>To set the maximum run time, set the <code class="codeph">AUTO_TASK_MAX_RUN_TIME</code> preference to the desired number of seconds.
                              </p>
                              <p>The following example sets the maximum run time to 10 minutes:</p><pre class="pre codeblock"><code>EXEC DBMS_STATS.SET_GLOBAL_PREFS('AUTO_TASK_MAX_RUN_TIME','600');</code></pre></li>
                           <li>
                              <p>To set the frequency, set the <code class="codeph">AUTO_TASK_INTERVAL</code> preference to the desired number of seconds.
                              </p>
                              <p>The following example sets the frequency to 8 minutes:</p><pre class="pre codeblock"><code>EXEC DBMS_STATS.SET_GLOBAL_PREFS('AUTO_TASK_INTERVAL','240');</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-374ACB86-2512-4658-9170-8505B3EACF7D" title="This lightweight task supplements standard automatic statistics collection.">Configuring High-Frequency Automatic Optimizer Statistics Collection</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-933EC241-11D2-47B0-B7E1-E68CDC9E9277" name="GUID-933EC241-11D2-47B0-B7E1-E68CDC9E9277"></a><h4 id="TGSQL-GUID-933EC241-11D2-47B0-B7E1-E68CDC9E9277" class="sect4"><span class="enumeration_section">13.2.3 </span><span>High-Frequency Automatic Optimizer Statistics Collection</span>: Example
                  </h4>
                  <div>
                     <p>In this example, you enable run DML statements, and then enable the high-frequency statistics collection job.</p>
                     <div class="section">
                        <p>This example assumes the following:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>You are logged in to the database as an administrator.</p>
                           </li>
                           <li>
                              <p>The statistics for the <code class="codeph">sh</code> schema are fresh.
                              </p>
                           </li>
                           <li>
                              <p><span>High-frequency automatic optimizer statistics collection</span></p> is not enabled.
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-933EC241-11D2-47B0-B7E1-E68CDC9E9277__GUID-C45CFDE1-F4A8-41DC-88C2-14F4D5DE7307">
                        <ol>
                           <li>
                              <p>Query the data dictionary for the statistics for the <code class="codeph">sales</code> and <code class="codeph">customers</code> tables (sample output included):
                              </p><pre class="pre codeblock"><code>SET LINESIZE 170
SET PAGESIZE 5000
COL TABLE_NAME FORMAT a20
COL PARTITION_NAME FORMAT a20
COL NUM_ROWS FORMAT 9999999
COL STALE_STATS FORMAT a3

SELECT TABLE_NAME, PARTITION_NAME, NUM_ROWS, STALE_STATS
FROM   DBA_TAB_STATISTICS
WHERE  OWNER = 'SH'
AND    TABLE_NAME IN ('CUSTOMERS','SALES')
ORDER BY TABLE_NAME, PARTITION_NAME;

TABLE_NAME           PARTITION_NAME       NUM_ROWS STA
-------------------- -------------------- -------- ---
CUSTOMERS                                    55500 NO
SALES                SALES_1995                  0 NO
SALES                SALES_1996                  0 NO
SALES                SALES_H1_1997               0 NO
SALES                SALES_H2_1997               0 NO
SALES                SALES_Q1_1998           43687 NO
SALES                SALES_Q1_1999           64186 NO
SALES                SALES_Q1_2000           62197 NO
SALES                SALES_Q1_2001           60608 NO
SALES                SALES_Q1_2002               0 NO
SALES                SALES_Q1_2003               0 NO
SALES                SALES_Q2_1998           35758 NO
SALES                SALES_Q2_1999           54233 NO
SALES                SALES_Q2_2000           55515 NO
SALES                SALES_Q2_2001           63292 NO
SALES                SALES_Q2_2002               0 NO
SALES                SALES_Q2_2003               0 NO
SALES                SALES_Q3_1998           50515 NO
SALES                SALES_Q3_1999           67138 NO
SALES                SALES_Q3_2000           58950 NO
SALES                SALES_Q3_2001           65769 NO
SALES                SALES_Q3_2002               0 NO
SALES                SALES_Q3_2003               0 NO
SALES                SALES_Q4_1998           48874 NO
SALES                SALES_Q4_1999           62388 NO
SALES                SALES_Q4_2000           55984 NO
SALES                SALES_Q4_2001           69749 NO
SALES                SALES_Q4_2002               0 NO
SALES                SALES_Q4_2003               0 NO
SALES                                       918843 NO</code></pre><p>The preceding output shows that none of the statistics are stale.</p>
                           </li>
                           <li>
                              <p>Perform DML on <code class="codeph">sales</code> and <code class="codeph">customers</code>:
                              </p><pre class="pre codeblock"><code>-- insert 918K rows in sales
INSERT INTO sh.sales SELECT * FROM sh.sales;
-- update around 15% of sales rows 
UPDATE sh.sales SET amount_sold = amount_sold + 1 WHERE amount_sold &gt; 100;
-- insert 1 row into customers
INSERT INTO sh.customers(cust_id, cust_first_name, cust_last_name, 
    cust_gender, cust_year_of_birth, cust_main_phone_number,  
    cust_street_address, cust_postal_code, cust_city_id, 
    cust_city, cust_state_province_id, cust_state_province, 
    country_id, cust_total, cust_total_id) 
  VALUES(188710, 'Jenny', 'Smith', 'F', '1966', '555-111-2222', 
    '400 oracle parkway','94065',51402, 'Redwood Shores', 
    52564, 'CA', 52790, 'Customer total', '52772');
COMMIT;</code></pre><p>The total number of <code class="codeph">sales</code> rows increased by 100%, but only 1 row was added to <code class="codeph">customers</code>.
                              </p>
                           </li>
                           <li>
                              <p>Save the optimizer statistics to disk:</p><pre class="pre codeblock"><code>EXEC DBMS_STATS.FLUSH_DATABASE_MONITORING_INFO;</code></pre></li>
                           <li>
                              <p>Query the table statistics again (sample output included):</p><pre class="pre codeblock"><code>SELECT TABLE_NAME, PARTITION_NAME, NUM_ROWS, STALE_STATS 
FROM   DBA_TAB_STATISTICS
WHERE  OWNER = 'SH'
AND    TABLE_NAME IN ('CUSTOMERS','SALES')
ORDER BY TABLE_NAME, PARTITION_NAME;

TABLE_NAME           PARTITION_NAME       NUM_ROWS STA
-------------------- -------------------- -------- ---
CUSTOMERS                                    55500 <span class="bold">NO</span>
SALES                SALES_1995                  0 NO
SALES                SALES_1996                  0 NO
SALES                SALES_H1_1997               0 NO
SALES                SALES_H2_1997               0 NO
SALES                SALES_Q1_1998           43687 YES
SALES                SALES_Q1_1999           64186 YES
SALES                SALES_Q1_2000           62197 YES
SALES                SALES_Q1_2001           60608 YES
SALES                SALES_Q1_2002               0 NO
SALES                SALES_Q1_2003               0 NO
SALES                SALES_Q2_1998           35758 YES
SALES                SALES_Q2_1999           54233 YES
SALES                SALES_Q2_2000           55515 YES
SALES                SALES_Q2_2001           63292 YES
SALES                SALES_Q2_2002               0 NO
SALES                SALES_Q2_2003               0 NO
SALES                SALES_Q3_1998           50515 YES
SALES                SALES_Q3_1999           67138 YES
SALES                SALES_Q3_2000           58950 YES
SALES                SALES_Q3_2001           65769 YES
SALES                SALES_Q3_2002               0 NO
SALES                SALES_Q3_2003               0 NO
SALES                SALES_Q4_1998           48874 YES
SALES                SALES_Q4_1999           62388 YES
SALES                SALES_Q4_2000           55984 YES
SALES                SALES_Q4_2001           69749 YES
SALES                SALES_Q4_2002               0 NO
SALES                SALES_Q4_2003               0 NO
SALES                                      1837686
SALES                                       918843 <span class="bold">YES</span>

31 rows selected.
</code></pre><p>The preceding output shows that the statistics are not stale for <code class="codeph">customers</code> but are stale for <code class="codeph">sales</code>.
                              </p>
                           </li>
                           <li>
                              <p>Configure <span>high-frequency automatic optimizer statistics collection</span>:
                              </p><pre class="pre codeblock"><code>EXEC DBMS_STATS.SET_GLOBAL_PREFS('AUTO_TASK_STATUS','ON');
EXEC DBMS_STATS.SET_GLOBAL_PREFS('AUTO_TASK_MAX_RUN_TIME','180');
EXEC DBMS_STATS.SET_GLOBAL_PREFS('AUTO_TASK_INTERVAL','240');</code></pre><p>The preceding PL/SQL programs enable high-frequency collection, set the maximum run time to 3 minutes, and set the task execution interval to 4 minutes.</p>
                           </li>
                           <li>
                              <p>Wait for a few minutes, and then query the data dictionary:</p><pre class="pre codeblock"><code>COL OPID FORMAT 9999
COL STATUS FORMAT a11
COL ORIGIN FORMAT a20
COL COMPLETED FORMAT 99999
COL FAILED FORMAT 99999
COL TIMEOUT FORMAT 99999
COL INPROG FORMAT 99999

SELECT OPID, ORIGIN, STATUS, TO_CHAR(START_TIME, 'DD/MM HH24:MI:SS' ) AS BEGIN_TIME,
       TO_CHAR(END_TIME, 'DD/MM HH24:MI:SS') AS END_TIME, COMPLETED, FAILED,
       TIMED_OUT AS TIMEOUT, IN_PROGRESS AS INPROG
FROM  DBA_AUTO_STAT_EXECUTIONS
ORDER BY OPID;
</code></pre><p>The output shows that the high-frequency job executed twice, and the standard automatic statistics collection job executed once:</p><pre class="pre codeblock"><code> OPID ORIGIN               STATUS      BEGIN_TIME     END_TIME       COMPLETED FAILED TIMEOUT INPROG
----- -------------------- ----------- -------------- -------------- --------- ------ ------- ------
  790 HIGH_FREQ_AUTO_TASK  COMPLETED   03/10 14:54:02 03/10 14:54:35       338      3       0      0
  793 HIGH_FREQ_AUTO_TASK  COMPLETED   03/10 14:58:11 03/10 14:58:45       193      3       0      0
  794 AUTO_TASK            COMPLETED   03/10 15:00:02 03/10 15:00:20        52      3       0      0</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-374ACB86-2512-4658-9170-8505B3EACF7D" title="This lightweight task supplements standard automatic statistics collection.">Configuring High-Frequency Automatic Optimizer Statistics Collection</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL406"></a><div class="props_rev_3"><a id="GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" name="GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B"></a><h3 id="TGSQL-GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" class="sect3"><span class="enumeration_section">13.3 </span>Gathering Optimizer Statistics Manually
               </h3>
               <div>
                  <p>As an alternative or supplement to automatic statistics gathering, you can use the <code class="codeph">DBMS_STATS</code> package to gather optimizer statistics manually.
                  </p>
                  <p>This section contains the following topics:</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-83F1A4F5-A316-4EAD-9AE6-CB95C1885001">About Manual Statistics Collection with DBMS_STATS</a><br>Use the <code class="codeph">DBMS_STATS</code> package to manipulate optimizer statistics. You can gather statistics on objects and columns at various levels of granularity: object, schema, and database. You can also gather statistics for the physical system.
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-A3E66485-F827-494E-99D7-6E4558E9CC21">Guidelines for Gathering Optimizer Statistics Manually</a><br>In most cases, automatic statistics collection is sufficient for database objects modified at a moderate speed.
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-33C8239F-53A9-4FCB-969B-4772041317AA">Determining When Optimizer Statistics Are Stale</a><br>Stale statistics on a table do not accurately reflect its data. To help you determine when a database object needs new statistics, the database provides a table monitoring facility. 
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D">Gathering Schema and Table Statistics</a><br>Use <code class="codeph">GATHER_TABLE_STATS</code> to collect table statistics, and <code class="codeph">GATHER_SCHEMA_STATS</code> to collect statistics for all objects in a schema.
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212">Gathering Statistics for Fixed Objects</a><br>Fixed objects are dynamic performance tables and their indexes. These objects record current database activity. 
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-D97EB4EA-DA11-4F19-888A-AAABA7D5FDF5">Gathering Statistics for Volatile Tables Using Dynamic Statistics</a><br>Statistics for volatile tables, which are tables modified significantly during the day, go stale quickly. For example, a table may be deleted or truncated, and then rebuilt.
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-3D36585C-5850-402E-9DB5-2EE9AAAD8C36">Gathering Optimizer Statistics Concurrently</a><br>Oracle Database can gather statistics on multiple tables or partitions concurrently.
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-63E195EB-10F4-428B-9912-3E98C2A957BF">Gathering Incremental Statistics on Partitioned Objects</a><br>Incremental statistics scan only changed partitions. When gathering statistics on large partitioned table by deriving global statistics from partition-level statistics, <strong class="term">incremental statistics maintenance</strong> improves performance.
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B__GUID-FAAC7E0D-F492-4210-8041-A1BE10562508">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><span class="q">"<a href="gathering-optimizer-statistics.html#GUID-F007E78A-9967-4921-8046-D8F59A9272B4" title="Oracle Database can gather optimizer statistics automatically.">Configuring Automatic Optimizer Statistics Collection</a>"</span></p>
                        </li>
                        <li>
                           <p><a href="../arpls/DBMS_STATS.html#ARPLS059" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_STATS</code> package
                           </p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-245F23B2-24AF-44D8-9F12-99FD1215E878" title="This chapter explains how to use the DBMS_STATS.GATHER_*_STATS program units.">Gathering Optimizer Statistics</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL94918"></a><a id="TGSQL407"></a><div class="props_rev_3"><a id="GUID-83F1A4F5-A316-4EAD-9AE6-CB95C1885001" name="GUID-83F1A4F5-A316-4EAD-9AE6-CB95C1885001"></a><h4 id="TGSQL-GUID-83F1A4F5-A316-4EAD-9AE6-CB95C1885001" class="sect4"><span class="enumeration_section">13.3.1 </span>About Manual Statistics Collection with DBMS_STATS
                  </h4>
                  <div>
                     <p>Use the <code class="codeph">DBMS_STATS</code> package to manipulate optimizer statistics. You can gather statistics on objects and columns at various levels of granularity: object, schema, and database. You can also gather statistics for the physical system.
                     </p>
                     <p>The following table summarizes the <code class="codeph">DBMS_STATS</code> procedures for gathering optimizer statistics. This package does not gather statistics for table clusters. However, you can gather statistics on individual tables in a <a href="glossary.html#GUID-631F5681-B73D-4551-A4B2-C69282695030"><span class="xrefglossterm">table cluster</span></a>.
                     </p>
                     <div class="tblformal" id="GUID-83F1A4F5-A316-4EAD-9AE6-CB95C1885001__CHDCEEJH">
                        <p class="titleintable">Table 13-1 DBMS_STATS Procedures for Gathering Optimizer Statistics</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="DBMS_STATS Procedures for Gathering Optimizer Statistics" summary="This 2 column table lists the DBMS_STATS Procedures for Setting Preferences. Column 1 is the procedure. Column 2 is the purpose of the procedure. " width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="40%" id="d74756e2055">Procedure</th>
                                 <th align="left" valign="bottom" width="60%" id="d74756e2058">Purpose</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="40%" id="d74756e2063" headers="d74756e2055 ">
                                    <p><code class="codeph">GATHER_INDEX_STATS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d74756e2063 d74756e2058 ">
                                    <p>Collects index statistics</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="40%" id="d74756e2071" headers="d74756e2055 ">
                                    <p><code class="codeph">GATHER_TABLE_STATS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d74756e2071 d74756e2058 ">
                                    <p>Collects table, column, and index statistics</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="40%" id="d74756e2079" headers="d74756e2055 ">
                                    <p><code class="codeph">GATHER_SCHEMA_STATS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d74756e2079 d74756e2058 ">
                                    <p>Collects statistics for all objects in a schema</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="40%" id="d74756e2087" headers="d74756e2055 ">
                                    <p><code class="codeph">GATHER_DICTIONARY_STATS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d74756e2087 d74756e2058 ">
                                    <p>Collects statistics for all system schemas, including <code class="codeph">SYS</code> and <code class="codeph">SYSTEM</code>, and other optional schemas, such as <code class="codeph">CTXSYS</code> and <code class="codeph">DRSYS</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="40%" id="d74756e2106" headers="d74756e2055 ">
                                    <p><code class="codeph">GATHER_DATABASE_STATS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="60%" headers="d74756e2106 d74756e2058 ">
                                    <p>Collects statistics for all objects in a database</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>When the <code class="codeph">OPTIONS</code> parameter is set to <code class="codeph">GATHER STALE</code> or <code class="codeph">GATHER AUTO</code>, the <code class="codeph">GATHER_SCHEMA_STATS</code> and <code class="codeph">GATHER_DATABASE_STATS</code> procedures gather statistics for any table that has stale statistics and any table that is missing statistics. If a monitored table has been modified more than 10%, then the database considers these statistics stale and gathers them again.
                     </p>
                     <div class="infoboxnote" id="GUID-83F1A4F5-A316-4EAD-9AE6-CB95C1885001__GUID-8CFAD02D-3599-4CF2-9AB9-774F5CAAA3AC">
                        <p class="notep1">Note:</p>
                        <p>As explained in <span class="q">"<a href="gathering-optimizer-statistics.html#GUID-F007E78A-9967-4921-8046-D8F59A9272B4" title="Oracle Database can gather optimizer statistics automatically.">Configuring Automatic Optimizer Statistics Collection</a>"</span>, you can configure a nightly job to gather statistics automatically.
                        </p>
                     </div>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-83F1A4F5-A316-4EAD-9AE6-CB95C1885001__GUID-BF19598F-E808-42C1-9C94-CEF1508BE5D2">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="q">"<a href="gathering-optimizer-statistics.html#GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31" title="System statistics describe hardware characteristics, such as I/O and CPU performance and utilization, to the optimizer.">Gathering System Statistics Manually</a>"</span></p>
                           </li>
                           <li>
                              <p><a href="../arpls/DBMS_STATS.html#ARPLS059" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about the <code class="codeph">DBMS_STATS</code> package
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" title="As an alternative or supplement to automatic statistics gathering, you can use the DBMS_STATS package to gather optimizer statistics manually.">Gathering Optimizer Statistics Manually</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL415"></a><div class="props_rev_3"><a id="GUID-A3E66485-F827-494E-99D7-6E4558E9CC21" name="GUID-A3E66485-F827-494E-99D7-6E4558E9CC21"></a><h4 id="TGSQL-GUID-A3E66485-F827-494E-99D7-6E4558E9CC21" class="sect4"><span class="enumeration_section">13.3.2 </span>Guidelines for Gathering Optimizer Statistics Manually
                  </h4>
                  <div>
                     <p>In most cases, automatic statistics collection is sufficient for database objects modified at a moderate speed.</p>
                     <p>Automatic collection may sometimes be inadequate or unavailable, as shown in the following table.</p>
                     <div class="tblformal" id="GUID-A3E66485-F827-494E-99D7-6E4558E9CC21__GUID-0433AA43-E757-4E66-A4CE-F3BF12A907AE">
                        <p class="titleintable">Table 13-2 Reasons for Gathering Statistics Manually</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="Reasons for Gathering Statistics Manually" summary="This table describes situations in which you may need to gather statistics manually." frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" id="d74756e2297">Issue</th>
                                 <th align="left" valign="bottom" id="d74756e2299">To Learn More</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d74756e2303" headers="d74756e2297 ">You perform certain types of <a href="glossary.html#GUID-FC504237-77A1-49E6-8BA2-4475A1C76553"><span class="xrefglossterm">bulk load</span></a> and cannot wait for the maintenance window to collect statistics because queries must be executed immediately. 
                                 </td>
                                 <td align="left" valign="top" headers="d74756e2303 d74756e2299 "><span class="q">"<a href="optimizer-statistics-concepts.html#GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B" title="The database can gather table and index statistics automatically during the following types of bulk loads: INSERT INTO ... SELECT using a direct path insert, and CREATE TABLE AS SELECT.">Online Statistics Gathering for Bulk Loads</a>"</span></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d74756e2322" headers="d74756e2297 ">During a nonrepresentative workload, automatic statistics collection gathers statistics for fixed tables.</td>
                                 <td align="left" valign="top" headers="d74756e2322 d74756e2299 "><span class="q">"<a href="gathering-optimizer-statistics.html#GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212" title="Fixed objects are dynamic performance tables and their indexes. These objects record current database activity.">Gathering Statistics for Fixed Objects</a>"</span></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d74756e2332" headers="d74756e2297 ">Automatic statistics collection does not gather system statistics. </td>
                                 <td align="left" valign="top" headers="d74756e2332 d74756e2299 "><span class="q">"<a href="gathering-optimizer-statistics.html#GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31" title="System statistics describe hardware characteristics, such as I/O and CPU performance and utilization, to the optimizer.">Gathering System Statistics Manually</a>"</span></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d74756e2342" headers="d74756e2297 ">Volatile tables are being deleted or truncated, and then rebuilt during the day.</td>
                                 <td align="left" valign="top" headers="d74756e2342 d74756e2299 "><span class="q">"<a href="gathering-optimizer-statistics.html#GUID-D97EB4EA-DA11-4F19-888A-AAABA7D5FDF5" title="Statistics for volatile tables, which are tables modified significantly during the day, go stale quickly. For example, a table may be deleted or truncated, and then rebuilt.">Gathering Statistics for Volatile Tables Using Dynamic Statistics</a>"</span></td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>This section offers guidelines for typical situations in which you may choose to gather statistically manually:</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-88E321BF-445E-40BD-83A2-9EA107689B2F">Guideline for Setting the Sample Size</a><br>In the context of optimizer statistics, <span class="bold">sampling</span> is the gathering of statistics from a random subset of table rows. By enabling the database to avoid full table scans and sorts of entire tables, sampling minimizes the resources necessary to gather statistics.
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-61D61DDE-C597-4B86-98B4-A0A9CB176F33">Guideline for Gathering Statistics in Parallel</a><br>By default, the database gathers statistics with the parallelism degree specified at the table or index level. 
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-5EB2976E-26EF-47A7-8568-7695CA853079">Guideline for Partitioned Objects</a><br>For partitioned tables and indexes, <code class="codeph">DBMS_STATS</code> can gather separate statistics for each partition and global statistics for the entire table or index.
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-6236E795-8A03-444B-92EA-52CD76EA332E">Guideline for Frequently Changing Objects</a><br>When tables are frequently modified, gather statistics often enough so that they do not go stale, but not so often that collection overhead degrades performance. 
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-47136764-F468-43ED-9FF7-053C90D338B8">Guideline for External Tables</a><br>Because the database does not permit data manipulation against external tables, the database never marks statistics on external tables as stale. If new statistics are required for an external table, for example, because the underlying data files change, then regather the statistics.
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" title="As an alternative or supplement to automatic statistics gathering, you can use the DBMS_STATS package to gather optimizer statistics manually.">Gathering Optimizer Statistics Manually</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL409"></a><div class="props_rev_3"><a id="GUID-88E321BF-445E-40BD-83A2-9EA107689B2F" name="GUID-88E321BF-445E-40BD-83A2-9EA107689B2F"></a><h5 id="TGSQL-GUID-88E321BF-445E-40BD-83A2-9EA107689B2F" class="sect5"><span class="enumeration_section">13.3.2.1 </span>Guideline for Setting the Sample Size
                     </h5>
                     <div>
                        <p>In the context of optimizer statistics, <span class="bold">sampling</span> is the gathering of statistics from a random subset of table rows. By enabling the database to avoid full table scans and sorts of entire tables, sampling minimizes the resources necessary to gather statistics.
                        </p>
                        <div class="section">
                           <p>The database gathers the most accurate statistics when it processes all rows in the table, which is a 100% sample. However, larger sample sizes increase the time of statistics gathering operations. The challenge is determining a sample size that provides accurate statistics in a reasonable time.</p>
                           <p><code class="codeph">DBMS_STATS</code> uses sampling when a user specifies the parameter <code class="codeph">ESTIMATE_PERCENT</code>, which controls the percentage of the rows in the table to sample. To maximize performance gains while achieving necessary statistical accuracy, Oracle recommends that the <code class="codeph">ESTIMATE_PERCENT</code> parameter use the default setting of <code class="codeph">DBMS_STATS.AUTO_SAMPLE_SIZE</code>. In this case, Oracle Database chooses the sample size automatically. This setting enables the use of the following:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>A hash-based algorithm that is much faster than sampling</p>
                                 <p>This algorithm reads all rows and produces statistics that are nearly as accurate as statistics from a 100% sample. The statistics computed using this technique are deterministic.</p>
                              </li>
                              <li>
                                 <p>Incremental statistics</p>
                              </li>
                              <li>
                                 <p>Concurrent statistics</p>
                              </li>
                              <li>
                                 <p>New histogram types</p>
                              </li>
                           </ul>
                           <p>The <code class="codeph">DBA_TABLES.SAMPLE_SIZE</code> column indicates the actual sample size used to gather statistics.
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-88E321BF-445E-40BD-83A2-9EA107689B2F__GUID-79811D0D-EF05-4A33-8E04-582862DA0389">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="q">"<a href="histograms.html#GUID-59C57EDF-E763-436A-9CB2-B59A536A10F7" title="A hybrid histogram combines characteristics of both height-based histograms and frequency histograms. This "best of both worlds" approach enables the optimizer to obtain better selectivity estimates in some situations.">Hybrid Histograms</a>"</span></p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-7BA4CA2E-013E-403B-9AB7-7AB62FE61FEE" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about <code class="codeph">DBMS_STATS.AUTO_SAMPLE_SIZE</code></p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-A3E66485-F827-494E-99D7-6E4558E9CC21" title="In most cases, automatic statistics collection is sufficient for database objects modified at a moderate speed.">Guidelines for Gathering Optimizer Statistics Manually</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL410"></a><div class="props_rev_3"><a id="GUID-61D61DDE-C597-4B86-98B4-A0A9CB176F33" name="GUID-61D61DDE-C597-4B86-98B4-A0A9CB176F33"></a><h5 id="TGSQL-GUID-61D61DDE-C597-4B86-98B4-A0A9CB176F33" class="sect5"><span class="enumeration_section">13.3.2.2 </span>Guideline for Gathering Statistics in Parallel
                     </h5>
                     <div>
                        <p>By default, the database gathers statistics with the parallelism degree specified at the table or index level. </p>
                        <div class="section">
                           <p>You can override this setting with the <code class="codeph">degree</code> argument to the <code class="codeph">DBMS_STATS</code> gathering procedures. Oracle recommends setting <code class="codeph">degree</code> to <code class="codeph">DBMS_STATS.AUTO_DEGREE</code>. This setting enables the database to choose an appropriate degree of parallelism based on the object size and the settings for the parallelism-related initialization parameters.
                           </p>
                           <p>The database can gather most statistics serially or in parallel. However, the database does not gather some index statistics in parallel, including cluster indexes, domain indexes, and bitmap join indexes. The database can use sampling when gathering parallel statistics.</p>
                           <div class="infoboxnote" id="GUID-61D61DDE-C597-4B86-98B4-A0A9CB176F33__GUID-C21C5D1A-536B-4B0C-9F6B-53B2979F42F3">
                              <p class="notep1">Note:</p>
                              <p>Do not confuse gathering statistics in parallel with gathering statistics concurrently. </p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-61D61DDE-C597-4B86-98B4-A0A9CB176F33__GUID-047F2C24-BC75-4E08-BDFD-25DE76C3211E">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="q">"<a href="gathering-optimizer-statistics.html#GUID-C5EEE744-8F37-4255-A18E-16B46B78EFA9" title="By default, each partition of a partition table is gathered sequentially.">About Concurrent Statistics Gathering</a>"</span></p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-7BA4CA2E-013E-403B-9AB7-7AB62FE61FEE" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about <code class="codeph">DBMS_STATS.AUTO_DEGREE</code></p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-A3E66485-F827-494E-99D7-6E4558E9CC21" title="In most cases, automatic statistics collection is sufficient for database objects modified at a moderate speed.">Guidelines for Gathering Optimizer Statistics Manually</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL411"></a><div class="props_rev_3"><a id="GUID-5EB2976E-26EF-47A7-8568-7695CA853079" name="GUID-5EB2976E-26EF-47A7-8568-7695CA853079"></a><h5 id="TGSQL-GUID-5EB2976E-26EF-47A7-8568-7695CA853079" class="sect5"><span class="enumeration_section">13.3.2.3 </span>Guideline for Partitioned Objects
                     </h5>
                     <div>
                        <p>For partitioned tables and indexes, <code class="codeph">DBMS_STATS</code> can gather separate statistics for each partition and global statistics for the entire table or index.
                        </p>
                        <div class="section">
                           <p>Similarly, for composite partitioning, <code class="codeph">DBMS_STATS</code> can gather separate statistics for subpartitions, partitions, and the entire table or index.
                           </p>
                           <p>To determine the type of partitioning statistics to be gathered, specify the <code class="codeph">granularity</code> argument to the <code class="codeph">DBMS_STATS</code> procedures. Oracle recommends setting <code class="codeph">granularity</code> to the default value of <code class="codeph">AUTO</code> to gather subpartition, partition, or global statistics, depending on partition type. The <code class="codeph">ALL</code> setting gathers statistics for all types.
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-5EB2976E-26EF-47A7-8568-7695CA853079__GUID-91B43C9E-43CD-4FBB-BF5D-0EDEA7C86C89">
                           <p class="notep1">See Also:</p>
                           <p><span class="q">"<a href="gathering-optimizer-statistics.html#GUID-63E195EB-10F4-428B-9912-3E98C2A957BF" title="Incremental statistics scan only changed partitions. When gathering statistics on large partitioned table by deriving global statistics from partition-level statistics, incremental statistics maintenance improves performance.">Gathering Incremental Statistics on Partitioned Objects</a>"</span></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-A3E66485-F827-494E-99D7-6E4558E9CC21" title="In most cases, automatic statistics collection is sufficient for database objects modified at a moderate speed.">Guidelines for Gathering Optimizer Statistics Manually</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL416"></a><div class="props_rev_3"><a id="GUID-6236E795-8A03-444B-92EA-52CD76EA332E" name="GUID-6236E795-8A03-444B-92EA-52CD76EA332E"></a><h5 id="TGSQL-GUID-6236E795-8A03-444B-92EA-52CD76EA332E" class="sect5"><span class="enumeration_section">13.3.2.4 </span>Guideline for Frequently Changing Objects
                     </h5>
                     <div>
                        <p>When tables are frequently modified, gather statistics often enough so that they do not go stale, but not so often that collection overhead degrades performance. </p>
                        <div class="section">
                           <p>You may only need to gather new statistics every week or month. The best practice is to use a script or job scheduler to regularly run the <code class="codeph">DBMS_STATS.GATHER_SCHEMA_STATS</code> and <code class="codeph">DBMS_STATS.GATHER_DATABASE_STATS</code> procedures.
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-A3E66485-F827-494E-99D7-6E4558E9CC21" title="In most cases, automatic statistics collection is sufficient for database objects modified at a moderate speed.">Guidelines for Gathering Optimizer Statistics Manually</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL95045"></a><div class="props_rev_3"><a id="GUID-47136764-F468-43ED-9FF7-053C90D338B8" name="GUID-47136764-F468-43ED-9FF7-053C90D338B8"></a><h5 id="TGSQL-GUID-47136764-F468-43ED-9FF7-053C90D338B8" class="sect5"><span class="enumeration_section">13.3.2.5 </span>Guideline for External Tables
                     </h5>
                     <div>
                        <p>Because the database does not permit data manipulation against external tables, the database never marks statistics on external tables as stale. If new statistics are required for an external table, for example, because the underlying data files change, then regather the statistics.</p>
                        <div class="section">
                           <p>For external tables, use the same <code class="codeph">DBMS_STATS</code> procedures that you use for internal tables. Note that the <code class="codeph">scanrate</code> parameter of <code class="codeph">DBMS_STATS.SET_TABLE_STATS</code> and <code class="codeph">DBMS_STATS.GET_TABLE_STATS</code> specifies the rate (in MB/s) at which Oracle Database scans data in tables, and is relevant only for external tables. The <code class="codeph">SCAN_RATE</code> column appears in the <code class="codeph">DBA_TAB_STATISTICS</code> and <code class="codeph">DBA_TAB_PENDING_STATS</code> data dictionary views.
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-47136764-F468-43ED-9FF7-053C90D338B8__GUID-63FA5FB5-B7CA-42F1-AC89-AE0757F648CC">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="q">"<a href="controlling-the-use-of-optimizer-statistics.html#GUID-87A26DD9-E2C1-41E3-9EF0-D141F44F0968" title="To provide the optimizer with user-created statistics for testing purposes, you can use the DBMS_STATS.SET_*_STATS procedures. These procedures provide the optimizer with artificial values for the specified statistics.">Creating Artificial Optimizer Statistics for Testing</a>"</span></p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-17645D4E-279E-4C6F-9FF5-6AC909EDBCD3" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about <code class="codeph">SET_TABLE_STATS</code> and <code class="codeph">GET_TABLE_STATS</code></p>
                              </li>
                              <li>
                                 <p><a href="../refrn/DBA_TAB_STATISTICS.html#REFRN-GUID-03D846F8-5906-42FE-983B-E3434F5545A7" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">DBA_TAB_STATISTICS</code> view
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-A3E66485-F827-494E-99D7-6E4558E9CC21" title="In most cases, automatic statistics collection is sufficient for database objects modified at a moderate speed.">Guidelines for Gathering Optimizer Statistics Manually</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="TGSQL425"></a><a id="TGSQL424"></a><div class="props_rev_3"><a id="GUID-33C8239F-53A9-4FCB-969B-4772041317AA" name="GUID-33C8239F-53A9-4FCB-969B-4772041317AA"></a><h4 id="TGSQL-GUID-33C8239F-53A9-4FCB-969B-4772041317AA" class="sect4"><span class="enumeration_section">13.3.3 </span>Determining When Optimizer Statistics Are Stale
                  </h4>
                  <div>
                     <p>Stale statistics on a table do not accurately reflect its data. To help you determine when a database object needs new statistics, the database provides a table monitoring facility. </p>
                     <div class="section">
                        <p>Monitoring tracks the approximate number of DML operations on a table and whether the table has been truncated since the most recent statistics collection. To check whether statistics are stale, query the <code class="codeph">STALE_STATS</code> column in <code class="codeph">DBA_TAB_STATISTICS</code> and <code class="codeph">DBA_IND_STATISTICS</code>. This column is based on data in the <code class="codeph">DBA_TAB_MODIFICATIONS</code> view and the <code class="codeph">STALE_PERCENT</code> preference for <code class="codeph">DBMS_STATS</code>.
                        </p>
                        <div class="infoboxnote" id="GUID-33C8239F-53A9-4FCB-969B-4772041317AA__GUID-FC6DC537-219E-4222-B131-C3F8D6ED414A">
                           <p class="notep1">Note:</p>
                           <p>Starting in <span>Oracle Database 12c</span> Release 2 (12.2), you no longer need to use <code class="codeph">DBMS_STATS.FLUSH_DATABASE_MONITORING_INFO</code> to ensure that view metadata is current. The statistics shown in the <code class="codeph">DBA_TAB_STATISTICS</code>, <code class="codeph">DBA_IND_STATISTICS</code>, and <code class="codeph">DBA_TAB_MODIFICATIONS</code> views are obtained from both disk and memory.
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>The  <code class="codeph">STALE_STATS</code> column has the following possible values:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">YES</code></p>
                              <p>The statistics are stale.</p>
                           </li>
                           <li>
                              <p><code class="codeph">NO</code></p>
                              <p>The statistics are not stale.</p>
                           </li>
                           <li>
                              <p>null</p>
                              <p>The statistics are not collected.</p>
                           </li>
                        </ul>
                        <p>Executing <code class="codeph">GATHER_SCHEMA_STATS</code> or <code class="codeph">GATHER_DATABASE_STATS</code> with the <code class="codeph">GATHER AUTO</code> option collects statistics only for objects with no statistics or stale statistics.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-33C8239F-53A9-4FCB-969B-4772041317AA__GUID-C82CCC7E-7AC7-48E2-87EC-2696C9BC690A">To determine stale statistics:</p>
                        <ol>
                           <li>
                              <p>Start SQL*Plus, and then log in to the database as a user with the necessary privileges.</p>
                           </li>
                           <li>
                              <p>Query the data dictionary for stale statistics.</p>
                              <p>The following example queries stale statistics for the <code class="codeph">sh.sales</code> table (partial output included):
                              </p><pre class="pre codeblock"><code>COL PARTITION_NAME FORMAT a15

SELECT PARTITION_NAME, STALE_STATS
FROM   DBA_TAB_STATISTICS
WHERE  TABLE_NAME = 'SALES'
AND    OWNER = 'SH'
ORDER BY PARTITION_NAME;
 
PARTITION_NAME  STA
--------------- ---
SALES_1995      NO
SALES_1996      NO
SALES_H1_1997   NO
SALES_H2_1997   NO
SALES_Q1_1998   NO
SALES_Q1_1999   NO
.
.
.</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section"></div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-33C8239F-53A9-4FCB-969B-4772041317AA__GUID-53B21D5F-CA63-49DB-AE6C-DEFA96EA1CCC">
                        <p class="notep1">See Also:</p>
                        <p><a href="../refrn/DBA_TAB_MODIFICATIONS.html#REFRN23280" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">DBA_TAB_MODIFICATIONS</code> view
                        </p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" title="As an alternative or supplement to automatic statistics gathering, you can use the DBMS_STATS package to gather optimizer statistics manually.">Gathering Optimizer Statistics Manually</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL427"></a><a id="TGSQL426"></a><div class="props_rev_3"><a id="GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D" name="GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D"></a><h4 id="TGSQL-GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D" class="sect4"><span class="enumeration_section">13.3.4 </span>Gathering Schema and Table Statistics
                  </h4>
                  <div>
                     <p>Use <code class="codeph">GATHER_TABLE_STATS</code> to collect table statistics, and <code class="codeph">GATHER_SCHEMA_STATS</code> to collect statistics for all objects in a schema.
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D__GUID-94399AF6-9D26-4F92-8B88-FF14809495BD">To gather schema statistics using DBMS_STATS:</p>
                        <ol>
                           <li>
                              <p>Start SQL*Plus, and connect to the database with the appropriate privileges for the procedure that you intend to run.</p>
                           </li>
                           <li>
                              <p>Run the <code class="codeph">GATHER_TABLE_STATS</code> or <code class="codeph">GATHER_SCHEMA_STATS</code> procedure, specifying the desired parameters.
                              </p>
                              <p>Typical parameters include:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>Owner - <code class="codeph">ownname</code></p>
                                 </li>
                                 <li>
                                    <p>Object name - <code class="codeph">tabname</code>, <code class="codeph">indname</code>, <code class="codeph">partname</code></p>
                                 </li>
                                 <li>
                                    <p>Degree of parallelism - <code class="codeph">degree</code></p>
                                 </li>
                              </ul>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D__GUID-725BD3D5-B0FC-4258-8EC5-8C2299538142">
                        <p class="titleinexample">Example 13-1 Gathering Statistics for a Table</p>
                        <p>This example uses the <code class="codeph">DBMS_STATS</code> package to gather statistics on the <code class="codeph">sh.customers</code> table with a parallelism setting of <code class="codeph">2</code>.
                        </p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.GATHER_TABLE_STATS (  
    ownname =&gt; 'sh'
,   tabname =&gt; 'customers'
,   degree  =&gt; 2  
);
END;
/</code></pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D__GUID-A41357C0-966D-4D13-8F41-1874DB543A74">
                        <p class="notep1">See Also:</p>
                        <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-CA6A56B9-0540-45E9-B1D7-D78769B7714C" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">GATHER_TABLE_STATS</code> procedure
                        </p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" title="As an alternative or supplement to automatic statistics gathering, you can use the DBMS_STATS package to gather optimizer statistics manually.">Gathering Optimizer Statistics Manually</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL95111"></a><a id="TGSQL95112"></a><a id="TGSQL95110"></a><div class="props_rev_3"><a id="GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212" name="GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212"></a><h4 id="TGSQL-GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212" class="sect4"><span class="enumeration_section">13.3.5 </span>Gathering Statistics for Fixed Objects
                  </h4>
                  <div>
                     <p>Fixed objects are dynamic performance tables and their indexes. These objects record current database activity. </p>
                     <div class="section">
                        <p>Unlike other database tables, the database does not automatically use dynamic statistics for SQL statement referencing <code class="codeph">X$</code> tables when optimizer statistics are missing. Instead, the optimizer uses predefined default values. These defaults may not be representative and could potentially lead to a suboptimal execution plan. Thus, it is important to keep fixed object statistics current.
                        </p>
                        <p>Oracle Database automatically gathers fixed object statistics as part of automated statistics gathering if they have not been previously collected. You can also manually collect statistics on fixed objects by calling <code class="codeph">DBMS_STATS.GATHER_FIXED_OBJECTS_STATS</code>. Oracle recommends that you gather statistics when the database has representative activity. 
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212__GUID-6CEE1F7E-F67D-43DD-BDE7-EB12EC0853A9">Prerequisites</p>
                        <p>You must have the <code class="codeph">SYSDBA</code> or <code class="codeph">ANALYZE ANY DICTIONARY</code> system privilege to execute this procedure.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212__GUID-783092EC-4FA2-4596-AC7E-BEBD2A9A034D">To gather schema statistics using GATHER_FIXED_OBJECTS_STATS:</p>
                        <ol>
                           <li>
                              <p id="GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212__d5e29">In SQL*Plus or SQL Developer, log in to the database as a user with the necessary privileges.</p>
                           </li>
                           <li>
                              <p>Run the <code class="codeph">DBMS_STATS.GATHER_FIXED_OBJECTS_STATS</code> procedure, specifying the desired parameters.
                              </p>
                              <p>Typical parameters include:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>Table identifier describing where to save the current statistics - <code class="codeph">stattab</code></p>
                                 </li>
                                 <li>
                                    <p>Identifier to associate with these statistics within <code class="codeph">stattab</code> (optional) - <code class="codeph">statid</code></p>
                                 </li>
                                 <li>
                                    <p>Schema containing <code class="codeph">stattab</code> (if different from current schema) - <code class="codeph">statown</code></p>
                                 </li>
                              </ul>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212__GUID-7ACCF448-2110-41EB-8CA6-C274DE61F8BB">
                        <p class="titleinexample">Example 13-2 Gathering Statistics for a Table</p>
                        <p>This example uses the <code class="codeph">DBMS_STATS</code> package to gather fixed object statistics.
                        </p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.GATHER_FIXED_OBJECTS_STATS;
END;
/
</code></pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-ADC86F77-3B71-4BB7-986A-2DD283F0E212__GUID-A5A0DC01-E906-4D5C-B87B-95E99AB607E3">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="q">"<a href="gathering-optimizer-statistics.html#GUID-F007E78A-9967-4921-8046-D8F59A9272B4" title="Oracle Database can gather optimizer statistics automatically.">Configuring Automatic Optimizer Statistics Collection</a>"</span></p>
                           </li>
                           <li>
                              <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-CA6A56B9-0540-45E9-B1D7-D78769B7714C" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">GATHER_TABLE_STATS</code> procedure
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" title="As an alternative or supplement to automatic statistics gathering, you can use the DBMS_STATS package to gather optimizer statistics manually.">Gathering Optimizer Statistics Manually</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL94628"></a><a id="TGSQL420"></a><div class="props_rev_3"><a id="GUID-D97EB4EA-DA11-4F19-888A-AAABA7D5FDF5" name="GUID-D97EB4EA-DA11-4F19-888A-AAABA7D5FDF5"></a><h4 id="TGSQL-GUID-D97EB4EA-DA11-4F19-888A-AAABA7D5FDF5" class="sect4"><span class="enumeration_section">13.3.6 </span>Gathering Statistics for Volatile Tables Using Dynamic Statistics
                  </h4>
                  <div>
                     <p>Statistics for volatile tables, which are tables modified significantly during the day, go stale quickly. For example, a table may be deleted or truncated, and then rebuilt.</p>
                     <div class="section">
                        <p>When you set the statistics of a volatile object to null, Oracle Database dynamically gathers the necessary statistics during optimization using dynamic statistics. The <code class="codeph">OPTIMIZER_DYNAMIC_SAMPLING</code> initialization parameter controls this feature.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-D97EB4EA-DA11-4F19-888A-AAABA7D5FDF5__GUID-65EA8679-2ED4-4281-B3B3-EBDD6A4D783E">Assumptions</p>
                        <p>This tutorial assumes the following:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>The <code class="codeph">oe.orders</code> table is extremely volatile.
                              </p>
                           </li>
                           <li>
                              <p>You want to delete and then lock the statistics on the <code class="codeph">orders</code> table to prevent the database from gathering statistics on the table. In this way, the database can dynamically gather necessary statistics as part of query optimization.
                              </p>
                           </li>
                           <li>
                              <p>The <code class="codeph">oe</code> user has the necessary privileges to query <code class="codeph">DBMS_XPLAN.DISPLAY_CURSOR</code>.
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-D97EB4EA-DA11-4F19-888A-AAABA7D5FDF5__GUID-99575B18-40F1-4C2A-B26F-98E21F65333F">To delete and the lock optimizer statistics:</p>
                        <ol>
                           <li>
                              <p>Connect to the database as user <code class="codeph">oe</code>, and then delete the statistics for the <code class="codeph">oe</code> table.
                              </p>
                              <p>For example, execute the following procedure:</p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.DELETE_TABLE_STATS('OE','ORDERS');
END;
/
</code></pre></li>
                           <li>
                              <p>Lock the statistics for the <code class="codeph">oe</code> table.
                              </p>
                              <p>For example, execute the following procedure:</p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.LOCK_TABLE_STATS('OE','ORDERS');
END;
/
</code></pre></li>
                           <li>
                              <p>You query the <code class="codeph">orders</code> table.
                              </p>
                              <p>For example, use the following statement:</p><pre class="pre codeblock"><code>SELECT COUNT(order_id) FROM orders;
</code></pre></li>
                           <li>
                              <p>You query the plan in the cursor.</p>
                              <p>You run the following commands (partial output included):</p><pre class="pre codeblock"><code>SET LINESIZE 150
SET PAGESIZE 0

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY_CURSOR);

SQL_ID  aut9632fr3358, child number 0
-------------------------------------
SELECT COUNT(order_id) FROM orders
 
Plan hash value: 425895392
 
---------------------------------------------------------------------
| Id  | Operation          | Name   | Rows  | Cost (%CPU)| Time     |
---------------------------------------------------------------------
|   0 | SELECT STATEMENT   |        |       |     2 (100)|          |
|   1 |  SORT AGGREGATE    |        |     1 |            |          |
|   2 |   TABLE ACCESS FULL| ORDERS |   105 |     2   (0)| 00:00:01 |
---------------------------------------------------------------------
 
Note
-----
   -<span class="bold"> dynamic statistics used for this statement (level=2)</span>
</code></pre><p>The Note in the preceding execution plan shows that the database used dynamic statistics for the <code class="codeph">SELECT</code> statement.
                              </p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-D97EB4EA-DA11-4F19-888A-AAABA7D5FDF5__GUID-84C8B4AA-A164-4C8C-87B4-904B358ABF92">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="q">"<a href="options-for-optimizer-statistics-gathering.html#GUID-F1C666DC-5450-4F92-83AA-607327DB5FD8" title="Dynamic statistics are an optimization technique in which the database uses recursive SQL to scan a small random sample of the blocks in a table.">Configuring Options for Dynamic Statistics</a>"</span></p>
                           </li>
                           <li>
                              <p><span class="q">"<a href="controlling-the-use-of-optimizer-statistics.html#GUID-1147FF89-68F0-4B0F-831A-A7E5D151D02F" title="You can lock statistics to prevent them from changing.">Locking and Unlocking Optimizer Statistics</a>"</span> to learn how to gather representative statistics and then lock them, which is an alternative technique for preventing statistics for volatile tables from going stale
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" title="As an alternative or supplement to automatic statistics gathering, you can use the DBMS_STATS package to gather optimizer statistics manually.">Gathering Optimizer Statistics Manually</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL428"></a><div class="props_rev_3"><a id="GUID-3D36585C-5850-402E-9DB5-2EE9AAAD8C36" name="GUID-3D36585C-5850-402E-9DB5-2EE9AAAD8C36"></a><h4 id="TGSQL-GUID-3D36585C-5850-402E-9DB5-2EE9AAAD8C36" class="sect4"><span class="enumeration_section">13.3.7 </span>Gathering Optimizer Statistics Concurrently
                  </h4>
                  <div>
                     <p>Oracle Database can gather statistics on multiple tables or partitions concurrently.</p>
                     <p>This section contains the following topics:</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-C5EEE744-8F37-4255-A18E-16B46B78EFA9">About Concurrent Statistics Gathering</a><br>By default, each partition of a partition table is gathered sequentially. 
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-F7874BC5-001C-4F92-B88A-53BFA3804C11">Enabling Concurrent Statistics Gathering</a><br>To enable concurrent statistics gathering, use the <code class="codeph">DBMS_STATS.SET_GLOBAL_PREFS</code> procedure to set the <code class="codeph">CONCURRENT</code> preference. 
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-A6C80B1F-55FD-4427-ADE8-CD7FDC2E7451">Monitoring Statistics Gathering Operations</a><br>You can monitor statistics gathering jobs using data dictionary views.
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" title="As an alternative or supplement to automatic statistics gathering, you can use the DBMS_STATS package to gather optimizer statistics manually.">Gathering Optimizer Statistics Manually</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL429"></a><div class="props_rev_3"><a id="GUID-C5EEE744-8F37-4255-A18E-16B46B78EFA9" name="GUID-C5EEE744-8F37-4255-A18E-16B46B78EFA9"></a><h5 id="TGSQL-GUID-C5EEE744-8F37-4255-A18E-16B46B78EFA9" class="sect5"><span class="enumeration_section">13.3.7.1 </span>About Concurrent Statistics Gathering
                     </h5>
                     <div>
                        <p>By default, each partition of a partition table is gathered sequentially. </p>
                        <p>When <strong class="term">concurrent statistics gathering mode</strong> is enabled, the database can simultaneously gather optimizer statistics for multiple tables in a schema, or multiple partitions or subpartitions in a table. Concurrency can reduce the overall time required to gather statistics by enabling the database to fully use multiple processors.
                        </p>
                        <div class="infoboxnote" id="GUID-C5EEE744-8F37-4255-A18E-16B46B78EFA9__GUID-2CA8B54B-33EC-448D-BEB2-9DAA6D7FFAAF">
                           <p class="notep1">Note:</p>
                           <p>Concurrent statistics gathering mode does not rely on parallel query processing, but is usable with it.</p>
                        </div>
                        <p>This section contains the following topics:</p>
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-859939B3-CCA8-4C20-8985-27FB8E9DCB95">How DBMS_STATS Gathers Statistics Concurrently</a><br>Oracle Database employs multiple tools and technologies to create and manage multiple statistics gathering jobs concurrently.
                           </li>
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-A07045A4-2A62-4233-AF00-BD98641EB224">Concurrent Statistics Gathering and Resource Management</a><br>The <code class="codeph">DBMS_STATS</code> package does not explicitly manage resources used by concurrent statistics gathering jobs that are part of a user-initiated statistics gathering call.
                           </li>
                        </ul>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-3D36585C-5850-402E-9DB5-2EE9AAAD8C36" title="Oracle Database can gather statistics on multiple tables or partitions concurrently.">Gathering Optimizer Statistics Concurrently</a></p>
                           </div>
                        </div>
                     </div>
                     <a id="TGSQL94629"></a><div class="props_rev_3"><a id="GUID-859939B3-CCA8-4C20-8985-27FB8E9DCB95" name="GUID-859939B3-CCA8-4C20-8985-27FB8E9DCB95"></a><h6 id="TGSQL-GUID-859939B3-CCA8-4C20-8985-27FB8E9DCB95" class="sect6"><span class="enumeration_section">13.3.7.1.1 </span>How DBMS_STATS Gathers Statistics Concurrently
                        </h6>
                        <div>
                           <p>Oracle Database employs multiple tools and technologies to create and manage multiple statistics gathering jobs concurrently.</p>
                           <p>The database uses the following:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Oracle Scheduler</p>
                              </li>
                              <li>
                                 <p>Oracle Database Advanced Queuing (AQ)</p>
                              </li>
                              <li>
                                 <p>Oracle Database Resource Manager (the Resource Manager)</p>
                              </li>
                           </ul>
                           <p>Enable concurrent statistics gathering by setting the <code class="codeph">CONCURRENT</code> preference with <code class="codeph">DBMS_STATS.SET_GLOBAL_PREF</code>.
                           </p>
                           <p>The database runs as many concurrent jobs as possible. The Job Scheduler decides how many jobs to execute concurrently and how many to queue. As running jobs complete, the scheduler dequeues and runs more jobs until the database has gathered statistics on all tables, partitions, and subpartitions. The maximum number of jobs is bounded by the <code class="codeph">JOB_QUEUE_PROCESSES</code> initialization parameter and available system resources.
                           </p>
                           <p>In most cases, the <code class="codeph">DBMS_STATS</code> procedures create a separate job for each table partition or subpartition. However, if the partition or subpartition is empty or very small, then the database may automatically batch the object with other small objects into a single job to reduce the overhead of job maintenance.
                           </p>
                           <p>The following figure illustrates the creation of jobs at different levels, where Table 3 is a partitioned table, and the other tables are nonpartitioned. Job 3 acts as a coordinator job for Table 3, and creates a job for each partition in that table, and a separate job for the global statistics of Table 3. This example assumes that incremental statistics gathering is disabled; if enabled, then the database derives global statistics from partition-level statistics after jobs for partitions complete.</p>
                           <div class="figure" id="GUID-859939B3-CCA8-4C20-8985-27FB8E9DCB95__GUID-C4206148-0B55-4801-84F7-8B47C6D102E9">
                              <p class="titleinfigure">Figure 13-1 Concurrent Statistics Gathering Jobs</p><img src="img/tgsql_vm_036.png" alt="Description of Figure 13-1 follows" title="Description of Figure 13-1 follows" longdesc="img_text/tgsql_vm_036.html"><br><a href="img_text/tgsql_vm_036.html">Description of "Figure 13-1 Concurrent Statistics Gathering Jobs"</a></div>
                           <!-- class="figure" -->
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-859939B3-CCA8-4C20-8985-27FB8E9DCB95__GUID-C4B4C6DC-E76A-48D3-8CD3-BB8B9DECBB38">
                              <p class="notep1">See Also:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><span class="q">"<a href="gathering-optimizer-statistics.html#GUID-F7874BC5-001C-4F92-B88A-53BFA3804C11" title="To enable concurrent statistics gathering, use the DBMS_STATS.SET_GLOBAL_PREFS procedure to set the CONCURRENT preference.">Enabling Concurrent Statistics Gathering</a>"</span></p>
                                 </li>
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS059" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_STATS</code> package
                                    </p>
                                 </li>
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=REFRN10077" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">JOB_QUEUE_PROCESSES</code> initialization parameter
                                    </p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-C5EEE744-8F37-4255-A18E-16B46B78EFA9" title="By default, each partition of a partition table is gathered sequentially.">About Concurrent Statistics Gathering</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL94630"></a><div class="props_rev_3"><a id="GUID-A07045A4-2A62-4233-AF00-BD98641EB224" name="GUID-A07045A4-2A62-4233-AF00-BD98641EB224"></a><h6 id="TGSQL-GUID-A07045A4-2A62-4233-AF00-BD98641EB224" class="sect6"><span class="enumeration_section">13.3.7.1.2 </span>Concurrent Statistics Gathering and Resource Management
                        </h6>
                        <div>
                           <p>The <code class="codeph">DBMS_STATS</code> package does not explicitly manage resources used by concurrent statistics gathering jobs that are part of a user-initiated statistics gathering call.
                           </p>
                           <p>Thus, the database may use system resources fully during concurrent statistics gathering. To address this situation, use the Resource Manager to cap resources consumed by concurrent statistics gathering jobs. The Resource Manager must be enabled to gather statistics concurrently.</p>
                           <p>The system-supplied consumer group <code class="codeph">ORA$AUTOTASK</code> registers all statistics gathering jobs. You can create a resource plan with proper resource allocations for <code class="codeph">ORA$AUTOTASK</code> to prevent concurrent statistics gathering from consuming all available resources. If you lack your own resource plan, and if choose not to create one, then consider activating the Resource Manager with the system-supplied <code class="codeph">DEFAULT_PLAN</code>.
                           </p>
                           <div class="infoboxnote" id="GUID-A07045A4-2A62-4233-AF00-BD98641EB224__GUID-E32B7ED8-AE1F-4C73-934C-EC7BF92A53E4">
                              <p class="notep1">Note:</p>
                              <p>The <code class="codeph">ORA$AUTOTASK</code> consumer group is shared with the maintenance tasks that automatically run during the maintenance windows. Thus, when concurrency is activated for automatic statistics gathering, the database automatically manages resources, with no extra steps required.
                              </p>
                           </div>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-A07045A4-2A62-4233-AF00-BD98641EB224__GUID-695BA61B-EEA0-4079-AF51-57CB3585A815">
                              <p class="notep1">See Also:</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ADMIN11841" target="_blank"><span><cite>Oracle Database Administrator’s Guide</cite></span></a> to learn about the Resource Manager
                              </p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-C5EEE744-8F37-4255-A18E-16B46B78EFA9" title="By default, each partition of a partition table is gathered sequentially.">About Concurrent Statistics Gathering</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div><a id="TGSQL431"></a><a id="TGSQL94632"></a><a id="TGSQL430"></a><div class="props_rev_3"><a id="GUID-F7874BC5-001C-4F92-B88A-53BFA3804C11" name="GUID-F7874BC5-001C-4F92-B88A-53BFA3804C11"></a><h5 id="TGSQL-GUID-F7874BC5-001C-4F92-B88A-53BFA3804C11" class="sect5"><span class="enumeration_section">13.3.7.2 </span>Enabling Concurrent Statistics Gathering
                     </h5>
                     <div>
                        <p>To enable concurrent statistics gathering, use the <code class="codeph">DBMS_STATS.SET_GLOBAL_PREFS</code> procedure to set the <code class="codeph">CONCURRENT</code> preference. 
                        </p>
                        <div class="section">
                           <p>Possible values are as follows:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">MANUAL</code></p>
                                 <p>	Concurrency is enabled only for manual statistics gathering.</p>
                              </li>
                              <li>
                                 <p><code class="codeph">AUTOMATIC</code></p>
                                 <p>	Concurrency is enabled only for automatic statistics gathering.</p>
                              </li>
                              <li>
                                 <p><code class="codeph">ALL</code></p>
                                 <p>	Concurrency is enabled for both manual and automatic statistics gathering.</p>
                              </li>
                              <li>
                                 <p><code class="codeph">OFF</code></p>
                                 <p>Concurrency is disabled for both manual and automatic statistics gathering. This is the default value.</p>
                              </li>
                           </ul>
                           <p>This tutorial in this section explains how to enable concurrent statistics gathering.</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-F7874BC5-001C-4F92-B88A-53BFA3804C11__GUID-F8316888-F567-4A76-B673-7FC2845BA570">Prerequisites</p>
                           <p>This tutorial has the following prerequisites:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>In addition to the standard privileges for gathering statistics, you must have the following privileges:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p><code class="codeph">CREATE JOB</code></p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">MANAGE SCHEDULER</code></p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">MANAGE ANY QUEUE</code></p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>The <code class="codeph">SYSAUX</code> tablespace must be online because the scheduler stores its internal tables and views in this tablespace.
                                 </p>
                              </li>
                              <li>
                                 <p>The <code class="codeph">JOB_QUEUE_PROCESSES</code> initialization parameter must be set to at least <code class="codeph">4</code>.
                                 </p>
                              </li>
                              <li>
                                 <p>The Resource Manager must be enabled.</p>
                                 <p>By default, the Resource Manager is disabled. If you do not have a resource plan, then consider enabling the Resource Manager with the system-supplied <code class="codeph">DEFAULT_PLAN</code>.
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-F7874BC5-001C-4F92-B88A-53BFA3804C11__GUID-7B94D593-B0E8-4F0D-8DBF-8AA4518C4C85">Assumptions</p>
                           <p>This tutorial assumes that you want to do the following:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Enable concurrent statistics gathering</p>
                              </li>
                              <li>
                                 <p>Gather statistics for the <code class="codeph">sh</code> schema
                                 </p>
                              </li>
                              <li>
                                 <p>Monitor the gathering of the <code class="codeph">sh</code> statistics
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-F7874BC5-001C-4F92-B88A-53BFA3804C11__GUID-4F36DFA7-CEEF-4DBB-8384-E974589E71FF">To enable concurrent statistics gathering:</p>
                           <ol>
                              <li>
                                 <p>Connect SQL*Plus to the database with the appropriate privileges, and then enable the Resource Manager.</p>
                                 <p>The following example uses the default plan for the Resource Manager:</p><pre class="pre codeblock"><code>ALTER SYSTEM SET RESOURCE_MANAGER_PLAN = 'DEFAULT_PLAN';
</code></pre></li>
                              <li>
                                 <p>Set the <code class="codeph">JOB_QUEUE_PROCESSES</code> initialization parameter to at least twice the number of CPU cores.
                                 </p>
                                 <p>In Oracle Real Application Clusters, the <code class="codeph">JOB_QUEUE_PROCESSES</code> setting applies to each node.
                                 </p>
                                 <p>Assume that the system has 4 CPU cores. The following example sets the parameter to <code class="codeph">8</code> (twice the number of cores):
                                 </p><pre class="pre codeblock"><code>ALTER SYSTEM SET JOB_QUEUE_PROCESSES=8;
</code></pre></li>
                              <li>
                                 <p>Confirm that the parameter change took effect.</p>
                                 <p>For example, enter the following command in SQL*Plus (sample output included):</p><pre class="pre codeblock"><code>SHOW PARAMETER PROCESSES;

NAME                             TYPE        VALUE
-------------------------------- ----------- -----
_high_priority_processes         string      VKTM
aq_tm_processes                  integer     1
db_writer_processes              integer     1
gcs_server_processes             integer     0
global_txn_processes             integer     1
job_queue_processes              integer     8
log_archive_max_processes        integer     4
processes                        integer     100
</code></pre></li>
                              <li>
                                 <p>Enable concurrent statistics.</p>
                                 <p>For example, execute the following PL/SQL anonymous block:</p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.SET_GLOBAL_PREFS('CONCURRENT','ALL');
END;
/
</code></pre></li>
                              <li>
                                 <p>Confirm that the statistics were enabled.</p>
                                 <p>For example, execute the following query (sample output included):</p><pre class="pre codeblock"><code>SELECT DBMS_STATS.GET_PREFS('CONCURRENT') FROM DUAL;

DBMS_STATS.GET_PREFS('CONCURRENT')
----------------------------------
ALL
</code></pre></li>
                              <li>
                                 <p>Gather the statistics for the <code class="codeph">SH</code> schema.
                                 </p>
                                 <p>For example, execute the following procedure:</p><pre class="pre codeblock"><code>EXEC DBMS_STATS.GATHER_SCHEMA_STATS('SH');
</code></pre></li>
                              <li>
                                 <p>In a separate session, monitor the job progress by querying <code class="codeph">DBA_OPTSTAT_OPERATION_TASKS</code>.
                                 </p>
                                 <p>For example, execute the following query (sample output included):</p><pre class="pre codeblock"><code>SET LINESIZE 1000
 
COLUMN TARGET FORMAT a8
COLUMN TARGET_TYPE FORMAT a25
COLUMN JOB_NAME FORMAT a14
COLUMN START_TIME FORMAT a40
 
SELECT TARGET, TARGET_TYPE, JOB_NAME, 
       TO_CHAR(START_TIME, 'dd-mon-yyyy hh24:mi:ss')
FROM   DBA_OPTSTAT_OPERATION_TASKS 
WHERE  STATUS = 'IN PROGRESS' 
AND    OPID = (SELECT MAX(ID) 
               FROM   DBA_OPTSTAT_OPERATIONS 
               WHERE  OPERATION = 'gather_schema_stats');

TARGET    TARGET_TYPE               JOB_NAME       TO_CHAR(START_TIME,'
--------- ------------------------- -------------- --------------------
SH.SALES  TABLE (GLOBAL STATS ONLY) ST$T292_1_B29  30-nov-2012 14:22:47
SH.SALES  TABLE (COORDINATOR JOB)   ST$SD290_1_B10 30-nov-2012 14:22:08
</code></pre></li>
                              <li>
                                 <p>In the original session, disable concurrent statistics gathering.</p>
                                 <p>For example, execute the following query:</p><pre class="pre codeblock"><code>EXEC DBMS_STATS.SET_GLOBAL_PREFS('CONCURRENT','OFF');</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                        <div class="section"></div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-F7874BC5-001C-4F92-B88A-53BFA3804C11__GUID-9AFAD145-71AE-4CD8-92EF-3E6D16EF83FB">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="q">"<a href="gathering-optimizer-statistics.html#GUID-A6C80B1F-55FD-4427-ADE8-CD7FDC2E7451" title="You can monitor statistics gathering jobs using data dictionary views.">Monitoring Statistics Gathering Operations</a>"</span></p>
                              </li>
                              <li>
                                 <p> <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ADMIN11890" target="_blank"><span><cite>Oracle Database Administrator’s Guide</cite></span></a></p>
                              </li>
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS-GUID-A17C466D-1DC0-422E-9E63-063CBAFFBC13" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn how to use the <code class="codeph">DBMS_STATS.SET_GLOBAL_PREFS</code> procedure
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-3D36585C-5850-402E-9DB5-2EE9AAAD8C36" title="Oracle Database can gather statistics on multiple tables or partitions concurrently.">Gathering Optimizer Statistics Concurrently</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL433"></a><div class="props_rev_3"><a id="GUID-A6C80B1F-55FD-4427-ADE8-CD7FDC2E7451" name="GUID-A6C80B1F-55FD-4427-ADE8-CD7FDC2E7451"></a><h5 id="TGSQL-GUID-A6C80B1F-55FD-4427-ADE8-CD7FDC2E7451" class="sect5"><span class="enumeration_section">13.3.7.3 </span>Monitoring Statistics Gathering Operations
                     </h5>
                     <div>
                        <p>You can monitor statistics gathering jobs using data dictionary views.</p>
                        <div class="section">
                           <p>The following views are relevant:</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="../refrn/DBA_OPTSTAT_OPERATION_TASKS.html#REFRN23868" target="_blank"><code class="codeph">DBA_OPTSTAT_OPERATION_TASKS</code></a></p>
                                 <p>This view contains the history of tasks that are performed or currently in progress as part of statistics gathering operations (recorded in <code class="codeph">DBA_OPTSTAT_OPERATIONS</code>). Each task represents a target object to be processed in the corresponding parent operation.
                                 </p>
                              </li>
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=REFRN23463" target="_blank"><code class="codeph">DBA_OPTSTAT_OPERATIONS</code></a></p>
                                 <p>This view contains a history of statistics operations performed or currently in progress at the table, schema, and database level using the <code class="codeph">DBMS_STATS</code> package.
                                 </p>
                              </li>
                           </ul>
                           <p>The <code class="codeph">TARGET</code> column in the preceding views shows the target object for that statistics gathering job in the following form:
                           </p><pre class="pre codeblock"><code>i</code></pre><p>All statistics gathering job names start with the string <code class="codeph">ST$</code>. 
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-A6C80B1F-55FD-4427-ADE8-CD7FDC2E7451__GUID-77440505-DBBE-4CB5-8869-48CD9065CA2F">To display currently running statistics tasks and jobs:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>To list statistics gathering currently running tasks from all user sessions, use the following SQL statement (sample output included):</p><pre class="pre codeblock"><code>SELECT OPID, TARGET, JOB_NAME, 
       (SYSTIMESTAMP - START_TIME) AS elapsed_time
FROM   DBA_OPTSTAT_OPERATION_TASKS
WHERE  STATUS = 'IN PROGRESS';

OPID TARGET                    JOB_NAME      ELAPSED_TIME
---- ------------------------- ------------- --------------------------
 981 SH.SALES.SALES_Q4_1998    ST$T82_1_B29  +000000000 00:00:00.596321
 981 SH.SALES                  ST$SD80_1_B10 +000000000 00:00:27.972033
</code></pre></li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-A6C80B1F-55FD-4427-ADE8-CD7FDC2E7451__GUID-A4683D06-FFAE-42EF-8ED6-1FC336897E1C">To display completed statistics tasks and jobs:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>To list only completed tasks and jobs from a particular operation, first identify the operation ID from the <code class="codeph">DBA_OPTSTAT_OPERATIONS</code> view based on the statistics gathering operation name, target, and start time. After you identify the operation ID, you can query the <code class="codeph">DBA_OPTSTAT_OPERATION_TASKS</code> view to find the corresponding tasks in that operation
                                 </p>
                                 <p>For example, to list operations with the ID 981, use the following commands in SQL*Plus (sample output included):</p><pre class="pre codeblock"><code>VARIABLE id NUMBER
EXEC :id := 981

SELECT TARGET, JOB_NAME, (END_TIME - START_TIME) AS ELAPSED_TIME
FROM   DBA_OPTSTAT_OPERATION_TASKS
WHERE  STATUS &lt;&gt; 'IN PROGRESS'
AND    OPID = :id;

TARGET                    JOB_NAME      ELAPSED_TIME
------------------------- ------------- --------------------------
SH.SALES_TRANSACTIONS_EXT               +000000000 00:00:45.479233
SH.CAL_MONTH_SALES_MV     ST$SD88_1_B10 +000000000 00:00:45.382764 
SH.CHANNELS               ST$SD88_1_B10 +000000000 00:00:45.307397
</code></pre></li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-A6C80B1F-55FD-4427-ADE8-CD7FDC2E7451__GUID-62624B18-45D2-4751-B306-C51A3F64B2EC">To display statistics gathering tasks and jobs that have failed:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Use the following SQL statement (partial sample output included):</p><pre class="pre codeblock"><code>SET LONG 10000

SELECT TARGET, JOB_NAME,
       (END_TIME - START_TIME) AS ELAPSED_TIME, NOTES
FROM   DBA_OPTSTAT_OPERATION_TASKS
WHERE  STATUS = 'FAILED';

TARGET             JOB_NAME ELAPSED_TIME               NOTES
------------------ -------- -------------------------- ----------------------
SYS.OPATCH_XML_INV          +000000007 02:36:31.130314 &lt;error&gt;ORA-20011:
                                                       Approximate NDV failed: 
                                                       ORA-29913: error in
.
.
.
</code></pre></li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-A6C80B1F-55FD-4427-ADE8-CD7FDC2E7451__GUID-4032F5C7-07F1-4ABF-BCF4-185BDBDD9E8E">
                           <p class="notep1">See Also:</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=REFRN23348" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">DBA_SCHEDULER_JOBS</code> view
                           </p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-3D36585C-5850-402E-9DB5-2EE9AAAD8C36" title="Oracle Database can gather statistics on multiple tables or partitions concurrently.">Gathering Optimizer Statistics Concurrently</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="TGSQL413"></a><div class="props_rev_3"><a id="GUID-63E195EB-10F4-428B-9912-3E98C2A957BF" name="GUID-63E195EB-10F4-428B-9912-3E98C2A957BF"></a><h4 id="TGSQL-GUID-63E195EB-10F4-428B-9912-3E98C2A957BF" class="sect4"><span class="enumeration_section">13.3.8 </span>Gathering Incremental Statistics on Partitioned Objects
                  </h4>
                  <div>
                     <p>Incremental statistics scan only changed partitions. When gathering statistics on large partitioned table by deriving global statistics from partition-level statistics, <strong class="term">incremental statistics maintenance</strong> improves performance.
                     </p>
                     <p>This section contains the following topics:</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-7BECE839-ACC5-4768-8BE6-A16AAD14A9ED">Purpose of Incremental Statistics</a><br>In a typical case, an application loads data into a new partition of a range-partitioned table. As applications add new partitions and load data, the database must gather statistics on the new partition and keep global statistics up to date.
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-6ECF96F3-72DD-4B09-974D-70D3FABE6F47">How DBMS_STATS Derives Global Statistics for Partitioned tables</a><br>When incremental statistics maintenance is enabled, <code class="codeph">DBMS_STATS</code> gathers statistics and creates synopses for changed partitions only. The database also automatically merges partition-level synopses into a global synopsis, and derives global statistics from the partition-level statistics and global synopses.
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-766CCB67-3CE7-47D5-83A8-BADFA08DBB60">Gathering Statistics for a Partitioned Table: Basic Steps</a><br>This section explains how to gather optimizer statistics for a partitioned table.
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-4A96081D-97DF-4C26-91E7-C25D18160FA1">Maintaining Incremental Statistics for Partition Maintenance Operations</a><br>A <strong class="term">partition maintenance operation</strong> is a partition-related operation such as adding, exchanging, merging, or splitting table partitions.
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-84FA133B-1F62-48FA-ACD2-203C1BFF4FF5">Maintaining Incremental Statistics for Tables with Stale or Locked Partition Statistics</a><br>Starting in <span>Oracle Database 12c</span>, incremental statistics can automatically calculate global statistics for a partitioned table even if the partition or subpartition statistics are stale and locked.
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" title="As an alternative or supplement to automatic statistics gathering, you can use the DBMS_STATS package to gather optimizer statistics manually.">Gathering Optimizer Statistics Manually</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL95046"></a><div class="props_rev_3"><a id="GUID-7BECE839-ACC5-4768-8BE6-A16AAD14A9ED" name="GUID-7BECE839-ACC5-4768-8BE6-A16AAD14A9ED"></a><h5 id="TGSQL-GUID-7BECE839-ACC5-4768-8BE6-A16AAD14A9ED" class="sect5"><span class="enumeration_section">13.3.8.1 </span>Purpose of Incremental Statistics
                     </h5>
                     <div>
                        <p>In a typical case, an application loads data into a new partition of a range-partitioned table. As applications add new partitions and load data, the database must gather statistics on the new partition and keep global statistics up to date.</p>
                        <p>Typically, data warehouse applications access large partitioned tables. Often these tables are partitioned on date columns, with only the recent partitions subject to frequent DML changes. Without incremental statistics, statistics collection typically uses a two-pass approach: </p>
                        <ol>
                           <li>
                              <p>The database scans the table to gather the global statistics.</p>
                              <p>The full scan of the table for global statistics collection can be very expensive, depending on the size of the table. As the table adds partitions, the longer the execution time for <code class="codeph">GATHER_TABLE_STATS</code> because of the full table scan required for the global statistics. The database must perform the scan of the entire table even if only a small subset of partitions change. 
                              </p>
                           </li>
                           <li>
                              <p>The database scans the changed partitions to gather their partition-level statistics.</p>
                           </li>
                        </ol>
                        <p>Incremental maintenance provides a huge performance benefit for data warehouse applications because of the following:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>The database must scan the table only once to gather partition statistics and to derive the global statistics by aggregating partition-level statistics. Thus, the database avoids the <span class="italic">two</span> full scans that are required when not using incremental statistics: one scan for the partition-level statistics, and one scan for the global-level statistics.
                              </p>
                           </li>
                           <li>
                              <p>In subsequent statistics gathering, the database only needs to scan the stale partitions and update their statistics (including synopses). The database can derive global statistics from the fresh partition statistics, which saves a full table scan.</p>
                           </li>
                        </ul>
                        <p>When using incremental statistics, the database must still gather statistics on any partition that will change the global or table-level statistics. Incremental statistics maintenance yields the same statistics as gathering table statistics from scratch, but performs better.</p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-63E195EB-10F4-428B-9912-3E98C2A957BF" title="Incremental statistics scan only changed partitions. When gathering statistics on large partitioned table by deriving global statistics from partition-level statistics, incremental statistics maintenance improves performance.">Gathering Incremental Statistics on Partitioned Objects</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL95048"></a><a id="TGSQL95047"></a><div class="props_rev_3"><a id="GUID-6ECF96F3-72DD-4B09-974D-70D3FABE6F47" name="GUID-6ECF96F3-72DD-4B09-974D-70D3FABE6F47"></a><h5 id="TGSQL-GUID-6ECF96F3-72DD-4B09-974D-70D3FABE6F47" class="sect5"><span class="enumeration_section">13.3.8.2 </span>How DBMS_STATS Derives Global Statistics for Partitioned tables
                     </h5>
                     <div>
                        <p>When incremental statistics maintenance is enabled, <code class="codeph">DBMS_STATS</code> gathers statistics and creates synopses for changed partitions only. The database also automatically merges partition-level synopses into a global synopsis, and derives global statistics from the partition-level statistics and global synopses.
                        </p>
                        <p>The database avoids a full table scan when computing global statistics by deriving some global statistics from the partition-level statistics. For example, the number of rows at the global level is the sum of number of rows of partitions. Even global histograms can be derived from partition histograms.</p>
                        <p>However, the database cannot derive <span class="italic">all</span> statistics from partition-level statistics, including the <a href="glossary.html#GUID-34DC46FD-32CE-4242-8ED9-945AE7A9F922"><span class="xrefglossterm">NDV</span></a> of a column. The following example shows the NDV for two partitions in a table:
                        </p>
                        <div class="tblformal" id="GUID-6ECF96F3-72DD-4B09-974D-70D3FABE6F47__GUID-4DADA3A8-7FC7-4346-A485-EB92D03F5271">
                           <p class="titleintable">Table 13-3 NDV for Two Partitions</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="NDV for Two Partitions" summary="This 3 column table provides a DV example. Column 1 is the object. Column 2 lists the column values. Column 3 is the NDV. " width="100%" frame="hsides" border="1" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="20%" id="d74756e5741">Object</th>
                                    <th align="left" valign="bottom" width="20%" id="d74756e5743">Column Values</th>
                                    <th align="left" valign="bottom" width="20%" id="d74756e5745">NDV</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d74756e5749" headers="d74756e5741 ">Partition 1</td>
                                    <td align="left" valign="top" width="20%" headers="d74756e5749 d74756e5743 ">1,3,3,4,5</td>
                                    <td align="left" valign="top" width="20%" headers="d74756e5749 d74756e5745 ">4</td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d74756e5756" headers="d74756e5741 ">Partition 2</td>
                                    <td align="left" valign="top" width="20%" headers="d74756e5756 d74756e5743 ">2,3,4,5,6</td>
                                    <td align="left" valign="top" width="20%" headers="d74756e5756 d74756e5745 ">5</td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>Calculating the NDV in the table by adding the NDV of the individual partitions produces an NDV of 9, which is incorrect. Thus, a more accurate technique is required: synopses.</p>
                        <p>This section contains the following topics:</p>
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-F2454C04-A250-444E-AB7B-0B9ED6F2E2B2">Partition-Level Synopses</a><br>A <span class="bold">synopsis</span> is special type of statistic that tracks the number of distinct values (NDV) for each column in a partition. You can consider a synopsis as an internal management structure that samples distinct values.
                           </li>
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-EA02EA33-9E0E-4E32-8C74-5943908D0537">NDV Algorithms: Adaptive Sampling and HyperLogLog</a><br>Starting in <span>Oracle Database 12c</span> Release 2 (12.2), the HyperLogLog algorithm can improve NDV (number of distinct values) calculation performance, and also reduce the storage space required for synopses.
                           </li>
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-D134B7F3-0EC2-4A03-8998-0286B9FF7A29">Aggregation of Global Statistics Using Synopses: Example</a><br>In this example, the database gathers statistics for the initial six partitions of the <code class="codeph">sales</code> table, and then creates synopses for each partition (<code class="codeph">S1</code>, <code class="codeph">S2</code>, and so on). The database creates global statistics by aggregating the partition-level statistics and synopses.
                           </li>
                        </ul>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-63E195EB-10F4-428B-9912-3E98C2A957BF" title="Incremental statistics scan only changed partitions. When gathering statistics on large partitioned table by deriving global statistics from partition-level statistics, incremental statistics maintenance improves performance.">Gathering Incremental Statistics on Partitioned Objects</a></p>
                           </div>
                        </div>
                     </div>
                     
                     <div class="sect5"><a id="GUID-F2454C04-A250-444E-AB7B-0B9ED6F2E2B2" name="GUID-F2454C04-A250-444E-AB7B-0B9ED6F2E2B2"></a><h6 id="TGSQL-GUID-F2454C04-A250-444E-AB7B-0B9ED6F2E2B2" class="sect6"><span class="enumeration_section">13.3.8.2.1 </span>Partition-Level Synopses
                        </h6>
                        <div>
                           <p>A <span class="bold">synopsis</span> is special type of statistic that tracks the number of distinct values (NDV) for each column in a partition. You can consider a synopsis as an internal management structure that samples distinct values.
                           </p>
                           <p>The database can accurately derive the global-level NDV for each column by merging partition-level synopses. In the example shown in <a href="gathering-optimizer-statistics.html#GUID-6ECF96F3-72DD-4B09-974D-70D3FABE6F47__GUID-4DADA3A8-7FC7-4346-A485-EB92D03F5271" title="This 3 column table provides a DV example. Column 1 is the object. Column 2 lists the column values. Column 3 is the NDV.">Table 13-3</a>, the database can use synopses to calculate the NDV for the column as 6.
                           </p>
                           <p>Each partition maintains a synopsis in incremental mode. When a new partition is added to the table you only need to gather statistics for the new partition. The database automatically updates the global statistics by aggregating the new partition synopsis with the synopses for existing partitions. Subsequent statistics gathering operations are faster than when synopses are not used.</p>
                           <p>The database stores synopses in data dictionary tables <code class="codeph">WRI$_OPTSTAT_SYNOPSIS_HEAD$</code> and <code class="codeph">WRI$_OPTSTAT_SYNOPSIS$</code> in the <code class="codeph">SYSAUX</code> tablespace. The <code class="codeph">DBA_PART_COL_STATISTICS</code> dictionary view contains information of the column statistics in partitions. If the <code class="codeph">NOTES</code> column contains the keyword <code class="codeph">INCREMENTAL</code>, then this column has synopses.
                           </p>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-F2454C04-A250-444E-AB7B-0B9ED6F2E2B2__GUID-C7BF3FA1-20D3-4EB0-AD35-44CCEF22FAA3">
                              <p class="notep1">See Also:</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=GUID-151E541C-C4D8-4F61-BD49-248E82D252BE" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn more about <code class="codeph">DBA_PART_COL_STATISTICS</code></p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-6ECF96F3-72DD-4B09-974D-70D3FABE6F47" title="When incremental statistics maintenance is enabled, DBMS_STATS gathers statistics and creates synopses for changed partitions only. The database also automatically merges partition-level synopses into a global synopsis, and derives global statistics from the partition-level statistics and global synopses.">How DBMS_STATS Derives Global Statistics for Partitioned tables</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-EA02EA33-9E0E-4E32-8C74-5943908D0537" name="GUID-EA02EA33-9E0E-4E32-8C74-5943908D0537"></a><h6 id="TGSQL-GUID-EA02EA33-9E0E-4E32-8C74-5943908D0537" class="sect6"><span class="enumeration_section">13.3.8.2.2 </span>NDV Algorithms: Adaptive Sampling and HyperLogLog
                        </h6>
                        <div>
                           <p>Starting in <span>Oracle Database 12c</span> Release 2 (12.2), the HyperLogLog algorithm can improve NDV (number of distinct values) calculation performance, and also reduce the storage space required for synopses.
                           </p>
                           <p>The legacy algorithm for calculating NDV uses <strong class="term">adaptive sampling</strong>. A synopsis is a sample of the distinct values. When calculating the NDV, the database initially stores every distinct value in a hash table. Each distinct value occupies a distinct hash bucket, so a column with 5000 distinct values has 5000 hash buckets. The database then halves the number of hash buckets, and then continues to halve the result until a small number of buckets remain. The algorithm is “adaptive” because the sampling rate changes based on the number of hash table splits.
                           </p>
                           <p>To calculate the NDV for the column, the database uses the following formula, where <span class="italic">B</span> is the number of hash buckets remaining after all the splits have been performed, and <span class="italic">S</span> is the number of splits:
                           </p><pre class="pre codeblock"><code>NDV = B * 2^S</code></pre><p>Adaptive sampling produces accurate NDV statistics, but has the following consequences:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Synopses occupy significant disk space, especially when tables have many columns and partitions, and the NDV in each column is high.</p>
                                 <p>For example, a 60-column table might have 300,000 partitions, with an average per-column NDV of 5,000. In this example, each partition has 300,000 entries (60 x 5000). In total, the synopses tables have 90 billion entries (300,000 squared), which occupies at least 720 GB of storage space.</p>
                              </li>
                              <li>
                                 <p>Bulk processing of synopses can negatively affect performance. </p>
                                 <p>Before the database regathers statistics on the stale partitions, it must delete the associated synopses. Bulk deletion can be slow because it generates significant amounts of undo and redo data.</p>
                              </li>
                           </ul>
                           <p>In contrast to dynamic sampling, the HyperLogLog algorithm uses a randomization technique. Although the algorithm is complex, the foundational insight is that in a stream of random values, <span class="italic">n</span> distinct values will be spaced on average 1/<span class="italic">n</span> apart. Therefore, if you know the smallest value in the stream, then you can roughly estimate the number of distinct values. For example, if the values range from 0 to 1, and if the smallest value observed is .2, then the numbers will on average be evenly spaced .2 apart, so the NDV estimate is 5.
                           </p>
                           <p>The HyperLogLog algorithm expands on and corrects the original estimate. The database applies a hash function to every column value, resulting in a set of hash values with the same cardinality as the column. For the base estimate, the NDV equals 2<sup>n</sup>, where <span class="italic">n</span> is the maximum number of trailing zeroes observed in the binary representation of the hash values. The database refines its NDV estimate by using part of the output to split values into different hash buckets.
                           </p>
                           <p>The advantages of the HyperLogLog algorithm over adaptive sampling are:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The accuracy of the new algorithm is similar to the original algorithm.</p>
                              </li>
                              <li>
                                 <p>The memory required is <span class="italic">significantly</span> lower, which typically leads to huge reductions in synopsis size.
                                 </p>
                                 <p>Synopses can become large when many partitions exist, and they have many columns with high NDV. Synopses that use the HyperLogLog algorithm are more compact. Creating and deleting synopses affects batch run times. Any operational procedures that manage partitions reduce run time.</p>
                              </li>
                           </ul>
                           <p>The <code class="codeph">DBMS_STATS</code> preference <code class="codeph">APPROXIMATE_NDV_ALGORITHM</code> determines which algorithm the database uses for NDV calculation.
                           </p>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-EA02EA33-9E0E-4E32-8C74-5943908D0537__GUID-7B79EEA5-D76A-4D82-A896-316F78E188F2">
                              <p class="notep1">See Also:</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=GUID-2C00FE80-1553-404C-85B6-220895561FE8" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">APPROXIMATE_NDV_ALGORITHM</code> preference
                              </p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-6ECF96F3-72DD-4B09-974D-70D3FABE6F47" title="When incremental statistics maintenance is enabled, DBMS_STATS gathers statistics and creates synopses for changed partitions only. The database also automatically merges partition-level synopses into a global synopsis, and derives global statistics from the partition-level statistics and global synopses.">How DBMS_STATS Derives Global Statistics for Partitioned tables</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-D134B7F3-0EC2-4A03-8998-0286B9FF7A29" name="GUID-D134B7F3-0EC2-4A03-8998-0286B9FF7A29"></a><h6 id="TGSQL-GUID-D134B7F3-0EC2-4A03-8998-0286B9FF7A29" class="sect6"><span class="enumeration_section">13.3.8.2.3 </span>Aggregation of Global Statistics Using Synopses: Example
                        </h6>
                        <div>
                           <p>In this example, the database gathers statistics for the initial six partitions of the <code class="codeph">sales</code> table, and then creates synopses for each partition (<code class="codeph">S1</code>, <code class="codeph">S2</code>, and so on). The database creates global statistics by aggregating the partition-level statistics and synopses.
                           </p>
                           <div class="figure" id="GUID-D134B7F3-0EC2-4A03-8998-0286B9FF7A29__GUID-A6A99CAC-C075-4CE9-B313-0D0B701FB31E">
                              <p class="titleinfigure">Figure 13-2 Aggregating Statistics</p><img src="img/tgsql_vm_074.png" alt="Description of Figure 13-2 follows" title="Description of Figure 13-2 follows" longdesc="img_text/tgsql_vm_074.html"><br><a href="img_text/tgsql_vm_074.html">Description of "Figure 13-2 Aggregating Statistics"</a></div>
                           <!-- class="figure" -->
                           <p>The following graphic shows a new partition, containing data for May 24, being added to the <code class="codeph">sales</code> table. The database gathers statistics for the newly added partition, retrieves synopses for the other partitions, and then aggregates the synopses to create global statistics.
                           </p>
                           <div class="figure" id="GUID-D134B7F3-0EC2-4A03-8998-0286B9FF7A29__GUID-56238B04-687D-4951-AD6D-6BE9E3C93E7B">
                              <p class="titleinfigure">Figure 13-3 Aggregating Statistics after Adding a Partition</p><img src="img/tgsql_vm_075.png" alt="Description of Figure 13-3 follows" title="Description of Figure 13-3 follows" longdesc="img_text/tgsql_vm_075.html"><br><a href="img_text/tgsql_vm_075.html">Description of "Figure 13-3 Aggregating Statistics after Adding a Partition"</a></div>
                           <!-- class="figure" -->
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-6ECF96F3-72DD-4B09-974D-70D3FABE6F47" title="When incremental statistics maintenance is enabled, DBMS_STATS gathers statistics and creates synopses for changed partitions only. The database also automatically merges partition-level synopses into a global synopsis, and derives global statistics from the partition-level statistics and global synopses.">How DBMS_STATS Derives Global Statistics for Partitioned tables</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-766CCB67-3CE7-47D5-83A8-BADFA08DBB60" name="GUID-766CCB67-3CE7-47D5-83A8-BADFA08DBB60"></a><h5 id="TGSQL-GUID-766CCB67-3CE7-47D5-83A8-BADFA08DBB60" class="sect5"><span class="enumeration_section">13.3.8.3 </span>Gathering Statistics for a Partitioned Table: Basic Steps
                     </h5>
                     <div>
                        <p>This section explains how to gather optimizer statistics for a partitioned table.</p>
                        <p>This section contains the following topics:</p>
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-C4BFFEEB-28D2-420C-A864-305C4334183B">Considerations for Incremental Statistics Maintenance</a><br>Enabling incremental statistics maintenance has several consequences.
                           </li>
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-75AD8460-A5F6-43B1-ADE0-4AD77AF72274">Enabling Incremental Statistics Using SET_TABLE_PREFS</a><br>To enable incremental statistics maintenance for a partitioned table, use <code class="codeph">DBMS_STATS.SET_TABLE_PREFS</code> to set the <code class="codeph">INCREMENTAL</code> value to <code class="codeph">true</code>. When <code class="codeph">INCREMENTAL</code> is set to <code class="codeph">false</code>, which is the default, the database uses a full table scan to maintain global statistics.
                           </li>
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-813375EE-1F69-4083-A4CF-C52CBD6F9D4C">About the APPROXIMATE_NDV_ALGORITHM Settings</a><br>The <code class="codeph">DBMS_STATS.APPROXIMATE_NDV_ALGORITHM</code> preference specifies the synopsis generation algorithm, either HyperLogLog or adaptive sampling. The <code class="codeph">INCREMENTAL_STALENESS</code> preference controls when the database reformats synopses that use the adaptive sampling format.
                           </li>
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-61C14F44-2893-44B4-8300-E5A6C262DE58">Configuring Synopsis Generation: Examples</a><br>These examples show different approaches, both conservative and aggressive, to switching synopses to the new HyperLogLog format.
                           </li>
                        </ul>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-63E195EB-10F4-428B-9912-3E98C2A957BF" title="Incremental statistics scan only changed partitions. When gathering statistics on large partitioned table by deriving global statistics from partition-level statistics, incremental statistics maintenance improves performance.">Gathering Incremental Statistics on Partitioned Objects</a></p>
                           </div>
                        </div>
                     </div>
                     <a id="TGSQL95049"></a><div class="props_rev_3"><a id="GUID-C4BFFEEB-28D2-420C-A864-305C4334183B" name="GUID-C4BFFEEB-28D2-420C-A864-305C4334183B"></a><h6 id="TGSQL-GUID-C4BFFEEB-28D2-420C-A864-305C4334183B" class="sect6"><span class="enumeration_section">13.3.8.3.1 </span>Considerations for Incremental Statistics Maintenance
                        </h6>
                        <div>
                           <p>Enabling incremental statistics maintenance has several consequences.</p>
                           <p>Specifically, note the following:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>If a table uses composite partitioning, then the database only gathers statistics for modified subpartitions. The database does not gather statistics at the subpartition level for unmodified subpartitions. In this way, the database reduces work by skipping unmodified partitions.</p>
                              </li>
                              <li>
                                 <p>If a table uses incremental statistics, and if this table has a locally partitioned index, then the database gathers index statistics at the global level and for modified (not unmodified) index partitions. The database does not generate global index statistics from the partition-level index statistics. Rather, the database gathers global index statistics by performing a full index scan.</p>
                              </li>
                              <li>
                                 <p>A <a href="glossary.html#GUID-9BAA7917-D479-4DCF-85B2-5B4BE0F891EE"><span class="xrefglossterm">hybrid partitioned table</span></a> contains both internal and external partitions. For internal partitions only, DDL changes invoke incremental statistic maintenance on individual partitions and on the table itself. For example, if <code class="codeph">june18</code> is an internal partition, then <code class="codeph">ALTER TABLE ... MODIFY PARTITION jun18 ...</code> triggers incremental statistics maintenance during statistics collection; if <code class="codeph">june18</code> is an external partition, however, then incremental maintenance does not occur.
                                 </p>
                              </li>
                              <li>
                                 <p>The <code class="codeph">SYSAUX</code> tablespace consumes additional space to maintain global statistics for partitioned tables.
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-C4BFFEEB-28D2-420C-A864-305C4334183B__GUID-A03902F0-BB84-4990-8955-FCDA34986679">
                              <p class="notep1">See Also:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=GUID-09CFA3CD-66B7-4CDF-A086-6958D113BDD1" target="_blank"><span><cite>Oracle Database VLDB and Partitioning Guide</cite></span></a> to learn how to create hybrid partitioned tables
                                    </p>
                                 </li>
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=GUID-01FAB8ED-E4A3-4C3E-8FE2-88717DCDDA06" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about <code class="codeph">DBMS_STATS</code></p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-766CCB67-3CE7-47D5-83A8-BADFA08DBB60" title="This section explains how to gather optimizer statistics for a partitioned table.">Gathering Statistics for a Partitioned Table: Basic Steps</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-75AD8460-A5F6-43B1-ADE0-4AD77AF72274" name="GUID-75AD8460-A5F6-43B1-ADE0-4AD77AF72274"></a><h6 id="TGSQL-GUID-75AD8460-A5F6-43B1-ADE0-4AD77AF72274" class="sect6"><span class="enumeration_section">13.3.8.3.2 </span>Enabling Incremental Statistics Using SET_TABLE_PREFS
                        </h6>
                        <div>
                           <p>To enable incremental statistics maintenance for a partitioned table, use <code class="codeph">DBMS_STATS.SET_TABLE_PREFS</code> to set the <code class="codeph">INCREMENTAL</code> value to <code class="codeph">true</code>. When <code class="codeph">INCREMENTAL</code> is set to <code class="codeph">false</code>, which is the default, the database uses a full table scan to maintain global statistics.
                           </p>
                           <div class="p">For the database to update global statistics incrementally by scanning <span class="italic">only</span> the partitions that have changed, the following conditions must be met:
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>The <code class="codeph">PUBLISH</code> value for the partitioned table is <code class="codeph">true</code>. 
                                    </p>
                                 </li>
                                 <li>
                                    <p>The <code class="codeph">INCREMENTAL</code> value for the partitioned table is <code class="codeph">true</code>.
                                    </p>
                                 </li>
                                 <li>
                                    <p>The statistics gathering procedure must specify <code class="codeph">AUTO_SAMPLE_SIZE</code> for <code class="codeph">ESTIMATE_PERCENT</code> and <code class="codeph">AUTO</code> for <code class="codeph">GRANULARITY</code>.
                                    </p>
                                 </li>
                              </ul>
                           </div>
                           <!-- class="section" -->
                           <div class="example" id="GUID-75AD8460-A5F6-43B1-ADE0-4AD77AF72274__GUID-0360CF84-1EBC-4060-8E18-D8D5663E85F5">
                              <p class="titleinexample">Example 13-3 Enabling Incremental Statistics</p>
                              <p>Assume that the <code class="codeph">PUBLISH</code> value for the partitioned table <code class="codeph">sh.sales</code> is <code class="codeph">true</code>. The following program enables incremental statistics for this table:
                              </p><pre class="pre codeblock"><code>EXEC DBMS_STATS.SET_TABLE_PREFS('sh', 'sales', 'INCREMENTAL', 'TRUE');
</code></pre></div>
                           <!-- class="example" -->
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-766CCB67-3CE7-47D5-83A8-BADFA08DBB60" title="This section explains how to gather optimizer statistics for a partitioned table.">Gathering Statistics for a Partitioned Table: Basic Steps</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-813375EE-1F69-4083-A4CF-C52CBD6F9D4C" name="GUID-813375EE-1F69-4083-A4CF-C52CBD6F9D4C"></a><h6 id="TGSQL-GUID-813375EE-1F69-4083-A4CF-C52CBD6F9D4C" class="sect6"><span class="enumeration_section">13.3.8.3.3 </span>About the APPROXIMATE_NDV_ALGORITHM Settings
                        </h6>
                        <div>
                           <p>The <code class="codeph">DBMS_STATS.APPROXIMATE_NDV_ALGORITHM</code> preference specifies the synopsis generation algorithm, either HyperLogLog or adaptive sampling. The <code class="codeph">INCREMENTAL_STALENESS</code> preference controls when the database reformats synopses that use the adaptive sampling format.
                           </p>
                           <div class="section">The <code class="codeph">APPROXIMATE_NDV_ALGORITHM</code> preference has the following possible values:
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><code class="codeph">REPEAT OR HYPERLOGLOG</code></p>
                                    <p>This is the default. If <code class="codeph">INCREMENTAL</code> is enabled on the table, then the database preserves the format of any existing synopses that use the adaptive sampling algorithm. However, the database creates any new synopses in HyperLogLog format. This approach is attractive when existing performance is acceptable, and you do not want to incur the performance cost of reformatting legacy content.
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">ADAPTIVE SAMPLING</code></p>
                                    <p>The database uses the adaptive sampling algorithm for all synopses. This is the most conservative option.</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">HYPERLOGLOG</code></p>
                                    <p>The database uses the HyperLogLog algorithm for all new and stale synopses.</p>
                                 </li>
                              </ul>
                              <p>The <code class="codeph">INCREMENTAL_STALENESS</code> preference controls when a synopsis is considered stale. When the <code class="codeph">APPROXIMATE_NDV_ALGORITHM</code> preference is set to <code class="codeph">HYPERLOGLOG</code>, then the following <code class="codeph">INCREMENTAL_STALENESS</code> settings apply:
                              </p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><code class="codeph">ALLOW_MIXED_FORMAT</code></p>
                                    <p>This is the default. If this value is specified, and if the following conditions are met, then the database does <span class="italic">not</span> consider existing adaptive sampling synopses as stale:
                                    </p>
                                    <ul style="list-style-type: disc;">
                                       <li>
                                          <p>The synopses are fresh.</p>
                                       </li>
                                       <li>
                                          <p>You gather statistics manually.</p>
                                       </li>
                                    </ul>
                                    <p>Thus, synopses in both the legacy and HyperLogLog formats can co-exist. However, over time the automatic statistics gathering job regathers statistics on synopses that use the old format, and replaces them with synopses in HyperLogLog format. In this way, the automatic statistics gather job gradually phases out the old format. Manual statistics gathering jobs do not reformat synopses that use the adaptive sampling format.</p>
                                 </li>
                                 <li>
                                    <p>Null</p>
                                    <p>Any partitions with the synopses in the legacy format are considered stale, which <span class="italic">immediately</span> triggers the database to regather statistics for stale synopses. The advantage is that the performance cost occurs only once. The disadvantage is that regathering all statistics on large tables can be resource-intensive.
                                    </p>
                                 </li>
                              </ul>
                           </div>
                           <!-- class="section" -->
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-766CCB67-3CE7-47D5-83A8-BADFA08DBB60" title="This section explains how to gather optimizer statistics for a partitioned table.">Gathering Statistics for a Partitioned Table: Basic Steps</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-61C14F44-2893-44B4-8300-E5A6C262DE58" name="GUID-61C14F44-2893-44B4-8300-E5A6C262DE58"></a><h6 id="TGSQL-GUID-61C14F44-2893-44B4-8300-E5A6C262DE58" class="sect6"><span class="enumeration_section">13.3.8.3.4 </span>Configuring Synopsis Generation: Examples
                        </h6>
                        <div>
                           <p>These examples show different approaches, both conservative and aggressive, to switching synopses to the new HyperLogLog format.</p>
                           <div class="example" id="GUID-61C14F44-2893-44B4-8300-E5A6C262DE58__GUID-D70A1148-229D-4E40-ADF3-C9FB8D5C3053">
                              <p class="titleinexample">Example 13-4 Taking a Conservative Approach to Reformatting Synopses</p>
                              <p>In this example, you allow synopses in mixed formats to coexist for the <code class="codeph">sh.sales</code> table. Mixed formats yield less accurate statistics. However, you do <span class="italic">not</span> need to regather statistics for all partitions of the table. 
                              </p>
                              <p>To ensure that all new and stale synopses use the HyperLogLog algorithm, set the <code class="codeph">APPROXIMATE_NDV_ALGORITHM</code> preference to <code class="codeph">HYPERLOGLOG</code>. To ensure that the automatic statistics gathering job reformats stale synopses gradually over time, set the <code class="codeph">INCREMENTAL_STALENESS</code> preference to <code class="codeph">ALLOW_MIXED_FORMAT</code>.
                              </p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.SET_TABLE_PREFS
    (   ownname =&gt; 'sh'
    ,   tabname =&gt; 'sales'
    ,   pname   =&gt; 'approximate_ndv_algorithm'
    ,   pvalue  =&gt; 'hyperloglog' );

  DBMS_STATS.SET_TABLE_PREFS
    (  ownname  =&gt; 'sh'
    ,  tabname  =&gt; 'sales'
    ,  pname    =&gt; 'incremental_staleness'
    ,  pvalue   =&gt; 'allow_mixed_format' );
END;
</code></pre></div>
                           <!-- class="example" -->
                           <div class="example" id="GUID-61C14F44-2893-44B4-8300-E5A6C262DE58__TAKINGANAGGRESSIVEAPPROACHTOREFORMA-012B5571">
                              <p class="titleinexample">Example 13-5 Taking an Aggressive Approach to Reformatting Synopses</p>
                              <p>In this example, you force all synopses to use the HyperLogLog algorithm for the <code class="codeph">sh.sales</code> table. In this case, the database must regather statistics for all partitions of the table.
                              </p>
                              <p>To ensure that all new and stale synopses use the HyperLogLog algorithm, set the <code class="codeph">APPROXIMATE_NDV_ALGORITHM</code> preference to <code class="codeph">HYPERLOGLOG</code>. To force the database to immediately regather statistics for all partitions in the table and store them in the new format, set the <code class="codeph">INCREMENTAL_STALENESS</code> preference to null.
                              </p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.SET_TABLE_PREFS
    (   ownname =&gt; 'sh'
    ,   tabname =&gt; 'sales'
    ,   pname   =&gt; 'approximate_ndv_algorithm'
    ,   pvalue  =&gt; 'hyperloglog' );

  DBMS_STATS.SET_TABLE_PREFS
    (  ownname  =&gt; 'sh'
    ,  tabname  =&gt; 'sales'
    ,  pname    =&gt; 'incremental_staleness'
    ,  pvalue   =&gt; 'null' );
END;</code></pre></div>
                           <!-- class="example" -->
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-766CCB67-3CE7-47D5-83A8-BADFA08DBB60" title="This section explains how to gather optimizer statistics for a partitioned table.">Gathering Statistics for a Partitioned Table: Basic Steps</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div><a id="TGSQL94920"></a><a id="TGSQL94860"></a><div class="props_rev_3"><a id="GUID-4A96081D-97DF-4C26-91E7-C25D18160FA1" name="GUID-4A96081D-97DF-4C26-91E7-C25D18160FA1"></a><h5 id="TGSQL-GUID-4A96081D-97DF-4C26-91E7-C25D18160FA1" class="sect5"><span class="enumeration_section">13.3.8.4 </span>Maintaining Incremental Statistics for Partition Maintenance Operations
                     </h5>
                     <div>
                        <p>A <strong class="term">partition maintenance operation</strong> is a partition-related operation such as adding, exchanging, merging, or splitting table partitions.
                        </p>
                        <div class="section">
                           <p>Oracle Database provides the following support for incremental statistics maintenance:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>If a partition maintenance operation triggers statistics gathering, then the database can reuse synopses that would previously have been dropped with the old segments.</p>
                              </li>
                              <li>
                                 <p><code class="codeph">DBMS_STATS</code> can create a synopsis on a nonpartitioned table. The synopsis enables the database to maintain incremental statistics as part of a partition exchange operation without having to explicitly gather statistics on the partition after the exchange.
                                 </p>
                              </li>
                           </ul>
                           <p>When the <code class="codeph">DBMS_STATS</code> preference <code class="codeph">INCREMENTAL</code> is set to <code class="codeph">true</code> on a table, the <code class="codeph">INCREMENTAL_LEVEL</code> preference controls which synopses are collected and when. This preference takes the following values:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">TABLE</code></p>
                                 <p><code class="codeph">DBMS_STATS</code> gathers table-level synopses on this table. You can only set <code class="codeph">INCREMENTAL_LEVEL</code> to <code class="codeph">TABLE</code> at the table level, not at the schema, database, or global level. 
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">PARTITION</code> (default)
                                 </p>
                                 <p><code class="codeph">DBMS_STATS</code> only gathers synopsis at the partition level of partitioned tables.
                                 </p>
                              </li>
                           </ul>
                           <p>When performing a partition exchange, to have synopses after the exchange for the partition being exchanged, set <code class="codeph">INCREMENTAL</code> to <code class="codeph">true</code> and <code class="codeph">INCREMENTAL_LEVEL</code> to <code class="codeph">TABLE</code> on the table to be exchanged with the partition.
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-4A96081D-97DF-4C26-91E7-C25D18160FA1__GUID-30D53601-0CFE-4FEF-A5F8-D41AA20B328F">Assumptions</p>
                           <p>This tutorial assumes the following:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>You want to load empty partition <code class="codeph">p_sales_01_2010</code> in a <code class="codeph">sales</code> table.
                                 </p>
                              </li>
                              <li>
                                 <p>You create a staging table <code class="codeph">t_sales_01_2010</code>, and then populate the table.
                                 </p>
                              </li>
                              <li>
                                 <p>You want the database to maintain incremental statistics as part of the partition exchange operation without having to explicitly gather statistics on the partition after the exchange.</p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-4A96081D-97DF-4C26-91E7-C25D18160FA1__GUID-AC04DA87-C0D0-435F-B171-B4FC399C9CE7">To maintain incremental statistics as part of a partition exchange operation:</p>
                           <ol>
                              <li>
                                 <p>Set incremental statistics preferences for staging table <code class="codeph">t_sales_01_2010</code>.
                                 </p>
                                 <p>For example, run the following statement:</p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.SET_TABLE_PREFS (   
      ownname  =&gt;  'sh'
,     tabname  =&gt;  't_sales_01_2010'
,     pname    =&gt;  'INCREMENTAL'
,     pvalue   =&gt;  'true'
); 
  DBMS_STATS.SET_TABLE_PREFS (  
      ownname  =&gt;  'sh'
,     tabname  =&gt;  't_sales_01_2010'
,     pname    =&gt;  'INCREMENTAL_LEVEL'
,     pvalue   =&gt;  'table'
);
END;
</code></pre></li>
                              <li>
                                 <p>Gather statistics on staging table <code class="codeph">t_sales_01_2010</code>.
                                 </p>
                                 <p>For example, run the following PL/SQL code:</p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.GATHER_TABLE_STATS ( 
      ownname  =&gt; 'SH'
,     tabname  =&gt; 'T_SALES_01_2010'
);
END;
/
</code></pre><p><code class="codeph">DBMS_STATS</code> gathers table-level synopses on <code class="codeph">t_sales_01_2010</code>.
                                 </p>
                              </li>
                              <li>
                                 <p>Ensure that the <code class="codeph">INCREMENTAL</code> preference is <code class="codeph">true</code> on the <code class="codeph">sh.sales</code> table.
                                 </p>
                                 <p>For example, run the following PL/SQL code:</p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.SET_TABLE_PREFS (
      ownname  =&gt;  'sh'
,     tabname  =&gt;  'sales'
,     pname    =&gt;  'INCREMENTAL'
,     pvalue   =&gt;  'true'
);
END;
/
</code></pre></li>
                              <li>
                                 <p>If you have never gathered statistics on <code class="codeph">sh.sales</code> before with <code class="codeph">INCREMENTAL</code> set to <code class="codeph">true</code>, then gather statistics on the partition to be exchanged.
                                 </p>
                                 <p>For example, run the following PL/SQL code: </p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.GATHER_TABLE_STATS (
      ownname  =&gt;  'sh'
,     tabname  =&gt;  'sales'
,     pname    =&gt;  'p_sales_01_2010'
,     pvalue   =&gt;  granularity=&gt;'partition'
);
END;
/
</code></pre></li>
                              <li>
                                 <p>Perform the partition exchange.</p>
                                 <p>For example, use the following SQL statement:</p><pre class="pre codeblock"><code>ALTER TABLE sales EXCHANGE PARTITION p_sales_01_2010 WITH TABLE t_sales_01_2010;
</code></pre><p>After the exchange, the partitioned table has both statistics and a synopsis for partition <code class="codeph">p_sales_01_2010</code>. 
                                 </p>
                                 <p>In releases before <span>Oracle Database 12c</span>, the preceding statement swapped the segment data and statistics of <code class="codeph">p_sales_01_2010</code> with <code class="codeph">t_sales_01_2010</code>. The database did not maintain synopses for nonpartitioned tables such as <code class="codeph">t_sales_01_2010</code>. To gather global statistics on the partitioned table, you needed to rescan the <code class="codeph">p_sales_01_2010</code> partition to obtain its synopses.
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-4A96081D-97DF-4C26-91E7-C25D18160FA1__GUID-7C45B371-5427-4ABA-8F1D-D9ECE840EFC2">
                           <p class="notep1">See Also:</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS-GUID-CDAA4742-5398-4A64-B871-E39F38D0021F" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about <code class="codeph">DBMS_STATS.SET_TABLE_PREFS</code></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-63E195EB-10F4-428B-9912-3E98C2A957BF" title="Incremental statistics scan only changed partitions. When gathering statistics on large partitioned table by deriving global statistics from partition-level statistics, incremental statistics maintenance improves performance.">Gathering Incremental Statistics on Partitioned Objects</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL94921"></a><a id="TGSQL94863"></a><div class="props_rev_3"><a id="GUID-84FA133B-1F62-48FA-ACD2-203C1BFF4FF5" name="GUID-84FA133B-1F62-48FA-ACD2-203C1BFF4FF5"></a><h5 id="TGSQL-GUID-84FA133B-1F62-48FA-ACD2-203C1BFF4FF5" class="sect5"><span class="enumeration_section">13.3.8.5 </span>Maintaining Incremental Statistics for Tables with Stale or Locked Partition Statistics
                     </h5>
                     <div>
                        <p>Starting in <span>Oracle Database 12c</span>, incremental statistics can automatically calculate global statistics for a partitioned table even if the partition or subpartition statistics are stale and locked.
                        </p>
                        <div class="section">
                           <p>When incremental statistics are enabled in releases before <span>Oracle Database 12c</span>, if any DML occurs on a partition, then the optimizer considers statistics on this partition to be stale. Thus, <code class="codeph">DBMS_STATS</code> must gather the statistics again to accurately aggregate the global statistics. Furthermore, if DML occurs on a partition whose statistics are locked, then <code class="codeph">DBMS_STATS</code> cannot regather the statistics on the partition, so a full table scan is the only means of gathering global statistics. Regathering statistics creates performance overhead.
                           </p>
                           <p>In <span>Oracle Database 12c</span>, the statistics preference <code class="codeph">INCREMENTAL_STALENESS</code> controls how the database determines whether the statistics on a partition or subpartition are stale. This preference takes the following values:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">USE_STALE_PERCENT</code></p>
                                 <p>A partition or subpartition is not considered stale if DML changes are less than the <code class="codeph">STALE_PERCENT</code> preference specified for the table. The default value of <code class="codeph">STALE_PERCENT</code> is <code class="codeph">10</code>, which means that if DML causes more than 10% of row changes, then the table is considered stale.
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">USE_LOCKED_STATS</code></p>
                                 <p>Locked partition or subpartition statistics are not considered stale, regardless of DML changes.</p>
                              </li>
                              <li>
                                 <p><code class="codeph">NULL</code> (default)
                                 </p>
                                 <p>A partition or subpartition is considered stale if it has any DML changes. This behavior is identical to the <span>Oracle Database 11g</span> behavior. When the default value is used, statistics gathered in incremental mode are guaranteed to be the same as statistics gathered in nonincremental mode. When a nondefault value is used, statistics gathered in incremental mode might be less accurate than those gathered in nonincremental mode.
                                 </p>
                              </li>
                           </ul>
                           <p>You can specify <code class="codeph">USE_STALE_PERCENT</code> and <code class="codeph">USE_LOCKED_STATS</code> together. For example, you can write the following anonymous block:
                           </p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.SET_TABLE_PREFS (
    ownname     =&gt; null
,   table_name  =&gt; 't'
,   pname       =&gt; 'incremental_staleness'
,   pvalue      =&gt; 'use_stale_percent,use_locked_stats'
);
END;</code></pre></div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-84FA133B-1F62-48FA-ACD2-203C1BFF4FF5__GUID-02FEC71F-B906-4468-803D-E06A24CB6090">Assumptions</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>This tutorial assumes the following:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The <code class="codeph">STALE_PERCENT</code> for a partitioned table is set to <code class="codeph">10</code>.
                                 </p>
                              </li>
                              <li>
                                 <p>The <code class="codeph">INCREMENTAL</code> value is set to <code class="codeph">true</code>.
                                 </p>
                              </li>
                              <li>
                                 <p>The table has had statistics gathered in <code class="codeph">INCREMENTAL</code> mode before.
                                 </p>
                              </li>
                              <li>
                                 <p>You want to discover how statistics gathering changes depending on the setting for <code class="codeph">INCREMENTAL_STALENESS</code>, whether the statistics are locked, and the percentage of DML changes.
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-84FA133B-1F62-48FA-ACD2-203C1BFF4FF5__GUID-ACB47378-90CD-470B-9C70-00C6809AE893">To test for tables with stale or locked partition statistics:</p>
                           <ol>
                              <li>
                                 <p>Set <code class="codeph">INCREMENTAL_STALENESS</code> to <code class="codeph">NULL</code>. 
                                 </p>
                                 <p>Afterward, 5% of the rows in one partition change because of DML activity. </p>
                              </li>
                              <li>
                                 <p>Use <code class="codeph">DBMS_STATS</code> to gather statistics on the table.
                                 </p>
                                 <p><code class="codeph">DBMS_STATS</code> regathers statistics for the partition that had the 5% DML activity, and incrementally maintains the global statistics.
                                 </p>
                              </li>
                              <li>
                                 <p>Set <code class="codeph">INCREMENTAL_STALENESS</code> to <code class="codeph">USE_STALE_PERCENT</code>.
                                 </p>
                                 <p>Afterward, 5% of the rows in one partition change because of DML activity. </p>
                              </li>
                              <li>
                                 <p>Use <code class="codeph">DBMS_STATS</code> to gather statistics on the table.
                                 </p>
                                 <p> <code class="codeph">DBMS_STATS</code> does <span class="italic">not</span> regather statistics for the partition that had DML activity (because the changes are under the staleness threshold of 10%), and incrementally maintains the global statistics.
                                 </p>
                              </li>
                              <li>
                                 <p>Lock the partition statistics.</p>
                                 <p>Afterward, 20% of the rows in one partition change because of DML activity.</p>
                              </li>
                              <li>
                                 <p>Use <code class="codeph">DBMS_STATS</code> to gather statistics on the table.
                                 </p>
                                 <p><code class="codeph">DBMS_STATS</code> does <span class="italic">not</span> regather statistics for the partition because the statistics are locked. The database gathers the global statistics with a full table scan.
                                 </p>
                                 <p>Afterward, 5% of the rows in one partition change because of DML activity.</p>
                              </li>
                              <li>
                                 <p>Use <code class="codeph">DBMS_STATS</code> to gather statistics on the table.
                                 </p>
                                 <p>When you gather statistics on this table, <code class="codeph">DBMS_STATS</code> does not regather statistics for the partition because they are not considered stale. The database maintains global statistics incrementally using the existing statistics for this partition.
                                 </p>
                              </li>
                              <li>
                                 <p>Set <code class="codeph">INCREMENTAL_STALENESS</code> to <code class="codeph">USE_LOCKED_STATS</code> and <code class="codeph">USE_STALE_PERCENT</code>.
                                 </p>
                                 <p>Afterward, 20% of the rows in one partition change because of DML activity.</p>
                              </li>
                              <li>
                                 <p>Use <code class="codeph">DBMS_STATS</code> to gather statistics on the table.
                                 </p>
                                 <p>Because <code class="codeph">USE_LOCKED_STATS</code> is set, <code class="codeph">DBMS_STATS</code> ignores the fact that the statistics are stale and uses the locked statistics. The database maintains global statistics incrementally using the existing statistics for this partition.
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-84FA133B-1F62-48FA-ACD2-203C1BFF4FF5__GUID-017C8070-4B8D-4790-9CDA-FAC24E409940">
                           <p class="notep1">See Also:</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS-GUID-CDAA4742-5398-4A64-B871-E39F38D0021F" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about <code class="codeph">DBMS_STATS.SET_TABLE_PREFS</code></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-63E195EB-10F4-428B-9912-3E98C2A957BF" title="Incremental statistics scan only changed partitions. When gathering statistics on large partitioned table by deriving global statistics from partition-level statistics, incremental statistics maintenance improves performance.">Gathering Incremental Statistics on Partitioned Objects</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
            </div><a id="TGSQL434"></a><div class="props_rev_3"><a id="GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31" name="GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31"></a><h3 id="TGSQL-GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31" class="sect3"><span class="enumeration_section">13.4 </span>Gathering System Statistics Manually
               </h3>
               <div>
                  <p>System statistics describe hardware characteristics, such as I/O and CPU performance and utilization, to the optimizer.</p>
                  <p>This section contains the following topics:</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-69E0AEFD-5C03-4EB6-B3CC-CD07153759E6">About System Statistics</a><br>System statistics measure the performance of CPU and storage so that the optimizer can use these inputs when evaluating plans.
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-BABC67C0-F851-4849-906E-E2588CFD7F2B">Guidelines for Gathering System Statistics</a><br>Unless there is a good reason to gather manually, Oracle recommends using the defaults for system statistics.
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-E5731E8E-3382-4E6A-9986-2508721631E3">Gathering System Statistics with DBMS_STATS</a><br>To gather system statistics manually, use the <code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code> procedure.
                     </li>
                     <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-C4F0B12B-2C9E-4050-B647-F7DC451D7878">Deleting System Statistics</a><br>The <code class="codeph">DBMS_STATS.DELETE_SYSTEM_STATS</code> procedure deletes system statistics.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-245F23B2-24AF-44D8-9F12-99FD1215E878" title="This chapter explains how to use the DBMS_STATS.GATHER_*_STATS program units.">Gathering Optimizer Statistics</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-69E0AEFD-5C03-4EB6-B3CC-CD07153759E6" name="GUID-69E0AEFD-5C03-4EB6-B3CC-CD07153759E6"></a><h4 id="TGSQL-GUID-69E0AEFD-5C03-4EB6-B3CC-CD07153759E6" class="sect4"><span class="enumeration_section">13.4.1 </span>About System Statistics
                  </h4>
                  <div>
                     <p>System statistics measure the performance of CPU and storage so that the optimizer can use these inputs when evaluating plans.</p>
                     <p>When a query executes, it consumes CPU. In many cases, a query also consumes storage subsystem resources. Each plan in a typical query may consume a different proportion of CPU and I/O. Using the <a href="glossary.html#GUID-7FCF0F80-65B5-4F76-A521-91ABD109DA17"><span class="xrefglossterm">cost</span></a> metric, the optimizer chooses the plan that it estimates will execute most quickly. If the optimizer knows the speed of CPU and storage, then it can make finer judgments about the cost of each alternative plan.
                     </p>
                     <p>The following figure shows a query that has three possible plans. Each plan uses different amounts of CPU and I/O. For the sake of this example, the optimizer has assigned Plan 1 the lowest cost.</p>
                     <div class="figure" id="GUID-69E0AEFD-5C03-4EB6-B3CC-CD07153759E6__GUID-06A60BA0-9CC5-4748-8D81-323C232D1CCC"><img src="img/mm-3242_tgsql_pb_001b.png" alt="Description of mm-3242_tgsql_pb_001b.eps follows" title="Description of mm-3242_tgsql_pb_001b.eps follows" longdesc="img_text/mm-3242_tgsql_pb_001b.html"><br><a href="img_text/mm-3242_tgsql_pb_001b.html">Description of the illustration mm-3242_tgsql_pb_001b.eps</a></div>
                     <!-- class="figure" -->
                     <p>The database automatically gathers essential system statistics, called noworkload statistics, at the first instance startup. Typically, these characteristics only change when some aspect of the hardware configuration is upgraded.</p>
                     <p>The following figure shows the same database after adding high-performance storage. Gathering system statistics enables the optimizer to take the storage performance into account. In this example, the high-performance storage lowers the relative cost of Plan 2 and Plan 3 significantly. Plan 1 shows only marginal improvement because it uses less I/O. Plan 3 has now been assigned the lowest cost.</p>
                     <div class="figure" id="GUID-69E0AEFD-5C03-4EB6-B3CC-CD07153759E6__GUID-16307460-B1B9-43D9-8C03-4D482775D117"><img src="img/mm-3242_tgsql_pb_002b.png" alt="Description of mm-3242_tgsql_pb_002b.eps follows" title="Description of mm-3242_tgsql_pb_002b.eps follows" longdesc="img_text/mm-3242_tgsql_pb_002b.html"><br><a href="img_text/mm-3242_tgsql_pb_002b.html">Description of the illustration mm-3242_tgsql_pb_002b.eps</a></div>
                     <!-- class="figure" -->
                     <p>On systems with fast I/O infrastructure, system statistics increase the probability that queries choose table scans over index access methods.</p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31" title="System statistics describe hardware characteristics, such as I/O and CPU performance and utilization, to the optimizer.">Gathering System Statistics Manually</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL436"></a><div class="props_rev_3"><a id="GUID-BABC67C0-F851-4849-906E-E2588CFD7F2B" name="GUID-BABC67C0-F851-4849-906E-E2588CFD7F2B"></a><h4 id="TGSQL-GUID-BABC67C0-F851-4849-906E-E2588CFD7F2B" class="sect4"><span class="enumeration_section">13.4.2 </span>Guidelines for Gathering System Statistics
                  </h4>
                  <div>
                     <p>Unless there is a good reason to gather manually, Oracle recommends using the defaults for system statistics.</p>
                     <div class="section">
                        <p>System statistics are important for performance because they affect <span class="italic">every</span> SQL statement executed in the database. Changing system statistics may change SQL execution plans, perhaps in unexpected or unwanted ways. For this reason, Oracle recommends considering the options carefully before changing system statistics.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-BABC67C0-F851-4849-906E-E2588CFD7F2B__GUID-E6162C47-EC8F-4C5A-A6DF-C146E76884EC">When to Consider Gathering System Statistics Manually</p>
                        <p>If you are using Oracle Exadata, and if the database is running a pure data warehouse load, then gathering system statistics using the <code class="codeph">EXADATA</code> option can help performance in some cases because table scans are more strongly favored. However, even on Exadata, the defaults are best for most workloads.
                        </p>
                        <p>If you are not using Oracle Exadata, and if you choose to gather system statistics manually, then Oracle recommends the following:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Gather system statistics when a physical change occurs in your environment, for example, the server gets faster CPUs, more memory, or different disk storage. Oracle recommends that you gather noworkload statistics after you create new tablespaces on storage that is not used by any other tablespace.</p>
                           </li>
                           <li>
                              <p>Capture statistics when the system has the most common workload. Gathering workload statistics does not generate additional overhead.</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-BABC67C0-F851-4849-906E-E2588CFD7F2B__GUID-8A588E7D-9018-42F8-B976-22FE2984A869">When to Consider Using Default Statistics</p>
                        <p>Oracle recommends using the defaults for system statistics in most cases. To reset system statistics to their default values, execute <code class="codeph">DBMS_STATS.DELETE_SYSTEM_STATS</code>, and then shut down and reopen the database. To ensure that appropriate defaults are used, this step is also recommended on a newly created database.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31" title="System statistics describe hardware characteristics, such as I/O and CPU performance and utilization, to the optimizer.">Gathering System Statistics Manually</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-E5731E8E-3382-4E6A-9986-2508721631E3" name="GUID-E5731E8E-3382-4E6A-9986-2508721631E3"></a><h4 id="TGSQL-GUID-E5731E8E-3382-4E6A-9986-2508721631E3" class="sect4"><span class="enumeration_section">13.4.3 </span>Gathering System Statistics with DBMS_STATS
                  </h4>
                  <div>
                     <p>To gather system statistics manually, use the <code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code> procedure.
                     </p>
                     <p>This section contains the following topics:</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-08CA67A6-5634-4C67-BA3A-6DB812682B23">About the GATHER_SYSTEM_STATS Procedure</a><br>The <code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code> procedure analyzes activity in a specified time period (<strong class="term">workload statistics</strong>) or simulates a workload (<strong class="term">noworkload statistics</strong>).
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-46A36510-4BAF-43B8-8C65-B1B2D6B17916">Gathering Workload Statistics</a><br>Oracle recommends that you use <code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code> to capture statistics when the database has the most typical workload. 
                        </li>
                        <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-4E99C958-71B0-4DC4-BF2A-33244BEFE46D">Gathering Noworkload Statistics</a><br>Noworkload statistics capture characteristics of the I/O system. 
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31" title="System statistics describe hardware characteristics, such as I/O and CPU performance and utilization, to the optimizer.">Gathering System Statistics Manually</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL435"></a><a id="TGSQL94865"></a><div class="props_rev_3"><a id="GUID-08CA67A6-5634-4C67-BA3A-6DB812682B23" name="GUID-08CA67A6-5634-4C67-BA3A-6DB812682B23"></a><h5 id="TGSQL-GUID-08CA67A6-5634-4C67-BA3A-6DB812682B23" class="sect5"><span class="enumeration_section">13.4.3.1 </span>About the GATHER_SYSTEM_STATS Procedure
                     </h5>
                     <div>
                        <p>The <code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code> procedure analyzes activity in a specified time period (<strong class="term">workload statistics</strong>) or simulates a workload (<strong class="term">noworkload statistics</strong>).
                        </p>
                        <p>The input arguments to <code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code> are:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">NOWORKLOAD</code></p>
                              <p>The optimizer gathers statistics based on system characteristics only, without regard to the workload.</p>
                           </li>
                           <li>
                              <p><code class="codeph">INTERVAL</code></p>
                              <p>After the specified number of minutes has passed, the optimizer updates system statistics either in the data dictionary, or in an alternative table (specified by <code class="codeph">stattab</code>). Statistics are based on system activity during the specified interval.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">START</code> and <code class="codeph">STOP</code></p>
                              <p><code class="codeph">START</code> initiates gathering statistics. <code class="codeph">STOP</code> calculates statistics for the elapsed period (since <code class="codeph">START</code>) and refreshes the data dictionary or an alternative table (specified by <code class="codeph">stattab</code>). The optimizer ignores <code class="codeph">INTERVAL</code>.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">EXADATA</code></p>
                              <p>The system statistics consider the unique capabilities provided by using Exadata, such as large I/O size and high I/O throughput. The optimizer sets the multiblock read count and I/O throughput statistics along with CPU speed.</p>
                           </li>
                        </ul>
                        <p>The following table lists the optimizer system statistics gathered by <code class="codeph">DBMS_STATS</code> and the options for gathering or manually setting specific system statistics.
                        </p>
                        <div class="tblformalwide" id="GUID-08CA67A6-5634-4C67-BA3A-6DB812682B23__CHDJHGGG">
                           <p class="titleintable">Table 13-4 Optimizer System Statistics in the DBMS_STATS Package</p>
                           <table cellpadding="4" cellspacing="0" class="FormalWide" title="Optimizer System Statistics in the DBMS_STATS Package" summary="This table describes the optimizer system statistics gathered by the DBMS_STATS package and explains when and how the statistics can be gathered." width="100%" frame="hsides" border="1" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="20%" id="d74756e8683">Parameter Name</th>
                                    <th align="left" valign="bottom" width="20%" id="d74756e8686">Description</th>
                                    <th align="left" valign="bottom" width="20%" id="d74756e8689">Initialization</th>
                                    <th align="left" valign="bottom" width="20%" id="d74756e8692">Options for Gathering or Setting Statistics</th>
                                    <th align="left" valign="bottom" width="20%" id="d74756e8695">Unit</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d74756e8700" headers="d74756e8683 ">
                                       <p><code class="codeph">cpuspeedNW</code></p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8700 d74756e8686 ">
                                       <p>Represents noworkload CPU speed. CPU speed is the average number of CPU cycles in each second.</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8700 d74756e8689 ">
                                       <p>At system startup</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8700 d74756e8692 ">
                                       <p>Set <code class="codeph">gathering_mode</code> = <code class="codeph">NOWORKLOAD</code> or set statistics manually.
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8700 d74756e8695 ">
                                       <p>millions/s</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d74756e8723" headers="d74756e8683 ">
                                       <p><code class="codeph">ioseektim</code></p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8723 d74756e8686 ">
                                       <p>Represents the time it takes to position the disk head to read data. I/O seek time equals seek time + latency time + operating system overhead time.</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8723 d74756e8689 ">
                                       <p>At system startup</p>
                                       <p>10 (default)</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8723 d74756e8692 ">
                                       <p>Set <code class="codeph">gathering_mode</code> = <code class="codeph">NOWORKLOAD</code> or set statistics manually.
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8723 d74756e8695 ">
                                       <p>ms</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d74756e8748" headers="d74756e8683 ">
                                       <p><code class="codeph">iotfrspeed</code></p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8748 d74756e8686 ">
                                       <p>Represents the rate at which an Oracle database can read data in the single read request.</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8748 d74756e8689 ">
                                       <p>At system startup</p>
                                       <p>4096 (default)</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8748 d74756e8692 ">
                                       <p>Set <code class="codeph">gathering_mode</code> = <code class="codeph">NOWORKLOAD</code> or set statistics manually.
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8748 d74756e8695 ">
                                       <p>bytes/ms</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d74756e8773" headers="d74756e8683 ">
                                       <p><code class="codeph">cpuspeed</code></p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8773 d74756e8686 ">
                                       <p>Represents workload CPU speed. CPU speed is the average number of CPU cycles in each second.</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8773 d74756e8689 ">
                                       <p>None</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8773 d74756e8692 ">
                                       <p>Set <code class="codeph">gathering_mode</code> = <code class="codeph">NOWORKLOAD</code>, <code class="codeph">INTERVAL</code>, or <code class="codeph">START|STOP</code>, or set statistics manually.
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8773 d74756e8695 ">
                                       <p>millions/s</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d74756e8802" headers="d74756e8683 ">
                                       <p><code class="codeph">maxthr</code></p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8802 d74756e8686 ">
                                       <p>Maximum I/O throughput is the maximum throughput that the I/O subsystem can deliver.</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8802 d74756e8689 ">
                                       <p>None</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8802 d74756e8692 ">
                                       <p>Set <code class="codeph">gathering_mode</code> = <code class="codeph">NOWORKLOAD</code>, <code class="codeph">INTERVAL</code>, or <code class="codeph">START|STOP</code>, or set statistics manually.
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8802 d74756e8695 ">
                                       <p>bytes/s</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d74756e8831" headers="d74756e8683 ">
                                       <p><code class="codeph">slavethr</code></p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8831 d74756e8686 ">
                                       <p>Slave I/O throughput is the average parallel execution server I/O throughput. </p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8831 d74756e8689 ">
                                       <p>None</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8831 d74756e8692 ">
                                       <p>Set <code class="codeph">gathering_mode</code> = <code class="codeph">INTERVAL</code> or <code class="codeph">START|STOP</code>, or set statistics manually.
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8831 d74756e8695 ">
                                       <p>bytes/s</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d74756e8857" headers="d74756e8683 ">
                                       <p><code class="codeph">sreadtim</code></p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8857 d74756e8686 ">
                                       <p>Single-block read time is the average time to read a single block randomly.</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8857 d74756e8689 ">
                                       <p>None</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8857 d74756e8692 ">
                                       <p>Set <code class="codeph">gathering_mode</code> = <code class="codeph">INTERVAL</code> or <code class="codeph">START|STOP</code>, or set statistics manually.
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8857 d74756e8695 ">
                                       <p>ms</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d74756e8883" headers="d74756e8683 ">
                                       <p><code class="codeph">mreadtim</code></p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8883 d74756e8686 ">
                                       <p>Multiblock read is the average time to read a multiblock sequentially.</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8883 d74756e8689 ">
                                       <p>None</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8883 d74756e8692 ">
                                       <p>Set <code class="codeph">gathering_mode</code> = <code class="codeph">INTERVAL</code> or <code class="codeph">START|STOP</code>, or set statistics manually.
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8883 d74756e8695 ">
                                       <p>ms</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d74756e8909" headers="d74756e8683 ">
                                       <p><code class="codeph">mbrc</code></p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8909 d74756e8686 ">
                                       <p>Multiblock count is the average multiblock read count sequentially.</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8909 d74756e8689 ">
                                       <p>None</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8909 d74756e8692 ">
                                       <p>Set <code class="codeph">gathering_mode</code> = <code class="codeph">INTERVAL</code> or <code class="codeph">START|STOP</code>, or set statistics manually.
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d74756e8909 d74756e8695 ">
                                       <p>blocks</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-08CA67A6-5634-4C67-BA3A-6DB812682B23__GUID-C33BC8C2-333A-4EF9-AB7E-E27AE65270F0">
                           <p class="notep1">See Also:</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS059" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for detailed information on the procedures in the <code class="codeph">DBMS_STATS</code> package for gathering and deleting system statistics
                           </p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-E5731E8E-3382-4E6A-9986-2508721631E3" title="To gather system statistics manually, use the DBMS_STATS.GATHER_SYSTEM_STATS procedure.">Gathering System Statistics with DBMS_STATS</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL437"></a><div class="props_rev_3"><a id="GUID-46A36510-4BAF-43B8-8C65-B1B2D6B17916" name="GUID-46A36510-4BAF-43B8-8C65-B1B2D6B17916"></a><h5 id="TGSQL-GUID-46A36510-4BAF-43B8-8C65-B1B2D6B17916" class="sect5"><span class="enumeration_section">13.4.3.2 </span>Gathering Workload Statistics
                     </h5>
                     <div>
                        <p>Oracle recommends that you use <code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code> to capture statistics when the database has the most typical workload. 
                        </p>
                        <p>For example, database applications can process OLTP transactions during the day and generate OLAP reports at night.</p>
                        <p>This section contains the following topics:</p>
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-FB1B9F70-C417-4CC5-8F46-1ECDE2326D66">About Workload Statistics</a><br>Workload statistics analyze activity in a specified time period.
                           </li>
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-90149651-4244-483C-93AF-D73387B0AF6F">Starting and Stopping System Statistics Gathering</a><br>This tutorial explains how to set the workload interval with the <code class="codeph">START</code> and <code class="codeph">STOP</code> parameters of <code class="codeph">GATHER_SYSTEM_STATS</code>.
                           </li>
                           <li class="ulchildlink"><a href="gathering-optimizer-statistics.html#GUID-3E84E773-1D87-46E8-8592-3B5E3CAC2712">Gathering System Statistics During a Specified Interval</a><br>This tutorial explains how to set the workload interval with the <code class="codeph">INTERVAL</code> parameter of <code class="codeph">GATHER_SYSTEM_STATS</code>.
                           </li>
                        </ul>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-E5731E8E-3382-4E6A-9986-2508721631E3" title="To gather system statistics manually, use the DBMS_STATS.GATHER_SYSTEM_STATS procedure.">Gathering System Statistics with DBMS_STATS</a></p>
                           </div>
                        </div>
                     </div>
                     <a id="TGSQL439"></a><a id="TGSQL438"></a><div class="props_rev_3"><a id="GUID-FB1B9F70-C417-4CC5-8F46-1ECDE2326D66" name="GUID-FB1B9F70-C417-4CC5-8F46-1ECDE2326D66"></a><h6 id="TGSQL-GUID-FB1B9F70-C417-4CC5-8F46-1ECDE2326D66" class="sect6"><span class="enumeration_section">13.4.3.2.1 </span>About Workload Statistics
                        </h6>
                        <div>
                           <p>Workload statistics analyze activity in a specified time period.</p>
                           <p>Workload statistics include the following statistics listed in <a href="gathering-optimizer-statistics.html#GUID-08CA67A6-5634-4C67-BA3A-6DB812682B23__CHDJHGGG" title="This table describes the optimizer system statistics gathered by the DBMS_STATS package and explains when and how the statistics can be gathered.">Table 13-4</a>:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Single block (<code class="codeph">sreadtim</code>) and multiblock (<code class="codeph">mreadtim</code>) read times
                                 </p>
                              </li>
                              <li>
                                 <p>Multiblock count (<code class="codeph">mbrc</code>)
                                 </p>
                              </li>
                              <li>
                                 <p>CPU speed (<code class="codeph">cpuspeed</code>)
                                 </p>
                              </li>
                              <li>
                                 <p>Maximum system throughput (<code class="codeph">maxthr</code>)
                                 </p>
                              </li>
                              <li>
                                 <p>Average parallel execution throughput (<code class="codeph">slavethr</code>)
                                 </p>
                              </li>
                           </ul>
                           <p>The database computes <code class="codeph">sreadtim</code>, <code class="codeph">mreadtim</code>, and <code class="codeph">mbrc</code> by comparing the number of physical sequential and random reads between two points in time from the beginning to the end of a workload. The database implements these values through counters that change when the buffer cache completes synchronous read requests.
                           </p>
                           <p>Because the counters are in the buffer cache, they include not only I/O delays, but also waits related to latch contention and task switching. Thus, workload statistics depend on system activity during the workload window. If system is I/O bound (both latch contention and I/O throughput), then the statistics promote a less I/O-intensive plan after the database uses the statistics.</p>
                           <p>As shown in <a href="gathering-optimizer-statistics.html#GUID-FB1B9F70-C417-4CC5-8F46-1ECDE2326D66__CHDIGAIC">Figure 13-4</a>, if you gather workload statistics, then the optimizer uses the <code class="codeph">mbrc</code> value gathered for workload statistics to estimate the cost of a full table scan.
                           </p>
                           <div class="figure" id="GUID-FB1B9F70-C417-4CC5-8F46-1ECDE2326D66__CHDIGAIC">
                              <p class="titleinfigure">Figure 13-4 Workload Statistics Counters</p><img src="img/tgsql_vm_019.png" alt="Description of Figure 13-4 follows" title="Description of Figure 13-4 follows" longdesc="img_text/tgsql_vm_019.html"><br><a href="img_text/tgsql_vm_019.html">Description of "Figure 13-4 Workload Statistics Counters"</a></div>
                           <!-- class="figure" -->
                           <p>When gathering workload statistics, the database may not gather the <code class="codeph">mbrc</code> and <code class="codeph">mreadtim</code> values if no table scans occur during serial workloads, as is typical of OLTP systems. However, full table scans occur frequently on DSS systems. These scans may run parallel and bypass the buffer cache. In such cases, the database still gathers the <code class="codeph">sreadtim</code> because index lookups use the buffer cache.
                           </p>
                           <p>If the database cannot gather or validate gathered <code class="codeph">mbrc</code> or <code class="codeph">mreadtim</code> values, but has gathered <code class="codeph">sreadtim</code> and <code class="codeph">cpuspeed</code>, then the database uses only <code class="codeph">sreadtim</code> and <code class="codeph">cpuspeed</code> for costing. In this case, the optimizer uses the value of the initialization parameter <code class="codeph">DB_FILE_MULTIBLOCK_READ_COUNT</code> to cost a full table scan. However, if <code class="codeph">DB_FILE_MULTIBLOCK_READ_COUNT</code> is <code class="codeph">0</code> or is not set, then the optimizer uses a value of <code class="codeph">8</code> for calculating cost.
                           </p>
                           <p>Use the <code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code> procedure to gather workload statistics. The <code class="codeph">GATHER_SYSTEM_STATS</code> procedure refreshes the data dictionary or a staging table with statistics for the elapsed period. To set the duration of the collection, use either of the following techniques:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Specify <code class="codeph">START</code> the beginning of the workload window, and then <code class="codeph">STOP</code> at the end of the workload window.
                                 </p>
                              </li>
                              <li>
                                 <p>Specify <code class="codeph">INTERVAL</code> and the number of minutes before statistics gathering automatically stops. If needed, you can use <code class="codeph">GATHER_SYSTEM_STATS (gathering_mode=&gt;'STOP')</code> to end gathering earlier than scheduled. 
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-FB1B9F70-C417-4CC5-8F46-1ECDE2326D66__GUID-8115234C-4B34-45E8-8B30-90013DB63CE1">
                              <p class="notep1">See Also:</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=REFRN10037" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">DB_FILE_MULTIBLOCK_READ_COUNT</code> initialization parameter
                              </p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-46A36510-4BAF-43B8-8C65-B1B2D6B17916" title="Oracle recommends that you use DBMS_STATS.GATHER_SYSTEM_STATS to capture statistics when the database has the most typical workload.">Gathering Workload Statistics</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL441"></a><a id="TGSQL440"></a><div class="props_rev_3"><a id="GUID-90149651-4244-483C-93AF-D73387B0AF6F" name="GUID-90149651-4244-483C-93AF-D73387B0AF6F"></a><h6 id="TGSQL-GUID-90149651-4244-483C-93AF-D73387B0AF6F" class="sect6"><span class="enumeration_section">13.4.3.2.2 </span>Starting and Stopping System Statistics Gathering
                        </h6>
                        <div>
                           <p>This tutorial explains how to set the workload interval with the <code class="codeph">START</code> and <code class="codeph">STOP</code> parameters of <code class="codeph">GATHER_SYSTEM_STATS</code>.
                           </p>
                           <div class="section">
                              <p class="subhead3" id="GUID-90149651-4244-483C-93AF-D73387B0AF6F__GUID-EFEE738F-F380-415E-848A-3FDDD7F4807B">Assumptions</p>
                              <p>This tutorial assumes the following:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>The hour between 10 a.m. and 11 a.m. is representative of the daily workload.</p>
                                 </li>
                                 <li>
                                    <p>You intend to collect system statistics directly in the data dictionary.</p>
                                 </li>
                              </ul>
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3" id="GUID-90149651-4244-483C-93AF-D73387B0AF6F__GUID-A784195D-CBF6-4547-ACF8-D78ABF27D431">To gather workload statistics using START and STOP:</p>
                              <ol>
                                 <li>
                                    <p>Start SQL*Plus and connect to the database with administrator privileges.</p>
                                 </li>
                                 <li>
                                    <p>Start statistics collection.</p>
                                    <p>For example, at 10 a.m., execute the following procedure to start collection:</p><pre class="pre codeblock"><code>EXECUTE DBMS_STATS.GATHER_SYSTEM_STATS( gathering_mode =&gt; 'START' );
</code></pre></li>
                                 <li>
                                    <p>Generate the workload.</p>
                                 </li>
                                 <li>
                                    <p>End statistics collection.</p>
                                    <p>For example, at 11 a.m., execute the following procedure to end collection:</p><pre class="pre codeblock"><code>EXECUTE DBMS_STATS.GATHER_SYSTEM_STATS( gathering_mode =&gt; 'STOP' );
</code></pre><p>The optimizer can now use the workload statistics to generate execution plans that are effective during the normal daily workload.</p>
                                 </li>
                                 <li>
                                    <p>Optionally, query the system statistics.</p>
                                    <p>For example, run the following query:</p><pre class="pre codeblock"><code>COL PNAME FORMAT a15
SELECT PNAME, PVAL1 
FROM   SYS.AUX_STATS$ 
WHERE  SNAME = 'SYSSTATS_MAIN';</code></pre></li>
                              </ol>
                           </div>
                           <!-- class="section" -->
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-90149651-4244-483C-93AF-D73387B0AF6F__GUID-46EBADD8-AABF-4511-BAD0-1699E46D1DD7">
                              <p class="notep1">See Also:</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS-GUID-257CDCB8-3595-464B-8337-43EF23A6068D" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code> procedure
                              </p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-46A36510-4BAF-43B8-8C65-B1B2D6B17916" title="Oracle recommends that you use DBMS_STATS.GATHER_SYSTEM_STATS to capture statistics when the database has the most typical workload.">Gathering Workload Statistics</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL94867"></a><a id="TGSQL94866"></a><div class="props_rev_3"><a id="GUID-3E84E773-1D87-46E8-8592-3B5E3CAC2712" name="GUID-3E84E773-1D87-46E8-8592-3B5E3CAC2712"></a><h6 id="TGSQL-GUID-3E84E773-1D87-46E8-8592-3B5E3CAC2712" class="sect6"><span class="enumeration_section">13.4.3.2.3 </span>Gathering System Statistics During a Specified Interval
                        </h6>
                        <div>
                           <p>This tutorial explains how to set the workload interval with the <code class="codeph">INTERVAL</code> parameter of <code class="codeph">GATHER_SYSTEM_STATS</code>.
                           </p>
                           <div class="section">
                              <p class="subhead3" id="GUID-3E84E773-1D87-46E8-8592-3B5E3CAC2712__GUID-AE5F421C-B1A3-475B-ABCA-0297FEF3B98A">Assumptions</p>
                              <p>This tutorial assumes the following:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>The database application processes OLTP transactions during the day and runs OLAP reports at night. To gather representative statistics, you collect them during the day for two hours and then at night for two hours.</p>
                                 </li>
                                 <li>
                                    <p>You want to store statistics in a table named <code class="codeph">workload_stats</code>.
                                    </p>
                                 </li>
                                 <li>
                                    <p>You intend to switch between the statistics gathered.</p>
                                 </li>
                              </ul>
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3" id="GUID-3E84E773-1D87-46E8-8592-3B5E3CAC2712__GUID-37226DAE-DB70-45B8-82F0-97EB62DA7B41">To gather workload statistics using INTERVAL:</p>
                              <ol>
                                 <li>
                                    <p>Start SQL*Plus and connect to the production database as administrator <code class="codeph">dba1</code>.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Create a table to hold the production statistics.</p>
                                    <p>For example, execute the following PL/SQL program to create user statistics table <code class="codeph">workload_stats</code>:
                                    </p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.CREATE_STAT_TABLE (
      ownname  =&gt;  'dba1'
,     stattab  =&gt;  'workload_stats'
);
END;
/
</code></pre></li>
                                 <li>
                                    <p>Ensure that <code class="codeph">JOB_QUEUE_PROCESSES</code> is not <code class="codeph">0</code> so that <code class="codeph">DBMS_JOB</code> jobs and Oracle Scheduler jobs run.
                                    </p><pre class="pre codeblock"><code>ALTER SYSTEM SET JOB_QUEUE_PROCESSES = 1;
</code></pre></li>
                                 <li>
                                    <p>Gather statistics during the day.</p>
                                    <p>For example, gather statistics for two hours with the following program:</p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.GATHER_SYSTEM_STATS ( 
      interval  =&gt;  120
,     stattab   =&gt; 'workload_stats'
,     statid    =&gt; 'OLTP' 
);
END;
/
</code></pre></li>
                                 <li>
                                    <p>Gather statistics during the evening.</p>
                                    <p>For example, gather statistics for two hours with the following program:</p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.GATHER_SYSTEM_STATS (
      interval  =&gt;  120
,     stattab   =&gt; 'workload_stats' 
,     statid    =&gt; 'OLAP' 
);
END;
/
</code></pre></li>
                                 <li>
                                    <p>In the day or evening, import the appropriate statistics into the data dictionary.</p>
                                    <p>For example, during the day you can import the OLTP statistics from the staging table into the dictionary with the following program:</p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.IMPORT_SYSTEM_STATS (
      stattab  =&gt;  'workload_stats'
,     statid   =&gt;  'OLTP' 
);
END;
/
</code></pre><p>For example, during the night you can import the OLAP statistics from the staging table into the dictionary with the following program:</p><pre class="pre codeblock"><code>BEGIN
  DBMS_STATS.IMPORT_SYSTEM_STATS (
      stattab  =&gt;  'workload_stats'
,     statid   =&gt;  'OLAP' 
);
END;
/</code></pre></li>
                              </ol>
                           </div>
                           <!-- class="section" -->
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-3E84E773-1D87-46E8-8592-3B5E3CAC2712__GUID-35BA840C-6FAD-49CA-9F50-DC3C42B7CA6F">
                              <p class="notep1">See Also:</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS-GUID-257CDCB8-3595-464B-8337-43EF23A6068D" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code> procedure
                              </p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-46A36510-4BAF-43B8-8C65-B1B2D6B17916" title="Oracle recommends that you use DBMS_STATS.GATHER_SYSTEM_STATS to capture statistics when the database has the most typical workload.">Gathering Workload Statistics</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div><a id="TGSQL94923"></a><a id="TGSQL443"></a><div class="props_rev_3"><a id="GUID-4E99C958-71B0-4DC4-BF2A-33244BEFE46D" name="GUID-4E99C958-71B0-4DC4-BF2A-33244BEFE46D"></a><h5 id="TGSQL-GUID-4E99C958-71B0-4DC4-BF2A-33244BEFE46D" class="sect5"><span class="enumeration_section">13.4.3.3 </span>Gathering Noworkload Statistics
                     </h5>
                     <div>
                        <p>Noworkload statistics capture characteristics of the I/O system. </p>
                        <div class="section">
                           <p>By default, Oracle Database uses noworkload statistics and the CPU cost model. The values of noworkload statistics are initialized to defaults at the first instance startup. You can also use the <code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code> procedure to gather noworkload statistics manually.
                           </p>
                           <p>Noworkload statistics include the following system statistics listed in <a href="gathering-optimizer-statistics.html#GUID-08CA67A6-5634-4C67-BA3A-6DB812682B23__CHDJHGGG" title="This table describes the optimizer system statistics gathered by the DBMS_STATS package and explains when and how the statistics can be gathered.">Table 13-4</a>:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>I/O transfer speed (<code class="codeph">iotfrspeed</code>)
                                 </p>
                              </li>
                              <li>
                                 <p>I/O seek time (<code class="codeph">ioseektim</code>)
                                 </p>
                              </li>
                              <li>
                                 <p>CPU speed (<code class="codeph">cpuspeednw</code>)
                                 </p>
                              </li>
                           </ul>
                           <p>The major difference between workload statistics and noworkload statistics is in the gathering method. Noworkload statistics gather data by submitting random reads against all data files, whereas workload statistics uses counters updated when database activity occurs. If you gather workload statistics, then Oracle Database uses them instead of noworkload statistics.</p>
                           <p>To gather noworkload statistics, run <code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code> with no arguments or with the gathering mode set to <code class="codeph">noworkload</code>. There is an overhead on the I/O system during the gathering process of noworkload statistics. The gathering process may take from a few seconds to several minutes, depending on I/O performance and database size.
                           </p>
                           <p>When you gather noworkload statistics, the database analyzes the information and verifies it for consistency. In some cases, the values of noworkload statistics may retain their default values. You can either gather the statistics again, or use <code class="codeph">SET_SYSTEM_STATS</code> to set the values manually to the I/O system specifications.
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-4E99C958-71B0-4DC4-BF2A-33244BEFE46D__GUID-9160BA12-8F08-46C4-A316-63F11A3CDDFD">Assumptions</p>
                           <p>This tutorial assumes that you want to gather noworkload statistics manually.</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-4E99C958-71B0-4DC4-BF2A-33244BEFE46D__GUID-24477134-3227-46B8-82EA-E7D987CA3716">To gather noworkload statistics manually:</p>
                           <ol>
                              <li>
                                 <p>Start SQL*Plus and connect to the database with administrator privileges.</p>
                              </li>
                              <li>
                                 <p>Gather the noworkload statistics.</p>
                                 <p>For example, run the following statement:</p><pre class="pre codeblock"><code>BEGIN 
  DBMS_STATS.GATHER_SYSTEM_STATS ( 
    gathering_mode =&gt; 'NOWORKLOAD' 
);
END;
</code></pre></li>
                              <li>
                                 <p>Optionally, query the system statistics.</p>
                                 <p>For example, run the following query:</p><pre class="pre codeblock"><code>COL PNAME FORMAT a15

SELECT PNAME, PVAL1 
FROM   SYS.AUX_STATS$
WHERE  SNAME = 'SYSSTATS_MAIN';</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-4E99C958-71B0-4DC4-BF2A-33244BEFE46D__GUID-1C7D5E35-0067-4EB7-ABE0-7FCD67393FC4">
                           <p class="notep1">See Also:</p>
                           <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-257CDCB8-3595-464B-8337-43EF23A6068D" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_STATS.GATHER_SYSTEM_STATS</code> procedure
                           </p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-E5731E8E-3382-4E6A-9986-2508721631E3" title="To gather system statistics manually, use the DBMS_STATS.GATHER_SYSTEM_STATS procedure.">Gathering System Statistics with DBMS_STATS</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="TGSQL448"></a><a id="TGSQL447"></a><div class="props_rev_3"><a id="GUID-C4F0B12B-2C9E-4050-B647-F7DC451D7878" name="GUID-C4F0B12B-2C9E-4050-B647-F7DC451D7878"></a><h4 id="TGSQL-GUID-C4F0B12B-2C9E-4050-B647-F7DC451D7878" class="sect4"><span class="enumeration_section">13.4.4 </span>Deleting System Statistics
                  </h4>
                  <div>
                     <p>The <code class="codeph">DBMS_STATS.DELETE_SYSTEM_STATS</code> procedure deletes system statistics.
                     </p>
                     <div class="section">
                        <p>This procedure deletes workload statistics collected using the <code class="codeph">INTERVAL</code> or <code class="codeph">START</code> and <code class="codeph">STOP</code> options, and then resets the default to noworkload statistics. However, if the <code class="codeph">stattab</code> parameter specifies a table for storing statistics, then the subprogram deletes all system statistics with the associated <code class="codeph">statid</code> from the statistics table.
                        </p>
                        <p>If the database is newly created, then Oracle recommends deleting system statistics, shutting down the database, and then reopening the database. This sequence of steps ensures that the database establishes appropriate defaults for system statistics.</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-C4F0B12B-2C9E-4050-B647-F7DC451D7878__GUID-14AC4F61-9092-45C3-B6D1-5BD243F3B13D">Assumptions</p>
                        <p>This tutorial assumes the following:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>You gathered statistics for a specific intensive workload, but no longer want the optimizer to use these statistics.</p>
                           </li>
                           <li>
                              <p>You stored workload statistics in the default location, not in a user-specified table.</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-C4F0B12B-2C9E-4050-B647-F7DC451D7878__GUID-BAB40C25-6AA8-47F5-A72D-CEFD38FDC3C7">To delete system statistics:</p>
                        <ol>
                           <li>
                              <p>In SQL*Plus, log in to the database as a user with administrative privileges.</p>
                           </li>
                           <li>
                              <p>Delete the system statistics.</p>
                              <p>For example, run the following statement:</p><pre class="pre codeblock"><code>EXEC DBMS_STATS.DELETE_SYSTEM_STATS;</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-C4F0B12B-2C9E-4050-B647-F7DC451D7878__GUID-EF6DCCF2-2D0E-466B-B801-2D684CE8A023">
                        <p class="notep1">See Also:</p>
                        <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS-GUID-69DC84A3-704B-4E48-8C17-7C7E01A368EC" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_STATS.DELETE_SYSTEM_STATS</code> procedure
                        </p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31" title="System statistics describe hardware characteristics, such as I/O and CPU performance and utilization, to the optimizer.">Gathering System Statistics Manually</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL94639"></a><a id="TGSQL94640"></a><a id="TGSQL94638"></a><div class="props_rev_3"><a id="GUID-4274A976-0185-4113-844F-1F818CD916CA" name="GUID-4274A976-0185-4113-844F-1F818CD916CA"></a><h3 id="TGSQL-GUID-4274A976-0185-4113-844F-1F818CD916CA" class="sect3"><span class="enumeration_section">13.5 </span>Running Statistics Gathering Functions in Reporting Mode
               </h3>
               <div>
                  <p>You can run the <code class="codeph">DBMS_STATS</code> statistics gathering procedures in reporting mode.
                  </p>
                  <div class="section">
                     <p>When you use the <code class="codeph">REPORT_*</code> procedures, the optimizer does not actually gather statistics. Rather, the package reports objects that <span class="italic">would</span> be processed if you were to use a specified statistics gathering function.
                     </p>
                     <p>The following table lists the <code class="codeph">DBMS_STATS.REPORT_GATHER_*_STATS</code> functions. For all functions, the input parameters are the same as for the corresponding <code class="codeph">GATHER_*_STATS</code> procedure, with the following additional parameters: <code class="codeph">detail_level</code> and <code class="codeph">format</code>. Supported formats are <code class="codeph">XML</code>, <code class="codeph">HTML</code>, and <code class="codeph">TEXT</code>.
                     </p>
                     <div class="tblformal" id="GUID-4274A976-0185-4113-844F-1F818CD916CA__CHDBEFIB">
                        <p class="titleintable">Table 13-5 DBMS_STATS Reporting Mode Functions</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="DBMS_STATS Reporting Mode Functions" summary="DBMS_STATS restore procedures" width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="46%" id="d74756e10353">Function</th>
                                 <th align="left" valign="bottom" width="54%" id="d74756e10356">Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="46%" id="d74756e10361" headers="d74756e10353 ">
                                    <p><code class="codeph">REPORT_GATHER_TABLE_STATS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="54%" headers="d74756e10361 d74756e10356 ">
                                    <p>Runs <code class="codeph">GATHER_TABLE_STATS</code> in reporting mode. The procedure does not collect statistics, but reports all objects that would be affected by invoking <code class="codeph">GATHER_TABLE_STATS</code>. 
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="46%" id="d74756e10375" headers="d74756e10353 ">
                                    <p><code class="codeph">REPORT_GATHER_SCHEMA_STATS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="54%" headers="d74756e10375 d74756e10356 ">
                                    <p>Runs <code class="codeph">GATHER_SCHEMA_STATS</code> in reporting mode. The procedure does not actually collect statistics, but reports all objects that would be affected by invoking <code class="codeph">GATHER_SCHEMA_STATS</code>.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="46%" id="d74756e10389" headers="d74756e10353 ">
                                    <p><code class="codeph">REPORT_GATHER_DICTIONARY_STATS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="54%" headers="d74756e10389 d74756e10356 ">
                                    <p>Runs <code class="codeph">GATHER_DICTIONARY_STATS</code> in reporting mode. The procedure does not actually collect statistics, but reports all objects that would be affected by invoking <code class="codeph">GATHER_DICTIONARY_STATS</code>.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="46%" id="d74756e10403" headers="d74756e10353 ">
                                    <p><code class="codeph">REPORT_GATHER_DATABASE_STATS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="54%" headers="d74756e10403 d74756e10356 ">
                                    <p>Runs <code class="codeph">GATHER_DATABASE_STATS</code> in reporting mode. The procedure does not actually collect statistics, but reports all objects that would be affected by invoking <code class="codeph">GATHER_DATABASE_STATS</code>.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="46%" id="d74756e10417" headers="d74756e10353 ">
                                    <p><code class="codeph">REPORT_GATHER_FIXED_OBJ_STATS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="54%" headers="d74756e10417 d74756e10356 ">
                                    <p>Runs <code class="codeph">GATHER_FIXED_OBJ_STATS</code> in reporting mode. The procedure does not actually collect statistics, but reports all objects that would be affected by invoking <code class="codeph">GATHER_FIXED_OBJ_STATS</code>.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="46%" id="d74756e10431" headers="d74756e10353 ">
                                    <p><code class="codeph">REPORT_GATHER_AUTO_STATS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="54%" headers="d74756e10431 d74756e10356 ">
                                    <p>Runs the automatic statistics gather job in reporting mode. The procedure does not actually collect statistics, but reports all objects that would be affected by running the job.</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-4274A976-0185-4113-844F-1F818CD916CA__GUID-B3049A7D-E2C7-436A-BD77-D61E8ED699DE">Assumptions</p>
                     <p>This tutorial assumes that you want to generate an HTML report of the objects that would be affected by running <code class="codeph">GATHER_SCHEMA_STATS</code> on the <code class="codeph">oe</code> schema.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-4274A976-0185-4113-844F-1F818CD916CA__GUID-1A17BB1F-9615-486F-8C93-D2AFB8AF4D25">To report on objects affected by running GATHER_SCHEMA_STATS:</p>
                     <ol>
                        <li>
                           <p>Start SQL*Plus and connect to the database with administrator privileges.</p>
                        </li>
                        <li>
                           <p>Run the <code class="codeph">DBMS_STATS.REPORT_GATHER_SCHEMA_STATS</code> function.
                           </p>
                           <p>For example, run the following commands in SQL*Plus:</p><pre class="pre codeblock"><code>SET LINES 200 PAGES 0
SET LONG 100000
COLUMN REPORT FORMAT A200

VARIABLE my_report CLOB;
BEGIN
  :my_report :=DBMS_STATS.REPORT_GATHER_SCHEMA_STATS(
    ownname      =&gt; 'OE'       , 
    detail_level =&gt; 'TYPICAL'  ,
    format       =&gt; 'HTML'     );
END;
/
</code></pre></li>
                     </ol>
                     <p>The following graphic shows a partial example report:</p>
                     <div class="figure" id="GUID-4274A976-0185-4113-844F-1F818CD916CA__GUID-EAC7CF7B-73CF-4924-B9AD-56617D7F599D"><img src="img/report_gs_oe.png" alt="Description of report_gs_oe.png follows" title="Description of report_gs_oe.png follows" longdesc="img_text/report_gs_oe.html"><br><a href="img_text/report_gs_oe.html">Description of the illustration report_gs_oe.png</a></div>
                     <!-- class="figure" -->
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-4274A976-0185-4113-844F-1F818CD916CA__GUID-9F6A0147-E0CC-4175-9BC4-FADCE441481E">
                     <p class="notep1">See Also:</p>
                     <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS059" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn more about <code class="codeph">DBMS_STATS</code> 
                     </p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="gathering-optimizer-statistics.html#GUID-245F23B2-24AF-44D8-9F12-99FD1215E878" title="This chapter explains how to use the DBMS_STATS.GATHER_*_STATS program units.">Gathering Optimizer Statistics</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>