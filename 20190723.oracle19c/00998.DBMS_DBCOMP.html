<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="The DBMS_DBCOMP package performs block comparison to detect lost writes or database inconsistencies between a primary database and one or more physical standby databases. It contains one procedure, DBCOMP, which can be executed at any time. (It does not require that the DB_LOST_WRITE_PROTECT initialization parameter be enabled.)">
      <meta name="description" content="The DBMS_DBCOMP package performs block comparison to detect lost writes or database inconsistencies between a primary database and one or more physical standby databases. It contains one procedure, DBCOMP, which can be executed at any time. (It does not require that the DB_LOST_WRITE_PROTECT initialization parameter be enabled.)">
      <title>DBMS_DBCOMP</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="PL/SQL Packages and Types Reference">
      <meta property="og:description" content="The DBMS_DBCOMP package performs block comparison to detect lost writes or database inconsistencies between a primary database and one or more physical standby databases. It contains one procedure, DBCOMP, which can be executed at any time. (It does not require that the DB_LOST_WRITE_PROTECT initialization parameter be enabled.)">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="PL/SQL Packages and Types Reference">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="database-pl-sql-packages-and-types-reference.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-03-25T11:24:34-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96430-03">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="DBMS_DB_VERSION.html" title="Previous" type="text/html">
      <link rel="next" href="DBMS_DBFS_CONTENT.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database PL/SQL Packages and Types Reference">
    <meta name="dcterms.isVersionOf" content="ARPLS">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="DBMS_DB_VERSION.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="DBMS_DBFS_CONTENT.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">PL/SQL Packages and Types Reference</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">DBMS_DBCOMP</li>
            </ol>
            <a id="GUID-4A248C6E-F52E-4841-B26B-139DD33012B1" name="GUID-4A248C6E-F52E-4841-B26B-139DD33012B1"></a>
            
            <h2 id="ARPLS-GUID-4A248C6E-F52E-4841-B26B-139DD33012B1" class="sect2"><span class="enumeration_chapter">48 </span>DBMS_DBCOMP
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>The <code class="codeph">DBMS_DBCOMP</code> package performs block comparison to detect lost writes or database inconsistencies between a primary database and one or more physical standby databases. It contains one procedure, <code class="codeph">DBCOMP</code>, which can be executed at any time. (It does not require that the <code class="codeph">DB_LOST_WRITE_PROTECT</code> initialization parameter be enabled.)
               </p>
               <p>This chapter contains the following sections:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="DBMS_DBCOMP.html#GUID-8E32D7DE-67BA-4238-8743-4BFF6CE81D30" title="The DBMS_DBCOMP.DBCOMP procedure assumes that there is one primary database and one or more physical standby databases. The databases should be at least mounted before block comparison.">Using DBMS_DBCOMP</a></p>
                  </li>
                  <li>
                     <p><a href="DBMS_DBCOMP.html#GUID-B6177712-FE00-47F7-A651-F17D202E7ABB" title="The DBMS_DBCOMP package runs with invoker’s rights and requires the SYSDBA or SYSDG or SYSBACKUP privilege.">DBMS_DBCOMP Security Model</a></p>
                  </li>
                  <li>
                     <p><a href="DBMS_DBCOMP.html#GUID-3AB1440C-D185-400E-9BBD-2C2095AC69D5" title="Use DBCOMP procedure to compare blocks on a primary database and one or more physical standby databases.">DBCOMP Procedure</a></p>
                  </li>
               </ul>
            </div>
            <div>
               <div class="relinfo">
                  <p><strong>Related Topics</strong></p>
                  <ul>
                     <li><a href="../sbydb/examples-of-using-oracle-data-guard.html#SBYDB-GUID-A2FA9BA2-07F9-492E-8113-3FE8521EB3E3" target="_blank"><span><cite>Oracle Data Guard Concepts and Administration</cite></span></a></li>
                  </ul>
               </div>
            </div>
            <div class="sect2"><a id="GUID-8E32D7DE-67BA-4238-8743-4BFF6CE81D30" name="GUID-8E32D7DE-67BA-4238-8743-4BFF6CE81D30"></a><h3 id="ARPLS-GUID-8E32D7DE-67BA-4238-8743-4BFF6CE81D30" class="sect3"><span class="enumeration_section">48.1 </span>Using DBMS_DBCOMP
               </h3>
               <div>
                  <p>The <code class="codeph">DBMS_DBCOMP.DBCOMP</code> procedure assumes that there is one primary database and one or more physical standby databases. The databases should be at least mounted before block comparison.
                  </p>
                  <div class="section">
                     <div class="infoboxnote" id="GUID-8E32D7DE-67BA-4238-8743-4BFF6CE81D30__GUID-4059CB03-59E8-40AF-A687-BA9654CEFACD">
                        <p class="notep1">Note:</p>Logical standby databases, far sync instances, and cascaded standbys cannot be the target database for the <code class="codeph">DBMS_DBCOMP.DBCOMP</code> procedure.
                     </div>
                     <p>While this procedure is running, you can monitor progress of the compare operation by querying the <code class="codeph">V$SESSION_LONGOPS</code> view. For example:
                     </p><pre class="pre codeblock"><code>SQL&gt; SELECT target_desc, sofar, totalwork FROM V$SESSION_LONGOPS WHERE opname = ‘BlockCompare’;</code></pre><p>The output might look as follows:</p><pre class="pre codeblock"><code>TARGET_DESC                   SO FAR     TOTALWORK
----------------------------- ---------  ----------
Compared Blocks               23914      340639
Lost Writes                   0          0</code></pre><p>The results can be interpreted as follows:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The <code class="codeph">Compared Blocks</code> value is the number of blocks that were scanned (including those that did not use compare callback functions). The number is the sum of all slaves (that is, each slave is responsible for a connection between primary and standby). For example, if there are two slaves and each slave has compared 1000 blocks, then the value of <code class="codeph">SOFAR</code> should be 2000.
                           </p>
                        </li>
                        <li>
                           <p> The <code class="codeph">Lost Writes</code> value is the number of lost writes found at both the primary and the standby. Also, it is the sum of all slaves. For <code class="codeph">Lost Writes</code>, the value of <code class="codeph">SOFAR</code> should be always equal to the value of <code class="codeph">TOTALWORK</code>.
                           </p>
                        </li>
                        <li>
                           <p>The value of <code class="codeph">SOFAR</code> should be always less than or equal to the value of <code class="codeph">TOTALWORK</code>.
                           </p>
                        </li>
                        <li>
                           <p>When the block compare slave processes finish, the value of <code class="codeph">SOFAR</code> should be equal to the value of <code class="codeph">TOTALWORK</code>.
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-B6177712-FE00-47F7-A651-F17D202E7ABB" name="GUID-B6177712-FE00-47F7-A651-F17D202E7ABB"></a><h3 id="ARPLS-GUID-B6177712-FE00-47F7-A651-F17D202E7ABB" class="sect3"><span class="enumeration_section">48.2 </span>DBMS_DBCOMP Security Model
               </h3>
               <div>
                  <p>The <code class="codeph">DBMS_DBCOMP</code> package runs with invoker’s rights and requires the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSDG</code> or <code class="codeph">SYSBACKUP</code> privilege.
                  </p>
               </div>
            </div>
            <div class="sect2"><a id="GUID-C078C2B4-11D3-4195-A4D2-ADFD939878C1" name="GUID-C078C2B4-11D3-4195-A4D2-ADFD939878C1"></a><h3 id="ARPLS-GUID-C078C2B4-11D3-4195-A4D2-ADFD939878C1" class="sect3"><span class="enumeration_section">48.3 </span>Summary of the DBMS_DBCOMP Subprogram
               </h3>
               <div>
                  <p>The <code class="codeph">DBMS_DBCOMP</code> package contains one procedure, <code class="codeph">DBCOMP</code>.
                  </p>
                  <div class="tblformal" id="GUID-C078C2B4-11D3-4195-A4D2-ADFD939878C1__GUID-E80DF370-7A63-4ED1-B904-E019CDC0A12A">
                     <table cellpadding="4" cellspacing="0" class="Formal" title="" summary="Description of the procedures in DBMS_DBCOMP." frame="hsides" border="1" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" id="d329761e486">Subprogram</th>
                              <th align="left" valign="bottom" id="d329761e488">Description</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" id="d329761e492" headers="d329761e486 "><code class="codeph">DBCOMP</code> procedure
                              </td>
                              <td align="left" valign="top" headers="d329761e492 d329761e488 ">The <code class="codeph">DBMS_DBCOMP.DBCOMP</code> procedure performs block comparison to detect lost writes or database inconsistencies between a primary database and one or more physical standby databases. The <code class="codeph">DBCOMP</code> procedure can be executed on the primary or on the physical standby while the databases are mounted or open.
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
               </div>
               <div class="sect3"><a id="GUID-3AB1440C-D185-400E-9BBD-2C2095AC69D5" name="GUID-3AB1440C-D185-400E-9BBD-2C2095AC69D5"></a><h4 id="ARPLS-GUID-3AB1440C-D185-400E-9BBD-2C2095AC69D5" class="sect4"><span class="enumeration_section">48.3.1 </span>DBCOMP Procedure
                  </h4>
                  <div>
                     <p>Use DBCOMP procedure to compare blocks on a primary database and one or more physical standby databases.</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-3AB1440C-D185-400E-9BBD-2C2095AC69D5__GUID-56E07A63-10B3-46A1-AF63-64A9D97ED803">Syntax</p><pre class="pre codeblock"><code>DBMS_DBCOMP.DBCOMP (
  datafile IN varchar2, 
  outputfile IN varchar2, 
  block_dump IN boolean);</code></pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-3AB1440C-D185-400E-9BBD-2C2095AC69D5__GUID-326E6E9A-3617-40EF-843E-6A891C32CF16">Parameters</p>
                        <div class="tblformal" id="GUID-3AB1440C-D185-400E-9BBD-2C2095AC69D5__GUID-9F09C3BB-053B-49DD-9E77-2AE1D8F5B81C">
                           <table cellpadding="4" cellspacing="0" class="Formal" title="" summary="Parameters for the DBMS_DBCOMP.DBCOMP procedure." frame="hsides" border="1" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" id="d329761e606">Parameter </th>
                                    <th align="left" valign="bottom" id="d329761e608">Description</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d329761e612" headers="d329761e606 "><code class="codeph">datafile</code></td>
                                    <td align="left" valign="top" headers="d329761e612 d329761e608 ">This can be a data file name or a data file number. Specify <code class="codeph">‘ALL’</code> to compare all data files.
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d329761e621" headers="d329761e606 "><code class="codeph">outputfile</code></td>
                                    <td align="left" valign="top" headers="d329761e621 d329761e608 ">This value is used as a prefix in the name of the output file. By default, output files are placed in the dbs/ directory, but the output file argument can contain a relative directory path or an absolute directory path. See Usage Notes for descriptions of the information contained in the output file.</td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" id="d329761e627" headers="d329761e606 "><code class="codeph">block_dump</code></td>
                                    <td align="left" valign="top" headers="d329761e627 d329761e608 ">This is a Boolean parameter to specify whether block content should be dumped into output files if a pair of blocks of primary and standby databases is not identical. This parameter does not guarantee that all different block pairs are dumped. The default value is <code class="codeph">FALSE</code>.
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-3AB1440C-D185-400E-9BBD-2C2095AC69D5__GUID-68856513-EB8C-415D-A0F5-B66E308A55B8">Usage Notes</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>The output file contains the following columns:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><span class="bold">ID</span>: The block type. For instance, type 02 is undo block type, and 06 is KTB-managed data block type.
                                    </p>
                                 </li>
                                 <li>
                                    <p><span class="bold">TOTAL</span>: The total number of blocks in the specific block type.
                                    </p>
                                 </li>
                                 <li>
                                    <p><span class="bold">CORR</span>: The number of corrupted blocks.
                                    </p>
                                 </li>
                                 <li>
                                    <p><span class="bold">SKIPPED</span>: The number of block pairs that are skipped (ignored) without comparison, such as direct loaded blocks, RMAN optimized blocks, and flashback optimized blocks
                                    </p>
                                 </li>
                                 <li>
                                    <p><span class="bold">DIFFV</span>: The number of blocks that have different version numbers between primary and standby. 
                                    </p>
                                 </li>
                                 <li>
                                    <p><span class="bold">SAMEV</span>: The number of block pairs that have the same version number between primary and standby.
                                    </p>
                                 </li>
                                 <li>
                                    <p><span class="bold">SAMEV&amp;C</span>: The number of block pairs that have the same version and the same checksum.
                                    </p>
                                 </li>
                                 <li>
                                    <p><span class="bold">ENCERR</span>: The number of block pairs that have encryption related errors (usually because the Wallet is not open).
                                    </p>
                                 </li>
                                 <li>
                                    <p><span class="bold">LWLOC</span>: The number of lost writes on the local database.
                                    </p>
                                 </li>
                                 <li>
                                    <p><span class="bold">LWRMT</span>: The number of lost writes on the remote databases.
                                    </p>
                                 </li>
                                 <li>
                                    <p><span class="bold">DIFFPAIR</span> : The number of block pairs that have the same version but different checksum, and which the block compare callback function has concluded are different.
                                    </p>
                                 </li>
                              </ul>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-3AB1440C-D185-400E-9BBD-2C2095AC69D5__GUID-790D3466-643E-44BD-9064-5574D6F49AB5">
                        <p class="titleinexample">Example 48-1 Example </p>
                        <p>The following is an example of using the <code class="codeph">DBMS_DBCOMP.DBCOMP</code> procedure.
                        </p><pre class="pre codeblock"><code>declare
  Datafile_Name_or_Number varchar2(1000);
  Output_File varchar2(1000);
begin
  dbms_output.enable(1000000);
  Datafile_Name_or_Number:= 'all' ;
  Output_File:='BlockCompareAll_';
  sys.dbms_dbcomp.DBCOMP(Datafile_Name_or_Number, Output_File, true);
end;</code></pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>