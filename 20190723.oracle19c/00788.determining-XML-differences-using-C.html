<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="An explanation is given of how to determine the differences between two Extensible Markup Language (XML) inputs and apply the differences as a patch to one of the XML documents.">
      <meta name="description" content="An explanation is given of how to determine the differences between two Extensible Markup Language (XML) inputs and apply the differences as a patch to one of the XML documents.">
      <title>Determining XML Differences Using C</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Programmer's Guide">
      <meta property="og:description" content="An explanation is given of how to determine the differences between two Extensible Markup Language (XML) inputs and apply the differences as a patch to one of the XML documents.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Programmer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="xml-developers-kit-programmers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-11T05:58:48-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2001, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96292-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="using-XML-schema-processor-for-C.html" title="Previous" type="text/html">
      <link rel="next" href="using-SOAP-with-XDK.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="XML Developers Kit Programmers Guide">
    <meta name="dcterms.isVersionOf" content="ADXDK">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="using-XML-schema-processor-for-C.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="using-SOAP-with-XDK.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Programmer's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="XDK-for-C.html" property="item" typeof="WebPage"><span property="name">Oracle XML Developer's Kit for C</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Determining XML Differences Using C</li>
            </ol>
            <a id="GUID-C602E94C-6FC5-4451-B2E0-ED6C5A888B52" name="GUID-C602E94C-6FC5-4451-B2E0-ED6C5A888B52"></a><a id="ADXDK1041"></a><a id="ADXDK2500"></a>
            
            <h2 id="ADXDK-GUID-C602E94C-6FC5-4451-B2E0-ED6C5A888B52" class="sect2"><span class="enumeration_chapter">8 </span>Determining XML Differences Using C
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>An explanation is given of how to determine the differences between two Extensible Markup Language (XML) inputs and apply the differences as a patch to one of the XML documents.</p>
               <div class="section"></div>
               <!-- class="section" -->
            </div><a id="ADXDK19828"></a><div class="props_rev_3"><a id="GUID-9CE0A27F-1595-4BA1-8BF2-083C10274EA9" name="GUID-9CE0A27F-1595-4BA1-8BF2-083C10274EA9"></a><h3 id="ADXDK-GUID-9CE0A27F-1595-4BA1-8BF2-083C10274EA9" class="sect3">Overview of XMLDiff in C</h3>
               <div>
                  <p>You can use Oracle <code class="codeph">XmlDiff</code> to determine the differences between two similar XML documents. It generates an <code class="codeph">Xdiff</code> instance document that indicates the differences. The <code class="codeph">Xdiff</code> document is an XML document that conforms to an XML schema, the <code class="codeph">Xdiff</code> schema.
                  </p>
                  <p>You can then use <code class="codeph">XmlPatch</code>, which takes the <code class="codeph">Xdiff</code> instance document and applies the changes to other documents. You can use this process to apply the same changes to a large number of XML documents.
                  </p>
                  <p><code class="codeph">XmlDiff</code> supports only the Document Object Model (DOM) application programming interface (API) for input and output.
                  </p>
                  <p><code class="codeph">XmlPatch</code> also supports the DOM for the input and patch documents.
                  </p>
                  <p>You can use <code class="codeph">XmlDiff</code> and <code class="codeph">XmlPatch</code> through a C API or a command-line tool. They are exposed by two structured query language (SQL) functions.
                  </p>
                  <p>An <code class="codeph">XmlHash</code> C API is provided to compute the hash value of an XML tree or subtree. If hash values of two trees or subtrees are equal, the trees are identical to a very high probability.
                  </p>
               </div><a id="ADXDK19829"></a><div class="sect3"><a id="GUID-BB147A78-50C6-43DD-8A07-CAAB060A5F74" name="GUID-BB147A78-50C6-43DD-8A07-CAAB060A5F74"></a><h4 id="ADXDK-GUID-BB147A78-50C6-43DD-8A07-CAAB060A5F74" class="sect4">Process Flow for XMLDiff</h4>
                  <div>
                     <p>The XMLDiff process flow is described.</p>
                     <ol>
                        <li>
                           <p>The two input documents are compared by <code class="codeph">XmlDiff</code>.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">XmlDiff</code> creates a <code class="codeph">Xdiff</code> instance document.
                           </p>
                        </li>
                        <li>
                           <p>The application can pass the <code class="codeph">Xdiff</code> instance document to <code class="codeph">XmlPatch</code>, if this is required.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">XmlPatch</code> can apply the differences captured from the comparison to other documents as specified by the application.
                           </p>
                        </li>
                     </ol>
                  </div>
               </div>
            </div><a id="ADXDK2510"></a><div class="props_rev_3"><a id="GUID-D25785EA-996A-44BE-ADF8-FF47DDD174E8" name="GUID-D25785EA-996A-44BE-ADF8-FF47DDD174E8"></a><h3 id="ADXDK-GUID-D25785EA-996A-44BE-ADF8-FF47DDD174E8" class="sect3">Using XmlDiff</h3>
               <div>
                  <p><code class="codeph">XmlDiff</code> compares the trees that represent two input documents, to determine their differences. Both input documents must use the same character-set encoding. The <code class="codeph">Xdiff</code> (output) instance document has the same encoding as the data encoding (DOM encoding) of the input documents.
                  </p>
               </div><a id="ADXDK19830"></a><div class="props_rev_3"><a id="GUID-21B69703-474D-4F5A-9804-DD67F1EBC279" name="GUID-21B69703-474D-4F5A-9804-DD67F1EBC279"></a><h4 id="ADXDK-GUID-21B69703-474D-4F5A-9804-DD67F1EBC279" class="sect4">User Options for Comparison Optimization</h4>
                  <div>
                     <p> There are two optimization options for comparison: global and local optimization.</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Global Optimization—Default</p>
                           <p>The whole document trees are compared. </p>
                        </li>
                        <li>
                           <p>Local Optimization</p>
                           <p>Comparison is at the sibling level. Local optimization compares siblings under the corresponding parents from two trees.</p>
                        </li>
                     </ul>
                     <p>Global optimization can take more time and space for large documents but always produces the smallest set of differences (the optimal difference). Local optimization is much faster, but may not produce the optimal difference.</p>
                  </div>
               </div><a id="ADXDK19831"></a><div class="props_rev_3"><a id="GUID-CD4119E5-921E-498A-8F3F-3432D5CD08C8" name="GUID-CD4119E5-921E-498A-8F3F-3432D5CD08C8"></a><h4 id="ADXDK-GUID-CD4119E5-921E-498A-8F3F-3432D5CD08C8" class="sect4">User Option for Hashing</h4>
                  <div>
                     <p>Hashing generally speeds up global optimization with a small possible loss in quality. Hashing improves the quality of the difference output, with local optimization. Using different hash levels may generate both local and global differences. You can specify the use of hashing for both local and global optimization.</p>
                     <p>To specify hashing, provide the <code class="codeph">hashLevel</code> parameter. If <code class="codeph">hashLevel</code> is greater than 1, then only the <code class="codeph">DOMHash</code> values are used for comparing all subtrees at <code class="codeph">depth &gt;= hashLevel</code> of difference. If the hash values are equal, then the subtrees are presumed to be equal.
                     </p>
                  </div>
               </div><a id="ADXDK19832"></a><div class="props_rev_3"><a id="GUID-C427B536-D231-4214-A051-E32F24251A22" name="GUID-C427B536-D231-4214-A051-E32F24251A22"></a><h4 id="ADXDK-GUID-C427B536-D231-4214-A051-E32F24251A22" class="sect4">How XmlDiff Looks at Input Documents</h4>
                  <div>
                     <p>How <code class="codeph">XmlDiff</code> handles input documents is described.
                     </p>
                     <p><code class="codeph">XmlDiff</code> ignores differences in the order of attributes while doing the comparison.
                     </p>
                     <p><code class="codeph">XmlDiff</code> ignores <code class="codeph">DocType</code> declarations. Files are not validated against the document type definition (DTD).
                     </p>
                     <p><code class="codeph">XmlDiff</code> ignores any differences in the namespace prefixes if the namespace prefixes refer to the same namespace Universal Resource Identifier (URI). Otherwise, if two nodes have the same local name and content but differ in namespace URI, these differences are indicated.
                     </p>
                     <div class="infoboxnote" id="GUID-C427B536-D231-4214-A051-E32F24251A22__GUID-50B88F23-AF51-4934-A31A-68E87E2DBFC2">
                        <p class="notep1">Note:</p>
                        <p><code class="codeph">XmlDiff</code> operates on its input documents in a nonschema-based way. It does not operate on elements or attributes in a type-aware manner.
                        </p>
                     </div>
                  </div>
               </div><a id="ADXDK19833"></a><a id="ADXDK2540"></a><div class="props_rev_3"><a id="GUID-74C319A8-BE88-4200-AABC-FD153108D3F3" name="GUID-74C319A8-BE88-4200-AABC-FD153108D3F3"></a><h4 id="ADXDK-GUID-74C319A8-BE88-4200-AABC-FD153108D3F3" class="sect4">Using the XmlDiff Command-Line Utility</h4>
                  <div>
                     <p>The command-line options for utility <code class="codeph">XmlDiff</code> are described.
                     </p>
                     <div class="section">
                        <div class="tblformal" id="GUID-74C319A8-BE88-4200-AABC-FD153108D3F3__BABJDEEA">
                           <p class="titleintable">Table 8-1 XmlDiff Command-Line Options for the C Language</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="XmlDiff Command-Line Options for the C Language" summary="This table describes command-line options. Rows are XmlDiff command line options. The first column is the option name, the second column is its description." width="100%" frame="hsides" border="1" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="31%" id="d26881e776">Option</th>
                                    <th align="left" valign="bottom" width="69%" id="d26881e779">Description</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d26881e784" headers="d26881e776 ">
                                       <p><code class="codeph">-e</code> encoding 
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d26881e784 d26881e779 ">
                                       <p>Specify default input-file encoding. If no encoding is specified in XML file, this encoding is assumed for input. </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d26881e793" headers="d26881e776 ">
                                       <p><code class="codeph">-E</code> encoding 
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d26881e793 d26881e779 ">
                                       <p>Specify output/data encoding. DOMs and the <code class="codeph">Xdiff</code> instance document are created in this encoding. Default is 8-bit encoding of Unicode (UTF-8).
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d26881e805" headers="d26881e776 ">
                                       <p><code class="codeph">-h</code> <code class="codeph">hash</code>L<code class="codeph">evel</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d26881e805 d26881e779 ">
                                       <p>Specify the hash level. <code class="codeph">0</code> means none.
                                       </p>
                                       <p>If greater than <code class="codeph">1</code>, starting depth to use hashing for subtrees.
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d26881e827" headers="d26881e776 ">
                                       <p><code class="codeph">-g</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d26881e827 d26881e779 ">
                                       <p>Set global optimization (default). </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d26881e835" headers="d26881e776 ">
                                       <p><code class="codeph">-l</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d26881e835 d26881e779 ">
                                       <p>Set local optimization. </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d26881e843" headers="d26881e776 ">
                                       <p><code class="codeph">-p</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d26881e843 d26881e779 ">
                                       <p>Show this usage help.</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d26881e851" headers="d26881e776 ">
                                       <p><code class="codeph">-u</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d26881e851 d26881e779 ">
                                       <p>Disable update operation.</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADXDK19835"></a><a id="ADXDK19834"></a><div class="props_rev_3"><a id="GUID-3750C497-D76A-4F95-9DEB-BC047170FF14" name="GUID-3750C497-D76A-4F95-9DEB-BC047170FF14"></a><h4 id="ADXDK-GUID-3750C497-D76A-4F95-9DEB-BC047170FF14" class="sect4">Sample Input Document</h4>
                  <div>
                     <p>A sample input XML document is presented.</p>
                     <div class="section">
                        <p><a href="determining-XML-differences-using-C.html#GUID-3750C497-D76A-4F95-9DEB-BC047170FF14__BABBHCIA">Example 8-1</a> is a sample XML document that you can use to explain updates resulting from using both <code class="codeph">XmlDiff</code> and <code class="codeph">XmlPatch</code>. It is followed by some hypothetical changes.
                        </p>
                        <p>Assume that there is another file, <code class="codeph">book2.xml</code>, that looks just like <a href="determining-XML-differences-using-C.html#GUID-3750C497-D76A-4F95-9DEB-BC047170FF14__BABBHCIA">Example 8-1</a> except that it causes these actions:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Deletes "The Eleventh Commandment", a <code class="codeph">delete-node</code> operation.
                              </p>
                           </li>
                           <li>
                              <p>Changes the country code for the "C++ Primer" to US from USA, an <code class="codeph">update-node</code> operation.
                              </p>
                           </li>
                           <li>
                              <p>Adds a description to "Emperor's New Mind", an <code class="codeph">append-node</code> operation.
                              </p>
                           </li>
                           <li>
                              <p>Adds the edition to "Evening News", an <code class="codeph">insert-node-before</code> operation.
                              </p>
                           </li>
                           <li>
                              <p>Updates the price of "Evening News", an <code class="codeph">update-node</code> operation.
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-3750C497-D76A-4F95-9DEB-BC047170FF14__BABBHCIA">
                        <p class="titleinexample">Example 8-1 book1.xml</p><pre class="pre codeblock"><code>&lt;?xml version="1.0"?&gt;
&lt;booklist xmlns="http://booklist.oracle.com"&gt;
  &lt;book&gt;    
    &lt;title&gt;Twelve Red Herrings&lt;/title&gt;
    &lt;author&gt;Jeffrey Archer&lt;/author&gt;
    &lt;publisher&gt;Harper Collins&lt;/publisher&gt;
    &lt;price&gt;7.99&lt;/price&gt;      
  &lt;/book&gt;
  &lt;book&gt;
    &lt;title language="English"&gt;The Eleventh Commandment&lt;/title&gt;
    &lt;author&gt;Jeffrey Archer&lt;/author&gt;
    &lt;publisher&gt;McGraw Hill&lt;/publisher&gt;   
    &lt;price&gt;3.99&lt;/price&gt;
  &lt;/book&gt;
  &lt;book&gt;
    &lt;title language="English" country="USA"&gt;C++ Primer&lt;/title&gt;
    &lt;author&gt;Lippmann&lt;/author&gt;
    &lt;publisher&gt;Harper Collins&lt;/publisher&gt;   
    &lt;price&gt;4.99&lt;/price&gt;
  &lt;/book&gt;          
  &lt;book&gt;
    &lt;title&gt;Emperor's New Mind&lt;/title&gt;
    &lt;author&gt;Roger Penrose&lt;/author&gt;
    &lt;publisher&gt;Oxford Publishing Company&lt;/publisher&gt;
    &lt;price&gt;15.9&lt;/price&gt;
  &lt;/book&gt;          
  &lt;book&gt;
    &lt;title&gt;Evening News&lt;/title&gt;
    &lt;author&gt;Arthur Hailey&lt;/author&gt;
    &lt;publisher&gt;MacMillan Publishers&lt;/publisher&gt;
    &lt;price&gt;9.99&lt;/price&gt;
  &lt;/book&gt;  
&lt;/booklist&gt;
</code></pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="ADXDK19837"></a><a id="ADXDK19836"></a><div class="props_rev_3"><a id="GUID-F7B63052-2AC2-4E25-A50D-CF8F0F2ADCAB" name="GUID-F7B63052-2AC2-4E25-A50D-CF8F0F2ADCAB"></a><h4 id="ADXDK-GUID-F7B63052-2AC2-4E25-A50D-CF8F0F2ADCAB" class="sect4">Sample Xdiff Instance Document</h4>
                  <div>
                     <p>A sample <code class="codeph">Xdiff</code> instance document is presented.
                     </p>
                     <div class="section">
                        <p>This section shows the <code class="codeph">Xdiff</code> instance document produced by the comparison of these two XML files described in the previous section. The sections that follow explain the XML processing instructions and the operations on this document.
                        </p>
                        <p>You can invoke <code class="codeph">XmlDiff</code>:
                        </p><pre class="oac_no_warn" dir="ltr">&gt; xmldiff book1.xml book2.xml
</pre><p>You can also examine the sample application for arguments and flags.</p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-F7B63052-2AC2-4E25-A50D-CF8F0F2ADCAB__GUID-911590D7-7364-4788-AFA0-233514ABBEF8">
                        <p class="titleinexample">Example 8-2 Sample Xdiff Instance Document</p><pre class="pre codeblock"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xd:xdiff xsi:schemaLocation="http://xmlns.oracle.com/xdb/xdiff.xsd
xmlns:xd="http://xmlns.oracle.com/xdb/xdiff.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
xmlns:oraxdfns_0="http://booklist.oracle.com"&gt;
<span class="bold">    &lt;?oracle-xmldiff operations-in-docorder="true" output-model="snapshot" </span>
<span class="bold">        diff-algorithm="global"?&gt; </span>
    &lt;xd:delete-node xd:node-type="element" xd:xpath="/oraxdfns_0
              :booklist[1]/oraxdfns_0:book[2]"/&gt;
    &lt;xd:update-node xd:node-type="attribute" 
         xd:parent-xpath="/oraxdfns_0:booklist[1]/oraxdfns_0:book[3]/oraxdfns_0
              :title[1]" xd:attr-local="country"&gt;
                &lt;xd:content&gt;US&lt;/xd:content&gt;
    &lt;/xd:update-node&gt;
    &lt;xd:append-node xd:node-type="element" xd:parent-xpath="/oraxdfns_0
              :booklist[1]/oraxdfns_0:book[4]"&gt;
        &lt;xd:content&gt;
            &lt;oraxdfns_0:description&gt; This is a classic &lt;/oraxdfns_0:description&gt;
        &lt;/xd:content&gt;
    &lt;/xd:append-node&gt;
    &lt;xd:insert-node-before xd:node-type="element" xd:xpath="/oraxdfns_0
              :booklist[1]/oraxdfns_0:book[5]/oraxdfns_0:author[1]"&gt;
        &lt;xd:content&gt;
            &lt;oraxdfns_0:edition&gt;Hardcover&lt;/oraxdfns_0:edition&gt;
        &lt;/xd:content&gt;
    &lt;/xd:insert-node-before&gt;
    &lt;xd:update-node xd:node-type="text" xd:xpath="/oraxdfns_0
           :booklist[1]/oraxdfns_0:book[5]/oraxdfns_0:price[1]/text()[1]"&gt;
        &lt;xd:content&gt;12.99&lt;/xd:content&gt;
    &lt;/xd:update-node&gt;
&lt;/xd:xdiff&gt;</code></pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="ADXDK19838"></a><div class="props_rev_3"><a id="GUID-707B667B-9A93-40E0-A109-1FE89C58BF47" name="GUID-707B667B-9A93-40E0-A109-1FE89C58BF47"></a><h4 id="ADXDK-GUID-707B667B-9A93-40E0-A109-1FE89C58BF47" class="sect4">Output Model and XML Processing Instructions</h4>
                  <div>
                     <p>The <code class="codeph">Xdiff</code> instance document uses some XML processing instructions (shown in bold in the previous section) that are used to represent certain aspects of the differencing process. 
                     </p>
                     <p>See <a href="determining-XML-differences-using-C.html#GUID-F795D8C3-DB9B-4617-B3B6-F66FB8F0BF94" title="An Xdiff XML schema, to which an Xdiff instance document (output) adheres, is presented.">Xdiff Schema</a>. These instructions and related options are:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><code class="codeph">operations-in-docorder</code>: Options are <code class="codeph">true</code> or <code class="codeph">false</code>:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">true</code>—The <code class="codeph">Xdiff</code> instance document refers to the nodes from the first document in the same order as in the document.
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">false</code>—The <code class="codeph">Xdiff</code> instance document does not refer to the nodes from the first document in the same order as in the document.
                                 </p>
                              </li>
                           </ul>
                           <p>The output of global optimization meets the <code class="codeph">operations-in-docorder</code> requirement, but local optimization does not. 
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">output-model</code>: Options are:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">snapshot</code>—<code class="codeph">Xmldiff</code> generates output in snapshot model and follows the UNIX <span class="italic">diff</span> model. Each operation uses <code class="codeph">XPath</code> as if no operations have been applied to the input document. This is the default. <code class="codeph">XmlPatch</code> can handle this model only if <code class="codeph">operations-in-docorder</code> is set to <code class="codeph">true</code> and the <code class="codeph">XPath</code>s are simple. Simple <code class="codeph">XPath</code>s require a child axis, no wild cards, and must use positional predicates, such as <code class="codeph">/root[1]/child[2]/text()[2]</code>.
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">current</code>—Each operation uses <code class="codeph">XPath</code> as if all operations up to the previous one have been applied to the input document. Even though <code class="codeph">XmlDiff</code> does not generate differences in the current model, <code class="codeph">XmlPatch</code> can handle a hand-crafted <code class="codeph">diff</code> document in the current model
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p><code class="codeph">diff-algorithm</code>: Options indicate which optimization generated the differences.
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Global optimization </p>
                              </li>
                              <li>
                                 <p>Local optimization</p>
                              </li>
                           </ul>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="determining-XML-differences-using-C.html#GUID-21B69703-474D-4F5A-9804-DD67F1EBC279" title="There are two optimization options for comparison: global and local optimization.">User Options for Comparison Optimization</a></li>
                        </ul>
                     </div>
                  </div>
                  
               </div><a id="ADXDK1042"></a><a id="ADXDK19839"></a><div class="props_rev_3"><a id="GUID-BBB028EC-736C-4F02-B330-75A03B96C1E6" name="GUID-BBB028EC-736C-4F02-B330-75A03B96C1E6"></a><h4 id="ADXDK-GUID-BBB028EC-736C-4F02-B330-75A03B96C1E6" class="sect4">Xdiff Operations</h4>
                  <div>
                     <p><code class="codeph">XmlDiff</code> captures differences using operations indicated by the <code class="codeph">Xdiff</code> instance document. The <code class="codeph">XmlDiff</code> operations are described.
                     </p>
                     <div class="tblformal" id="GUID-BBB028EC-736C-4F02-B330-75A03B96C1E6__GUID-F418F0B5-0171-45B7-91C2-43BD5FDA9ABD">
                        <p class="titleintable">Table 8-2 Xdiff Operation Attributes</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="Xdiff Operation Attributes" summary="Lists and describes the attributes of an Xdiff operation." width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="31%" id="d26881e1409">Attribute</th>
                                 <th align="left" valign="bottom" width="69%" id="d26881e1412">Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d26881e1417" headers="d26881e1409 ">
                                    <p><code class="codeph">parent-path</code> or <code class="codeph">xpath</code></p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d26881e1417 d26881e1412 ">
                                    <p>Specifies the <code class="codeph">XPATH</code> location of the parent node of the operand node or the <code class="codeph">XPATH</code> location of node.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d26881e1434" headers="d26881e1409 ">
                                    <p><code class="codeph">node-type</code></p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d26881e1434 d26881e1412 ">
                                    <p>Specifies the type of the operand node.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d26881e1442" headers="d26881e1409 ">
                                    <p><code class="codeph">content</code></p>
                                 </td>
                                 <td align="left" valign="top" width="69%" headers="d26881e1442 d26881e1412 ">
                                    <p>Child element that specifies the new subtree or value appended or inserted.</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>The <code class="codeph">Xdiff</code> operations, presented in the <code class="codeph">Xdiff</code> instance document, are:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><code class="codeph">append-node</code>:
                           </p>
                           <p>The <code class="codeph">append-node</code> element specifies that a node of the given type is added as the last child of the given parent. 
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">insert-node-before</code>:
                           </p>
                           <p>The <code class="codeph">insert-node-before</code> element specifies that a node of the given type is inserted before the given reference node.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">delete-node</code>:
                           </p>
                           <p>The <code class="codeph">delete-node</code> element specifies that the node be deleted along with all its children. You can use this element to delete elements, comments, and so on.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">update-node</code>:
                           </p>
                           <p><code class="codeph">update-node</code> specifies that the value associated with the node with the given <code class="codeph">XPath</code> expression is updated to the new value, which is specified. Content is the value for a text node. The value of an attribute is the value for an attribute node. 
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Update for Text Nodes:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>Generation of update node operations can be turned off by the user.</p>
                                    </li>
                                    <li>
                                       <p>The value of an attribute is the value for an attribute node. </p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">update-node</code> is generated for text nodes only by global optimization.
                                       </p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>Update for Elements:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p><code class="codeph">XmlDiff</code> does not generate update operations for element nodes. 
                                       </p>
                                       <p>You can either manually modify the <code class="codeph">Xdiff</code> instance document to create an update operation that works with <code class="codeph">XmlPatch</code>, or provide a totally hand-written <code class="codeph">Xdiff</code> instance document. All children of the element operated on by the update are deleted. Any new subtree specified under the content node is imported.
                                       </p>
                                    </li>
                                 </ul>
                              </li>
                           </ul>
                        </li>
                     </ul>
                  </div>
               </div><a id="ADXDK19840"></a><div class="props_rev_3"><a id="GUID-4BF58AA7-A438-4663-9483-2DEAAC908885" name="GUID-4BF58AA7-A438-4663-9483-2DEAAC908885"></a><h4 id="ADXDK-GUID-4BF58AA7-A438-4663-9483-2DEAAC908885" class="sect4">Format of Xdiff Instance Document</h4>
                  <div>
                     <p>The output of <code class="codeph">XmlDiff</code>, the <code class="codeph">Xdiff</code> instance document, is an XML document that conforms to the <code class="codeph">Xdiff</code> XML schema. The output document contains a sequence of operations describing the differences between the two input documents. If you apply the differences to the first document, you obtain the second document.
                     </p>
                  </div>
               </div><a id="ADXDK19842"></a><a id="ADXDK19841"></a><div class="props_rev_3"><a id="GUID-F795D8C3-DB9B-4617-B3B6-F66FB8F0BF94" name="GUID-F795D8C3-DB9B-4617-B3B6-F66FB8F0BF94"></a><h4 id="ADXDK-GUID-F795D8C3-DB9B-4617-B3B6-F66FB8F0BF94" class="sect4">Xdiff Schema</h4>
                  <div>
                     <p>An <code class="codeph">Xdiff</code> XML schema, to which an <code class="codeph">Xdiff</code> instance document (output) adheres, is presented.
                     </p>
                     <div class="example" id="GUID-F795D8C3-DB9B-4617-B3B6-F66FB8F0BF94__BABJEFEE">
                        <p class="titleinexample">Example 8-3 Xdiff Schema: xdiff.xsd</p><pre class="pre codeblock"><code>&lt;schema targetNamespace="http://xmlns.oracle.com/xdb/xdiff.xsd" 
    xmlns="http://www.w3.org/2001/XMLSchema" 
    xmlns:xd="http://xmlns.oracle.com/xdb/xdiff.xsd" 
    version="1.0" elementFormDefault="qualified"
    attributeFormDefault="qualified"&gt; 
    &lt;annotation&gt; 
        &lt;documentation xml:lang="en"&gt; 
         Defines the structure of XML documents that capture the difference 
         between two XML documents. Changes that are not supported by Oracle 
         XmlDiff may not be expressible in this schema. 
           
       'oracle-xmldiff' PI in Xdiff document:
 
       We use 'oracle-xmldiff' PI to describe certain aspects of the diff.
       The PI denotes values for 'operations-in-docorder' and 'output-model'.
       The output of XmlDiff has the PI always. If the user hand-codes a diff doc
       then it must also have the PI in it as the first child of top level xdiff
       element, to be able to call XmlPatch.
 
       operations-in-docorder: 
       Can be either 'true' or 'false'.
       If true, the operations in the diff document refer to the
       elements of the input doc in the same order as document order. Output of
       global algorithm meets this requirement while local does not.
       
       output-model:
       output models for representing the diff. Can be either 'Snapshot' or 
       'Current'.
 
       Snapshot model:
       Each operation uses Xpaths as if no operations
       have been applied to the input document. (like UNIX diff)
       This is the model used in the output of XmlDiff. XmlPatch works with 
       this (and the current model too).
       For XmlPatch to handle this model, "operations-in-docorder" must be 
       true and the Xpaths must be simple. (see XmlDif C API documentation).
 
       Current model:
       Each operation uses Xpaths as if all operations till the previous one
       have been applied to the input document. Works with XmlPatch even if 
       the 'operations-in-docorder' criterion is not met and the xpaths are 
       not simple.
       &lt;!-- Example:
            &lt;?oracle-xmldiff operations-in-docorder="true" output-model=
            "snapshot" diff-algorithm="global"?&gt;
        --&gt;
      &lt;/documentation&gt; 
    &lt;/annotation&gt; 
    &lt;!-- Enumerate the supported node types --&gt; 
    &lt;simpleType name="xdiff-nodetype"&gt; 
        &lt;restriction base="string"&gt; 
            &lt;enumeration value="element"/&gt; 
            &lt;enumeration value="attribute"/&gt; 
            &lt;enumeration value="text"/&gt; 
            &lt;enumeration value="cdata"/&gt; 
            &lt;enumeration value="entity-reference"/&gt;
            &lt;enumeration value="entity"/&gt;
            &lt;enumeration value="processing-instruction"/&gt;
            &lt;enumeration value="notation"/&gt;
            &lt;enumeration value="comment"/&gt;            
         &lt;/restriction&gt; 
    &lt;/simpleType&gt;
 
    &lt;element name="xdiff"&gt; 
        &lt;complexType&gt; 
            &lt;choice minOccurs="0" maxOccurs="unbounded"&gt; 
                &lt;element name="append-node"&gt; 
                    &lt;complexType&gt; 
                        &lt;sequence&gt; 
                            &lt;element name="content" type="anyType"/&gt; 
                        &lt;/sequence&gt; 
                        &lt;attribute name="node-type" type="xd:xdiff-nodetype"/&gt; 
                        &lt;attribute name="xpath" type="string"/&gt; 
                        &lt;attribute name="parent-xpath" type="string"/&gt; 
                        &lt;attribute name="attr-local" type="string"/&gt;
                        &lt;attribute name="attr-nsuri" type="string"/&gt;
                    &lt;/complexType&gt; 
                &lt;/element&gt;
 
                &lt;element name="insert-node-before"&gt; 
                    &lt;complexType&gt; 
                        &lt;sequence&gt; 
                            &lt;element name="content" type="anyType"/&gt; 
                        &lt;/sequence&gt; 
                        &lt;attribute name="xpath" type="string"/&gt; 
                        &lt;attribute name="node-type" type="xd:xdiff-nodetype"/&gt;
 
                    &lt;/complexType&gt; 
                &lt;/element&gt;
 
                &lt;element name="delete-node"&gt; 
                    &lt;complexType&gt; 
                        &lt;attribute name="node-type" type="xd:xdiff-nodetype"/&gt;
                        &lt;attribute name="xpath" type="string"/&gt; 
                        &lt;attribute name="parent-xpath" type="string"/&gt; 
                        &lt;attribute name="attr-local" type="string"/&gt;
                        &lt;attribute name="attr-nsuri" type="string"/&gt;
                    &lt;/complexType&gt; 
                &lt;/element&gt;
                 &lt;element name="update-node"&gt; 
                    &lt;complexType&gt; 
                        &lt;sequence&gt; 
                            &lt;element name="content" type="anyType"/&gt; 
                        &lt;/sequence&gt; 
                        &lt;attribute name="node-type" type="xd:xdiff-nodetype"/&gt; 
                        &lt;attribute name="parent-xpath" type="string"/&gt; 
                        &lt;attribute name="xpath" type="string"/&gt; 
                        &lt;attribute name="attr-local" type="string"/&gt;
                        &lt;attribute name="attr-nsuri" type="string"/&gt;
                    &lt;/complexType&gt; 
                &lt;/element&gt;
                &lt;element name="rename-node"&gt; 
                    &lt;complexType&gt; 
                        &lt;sequence&gt; 
                            &lt;element name="content" type="anyType"/&gt; 
                        &lt;/sequence&gt; 
                        &lt;attribute name="xpath" type="string"/&gt; 
                        &lt;attribute name="node-type" type="xd:xdiff-nodetype"/&gt; 
                    &lt;/complexType&gt; 
                &lt;/element&gt;
            &lt;/choice&gt; 
         &lt;attribute name="xdiff-version" type="string"/&gt; 
        &lt;/complexType&gt; 
    &lt;/element&gt; 
&lt;/schema&gt;</code></pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="ADXDK19844"></a><a id="ADXDK19843"></a><div class="props_rev_3"><a id="GUID-A210D2A4-B291-4BA5-AA43-2FC2F1DE180D" name="GUID-A210D2A4-B291-4BA5-AA43-2FC2F1DE180D"></a><h4 id="ADXDK-GUID-A210D2A4-B291-4BA5-AA43-2FC2F1DE180D" class="sect4">Using XMLDiff in an Application</h4>
                  <div>
                     <p>In an application, <code class="codeph">XmlDiff</code> takes the source types and locations of the input documents as arguments. The source type can be a URL, file, <code class="codeph">orastream</code> and <code class="codeph">stream</code> context pointers, buffer, and <code class="codeph">buffer_length</code> pointers or the pointer to a DOM document element (<code class="codeph">docelement</code>). 
                     </p>
                     <p><code class="codeph">XmlDiff</code> returns the document node for the DOM for the <code class="codeph">Xdiff</code> instance document.
                     </p>
                     <p>XmlDiff builds the DOM for the two documents, if they are not already provided as DOM, before performing a comparison.</p>
                     <div class="infoboxnotealso" id="GUID-A210D2A4-B291-4BA5-AA43-2FC2F1DE180D__GUID-C52B078B-71D7-45E8-9C6E-172FC550B25B">
                        <p class="notep1">See Also:</p>
                        <p><a href="../caxml/package-XmlDiff-API.html#CAXML6192" target="_blank"><span><cite>Oracle Database XML C API Reference</cite></span></a> for the C API for the flags that control the behavior of <code class="codeph">XmlDiff</code></p>
                     </div>
                     <div class="example" id="GUID-A210D2A4-B291-4BA5-AA43-2FC2F1DE180D__GUID-9D8E4169-0CD1-401C-A097-F0F9D7B70077">
                        <p class="titleinexample">Example 8-4 XMLDiff Application</p><pre class="oac_no_warn" dir="ltr"># include &lt;xmldf.h&gt;
...
xmlctx     *xctx;
xmldocnode *doc1, *doc2, *doc3;
uword       hash_level;
oratext    *s, *inp1 = "book1.xml", *inp2="book2.xml";
xmlerr      err;
ub4         flags;

flags = 0; /* defaults : global algorithm */
hash_level = 0; /* no hashing */
/* create XML meta context */
if (!(xctx = XmlCreate(&amp;err, (oratext *) "XmlDiff", NULL)))
{
   printf("Failed to create XML context, error %u\n",
(unsigned) err);
err_exit("Exiting");
}
/* Load the two input files */
if (!(doc1 = XmlLoadDom(xctx, &amp;err, "file", inp1, "discard_whitespace", TRUE,
 NULL)))
{
   printf("Parsing first file failed, error %u\n", (unsigned)err);
   err_exit((oratext *)"Exiting.");
}
if (!(doc2 = XmlLoadDom(xctx, &amp;err, "file", inp2, "discard_whitespace", TRUE,
    NULL)))
{
   printf("Parsing second file failed, error %u\n", (unsigned)err);
   err_exit((oratext *)"Exiting.");
}
 
/* run XmlDiff on the DOM trees. */
 
doc3 = XmlDiff(xctx, &amp;err, flags, XMLDF_SRCT_DOM, doc1, NULL, XMLDF_SRCT_DOM,
               doc2, NULL,hash_level, NULL);
 
if(!doc3)
   printf("XmlDiff Failed, error %u\n", (unsigned)err);
else
{
if(err != XMLERR_OK)
printf("XmlDiff returned error %u\n", (unsigned)err);
/* Now we have the DOM tree in doc3 which represent the Diff */
...
}
 
XmlFreeDocument(xctx, doc1);
XmlFreeDocument(xctx, doc2);
XmlFreeDocument(xctx, doc3);
XmlDestroy(xctx);</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="ADXDK19846"></a><a id="ADXDK19845"></a><div class="props_rev_3"><a id="GUID-CB4DB221-21E5-4E33-98CC-9E07C28567C0" name="GUID-CB4DB221-21E5-4E33-98CC-9E07C28567C0"></a><h4 id="ADXDK-GUID-CB4DB221-21E5-4E33-98CC-9E07C28567C0" class="sect4">Customized Output</h4>
                  <div>
                     <p>A customized output builder stores differences in any format suitable to the application. You can create your own customized output builder, rather than using the default <code class="codeph">Xdiff</code> instance document, which is generated by <code class="codeph">XmlDiff</code> and that conforms to the <code class="codeph">Xdiff</code> schema.
                     </p>
                     <p>To create a customized output builder, you must provide a callback that can be called after <code class="codeph">XmlDiff</code> determines the differences. The differences are passed to the callback as an array of <code class="codeph">xmdlfop</code>. The callback may be called multiple times as the differences are being generated.
                     </p>
                     <p>Using a customized output builder may perform better than using the default, because it does not have to maintain the internal state necessary for <code class="codeph">XPath</code> generation.
                     </p>
                     <p>By default, <code class="codeph">XmlDiff</code> captures the differences in XML conforming to the <code class="codeph">Xdiff</code> schema. If necessary, plug in your own output builder. The differences are represented as an array <code class="codeph">xmldfop</code>. You must write an output builder callback function. The function signature is:
                     </p><pre class="oac_no_warn" dir="ltr">xmlerr(*xdfobcb)(void *uctx, xmldfop *escript, ub4 escript_siz);
</pre><p><code class="codeph">uctx</code> is the user specific context.
                     </p>
                     <p><code class="codeph">escript</code> is the array of size <code class="codeph">escript_siz</code>:
                     </p><pre class="oac_no_warn" dir="ltr"><code class="codeph">diff[escript_siz]</code>
</pre><p><code class="codeph">mctx</code> is the memory context.
                     </p>
                     <p>Supply this memory context through properties to <code class="codeph">XmlDiff()</code>. Use this memory context to allocate <code class="codeph">escript</code>. You must later free <code class="codeph">escript</code>.
                     </p>
                     <p>Invoke the output builder callback after the differences have been found which happens even before the invocation of <code class="codeph">XmlDiff()</code> returns. The output builder callback can be called multiple times.
                     </p>
                     <div class="example" id="GUID-CB4DB221-21E5-4E33-98CC-9E07C28567C0__GUID-C4B6D5C8-4448-4073-84FD-272679581F03">
                        <p class="titleinexample">Example 8-5 Customized XMLDiff Output</p><pre class="oac_no_warn" dir="ltr"> /* Sample useage:  */
 ...
 #include &lt;orastruc.h&gt; / * for 'oraprop' * /
 ...
 static oraprop diff_props[] = {
    ORAPROP(XMLDF_PROPN_CUSTOM_OB, XMLDF_PROPI_CUSTOM_OB, POINTER),
    ORAPROP(XMLDF_PROPN_CUSTOM_OBMCX, XMLDF_PROPI_CUSTOM_OBMCX, POINTER),
    ORAPROP(XMLDF_PROPN_CUSTOM_OBUCX, XMLDF_PROPI_CUSTOM_OBUCX, POINTER),
        { NULL }
  }; 
  ...
  oramemctx *mymemctx;
  ...
  xmlerr myob(void *uctx,  xmldfop *escript, ub4 escript_siz)
  {
     /* process diff which is available in escript * /
     
     /* free escript - the caller has to do this * /
     OraMemFree(mymemctx, escript);
  }
 
  main()
  {
   ...
      myctxt  *myctx;
 
      diff_props[0].value_oraprop.p_oraprop_v = myob;
      diff_props[1].value_oraprop.p_oraprop_v = mymemctx;
      diff_props[2].value_oraprop.p_oraprop_v = myctx;
      XmlDiff(xctx, &amp;err, 0, doc1, NULL, 0, doc2, NULL, 0, diff_props);
 ...
 </pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div><a id="ADXDK2520"></a><div class="props_rev_3"><a id="GUID-45E03E82-7DE3-49C3-A29A-8AC3091566EE" name="GUID-45E03E82-7DE3-49C3-A29A-8AC3091566EE"></a><h3 id="ADXDK-GUID-45E03E82-7DE3-49C3-A29A-8AC3091566EE" class="sect3">Using XmlPatch</h3>
               <div>
                  <p><code class="codeph">XmlPatch</code> takes an <code class="codeph">Xdiff</code> instance document, generated by <code class="codeph">XmlDiff</code> or created by another mechanism, and follows the instructions in the <code class="codeph">Xdiff</code> instance document to modify other XML documents.
                  </p>
                  <div class="section"></div>
                  <!-- class="section" -->
               </div><a id="ADXDK19847"></a><a id="ADXDK2550"></a><div class="props_rev_3"><a id="GUID-2218E811-A238-4942-A4BF-BE4763ECA2CA" name="GUID-2218E811-A238-4942-A4BF-BE4763ECA2CA"></a><h4 id="ADXDK-GUID-2218E811-A238-4942-A4BF-BE4763ECA2CA" class="sect4">Using the XmlPatch Command-Line Utility</h4>
                  <div>
                     <p>Command-line options for utility <code class="codeph">XmlPatch</code> are described.
                     </p>
                     <div class="section">
                        <div class="tblformal" id="GUID-2218E811-A238-4942-A4BF-BE4763ECA2CA__BABFFEGF">
                           <p class="titleintable">Table 8-3 XmlPatch for C Command-Line Options</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="XmlPatch for C Command-Line Options" summary="This table describes the XmlPatch command-line options. Rows are XmlPatch command line options. First column is option name, second column is description." width="100%" frame="hsides" border="1" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="31%" id="d26881e2185">Option</th>
                                    <th align="left" valign="bottom" width="69%" id="d26881e2188">Description</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d26881e2193" headers="d26881e2185 ">
                                       <p><code class="codeph">-e</code> encoding
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d26881e2193 d26881e2188 ">
                                       <p>Specify default input-file encoding. If no encoding is specified in XML file, this encoding is assumed for input.</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d26881e2202" headers="d26881e2185 ">
                                       <p><code class="codeph">-E</code> encoding 
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d26881e2202 d26881e2188 ">
                                       <p>Specify output/data encoding. DOMs and patched document are created in this encoding. Default is UTF-8. </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d26881e2211" headers="d26881e2185 ">
                                       <p><code class="codeph">-i</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d26881e2211 d26881e2188 ">
                                       <p>Interpret file names as URLs.</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d26881e2219" headers="d26881e2185 ">
                                       <p><code class="codeph">-h</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d26881e2219 d26881e2188 ">
                                       <p>Show this usage help. </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADXDK19849"></a><a id="ADXDK19848"></a><div class="props_rev_3"><a id="GUID-7C4C7410-A8FA-4EE7-9996-31799450485E" name="GUID-7C4C7410-A8FA-4EE7-9996-31799450485E"></a><h4 id="ADXDK-GUID-7C4C7410-A8FA-4EE7-9996-31799450485E" class="sect4">Using XmlPatch in an Application</h4>
                  <div>
                     <p><code class="codeph">XmlPatch</code> takes the source types and locations of the input document and the <code class="codeph">diff</code> document as arguments. The source type can be a URL, file, <code class="codeph">orastream</code> and <code class="codeph">stream</code> context pointers, buffer and <code class="codeph">buffer_length</code> pointers, or the pointer to a DOM document element (<code class="codeph">docelement</code>).
                     </p>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-7C4C7410-A8FA-4EE7-9996-31799450485E__GUID-07697ED1-8946-4A67-AD05-5087FFF23257">
                           <p class="notep1">See Also:</p>
                           <p><a href="../caxml/package-XmlDiff-API.html#CAXML6201" target="_blank"><span><cite>Oracle Database XML C API Reference</cite></span></a> for the C API for the flags that control the behavior of <code class="codeph">XmlPatch</code></p>
                        </div>
                        <p>The modes that were set by the <code class="codeph">Xdiff</code> schema affect how <code class="codeph">XmlPatch</code> works.
                        </p>
                        <p>If the <code class="codeph">output-model</code> is <code class="codeph">Snapshot</code>, <code class="codeph">XmlPatch</code> only works if <code class="codeph">operations-in-docorder</code> is <code class="codeph">TRUE</code>.
                        </p>
                        <p>If the <code class="codeph">output-model</code> is <code class="codeph">Current</code>, it is not necessary that <code class="codeph">operations-in-docorder</code> be set to <code class="codeph">TRUE</code>.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-7C4C7410-A8FA-4EE7-9996-31799450485E__GUID-A71CE5FF-ADAC-457C-A02D-401ABE25AE8E">
                        <p class="titleinexample">Example 8-6 Sample Application for XmlPatch</p><pre class="oac_no_warn" dir="ltr">...
#include &lt;xmldf.h&gt;
...
xmlctx     *xctx;
xmldocnode *doc1, *doc2;
oratext    *s;
oratext    *inp1 = "book1.xml"; /* input document */
oratext    *inp2 = "diff.xml", /* diff document */
xmlerr      err;
 
/* create XML meta context */
if (!(xctx = XmlCreate(&amp;err, (oratext *) "XmlPatch", NULL)))
{
   printf("Failed to create XML context, error %u\n",
(unsigned) err);
err_exit("Exiting");
}
/* Load the two input files */
if (!(doc1 = XmlLoadDom(xctx, &amp;err, "file", inp1, "discard_whitespace", TRUE,
    NULL)))
{
   printf("Parsing first file failed, error %u\n", (unsigned)err);
   err_exit((oratext *)"Exiting.");
}
if (!(doc2 = XmlLoadDom(xctx, &amp;err, "file", inp2, "discard_whitespace", TRUE,
    NULL)))
{
   printf("Parsing second file failed, error %u\n", (unsigned)err);
   err_exit((oratext *)"Exiting.");
}
 
/* call XmlPatch */
if(!XmlPatch(xctx, &amp;err, 0, XMLDF_SRCT_DOM, doc1, NULL, XMLDF_SRCT_DOM,
           doc2, NULL, NULL));
 
   printf("XmlPatch Failed, error %u\n", (unsigned)err);
else
{
if(err != XMLERR_OK)
printf("XmlPatch returned error %u\n", (unsigned)err);
/* Now we have the patched document in doc1 */
...
}
 
XmlFreeDocument(xctx, doc1);
XmlFreeDocument(xctx, doc2);
XmlDestroy(xctx);</pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div><a id="ADXDK19850"></a><a id="ADXDK2530"></a><div class="props_rev_3"><a id="GUID-C0215942-5C76-4B9F-9ECC-B79F48F4F8EF" name="GUID-C0215942-5C76-4B9F-9ECC-B79F48F4F8EF"></a><h3 id="ADXDK-GUID-C0215942-5C76-4B9F-9ECC-B79F48F4F8EF" class="sect3">Using XmlHash</h3>
               <div>
                  <p><code class="codeph">XmlHash</code> computes a hash value for an XML tree. If the hash values of two trees are equal, it is probable that they are the same XML. You can use <code class="codeph">XmlHash</code> to do a quick comparison to see if an XML tree is already in the database.
                  </p>
                  <div class="section">
                     <p>You can run <code class="codeph">XmlDiff</code> again, if necessary, on any matches, to be absolutely certain there is a match. You can compute the hash value of the new document and query the database for it.
                     </p>
                     <p><a href="determining-XML-differences-using-C.html#GUID-C0215942-5C76-4B9F-9ECC-B79F48F4F8EF__BABDABHF">Example 8-7</a> shows a sample program that uses <code class="codeph">XmlHash</code>. 
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-C0215942-5C76-4B9F-9ECC-B79F48F4F8EF__BABDABHF">
                     <p class="titleinexample">Example 8-7 XmlHash Program</p><pre class="pre codeblock"><code>sword main(sword argc, char *argv[])
{
   xmlctx     *xctx;
   xmldfsrct   srct;
   oratext    *data_encoding, *input_encoding, *s, *inp1;
   ub1         flags;
   xmlerr      err;
   ub4         num_args;
   xmlhasht    digest;
   flags = 0; /* defaults */
   srct = XMLDF_SRCT_FILE;
   inp1 = "somexml.xml";
   xctx = XmlCreate(&amp;err, (oratext *) "XmlHash", NULL);
 
   if (!xctx)
   {
      /* handle error with creating xml context and exit */
      ...
   }
 
   /* run XmlHash */
   err = XmlHash(xctx, &amp;digest, 0, srct, inp1, NULL, NULL);
   if(err)
      printf("XmlHash returned error:%d \n", err);
   else
      txdfha_pd(digest);
 
   XmlDestroy(xctx);
 
   return (sword )err;
}
 
/* print bytes in xml hash */
static void txdfha_pd(xmlhasht digest)
{
   ub4  i;
 
   for(i = 0; i &lt; digest.l_xmlhasht; i++)
      printf("%x ", digest.d_xmlhasht[i]);
 
   printf("\n");
}</code></pre></div>
                  <!-- class="example" -->
               </div><a id="ADXDK19851"></a><div class="props_rev_3"><a id="GUID-6DE2C17C-A24B-428D-9BED-9A6FC9E52390" name="GUID-6DE2C17C-A24B-428D-9BED-9A6FC9E52390"></a><h4 id="ADXDK-GUID-6DE2C17C-A24B-428D-9BED-9A6FC9E52390" class="sect4">Invoking XmlDiff and XmlPatch</h4>
                  <div>
                     <p><code class="codeph">XmlDiff</code> and <code class="codeph">XmlPatch</code> can be called as command-line tools and from the C language. They are also available as SQL functions.
                     </p>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-6DE2C17C-A24B-428D-9BED-9A6FC9E52390__GUID-88A4522A-6FF1-4A9D-8643-E5D42F877A9D">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="../sqlrf/XMLDIFF.html#SQLRF20025" target="_blank"><span><cite>Oracle Database SQL Language Reference</cite></span></a> <code class="codeph">XMLDiff</code></p>
                              </li>
                              <li>
                                 <p><a href="../sqlrf/XMLPATCH.html#SQLRF20026" target="_blank"><span><cite>Oracle Database SQL Language Reference</cite></span></a>, <code class="codeph">XMLPatch</code></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>