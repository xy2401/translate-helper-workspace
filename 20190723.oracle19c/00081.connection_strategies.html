<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="A database connection is a physical communication pathway between a client process and a database instance. A database session is a logical entity in the database instance memory that represents the state of a current user login to a database. A session lasts from the time the user is authenticated by the database until the time the user disconnects or exits the database application. A single connection can have 0, 1, or more sessions established on it.">
      <meta name="description" content="A database connection is a physical communication pathway between a client process and a database instance. A database session is a logical entity in the database instance memory that represents the state of a current user login to a database. A session lasts from the time the user is authenticated by the database until the time the user disconnects or exits the database application. A single connection can have 0, 1, or more sessions established on it.">
      <title>Connection Strategies for Database Applications</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Database Development Guide">
      <meta property="og:description" content="A database connection is a physical communication pathway between a client process and a database instance. A database session is a logical entity in the database instance memory that represents the state of a current user login to a database. A session lasts from the time the user is authenticated by the database until the time the user disconnects or exits the database application. A single connection can have 0, 1, or more sessions established on it.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Database Development Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="database-development-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-31T23:23:15-08:00">
      <meta name="dcterms.title" content="Database Development Guide">
      <meta name="dcterms.dateCopyrighted" content="1996, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96334-02">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="design_basics.html" title="Previous" type="text/html">
      <link rel="next" href="performance-and-scalability.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="ADFNS">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="design_basics.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="performance-and-scalability.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Database Development Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="fundamentals.html" property="item" typeof="WebPage"><span property="name">Database Development Fundamentals</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Connection Strategies for Database Applications</li>
            </ol>
            <a id="GUID-90D1249D-38B8-47BF-9829-BA0146BD814A" name="GUID-90D1249D-38B8-47BF-9829-BA0146BD814A"></a>
            
            <h2 id="ADFNS-GUID-90D1249D-38B8-47BF-9829-BA0146BD814A" class="sect2"><span class="enumeration_chapter">2 </span>Connection Strategies for Database Applications
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>A <span class="bold">database connection</span> is a physical communication pathway between a client process and a database instance. A <span class="bold">database session </span>is a logical entity in the database instance memory that represents the state of a current user login to a database. A session lasts from the time the user is authenticated by the database until the time the user disconnects or exits the database application. A single connection can have 0, 1, or more sessions established on it.
               </p>
               <p>Most OLTP performance problems that the Oracle Real-World Performance group investigates relate to the application connection strategy. For this reason, designing a sound connection strategy is crucial for application development, especially in enterprise environments that must scale to meet increasing demand.</p>
               <p>Topics:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="connection_strategies.html#GUID-82AE88EA-B3C8-4416-99AF-7342FE700BD5" title="A connection pool is a cache of connections to an Oracle database that is usable by an application.">Design Guidelines for Connection Pools</a></p>
                  </li>
                  <li>
                     <p><a href="connection_strategies.html#GUID-841C6E1B-00A3-41AA-A5A8-9740E4EBA929" title="A problem facing all database developers is how and when the application logs in to the database to initiate transactions.">Design Guideline for Login Strategy</a></p>
                  </li>
                  <li>
                     <p><a href="connection_strategies.html#GUID-22A9F0BE-987E-4C50-B006-4CF5336C61F4" title="A session leak occurs when a program loses a connection, but its session remains active in the database instance. A leaked session is programmatically lost to the application.">Design Guideline for Preventing Programmatic Session Leaks</a></p>
                  </li>
                  <li>
                     <p><a href="connection_strategies.html#GUID-25F85237-702B-4609-ACE2-1454EBC8284B">Using Runtime Connection Load Balancing</a></p>
                  </li>
               </ul>
            </div>
            <div class="sect2"><a id="GUID-82AE88EA-B3C8-4416-99AF-7342FE700BD5" name="GUID-82AE88EA-B3C8-4416-99AF-7342FE700BD5"></a><h3 id="ADFNS-GUID-82AE88EA-B3C8-4416-99AF-7342FE700BD5" class="sect3">Design Guidelines for Connection Pools</h3>
               <div>
                  <p>A <span class="bold">connection pool</span> is a cache of connections to an Oracle database that is usable by an application.
                  </p>
                  <p>At run time, the application requests a connection from the pool. If the pool contains a connection that can satisfy the request, then it returns the connection to the application. The application uses the connection to perform work on the database, and then returns the connection to the pool. The released connection is then available for the next connection request.</p>
                  <p>In a <span class="bold">static connection pool</span>, the pool contains a fixed number of connections and cannot create more to meet demand. Thus, if the pool cannot find an idle connection to satisfy a new application request, then the request is queued or an error is returned. In a <span class="bold">dynamic connection pool</span>, however, the pool creates a new connection, and then returns it to the application. In theory, dynamic connection pools enable the number of connections in the pool to increase and decrease, thereby conserving system resources that are otherwise lost on maintaining unnecessary connections. However, in practice, a dynamic connection pool strategy allows for potential connection storms and over-subscription problems. 
                  </p>
               </div>
               <div class="sect3"><a id="GUID-1B9A21E9-B8E6-4F75-AC9D-1F5D13A1F6F9" name="GUID-1B9A21E9-B8E6-4F75-AC9D-1F5D13A1F6F9"></a><h4 id="ADFNS-GUID-1B9A21E9-B8E6-4F75-AC9D-1F5D13A1F6F9" class="sect4">Connection Storms</h4>
                  <div>
                     <p>A <span class="bold">connection storm</span> is a race condition in which application servers initiate an increasing number of connection requests, but the database server CPU is unable to schedule them immediately, which causes the application servers to create more connections. 
                     </p>
                     <p>During a connection storm, the number of database connections can soar from hundreds to thousands in less than a minute.</p>
                     <p>Dynamic connection pools are particularly prone to connection storms. As the number of connection requests increases, the database server becomes oversubscribed relative to the number of CPU cores. At any given time, only one process can run on a CPU core. Thus, if 32 cores exist on the server, then only 32 processes can be doing work at one time. If the application server creates hundreds or thousands of connections, then the CPU becomes busy trying to keep up with the number of processes fighting for time on the system.</p>
                     <p>Inside the database, wait activity increases as the number of active sessions increase. You can observe this activity by looking at the wait events in ASH and AWR reports. Typical wait events include latches on enqueues, row cache objects, latch free, enq: TX - index contention, and buffer busy waits. As the wait events increase, the transaction throughput decreases because sessions are unable to perform work. Because the server computer is oversubscribed, monitoring tool processes must fight for time on the CPU. In the most extreme case, using the keyboard becomes impossible, making debugging difficult.</p>
                     <div class="infoboxnote" id="GUID-1B9A21E9-B8E6-4F75-AC9D-1F5D13A1F6F9__NOTE-145-77B840EF">
                        <p class="notep1">Video:</p>
                        <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=vid_oll_rwp_conn_pools_1" target="_blank">RWP #13: Large Dynamic Connection Pools - Part 1</a></p>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-7DFBA826-7CC0-4D16-B19C-31D168069B54" name="GUID-7DFBA826-7CC0-4D16-B19C-31D168069B54"></a><h4 id="ADFNS-GUID-7DFBA826-7CC0-4D16-B19C-31D168069B54" class="sect4">Guideline for Preventing Connection Storms: Use Static Pools</h4>
                  <div>
                     <p>The Oracle Real-World Performance group recommends that you use static connection pools rather than dynamic connection pools. </p>
                     <p>Over years of diagnosing connection storms, the Oracle Real-World Performance group has discovered that dynamic connection pools often use too many processes for the necessary workload. A prevalent myth is that a dynamic connection pool creates connections as required and reduces them when they are not needed. In reality, when the connection pool is exhausted, application servers enable the size of the pool of database connections to increase rapidly. The number of sessions increases with little load on the system, leading to a performance problem when all the sessions become active.</p>
                     <p>Because dynamic connection pools can destabilize the system quickly, the Oracle Real-World Performance group recommends that you use static rather than dynamic connection pools.</p>
                     <p>Reducing the number of connections reduces the stress on the CPU, which leads to faster response time and higher throughput. This result may seem paradoxical. Performance improves for the following reasons:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Fewer sessions means fewer contention-related wait events inside the database. After reducing connections, the CPU that formerly consumed cycles on latches and arbitrating contention can spend more time processing database transactions.</p>
                        </li>
                        <li>
                           <p>As the number of connections decreases, connections can stay scheduled on the CPU for longer. As a result, all memory pages associated with these processes stay resident in the CPU cache. They become increasingly efficient at scheduling, and stall less in memory</p>
                        </li>
                     </ul>
                     <p>As a rule of thumb, the Oracle Real-World Performance group recommends a 90/10 ratio of %user to %system CPU utilization, and an average of no more than 10 processes per CPU core on the database server. The number of connections should be based on the number of CPU cores and not the number of CPU core threads. For example, suppose a server has 2 CPUs and each CPU has 18 cores. Each CPU core has 2 threads. Based on the Oracle Real-Wold Performance group guidelines, the application can have between 36 and 360 connections to the database instance.</p>
                     <div class="infoboxnote" id="GUID-7DFBA826-7CC0-4D16-B19C-31D168069B54__NOTE-147-77B8A1C4">
                        <p class="notep1">Video:</p>
                        <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=vid_oll_rwp_conn_pools_2" target="_blank">RWP #14: Large Dynamic Connection Pools - Part 2</a></p>
                     </div>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-841C6E1B-00A3-41AA-A5A8-9740E4EBA929" name="GUID-841C6E1B-00A3-41AA-A5A8-9740E4EBA929"></a><h3 id="ADFNS-GUID-841C6E1B-00A3-41AA-A5A8-9740E4EBA929" class="sect3">Design Guideline for Login Strategy</h3>
               <div>
                  <p>A problem facing all database developers is how and when the application logs in to the database to initiate transactions.</p>
                  <p>In a suboptimal design, the database application performs the following steps for every SQL request:</p>
                  <ol>
                     <li>
                        <p>Log in to the database.</p>
                     </li>
                     <li>
                        <p>Issue a SQL request, such as an <code class="codeph">INSERT</code> or <code class="codeph">UPDATE</code> statement.
                        </p>
                     </li>
                     <li>
                        <p>Log out of the database.</p>
                     </li>
                  </ol>
                  <p>Applications that use a login/logout strategy may meet functional requirements. Also, they may perform well when the number of transactions per second is low. However, logging in and out of the database is an extremely resource-intensive operation. The Oracle Real-World Performance group has found that applications that use such algorithms do not scale well and can cause severe performance problems, especially when used with dynamic connection pools. A login/logout strategy usually uses no connection pool.</p>
                  <p>If an application uses a login/logout design, and if the DBAs and developers do not realize the source of the problem, then the first symptoms may be low database throughput and erratic, excessively high response times. A diagnostic investigation of the database may show that relatively few sessions are active, while resource contention is low.</p>
                  <p>The clue to the suboptimal performance is that the number of logins per second is close to the number of transactions per second. When a login/loutout per transaction stategy is used, the database instance and operating system perform a lot of work behind the scenes to create the new process, database connection, and associated memory area. Many of these steps are serialized, leading to low CPU utilization combine with low transaction througput.</p>
                  <p>For the preceding reasons, the Oracle Real-World Performance group strongly recommends against a login/logout design for any application that must scale to support a high number of transactions.</p>
                  <div class="infoboxnote" id="GUID-841C6E1B-00A3-41AA-A5A8-9740E4EBA929__NOTE-148-77B95D8F">
                     <p class="notep1">Video:</p>
                     <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=vid_oll_rwp_cursor_logon" target="_blank">RWP #2 Bad Performance with Cursors and Logons</a></p>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-22A9F0BE-987E-4C50-B006-4CF5336C61F4" name="GUID-22A9F0BE-987E-4C50-B006-4CF5336C61F4"></a><h3 id="ADFNS-GUID-22A9F0BE-987E-4C50-B006-4CF5336C61F4" class="sect3">Design Guideline for Preventing Programmatic Session Leaks</h3>
               <div>
                  <p>A <span class="bold">session leak </span>occurs when a program loses a connection, but its session remains active in the database instance. A leaked session is programmatically lost to the application.
                  </p>
                  <p>An optimally designed application prevents session leaks. Typically, session leaks occur because of exceptions caught by the application. If the application does not handle the exception correctly, then it may terminate the connection without executing a commit or rollback, thus leaking the session.</p>
                  <p>Session leaks can cause severe problems for database performance and data integrity. Typically, the problems take the following forms: </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Drained connection pools</p>
                     </li>
                     <li>
                        <p>Lock leaks</p>
                     </li>
                     <li>
                        <p>Logical corruption</p>
                     </li>
                  </ul>
               </div>
               <div class="sect3"><a id="GUID-FC30AE85-A3E7-4D78-8C33-FE982279CFBB" name="GUID-FC30AE85-A3E7-4D78-8C33-FE982279CFBB"></a><h4 id="ADFNS-GUID-FC30AE85-A3E7-4D78-8C33-FE982279CFBB" class="sect4">Drained Connection Pools</h4>
                  <div>
                     <p>Design flaws can cause connection pools to drain. </p>
                     <p>For example, assume that an application design flaw causes it to leak sessions consistently. Even if the leak rate is low, a dynamic connection pool leads to an ever-increasing number of sessions become programmatically impossible to use. </p>
                     <p>The effect is to reduce the usable connection pool and prevent the remaining connections from keeping up with the workload. The number of unusable sessions climbs until there are no usable connections left in the pool.</p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-DDF4D9DF-F872-4C58-AD7D-CD45E10458FA" name="GUID-DDF4D9DF-F872-4C58-AD7D-CD45E10458FA"></a><h4 id="ADFNS-GUID-DDF4D9DF-F872-4C58-AD7D-CD45E10458FA" class="sect4">Checking for Session Leaks</h4>
                  <div>
                     <p>Session leaks occur due to issues in the application or application server and cannot be fixed from the database alone. The issue needs to be addressed in the application or application server. An easy way to check for session leaks is by modifying the connection pool to use one connection to the database and test the application. Testing with one connection makes it is easier to find the root cause of the problem in the application.</p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-76A3AA5F-3EC8-4302-907C-56294823E120" name="GUID-76A3AA5F-3EC8-4302-907C-56294823E120"></a><h4 id="ADFNS-GUID-76A3AA5F-3EC8-4302-907C-56294823E120" class="sect4">Lock Leaks</h4>
                  <div>
                     <p>A <span class="bold">lock leak</span> is typically a side-effect of a session leak. 
                     </p>
                     <p>For example, a leaked session that was in the middle of a batch update may hold TX locks on multiple rows in a table. If a leaked session is holding a lock, then sessions that want to acquire the lock form a queue behind the leaked session.</p>
                     <p>The program that is holding the lock is waiting for interaction from the client to release that lock, but because the connection is lost programmatically, the message will not be sent. Consequently, the database cannot commit or roll back any transaction active in the session.</p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-EB9BD859-00C0-43E3-AB7A-D7F2B205E387" name="GUID-EB9BD859-00C0-43E3-AB7A-D7F2B205E387"></a><h4 id="ADFNS-GUID-EB9BD859-00C0-43E3-AB7A-D7F2B205E387" class="sect4">Logical Corruption</h4>
                  <div>
                     <p>A leaked session can contain uncommitted changes to the database. For example, a transaction is partway through its work when the database connection is unexpectedly released. </p>
                     <p>This situation can lead to the following problems:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The application reports an error to the UI. In this case, customers may complain that they have lost work, for example, a business order or a flight schedule</p>
                        </li>
                        <li>
                           <p>The UI receive a commit message even though no commit or rollback has occurred. This is the worst case, because a subsequent transaction might commit both its own work and the half of the transaction from the leaked session. In this case, the database is logically corrupted.</p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div><a id="ADFNS514"></a><a id="ADFNS229"></a><div class="props_rev_3"><a id="GUID-25F85237-702B-4609-ACE2-1454EBC8284B" name="GUID-25F85237-702B-4609-ACE2-1454EBC8284B"></a><h3 id="ADFNS-GUID-25F85237-702B-4609-ACE2-1454EBC8284B" class="sect3">Using Runtime Connection Load Balancing</h3>
               <div>
                  <div class="section">
                     <p class="subhead2" id="GUID-25F85237-702B-4609-ACE2-1454EBC8284B__GUID-E3C2AE93-28B5-4CB7-BC79-85D179CD8422">Topics:</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="connection_strategies.html#GUID-27FA9E68-80C0-47DF-A6C8-E82D9C14072A">About Runtime Connection Load Balancing</a></p>
                        </li>
                        <li>
                           <p><a href="connection_strategies.html#GUID-6FD17B29-2BBB-497E-9FD2-17897A2C4756">Enabling and Disabling Runtime Connection Load Balancing</a></p>
                        </li>
                        <li>
                           <p><a href="connection_strategies.html#GUID-322FFE9C-25EC-4249-8C17-3689AB80019B">Receiving Load Balancing Advisory FAN Events</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS515"></a><div class="props_rev_3"><a id="GUID-27FA9E68-80C0-47DF-A6C8-E82D9C14072A" name="GUID-27FA9E68-80C0-47DF-A6C8-E82D9C14072A"></a><h4 id="ADFNS-GUID-27FA9E68-80C0-47DF-A6C8-E82D9C14072A" class="sect4">About Runtime Connection Load Balancing</h4>
                  <div>
                     <p>Oracle Real Application Clusters (Oracle RAC) is a database option in which a single database is hosted by multiple instances on multiple nodes. The Oracle RAC shared disk method of clustering databases increases scalability. The nodes can easily be added or freed to meet current needs and improve availability, because if one node fails, another can assume its workload. Oracle RAC adds high availability and failover capacity to the database, because all instances have access to the whole database.</p>
                     <p>Work requests are balanced at both connect time (<span class="bold">connect time load balancing</span>, provided by Oracle Net Services) and runtime (<span class="bold">runtime connection load balancing</span>). For Oracle RAC environments, session pools use service metrics received from the Oracle RAC load balancing advisory through Fast Application Notification (FAN) events to balance application session requests. The work requests coming into the session pool can be distributed across the instances of Oracle RAC offering a service, using the current service performance.
                     </p>
                     <p>Connect time load balancing occurs when an application creates a session. Pooled sessions must be well distributed across Oracle RAC instances when the sessions are created to ensure that sessions on each instance can execute work.</p>
                     <p>Runtime connection load balancing occurs when an application selects a session from an existing session pool (and thus is a very frequent activity). Runtime connection load balancing routes work requests to sessions in a session pool that best serve the work. For session pools that support services at only one instance, the first available session in the pool is adequate. When the pool supports services that span multiple instances, the work must be distributed across instances so that the instances that are providing better service or have greater capacity get more work requests.</p>
                     <p>OCI, OCCI, JDBC, and ODP.NET client applications all support runtime connection load balancing.</p>
                     <div class="infoboxnotealso" id="GUID-27FA9E68-80C0-47DF-A6C8-E82D9C14072A__GUID-C0171821-6769-4804-98DB-17BE152FB228">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">cdemosp.c</code> in the directory <code class="codeph">demo</code></p>
                           </li>
                           <li>
                              <p><a href="performance-and-scalability.html#GUID-015CA8C1-2386-4626-855D-CC546DDC1086" title="You can use the OCISessionPoolCreate API to set a connection class as HRMS.You can use the OCISessionPoolCreate API to create a connection class as RECMS.">Using Database Resident Connection Pool</a></p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI09100" target="_blank"><span class="italic">Oracle Call Interface Programmer's Guide</span></a></p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNCPP20028" target="_blank"><span class="italic">Oracle C++ Call Interface Programmer's Guide</span></a></p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=JJDBC28747" target="_blank"><span class="italic">Oracle Database JDBC Developer's Guide</span></a></p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=JJUAR" target="_blank"><span class="italic">Oracle Universal Connection Pool for JDBC Java API Reference</span></a></p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ODPNT-GUID-3515AA3B-9F5E-4FA4-8550-7908F26794D1" target="_blank"><span><cite>Oracle Data Provider for .NET Developer's Guide for Microsoft Windows</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="ADFNS1447"></a><a id="ADFNS516"></a><div class="props_rev_3"><a id="GUID-6FD17B29-2BBB-497E-9FD2-17897A2C4756" name="GUID-6FD17B29-2BBB-497E-9FD2-17897A2C4756"></a><h4 id="ADFNS-GUID-6FD17B29-2BBB-497E-9FD2-17897A2C4756" class="sect4">Enabling and Disabling Runtime Connection Load Balancing</h4>
                  <div>
                     <p>Enabling and disabling runtime connection load balancing on the client depends on the client environment.</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-6FD17B29-2BBB-497E-9FD2-17897A2C4756__GUID-A1A2F663-F7C4-44CE-B468-2888F6C6D347">Topics:</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="connection_strategies.html#GUID-1807C0D6-EE3C-4633-AF4D-157B40BAA68F">OCI</a></p>
                           </li>
                           <li>
                              <p><a href="connection_strategies.html#GUID-A745449F-8952-4322-BC13-8077A3A93C73">OCCI</a></p>
                           </li>
                           <li>
                              <p><a href="connection_strategies.html#GUID-106CCFB7-2B68-4639-8209-53B0359B1D5C">JDBC</a></p>
                           </li>
                           <li>
                              <p><a href="connection_strategies.html#GUID-57AC1910-FB60-456C-8113-861623D05F30">ODP.NET</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div><a id="ADFNS1448"></a><div class="props_rev_3"><a id="GUID-1807C0D6-EE3C-4633-AF4D-157B40BAA68F" name="GUID-1807C0D6-EE3C-4633-AF4D-157B40BAA68F"></a><h5 id="ADFNS-GUID-1807C0D6-EE3C-4633-AF4D-157B40BAA68F" class="sect5">OCI</h5>
                     <div>
                        <div class="section">
                           <p>For an OCI client application, runtime connection load balancing is enabled by default in an Oracle Database 11<span class="italic">g</span> Release 1 (11.1) or later client communicating with a server of Oracle Database 10<span class="italic">g</span> Release 2 (10.2) or later when you perform the following operations to ensure that your application receives service metrics based on service time:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Link the application with the threads library.</p>
                              </li>
                              <li>
                                 <p>Create the OCI environment in <code class="codeph">OCI_EVENTS</code> and <code class="codeph">OCI_THREADED</code> modes.
                                 </p>
                              </li>
                              <li>
                                 <p>Configure the load balancing advisory goal and the connection load balancing goal for a service that is used by the session pool.</p>
                              </li>
                           </ul>
                           <p>To disable runtime connection load balancing for an OCI client, set the <code class="codeph">mode</code> parameter to <code class="codeph">OCI_SPC_NO_RLB</code> when calling <code class="codeph">OCISessionPoolCreate()</code>.
                           </p>
                           <p>FAN HA (FCF) for OCI requires <code class="codeph">AQ_HA_NOTIFICATIONS</code> for the service to be <code class="codeph">TRUE</code>.
                           </p>
                           <div class="infoboxnotealso" id="GUID-1807C0D6-EE3C-4633-AF4D-157B40BAA68F__GUID-4178DF4B-17AD-48AA-9D70-04496BD52E2D">
                              <p class="notep1">See Also:</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI17124" target="_blank"><span class="italic">Oracle Call Interface Programmer's Guide</span></a> for information about <code class="codeph">OCISessionPoolCreate()</code></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="ADFNS1449"></a><div class="props_rev_3"><a id="GUID-A745449F-8952-4322-BC13-8077A3A93C73" name="GUID-A745449F-8952-4322-BC13-8077A3A93C73"></a><h5 id="ADFNS-GUID-A745449F-8952-4322-BC13-8077A3A93C73" class="sect5">OCCI</h5>
                     <div>
                        <div class="section">
                           <p>For an OCCI client application, runtime connection load balancing is enabled by default in an Oracle Database 11<span class="italic">g</span> Release 1 (11.1) or later client communicating with a server of Oracle Database 10<span class="italic">g</span> Release 2 (10.2) or later when you perform the following operations:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Link the application with the threads library.</p>
                              </li>
                              <li>
                                 <p>Create the OCCI environment in <code class="codeph">EVENTS</code> and <code class="codeph">THREADED_MUTEXED</code> modes.
                                 </p>
                              </li>
                              <li>
                                 <p>Configure the load balancing advisory goal and the connection load balancing goal for a service that is used by the session pool.</p>
                              </li>
                           </ul>
                           <p>To disable runtime connection load balancing for an OCCI client, use the <code class="codeph">NO_RLB</code> option for the <code class="codeph">PoolType</code> attribute of the <code class="codeph">StatelessConnectionPool</code> <code class="codeph">Class</code>.
                           </p>
                           <p>FAN HA (FCF) for OCCI requires <code class="codeph">AQ_HA_NOTIFICATIONS</code> for the service to be <code class="codeph">TRUE</code>.
                           </p>
                           <div class="infoboxnotealso" id="GUID-A745449F-8952-4322-BC13-8077A3A93C73__GUID-2CB1BB63-C7E0-4EC8-BCF2-EAAF73BB7295">
                              <p class="notep1">See Also:</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNCPP20491" target="_blank"><span class="italic">Oracle C++ Call Interface Programmer's Guide</span></a> for more information about runtime load balancing using the OCCI interface
                              </p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="ADFNS1450"></a><div class="props_rev_3"><a id="GUID-106CCFB7-2B68-4639-8209-53B0359B1D5C" name="GUID-106CCFB7-2B68-4639-8209-53B0359B1D5C"></a><h5 id="ADFNS-GUID-106CCFB7-2B68-4639-8209-53B0359B1D5C" class="sect5">JDBC</h5>
                     <div>
                        <div class="section">
                           <p>In the JDBC environment, runtime connection load balancing is enabled by default in an Oracle Database 11<span class="italic">g</span> Release 1 (11.1) or later client communicating with a server of Oracle Database 10<span class="italic">g</span> Release 2 (10.2) or later when Fast Connection Failover (FCF) is enabled.
                           </p>
                           <p>In the JDBC environment, runtime connection load balancing relies on the Oracle Notification Service (ONS) infrastructure, which uses the same out-of-band ONS event mechanism used by FCF processing. No additional setup or configuration of ONS is required to benefit from runtime connection load balancing.</p>
                           <p>To disable runtime connection load balancing in the JDBC environment, call <code class="codeph">setFastConnectionFailoverEnabled()</code> with a value of false.
                           </p>
                           <div class="infoboxnotealso" id="GUID-106CCFB7-2B68-4639-8209-53B0359B1D5C__GUID-E47B87D0-E479-4113-976F-80276326026E">
                              <p class="notep1">See Also:</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=JJDBC28829" target="_blank"><span class="italic">Oracle Database JDBC Developer's Guide</span></a> for more information about runtime load balancing using the JDBC interface
                              </p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="ADFNS1451"></a><div class="props_rev_3"><a id="GUID-57AC1910-FB60-456C-8113-861623D05F30" name="GUID-57AC1910-FB60-456C-8113-861623D05F30"></a><h5 id="ADFNS-GUID-57AC1910-FB60-456C-8113-861623D05F30" class="sect5">ODP.NET</h5>
                     <div>
                        <div class="section">
                           <p>In an ODP.NET client application, runtime connection load balancing is disabled by default. To enable runtime connection load balancing, include "<code class="codeph">Load Balancing=true</code>" in the connection string and make sure “<code class="codeph">Pooling=true</code>” (default).
                           </p>
                           <p>FAN HA (FCF) for ODP.NET requires <code class="codeph">AQ_HA_NOTIFICATIONS</code> for the service to be <code class="codeph">TRUE</code>.
                           </p>
                           <div class="infoboxnotealso" id="GUID-57AC1910-FB60-456C-8113-861623D05F30__GUID-38EA6265-6151-42A6-9040-52E567FF1DF2">
                              <p class="notep1">See Also:</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ODPNT-GUID-3515AA3B-9F5E-4FA4-8550-7908F26794D1" target="_blank"><span><cite>Oracle Data Provider for .NET Developer's Guide for Microsoft Windows</cite></span></a> for more information about runtime load balancing
                              </p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="ADFNS517"></a><div class="props_rev_3"><a id="GUID-322FFE9C-25EC-4249-8C17-3689AB80019B" name="GUID-322FFE9C-25EC-4249-8C17-3689AB80019B"></a><h4 id="ADFNS-GUID-322FFE9C-25EC-4249-8C17-3689AB80019B" class="sect4">Receiving Load Balancing Advisory FAN Events</h4>
                  <div>
                     <div class="section">
                        <p>Your application can receive load balancing advisory FAN events only if all of these requirements are met:</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Oracle RAC environment with Oracle Clusterware is set up and enabled.</p>
                           </li>
                           <li>
                              <p>The server is configured to issue event notifications.</p>
                           </li>
                           <li>
                              <p>The application is linked with the threads library.</p>
                           </li>
                           <li>
                              <p>The OCI environment is created in <code class="codeph">OCI_EVENTS</code> and <code class="codeph">OCI_THREADED</code> modes.
                              </p>
                           </li>
                           <li>
                              <p>The OCCI environment is created in <code class="codeph">THREADED_MUTEXED</code> and <code class="codeph">EVENTS</code> modes.
                              </p>
                           </li>
                           <li>
                              <p>You configured or modified the Oracle RAC environment using the <code class="codeph">DBMS_SERVICE</code> package.
                              </p>
                              <p>You must modify the service to set up its goal and the connection load balancing goal as follows:</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_SERVICE.MODIFY_SERVICE("myService",
     DBMS_SERVICE.GOAL_SERVICE_TIME,
     clb_goal =&gt; DBMS_SERVICE.CLB_GOAL_SHORT);
</pre><p>The constant <code class="codeph">GOAL_SERVICE_TIME</code> specifies that Load Balancing Advisory is based on elapsed time for work done in the service plus bandwidth available to the service.
                              </p>
                              <p>The constant <code class="codeph">CLB_GOAL_SHORT</code> specifies that connection load balancing uses Load Balancing Advisory, when Load Balancing Advisory is enabled.You can set the connection balancing goal to <code class="codeph">CLB_GOAL_LONG</code>. However, <code class="codeph">CLB_GOAL_LONG</code> is typically useful for closed workloads (that is, when the rate of completing work is equal to the rate of starting new work).
                              </p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-322FFE9C-25EC-4249-8C17-3689AB80019B__GUID-343FAFD3-F657-4EA2-85B0-D62091178766">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=RACAD8286" target="_blank"><span class="italic">Oracle Real Application Clusters Administration and Deployment Guide</span></a> for information about enabling OCI clients to receive FAN events
                                 </p>
                              </li>
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ARPLS092" target="_blank"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about <code class="codeph">DBMS_SERVICE</code> 
                                 </p>
                              </li>
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI17124" target="_blank"><span class="italic">Oracle Call Interface Programmer's Guide</span></a> for information about <code class="codeph">OCISessionPoolCreate()</code></p>
                              </li>
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=JJDBC28748" target="_blank"><span class="italic">Oracle Database JDBC Developer's Guide</span></a> for more information about runtime load balancing using the JDBC interface
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>