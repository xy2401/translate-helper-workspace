<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="You can create XMLType views over relational and object-relational data.">
      <meta name="description" content="You can create XMLType views over relational and object-relational data.">
      <title>XMLType Views</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Developer's Guide ">
      <meta property="og:description" content="You can create XMLType views over relational and object-relational data.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="xml-db-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-03-30T12:32:42-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="2002, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96222-03">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="relational-views-over-XML-data.html" title="Previous" type="text/html">
      <link rel="next" href="XMLType-APIs.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="XML DB Developer's Guide">
    <meta name="dcterms.isVersionOf" content="ADXDB">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="relational-views-over-XML-data.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="XMLType-APIs.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Developer's Guide </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="relational-data-to-and-from-XML-data.html" property="item" typeof="WebPage"><span property="name"> Relational Data To and From XML Data</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> XMLType Views</li>
            </ol>
            <a id="GUID-9F0A7B1F-269B-411F-AD8B-8F1CB2E2A671" name="GUID-9F0A7B1F-269B-411F-AD8B-8F1CB2E2A671"></a><a id="ADXDB1800"></a>
            
            <h2 id="ADXDB-GUID-9F0A7B1F-269B-411F-AD8B-8F1CB2E2A671" class="sect2"><span class="enumeration_chapter">10 </span> XMLType Views
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>You can create <code class="codeph">XMLType</code> views over relational and object-relational data.
               </p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="XMLType-views.html#GUID-EF747930-3691-4BFA-B1C7-99FC449C3BFE">What Are XMLType Views?</a><br><code class="codeph">XMLType</code> views wrap existing relational and object-relational data in XML formats. This lets you use existing data in contexts that expect XML data and exploit XML features, including XML Schema.
                  </li>
                  <li class="ulchildlink"><a href="XMLType-views.html#GUID-30E3C3B8-46F7-4D1E-97DE-B7A261BC2995">CREATE VIEW for XMLType Views: Syntax</a><br>The syntax for the <code class="codeph">CREATE VIEW</code> clause for creating <code class="codeph">XMLType</code> views is presented.
                  </li>
                  <li class="ulchildlink"><a href="XMLType-views.html#GUID-69A4022C-9FCA-4529-8A29-084EB2185FCF">Creating Non-Schema-Based XMLType Views</a><br>The XML data in a non XML Schema-based <code class="codeph">XMLType</code> view is not constrained to conform to a registered XML schema. You can create a non-schema-based <code class="codeph">XMLType</code> view using SQL/XML publishing functions.
                  </li>
                  <li class="ulchildlink"><a href="XMLType-views.html#GUID-4BA4C794-3CAA-43D6-B8C4-5FE946FC1134">Creating XML Schema-Based XMLType Views</a><br>The XML data in an XML Schema-based <code class="codeph">XMLType</code> view is constrained to conform to an XML schema. You can create a schema-based <code class="codeph">XMLType</code> view using SQL/XML publishing functions or using object types or views.
                  </li>
                  <li class="ulchildlink"><a href="XMLType-views.html#GUID-5191DBB9-EEA9-402C-BAD2-28AB6894E63D">Creating XMLType Views from XMLType Tables</a><br>An <code class="codeph">XMLType</code> view can be created on an <code class="codeph">XMLType</code> table, for example, to transform the XML data or to restrict the rows returned. 
                  </li>
                  <li class="ulchildlink"><a href="XMLType-views.html#GUID-72A94695-5890-4BA1-8FD1-6D26E1C4349B">Referencing XMLType View Objects Using SQL Function REF</a><br>You can reference an <code class="codeph">XMLType</code> view object using SQL function <code class="codeph">ref</code>.
                  </li>
                  <li class="ulchildlink"><a href="XMLType-views.html#GUID-FF5B6A10-191B-45E0-810F-A7F0CFF71711">Using DML (Data Manipulation Language) on XMLType Views</a><br>A given <code class="codeph">XMLType</code> view might not be implicitly updatable. In that case, you must write instead-of triggers to handle all DML. To determine whether an <code class="codeph">XMLType</code> view is implicitly updatable, query it to see whether it is based on an object view or constructor that is itself inherently updatable.
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>Parent topic:</strong> <a href="relational-data-to-and-from-XML-data.html#GUID-52910135-EC23-41B2-97EC-116790BF6A3C" title="There are various ways that you can view existing relational data as XML data.">Relational Data To and From XML Data</a></p>
                  </div>
               </div>
            </div>
            <a id="ADXDB5166"></a><div class="props_rev_3"><a id="GUID-EF747930-3691-4BFA-B1C7-99FC449C3BFE" name="GUID-EF747930-3691-4BFA-B1C7-99FC449C3BFE"></a><h3 id="ADXDB-GUID-EF747930-3691-4BFA-B1C7-99FC449C3BFE" class="sect3"><span class="enumeration_section">10.1 </span>What Are XMLType Views?
               </h3>
               <div>
                  <p><code class="codeph">XMLType</code> views wrap existing relational and object-relational data in XML formats. This lets you use existing data in contexts that expect XML data and exploit XML features, including XML Schema.
                  </p>
                  <p>The major advantages of using <code class="codeph">XMLType</code> views are:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>You can exploit Oracle XML&nbsp;DB XML features that use XML Schema functionality without having to migrate your base legacy data. </p>
                     </li>
                     <li>
                        <p>With <code class="codeph">XMLType</code> views, you can experiment with various forms of storage for your data. You need not decide immediately whether to store it as <code class="codeph">XMLType</code> or which <code class="codeph">XMLType</code> storage model to use. 
                        </p>
                     </li>
                  </ul>
                  <p><code class="codeph">XMLType</code> views are similar to object views. Each row of an <code class="codeph">XMLType</code> view corresponds to an <code class="codeph">XMLType</code> instance. The object identifier for uniquely identifying each row in the view can be created using SQL/XML functions <code class="codeph">XMLCast</code> and <code class="codeph">XMLQuery</code>.
                  </p>
                  <p>There are two types of <code class="codeph">XMLType</code> views:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><strong class="term">Non-schema-based XMLType views. </strong>These views do not confirm to a particular XML schema. 
                        </p>
                     </li>
                     <li>
                        <p><strong class="term">XML schema-based XMLType views.</strong> As with <code class="codeph">XMLType</code> tables, <code class="codeph">XMLType</code> views that conform to a particular XML schema are called XML schema-based <code class="codeph">XMLType</code> views. These provide stronger typing than non-schema-based <code class="codeph">XMLType</code> views. 
                        </p>
                     </li>
                  </ul>
                  <p>XPath rewrite of queries over <code class="codeph">XMLType</code> views is enabled for both XML schema-based and non-schema-based <code class="codeph">XMLType</code> views. XPath rewrite is described in <a href="XPath-rewrite-for-object-relational-storage.html#GUID-35551023-CCAC-477B-8BBF-CD0E0B44C962" title="For XMLType data stored object-relationally, queries involving XPath expression arguments to various SQL functions can often be automatically rewritten to queries against the underlying SQL tables, which are highly optimized.">XPath Rewrite for Object-Relational Storage</a>.
                  </p>
                  <p>To create an XML schema-based <code class="codeph">XMLType</code> view, first register your XML schema. If the view is an object view, that is, if it is constructed using an object type, then the XML schema should have annotations that represent the bidirectional mapping from XML to SQL object types. <code class="codeph">XMLType</code> views conforming to this registered XML schema can then be created by providing an underlying query that constructs instances of the appropriate SQL object type.
                  </p>
                  <p>You can create <code class="codeph">XMLType</code> views in any of the following ways:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Based on SQL/XML publishing functions, such as <code class="codeph">XMLElement</code>, <code class="codeph">XMLForest</code>, <code class="codeph">XMLConcat</code>, and <code class="codeph">XMLAgg</code>. SQL/XML publishing functions can be used to construct both non-schema-based <code class="codeph">XMLType</code> views and XML schema-based <code class="codeph">XMLType</code> views. This enables construction of <code class="codeph">XMLType</code> view from the underlying relational tables directly without physically migrating those relational legacy data into XML. However, to construct XML schema-based <code class="codeph">XMLType</code> view, the XML schema must be registered and the XML value generated by SQL/XML publishing functions must be constrained to the XML schema.
                        </p>
                     </li>
                     <li>
                        <p>Based on object types or object views. This enables the construction of the <code class="codeph">XMLType</code> view from underlying relational or object relational tables directly without physically migrating the relational or object relational legacy data into XML. Creating an XML-schema-based <code class="codeph">XMLType</code> view requires that you annotate the XML schema with a mapping to existing object types or that you generate the XML schema from the existing object types.
                        </p>
                     </li>
                     <li>
                        <p>Directly from an <code class="codeph">XMLType</code> table.
                        </p>
                     </li>
                  </ul>
                  <div class="section"></div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="XML-Schema-and-query-basic.html#GUID-C09824C1-6B02-4556-A265-B1749DEE8DE1" title="XML Schema is a standard for describing the content and structure of XML documents. You can register, update, and delete an XML schema used with Oracle XML&nbsp;DB. You can define storage structures to use for your XML schema-based data and map XML Schema data types to SQL data types.">XML Schema Storage and Query: Basic</a></li>
                        <li><a href="relational-views-over-XML-data.html#GUID-420496CE-D62F-4EBE-A76E-861B932AE1E6" title="Relational database views over XML data provide conventional, relational access to XML content.">Relational Views over XML Data</a></li>
                        <li><a href="choice-of-XMLType-storage-and-indexing.html#GUID-F1EE5B88-69E1-47B4-97FC-92F184C0CBA1" title="Important design choices for your application include what XMLType storage model to use and which indexing approaches to use.">Choice of XMLType Storage and Indexing</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="XMLType-views.html#GUID-9F0A7B1F-269B-411F-AD8B-8F1CB2E2A671" title="You can create XMLType views over relational and object-relational data.">XMLType Views</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB5168"></a><a id="ADXDB5167"></a><div class="props_rev_3"><a id="GUID-30E3C3B8-46F7-4D1E-97DE-B7A261BC2995" name="GUID-30E3C3B8-46F7-4D1E-97DE-B7A261BC2995"></a><h3 id="ADXDB-GUID-30E3C3B8-46F7-4D1E-97DE-B7A261BC2995" class="sect3"><span class="enumeration_section">10.2 </span>CREATE VIEW for XMLType Views: Syntax
               </h3>
               <div>
                  <p>The syntax for the <code class="codeph">CREATE VIEW</code> clause for creating <code class="codeph">XMLType</code> views is presented.
                  </p>
                  <div class="section">
                     <p><a href="XMLType-views.html#GUID-30E3C3B8-46F7-4D1E-97DE-B7A261BC2995__CJIBFAFH">Figure 10-1</a> shows this syntax. See <a href="../sqlrf/CREATE-VIEW.html#SQLRF01504" target="_blank"><span><cite>Oracle Database SQL Language Reference</cite></span></a> for details on the <code class="codeph">CREATE VIEW</code> syntax.
                     </p>
                     <div class="figure" id="GUID-30E3C3B8-46F7-4D1E-97DE-B7A261BC2995__CJIBFAFH">
                        <p class="titleinfigure">Figure 10-1 Creating XMLType Views Clause: Syntax</p><img src="img/xmltype_view_clause.gif" width="558" alt="Description of Figure 10-1 follows" title="Description of Figure 10-1 follows" longdesc="img_text/xmltype_view_clause.html"><br><a href="img_text/xmltype_view_clause.html">Description of "Figure 10-1 Creating XMLType Views Clause: Syntax"</a></div>
                     <!-- class="figure" -->
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="XMLType-views.html#GUID-9F0A7B1F-269B-411F-AD8B-8F1CB2E2A671" title="You can create XMLType views over relational and object-relational data.">XMLType Views</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB5171"></a><a id="ADXDB5169"></a><div class="props_rev_3"><a id="GUID-69A4022C-9FCA-4529-8A29-084EB2185FCF" name="GUID-69A4022C-9FCA-4529-8A29-084EB2185FCF"></a><h3 id="ADXDB-GUID-69A4022C-9FCA-4529-8A29-084EB2185FCF" class="sect3"><span class="enumeration_section">10.3 </span>Creating Non-Schema-Based XMLType Views
               </h3>
               <div>
                  <p>The XML data in a non XML Schema-based <code class="codeph">XMLType</code> view is not constrained to conform to a registered XML schema. You can create a non-schema-based <code class="codeph">XMLType</code> view using SQL/XML publishing functions.
                  </p>
                  <div class="section">
                     <p><a href="XMLType-views.html#GUID-69A4022C-9FCA-4529-8A29-084EB2185FCF__I1027167">Example 10-1</a> shows how to create an <code class="codeph">XMLType</code> view using SQL/XML function <code class="codeph">XMLELement</code>.
                     </p>
                     <p>Existing data in relational tables or views can be exposed as XML data this way. If a view is generated using a SQL/XML publishing function then queries that access that view using XQuery expressions can often be rewritten. These optimized queries can then directly access the underlying relational columns. See <a href="XPath-rewrite-for-object-relational-storage.html#GUID-35551023-CCAC-477B-8BBF-CD0E0B44C962" title="For XMLType data stored object-relationally, queries involving XPath expression arguments to various SQL functions can often be automatically rewritten to queries against the underlying SQL tables, which are highly optimized.">XPath Rewrite for Object-Relational Storage</a> for details.
                     </p>
                     <p>You can perform a DML operation on an <code class="codeph">XMLType</code> view, but, in general, you must write instead-of triggers to handle the DML operation. 
                     </p>
                     <div class="infoboxnotealso" id="GUID-69A4022C-9FCA-4529-8A29-084EB2185FCF__GUID-89523654-DEE2-42CE-9A71-4B32E974C95F">
                        <p class="notep1">See Also:</p>
                        <p> <a href="generation-of-XML-data-from-relational-data.html#GUID-3BEB9A88-8B44-4AA3-89F4-8CBF6F8FA686" title="Oracle XML&nbsp;DB provides features for generating (constructing) XML data from relational data in the database. There are both SQL/XML standard functions and Oracle-specific functions and packages for generating XML data from relational content.">Generation of XML Data from Relational Data</a>, for details on SQL/XML publishing functions
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-69A4022C-9FCA-4529-8A29-084EB2185FCF__I1027167">
                     <p class="titleinexample">Example 10-1 Creating an XMLType View Using XMLELEMENT </p><pre class="oac_no_warn" dir="ltr">CREATE OR REPLACE VIEW emp_view OF XMLType
  WITH OBJECT ID (XMLCast(XMLQuery('/Emp/@empno'
                                   PASSING OBJECT_VALUE RETURNING CONTENT)
                          AS BINARY_DOUBLE)) AS
  SELECT XMLElement("Emp",
                    XMLAttributes(employee_id AS "empno"),
                    XMLForest(e.first_name ||' '|| e.last_name AS "name",
                              e.hire_date AS "hiredate"))
    AS "result" FROM employees e WHERE salary &gt; 15000;

SELECT * FROM emp_view;
 
SYS_NC_ROWINFO$
-------------------------------------------------------------------------------------
&lt;Emp empno="100"&gt;&lt;name&gt;Steven King&lt;/name&gt;&lt;hiredate&gt;2003-06-17&lt;/hiredate&gt;&lt;/Emp&gt; 
&lt;Emp empno="101"&gt;&lt;name&gt;Neena Kochhar&lt;/name&gt;&lt;hiredate&gt;2005-09-21&lt;/hiredate&gt;&lt;/Emp&gt; 
&lt;Emp empno="102"&gt;&lt;name&gt;Lex De Haan&lt;/name&gt;&lt;hiredate&gt;2001-01-13&lt;/hiredate&gt;&lt;/Emp&gt; 
</pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="XMLType-views.html#GUID-9F0A7B1F-269B-411F-AD8B-8F1CB2E2A671" title="You can create XMLType views over relational and object-relational data.">XMLType Views</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB5174"></a><div class="props_rev_3"><a id="GUID-4BA4C794-3CAA-43D6-B8C4-5FE946FC1134" name="GUID-4BA4C794-3CAA-43D6-B8C4-5FE946FC1134"></a><h3 id="ADXDB-GUID-4BA4C794-3CAA-43D6-B8C4-5FE946FC1134" class="sect3"><span class="enumeration_section">10.4 </span>Creating XML Schema-Based XMLType Views
               </h3>
               <div>
                  <p>The XML data in an XML Schema-based <code class="codeph">XMLType</code> view is constrained to conform to an XML schema. You can create a schema-based <code class="codeph">XMLType</code> view using SQL/XML publishing functions or using object types or views.
                  </p>
                  <p>Create a schema-based view in either of these ways: </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Using SQL/XML publishing functions.</p>
                     </li>
                     <li>
                        <p>Using object types or object views. This is convenient when you already have object types, views, and tables that you want to map to XML data.</p>
                     </li>
                  </ul>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="XMLType-views.html#GUID-B3F5A02B-8D97-411A-B542-3D441BE3DEF9">Creating XML Schema-Based XMLType Views Using SQL/XML Publishing Functions</a><br>You can use SQL/XML publishing functions to create an XML Schema-based <code class="codeph">XMLType</code> view. 
                     </li>
                     <li class="ulchildlink"><a href="XMLType-views.html#GUID-E50ECA03-3E64-4089-9770-62C98D23DD67">Creating XML Schema-Based XMLType Views Using Object Types or Object Views</a><br>You can create an XML Schema-based <code class="codeph">XMLType</code> view from object types or views by annotating the XML schema to define a mapping between XML types and SQL object types and object attributes.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="XMLType-views.html#GUID-9F0A7B1F-269B-411F-AD8B-8F1CB2E2A671" title="You can create XMLType views over relational and object-relational data.">XMLType Views</a></p>
                     </div>
                  </div>
               </div>
               <a id="ADXDB5176"></a><a id="ADXDB5177"></a><a id="ADXDB5178"></a><a id="ADXDB5175"></a><div class="props_rev_3"><a id="GUID-B3F5A02B-8D97-411A-B542-3D441BE3DEF9" name="GUID-B3F5A02B-8D97-411A-B542-3D441BE3DEF9"></a><h4 id="ADXDB-GUID-B3F5A02B-8D97-411A-B542-3D441BE3DEF9" class="sect4"><span class="enumeration_section">10.4.1 </span>Creating XML Schema-Based XMLType Views Using SQL/XML Publishing Functions
                  </h4>
                  <div>
                     <p>You can use SQL/XML publishing functions to create an XML Schema-based <code class="codeph">XMLType</code> view. 
                     </p>
                     <div class="section">
                        <ol>
                           <li>
                              <p>Create and register the XML schema document that contains the necessary XML structures. You do not need to annotate the XML schema to define the mapping between XML types and SQL object types.</p>
                           </li>
                           <li>
                              <p>Use SQL/XML publishing functions to create an <code class="codeph">XMLType</code> view that conforms to the XML schema. 
                              </p>
                           </li>
                        </ol>
                        <p>These two steps are illustrated in <a href="XMLType-views.html#GUID-B3F5A02B-8D97-411A-B542-3D441BE3DEF9__CHDHDHAD">Example 10-2</a> and <a href="XMLType-views.html#GUID-B3F5A02B-8D97-411A-B542-3D441BE3DEF9__CHDFDJCH">Example 10-3</a>, respectively. 
                        </p>
                        <p><a href="XMLType-views.html#GUID-B3F5A02B-8D97-411A-B542-3D441BE3DEF9__CHDGIHBA">Example 10-4</a> illustrates querying an <code class="codeph">XMLType</code> view.
                        </p>
                        <p><a href="XMLType-views.html#GUID-B3F5A02B-8D97-411A-B542-3D441BE3DEF9__CHDHDHAD">Example 10-2</a> assumes that you have an XML schema <code class="codeph">emp_simple.xsd</code> that contains XML structures defining an employee. It registers the XML schema with the target location <code class="codeph">http://www.oracle.com/emp_simple.xsd</code>.
                        </p>
                        <p>When using SQL/XML publishing functions to generate XML schema-based content, you must specify the appropriate namespace information for all of the elements and also indicate the location of the schema using attribute <code class="codeph">xsi:schemaLocation</code>. These can be specified using the <code class="codeph">XMLAttributes</code> clause. <a href="XMLType-views.html#GUID-B3F5A02B-8D97-411A-B542-3D441BE3DEF9__CHDFDJCH">Example 10-3</a> illustrates this.
                        </p>
                        <div class="infoboxnote" id="GUID-B3F5A02B-8D97-411A-B542-3D441BE3DEF9__GUID-E130F07E-D0D8-4C96-A03D-33A64077C1D9">
                           <p class="notep1">Note:</p>
                           <p> Whenever you use SQL/XML function <code class="codeph">XMLAttributes</code> with an XML schema reference to create an <code class="codeph">XMLType</code> view, register the XML schema before creating the view, if possible. Otherwise, you must recompile the view after registering the XML schema, in order for the generated documents to be based on the XML schema.
                           </p>
                        </div>
                        <p>In <a href="XMLType-views.html#GUID-B3F5A02B-8D97-411A-B542-3D441BE3DEF9__CHDFDJCH">Example 10-3</a>, function <code class="codeph">XMLElement</code> creates XML element <code class="codeph">Employee</code>. Function <code class="codeph">XMLForest</code> creates the children of element <code class="codeph">Employee</code>. The <code class="codeph">XMLAttributes</code> clause inside <code class="codeph">XMLElement</code> constructs the required XML <code class="codeph">namespace</code> and schema <code class="codeph">location</code> attributes, so that the XML data that is generated conforms to the XML schema of the view. The innermost call to <code class="codeph">XMLForest</code> creates the children of element <code class="codeph">department</code>, which is a child of element <code class="codeph">Employee</code>.
                        </p>
                        <p>By default, the XML generation functions create a non-schema-based XML instance. However, when the schema location is specified, using attribute <code class="codeph">xsi:schemaLocation</code> or <code class="codeph">xsi:noNamespaceSchemaLocation</code>, Oracle XML DB generates XML schema-based XML data. For <code class="codeph">XMLType</code> views, as long as the names of the elements and attributes match those in the XML schema, the XML data is converted implicitly into a valid XML schema-based document. Any errors in the generated XML data are caught later, when operations such as validation or extraction operations are performed on the XML instance. 
                        </p>
                        <p><a href="XMLType-views.html#GUID-B3F5A02B-8D97-411A-B542-3D441BE3DEF9__CHDGIHBA">Example 10-4</a> queries the <code class="codeph">XMLType</code> view, returning an XML result from tables <code class="codeph">employees</code> and <code class="codeph">departments</code>. The result of the query is shown pretty-printed, for clarity.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-B3F5A02B-8D97-411A-B542-3D441BE3DEF9__CHDHDHAD">
                        <p class="titleinexample">Example 10-2 Registering XML Schema emp_simple.xsd</p><pre class="pre codeblock"><code>BEGIN
  DBMS_XMLSCHEMA.registerSchema(
   SCHEMAURL =&gt; 'http://www.oracle.com/emp_simple.xsd',
   SCHEMADOC =&gt; '&lt;schema xmlns="http://www.w3.org/2001/XMLSchema"
                         targetNamespace="http://www.oracle.com/emp_simple.xsd"
                         version="1.0"
                         xmlns:xdb="http://xmlns.oracle.com/xdb" 
                         elementFormDefault="qualified"&gt; 
                   &lt;element name = "Employee"&gt; 
                     &lt;complexType&gt; 
                       &lt;sequence&gt; 
                         &lt;element name = "EmployeeId"
                                  type = "positiveInteger" minOccurs = "0"/&gt; 
                         &lt;element name = "Name"
                                  type = "string" minOccurs = "0"/&gt; 
                         &lt;element name = "Job"
                                  type = "string" minOccurs = "0"/&gt; 
                         &lt;element name = "Manager"
                                  type = "positiveInteger" minOccurs = "0"/&gt; 
                         &lt;element name = "HireDate"
                                  type = "date" minOccurs = "0"/&gt; 
                         &lt;element name = "Salary"
                                  type = "positiveInteger" minOccurs = "0"/&gt; 
                         &lt;element name = "Commission"
                                  type = "positiveInteger" minOccurs = "0"/&gt; 
                         &lt;element name = "Dept"&gt; 
                           &lt;complexType&gt; 
                             &lt;sequence&gt; 
                               &lt;element name = "DeptNo"
                                        type = "positiveInteger" minOccurs = "0"/&gt; 
                               &lt;element name = "DeptName"
                                        type = "string" minOccurs = "0"/&gt; 
                               &lt;element name = "Location"
                                        type = "positiveInteger" minOccurs = "0"/&gt; 
                             &lt;/sequence&gt; 
                           &lt;/complexType&gt; 
                         &lt;/element&gt; 
                       &lt;/sequence&gt; 
                     &lt;/complexType&gt; 
                   &lt;/element&gt; 
                 &lt;/schema&gt;',
   LOCAL     =&gt; TRUE,
   GENTYPES  =&gt; TRUE);
END;
</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-B3F5A02B-8D97-411A-B542-3D441BE3DEF9__CHDFDJCH">
                        <p class="titleinexample">Example 10-3 Creating an XMLType View Using SQL/XML Publishing Functions</p><pre class="pre codeblock"><code>CREATE OR REPLACE VIEW <span class="bold">emp_simple_xml</span> OF XMLType
  XMLSCHEMA "http://www.oracle.com/<span class="bold">emp_simple.xsd</span>" ELEMENT "Employee"
   WITH OBJECT ID (XMLCast(XMLQuery('/Employee/EmployeeId/text()'
                                    PASSING OBJECT_VALUE
                                    RETURNING CONTENT)
                           AS BINARY_DOUBLE)) AS
   SELECT
     XMLElement("Employee",
                XMLAttributes(
                  'http://www.oracle.com/emp_simple.xsd' AS "xmlns" ,
                  'http://www.w3.org/2001/XMLSchema-instance' AS "xmlns:xsi",
                  'http://www.oracle.com/emp_simple.xsd
                   http://www.oracle.com/emp_simple.xsd'
                  AS "xsi:schemaLocation"),
                XMLForest(e.employee_id    AS "EmployeeId",
                          e.last_name      AS "Name",
                          e.job_id         AS "Job",
                          e.manager_id     AS "Manager",
                          e.hire_date      AS "HireDate",
                          e.salary         AS "Salary",
                          e.commission_pct AS "Commission",
                          XMLForest(
                            d.department_id   AS "DeptNo",
                            d.department_name AS "DeptName",
                            d.location_id     AS "Location") AS "Dept"))
     FROM employees e, departments d
     WHERE e.department_id = d.department_id;
</code></pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-B3F5A02B-8D97-411A-B542-3D441BE3DEF9__CHDGIHBA">
                        <p class="titleinexample">Example 10-4 Querying an XMLType View</p><pre class="pre codeblock"><code>SELECT OBJECT_VALUE AS RESULT FROM emp_simple_xml WHERE ROWNUM &lt; 2;

RESULT
---------------------------------------------------------------------
&lt;Employee xmlns="http://www.oracle.com/emp_simple.xsd"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="http://www.oracle.com/emp_simple.xsd 
                              http://www.oracle.com/emp_simple.xsd"&gt;
  &lt;EmployeeId&gt;200&lt;/EmployeeId&gt;
  &lt;Name&gt;Whalen&lt;/Name&gt;
  &lt;Job&gt;AD_ASST&lt;/Job&gt;
  &lt;Manager&gt;101&lt;/Manager&gt;
  &lt;HireDate&gt;2003-09-17&lt;/HireDate&gt;
  &lt;Salary&gt;4400&lt;/Salary&gt;
  &lt;Dept&gt;
    &lt;DeptNo&gt;10&lt;/Deptno&gt;
    &lt;DeptName&gt;Administration&lt;/DeptName&gt;
    &lt;Location&gt;1700&lt;/Location&gt;
  &lt;/Dept&gt;
&lt;/Employee&gt;</code></pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="XMLType-views.html#GUID-5AA7CC36-1A4D-49D6-8071-5F2AB5CB27FE">Using Namespaces with SQL/XML Publishing Functions</a><br>If you have complex XML schemas involving namespaces, you must use the partially escaped mapping provided by the SQL/XML publishing functions and create elements with appropriate namespaces and prefixes. 
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="XMLType-views.html#GUID-4BA4C794-3CAA-43D6-B8C4-5FE946FC1134" title="The XML data in an XML Schema-based XMLType view is constrained to conform to an XML schema. You can create a schema-based XMLType view using SQL/XML publishing functions or using object types or views.">Creating XML Schema-Based XMLType Views</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="ADXDB5180"></a><a id="ADXDB5897"></a><a id="ADXDB5898"></a><a id="ADXDB5181"></a><a id="ADXDB5179"></a><div class="props_rev_3"><a id="GUID-5AA7CC36-1A4D-49D6-8071-5F2AB5CB27FE" name="GUID-5AA7CC36-1A4D-49D6-8071-5F2AB5CB27FE"></a><h5 id="ADXDB-GUID-5AA7CC36-1A4D-49D6-8071-5F2AB5CB27FE" class="sect5"><span class="enumeration_section">10.4.1.1 </span>Using Namespaces with SQL/XML Publishing Functions
                     </h5>
                     <div>
                        <p>If you have complex XML schemas involving namespaces, you must use the partially escaped mapping provided by the SQL/XML publishing functions and create elements with appropriate namespaces and prefixes. </p>
                        <div class="section">
                           <p>The query in <a href="XMLType-views.html#GUID-5AA7CC36-1A4D-49D6-8071-5F2AB5CB27FE__CFHIIBIH">Example 10-5</a> creates XML instances that have the correct namespace, prefixes, and target schema location. It can be used as the query in the definition of view <code class="codeph">emp_simple_xml</code>.
                           </p>
                           <p>If the XML schema had no target namespace, then you could use attribute <code class="codeph">xsi:noNamespaceSchemaLocation</code> to indicate that. <a href="XMLType-views.html#GUID-5AA7CC36-1A4D-49D6-8071-5F2AB5CB27FE__CFHGDFAH">Example 10-6</a> shows such an XML schema.
                           </p>
                           <p><a href="XMLType-views.html#GUID-5AA7CC36-1A4D-49D6-8071-5F2AB5CB27FE__CFHEICEA">Example 10-7</a> creates a view that conforms to the XML schema in <a href="XMLType-views.html#GUID-5AA7CC36-1A4D-49D6-8071-5F2AB5CB27FE__CFHGDFAH">Example 10-6</a>. The <code class="codeph">XMLAttributes</code> clause creates an XML element that contains the <code class="codeph">noNamespace</code> schema location attribute.
                           </p>
                           <p><a href="XMLType-views.html#GUID-5AA7CC36-1A4D-49D6-8071-5F2AB5CB27FE__CFHIBCBF">Example 10-8</a> creates view <code class="codeph">dept_xml</code>, which conforms to XML schema <code class="codeph">dept.xsd</code>.
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-5AA7CC36-1A4D-49D6-8071-5F2AB5CB27FE__CFHIIBIH">
                           <p class="titleinexample">Example 10-5 Using Namespace Prefixes with SQL/XML Publishing Functions</p><pre class="pre codeblock"><code>SELECT XMLElement("ipo:Employee", 
          XMLAttributes('http://www.oracle.com/emp_simple.xsd' AS "xmlns:ipo", 
                        'http://www.oracle.com/emp_simple.xsd 
                         http://www.oracle.com/emp_simple.xsd' AS "xmlns:xsi"),
            XMLForest(e.employee_id                     AS "ipo:EmployeeId", 
                      e.last_name                       AS "ipo:Name",  
                      e.job_id                          AS "ipo:Job",
                      e.manager_id                      AS "ipo:Manager",
                      TO_CHAR(e.hire_date,'YYYY-MM-DD') AS "ipo:HireDate", 
                      e.salary                          AS "ipo:Salary",
                      e.commission_pct                  AS "ipo:Commission",
                 XMLForest(d.department_id   AS "ipo:DeptNo",
                           d.department_name AS "ipo:DeptName", d.location_id
       AS "ipo:Location") AS "ipo:Dept"))
       FROM employees e, departments d 
       WHERE e.department_id = d.department_id AND d.department_id = 20;
BEGIN
  -- Delete schema if it already exists (else error)
  DBMS_XMLSCHEMA.deleteSchema('emp-noname.xsd', 4); 
END;
</code></pre><pre class="pre codeblock"><code>XMLELEMENT("IPO:EMPLOYEE",XMLATTRIBUTES('HTTP://WWW.ORACLE.COM/EMP_SIMPLE.XSD'AS
--------------------------------------------------------------------------------
&lt;ipo:Employee
xmlns:ipo="http://www.oracle.com/emp_simple.xsd"
 xmlns:xsi="http://www.oracle.com/emp_simple.xsd
 http://www.oracle.com/emp_simple.xsd"&gt;
&lt;ipo:EmployeeId&gt;201&lt;/ipo:EmployeeId&gt;&lt;ipo:Name&gt;Hartstein&lt;/ipo:Name&gt;
&lt;ipo:Job&gt;MK_MAN&lt;/ipo:Job&gt;&lt;ipo:Manager&gt;100&lt;/ipo:Manager&gt;
&lt;ipo:HireDate&gt;2004-02-17&lt;/ipo:HireDate&gt;&lt;ipo:Salary&gt;13000&lt;/ipo:Salary&gt;
&lt;ipo:Dept&gt;&lt;ipo:DeptNo&gt;20&lt;/ipo:DeptNo&gt;&lt;ipo:DeptName&gt;Marketing&lt;/ipo:DeptName&gt;
&lt;ipo:Location&gt;1800&lt;/ipo:Location&gt;&lt;/ipo:Dept&gt;&lt;/ipo:Employee&gt;
&lt;ipo:Employee xmlns:ipo="http://www.oracle.com/emp_simple.xsd"
 xmlns:xsi="http://www.oracle.com/emp_simple.xsd 
 http://www.oracle.com/emp_simple.xsd"&gt;&lt;ipo:EmployeeId&gt;202&lt;/ipo:EmployeeId&gt;
&lt;ipo:Name&gt;Fay&lt;/ipo:Name&gt;&lt;ipo:Job&gt;MK_REP&lt;/ipo:Job&gt;&lt;ipo:Manager&gt;201&lt;/ipo:Manager&gt;
&lt;ipo:HireDate&gt;2005-08-17&lt;/ipo:HireDate&gt;&lt;ipo:Salary&gt;6000&lt;/ipo:Salary&gt;
&lt;ipo:Dept&gt;&lt;ipo:DeptNo&gt;20&lt;/ipo:Dept
No&gt;&lt;ipo:DeptName&gt;Marketing&lt;/ipo:DeptName&gt;&lt;ipo:Location&gt;1800&lt;/ipo:Location&gt;
&lt;/ipo:Dept&gt;
&lt;/ipo:Employee&gt;
</code></pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-5AA7CC36-1A4D-49D6-8071-5F2AB5CB27FE__CFHGDFAH">
                           <p class="titleinexample">Example 10-6 XML Schema with No Target Namespace</p><pre class="pre codeblock"><code>BEGIN
  DBMS_XMLSCHEMA.registerSchema(
    SCHEMAURL =&gt; '<span class="bold">emp-noname.xsd</span>',
    SCHEMADOC =&gt; '&lt;schema xmlns="http://www.w3.org/2001/XMLSchema"
                          xmlns:xdb="http://xmlns.oracle.com/xdb"&gt; 
                    &lt;element name = "Employee"&gt; 
                      &lt;complexType&gt; 
                        &lt;sequence&gt; 
                          &lt;element name = "EmployeeId" type = "positiveInteger"/&gt; 
                          &lt;element name = "Name" type = "string"/&gt; 
                          &lt;element name = "Job" type = "string"/&gt; 
                          &lt;element name = "Manager" type = "positiveInteger"/&gt; 
                          &lt;element name = "HireDate" type = "date"/&gt; 
                          &lt;element name = "Salary" type = "positiveInteger"/&gt; 
                          &lt;element name = "Commission" type = "positiveInteger"/&gt; 
                          &lt;element name = "Dept"&gt; 
                            &lt;complexType&gt; 
                              &lt;sequence&gt; 
                                &lt;element name = "DeptNo" type = "positiveInteger" /&gt; 
                                &lt;element name = "DeptName" type = "string"/&gt; 
                                &lt;element name = "Location" type = "positiveInteger"/&gt; 
                              &lt;/sequence&gt; 
                            &lt;/complexType&gt; 
                          &lt;/element&gt; 
                        &lt;/sequence&gt; 
                      &lt;/complexType&gt; 
                    &lt;/element&gt; 
                  &lt;/schema&gt;',
    LOCAL     =&gt; TRUE,
    GENTYPES  =&gt; TRUE);
END;
</code></pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-5AA7CC36-1A4D-49D6-8071-5F2AB5CB27FE__CFHEICEA">
                           <p class="titleinexample">Example 10-7 Creating a View for an XML Schema with No Target Namespace</p><pre class="pre codeblock"><code>CREATE OR REPLACE VIEW <span class="bold">emp_xml</span> OF XMLType
     XMLSCHEMA "emp-noname.xsd" ELEMENT "Employee"
     WITH OBJECT ID (XMLCast(XMLQuery('/Employee/EmployeeId/text()'
                                      PASSING OBJECT_VALUE
                                      RETURNING CONTENT)
                             AS BINARY_DOUBLE)) AS
     SELECT XMLElement(
       "Employee",
       XMLAttributes('http://www.w3.org/2001/XMLSchema-instance' AS "xmlns:xsi",
                     'emp-noname.xsd' AS "<span class="bold">xsi:noNamespaceSchemaLocation</span>"),
       XMLForest(e.employee_id    AS "EmployeeId",
                 e.last_name      AS "Name",
                 e.job_id         AS "Job",
                 e.manager_id     AS "Manager",
                 e.hire_date      AS "HireDate",
                 e.salary         AS "Salary",
                 e.commission_pct AS "Commission",
                 XMLForest(d.department_id   AS "DeptNo",
                           d.department_name AS "DeptName",
                           d.location_id     AS "Location") AS "Dept"))
       FROM employees e, departments d
       WHERE e.department_id = d.department_id;
</code></pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-5AA7CC36-1A4D-49D6-8071-5F2AB5CB27FE__CFHIBCBF">
                           <p class="titleinexample">Example 10-8 Using SQL/XML Functions in XML Schema-Based XMLType Views</p><pre class="pre codeblock"><code>BEGIN
  -- Delete schema if it already exists (else error)
  DBMS_XMLSCHEMA.deleteSchema('http://www.oracle.com/dept.xsd', 4);
END;
/

BEGIN
  DBMS_XMLSCHEMA.registerSchema(
    SCHEMAURL =&gt; 'http://www.oracle.com/<span class="bold">dept.xsd</span>',
    SCHEMADOC =&gt; '&lt;schema xmlns="http://www.w3.org/2001/XMLSchema"
                          targetNamespace="http://www.oracle.com/dept.xsd"
                          version="1.0" 
                          xmlns:xdb="http://xmlns.oracle.com/xdb"
                          elementFormDefault="qualified"&gt; 
                    &lt;element name = "Department"&gt; 
                      &lt;complexType&gt; 
                        &lt;sequence&gt; 
                          &lt;element name = "DeptNo" type = "positiveInteger"/&gt; 
                          &lt;element name = "DeptName" type = "string"/&gt; 
                          &lt;element name = "Location" type = "positiveInteger"/&gt; 
                          &lt;element name = "Employee" maxOccurs = "unbounded"&gt; 
                            &lt;complexType&gt; 
                              &lt;sequence&gt; 
                                &lt;element name = "EmployeeId" type = "positiveInteger"/&gt; 
                                &lt;element name = "Name" type = "string"/&gt; 
                                &lt;element name = "Job" type = "string"/&gt; 
                                &lt;element name = "Manager" type = "positiveInteger"/&gt; 
                                &lt;element name = "HireDate" type = "date"/&gt; 
                                &lt;element name = "Salary" type = "positiveInteger"/&gt; 
                                &lt;element name = "Commission" type = "positiveInteger"/&gt; 
                             &lt;/sequence&gt; 
                            &lt;/complexType&gt; 
                          &lt;/element&gt; 
                        &lt;/sequence&gt; 
                      &lt;/complexType&gt; 
                    &lt;/element&gt; 
                  &lt;/schema&gt;',
    LOCAL     =&gt; TRUE,
    GENTYPES  =&gt; FALSE);
  END;
/

CREATE OR REPLACE VIEW <span class="bold">dept_xml</span> OF XMLType
  XMLSCHEMA "http://www.oracle.com/dept.xsd" ELEMENT "Department"
  WITH OBJECT ID (XMLCast(XMLQuery('/Department/DeptNo'
                                   PASSING OBJECT_VALUE RETURNING CONTENT)
                          AS BINARY_DOUBLE)) AS
  SELECT XMLElement(
    "Department",
    XMLAttributes(
      'http://www.oracle.com/emp.xsd' AS "xmlns" ,
      'http://www.w3.org/2001/XMLSchema-instance' AS "xmlns:xsi",
      'http://www.oracle.com/dept.xsd
       http://www.oracle.com/dept.xsd' AS "xsi:schemaLocation"),
    XMLForest(d.department_id AS "DeptNo",
              d.department_name AS "DeptName",
              d.location_id AS "Location"),
    (SELECT XMLagg(
              XMLElement("Employee",
                         XMLForest(
                           e.employee_id AS "EmployeeId",
                           e.last_name AS "Name",
                           e.job_id AS "Job",
                           e.manager_id AS "Manager",
                           to_char(e.hire_date,'YYYY-MM-DD') AS "Hiredate",
                           e.salary AS "Salary",
                           e.commission_pct AS "Commission")))
       FROM employees e
       WHERE e.department_id = d.department_id))
     FROM departments d;
</code></pre><p>This is the <code class="codeph">XMLType</code> instance that results:
                           </p><pre class="pre codeblock"><code>SELECT OBJECT_VALUE AS result FROM dept_xml WHERE ROWNUM &lt; 2;

RESULT
----------------------------------------------------------------
&lt;Department
    xmlns="http://www.oracle.com/emp.xsd"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.oracle.com/dept.xsd 
                        http://www.oracle.com/dept.xsd"&gt;
  &lt;DeptNo&gt;10&lt;/DeptNo&gt;
  &lt;DeptName&gt;Administration&lt;/DeptName&gt;
  &lt;Location&gt;1700&lt;/Location&gt;
  &lt;Employee&gt;
    &lt;EmployeeId&gt;200&lt;/EmployeeId&gt;
    &lt;Name&gt;Whalen&lt;/Name&gt;
    &lt;Job&gt;AD_ASST&lt;/Job&gt;
    &lt;Manager&gt;101&lt;/Manager&gt;
    &lt;Hiredate&gt;2003-09-17&lt;/Hiredate&gt;
    &lt;Salary&gt;4400&lt;/Salary&gt;
  &lt;/Employee&gt;
&lt;/Department&gt; </code></pre></div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="XMLType-views.html#GUID-B3F5A02B-8D97-411A-B542-3D441BE3DEF9" title="You can use SQL/XML publishing functions to create an XML Schema-based XMLType view.">Creating XML Schema-Based XMLType Views Using SQL/XML Publishing Functions</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="ADXDB5182"></a><div class="props_rev_3"><a id="GUID-E50ECA03-3E64-4089-9770-62C98D23DD67" name="GUID-E50ECA03-3E64-4089-9770-62C98D23DD67"></a><h4 id="ADXDB-GUID-E50ECA03-3E64-4089-9770-62C98D23DD67" class="sect4"><span class="enumeration_section">10.4.2 </span>Creating XML Schema-Based XMLType Views Using Object Types or Object Views
                  </h4>
                  <div>
                     <p>You can create an XML Schema-based <code class="codeph">XMLType</code> view from object types or views by annotating the XML schema to define a mapping between XML types and SQL object types and object attributes.
                     </p>
                     <div class="section">
                        <p>To create an XML Schema-based <code class="codeph">XMLType</code> view from object types or object views, do the following:
                        </p>
                        <ol>
                           <li>
                              <p>Create the object types, if they do not yet exist.</p>
                           </li>
                           <li>
                              <p>Create and then register the XML schema, annotating it to define the mapping between XML types and SQL object types and attributes.</p>
                              <p>Annotate the XML schema <span class="italic">before</span> registering it. You typically do this when you wrap existing data to create an <code class="codeph">XMLType</code> view.
                              </p>
                              <p>When such an XML schema document is registered, the following validation can occur: </p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><code class="codeph">SQLType</code> for attributes or elements based on <code class="codeph">simpleType</code>. The SQL type must be compatible with the XML type of the corresponding <code class="codeph">XMLType</code> data. For example, an XML <code class="codeph">string</code> data type can be mapped only to a <code class="codeph">VARCHAR2</code> or a Large Object (LOB) data type.
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">SQLType</code> specified for elements based on <code class="codeph">complexType</code>. This is either a LOB or an object type whose structure must be compatible with the declaration of the <code class="codeph">complexType</code>, that is, the object type must have the correct number of attributes with the correct data types. 
                                    </p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>Create the <code class="codeph">XMLType</code> view, specifying the XML schema URL and the root element name. The query defining the view first constructs the object instances and then converts them to XML.
                              </p>
                              <ol type="a">
                                 <li>
                                    <p>Create an object view.</p>
                                 </li>
                                 <li>
                                    <p>Create an <code class="codeph">XMLType</code> view over the object view.
                                    </p>
                                 </li>
                              </ol>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>The topics in this section present examples of creating XML schema-based <code class="codeph">XMLType</code> views using object types or object views. They are based on relational tables that contain employee and department data.
                        </p>
                        <p>The same relational data is used to create each of two <code class="codeph">XMLType</code> views. In the employee view, <code class="codeph">emp_xml</code>, the XML document describes an employee, with the employee's department as nested information. In the department view, <code class="codeph">dept_xml</code>, the XML data describes a department, with the department's employees as nested information.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="XMLType-views.html#GUID-205D69F3-0966-4418-A241-A7BBB37C79A4">Creating XMLType Employee View, with Nested Department Information</a><br>Examples here create <code class="codeph">XMLType</code> view <code class="codeph">emp_xml</code> based on object views. 
                        </li>
                        <li class="ulchildlink"><a href="XMLType-views.html#GUID-6FFDAA7E-8505-4055-A476-6EEEBCF6D79E">Creating XMLType Department View, with Nested Employee Information</a><br><code class="codeph">XMLType</code> view <code class="codeph">dept_xml</code> is created so that each department in the view contains nested employee information. 
                        </li>
                     </ul>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="XML-Schema-and-query-basic.html#GUID-C09824C1-6B02-4556-A265-B1749DEE8DE1" title="XML Schema is a standard for describing the content and structure of XML documents. You can register, update, and delete an XML schema used with Oracle XML&nbsp;DB. You can define storage structures to use for your XML schema-based data and map XML Schema data types to SQL data types.">XML Schema Storage and Query: Basic</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="XMLType-views.html#GUID-4BA4C794-3CAA-43D6-B8C4-5FE946FC1134" title="The XML data in an XML Schema-based XMLType view is constrained to conform to an XML schema. You can create a schema-based XMLType view using SQL/XML publishing functions or using object types or views.">Creating XML Schema-Based XMLType Views</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="ADXDB5183"></a><div class="props_rev_3"><a id="GUID-205D69F3-0966-4418-A241-A7BBB37C79A4" name="GUID-205D69F3-0966-4418-A241-A7BBB37C79A4"></a><h5 id="ADXDB-GUID-205D69F3-0966-4418-A241-A7BBB37C79A4" class="sect5"><span class="enumeration_section">10.4.2.1 </span>Creating XMLType Employee View, with Nested Department Information
                     </h5>
                     <div>
                        <p>Examples here create <code class="codeph">XMLType</code> view <code class="codeph">emp_xml</code> based on object views. 
                        </p>
                        <div class="section">
                           <p>For the <span class="italic">last</span> step of the view creation, there are two <span class="italic">alternatives</span>:
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="XMLType-views.html#GUID-197D406F-1384-4E86-B778-4F743E741433" title="Create an XMLType view using an object type.">Step 3a. Create XMLType View emp_xml Using Object Type emp_t</a> &#x2013; create <code class="codeph">XMLType</code> view <code class="codeph">emp_xml</code> using object type <code class="codeph">emp_t</code></p>
                              </li>
                              <li>
                                 <p><a href="XMLType-views.html#GUID-EF8A2855-1364-4D6E-9023-7F6358F0A995" title="Create an XMLType view using an object view.">Step 3b. Create XMLType View emp_xml Using Object View emp_v</a> &#x2013; create <code class="codeph">XMLType</code> view <code class="codeph">emp_xml</code> using object view <code class="codeph">emp_v</code></p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="XMLType-views.html#GUID-8B26B5AC-0449-4708-8B61-3A1F003D9922">Step 1. Create Object Types for XMLType Employee View</a><br>Create an object type for an XML Schema-based view.
                           </li>
                           <li class="ulchildlink"><a href="XMLType-views.html#GUID-288BB72F-FFD9-453B-BDCA-9A75AA555192">Step 2. Create and Register XML Schema emp_complex.xsd</a><br>Create and register an XML schema, <code class="codeph">emp_complex.xsd</code>. The schema maps XML elements and attributes to corresponding object-relational object attributes.
                           </li>
                           <li class="ulchildlink"><a href="XMLType-views.html#GUID-197D406F-1384-4E86-B778-4F743E741433">Step 3a. Create XMLType View emp_xml Using Object Type emp_t</a><br>Create an <code class="codeph">XMLType</code> view using an object type.
                           </li>
                           <li class="ulchildlink"><a href="XMLType-views.html#GUID-EF8A2855-1364-4D6E-9023-7F6358F0A995">Step 3b. Create XMLType View emp_xml Using Object View emp_v</a><br>Create an <code class="codeph">XMLType</code> view using an object view.
                           </li>
                        </ul>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="XMLType-views.html#GUID-E50ECA03-3E64-4089-9770-62C98D23DD67" title="You can create an XML Schema-based XMLType view from object types or views by annotating the XML schema to define a mapping between XML types and SQL object types and object attributes.">Creating XML Schema-Based XMLType Views Using Object Types or Object Views</a></p>
                           </div>
                        </div>
                     </div>
                     <a id="ADXDB5185"></a><a id="ADXDB5184"></a><div class="props_rev_3"><a id="GUID-8B26B5AC-0449-4708-8B61-3A1F003D9922" name="GUID-8B26B5AC-0449-4708-8B61-3A1F003D9922"></a><h6 id="ADXDB-GUID-8B26B5AC-0449-4708-8B61-3A1F003D9922" class="sect6"><span class="enumeration_section">10.4.2.1.1 </span>Step 1. Create Object Types for XMLType Employee View
                        </h6>
                        <div>
                           <p>Create an object type for an XML Schema-based view.</p>
                           <div class="section">
                              <p><a href="XMLType-views.html#GUID-8B26B5AC-0449-4708-8B61-3A1F003D9922__CHDEBBJC">Example 10-9</a> creates the object types used in the other steps.
                              </p>
                           </div>
                           <!-- class="section" -->
                           <div class="example" id="GUID-8B26B5AC-0449-4708-8B61-3A1F003D9922__CHDEBBJC">
                              <p class="titleinexample">Example 10-9 Creating Object Types for Schema-Based XMLType Views</p><pre class="pre codeblock"><code>CREATE TYPE dept_t AS OBJECT 
      (deptno NUMBER(4), 
       dname  VARCHAR2(30), 
       loc    NUMBER(4)); 
/ 

CREATE TYPE emp_t AS OBJECT 
      (empno     NUMBER(6), 
       ename     VARCHAR2(25), 
       job       VARCHAR2(10), 
       mgr       NUMBER(6), 
       hiredate  DATE, 
       sal       NUMBER(8,2), 
       comm      NUMBER(2,2), 
       dept      dept_t); 
/</code></pre></div>
                           <!-- class="example" -->
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="XMLType-views.html#GUID-205D69F3-0966-4418-A241-A7BBB37C79A4" title="Examples here create XMLType view emp_xml based on object views.">Creating XMLType Employee View, with Nested Department Information</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="ADXDB5189"></a><a id="ADXDB5186"></a><div class="props_rev_3"><a id="GUID-288BB72F-FFD9-453B-BDCA-9A75AA555192" name="GUID-288BB72F-FFD9-453B-BDCA-9A75AA555192"></a><h6 id="ADXDB-GUID-288BB72F-FFD9-453B-BDCA-9A75AA555192" class="sect6"><span class="enumeration_section">10.4.2.1.2 </span>Step 2. Create and Register XML Schema emp_complex.xsd
                        </h6>
                        <div>
                           <p>Create and register an XML schema, <code class="codeph">emp_complex.xsd</code>. The schema maps XML elements and attributes to corresponding object-relational object attributes.
                           </p>
                           <div class="section">
                              <p>Create XML schema <code class="codeph">emp_complex.xsd</code>, which specifies how XML elements and attributes are mapped to corresponding object attributes in the object types (the <code class="codeph">xdb:SQLType</code> annotations), then register it. <a href="XMLType-views.html#GUID-288BB72F-FFD9-453B-BDCA-9A75AA555192__CHDFDHFI">Example 10-10</a> registers it.
                              </p>
                              <p><a href="XMLType-views.html#GUID-288BB72F-FFD9-453B-BDCA-9A75AA555192__CHDFDHFI">Example 10-10</a> creates and registers the XML schema using the target location <code class="codeph">http://www.oracle.com/emp_complex.xsd</code>.
                              </p>
                           </div>
                           <!-- class="section" -->
                           <div class="example" id="GUID-288BB72F-FFD9-453B-BDCA-9A75AA555192__CHDFDHFI">
                              <p class="titleinexample">Example 10-10 Creating and Registering XML Schema emp_complex.xsd</p><pre class="pre codeblock"><code>BEGIN
  -- Delete schema if it already exists (else error)
  DBMS_XMLSCHEMA.deleteSchema('http://www.oracle.com/emp_complex.xsd', 4);
END;
/

COMMIT;
 
BEGIN
  DBMS_XMLSCHEMA.registerSchema(
    SCHEMAURL =&gt; 'http://www.oracle.com/emp_complex.xsd', 
    SCHEMADOC =&gt; '&lt;?xml version="1.0"?&gt;
                  &lt;xsd:schema xmlns:xsd="http://www.w3.org/2001/XMLSchema" 
                              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
                              xmlns:xdb="http://xmlns.oracle.com/xdb" 
                              xsi:schemaLocation="http://xmlns.oracle.com/xdb 
                                                  http://xmlns.oracle.com/xdb/XDBSchema.xsd"&gt;
                    &lt;xsd:element name="<span class="bold">Employee</span>" type="EMP_TType" xdb:SQLType="EMP_T"/&gt;
                    &lt;xsd:complexType name="EMP_TType" xdb:SQLType="<span class="bold">EMP_T</span>" xdb:maintainDOM="false"&gt;
                      &lt;xsd:sequence&gt;
                        &lt;xsd:element name="EMPNO" type="xsd:double" xdb:SQLName="EMPNO" 
                                     xdb:SQLType="NUMBER"/&gt;
                        &lt;xsd:element name="ENAME" xdb:SQLName="ENAME" xdb:SQLType="VARCHAR2"&gt;
                          &lt;xsd:simpleType&gt;
                            &lt;xsd:restriction base="xsd:string"&gt;
                              &lt;xsd:maxLength value="25"/&gt;
                            &lt;/xsd:restriction&gt;
                          &lt;/xsd:simpleType&gt;
                        &lt;/xsd:element&gt;
                        &lt;xsd:element name="JOB" xdb:SQLName="JOB" xdb:SQLType="VARCHAR2"&gt;
                          &lt;xsd:simpleType&gt;
                            &lt;xsd:restriction base="xsd:string"&gt;
                              &lt;xsd:maxLength value="10"/&gt;
                            &lt;/xsd:restriction&gt;
                          &lt;/xsd:simpleType&gt;
                        &lt;/xsd:element&gt;
                        &lt;xsd:element name="MGR" type="xsd:double" xdb:SQLName="MGR" 
                                     xdb:SQLType="NUMBER"/&gt;
                        &lt;xsd:element name="HIREDATE" type="xsd:date" xdb:SQLName="HIREDATE" 
                                     xdb:SQLType="DATE"/&gt;
                        &lt;xsd:element name="SAL" type="xsd:double" xdb:SQLName="SAL" 
                                     xdb:SQLType="NUMBER"/&gt;
                        &lt;xsd:element name="COMM" type="xsd:double" xdb:SQLName="COMM" 
                                     xdb:SQLType="NUMBER"/&gt;
                        &lt;xsd:element name="<span class="bold">DEPT</span>" type="DEPT_TType" xdb:SQLName="DEPT"
                                     xdb:SQLType="DEPT_T"/&gt;
                      &lt;/xsd:sequence&gt;
                    &lt;/xsd:complexType&gt;
                    &lt;xsd:complexType name="DEPT_TType" xdb:SQLType="<span class="bold">DEPT_T</span>" 
                                     xdb:maintainDOM="false"&gt;
                      &lt;xsd:sequence&gt;
                        &lt;xsd:element name="DEPTNO" type="xsd:double" xdb:SQLName="DEPTNO" 
                                     xdb:SQLType="NUMBER"/&gt;
                        &lt;xsd:element name="DNAME" xdb:SQLName="DNAME" xdb:SQLType="VARCHAR2"&gt;
                          &lt;xsd:simpleType&gt;
                            &lt;xsd:restriction base="xsd:string"&gt;
                              &lt;xsd:maxLength value="30"/&gt;
                            &lt;/xsd:restriction&gt;
                          &lt;/xsd:simpleType&gt;
                        &lt;/xsd:element&gt;
                       &lt;xsd:element name="LOC" type="xsd:double" xdb:SQLName="LOC" 
                                    xdb:SQLType="NUMBER"/&gt;
                      &lt;/xsd:sequence&gt;
                    &lt;/xsd:complexType&gt;
                  &lt;/xsd:schema&gt;', 
    LOCAL     =&gt; TRUE, 
    GENTYPES  =&gt; FALSE);
END;
/
</code></pre></div>
                           <!-- class="example" -->
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="XMLType-views.html#GUID-205D69F3-0966-4418-A241-A7BBB37C79A4" title="Examples here create XMLType view emp_xml based on object views.">Creating XMLType Employee View, with Nested Department Information</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="ADXDB5191"></a><a id="ADXDB5190"></a><div class="props_rev_3"><a id="GUID-197D406F-1384-4E86-B778-4F743E741433" name="GUID-197D406F-1384-4E86-B778-4F743E741433"></a><h6 id="ADXDB-GUID-197D406F-1384-4E86-B778-4F743E741433" class="sect6"><span class="enumeration_section">10.4.2.1.3 </span>Step 3a. Create XMLType View emp_xml Using Object Type emp_t
                        </h6>
                        <div>
                           <p>Create an <code class="codeph">XMLType</code> view using an object type.
                           </p>
                           <div class="section">
                              <p><a href="XMLType-views.html#GUID-197D406F-1384-4E86-B778-4F743E741433__CHDJAGIC">Example 10-11</a> creates an <code class="codeph">XMLType</code> view using object type <code class="codeph">emp_t</code>.
                              </p>
                              <p><a href="XMLType-views.html#GUID-197D406F-1384-4E86-B778-4F743E741433__CHDJAGIC">Example 10-11</a> uses SQL/XML function <code class="codeph">XMLCast</code> in the <code class="codeph">OBJECT ID</code> clause to convert the XML employee number to SQL data type <code class="codeph">BINARY_DOUBLE</code>.
                              </p>
                              <div class="infoboxnotealso" id="GUID-197D406F-1384-4E86-B778-4F743E741433__GUID-37726CAE-DA92-4A28-BA09-8DF6A2FC61BF">
                                 <p class="notep1">See Also:</p>
                                 <p><a href="XMLType-views.html#GUID-EF8A2855-1364-4D6E-9023-7F6358F0A995" title="Create an XMLType view using an object view.">Step 3b. Create XMLType View emp_xml Using Object View emp_v</a> for an alternative way to create view <code class="codeph">emp_xml</code>, which uses object view <code class="codeph">emp_v</code></p>
                              </div>
                           </div>
                           <!-- class="section" -->
                           <div class="example" id="GUID-197D406F-1384-4E86-B778-4F743E741433__CHDJAGIC">
                              <p class="titleinexample">Example 10-11 Creating XMLType View emp_xml Using Object Type emp_t</p><pre class="oac_no_warn" dir="ltr">CREATE OR REPLACE VIEW <span class="bold">emp_xml</span> OF XMLType 
  XMLSCHEMA "http://www.oracle.com/emp_complex.xsd"
  ELEMENT "Employee" 
    WITH OBJECT ID (XMLCast(XMLQuery('/Employee/EMPNO'
                                     PASSING OBJECT_VALUE RETURNING CONTENT)
                            AS BINARY_DOUBLE)) AS 
  SELECT <span class="bold">emp_t</span>(e.employee_id, e.last_name, e.job_id, e.manager_id, e.hire_date, 
               e.salary, e.commission_pct,
               dept_t(d.department_id, d.department_name, d.location_id)) 
    FROM employees e, departments d 
    WHERE e.department_id = d.department_id;
</pre></div>
                           <!-- class="example" -->
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="XMLType-views.html#GUID-205D69F3-0966-4418-A241-A7BBB37C79A4" title="Examples here create XMLType view emp_xml based on object views.">Creating XMLType Employee View, with Nested Department Information</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="ADXDB5193"></a><a id="ADXDB5192"></a><div class="props_rev_3"><a id="GUID-EF8A2855-1364-4D6E-9023-7F6358F0A995" name="GUID-EF8A2855-1364-4D6E-9023-7F6358F0A995"></a><h6 id="ADXDB-GUID-EF8A2855-1364-4D6E-9023-7F6358F0A995" class="sect6"><span class="enumeration_section">10.4.2.1.4 </span>Step 3b. Create XMLType View emp_xml Using Object View emp_v
                        </h6>
                        <div>
                           <p>Create an <code class="codeph">XMLType</code> view using an object view.
                           </p>
                           <div class="section">
                              <p><a href="XMLType-views.html#GUID-EF8A2855-1364-4D6E-9023-7F6358F0A995__CHDEAFJH">Example 10-12</a> creates object view <code class="codeph">emp_v</code> and then creates <code class="codeph">XMLType</code> view <code class="codeph">emp_xml</code> based on that object view.
                              </p>
                              <div class="infoboxnotealso" id="GUID-EF8A2855-1364-4D6E-9023-7F6358F0A995__GUID-5C90308D-690D-4D23-BFF2-9D388BA4F0E2">
                                 <p class="notep1">See Also:</p>
                                 <p><a href="XMLType-views.html#GUID-197D406F-1384-4E86-B778-4F743E741433" title="Create an XMLType view using an object type.">Step 3a. Create XMLType View emp_xml Using Object Type emp_t</a> for an alternative way to create view <code class="codeph">emp_xml</code>, which uses object type <code class="codeph">emp_t</code></p>
                              </div>
                           </div>
                           <!-- class="section" -->
                           <div class="example" id="GUID-EF8A2855-1364-4D6E-9023-7F6358F0A995__CHDEAFJH">
                              <p class="titleinexample">Example 10-12 Creating an Object View and an XMLType View Based on the Object View</p><pre class="oac_no_warn" dir="ltr">CREATE OR REPLACE VIEW <span class="bold">emp_v</span> OF <span class="bold">emp_t</span> WITH OBJECT ID (empno) AS 
  SELECT <span class="bold">emp_t</span>(e.employee_id, e.last_name, e.job_id, e.manager_id, e.hire_date,
               e.salary, e.commission_pct,
               dept_t(d.department_id, d.department_name, d.location_id)) 
    FROM employees e, departments d 
    WHERE e.department_id = d.department_id;
 
CREATE OR REPLACE VIEW <span class="bold">emp_xml</span> OF XMLType 
  XMLSCHEMA "http://www.oracle.com/emp_complex.xsd" ELEMENT "Employee"
  WITH OBJECT ID DEFAULT AS
  SELECT VALUE(p) FROM <span class="bold">emp_v</span> p;</pre></div>
                           <!-- class="example" -->
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="XMLType-views.html#GUID-205D69F3-0966-4418-A241-A7BBB37C79A4" title="Examples here create XMLType view emp_xml based on object views.">Creating XMLType Employee View, with Nested Department Information</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div><a id="ADXDB5194"></a><div class="props_rev_3"><a id="GUID-6FFDAA7E-8505-4055-A476-6EEEBCF6D79E" name="GUID-6FFDAA7E-8505-4055-A476-6EEEBCF6D79E"></a><h5 id="ADXDB-GUID-6FFDAA7E-8505-4055-A476-6EEEBCF6D79E" class="sect5"><span class="enumeration_section">10.4.2.2 </span>Creating XMLType Department View, with Nested Employee Information
                     </h5>
                     <div>
                        <p><code class="codeph">XMLType</code> view <code class="codeph">dept_xml</code> is created so that each department in the view contains nested employee information. 
                        </p>
                        <div class="section">
                           <p>For the <span class="italic">last</span> step of the view creation, there are two <span class="italic">alternatives</span>:
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="XMLType-views.html#GUID-B30BAAA4-A9B0-4C74-96C7-89FCD44F7AA0" title="Create XMLType view dept_xml using object type dept_t.">Step 3a. Create XMLType View dept_xml Using Object Type dept_t</a> &#x2013; create <code class="codeph">XMLType</code> view <code class="codeph">dept_xml</code> using the object type for a department, <code class="codeph">dept_t</code></p>
                              </li>
                              <li>
                                 <p><a href="XMLType-views.html#GUID-50B49D70-F4A9-4C25-BABC-E0FBBB5F6FEF" title="You can use SQL/XML publishing functions to create XMLType view dept_xml from the relational tables without using object type dept_t.">Step 3b. Create XMLType View dept_xml Using Relational Data Directly</a> &#x2013; create <code class="codeph">XMLType</code> view <code class="codeph">dept_xml</code> using relational data directly
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="XMLType-views.html#GUID-055D62F0-797F-44DE-ADAE-AD3AEF5F4F6C">Step 1. Create Object Types for XMLType Department View</a><br>Create an object type for an XML Schema-based view.
                           </li>
                           <li class="ulchildlink"><a href="XMLType-views.html#GUID-A55D6F10-D953-44C6-8D71-3EDF99CAD0D3">Step 2. Register XML Schema dept_complex.xsd</a><br>Register XML schema <code class="codeph">dept_complex.xsd</code>. 
                           </li>
                           <li class="ulchildlink"><a href="XMLType-views.html#GUID-B30BAAA4-A9B0-4C74-96C7-89FCD44F7AA0">Step 3a. Create XMLType View dept_xml Using Object Type dept_t</a><br>Create <code class="codeph">XMLType</code> view <code class="codeph">dept_xml</code> using object type <code class="codeph">dept_t</code>.
                           </li>
                           <li class="ulchildlink"><a href="XMLType-views.html#GUID-50B49D70-F4A9-4C25-BABC-E0FBBB5F6FEF">Step 3b. Create XMLType View dept_xml Using Relational Data Directly</a><br>You can use SQL/XML publishing functions to create <code class="codeph">XMLType</code> view <code class="codeph">dept_xml</code> from the relational tables without using object type <code class="codeph">dept_t</code>. 
                           </li>
                        </ul>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="XMLType-views.html#GUID-E50ECA03-3E64-4089-9770-62C98D23DD67" title="You can create an XML Schema-based XMLType view from object types or views by annotating the XML schema to define a mapping between XML types and SQL object types and object attributes.">Creating XML Schema-Based XMLType Views Using Object Types or Object Views</a></p>
                           </div>
                        </div>
                     </div>
                     <a id="ADXDB5196"></a><a id="ADXDB5195"></a><div class="props_rev_3"><a id="GUID-055D62F0-797F-44DE-ADAE-AD3AEF5F4F6C" name="GUID-055D62F0-797F-44DE-ADAE-AD3AEF5F4F6C"></a><h6 id="ADXDB-GUID-055D62F0-797F-44DE-ADAE-AD3AEF5F4F6C" class="sect6"><span class="enumeration_section">10.4.2.2.1 </span>Step 1. Create Object Types for XMLType Department View
                        </h6>
                        <div>
                           <p>Create an object type for an XML Schema-based view.</p>
                           <div class="section">
                              <p><a href="XMLType-views.html#GUID-055D62F0-797F-44DE-ADAE-AD3AEF5F4F6C__CHDFHJCJ">Example 10-13</a> creates the object types used in the other steps.
                              </p>
                           </div>
                           <!-- class="section" -->
                           <div class="example" id="GUID-055D62F0-797F-44DE-ADAE-AD3AEF5F4F6C__CHDFHJCJ">
                              <p class="titleinexample">Example 10-13 Creating Object Types</p><pre class="pre codeblock"><code>CREATE TYPE emp_t AS OBJECT (empno    NUMBER(6),
                             ename    VARCHAR2(25), 
                             job      VARCHAR2(10), 
                             mgr      NUMBER(6), 
                             hiredate DATE, 
                             sal      NUMBER(8,2), 
                             comm     NUMBER(2,2)); /

CREATE OR REPLACE TYPE emplist_t AS TABLE OF emp_t; 
/

CREATE TYPE dept_t AS OBJECT (deptno NUMBER(4),
                              dname  VARCHAR2(30), 
                              loc    NUMBER(4),
                              emps   emplist_t); 
/</code></pre></div>
                           <!-- class="example" -->
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="XMLType-views.html#GUID-6FFDAA7E-8505-4055-A476-6EEEBCF6D79E" title="XMLType view dept_xml is created so that each department in the view contains nested employee information.">Creating XMLType Department View, with Nested Employee Information</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="ADXDB5198"></a><a id="ADXDB5197"></a><div class="props_rev_3"><a id="GUID-A55D6F10-D953-44C6-8D71-3EDF99CAD0D3" name="GUID-A55D6F10-D953-44C6-8D71-3EDF99CAD0D3"></a><h6 id="ADXDB-GUID-A55D6F10-D953-44C6-8D71-3EDF99CAD0D3" class="sect6"><span class="enumeration_section">10.4.2.2.2 </span>Step 2. Register XML Schema dept_complex.xsd
                        </h6>
                        <div>
                           <p>Register XML schema <code class="codeph">dept_complex.xsd</code>. 
                           </p>
                           <div class="section">
                              <p><a href="XMLType-views.html#GUID-A55D6F10-D953-44C6-8D71-3EDF99CAD0D3__CHDJDCGF">Example 10-14</a> illustrates this.
                              </p>
                           </div>
                           <!-- class="section" -->
                           <div class="example" id="GUID-A55D6F10-D953-44C6-8D71-3EDF99CAD0D3__CHDJDCGF">
                              <p class="titleinexample">Example 10-14 Registering XML Schema dept_complex.xsd</p><pre class="pre codeblock"><code>BEGIN
  -- Delete schema if it already exists (else error)
  DBMS_XMLSCHEMA.deleteSchema('http://www.oracle.com/dept_complex.xsd', 4);
END;
/

BEGIN
  DBMS_XMLSCHEMA.registerSchema(
    SCHEMAURL =&gt; 'http://www.oracle.com/dept_complex.xsd',
    SCHEMADOC =&gt; '&lt;?xml version="1.0"?&gt;
                  &lt;xsd:schema xmlns:xsd="http://www.w3.org/2001/XMLSchema" 
                              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
                              xmlns:xdb="http://xmlns.oracle.com/xdb"            
                              xsi:schemaLocation="http://xmlns.oracle.com/xdb 
                                                  http://xmlns.oracle.com/xdb/XDBSchema.xsd"&gt;
                    &lt;xsd:element name="<span class="bold">Department</span>" type="DEPT_TType" xdb:SQLType="<span class="bold">DEPT_T</span>"/&gt;
                    &lt;xsd:complexType name="DEPT_TType" xdb:SQLType="<span class="bold">DEPT_T</span>" 
                                     xdb:maintainDOM="false"&gt;
                      &lt;xsd:sequence&gt;
                        &lt;xsd:element name="DEPTNO" type="xsd:double" xdb:SQLName="DEPTNO" 
                                     xdb:SQLType="NUMBER"/&gt;
                        &lt;xsd:element name="DNAME" xdb:SQLName="DNAME" xdb:SQLType="VARCHAR2"&gt;
                          &lt;xsd:simpleType&gt;
                            &lt;xsd:restriction base="xsd:string"&gt;
                              &lt;xsd:maxLength value="30"/&gt;
                            &lt;/xsd:restriction&gt;
                          &lt;/xsd:simpleType&gt;
                        &lt;/xsd:element&gt;
                        &lt;xsd:element name="LOC" type="xsd:double" xdb:SQLName="LOC" 
                                     xdb:SQLType="NUMBER"/&gt;
                        &lt;xsd:element name="<span class="bold">EMPS</span>" type="EMP_TType" maxOccurs="unbounded" 
                                     minOccurs="0" xdb:SQLName="EMPS" 
                                     xdb:SQLCollType="EMPLIST_T" xdb:SQLType="<span class="bold">EMP_T</span>"  
                                     xdb:SQLCollSchema="HR"/&gt;
                      &lt;/xsd:sequence&gt;
                    &lt;/xsd:complexType&gt;
                    &lt;xsd:complexType name="EMP_TType" xdb:SQLType="<span class="bold">EMP_T</span>" xdb:maintainDOM="false"&gt;
                      &lt;xsd:sequence&gt;
                        &lt;xsd:element name="EMPNO" type="xsd:double" xdb:SQLName="EMPNO" 
                                     xdb:SQLType="NUMBER"/&gt;
                        &lt;xsd:element name="ENAME" xdb:SQLName="ENAME" xdb:SQLType="VARCHAR2"&gt;
                          &lt;xsd:simpleType&gt;
                            &lt;xsd:restriction base="xsd:string"&gt;
                              &lt;xsd:maxLength value="25"/&gt;
                            &lt;/xsd:restriction&gt;
                          &lt;/xsd:simpleType&gt;
                        &lt;/xsd:element&gt;
                        &lt;xsd:element name="JOB" xdb:SQLName="JOB" xdb:SQLType="VARCHAR2"&gt;
                          &lt;xsd:simpleType&gt;
                            &lt;xsd:restriction base="xsd:string"&gt;
                              &lt;xsd:maxLength value="10"/&gt;
                            &lt;/xsd:restriction&gt;
                          &lt;/xsd:simpleType&gt;
                        &lt;/xsd:element&gt;
                        &lt;xsd:element name="MGR" type="xsd:double" xdb:SQLName="MGR" 
                                     xdb:SQLType="NUMBER"/&gt;
                        &lt;xsd:element name="HIREDATE" type="xsd:date" xdb:SQLName="HIREDATE" 
                                     xdb:SQLType="DATE"/&gt;
                        &lt;xsd:element name="SAL" type="xsd:double" xdb:SQLName="SAL" 
                                     xdb:SQLType="NUMBER"/&gt;
                        &lt;xsd:element name="COMM" type="xsd:double" xdb:SQLName="COMM"   
                                     xdb:SQLType="NUMBER"/&gt;
                      &lt;/xsd:sequence&gt;
                    &lt;/xsd:complexType&gt;
                  &lt;/xsd:schema&gt;', 
    LOCAL     =&gt; TRUE, 
    GENTYPES  =&gt; FALSE);
END;
/</code></pre></div>
                           <!-- class="example" -->
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="XMLType-views.html#GUID-6FFDAA7E-8505-4055-A476-6EEEBCF6D79E" title="XMLType view dept_xml is created so that each department in the view contains nested employee information.">Creating XMLType Department View, with Nested Employee Information</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="ADXDB5200"></a><a id="ADXDB5199"></a><div class="props_rev_3"><a id="GUID-B30BAAA4-A9B0-4C74-96C7-89FCD44F7AA0" name="GUID-B30BAAA4-A9B0-4C74-96C7-89FCD44F7AA0"></a><h6 id="ADXDB-GUID-B30BAAA4-A9B0-4C74-96C7-89FCD44F7AA0" class="sect6"><span class="enumeration_section">10.4.2.2.3 </span>Step 3a. Create XMLType View dept_xml Using Object Type dept_t
                        </h6>
                        <div>
                           <p>Create <code class="codeph">XMLType</code> view <code class="codeph">dept_xml</code> using object type <code class="codeph">dept_t</code>.
                           </p>
                           <div class="section">
                              <p><a href="XMLType-views.html#GUID-B30BAAA4-A9B0-4C74-96C7-89FCD44F7AA0__CHDBHBCH">Example 10-15</a> illustrates this.
                              </p>
                           </div>
                           <!-- class="section" -->
                           <div class="example" id="GUID-B30BAAA4-A9B0-4C74-96C7-89FCD44F7AA0__CHDBHBCH">
                              <p class="titleinexample">Example 10-15 Creating XMLType View dept_xml Using Object Type dept_t</p><pre class="pre codeblock"><code>CREATE OR REPLACE VIEW dept_xml OF XMLType
  XMLSCHEMA "http://www.oracle.com/dept_complex.xsd" ELEMENT "Department"
  WITH OBJECT ID (XMLCast(XMLQuery('/Department/DEPTNO'
                                   PASSING OBJECT_VALUE RETURNING CONTENT)
                          AS BINARY_DOUBLE)) AS
  SELECT <span class="bold">dept_t</span>(d.department_id, d.department_name, d.location_id,
                cast(MULTISET
                     (SELECT emp_t(e.employee_id, e.last_name, e.job_id,
                                   e.manager_id, e.hire_date,
                                   e.salary, e.commission_pct) 
                        FROM employees e WHERE e.department_id = d.department_id) 
                     AS emplist_t))
    FROM departments d;</code></pre></div>
                           <!-- class="example" -->
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="XMLType-views.html#GUID-6FFDAA7E-8505-4055-A476-6EEEBCF6D79E" title="XMLType view dept_xml is created so that each department in the view contains nested employee information.">Creating XMLType Department View, with Nested Employee Information</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="ADXDB5202"></a><a id="ADXDB5201"></a><div class="props_rev_3"><a id="GUID-50B49D70-F4A9-4C25-BABC-E0FBBB5F6FEF" name="GUID-50B49D70-F4A9-4C25-BABC-E0FBBB5F6FEF"></a><h6 id="ADXDB-GUID-50B49D70-F4A9-4C25-BABC-E0FBBB5F6FEF" class="sect6"><span class="enumeration_section">10.4.2.2.4 </span>Step 3b. Create XMLType View dept_xml Using Relational Data Directly
                        </h6>
                        <div>
                           <p>You can use SQL/XML publishing functions to create <code class="codeph">XMLType</code> view <code class="codeph">dept_xml</code> from the relational tables without using object type <code class="codeph">dept_t</code>. 
                           </p>
                           <div class="section">
                              <p><a href="XMLType-views.html#GUID-50B49D70-F4A9-4C25-BABC-E0FBBB5F6FEF__CHDEHIFF">Example 10-16</a> illustrates this.
                              </p>
                              <div class="infoboxnote" id="GUID-50B49D70-F4A9-4C25-BABC-E0FBBB5F6FEF__GUID-2E06B65F-12C2-4D27-9A94-E43164A83C40">
                                 <p class="notep1">Note:</p>
                                 <p>XML schema and element information must be specified at the view level, because the <code class="codeph">SELECT</code> list could arbitrarily construct XML of a different XML schema from the underlying table.
                                 </p>
                              </div>
                           </div>
                           <!-- class="section" -->
                           <div class="example" id="GUID-50B49D70-F4A9-4C25-BABC-E0FBBB5F6FEF__CHDEHIFF">
                              <p class="titleinexample">Example 10-16 Creating XMLType View dept_xml Using Relational Data Directly</p><pre class="pre codeblock"><code>CREATE OR REPLACE VIEW dept_xml OF XMLType
  XMLSCHEMA "http://www.oracle.com/dept_complex.xsd" ELEMENT "Department"
  WITH OBJECT ID (XMLCast(XMLQuery('/Department/DEPTNO'
                                   PASSING OBJECT_VALUE RETURNING CONTENT)
                          AS BINARY_DOUBLE)) AS
  SELECT  
    XMLElement(
      "Department",
      XMLAttributes('http://www.oracle.com/dept_complex.xsd' AS "xmlns",        
                    'http://www.w3.org/2001/XMLSchema-instance' AS "xmlns:xsi",
                    'http://www.oracle.com/dept_complex.xsd 
                     http://www.oracle.com/dept_complex.xsd' 
                      AS "xsi:schemaLocation"),
      XMLForest(d.department_id "DeptNo", d.department_name "DeptName",
                d.location_id "Location"),
      (SELECT XMLAgg(XMLElement("Employee",
                                XMLForest(e.employee_id "EmployeeId", 
                                          e.last_name "Name", 
                                          e.job_id "Job", 
                                          e.manager_id "Manager", 
                                          e.hire_date "Hiredate",
                                          e.salary "Salary",
                                          e.commission_pct "Commission")))
                      FROM employees e WHERE e.department_id = d.department_id))
    FROM departments d;</code></pre></div>
                           <!-- class="example" -->
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="XMLType-views.html#GUID-6FFDAA7E-8505-4055-A476-6EEEBCF6D79E" title="XMLType view dept_xml is created so that each department in the view contains nested employee information.">Creating XMLType Department View, with Nested Employee Information</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div>
               </div>
            </div><a id="ADXDB5204"></a><a id="ADXDB5205"></a><a id="ADXDB5203"></a><div class="props_rev_3"><a id="GUID-5191DBB9-EEA9-402C-BAD2-28AB6894E63D" name="GUID-5191DBB9-EEA9-402C-BAD2-28AB6894E63D"></a><h3 id="ADXDB-GUID-5191DBB9-EEA9-402C-BAD2-28AB6894E63D" class="sect3"><span class="enumeration_section">10.5 </span>Creating XMLType Views from XMLType Tables
               </h3>
               <div>
                  <p>An <code class="codeph">XMLType</code> view can be created on an <code class="codeph">XMLType</code> table, for example, to transform the XML data or to restrict the rows returned. 
                  </p>
                  <div class="section">
                     <p><a href="XMLType-views.html#GUID-5191DBB9-EEA9-402C-BAD2-28AB6894E63D__CFHJBHJI">Example 10-17</a> creates an <code class="codeph">XMLType</code> view by restricting the rows included from an underlying <code class="codeph">XMLType</code> table. It uses XML schema <code class="codeph">dept_complex.xsd</code> to create the underlying tablesee <a href="XMLType-views.html#GUID-6FFDAA7E-8505-4055-A476-6EEEBCF6D79E" title="XMLType view dept_xml is created so that each department in the view contains nested employee information.">Creating XMLType Department View, with Nested Employee Information</a>.
                     </p>
                     <p><a href="XMLType-views.html#GUID-5191DBB9-EEA9-402C-BAD2-28AB6894E63D__CHDIIIAG">Example 10-18</a> shows how you can create an <code class="codeph">XMLType</code> view by transforming XML data using an XSL stylesheet. 
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section"></div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-5191DBB9-EEA9-402C-BAD2-28AB6894E63D__CFHJBHJI">
                     <p class="titleinexample">Example 10-17 Creating an XMLType View by Restricting Rows from an XMLType Table</p><pre class="oac_no_warn" dir="ltr">CREATE TABLE dept_xml_tab OF XMLType 
    XMLSchema "http://www.oracle.com/dept_complex.xsd" ELEMENT "Department"
    NESTED TABLE XMLDATA."EMPS" STORE AS dept_xml_tab_tab1;
 
CREATE OR REPLACE VIEW dallas_dept_view OF XMLType 
    XMLSchema "http://www.oracle.com/dept.xsd" ELEMENT "Department"
        AS SELECT OBJECT_VALUE FROM dept_xml_tab 
           WHERE XMLCast(XMLQuery('/Department/LOC'
                                  PASSING OBJECT_VALUE RETURNING CONTENT)
                         AS VARCHAR2(20))
                 = 'DALLAS'; 
</pre><p>Here, <code class="codeph">dallas_dept_view</code> restricts the <code class="codeph">XMLType</code> table rows to those departments whose location is Dallas.
                     </p>
                  </div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-5191DBB9-EEA9-402C-BAD2-28AB6894E63D__CHDIIIAG">
                     <p class="titleinexample">Example 10-18 Creating an XMLType View by Transforming an XMLType Table</p><pre class="oac_no_warn" dir="ltr">CREATE OR REPLACE VIEW hr_po_tab OF XMLType 
  ELEMENT "PurchaseOrder" WITH OBJECT ID DEFAULT AS
  SELECT XMLtransform(OBJECT_VALUE, x.col1)
    FROM purchaseorder p, xsl_tab x;</pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="transformation-and-validation-of-XMLType-data.html#GUID-9E65513C-C113-4EA1-8511-462AC3EEE2D8" title="SQL function XMLtransform transforms an XML document by using an XSLT stylesheet. It returns the processed output as XML, HTML, and so on, as specified by the stylesheet.">SQL Function XMLTRANSFORM and XMLType Method TRANSFORM()</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="XMLType-views.html#GUID-9F0A7B1F-269B-411F-AD8B-8F1CB2E2A671" title="You can create XMLType views over relational and object-relational data.">XMLType Views</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB5206"></a><div class="props_rev_3"><a id="GUID-72A94695-5890-4BA1-8FD1-6D26E1C4349B" name="GUID-72A94695-5890-4BA1-8FD1-6D26E1C4349B"></a><h3 id="ADXDB-GUID-72A94695-5890-4BA1-8FD1-6D26E1C4349B" class="sect3"><span class="enumeration_section">10.6 </span>Referencing XMLType View Objects Using SQL Function REF
               </h3>
               <div>
                  <p>You can reference an <code class="codeph">XMLType</code> view object using SQL function <code class="codeph">ref</code>.
                  </p>
                  <div class="section"><pre class="pre codeblock"><code>SELECT ref(d) FROM dept_xml_tab d;
</code></pre><p>An <code class="codeph">XMLType</code> view reference is based on one of the following object IDs:
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>System-generated OID  for views on <code class="codeph">XMLType</code> tables or object views
                           </p>
                        </li>
                        <li>
                           <p>Primary key based OID -- for views with <code class="codeph">OBJECT ID</code> expressions
                           </p>
                        </li>
                     </ul>
                     <p>These <code class="codeph">REF</code>s can be used to fetch <code class="codeph">OCIXMLType</code> instances in the OCI Object cache, or they can be used in SQL queries. These <code class="codeph">REF</code>s act the same as <code class="codeph">REF</code>s to object views.
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="XMLType-views.html#GUID-9F0A7B1F-269B-411F-AD8B-8F1CB2E2A671" title="You can create XMLType views over relational and object-relational data.">XMLType Views</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB5208"></a><a id="ADXDB5207"></a><div class="props_rev_3"><a id="GUID-FF5B6A10-191B-45E0-810F-A7F0CFF71711" name="GUID-FF5B6A10-191B-45E0-810F-A7F0CFF71711"></a><h3 id="ADXDB-GUID-FF5B6A10-191B-45E0-810F-A7F0CFF71711" class="sect3"><span class="enumeration_section">10.7 </span>Using DML (Data Manipulation Language) on XMLType Views
               </h3>
               <div>
                  <p>A given <code class="codeph">XMLType</code> view might not be implicitly updatable. In that case, you must write instead-of triggers to handle all DML. To determine whether an <code class="codeph">XMLType</code> view is implicitly updatable, query it to see whether it is based on an object view or constructor that is itself inherently updatable.
                  </p>
                  <div class="section">
                     <p> <a href="XMLType-views.html#GUID-FF5B6A10-191B-45E0-810F-A7F0CFF71711__CFHBIHCF">Example 10-19</a> illustrates this.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-FF5B6A10-191B-45E0-810F-A7F0CFF71711__CFHBIHCF">
                     <p class="titleinexample">Example 10-19 Determining Whether an XMLType View Is Implicitly Updatable, and Updating It</p><pre class="pre codeblock"><code>CREATE TYPE dept_t AS OBJECT 
      (deptno NUMBER(4), 
       dname  VARCHAR2(30), 
       loc    NUMBER(4)); 
/

BEGIN
  -- Delete schema if it already exists (else error)
  DBMS_XMLSCHEMA.deleteSchema('http://www.oracle.com/dept_t.xsd', 4);
END;
/
COMMIT;
 
BEGIN
  DBMS_XMLSCHEMA.registerSchema(
    SCHEMAURL =&gt; 'http://www.oracle.com/dept_t.xsd',
    SCHEMADOC =&gt; '&lt;?xml version="1.0"?&gt;
                  &lt;xsd:schema xmlns:xsd="http://www.w3.org/2001/XMLSchema" 
                              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
                              xmlns:xdb="http://xmlns.oracle.com/xdb" 
                              xsi:schemaLocation="http://xmlns.oracle.com/xdb 
                                                  http://xmlns.oracle.com/xdb/XDBSchema.xsd"&gt;
                    &lt;xsd:element name="Department" type="DEPT_TType" xdb:SQLType="DEPT_T"/&gt;
                    &lt;xsd:complexType name="DEPT_TType" xdb:SQLType="DEPT_T"
                                     xdb:maintainDOM="false"&gt;
                      &lt;xsd:sequence&gt;
                        &lt;xsd:element name="DEPTNO" type="xsd:double" xdb:SQLName="DEPTNO" 
                                     xdb:SQLType="NUMBER"/&gt;
                        &lt;xsd:element name="DNAME" xdb:SQLName="DNAME" xdb:SQLType="VARCHAR2"&gt;
                          &lt;xsd:simpleType&gt;
                            &lt;xsd:restriction base="xsd:string"&gt;
                              &lt;xsd:maxLength value="30"/&gt;
                            &lt;/xsd:restriction&gt;
                          &lt;/xsd:simpleType&gt;
                        &lt;/xsd:element&gt;
                        &lt;xsd:element name="LOC" type="xsd:double" xdb:SQLName="LOC" 
                                     xdb:SQLType="NUMBER"/&gt;
                      &lt;/xsd:sequence&gt;
                    &lt;/xsd:complexType&gt;
                  &lt;/xsd:schema&gt;', 
    LOCAL     =&gt; TRUE, 
    GENTYPES  =&gt; FALSE);
END;
/

CREATE OR REPLACE VIEW dept_xml of XMLType
  XMLSchema "http://www.oracle.com/dept_t.xsd" element "Department"
  WITH OBJECT ID (XMLCast(XMLQuery('/Department/DEPTNO'
                                   PASSING OBJECT_VALUE RETURNING CONTENT)
                          AS BINARY_DOUBLE)) AS
  SELECT dept_t(d.department_id, d.department_name, d.location_id) 
    FROM departments d;

INSERT INTO dept_xml 
  VALUES (
    XMLType.createXML(
      '&lt;Department 
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
         xsi:noNamespaceSchemaLocation="http://www.oracle.com/dept_t.xsd" &gt;
         &lt;DEPTNO&gt;300&lt;/DEPTNO&gt;
         &lt;DNAME&gt;Processing&lt;/DNAME&gt;
         &lt;LOC&gt;1700&lt;/LOC&gt;
       &lt;/Department&gt;'));

UPDATE dept_xml d
  SET d.OBJECT_VALUE =
    XMLQuery('copy $i := $p1 modify
                (for $j in $i/Department/DNAME
                 return replace value of node $j with $p2)
              return $i'
             PASSING d.OBJECT_VALUE AS "p1", 'Shipping' AS "p2" RETURNING CONTENT)
    WHERE XMLExists('/Department[DEPTNO=300]' PASSING OBJECT_VALUE);</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="XMLType-views.html#GUID-9F0A7B1F-269B-411F-AD8B-8F1CB2E2A671" title="You can create XMLType views over relational and object-relational data.">XMLType Views</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>