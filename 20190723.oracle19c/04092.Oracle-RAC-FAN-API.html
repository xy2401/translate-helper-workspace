<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Oracle RAC Fast Application Notification</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="JDBC Developer's Guide">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="JDBC Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="jdbc-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-02-13T13:20:37-08:00">
      <meta name="dcterms.title" content="JDBC Developer's Guide">
      <meta name="dcterms.dateCopyrighted" content="1999, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96471-02">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="JDBC-reference-information.html" title="Previous" type="text/html">
      <link rel="next" href="JDBC-coding-tips.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="JJDBC">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="JDBC-reference-information.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="JDBC-coding-tips.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">JDBC Developer's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="appendixes.html" property="item" typeof="WebPage"><span property="name"> Appendixes</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Oracle RAC Fast Application Notification</li>
            </ol>
            <a id="GUID-672941ED-9553-4779-B1AD-7FEBC07603D6" name="GUID-672941ED-9553-4779-B1AD-7FEBC07603D6"></a><a id="JJDBC28934"></a>
            
            <h2 id="JJDBC-GUID-672941ED-9553-4779-B1AD-7FEBC07603D6" class="sect2"><span class="enumeration_chapter">B </span>Oracle RAC Fast Application Notification
            </h2>
         </header>
         <div class="ind">
            <div>
               <div class="section">
                  <p>Starting from Oracle Database 12<span class="italic">c </span>Release 1 (12.1), the Oracle RAC Fast Application Notification (FAN) APIs provide an alternative for taking advantage of the high-availability (HA) features of Oracle Database, if you do not use Universal Connection Pool or Oracle WebLogic Server with Active Grid Link (AGL).
                  </p>
                  <p>This appendix covers the following topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="Oracle-RAC-FAN-API.html#GUID-564CF905-2682-48DB-B818-94C5F65A29AB">Overview of Oracle RAC Fast Application Notification</a></p>
                     </li>
                     <li>
                        <p><a href="Oracle-RAC-FAN-API.html#GUID-4F5A94F1-0ED0-45C7-A52F-8E6F68F1D7DF">Installing and Configuring Oracle RAC Fast Application Notification</a></p>
                     </li>
                     <li>
                        <p><a href="Oracle-RAC-FAN-API.html#GUID-FA425A8A-C25F-4CE8-A54E-50C038379AC5">Using Oracle RAC Fast Application Notification</a></p>
                     </li>
                     <li>
                        <p><a href="Oracle-RAC-FAN-API.html#GUID-B057A535-2AAE-4F91-BBFC-2FA596FEC689">Implementing a Connection Pool</a></p>
                     </li>
                  </ul>
                  <p>This feature depends on the Oracle Notification System (ONS) message transport mechanism. This feature requires configuring your system, servers, and clients to use ONS.</p>
                  <p>For using Oracle RAC Fast Application Notification, the <code class="codeph">simplefan.jar</code> file must be present in the <code class="codeph">CLASSPATH</code>, and either the <code class="codeph">ons.jar</code> file must be present in the <code class="codeph">CLASSPATH</code> or an Oracle Notification Services (ONS) client must be installed and running in the client system.
                  </p>
               </div>
               <!-- class="section" -->
            </div><a id="JJDBC28935"></a><div class="props_rev_3"><a id="GUID-564CF905-2682-48DB-B818-94C5F65A29AB" name="GUID-564CF905-2682-48DB-B818-94C5F65A29AB"></a><h3 id="JJDBC-GUID-564CF905-2682-48DB-B818-94C5F65A29AB" class="sect3"><span class="enumeration_section">B.1 </span>Overview of Oracle RAC Fast Application Notification
               </h3>
               <div>
                  <p>The Oracle RAC Fast Application Notification (FAN) feature provides a simplified API for accessing FAN events through a callback mechanism. This mechanism enables third-party drivers, connection pools, and containers to subscribe, receive and process FAN events. These APIs are referred to as Oracle RAC FAN APIs in this appendix.</p>
                  <p>The Oracle RAC FAN APIs provide FAN event notification for developing more responsive applications that can take full advantage of Oracle Database HA features. If you do not want to use Universal Connection Pool, but want to work with FAN events implementing your own connection pool, then you should use Oracle RAC Fast Application Notification.</p>
                  <div class="infoboxnote" id="GUID-564CF905-2682-48DB-B818-94C5F65A29AB__GUID-BF23AFB9-218C-4D9C-923F-851E91FDF257">
                     <p class="notep1">Note:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>If you do not want to implement your own connection pool, then you should use Oracle Universal Connection Pool to get all the advantages of Oracle RAC Fast Application Notification, along with many additional benefits.</p>
                        </li>
                        <li>
                           <p>Starting from Oracle Database 12<span class="italic">c </span>Release 1 (12.1), implicit connection cache (ICC) is desupported. Oracle recommends to use Universal Connection Pool instead.
                           </p>
                        </li>
                     </ul>
                  </div>
                  <p>Your applications are enabled to respond to FAN events in the following way:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Listening for Oracle RAC service down and node down events.</p>
                     </li>
                     <li>
                        <p>Listening for Oracle RAC service up events representing any Oracle RAC or Global data Service (GDS) start or restart. For these UP events, FAN parameter status is <code class="codeph">UP</code> and <code class="codeph">event_type</code> is one of the following: <code class="codeph">database</code>, <code class="codeph">instance</code>, <code class="codeph">service</code>, or <code class="codeph">servicemember</code>.
                        </p>
                     </li>
                     <li>
                        <p>Supporting FAN ONS event syntax and fields for both Oracle Database Release 12<span class="italic">c</span> and earlier releases, for example, the <code class="codeph">event_type</code> and <code class="codeph">timezone</code> fields added to every event, the <code class="codeph">db_domain</code> field added to every event other than node or public-network events, the <code class="codeph">percentf</code> field added to Run-Time Load Balancing (RLB) events, and so on.
                        </p>
                     </li>
                     <li>
                        <p>Listening for load balancing advisory events and responding to them.</p>
                     </li>
                  </ul>
                  <p>This feature exposes the FAN events, which are the notifications sent by a cluster running Oracle RAC, to inform the subscribers about an event happening at the service level or the node level. The supported FAN events are the following:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Service up</p>
                        <p>The service up event notifies the connection pool that a new instance is available for use, allowing sessions to be created on the new instance. The <code class="codeph">ServiceUpEvent</code> Client API is supported in the current release of the Oracle RAC FAN APIs, that is, in the <code class="codeph">simplefan.jar</code> file.
                        </p>
                     </li>
                     <li>
                        <p>Service down</p>
                        <p>The service down events notify that the managed resources are down and currently not available for access. There are two types of service down events:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Events indicating that a particular instance of a service is down and the instance is no longer able to accept work.</p>
                           </li>
                           <li>
                              <p>Events indicating that all-but-one instances of a service are down and the service is no longer able to accept work.</p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>Node down</p>
                        <p>The node down events notify that the Oracle RAC node identified by the host identifier is down and not reachable. The cluster sends node down events when a node is no longer able to accept work.</p>
                     </li>
                     <li>
                        <p>Planned down</p>
                        <p>Planned down events include all the down events, except node down event. These events have the following two fields set: <code class="codeph">status=down</code> and <code class="codeph">reason=user</code>.
                        </p>
                     </li>
                     <li>
                        <p>Load balancing advisory</p>
                        <p>The load balancing advisory events provide metrics for load balancing algorithms. Load balancing advisories are sent regularly to inform subscribers of the recommended distribution of work among the available nodes.</p>
                     </li>
                  </ul>
                  <div class="infoboxnote" id="GUID-564CF905-2682-48DB-B818-94C5F65A29AB__GUID-3BA34760-5BD3-4C5F-8152-C8E38DD78831">
                     <p class="notep1">Note:</p>
                     <p>If you want to implement your own connection pool, only then you should use Oracle RAC Fast Application Notification. Otherwise, you should use Oracle Universal Connection Pool to get all the advantages of Oracle RAC Fast Application Notification, along with many additional benefits.</p>
                  </div>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="../jjucp/index.html" target="_blank"><span><cite>Oracle Universal Connection Pool Developer’s Guide</cite></span></a></li>
                     </ul>
                  </div>
               </div>
            </div><a id="JJDBC28936"></a><div class="props_rev_3"><a id="GUID-4F5A94F1-0ED0-45C7-A52F-8E6F68F1D7DF" name="GUID-4F5A94F1-0ED0-45C7-A52F-8E6F68F1D7DF"></a><h3 id="JJDBC-GUID-4F5A94F1-0ED0-45C7-A52F-8E6F68F1D7DF" class="sect3"><span class="enumeration_section">B.2 </span>Installing and Configuring Oracle RAC Fast Application Notification
               </h3>
               <div>
                  <div class="section">
                     <p>You can install the Oracle RAC FAN APIs by performing the following steps:</p>
                     <ol>
                        <li>
                           <p>Download the <code class="codeph">simplefan.jar</code> file from the following link
                           </p><pre class="oac_no_warn" dir="ltr">
<a href="http://www.oracle.com/technetwork/database/application-development/jdbc/jdbc-ucp-122-3110062.html" target="_blank">http://www.oracle.com/technetwork/database/application-development/jdbc/jdbc-ucp-122-3110062.html</a></pre></li>
                        <li>
                           <p>Add the <code class="codeph">simplefan.jar</code> file to the classpath.
                           </p>
                        </li>
                        <li>
                           <p>Perform the following in your Java code:</p>
                           <ol type="a">
                              <li>
                                 <p>Get an instance of the <code class="codeph">FanManager</code> class by using the <code class="codeph">getInstance</code> method.
                                 </p>
                              </li>
                              <li>
                                 <p>Configure the event daemon using the <code class="codeph">configure</code> method of the <code class="codeph">FanManager</code> class. The <code class="codeph">configure</code> method sets the following properties:
                                 </p>
                                 <p><code class="codeph">onsNodes</code>: A comma separated list of <code class="codeph">host:port</code> pairs of ONS daemons that the ONS runtime in this Java VM should communicate with. The <code class="codeph">host</code> in a <code class="codeph">host:port</code> pair is the host name of a system running the ONS daemon. The <code class="codeph">port</code> is the local port configuration parameter for that daemon.
                                 </p>
                                 <p><code class="codeph">onsWalletFile</code>: The path name of the ONS wallet file. The wallet file is the path to a local wallet file used by SSL to store SSL certificates. Same as wallet file configuration parameter to ONS daemon.
                                 </p>
                                 <p><code class="codeph">onsWalletPassword</code>: The password for accessing the ONS wallet file.
                                 </p>
                              </li>
                           </ol>
                        </li>
                     </ol>
                     <div class="infoboxnotealso" id="GUID-4F5A94F1-0ED0-45C7-A52F-8E6F68F1D7DF__GUID-1B503FB8-D058-40F7-BC11-605357BE3F1F">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>For a detailed description of the Oracle RAC FAN APIs, refer to <a href="../jafan/index.html" target="_blank"><span class="italic">Oracle Database RAC FAN Events Java API Reference</span></a>.
                              </p>
                           </li>
                           <li>
                              <p><a href="../jjucp/fast-connection-failover.html#JJUCP-GUID-0D8CD8C4-734F-49F7-8737-9AC03173C73F" target="_blank"><span><cite>Oracle Universal Connection Pool Developer’s Guide</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDBC28946"></a><a id="JJDBC28945"></a><div class="props_rev_3"><a id="GUID-FA425A8A-C25F-4CE8-A54E-50C038379AC5" name="GUID-FA425A8A-C25F-4CE8-A54E-50C038379AC5"></a><h3 id="JJDBC-GUID-FA425A8A-C25F-4CE8-A54E-50C038379AC5" class="sect3"><span class="enumeration_section">B.3 </span>Using Oracle RAC Fast Application Notification
               </h3>
               <div>
                  <div class="section">
                     <p>The following code snippet explains how to handle FAN down events. This example code prints the event data to the standard output device.</p>
                     <p>This example code demonstrates how to use Oracle RAC FAN APIs by overloading the <code class="codeph">handleFanEvent</code> method to accept different FAN event notifications as arguments. The example code also displays event data such as:
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Name of the system sending the FAN event notification</p>
                        </li>
                        <li>
                           <p>Timestamp of the FAN event notification</p>
                        </li>
                        <li>
                           <p>Load status of the FAN event notification</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-FA425A8A-C25F-4CE8-A54E-50C038379AC5__CDCDJIAC">
                     <p class="titleinexample">Example B-1 Example of Sample Code Using Oracle RAC FAN API for FAN Down Events</p><pre class="oac_no_warn" dir="ltr">...
...Properties props = new Properties();
props.putProperty(“serviceName", “gl");
FanSubscription sub = FanManager.getInstance().subscribe(props);
sub.addListener(new FanEventListener()) {
  public void handleFanEvent(ServiceDownEvent se) {
    try {
      System.out.println(event.getTimestamp());
      System.out.println(event.getServiceName());
      System.out.println(event.getDatabaseUniqueName());
      System.out.println(event.getReason());
      ServiceMemberEvent me = se.getServiceMemberEvent();
      if (me != null) {
        System.out.println(me.getInstanceName());
        System.out.println(me.getNodeName());
        System.out.println(me.getServiceMemberStatus());
      }
      ServiceCompositeEvent ce = se.getServiceCompositeEvent();
      if (ce != null) {
        System.out.println(ce.getServiceCompositeStatus());
      }
    }
    catch (Throwable t) {
      // handle all exceptions and errors
      t.printStackTrace(System.err);
    }
  }
  public void handleFanEvent(NodeDownEvent ne) {
    try {
      System.out.println(event.getTimestamp());
      System.out.println(ne.getNodeName());
      System.out.println(ne.getIncarnation());
    }
    catch (Throwable t) {
      // handle all exceptions and errors
      t.printStackTrace(System.err);
    }
  }
  public void handleFanEvent(LoadAdvisoryEvent le) {
    try {
      System.out.println(event.getTimestamp());
      System.out.println(le.getServiceName());
      System.out.println(le.getDatabaseUniqueName());
      System.out.println(le.getInstanceName());
      System.out.println(le.getPercent());
      System.out.println(le.getServiceQuality());
      System.out.println(le.getLoadStatus());
    }
    catch (Throwable t) {
      // handle all exceptions and errors
      t.printStackTrace(System.err);
    }
  }
});
</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-FA425A8A-C25F-4CE8-A54E-50C038379AC5__GUID-EFDF8F37-6AEB-455C-875E-196D1273B9F6">
                     <p class="titleinexample">Example B-2 Example of Sample Code Using Oracle RAC FAN API for FAN Up Events</p>
                     <p>The following code snippet explains how to use Oracle RAC Fast Application Notification for service up events. The code uses the new Oracle RAC FAN APIs introduced in Oracle Database 12<span class="italic">c</span> Release 2 (12.2.0.1), namely, <code class="codeph">FanUpEventListener</code> interface that extends the <code class="codeph">FanEventListener</code> interface and <code class="codeph">ServiceUpEvent</code>. You must implement the <code class="codeph">FanUpEventListener</code> interface in the client application in the similar way you implement the <code class="codeph">FanEventListener</code> interface.
                     </p><pre class="pre codeblock"><code>import oracle.simplefan.*;

...
FanEventListener fanListener = new FanUpEventListener() {
 public void handleEvent(ServiceUpEvent event) { ...... }

// Specify the next action here, when the node comes up
public void handleEvent(NodeUpEvent event) { ...... }
    ......
}
FanManager fanMngr = FanManager.getInstance();
Properties onsProps = new Properties();
onsProps.setProperty("onsNodes", ......);
fanMngr.configure(onsProps);

Properties subscriptionProps = new Properties();
subscriptionProps.setProperty("serviceName", ......);
fanSubscription = fanMngr.subscribe(subscriptionProps);
fanSubscription.addListener(fanListener);
...</code></pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="JJDBC28947"></a><div class="props_rev_3"><a id="GUID-B057A535-2AAE-4F91-BBFC-2FA596FEC689" name="GUID-B057A535-2AAE-4F91-BBFC-2FA596FEC689"></a><h3 id="JJDBC-GUID-B057A535-2AAE-4F91-BBFC-2FA596FEC689" class="sect3"><span class="enumeration_section">B.4 </span>Implementing a Connection Pool
               </h3>
               <div>
                  <div class="section">
                     <p>You must implement your own connection pool for using Oracle RAC FAN APIs. Consider the following points before you implement a connection pool using the Oracle RAC FAN APIs:</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p> Oracle RAC FAN APIs provide a subset of FAN events.</p>
                        </li>
                        <li>
                           <p> Oracle RAC FAN APIs support only ONS events. If you want your application to support corresponding supercluster events, then you may require additions to the subscription properties.</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>