<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Performing Complete Database Recovery</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Backup and Recovery User's Guide">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Backup and Recovery User's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96241-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="validating-database-files-backups.html" title="Previous" type="text/html">
      <link rel="next" href="rman-performing-flashback-dbpitr.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User's Guide">
    <meta name="dcterms.isVersionOf" content="BRADV">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="validating-database-files-backups.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="rman-performing-flashback-dbpitr.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Backup and Recovery User's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-diagnosing-responding-failures.html" property="item" typeof="WebPage"><span property="name"> Diagnosing and Responding to Failures </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Performing Complete Database Recovery</li>
            </ol>
            <a id="GUID-D908719C-9D46-4084-850C-0F81C25094EB" name="GUID-D908719C-9D46-4084-850C-0F81C25094EB"></a><a id="BRADV8005"></a>
            
            <h2 id="BRADV-GUID-D908719C-9D46-4084-850C-0F81C25094EB" class="sect2"><span class="enumeration_chapter">17 </span>Performing Complete Database Recovery
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>This chapter explains how to use RMAN to return your database to normal operation after the loss of one or more data files. This chapter contains the following topics:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="rman-complete-database-recovery.html#GUID-606C0F71-87D3-46F8-8295-9340D1A15D2D" title="Complete recovery returns your database to normal operation after the loss of one or more database files.">Overview of Complete Database Recovery</a></p>
                  </li>
                  <li>
                     <p><a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="You must plan your database restore and recovery strategy based on your recovery goal and which database files have been lost.">Preparing for Complete Database Recovery</a></p>
                  </li>
                  <li>
                     <p><a href="rman-complete-database-recovery.html#GUID-5E09344A-76D0-4188-A39D-CBA07F0B5C25" title="During complete recovery RMAN restores one or more data files and then applies all the redo generated after the restored backup.">Performing Complete Database Recovery</a></p>
                  </li>
                  <li>
                     <p><a href="rman-complete-database-recovery.html#GUID-1F744C63-2D4C-4F65-8773-1340A85993ED" title="RMAN and Oracle Enterprise Manager Cloud Control (Cloud Control) provide full support for backup and recovery in a multitenant environment.">Performing Complete Recovery of CDBs</a></p>
                  </li>
                  <li>
                     <p><a href="rman-complete-database-recovery.html#GUID-B852BD56-E872-4173-9EE9-96D1273B2CCF" title="RMAN enables you to use the RESTORE and RECOVER commands to perform complete recovery of the application containers without impacting the other containers in the CDB.">Performing Complete Recovery of Application Containers</a></p>
                  </li>
                  <li>
                     <p><a href="rman-complete-database-recovery.html#GUID-D5AFD861-FCA5-4BE6-913F-6C4B6C96A063" title="You can recover sparse databases to the most recent point in time using the RESTORE and RECOVER commands.">Performing Complete Recovery of Sparse Databases with RMAN</a></p>
                  </li>
               </ul>
            </div><a id="BRADV89759"></a><div class="props_rev_3"><a id="GUID-606C0F71-87D3-46F8-8295-9340D1A15D2D" name="GUID-606C0F71-87D3-46F8-8295-9340D1A15D2D"></a><h3 id="BRADV-GUID-606C0F71-87D3-46F8-8295-9340D1A15D2D" class="sect3"><span class="enumeration_section">17.1 </span>Overview of Complete Database Recovery
               </h3>
               <div>
                  <p>Complete recovery returns your database to normal operation after the loss of one or more database files.</p>
                  <p>This section contains the following topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-C944605B-6B9E-4F39-BEC9-5AD58805B208" title="Complete recovery is recovering a database to the most recent point in time, without the loss of any committed transactions.">Purpose of Complete Database Recovery</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075" title="The complete recovery operations described in this chapter are subject to certain conditions.">Scope of This Chapter</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-C192C448-0D8A-4366-91AB-BE62ED5B12ED" title="Zero Data Loss Recovery Appliance (Recovery Appliance) substantially reduces the window of potential data loss that exists between successive archived redo log backups. You to recover target databases to within a few subseconds of a database failure.">About Real-time Redo Transport for Recovery Appliance</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89760"></a><div class="props_rev_3"><a id="GUID-C944605B-6B9E-4F39-BEC9-5AD58805B208" name="GUID-C944605B-6B9E-4F39-BEC9-5AD58805B208"></a><h4 id="BRADV-GUID-C944605B-6B9E-4F39-BEC9-5AD58805B208" class="sect4"><span class="enumeration_section">17.1.1 </span>Purpose of Complete Database Recovery
                  </h4>
                  <div>
                     <p>Complete recovery is recovering a database to the most recent point in time, without the loss of any committed transactions.</p>
                     <p>This chapter assumes that some or all of your data files are lost or damaged. Typically, this situation is caused by a media failure or accidental deletion. Your goal is to return the database to normal operation by restoring the damaged files from RMAN backups and recovering all database changes.</p>
                  </div>
               </div><a id="BRADV89761"></a><div class="props_rev_3"><a id="GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075" name="GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075"></a><h4 id="BRADV-GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075" class="sect4"><span class="enumeration_section">17.1.2 </span>Scope of This Chapter
                  </h4>
                  <div>
                     <p>The complete recovery operations described in this chapter are subject to certain conditions.</p>
                     <p>This chapter makes the following assumptions:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>You have lost some or all data files and your goal is to recover all changes, but you have not lost all current control files or an entire online redo log group. </p>
                        </li>
                        <li>
                           <p>Your database is using the current server parameter file. </p>
                        </li>
                        <li>
                           <p>You have the complete set of archived redo logs and incremental backups needed for recovery of your data file backups. Every data file either has a backup, or a complete set of online and archived redo logs goes back to the creation of a data file with no backup. </p>
                           <p>RMAN can handle lost data files without user intervention during restore and recovery. When a data file is lost, the possible cases can be classified as follows:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The control file knows about the data file, that is, you backed up the control file after data file creation, but the data file itself is not backed up. If the data file record is in the control file, then <code class="codeph">RESTORE</code> creates the data file in the original location or in a user-specified location. The <code class="codeph">RECOVER</code> command can then apply the necessary logs to the data file.
                                 </p>
                              </li>
                              <li>
                                 <p>The control file does not have the data file record, that is, you did not back up the control file after data file creation. During recovery, the database detects the missing data file and reports it to RMAN, which creates a data file and continues recovery by applying the remaining logs. If the data file was created in a parent incarnation, then it is created during the restore or recovery phase as appropriate.</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>You are not restoring and recovering an encrypted tablespace. </p>
                           <p>If you perform media recovery on an encrypted tablespace, then the Oracle keystore must be open when performing media recovery of this tablespace. </p>
                        </li>
                        <li>
                           <p>Your database runs in a single-instance configuration. </p>
                           <p>Although RMAN can restore and recover databases in Oracle RAC and Data Guard configurations, these scenarios are beyond the scope of this manual.</p>
                        </li>
                        <li>
                           <p>You are using the RMAN client rather than Oracle Enterprise Manager.</p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075__GUID-D9BB73C3-1D7F-401F-BA2D-A01C561EB90E">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="q">"<a href="rman-performing-flashback-dbpitr.html#GUID-5463669A-DC89-4FF4-ACCE-136A72DF687B" title="This overview describes the purpose and basic concepts of Oracle Flashback Technology and database point-in-time recovery.Certain situations are suited for using point-in-time recovery or flashback features to return the database or database object to its state at a previous point in time.Database point-in-time recovery (DBPITR) and Flashback features enable you to recover your database to a prior point in time.DBPITR works at the physical level to return the data files to their state at a target time in the past.RMAN provides support for point-in-time recovery for one or more PDBs. To recover PDBs, you must connect to the root as a user with SYSDBA or SYSBACKUP privilege. After recovery, old backups of the PDB remain valid and can be used if a media failure occurs.The flashback features of the Oracle Database are more efficient than media recovery in most circumstances in which they are available. You can use them to investigate past states of the database.Oracle Flashback Database is the most efficient alternative to DBPITR.Logical flashback features are used to recover tables and their contents to a past time.You can perform a Flashback Database operation for a whole multitenant container database (CDB) or for a particular pluggable database (PDB). A multitenant container database (CDB) can use shared undo or local undo. The technique used by RMAN to perform flashback database operations depends on the type of undo configuration for the CDB.RMAN provides methods to manage redo corruption to data blocks in a PDB.Flashback Table uses information in the undo tablespace rather than restored backups to retrieve the table. When a Flashback Table operation occurs, new rows are deleted and old rows are reinserted. The rest of your database remains available while the flashback of the table is being performed.To perform a Flashback Table operation, the table must be eligible to be flashed back and the user performing the operation must have the required privileges.To use the Flashback Table feature on one or more tables, use the FLASHBACK TABLE SQL statement with a target time or SCN.By default, the database disables triggers on the affected table before performing a FLASHBACK TABLE operation. After the operation, the database returns the triggers to the state they were in before the operation (enabled or disabled). You can retrieve objects from the recycle bin with the FLASHBACK TABLE ... TO BEFORE DROP statement.Flashback Drop reverses the effects of a DROP TABLE operation. Flashback Drop is faster than other recovery mechanisms that can be used in this situation, such as point-in-time recovery, and does not lead to downtime or loss of recent transactions.Prerequisites must be met before you perform a Flashback Drop operation.Use the FLASHBACK TABLE ... TO BEFORE DROP statement to recover objects from the recycle bin. You can specify either the name of the table in the recycle bin or the original table name.You can create, and then drop, several objects with the same original name. All dropped objects are stored in the recycle bin.Flashback Database reverses unwanted changes by returning your database to its state at a previous point in time.Flashback Database works by undoing changes to the data files that exist at the moment that you run the command. Prerequisites must be met to perform a Flashback Database operation.A Flashback Database operation uses the FLASHBACK DATABASE command to rewind the database to a past point in time.You can perform a flashback database operation for a whole multitenant container database (CDB) using the FLASHBACK DATABASE command.You can perform a flashback database operation for a single pluggable database (PDB) in a multitenant container database (CDB) using the FLASHBACK DATABASE command.Data dictionary views contain information that is used to monitor flashback database.RMAN DBPITR restores the database from backups before the target time for recovery, then uses incremental backups and redo to roll the database forward to the target time. You can recover to an SCN, time, log sequence number, or restore point. Oracle recommends that you create restore points at important times to make point-in-time recovery more manageable if it ever becomes necessary.Certain prerequisites must be met to perform database point-in-time recovery (DBPITR).Use the RESTORE and RECOVER commands to perform DBPITR.Use the RECOVER command to perform point-in-time recovery (PITR) of container databases (CDBs) and pluggable databases (PDBs). PITR of PDBs can only be performed using RMAN.Use the RESTORE and RECOVER commands to perform point-in-time recovery for a whole CDB.When you recover one or more PDBs to a specified point-in-time, the remaining PDBs in the CDB are not affected and they can be open and operational. Use the RESTORE and RECOVER commands to perform point-in-time recovery of an application PDB.Performing point-in-time recovery of sparse databases is similar to performing point-in-time recovery of normal databases. This section describes variations of the basic Flashback Database and DBPITR scenarios.Flashback Database can be used to undo an OPEN RESETLOGS operation.Flashback Database across OPEN RESETLOGS may be used to perform multiple functions in a Data Guard environment.You can use Flashback Database to rewind a database to an abandoned database incarnation.To perform DPITR to an noncurrent database incarnation, you must explicitly execute the RESET DATABASE to reset the database to the incarnation that was current at the target SCN. You must also restore a control file from the database incarnation containing the target SCN.">Performing Flashback and Database Point-in-Time Recovery</a>"</span> for information about recovering some but not all database changes
                              </p>
                           </li>
                           <li>
                              <p><span class="q">"<a href="rman-recovery-advanced.html#GUID-77C2B092-4BEB-4BAC-91F9-7368EA16A2B6" title="When all current control files are lost, you must restore a backup control file.">Performing Recovery with a Backup Control File</a>"</span> for information about recovering the database when all control files are lost
                              </p>
                           </li>
                           <li>
                              <p><span class="q">"<a href="rman-recovery-advanced.html#GUID-2B93E1AF-5ED1-4FAE-91BB-63362CADF7AD" title="RMAN can restore a lost server parameter file to its default location or to a location of your choice. Unlike the loss of the control file, the loss of the server parameter file does not cause the instance to immediately stop. The instance may continue operating, although you must shut it down and restart it after restoring the server parameter file.">Restoring the Server Parameter File</a>"</span> for information about restoring a backup server parameter file
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="BRADV771"></a><div class="props_rev_3"><a id="GUID-C192C448-0D8A-4366-91AB-BE62ED5B12ED" name="GUID-C192C448-0D8A-4366-91AB-BE62ED5B12ED"></a><h4 id="BRADV-GUID-C192C448-0D8A-4366-91AB-BE62ED5B12ED" class="sect4"><span class="enumeration_section">17.1.3 </span>About Real-time Redo Transport for Recovery Appliance
                  </h4>
                  <div>
                     <p>Zero Data Loss Recovery Appliance (Recovery Appliance) substantially reduces the window of potential data loss that exists between successive archived redo log backups. You to recover target databases to within a few subseconds of a database failure.</p>
                     <p>When real-time redo transport is configured for a target database, redo data from the current redo log groups is written asynchronously to Recovery Appliance as it is generated. As the redo stream is received, it is stored as a complete RMAN archived redo log. If the target database crashes, the redo data received from the current redo log group, until the time of the crash, is used during restore and recovery operations.</p>
                     <p>You must perform certain configuration steps to enable real-time redo transport for the target database.</p>
                     <div class="infoboxnote" id="GUID-C192C448-0D8A-4366-91AB-BE62ED5B12ED__GUID-C6B2C8EB-B044-47B1-AF6B-CB809D07198C">
                        <p class="notep1">Note:</p>
                        <p>Real-time redo transport can be used only with Recovery Appliance.</p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-C192C448-0D8A-4366-91AB-BE62ED5B12ED__GUID-A15CCA6C-7FAB-4BA9-8EBE-2C616C0A0D91">
                        <p class="notep1">See Also:</p>
                        <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=AMPDB732" target="_blank"><span><cite>Zero Data Loss Recovery Appliance Protected Databases Configuration Guide</cite></span></a> for the steps to configure real-time redo transport
                        </p>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV89762"></a><div class="props_rev_3"><a id="GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" name="GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7"></a><h3 id="BRADV-GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" class="sect3"><span class="enumeration_section">17.2 </span>Preparing for Complete Database Recovery
               </h3>
               <div>
                  <p>You must plan your database restore and recovery strategy based on your recovery goal and which database files have been lost.</p>
                  <p>This section contains the following topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-76EF94C5-605E-4BC2-B710-08B990180223" title="The techniques for determining which files require restore or recovery depend upon the type of file that is lost.">Identifying the Database Files to Restore or Recover</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-34BB2E4B-B2FC-4701-BB65-BFED027DB865" title="It is recommended that you record the DBID of your database.">Determining the DBID of the Database</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-8837082E-3409-4D00-9836-3B9617720349" title="Previewing backups helps you to ensure that all backups required for a restore and recovery operation are available.">Previewing Backups Used in Restore Operations</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-ED9C3AA0-41DF-437D-82D3-107B4283C8AE" title="Validating backups determines if the backups are usable.">Validating Backups Before Restoring Them</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-4C90790F-0BA2-45B8-AB01-323FB6E93469" title="RMAN restores archived redo log files from backup automatically as needed to perform recovery.">Restoring Archived Redo Logs Needed for Recovery</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-0A087440-D046-4995-9A00-BBA9C5D3750C" title="For backups encrypted using certain techniques, you must provide the password that will be used to decrypt these backups.">Providing the Password Required to Decrypt Encrypted Backups</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89763"></a><div class="props_rev_3"><a id="GUID-76EF94C5-605E-4BC2-B710-08B990180223" name="GUID-76EF94C5-605E-4BC2-B710-08B990180223"></a><h4 id="BRADV-GUID-76EF94C5-605E-4BC2-B710-08B990180223" class="sect4"><span class="enumeration_section">17.2.1 </span>Identifying the Database Files to Restore or Recover
                  </h4>
                  <div>
                     <p>The techniques for determining which files require restore or recovery depend upon the type of file that is lost.</p>
                     <p>This section contains the following topics:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="rman-complete-database-recovery.html#GUID-9B1715D6-500B-4D9A-AE1D-22CB0E4E8DAE" title="The database shuts down immediately when any of the multiplexed control files become inaccessible.">Identifying a Lost Control File</a></p>
                        </li>
                        <li>
                           <p><a href="rman-complete-database-recovery.html#GUID-8AE07B2A-CD72-45C6-9478-28CF459407C8" title="The decision about when and how to recover depends on the state of the database and the location of its data files.">Identifying Data Files Requiring Media Recovery</a></p>
                        </li>
                     </ul>
                  </div><a id="BRADV89764"></a><div class="props_rev_3"><a id="GUID-9B1715D6-500B-4D9A-AE1D-22CB0E4E8DAE" name="GUID-9B1715D6-500B-4D9A-AE1D-22CB0E4E8DAE"></a><h5 id="BRADV-GUID-9B1715D6-500B-4D9A-AE1D-22CB0E4E8DAE" class="sect5"><span class="enumeration_section">17.2.1.1 </span>Identifying a Lost Control File 
                     </h5>
                     <div>
                        <p>The database shuts down immediately when any of the multiplexed control files become inaccessible. </p>
                        <p>If you try to start the database without a valid control file at each location specified in the <code class="codeph">CONTROL_FILES</code> initialization parameter, then the database reports an error.
                        </p>
                        <p>Loss of some but not all copies of your control file does not require you to restore a control file from backup. If at least one control file remains intact, then you can either copy an intact copy of the control file over the damaged or missing control file, or update the initialization parameter file so that it does not refer to the damaged or missing control file. After the <code class="codeph">CONTROL_FILES</code> parameter references only present, intact copies of the control file, you can restart your database.
                        </p>
                        <p>If you restore the control file from backup, then you must perform media recovery of the whole database and then open it with the <code class="codeph">OPEN RESETLOGS</code> option, even if no data files must be restored. This technique is described in <span class="q">"<a href="rman-recovery-advanced.html#GUID-77C2B092-4BEB-4BAC-91F9-7368EA16A2B6" title="When all current control files are lost, you must restore a backup control file.">Performing Recovery with a Backup Control File</a>"</span>.
                        </p>
                     </div>
                  </div><a id="BRADV89765"></a><div class="props_rev_3"><a id="GUID-8AE07B2A-CD72-45C6-9478-28CF459407C8" name="GUID-8AE07B2A-CD72-45C6-9478-28CF459407C8"></a><h5 id="BRADV-GUID-8AE07B2A-CD72-45C6-9478-28CF459407C8" class="sect5"><span class="enumeration_section">17.2.1.2 </span>Identifying Data Files Requiring Media Recovery
                     </h5>
                     <div>
                        <p>The decision about when and how to recover depends on the state of the database and the location of its data files.</p>
                        <p>Use RMAN or SQL*Plus to identify data files that require media recovery.</p>
                        <div class="infoboxnotealso" id="GUID-8AE07B2A-CD72-45C6-9478-28CF459407C8__GUID-ABD6AD9E-6ABA-4704-BAF8-B19452E2DEAD">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="rman-complete-database-recovery.html#GUID-0E285ED7-6C85-4D6E-A8E0-C969DB305F29" title="An easy technique for determining which data files are missing is to run a VALIDATE DATABASE command.">Identifying Data Files with RMAN</a></p>
                              </li>
                              <li>
                                 <p><a href="rman-complete-database-recovery.html#GUID-25704467-1CEE-45D2-8D79-1C93C1CE0BAC" title="Although VALIDATE DATABASE is a good technique for determining whether files are inaccessible, you may want to use SQL queries to obtain more detailed information.">Identifying Data Files with SQL</a></p>
                              </li>
                           </ul>
                        </div>
                     </div><a id="BRADV350"></a><a id="BRADV89766"></a><div class="props_rev_3"><a id="GUID-0E285ED7-6C85-4D6E-A8E0-C969DB305F29" name="GUID-0E285ED7-6C85-4D6E-A8E0-C969DB305F29"></a><h6 id="BRADV-GUID-0E285ED7-6C85-4D6E-A8E0-C969DB305F29" class="sect6"><span class="enumeration_section">17.2.1.2.1 </span>Identifying Data Files with RMAN
                        </h6>
                        <div>
                           <p>An easy technique for determining which data files are missing is to run a <code class="codeph">VALIDATE DATABASE</code> command. 
                           </p>
                           <div class="section"></div>
                           <!-- class="section" -->
                           <div class="example" id="GUID-0E285ED7-6C85-4D6E-A8E0-C969DB305F29__CHDICCBB">
                              <p class="titleinexample">Example 17-1 VALIDATE DATABASE</p>
                              <p>This example validates the database and tries to read all specified data files (sample output included).</p><pre class="oac_no_warn" dir="ltr">RMAN&gt; VALIDATE DATABASE;

Starting validate at 20-OCT-13
allocated channel: ORA_DISK_1
channel ORA_DISK_1: SID=90 device type=DISK
could not read file header for datafile 7 error reason 4
RMAN-00571: ===========================================================
RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============
RMAN-00571: ===========================================================
RMAN-03002: failure of backup command at 10/20/2013 13:05:43
RMAN-06056: could not access datafile 7
</pre><div class="p">The output of <code class="codeph">VALIDATE DATABASE</code> command indicates that data file 7 is inaccessible. You can then run the <code class="codeph">REPORT SCHEMA</code> command to obtain the tablespace name and file name for data file 7 as follows (sample output included):<pre class="oac_no_warn" dir="ltr">RMAN&gt; REPORT SCHEMA;
 
Report of database schema for database with db_unique_name RDBMS
 
List of Permanent Datafiles
===========================
File Size(MB) Tablespace           RB segs Datafile Name
---- -------- -------------------- ------- ------------------------
1    450      SYSTEM               ***     +DATAFILE/tbs_01.f
2    86       SYSAUX               ***     +DATAFILE/tbs_ax1.f
3    15       UD1                  ***     +DATAFILE/tbs_undo1.f
4    2        SYSTEM               ***     +DATAFILE/tbs_02.f
5    2        TBS_1                ***     +DATAFILE/tbs_11.f
6    2        TBS_1                ***     +DATAFILE/tbs_12.f
7    2        TBS_2                ***     +DATAFILE/tbs_21.f
 
List of Temporary Files
=======================
File Size(MB) Tablespace           Maxsize(MB) Tempfile Name
---- -------- -------------------- ----------- --------------------
1    40       TEMP                 32767       +DATAFILE/tbs_tmp1.f</pre></div>
                           </div>
                           <!-- class="example" -->
                        </div>
                     </div><a id="BRADV351"></a><a id="BRADV89767"></a><div class="props_rev_3"><a id="GUID-25704467-1CEE-45D2-8D79-1C93C1CE0BAC" name="GUID-25704467-1CEE-45D2-8D79-1C93C1CE0BAC"></a><h6 id="BRADV-GUID-25704467-1CEE-45D2-8D79-1C93C1CE0BAC" class="sect6"><span class="enumeration_section">17.2.1.2.2 </span>Identifying Data Files with SQL
                        </h6>
                        <div>
                           <p>Although <code class="codeph">VALIDATE DATABASE</code> is a good technique for determining whether files are inaccessible, you may want to use SQL queries to obtain more detailed information. 
                           </p>
                           <div class="section">
                              <p class="subhead3" id="GUID-25704467-1CEE-45D2-8D79-1C93C1CE0BAC__GUID-D41A0CB4-98CF-4A02-8D58-24C2B88E0F96">To determine whether data files require media recovery:</p>
                           </div>
                           <!-- class="section" -->
                           <ol>
                              <li class="stepexpand"><span>Start SQL*Plus and connect to the target database instance with administrator privileges.</span></li>
                              <li class="stepexpand"><span>Determine the status of the database by executing the following SQL query:</span><div><pre class="oac_no_warn" dir="ltr">SELECT STATUS FROM V$INSTANCE;
</pre><p>If the status is <code class="codeph">OPEN</code>, then the database is open. Nevertheless, some data files may require media recovery.
                                    </p>
                                 </div>
                              </li>
                              <li class="stepexpand"><span>Query <code class="codeph">V$DATAFILE_HEADER</code> to determine the status of your data files. Run the following SQL statements to check the data file headers: </span><div><pre class="oac_no_warn" dir="ltr">SELECT FILE#, STATUS, ERROR, RECOVER, TABLESPACE_NAME, NAME 
FROM   V$DATAFILE_HEADER 
WHERE  RECOVER = 'YES' 
OR     (RECOVER IS NULL AND ERROR IS NOT NULL);
</pre><p>Each row returned represents a data file that either requires media recovery or has an error requiring a restore. Check the <code class="codeph">RECOVER</code> and <code class="codeph">ERROR</code> columns. <code class="codeph">RECOVER</code> indicates whether a file needs media recovery, and <code class="codeph">ERROR</code> indicates whether there was an error reading and validating the data file header. 
                                    </p>
                                    <p>If <code class="codeph">ERROR</code> is not <code class="codeph">NULL</code>, then the data file header cannot be read and validated. Check for a temporary hardware or operating system problem causing the error. If there is no such problem, then you must restore the file or switch to a copy.
                                    </p>
                                    <p>If the <code class="codeph">ERROR</code> column is <code class="codeph">NULL</code> and the <code class="codeph">RECOVER</code> column is <code class="codeph">YES</code>, then the file requires media recovery (and may also require a restore from backup).
                                    </p>
                                    <div class="infoboxnote" id="GUID-25704467-1CEE-45D2-8D79-1C93C1CE0BAC__GUID-76A234C5-4DA5-4CBF-9775-0567B66BF8AA">
                                       <p class="notep1">Note:</p>
                                       <p>Because <code class="codeph">V$DATAFILE_HEADER</code> only reads the header block of each data file, it does not detect all problems that require the data file to be restored. For example, this view cannot tell whether a data file contains corrupt data blocks.
                                       </p>
                                    </div>
                                 </div>
                              </li>
                              <li class="stepexpand"><span>Optionally, query <code class="codeph">V$RECOVER_FILE</code> to list data files requiring recovery by data file number with their status and error information. For example, execute the following query:</span><div><pre class="oac_no_warn" dir="ltr">SELECT FILE#, ERROR, ONLINE_STATUS, CHANGE#, TIME 
FROM   V$RECOVER_FILE;
</pre><div class="infoboxnote" id="GUID-25704467-1CEE-45D2-8D79-1C93C1CE0BAC__GUID-E07311E9-881B-4642-839F-22F56276324B">
                                       <p class="notep1">Note:</p>
                                       <p>You cannot use <code class="codeph">V$RECOVER_FILE</code> with a control file restored from backup or a control file that was re-created after the time of the media failure affecting the data files. A restored or re-created control file does not contain the information needed to update <code class="codeph">V$RECOVER_FILE</code> accurately.
                                       </p>
                                    </div>
                                    <p>To find data file and tablespace names, you can also perform joins using the data file number and the <code class="codeph">V$DATAFILE</code> and <code class="codeph">V$TABLESPACE</code> views, as shown in the following example.
                                    </p><pre class="oac_no_warn" dir="ltr">SELECT r.FILE# AS df#, d.NAME AS df_name, t.NAME AS tbsp_name, 
       d.STATUS, r.ERROR, r.CHANGE#, r.TIME
FROM V$RECOVER_FILE r, V$DATAFILE d, V$TABLESPACE t
WHERE t.TS# = d.TS#
AND d.FILE# = r.FILE#;
</pre><p>The <code class="codeph">ERROR</code> column identifies the problem for each file requiring recovery.
                                    </p>
                                 </div>
                              </li>
                           </ol>
                           <div class="section">
                              <div class="infoboxnotealso" id="GUID-25704467-1CEE-45D2-8D79-1C93C1CE0BAC__GUID-8EBFAF64-9D59-4CA5-BB26-F971BF659B80">
                                 <p class="notep1">See Also:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p><code class="codeph">V$DATAFILE_HEADER</code> in <a href="../refrn/V-DATAFILE_HEADER.html#REFRN30052" target="_blank"><span><cite>Oracle Database Reference</cite></span></a></p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">V$RECOVER_FILE</code> in <a href="../refrn/V-RECOVER_FILE.html#REFRN30196" target="_blank"><span><cite>Oracle Database Reference</cite></span></a></p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">V$DATAFILE</code> in <a href="../refrn/V-DATAFILE.html#REFRN30050" target="_blank"><span><cite>Oracle Database Reference</cite></span></a></p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">V$TABLESPACE</code> in <a href="../refrn/V-TABLESPACE.html#REFRN30277" target="_blank"><span><cite>Oracle Database Reference</cite></span></a></p>
                                    </li>
                                 </ul>
                              </div>
                           </div>
                           <!-- class="section" -->
                        </div>
                     </div>
                  </div>
               </div><a id="BRADV80002"></a><div class="props_rev_3"><a id="GUID-34BB2E4B-B2FC-4701-BB65-BFED027DB865" name="GUID-34BB2E4B-B2FC-4701-BB65-BFED027DB865"></a><h4 id="BRADV-GUID-34BB2E4B-B2FC-4701-BB65-BFED027DB865" class="sect4"><span class="enumeration_section">17.2.2 </span>Determining the DBID of the Database
                  </h4>
                  <div>
                     <p>It is recommended that you record the DBID of your database.</p>
                     <div class="section">
                        <p>In situations requiring the recovery of your server parameter file or control file from autobackup, you must know the DBID. Be sure to record the DBID along with other basic information about your database.</p>
                        <p>If you do not have a record of the DBID of your database, then you can find it in the following places without opening your database:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>The DBID is used in forming the file name for the control file autobackup. Locate this file, and then refer to <span class="q">"<a href="configuring-rman-client-basic.html#GUID-C64AE090-0749-43EA-92C4-69DC6201A15F" title="By default, the format of the autobackup file for all configured devices is the substitution variable %F in the FORMAT clause.">Configuring the Control File Autobackup Format</a>"</span> to determine where the DBID appears in the file name.
                              </p>
                           </li>
                           <li>
                              <p>If you have any text files that preserve the output from an RMAN session, then the DBID is displayed by the RMAN client when it starts up and connects to your database. Typical output follows:</p><pre class="oac_no_warn" dir="ltr">% rman TARGET /

Recovery Manager: Release 12.1.0.1.0 - Production on Wed Jan 16 17:51:30 2013
 
Copyright (c) 1982, 2013, Oracle and/or its affiliates.  All rights reserved.
 
connected to target database: PROD (<span class="bold">DBID=36508508</span>)</pre></li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV352"></a><a id="BRADV8140"></a><div class="props_rev_3"><a id="GUID-8837082E-3409-4D00-9836-3B9617720349" name="GUID-8837082E-3409-4D00-9836-3B9617720349"></a><h4 id="BRADV-GUID-8837082E-3409-4D00-9836-3B9617720349" class="sect4"><span class="enumeration_section">17.2.3 </span>Previewing Backups Used in Restore Operations
                  </h4>
                  <div>
                     <p>Previewing backups helps you to ensure that all backups required for a restore and recovery operation are available.</p>
                     <div class="section">
                        <p>You can apply <code class="codeph">RESTORE</code> <code class="codeph">...</code> <code class="codeph">PREVIEW</code> to any <code class="codeph">RESTORE</code> operation to create a detailed list of every backup to be used in the requested <code class="codeph">RESTORE</code> operation, and the necessary target SCN for recovery after the <code class="codeph">RESTORE</code> operation is complete. This command accesses the RMAN repository to query the backup metadata, but does not actually read the backup files to ensure that they can be restored.
                        </p>
                        <p>As an alternative to <code class="codeph">RESTORE ... PREVIEW</code>, you can use the <code class="codeph">RESTORE ... VALIDATE HEADER</code> command. In addition to listing the files needed for restore and recovery, the <code class="codeph">RESTORE ... VALIDATE HEADER</code> command validates the backup file headers to determine whether the files on disk or in the media management catalog correspond to the metadata in the RMAN repository.
                        </p>
                        <p>When planning your restore and recovery operation, use <code class="codeph">RESTORE ... </code><code class="codeph">PREVIEW</code> or <code class="codeph">RESTORE ... VALIDATE HEADER</code> to ensure that all required backups are available or to identify situations in which you may want to direct RMAN to use or avoid specific backups.
                        </p>
                        <p><span class="bold">To preview backups to be used in a restore operation:</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Run a <code class="codeph">RESTORE</code> command with the <code class="codeph">PREVIEW</code> option.</span><div>
                              <p>For example, run one of the following commands:</p><pre class="oac_no_warn" dir="ltr">RESTORE DATABASE PREVIEW;
RESTORE ARCHIVELOG FROM TIME 'SYSDATE-7' PREVIEW;
</pre><p>If the report produced by <code class="codeph">RESTORE</code> <code class="codeph">...</code> <code class="codeph">PREVIEW</code> provides too much information, then specify the <code class="codeph">SUMMARY</code> option as shown in the following example:
                              </p><pre class="oac_no_warn" dir="ltr">RESTORE DATABASE PREVIEW SUMMARY;
</pre><p>If you are satisfied with the output, then stop here. If the output indicates that RMAN will request a backup from a tape that you know is temporarily unavailable, then continue with this procedure. If the output indicates that a backup is stored off-site, then skip to <span class="q">"<a href="rman-complete-database-recovery.html#GUID-34B3312D-B577-4692-8730-1243CB3EC326" title="An offsite backup is stored in a remote location, such as a secure storage facility, and cannot be restored unless the media manager retrieves the media.">Recalling Off-site Backups</a>"</span>.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>If needed, use the <code class="codeph">CHANGE</code> command to set the backup status of any temporarily unavailable backups to <code class="codeph">UNAVAILABLE</code>.</span><div>
                              <p><span class="q">"<a href="maintaining-rman-backups.html#GUID-B8ADC6B5-A7F4-4045-9BCE-CC9912F8FCFC" title="Run the CHANGE...UNAVAILABLE command when a backup cannot be found or has migrated offsite.">Updating a Backup to Status AVAILABLE or UNAVAILABLE</a>"</span> explains how to perform this task.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Optionally, run <code class="codeph">RESTORE </code><code class="codeph">...</code> <code class="codeph">PREVIEW</code> again to confirm that the restore operation does not attempt to use unavailable backups.</span></li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-8837082E-3409-4D00-9836-3B9617720349__GUID-FC6F3739-53AC-4BC6-B932-210CF52BEB27">
                           <p class="notep1">See Also:</p>
                           <p><a href="../rcmrf/LIST.html#RCMRF132" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a>for details on interpreting <code class="codeph">RESTORE</code> <code class="codeph">...</code> <code class="codeph">PREVIEW</code> output, which is in the same format as the output of the <code class="codeph">LIST</code> command
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div><a id="BRADV354"></a><a id="BRADV353"></a><a id="BRADV89768"></a><div class="props_rev_3"><a id="GUID-34B3312D-B577-4692-8730-1243CB3EC326" name="GUID-34B3312D-B577-4692-8730-1243CB3EC326"></a><h5 id="BRADV-GUID-34B3312D-B577-4692-8730-1243CB3EC326" class="sect5"><span class="enumeration_section">17.2.3.1 </span>Recalling Off-site Backups
                     </h5>
                     <div>
                        <p>An offsite backup is stored in a remote location, such as a secure storage facility, and cannot be restored unless the media manager retrieves the media.</p>
                        <div class="section">
                           <p>Some media managers provide status information to RMAN about which backups are off-site. Off-site backups are marked as <code class="codeph">AVAILABLE</code> in the RMAN repository even though the media must be retrieved from storage before the backup can be restored. If RMAN attempts to restore an off-site backup, then the restore job fails.
                           </p>
                           <p><span class="bold">To recall offsite backups:</span></p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>(Optional) Identify the off-site backups using the <code class="codeph">RESTORE ... PREVIEW</code> command. The command output indicates whether backups are stored off-site, as shown by the text after the sample output in the following example.</span><div><pre class="oac_no_warn" dir="ltr">List of Backup Sets
===================


BS Key  Size       Device Type Elapsed Time Completion Time
------- ---------- ----------- ------------ ---------------
9       2.25M      SBT_TAPE    00:00:00     21-MAY-13
        BP Key: 9   Status: AVAILABLE  Compressed: NO  Tag: TAG20130521T144258
        Handle: 0aii9k7i_1_1   Media: 0aii9k7i_1_1
 
  List of Archived Logs in backup set 9
  Thrd Seq     Low SCN    Low Time  Next SCN   Next Time
  ---- ------- ---------- --------- ---------- ---------
  1    1       392314     21-MAY-13 392541     21-MAY-13
  1    2       392541     21-MAY-13 392545     21-MAY-13
  1    3       392545     21-MAY-13 392548     21-MAY-13
  1    4       392548     21-MAY-13 395066     21-MAY-13
  1    5       395066     21-MAY-13 395095     21-MAY-13
  1    6       395095     21-MAY-13 395355     21-MAY-13
 
List of remote backup files
============================
        Handle: aii9k7i_1_1   Media: 0aii9k7i_1_1
validation succeeded for backup piece
Finished restore at 21-MAY-13
released channel: dev1
</pre><p>You can use <code class="codeph">RESTORE</code> <code class="codeph">...</code> <code class="codeph">PREVIEW</code> <code class="codeph">RECALL</code> to instruct the media manager to make off-site backups available.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span> If backups are stored offsite, then execute a <code class="codeph">RESTORE ... PREVIEW</code> command with the <code class="codeph">RECALL</code> option.</span><div>
                                 <p>The following example initiates recall for the off-site archived log backups shown in the previous step (sample output included):</p><pre class="oac_no_warn" dir="ltr">RESTORE ARCHIVELOG ALL PREVIEW RECALL;
</pre><p>The following sample output indicates that RMAN initiated a recall:</p><pre class="oac_no_warn" dir="ltr">List of Backup Sets
===================
 
 
BS Key  Size       Device Type Elapsed Time Completion Time
------- ---------- ----------- ------------ ---------------
9       2.25M      SBT_TAPE    00:00:00     21-MAY-13
        BP Key: 9   Status: AVAILABLE  Compressed: NO  Tag: TAG20130521T144258
        Handle: VAULT0aii9k7i_1_1   Media: /tmp,VAULT0aii9k7i_1_1
 
  List of Archived Logs in backup set 9
  Thrd Seq     Low SCN    Low Time  Next SCN   Next Time
  ---- ------- ---------- --------- ---------- ---------
  1    1       392314     21-MAY-13 392541     21-MAY-13
  1    2       392541     21-MAY-13 392545     21-MAY-13
  1    3       392545     21-MAY-13 392548     21-MAY-13
  1    4       392548     21-MAY-13 395066     21-MAY-13
  1    5       395066     21-MAY-13 395095     21-MAY-13
  1    6       395095     21-MAY-13 395355     21-MAY-13
 
Initiated recall for the following list of remote backup files
==========================================================
        Handle: VAULT0aii9k7i_1_1   Media: /tmp,VAULT0aii9k7i_1_1
validation succeeded for backup piece
Finished restore at 21-MAY-13
released channel: dev1
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Run the <code class="codeph">RESTORE</code><code class="codeph"> ...</code> <code class="codeph">PREVIEW</code> command. If necessary, return to the previous step until no backups needed for the restore operation are reported as off-site.</span></li>
                        </ol>
                     </div>
                  </div>
               </div><a id="BRADV90066"></a><div class="props_rev_3"><a id="GUID-ED9C3AA0-41DF-437D-82D3-107B4283C8AE" name="GUID-ED9C3AA0-41DF-437D-82D3-107B4283C8AE"></a><h4 id="BRADV-GUID-ED9C3AA0-41DF-437D-82D3-107B4283C8AE" class="sect4"><span class="enumeration_section">17.2.4 </span>Validating Backups Before Restoring Them
                  </h4>
                  <div>
                     <p>Validating backups determines if the backups are usable.</p>
                     <div class="section">
                        <p>Although the output of a restore preview operation indicates which backups will be restored, the usability of the backups is not actually verified. You can run RMAN commands to test the availability of usable backups for any <code class="codeph">RESTORE</code> operation, or test the contents of a specific backup for use in <code class="codeph">RESTORE</code> operations. The contents of the backups are actually read and checked for corruption.
                        </p>
                        <p>Use one of the following validation options:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">RESTORE</code> <code class="codeph">...</code> <code class="codeph">VALIDATE</code> to test whether RMAN can restore a specific object from a backup. RMAN chooses which backups to use.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">VALIDATE BACKUPSET</code> to test the validity of a backup set that you specify.
                              </p>
                              <div class="infoboxnotealso" id="GUID-ED9C3AA0-41DF-437D-82D3-107B4283C8AE__GUID-6EE59D47-26C6-4ECC-9E0A-E39835670C68">
                                 <p class="notep1">See Also:</p>
                                 <p><a href="validating-database-files-backups.html#GUID-CC967929-9610-410D-B881-66E71353D84C" title="Validation enables you to check the integrity of your backups.The main purpose of RMAN validation is to check for corrupt blocks and missing files. You can also use RMAN to determine whether backups can be restored.The database prevents operations that result in unusable backup files or corrupted restored data files. A corrupt block is a block that has been changed so that it differs from what Oracle Database expects to find.In a physical corruption, which is also called a media corruption, the database does not recognize the block at all: the checksum is invalid, the block contains all zeros, or the header and footer of the block do not match. You can use the SET MAXCORRUPT command to set the total number of unmarked corruptions permitted in a file for RMAN backups. The default is zero, meaning that RMAN does not tolerate unmarked corrupt blocks of any kind.Oracle Database supports different techniques for detecting, repairing, and monitoring block corruption.You can use the VALIDATE command to manually check for physical and logical corruptions in database files. You can also use the BACKUP VALIDATE command to perform validation.You can run RESTORE...VALIDATE to test whether RMAN can restore a specific file or set of files from a backup. RMAN chooses which backups to use.RMAN enables you to validate multitenant container databases (CDBs) and pluggable databases (PDBs) using the VALIDATE command. The steps to validate a CDB are similar to the ones used to validate a non-CDB. There are multiple methods to validate PDBs.">Validating Database Files and Backups</a></p>
                              </div>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV89778"></a><div class="props_rev_3"><a id="GUID-4C90790F-0BA2-45B8-AB01-323FB6E93469" name="GUID-4C90790F-0BA2-45B8-AB01-323FB6E93469"></a><h4 id="BRADV-GUID-4C90790F-0BA2-45B8-AB01-323FB6E93469" class="sect4"><span class="enumeration_section">17.2.5 </span>Restoring Archived Redo Logs Needed for Recovery
                  </h4>
                  <div>
                     <p>RMAN restores archived redo log files from backup automatically as needed to perform recovery.</p>
                     <p>You can also restore archived redo logs manually to save the time needed to restore these files later during the <code class="codeph">RECOVER</code> command, or if you want to store the restored archived redo log files in some new location. RMAN also gives you the flexibility of restoring all archive redo log files, the current ones, or archive redo log files from a specified previous incarnation of the database.
                     </p>
                     <p>In case of missing archived redo logs during disaster recovery, RMAN enables you to automate the database recovery till the last available archived redo log, using the <code class="codeph">UNTIL AVAILABLE REDO</code> option. You can use this option only when performing recovery for a whole database. Using this option for a data file, tablespace, or pluggable database is not supported. To perform point-in-time recovery for a pluggable database, you must provide the SCN number as the point of recovery.
                     </p>
                     <p>By default, RMAN restores archived redo logs with names constructed using the <code class="codeph">LOG_ARCHIVE_FORMAT</code> and the highest <code class="codeph">LOG_ARCHIVE_DEST_</code><span class="italic"><code class="codeph">n</code></span> parameters of the target database. These parameters are combined in a platform-specific fashion to form the name of the restored archived log. 
                     </p>
                     <p>This section contains the following topics:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><span class="q">"<a href="rman-complete-database-recovery.html#GUID-FF8DDFE9-71CC-4A7C-9890-799E20EC963D" title="RMAN enables you to override the default location for restored archived redo log files.">Restoring Archived Redo Logs to a New Location</a>"</span></p>
                        </li>
                        <li>
                           <p><span class="q">"<a href="rman-complete-database-recovery.html#GUID-83FE5D57-3F48-45EE-B782-564DF00685E7" title="To manage disk space that is used to contain the restored logs, you can specify restore destinations for archived logs multiple times in one RUN block, to distribute restored logs among several destinations.">Restoring Archived Redo Logs to Multiple Locations</a>"</span></p>
                        </li>
                     </ul>
                  </div><a id="BRADV89779"></a><div class="props_rev_3"><a id="GUID-FF8DDFE9-71CC-4A7C-9890-799E20EC963D" name="GUID-FF8DDFE9-71CC-4A7C-9890-799E20EC963D"></a><h5 id="BRADV-GUID-FF8DDFE9-71CC-4A7C-9890-799E20EC963D" class="sect5"><span class="enumeration_section">17.2.5.1 </span>Restoring Archived Redo Logs to a New Location
                     </h5>
                     <div>
                        <p>RMAN enables you to override the default location for restored archived redo log files.</p>
                        <div class="section">
                           <p>The <code class="codeph">SET ARCHIVELOG DESTINATION</code> command manually stages archived logs to different locations while a database restore operation is occurring. During recovery, RMAN knows where to find the newly restored archived logs; it does not require them to be in the location specified in the initialization parameter file.
                           </p>
                           <p><span class="bold">To restore archived redo logs to a new location:</span></p>
                           <ol>
                              <li>
                                 <p>Start RMAN and connect to a target database, as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>.
                                 </p>
                              </li>
                              <li>
                                 <p>Ensure that the database is mounted or open.</p>
                              </li>
                              <li>
                                 <p>Perform the following operations within a <code class="codeph">RUN</code> command:
                                 </p>
                                 <ol type="a">
                                    <li>
                                       <p>Specify the new location for the restored archived redo logs using <code class="codeph">SET</code> <code class="codeph">ARCHIVELOG</code> <code class="codeph">DESTINATION</code>.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Either explicitly restore the archived redo logs or execute commands that automatically restore the logs.</p>
                                    </li>
                                 </ol>
                                 <p>The following sample <code class="codeph">RUN</code> command explicitly restores all backup archived logs to a new location:
                                 </p><pre class="oac_no_warn" dir="ltr">RUN
{ 
  SET ARCHIVELOG DESTINATION TO '/oracle/temp_restore';
  RESTORE ARCHIVELOG ALL;
  # restore and recover data files as needed
  .
  .
  .
}
</pre><p>The following example sets the archived log destination and then uses <code class="codeph">RECOVER DATABASE</code> to restore archived logs from this destination automatically:
                                 </p><pre class="oac_no_warn" dir="ltr">RUN
{ 
  SET ARCHIVELOG DESTINATION TO '/oracle/temp_restore';
  RESTORE DATABASE;
  RECOVER DATABASE; # restores and recovers logs automatically
}
</pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="BRADV89780"></a><div class="props_rev_3"><a id="GUID-83FE5D57-3F48-45EE-B782-564DF00685E7" name="GUID-83FE5D57-3F48-45EE-B782-564DF00685E7"></a><h5 id="BRADV-GUID-83FE5D57-3F48-45EE-B782-564DF00685E7" class="sect5"><span class="enumeration_section">17.2.5.2 </span>Restoring Archived Redo Logs to Multiple Locations
                     </h5>
                     <div>
                        <p>To manage disk space that is used to contain the restored logs, you can specify restore destinations for archived logs multiple times in one <code class="codeph">RUN</code> block, to distribute restored logs among several destinations.
                        </p>
                        <div class="section">
                           <p>Note that you cannot specify multiple destinations simultaneously to produce multiple copies of the same log during the restore operation. </p>
                           <p>The following example restores 300 archived redo logs from backup, distributing them across the directories<code class="codeph"> /fs1/tmp</code>, <code class="codeph">/fs2/tmp</code>, and <code class="codeph">/fs3/tmp</code>:
                           </p><pre class="oac_no_warn" dir="ltr">RUN 
{ 
  # Set a new location for logs 1 through 100.
  SET ARCHIVELOG DESTINATION TO '/fs1/tmp';
  RESTORE ARCHIVELOG FROM SEQUENCE 1 UNTIL SEQUENCE 100;
  # Set a new location for logs 101 through 200.
  SET ARCHIVELOG DESTINATION TO '/fs2/tmp';
  RESTORE ARCHIVELOG FROM SEQUENCE 101 UNTIL SEQUENCE 200;
  # Set a new location for logs 201 through 300.
  SET ARCHIVELOG DESTINATION TO '/fs3/tmp';
  RESTORE ARCHIVELOG FROM SEQUENCE 201 UNTIL SEQUENCE 300;
  # restore and recover data files as needed
  .
  .
  .
}
</pre><p>When you issue a <code class="codeph">RECOVER</code> command, RMAN finds the needed restored archived logs automatically across the destinations to which they were restored, and applies them to the data files.
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="BRADV854"></a><div class="props_rev_3"><a id="GUID-0A087440-D046-4995-9A00-BBA9C5D3750C" name="GUID-0A087440-D046-4995-9A00-BBA9C5D3750C"></a><h4 id="BRADV-GUID-0A087440-D046-4995-9A00-BBA9C5D3750C" class="sect4"><span class="enumeration_section">17.2.6 </span>Providing the Password Required to Decrypt Encrypted Backups
                  </h4>
                  <div>
                     <p>For backups encrypted using certain techniques, you must provide the password that will be used to decrypt these backups.</p>
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Backups that were encrypted using transparent encryption with an auto-login keystore require no intervention to restore, if the keystore is available. RMAN decrypts these backups while restoring their contents.</p>
                           </li>
                           <li>
                              <p>For backups that were encrypted using transparent encryption with a password-based software keystore, the keystore must be available and the keystore password must be provided before the restore operation is performed. Use the <code class="codeph">SET</code> command with the <code class="codeph">DECRYPTION WALLET OPEN IDENTIFIED BY</code> option to specify the password that must be used to open the password-based software keystore.
                              </p>
                              <p>The following command sets the keystore password for a password-based software keystore (where <code class="codeph"><span class="codeinlineitalic">password</span></code> is a placeholder for the actual password that you enter):
                              </p><pre class="oac_no_warn" dir="ltr">SET DECRYPTION WALLET OPEN IDENTIFIED BY <span class="italic">password</span>;
</pre></li>
                           <li>
                              <p>Backups created using password-mode encryption require the correct password to be entered before they can be restored. Use the <code class="codeph">SET DECRYPTION</code> command to specify the password used to decrypt the backups. If you are restoring from a group of backups that were created with different passwords, then specify all of the required passwords on the <code class="codeph">SET DECRYPTION</code> command. RMAN automatically uses the correct password with each backup set. The <code class="codeph">SET</code> command must be used before executing the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands.
                              </p>
                              <p>The following command sets the password used to decrypt backups (where <code class="codeph"><span class="codeinlineitalic">password</span></code> is a placeholder for the actual password that you enter):
                              </p><pre class="oac_no_warn" dir="ltr">SET DECRYPTION IDENTIFIED BY <span class="italic">password</span>;
</pre></li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-0A087440-D046-4995-9A00-BBA9C5D3750C__GUID-1B317E10-A18E-4037-B63A-7131DCBAEDFA">
                           <p class="notep1">See Also:</p>
                           <p><a href="../rcmrf/RESTORE.html#RCMRF149" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> for additional information about performing restore operations using encrypted backups
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV8152"></a><div class="props_rev_3"><a id="GUID-5E09344A-76D0-4188-A39D-CBA07F0B5C25" name="GUID-5E09344A-76D0-4188-A39D-CBA07F0B5C25"></a><h3 id="BRADV-GUID-5E09344A-76D0-4188-A39D-CBA07F0B5C25" class="sect3"><span class="enumeration_section">17.3 </span>Performing Complete Database Recovery
               </h3>
               <div>
                  <p>During complete recovery RMAN restores one or more data files and then applies all the redo generated after the restored backup.</p>
                  <p>This section describes the basic outline of complete database recovery, which is intended to encompass a wide range of different scenarios.</p>
                  <p>This section contains the following topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-75DB188C-1E20-49B0-BC34-363B3B5291DA" title="You use the RESTORE and RECOVER commands to restore and recover the database.">About Complete Database Recovery</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-C605DF51-5348-46BB-AC18-B928F62991C3" title="This scenario assumes that database trgt has lost most or all of its data files. It also assumes that the database uses a fast recovery area.">Performing Complete Recovery of the Whole Database</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-4EBD9D56-9700-45A1-B233-1F5506A04532" title="Use the RESTORE and RECOVER commands with the TABLESPACE option to perform complete recovery of a tablespace">Performing Complete Recovery of a Tablespace</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-19A07A76-AE1E-41EE-8B7D-7C4EF1FD3137" title="You can recover a database by switching to image copies of inaccessible data files. This technique takes less time than traditional restore and recovery because no backups need to be restored.">Performing Complete Recovery After Switching to a Copy</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89771"></a><div class="props_rev_3"><a id="GUID-75DB188C-1E20-49B0-BC34-363B3B5291DA" name="GUID-75DB188C-1E20-49B0-BC34-363B3B5291DA"></a><h4 id="BRADV-GUID-75DB188C-1E20-49B0-BC34-363B3B5291DA" class="sect4"><span class="enumeration_section">17.3.1 </span>About Complete Database Recovery
                  </h4>
                  <div>
                     <p>You use the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands to restore and recover the database. 
                     </p>
                     <p>During the recovery, RMAN automatically restores backups of any needed archived redo logs. If backups are stored on a media manager, then channels must be configured in advance or a <code class="codeph">RUN</code> block with <code class="codeph">ALLOCATE CHANNEL</code> commands must be used to enable access to backups stored there.
                     </p>
                     <p>If RMAN restores archived redo logs to the fast recovery area during a recovery, then it automatically deletes the restored logs after applying them to the data files. Otherwise, you can use the <code class="codeph">DELETE ARCHIVELOG</code> command to delete restored archived redo logs from disk when they are no longer needed for recovery. For example, you can enter the following command:
                     </p><pre class="oac_no_warn" dir="ltr">RECOVER DATABASE DELETE ARCHIVELOG;</pre></div><a id="BRADV89776"></a><div class="props_rev_3"><a id="GUID-A3DE37A6-3983-4834-858E-A2BCC3804681" name="GUID-A3DE37A6-3983-4834-858E-A2BCC3804681"></a><h5 id="BRADV-GUID-A3DE37A6-3983-4834-858E-A2BCC3804681" class="sect5"><span class="enumeration_section">17.3.1.1 </span>About Restoring Data Files to a Nondefault Location
                     </h5>
                     <div>
                        <p>If you cannot restore data files to their default locations, then you must update the control file to reflect the new locations of the data files.</p>
                        <p>Use the RMAN <code class="codeph">SET NEWNAME</code> command within a <code class="codeph">RUN</code> command to specify the new file name. Afterward, use a <code class="codeph">SWITCH</code> command, which is equivalent to using the SQL statement <code class="codeph">ALTER DATABASE RENAME FILE</code>, to update the names of the data files in the control file. <code class="codeph">SWITCH DATAFILE ALL</code> updates the control file to reflect the new names for all data files for which a <code class="codeph">SET NEWNAME</code> has been issued in a <code class="codeph">RUN</code> command.
                        </p>
                        <div class="infoboxnotealso" id="GUID-A3DE37A6-3983-4834-858E-A2BCC3804681__GUID-BFDFFD89-5205-4FE8-A9EA-B5A958E16DFE">
                           <p class="notep1">See Also:</p>
                           <p><a href="../rcmrf/SWITCH.html#RCMRF159" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> for <code class="codeph">SWITCH</code> syntax
                           </p>
                        </div>
                     </div>
                  </div>
               </div><a id="BRADV355"></a><a id="BRADV89772"></a><div class="props_rev_3"><a id="GUID-C605DF51-5348-46BB-AC18-B928F62991C3" name="GUID-C605DF51-5348-46BB-AC18-B928F62991C3"></a><h4 id="BRADV-GUID-C605DF51-5348-46BB-AC18-B928F62991C3" class="sect4"><span class="enumeration_section">17.3.2 </span>Performing Complete Recovery of the Whole Database
                  </h4>
                  <div>
                     <p>This scenario assumes that database <code class="codeph">trgt</code> has lost most or all of its data files. It also assumes that the database uses a fast recovery area.
                     </p>
                     <div class="section">
                        <p>After restore and recovery of a whole database, when the database is open, missing temporary tablespaces that were recorded in the control file are re-created with their previous creation size, <code class="codeph">AUTOEXTEND</code>, and <code class="codeph">MAXSIZE</code> attributes. Only temporary tablespaces that are missing are re-created. If a temp file exists at the location recorded in the RMAN repository but has an invalid header, then RMAN does not re-create the temp file.
                        </p>
                        <p>If the temp files were created as Oracle-managed files, then they are re-created in the current <code class="codeph">DB_CREATE_FILE_DEST</code> location. Otherwise, they are re-created at their previous locations. If RMAN cannot re-create the file due to an I/O error or some other cause, then the error is reported in the alert log and the database open operation continues.
                        </p>
                        <div class="infoboxnotealso" id="GUID-C605DF51-5348-46BB-AC18-B928F62991C3__GUID-2E85197D-B951-4FAF-B3A8-A812FD6FE3FD">
                           <p class="notep1">See Also:</p>
                           <p><span class="q">"<a href="rman-complete-database-recovery.html#GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075" title="The complete recovery operations described in this chapter are subject to certain conditions.">Scope of This Chapter</a>"</span> for some of the assumptions used in the recovery procedures
                           </p>
                        </div>
                        <p><span class="bold">To restore and recover the whole database:</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Complete the preparation steps required for your scenario, as described in <span class="q">"<a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="You must plan your database restore and recovery strategy based on your recovery goal and which database files have been lost.">Preparing for Complete Database Recovery</a>"</span>.</span></li>
                        <li class="stepexpand"><span>Start RMAN and connect to a target database and to a recovery catalog (if used), as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>.</span><div>
                              <p>RMAN displays the database status when it connects: <code class="codeph">not started</code>, <code class="codeph">not mounted</code>, <code class="codeph">not open</code> (when the database is mounted but not open), or none (when the database is open).
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>If the database is not mounted, then mount but do not open the database.</span><div>
                              <p>For example, enter the following command:</p><pre class="oac_no_warn" dir="ltr">STARTUP MOUNT;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Use the <code class="codeph">SHOW</code> command to see which channels are preconfigured.</span><div>
                              <p>For example, enter the following command (sample output is included):</p><pre class="oac_no_warn" dir="ltr">SHOW ALL;

 
RMAN configuration parameters for database with db_unique_name PROD1 are:
.
.
.
CONFIGURE DEFAULT DEVICE TYPE TO DISK; # default
CONFIGURE DEVICE TYPE DISK PARALLELISM 1 BACKUP TYPE TO BACKUPSET; # default
CONFIGURE DEVICE TYPE SBT_TAPE PARALLELISM 1 BACKUP TYPE TO BACKUPSET; # default
CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE' PARMS "SBT_
LIBRARY=/usr/local/oracle/backup/lib/libobk.so";
</pre><p>If the necessary devices and channels are configured, then no action is necessary. Otherwise, you can use the <code class="codeph">CONFIGURE</code> command to configure automatic channels, or include <code class="codeph">ALLOCATE CHANNEL</code> commands within a <code class="codeph">RUN</code> block.
                              </p>
                              <p></p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Restore and recover the database. Do one of the following:</span><div>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>If you are restoring all data files to their original locations, then execute <code class="codeph">RESTORE DATABASE</code> and <code class="codeph">RECOVER DATABASE</code> sequentially at the RMAN prompt.
                                    </p>
                                    <p>For example, enter the following commands if automatic channels are configured (sample output included):</p><pre class="oac_no_warn" dir="ltr">RMAN&gt; <span class="bold">RESTORE DATABASE;</span>

Starting restore at 20-JUN-13
allocated channel: ORA_DISK_1
channel ORA_DISK_1: SID=35 device type=DISK
allocated channel: ORA_SBT_TAPE_1
channel ORA_SBT_TAPE_1: SID=34 device type=SBT_TAPE
channel ORA_SBT_TAPE_1: Oracle Secure Backup
 
channel ORA_DISK_1: starting datafile backup set restore
channel ORA_DISK_1: specifying datafile(s) to restore from backup set
channel ORA_DISK_1: restoring datafile 00001 to /disk1/oracle/dbs/tbs_01.f
channel ORA_DISK_1: restoring datafile 00002 to /disk1/oracle/dbs/tbs_ax1.f
.
.
.
Finished restore at 20-JUN-13
</pre><pre class="oac_no_warn" dir="ltr">RMAN&gt; <span class="bold">RECOVER DATABASE;</span>

Starting recover at 20-JUN-13
using channel ORA_DISK_1
allocated channel: ORA_SBT_TAPE_1
channel ORA_SBT_TAPE_1: SID=34 device type=SBT_TAPE
channel ORA_SBT_TAPE_1: Oracle Secure Backup
 
starting media recovery
 
channel ORA_DISK_1: starting archived log restore to default destination
channel ORA_DISK_1: restoring archived log
archived log thread=1 sequence=5
channel ORA_DISK_1: restoring archived log
archived log thread=1 sequence=6
.
.
.
channel ORA_DISK_1: reading from backup piece
 /disk1/oracle/work/orcva/TKRM/backupset/2013_06_20/o1_mf_annnn_
TAG20130620T113128_29jhr197_.bkp
channel ORA_DISK_1: piece
 handle=/disk1/oracle/work/orcva/TKRM/backupset/2013_06_20/o1_mf_annnn_
TAG20130620T113128_29jhr197_.bkp tag=TAG20130620T113128
channel ORA_DISK_1: restored backup piece 1
channel ORA_DISK_1: restore complete, elapsed time: 00:00:02
archived log file name=/disk1/oracle/work/orcva/TKRM/archivelog/2013_06_
20/o1_mf_1_5_29jhv47k_.arc thread=1 sequence=5
channel default: deleting archived log(s)
.
.
.
media recovery complete, elapsed time: 00:00:15
Finished recover at 20-JUN-13
 </pre><p>If you manually allocate channels, then you must issue the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands together within a <code class="codeph">RUN</code> block as shown in the following example:
                                    </p><pre class="oac_no_warn" dir="ltr">RUN
{
  ALLOCATE CHANNEL c1 DEVICE TYPE sbt;
  RESTORE DATABASE;
  RECOVER DATABASE;
}
</pre></li>
                                 <li>
                                    <p>If you are restoring some data files to new locations, then execute <code class="codeph">RESTORE DATABASE</code> and <code class="codeph">RECOVER DATABASE</code> sequentially in a <code class="codeph">RUN</code> command. Use the <code class="codeph">SET NEWNAME</code> command to rename data files, as described in <span class="q">"<a href="rman-complete-database-recovery.html#GUID-A3DE37A6-3983-4834-858E-A2BCC3804681" title="If you cannot restore data files to their default locations, then you must update the control file to reflect the new locations of the data files.">About Restoring Data Files to a Nondefault Location</a>"</span>.
                                    </p>
                                    <p>The following example restores the database, specifying new names for three of the data files, and then recovers the database:</p><pre class="oac_no_warn" dir="ltr">RUN
{  
  SET NEWNAME FOR DATAFILE 2 TO '/disk2/df2.dbf';
  SET NEWNAME FOR DATAFILE 3 TO '/disk2/df3.dbf';
  SET NEWNAME FOR DATAFILE 4 TO '/disk2/df4.dbf';
  RESTORE DATABASE;
  SWITCH DATAFILE ALL;
  RECOVER DATABASE;
}
</pre></li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Examine the output to see if media recovery was successful. If so, open the database.</span><div>
                              <p>For example, enter the following command:</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN;</pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV356"></a><a id="BRADV89773"></a><div class="props_rev_3"><a id="GUID-4EBD9D56-9700-45A1-B233-1F5506A04532" name="GUID-4EBD9D56-9700-45A1-B233-1F5506A04532"></a><h4 id="BRADV-GUID-4EBD9D56-9700-45A1-B233-1F5506A04532" class="sect4"><span class="enumeration_section">17.3.3 </span>Performing Complete Recovery of a Tablespace
                  </h4>
                  <div>
                     <p>Use the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands with the <code class="codeph">TABLESPACE</code> option to perform complete recovery of a tablespace
                     </p>
                     <div class="p">
                        <p><a href="rman-complete-database-recovery.html#GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075" title="The complete recovery operations described in this chapter are subject to certain conditions.">Scope of This Chapter</a> for some of the assumptions used in the recovery procedures
                        </p>
                        <p>In the basic scenario, the database is open, and some but not all of the data files are damaged. You want to restore and recover the damaged tablespace while leaving the database open so that the rest of the database remains available. This scenario assumes that database <code class="codeph">TRGT</code> has lost tablespace <code class="codeph">USERS</code>.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><span class="bold">To restore and recover a tablespace:</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Complete the preparation steps that are required for your recovery scenario as described in <span class="q">"<a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="You must plan your database restore and recovery strategy based on your recovery goal and which database files have been lost.">Preparing for Complete Database Recovery</a>"</span>.</span></li>
                        <li class="stepexpand"><span>Start RMAN and connect to a target database and to a recovery catalog (if used), as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>.</span></li>
                        <li class="stepexpand"><span>If the database is open, then take the tablespace requiring recovery offline.</span><div>
                              <p>For example, enter the following command to take <code class="codeph">USERS</code> offline:
                              </p><pre class="oac_no_warn" dir="ltr">ALTER TABLESPACE users OFFLINE IMMEDIATE;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Use the <code class="codeph">SHOW</code> command to see which channels are preconfigured.</span><div>
                              <p>For example, enter the following command (sample output is included):</p><pre class="oac_no_warn" dir="ltr">SHOW ALL;

RMAN configuration parameters for database with db_unique_name PROD1 are:
.
.
.
CONFIGURE DEFAULT DEVICE TYPE TO DISK; # default
CONFIGURE DEVICE TYPE DISK PARALLELISM 1 BACKUP TYPE TO BACKUPSET; # default
CONFIGURE DEVICE TYPE SBT_TAPE PARALLELISM 1 BACKUP TYPE TO BACKUPSET; # default
CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE' PARMS  "SBT_
LIBRARY=/usr/local/oracle/backup/lib/libobk.so";
</pre><p>If the necessary devices and channels are configured, then no action is necessary. Otherwise, you can use the <code class="codeph">CONFIGURE</code> command to configure automatic channels, or include <code class="codeph">ALLOCATE CHANNEL</code> commands within a <code class="codeph">RUN</code> block.
                              </p>
                              <p></p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Restore and recover the tablespace. Do one of the following:</span><div>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>If you are restoring data files to their original locations, then run the <code class="codeph">RESTORE TABLESPACE</code> and <code class="codeph">RECOVER TABLESPACE</code> commands at the RMAN prompt.
                                    </p>
                                    <p>For example, enter the following command if automatic channels are configured (sample output included):</p><pre class="oac_no_warn" dir="ltr">RMAN&gt; <span class="bold">RESTORE TABLESPACE users;</span>
 
Starting restore at 20-JUN-13
allocated channel: ORA_DISK_1
channel ORA_DISK_1: SID=37 device type=DISK
allocated channel: ORA_SBT_TAPE_1
channel ORA_SBT_TAPE_1: SID=38 device type=SBT_TAPE
channel ORA_SBT_TAPE_1: Oracle Secure Backup
 
channel ORA_DISK_1: starting datafile backup set restore
channel ORA_DISK_1: specifying datafile(s) to restore from backup set
channel ORA_DISK_1: restoring datafile 00012 to /disk1/oracle/dbs/users01.f
channel ORA_DISK_1: restoring datafile 00013 to /disk1/oracle/dbs/users02.f
channel ORA_DISK_1: restoring datafile 00021 to /disk1/oracle/dbs/users03.f
channel ORA_DISK_1: reading from backup piece
 /disk1/oracle/work/orcva/TKRM/backupset/2013_06_20/o1_mf_nnndf_
TAG20130620T105435_29jflwor_.bkp
channel ORA_DISK_1: piece
 handle=/disk1/oracle/work/orcva/TKRM/backupset/2013_06_20/o1_mf_nnndf_
TAG20130620T105435_29jflwor_.bkp tag=TAG20130620T105435
channel ORA_DISK_1: restored backup piece 1
channel ORA_DISK_1: restore complete, elapsed time: 00:00:01
Finished restore at 20-JUN-13
</pre><pre class="oac_no_warn" dir="ltr">RMAN&gt; <span class="bold">RECOVER TABLESPACE users;</span>
 
Starting recover at 20-JUN-13
using channel ORA_DISK_1
using channel ORA_SBT_TAPE_1
 
starting media recovery
 
archived log for thread 1 with sequence 27 is on disk as file
 /disk1/oracle/work/orcva/TKRM/archivelog/2013_06_20/o1_mf_1_27_29jjmtc9_.arc
archived log for thread 1 with sequence 28 is on disk as file
 /disk1/oracle/work/orcva/TKRM/archivelog/2013_06_20/o1_mf_1_28_29jjnc5x_.arc
.
.
.
channel ORA_DISK_1: starting archived log restore to default destination
channel ORA_DISK_1: restoring archived log
archived log thread=1 sequence=5
channel ORA_DISK_1: restoring archived log
archived log thread=1 sequence=6
channel ORA_DISK_1: restoring archived log
archived log thread=1 sequence=7
.
.
.
channel ORA_DISK_1: reading from backup piece
 /disk1/oracle/work/orcva/TKRM/backupset/2013_06_20/o1_mf_annnn_
TAG20130620T113128_29jhr197_.bkp
channel ORA_DISK_1: piece
 handle=/disk1/oracle/work/orcva/TKRM/backupset/2013_06_20/o1_mf_annnn_
TAG20130620T113128_29jhr197_.bkp tag=TAG20130620T113128
channel ORA_DISK_1: restored backup piece 1
channel ORA_DISK_1: restore complete, elapsed time: 00:00:02
archived log file name=/disk1/oracle/work/orcva/TKRM/archivelog/2013_06_
20/o1_mf_1_5_29jkdvjq_.arc thread=1 sequence=5
channel default: deleting archived log(s)
archived log file name=/disk1/oracle/work/orcva/TKRM/archivelog/2013_06_
20/o1_mf_1_5_29jkdvjq_.arc RECID=91 STAMP=593611179
archived log file name=/disk1/oracle/work/orcva/TKRM/archivelog/2013_06_
20/o1_mf_1_6_29jkdvbz_.arc thread=1 sequence=6
channel default: deleting archived log(s)
.
.
.
media recovery complete, elapsed time: 00:00:01
Finished recover at 20-JUN-13
</pre></li>
                                 <li>
                                    <p>If you are restoring some data files to new locations, then execute <code class="codeph">RESTORE TABLESPACE</code> and <code class="codeph">RECOVER TABLESPACE</code> in a <code class="codeph">RUN</code> command. Use the <code class="codeph">SET NEWNAME</code> command to rename data files, as described in <span class="q">"<a href="rman-complete-database-recovery.html#GUID-A3DE37A6-3983-4834-858E-A2BCC3804681" title="If you cannot restore data files to their default locations, then you must update the control file to reflect the new locations of the data files.">About Restoring Data Files to a Nondefault Location</a>"</span>.
                                    </p>
                                    <p>The following example restores the data files in tablespace <code class="codeph">users</code> to a new location, and then performs recovery. Assume that the old data files were stored in the <code class="codeph">/disk1</code> path and the new ones will be stored in the <code class="codeph">/disk2</code> path.
                                    </p><pre class="oac_no_warn" dir="ltr">RUN
{
  # specify the new location for each datafile
  SET NEWNAME FOR DATAFILE '/disk1/oracle/dbs/users01.f' TO 
                           '/disk2/users01.f';
  SET NEWNAME FOR DATAFILE '/disk1/oracle/dbs/users02.f' TO 
                           '/disk2/users02.f';
  SET NEWNAME FOR DATAFILE '/disk1/oracle/dbs/users03.f' TO 
                           '/disk2/users03.f';
  RESTORE TABLESPACE users;
  SWITCH DATAFILE ALL;   # update control file with new file names
  RECOVER TABLESPACE users;
}
</pre></li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Examine the output to see if recovery was successful. If so, bring the recovered tablespace back online.</span><div>
                              <p>For example, enter the following command:</p><pre class="oac_no_warn" dir="ltr">ALTER TABLESPACE users ONLINE;</pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV89774"></a><div class="props_rev_3"><a id="GUID-19A07A76-AE1E-41EE-8B7D-7C4EF1FD3137" name="GUID-19A07A76-AE1E-41EE-8B7D-7C4EF1FD3137"></a><h4 id="BRADV-GUID-19A07A76-AE1E-41EE-8B7D-7C4EF1FD3137" class="sect4"><span class="enumeration_section">17.3.4 </span>Performing Complete Recovery After Switching to a Copy
                  </h4>
                  <div>
                     <p>You can recover a database by switching to image copies of inaccessible data files. This technique takes less time than traditional restore and recovery because no backups need to be restored.</p>
                     <p>If you have image copies of the inaccessible data files in the fast recovery area, then you can use the <code class="codeph">SWITCH DATAFILE ... TO COPY</code> command to point the control file at the data file copy and then use <code class="codeph">RECOVER</code> to recover lost changes. You can also use the <code class="codeph">SWITCH DATABASE TO COPY</code> command to point the control file at a copy of the whole database.
                     </p>
                     <div class="infoboxnote" id="GUID-19A07A76-AE1E-41EE-8B7D-7C4EF1FD3137__GUID-32D4DB6B-B3DF-46F9-9223-26EA7F7B6CBD">
                        <p class="notep1">Note:</p>
                        <p>A <code class="codeph">SWITCH TABLESPACE ... TO COPY</code> command is also supported for cases when all data files in a tablespace are lost and copies of all data files exist. The same restriction exists for <code class="codeph">SWITCH DATABASE ... TO COPY</code>.
                        </p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-19A07A76-AE1E-41EE-8B7D-7C4EF1FD3137__GUID-B12BFE88-8ACB-4170-A2FB-B36A5149A5A2">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="rman-complete-database-recovery.html#GUID-27F3EB09-3608-4E0E-A7F0-1F0DF1D5C572" title="When one or more data files are damaged, you can perform recovery by switching to existing image copies of the damaged data files.">Performing Recovery After Switching to a Data File Copy</a></p>
                           </li>
                           <li>
                              <p><a href="rman-complete-database-recovery.html#GUID-4C884005-5636-4B54-98FC-4BBD683B3D7A" title="You can perform complete database recovery by switching to image copies of the damaged data files instead of restoring these data files.">Performing Complete Recovery After Switching to a Database Copy</a></p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="BRADV357"></a><a id="BRADV996"></a><div class="props_rev_3"><a id="GUID-27F3EB09-3608-4E0E-A7F0-1F0DF1D5C572" name="GUID-27F3EB09-3608-4E0E-A7F0-1F0DF1D5C572"></a><h5 id="BRADV-GUID-27F3EB09-3608-4E0E-A7F0-1F0DF1D5C572" class="sect5"><span class="enumeration_section">17.3.4.1 </span>Performing Recovery After Switching to a Data File Copy
                     </h5>
                     <div>
                        <p>When one or more data files are damaged, you can perform recovery by switching to existing image copies of the damaged data files.</p>
                        <div class="p">
                           <p><span class="q">"<a href="rman-complete-database-recovery.html#GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075" title="The complete recovery operations described in this chapter are subject to certain conditions.">Scope of This Chapter</a>"</span> for some of the assumptions used in the recovery procedures
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>In the basic scenario, the database is open, and some but not all of the data files are damaged. During the course of the day, a data file goes missing due to storage failure. You must repair this file, but cannot afford the time to do a restore and recovery from a backup. You decide to use a recent image copy backup as the new file, thus eliminating restore time. This scenario assumes that database <code class="codeph">trgt</code> has lost data file 4.
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-27F3EB09-3608-4E0E-A7F0-1F0DF1D5C572__GUID-862E8986-CEF8-445E-A998-A68748221196">To switch to a data file copy and perform recovery:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Complete the preparation steps required for your scenario, as described in <span class="q">"<a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="You must plan your database restore and recovery strategy based on your recovery goal and which database files have been lost.">Preparing for Complete Database Recovery</a>"</span>.</span></li>
                           <li class="stepexpand"><span>Start RMAN and connect to a target database, as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>.</span></li>
                           <li class="stepexpand"><span>If the database is open, then take the tablespace requiring recovery offline.</span><div>
                                 <p>Enter the following command to take data file 4 offline:</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE DATAFILE 4 OFFLINE;
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Switch the offline data file to the latest copy.</span><div>
                                 <p>Enter the following command to point the control file to the latest image copy of data file 4:</p><pre class="oac_no_warn" dir="ltr">SWITCH DATAFILE 4 TO COPY;
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Recover the data file with the <code class="codeph">RECOVER DATAFILE</code> command.</span><div>
                                 <p>Enter the following command:</p><pre class="oac_no_warn" dir="ltr">RECOVER DATAFILE 4;
 </pre><p>RMAN automatically restores archived redo logs and incremental backups. Because the database uses a fast recovery area, RMAN automatically deletes them after they have been applied.</p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Examine the output to see if recovery was successful. If so, bring the recovered data file back online.</span><div>
                                 <p>Enter the following command to bring data file 4 online:</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE DATAFILE 4 ONLINE;</pre></div>
                           </li>
                        </ol>
                     </div>
                  </div><a id="BRADV358"></a><a id="BRADV999"></a><div class="props_rev_3"><a id="GUID-4C884005-5636-4B54-98FC-4BBD683B3D7A" name="GUID-4C884005-5636-4B54-98FC-4BBD683B3D7A"></a><h5 id="BRADV-GUID-4C884005-5636-4B54-98FC-4BBD683B3D7A" class="sect5"><span class="enumeration_section">17.3.4.2 </span>Performing Complete Recovery After Switching to a Database Copy
                     </h5>
                     <div>
                        <p>You can perform complete database recovery by switching to image copies of the damaged data files instead of restoring these data files.</p>
                        <div class="p">
                           <p><span class="q">"<a href="rman-complete-database-recovery.html#GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075" title="The complete recovery operations described in this chapter are subject to certain conditions.">Scope of This Chapter</a>"</span> for some of the assumptions used in the recovery procedures
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>In this scenario, the database is shut down, and all of the data files are damaged. You have image copies of all the damaged data files and decide to use the existing image copies as the new data files, thus eliminating restore time.</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-4C884005-5636-4B54-98FC-4BBD683B3D7A__GUID-24DCC826-6790-425A-9DEB-56D8A5013D2A">To switch to a database copy and perform recovery:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Complete the preparation steps required for your scenario, as described in <span class="q">"<a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="You must plan your database restore and recovery strategy based on your recovery goal and which database files have been lost.">Preparing for Complete Database Recovery</a>"</span>.</span></li>
                           <li class="stepexpand"><span>Start RMAN and connect to a target database, as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>.</span></li>
                           <li class="stepexpand"><span>Mount the database.</span></li>
                           <li class="stepexpand"><span>Switch the database to the latest copy.</span><div>
                                 <p>Enter the following command to point the control file to the latest image copy of the database:</p><pre class="oac_no_warn" dir="ltr">SWITCH DATABASE TO COPY;
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Recover the database with the <code class="codeph">RECOVER DATABASE</code> command.</span><div>
                                 <p>Enter the following command:</p><pre class="oac_no_warn" dir="ltr">RECOVER DATABASE;
 </pre><p>RMAN automatically restores archived redo logs and incremental backups. Because the database uses a fast recovery area, RMAN automatically deletes them after they have been applied.</p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Examine the output to see if recovery was successful. If so, open the database.</span><div>
                                 <p>Enter the following command to open the database:</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN;
</pre></div>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV636"></a><div class="props_rev_3"><a id="GUID-1F744C63-2D4C-4F65-8773-1340A85993ED" name="GUID-1F744C63-2D4C-4F65-8773-1340A85993ED"></a><h3 id="BRADV-GUID-1F744C63-2D4C-4F65-8773-1340A85993ED" class="sect3"><span class="enumeration_section">17.4 </span>Performing Complete Recovery of CDBs
               </h3>
               <div>
                  <p>RMAN and Oracle Enterprise Manager Cloud Control (Cloud Control) provide full support for backup and recovery in a multitenant environment. </p>
                  <p>You can back up and recover a whole <a href="glossary.html#GUID-3E156A59-F6CC-4A2A-9749-DB7D1CE25F13"><span class="xrefglossterm">multitenant container database (CDB)</span></a>, <a href="glossary.html#GUID-EA3DB8F4-F68E-4FC5-A599-32A4886FFF8A"><span class="xrefglossterm">root</span></a> only, or one or more pluggable databases (<a href="glossary.html#GUID-993BFB3F-3305-481C-999D-26132095DEC9"><span class="xrefglossterm">PDB</span></a>s).
                  </p>
                  <p>The section contains the following topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-50186233-ADCE-4566-8D82-B41A566A0E3B" title="When you recover a whole CDB, you recover the root and all PDBs in a single operation.">Performing Complete Recovery of a Whole CDB</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-4575B27F-BB73-4EEE-8F80-F077801CA94B" title="You might consider recovering only the root if a data corruption or user error occurs that affects only the root.">Performing Complete Recovery of the Root</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44" title="You can perform complete recovery of one or more PDBs without affecting operations of other open PDBs.">Performing Complete Recovery of PDBs with RMAN</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-928729FC-3714-4FAE-9BDE-2DFBF45EE451" title="Enterprise Manager Cloud Control (Cloud Control) provides an interface to recover PDBs.">Performing Complete Recovery of PDBs with Cloud Control</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-591669B1-74A4-461F-A6B3-460F69803E90" title="Use the RECOVER command to perform complete recovery using preplugin backups.">Performing Complete Recovery Using Preplugin Backups</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934" title="Because tablespaces in different PDBs can have the same name, to eliminate ambiguity, you must connect directly to a PDB to recover one or more of its tablespaces. In contrast, because data file numbers and paths are unique across the CDB, you can connect either to the root or to a PDB when recovering PDB data files.">Performing Complete Recovery of Tablespaces or Data Files in a PDB with RMAN</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-97BD3A51-0AF1-46B0-B7DF-9F069C68F83F" title="Oracle Enterprise Manager Cloud Control (Cloud Control) provides an interface to recover tablespaces within a PDB.">Performing Complete Recovery of Tablespaces in a PDB with Cloud Control</a></p>
                     </li>
                     <li>
                        <p><a href="rman-complete-database-recovery.html#GUID-9A824454-8577-4899-BD69-E631B573021F" title="Recovering a CDB by switching to a copy is faster than traditional restore and recovery.">Performing Complete Recovering of CDBs After Switching to a Copy</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV637"></a><a id="BRADV746"></a><div class="props_rev_3"><a id="GUID-50186233-ADCE-4566-8D82-B41A566A0E3B" name="GUID-50186233-ADCE-4566-8D82-B41A566A0E3B"></a><h4 id="BRADV-GUID-50186233-ADCE-4566-8D82-B41A566A0E3B" class="sect4"><span class="enumeration_section">17.4.1 </span>Performing Complete Recovery of a Whole CDB
                  </h4>
                  <div>
                     <p>When you recover a whole CDB, you recover the root and all PDBs in a single operation.</p>
                     <div class="section">
                        <p><span class="bold">To recover a whole CDB:</span></p>
                        <ol>
                           <li>
                              <p>Complete the preparation steps that are required for your scenario, as described in <span class="q">"<a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="You must plan your database restore and recovery strategy based on your recovery goal and which database files have been lost.">Preparing for Complete Database Recovery</a>"</span></p>
                           </li>
                           <li>
                              <p>Connect to the root as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege and to a recovery catalog (if used), as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D" title="There are several ways to connect as target to the root.">Connecting as Target to the Root</a>"</span>.
                              </p>
                           </li>
                           <li>
                              <p>If the database is not mounted, then mount but do not open the database. Use the following g command:</p><pre class="oac_no_warn" dir="ltr">STARTUP MOUNT;
</pre></li>
                           <li>
                              <p>Use the <code class="codeph">SHOW</code> command to see which channels are preconfigured.
                              </p>
                              <p>If the necessary devices and channels are configured, then no action is necessary. Otherwise, you can use the <code class="codeph">CONFIGURE</code> command to configure automatic channels, or include <code class="codeph">ALLOCATE CHANNEL</code> commands within a <code class="codeph">RUN</code> block.
                              </p>
                           </li>
                           <li>
                              <p>Restore and recover the database. Do one of the following:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>If you are restoring all data files to their original locations, then execute <code class="codeph">RESTORE DATABASE</code> and <code class="codeph">RECOVER DATABASE</code> sequentially at the RMAN prompt.
                                    </p>
                                    <p>For example, enter the following commands if automatic channels are configured:</p><pre class="pre codeblock"><code>RESTORE DATABASE;
RECOVER DATABASE;</code></pre><p>If you manually allocate channels, then you must issue the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands together within a <code class="codeph">RUN</code> block as shown in the following example:
                                    </p><pre class="pre codeblock"><code>RUN
{
  ALLOCATE CHANNEL c1 DEVICE TYPE sbt;
  RESTORE DATABASE;
  RECOVER DATABASE;
}
</code></pre></li>
                                 <li>
                                    <p>If you are restoring some data files to new locations, then execute <code class="codeph">RESTORE DATABASE</code> and <code class="codeph">RECOVER DATABASE</code> sequentially in a <code class="codeph">RUN</code> command. Use the <code class="codeph">SET NEWNAME</code> command to rename data files.
                                    </p>
                                    <p>The following example restores the database, specifying new names for three of the data files, and then recovers the database:</p><pre class="oac_no_warn" dir="ltr">RUN
{  
  SET NEWNAME FOR DATAFILE 2 TO '/disk2/df2.dbf';
  SET NEWNAME FOR DATAFILE 3 TO '/disk2/df3.dbf';
  SET NEWNAME FOR DATAFILE 4 TO '/disk2/df4.dbf';
  RESTORE DATABASE;
  SWITCH DATAFILE ALL;
  RECOVER DATABASE;
}
</pre></li>
                              </ul>
                           </li>
                           <li>
                              <p>Examine the output to see if media recovery was successful. If so, open the database.</p>
                              <p>For example, enter the following command:</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN;</pre></li>
                        </ol>
                        <div class="infoboxnotealso" id="GUID-50186233-ADCE-4566-8D82-B41A566A0E3B__GUID-7B5DA9E9-268E-4D7D-92BB-94ACC6412B68">
                           <p class="notep1">See Also:</p>
                           <p><a href="rman-complete-database-recovery.html#GUID-A3DE37A6-3983-4834-858E-A2BCC3804681" title="If you cannot restore data files to their default locations, then you must update the control file to reflect the new locations of the data files.">About Restoring Data Files to a Nondefault Location</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV748"></a><a id="BRADV747"></a><div class="props_rev_3"><a id="GUID-4575B27F-BB73-4EEE-8F80-F077801CA94B" name="GUID-4575B27F-BB73-4EEE-8F80-F077801CA94B"></a><h4 id="BRADV-GUID-4575B27F-BB73-4EEE-8F80-F077801CA94B" class="sect4"><span class="enumeration_section">17.4.2 </span>Performing Complete Recovery of the Root
                  </h4>
                  <div>
                     <p>You might consider recovering only the root if a data corruption or user error occurs that affects only the root.</p>
                     <div class="section">
                        <p>However, Oracle strongly recommends that you recover all PDBs after recovering the root to prevent metadata inconsistencies among the root and the PDBs. In this case, it might be preferable to perform a complete recovery of the whole CDB.</p>
                        <div class="infoboxnotealso" id="GUID-4575B27F-BB73-4EEE-8F80-F077801CA94B__GUID-A55FFDE4-7020-425E-827B-BB400ECD5456">
                           <p class="notep1">See Also:</p>
                           <p><span class="q">"<a href="rman-complete-database-recovery.html#GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075" title="The complete recovery operations described in this chapter are subject to certain conditions.">Scope of This Chapter</a>"</span> for some of the assumptions used in the recovery procedures
                           </p>
                        </div>
                        <p><span class="bold">To recover the root:</span></p>
                        <ol>
                           <li>
                              <p>Complete the preparation steps that are required for your recovery scenario, as described in <span class="q">"<a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="You must plan your database restore and recovery strategy based on your recovery goal and which database files have been lost.">Preparing for Complete Database Recovery</a>"</span>.
                              </p>
                           </li>
                           <li>
                              <p>Start RMAN and connect to the root as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege, as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D" title="There are several ways to connect as target to the root.">Connecting as Target to the Root</a>"</span>.
                              </p>
                           </li>
                           <li>
                              <p>Place the CDB in mounted mode.</p><pre class="oac_no_warn" dir="ltr">SHUTDOWN IMMEDIATE;
STARTUP MOUNT;
</pre></li>
                           <li>
                              <p>(Optional) Use the <code class="codeph">CONFIGURE</code> command to configure the default device type and automatic channels.
                              </p>
                           </li>
                           <li>
                              <p>Restore and recover the root with the following commands:</p><pre class="oac_no_warn" dir="ltr">RESTORE DATABASE ROOT;
RECOVER DATABASE ROOT;
</pre></li>
                           <li>
                              <p>Examine the output to see if media recovery was successful. If so, proceed to the next step.</p>
                           </li>
                           <li>
                              <p>(Strongly recommended) Recover all PDBs, including the CDB seed.</p>
                              <ol type="a">
                                 <li>
                                    <p>Issue the <code class="codeph">RESTORE PLUGGABLE DATABASE</code> and <code class="codeph">RECOVER PLUGGABLE DATABASE</code> commands.
                                    </p>
                                    <p>The following example recovers the PDBs <code class="codeph">sales</code> and <code class="codeph">hr</code>:
                                    </p><pre class="oac_no_warn" dir="ltr">RESTORE PLUGGABLE DATABASE 'PDB$SEED', sales, hr;
RECOVER PLUGGABLE DATABASE 'PDB$SEED', sales, hr;
</pre></li>
                                 <li>
                                    <p>Examine the output to see if media recovery was successful. If so, proceed to the next step.</p>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>Open the CDB and all PDBs.</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN;
ALTER PLUGGABLE DATABASE ALL OPEN;</pre></li>
                        </ol>
                        <div class="infoboxnotealso" id="GUID-4575B27F-BB73-4EEE-8F80-F077801CA94B__GUID-71C950E2-FE92-477E-AFB8-BF44B36C045E">
                           <p class="notep1">See Also:</p>
                           <p><a href="rman-complete-database-recovery.html#GUID-50186233-ADCE-4566-8D82-B41A566A0E3B" title="When you recover a whole CDB, you recover the root and all PDBs in a single operation.">Performing Complete Recovery of a Whole CDB</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV750"></a><a id="BRADV751"></a><a id="BRADV749"></a><div class="props_rev_3"><a id="GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44" name="GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44"></a><h4 id="BRADV-GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44" class="sect4"><span class="enumeration_section">17.4.3 </span>Performing Complete Recovery of PDBs with RMAN
                  </h4>
                  <div>
                     <p>You can perform complete recovery of one or more PDBs without affecting operations of other open PDBs.</p>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44__GUID-C837E782-277A-4976-B971-86FA059546A0">
                           <p class="notep1">See Also:</p>
                           <p><span class="q">"<a href="rman-complete-database-recovery.html#GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075" title="The complete recovery operations described in this chapter are subject to certain conditions.">Scope of This Chapter</a>"</span> for some of the assumptions used in the recovery procedures
                           </p>
                        </div>
                        <p>There are two approaches to recovering a PDB with RMAN:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Connect to the root and then use the <code class="codeph">RESTORE PLUGGABLE DATABASE</code> and <code class="codeph">RECOVER PLUGGABLE DATABASE</code> commands. This approach enables you to recover multiple PDBs with a single command.
                              </p>
                           </li>
                           <li>
                              <p>Connect to the PDB and use the <code class="codeph">RESTORE DATABASE</code> and <code class="codeph">RECOVER DATABASE</code> commands. This approach recovers only a single PDB and enables you to use the same commands used for recovering non-CDB databases.
                              </p>
                           </li>
                        </ul>
                        <div class="infoboxnote" id="GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44__GUID-1DA489AB-D3AA-4AE1-8DF4-4E4C8C881277">
                           <p class="notep1">Video:</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=vid_dbbackup_recoverpdb" target="_blank">Oracle Video: Recovering a PDB</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p></p>
                        <p><span class="bold">To recover one or more PDBs while connected to the root:</span></p>
                        <ol>
                           <li>
                              <p>Complete the preparation steps that are required for your recovery scenario, as described in <span class="q">"<a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="You must plan your database restore and recovery strategy based on your recovery goal and which database files have been lost.">Preparing for Complete Database Recovery</a>"</span>.
                              </p>
                           </li>
                           <li>
                              <p>Start RMAN. Connect to the root as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege and to a recovery catalog (if used), as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D" title="There are several ways to connect as target to the root.">Connecting as Target to the Root</a>"</span>.
                              </p>
                           </li>
                           <li>
                              <p>Close the PDBs that you want to recover.</p><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE sales, hr CLOSE;
</pre><p>If any data files are missing, an error occurs and you cannot close a PDB. You must then connect to the PDB to which the missing data file belongs, take the missing data file offline, and then close the PDB.</p>
                              <p>The following command takes the data file 12 offline:</p><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE DATAFILE 12 OFFLINE;
</pre><div class="infoboxnote" id="GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44__GUID-BC3A98D5-DE8A-41FC-8558-750A70A8A5F1">
                                 <p class="notep1">Note:</p>
                                 <p>If the data files that store the <code class="codeph">SYSTEM</code> tablespace of a PDB are missing, then follow the recovery steps that are described in <span class="q">"<a href="rman-complete-database-recovery.html#GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934" title="Because tablespaces in different PDBs can have the same name, to eliminate ambiguity, you must connect directly to a PDB to recover one or more of its tablespaces. In contrast, because data file numbers and paths are unique across the CDB, you can connect either to the root or to a PDB when recovering PDB data files.">Performing Complete Recovery of Tablespaces or Data Files in a PDB with RMAN</a>"</span>.
                                 </p>
                              </div>
                           </li>
                           <li>
                              <p>(Optional) Use the <code class="codeph">CONFIGURE</code> command to configure the default device type and automatic channels.
                              </p>
                           </li>
                           <li>
                              <p>Issue the <code class="codeph">RESTORE PLUGGABLE DATABASE</code> and <code class="codeph">RECOVER PLUGGABLE DATABASE</code> commands.
                              </p>
                              <p>The following example recovers the CDB seed, <code class="codeph">PDB$SEED</code>, and the PDBs <code class="codeph">sales</code> and <code class="codeph">hr</code>:
                              </p><pre class="oac_no_warn" dir="ltr">RESTORE PLUGGABLE DATABASE 'pdb$seed', sales, hr;
RECOVER PLUGGABLE DATABASE 'pdb$seed', sales, hr;
</pre></li>
                           <li>
                              <p>If any data files were taken offline in Step 2, make these data files online.</p>
                              <p>Connect to the PDB to which the missing data file belongs and then make the data file online. The following command makes the data file 12 online:</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE DATAFILE 12 ONLINE;
</pre></li>
                           <li>
                              <p>Examine the output to see if media recovery was successful. If so, open the PDBs.</p><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE sales, hr OPEN;</pre></li>
                        </ol>
                        <p><span class="bold">To connect to and recover one PDB:</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Complete the preparation steps that are required for your recovery scenario, as described in <span class="q">"<a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="You must plan your database restore and recovery strategy based on your recovery goal and which database files have been lost.">Preparing for Complete Database Recovery</a>"</span>.</span></li>
                        <li class="stepexpand"><span>Start RMAN. Connect to the PDB as a <a href="glossary.html#GUID-43EA1A4C-E5EB-4926-99EC-1DDA0E74A07C"><span class="xrefglossterm">local user</span></a> with the <code class="codeph">SYSDBA</code> system privilege and to a recovery catalog (if used), as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E95C5C27-C036-4773-B77C-E4120526F422" title="You can connect to a PDB either from the RMAN prompt or the operating system command line.">Connecting as Target to a PDB</a>"</span>.</span></li>
                        <li class="stepexpand"><span>Close the PDB.</span><div><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE CLOSE;
</pre><p>If any data files are missing, an error occurs and you cannot close the PDB. You must take the missing data file offline and then close the PDB.</p>
                              <p>The following command takes the data file 12 offline:</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE DATAFILE 12 OFFLINE;
</pre><div class="infoboxnote" id="GUID-8D0D3B72-C618-4AD2-902A-6A4064C14C44__GUID-4AAF369F-0C9E-4319-BD15-A6BB51DDB0EC">
                                 <p class="notep1">Note:</p>
                                 <p>If the data files that store the <code class="codeph">SYSTEM</code> tablespace of a PDB are missing, then follow the recovery steps described in <span class="q">"<a href="rman-complete-database-recovery.html#GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934" title="Because tablespaces in different PDBs can have the same name, to eliminate ambiguity, you must connect directly to a PDB to recover one or more of its tablespaces. In contrast, because data file numbers and paths are unique across the CDB, you can connect either to the root or to a PDB when recovering PDB data files.">Performing Complete Recovery of Tablespaces or Data Files in a PDB with RMAN</a>"</span>.
                                 </p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>(Optional) Use the <code class="codeph">CONFIGURE</code> command to configure the default device type and automatic channels.</span></li>
                        <li class="stepexpand"><span>Issue the <code class="codeph">RESTORE DATABASE</code> and <code class="codeph">RECOVER DATABASE</code> commands.</span><div><pre class="oac_no_warn" dir="ltr">RESTORE DATABASE;
RECOVER DATABASE;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>If any data files were taken offline in Step 2, make these data files online.</span><div>
                              <p>The following command makes the data file 12 online:</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE DATAFILE 12 ONLINE;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Open the PDB.</span><div><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE OPEN;</pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV752"></a><div class="props_rev_3"><a id="GUID-928729FC-3714-4FAE-9BDE-2DFBF45EE451" name="GUID-928729FC-3714-4FAE-9BDE-2DFBF45EE451"></a><h4 id="BRADV-GUID-928729FC-3714-4FAE-9BDE-2DFBF45EE451" class="sect4"><span class="enumeration_section">17.4.4 </span>Performing Complete Recovery of PDBs with Cloud Control
                  </h4>
                  <div>
                     <p>Enterprise Manager Cloud Control (Cloud Control) provides an interface to recover PDBs.</p>
                     <div class="section">
                        <p><span class="bold">To recover one or more PDBs with Cloud Control:</span></p>
                        <ol>
                           <li>
                              <p>From the Database Home page, select <span class="bold">Backup &amp; Recovery</span> from the Availability menu, and then select <span class="bold">Perform Recovery</span>.
                              </p>
                           </li>
                           <li>
                              <p>If you have not logged in to the database previously, the Database Login page is displayed. Log in to the database using Named or New credentials and then click <span class="bold">Login</span>.
                              </p>
                              <p>Cloud Control displays the Perform Recovery page.</p>
                           </li>
                           <li>
                              <p>From the User Directed Recovery section, select <span class="bold">Pluggable Databases</span> from the Recovery Scope drop-down list, and then click <span class="bold">Recover</span>.
                              </p>
                              <p>The Perform Pluggable Database Recovery Wizard appears and displays the Pluggable Databases page.</p>
                           </li>
                           <li>
                              <p>Select the PDBs that you want to recover by following these steps:</p>
                              <ol type="a">
                                 <li>
                                    <p>Click <span class="bold">Add</span> to display the Available Pluggable Databases page.
                                    </p>
                                 </li>
                                 <li>
                                    <p>From the list of PDBs shown, click in the <span class="bold">Select</span> column to designate the PDBs that you want to recover. Optionally, you can click <span class="bold">Select All</span> to turn on the Select option for all available PDBs. Click <span class="bold">Select None</span> to deselect all PDBs.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Click the <span class="bold">Select</span> button to return to the Pluggable Databases page.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Optionally, you can remove PDBs from the table by clicking in the <span class="bold">Select</span> column for each PDB that you want to remove and then clicking <span class="bold">Remove</span>.
                                    </p>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>Complete the wizard by navigating through the remainder of the pages to recover the PDBs. For more information about each page of the wizard, click <span class="bold">Help</span>.
                              </p>
                           </li>
                        </ol>
                        <div class="infoboxnotealso" id="GUID-928729FC-3714-4FAE-9BDE-2DFBF45EE451__GUID-600E1F3D-0F41-4C9A-975C-5C9D05163644">
                           <p class="notep1">See Also:</p>
                           <p><span class="q">"<a href="introduction-backup-recovery.html#GUID-7557D8F6-2DC8-460A-8453-74E73DEF8705" title="The Database Home page is the main database management page in Oracle Enterprise Manager Cloud Control (Cloud Control).">Accessing the Database Home Page Using Cloud Control</a>"</span></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-591669B1-74A4-461F-A6B3-460F69803E90" name="GUID-591669B1-74A4-461F-A6B3-460F69803E90"></a><h4 id="BRADV-GUID-591669B1-74A4-461F-A6B3-460F69803E90" class="sect4"><span class="enumeration_section">17.4.5 </span>Performing Complete Recovery Using Preplugin Backups
                  </h4>
                  <div>
                     <p>Use the <code class="codeph">RECOVER</code> command to perform complete recovery using preplugin backups.
                     </p>
                     <p>This section contains the following topics:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="rman-complete-database-recovery.html#GUID-C5D28C51-1265-4EF0-BA08-ED6CA6998F04" title="Preplugin backups are used to restore and recover a PDB to its state at a time in the past that was before the PDB was plugged in to the current CDB.">About Complete Recovery of PDBs Using PrePlugin Backups</a></p>
                        </li>
                        <li>
                           <p><a href="rman-complete-database-recovery.html#GUID-1F67ECAB-B8D0-4547-A5F1-F1C3C7AF2C5D" title="RMAN performs complete recovery of a PDB using preplugin backups. These preplugin backups were created on a source non-CDB or a source CDB before the PDB was migrated to the current target CDB.">Performing Complete Recovery of PDBs Using Preplugin Backups</a></p>
                        </li>
                        <li>
                           <p><a href="rman-complete-database-recovery.html#GUID-24440AE6-42DA-4392-A871-C7632DD9BEF8" title="This example performs complete recovery of a PDB my_pdb in the destination CDB prod_cdb using preplugin backups.">Example: Performing Complete Recovery of PDBs Using Preplugin Backups</a></p>
                        </li>
                     </ul>
                  </div>
                  <div class="sect4"><a id="GUID-C5D28C51-1265-4EF0-BA08-ED6CA6998F04" name="GUID-C5D28C51-1265-4EF0-BA08-ED6CA6998F04"></a><h5 id="BRADV-GUID-C5D28C51-1265-4EF0-BA08-ED6CA6998F04" class="sect5"><span class="enumeration_section">17.4.5.1 </span>About Complete Recovery of PDBs Using PrePlugin Backups
                     </h5>
                     <div>
                        <p>Preplugin backups are used to restore and recover a PDB to its state at a time in the past that was before the PDB was plugged in to the current CDB. </p>
                        <p></p>
                        <p>To perform complete recovery using preplugin backups, use the <code class="codeph">FROM PREPLUGIN</code> clause of the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands. RMAN restores data files using preplugin backups and then uses the preplugin incremental backups and archived redo logs to recover data files to a point in time that is before the PDB was plugged in to the destination CDB.
                        </p>
                        <p>The metadata for the preplugin backups is migrated to the destination CDB when you unplug the PDB or use the <code class="codeph">DBMS_PDB.EXPORTRMANBACKUP()</code> procedure with non-CDBs. Preplugin backups are not automatically migrated to the destination CDB. You must ensure that the destination CDB has access to the backups created on the source database.
                        </p>
                        <p>The location to which RMAN restores preplugin archived redo logs depends on whether a fast recovery area is configured in the destination CDB. If a fast recovery area is not the default destination for archived redo log files in the CDB, then RMAN restores preplugin archived redo logs to the fast recovery area. If the fast recovery area is the default destination for archived redo log files in the CDB, then you must use the <code class="codeph">SET ARCHIVELOG DESTINATION</code> command to specify a location for the preplugin archived redo log files.
                        </p>
                        <div class="infoboxnotealso" id="GUID-C5D28C51-1265-4EF0-BA08-ED6CA6998F04__GUID-27C3BA50-7BDD-4CCC-98E1-16A98BA6F46A">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="rman-backup-concepts.html#GUID-7D69CBCA-123F-49FF-85E9-F5C70E47202D" title="A preplugin backup is an RMAN backup of a non-CDB or a PDB that was created before the non-CDB or PDB was plugged in to a different CDB.">About Preplugin Backups</a></p>
                              </li>
                              <li>
                                 <p><a href="rman-complete-database-recovery.html#GUID-1F67ECAB-B8D0-4547-A5F1-F1C3C7AF2C5D" title="RMAN performs complete recovery of a PDB using preplugin backups. These preplugin backups were created on a source non-CDB or a source CDB before the PDB was migrated to the current target CDB.">Performing Complete Recovery of PDBs Using Preplugin Backups</a></p>
                              </li>
                              <li>
                                 <p><a href="rman-complete-database-recovery.html#GUID-24440AE6-42DA-4392-A871-C7632DD9BEF8" title="This example performs complete recovery of a PDB my_pdb in the destination CDB prod_cdb using preplugin backups.">Example: Performing Complete Recovery of PDBs Using Preplugin Backups</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-1F67ECAB-B8D0-4547-A5F1-F1C3C7AF2C5D" name="GUID-1F67ECAB-B8D0-4547-A5F1-F1C3C7AF2C5D"></a><h5 id="BRADV-GUID-1F67ECAB-B8D0-4547-A5F1-F1C3C7AF2C5D" class="sect5"><span class="enumeration_section">17.4.5.2 </span>Performing Complete Recovery of PDBs Using Preplugin Backups
                     </h5>
                     <div>
                        <p>RMAN performs complete recovery of a PDB using preplugin backups. These preplugin backups were created on a source non-CDB or a source CDB before the PDB was migrated to the current target CDB. </p>
                        <div class="section">
                           <p></p>
                        </div>
                        <!-- class="section" -->
                        <div class="p">Preplugin backups must include all archived redo logs that are required to recover the PDB.</div>
                        <!-- class="section" -->
                        <div class="p">To perform complete recovery using preplugin backups of a non-CDB, the non-CDB backups must be created using the procedure described in <span class="q">"<a href="backing-up-database.html#GUID-7F9F8913-2838-4066-A000-048B35A70EA4" title="Preplugin backups ensure that an RMAN backup is usable after a non-CDB is plugged in as a PDB into a CDB.">Creating a Preplugin Backup of the Whole Database</a>"</span>.
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p></p>
                           <div class="infoboxnote" id="GUID-1F67ECAB-B8D0-4547-A5F1-F1C3C7AF2C5D__GUID-19BC4F6F-8776-4BD7-8E02-25AC5A065FA1">
                              <p class="notep1">Note:</p>
                              <p>You cannot recover a PDB using preplugin backups if the preplugin backup was created before the PDB was opened with the <code class="codeph">RESETLOGS</code> option.
                              </p>
                           </div>
                           <p><span class="bold">To perform complete recovery of a PDB using preplugin backups:</span> 
                           </p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Ensure that the prerequisites for performing recovery using preplugin backups described in <a href="../rcmrf/BACKUP.html#RCMRF-GUID-73642FF2-43C5-48B2-9969-99001C52EB50" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> are met.</span></li>
                           <li class="stepexpand"><span>Ensure that the shared location containing preplugin backups of the PDB is accessible to the destination host. </span><div>
                                 <div class="infoboxnote" id="GUID-1F67ECAB-B8D0-4547-A5F1-F1C3C7AF2C5D__GUID-6F4B837F-F27A-47A9-B4E9-DE851BA59C03">
                                    <p class="notep1">Note:</p>
                                    <p>Using shared disk is the only method that is supported to share prelugin backups with the destination host. Manually copying the required backups to the destination is not supported.</p>
                                 </div>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Connect to the target CDB using one of the following techniques:</span><div>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>Connect to the root as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege
                                       </p>
                                    </li>
                                    <li>
                                       <p>Connect to the PDB that needs to be recovered as a user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege.
                                       </p>
                                    </li>
                                 </ul>
                                 <p>See <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Close the PDB that is being recovered. For example:</span><div><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE pdb1 CLOSE IMMEDIATE;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>Set the current container to the PDB that is being recovered. For example:</span><div><pre class="pre codeblock"><code>SET PREPLUGIN CONTAINER=pdb1;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>(Optional) To view the preplugin backups, use the <code class="codeph">LIST</code> command.</span><div><pre class="pre codeblock"><code>LIST PREPLUGIN BACKUP OF PLUGGABLE DATABASE pdb1;
LIST PREPLUGIN ARCHIVELOG ALL;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>(Optional) To catalog any backups that were not stored in the source database control file before migration, use the <code class="codeph">CATALOG...PREPLUGIN</code> command.</span><div>
                                 <p>The <code class="codeph">ROOT</code> must be open in read-write mode for cataloging backups. The following command catalogs the specified archived redo log:
                                 </p><pre class="pre codeblock"><code>CATALOG PREPLUGIN ARCHIVELOG '/disk1/o1_mf_annnn_dmy2r45h_.bkp';</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>Restore the PDB using preplugin backups.</span><div><pre class="pre codeblock"><code>RESTORE PLUGGABLE DATABASE pdb1 FROM PREPLUGIN;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>Recover the PDB using preplugin backups.</span><div>
                                 <p>The <code class="codeph">RECOVER ... FROM PREPLUGIN</code> command performs preplugin recovery. If the destination CDB uses the fast recovery area as the archivelog destination, then use <code class="codeph">SET ARCHIVELOG DESTINATION</code> to specify the destination to which preplugin backups must be recovered.
                                 </p><pre class="pre codeblock"><code>RUN
{
   SET ARCHIVELOG DESTINATION TO '/disk1/alog_dest';
   RECOVER PLUGGABLE DATABASE pdb1 FROM PREPLUGIN;
}
</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>Restore any new data files that were added after <code class="codeph">pdb1</code> was plugged in to the destination CDB and then perform normal recovery of <code class="codeph">pdb1</code>.</span><div><pre class="pre codeblock"><code>   RESTORE PLUGGABLE DATABASE pdb1 SKIP PREPLUGIN;
   RECOVER PLUGGABLE DATABASE pdb1;
</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>Open the recovered PDB.</span><div>
                                 <p>The following command opens the PDB called <code class="codeph">pdb1</code>.
                                 </p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE pdb1 OPEN;</code></pre></div>
                           </li>
                        </ol>
                        <div class="section">
                           <div class="infoboxnotealso" id="GUID-1F67ECAB-B8D0-4547-A5F1-F1C3C7AF2C5D__GUID-F842F64F-C92E-491B-88EF-9AE2681C2A29">
                              <p class="notep1">See Also:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><a href="rman-complete-database-recovery.html#GUID-24440AE6-42DA-4392-A871-C7632DD9BEF8" title="This example performs complete recovery of a PDB my_pdb in the destination CDB prod_cdb using preplugin backups.">Example: Performing Complete Recovery of PDBs Using Preplugin Backups</a></p>
                                 </li>
                                 <li>
                                    <p><a href="rman-complete-database-recovery.html#GUID-C5D28C51-1265-4EF0-BA08-ED6CA6998F04" title="Preplugin backups are used to restore and recover a PDB to its state at a time in the past that was before the PDB was plugged in to the current CDB.">About Complete Recovery of PDBs Using PrePlugin Backups</a></p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-24440AE6-42DA-4392-A871-C7632DD9BEF8" name="GUID-24440AE6-42DA-4392-A871-C7632DD9BEF8"></a><h5 id="BRADV-GUID-24440AE6-42DA-4392-A871-C7632DD9BEF8" class="sect5"><span class="enumeration_section">17.4.5.3 </span>Example: Performing Complete Recovery of PDBs Using Preplugin Backups
                     </h5>
                     <div>
                        <p>This example performs complete recovery of a PDB <code class="codeph">my_pdb</code> in the destination CDB <code class="codeph">prod_cdb</code> using preplugin backups.
                        </p>
                        <div class="section">
                           <p></p>
                           <p>The PDB <code class="codeph">my_pdb</code> was unplugged from the CDB <code class="codeph">test_cdb</code> and then plugged in to the CDB <code class="codeph">prod_cdb</code>. When this PDB was unplugged from <code class="codeph">test_cdb</code>, its metadata was stored in the file <code class="codeph">mypdb.xml</code>. This metadata was used to plug <code class="codeph">my_pdb</code> into <code class="codeph">prod_cdb</code>. The backups of <code class="codeph">my_pdb</code> that were created in the source CDB <code class="codeph">test_cdb</code> are stored in the shared location <code class="codeph">/oracle/database/backups</code>. The CDB <code class="codeph">prod_cdb</code> uses the fast recovery area to store archived redo log files.
                           </p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Ensure that the prerequisites for performing recovery using preplugin backups described in <a href="../rcmrf/RESTORE.html#RCMRF-GUID-4491C03F-C5F8-43E5-B4C4-FE26C70F2E9B" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> are met.</span></li>
                           <li class="stepexpand"><span>Set up a shared disk to share the preplugin backups created on the source with the destination host.</span></li>
                           <li class="stepexpand"><span>Start RMAN and connect to the root of <code class="codeph">prod_cdb</code> as a common user with the <code class="codeph">SYSBABKUP</code> privilege.</span><div>
                                 <p>The following command uses password file authentication to connect to the root as a common user with the <code class="codeph">SYSBACKUP</code> privilege.
                                 </p><pre class="pre codeblock"><code>CONNECT TARGET sbu@prod_cdb as SYSBACKUP;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>Close the PDB <code class="codeph">my_pdb</code>.</span><div><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE my_pdb CLOSE IMMEDIATE;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>Set the preplugin container to the PDB that is being recovered.</span><div><pre class="pre codeblock"><code>SET PREPLUGIN CONTAINER=my_pdb;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>Restore <code class="codeph">my_pdb</code> using the preplugin backups that were created on the source CDB <code class="codeph">test_cdb</code> before <code class="codeph">my_pdb</code> was plugged in to <code class="codeph">prod_cdb</code>. </span><div><pre class="pre codeblock"><code>RESTORE PLUGGABLE DATABASE my_pdb FROM PREPLUGIN;
</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>Recover <code class="codeph">my_pdb</code> using preplugin backups. Because the fast recovery area is configured to store archived redo log files for the destination CDB, you must specify an alternate destination for the restored preplugin archived redo log files. </span><div><pre class="pre codeblock"><code>RUN
{
   SET ARCHIVELOG DESTINATION TO '/disk1/arc_dest/';
   RECOVER PLUGGABLE DATABASE my_pdb FROM PREPLUGIN;
}</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>If any data files were added to <code class="codeph">my_pdb</code> after it was plugged in to <code class="codeph">prod_cdb</code>, then restore these data files and then recover the PDB <code class="codeph">my_pdb</code>.</span><div>
                                 <p></p><pre class="pre codeblock"><code>RESTORE PLUGGABLE DATABASE my_pdb SKIP PREPLUGIN;
RECOVER PLUGGABLE DATABASE my_pdb;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>Open the PDB <code class="codeph">my_pdb</code>.</span><div><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE my_pdb OPEN;</code></pre></div>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div><a id="BRADV754"></a><a id="BRADV755"></a><a id="BRADV753"></a><div class="props_rev_3"><a id="GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934" name="GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934"></a><h4 id="BRADV-GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934" class="sect4"><span class="enumeration_section">17.4.6 </span>Performing Complete Recovery of Tablespaces or Data Files in a PDB with RMAN
                  </h4>
                  <div>
                     <p>Because tablespaces in different PDBs can have the same name, to eliminate ambiguity, you must connect directly to a PDB to recover one or more of its tablespaces. In contrast, because data file numbers and paths are unique across the CDB, you can connect either to the root or to a PDB when recovering PDB data files.</p>
                     <div class="section">
                        <p>If you connect to the root, you can recover data files from multiple PDBs with a single command. If you connect to a PDB, you can recover only data files in that PDB.</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p></p>
                        <p><span class="bold">To restore and recover a non-SYSTEM tablespace in a PDB:</span></p>
                        <ol>
                           <li>
                              <p>Complete the preparation steps that are required for your recovery scenario, as described in <span class="q">"<a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="You must plan your database restore and recovery strategy based on your recovery goal and which database files have been lost.">Preparing for Complete Database Recovery</a>"</span>.
                              </p>
                           </li>
                           <li>
                              <p>Start RMAN. Connect to a target database and to a recovery catalog (if used), as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>."</span></p>
                           </li>
                           <li>
                              <p>If the database is open, then take the tablespace requiring recovery offline.</p>
                              <p>For example, enter the following command to take the <code class="codeph">USERS</code> tablespace offline:
                              </p><pre class="pre codeblock"><code>ALTER TABLESPACE users OFFLINE IMMEDIATE;
</code></pre></li>
                           <li>
                              <p>Use the <code class="codeph">SHOW</code> command to see which channels are preconfigured.
                              </p>
                              <p>If the necessary devices and channels are configured, then no action is necessary. Otherwise, you can use the <code class="codeph">CONFIGURE</code> command to configure automatic channels, or include <code class="codeph">ALLOCATE CHANNEL</code> commands within a <code class="codeph">RUN</code> block.
                              </p>
                              <p></p>
                           </li>
                           <li>
                              <p>Restore and recover the tablespace. Do one of the following:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>If you are restoring data files to their original locations, then run the <code class="codeph">RESTORE TABLESPACE</code> and <code class="codeph">RECOVER TABLESPACE</code> commands at the RMAN prompt.
                                    </p>
                                    <p>For example, enter the following commands if automatic channels are configured:</p><pre class="pre codeblock"><code>RMAN&gt; RESTORE TABLESPACE users;
RMAN&gt; RECOVER TABLESPACE users;</code></pre></li>
                                 <li>
                                    <p>If you are restoring some data files to new locations, then execute <code class="codeph">RESTORE TABLESPACE</code> and <code class="codeph">RECOVER TABLESPACE</code> in a <code class="codeph">RUN</code> command. Use the <code class="codeph">SET NEWNAME</code> command to rename data files.
                                    </p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>Examine the output to see if recovery was successful. If so, bring the recovered tablespace back online.</p>
                              <p>For example, enter the following command:</p><pre class="pre codeblock"><code>ALTER TABLESPACE users ONLINE;</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><span class="bold">To restore and recover the SYSTEM tablespace in a PDB:</span></p>
                        <ol>
                           <li>
                              <p>Complete the preparation steps that are required for your recovery scenario, as described in <span class="q">"<a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="You must plan your database restore and recovery strategy based on your recovery goal and which database files have been lost.">Preparing for Complete Database Recovery</a>"</span>.
                              </p>
                           </li>
                           <li>
                              <p>Start RMAN. Connect to the root as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege and to a recovery catalog (if used), as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D" title="There are several ways to connect as target to the root.">Connecting as Target to the Root</a>"</span>.
                              </p>
                           </li>
                           <li>
                              <p>Shut down the CDB and restart it in mount mode.</p><pre class="pre codeblock"><code>SHUTDOWN IMMEDIATE;
STARTUP MOUNT;</code></pre></li>
                           <li>
                              <p>Restore and recover the data files that store the <code class="codeph">SYSTEM</code> tablespace of the affected PDB.
                              </p><pre class="pre codeblock"><code>RESTORE DATAFILE 2,3;
RECOVER DATAFILE 2,3;</code></pre></li>
                           <li>
                              <p>Open all the PDBs in the CDB.</p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE ALL OPEN READ WRITE;</code></pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><span class="bold">To recover non-SYSTEM data files in a PDB:</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Complete the preparation steps that are required for your recovery scenario, as described in <span class="q">"<a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="You must plan your database restore and recovery strategy based on your recovery goal and which database files have been lost.">Preparing for Complete Database Recovery</a>"</span>.</span></li>
                        <li class="stepexpand"><span>Do one of the following:</span><div>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>Start RMAN. Connect to the root as a <a href="glossary.html#GUID-2B102186-15BD-443C-B375-8CB0D442CF5F"><span class="xrefglossterm">common user</span></a> with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege and to a recovery catalog (if used), as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D" title="There are several ways to connect as target to the root.">Connecting as Target to the Root</a>"</span>.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Start RMAN. Connect to the PDB as a local user with the <code class="codeph">SYSDBA</code> privilege and to a recovery catalog (if used), as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E95C5C27-C036-4773-B77C-E4120526F422" title="You can connect to a PDB either from the RMAN prompt or the operating system command line.">Connecting as Target to a PDB</a>"</span>.
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Issue the <code class="codeph">RESTORE DATAFILE</code> and <code class="codeph">RECOVER DATAFILE</code> commands.</span><div><pre class="oac_no_warn" dir="ltr">RESTORE DATAFILE 10, 13;
RECOVER DATAFILE 10, 13;</pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934__GUID-DFF0BBD1-2174-4245-A6DB-8A12BE84A62F">
                           <p class="notep1">See Also:</p>
                           <p><span class="q">"<a href="rman-complete-database-recovery.html#GUID-A3DE37A6-3983-4834-858E-A2BCC3804681" title="If you cannot restore data files to their default locations, then you must update the control file to reflect the new locations of the data files.">About Restoring Data Files to a Nondefault Location</a>"</span></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV756"></a><div class="props_rev_3"><a id="GUID-97BD3A51-0AF1-46B0-B7DF-9F069C68F83F" name="GUID-97BD3A51-0AF1-46B0-B7DF-9F069C68F83F"></a><h4 id="BRADV-GUID-97BD3A51-0AF1-46B0-B7DF-9F069C68F83F" class="sect4"><span class="enumeration_section">17.4.7 </span>Performing Complete Recovery of Tablespaces in a PDB with Cloud Control
                  </h4>
                  <div>
                     <p>Oracle Enterprise Manager Cloud Control (Cloud Control) provides an interface to recover tablespaces within a PDB.</p>
                     <div class="section">
                        <p><span class="bold">To perform complete recovery of tablespaces in a PDB with Cloud Control:</span></p>
                        <ol>
                           <li>
                              <p>From the Database Home page, select <span class="bold">Backup &amp; Recovery</span> from the Availability menu, and then select <span class="bold">Perform Recovery</span>.
                              </p>
                           </li>
                           <li>
                              <p>If you have not logged in to the database previously, the Database Login page is displayed. Log in to the database using Named or New credentials and then click <span class="bold">Login</span>.
                              </p>
                              <p>Cloud Control displays the Perform Recovery page.</p>
                           </li>
                           <li>
                              <p>From the User Directed Recovery section, select <span class="bold">Tablespaces</span> from the Recovery Scope drop-down list, and then click <span class="bold">Recover</span>.
                              </p>
                           </li>
                           <li>
                              <p>On the Perform Object Level Recovery:Point-in-time page, ensure that <span class="bold">Recover to the current time</span> is selected, and click <span class="bold">Next</span>.
                              </p>
                           </li>
                           <li>
                              <p>On the Perform Object Level Recovery: Tablespaces page, select the tablespaces that you want to recover by completing these steps:</p>
                              <ol type="a">
                                 <li>
                                    <p>Click <span class="bold">Add</span> to display the Available Tablespaces page.
                                    </p>
                                    <p>The Search Results table shows all available tablespaces and includes the name of the PDB to which each tablespace belongs.</p>
                                 </li>
                                 <li>
                                    <p>Click <span class="bold">Select</span> to designate the tablespaces that you want to recover. Optionally, you can click <span class="bold">Select All</span> to turn on the Select option for all available tablespaces. Click <span class="bold">Select None</span> to deselect all tablespaces.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Click the <span class="bold">Select</span> button to return to the Perform Object Level Recovery: Tablespaces page.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Optionally, you can remove tablespaces from the table by turning on the Select option for each tablespace that you want to remove and then clicking <span class="bold">Remove</span>.
                                    </p>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>Click <span class="bold">Next</span> to move to the next step in the wizard.
                              </p>
                           </li>
                           <li>
                              <p>Complete the wizard by navigating through the remainder of the pages to recover the PDB tablespace. For more information about each page of the wizard, click <span class="bold">Help</span>.
                              </p>
                           </li>
                        </ol>
                        <div class="infoboxnotealso" id="GUID-97BD3A51-0AF1-46B0-B7DF-9F069C68F83F__GUID-1A8A7785-7DCC-4E66-BEFD-982544C71CF6">
                           <p class="notep1">See Also:</p>
                           <p><span class="q">"<a href="introduction-backup-recovery.html#GUID-7557D8F6-2DC8-460A-8453-74E73DEF8705" title="The Database Home page is the main database management page in Oracle Enterprise Manager Cloud Control (Cloud Control).">Accessing the Database Home Page Using Cloud Control</a>"</span></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV757"></a><div class="props_rev_3"><a id="GUID-9A824454-8577-4899-BD69-E631B573021F" name="GUID-9A824454-8577-4899-BD69-E631B573021F"></a><h4 id="BRADV-GUID-9A824454-8577-4899-BD69-E631B573021F" class="sect4"><span class="enumeration_section">17.4.8 </span>Performing Complete Recovering of CDBs After Switching to a Copy
                  </h4>
                  <div>
                     <p>Recovering a CDB by switching to a copy is faster than traditional restore and recovery.</p>
                     <div class="section">
                        <p>If you have image copies of the inaccessible data files in your CDB or PDB, then you can recover lost changes by using the <code class="codeph">SWITCH</code> command to point the control file at the data file copies.
                        </p>
                        <div class="infoboxnotealso" id="GUID-9A824454-8577-4899-BD69-E631B573021F__GUID-F782D35A-1964-44D6-9D59-666BB05E7A56">
                           <p class="notep1">See Also:</p>
                           <p><span class="q">"<a href="rman-complete-database-recovery.html#GUID-00337B16-4DA6-42C0-B997-DDB4B6CD1075" title="The complete recovery operations described in this chapter are subject to certain conditions.">Scope of This Chapter</a>"</span> for some of the assumptions used in the recovery procedures
                           </p>
                        </div>
                        <p><span class="bold">To switch a data file in a CDB:</span></p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Connect to the root and use the same steps that you would use for a non-CDB as described in <span class="q">"<a href="rman-complete-database-recovery.html#GUID-27F3EB09-3608-4E0E-A7F0-1F0DF1D5C572" title="When one or more data files are damaged, you can perform recovery by switching to existing image copies of the damaged data files.">Performing Recovery After Switching to a Data File Copy</a>"</span>.
                              </p>
                           </li>
                        </ul>
                        <p>To switch a data file in a PDB, use one of the following techniques:</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Connect to the root and use the <code class="codeph">SWITCH ... PLUGGABLE DATABASE</code> or <code class="codeph">SWITCH DATAFILE</code> command. This enables you to switch the data files for one or more PDBs.
                              </p>
                           </li>
                           <li>
                              <p>Connect to the PDB and use the <code class="codeph">SWITCH DATABASE</code> or <code class="codeph">SWITCH DATAFILE</code> command to switch data files in that PDB.
                              </p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-9A824454-8577-4899-BD69-E631B573021F__GUID-E0C04B57-7431-4B20-96C6-E2CD46FD7675">
                           <p class="notep1">See Also:</p>
                           <p><a href="starting-interacting-with-rman-client.html#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD" title="You can connect the RMAN client to multitenant container databases (CDBs) and pluggable databases (PDBs).">Making RMAN Connections to a CDB</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-B852BD56-E872-4173-9EE9-96D1273B2CCF" name="GUID-B852BD56-E872-4173-9EE9-96D1273B2CCF"></a><h3 id="BRADV-GUID-B852BD56-E872-4173-9EE9-96D1273B2CCF" class="sect3"><span class="enumeration_section">17.5 </span>Performing Complete Recovery of Application Containers
               </h3>
               <div>
                  <p>RMAN enables you to use the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands to perform complete recovery of the application containers without impacting the other containers in the CDB.
                  </p>
                  <p></p>
                  <div class="infoboxnotealso" id="GUID-B852BD56-E872-4173-9EE9-96D1273B2CCF__GUID-A1EEC59F-9742-4E62-A087-0A755C9E5E00">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="rman-complete-database-recovery.html#GUID-EB61F66E-9BC1-4CA5-B92B-9A955871ED68" title="Use the RESTORE and RECOVER commands to perform complete recovery of the application root.">Performing Complete Recovery of the Application Root</a></p>
                        </li>
                        <li>
                           <p><a href="rman-complete-database-recovery.html#GUID-85F841AA-89AC-458C-ABEE-3E831D242291" title="You can perform complete recovery of an application container, which includes the application root and all its application PDBs without impacting the other PDBs within the CDB.">Performing Complete Recovery of the Application Root and Application PDBs</a></p>
                        </li>
                        <li>
                           <p><a href="rman-complete-database-recovery.html#GUID-535D529F-9F34-4FF6-A8F3-D7A0F893C5F9" title="Use the RESTORE and RECOVER commands to perform complete recovery of one or more application PDBs.">Performing Complete Recovery of Application PDBs</a></p>
                        </li>
                     </ul>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-EB61F66E-9BC1-4CA5-B92B-9A955871ED68" name="GUID-EB61F66E-9BC1-4CA5-B92B-9A955871ED68"></a><h4 id="BRADV-GUID-EB61F66E-9BC1-4CA5-B92B-9A955871ED68" class="sect4"><span class="enumeration_section">17.5.1 </span>Performing Complete Recovery of the Application Root
                  </h4>
                  <div>
                     <p>Use the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands to perform complete recovery of the application root.
                     </p>
                     <div class="p">The <code class="codeph">COMPATIBLE</code> parameter for the CDB must be set to 19.0 or higher.
                     </div>
                     <!-- class="section" -->
                     <div class="p">
                        <p></p>
                        <p><span class="bold">To recover the application root when connected to the root in a CDB</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Perform one of the following steps:</span><div>
                              <ul style="list-style-type: disc;" id="GUID-EB61F66E-9BC1-4CA5-B92B-9A955871ED68__UL_LJF_CNJ_CGB">
                                 <li>
                                    <p>Start RMAN and connect to the <a href="glossary.html#GUID-CC9EB948-16BC-4AB6-A05E-08EEAFCDD05F"><span class="xrefglossterm">application root</span></a> as an application common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege.
                                    </p>
                                    <p>The application root has its own service name and you can connect to the application root in the same way that you connect to a PDB.</p>
                                 </li>
                                 <li>
                                    <p>Start RMAN and connect to the CDB root as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege.
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Close the application container whose application root needs to be recovered. </span><div>
                              <p>When connected to the application root or CDB, use the following command to close the application container whose application root is called <code class="codeph">hr_appcont</code>:
                              </p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE hr_appcont CLOSE;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>(Optional) Use the <code class="codeph">CONFIGURE</code> command to configure the default device type and automatic channels.</span></li>
                        <li class="stepexpand"><span>Restore and recover the application root.</span><div>
                              <p>The following commands restore and recover an application root named hr_appcont:</p><pre class="pre codeblock"><code>RESTORE APPLICATION ROOT DATABASE hr_appcont;
RECOVER APPLICATION ROOT DATABASE hr_appcont;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Examine the output to see if media recovery was successful. If so, proceed to the next step.</span></li>
                        <li class="stepexpand"><span>Open the application root.</span><div>
                              <p>When connected to the application root, use the following command:</p><pre class="pre codeblock"><code>ALTER DATABASE OPEN;</code></pre><p>When connected to the CDB, use the following command:</p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE hr_appcont OPEN;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-EB61F66E-9BC1-4CA5-B92B-9A955871ED68__GUID-60D8189C-D2E5-4A39-A9D6-EE123C3E5B83">
                           <p class="notep1">See Also:</p>
                           <p><a href="starting-interacting-with-rman-client.html#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD" title="You can connect the RMAN client to multitenant container databases (CDBs) and pluggable databases (PDBs).">Making RMAN Connections to a CDB</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-85F841AA-89AC-458C-ABEE-3E831D242291" name="GUID-85F841AA-89AC-458C-ABEE-3E831D242291"></a><h4 id="BRADV-GUID-85F841AA-89AC-458C-ABEE-3E831D242291" class="sect4"><span class="enumeration_section">17.5.2 </span>Performing Complete Recovery of the Application Root and Application PDBs
                  </h4>
                  <div>
                     <p>You can perform complete recovery of an application container, which includes the application root and all its application PDBs without impacting the other PDBs within the CDB.</p>
                     <div class="p">
                        <p></p>
                     </div>
                     <!-- class="section" -->
                     <div class="p">The <code class="codeph">COMPATIBLE</code> parameter for the CDB must be set to 12.2 or higher.
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><span class="bold">To perform complete recovery of the application root and all its application PDBs:</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Start RMAN and connect to the <a href="glossary.html#GUID-CC9EB948-16BC-4AB6-A05E-08EEAFCDD05F"><span class="xrefglossterm">application root</span></a> as an application common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege.</span><div>The application root has its own service name and you can connect to the application root in the same way that you connect to a PDB.</div>
                        </li>
                        <li class="stepexpand"><span>Close the application container. </span><div>
                              <p>The following command closes the application container whose application root is called <code class="codeph">hr_appcont</code>:
                              </p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE hr_appcont CLOSE;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>(Optional) Use the <code class="codeph">CONFIGURE</code> command to configure the default device type and automatic channels.</span></li>
                        <li class="stepexpand"><span>Restore and recover the application container (application root and all application PDBs) using the following commands.</span><div><pre class="pre codeblock"><code>RESTORE DATABASE;
RECOVER DATABASE;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Examine the output to see if media recovery was successful. If so, proceed to the next step.</span></li>
                        <li class="stepexpand"><span>Open the application root and all the application PDBs.</span><div><pre class="pre codeblock"><code>ALTER DATABASE OPEN;
ALTER PLUGGABLE DATABASE ALL OPEN;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-85F841AA-89AC-458C-ABEE-3E831D242291__GUID-8ED0F447-B225-4905-872E-6292BAB4C4BB">
                           <p class="notep1">See Also:</p>
                           <p><a href="starting-interacting-with-rman-client.html#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD" title="You can connect the RMAN client to multitenant container databases (CDBs) and pluggable databases (PDBs).">Making RMAN Connections to a CDB</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-535D529F-9F34-4FF6-A8F3-D7A0F893C5F9" name="GUID-535D529F-9F34-4FF6-A8F3-D7A0F893C5F9"></a><h4 id="BRADV-GUID-535D529F-9F34-4FF6-A8F3-D7A0F893C5F9" class="sect4"><span class="enumeration_section">17.5.3 </span>Performing Complete Recovery of Application PDBs
                  </h4>
                  <div>
                     <p>Use the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands to perform complete recovery of one or more application PDBs.
                     </p>
                     <div class="p">
                        <p></p>
                     </div>
                     <!-- class="section" -->
                     <div class="p">The <code class="codeph">COMPATIBLE</code> parameter for the CDB must be set to 12.2 or higher.
                     </div>
                     <!-- class="section" -->
                     <div class="section"><span class="bold">To perform complete recovery of an application PDB:</span></div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Start RMAN and establish one of the following types of connections:</span><div>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>Connect to the <a href="glossary.html#GUID-CC9EB948-16BC-4AB6-A05E-08EEAFCDD05F"><span class="xrefglossterm">application root</span></a> as an application common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege.
                                    </p>
                                    <p>The application root has its own service name and you can connect to the application root in the same way that you connect to a PDB.</p>
                                 </li>
                                 <li>
                                    <p>Connect to the CDB root as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege.
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Close the <a href="glossary.html#GUID-6E2F65AE-C36C-446D-84D7-4F709C7DEBCE"><span class="xrefglossterm">application PDB</span></a> for which complete recovery is required.</span><div>
                              <p>The following command closes the application PDB called <code class="codeph">hr_appcont_pdb1</code>:
                              </p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE hr_appcont_pdb1 CLOSE;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>(Optional) Use the <code class="codeph">CONFIGURE</code> command to configure the default device type and automatic channels.</span></li>
                        <li class="stepexpand"><span>Restore and recover the application PDB.</span><div>
                              <p>The following commands perform complete recovery of an application PDB called <code class="codeph">hr_appcont_pdb1</code></p><pre class="pre codeblock"><code>RESTORE PLUGGABLE DATABASE hr_appcont_pdb1;
RECOVER PLUGGABLE DATABASE hr_appcont_pdb1;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Examine the output to see if media recovery was successful. If so, proceed to the next step.</span></li>
                        <li class="stepexpand"><span>Open the application PDB.</span><div>
                              <p>The following commands opens the application PDB called <code class="codeph">hr_appcont_pdb1</code>:
                              </p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE hr_appcont_pdb1 OPEN;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-535D529F-9F34-4FF6-A8F3-D7A0F893C5F9__GUID-1505F605-EFEC-4F60-A3B5-F5670EFB3BF1">
                           <p class="notep1">See Also:</p>
                           <p><a href="starting-interacting-with-rman-client.html#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD" title="You can connect the RMAN client to multitenant container databases (CDBs) and pluggable databases (PDBs).">Making RMAN Connections to a CDB</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-D5AFD861-FCA5-4BE6-913F-6C4B6C96A063" name="GUID-D5AFD861-FCA5-4BE6-913F-6C4B6C96A063"></a><h3 id="BRADV-GUID-D5AFD861-FCA5-4BE6-913F-6C4B6C96A063" class="sect3"><span class="enumeration_section">17.6 </span>Performing Complete Recovery of Sparse Databases with RMAN
               </h3>
               <div>
                  <p>You can recover sparse databases to the most recent point in time using the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands.
                  </p>
                  <div class="p">This section contains the following topics:
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="rman-complete-database-recovery.html#GUID-C8453C47-BA71-4272-B0D4-BC7B97EC2584" title="Performing recovery of a database containing sparse data files is very similar to performing recovery of a whole database.">Performing Complete Recovery of a Sparse Database</a></p>
                        </li>
                        <li>
                           <p><a href="rman-complete-database-recovery.html#GUID-9E0A0ABF-4DC9-4DF6-9015-004868ACB01C" title="Performing recovery of a sparse CDB is very similar to performing the complete recovery of a sparse database.">Performing Complete Recovery of a Sparse CDB</a></p>
                        </li>
                        <li>
                           <p><a href="rman-complete-database-recovery.html#GUID-C7DF025E-B8DF-4686-876D-AAE28E7869CF" title="You can recover a sparse PDB while you are connected at the root level or at the CDB level.">Performing Recovery of a Sparse PDB with RMAN</a></p>
                        </li>
                     </ul>
                  </div>
                  <div class="infoboxnote" id="GUID-D5AFD861-FCA5-4BE6-913F-6C4B6C96A063__GUID-7B4D23C3-30E0-4AB5-89A0-0911690858E6">
                     <p class="notep1">Note:</p>
                     <p>The base (read-only) data files in a sparse database are not encrypted. Ensure that the base data files are stored in a protected storage and accessed using secured communications.</p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-C8453C47-BA71-4272-B0D4-BC7B97EC2584" name="GUID-C8453C47-BA71-4272-B0D4-BC7B97EC2584"></a><h4 id="BRADV-GUID-C8453C47-BA71-4272-B0D4-BC7B97EC2584" class="sect4"><span class="enumeration_section">17.6.1 </span>Performing Complete Recovery of a Sparse Database
                  </h4>
                  <div>
                     <p>Performing recovery of a database containing sparse data files is very similar to performing recovery of a whole database.</p>
                     <div class="section">RMAN first restores the logical data that was backed up from the delta storage space of the database and then recovers the database by reading from the redo log and applying the logical data file blocks. You can perform either complete recovery or point-in-time recovery of a sparse database, tablespace, or data file. </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><span class="bold">To recover a sparse database:</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Complete the preparation steps required for your recovery scenario, as described in <span class="q">"<a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="You must plan your database restore and recovery strategy based on your recovery goal and which database files have been lost.">Preparing for Complete Database Recovery</a>"</span>.</span></li>
                        <li class="stepexpand"><span>Start RMAN and connect to a target database, as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>.</span></li>
                        <li class="stepexpand"><span>If the database is not mounted, then mount but do not open the database.</span><div>
                              <p>For example, enter the following command:</p><pre class="oac_no_warn" dir="ltr">STARTUP MOUNT;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Use the <code class="codeph">SHOW</code> command to see which channels are preconfigured.</span><div>
                              <p>If the necessary devices and channels are configured, then no action is necessary. Otherwise, you can use the <code class="codeph">CONFIGURE</code> command to configure automatic channels, or include <code class="codeph">ALLOCATE CHANNEL</code> commands within a <code class="codeph">RUN</code> block.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Restore and recover the sparse database. The following commands perform complete recovery of a sparse database:</span><div><pre class="pre codeblock"><code>RESTORE FROM SPARSE DATABASE;
RECOVER DATABASE;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>To recover a specific tablespace containing sparse data files, use the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands for the tablespace.</span><div>The following example restores and recovers the tablespace <code class="codeph">MY_TBS</code><pre class="pre codeblock"><code>RESTORE FROM SPARSE TABLESPACE MY_TBS;
RECOVER TABLESPACE MY_TBS;</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-9E0A0ABF-4DC9-4DF6-9015-004868ACB01C" name="GUID-9E0A0ABF-4DC9-4DF6-9015-004868ACB01C"></a><h4 id="BRADV-GUID-9E0A0ABF-4DC9-4DF6-9015-004868ACB01C" class="sect4"><span class="enumeration_section">17.6.2 </span>Performing Complete Recovery of a Sparse CDB
                  </h4>
                  <div>
                     <p>Performing recovery of a sparse CDB is very similar to performing the complete recovery of a sparse database. </p>
                     <div class="section">
                        <p><span class="bold">To recover a sparse CDB:</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Complete the preparation steps required for your scenario, as described in <span class="q">"<a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="You must plan your database restore and recovery strategy based on your recovery goal and which database files have been lost.">Preparing for Complete Database Recovery</a>"</span>.</span></li>
                        <li class="stepexpand"><span>Start RMAN and connect to the root as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege, as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>.</span></li>
                        <li class="stepexpand"><span>If the CDB is not mounted, then mount but do not open the CDB.</span><div>
                              <p>For example, enter the following command:</p><pre class="oac_no_warn" dir="ltr">STARTUP MOUNT;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Use the <code class="codeph">SHOW</code> command to see which channels are preconfigured.</span><div>
                              <p>If the necessary devices and channels are configured, then no action is necessary. Otherwise, you can use the <code class="codeph">CONFIGURE</code> command to configure automatic channels, or include <code class="codeph">ALLOCATE CHANNEL</code> commands within a <code class="codeph">RUN</code> block.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Restore and recover the sparse CDB. The following commands perform complete recovery of a sparse CDB:</span><div><pre class="pre codeblock"><code>RESTORE FROM SPARSE DATABASE;
RECOVER DATABASE;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>To recover a specific tablespace containing sparse data files, use the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands for the tablespace.</span><div>The following example restores and recovers the tablespace <code class="codeph">MY_TBS</code><pre class="pre codeblock"><code>RESTORE FROM SPARSE TABLESPACE MY_TBS;
RECOVER TABLESPACE MY_TBS;</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-C7DF025E-B8DF-4686-876D-AAE28E7869CF" name="GUID-C7DF025E-B8DF-4686-876D-AAE28E7869CF"></a><h4 id="BRADV-GUID-C7DF025E-B8DF-4686-876D-AAE28E7869CF" class="sect4"><span class="enumeration_section">17.6.3 </span>Performing Recovery of a Sparse PDB with RMAN
                  </h4>
                  <div>
                     <p>You can recover a sparse PDB while you are connected at the root level or at the CDB level. </p>
                     <div class="section"></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><span class="bold">To recover one or more sparse PDBs while connected to the root:</span></p>
                        <ol>
                           <li>
                              <p>Complete the preparation steps required for your recovery scenario, as described in <span class="q">"<a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="You must plan your database restore and recovery strategy based on your recovery goal and which database files have been lost.">Preparing for Complete Database Recovery</a>"</span>.
                              </p>
                           </li>
                           <li>
                              <p>Start RMAN and connect to the root as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege, as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD" title="You can connect the RMAN client to multitenant container databases (CDBs) and pluggable databases (PDBs).">Making RMAN Connections to a CDB</a>"</span>.
                              </p>
                           </li>
                           <li>
                              <p>Close the PDBs that you want to recover.</p><pre class="oac_no_warn" dir="ltr"> ALTER PLUGGABLE DATABASE sales, hr CLOSE;
</pre><p>If any data files are missing, an error occurs and you cannot close a PDB. You must then connect to the PDB to which the missing data file belongs, take the missing data file offline, and then close the PDB.</p>
                              <p>The following command takes the data file 12 offline:</p><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE DATAFILE 12 OFFLINE;
</pre><div class="infoboxnote" id="GUID-C7DF025E-B8DF-4686-876D-AAE28E7869CF__GUID-BC3A98D5-DE8A-41FC-8558-750A70A8A5F1">
                                 <p class="notep1">Note:</p>
                                 <p>If the data files that store the <code class="codeph">SYSTEM</code> tablespace of a PDB are missing, then follow the recovery steps described in <span class="q">"<a href="rman-complete-database-recovery.html#GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934" title="Because tablespaces in different PDBs can have the same name, to eliminate ambiguity, you must connect directly to a PDB to recover one or more of its tablespaces. In contrast, because data file numbers and paths are unique across the CDB, you can connect either to the root or to a PDB when recovering PDB data files.">Performing Complete Recovery of Tablespaces or Data Files in a PDB with RMAN</a>"</span>.
                                 </p>
                              </div>
                           </li>
                           <li>
                              <p>(Optional) Use the <code class="codeph">CONFIGURE</code> command to configure the default device type and automatic channels.
                              </p>
                           </li>
                           <li>
                              <p>Run the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands for the pluggable database.
                              </p>
                              <div class="p">The following example performs complete recovery of the PDB <code class="codeph">HR_PDB</code> when connected to the root:<pre class="pre codeblock"><code>RESTORE FROM SPARSE PLUGGABLE DATABASE HR_PDB;
RECOVER PLUGGABLE DATABASE HR_PDB;</code></pre></div>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-C7DF025E-B8DF-4686-876D-AAE28E7869CF__GUID-C59DB10A-2FFE-4EF4-9AC8-D6185AA36E60">To connect to and recover one sparse PDB:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Complete the preparation steps required for your recovery scenario, as described in <span class="q">"<a href="rman-complete-database-recovery.html#GUID-B61F3262-0896-430A-B87C-D97BDEEB1BD7" title="You must plan your database restore and recovery strategy based on your recovery goal and which database files have been lost.">Preparing for Complete Database Recovery</a>"</span>.</span></li>
                        <li class="stepexpand"><span>Start RMAN and connect to the PDB as a <a href="glossary.html#GUID-43EA1A4C-E5EB-4926-99EC-1DDA0E74A07C"><span class="xrefglossterm">local user</span></a> with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> system privilege, as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD" title="You can connect the RMAN client to multitenant container databases (CDBs) and pluggable databases (PDBs).">Making RMAN Connections to a CDB</a>"</span>.</span></li>
                        <li class="stepexpand"><span>Close the PDB.</span><div><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE CLOSE;
</pre><p>If any data files are missing, an error occurs and you cannot close the PDB. You must take the missing data file offline and then close the PDB.</p>
                              <p>The following command takes the data file 12 offline:</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE DATAFILE 12 OFFLINE;
</pre><div class="infoboxnote" id="GUID-C7DF025E-B8DF-4686-876D-AAE28E7869CF__GUID-4AAF369F-0C9E-4319-BD15-A6BB51DDB0EC">
                                 <p class="notep1">Note:</p>
                                 <p>If the data files that store the <code class="codeph">SYSTEM</code> tablespace of a PDB are missing, then follow the recovery steps described in <span class="q">"<a href="rman-complete-database-recovery.html#GUID-E23BD16E-71D5-48BE-8E66-C31E7FA84934" title="Because tablespaces in different PDBs can have the same name, to eliminate ambiguity, you must connect directly to a PDB to recover one or more of its tablespaces. In contrast, because data file numbers and paths are unique across the CDB, you can connect either to the root or to a PDB when recovering PDB data files.">Performing Complete Recovery of Tablespaces or Data Files in a PDB with RMAN</a>"</span>.
                                 </p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>(Optional) Use the <code class="codeph">CONFIGURE</code> command to configure the default device type and automatic channels.</span></li>
                        <li class="stepexpand"><span>Issue the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands.</span><div>The following example restores and recovers the PDB <code class="codeph">USERS_PDB</code><pre class="pre codeblock"><code>RESTORE FROM SPARSE DATABASE FROM USERS_PDB;
RECOVER DATABASE USERS_PDB;</code></pre>.</div>
                        </li>
                     </ol>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>