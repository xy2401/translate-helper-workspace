<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 5. Database servers on Red Hat Enterprise Linux 8</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="using-databases"/>Chapter 5. Database servers on Red Hat Enterprise Linux 8</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="introduction-to-databases_using-databases"/>Introduction to databases and database servers</h1></div></div></div><p>
				Databases are organized collections of data. The data in databases are stored and can be accessed electronically.
			</p><p>
				The organization of data in a database is typically designed to support:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						Modelling of various aspects of reality
					</li><li class="listitem">
						Querying and filtering data according to their attributes
					</li></ul></div><p>
				Red Hat Enterprise Linux 8 provides the following database servers:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						MariaDB 10.3
					</li><li class="listitem">
						MySQL 8.0
					</li><li class="listitem">
						PostgeSQL 10
					</li><li class="listitem">
						PostgreSQL 9.6
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="using-mariadb"/>Using MariaDB on Red Hat Enterprise Linux 8</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="introduction-to-mariadb_using-mariadb"/>Getting started with MariaDB on Red Hat Enterprise Linux 8</h2></div></div></div><p>
					The <span class="strong"><strong>MariaDB</strong></span> server is an open source fast and robust database server that is based on MySQL technology.
				</p><p>
					<span class="strong"><strong>MariaDB</strong></span> is a relational database which converts data into structured information and provides an SQL interface for accessing data. It includes multiple storage engines and plug-ins, as well as geographic information system (GIS) and JavaScript Object Notation (JSON) features.
				</p><p>
					This section describes how to install the <span class="strong"><strong>MariaDB</strong></span> server in <a class="link" href="using-databases.html#installing-mariadb_using-mariadb" title="Installing MariaDB">Installing MariaDB</a> or how to migrate from the Red Hat Enterprise Linux 7 default version, <span class="strong"><strong>MariaDB 5.5</strong></span>, to the Red Hat Enterprise Linux 8 default version, <span class="strong"><strong>MariaDB 10.3</strong></span>, in <a class="link" href="using-databases.html#migrating-to-mariadb_10_3_using-mariadb" title="Migrating to MariaDB 10.3">Migrating to MariaDB 10.3</a>. One of the prerequisites of migration is performing data backup, which is described in <a class="link" href="using-databases.html#backuping-mariadb_using-mariadb" title="Backing up MariaDB data">Backing up MariaDB data</a>.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="installing-mariadb_using-mariadb"/>Installing MariaDB</h2></div></div></div><p>
					To install <span class="strong"><strong>MariaDB</strong></span>, follow this procedure:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Ensure that the <code class="literal">mariadb</code> and <code class="literal">mariadb-server</code> packages, available in the AppStream repository, are installed on the required server:
						</p><pre class="literallayout">~]# yum install mariadb mariadb-server</pre></li><li class="listitem"><p class="simpara">
							Start the <code class="literal">mariadb</code> service:
						</p><pre class="literallayout">~]# systemctl start mariadb.service</pre></li><li class="listitem"><p class="simpara">
							Enable the <code class="literal">mariadb</code> service to start at boot:
						</p><pre class="literallayout">~]# systemctl enable mariadb.service</pre></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						Note that the <span class="strong"><strong>MariaDB</strong></span> and <span class="strong"><strong>MySQL</strong></span> database servers cannot be installed in parallel in Red Hat Enterprise Linux 8.0 due to conflicting RPM packages. Parallel installation of components is possible in Red Hat Software Collections for Red Hat Enterprise Linux 6 and Red Hat Enterprise Linux 7. In Red Hat Enterprise Linux 8, different versions of database servers can be used in containers.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sect-mariadb-secure-configurations"/>Improving MariaDB installation security</h3></div></div></div><p>
						You can improve security when installing <span class="strong"><strong>MariaDB</strong></span> by running the <code class="literal">mysql_secure_installation</code> command:
					</p><pre class="literallayout">~]# mysql_secure_installation</pre><p>
						This command launches a fully interactive script, which prompts for each step in the process.
					</p><p>
						The script enables to improve security in the following ways:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								Setting a password for root accounts
							</li><li class="listitem">
								Removing anonymous users
							</li><li class="listitem">
								Disallowing remote (outside the local host) root logins
							</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-mariadb_using-mariadb"/>Configuring MariaDB</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="configuring_the_mariadb_server_for_networking"/>Configuring the MariaDB server for networking</h3></div></div></div><p>
						To configure the <span class="strong"><strong>MariaDB</strong></span> server for networking, use the <code class="literal">[mysqld]</code> section of the <code class="literal">/etc/my.cnf.d/mariadb-server.cnf</code> file, where you can set the following configuration directives:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
								<code class="literal">bind-address</code>
							</p><p class="simpara">
								Bind-address is the address on which the server will listen.
							</p><p class="simpara">
								Possible options are: a host name, an IPv4 address, or an IPv6 address.
							</p></li><li class="listitem"><p class="simpara">
								<code class="literal">skip-networking</code> +fna Possible values are:
							</p><p class="simpara">
								0 - to listen for all clients
							</p><p class="simpara">
								1 - to listen for local clients only
							</p></li><li class="listitem"><p class="simpara">
								<code class="literal">port</code>
							</p><p class="simpara">
								The port on which <span class="strong"><strong>MariaDB</strong></span> listens for TCP/IP connections.
							</p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="backuping-mariadb_using-mariadb"/>Backing up MariaDB data</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="backup-types_using-mariadb"/>Types of MariaDB backup</h3></div></div></div><p>
						There are two main ways to back up data from a MariaDB database:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								Logical backup
							</li><li class="listitem">
								Physical backup
							</li></ul></div><p>
						<span class="strong"><strong>Logical backup</strong></span> consists of the SQL statements necessary to restore the data. This type of backup exports information and records in plain text files.
					</p><p>
						The main advantage of logical backup over physical backup is portability and flexibility. The data can be restored on other hardware configurations, MariaDB versions or Database Management System (DBMS), which is not possible with physical backups.
					</p><p>
						Note that logical backup can be performed if the <code class="literal">mariadb.service</code> is running. Logical backup does not include log and configuration files.
					</p><p>
						<span class="strong"><strong>Physical backup</strong></span> consists of copies of files and directories that store the content.
					</p><p>
						Physical backup has the following advantages compared to logical backup:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								Output is more compact.
							</li><li class="listitem">
								Backup is smaller in size.
							</li><li class="listitem">
								Backup and restore are faster.
							</li><li class="listitem">
								Backup includes log and configuration files.
							</li></ul></div><p>
						Note that physical backup must be performed when the <code class="literal">mariadb.service</code> is not running or all tables in the database are locked to prevent changes during the backup.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="mariadb_backup_methods"/>MariaDB backup methods</h3></div></div></div><p>
						You can use one of the following approaches to back up data from a <span class="strong"><strong>MariaDB</strong></span> database:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="xref" href="using-databases.html#backuping-mariadb_logical_backup" title="Logical backup with mysqldump">the section called “Logical backup with mysqldump”</a>
							</li><li class="listitem">
								<a class="xref" href="using-databases.html#backuping-mariadb_physical_backup" title="Physical online backup using the Mariabackup tool">the section called “Physical online backup using the Mariabackup tool”</a>
							</li><li class="listitem">
								<a class="xref" href="using-databases.html#backuping-mariadb_filesystem_backup" title="File system backup">the section called “File system backup”</a>
							</li><li class="listitem">
								<a class="xref" href="using-databases.html#backuping-mariadb_replication" title="Replication as a backup solution">the section called “Replication as a backup solution”</a>
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="backuping-mariadb_logical_backup"/>Logical backup with mysqldump</h3></div></div></div><p>
						The <span class="strong"><strong><span class="application">mysqldump</span></strong></span> client is a backup utility, which can can be used to dump a database or a collection of databases for the purpose of a backup or transfer to another database server. The output of <span class="strong"><strong><span class="application">mysqldump</span></strong></span> typically consists of SQL statements, which enable to create a table, populate a table, or create a table and populate it. Alternatively, <span class="strong"><strong><span class="application">mysqldump</span></strong></span> can also generate files in other formats, including CSV or other delimited text formats, and XML.
					</p><p>
						For more information on logical backup with <span class="strong"><strong><span class="application">mysqldump</span></strong></span>, see the <a class="link" href="https://mariadb.com/kb/en/library/mysqldump/">MariaDB Documentation</a>.
					</p><p>
						To perform the <span class="strong"><strong><span class="application">mysqldump</span></strong></span> backup, you can use one of the following options:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								Back up a selected database
							</li><li class="listitem">
								Back up a subset of tables from one database
							</li><li class="listitem">
								Back up multiple databases
							</li><li class="listitem">
								Back up all databases
							</li></ul></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="frequently_used_commands_in_mysqldump_backups"/>Frequently used commands in mysqldump backups</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
									To back up an entire database, run:
								</p><pre class="literallayout">~]# mysqldump [options] db_name &gt; backup-file.sql</pre></li><li class="listitem"><p class="simpara">
									To back up a subset of tables from one database, add a list of the chosen tables at the end of the command:
								</p><pre class="literallayout">~]# mysqldump [options] db_name [tbl_name …​]</pre></li><li class="listitem"><p class="simpara">
									To load the dump file back into a server, run:
								</p><pre class="literallayout">~]# mysql db_name &lt; backup-file.sql</pre><p class="simpara">
									or
								</p><pre class="literallayout">~]# mysql -e "source /path-to-backup/backup-file.sql" db_name</pre></li><li class="listitem"><p class="simpara">
									To populate databases by copying data from one <span class="strong"><strong>MariaDB</strong></span> server to another, run:
								</p><pre class="literallayout">~]# mysqldump --opt db_name | mysql --host=remote_host -C db_name</pre></li><li class="listitem"><p class="simpara">
									To dump multiple databases at once, run:
								</p><pre class="literallayout">~]# mysqldump [options] --databases db_name1 [db_name2 …​] &gt; my_databases.sql</pre></li><li class="listitem"><p class="simpara">
									To dump all databases, run:
								</p><pre class="literallayout">~]# mysqldump [options]--all-databases &gt; all_databases.sql</pre></li><li class="listitem"><p class="simpara">
									To see a list of the options that mysqldump supports, run:
								</p><pre class="literallayout">~]$ mysqldump --help</pre></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="backuping-mariadb_physical_backup"/>Physical online backup using the Mariabackup tool</h3></div></div></div><p>
						<span class="strong"><strong><span class="application">Mariabackup</span></strong></span> is a tool based on the Percona XtraBackup technology, which enables performing physical online backups of InnoDB, Aria, and MyISAM tables.
					</p><p>
						<span class="strong"><strong><span class="application">Mariabackup</span></strong></span>, provided by the <code class="literal">mariadb-backup</code> package from the AppStream repository, supports full backup capability for <span class="strong"><strong>MariaDB</strong></span> server, which includes encrypted and compressed data.
					</p><p>
						To install <span class="strong"><strong><span class="application">Mariabackup</span></strong></span>, run the following command as <code class="literal">root</code>:
					</p><pre class="literallayout">~]# yum install mariadb-backup</pre><p>
						To configure <span class="strong"><strong><span class="application">Mariabackup</span></strong></span>, set the user name and password by adding the following lines into the <code class="literal">[xtrabackup]</code> or <code class="literal">[mysqld]</code> section of the <code class="literal">*.cnf</code> configuration file that you need to create (for example, <code class="literal">/etc/my.cnf.d/mariabackup.cnf</code>):
					</p><pre class="literallayout">[xtrabackup]
user=myuser
password=mypassword</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							<span class="strong"><strong><span class="application">Mariabackup</span></strong></span> does not read options in the <code class="literal">[mariadb]</code> section of configuration files. If a non-default data directory is specified on a <span class="strong"><strong>MariaDB</strong></span> server, you must specify this directory in the <code class="literal">[xtrabackup]</code> or <code class="literal">[mysqld]</code> sections of configuration files, so that <span class="strong"><strong><span class="application">Mariabackup</span></strong></span> is able to find the data directory.
						</p><p>
							To specify such a data directory, include the following line in the <code class="literal">[xtrabackup]</code> or <code class="literal">[mysqld]</code> sections of <span class="strong"><strong>MariaDB</strong></span> configuration files:
						</p><pre class="literallayout">datadir=/var/mycustomdatadir</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							Users of <span class="strong"><strong><span class="application">Mariabackup</span></strong></span> must have the <code class="literal">RELOAD</code>, <code class="literal">LOCK TABLES</code>, and <code class="literal">REPLICATION CLIENT</code> privileges to be able to work with the backup.
						</p></div><p>
						To create a backup of a database using <span class="strong"><strong><span class="application">Mariabackup</span></strong></span>, run the following command:
					</p><pre class="literallayout">~]$ mariabackup --backup --target-dir &lt;backup_directory&gt; --user &lt;backup_user&gt; --password &lt;backup_passwd&gt;</pre><p>
						The <code class="literal">target-dir</code> option defines the directory where the backup files will be stored.
					</p><p>
						Note that if you want to perform a full backup, the target directory must be empty or not exist.
					</p><p>
						For more information on performing backups with <span class="strong"><strong><span class="application">Mariabackup</span></strong></span>, see <a class="link" href="https://mariadb.com/kb/en/library/full-backup-and-restore-with-mariadb-backup/">Full Backup and Restore with Mariabackup</a>.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="backuping-mariadb_filesystem_backup"/>File system backup</h3></div></div></div><p>
						To perform a file system backup, copy the data files to another location. Make sure that the <code class="literal">mariadb</code> service is not running when copying the data files.
					</p><p>
						To create a file system backup of <span class="strong"><strong>MariaDB</strong></span> data files, change to the <code class="literal">root</code> user, and use the following procedure:
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Stop the <code class="literal">mariadb</code> service:
							</p><pre class="literallayout">~]# systemctl stop mariadb.service</pre></li><li class="listitem"><p class="simpara">
								Copy the data files to the required location:
							</p><pre class="literallayout">~]# cp -r /var/lib/mysql /backup-location</pre></li><li class="listitem"><p class="simpara">
								Start the <code class="literal">mariadb</code> service:
							</p><pre class="literallayout">~]# systemctl start mariadb.service</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="backuping-mariadb_replication"/>Replication as a backup solution</h3></div></div></div><p>
						Replication is an alternative backup solution for master servers. If a master server replicates to a slave server, backups can be run on the slave without any impact on the master.
					</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
							Replication is not a sufficient backup solution. Replication protects master servers against hardware failures, but it does not ensure protection against data loss.
						</p></div><p>
						For more information on replication as a backup solution, see <a class="link" href="https://mariadb.com/kb/en/library/replication-as-a-backup-solution/">MariaDB Documentation</a>.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="migrating-to-mariadb_10_3_using-mariadb"/>Migrating to MariaDB 10.3</h2></div></div></div><p>
					Red Hat Enterprise Linux 7 contains <span class="strong"><strong>MariaDB 5.5</strong></span> as the default implementation of a server from the MySQL databases family. Later versions of the <span class="strong"><strong>MariaDB</strong></span> database server are available as Software Collections for Red Hat Enterprise Linux 6 and Red Hat Enterprise Linux 7. Red Hat Enterprise Linux 8 provides <span class="strong"><strong>MariaDB 10.3</strong></span> and <span class="strong"><strong>MySQL 8.0</strong></span>.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="notable-differences-in-mariadb-rhel7-rhel8"/>Notable differences between the RHEL 7 and RHEL 8 versions of MariaDB</h3></div></div></div><p>
						The most important changes between <span class="strong"><strong>MariaDB 5.5</strong></span> and <span class="strong"><strong>MariaDB</strong></span> 10.3 are as follows:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<span class="strong"><strong>MariaDB</strong></span> Galera Cluster, a synchronous multi-master cluster, is a standard part of <span class="strong"><strong>MariaDB</strong></span> since 10.1.
							</li><li class="listitem">
								The ARCHIVE storage engine is no longer enabled by default, and the plug-in needs to be specifically enabled.
							</li><li class="listitem">
								The BLACKHOLE storage engine is no longer enabled by default, and the plug-in needs to be specifically enabled.
							</li><li class="listitem"><p class="simpara">
								InnoDB is used as the default storage engine instead of XtraDB, which was used in <span class="strong"><strong>MariaDB 10.1</strong></span> and earlier versions.
							</p><p class="simpara">
								For more details, see <a class="link" href="https://mariadb.com/kb/en/library/why-does-mariadb-102-use-innodb-instead-of-xtradb/">Why does MariaDB 10.2 use InnoDB instead of XtraDB?</a>.
							</p></li><li class="listitem">
								The new <code class="literal">mariadb-connector-c</code> packages provide a common client library for MySQL and MariaDB. This library is usable with any version of the <span class="strong"><strong>MySQL</strong></span> and <span class="strong"><strong>MariaDB</strong></span> database servers. As a result, the user is able to connect one build of an application to any of the MySQL and <span class="strong"><strong>MariaDB</strong></span> servers distributed with Red Hat Enterprise Linux 8.
							</li></ul></div><p>
						To migrate from <span class="strong"><strong>MariaDB 5.5</strong></span> to <span class="strong"><strong>MariaDB 10.3</strong></span>, you need to perform multiple configuration changes as described in <a class="xref" href="using-databases.html#migrating-to-mariadb_10_3_conf_changes" title="Configuration changes">the section called “Configuration changes”</a>.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="migrating-to-mariadb_10_3_conf_changes"/>Configuration changes</h3></div></div></div><p>
						The recommended migration path from <span class="strong"><strong>MariaDB 5.5</strong></span> to <span class="strong"><strong>MariaDB 10.3</strong></span> is to upgrade to <span class="strong"><strong>MariaDB 10.0</strong></span> first, and then upgrade by one version successively.
					</p><p>
						For more information about configuration changes when migrating from <span class="strong"><strong>MariaDB 5.5</strong></span> to <span class="strong"><strong>MariaDB 10.0</strong></span>, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_software_collections/2/html-single/2.0_release_notes/#sect-Migration-MariaDB/">Migrating to MariaDB 10.0</a> in Red Hat Software Collections documentation.
					</p><p>
						The migration to following successive versions of <span class="strong"><strong>MariaDB</strong></span> and the required configuration changes is described in these documents:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_software_collections/2/html-single/2.2_release_notes/#sect-Migration-MariaDB">Migrating to MariaDB 10.1</a> in Red Hat Software Collections documentation.
							</li><li class="listitem">
								<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_software_collections/3/html-single/3.0_release_notes/#sect-Migration-MariaDB">Migrating to MariaDB 10.2</a> in Red Hat Software Collections documentation.
							</li><li class="listitem">
								<a class="link" href="https://mariadb.com/kb/en/library/upgrading-from-mariadb-102-to-mariadb-103/">Upgrading from MariaDB 10.2 to MariaDB 10.3</a> in upstream documentation.
							</li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							Migration directly from <span class="strong"><strong>MariaDB 5.5</strong></span> to <span class="strong"><strong>MariaDB 10.3</strong></span> is also possible, but you must perform all configuration changes that are required by differences described in the migration documents above.
						</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="mariadb-in-place-upgrade"/>In-place upgrade using the mysql_upgrade tool</h3></div></div></div><p>
						To migrate the database files to Red Hat Enterprise Linux 8, users of <span class="strong"><strong>MariaDB</strong></span> on Red Hat Enterprise Linux 7 need to perform the in-place upgrade using the <code class="literal">mysql_upgrade</code> tool.
					</p><p>
						To perform an in-place upgrade, you need to copy binary data files to the <code class="literal">/var/lib/mysql/</code> data directory on the Red Hat Enterprise Linux 8 system and use the <code class="literal">mysql_upgrade</code> tool.
					</p><p>
						You can use this method for migrating data from:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								The Red Hat Enterprise Linux 7 version of <span class="strong"><strong>MariaDB 5.5</strong></span>
							</li><li class="listitem"><p class="simpara">
								The Red Hat Software Collections versions of:
							</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										<span class="strong"><strong>MariaDB 5.5</strong></span> (no longer supported)
									</li><li class="listitem">
										<span class="strong"><strong>MariaDB 10.0</strong></span> (no longer supported)
									</li><li class="listitem">
										<span class="strong"><strong>MariaDB 10.1</strong></span>
									</li><li class="listitem">
										<span class="strong"><strong>MariaDB 10.2</strong></span>
									</li></ul></div></li></ul></div><p>
						Note that it is recommended to upgrade to <span class="strong"><strong>MariaDB 10.2</strong></span> by one version successively. See the respective Migration chapters in the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_software_collections/3/">Release Notes for Red Hat Software Collections</a>.
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							If you are upgrading from the Red Hat Enterprise Linux 7 version of <span class="strong"><strong>MariaDB</strong></span>, the source data is stored in the <code class="literal">/var/lib/mysql/</code> directory. In case of Red Hat Software Collections versions of <span class="strong"><strong>MariaDB</strong></span>, the source data directory is <code class="literal">/var/opt/rh/&lt;collection_name&gt;/lib/mysql/</code> (with the exception of the <code class="literal">mariadb55</code>, which uses the <code class="literal">/opt/rh/mariadb55/root/var/lib/mysql/</code> data directory).
						</p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							Before performing the upgrade, back up all your data stored in the <span class="strong"><strong>MariaDB</strong></span> databases as described in <a class="xref" href="using-databases.html#backuping-mariadb_using-mariadb" title="Backing up MariaDB data">the section called “Backing up MariaDB data”</a>.
						</p></div><p>
						To perform the in-place upgrade, change to the <code class="literal">root</code> user, and use the following procedure:
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Ensure that the <code class="literal">mariadb-server</code> package is installed on the Red Hat Enterprise Linux 8 system:
							</p><pre class="literallayout">~]# yum install mariadb-server</pre></li><li class="listitem"><p class="simpara">
								Ensure that the mariadb daemon is not running on either of the source and target systems at the time of copying data:
							</p><pre class="literallayout">~]# systemctl stop mariadb.service</pre></li><li class="listitem">
								Copy the data from the source location to the <code class="literal">/var/lib/mysql/</code> directory on the Red Hat Enterprise Linux 8 target system.
							</li><li class="listitem"><p class="simpara">
								Set the appropriate permissions and SELinux context for copied files on the target system:
							</p><pre class="literallayout">~]# restorecon -vr /var/lib/mysql</pre></li><li class="listitem"><p class="simpara">
								Start the <span class="strong"><strong>MariaDB</strong></span> server on the target system:
							</p><pre class="literallayout">~]# systemctl start mariadb.service</pre></li><li class="listitem"><p class="simpara">
								Run the <code class="literal">mysql_upgrade</code> command to check and repair internal tables:
							</p><pre class="literallayout">~]# systemctl mysql_upgrade</pre></li><li class="listitem">
								When the upgrade is complete, make sure that all configuration files within the <code class="literal">/etc/my.cnf.d/</code> directory include only valid options for <span class="strong"><strong>MariaDB 10.3</strong></span>.
							</li></ol></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							There are certain risks and known problems related to in-place upgrade. For example, some queries might not work or they will be run in different order than before the upgrade. For more information on these risks and problems, and for general information about in-place upgrade, see <a class="link" href="https://mariadb.com/kb/en/library/mariadb-1030-release-notes/">MariaDB 10.3 Release Notes</a>.
						</p></div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="using-postgresql"/>Using PostgreSQL on Red Hat Enterprise Linux 8</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="introduction-to-postgresql_using-postgresql"/>Getting started with PostgreSQL on Red Hat Enterprise Linux 8</h2></div></div></div><p>
					The <span class="strong"><strong>PostgreSQL</strong></span> server is an open source robust and highly-extensible database server based on the SQL language. It provides an object-relational database system, which allows to manage extensive datasets and a high number of concurrent users. For these reasons, the PostgreSQL servers can be used in clusters to manage high amounts of data.
				</p><p>
					The <span class="strong"><strong>PostgreSQL</strong></span> server includes features for ensuring data integrity, building fault-tolerant environments or building applications. It allows to extend a database with user’s own data types, custom functions, or code from different programming languages without the need to recompile the database.
				</p><p>
					This section describes how to install <span class="strong"><strong>PostgreSQL</strong></span> in <a class="link" href="using-databases.html#installing-postgresql_using-postgresql" title="Installing PostgreSQL">Installing PostgreSQL</a> or how to migrate from the Red Hat Enterprise Linux 7 default version <span class="strong"><strong>PostgreSQL 9.2</strong></span> to Red Hat Enterprise Linux 8 default version <span class="strong"><strong>PostgreSQL 10.0</strong></span> in <a class="link" href="using-databases.html#migrating-to-postgresql_using-postgresql" title="Migrating to PostgreSQL 10.0">Migrating to PostgreSQL 10.0</a>. One of the prerequisites of migration is performing a data backup.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="installing-postgresql_using-postgresql"/>Installing PostgreSQL</h2></div></div></div><p>
					In RHEL 8, the <span class="strong"><strong>PostgreSQL</strong></span> server is available in two versions: 10 and 9.6, provided by two streams. This section assumes using <span class="strong"><strong>PostgreSQL 10</strong></span> from the default stream. For information about changing streams, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/installing_managing_and_removing_user_space_components/">Installing, managing, and removing user space components</a>.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						By design, it is impossible to install more than one version (stream) of the same module in parallel. For example, you need to choose only one of the available streams from the <code class="literal">postgresql</code> module, either 10 (default) or 9.6. Parallel installation of components is possible in Red Hat Software Collections for Red Hat Enterprise Linux 6 and Red Hat Enterprise Linux 7. In Red Hat Enterprise Linux 8, different versions of database servers can be used in containers.
					</p></div><p>
					To install <span class="strong"><strong>PostgreSQL</strong></span> follow this procedure:
				</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Ensure that the <code class="literal">postgresql-server</code> package, available in the Application Stream repository, is installed on the required server:
						</p><pre class="literallayout">~]# yum install postgresql-server</pre></li><li class="listitem"><p class="simpara">
							Initialize the data directory
						</p><pre class="literallayout">postgresql-setup --initdb</pre></li><li class="listitem"><p class="simpara">
							Start the <code class="literal">postgresql</code> service:
						</p><pre class="literallayout">~]# systemctl start postgresql.service</pre></li><li class="listitem"><p class="simpara">
							Enable the <code class="literal">postgresql</code> service to start at boot:
						</p><pre class="literallayout">~]# systemctl enable postgresql.service</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-postgresql_using-postgresql"/>Configuring PostgreSQL</h2></div></div></div><p>
					To change the <span class="strong"><strong>PostgreSQL</strong></span> configuration, use the <code class="literal">/var/lib/pgsql/data/postgresql.conf</code> file. Afterwards, restart the <code class="literal">postgresql</code> service so that the changes become effective:
				</p><pre class="literallayout">systemctl restart postgresql.service</pre><p>
					Apart from <code class="literal">/var/lib/pgsql/data/postgresql.conf</code>, other files to change <span class="strong"><strong>PostgreSQL</strong></span> configuration exist:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<code class="literal">postgresql.auto.conf</code>
						</li><li class="listitem">
							<code class="literal">pg_ident.conf</code>
						</li><li class="listitem">
							<code class="literal">pg_hba.conf</code>
						</li></ul></div><p>
					The <code class="literal">postgresql.auto.conf</code> file holds basic <span class="strong"><strong>PostgreSQL</strong></span> settings similarly to <code class="literal">/var/lib/pgsql/data/postgresql.conf</code>. However, this file is under the server control. It is edited by the <code class="literal">ALTER SYSTEM</code> queries, and cannot be edited manually.
				</p><p>
					The <code class="literal">pg_ident.conf</code> file is used for mapping user identities from external authentication mechanisms into the postgresql user identities.
				</p><p>
					The <code class="literal">pg_hba.conf</code> file is used for configuring detailed user permissions for <span class="strong"><strong>PostgreSQL</strong></span> databases.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="initializing-database-cluster_using-postgresql"/>Initializing a database cluster</h3></div></div></div><p>
						In a <span class="strong"><strong>PostgreSQL</strong></span> database, all data is stored a single directory, which is called a database cluster. You can choose where to store your data but Red Hat recommends to store the data in the default <code class="literal">/var/lib/pgsql/data</code> directory.
					</p><p>
						To initialize this data directory, run:
					</p><pre class="literallayout">postgresql-setup --initdb</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="backing-up-postgresql-data_using-postgresql"/>Backing up PostgreSQL data</h2></div></div></div><p>
					To back up <span class="strong"><strong>PostgreSQL</strong></span> data, use one of the following approaches:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							SQL dump
						</li><li class="listitem">
							File system level backup
						</li><li class="listitem">
							Ccontinuous archiving
						</li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="backuping-postgresql-sql-dump_backing-up-postgresql-data"/>Backing up PostgreSQL data with an SQL dump</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="perforing-sql-dump_backing-up-postgresql-data"/>Performing an SQL dump</h4></div></div></div><p>
							The SQL dump method is based on generating a file with SQL commands. When this file is uploaded back to the database server, it recreates the database in the same state as it was at the time of the dump. The SQL dump is ensured by the <span class="strong"><strong><span class="application">pg_dump</span></strong></span> utility, which is a <span class="strong"><strong>PostgreSQL</strong></span> client application. The basic usage of the <code class="literal">pg_dump</code> command is such that the command writes its result into the standard output:
						</p><pre class="literallayout">pg_dump dbname &gt; dumpfile</pre><p>
							The resulting SQL file can be either in a text format or in other different formats, which allows for parallelism and for more detailed control of object restoration.
						</p><p>
							You can perform the SQL dump from any remote host that has access to the database. The <span class="strong"><strong><span class="application">pg_dump</span></strong></span> utility does not operate with special permissions, but it must have a read access to all tables that you want to back up. To back up the entire database, you must run it as a database superuser.
						</p><p>
							To specify which database server <span class="strong"><strong><span class="application">pg_dump</span></strong></span> will contact, use the following command-line options:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
									The <code class="literal">-h</code> option to define the host.
								</p><p class="simpara">
									The default host is either the local host or what is specified by the <code class="literal">PGHOST</code> environment variable.
								</p></li><li class="listitem"><p class="simpara">
									The <code class="literal">-p</code> option to define the port.
								</p><p class="simpara">
									The default port is indicated by the <code class="literal">PGPORT</code> environment variable or the compiled-in default.
								</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								Note that <span class="strong"><strong><span class="application">pg_dump</span></strong></span> dumps only a single database. It does not dump information about roles or tablespaces because such information is cluster-wide.
							</p><p>
								To back up each database in a given cluster and to preserve cluster-wide data, such as role and tablespace definitions, use the <code class="literal">pg_dumpall</code> command:
							</p><pre class="literallayout">pg_dumpall &gt; dumpfile</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="restoring-from-sql-dump"/>Restoring database from an SQL dump</h4></div></div></div><p>
							To restore a database from an SQL dump:
						</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
									Create a new database (dbname):
								</p><pre class="literallayout">createdb <code class="literal">dbname</code></pre></li><li class="listitem"><p class="simpara">
									Make sure that all users who own objects or were granted permissions on objects in the dumped database already exist.
								</p><p class="simpara">
									If such users do not exist, the restore fails to recreate the objects with the original ownership and permissions.
								</p></li><li class="listitem"><p class="simpara">
									Run the <span class="strong"><strong><span class="application">psql</span></strong></span> utility to restore a text file dump created by the <span class="strong"><strong><span class="application">pg_dump</span></strong></span> utility:
								</p><pre class="literallayout">psql dbname &lt; dumpfile</pre></li></ol></div><p>
							where <code class="literal">dumpfile</code> is the output of the <code class="literal">pg_dump</code> command.
						</p><p>
							If you want to restore a non-text file dump, use the <code class="literal">pg_restore</code> utility:
						</p><pre class="literallayout">pg_restore non-plain-text-file</pre><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="restoring_a_database_on_another_server"/>Restoring a database on another server</h5></div></div></div><p>
								Dumping a database directly from one server to another is possible because <span class="strong"><strong><span class="application">pg_dump</span></strong></span> and <span class="strong"><strong><span class="application">psql</span></strong></span> can write to and read from pipes.
							</p><p>
								To dump a database from one server to another, run:
							</p><pre class="literallayout">pg_dump -h host1 dbname | psql -h host2 dbname</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="handling_sql_errors_during_restore"/>Handling SQL errors during restore</h5></div></div></div><p>
								By default, <span class="strong"><strong><span class="application">psql</span></strong></span> continues to execute if an SQL error occurs. Consequently, the database is restored only partially.
							</p><p>
								If you want to change this default behavior, use one of the following approaches:
							</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
										Make <span class="strong"><strong><span class="application">psql</span></strong></span> exit with an exit status of 3 if an SQL error occurs by setting the <code class="literal">ON_ERROR_STOP</code> variable:
									</p><pre class="literallayout">psql --set ON_ERROR_STOP=on dbname &lt; dumpfile</pre></li><li class="listitem"><p class="simpara">
										Specify that the whole dump is restored as a single transaction so that the restore is either fully completed or canceled by using <code class="literal">psql</code> with one of the following options:
									</p><pre class="literallayout">psql -1</pre><p class="simpara">
										or
									</p><pre class="literallayout">psql --single-transaction</pre><p class="simpara">
										Note that when using this approach, even a minor error can cancel a restore operation that has already run for many hours.
									</p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="advantages-sql-dump_backing-up-postgresql-data"/>Advantages and disadvantages of an SQL dump</h4></div></div></div><p>
							An SQL dump has the following advantages compared to other <span class="strong"><strong>PostgreSQL</strong></span> backup methods:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									An SQL dump is the only <span class="strong"><strong>PostgreSQL</strong></span> backup method that is not server version-specific. The output of the <span class="strong"><strong><span class="application">pg_dump</span></strong></span> utility can be reloaded into later versions of <span class="strong"><strong>PostgreSQL</strong></span>, which is not possible for file system level backups or continuous archiving.
								</li><li class="listitem">
									An SQL dump is the only method that works when transferring a database to a different machine architecture, such as going from a 32-bit to a 64-bit server.
								</li><li class="listitem">
									An SQL dump provides internally consistent dumps. A dump represents a snapshot of the database at the time pg_dump began running.
								</li><li class="listitem">
									The <span class="strong"><strong><span class="application">pg_dump</span></strong></span> utility does not block other operations on the database when it is running.
								</li></ul></div><p>
							A disadvantage of an SQL dump is that it takes more time compared to file system level backup.
						</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="additional_resources_42"/>Additional resources</h4></div></div></div><p>
							For more information about the SQL dump, see <a class="link" href="https://www.postgresql.org/docs/10/static/backup-dump.html">PostgreSQL 10 Documentation</a>.
						</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="backuping-postgresql-system-level-backup_backing-up-postgresql-data"/>Backing up PostgreSQL data with a file system level backup</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="performing_a_file_system_level_backup"/>Performing a file system level backup</h4></div></div></div><p>
							To perform a file system level backup, you need to copy the files that <span class="strong"><strong>PostgreSQL</strong></span> uses to store the data in the database to another location:
						</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
									Choose the location of a database cluster and initialize this cluster as described in <a class="xref" href="using-databases.html#initializing-database-cluster_using-postgresql" title="Initializing a database cluster">the section called “Initializing a database cluster”</a>.
								</li><li class="listitem"><p class="simpara">
									Stop the postgresql service:
								</p><pre class="literallayout">~]# systemctl stop postgresql.service</pre></li><li class="listitem"><p class="simpara">
									Use any method to make a file system backup, for example:
								</p><pre class="literallayout">tar -cf backup.tar /var/lib/pgsql/data</pre></li><li class="listitem"><p class="simpara">
									Start the postgresql service:
								</p><pre class="literallayout">~]# systemctl start postgresql.service</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="advantages_and_disadvantages_of_a_file_system_level_backup"/>Advantages and disadvantages of a file system level backup</h4></div></div></div><p>
							A file system level backup has the following advantage compared to other <span class="strong"><strong>PostgreSQL</strong></span> backup methods:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									File system level backup is usually faster than SQL dump.
								</li></ul></div><p>
							File system level backup has the following disadvantages compared to other <span class="strong"><strong>PostgreSQL</strong></span> backup methods:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									The backup is architecture-specific and Red Hat Enterprise Linux 7-specific. It can only be used as a backup to return to Red Hat Enterprise Linux 7 if the upgrade was not successful, but it cannot be used with <span class="strong"><strong>PostgreSQL 10.0</strong></span>.
								</li><li class="listitem">
									The database server must be shut down before data backup and before data restore as well.
								</li><li class="listitem">
									Backup and restore of certain individual files or tables is impossible. The file system backups only work for a complete backup and restoration of an entire database cluster.
								</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="alternative_approaches_to_file_system_level_backup"/>Alternative approaches to file system level backup</h4></div></div></div><p>
							Alternative approaches to file system backup include:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									A consistent snapshot of the data directory
								</li><li class="listitem">
									The rsync utility
								</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="additional_resources_43"/>Additional resources</h4></div></div></div><p>
							For more information about the file system level backup, see <a class="link" href="https://www.postgresql.org/docs/10/static/backup-file.html">PostgreSQL 10 Documentation</a>.
						</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="backuping-postgresql-continuous-archiving_backing-up-postgresql-data"/>Backing up PostgreSQL data by continuous archiving</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="intro-continuous-archiving"/>Introduction to continuous archiving</h4></div></div></div><p>
							<span class="strong"><strong>PostgreSQL</strong></span> records every change made to the database’s data files into a write ahead log (WAL) file that is available in the <code class="literal">pg_wal/</code> subdirectory of the cluster’s data directory. This log is intended primarily for a crash recovery. After a crash, the log entries made since the last checkpoint can be used for restoring the database to a consistency.
						</p><p>
							The continuous archiving method, also known as <code class="literal">online backup</code>, combines the WAL files with a file system level backup. If a database recovery is needed, you can restore the database from the file system backup and then replay log from the backed up WAL files to bring the system to the current state.
						</p><p>
							For this backup method, you need a continuous sequence of archived WAL files that extends back to the start time of your backup at least.
						</p><p>
							If you want to start using the continuous archiving backup method, make sure to set up and test your procedure for archiving WAL files before taking your first base backup.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								You cannot use <span class="strong"><strong><span class="application">pg_dump</span></strong></span> and <span class="strong"><strong><span class="application">pg_dumpall</span></strong></span> dumps as a part of a continuous archiving backup solution. These dumps produce logical backups, not file system level backups. As such, they do not contain enough information to be used by a WAL replay.
							</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="performing-continuous-archiving-backup"/>Performing continuous archiving backup</h4></div></div></div><p>
							To perform a database backup and restore using the continuous archiving method, follow these steps:
						</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
									<a class="xref" href="using-databases.html#making-base-backup" title="Making a base backup">the section called “Making a base backup”</a>
								</li><li class="listitem">
									<a class="xref" href="using-databases.html#restoring-database-with-continuous-archiving" title="Restoring the database using a continuous archive backup">the section called “Restoring the database using a continuous archive backup”</a>
								</li></ol></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="making-base-backup"/>Making a base backup</h5></div></div></div><p>
								To perform a base backup, use the <span class="strong"><strong><span class="application">pg_basebackup</span></strong></span> tool, which can create a base backup in the form of either individual files or a <code class="literal">tar</code> archive.
							</p><p>
								To use the base backup, you need to keep all the WAL segment files generated during and after the file system backup. The base backup process creates a backup history file that is stored into the WAL archive area and is named after the first WAL segment file that you need for the file system backup. When you have safely archived the file system backup and the WAL segment files used during the backup, which are specified in the backup history file, you can delete all archived WAL segments with names numerically less because they are no longer needed to recover the file system backup. However, consider keeping several backup sets to be certain that you can recover your data.
							</p><p>
								The backup history file is a small text file, which contains the label string that you gave to <span class="strong"><strong><span class="application">pg_basebackup</span></strong></span>, the starting and ending times, and WAL segments of the backup. If you used the label string to identify the associated dump file, then the archived history file is enough to tell you which dump file to restore.
							</p><p>
								With the continuous archiving method, you need to keep all the archived WAL files back to your last base backup. Thus the ideal frequency of base backups depends on:
							</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										The storage volume available for archived WAL files.
									</li><li class="listitem"><p class="simpara">
										The maximum possible duration of data recovery in situations when recovery is necessary.
									</p><p class="simpara">
										In cases with long period since the last backup, the system replays more WAL segments, and the recovery thus takes more time.
									</p></li></ul></div><p>
								For more information about making a base backup, see <a class="link" href="https://www.postgresql.org/docs/10/static/continuous-archiving.html#BACKUP-BASE-BACKUP">PostgreSQL 10 Documentation</a>.
							</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="restoring-database-with-continuous-archiving"/>Restoring the database using a continuous archive backup</h5></div></div></div><p>
								To restore a database using a continuous backup:
							</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
										Stop the server:
									</p><pre class="literallayout">~]# systemctl stop postgresql.service</pre></li><li class="listitem"><p class="simpara">
										Copy the necessary data to a temporary location.
									</p><p class="simpara">
										Preferably, copy the whole cluster data directory and any tablespaces. Note that this requires enough free space on your system to hold two copies of your existing database.
									</p><p class="simpara">
										If you do not have enough space, save the contents of the cluster’s <code class="literal">pg_wal</code> directory, which can contain logs that were not archived before the system went down.
									</p></li><li class="listitem">
										Remove all existing files and subdirectories under the cluster data directory and under the root directories of any tablespaces you are using.
									</li><li class="listitem"><p class="simpara">
										Restore the database files from your file system backup.
									</p><p class="simpara">
										Make sure that:
									</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
												The files are restored with the correct ownership (the database system user, not <code class="literal">root</code>)
											</li><li class="listitem">
												The files are restored with the correct permissions
											</li><li class="listitem">
												The symbolic links in the <code class="literal">pg_tblspc/</code> subdirectory were restored correctly
											</li></ul></div></li><li class="listitem"><p class="simpara">
										Remove any files present in the <code class="literal">pg_wal/</code> subdirectory
									</p><p class="simpara">
										These files resulted from the file system backup and are therefore obsolete. If you did not archive <code class="literal">pg_wal/</code>, recreate it with proper permissions.
									</p></li><li class="listitem">
										Copy the unarchived WAL segment files that you saved in step 2 into <code class="literal">pg_wal/</code> if there are such files.
									</li><li class="listitem">
										Create the <code class="literal">recovery.conf</code> recovery command file in the cluster data directory.
									</li><li class="listitem"><p class="simpara">
										Start the server:
									</p><pre class="literallayout">~]# systemctl start postgresql.service</pre><p class="simpara">
										The server will enter the recovery mode and proceed to read through the archived WAL files that it needs.
									</p><p class="simpara">
										If the recovery is terminated due to an external error, the server can simply be restarted and it will continue the recovery. When the recovery process is completed, the server renames <code class="literal">recovery.conf</code> to <code class="literal">recovery.done</code> to prevent accidental re-entering the recovery mode later, when the server starts normal database operations.
									</p></li><li class="listitem"><p class="simpara">
										Check the contents of the database to make sure that the database has recovered into the required state.
									</p><p class="simpara">
										If the database has not recovered into the required state, return to step 1. If the database has recovered into the required state, allow the users to connect by restoring the <code class="literal">pg_hba.conf</code> file to normal.
									</p></li></ol></div><p>
								For more information about restoring using the continuous backup, see <a class="link" href="https://www.postgresql.org/docs/10/static/continuous-archiving.html#BACKUP-PITR-RECOVERY">PostgreSQL 10 Documentation</a>.
							</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="advantages-continuous-archiving"/>Advantages and disadvantages of continuous archiving</h4></div></div></div><p>
							Continuous archiving has the following advantages compared to other <span class="strong"><strong>PostgreSQL</strong></span> backup methods:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									With the continuous backup method, it is possible to use a file system backup that is not entirely consistent because any internal inconsistency in the backup is corrected by the log replay. A file system snapshot is not needed; <code class="literal">tar</code> or a similar archiving tool is sufficient.
								</li><li class="listitem">
									Continuous backup can be achieved by continuing to archive the WAL files because the sequence of WAL files for the log replay can be indefinitely long. This is particularly valuable for large databases.
								</li><li class="listitem">
									Continuous backup supports point-in-time recovery. It is not necessary to replay the WAL entries to the end. The replay can be stopped at any point and the database can be restored to its state at any time since the base backup was taken.
								</li><li class="listitem">
									If the series of WAL files are continuously available to another machine that has been loaded with the same base backup file, it is possible to restore the other machine with a nearly-current copy of the database at any point.
								</li></ul></div><p>
							Continuous archiving has the following disadvantages compared to other <span class="strong"><strong>PostgreSQL</strong></span> backup methods:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									Continuous backup method supports only restoration of an entire database cluster, not a subset.
								</li><li class="listitem">
									Continuous backup requires extensive archival storage.
								</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="additional_resources_44"/>Additional resources</h4></div></div></div><p>
							For more information on continuous archiving method, see <a class="link" href="https://www.postgresql.org/docs/10/static/continuous-archiving.html">PostgreSQL 10 Documentation</a>.
						</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="migrating-to-postgresql_using-postgresql"/>Migrating to PostgreSQL 10.0</h2></div></div></div><p>
					Red Hat Enterprise Linux 7 contains <span class="strong"><strong>PostgreSQL 9.2</strong></span> as the default version of the <span class="strong"><strong>PostgreSQL</strong></span> server. In addition, several versions of <span class="strong"><strong>PostgreSQL</strong></span> are provided as Software Collections for Red Hat Enterprise Linux 6 and Red Hat Enterprise Linux 7. Red Hat Enterprise Linux 8 provides <span class="strong"><strong>PostgreSQL 10.0</strong></span> and <span class="strong"><strong>PostgreSQL 9.6</strong></span>.
				</p><p>
					This section assumes migration from the Red Hat Enterprise Linux 7 system version of <span class="strong"><strong>Postgreql 9.2</strong></span> to the Red Hat Enterprise Linux 8 version of <span class="strong"><strong>PostgreSQL 10</strong></span>, which is provided by the default stream.
				</p><p>
					Users of <span class="strong"><strong>PostgreSQL</strong></span> on Red Hat Enterprise Linux 7 can use two migration paths for the database files to Red Hat Enterprise Linux 8:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="link" href="using-databases.html#postgresql-in-place-upgrade" title="Fast upgrade using the pg_upgrade tool">Fast upgrade using the pg_upgrade tool</a>
						</li><li class="listitem">
							<a class="link" href="using-databases.html#postgresql-dump-and-restore-upgrade" title="Dump and restore upgrade">Dump and restore upgrade</a>
						</li></ul></div><p>
					Use preferably the fast upgrade method, which is faster than the dump and restore process.
				</p><p>
					ba * Cross-architecture upgrades * Systems using the <code class="literal">plpython</code> or <code class="literal">plpython2</code> extensions
				</p><p>
					+ Red Hat Enterprise Linux 8 Application stream repository includes only the <code class="literal">postgresql-plpython3</code> package, not the <code class="literal">postgresql-plpython2</code> package.
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Fast upgrade is not supported for migration from Red Hat Software Collections versions of <span class="strong"><strong>PostgreSQL</strong></span>.
						</li></ul></div><p>
					As a prerequisite for migration from <span class="strong"><strong>PostgreSQL 9.2</strong></span> to <span class="strong"><strong>PostgreSQL 10.0</strong></span>, back up your <span class="strong"><strong>PostgreSQL</strong></span> databases.
				</p><p>
					Dumping the databases and performing backup of the SQL files is a necessary part of the dump and restore process. However, you are recommended to do so if performing the fast upgrade as well.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="postgresql-in-place-upgrade"/>Fast upgrade using the pg_upgrade tool</h3></div></div></div><p>
						During a fast upgrade, you need to copy binary data files to the <code class="literal">/var/lib/pgsql/data/</code> directory and use the <code class="literal">pg_upgrade</code> tool. You can use this method for migrating data from the Red Hat Enterprise Linux 7 version of <span class="strong"><strong>PostgreSQL 9.2</strong></span>. By default, all data is stored in the <code class="literal">/var/lib/pgsql/data/</code> directory on both the Red Hat Enterprise Linux 7 and Red Hat Enterprise Linux 8 systems. For migration from Red Hat Software Collections versions of <span class="strong"><strong>PostgreSQL</strong></span>, use <a class="link" href="using-databases.html#postgresql-dump-and-restore-upgrade" title="Dump and restore upgrade">Dump and restore upgrade</a>.
					</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							Before performing the upgrade, back up all your data stored in the <span class="strong"><strong>PostgreSQL</strong></span> databases.
						</p></div><p>
						To perform a fast upgrade, use the following procedure:
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								On the RHEL 8 system, install the <code class="literal">postgresql-server</code> and <code class="literal">postgresql-upgrade</code> packages:
							</p><pre class="literallayout">~]# yum install postgresql-server postgresql-upgrade</pre><p class="simpara">
								Optionally, if you used any <span class="strong"><strong>PostgreSQL</strong></span> server modules on RHEL 7, install them also on the RHEL 8 system in two versions, compiled both against <span class="strong"><strong>PostgreSQL 9.2</strong></span> (installed as the <code class="literal">postgresql-upgrade</code> package) and <span class="strong"><strong>PostgreSQL 10</strong></span> (installed as the <code class="literal">postgresql-server</code> package). If you need to compile a third-party <span class="strong"><strong>PostgreSQL</strong></span> server module, build it both against the <code class="literal">postgresql-devel</code> and <code class="literal">postgresql-upgrade-devel</code> packages.
							</p></li><li class="listitem"><p class="simpara">
								Check the following items:
							</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										Basic configuration: On the RHEL 8 system, check whether your server uses the default <code class="literal">/var/lib/pgsql/data</code> directory and the database is correctly initialized and enabled. In addition, the data files must be stored in the same path as mentioned in the <code class="literal">/usr/lib/systemd/system/postgresql.service</code> file.
									</li><li class="listitem">
										<span class="strong"><strong>PostgreSQL</strong></span> servers: Your system can run multiple <span class="strong"><strong>PostgreSQL</strong></span> servers. Make sure that the data directories for all these servers are handled independently.
									</li><li class="listitem">
										<span class="strong"><strong>PostgreSQL</strong></span> server modules: Ensure that the <span class="strong"><strong>PostgreSQL</strong></span> server modules that you used on {RHE} 7 are installed on your RHEL 8 system as well. Note that plug-ins are installed in the <code class="literal">/usr/lib64/pgsql/</code> directory (or in the <code class="literal">/usr/lib/pgsql/</code> directory on 32-bit systems).
									</li></ul></div></li><li class="listitem"><p class="simpara">
								Ensure that the <code class="literal">postgresql</code> service is not running on either of the source and target systems at the time of copying data.
							</p><pre class="literallayout">~]# systemctl stop postgresql.service</pre></li><li class="listitem">
								Copy the database files from the source location to the <code class="literal">/var/lib/pgsql/data/</code> directory on the RHEL 8 system.
							</li><li class="listitem"><p class="simpara">
								Perform the upgrade process by running the following command as the <span class="strong"><strong>PostgreSQL</strong></span> user:
							</p><pre class="literallayout">~]$ /bin/postgresql-setup --upgrade</pre><p class="simpara">
								This launches the <code class="literal">pg_upgrade</code> process in the background.
							</p><p class="simpara">
								In case of failure, <code class="literal">postgresql-setup</code> provides an informative error message.
							</p></li><li class="listitem"><p class="simpara">
								Copy the prior configuration from <code class="literal">/var/lib/pgsql/data-old</code> to the new cluster.
							</p><p class="simpara">
								Note that the fast upgrade does not reuse the prior configuration in the newer data stack and the configuration is generated from scratch. If you want to combine the old and new configurations manually, use the *.conf files in the data directories.
							</p></li><li class="listitem"><p class="simpara">
								Start the new <span class="strong"><strong>PostgreSQL 10</strong></span> server:
							</p><pre class="literallayout">~]# systemctl start postgresql.service</pre></li><li class="listitem"><p class="simpara">
								Run the <code class="literal">analyze_new_cluster.sh</code> script located in the <span class="strong"><strong>PostgreSQL</strong></span> home directory:
							</p><pre class="literallayout">su postgres -c '~/analyze_new_cluster.sh'</pre></li><li class="listitem"><p class="simpara">
								If you want the <span class="strong"><strong>PostgreSQL 10</strong></span> server to be automatically started on boot, run:
							</p><pre class="literallayout">~]# systemctl enable postgresql.service</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="postgresql-dump-and-restore-upgrade"/>Dump and restore upgrade</h3></div></div></div><p>
						When using the dump and restore upgrade, you need to dump all databases contents into an SQL file dump file.
					</p><p>
						Note that the dump and restore upgrade is slower than the fast upgrade method and it may require some manual fixing in the generated SQL file.
					</p><p>
						You can use this method for migrating data from:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								TheRed Hat Enterprise Linux7 version of <span class="strong"><strong>PostgreSQL 9.2</strong></span>
							</li><li class="listitem"><p class="simpara">
								The Red Hat Software Collections versions of:
							</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										<span class="strong"><strong>PostgreSQL 9.2</strong></span> (no longer supported)
									</li><li class="listitem">
										<span class="strong"><strong>PostgreSQL 9.4</strong></span> (no longer supported)
									</li><li class="listitem">
										<span class="strong"><strong>PostgreSQL 9.6</strong></span>
									</li><li class="listitem">
										<span class="strong"><strong>PostgreSQL 10</strong></span>
									</li></ul></div></li></ul></div><p>
						On Red Hat Enterprise Linux 7 and Red Hat Enterprise Linux 8 systems, <span class="strong"><strong>PostgreSQL</strong></span> data is stored in the <code class="literal">/var/lib/pgsql/data/</code> directory by default. In case of Red Hat Software Collections versions of <span class="strong"><strong>PostgreSQL</strong></span>, the default data directory is <code class="literal">/var/opt/rh/collection_name/lib/pgsql/data/</code> (with the exception of <code class="literal">postgresql92</code>, which uses the <code class="literal">/opt/rh/postgresql92/root/var/lib/pgsql/data/</code> directory).
					</p><p>
						To perform the dump and restore upgrade, change the user to <code class="literal">root</code>, and use the following procedure for migrating from the base Red Hat Enterprise Linux 7 system version of <span class="strong"><strong>PostgreSQL 9.2</strong></span> to the Red Hat Enterprise Linux 8 default version of <span class="strong"><strong>PostgreSQL 10</strong></span>:
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								On your RHEL 7 system, start the <span class="strong"><strong>PostgreSQL 9.2</strong></span> server:
							</p><pre class="literallayout">~]# systemctl start postgresql.service</pre></li><li class="listitem"><p class="simpara">
								On the RHEL 7 system, dump all databases contents into the <code class="literal">pgdump_file.sql</code> file:
							</p><pre class="literallayout">su - postgres -c "pg_dumpall &gt; ~/pgdump_file.sql"</pre></li><li class="listitem"><p class="simpara">
								Make sure that the databases were dumped correctly:
							</p><pre class="literallayout">su - postgres -c 'less "$HOME/pgdump_file.sql"'</pre><p class="simpara">
								As a result, the path to the dumped sql file is displayed: <code class="literal">/var/lib/pgsql/pgdump_file.sql</code>.
							</p></li><li class="listitem"><p class="simpara">
								On the RHEL 8 system, install the <code class="literal">postgresql-server</code> package:
							</p><pre class="literallayout">~]# yum install postgresql-server</pre><p class="simpara">
								Optionally, if you used any <span class="strong"><strong>PostgreSQL</strong></span> server modules on RHEL 7, install them also on the RHEL 8 system. If you need to compile a third-party <span class="strong"><strong>PostgreSQL</strong></span> server module, build it against the <code class="literal">postgresql-devel</code> package.
							</p></li><li class="listitem"><p class="simpara">
								On the RHEL 8 system, initialize the data directory for the <span class="strong"><strong>PostgreSQL 10.0</strong></span> server:
							</p><pre class="literallayout">~]# postgresql-setup --initdb</pre></li><li class="listitem"><p class="simpara">
								On the RHEL 8 system, copy the <code class="literal">pgdump_file.sql</code> into the <span class="strong"><strong>PostgreSQL</strong></span> home directory, and check that the file was copied correctly:
							</p><pre class="literallayout">su - postgres -c 'test -e "$HOME/pgdump_file.sql" &amp;&amp; echo exists'</pre></li><li class="listitem"><p class="simpara">
								Copy the configuration files from the RHEL 7 system:
							</p><pre class="literallayout">su - postgres -c 'ls -1 $PGDATA/*.conf'</pre><p class="simpara">
								The configuration files to be copied are:
							</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										<code class="literal">/var/lib/pgsql/data/pg_hba.conf</code>
									</li><li class="listitem">
										<code class="literal">/var/lib/pgsql/data/pg_ident.conf</code>
									</li><li class="listitem">
										<code class="literal">/var/lib/pgsql/data/postgresql.conf</code>
									</li></ul></div></li><li class="listitem"><p class="simpara">
								On the RHEL 8 system, start the new <span class="strong"><strong>PostgreSQL 10</strong></span> server:
							</p><pre class="literallayout">~]# systemctl start postgresql.service</pre></li><li class="listitem"><p class="simpara">
								On the RHEL 8 system, import data from the dumped sql file:
							</p><pre class="literallayout">su - postgres -c 'psql -f ~/pgdump_file.sql postgres'</pre></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							When upgrading from a Red Hat Software Collections version of <span class="strong"><strong>PostgreSQL</strong></span>, adjust the commands to include <code class="literal">scl enable collection_name.</code> For example, to dump data from the <code class="literal">rh-postgresql96</code> Software Collection, use the following command:
						</p><pre class="literallayout">su - postgres -c 'scl enable rh-postgresql96 "pg_dumpall &gt; ~/pgdump_file.sql"'</pre></div></div></div></div></div></body></html>