<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 5. Managing power consumption with PowerTOP</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="managing-power-consumption-with-powertop_monitoring-and-managing-system-status-and-performance"/>Chapter 5. Managing power consumption with PowerTOP</h1></div></div></div><p>
			As a system administrator, you can use the <span class="strong"><strong><span class="application">PowerTOP</span></strong></span> tool to analyze and manage power consumption.
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="the-purpose-of-powertop_managing-power-consumption-with-powertop"/>The purpose of PowerTOP</h1></div></div></div><p>
				<span class="strong"><strong><span class="application">PowerTOP</span></strong></span> is a program that diagnoses issues related to power consumption and provides suggestions on how to extend battery lifetime.
			</p><p>
				The <span class="strong"><strong><span class="application">PowerTOP</span></strong></span> tool can provide an estimate of the total power usage of the system and also individual power usage for each process, device, kernel worker, timer, and interrupt handler. The tool can also identify specific components of kernel and user-space applications that frequently wake up the CPU.
			</p><p>
				Red Hat Enterprise Linux 8 uses version 2.x of <span class="strong"><strong><span class="application">PowerTOP</span></strong></span>.
			</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="using-powertop_managing-power-consumption-with-powertop"/>Using PowerTOP</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="prerequisites-using-powertop"/>Prerequisites</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							To be able to use <span class="strong"><strong><span class="application">PowerTOP</span></strong></span>, make sure that the <code class="literal">powertop</code> package has been installed on your system:
						</p><pre class="screen"># yum install powertop</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="starting-powertop_using-powertop"/>Starting PowerTOP</h2></div></div></div><h4><a id="procedure_10"/>Procedure</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							To run <span class="strong"><strong><span class="application">PowerTOP</span></strong></span>, use the following command:
						</p><pre class="literallayout"># powertop</pre></li></ul></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						Laptops should run on battery power when running the <code class="literal">powertop</code> command.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="calibrating-powertop_using-powertop"/>Calibrating PowerTOP</h2></div></div></div><h4><a id="procedure_11"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							On a laptop, you can calibrate the power estimation engine by running the following command:
						</p><pre class="literallayout"># powertop --calibrate</pre></li><li class="listitem"><p class="simpara">
							Let the calibration finish without interacting with the machine during the process.
						</p><p class="simpara">
							Calibration takes time because the process performs various tests, cycles through brightness levels and switches devices on and off.
						</p></li><li class="listitem"><p class="simpara">
							When the calibration process is completed, <span class="strong"><strong><span class="application">PowerTOP</span></strong></span> starts as normal. Let it run for approximately an hour to collect data.
						</p><p class="simpara">
							When enough data is collected, power estimation figures will be displayed in the first column of the output table.
						</p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						Note that <code class="literal">powertop --calibrate</code> can only be used on laptops.
					</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="setting-the-measuring-interval_using-powertop"/>Setting the measuring interval</h2></div></div></div><p>
					By default, <span class="strong"><strong><span class="application">PowerTOP</span></strong></span> takes measurements in 20 seconds intervals.
				</p><p>
					If you want to change this measuring frequency, use the following procedure:
				</p><h4><a id="procedure_12"/>Procedure</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							Run the <code class="literal">powertop</code> command with the <code class="literal">--time</code> option:
						</p><pre class="literallayout"># powertop --time=<span class="emphasis"><em><span class="replaceable">time in seconds</span></em></span></pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="related-information-using-powertop"/>Related information</h2></div></div></div><p>
					For more details on how to use <span class="strong"><strong><span class="application">PowerTOP</span></strong></span>, see the <code class="literal">powertop</code> man page.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="powertop-statistics_managing-power-consumption-with-powertop"/>PowerTOP statistics</h1></div></div></div><p>
				While it runs, <span class="strong"><strong><span class="application">PowerTOP</span></strong></span> gathers statistics from the system.
			</p><p>
				<span class="strong"><strong><span class="application">PowerTOP</span></strong></span>'s output provides multiple tabs:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<code class="literal">Overview</code>
					</li><li class="listitem">
						<code class="literal">Idle stats</code>
					</li><li class="listitem">
						<code class="literal">Frequency stats</code>
					</li><li class="listitem">
						<code class="literal">Device stats</code>
					</li><li class="listitem">
						<code class="literal">Tunables</code>
					</li></ul></div><p>
				You can use the <code class="literal">Tab</code> and <code class="literal">Shift+Tab</code> keys to cycle through these tabs.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="overview-tab_managing-power-consumption-with-powertop"/>The Overview tab</h2></div></div></div><p>
					In the <code class="literal">Overview</code> tab, you can view a list of the components that either send wakeups to the CPU most frequently or consume the most power. The items within the <code class="literal">Overview</code> tab, including processes, interrupts, devices, and other resources, are sorted according to their utilization.
				</p><p>
					The adjacent columns within the <code class="literal">Overview</code> tab provide the following pieces of information:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Usage</span></dt><dd>
								Power estimation of how the resource is being used.
							</dd><dt><span class="term">Events/s</span></dt><dd>
								Wakeups per second. The number of wakeups per second indicates how efficiently the services or the devices and drivers of the kernel are performing. Less wakeups means that less power is consumed. Components are ordered by how much further their power usage can be optimized.
							</dd><dt><span class="term">Category</span></dt><dd>
								Classification of the component; such as process, device, or timer.
							</dd><dt><span class="term">Description</span></dt><dd>
								Description of the component.
							</dd></dl></div><p>
					If properly calibrated, a power consumption estimation for every listed item in the first column is shown as well.
				</p><p>
					Apart from this, the <code class="literal">Overview</code> tab includes the line with summary statistics such as:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Total power consumption
						</li><li class="listitem">
							Remaining battery life (only if applicable)
						</li><li class="listitem">
							Summary of total wakeups per second, GPU operations per second, and virtual file system operations per second
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idle-stats-tab_managing-power-consumption-with-powertop"/>The Idle stats tab</h2></div></div></div><p>
					The <code class="literal">Idle stats</code> tab shows usage of C-states for all processors and cores, while the <code class="literal">Frequency stats</code> tab shows usage of P-states including the Turbo mode, if applicable, for all processors and cores. The duration of C- or P-states is an indication of how well the CPU usage has been optimized. The longer the CPU stays in the higher C- or P-states (for example C4 is higher than C3), the better the CPU usage optimization is. Ideally, residency is 90% or more in the highest C- or P-state when the system is idle.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="device-stats-tab_managing-power-consumption-with-powertop"/>The Device stats tab</h2></div></div></div><p>
					The <code class="literal">Device stats</code> tab provides similar information to the <code class="literal">Overview</code> tab but only for devices.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="tunables-tab_managing-power-consumption-with-powertop"/>The Tunables tab</h2></div></div></div><p>
					The <code class="literal">Tunables</code> tab contains <span class="strong"><strong><span class="application">PowerTOP</span></strong></span>'s suggestions for optimizing the system for lower power consumption.
				</p><p>
					Use the <code class="literal">up</code> and <code class="literal">down</code> keys to move through suggestions, and the <code class="literal">enter</code> key to toggle the suggestion on or off.
				</p><div class="figure"><a id="idm140217628546912"/><p class="title"><strong>Figure 5.1. PowerTOP output</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/powertop_output_n.png" alt="powertop output n"/></div></div></div><h3><a id="additional_resources_12"/>Additional resources</h3><p>
					For more details on <span class="strong"><strong><span class="application">PowerTOP</span></strong></span>, see <a class="link" href="https://01.org/powertop/">PowerTOP’s home page</a>.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="generating-an-html-output_managing-power-consumption-with-powertop"/>Generating an HTML output</h1></div></div></div><p>
				Apart from the <code class="literal">powertop’s</code> output in terminal, you can also generate an HTML report.
			</p><h3><a id="procedure_13"/>Procedure</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
						Run the <code class="literal">powertop</code> command with the <code class="literal">--html</code> option:
					</p><pre class="literallayout"># powertop --html=htmlfile.html</pre><p class="simpara">
						Replace the <code class="literal">htmlfile.html</code> parameter with the required name for the output file.
					</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="optimizing-power-consumption_managing-power-consumption-with-powertop"/>Optimizing power consumption</h1></div></div></div><p>
				To optimize power consumption, you can use either the <code class="literal">powertop</code> service or the <code class="literal">powertop2tuned</code> utility.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="optimizing-power-consumption-using-the-powertop-service_optimizing-power-consumption"/>Optimizing power consumption using the powertop service</h2></div></div></div><p>
					You can use the <code class="literal">powertop</code> service to automatically enable all <span class="strong"><strong><span class="application">PowerTOP</span></strong></span>'s suggestions from the <code class="literal">Tunables</code> tab on the boot:
				</p><h4><a id="procedure_14"/>Procedure</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							Enable the <code class="literal">powertop</code> service:
						</p><pre class="literallayout"># systemctl enable powertop</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="powertop2tuned-utility_optimizing-power-consumption"/>The powertop2tuned utility</h2></div></div></div><p>
					The <code class="literal">powertop2tuned</code> utility allows you to create custom <span class="strong"><strong><span class="application">Tuned</span></strong></span> profiles from <span class="strong"><strong><span class="application">PowerTOP</span></strong></span> suggestions.
				</p><p>
					By default, <code class="literal">powertop2tuned</code> creates profiles in the <code class="literal">/etc/tuned/</code> directory, and bases the custom profile on the currently selected <span class="strong"><strong><span class="application">Tuned</span></strong></span> profile. For safety reasons, all <span class="strong"><strong><span class="application">PowerTOP</span></strong></span> tunings are initially disabled in the new profile.
				</p><p>
					To enable the tunings, you can:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Uncomment them in the <code class="literal">/etc/tuned/profile_name/tuned.conf file</code>.
						</li><li class="listitem"><p class="simpara">
							Use the <code class="literal">--enable</code> or <code class="literal">-e</code> option to generate a new profile that enables most of the tunings suggested by <span class="strong"><strong><span class="application">PowerTOP</span></strong></span>.
						</p><p class="simpara">
							Certain potentially problematic tunings, such as the USB autosuspend, are disabled by default and need to be uncommented manually.
						</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="optimizing-power-consumption-with-powertop2tuned_optimizing-power-consumption"/>Optimizing power consumption using the powertop2tuned utility</h2></div></div></div><h4><a id="prerequisites_6"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							The <code class="literal">powertop2tuned</code> utility is installed on the system:
						</p><pre class="literallayout"># yum install tuned-utils</pre></li></ul></div><h4><a id="procedure_15"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Create a custom profile:
						</p><pre class="literallayout"># powertop2tuned new_profile_name</pre></li><li class="listitem"><p class="simpara">
							Activate the new profile:
						</p><pre class="literallayout"># tuned-adm profile new_profile_name</pre></li></ol></div><h4><a id="additional_information"/>Additional information</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							For a complete list of options that <code class="literal">powertop2tuned</code> supports, use:
						</p><pre class="literallayout">$ powertop2tuned --help</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="con_comparison-of-powertop-service-and-powertop2tuned_optimizing-power-consumption"/>Comparison of powertop.service and powertop2tuned</h2></div></div></div><p>
					Optimizing power consumption with <code class="literal">powertop2tuned</code> is preferred over <code class="literal">powertop.service</code> for the following reasons:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">powertop2tuned</code> utility represents integration of <span class="strong"><strong><span class="application">PowerTOP</span></strong></span> into <span class="strong"><strong><span class="application">Tuned</span></strong></span>, which enables to benefit of advantages of both tools.
						</li><li class="listitem">
							The <code class="literal">powertop2tuned</code> utility allows for fine-grained control of enabled tuning.
						</li><li class="listitem">
							With <code class="literal">powertop2tuned</code>, potentially dangerous tuning are not automatically enabled.
						</li><li class="listitem">
							With <code class="literal">powertop2tuned</code>, rollback is possible without reboot.
						</li></ul></div></div></div></div></body></html>