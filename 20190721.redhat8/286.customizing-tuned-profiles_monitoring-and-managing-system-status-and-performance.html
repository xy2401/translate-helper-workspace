<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 2. Customizing Tuned profiles</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="customizing-tuned-profiles_monitoring-and-managing-system-status-and-performance"/>Chapter 2. Customizing Tuned profiles</h1></div></div></div><p>
			You can create or modify <span class="strong"><strong>Tuned</strong></span> profiles to optimize system performance for your intended use case.
		</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="prerequisites-customizing-tuned-profiles"/>Prerequisites</h1></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						Install and enable <span class="strong"><strong>Tuned</strong></span> as described in <a class="xref" href="getting-started-with-tuned_monitoring-and-managing-system-status-and-performance.html#installing-and-enabling-tuned_getting-started-with-tuned" title="Installing and enabling Tuned">the section called “Installing and enabling Tuned”</a>.
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="tuned-profiles_customizing-tuned-profiles"/>Tuned profiles</h1></div></div></div><p>
				A detailed analysis of a system can be very time-consuming. <span class="strong"><strong>Tuned</strong></span> provides a number of predefined profiles for typical use cases. You can also create, modify, and delete profiles.
			</p><p>
				The profiles provided with <span class="strong"><strong>Tuned</strong></span> are divided into the following categories:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						Power-saving profiles
					</li><li class="listitem">
						Performance-boosting profiles
					</li></ul></div><p>
				The performance-boosting profiles include profiles that focus on the following aspects:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						Low latency for storage and network
					</li><li class="listitem">
						High throughput for storage and network
					</li><li class="listitem">
						Virtual machine performance
					</li><li class="listitem">
						Virtualization host performance
					</li></ul></div><h3><a id="the_default_profile_2"/>The default profile</h3><p>
				During the installation, the best profile for your system is selected automatically. Currently, the default profile is selected according to the following customizable rules:
			</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">Environment</th><th style="text-align: left" valign="top">Default profile</th><th style="text-align: left" valign="top">Goal</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
								Compute nodes
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								<code class="literal">throughput-performance</code>
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								The best throughput performance
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								Virtual machines
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								<code class="literal">virtual-guest</code>
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								The best performance. If you are not interested in the best performance, you can change it to the <code class="literal">balanced</code> or <code class="literal">powersave</code> profile.
							</p>
							 </td></tr><tr><td style="text-align: left" valign="top"> <p>
								Other cases
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								<code class="literal">balanced</code>
							</p>
							 </td><td style="text-align: left" valign="top"> <p>
								Balanced performance and power consumption
							</p>
							 </td></tr></tbody></table></div><h3><a id="merged_profiles_2"/>Merged profiles</h3><p>
				As an experimental feature, it is possible to select more profiles at once. <span class="strong"><strong>Tuned</strong></span> will try to merge them during the load.
			</p><p>
				If there are conflicts, the settings from the last specified profile takes precedence.
			</p><div class="example"><a id="idm140217721002512"/><p class="title"><strong>Example 2.1. Low power consumption in a virtual guest</strong></p><div class="example-contents"><p>
					The following example optimizes the system to run in a virtual machine for the best performance and concurrently tunes it for low power consumption, while the low power consumption is the priority:
				</p><pre class="screen"># tuned-adm profile virtual-guest powersave</pre></div></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
					Merging is done automatically without checking whether the resulting combination of parameters makes sense. Consequently, the feature might tune some parameters the opposite way, which might be counterproductive: for example, setting the disk for high throughput by using the <code class="literal">throughput-performance</code> profile and concurrently setting the disk spindown to the low value by the <code class="literal">spindown-disk</code> profile.
				</p></div><h3><a id="the_location_of_profiles_2"/>The location of profiles</h3><p>
				<span class="strong"><strong>Tuned</strong></span> stores profiles in the following directories:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">/usr/lib/tuned/</code></span></dt><dd>
							Distribution-specific profiles are stored in the directory. Each profile has its own directory. The profile consists of the main configuration file called <code class="literal">tuned.conf</code>, and optionally other files, for example helper scripts.
						</dd><dt><span class="term"><code class="literal">/etc/tuned/</code></span></dt><dd>
							If you need to customize a profile, copy the profile directory into the directory, which is used for custom profiles. If there are two profiles of the same name, the custom profile located in <code class="literal">/etc/tuned/</code> is used.
						</dd></dl></div><h3><a id="the_syntax_of_profile_configuration_2"/>The syntax of profile configuration</h3><p>
				The <code class="literal">tuned.conf</code> file can contain one <code class="literal">[main]</code> section and other sections for configuring plug-in instances. However, all sections are optional.
			</p><p>
				Lines starting with the hash sign (<code class="literal">#</code>) are comments.
			</p><h3><a id="additional_resources_5"/>Additional resources</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						The <code class="literal">tuned.conf(5)</code> man page.
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="inheritance-between-tuned-profiles_customizing-tuned-profiles"/>Inheritance between Tuned profiles</h1></div></div></div><p>
				<span class="strong"><strong>Tuned</strong></span> profiles can be based on other profiles and modify only certain aspects of their parent profile.
			</p><p>
				The <code class="literal">[main]</code> section of <span class="strong"><strong>Tuned</strong></span> profiles recognizes the <code class="literal">include</code> option:
			</p><pre class="screen">[main]
include=<span class="emphasis"><em><span class="replaceable">parent</span></em></span></pre><p>
				All settings from the <span class="emphasis"><em><span class="replaceable">parent</span></em></span> profile are loaded in this <span class="emphasis"><em>child</em></span> profile. In the following sections, the <span class="emphasis"><em>child</em></span> profile can override certain settings inherited from the <span class="emphasis"><em><span class="replaceable">parent</span></em></span> profile or add new settings not present in the <span class="emphasis"><em><span class="replaceable">parent</span></em></span> profile.
			</p><p>
				You can create your own <span class="emphasis"><em>child</em></span> profile in the <code class="literal">/etc/tuned/</code> directory based on a pre-installed profile in <code class="literal">/usr/lib/tuned/</code> with only some parameters adjusted.
			</p><p>
				If the <span class="emphasis"><em><span class="replaceable">parent</span></em></span> profile is updated, such as after a <span class="strong"><strong>Tuned</strong></span> upgrade, the changes are reflected in the <span class="emphasis"><em>child</em></span> profile.
			</p><div class="example"><a id="idm140217737789984"/><p class="title"><strong>Example 2.2. A power-saving profile based on balanced</strong></p><div class="example-contents"><p>
					The following is an example of a custom profile that extends the <code class="literal">balanced</code> profile and sets Aggressive Link Power Management (ALPM) for all devices to the maximum powersaving.
				</p><pre class="screen">[main]
include=balanced

[scsi_host]
alpm=min_power</pre></div></div><h3><a id="additional_resources_6"/>Additional resources</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						The <code class="literal">tuned.conf(5)</code> man page
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="static-and-dynamic-tuning-in-tuned_customizing-tuned-profiles"/>Static and dynamic tuning in Tuned</h1></div></div></div><p>
				This section explains the difference between the two categories of system tuning that <span class="strong"><strong>Tuned</strong></span> applies: <span class="emphasis"><em>static</em></span> and <span class="emphasis"><em>dynamic</em></span>.
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Static tuning</span></dt><dd>
							Mainly consists of the application of predefined <code class="literal">sysctl</code> and <code class="literal">sysfs</code> settings and one-shot activation of several configuration tools such as <code class="literal">ethtool</code>.
						</dd><dt><span class="term">Dynamic tuning</span></dt><dd><p class="simpara">
							Watches how various system components are used throughout the uptime of your system. <span class="strong"><strong>Tuned</strong></span> adjusts system settings dynamically based on that monitoring information.
						</p><p class="simpara">
							For example, the hard drive is used heavily during startup and login, but is barely used later when the user might mainly work with applications such as web browsers or email clients. Similarly, the CPU and network devices are used differently at different times. <span class="strong"><strong>Tuned</strong></span> monitors the activity of these components and reacts to the changes in their use.
						</p><p class="simpara">
							By default, dynamic tuning is disabled. To enable it, edit the <code class="literal">/etc/tuned/tuned-main.conf</code> file and change the <code class="literal">dynamic_tuning</code> option to <code class="literal">1</code>. <span class="strong"><strong>Tuned</strong></span> then periodically analyzes system statistics and uses them to update your system tuning settings. To configure the time interval in seconds between these updates, use the <code class="literal">update_interval</code> option.
						</p><p class="simpara">
							Currently implemented dynamic tuning algorithms try to balance the performance and powersave, and are therefore disabled in the performance profiles. Dynamic tuning for individual plug-ins can be enabled or disabled in the <span class="strong"><strong>Tuned</strong></span> profiles.
						</p></dd></dl></div><div class="example"><a id="idm140217729276912"/><p class="title"><strong>Example 2.3. Static and dynamic tuning on a workstation</strong></p><div class="example-contents"><p>
					On a typical office workstation, the Ethernet network interface is inactive most of the time. Only a few emails go in and out or some web pages might be loaded.
				</p><p>
					For those kinds of loads, the network interface does not have to run at full speed all the time, as it does by default. <span class="strong"><strong>Tuned</strong></span> has a monitoring and tuning plug-in for network devices that can detect this low activity and then automatically lower the speed of that interface, typically resulting in a lower power usage.
				</p><p>
					If the activity on the interface increases for a longer period of time, for example because a DVD image is being downloaded or an email with a large attachment is opened, <span class="strong"><strong>Tuned</strong></span> detects this and sets the interface speed to maximum to offer the best performance while the activity level is high.
				</p><p>
					This principle is used for other plug-ins for CPU and disks as well.
				</p></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="tuned-plug-ins_customizing-tuned-profiles"/>Tuned plug-ins</h1></div></div></div><p>
				Plug-ins are modules in <span class="strong"><strong>Tuned</strong></span> profiles that <span class="strong"><strong>Tuned</strong></span> uses to monitor or optimize different devices on the system.
			</p><p>
				<span class="strong"><strong>Tuned</strong></span> uses two types of plug-ins:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						monitoring plug-ins
					</li><li class="listitem">
						tuning plug-ins
					</li></ul></div><h3><a id="monitoring_plug_ins"/>Monitoring plug-ins</h3><p>
				Monitoring plug-ins are used to get information from a running system. The output of the monitoring plug-ins can be used by tuning plug-ins for dynamic tuning.
			</p><p>
				Monitoring plug-ins are automatically instantiated whenever their metrics are needed by any of the enabled tuning plug-ins. If two tuning plug-ins require the same data, only one instance of the monitoring plug-in is created and the data is shared.
			</p><h3><a id="tuning_plug_ins"/>Tuning plug-ins</h3><p>
				Each tuning plug-in tunes an individual subsystem and takes several parameters that are populated from the tuned profiles. Each subsystem can have multiple devices, such as multiple CPUs or network cards, that are handled by individual instances of the tuning plug-ins. Specific settings for individual devices are also supported.
			</p><h3><a id="syntax_for_plug_ins_in_tuned_profiles"/>Syntax for plug-ins in Tuned profiles</h3><p>
				Sections describing plug-in instances are formatted in the following way:
			</p><pre class="screen">[<span class="emphasis"><em>NAME</em></span>]
type=<span class="emphasis"><em>TYPE</em></span>
devices=<span class="emphasis"><em>DEVICES</em></span></pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">NAME</span></dt><dd>
							is the name of the plug-in instance as it is used in the logs. It can be an arbitrary string.
						</dd><dt><span class="term">TYPE</span></dt><dd>
							is the type of the tuning plug-in.
						</dd><dt><span class="term">DEVICES</span></dt><dd><p class="simpara">
							is the list of devices that this plug-in instance handles.
						</p><p class="simpara">
							The <code class="literal">devices</code> line can contain a list, a wildcard (<code class="literal">*</code>), and negation (<code class="literal">!</code>). If there is no <code class="literal">devices</code> line, all devices present or later attached on the system of the <span class="emphasis"><em><span class="replaceable">TYPE</span></em></span> are handled by the plug-in instance. This is same as using the <code class="literal">devices=*</code> option.
						</p><div class="example"><a id="idm140217726077056"/><p class="title"><strong>Example 2.4. Matching block devices with a plug-in</strong></p><div class="example-contents"><p>
								The following example matches all block devices starting with <code class="literal">sd</code>, such as <code class="literal">sda</code> or <code class="literal">sdb</code>, and does not disable barriers on them:
							</p><pre class="screen">[data_disk]
type=disk
devices=sd*
disable_barriers=false</pre><p>
								The following example matches all block devices except <code class="literal">sda1</code> and <code class="literal">sda2</code>:
							</p><pre class="screen">[data_disk]
type=disk
devices=!sda1, !sda2
disable_barriers=false</pre></div></div></dd></dl></div><p>
				If no instance of a plug-in is specified, the plug-in is not enabled.
			</p><p>
				If the plug-in supports more options, they can be also specified in the plug-in section. If the option is not specified and it was not previously specified in the included plug-in, the default value is used.
			</p><h3><a id="short_plug_in_syntax"/>Short plug-in syntax</h3><p>
				If you do not need custom names for the plug-in instance and there is only one definition of the instance in your configuration file, <span class="strong"><strong>Tuned</strong></span> supports the following short syntax:
			</p><pre class="screen">[<span class="emphasis"><em>TYPE</em></span>]
devices=<span class="emphasis"><em>DEVICES</em></span></pre><p>
				In this case, it is possible to omit the <code class="literal">type</code> line. The instance is then referred to with a name, same as the type. The previous example could be then rewritten into:
			</p><div class="example"><a id="idm140217744803696"/><p class="title"><strong>Example 2.5. Matching block devices using the short syntax</strong></p><div class="example-contents"><pre class="screen">[disk]
devices=sdb*
disable_barriers=false</pre></div></div><h3><a id="conflicting_plug_in_definitions_in_a_profile"/>Conflicting plug-in definitions in a profile</h3><p>
				If the same section is specified more than once using the <code class="literal">include</code> option, the settings are merged. If they cannot be merged due to a conflict, the last conflicting definition overrides the previous settings. If you do not know what was previously defined, you can use the <code class="literal">replace</code> Boolean option and set it to <code class="literal">true</code>. This causes all the previous definitions with the same name to be overwritten and the merge does not happen.
			</p><p>
				You can also disable the plug-in by specifying the <code class="literal">enabled=false</code> option. This has the same effect as if the instance was never defined. Disabling the plug-in is useful if you are redefining the previous definition from the <code class="literal">include</code> option and do not want the plug-in to be active in your custom profile.
			</p><h3><a id="functionality_not_implemented_in_any_plug_in"/>Functionality not implemented in any plug-in</h3><p>
				<span class="strong"><strong>Tuned</strong></span> includes the ability to run any shell command as part of enabling or disabling a tuning profile. This enables you to extend <span class="strong"><strong>Tuned</strong></span> profiles with functionality that has not been integrated into Tuned yet.
			</p><p>
				You can specify arbitrary shell commands using the <code class="literal">script</code> plug-in.
			</p><h3><a id="additional_resources_7"/>Additional resources</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						The <code class="literal">tuned.conf(5)</code> man page
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="available-tuned-plug-ins_customizing-tuned-profiles"/>Available Tuned plug-ins</h1></div></div></div><p>
				This section lists all monitoring and tuning plug-ins currently available in <span class="strong"><strong>Tuned</strong></span>.
			</p><h3><a id="monitoring_plug_ins_2"/>Monitoring plug-ins</h3><p>
				Currently, the following monitoring plug-ins are implemented:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">disk</code></span></dt><dd>
							Gets disk load (number of IO operations) per device and measurement interval.
						</dd><dt><span class="term"><code class="literal">net</code></span></dt><dd>
							Gets network load (number of transferred packets) per network card and measurement interval.
						</dd><dt><span class="term"><code class="literal">load</code></span></dt><dd>
							Gets CPU load per CPU and measurement interval.
						</dd></dl></div><h3><a id="tuning_plug_ins_2"/>Tuning plug-ins</h3><p>
				Currently, the following tuning plug-ins are implemented. Only some of these plug-ins implement dynamic tuning. Options supported by plug-ins are also listed:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">cpu</code></span></dt><dd><p class="simpara">
							Sets the CPU governor to the value specified by the <code class="literal">governor</code> option and dynamically changes the Power Management Quality of Service (PM QoS) CPU Direct Memory Access (DMA) latency according to the CPU load.
						</p><p class="simpara">
							If the CPU load is lower than the value specified by the <code class="literal">load_threshold</code> option, the latency is set to the value specified by the <code class="literal">latency_high</code> option, otherwise it is set to the value specified by <code class="literal">latency_low</code>.
						</p><p class="simpara">
							You can also force the latency to a specific value and prevent it from dynamically changing further. To do so, set the <code class="literal">force_latency</code> option to the required latency value.
						</p></dd><dt><span class="term"><code class="literal">eeepc_she</code></span></dt><dd><p class="simpara">
							Dynamically sets the front-side bus (FSB) speed according to the CPU load.
						</p><p class="simpara">
							This feature can be found on some netbooks and is also known as the ASUS Super Hybrid Engine (SHE).
						</p><p class="simpara">
							If the CPU load is lower or equal to the value specified by the <code class="literal">load_threshold_powersave</code> option, the plug-in sets the FSB speed to the value specified by the <code class="literal">she_powersave</code> option. If the CPU load is higher or equal to the value specified by the <code class="literal">load_threshold_normal</code> option, it sets the FSB speed to the value specified by the <code class="literal">she_normal</code> option.
						</p><p class="simpara">
							Static tuning is not supported and the plug-in is transparently disabled if <span class="strong"><strong>Tuned</strong></span> does not detect the hardware support for this feature.
						</p></dd><dt><span class="term"><code class="literal">net</code></span></dt><dd>
							Configures the Wake-on-LAN functionality to the values specified by the <code class="literal">wake_on_lan</code> option. It uses the same syntax as the <code class="literal">ethtool</code> utility. It also dynamically changes the interface speed according to the interface utilization.
						</dd><dt><span class="term"><code class="literal">sysctl</code></span></dt><dd><p class="simpara">
							Sets various <code class="literal">sysctl</code> settings specified by the plug-in options.
						</p><p class="simpara">
							The syntax is <code class="literal"><span class="emphasis"><em><span class="replaceable">name</span></em></span>=<span class="emphasis"><em><span class="replaceable">value</span></em></span></code>, where <span class="emphasis"><em><span class="replaceable">name</span></em></span> is the same as the name provided by the <code class="literal">sysctl</code> utility.
						</p><p class="simpara">
							Use the <code class="literal">sysctl</code> plug-in if you need to change system settings that are not covered by other plug-ins available in <span class="strong"><strong>Tuned</strong></span>. If the settings are covered by some specific plug-ins, prefer these plug-ins.
						</p></dd><dt><span class="term"><code class="literal">usb</code></span></dt><dd><p class="simpara">
							Sets autosuspend timeout of USB devices to the value specified by the <code class="literal">autosuspend</code> parameter.
						</p><p class="simpara">
							The value <code class="literal">0</code> means that autosuspend is disabled.
						</p></dd><dt><span class="term"><code class="literal">vm</code></span></dt><dd>
							Enables or disables transparent huge pages depending on the Boolean value of the <code class="literal">transparent_hugepages</code> option.
						</dd><dt><span class="term"><code class="literal">audio</code></span></dt><dd><p class="simpara">
							Sets the autosuspend timeout for audio codecs to the value specified by the <code class="literal">timeout</code> option.
						</p><p class="simpara">
							Currently, the <code class="literal">snd_hda_intel</code> and <code class="literal">snd_ac97_codec</code> codecs are supported. The value <code class="literal">0</code> means that the autosuspend is disabled. You can also enforce the controller reset by setting the Boolean option <code class="literal">reset_controller</code> to <code class="literal">true</code>.
						</p></dd><dt><span class="term"><code class="literal">disk</code></span></dt><dd><p class="simpara">
							Sets the disk elevator to the value specified by the <code class="literal">elevator</code> option.
						</p><p class="simpara">
							It also sets:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									APM to the value specified by the <code class="literal">apm</code> option
								</li><li class="listitem">
									Scheduler quantum to the value specified by the <code class="literal">scheduler_quantum</code> option
								</li><li class="listitem">
									Disk spindown timeout to the value specified by the <code class="literal">spindown</code> option
								</li><li class="listitem">
									Disk readahead to the value specified by the <code class="literal">readahead</code> parameter
								</li><li class="listitem">
									The current disk readahead to a value multiplied by the constant specified by the <code class="literal">readahead_multiply</code> option
								</li></ul></div><p class="simpara">
							In addition, this plug-in dynamically changes the advanced power management and spindown timeout setting for the drive according to the current drive utilization. The dynamic tuning can be controlled by the Boolean option <code class="literal">dynamic</code> and is enabled by default.
						</p></dd><dt><span class="term"><code class="literal">scsi_host</code></span></dt><dd><p class="simpara">
							Tunes options for SCSI hosts.
						</p><p class="simpara">
							It sets Aggressive Link Power Management (ALPM) to the value specified by the <code class="literal">alpm</code> option.
						</p></dd><dt><span class="term"><code class="literal">mounts</code></span></dt><dd>
							Enables or disables barriers for mounts according to the Boolean value of the <code class="literal">disable_barriers</code> option.
						</dd><dt><span class="term"><code class="literal">script</code></span></dt><dd><p class="simpara">
							Executes an external script or binary when the profile is loaded or unloaded. You can choose an arbitrary executable.
						</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
								The <code class="literal">script</code> plug-in is provided mainly for compatibility with earlier releases. Prefer other <span class="strong"><strong>Tuned</strong></span> plug-ins if they cover the required functionality.
							</p></div><p class="simpara">
							<span class="strong"><strong>Tuned</strong></span> calls the executable with one of the following arguments:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									<code class="literal">start</code> when loading the profile
								</li><li class="listitem">
									<code class="literal">stop</code> when unloading the profile
								</li></ul></div><p class="simpara">
							You need to correctly implement the <code class="literal">stop</code> action in your executable and revert all settings that you changed during the <code class="literal">start</code> action. Otherwise, the roll-back step after changing your <span class="strong"><strong>Tuned</strong></span> profile will not work.
						</p><p class="simpara">
							Bash scripts can import the <code class="literal">/usr/lib/tuned/functions</code> Bash library and use the functions defined there. Use these functions only for functionality that is not natively provided by <span class="strong"><strong>Tuned</strong></span>. If a function name starts with an underscore, such as <code class="literal">_wifi_set_power_level</code>, consider the function private and do not use it in your scripts, because it might change in the future.
						</p><p class="simpara">
							Specify the path to the executable using the <code class="literal">script</code> parameter in the plug-in configuration.
						</p><div class="example"><a id="idm140217738266512"/><p class="title"><strong>Example 2.6. Running a Bash script from a profile</strong></p><div class="example-contents"><p>
								To run a Bash script named <code class="literal">script.sh</code> that is located in the profile directory, use:
							</p><pre class="screen">[script]
script=${i:PROFILE_DIR}/script.sh</pre></div></div></dd><dt><span class="term"><code class="literal">sysfs</code></span></dt><dd><p class="simpara">
							Sets various <code class="literal">sysfs</code> settings specified by the plug-in options.
						</p><p class="simpara">
							The syntax is <code class="literal"><span class="emphasis"><em><span class="replaceable">name</span></em></span>=<span class="emphasis"><em><span class="replaceable">value</span></em></span></code>, where <span class="emphasis"><em><span class="replaceable">name</span></em></span> is the <code class="literal">sysfs</code> path to use.
						</p><p class="simpara">
							Use this plugin in case you need to change some settings that are not covered by other plug-ins. Prefer specific plug-ins if they cover the required settings.
						</p></dd><dt><span class="term"><code class="literal">video</code></span></dt><dd><p class="simpara">
							Sets various powersave levels on video cards. Currently, only the Radeon cards are supported.
						</p><p class="simpara">
							The powersave level can be specified by using the <code class="literal">radeon_powersave</code> option. Supported values are:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									<code class="literal">default</code>
								</li><li class="listitem">
									<code class="literal">auto</code>
								</li><li class="listitem">
									<code class="literal">low</code>
								</li><li class="listitem">
									<code class="literal">mid</code>
								</li><li class="listitem">
									<code class="literal">high</code>
								</li><li class="listitem">
									<code class="literal">dynpm</code>
								</li><li class="listitem">
									<code class="literal">dpm-battery</code>
								</li><li class="listitem">
									<code class="literal">dpm-balanced</code>
								</li><li class="listitem">
									<code class="literal">dpm-perfomance</code>
								</li></ul></div><p class="simpara">
							For details, see <a class="link" href="http://www.x.org/wiki/RadeonFeature#KMS_Power_Management_Options">www.x.org</a>. Note that this plug-in is experimental and the option might change in future releases.
						</p></dd><dt><span class="term"><code class="literal">bootloader</code></span></dt><dd><p class="simpara">
							Adds options to the kernel command line. This plug-in supports only the GRUB 2 boot loader.
						</p><p class="simpara">
							Customized non-standard location of the GRUB 2 configuration file can be specified by the <code class="literal">grub2_cfg_file</code> option.
						</p><p class="simpara">
							The kernel options are added to the current GRUB configuration and its templates. The system needs to be rebooted for the kernel options to take effect.
						</p><p class="simpara">
							Switching to another profile or manually stopping the <code class="literal">tuned</code> service removes the additional options. If you shut down or reboot the system, the kernel options persist in the <code class="literal">grub.cfg</code> file.
						</p><p class="simpara">
							The kernel options can be specified by the following syntax:
						</p><pre class="screen">cmdline=<span class="emphasis"><em><span class="replaceable">arg1</span></em></span> <span class="emphasis"><em><span class="replaceable">arg2</span></em></span> ... <span class="emphasis"><em><span class="replaceable">argN</span></em></span></pre><div class="example"><a id="idm140217725609120"/><p class="title"><strong>Example 2.7. Modifying the kernel command line</strong></p><div class="example-contents"><p>
								For example, to add the <code class="literal">quiet</code> kernel option to a <span class="strong"><strong>Tuned</strong></span> profile, include the following lines in the <code class="literal">tuned.conf</code> file:
							</p><pre class="screen">[bootloader]
cmdline=quiet</pre><p>
								The following is an example of a custom profile that adds the <code class="literal">isolcpus=2</code> option to the kernel command line:
							</p><pre class="screen">[bootloader]
cmdline=isolcpus=2</pre></div></div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="variables-and-built-in-functions-in-tuned-profiles_customizing-tuned-profiles"/>Variables and built-in functions in Tuned profiles</h1></div></div></div><p>
				Variables and built-in functions expand at run time when a <span class="strong"><strong>Tuned</strong></span> profile is activated.
			</p><p>
				Using <span class="strong"><strong>Tuned</strong></span> variables reduces the amount of necessary typing in <span class="strong"><strong>Tuned</strong></span> profiles. You can also:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						Use various built-in functions together with <span class="strong"><strong>Tuned</strong></span> variables
					</li><li class="listitem">
						Create custom functions in Python and add them to <span class="strong"><strong>Tuned</strong></span> in the form of plug-ins
					</li></ul></div><h3><a id="variables"/>Variables</h3><p>
				There are no predefined variables in <span class="strong"><strong>Tuned</strong></span> profiles. You can define your own variables by creating the <code class="literal">[variables]</code> section in a profile and using the following syntax:
			</p><pre class="screen">[variables]

<span class="emphasis"><em><span class="replaceable">variable_name</span></em></span>=<span class="emphasis"><em><span class="replaceable">value</span></em></span></pre><p>
				To expand the value of a variable in a profile, use the following syntax:
			</p><pre class="screen">${<span class="emphasis"><em><span class="replaceable">variable_name</span></em></span>}</pre><div class="example"><a id="idm140217724837312"/><p class="title"><strong>Example 2.8. Isolating CPU cores using variables</strong></p><div class="example-contents"><p>
					In the following example, the <code class="literal">${isolated_cores}</code> variable expands to <code class="literal">1,2</code>; hence the kernel boots with the <code class="literal">isolcpus=1,2</code> option:
				</p><pre class="screen">[variables]
isolated_cores=1,2

[bootloader]
cmdline=isolcpus=${isolated_cores}</pre><p>
					The variables can be specified in a separate file. For example, you can add the following lines to <code class="literal">tuned.conf</code>:
				</p><pre class="screen">[variables]
include=/etc/tuned/<span class="emphasis"><em><span class="replaceable">my-variables.conf</span></em></span>

[bootloader]
cmdline=isolcpus=${isolated_cores}</pre><p>
					If you add the <code class="literal">isolated_cores=1,2</code> option to the <code class="literal">/etc/tuned/my-variables.conf</code> file, the kernel boots with the <code class="literal">isolcpus=1,2</code> option.
				</p></div></div><h3><a id="functions"/>Functions</h3><p>
				To call a function, use the following syntax:
			</p><pre class="screen">${f:<span class="emphasis"><em><span class="replaceable">function_name</span></em></span>:<span class="emphasis"><em><span class="replaceable">argument_1</span></em></span>:<span class="emphasis"><em><span class="replaceable">argument_2</span></em></span>}</pre><p>
				To expand the directory path where the profile and the <code class="literal">tuned.conf</code> file are located, use the <code class="literal">PROFILE_DIR</code> function, which requires special syntax:
			</p><pre class="screen">${i:PROFILE_DIR}</pre><div class="example"><a id="idm140217729263088"/><p class="title"><strong>Example 2.9. Isolating CPU cores using variables and built-in functions</strong></p><div class="example-contents"><p>
					In the following example, the <code class="literal">${non_isolated_cores}</code> variable expands to <code class="literal">0,3-5</code>, and the <code class="literal">cpulist_invert</code> built-in function is called with the <code class="literal">0,3-5</code> argument:
				</p><pre class="screen">[variables]
non_isolated_cores=0,3-5

[bootloader]
cmdline=isolcpus=${f:cpulist_invert:${non_isolated_cores}}</pre><p>
					The <code class="literal">cpulist_invert</code> function inverts the list of CPUs. For a 6-CPU machine, the inversion is <code class="literal">1,2</code>, and the kernel boots with the <code class="literal">isolcpus=1,2</code> command-line option.
				</p></div></div><h3><a id="additional_resources_8"/>Additional resources</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						The <code class="literal">tuned.conf(5)</code> man page
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="built-in-functions-available-in-tuned-profiles_customizing-tuned-profiles"/>Built-in functions available in Tuned profiles</h1></div></div></div><p>
				The following built-in functions are available in all <span class="strong"><strong>Tuned</strong></span> profiles:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">PROFILE_DIR</code></span></dt><dd>
							Returns the directory path where the profile and the <code class="literal">tuned.conf</code> file are located.
						</dd><dt><span class="term"><code class="literal">exec</code></span></dt><dd>
							Executes a process and returns its output.
						</dd><dt><span class="term"><code class="literal">assertion</code></span></dt><dd>
							Compares two arguments. If they <span class="emphasis"><em>do not match</em></span>, the function logs text from the first argument and aborts profile loading.
						</dd><dt><span class="term"><code class="literal">assertion_non_equal</code></span></dt><dd>
							Compares two arguments. If they <span class="emphasis"><em>match</em></span>, the function logs text from the first argument and aborts profile loading.
						</dd><dt><span class="term"><code class="literal">kb2s</code></span></dt><dd>
							Converts kilobytes to disk sectors.
						</dd><dt><span class="term"><code class="literal">s2kb</code></span></dt><dd>
							Converts disk sectors to kilobytes.
						</dd><dt><span class="term"><code class="literal">strip</code></span></dt><dd>
							Creates a string from all passed arguments and deletes both leading and trailing white space.
						</dd><dt><span class="term"><code class="literal">virt_check</code></span></dt><dd><p class="simpara">
							Checks whether <span class="strong"><strong>Tuned</strong></span> is running inside a virtual machine (VM) or on bare metal:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									Inside a VM, the function returns the first argument.
								</li><li class="listitem">
									On bare metal, the function returns the second argument, even in case of an error.
								</li></ul></div></dd><dt><span class="term"><code class="literal">cpulist_invert</code></span></dt><dd>
							Inverts a list of CPUs to make its complement. For example, on a system with 4 CPUs, numbered from 0 to 3, the inversion of the list <code class="literal">0,2,3</code> is <code class="literal">1</code>.
						</dd><dt><span class="term"><code class="literal">cpulist2hex</code></span></dt><dd>
							Converts a CPU list to a hexadecimal CPU mask.
						</dd><dt><span class="term"><code class="literal">cpulist2hex_invert</code></span></dt><dd>
							Converts a CPU list to a hexadecimal CPU mask and inverts it.
						</dd><dt><span class="term"><code class="literal">hex2cpulist</code></span></dt><dd>
							Converts a hexadecimal CPU mask to a CPU list.
						</dd><dt><span class="term"><code class="literal">cpulist_online</code></span></dt><dd>
							Checks whether the CPUs from the list are online. Returns the list containing only online CPUs.
						</dd><dt><span class="term"><code class="literal">cpulist_present</code></span></dt><dd>
							Checks whether the CPUs from the list are present. Returns the list containing only present CPUs.
						</dd><dt><span class="term"><code class="literal">cpulist_unpack</code></span></dt><dd>
							Unpacks a CPU list in the form of <code class="literal">1-3,4</code> to <code class="literal">1,2,3,4</code>.
						</dd><dt><span class="term"><code class="literal">cpulist_pack</code></span></dt><dd>
							Packs a CPU list in the form of <code class="literal">1,2,3,5</code> to <code class="literal">1-3,5</code>.
						</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="creating-new-tuned-profiles_customizing-tuned-profiles"/>Creating new Tuned profiles</h1></div></div></div><p>
				This procedure creates a new <span class="strong"><strong>Tuned</strong></span> profile with custom performance rules.
			</p><h3><a id="prerequisites_2"/>Prerequisites</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						The <code class="literal">tuned</code> service is installed and running. See <a class="xref" href="getting-started-with-tuned_monitoring-and-managing-system-status-and-performance.html#installing-and-enabling-tuned_getting-started-with-tuned" title="Installing and enabling Tuned">the section called “Installing and enabling Tuned”</a> for details.
					</li></ul></div><h3><a id="procedure_5"/>Procedure</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						In the <code class="literal">/etc/tuned/</code> directory, create a new directory named the same as the profile that you want to create:
					</p><pre class="screen"># mkdir /etc/tuned/<span class="emphasis"><em><span class="replaceable">my-profile</span></em></span></pre></li><li class="listitem"><p class="simpara">
						In the new directory, create a file named <code class="literal">tuned.conf</code>. Add a <code class="literal">[main]</code> section and plug-in definitions in it, according to your requirements.
					</p><p class="simpara">
						For example, see the configuration of the <code class="literal">balanced</code> profile:
					</p><pre class="screen">[main]
summary=General non-specialized tuned profile

[cpu]
governor=conservative
energy_perf_bias=normal

[audio]
timeout=10

[video]
radeon_powersave=dpm-balanced, auto

[scsi_host]
alpm=medium_power</pre></li><li class="listitem"><p class="simpara">
						To activate the profile, use:
					</p><pre class="screen"># tuned-adm profile <span class="emphasis"><em><span class="replaceable">my-profile</span></em></span></pre></li><li class="listitem"><p class="simpara">
						Verify that the <span class="strong"><strong>Tuned</strong></span> profile is active and the system settings are applied:
					</p><pre class="screen">$ tuned-adm active

Current active profile: <span class="emphasis"><em><span class="replaceable">my-profile</span></em></span></pre><pre class="screen">$ tuned-adm verify

Verfication succeeded, current system settings match the preset profile.
See tuned log file ('/var/log/tuned/tuned.log') for details.</pre></li></ol></div><h3><a id="additional_resources_9"/>Additional resources</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						The <code class="literal">tuned.conf(5)</code> man page
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="modifying-existing-tuned-profiles_customizing-tuned-profiles"/>Modifying existing Tuned profiles</h1></div></div></div><p>
				This procedure creates a modified child profile based on an existing <span class="strong"><strong>Tuned</strong></span> profile.
			</p><h3><a id="prerequisites_3"/>Prerequisites</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						The <code class="literal">tuned</code> service is installed and running. See <a class="xref" href="getting-started-with-tuned_monitoring-and-managing-system-status-and-performance.html#installing-and-enabling-tuned_getting-started-with-tuned" title="Installing and enabling Tuned">the section called “Installing and enabling Tuned”</a> for details.
					</li></ul></div><h3><a id="procedure_6"/>Procedure</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						In the <code class="literal">/etc/tuned/</code> directory, create a new directory named the same as the profile that you want to create:
					</p><pre class="screen"># mkdir /etc/tuned/<span class="emphasis"><em><span class="replaceable">modified-profile</span></em></span></pre></li><li class="listitem"><p class="simpara">
						In the new directory, create a file named <code class="literal">tuned.conf</code>, and set the <code class="literal">[main]</code> section as follows:
					</p><pre class="screen">[main]
include=<span class="emphasis"><em><span class="replaceable">parent-profile</span></em></span></pre><p class="simpara">
						Replace <span class="emphasis"><em><span class="replaceable">parent-profile</span></em></span> with the name of the profile you are modifying.
					</p></li><li class="listitem"><p class="simpara">
						Include your profile modifications.
					</p><div class="example"><a id="idm140217734153120"/><p class="title"><strong>Example 2.10. Lowering swappiness in the throughput-performance profile</strong></p><div class="example-contents"><p>
							To use the settings from the <code class="literal">throughput-performance</code> profile and change the value of <code class="literal">vm.swappiness</code> to 5, instead of the default 10, use:
						</p><pre class="screen">[main]
include=throughput-performance

[sysctl]
vm.swappiness=5</pre></div></div></li><li class="listitem"><p class="simpara">
						To activate the profile, use:
					</p><pre class="screen"># tuned-adm profile <span class="emphasis"><em><span class="replaceable">modified-profile</span></em></span></pre></li><li class="listitem"><p class="simpara">
						Verify that the <span class="strong"><strong>Tuned</strong></span> profile is active and the system settings are applied:
					</p><pre class="screen">$ tuned-adm active

Current active profile: <span class="emphasis"><em><span class="replaceable">my-profile</span></em></span></pre><pre class="screen">$ tuned-adm verify

Verfication succeeded, current system settings match the preset profile.
See tuned log file ('/var/log/tuned/tuned.log') for details.</pre></li></ol></div><h3><a id="additional_resources_10"/>Additional resources</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						The <code class="literal">tuned.conf(5)</code> man page
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="related-information-customizing-tuned-profiles"/>Related information</h1></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						The <code class="literal">tuned.conf(5)</code> man page
					</li><li class="listitem">
						The <span class="strong"><strong>Tuned</strong></span> project website: <a class="link" href="https://tuned-project.org/">https://tuned-project.org/</a>
					</li></ul></div></div></div></body></html>