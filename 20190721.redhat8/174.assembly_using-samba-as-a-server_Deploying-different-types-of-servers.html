<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 2. Using Samba as a server</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.78.1"/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_using-samba-as-a-server_Deploying-different-types-of-servers"/>Chapter 2. Using Samba as a server</h1></div></div></div><p>
			Samba implements the Server Message Block (SMB) protocol in Red Hat Enterprise Linux. The SMB protocol is used to access resources on a server, such as file shares and shared printers. Additionally, Samba implements the Distributed Computing Environment Remote Procedure Call (DCE RPC) protocol used by Microsoft Windows.
		</p><p>
			You can run Samba as:
		</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
					An Active Directory (AD) or NT4 domain member
				</li><li class="listitem">
					A standalone server
				</li><li class="listitem"><p class="simpara">
					An NT4 Primary Domain Controller (PDC) or Backup Domain Controller (BDC)
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						Red Hat supports the PDC and BDC modes only in existing installations with Windows versions which support NT4 domains. Red Hat recommends not setting up a new Samba NT4 domain, because Microsoft operating systems later than Windows 7 and Windows Server 2008 R2 do not support NT4 domains.
					</p><p>
						Red Hat does not support running Samba as an AD domain controller (DC).
					</p></div></li></ul></div><p>
			Independently of the installation mode, you can optionally share directories and printers. This enables Samba to act as a file and print server.
		</p><h2><a id="prerequisites"/>Prerequisites</h2><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
					Red Hat Enterprise Linux 8 is installed on the server.
				</li></ul></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="con_the-samba-services_assembly_using-samba-as-a-server"/>The Samba services</h1></div></div></div><p>
				Samba provides the following services:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">smbd</code></span></dt><dd><p class="simpara">
							This service provides file sharing and printing services using the SMB protocol. Additionally, the service is responsible for resource locking and for authenticating connecting users. The <code class="literal">smb</code> <code class="literal">systemd</code> service starts and stops the <code class="literal">smbd</code> daemon.
						</p><p class="simpara">
							To use the <code class="literal">smbd</code> service, install the <code class="literal">samba</code> package.
						</p></dd><dt><span class="term"><code class="literal">nmbd</code></span></dt><dd><p class="simpara">
							This service provides host name and IP resolution using the NetBIOS over IPv4 protocol. Additionally to the name resolution, the <code class="literal">nmbd</code> service enables browsing the SMB network to locate domains, work groups, hosts, file shares, and printers. For this, the service either reports this information directly to the broadcasting client or forwards it to a local or master browser. The <code class="literal">nmb</code> <code class="literal">systemd</code> service starts and stops the <code class="literal">nmbd</code> daemon.
						</p><p class="simpara">
							Note that modern SMB networks use DNS to resolve clients and IP addresses.
						</p><p class="simpara">
							To use the <code class="literal">nmbd</code> service, install the <code class="literal">samba</code> package.
						</p></dd><dt><span class="term"><code class="literal">winbindd</code></span></dt><dd><p class="simpara">
							This service provides an interface for the Name Service Switch (NSS) to use AD or NT4 domain users and groups on the local system. This enables, for example, domain users to authenticate to services hosted on a Samba server or to other local services. The <code class="literal">winbind</code> <code class="literal">systemd</code> service starts and stops the <code class="literal">winbindd</code> daemon.
						</p><p class="simpara">
							If you set up Samba as a domain member, <code class="literal">winbindd</code> must be started before the <code class="literal">smbd</code> service. Otherwise, domain users and groups are not available to the local system..
						</p><p class="simpara">
							To use the <code class="literal">winbindd</code> service, install the <code class="literal">samba-winbind</code> package.
						</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
								Red Hat only supports running Samba as a server with the <code class="literal">winbindd</code> service to provide domain users and groups to the local system. Due to certain limitations, such as missing Windows access control list (ACL) support and NT LAN Manager (NTLM) fallback, SSSD is not supported.
							</p></div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server"/>Verifying the smb.conf file by using the testparm utility</h1></div></div></div><p>
				The <code class="literal">testparm</code> utility verifies that the Samba configuration in the <code class="literal">/etc/samba/smb.conf</code> file is correct. The utility detects invalid parameters and values, but also incorrect settings, such as for ID mapping. If <code class="literal">testparm</code> reports no problem, the Samba services will successfully load the <code class="literal">/etc/samba/smb.conf</code> file. Note that <code class="literal">testparm</code> cannot verify that the configured services will be available or work as expected.
			</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
					Red Hat recommends that you verify the <code class="literal">/etc/samba/smb.conf</code> file by using <code class="literal">testparm</code> after each modification of this file.
				</p></div><h3><a id="procedure"/>Procedure</h3><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
						Run the <code class="literal">testparm</code> utility as the <code class="literal">root</code> user:
					</p><pre class="literallayout"># testparm
Load smb config files from /etc/samba/smb.conf
rlimit_max: increasing rlimit_max (1024) to minimum Windows limit (16384)
<span class="strong"><strong>Unknown parameter encountered: "log levell"</strong></span>
Processing section "[example_share]"
Loaded services file OK.
<span class="strong"><strong>ERROR: The idmap range for the domain * (tdb) overlaps with the range of DOMAIN (ad)!</strong></span>

Server role: ROLE_DOMAIN_MEMBER

Press enter to see a dump of your service definitions

# Global parameters
[global]
	...

[example_share]
	...</pre><p class="simpara">
						The previous example output reports a non-existent parameter and an incorrect ID mapping configuration.
					</p></li><li class="listitem">
						If <code class="literal">testparm</code> reports incorrect parameters, values, or other errors in the configuration, fix the problem and run the utility again.
					</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="con_the-samba-security-services_assembly_using-samba-as-a-server"/>The Samba security services</h1></div></div></div><p>
				The <code class="literal">security</code> parameter in the <code class="literal">[global]</code> section in the <code class="literal">/etc/samba/smb.conf</code> file manages how Samba authenticates users that are connecting to the service. Depending on the mode you install Samba in, the parameter must be set to different values:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">On an AD domain member, set <code class="literal">security = ads</code></span></dt><dd><p class="simpara">
							In this mode, Samba uses Kerberos to authenticate AD users.
						</p><p class="simpara">
							For details about setting up Samba as a domain member, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-samba-as-a-domain-member-server_assembly_using-samba-as-a-server" title="Setting up Samba as a domain member server">the section called “Setting up Samba as a domain member server”</a>.
						</p></dd><dt><span class="term">On a standalone server, set <code class="literal">security = user</code></span></dt><dd><p class="simpara">
							In this mode, Samba uses a local database to authenticate connecting users.
						</p><p class="simpara">
							For details about setting up Samba as a standalone server, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-samba-as-a-standalone-server_assembly_using-samba-as-a-server" title="Setting up Samba as a standalone server">the section called “Setting up Samba as a standalone server”</a>.
						</p></dd><dt><span class="term">On an NT4 PDC or BDC, set <code class="literal">security = user</code></span></dt><dd>
							In this mode, Samba authenticates users to a local or LDAP database.
						</dd><dt><span class="term">On an NT4 domain member, set <code class="literal">security = domain</code></span></dt><dd><p class="simpara">
							In this mode, Samba authenticates connecting users to an NT4 PDC or BDC. You cannot use this mode on AD domain members.
						</p><p class="simpara">
							For details about setting up Samba as a domain member, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-samba-as-a-domain-member-server_assembly_using-samba-as-a-server" title="Setting up Samba as a domain member server">the section called “Setting up Samba as a domain member server”</a>.
						</p></dd></dl></div><h3><a id="additional_resources"/>Additional resources</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						See the description of the <code class="literal">security</code> parameter in the <code class="literal">smb.conf(5)</code> man page.
					</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_setting-up-samba-as-a-standalone-server_assembly_using-samba-as-a-server"/>Setting up Samba as a standalone server</h1></div></div></div><p>
				You can set up Samba as a server that is not a member of a domain. In this installation mode, Samba authenticates users to a local database instead of to a central DC. Additionally, you can enable guest access to allow users to connect to one or multiple services without authentication.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_setting-up-the-server-configuration-for-the-standalone-server_assembly_setting-up-samba-as-a-standalone-server"/>Setting up the server configuration for the standalone server</h2></div></div></div><p>
					This section describes how to set up the server configuration for a Samba standalone server.
				</p><h4><a id="procedure_2"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Install the <code class="literal">samba</code> package:
						</p><pre class="literallayout"># yum install samba</pre></li><li class="listitem"><p class="simpara">
							Edit the <code class="literal">/etc/samba/smb.conf</code> file and set the following parameters:
						</p><pre class="literallayout">[global]
	workgroup = <span class="emphasis"><em>Example-WG</em></span>
	netbios name = <span class="emphasis"><em>Server</em></span>
	security = user

	log file = /var/log/samba/%m.log
	log level = 1</pre><p class="simpara">
							This configuration defines a standalone server named <code class="literal">Server</code> within the <code class="literal">Example-WG</code> work group. Additionally, this configuration enables logging on a minimal level (<code class="literal">1</code>) and log files will be stored in the <code class="literal">/var/log/samba/</code> directory. Samba will expand the <code class="literal">%m</code> macro in the <code class="literal">log file</code> parameter to the NetBIOS name of connecting clients. This enables individual log files for each client.
						</p></li><li class="listitem"><p class="simpara">
							Configure file or printer sharing. See:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_configuring-file-shares-on-a-samba-server_assembly_using-samba-as-a-server" title="Configuring file shares on a Samba server">the section called “Configuring file shares on a Samba server”</a>
								</li><li class="listitem">
									<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-samba-as-a-print-server_assembly_using-samba-as-a-server" title="Setting up Samba as a print server">the section called “Setting up Samba as a print server”</a>
								</li></ul></div></li><li class="listitem"><p class="simpara">
							Verify the <code class="literal">/etc/samba/smb.conf</code> file:
						</p><pre class="literallayout"># testparm</pre></li><li class="listitem">
							If you set up shares that require authentication, create the user accounts. See <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_creating-and-enabling-local-user-accounts_assembly_setting-up-samba-as-a-standalone-server" title="Creating and enabling local user accounts">the section called “Creating and enabling local user accounts”</a>.
						</li><li class="listitem"><p class="simpara">
							Open the required ports and reload the firewall configuration by using the <code class="literal">firewall-cmd</code> utility:
						</p><pre class="literallayout"># firewall-cmd --permanent --add-port={139/tcp,445/tcp}
# firewall-cmd --reload</pre></li><li class="listitem"><p class="simpara">
							Start the <code class="literal">smb</code> service:
						</p><pre class="literallayout"># systemctl start smb</pre><p class="simpara">
							Optionally, enable the <code class="literal">smb</code> service to start automatically when the system boots:
						</p><pre class="literallayout"># systemctl enable smb</pre></li></ol></div><h4><a id="additional_resources_2"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							For further details about the parameters used in the procedure, see the descriptions of the parameters in the <code class="literal">smb.conf(5)</code> man page.
						</li><li class="listitem">
							<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="Verifying the smb.conf file by using the testparm utility">the section called “Verifying the smb.conf file by using the testparm utility”</a>
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_creating-and-enabling-local-user-accounts_assembly_setting-up-samba-as-a-standalone-server"/>Creating and enabling local user accounts</h2></div></div></div><p>
					To enable users to authenticate when they connect to a share, you must create the accounts on the Samba host both in the operating system and in the Samba database. Samba requires the operating system account to validate the Access Control Lists (ACL) on file system objects and the Samba account to authenticate connecting users.
				</p><p>
					If you use the <code class="literal">passdb backend = tdbsam</code> default setting, Samba stores user accounts in the <code class="literal">/var/lib/samba/private/passdb.tdb</code> database.
				</p><p>
					The procedure in this section describes how to create a local Samba user named <code class="literal">example</code>.
				</p><h4><a id="prerequisites_2"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Samba is installed configured as a standalone server.
						</li></ul></div><h4><a id="procedure_3"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Create the operating system account:
						</p><pre class="literallayout"># useradd -M -s /sbin/nologin example</pre><p class="simpara">
							This command adds the <code class="literal">example</code> account without creating a home directory. If the account is only used to authenticate to Samba, assign the <code class="literal">/sbin/nologin</code> command as shell to prevent the account from logging in locally.
						</p></li><li class="listitem"><p class="simpara">
							Set a password to the operating system account to enable it:
						</p><pre class="literallayout"># passwd example
Enter new UNIX password: <span class="emphasis"><em>password</em></span>
Retype new UNIX password: <span class="emphasis"><em>password</em></span>
passwd: password updated successfully</pre><p class="simpara">
							Samba does not use the password set on the operating system account to authenticate. However, you need to set a password to enable the account. If an account is disabled, Samba denies access if this user connects.
						</p></li><li class="listitem"><p class="simpara">
							Add the user to the Samba database and set a password to the account:
						</p><pre class="literallayout"># smbpasswd -a example
New SMB password: <span class="emphasis"><em>password</em></span>
Retype new SMB password: <span class="emphasis"><em>password</em></span>
Added user example.</pre><p class="simpara">
							Use this password to authenticate when using this account to connect to a Samba share.
						</p></li><li class="listitem"><p class="simpara">
							Enable the Samba account:
						</p><pre class="literallayout"># smbpasswd -e example
Enabled user example.</pre></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_setting-up-samba-as-a-domain-member-server_assembly_using-samba-as-a-server"/>Setting up Samba as a domain member server</h1></div></div></div><p>
				If you are running an AD or NT4 domain, use Samba to add your Red Hat Enterprise Linux server as a member to the domain to gain the following:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						Access domain resources on other domain members
					</li><li class="listitem">
						Authenticate domain users to local services, such as <code class="literal">sshd</code>
					</li><li class="listitem">
						Share directories and printers hosted on the server to act as a file and print server
					</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_joining-samba-to-a-domain_assembly_setting-up-samba-as-a-domain-member-server"/>Joining Samba to a Domain</h2></div></div></div><p>
					This section describes how to join a Red Hat Enterprise Linux system to a domain.
				</p><h4><a id="procedure_4"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Install the following packages:
						</p><pre class="literallayout"># yum install realmd oddjob-mkhomedir oddjob samba-winbind-clients \
       samba-winbind samba-common-tools samba</pre></li><li class="listitem"><p class="simpara">
							To share directories or printers on the domain member, install the <code class="literal">samba</code> package:
						</p><pre class="literallayout"># yum install samba</pre></li><li class="listitem"><p class="simpara">
							If you are joining an AD, additionally install the Winbind Kerberos locator plug-in:
						</p><pre class="literallayout"># yum install samba-winbind-krb5-locator</pre><p class="simpara">
							This plug-in enables Kerberos to locate the Key Distribution Center (KDC) based on AD sites using DNS service records.
						</p></li><li class="listitem"><p class="simpara">
							Optionally, for backup purposes, rename the existing <code class="literal">/etc/samba/smb.conf</code> Samba configuration file:
						</p><pre class="literallayout"># mv /etc/samba/smb.conf /etc/samba/smb.conf.old</pre></li><li class="listitem"><p class="simpara">
							Join the domain. For example, to join a domain named <code class="literal">ad.example.com</code>:
						</p><pre class="literallayout"># realm join --client-software=winbind ad.example.com</pre><p class="simpara">
							Using the previous command, the <code class="literal">realm</code> utility automatically:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									Creates a <code class="literal">/etc/samba/smb.conf</code> file for a membership in the <code class="literal">ad.example.com</code> domain
								</li><li class="listitem">
									Adds the <code class="literal">winbind</code> module for user and group lookups to the <code class="literal">/etc/nsswitch.conf</code> file
								</li><li class="listitem">
									Updates the Pluggable Authentication Module (PAM) configuration files in the <code class="literal">/etc/pam.d/</code> directory
								</li><li class="listitem">
									Starts the <code class="literal">winbind</code> service and enables the service to start when the system boots
								</li></ul></div></li><li class="listitem">
							Optionally, set an alternative ID mapping back end or customized ID mapping settings in the <code class="literal">/etc/samba/smb.conf</code> file. For details, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_samba-id-mapping_assembly_setting-up-samba-as-a-domain-member-server" title="Samba ID mapping">the section called “Samba ID mapping”</a>.
						</li><li class="listitem">
							Optionally, verify the configuration. See <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-that-samba-was-correctly-joined-as-a-domain-member_assembly_setting-up-samba-as-a-domain-member-server" title="Verifying that Samba was correctly joined as a domain member">the section called “Verifying that Samba was correctly joined as a domain member”</a>.
						</li><li class="listitem"><p class="simpara">
							Verify that the <code class="literal">winbind</code> service is running:
						</p><pre class="literallayout"># systemctl status winbind
...
   Active: active (running) since Tue 2018-11-06 19:10:40 CET; 15s ago</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
								To enable Samba to query domain user and group information, the <code class="literal">winbind</code> service must be running before you start <code class="literal">smb</code>.
							</p></div></li><li class="listitem"><p class="simpara">
							If you installed the <code class="literal">samba</code> package to share directories and printers, start the <code class="literal">smb</code> service:
						</p><pre class="literallayout"># systemctl start smb</pre></li><li class="listitem">
							Optionally, if you are authenticating local logins to Active Directory, enable the <code class="literal">winbind_krb5_localauth</code> plug-in. See <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#using-the-local-authorization-plug-in-for-mit-kerberos_assembly_setting-up-samba-as-a-domain-member-server" title="Using the local authorization plug-in for MIT Kerberos">the section called “Using the local authorization plug-in for MIT Kerberos”</a>.
						</li></ol></div><h4><a id="additional_resources_3"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							For further details about the <code class="literal">realm</code> utility, see
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									The <code class="literal">realm(8)</code> man page
								</li></ul></div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_verifying-that-samba-was-correctly-joined-as-a-domain-member_assembly_setting-up-samba-as-a-domain-member-server"/>Verifying that Samba was correctly joined as a domain member</h2></div></div></div><p>
					To verify you added your Red Hat Enterprise Linux correctly to your domain perform the tests described in this section on the domain member.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="verifying-that-the-operating-system-can-retrieve-domain-user-accounts-and-groups_assembly_setting-up-samba-as-a-domain-member-server"/>Verifying that the operating system can retrieve domain user accounts and groups</h3></div></div></div><p>
						Use the <code class="literal">getent</code> and <code class="literal">chown</code> utilities to verify that the operating system can retrieve domain users and groups
					</p><h5><a id="procedure_5"/>Procedure</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								To query the <code class="literal">administrator</code> account in the <code class="literal">AD</code> domain:
							</p><pre class="literallayout"># getent passwd "AD\administrator"
AD\administrator:*:10000:10000::/home/administrator@AD:/bin/bash</pre></li><li class="listitem"><p class="simpara">
								To query the members of the <code class="literal">Domain Users</code> group in the <code class="literal">AD</code> domain:
							</p><pre class="literallayout"># getent group "AD\Domain Users"
AD\domain users:x:10000:<span class="emphasis"><em>user1</em></span>,<span class="emphasis"><em>user2</em></span></pre></li><li class="listitem"><p class="simpara">
								Verify that you can use domain users and groups when you set permissions on files and directories. For example, to set the owner of the <code class="literal">/srv/samba/example.txt</code> file to <code class="literal">AD\administrator</code> and the group to <code class="literal">AD\Domain Users</code>:
							</p><pre class="literallayout"># chown "AD\administrator":"AD\Domain Users" /srv/samba/example.txt</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="verifying-if-ad-domain-users-can-obtain-a-kerberos-ticket_assembly_setting-up-samba-as-a-domain-member-server"/>Verifying if AD domain users can obtain a Kerberos ticket</h3></div></div></div><p>
						In an AD environment, users can obtain a Kerberos ticket from the DC.
					</p><p>
						The procedure in this section describes how to verify if the <code class="literal">administrator</code> user can obtain a Kerberos ticket.
					</p><h5><a id="prerequisites_3"/>Prerequisites</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								Install the <code class="literal">krb5-workstation</code> package on the Samba domain member
							</li></ul></div><h5><a id="procedure_6"/>Procedure</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								On the AD domain member, obtain a ticket for the <a class="link" href="mailto:administrator@AD.EXAMPLE.COM">administrator@AD.EXAMPLE.COM</a> principal:
							</p><pre class="literallayout"># kinit administrator@AD.EXAMPLE.COM</pre></li><li class="listitem"><p class="simpara">
								Display the cached Kerberos ticket:
							</p><pre class="literallayout"># klist
Ticket cache: KCM:0
Default principal: administrator@AD.EXAMPLE.COM

Valid starting       Expires              Service principal
01.11.2018 10:00:00  01.11.2018 20:00:00  krbtgt/AD.EXAMPLE.COM@AD.EXAMPLE.COM
        renew until 08.11.2018 05:00:00</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="listing-the-available-domains_assembly_setting-up-samba-as-a-domain-member-server"/>Listing the available domains</h3></div></div></div><p>
						Use the <code class="literal">wbinfo</code> utility to list all domains available through the <code class="literal">winbindd</code> service.
					</p><h5><a id="procedure_7"/>Procedure</h5><pre class="literallayout"># wbinfo --all-domains</pre><p>
						If Samba was successfully joined as a domain member, the command displays the built-in and local host name, as well as the domain Samba is a member of including trusted domains.
					</p><div class="example"><a id="idm140241874389552"/><p class="title"><strong>Example 2.1. Displaying the available domains</strong></p><div class="example-contents"><p>
							The following is an example of the <code class="literal">wbinfo --all-domains</code> command’s output:
						</p><pre class="literallayout"># wbinfo --all-domains
BUILTIN
SAMBA-SERVER
AD</pre></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="using-the-local-authorization-plug-in-for-mit-kerberos_assembly_setting-up-samba-as-a-domain-member-server"/>Using the local authorization plug-in for MIT Kerberos</h2></div></div></div><p>
					The <code class="literal">winbind</code> service provides Active Directory users to the domain member. In certain situations, administrators want to enable domain users to authenticate to local services, such as an SSH server, which are running on the domain member. When using Kerberos to authenticate the domain users, enable the <code class="literal">winbind_krb5_localauth</code> plug-in to correctly map Kerberos principals to Active Directory accounts through the <code class="literal">winbind</code> service.
				</p><p>
					For example, if the <code class="literal">sAMAccountName</code> attribute of an Active Directory user is set to <code class="literal">EXAMPLE</code> and the user tries to log with the user name lowercase, Kerberos returns the user name in upper case. As a consequence, the entries do not match an authentication fails.
				</p><p>
					Using the <code class="literal">winbind_krb5_localauth</code> plug-in, the account names are mapped correctly. Note that this only applies to GSSAPI authentication and not for getting the initial ticket granting ticket (TGT).
				</p><h4><a id="prerequisites_4"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Samba is configured as a member of an Active Directory.
						</li><li class="listitem">
							Red Hat Enterprise Linux authenticates log in attempts against Active Directory.
						</li><li class="listitem">
							The <code class="literal">winbind</code> service is running.
						</li></ul></div><h4><a id="procedure_8"/>Procedure</h4><p>
					Edit the <code class="literal">/etc/krb5.conf</code> file and add the following section:
				</p><pre class="literallayout">[plugins]
localauth = {
     module = winbind:/usr/lib64/samba/krb5/winbind_krb5_localauth.so
     enable_only = winbind
}</pre><h4><a id="additional_resources_4"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							See the <code class="literal">winbind_krb5_localauth(8)</code> man page.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assembly_samba-id-mapping_assembly_setting-up-samba-as-a-domain-member-server"/>Samba ID mapping</h2></div></div></div><p>
					Windows domains distinguish users and groups by unique Security Identifiers (SID). However, Linux requires unique UIDs and GIDs for each user and group. If you run Samba as a domain member, the <code class="literal">winbindd</code> service is responsible for providing information about domain users and groups to the operating system.
				</p><p>
					To enable the <code class="literal">winbindd</code> service to provide unique IDs for users and groups to Linux, you must configure ID mapping in the <code class="literal">/etc/samba/smb.conf</code> file for:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The local database (default domain)
						</li><li class="listitem">
							The AD or NT4 domain the Samba server is a member of
						</li><li class="listitem">
							Each trusted domain from which users must be able to access resources on this Samba server
						</li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="con_planning-samba-id-ranges_assembly_samba-id-mapping"/>Planning Samba ID ranges</h3></div></div></div><p>
						Regardless of whether you store the Linux UIDs and GIDs in AD or if you configure Samba to generate them, each domain configuration requires a unique ID range that must not overlap with any of the other domains.
					</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
							If you set overlapping ID ranges, Samba fails to work correctly.
						</p></div><div class="example"><a id="idm140241853192928"/><p class="title"><strong>Example 2.2. Unique ID Ranges</strong></p><div class="example-contents"><p>
							The following shows non-overlapping ID mapping ranges for the default (<code class="literal">*</code>), <code class="literal">AD-DOM</code>, and the <code class="literal">TRUST-DOM</code> domains.
						</p><pre class="literallayout">[global]
...
idmap config * : backend = tdb
idmap config * : range = 10000-999999

idmap config AD-DOM:backend = rid
idmap config AD-DOM:range = 2000000-2999999

idmap config TRUST-DOM:backend = rid
idmap config TRUST-DOM:range = 4000000-4999999</pre></div></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							You can only assign one range per domain. Therefore, leave enough space between the domains ranges. This enables you to extend the range later if your domain grows.
						</p><p>
							If you later assign a different range to a domain, the ownership of files and directories previously created by these users and groups will be lost.
						</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="con_the-asterisk-default-domain_assembly_samba-id-mapping"/>The * default domain</h3></div></div></div><p>
						In a domain environment, you add one ID mapping configuration for each of the following:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								The domain the Samba server is a member of
							</li><li class="listitem">
								Each trusted domain that should be able to access the Samba server
							</li></ul></div><p>
						However, for all other objects, Samba assigns IDs from the default domain. This includes:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								Local Samba users and groups
							</li><li class="listitem">
								Samba built-in accounts and groups, such as <code class="literal">BUILTIN\Administrators</code>
							</li></ul></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							You must configure the default domain as described in this section to enable Samba to operate correctly.
						</p></div><p>
						The default domain back end must be writable to permanently store the assigned IDs.
					</p><p>
						For the default domain, you can use one of the following back ends:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">tdb</code></span></dt><dd><p class="simpara">
									When you configure the default domain to use the <code class="literal">tdb</code> back end, set an ID range that is big enough to include objects that will be created in the future and that are not part of a defined domain ID mapping configuration.
								</p><p class="simpara">
									For example, set the following in the <code class="literal">[global]</code> section in the <code class="literal">/etc/samba/smb.conf</code> file:
								</p><pre class="literallayout">idmap config * : backend = tdb
idmap config * : range = 10000-999999</pre><p class="simpara">
									For further details, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_using-the-tdb-id-mapping-back-end_assembly_the-different-samba-id-mapping-back-ends" title="Using the tdb ID mapping back end">the section called “Using the tdb ID mapping back end”</a>.
								</p></dd><dt><span class="term"><code class="literal">autorid</code></span></dt><dd><p class="simpara">
									When you configure the default domain to use the <code class="literal">autorid</code> back end, adding additional ID mapping configurations for domains is optional.
								</p><p class="simpara">
									For example, set the following in the <code class="literal">[global]</code> section in the <code class="literal">/etc/samba/smb.conf</code> file:
								</p><pre class="literallayout">idmap config * : backend = autorid
idmap config * : range = 10000-999999</pre><p class="simpara">
									For further details, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_using-the-autorid-id-mapping-back-end_assembly_the-different-samba-id-mapping-back-ends" title="Using the autorid ID mapping back end">the section called “Using the autorid ID mapping back end”</a>.
								</p></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assembly_the-different-samba-id-mapping-back-ends_assembly_setting-up-samba-as-a-domain-member-server"/>The different Samba ID mapping back ends</h2></div></div></div><p>
					Samba provides different ID mapping back ends for specific configurations. The most frequently used back ends are:
				</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Back end</th><th style="text-align: left" valign="top">Use case</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
									<code class="literal">tdb</code>
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									The <code class="literal">*</code> default domain only
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									<code class="literal">ad</code>
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									AD domains only
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									<code class="literal">rid</code>
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									AD and NT4 domains
								</p>
								 </td></tr><tr><td style="text-align: left" valign="top"> <p>
									<code class="literal">autorid</code>
								</p>
								 </td><td style="text-align: left" valign="top"> <p>
									AD, NT4, and the <code class="literal">*</code> default domain
								</p>
								 </td></tr></tbody></table></div><p>
					The following sections describe the benefits, recommended scenarios where to use the back end, and how to configure it.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_using-the-tdb-id-mapping-back-end_assembly_the-different-samba-id-mapping-back-ends"/>Using the tdb ID mapping back end</h3></div></div></div><p>
						The <code class="literal">winbindd</code> service uses the writable <code class="literal">tdb</code> ID mapping back end by default to store Security Identifier (SID), UID, and GID mapping tables. This includes local users, groups, and built-in principals.
					</p><p>
						Use this back end only for the <code class="literal">*</code> default domain. For example:
					</p><pre class="literallayout">idmap config * : backend = tdb
idmap config * : range = 10000-999999</pre><h5><a id="additional_resources_5"/>Additional resources</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#con_the-asterisk-default-domain_assembly_samba-id-mapping" title="The * default domain">the section called “The * default domain”</a>.
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_using-the-ad-id-mapping-back-end_assembly_the-different-samba-id-mapping-back-ends"/>Using the ad ID mapping back end</h3></div></div></div><p>
						This section describes how to configure a Samba AD member to use the <code class="literal">ad</code> ID mapping back end.
					</p><p>
						The <code class="literal">ad</code> ID mapping back end implements a read-only API to read account and group information from AD. This provides the following benefits:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								All user and group settings are stored centrally in AD.
							</li><li class="listitem">
								User and group IDs are consistent on all Samba servers that use this back end.
							</li><li class="listitem">
								The IDs are not stored in a local database which can corrupt, and therefore file ownerships cannot be lost.
							</li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							The <code class="literal">ad</code> ID mapping back end does not support Active Directory domains with one-way trusts. If you configure a domain member in an Active Directory with one-way trusts, use instead one of the following ID mapping back ends: <code class="literal">tdb</code>, <code class="literal">rid</code>, or <code class="literal">autorid</code>.
						</p></div><p>
						The ad back end reads the following attributes from AD:
					</p><div class="informaltable"><a id="table_proc_using-the-ad-id-mapping-back-end_assembly_the-different-samba-id-mapping-back-ends"/><table border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">AD attribute name</th><th style="text-align: left" valign="top">Object type</th><th style="text-align: left" valign="top">Mapped to</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">sAMAccountName</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										User and group
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										User or group name, depending on the object
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">uidNumber</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										User
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										User ID (UID)
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">gidNumber</code>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										Group
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										Group ID (GID)
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">loginShell</code> <a href="#ftn.sambaloginshell" class="footnote" id="sambaloginshell"><sup class="footnote">[a]</sup></a>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										User
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										Path to the shell of the user
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">unixHomeDirectory</code> <a href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#ftn.sambaloginshell" class="footnoteref"><sup class="footnoteref">[a]</sup></a>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										User
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										Path to the home directory of the user
									</p>
									 </td></tr><tr><td style="text-align: left" valign="top"> <p>
										<code class="literal">primaryGroupID</code> <a href="#ftn.samba_primarygroupid" class="footnote" id="samba_primarygroupid"><sup class="footnote">[b]</sup></a>
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										User
									</p>
									 </td><td style="text-align: left" valign="top"> <p>
										Primary group ID
									</p>
									 </td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div id="ftn.sambaloginshell" class="footnote"><p><a href="#sambaloginshell" class="simpara"><sup class="simpara">[a] </sup></a>
											Samba only reads this attribute if you set <code class="literal">idmap config <span class="emphasis"><em>DOMAIN</em></span>:unix_nss_info = yes</code>.
										</p></div><div id="ftn.samba_primarygroupid" class="footnote"><p><a href="#samba_primarygroupid" class="simpara"><sup class="simpara">[b] </sup></a>
											Samba only reads this attribute if you set <code class="literal">idmap config <span class="emphasis"><em>DOMAIN</em></span>:unix_primary_group = yes</code>.
										</p></div></td></tr></tbody></table></div><h5><a id="prerequisites_5"/>Prerequisites</h5><p>
						To use the <code class="literal">ad</code> ID mapping back end:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								Both users and groups must have unique IDs set in AD, and the IDs must be within the range configured in the <code class="literal">/etc/samba/smb.conf</code> file. Objects whose IDs are outside of the range will not be available on the Samba server.
							</li><li class="listitem">
								Users and groups must have all required attributes set in AD. If required attributes are missing, the user or group will not be available on the Samba server. The required attributes depend on your configuration.
							</li></ul></div><h5><a id="procedure_9"/>Procedure</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Edit the <code class="literal">[global]</code> section in the <code class="literal">/etc/samba/smb.conf</code> file:
							</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
										Add an ID mapping configuration for the default domain (<code class="literal">*</code>) if it does not exist. For example:
									</p><pre class="literallayout">idmap config * : backend = tdb
idmap config * : range = <span class="emphasis"><em>10000-999999</em></span></pre></li><li class="listitem"><p class="simpara">
										Enable the <code class="literal">ad</code> ID mapping back end for the AD domain:
									</p><pre class="literallayout">idmap config <span class="emphasis"><em>DOMAIN</em></span> : backend = ad</pre></li><li class="listitem"><p class="simpara">
										Set the range of IDs that is assigned to users and groups in the AD domain. For example:
									</p><pre class="literallayout">idmap config <span class="emphasis"><em>DOMAIN</em></span> : range = <span class="emphasis"><em>2000000-2999999</em></span></pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
											The range must not overlap with any other domain configuration on this server. Additionally, the range must be set big enough to include all IDs assigned in the future. For further details, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#con_planning-samba-id-ranges_assembly_samba-id-mapping" title="Planning Samba ID ranges">the section called “Planning Samba ID ranges”</a>.
										</p></div></li><li class="listitem"><p class="simpara">
										Set that Samba uses the <a class="link" href="https://tools.ietf.org/html/rfc2307">RFC 2307</a> schema when reading attributes from AD:
									</p><pre class="literallayout">idmap config <span class="emphasis"><em>DOMAIN</em></span> : schema_mode = rfc2307</pre></li><li class="listitem"><p class="simpara">
										To enable Samba to read the login shell and the path to the users home directory from the corresponding AD attribute, set:
									</p><pre class="literallayout">idmap config <span class="emphasis"><em>DOMAIN</em></span> : unix_nss_info = yes</pre><p class="simpara">
										Alternatively, you can set a uniform domain-wide home directory path and login shell that is applied to all users. For example:
									</p><pre class="literallayout">template shell = <span class="emphasis"><em>/bin/bash</em></span>
template homedir = <span class="emphasis"><em>/home/%U</em></span></pre></li><li class="listitem"><p class="simpara">
										By default, Samba uses the <code class="literal">primaryGroupID</code> attribute of a user object as the user’s primary group on Linux. Alternatively, you can configure Samba to use the value set in the <code class="literal">gidNumber</code> attribute instead:
									</p><pre class="literallayout">idmap config <span class="emphasis"><em>DOMAIN</em></span> : unix_primary_group = yes</pre></li></ol></div></li><li class="listitem"><p class="simpara">
								Verify the <code class="literal">/etc/samba/smb.conf</code> file:
							</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">
								Reload the Samba configuration:
							</p><pre class="literallayout"># smbcontrol all reload-config</pre></li><li class="listitem">
								Verify that the settings work as expected. See <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#verifying-that-the-operating-system-can-retrieve-domain-user-accounts-and-groups_assembly_setting-up-samba-as-a-domain-member-server" title="Verifying that the operating system can retrieve domain user accounts and groups">the section called “Verifying that the operating system can retrieve domain user accounts and groups”</a>.
							</li></ol></div><h5><a id="additional_resources_6"/>Additional resources</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#con_the-asterisk-default-domain_assembly_samba-id-mapping" title="The * default domain">the section called “The * default domain”</a>
							</li><li class="listitem">
								For further details about the parameters used in the procedure, see the <code class="literal">smb.conf(5)</code> and <code class="literal">idmap_ad(8)</code> man pages.
							</li><li class="listitem">
								For details about variable substitution, see the <code class="literal">VARIABLE SUBSTITUTIONS</code> section in the <code class="literal">smb.conf(5)</code> man page.
							</li><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="Verifying the smb.conf file by using the testparm utility">the section called “Verifying the smb.conf file by using the testparm utility”</a>
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_using-the-rid-id-mapping-back-end_assembly_the-different-samba-id-mapping-back-ends"/>Using the rid ID mapping back end</h3></div></div></div><p>
						This section describes how to configure a Samba domain member to use the <code class="literal">rid</code> ID mapping back end.
					</p><p>
						Samba can use the relative identifier (RID) of a Windows SID to generate an ID on Red Hat Enterprise Linux.
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							The RID is the last part of a SID. For example, if the SID of a user is <code class="literal">S-1-5-21-5421822485-1151247151-421485315-30014</code>, then <code class="literal">30014</code> is the corresponding RID.
						</p></div><p>
						The <code class="literal">rid</code> ID mapping back end implements a read-only API to calculate account and group information based on an algorithmic mapping scheme for AD and NT4 domains. When you configure the back end, you must set the lowest and highest RID in the <code class="literal">idmap config <span class="emphasis"><em>DOMAIN</em></span> : <span class="emphasis"><em>range</em></span></code> parameter. Samba will not map users or groups with a lower or higher RID than set in this parameter.
					</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							As a read-only back end, <code class="literal">rid</code> cannot assign new IDs, such as for <code class="literal">BUILTIN</code> groups. Therefore, do not use this back end for the <code class="literal">*</code> default domain.
						</p></div><h5><a id="benefits_of_using_the_rid_back_end"/>Benefits of using the rid back end</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								All domain users and groups that have an RID within the configured range are automatically available on the domain member.
							</li><li class="listitem">
								You do not need to manually assign IDs, home directories, and login shells.
							</li></ul></div><h5><a id="drawbacks_of_using_the_rid_back_end"/>Drawbacks of using the rid back end</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								All domain users get the same login shell and home directory assigned. However, you can use variables.
							</li><li class="listitem">
								User and group IDs are only the same across Samba domain members if all use the <code class="literal">rid</code> back end with the same ID range settings.
							</li><li class="listitem">
								You cannot exclude individual users or groups from being available on the domain member. Only users and groups outside of the configured range are excluded.
							</li><li class="listitem">
								Based on the formulas the <code class="literal">winbindd</code> service uses to calculate the IDs, duplicate IDs can occur in multi-domain environments if objects in different domains have the same RID.
							</li></ul></div><h5><a id="procedure_10"/>Procedure</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Edit the <code class="literal">[global]</code> section in the <code class="literal">/etc/samba/smb.conf</code> file:
							</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
										Add an ID mapping configuration for the default domain (<code class="literal">*</code>) if it does not exist. For example:
									</p><pre class="literallayout">idmap config * : backend = tdb
idmap config * : range = <span class="emphasis"><em>10000-999999</em></span></pre></li><li class="listitem"><p class="simpara">
										Enable the <code class="literal">rid</code> ID mapping back end for the domain:
									</p><pre class="literallayout">idmap config <span class="emphasis"><em>DOMAIN</em></span> : backend = rid</pre></li><li class="listitem"><p class="simpara">
										Set a range that is big enough to include all RIDs that will be assigned in the future. For example:
									</p><pre class="literallayout">idmap config <span class="emphasis"><em>DOMAIN</em></span> : range = <span class="emphasis"><em>2000000-2999999</em></span></pre><p class="simpara">
										Samba ignores users and groups whose RIDs in this domain are not within the range.
									</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
											The range must not overlap with any other domain configuration on this server. For further details, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#con_planning-samba-id-ranges_assembly_samba-id-mapping" title="Planning Samba ID ranges">the section called “Planning Samba ID ranges”</a>.
										</p></div></li><li class="listitem"><p class="simpara">
										Set a shell and home directory path that will be assigned to all mapped users. For example:
									</p><pre class="literallayout">template shell = <span class="emphasis"><em>/bin/bash</em></span>
template homedir = <span class="emphasis"><em>/home/%U</em></span></pre></li></ol></div></li><li class="listitem"><p class="simpara">
								Verify the <code class="literal">/etc/samba/smb.conf</code> file:
							</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">
								Reload the Samba configuration:
							</p><pre class="literallayout"># smbcontrol all reload-config</pre><p class="simpara">
								Verify that the settings work as expected. See <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#verifying-that-the-operating-system-can-retrieve-domain-user-accounts-and-groups_assembly_setting-up-samba-as-a-domain-member-server" title="Verifying that the operating system can retrieve domain user accounts and groups">the section called “Verifying that the operating system can retrieve domain user accounts and groups”</a>.
							</p></li></ol></div><h5><a id="additional_resources_7"/>Additional resources</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#con_the-asterisk-default-domain_assembly_samba-id-mapping" title="The * default domain">the section called “The * default domain”</a>
							</li><li class="listitem">
								For details about variable substitution, see the <code class="literal">VARIABLE SUBSTITUTIONS</code> section in the <code class="literal">smb.conf(5)</code> man page.
							</li><li class="listitem">
								For details, how Samba calculates the local ID from a RID, see the <code class="literal">idmap_rid(8)</code> man page.
							</li><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="Verifying the smb.conf file by using the testparm utility">the section called “Verifying the smb.conf file by using the testparm utility”</a>
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_using-the-autorid-id-mapping-back-end_assembly_the-different-samba-id-mapping-back-ends"/>Using the autorid ID mapping back end</h3></div></div></div><p>
						This section describes how to configure a Samba domain member to use the <code class="literal">autorid</code> ID mapping back end.
					</p><p>
						The <code class="literal">autorid</code> back end works similar to the <code class="literal">rid</code> ID mapping back end, but can automatically assign IDs for different domains. This enables you to use the <code class="literal">autorid</code> back end in the following situations:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								Only for the <code class="literal">*</code> default domain
							</li><li class="listitem">
								For the <code class="literal">*</code> default domain and additional domains, without the need to create ID mapping configurations for each of the additional domains
							</li><li class="listitem">
								Only for specific domains
							</li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							If you use <code class="literal">autorid</code> for the default domain, adding additional ID mapping configuration for domains is optional.
						</p></div><p>
						Parts of this section were adopted from the <a class="link" href="https://wiki.samba.org/index.php/Idmap_config_autorid">idmap config autorid</a> documentation published in the Samba Wiki. License: <a class="link" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. Authors and contributors: See the <a class="link" href="https://wiki.samba.org/index.php?title=Idmap_config_autorid&amp;action=history">history</a> tab on the Wiki page.
					</p><h5><a id="benefits_of_using_the_autorid_back_end"/>Benefits of using the autorid back end</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								All domain users and groups whose calculated UID and GID is within the configured range are automatically available on the domain member.
							</li><li class="listitem">
								You do not need to manually assign IDs, home directories, and login shells.
							</li><li class="listitem">
								No duplicate IDs, even if multiple objects in a multi-domain environment have the same RID.
							</li></ul></div><h5><a id="drawbacks"/>Drawbacks</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								User and group IDs are not the same across Samba domain members.
							</li><li class="listitem">
								All domain users get the same login shell and home directory assigned. However, you can use variables.
							</li><li class="listitem">
								You cannot exclude individual users or groups from being available on the domain member. Only users and groups whose calculated UID or GID is outside of the configured range are excluded.
							</li></ul></div><h5><a id="procedure_11"/>Procedure</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Edit the <code class="literal">[global]</code> section in the <code class="literal">/etc/samba/smb.conf</code> file:
							</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
										Enable the <code class="literal">autorid</code> ID mapping back end for the <code class="literal">*</code> default domain:
									</p><pre class="literallayout">idmap config * : backend = autorid</pre></li><li class="listitem"><p class="simpara">
										Set a range that is big enough to assign IDs for all existing and future objects. For example:
									</p><pre class="literallayout">idmap config * : range = <span class="emphasis"><em>10000-999999</em></span></pre><p class="simpara">
										Samba ignores users and groups whose calculated IDs in this domain are not within the range.
									</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
											After you set the range and Samba starts using it, you can only increase the upper limit of the range. Any other change to the range can result in new ID assignments, and thus in losing file ownerships.
										</p></div></li><li class="listitem"><p class="simpara">
										Optionally, set a range size. For example:
									</p><pre class="literallayout">idmap config * : rangesize = <span class="emphasis"><em>200000</em></span></pre><p class="simpara">
										Samba assigns this number of continuous IDs for each domain’s object until all IDs from the range set in the <code class="literal">idmap config * : <span class="emphasis"><em>range</em></span></code> parameter are taken.
									</p></li><li class="listitem"><p class="simpara">
										Set a shell and home directory path that will be assigned to all mapped users. For example:
									</p><pre class="literallayout">template shell = <span class="emphasis"><em>/bin/bash</em></span>
template homedir = <span class="emphasis"><em>/home/%U</em></span></pre></li><li class="listitem"><p class="simpara">
										Optionally, add additional ID mapping configuration for domains. If no configuration for an individual domain is available, Samba calculates the ID using the <code class="literal">autorid</code> back end settings in the previously configured <code class="literal">*</code> default domain.
									</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
											If you configure additional back ends for individual domains, the ranges for all ID mapping configuration must not overlap. For further details, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#con_planning-samba-id-ranges_assembly_samba-id-mapping" title="Planning Samba ID ranges">the section called “Planning Samba ID ranges”</a>.
										</p></div></li></ol></div></li><li class="listitem"><p class="simpara">
								Verify the <code class="literal">/etc/samba/smb.conf</code> file:
							</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">
								Reload the Samba configuration:
							</p><pre class="literallayout"># smbcontrol all reload-config</pre></li><li class="listitem">
								Verify that the settings work as expected. See <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#verifying-that-the-operating-system-can-retrieve-domain-user-accounts-and-groups_assembly_setting-up-samba-as-a-domain-member-server" title="Verifying that the operating system can retrieve domain user accounts and groups">the section called “Verifying that the operating system can retrieve domain user accounts and groups”</a>.
							</li></ol></div><h5><a id="additional_resources_8"/>Additional resources</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								For details about how the back end calculated IDs, see the <code class="literal">THE MAPPING FORMULAS</code> section in the <code class="literal">idmap_autorid(8)</code> man page.
							</li><li class="listitem">
								For details about using the <code class="literal">idmap config</code> <code class="literal">rangesize</code> parameter, see the <code class="literal">rangesize</code> parameter description in the <code class="literal">idmap_autorid(8)</code> man page.
							</li><li class="listitem">
								For details about variable substitution, see the <code class="literal">VARIABLE SUBSTITUTIONS</code> section in the <code class="literal">smb.conf(5)</code> man page.
							</li><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="Verifying the smb.conf file by using the testparm utility">the section called “Verifying the smb.conf file by using the testparm utility”</a>
							</li></ul></div></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_configuring-file-shares-on-a-samba-server_assembly_using-samba-as-a-server"/>Configuring file shares on a Samba server</h1></div></div></div><p>
				To use Samba as a file server, add shares to the <code class="literal">/etc/samba/smb.conf</code> file of your standalone server or domain member configuration.
			</p><p>
				You can add shares that uses either:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						POSIX ACLs. See <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-a-share-that-uses-posix-acls_assembly_configuring-file-shares-on-a-samba-server" title="Setting up a share that uses POSIX ACLs">the section called “Setting up a share that uses POSIX ACLs”</a>.
					</li><li class="listitem">
						Fine-granular Windows ACLs. See <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-a-share-that-uses-windows-acls_assembly_configuring-file-shares-on-a-samba-server" title="Setting up a share that uses Windows ACLs">the section called “Setting up a share that uses Windows ACLs”</a>.
					</li></ul></div><h3><a id="prerequisites-assembly_configuring-file-shares-on-a-samba-server"/>Prerequisites</h3><p>
				Samba has been set up in one of the following modes:
			</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						<a class="link" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-samba-as-a-standalone-server_assembly_using-samba-as-a-server" title="Setting up Samba as a standalone server">Standalone server</a>
					</li><li class="listitem">
						<a class="link" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-samba-as-a-domain-member-server_assembly_using-samba-as-a-server" title="Setting up Samba as a domain member server">Domain member</a>
					</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assembly_setting-up-a-share-that-uses-posix-acls_assembly_configuring-file-shares-on-a-samba-server"/>Setting up a share that uses POSIX ACLs</h2></div></div></div><p>
					As a Linux service, Samba supports shares with POSIX ACLs. They enable you to manage permissions locally on the Samba server using utilities, such as <code class="literal">chmod</code>. If the share is stored on a file system that supports extended attributes, you can define ACLs with multiple users and groups.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						If you need to use fine-granular Windows ACLs instead, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-a-share-that-uses-windows-acls_assembly_configuring-file-shares-on-a-samba-server" title="Setting up a share that uses Windows ACLs">the section called “Setting up a share that uses Windows ACLs”</a>.
					</p></div><p>
					Parts of this section were adopted from the <a class="link" href="https://wiki.samba.org/index.php/Setting_up_a_Share_Using_POSIX_ACLs">Setting up a Share Using POSIX ACLs</a> documentation published in the Samba Wiki. License: <a class="link" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. Authors and contributors: See the <a class="link" href="https://wiki.samba.org/index.php?title=Setting_up_a_Share_Using_POSIX_ACLs&amp;action=history">history</a> tab on the Wiki page.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_adding-a-share-that-uses-posix-acls_assembly_setting-up-a-share-that-uses-posix-acls"/>Adding a share that uses POSIX ACLs</h3></div></div></div><p>
						This section describes how to create a share named <code class="literal">example</code> that provides the content of the <code class="literal">/srv/samba/example/</code> directory, and uses POSIX ACLs.
					</p><h5><a id="procedure_12"/>Procedure</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Create the folder if it does not exist. For example:
							</p><pre class="literallayout"># mkdir -p /srv/samba/example/</pre></li><li class="listitem"><p class="simpara">
								If you run SELinux in <code class="literal">enforcing</code> mode, set the <code class="literal">samba_share_t</code> context on the directory:
							</p><pre class="literallayout"># semanage fcontext -a -t samba_share_t "/srv/samba/example(/.*)?"
# restorecon -Rv /srv/samba/example/</pre></li><li class="listitem">
								Set file system ACLs on the directory. See <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-a-share-that-uses-posix-acls_assembly_configuring-file-shares-on-a-samba-server" title="Setting up a share that uses POSIX ACLs">the section called “Setting up a share that uses POSIX ACLs”</a>.
							</li><li class="listitem"><p class="simpara">
								Add the example share to the <code class="literal">/etc/samba/smb.conf</code> file. For example, to add the share write-enabled:
							</p><pre class="literallayout">[example]
	path = /srv/samba/example/
	read only = no</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
									Regardless of the file system ACLs; if you do not set <code class="literal">read only = no</code>, Samba shares the directory in read-only mode.
								</p></div></li><li class="listitem"><p class="simpara">
								Verify the <code class="literal">/etc/samba/smb.conf</code> file:
							</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">
								Open the required ports and reload the firewall configuration using the <code class="literal">firewall-cmd</code> utility:
							</p><pre class="literallayout"># firewall-cmd --permanent --add-service=samba
# firewall-cmd --reload</pre></li><li class="listitem"><p class="simpara">
								Restart the <code class="literal">smb</code> service:
							</p><pre class="literallayout"># systemctl restart smb</pre></li><li class="listitem"><p class="simpara">
								Optionally, enable the smb service to start automatically at boot time:
							</p><pre class="literallayout"># systemctl enable smb</pre></li></ol></div><h5><a id="additional_resources_9"/>Additional resources</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="Verifying the smb.conf file by using the testparm utility">the section called “Verifying the smb.conf file by using the testparm utility”</a>
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="assembly_setting-acls-on-a-share-that-uses-posix-acls_assembly_setting-up-a-share-that-uses-posix-acls"/>Setting ACLs on a share that uses POSIX ACLs</h3></div></div></div><p>
						This section describes how to set ACLs on a share that uses POSIX ACLs.
					</p><p>
						Shares that use POSIX ACLs support:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								Standard Linux ACLs. For details, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_setting-standard-linux-acls_assembly_setting-acls-on-a-share-that-uses-posix-acls" title="Setting standard Linux ACLs">the section called “Setting standard Linux ACLs”</a>.
							</li><li class="listitem">
								Extended ACLs. For details, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_setting-extended-acls_assembly_setting-acls-on-a-share-that-uses-posix-acls" title="Setting extended ACLs">the section called “Setting extended ACLs”</a>.
							</li></ul></div><h5><a id="prerequisites-assembly_setting-acls-on-a-share-that-uses-posix-acls"/>Prerequisites</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								A share with POSIX ACLs has been set up according to <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_adding-a-share-that-uses-posix-acls_assembly_setting-up-a-share-that-uses-posix-acls" title="Adding a share that uses POSIX ACLs">the section called “Adding a share that uses POSIX ACLs”</a>.
							</li></ul></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="proc_setting-standard-linux-acls_assembly_setting-acls-on-a-share-that-uses-posix-acls"/>Setting standard Linux ACLs</h4></div></div></div><p>
							The standard ACLs on Linux support setting permissions for one owner, one group, and for all other undefined users. You can use the <code class="literal">chown</code>, <code class="literal">chgrp</code>, and <code class="literal">chmod</code> utility to update the ACLs. If you require precise control, then you use the more complex POSIX ACLs, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_setting-extended-acls_assembly_setting-acls-on-a-share-that-uses-posix-acls" title="Setting extended ACLs">the section called “Setting extended ACLs”</a>.
						</p><p>
							The following procedure sets the owner of the <code class="literal">/srv/samba/example/</code> directory to the <code class="literal">root</code> user, grant read and write permissions to the <code class="literal">Domain Users</code> group, and deny access to all other users.
						</p><h6><a id="procedure_13"/>Procedure</h6><pre class="literallayout"># chown root:"Domain Users" /srv/samba/example/
# chmod 2770 /srv/samba/example/</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								Enabling the set-group-ID (SGID) bit on a directory automatically sets the default group for all new files and subdirectories to that of the directory group, instead of the usual behavior of setting it to the primary group of the user who created the new directory entry.
							</p></div><h6><a id="additional_resources_10"/>Additional resources</h6><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									For further details about permissions, see the <code class="literal">chown(1)</code> and <code class="literal">chmod(1)</code> man pages.
								</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="proc_setting-extended-acls_assembly_setting-acls-on-a-share-that-uses-posix-acls"/>Setting extended ACLs</h4></div></div></div><p>
							If the file system the shared directory is stored on supports extended ACLs, you can use them to set complex permissions. Extended ACLs can contain permissions for multiple users and groups.
						</p><p>
							Extended POSIX ACLs enable you to configure complex ACLs with multiple users and groups. However, you can only set the following permissions:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									No access
								</li><li class="listitem">
									Read access
								</li><li class="listitem">
									Write access
								</li><li class="listitem">
									Full control
								</li></ul></div><p>
							If you require the fine-granular Windows permissions, such as <code class="literal">Create folder / append data</code>, configure the share to use Windows ACLs. See <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-a-share-that-uses-windows-acls_assembly_configuring-file-shares-on-a-samba-server" title="Setting up a share that uses Windows ACLs">the section called “Setting up a share that uses Windows ACLs”</a>.
						</p><p>
							The following procedure shows how to enable extended ACLs on a share. Additionally, it contains an example about setting extended ACLs.
						</p><h6><a id="procedure_14"/>Procedure</h6><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
									Enable the following parameter in the share’s section in the <code class="literal">/etc/samba/smb.conf</code> file to enable ACL inheritance of extended ACLs:
								</p><pre class="literallayout">inherit acls = yes</pre><p class="simpara">
									For details, see the parameter description in the <code class="literal">smb.conf(5</code>) man page.
								</p></li><li class="listitem"><p class="simpara">
									Restart the <code class="literal">smb</code> service:
								</p><pre class="literallayout"># systemctl restart smb</pre></li><li class="listitem"><p class="simpara">
									Set the ACLs on the directory. For example:
								</p><div class="example"><a id="ex.setting-extended-acls_proc_setting-extended-acls_assembly_setting-acls-on-a-share-that-uses-posix-acls"/><p class="title"><strong>Example 2.3. Setting Extended ACLs</strong></p><div class="example-contents"><p>
										The following procedure sets read, write, and execute permissions for the <code class="literal">Domain Admins</code> group, read, and execute permissions for the <code class="literal">Domain Users</code> group, and deny access to everyone else on the <code class="literal">/srv/samba/example/</code> directory:
									</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
												Disable auto-granting permissions to the primary group of user accounts:
											</p><pre class="literallayout"># setfacl -m group::--- /srv/samba/example/
# setfacl -m default:group::--- /srv/samba/example/</pre><p class="simpara">
												The primary group of the directory is additionally mapped to the dynamic <code class="literal">CREATOR GROUP</code> principal. When you use extended POSIX ACLs on a Samba share, this principal is automatically added and you cannot remove it.
											</p></li><li class="listitem"><p class="simpara">
												Set the permissions on the directory:
											</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
														Grant read, write, and execute permissions to the <code class="literal">Domain Admins</code> group:
													</p><pre class="literallayout"># setfacl -m group:"<span class="emphasis"><em>DOMAIN</em></span>\Domain Admins":rwx /srv/samba/example/</pre></li><li class="listitem"><p class="simpara">
														Grant read and execute permissions to the <code class="literal">Domain Users</code> group:
													</p><pre class="literallayout"># setfacl -m group:"<span class="emphasis"><em>DOMAIN</em></span>\Domain Users":r-x /srv/samba/example/</pre></li><li class="listitem"><p class="simpara">
														Set permissions for the <code class="literal">other</code> ACL entry to deny access to users that do not match the other ACL entries:
													</p><pre class="literallayout"># setfacl -R -m other::--- /srv/samba/example/</pre></li></ol></div><p class="simpara">
												These settings apply only to this directory. In Windows, these ACLs are mapped to the <code class="literal">This folder only</code> mode.
											</p></li><li class="listitem"><p class="simpara">
												To enable the permissions set in the previous step to be inherited by new file system objects created in this directory:
											</p><pre class="literallayout"># setfacl -m default:group:"<span class="emphasis"><em>DOMAIN</em></span>\Domain Admins":rwx /srv/samba/example/
# setfacl -m default:group:"<span class="emphasis"><em>DOMAIN</em></span>\Domain Users":r-x /srv/samba/example/
# setfacl -m default:other::--- /srv/samba/example/</pre><p class="simpara">
												With these settings, the <code class="literal">This folder only</code> mode for the principals is now set to <code class="literal">This folder, subfolders, and files</code>.
											</p></li></ol></div><p>
										Samba maps the permissions set in the procedure to the following Windows ACLs:
									</p><div class="informaltable"><a id="table_example_proc_setting-extended-acls_assembly_setting-acls-on-a-share-that-uses-posix-acls"/><table border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">Principal</th><th style="text-align: left" valign="top">Access</th><th style="text-align: left" valign="top">Applies to</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
														<span class="emphasis"><em>Domain</em></span>\Domain Admins
													</p>
													 </td><td style="text-align: left" valign="top"> <p>
														Full control
													</p>
													 </td><td style="text-align: left" valign="top"> <p>
														This folder, subfolders, and files
													</p>
													 </td></tr><tr><td style="text-align: left" valign="top"> <p>
														<span class="emphasis"><em>Domain</em></span>\Domain Users
													</p>
													 </td><td style="text-align: left" valign="top"> <p>
														Read &amp; execute
													</p>
													 </td><td style="text-align: left" valign="top"> <p>
														This folder, subfolders, and files
													</p>
													 </td></tr><tr><td style="text-align: left" valign="top"> <p>
														<code class="literal">Everyone</code> <a href="#ftn.idm140241875041792" class="footnote" id="idm140241875041792"><sup class="footnote">[a]</sup></a>
													</p>
													 </td><td style="text-align: left" valign="top"> <p>
														None
													</p>
													 </td><td style="text-align: left" valign="top"> <p>
														This folder, subfolders, and files
													</p>
													 </td></tr><tr><td style="text-align: left" valign="top"> <p>
														<span class="emphasis"><em>owner</em></span> (<span class="emphasis"><em>Unix User\owner</em></span>) <a href="#ftn.idm140241875034080" class="footnote" id="idm140241875034080"><sup class="footnote">[b]</sup></a>
													</p>
													 </td><td style="text-align: left" valign="top"> <p>
														Full control
													</p>
													 </td><td style="text-align: left" valign="top"> <p>
														This folder only
													</p>
													 </td></tr><tr><td style="text-align: left" valign="top"> <p>
														<span class="emphasis"><em>primary_group</em></span> (<span class="emphasis"><em>Unix User\primary_group</em></span>) <a href="#ftn.idm140241875026848" class="footnote" id="idm140241875026848"><sup class="footnote">[c]</sup></a>
													</p>
													 </td><td style="text-align: left" valign="top"> <p>
														None
													</p>
													 </td><td style="text-align: left" valign="top"> <p>
														This folder only
													</p>
													 </td></tr><tr><td style="text-align: left" valign="top"> <p>
														<code class="literal">CREATOR OWNER</code> <a href="#ftn.idm140241819071520" class="footnote" id="idm140241819071520"><sup class="footnote">[d]</sup></a> <a href="#ftn.sambawinaclcreatorowner" class="footnote" id="sambawinaclcreatorowner"><sup class="footnote">[e]</sup></a>
													</p>
													 </td><td style="text-align: left" valign="top"> <p>
														Full control
													</p>
													 </td><td style="text-align: left" valign="top"> <p>
														Subfolders and files only
													</p>
													 </td></tr><tr><td style="text-align: left" valign="top"> <p>
														<code class="literal">CREATOR GROUP</code> <a href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#ftn.sambawinaclcreatorowner" class="footnoteref"><sup class="footnoteref">[e]</sup></a> <a href="#ftn.idm140241819062592" class="footnote" id="idm140241819062592"><sup class="footnote">[f]</sup></a>
													</p>
													 </td><td style="text-align: left" valign="top"> <p>
														None
													</p>
													 </td><td style="text-align: left" valign="top"> <p>
														Subfolders and files only
													</p>
													 </td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div id="ftn.idm140241875041792" class="footnote"><p><a href="#idm140241875041792" class="simpara"><sup class="simpara">[a] </sup></a>
															Samba maps the permissions for this principal from the <code class="literal">other</code> ACL entry.
														</p></div><div id="ftn.idm140241875034080" class="footnote"><p><a href="#idm140241875034080" class="simpara"><sup class="simpara">[b] </sup></a>
															Samba maps the owner of the directory to this entry.
														</p></div><div id="ftn.idm140241875026848" class="footnote"><p><a href="#idm140241875026848" class="simpara"><sup class="simpara">[c] </sup></a>
															Samba maps the primary group of the directory to this entry.
														</p></div><div id="ftn.idm140241819071520" class="footnote"><p><a href="#idm140241819071520" class="simpara"><sup class="simpara">[d] </sup></a>
															On new file system objects, the creator inherits automatically the permissions of this principal.
														</p></div><div id="ftn.sambawinaclcreatorowner" class="footnote"><p><a href="#sambawinaclcreatorowner" class="simpara"><sup class="simpara">[e] </sup></a>
															Configuring or removing these principals from the ACLs not supported on shares that use POSIX ACLs.
														</p></div><div id="ftn.idm140241819062592" class="footnote"><p><a href="#idm140241819062592" class="simpara"><sup class="simpara">[f] </sup></a>
															On new file system objects, the creator’s primary group inherits automatically the permissions of this principal.
														</p></div></td></tr></tbody></table></div></div></div></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="assembly_setting-permissions-on-a-share-that-uses-posix-acls_assembly_setting-up-a-share-that-uses-posix-acls"/>Setting permissions on a share that uses POSIX ACLs</h3></div></div></div><p>
						Optionally, to limit or grant access to a Samba share, you can set certain parameters in the share’s section in the <code class="literal">/etc/samba/smb.conf</code> file.
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							Share-based permissions manage if a user, group, or host is able to access a share. These settings do not affect file system ACLs.
						</p></div><p>
						Use share-based settings to restrict access to shares, for example, to deny access from specific hosts.
					</p><h5><a id="prerequisites-assembly_setting-permissions-on-a-share-that-uses-posix-acls"/>Prerequisites</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								A share with POSIX ACLs has been set up according to <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_adding-a-share-that-uses-posix-acls_assembly_setting-up-a-share-that-uses-posix-acls" title="Adding a share that uses POSIX ACLs">the section called “Adding a share that uses POSIX ACLs”</a>.
							</li></ul></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="proc_configuring-user-and-group-based-share-access_assembly_setting-permissions-on-a-share-that-uses-posix-acls"/>Configuring user and group-based share access</h4></div></div></div><p>
							User and group-based access control enables you to grant or deny access to a share for certain users and groups.
						</p><h6><a id="procedure_15"/>Procedure</h6><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
									For example, to enable all members of the <code class="literal">Domain Users</code> group to access a share while access is denied for the <code class="literal">user</code> account, add the following parameters to the share’s configuration:
								</p><pre class="literallayout">valid users = +<span class="emphasis"><em>DOMAIN</em></span>\"Domain Users"
invalid users = <span class="emphasis"><em>DOMAIN</em></span>\user</pre><p class="simpara">
									The <code class="literal">invalid users</code> parameter has a higher priority than the <code class="literal">valid users</code> parameter. For example, if the <code class="literal">user</code> account is a member of the <code class="literal">Domain Users</code> group, access is denied to this account when you use the previous example.
								</p></li><li class="listitem"><p class="simpara">
									Reload the Samba configuration:
								</p><pre class="literallayout"># smbcontrol all reload-config</pre></li></ol></div><h6><a id="additional_resources_11"/>Additional resources</h6><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									For further details, see the parameter descriptions in the <code class="literal">smb.conf(5)</code> man page.
								</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="proc_configuring-host-based-share-access_assembly_setting-permissions-on-a-share-that-uses-posix-acls"/>Configuring host-based share access</h4></div></div></div><p>
							Host-based access control enables you to grant or deny access to a share based on client’s host names, IP addresses, or IP range.
						</p><p>
							The following procedure explains how to enable the <code class="literal">127.0.0.1</code> IP address, the <code class="literal">192.0.2.0/24</code> IP range, and the <code class="literal">client1.example.com</code> host to access a share, and additionally deny access for the <code class="literal">client2.example.com</code> host:
						</p><h6><a id="procedure_16"/>Procedure</h6><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
									Add the following parameters to the configuration of the share in the <code class="literal">/etc/samba/smb.conf</code> file:
								</p><pre class="literallayout">hosts allow = 127.0.0.1 192.0.2.0/24 client1.example.com
hosts deny = client2.example.com</pre><p class="simpara">
									The <code class="literal">hosts deny</code> parameter has a higher priority than <code class="literal">hosts allow</code>. For example, if <code class="literal">client1.example.com</code> resolves to an IP address that is listed in the <code class="literal">hosts allow</code> parameter, access for this host is denied.
								</p></li><li class="listitem"><p class="simpara">
									Reload the Samba configuration:
								</p><pre class="literallayout"># smbcontrol all reload-config</pre></li></ol></div><h6><a id="additional_resources_12"/>Additional resources</h6><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									For further details, see the parameter descriptions in the <code class="literal">smb.conf(5)</code> man page.
								</li></ul></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assembly_setting-up-a-share-that-uses-windows-acls_assembly_configuring-file-shares-on-a-samba-server"/>Setting up a share that uses Windows ACLs</h2></div></div></div><p>
					Samba supports setting Windows ACLs on shares and file system object. This enables you to:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Use the fine-granular Windows ACLs
						</li><li class="listitem">
							Manage share permissions and file system ACLs using Windows
						</li></ul></div><p>
					Alternatively, you can configure a share to use POSIX ACLs. For details, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-a-share-that-uses-posix-acls_assembly_configuring-file-shares-on-a-samba-server" title="Setting up a share that uses POSIX ACLs">the section called “Setting up a share that uses POSIX ACLs”</a>.
				</p><p>
					Parts of this section were adopted from the <a class="link" href="https://wiki.samba.org/index.php/Setting_up_a_Share_Using_Windows_ACLs">Setting up a Share Using Windows ACLs</a> documentation published in the Samba Wiki. License: <a class="link" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. Authors and contributors: See the <a class="link" href="https://wiki.samba.org/index.php?title=Setting_up_a_Share_Using_Windows_ACLs&amp;action=history">history</a> tab on the Wiki page.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_granting-the-sediskoperatorprivilege-privilege_assembly_setting-up-a-share-that-uses-windows-acls"/>Granting the SeDiskOperatorPrivilege privilege</h3></div></div></div><p>
						Only users and groups having the <code class="literal">SeDiskOperatorPrivilege</code> privilege granted can configure permissions on shares that use Windows ACLs.
					</p><h5><a id="procedure_17"/>Procedure</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								For example, to grant the <code class="literal">SeDiskOperatorPrivilege</code> privilege to the <code class="literal"><span class="emphasis"><em>DOMAIN</em></span>\Domain Admins</code> group:
							</p><pre class="literallayout"># net rpc rights grant "<span class="emphasis"><em>DOMAIN</em></span>\Domain Admins" SeDiskOperatorPrivilege \
       -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrator's password:
Successfully granted rights.</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
									In a domain environment, grant <code class="literal">SeDiskOperatorPrivilege</code> to a domain group. This enables you to centrally manage the privilege by updating a user’s group membership.
								</p></div></li><li class="listitem"><p class="simpara">
								To list all users and groups having <code class="literal">SeDiskOperatorPrivilege</code> granted:
							</p><pre class="literallayout"># net rpc rights list privileges SeDiskOperatorPrivilege \
       -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
Enter administrator's password:
SeDiskOperatorPrivilege:
  BUILTIN\Administrators
  <span class="emphasis"><em>DOMAIN</em></span>\Domain Admins</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_enabling-windows-acl-support_assembly_setting-up-a-share-that-uses-windows-acls"/>Enabling Windows ACL support</h3></div></div></div><p>
						To configure shares that support Windows ACLs, you must enable this feature in Samba.
					</p><h5><a id="prerequisites_6"/>Prerequisites</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								A user share is configured on the Samba server.
							</li></ul></div><h5><a id="procedure_18"/>Procedure</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								To enable it globally for all shares, add the following settings to the <code class="literal">[global]</code> section of the <code class="literal">/etc/samba/smb.conf</code> file:
							</p><pre class="literallayout">vfs objects = acl_xattr
map acl inherit = yes
store dos attributes = yes</pre><p class="simpara">
								Alternatively, you can enable Windows ACL support for individual shares, by adding the same parameters to a share’s section instead.
							</p></li><li class="listitem"><p class="simpara">
								Restart the <code class="literal">smb</code> service:
							</p><pre class="literallayout"># systemctl restart smb</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_adding-a-share-that-uses-windows-acls_assembly_setting-up-a-share-that-uses-windows-acls"/>Adding a share that uses Windows ACLs</h3></div></div></div><p>
						This section describes how to create a share named <code class="literal">example</code>, that shares the content of the <code class="literal">/srv/samba/example/</code> directory, and uses Windows ACLs.
					</p><h5><a id="procedure_19"/>Procedure</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Create the folder if it does not exists. For example:
							</p><pre class="literallayout"># mkdir -p /srv/samba/example/</pre></li><li class="listitem"><p class="simpara">
								If you run SELinux in <code class="literal">enforcing</code> mode, set the <code class="literal">samba_share_t</code> context on the directory:
							</p><pre class="literallayout"># semanage fcontext -a -t samba_share_t "/srv/samba/example(/.*)?"
# restorecon -Rv /srv/samba/example/</pre></li><li class="listitem"><p class="simpara">
								Add the example share to the <code class="literal">/etc/samba/smb.conf</code> file. For example, to add the share write-enabled:
							</p><pre class="literallayout">[example]
	path = /srv/samba/example/
	read only = no</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
									Regardless of the file system ACLs; if you do not set <code class="literal">read only = no</code>, Samba shares the directory in read-only mode.
								</p></div></li><li class="listitem"><p class="simpara">
								If you have not enabled Windows ACL support in the <code class="literal">[global]</code> section for all shares, add the following parameters to the <code class="literal">[example]</code> section to enable this feature for this share:
							</p><pre class="literallayout">vfs objects = acl_xattr
map acl inherit = yes
store dos attributes = yes</pre></li><li class="listitem"><p class="simpara">
								Verify the <code class="literal">/etc/samba/smb.conf</code> file:
							</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">
								Open the required ports and reload the firewall configuration using the <code class="literal">firewall-cmd</code> utility:
							</p><pre class="literallayout"># firewall-cmd --permanent --add-service=samba
# firewall-cmd --reload</pre></li><li class="listitem"><p class="simpara">
								Restart the <code class="literal">smb</code> service:
							</p><pre class="literallayout"># systemctl restart smb</pre></li></ol></div><h5><a id="additional_resources_13"/>Additional resources</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="Verifying the smb.conf file by using the testparm utility">the section called “Verifying the smb.conf file by using the testparm utility”</a>
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_managing-share-permissions-and-file-system-acls-of-a-share-that-uses-windows-acls_assembly_setting-up-a-share-that-uses-windows-acls"/>Managing share permissions and file system ACLs of a share that uses Windows ACLs</h3></div></div></div><p>
						To manage share permissions and file system ACLs on a Samba share that uses Windows ACLs, use a Windows applications, such as <code class="literal">Computer Management</code>. For details, see the Windows documentation. Alternatively, use the <code class="literal">smbcacls</code> utility to manage ACLs.
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							To modify the file system permissions from Windows, you must use an account that has the <code class="literal">SeDiskOperatorPrivilege</code> privilege granted.
						</p></div><h5><a id="additional_resources_14"/>Additional resources</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_managing-acls-on-an-smb-share-using-smbcacls_assembly_configuring-file-shares-on-a-samba-server" title="Managing ACLs on an SMB share using smbcacls">the section called “Managing ACLs on an SMB share using smbcacls”</a>
							</li><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_granting-the-sediskoperatorprivilege-privilege_assembly_setting-up-a-share-that-uses-windows-acls" title="Granting the SeDiskOperatorPrivilege privilege">the section called “Granting the SeDiskOperatorPrivilege privilege”</a>
							</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assembly_managing-acls-on-an-smb-share-using-smbcacls_assembly_configuring-file-shares-on-a-samba-server"/>Managing ACLs on an SMB share using smbcacls</h2></div></div></div><p>
					The <code class="literal">smbcacls</code> utility can list, set, and delete ACLs of files and directories stored on an SMB share. You can use <code class="literal">smbcacls</code> to manage file system ACLs:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							On a local or remote Samba server that uses advanced Windows ACLs or POSIX ACLs
						</li><li class="listitem">
							On Red Hat Enterprise Linux to remotely manage ACLs on a share hosted on Windows
						</li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="con_access-control-entries_assembly_managing-acls-on-an-smb-share-using-smbcacls"/>Access control entries</h3></div></div></div><p>
						Each ACL entry of a file system object contains Access Control Entries (ACE) in the following format:
					</p><pre class="literallayout"><span class="emphasis"><em>security_principal</em></span>:<span class="emphasis"><em>access_right</em></span>/<span class="emphasis"><em>inheritance_information</em></span>/<span class="emphasis"><em>permissions</em></span></pre><div class="example"><a id="idm140241865030336"/><p class="title"><strong>Example 2.4. Access control entries</strong></p><div class="example-contents"><p>
							If the <code class="literal">AD\Domain Users</code> group has <code class="literal">Modify</code> permissions that apply to <code class="literal">This folder, subfolders, and files</code> on Windows, the ACL contains the following ACE:
						</p><pre class="literallayout">AD\Domain Users:ALLOWED/OI|CI/CHANGE</pre></div></div><p>
						An ACE contains the following parts:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Security principal</span></dt><dd>
									The security principal is the user, group, or SID the permissions in the ACL are applied to.
								</dd><dt><span class="term">Access right</span></dt><dd>
									Defines if access to an object is granted or denied. The value can be <code class="literal">ALLOWED</code> or <code class="literal">DENIED</code>.
								</dd><dt><span class="term">Inheritance information</span></dt><dd><p class="simpara">
									The following values exist:
								</p><div class="table"><a id="idm140241860049392"/><p class="title"><strong>Table 2.1. Inheritance settings</strong></p><div class="table-contents"><table summary="Inheritance settings" border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">Value</th><th style="text-align: left" valign="top">Description</th><th style="text-align: left" valign="top">Maps to</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
													<code class="literal">OI</code>
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													Object Inherit
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													This folder and files
												</p>
												 </td></tr><tr><td style="text-align: left" valign="top"> <p>
													<code class="literal">CI</code>
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													Container Inherit
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													This folder and subfolders
												</p>
												 </td></tr><tr><td style="text-align: left" valign="top"> <p>
													<code class="literal">IO</code>
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													Inherit Only
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													The ACE does not apply to the current file or directory
												</p>
												 </td></tr><tr><td style="text-align: left" valign="top"> <p>
													<code class="literal">ID</code>
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													Inherited
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													The ACE was inherited from the parent directory
												</p>
												 </td></tr></tbody></table></div></div><p class="simpara">
									Additionally, the values can be combined as follows:
								</p><div class="table"><a id="idm140241860015776"/><p class="title"><strong>Table 2.2. Inheritance settings combinations</strong></p><div class="table-contents"><table summary="Inheritance settings combinations" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Value combinations</th><th style="text-align: left" valign="top">Maps to the Windows <code class="literal">Applies to</code> setting</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
													<code class="literal">OI|CI</code>
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													This folder, subfolders, and files
												</p>
												 </td></tr><tr><td style="text-align: left" valign="top"> <p>
													<code class="literal">OI|CI|IO</code>
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													Subfolders and files only
												</p>
												 </td></tr><tr><td style="text-align: left" valign="top"> <p>
													<code class="literal">CI|IO</code>
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													Subfolders only
												</p>
												 </td></tr><tr><td style="text-align: left" valign="top"> <p>
													<code class="literal">OI|IO</code>
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													Files only
												</p>
												 </td></tr></tbody></table></div></div></dd><dt><span class="term">Permissions</span></dt><dd><p class="simpara">
									This value can be either a hex value that represents one or more Windows permissions or an <code class="literal">smbcacls</code> alias:
								</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
											A hex value that represents one or more Windows permissions.
										</p><p class="simpara">
											The following table displays the advanced Windows permissions and their corresponding value in hex format:
										</p><div class="table"><a id="table_windows-permissions-hex-values_assembly_managing-acls-on-an-smb-share-using-smbcacls"/><p class="title"><strong>Table 2.3. Windows permissions and their corresponding smbcacls value in hex format</strong></p><div class="table-contents"><table summary="Windows permissions and their corresponding smbcacls value in hex format" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Windows permissions</th><th style="text-align: left" valign="top">Hex values</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
															Full control
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x001F01FF</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Traverse folder / execute file
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00100020</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															List folder / read data
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00100001</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Read attributes
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00100080</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Read extended attributes
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00100008</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Create files / write data
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00100002</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Create folders / append data
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00100004</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Write attributes
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00100100</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Write extended attributes
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00100010</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Delete subfolders and files
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00100040</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Delete
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00110000</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Read permissions
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00120000</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Change permissions
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00140000</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Take ownership
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00180000</code>
														</p>
														 </td></tr></tbody></table></div></div><p class="simpara">
											Multiple permissions can be combined as a single hex value using the bit-wise <code class="literal">OR</code> operation. For details, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#con_ace-mask-calculation_assembly_managing-acls-on-an-smb-share-using-smbcacls" title="ACE mask calculation">the section called “ACE mask calculation”</a>.
										</p></li><li class="listitem"><p class="simpara">
											An <code class="literal">smbcacls</code> alias. The following table displays the available aliases:
										</p><div class="table"><a id="table_smbcacls-aliases_assembly_managing-acls-on-an-smb-share-using-smbcacls"/><p class="title"><strong>Table 2.4. Existing smbcacls aliases and their corresponding Windows permission</strong></p><div class="table-contents"><table summary="Existing smbcacls aliases and their corresponding Windows permission" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top"><code class="literal">smbcacls</code> alias</th><th style="text-align: left" valign="top">Maps to Windows permission</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
															<code class="literal">R</code>
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															Read
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															<code class="literal">READ</code>
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															Read &amp; execute
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															<code class="literal">W</code>
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															Special:
														</p>
														 <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
																	Create files / write data
																</li><li class="listitem">
																	Create folders / append data
																</li><li class="listitem">
																	Write attributes
																</li><li class="listitem">
																	Write extended attributes
																</li><li class="listitem">
																	Read permissions
																</li></ul></div>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															<code class="literal">D</code>
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															Delete
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															<code class="literal">P</code>
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															Change permissions
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															<code class="literal">O</code>
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															Take ownership
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															<code class="literal">X</code>
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															Traverse / execute
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															<code class="literal">CHANGE</code>
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															Modify
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															<code class="literal">FULL</code>
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															Full control
														</p>
														 </td></tr></tbody></table></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
												You can combine single-letter aliases when you set permissions. For example, you can set <code class="literal">RD</code> to apply the Windows permission <code class="literal">Read</code> and <code class="literal">Delete</code>. However, you can neither combine multiple non-single-letter aliases nor combine aliases and hex values.
											</p></div></li></ul></div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_displaying-acls-using-smbcacls_assembly_managing-acls-on-an-smb-share-using-smbcacls"/>Displaying ACLs using smbcacls</h3></div></div></div><p>
						To display ACLs on an SMB share, use the <code class="literal">smbcacls</code> utility. If you run <code class="literal">smbcacls</code> without any operation parameter, such as <code class="literal">--add</code>, the utility displays the ACLs of a file system object.
					</p><h5><a id="procedure_20"/>Procedure</h5><p>
						For example, to list the ACLs of the root directory of the <code class="literal">//server/example</code> share:
					</p><pre class="literallayout"># smbcacls //server/example / -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrator's password:
REVISION:1
CONTROL:SR|PD|DI|DP
OWNER:AD\Administrators
GROUP:AD\Domain Users
ACL:AD\Administrator:ALLOWED/OI|CI/FULL
ACL:AD\Domain Users:ALLOWED/OI|CI/CHANGE
ACL:AD\Domain Guests:ALLOWED/OI|CI/0x00100021</pre><p>
						The output of the command displays:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<code class="literal">REVISION</code>: The internal Windows NT ACL revision of the security descriptor
							</li><li class="listitem">
								<code class="literal">CONTROL</code>: Security descriptor control
							</li><li class="listitem">
								<code class="literal">OWNER</code>: Name or SID of the security descriptor’s owner
							</li><li class="listitem">
								<code class="literal">GROUP</code>: Name or SID of the security descriptor’s group
							</li><li class="listitem">
								<code class="literal">ACL</code> entries. For details, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#con_access-control-entries_assembly_managing-acls-on-an-smb-share-using-smbcacls" title="Access control entries">the section called “Access control entries”</a>.
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="con_ace-mask-calculation_assembly_managing-acls-on-an-smb-share-using-smbcacls"/>ACE mask calculation</h3></div></div></div><p>
						In most situations, when you add or update an ACE, you use the <code class="literal">smbcacls</code> aliases listed in <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#table_smbcacls-aliases_assembly_managing-acls-on-an-smb-share-using-smbcacls" title="Table 2.4. Existing smbcacls aliases and their corresponding Windows permission">Table 2.4, “Existing smbcacls aliases and their corresponding Windows permission”</a>.
					</p><p>
						However, if you want to set advanced Windows permissions as listed in <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#table_windows-permissions-hex-values_assembly_managing-acls-on-an-smb-share-using-smbcacls" title="Table 2.3. Windows permissions and their corresponding smbcacls value in hex format">Table 2.3, “Windows permissions and their corresponding smbcacls value in hex format”</a>, you must use the bit-wise <code class="literal">OR</code> operation to calculate the correct value. You can use the following shell command to calculate the value:
					</p><pre class="literallayout"># echo $(printf '0x%X' $(( hex_value_1 | hex_value_2 | ... )))</pre><div class="example"><a id="idm140241760990720"/><p class="title"><strong>Example 2.5. Calculating an ACE Mask</strong></p><div class="example-contents"><p>
							You want to set the following permissions:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									Traverse folder / execute file (0x00100020)
								</li><li class="listitem">
									List folder / read data (0x00100001)
								</li><li class="listitem">
									Read attributes (0x00100080)
								</li></ul></div><p>
							To calculate the hex value for the previous permissions, enter:
						</p><pre class="literallayout"># echo $(printf '0x%X' $(( 0x00100020 | 0x00100001 | 0x00100080 )))
<code class="literal">0x1000A1</code></pre><p>
							Use the returned value when you set or update an ACE.
						</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_adding-updating-and-removing-an-acl-using-smbcacls_assembly_managing-acls-on-an-smb-share-using-smbcacls"/>Adding, updating, and removing an ACL using smbcacls</h3></div></div></div><p>
						Depending on the parameter you pass to the <code class="literal">smbcacls</code> utility, you can add, update, and remove ACLs from a file or directory.
					</p><h5><a id="adding_an_acl"/>Adding an ACL</h5><p>
						To add an ACL to the root of the <code class="literal">//server/example</code> share that grants <code class="literal">CHANGE</code> permissions for <code class="literal">This folder, subfolders, and files</code> to the <code class="literal">AD\Domain Users</code> group:
					</p><pre class="literallayout"># smbcacls //server/example / -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator \
       --add ACL:"AD\Domain Users":ALLOWED/OI|CI/CHANGE</pre><h5><a id="updating_an_acl"/>Updating an ACL</h5><p>
						Updating an ACL is similar to adding a new ACL. You update an ACL by overriding the ACL using the <code class="literal">--modify</code> parameter with an existing security principal. If <code class="literal">smbcacls</code> finds the security principal in the ACL list, the utility updates the permissions. Otherwise the command fails with an error:
					</p><pre class="literallayout">ACL for SID <span class="emphasis"><em>principal_name</em></span> not found</pre><p>
						For example, to update the permissions of the <code class="literal">AD\Domain Users</code> group and set them to <code class="literal">READ</code> for <code class="literal">This folder, subfolders, and files</code>:
					</p><pre class="literallayout"># smbcacls //server/example / -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator \
       --modify ACL:"AD\Domain Users":ALLOWED/OI|CI/READ</pre><h5><a id="deleting_an_acl"/>Deleting an ACL</h5><p>
						To delete an ACL, pass the <code class="literal">--delete</code> parameter with the exact ACL to the <code class="literal">smbcacls</code> utility. For example:
					</p><pre class="literallayout"># smbcacls //server/example / -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator \
       --delete ACL:"AD\Domain Users":ALLOWED/OI|CI/READ</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assembly_enabling-users-to-share-directories-on-a-samba-server_assembly_configuring-file-shares-on-a-samba-server"/>Enabling users to share directories on a Samba server</h2></div></div></div><p>
					On a Samba server, you can configure that users can share directories without root permissions.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_enabling-the-user-shares-feature_assembly_enabling-users-to-share-directories-on-a-samba-server"/>Enabling the user shares feature</h3></div></div></div><p>
						Before users can share directories, the administrator must enable user shares in Samba.
					</p><p>
						For example, to enable only members of the local <code class="literal">example</code> group to create user shares.
					</p><h5><a id="procedure_21"/>Procedure</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Create the local <code class="literal">example</code> group, if it does not exist:
							</p><pre class="literallayout"># groupadd example</pre></li><li class="listitem"><p class="simpara">
								Prepare the directory for Samba to store the user share definitions and set its permissions properly. For example:
							</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
										Create the directory:
									</p><pre class="literallayout"># mkdir -p /var/lib/samba/usershares/</pre></li><li class="listitem"><p class="simpara">
										Set write permissions for the <code class="literal">example</code> group:
									</p><pre class="literallayout"># chgrp example /var/lib/samba/usershares/
# chmod 1770 /var/lib/samba/usershares/</pre></li><li class="listitem">
										Set the sticky bit to prevent users to rename or delete files stored by other users in this directory.
									</li></ol></div></li><li class="listitem"><p class="simpara">
								Edit the <code class="literal">/etc/samba/smb.conf</code> file and add the following to the <code class="literal">[global]</code> section:
							</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
										Set the path to the directory you configured to store the user share definitions. For example:
									</p><pre class="literallayout">usershare path = /var/lib/samba/usershares/</pre></li><li class="listitem"><p class="simpara">
										Set how many user shares Samba allows to be created on this server. For example:
									</p><pre class="literallayout">usershare max shares = 100</pre><p class="simpara">
										If you use the default of <code class="literal">0</code> for the <code class="literal">usershare max shares</code> parameter, user shares are disabled.
									</p></li><li class="listitem"><p class="simpara">
										Optionally, set a list of absolute directory paths. For example, to configure that Samba only allows to share subdirectories of the <code class="literal">/data</code> and <code class="literal">/srv</code> directory to be shared, set:
									</p><pre class="literallayout">usershare prefix allow list = /data /srv</pre></li></ol></div><p class="simpara">
								For a list of further user share-related parameters you can set, see the <code class="literal">USERSHARES</code> section in the <code class="literal">smb.conf(5)</code> man page.
							</p></li><li class="listitem"><p class="simpara">
								Verify the <code class="literal">/etc/samba/smb.conf</code> file:
							</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">
								Reload the Samba configuration:
							</p><pre class="literallayout"># smbcontrol all reload-config</pre></li></ol></div><p>
						Users are now able to create user shares. For details, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_adding-a-user-share_assembly_enabling-users-to-share-directories-on-a-samba-server" title="Adding a user share">the section called “Adding a user share”</a>.
					</p><h5><a id="additional_resources_15"/>Additional resources</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="Verifying the smb.conf file by using the testparm utility">the section called “Verifying the smb.conf file by using the testparm utility”</a>
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_adding-a-user-share_assembly_enabling-users-to-share-directories-on-a-samba-server"/>Adding a user share</h3></div></div></div><p>
						After you configured Samba according to <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_enabling-the-user-shares-feature_assembly_enabling-users-to-share-directories-on-a-samba-server" title="Enabling the user shares feature">the section called “Enabling the user shares feature”</a>, users can share directories on the Samba server without <code class="literal">root</code> permissions by running the <code class="literal">net usershare add</code> command.
					</p><p>
						Synopsis of the <code class="literal">net usershare add</code> command:
					</p><p>
						<code class="literal">net usershare add</code> share_name path [[ comment ] | [ ACLs ]] [ guest_ok=y|n ]
					</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							If you set ACLs when you create a user share, you must specify the comment parameter prior to the ACLs. To set an empty comment, use an empty string in double quotes.
						</p></div><p>
						Note that users can only enable guest access on a user share, if the administrator set <code class="literal">usershare allow guests = yes</code> in the <code class="literal">[global]</code> section in the <code class="literal">/etc/samba/smb.conf</code> file.
					</p><div class="example"><a id="idm140241856462176"/><p class="title"><strong>Example 2.6. Adding a user share</strong></p><div class="example-contents"><p>
							A user wants to share the <code class="literal">/srv/samba/</code> directory on a Samba server. The share should be named <code class="literal">example</code>, have no comment set, and should be accessible by guest users. Additionally, the share permissions should be set to full access for the <code class="literal">AD\Domain Users</code> group and read permissions for other users. To add this share, run as the user:
						</p><pre class="literallayout">$ net usershare add example /srv/samba/ "" \
       "AD\Domain Users":F,Everyone:R guest_ok=yes</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_updating-settings-of-a-user-share_assembly_enabling-users-to-share-directories-on-a-samba-server"/>Updating settings of a user share</h3></div></div></div><p>
						To update settings of a user share, override the share by using the <code class="literal">net usershare add</code> command with the same share name and the new settings. See <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_adding-a-user-share_assembly_enabling-users-to-share-directories-on-a-samba-server" title="Adding a user share">the section called “Adding a user share”</a>.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_displaying-information-about-existing-user-shares_assembly_enabling-users-to-share-directories-on-a-samba-server"/>Displaying information about existing user shares</h3></div></div></div><p>
						Users can enter the <code class="literal">net usershare info</code> command on a Samba server to display user shares and their settings.
					</p><h5><a id="prerequisites_7"/>Prerequisites</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								A user share is configured on the Samba server.
							</li></ul></div><h5><a id="procedure_22"/>Procedure</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								To display all user shares created by any user:
							</p><pre class="literallayout">$ net usershare info -l
[<span class="emphasis"><em>share_1</em></span>]
path=<span class="emphasis"><em>/srv/samba/</em></span>
comment=
usershare_acl=<span class="emphasis"><em>Everyone:R,host_name\user:F,</em></span>
guest_ok=<span class="emphasis"><em>y</em></span>
...</pre><p class="simpara">
								To list only shares created by the user who runs the command, omit the <code class="literal">-l</code> parameter.
							</p></li><li class="listitem"><p class="simpara">
								To display only the information about specific shares, pass the share name or wild cards to the command. For example, to display the information about shares whose name starts with <code class="literal">share_</code>:
							</p><pre class="literallayout">$ net usershare info -l share_*</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_listing-user-shares_assembly_enabling-users-to-share-directories-on-a-samba-server"/>Listing user shares</h3></div></div></div><p>
						If you want to list only the available user shares without their settings on a Samba server, use the <code class="literal">net usershare list</code> command.
					</p><h5><a id="prerequisites_8"/>Prerequisites</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								A user share is configured on the Samba server.
							</li></ul></div><h5><a id="procedure_23"/>Procedure</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								To list the shares created by any user:
							</p><pre class="literallayout">$ net usershare list -l
<span class="emphasis"><em>share_1</em></span>
<span class="emphasis"><em>share_2</em></span>
...</pre><p class="simpara">
								To list only shares created by the user who runs the command, omit the <code class="literal">-l</code> parameter.
							</p></li><li class="listitem"><p class="simpara">
								To list only specific shares, pass the share name or wild cards to the command. For example, to list only shares whose name starts with <code class="literal">share_</code>:
							</p><pre class="literallayout">$ net usershare list -l share_*</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_deleting-a-user-share_assembly_enabling-users-to-share-directories-on-a-samba-server"/>Deleting a user share</h3></div></div></div><p>
						To delete a user share, use the command <code class="literal">net usershare delete</code> command as the user who created the share or as the <code class="literal">root</code> user.
					</p><h5><a id="prerequisites_9"/>Prerequisites</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								A user share is configured on the Samba server.
							</li></ul></div><h5><a id="procedure_24"/>Procedure</h5><pre class="literallayout">$ net usershare delete <span class="emphasis"><em>share_name</em></span></pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_enabling-guest-access-to-a-share_assembly_configuring-file-shares-on-a-samba-server"/>Enabling guest access to a share</h2></div></div></div><p>
					In certain situations, you want to share a directory to which users can connect without authentication. To configure this, enable guest access on a share.
				</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
						Shares that do not require authentication can be a security risk.
					</p></div><p>
					If guest access is enabled on a share, Samba maps guest connections to the operating system account set in the <code class="literal">guest account</code> parameter. Guest users can access files on this share if at least one of the following conditions is satisfied:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The account is listed in file system ACLs
						</li><li class="listitem">
							The POSIX permissions for <code class="literal">other</code> users allow it
						</li></ul></div><div class="example"><a id="idm140241858746336"/><p class="title"><strong>Example 2.7. Guest share permissions</strong></p><div class="example-contents"><p>
						If you configured Samba to map the guest account to <code class="literal">nobody</code>, which is the default, the ACLs in the following example:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								Allow guest users to read <code class="literal">file1.txt</code>
							</li><li class="listitem">
								Allow guest users to read and modify <code class="literal">file2.txt</code>
							</li><li class="listitem">
								Prevent guest users to read or modify <code class="literal">file3.txt</code>
							</li></ul></div><pre class="literallayout">-rw-r--r--. 1 root       root      1024 1. Sep 10:00 file1.txt
-rw-r-----. 1 nobody     root      1024 1. Sep 10:00 file2.txt
-rw-r-----. 1 root       root      1024 1. Sep 10:00 file3.txt</pre></div></div><h4><a id="procedure_25"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Edit the <code class="literal">/etc/samba/smb.conf</code> file:
						</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
									If this is the first guest share you set up on this server:
								</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
											Set <code class="literal">map to guest = Bad User</code> in the <code class="literal">[global]</code> section:
										</p><pre class="literallayout">[global]
        ...
        map to guest = Bad User</pre><p class="simpara">
											With this setting, Samba rejects login attempts that use an incorrect password unless the user name does not exist. If the specified user name does not exist and guest access is enabled on a share, Samba treats the connection as a guest log in.
										</p></li><li class="listitem"><p class="simpara">
											By default, Samba maps the guest account to the <code class="literal">nobody</code> account on Red Hat Enterprise Linux. Alternatively, you can set a different account. For example:
										</p><pre class="literallayout">[global]
        ...
        guest account = user_name</pre><p class="simpara">
											The account set in this parameter must exist locally on the Samba server. For security reasons, Red Hat recommends using an account that does not have a valid shell assigned.
										</p></li></ol></div></li><li class="listitem"><p class="simpara">
									Add the <code class="literal">guest ok = yes</code> setting to the <code class="literal">[example]</code> share section:
								</p><pre class="literallayout">[example]
        ...
        guest ok = yes</pre></li></ol></div></li><li class="listitem"><p class="simpara">
							Verify the <code class="literal">/etc/samba/smb.conf</code> file:
						</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">
							Reload the Samba configuration:
						</p><pre class="literallayout"># smbcontrol all reload-config</pre></li></ol></div><h4><a id="additional_resources_16"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="Verifying the smb.conf file by using the testparm utility">the section called “Verifying the smb.conf file by using the testparm utility”</a>
						</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_setting-up-samba-as-a-print-server_assembly_using-samba-as-a-server"/>Setting up Samba as a print server</h1></div></div></div><p>
				If you set up Samba as a print server, clients in your network can use Samba to print. Additionally, Windows clients can, if configured, download the driver from the Samba server.
			</p><p>
				Parts of this section were adopted from the <a class="link" href="https://wiki.samba.org/index.php/Setting_up_Samba_as_a_Print_Server">Setting up Samba as a Print Server</a> documentation published in the Samba Wiki. License: <a class="link" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. Authors and contributors: See the <a class="link" href="https://wiki.samba.org/index.php?title=Setting_up_Samba_as_a_Print_Server&amp;action=history">history</a> tab on the Wiki page.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="prerequisites-assembly_setting-up-samba-as-a-print-server"/>Prerequisites</h2></div></div></div><p>
					Samba has been set up in one of the following modes:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="link" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-samba-as-a-standalone-server_assembly_using-samba-as-a-server" title="Setting up Samba as a standalone server">Standalone server</a>
						</li><li class="listitem">
							<a class="link" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_setting-up-samba-as-a-domain-member-server_assembly_using-samba-as-a-server" title="Setting up Samba as a domain member server">Domain member</a>
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_the-samba-spoolssd-service_assembly_setting-up-samba-as-a-print-server"/>The Samba spoolssd service</h2></div></div></div><p>
					The Samba <code class="literal">spoolssd</code> is a service that is integrated into the <code class="literal">smbd</code> service. Enable <code class="literal">spoolssd</code> in the Samba configuration to significantly increase the performance on print servers with a high number of jobs or printers.
				</p><p>
					Without <code class="literal">spoolssd</code>, Samba forks the <code class="literal">smbd</code> process and initializes the <code class="literal">printcap</code> cache for each print job. In case of a large number of printers, the <code class="literal">smbd</code> service can become unresponsive for multiple seconds while the cache is initialized. The <code class="literal">spoolssd</code> service enables you to start pre-forked <code class="literal">smbd</code> processes that are processing print jobs without any delays. The main <code class="literal">spoolssd</code> <code class="literal">smbd</code> process uses a low amount of memory, and forks and terminates child processes.
				</p><p>
					The following procedure explains how to enable the <code class="literal">spoolssd</code> service.
				</p><h4><a id="procedure_26"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Edit the <code class="literal">[global]</code> section in the <code class="literal">/etc/samba/smb.conf</code> file:
						</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
									Add the following parameters:
								</p><pre class="literallayout">rpc_server:spoolss = external
rpc_daemon:spoolssd = fork</pre></li><li class="listitem"><p class="simpara">
									Optionally, you can set the following parameters:
								</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">Parameter</th><th style="text-align: left" valign="top">Default</th><th style="text-align: left" valign="top">Description</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
													<code class="literal">spoolssd:prefork_min_children</code>
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													5
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													Minimum number of child processes
												</p>
												 </td></tr><tr><td style="text-align: left" valign="top"> <p>
													<code class="literal">spoolssd:prefork_max_children</code>
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													25
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													Maximum number of child processes
												</p>
												 </td></tr><tr><td style="text-align: left" valign="top"> <p>
													<code class="literal">spoolssd:prefork_spawn_rate</code>
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													5
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													Samba forks the number of new child processes set in this parameter, up to the value set in <code class="literal">spoolssd:prefork_max_children</code>, if a new connection is established
												</p>
												 </td></tr><tr><td style="text-align: left" valign="top"> <p>
													<code class="literal">spoolssd:prefork_max_allowed_clients</code>
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													100
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													Number of clients, a child process serves
												</p>
												 </td></tr><tr><td style="text-align: left" valign="top"> <p>
													<code class="literal">spoolssd:prefork_child_min_life</code>
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													60
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													Minimum lifetime of a child process in seconds. 60 seconds is the minimum.
												</p>
												 </td></tr></tbody></table></div></li></ol></div></li><li class="listitem"><p class="simpara">
							Verify the <code class="literal">/etc/samba/smb.conf</code> file:
						</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">
							Restart the <code class="literal">smb</code> service:
						</p><pre class="literallayout"># systemctl restart smb</pre><p class="simpara">
							After you restarted the service, Samba automatically starts <code class="literal">smbd</code> child processes:
						</p><pre class="literallayout"># ps axf
...
30903 smbd
30912  \_ smbd
30913      \_ smbd
30914      \_ smbd
30915      \_ smbd
...</pre></li></ol></div><h4><a id="additional_resources_17"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="Verifying the smb.conf file by using the testparm utility">the section called “Verifying the smb.conf file by using the testparm utility”</a>
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_enabling-print-server-support-in-samba_assembly_setting-up-samba-as-a-print-server"/>Enabling print server support in Samba</h2></div></div></div><p>
					This section explains how to enable the print server support in Samba.
				</p><h4><a id="procedure_27"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							On the Samba server, set up CUPS and add the printer to the CUPS back end. For details about configuring printers in CUPS; see the documentation provided in the CUPS web console (https://<span class="emphasis"><em>print_server_host_name</em></span>:631/help) on the print server.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								Samba can only forward the print jobs to CUPS if CUPS is installed locally on the Samba print server.
							</p></div></li><li class="listitem"><p class="simpara">
							Edit the <code class="literal">/etc/samba/smb.conf</code> file:
						</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
									If you want to enable the <code class="literal">spoolssd</code> service, add the following parameters to the <code class="literal">[global]</code> section:
								</p><pre class="literallayout">rpc_server:spoolss = external
rpc_daemon:spoolssd = fork</pre></li><li class="listitem"><p class="simpara">
									To configure the printing back end, add the <code class="literal">[printers]</code> section:
								</p><pre class="literallayout">[printers]
        comment = All Printers
        path = /var/tmp/
        printable = yes
        create mask = 0600</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
										The <code class="literal">[printers]</code> share name is hard-coded and cannot be changed.
									</p></div></li></ol></div></li><li class="listitem"><p class="simpara">
							Verify the <code class="literal">/etc/samba/smb.conf</code> file:
						</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">
							Open the required ports and reload the firewall configuration using the <code class="literal">firewall-cmd</code> utility:
						</p><pre class="literallayout"># firewall-cmd --permanent --add-service=samba
# firewall-cmd --reload</pre></li><li class="listitem"><p class="simpara">
							Restart the <code class="literal">smb</code> service:
						</p><pre class="literallayout"># systemctl restart smb</pre></li></ol></div><p>
					After restarting the service, Samba automatically shares all printers that are configured in the CUPS back end. If you want to manually share only specific printers, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_manually-sharing-specific-printers_assembly_setting-up-samba-as-a-print-server" title="Manually sharing specific printers">the section called “Manually sharing specific printers”</a>.
				</p><h4><a id="additional_resources_18"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							For further details and <code class="literal">spoolssd</code> parameters you can set, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_the-samba-spoolssd-service_assembly_setting-up-samba-as-a-print-server" title="The Samba spoolssd service">the section called “The Samba spoolssd service”</a>
						</li><li class="listitem">
							<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="Verifying the smb.conf file by using the testparm utility">the section called “Verifying the smb.conf file by using the testparm utility”</a>
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_manually-sharing-specific-printers_assembly_setting-up-samba-as-a-print-server"/>Manually sharing specific printers</h2></div></div></div><p>
					If you configured Samba as a print server, by default, Samba shares all printers that are configured in the CUPS back end. The following procedure explains how to share only specific printers.
				</p><h4><a id="prerequisites_10"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Samba is set up as a print server
						</li></ul></div><h4><a id="procedure_28"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Edit the <code class="literal">/etc/samba/smb.conf</code> file:
						</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
									In the <code class="literal">[global]</code> section, disable automatic printer sharing by setting:
								</p><pre class="literallayout">load printers = no</pre></li><li class="listitem"><p class="simpara">
									Add a section for each printer you want to share. For example, to share the printer named <code class="literal">example</code> in the CUPS back end as <code class="literal">Example-Printer</code> in Samba, add the following section:
								</p><pre class="literallayout">[Example-Printer]
        path = /var/tmp/
        printable = yes
        printer name = example</pre><p class="simpara">
									You do not need individual spool directories for each printer. You can set the same spool directory in the <code class="literal">path</code> parameter for the printer as you set in the <code class="literal">[printers]</code> section.
								</p></li></ol></div></li><li class="listitem"><p class="simpara">
							Verify the <code class="literal">/etc/samba/smb.conf</code> file:
						</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">
							Reload the Samba configuration:
						</p><pre class="literallayout"># smbcontrol all reload-config</pre></li></ol></div><h4><a id="additional_resources_19"/>Additional resources</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="Verifying the smb.conf file by using the testparm utility">the section called “Verifying the smb.conf file by using the testparm utility”</a>
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assembly_setting-up-automatic-printer-driver-downloads-for-windows-clients_assembly_setting-up-samba-as-a-print-server"/>Setting up automatic printer driver downloads for Windows clients</h2></div></div></div><p>
					If you are running a Samba print server for Windows clients, you can upload drivers and preconfigure printers. If a user connects to a printer, Windows automatically downloads and installs the driver locally on the client. The user does not require local administrator permissions for the installation. Additionally, Windows applies preconfigured driver settings, such as the number of trays.
				</p><p>
					Parts of this section were adopted from the <a class="link" href="https://wiki.samba.org/index.php/Setting_up_Automatic_Printer_Driver_Downloads_for_Windows_Clients">Setting up Automatic Printer Driver Downloads for Windows Clients</a> documentation published in the Samba Wiki. License: <a class="link" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. Authors and contributors: See the <a class="link" href="https://wiki.samba.org/index.php?title=Setting_up_Automatic_Printer_Driver_Downloads_for_Windows_Clients&amp;action=history">history</a> tab on the Wiki page.
				</p><h4><a id="prerequisites-assembly_setting-up-automatic-printer-driver-downloads-for-windows-clients"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Samba is set up as a print server
						</li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="con_basic-information-about-printer-drivers_assembly_setting-up-automatic-printer-driver-downloads-for-windows-clients"/>Basic information about printer drivers</h3></div></div></div><p>
						This section provides general information about printer drivers.
					</p><h5><a id="supported_driver_model_version"/>Supported driver model version</h5><p>
						Samba only supports the printer driver model version 3 which is supported in Windows 2000 and later, and Windows Server 2000 and later. Samba does not support the driver model version 4, introduced in Windows 8 and Windows Server 2012. However, these and later Windows versions also support version 3 drivers.
					</p><h5><a id="package_aware_drivers"/>Package-aware drivers</h5><p>
						Samba does not support package-aware drivers.
					</p><h5><a id="preparing_a_printer_driver_for_being_uploaded"/>Preparing a printer driver for being uploaded</h5><p>
						Before you can upload a driver to a Samba print server:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								Unpack the driver if it is provided in a compressed format.
							</li><li class="listitem"><p class="simpara">
								Some drivers require to start a setup application that installs the driver locally on a Windows host. In certain situations, the installer extracts the individual files into the operating system’s temporary folder during the setup runs. To use the driver files for uploading:
							</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
										Start the installer.
									</li><li class="listitem">
										Copy the files from the temporary folder to a new location.
									</li><li class="listitem">
										Cancel the installation.
									</li></ol></div></li></ul></div><p>
						Ask your printer manufacturer for drivers that support uploading to a print server.
					</p><h5><a id="providing_32_bit_and_64_bit_drivers_for_a_printer_to_a_client"/>Providing 32-bit and 64-bit drivers for a printer to a client</h5><p>
						To provide the driver for a printer for both 32-bit and 64-bit Windows clients, you must upload a driver with exactly the same name for both architectures. For example, if you are uploading the 32-bit driver named <code class="literal">Example PostScript</code> and the 64-bit driver named <code class="literal">Example PostScript (v1.0)</code>, the names do not match. Consequently, you can only assign one of the drivers to a printer and the driver will not be available for both architectures.
					</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_enabling-users-to-upload-and-preconfigure-drivers_assembly_setting-up-automatic-printer-driver-downloads-for-windows-clients"/>Enabling users to upload and preconfigure drivers</h3></div></div></div><p>
						To be able to upload and preconfigure printer drivers, a user or a group needs to have the <code class="literal">SePrintOperatorPrivilege</code> privilege granted. A user must be added into the <code class="literal">printadmin</code> group. Red Hat Enterprise Linux automatically creates this group when you install the <code class="literal">samba</code> package. The <code class="literal">printadmin</code> group gets assigned the lowest available dynamic system GID that is lower than 1000.
					</p><h5><a id="procedure_29"/>Procedure</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								For example, to grant the <code class="literal">SePrintOperatorPrivilege</code> privilege to the <code class="literal">printadmin</code> group:
							</p><pre class="literallayout"># net rpc rights grant "printadmin" SePrintOperatorPrivilege \
       -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrator's password:
Successfully granted rights.</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
									In a domain environment, grant <code class="literal">SePrintOperatorPrivilege</code> to a domain group. This enables you to centrally manage the privilege by updating a user’s group membership.
								</p></div></li><li class="listitem"><p class="simpara">
								To list all users and groups having <code class="literal">SePrintOperatorPrivilege</code> granted:
							</p><pre class="literallayout"># net rpc rights list privileges SePrintOperatorPrivilege \
       -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
Enter administrator's password:
SePrintOperatorPrivilege:
  BUILTIN\Administrators
  <span class="emphasis"><em>DOMAIN</em></span>\printadmin</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_setting-up-the-print-share_assembly_setting-up-automatic-printer-driver-downloads-for-windows-clients"/>Setting up the print$ share</h3></div></div></div><p>
						Windows operating systems download printer drivers from a share named <code class="literal">print$</code> from a print server. This share name is hard-coded in Windows and cannot be changed.
					</p><p>
						The following procedure explains how to share the <code class="literal">/var/lib/samba/drivers/</code> directory as <code class="literal">print$</code>, and enable members of the local <code class="literal">printadmin</code> group to upload printer drivers.
					</p><h5><a id="procedure_30"/>Procedure</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Add the <code class="literal">[print$]</code> section to the <code class="literal">/etc/samba/smb.conf</code> file:
							</p><pre class="literallayout">[print$]
        path = /var/lib/samba/drivers/
        read only = no
        write list = @printadmin
        force group = @printadmin
        create mask = 0664
        directory mask = 2775</pre><p class="simpara">
								Using these settings:
							</p><p class="simpara">
								Only members of the <code class="literal">printadmin</code> group can upload printer drivers to the share.
							</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
										The group of new created files and directories will be set to <code class="literal">printadmin</code>.
									</li><li class="listitem">
										The permissions of new files will be set to <code class="literal">664</code>.
									</li><li class="listitem">
										The permissions of new directories will be set to <code class="literal">2775</code>.
									</li></ul></div></li><li class="listitem"><p class="simpara">
								To upload only 64-bit drivers for a printer, include this setting in the <code class="literal">[global]</code> section in the <code class="literal">/etc/samba/smb.conf</code> file:
							</p><pre class="literallayout">spoolss: architecture = Windows x64</pre><p class="simpara">
								Without this setting, Windows only displays drivers for which you have uploaded at least the 32-bit version.
							</p></li><li class="listitem"><p class="simpara">
								Verify the <code class="literal">/etc/samba/smb.conf</code> file:
							</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">
								Reload the Samba configuration
							</p><pre class="literallayout"># smbcontrol all reload-config</pre></li><li class="listitem"><p class="simpara">
								Create the <code class="literal">printadmin</code> group if it does not exists:
							</p><pre class="literallayout"># groupadd printadmin</pre></li><li class="listitem"><p class="simpara">
								Grant the <code class="literal">SePrintOperatorPrivilege</code> privilege to the <code class="literal">printadmin</code> group.
							</p><pre class="literallayout"># net rpc rights grant "printadmin" SePrintOperatorPrivilege \
       -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrator's password:
Successfully granted rights.</pre></li><li class="listitem"><p class="simpara">
								If you run SELinux in <code class="literal">enforcing</code> mode, set the <code class="literal">samba_share_t</code> context on the directory:
							</p><pre class="literallayout"># semanage fcontext -a -t samba_share_t "/var/lib/samba/drivers(/.*)?"
# restorecon -Rv /var/lib/samba/drivers/</pre></li><li class="listitem"><p class="simpara">
								Set the permissions on the <code class="literal">/var/lib/samba/drivers/</code> directory:
							</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
										If you use POSIX ACLs, set:
									</p><pre class="literallayout"># chgrp -R "printadmin" /var/lib/samba/drivers/
# chmod -R 2775 /var/lib/samba/drivers/</pre></li><li class="listitem"><p class="simpara">
										If you use Windows ACLs, set:
									</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">Principal</th><th style="text-align: left" valign="top">Access</th><th style="text-align: left" valign="top">Apply to</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
														<code class="literal">CREATOR OWNER</code>
													</p>
													 </td><td style="text-align: left" valign="top"> <p>
														Full control
													</p>
													 </td><td style="text-align: left" valign="top"> <p>
														Subfolders and files only
													</p>
													 </td></tr><tr><td style="text-align: left" valign="top"> <p>
														<code class="literal">Authenticated Users</code>
													</p>
													 </td><td style="text-align: left" valign="top"> <p>
														Read &amp; execute, List folder contents, Read
													</p>
													 </td><td style="text-align: left" valign="top"> <p>
														This folder, subfolders, and files
													</p>
													 </td></tr><tr><td style="text-align: left" valign="top"> <p>
														<code class="literal">printadmin</code>
													</p>
													 </td><td style="text-align: left" valign="top"> <p>
														Full control
													</p>
													 </td><td style="text-align: left" valign="top"> <p>
														This folder, subfolders, and files
													</p>
													 </td></tr></tbody></table></div><p class="simpara">
										For details about setting ACLs on Windows, see the Windows documentation.
									</p></li></ul></div></li></ol></div><h5><a id="additional_resources_20"/>Additional resources</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_enabling-users-to-upload-and-preconfigure-drivers_assembly_setting-up-automatic-printer-driver-downloads-for-windows-clients" title="Enabling users to upload and preconfigure drivers">the section called “Enabling users to upload and preconfigure drivers”</a>.
							</li><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="Verifying the smb.conf file by using the testparm utility">the section called “Verifying the smb.conf file by using the testparm utility”</a>
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_creating-a-gpo-to-enable-clients-to-trust-the-samba-print-server_assembly_setting-up-automatic-printer-driver-downloads-for-windows-clients"/>Creating a GPO to enable clients to trust the Samba print server</h3></div></div></div><p>
						For security reasons, recent Windows operating systems prevent clients from downloading non-package-aware printer drivers from an untrusted server. If your print server is a member in an AD, you can create a Group Policy Object (GPO) in your domain to trust the Samba server.
					</p><h5><a id="prerequisites_11"/>Prerequisites</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								The Samba print server is a member of an AD domain.
							</li><li class="listitem">
								The Windows computer you are using to create the GPO must have the Windows Remote Server Administration Tools (RSAT) installed. For details, see the Windows documentation.
							</li></ul></div><h5><a id="procedure_31"/>Procedure</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
								Log into a Windows computer using an account that is allowed to edit group policies, such as the AD domain <code class="literal">Administrator</code> user.
							</li><li class="listitem">
								Open the <code class="literal">Group Policy Management Console</code>.
							</li><li class="listitem"><p class="simpara">
								Right-click to your AD domain and select <code class="literal">Create a GPO in this domain, and Link it here</code>.
							</p><div class="informalfigure"><div class="mediaobject"><img src="images/samba_create_new_GPO.png" alt="samba create new GPO"/></div></div></li><li class="listitem">
								Enter a name for the GPO, such as <code class="literal">Legacy Printer Driver Policy</code> and click <code class="literal">OK</code>. The new GPO will be displayed under the domain entry.
							</li><li class="listitem">
								Right-click to the newly-created GPO and select <code class="literal">Edit</code> to open the <code class="literal">Group Policy Management Editor</code>.
							</li><li class="listitem"><p class="simpara">
								Navigate to <span class="guimenu">Computer Configuration</span> → <span class="guisubmenu">Policies</span> → <span class="guisubmenu">Administrative Templates</span> → <span class="guimenuitem">Printers</span>.
							</p><div class="informalfigure"><div class="mediaobject"><img src="images/samba_select_printer_GPO_group.png" alt="samba select printer GPO group"/></div></div></li><li class="listitem"><p class="simpara">
								On the right side of the window, double-click <code class="literal">Point and Print Restriction</code> to edit the policy:
							</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
										Enable the policy and set the following options:
									</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
												Select <code class="literal">Users can only point and print to these servers</code> and enter the fully-qualified domain name (FQDN) of the Samba print server to the field next to this option.
											</li><li class="listitem"><p class="simpara">
												In both check boxes under <code class="literal">Security Prompts</code>, select <code class="literal">Do not show warning or elevation prompt</code>.
											</p><div class="informalfigure"><div class="mediaobject"><img src="images/samba_GPO_point_and_print.png" alt="samba GPO point and print"/></div></div></li></ol></div></li><li class="listitem">
										Click OK.
									</li></ol></div></li><li class="listitem"><p class="simpara">
								Double-click <code class="literal">Package Point and Print - Approved servers</code> to edit the policy:
							</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
										Enable the policy and click the <code class="literal">Show</code> button.
									</li><li class="listitem"><p class="simpara">
										Enter the FQDN of the Samba print server.
									</p><div class="informalfigure"><div class="mediaobject"><img src="images/samba_GPO_approved_servers.png" alt="samba GPO approved servers"/></div></div></li><li class="listitem">
										Close both the <code class="literal">Show Contents</code> and the policy’s properties window by clicking <code class="literal">OK</code>.
									</li></ol></div></li><li class="listitem">
								Close the <code class="literal">Group Policy Management Editor</code>.
							</li><li class="listitem">
								Close the <code class="literal">Group Policy Management Console</code>.
							</li></ol></div><p>
						After the Windows domain members applied the group policy, printer drivers are automatically downloaded from the Samba server when a user connects to a printer.
					</p><h5><a id="additional_resources_21"/>Additional resources</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								For further details about using group policies, see the Windows documentation.
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_uploading-drivers-and-preconfiguring-printers_assembly_setting-up-automatic-printer-driver-downloads-for-windows-clients"/>Uploading drivers and preconfiguring printers</h3></div></div></div><p>
						Use the <code class="literal">Print Management</code> application on a Windows client to upload drivers and preconfigure printers hosted on the Samba print server. For further details, see the Windows documentation.
					</p></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_tuning-the-performance-of-a-samba-server_assembly_using-samba-as-a-server"/>Tuning the performance of a Samba server</h1></div></div></div><p>
				This chapter describes what settings can improve the performance of Samba in certain situations, and which settings can have a negative performance impact.
			</p><p>
				Parts of this section were adopted from the <a class="link" href="https://wiki.samba.org/index.php/Performance_Tuning">Performance Tuning</a> documentation published in the Samba Wiki. License: <a class="link" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. Authors and contributors: See the <a class="link" href="https://wiki.samba.org/index.php?title=Performance_Tuning&amp;action=history">history</a> tab on the Wiki page.
			</p><h3><a id="prerequisites-assembly_tuning-the-performance-of-a-samba-server"/>Prerequisites</h3><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
						Samba is set up as a file or print server
					</li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_setting-the-smb-protocol-version_assembly_tuning-the-performance-of-a-samba-server"/>Setting the SMB protocol version</h2></div></div></div><p>
					Each new SMB version adds features and improves the performance of the protocol. The recent Windows and Windows Server operating systems always supports the latest protocol version. If Samba also uses the latest protocol version, Windows clients connecting to Samba benefit from the performance improvements. In Samba, the default value of the server max protocol is set to the latest supported stable SMB protocol version.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
						To always have the latest stable SMB protocol version enabled, do not set the <code class="literal">server max protocol</code> parameter. If you set the parameter manually, you will need to modify the setting with each new version of the SMB protocol, to have the latest protocol version enabled.
					</p></div><p>
					The following procedure explains how to use the default value in the <code class="literal">server max protocol</code> parameter.
				</p><h4><a id="procedure_32"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem">
							Remove the <code class="literal">server max protocol</code> parameter from the <code class="literal">[global]</code> section in the <code class="literal">/etc/samba/smb.conf</code> file.
						</li><li class="listitem"><p class="simpara">
							Reload the Samba configuration
						</p><pre class="literallayout"># smbcontrol all reload-config</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_tuning-shares-with-directories-that-contain-a-large-number-of-files_assembly_tuning-the-performance-of-a-samba-server"/>Tuning shares with directories that contain a large number of files</h2></div></div></div><p>
					Linux supports case-sensitive file names. For this reason, Samba needs to scan directories for uppercase and lowercase file names when searching or accessing a file. You can configure a share to create new files only in lowercase or uppercase, which improves the performance.
				</p><h4><a id="prerequisites_12"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Samba is configured as a file server
						</li></ul></div><h4><a id="procedure_33"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Rename all files on the share to lowercase.
						</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
								Using the settings in this procedure, files with names other than in lowercase will no longer be displayed.
							</p></div></li><li class="listitem"><p class="simpara">
							Set the following parameters in the share’s section:
						</p><pre class="literallayout">case sensitive = true
default case = lower
preserve case = no
short preserve case = no</pre><p class="simpara">
							For details about the parameters, see their descriptions in the <code class="literal">smb.conf(5)</code> man page.
						</p></li><li class="listitem"><p class="simpara">
							Verify the <code class="literal">/etc/samba/smb.conf</code> file:
						</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">
							Reload the Samba configuration:
						</p><pre class="literallayout"># smbcontrol all reload-config</pre></li></ol></div><p>
					After you applied these settings, the names of all newly created files on this share use lowercase. Because of these settings, Samba no longer needs to scan the directory for uppercase and lowercase, which improves the performance.
				</p><h4><a id="additional_resources_22"/>Additional resources</h4><p>
					samba docs
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="Verifying the smb.conf file by using the testparm utility">the section called “Verifying the smb.conf file by using the testparm utility”</a>
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="con_settings-that-can-have-a-negative-performance-impact_assembly_tuning-the-performance-of-a-samba-server"/>Settings that can have a negative performance impact</h2></div></div></div><p>
					By default, the kernel in Red Hat Enterprise Linux is tuned for high network performance. For example, the kernel uses an auto-tuning mechanism for buffer sizes. Setting the <code class="literal">socket options</code> parameter in the <code class="literal">/etc/samba/smb.conf</code> file overrides these kernel settings. As a result, setting this parameter decreases the Samba network performance in most cases.
				</p><p>
					To use the optimized settings from the Kernel, remove the <code class="literal">socket options</code> parameter from the <code class="literal">[global]</code> section in the <code class="literal">/etc/samba/smb.conf</code>.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="assembly_frequently-used-samba-command-line-utilities_assembly_using-samba-as-a-server"/>Frequently used Samba command-line utilities</h1></div></div></div><p>
				This chapter describes frequently used commands when working with a Samba server.
			</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assembly_using-the-net-utility_assembly_frequently-used-samba-command-line-utilities"/>Using the net utility</h2></div></div></div><p>
					The <code class="literal">net</code> utility enables you to perform several administration tasks on a Samba server. This section describes the most frequently used subcommands of the <code class="literal">net</code> utility.
				</p><h4><a id="prerequisites_13"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">samba-common-tools</code> package is installed.
						</li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_using-the-net-ads-join-and-net-rpc-join-commands_assembly_using-the-net-utility"/>Using the net ads join and net rpc join commands</h3></div></div></div><p>
						Using the <code class="literal">join</code> subcommand of the <code class="literal">net</code> utility, you can join Samba to an AD or NT4 domain. To join the domain, you must create the <code class="literal">/etc/samba/smb.conf</code> file manually, and optionally update additional configurations, such as PAM.
					</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
							Red Hat recommends using the <code class="literal">realm</code> utility to join a domain. The <code class="literal">realm</code> utility automatically updates all involved configuration files. For details, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_joining-samba-to-a-domain_assembly_setting-up-samba-as-a-domain-member-server" title="Joining Samba to a Domain">the section called “Joining Samba to a Domain”</a>.
						</p></div><h5><a id="procedure_34"/>Procedure</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Manually create the <code class="literal">/etc/samba/smb.conf</code> file with the following settings:
							</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
										For an AD domain member:
									</p><pre class="literallayout">[global]
workgroup = <span class="emphasis"><em>domain_name</em></span>
security = ads
passdb backend = tdbsam
realm = <span class="emphasis"><em>AD_REALM</em></span></pre></li><li class="listitem"><p class="simpara">
										For an NT4 domain member:
									</p><pre class="literallayout">[global]
workgroup = <span class="emphasis"><em>domain_name</em></span>
security = user
passdb backend = tdbsam</pre></li></ul></div></li><li class="listitem">
								Add an ID mapping configuration for the <code class="literal">*</code> default domain and for the domain you want to join to the <code class="literal">[global</code>] section in the <code class="literal">/etc/samba/smb.conf</code> file. For details, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#assembly_samba-id-mapping_assembly_setting-up-samba-as-a-domain-member-server" title="Samba ID mapping">the section called “Samba ID mapping”</a>.
							</li><li class="listitem"><p class="simpara">
								Verify the <code class="literal">/etc/samba/smb.conf</code> file:
							</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">
								Join the domain as the domain administrator:
							</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
										To join an AD domain:
									</p><pre class="literallayout"># net ads join -U "DOMAIN\administrator"</pre></li><li class="listitem"><p class="simpara">
										To join an NT4 domain:
									</p><pre class="literallayout"># net rpc join -U "DOMAIN\administrator"</pre></li></ul></div></li><li class="listitem"><p class="simpara">
								Append the <code class="literal">winbind</code> source to the <code class="literal">passwd</code> and <code class="literal">group</code> database entry in the <code class="literal">/etc/nsswitch.conf</code> file:
							</p><pre class="literallayout">passwd:     files <code class="literal">winbind</code>
group:      files <code class="literal">winbind</code></pre></li><li class="listitem"><p class="simpara">
								Enable and start the <code class="literal">winbind</code> service:
							</p><pre class="literallayout"># systemctl enable winbind
# systemctl start winbind</pre></li><li class="listitem"><p class="simpara">
								Optionally, configure PAM using the <code class="literal">authselect</code> utility.
							</p><p class="simpara">
								For details, see the <code class="literal">authselect(8)</code> man page.
							</p></li><li class="listitem"><p class="simpara">
								Optionally for AD environments, configure the Kerberos client.
							</p><p class="simpara">
								For details, see the documentation of your Kerberos client.
							</p></li></ol></div><h5><a id="additional_resources_23"/>Additional resources</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="Verifying the smb.conf file by using the testparm utility">the section called “Verifying the smb.conf file by using the testparm utility”</a>
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_using-the-net-rpc-rights-command_assembly_using-the-net-utility"/>Using the net rpc rights command</h3></div></div></div><p>
						In Windows, you can assign privileges to accounts and groups to perform special operations, such as setting ACLs on a share or upload printer drivers. On a Samba server, you can use the <code class="literal">net rpc rights</code> command to manage privileges.
					</p><h5><a id="listing_privileges_you_can_set"/>Listing privileges you can set</h5><p>
						To list all available privileges and their owners, use the <code class="literal">net rpc rights list</code> command. For example:
					</p><pre class="literallayout">net rpc rights list -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrator's password:
     SeMachineAccountPrivilege  Add machines to domain
      SeTakeOwnershipPrivilege  Take ownership of files or other objects
             SeBackupPrivilege  Back up files and directories
            SeRestorePrivilege  Restore files and directories
     SeRemoteShutdownPrivilege  Force shutdown from a remote system
      SePrintOperatorPrivilege  Manage printers
           SeAddUsersPrivilege  Add users and groups to the domain
       SeDiskOperatorPrivilege  Manage disk shares
           SeSecurityPrivilege  System security</pre><h5><a id="granting_privileges"/>Granting privileges</h5><p>
						To grant a privilege to an account or group, use the <code class="literal">net rpc rights grant</code> command.
					</p><p>
						For example, grant the <code class="literal">SePrintOperatorPrivilege</code> privilege to the <code class="literal"><span class="emphasis"><em>DOMAIN</em></span>\printadmin</code> group:
					</p><pre class="literallayout"># net rpc rights grant "<span class="emphasis"><em>DOMAIN</em></span>\printadmin" SePrintOperatorPrivilege \
       -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrator's password:
Successfully granted rights.</pre><h5><a id="revoking_privileges"/>Revoking privileges</h5><p>
						To revoke a privilege from an account or group, use the <code class="literal">net rpc rights revoke</code> command.
					</p><p>
						For example, to revoke the <code class="literal">SePrintOperatorPrivilege</code> privilege from the <code class="literal"><span class="emphasis"><em>DOMAIN</em></span>\printadmin</code> group:
					</p><pre class="literallayout"># net rpc rights remoke "<span class="emphasis"><em>DOMAIN</em></span>\printadmin" SePrintOperatorPrivilege \
       -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrator's password:
Successfully revoked rights.</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_using-the-net-rpc-share-command_assembly_using-the-net-utility"/>Using the net rpc share command</h3></div></div></div><p>
						The <code class="literal">net rpc share</code> command provides the capability to list, add, and remove shares on a local or remote Samba or Windows server.
					</p><h5><a id="listing_shares"/>Listing shares</h5><p>
						To list the shares on an SMB server, use the <code class="literal">net rpc share list</code> command. Optionally, pass the <code class="literal">-S <span class="emphasis"><em>server_name</em></span></code> parameter to the command to list the shares of a remote server. For example:
					</p><pre class="literallayout"># net rpc share list -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator" -S <span class="emphasis"><em>server_name</em></span>
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrator's password:
IPC$
<span class="emphasis"><em>share_1</em></span>
<span class="emphasis"><em>share_2</em></span>
...</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							Shares hosted on a Samba server that have <code class="literal">browseable = no</code> set in their section in the <code class="literal">/etc/samba/smb.conf</code> file are not displayed in the output.
						</p></div><h5><a id="adding_a_share"/>Adding a share</h5><p>
						The <code class="literal">net rpc share add</code> command enables you to add a share to an SMB server.
					</p><p>
						For example, to add a share named <code class="literal">example</code> on a remote Windows server that shares the <code class="literal">C:\example\</code> directory:
					</p><pre class="literallayout"># net rpc share add example="C:\example" -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator" -S <span class="emphasis"><em>server_name</em></span></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							You must omit the trailing backslash in the path when specifying a Windows directory name.
						</p></div><p>
						To use the command to add a share to a Samba server:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								The user specified in the <code class="literal">-U</code> parameter must have the <code class="literal">SeDiskOperatorPrivilege</code> privilege granted on the destination server.
							</li><li class="listitem">
								You must write a script that adds a share section to the <code class="literal">/etc/samba/smb.conf</code> file and reloads Samba. The script must be set in the <code class="literal">add share command</code> parameter in the <code class="literal">[global]</code> section in <code class="literal">/etc/samba/smb.conf</code>. For further details, see the <code class="literal">add share command</code> description in the <code class="literal">smb.conf(5)</code> man page.
							</li></ul></div><h5><a id="removing_a_share"/>Removing a share</h5><p>
						The <code class="literal">net rpc share delete</code> command enables you to remove a share from an SMB server.
					</p><p>
						For example, to remove the share named example from a remote Windows server:
					</p><pre class="literallayout"># net rpc share delete example -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator" -S <span class="emphasis"><em>server_name</em></span></pre><p>
						To use the command to remove a share from a Samba server:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								The user specified in the <code class="literal">-U</code> parameter must have the <code class="literal">SeDiskOperatorPrivilege</code> privilege granted.
							</li><li class="listitem">
								You must write a script that removes the share’s section from the <code class="literal">/etc/samba/smb.conf</code> file and reloads Samba. The script must be set in the <code class="literal">delete share command</code> parameter in the <code class="literal">[global]</code> section in <code class="literal">/etc/samba/smb.conf</code>. For further details, see the <code class="literal">delete share command</code> description in the <code class="literal">smb.conf(5)</code> man page.
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_using-the-net-user-command_assembly_using-the-net-utility"/>Using the net user command</h3></div></div></div><p>
						The <code class="literal">net user</code> command enables you to perform the following actions on an AD DC or NT4 PDC:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								List all user accounts
							</li><li class="listitem">
								Add users
							</li><li class="listitem">
								Remove Users
							</li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
							Specifying a connection method, such as <code class="literal">ads</code> for AD domains or <code class="literal">rpc</code> for NT4 domains, is only required when you list domain user accounts. Other user-related subcommands can auto-detect the connection method.
						</p></div><p>
						Pass the <code class="literal">-U <span class="emphasis"><em>user_name</em></span></code> parameter to the command to specify a user that is allowed to perform the requested action.
					</p><h5><a id="listing_domain_user_accounts"/>Listing domain user accounts</h5><p>
						To list all users in an AD domain:
					</p><pre class="literallayout"># net ads user -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"</pre><p>
						To list all users in an NT4 domain:
					</p><pre class="literallayout"># net rpc user -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"</pre><h5><a id="adding_a_user_account_to_the_domain"/>Adding a user account to the domain</h5><p>
						On a Samba domain member, you can use the <code class="literal">net user add</code> command to add a user account to the domain.
					</p><p>
						For example, add the <code class="literal">user</code> account to the domain:
					</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Add the account:
							</p><pre class="literallayout"># net user add <span class="emphasis"><em>user</em></span> <span class="emphasis"><em>password</em></span> -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
User <span class="emphasis"><em>user</em></span> added</pre></li><li class="listitem"><p class="simpara">
								Optionally, use the remote procedure call (RPC) shell to enable the account on the AD DC or NT4 PDC. For example:
							</p><pre class="literallayout"># net rpc shell -U <span class="emphasis"><em>DOMAIN</em></span>\administrator -S <span class="emphasis"><em>DC_or_PDC_name</em></span>
Talking to domain DOMAIN (<span class="emphasis"><em>S-1-5-21-1424831554-512457234-5642315751</em></span>)

net rpc&gt; user edit disabled <span class="emphasis"><em>user</em></span>: no
Set <span class="emphasis"><em>user</em></span>'s disabled flag from [yes] to [no]

net rpc&gt; exit</pre></li></ol></div><h5><a id="deleting_a_user_account_from_the_domain"/>Deleting a user account from the domain</h5><p>
						On a Samba domain member, you can use the <code class="literal">net user delete</code> command to remove a user account from the domain.
					</p><p>
						For example, to remove the <code class="literal">user</code> account from the domain:
					</p><pre class="literallayout"># net user delete <span class="emphasis"><em>user</em></span> -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
User <span class="emphasis"><em>user</em></span> deleted</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="assembly_using-the-net-usershare-command_assembly_using-the-net-utility"/>Using the net usershare command</h3></div></div></div><p>
						On a Samba server, you can configure that users can share directories without root permissions.
					</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="proc_enabling-the-user-shares-feature_assembly_using-the-net-usershare-command"/>Enabling the user shares feature</h4></div></div></div><p>
							Before users can share directories, the administrator must enable user shares in Samba.
						</p><p>
							For example, to enable only members of the local <code class="literal">example</code> group to create user shares.
						</p><h6><a id="procedure_35"/>Procedure</h6><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
									Create the local <code class="literal">example</code> group, if it does not exist:
								</p><pre class="literallayout"># groupadd example</pre></li><li class="listitem"><p class="simpara">
									Prepare the directory for Samba to store the user share definitions and set its permissions properly. For example:
								</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
											Create the directory:
										</p><pre class="literallayout"># mkdir -p /var/lib/samba/usershares/</pre></li><li class="listitem"><p class="simpara">
											Set write permissions for the <code class="literal">example</code> group:
										</p><pre class="literallayout"># chgrp example /var/lib/samba/usershares/
# chmod 1770 /var/lib/samba/usershares/</pre></li><li class="listitem">
											Set the sticky bit to prevent users to rename or delete files stored by other users in this directory.
										</li></ol></div></li><li class="listitem"><p class="simpara">
									Edit the <code class="literal">/etc/samba/smb.conf</code> file and add the following to the <code class="literal">[global]</code> section:
								</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
											Set the path to the directory you configured to store the user share definitions. For example:
										</p><pre class="literallayout">usershare path = /var/lib/samba/usershares/</pre></li><li class="listitem"><p class="simpara">
											Set how many user shares Samba allows to be created on this server. For example:
										</p><pre class="literallayout">usershare max shares = 100</pre><p class="simpara">
											If you use the default of <code class="literal">0</code> for the <code class="literal">usershare max shares</code> parameter, user shares are disabled.
										</p></li><li class="listitem"><p class="simpara">
											Optionally, set a list of absolute directory paths. For example, to configure that Samba only allows to share subdirectories of the <code class="literal">/data</code> and <code class="literal">/srv</code> directory to be shared, set:
										</p><pre class="literallayout">usershare prefix allow list = /data /srv</pre></li></ol></div><p class="simpara">
									For a list of further user share-related parameters you can set, see the <code class="literal">USERSHARES</code> section in the <code class="literal">smb.conf(5)</code> man page.
								</p></li><li class="listitem"><p class="simpara">
									Verify the <code class="literal">/etc/samba/smb.conf</code> file:
								</p><pre class="literallayout"># testparm</pre></li><li class="listitem"><p class="simpara">
									Reload the Samba configuration:
								</p><pre class="literallayout"># smbcontrol all reload-config</pre></li></ol></div><p>
							Users are now able to create user shares. For details, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_adding-a-user-share_assembly_enabling-users-to-share-directories-on-a-samba-server" title="Adding a user share">the section called “Adding a user share”</a>.
						</p><h6><a id="additional_resources_24"/>Additional resources</h6><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									<a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_verifying-the-smb-conf-file-by-using-the-testparm-utility_assembly_using-samba-as-a-server" title="Verifying the smb.conf file by using the testparm utility">the section called “Verifying the smb.conf file by using the testparm utility”</a>
								</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="proc_adding-a-user-share_assembly_using-the-net-usershare-command"/>Adding a user share</h4></div></div></div><p>
							After you configured Samba according to <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_enabling-the-user-shares-feature_assembly_enabling-users-to-share-directories-on-a-samba-server" title="Enabling the user shares feature">the section called “Enabling the user shares feature”</a>, users can share directories on the Samba server without <code class="literal">root</code> permissions by running the <code class="literal">net usershare add</code> command.
						</p><p>
							Synopsis of the <code class="literal">net usershare add</code> command:
						</p><p>
							<code class="literal">net usershare add</code> share_name path [[ comment ] | [ ACLs ]] [ guest_ok=y|n ]
						</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
								If you set ACLs when you create a user share, you must specify the comment parameter prior to the ACLs. To set an empty comment, use an empty string in double quotes.
							</p></div><p>
							Note that users can only enable guest access on a user share, if the administrator set <code class="literal">usershare allow guests = yes</code> in the <code class="literal">[global]</code> section in the <code class="literal">/etc/samba/smb.conf</code> file.
						</p><div class="example"><a id="idm140241871132432"/><p class="title"><strong>Example 2.8. Adding a user share</strong></p><div class="example-contents"><p>
								A user wants to share the <code class="literal">/srv/samba/</code> directory on a Samba server. The share should be named <code class="literal">example</code>, have no comment set, and should be accessible by guest users. Additionally, the share permissions should be set to full access for the <code class="literal">AD\Domain Users</code> group and read permissions for other users. To add this share, run as the user:
							</p><pre class="literallayout">$ net usershare add example /srv/samba/ "" \
       "AD\Domain Users":F,Everyone:R guest_ok=yes</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="proc_updating-settings-of-a-user-share_assembly_using-the-net-usershare-command"/>Updating settings of a user share</h4></div></div></div><p>
							To update settings of a user share, override the share by using the <code class="literal">net usershare add</code> command with the same share name and the new settings. See <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#proc_adding-a-user-share_assembly_enabling-users-to-share-directories-on-a-samba-server" title="Adding a user share">the section called “Adding a user share”</a>.
						</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="proc_displaying-information-about-existing-user-shares_assembly_using-the-net-usershare-command"/>Displaying information about existing user shares</h4></div></div></div><p>
							Users can enter the <code class="literal">net usershare info</code> command on a Samba server to display user shares and their settings.
						</p><h6><a id="prerequisites_14"/>Prerequisites</h6><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									A user share is configured on the Samba server.
								</li></ul></div><h6><a id="procedure_36"/>Procedure</h6><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
									To display all user shares created by any user:
								</p><pre class="literallayout">$ net usershare info -l
[<span class="emphasis"><em>share_1</em></span>]
path=<span class="emphasis"><em>/srv/samba/</em></span>
comment=
usershare_acl=<span class="emphasis"><em>Everyone:R,host_name\user:F,</em></span>
guest_ok=<span class="emphasis"><em>y</em></span>
...</pre><p class="simpara">
									To list only shares created by the user who runs the command, omit the <code class="literal">-l</code> parameter.
								</p></li><li class="listitem"><p class="simpara">
									To display only the information about specific shares, pass the share name or wild cards to the command. For example, to display the information about shares whose name starts with <code class="literal">share_</code>:
								</p><pre class="literallayout">$ net usershare info -l share_*</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="proc_listing-user-shares_assembly_using-the-net-usershare-command"/>Listing user shares</h4></div></div></div><p>
							If you want to list only the available user shares without their settings on a Samba server, use the <code class="literal">net usershare list</code> command.
						</p><h6><a id="prerequisites_15"/>Prerequisites</h6><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									A user share is configured on the Samba server.
								</li></ul></div><h6><a id="procedure_37"/>Procedure</h6><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
									To list the shares created by any user:
								</p><pre class="literallayout">$ net usershare list -l
<span class="emphasis"><em>share_1</em></span>
<span class="emphasis"><em>share_2</em></span>
...</pre><p class="simpara">
									To list only shares created by the user who runs the command, omit the <code class="literal">-l</code> parameter.
								</p></li><li class="listitem"><p class="simpara">
									To list only specific shares, pass the share name or wild cards to the command. For example, to list only shares whose name starts with <code class="literal">share_</code>:
								</p><pre class="literallayout">$ net usershare list -l share_*</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="proc_deleting-a-user-share_assembly_using-the-net-usershare-command"/>Deleting a user share</h4></div></div></div><p>
							To delete a user share, use the command <code class="literal">net usershare delete</code> command as the user who created the share or as the <code class="literal">root</code> user.
						</p><h6><a id="prerequisites_16"/>Prerequisites</h6><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									A user share is configured on the Samba server.
								</li></ul></div><h6><a id="procedure_38"/>Procedure</h6><pre class="literallayout">$ net usershare delete <span class="emphasis"><em>share_name</em></span></pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_using-the-rpcclient-utility_assembly_frequently-used-samba-command-line-utilities"/>Using the rpcclient utility</h2></div></div></div><p>
					The <code class="literal">rpcclient</code> utility enables you to manually execute client-side Microsoft Remote Procedure Call (MS-RPC) functions on a local or remote SMB server. However, most of the features are integrated into separate utilities provided by Samba. Use <code class="literal">rpcclient</code> only for testing MS-PRC functions.
				</p><h4><a id="prerequisites_17"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">samba-client</code> package is installed.
						</li></ul></div><h4><a id="examples"/>Examples</h4><p>
					For example, you can use the <code class="literal">rpcclient</code> utility to:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							Manage the printer Spool Subsystem (SPOOLSS).
						</p><div class="example"><a id="idm140241748059712"/><p class="title"><strong>Example 2.9. Assigning a Driver to a Printer</strong></p><div class="example-contents"><pre class="literallayout"># rpcclient <span class="emphasis"><em>server_name</em></span> -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator" \
       -c 'setdriver "<span class="emphasis"><em>printer_name</em></span>" "<span class="emphasis"><em>driver_name</em></span>"'
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrators password:
Successfully set <span class="emphasis"><em>printer_name</em></span> to driver <span class="emphasis"><em>driver_name</em></span>.</pre></div></div></li><li class="listitem"><p class="simpara">
							Retrieve information about an SMB server.
						</p><div class="example"><a id="idm140241748053520"/><p class="title"><strong>Example 2.10. Listing all File Shares and Shared Printers</strong></p><div class="example-contents"><pre class="literallayout"># rpcclient <span class="emphasis"><em>server_name</em></span> -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator" -c 'netshareenum'
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrators password:
netname: <span class="emphasis"><em>Example_Share</em></span>
	remark:
	path:   <span class="emphasis"><em>C:\srv\samba\example_share\</em></span>
	password:
netname: <span class="emphasis"><em>Example_Printer</em></span>
	remark:
	path:   <span class="emphasis"><em>C:\var\spool\samba\</em></span>
	password:</pre></div></div></li><li class="listitem"><p class="simpara">
							Perform actions using the Security Account Manager Remote (SAMR) protocol.
						</p><div class="example"><a id="idm140241748047280"/><p class="title"><strong>Example 2.11. Listing Users on an SMB Server</strong></p><div class="example-contents"><pre class="literallayout"># rpcclient <span class="emphasis"><em>server_name</em></span> -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator" -c 'enumdomusers'
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrators password:
user:[<span class="emphasis"><em>user1</em></span>] rid:[<span class="emphasis"><em>0x3e8</em></span>]
user:[<span class="emphasis"><em>user2</em></span>] rid:[<span class="emphasis"><em>0x3e9</em></span>]</pre></div></div><p class="simpara">
							If you run the command against a standalone server or a domain member, it lists the users in the local database. Running the command against an AD DC or NT4 PDC lists the domain users.
						</p></li></ul></div><h4><a id="additional_resources_25"/>Additional resources</h4><p>
					For a complete list of supported subcommands, see the <code class="literal">COMMANDS</code> section in the <code class="literal">rpcclient(1)</code> man page.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_using-the-samba-regedit-application_assembly_frequently-used-samba-command-line-utilities"/>Using the samba-regedit application</h2></div></div></div><p>
					Certain settings, such as printer configurations, are stored in the registry on the Samba server. You can use the ncurses-based <code class="literal">samba-regedit</code> application to edit the registry of a Samba server.
				</p><p>
					<span class="inlinemediaobject"><img src="images/samba-regedit.png" alt="samba regedit"/></span>

				</p><h4><a id="prerequisites_18"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">samba-client</code> package is installed.
						</li></ul></div><h4><a id="procedure_39"/>Procedure</h4><p>
					To start the application, enter:
				</p><pre class="literallayout"># samba-regedit</pre><p>
					Use the following keys:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Cursor up and cursor down: Navigate through the registry tree and the values.
						</li><li class="listitem">
							<span class="keycap"><strong>Enter</strong></span>: Opens a key or edits a value.
						</li><li class="listitem">
							<span class="keycap"><strong>Tab</strong></span>: Switches between the <code class="literal">Key</code> and <code class="literal">Value</code> pane.
						</li><li class="listitem">
							<span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>C</strong></span>: Closes the application.
						</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assembly_using-the-smbcacls-utility_assembly_frequently-used-samba-command-line-utilities"/>Using the smbcacls utility</h2></div></div></div><p>
					The <code class="literal">smbcacls</code> utility can list, set, and delete ACLs of files and directories stored on an SMB share. You can use <code class="literal">smbcacls</code> to manage file system ACLs:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							On a local or remote Samba server that uses advanced Windows ACLs or POSIX ACLs
						</li><li class="listitem">
							On Red Hat Enterprise Linux to remotely manage ACLs on a share hosted on Windows
						</li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="con_access-control-entries_assembly_using-the-smbcacls-utility"/>Access control entries</h3></div></div></div><p>
						Each ACL entry of a file system object contains Access Control Entries (ACE) in the following format:
					</p><pre class="literallayout"><span class="emphasis"><em>security_principal</em></span>:<span class="emphasis"><em>access_right</em></span>/<span class="emphasis"><em>inheritance_information</em></span>/<span class="emphasis"><em>permissions</em></span></pre><div class="example"><a id="idm140241748007232"/><p class="title"><strong>Example 2.12. Access control entries</strong></p><div class="example-contents"><p>
							If the <code class="literal">AD\Domain Users</code> group has <code class="literal">Modify</code> permissions that apply to <code class="literal">This folder, subfolders, and files</code> on Windows, the ACL contains the following ACE:
						</p><pre class="literallayout">AD\Domain Users:ALLOWED/OI|CI/CHANGE</pre></div></div><p>
						An ACE contains the following parts:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Security principal</span></dt><dd>
									The security principal is the user, group, or SID the permissions in the ACL are applied to.
								</dd><dt><span class="term">Access right</span></dt><dd>
									Defines if access to an object is granted or denied. The value can be <code class="literal">ALLOWED</code> or <code class="literal">DENIED</code>.
								</dd><dt><span class="term">Inheritance information</span></dt><dd><p class="simpara">
									The following values exist:
								</p><div class="table"><a id="idm140241847111600"/><p class="title"><strong>Table 2.5. Inheritance settings</strong></p><div class="table-contents"><table summary="Inheritance settings" border="1"><colgroup><col class="col_1"/><col class="col_2"/><col class="col_3"/></colgroup><thead><tr><th style="text-align: left" valign="top">Value</th><th style="text-align: left" valign="top">Description</th><th style="text-align: left" valign="top">Maps to</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
													<code class="literal">OI</code>
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													Object Inherit
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													This folder and files
												</p>
												 </td></tr><tr><td style="text-align: left" valign="top"> <p>
													<code class="literal">CI</code>
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													Container Inherit
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													This folder and subfolders
												</p>
												 </td></tr><tr><td style="text-align: left" valign="top"> <p>
													<code class="literal">IO</code>
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													Inherit Only
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													The ACE does not apply to the current file or directory
												</p>
												 </td></tr><tr><td style="text-align: left" valign="top"> <p>
													<code class="literal">ID</code>
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													Inherited
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													The ACE was inherited from the parent directory
												</p>
												 </td></tr></tbody></table></div></div><p class="simpara">
									Additionally, the values can be combined as follows:
								</p><div class="table"><a id="idm140241847078176"/><p class="title"><strong>Table 2.6. Inheritance settings combinations</strong></p><div class="table-contents"><table summary="Inheritance settings combinations" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Value combinations</th><th style="text-align: left" valign="top">Maps to the Windows <code class="literal">Applies to</code> setting</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
													<code class="literal">OI|CI</code>
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													This folder, subfolders, and files
												</p>
												 </td></tr><tr><td style="text-align: left" valign="top"> <p>
													<code class="literal">OI|CI|IO</code>
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													Subfolders and files only
												</p>
												 </td></tr><tr><td style="text-align: left" valign="top"> <p>
													<code class="literal">CI|IO</code>
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													Subfolders only
												</p>
												 </td></tr><tr><td style="text-align: left" valign="top"> <p>
													<code class="literal">OI|IO</code>
												</p>
												 </td><td style="text-align: left" valign="top"> <p>
													Files only
												</p>
												 </td></tr></tbody></table></div></div></dd><dt><span class="term">Permissions</span></dt><dd><p class="simpara">
									This value can be either a hex value that represents one or more Windows permissions or an <code class="literal">smbcacls</code> alias:
								</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
											A hex value that represents one or more Windows permissions.
										</p><p class="simpara">
											The following table displays the advanced Windows permissions and their corresponding value in hex format:
										</p><div class="table"><a id="table_windows-permissions-hex-values_assembly_using-the-smbcacls-utility"/><p class="title"><strong>Table 2.7. Windows permissions and their corresponding smbcacls value in hex format</strong></p><div class="table-contents"><table summary="Windows permissions and their corresponding smbcacls value in hex format" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top">Windows permissions</th><th style="text-align: left" valign="top">Hex values</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
															Full control
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x001F01FF</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Traverse folder / execute file
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00100020</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															List folder / read data
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00100001</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Read attributes
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00100080</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Read extended attributes
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00100008</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Create files / write data
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00100002</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Create folders / append data
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00100004</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Write attributes
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00100100</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Write extended attributes
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00100010</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Delete subfolders and files
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00100040</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Delete
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00110000</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Read permissions
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00120000</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Change permissions
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00140000</code>
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															Take ownership
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															<code class="literal">0x00180000</code>
														</p>
														 </td></tr></tbody></table></div></div><p class="simpara">
											Multiple permissions can be combined as a single hex value using the bit-wise <code class="literal">OR</code> operation. For details, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#con_ace-mask-calculation_assembly_managing-acls-on-an-smb-share-using-smbcacls" title="ACE mask calculation">the section called “ACE mask calculation”</a>.
										</p></li><li class="listitem"><p class="simpara">
											An <code class="literal">smbcacls</code> alias. The following table displays the available aliases:
										</p><div class="table"><a id="table_smbcacls-aliases_assembly_using-the-smbcacls-utility"/><p class="title"><strong>Table 2.8. Existing smbcacls aliases and their corresponding Windows permission</strong></p><div class="table-contents"><table summary="Existing smbcacls aliases and their corresponding Windows permission" border="1"><colgroup><col class="col_1"/><col class="col_2"/></colgroup><thead><tr><th style="text-align: left" valign="top"><code class="literal">smbcacls</code> alias</th><th style="text-align: left" valign="top">Maps to Windows permission</th></tr></thead><tbody><tr><td style="text-align: left" valign="top"> <p>
															<code class="literal">R</code>
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															Read
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															<code class="literal">READ</code>
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															Read &amp; execute
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															<code class="literal">W</code>
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															Special:
														</p>
														 <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
																	Create files / write data
																</li><li class="listitem">
																	Create folders / append data
																</li><li class="listitem">
																	Write attributes
																</li><li class="listitem">
																	Write extended attributes
																</li><li class="listitem">
																	Read permissions
																</li></ul></div>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															<code class="literal">D</code>
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															Delete
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															<code class="literal">P</code>
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															Change permissions
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															<code class="literal">O</code>
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															Take ownership
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															<code class="literal">X</code>
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															Traverse / execute
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															<code class="literal">CHANGE</code>
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															Modify
														</p>
														 </td></tr><tr><td style="text-align: left" valign="top"> <p>
															<code class="literal">FULL</code>
														</p>
														 </td><td style="text-align: left" valign="top"> <p>
															Full control
														</p>
														 </td></tr></tbody></table></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
												You can combine single-letter aliases when you set permissions. For example, you can set <code class="literal">RD</code> to apply the Windows permission <code class="literal">Read</code> and <code class="literal">Delete</code>. However, you can neither combine multiple non-single-letter aliases nor combine aliases and hex values.
											</p></div></li></ul></div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_displaying-acls-using-smbcacls_assembly_using-the-smbcacls-utility"/>Displaying ACLs using smbcacls</h3></div></div></div><p>
						To display ACLs on an SMB share, use the <code class="literal">smbcacls</code> utility. If you run <code class="literal">smbcacls</code> without any operation parameter, such as <code class="literal">--add</code>, the utility displays the ACLs of a file system object.
					</p><h5><a id="procedure_40"/>Procedure</h5><p>
						For example, to list the ACLs of the root directory of the <code class="literal">//server/example</code> share:
					</p><pre class="literallayout"># smbcacls //server/example / -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator"
Enter <span class="emphasis"><em>DOMAIN</em></span>\administrator's password:
REVISION:1
CONTROL:SR|PD|DI|DP
OWNER:AD\Administrators
GROUP:AD\Domain Users
ACL:AD\Administrator:ALLOWED/OI|CI/FULL
ACL:AD\Domain Users:ALLOWED/OI|CI/CHANGE
ACL:AD\Domain Guests:ALLOWED/OI|CI/0x00100021</pre><p>
						The output of the command displays:
					</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								<code class="literal">REVISION</code>: The internal Windows NT ACL revision of the security descriptor
							</li><li class="listitem">
								<code class="literal">CONTROL</code>: Security descriptor control
							</li><li class="listitem">
								<code class="literal">OWNER</code>: Name or SID of the security descriptor’s owner
							</li><li class="listitem">
								<code class="literal">GROUP</code>: Name or SID of the security descriptor’s group
							</li><li class="listitem">
								<code class="literal">ACL</code> entries. For details, see <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#con_access-control-entries_assembly_managing-acls-on-an-smb-share-using-smbcacls" title="Access control entries">the section called “Access control entries”</a>.
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="con_ace-mask-calculation_assembly_using-the-smbcacls-utility"/>ACE mask calculation</h3></div></div></div><p>
						In most situations, when you add or update an ACE, you use the <code class="literal">smbcacls</code> aliases listed in <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#table_smbcacls-aliases_assembly_managing-acls-on-an-smb-share-using-smbcacls" title="Table 2.4. Existing smbcacls aliases and their corresponding Windows permission">Table 2.4, “Existing smbcacls aliases and their corresponding Windows permission”</a>.
					</p><p>
						However, if you want to set advanced Windows permissions as listed in <a class="xref" href="assembly_using-samba-as-a-server_Deploying-different-types-of-servers.html#table_windows-permissions-hex-values_assembly_managing-acls-on-an-smb-share-using-smbcacls" title="Table 2.3. Windows permissions and their corresponding smbcacls value in hex format">Table 2.3, “Windows permissions and their corresponding smbcacls value in hex format”</a>, you must use the bit-wise <code class="literal">OR</code> operation to calculate the correct value. You can use the following shell command to calculate the value:
					</p><pre class="literallayout"># echo $(printf '0x%X' $(( hex_value_1 | hex_value_2 | ... )))</pre><div class="example"><a id="idm140241755329040"/><p class="title"><strong>Example 2.13. Calculating an ACE Mask</strong></p><div class="example-contents"><p>
							You want to set the following permissions:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
									Traverse folder / execute file (0x00100020)
								</li><li class="listitem">
									List folder / read data (0x00100001)
								</li><li class="listitem">
									Read attributes (0x00100080)
								</li></ul></div><p>
							To calculate the hex value for the previous permissions, enter:
						</p><pre class="literallayout"># echo $(printf '0x%X' $(( 0x00100020 | 0x00100001 | 0x00100080 )))
<code class="literal">0x1000A1</code></pre><p>
							Use the returned value when you set or update an ACE.
						</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_adding-updating-and-removing-an-acl-using-smbcacls_assembly_using-the-smbcacls-utility"/>Adding, updating, and removing an ACL using smbcacls</h3></div></div></div><p>
						Depending on the parameter you pass to the <code class="literal">smbcacls</code> utility, you can add, update, and remove ACLs from a file or directory.
					</p><h5><a id="adding_an_acl_2"/>Adding an ACL</h5><p>
						To add an ACL to the root of the <code class="literal">//server/example</code> share that grants <code class="literal">CHANGE</code> permissions for <code class="literal">This folder, subfolders, and files</code> to the <code class="literal">AD\Domain Users</code> group:
					</p><pre class="literallayout"># smbcacls //server/example / -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator \
       --add ACL:"AD\Domain Users":ALLOWED/OI|CI/CHANGE</pre><h5><a id="updating_an_acl_2"/>Updating an ACL</h5><p>
						Updating an ACL is similar to adding a new ACL. You update an ACL by overriding the ACL using the <code class="literal">--modify</code> parameter with an existing security principal. If <code class="literal">smbcacls</code> finds the security principal in the ACL list, the utility updates the permissions. Otherwise the command fails with an error:
					</p><pre class="literallayout">ACL for SID <span class="emphasis"><em>principal_name</em></span> not found</pre><p>
						For example, to update the permissions of the <code class="literal">AD\Domain Users</code> group and set them to <code class="literal">READ</code> for <code class="literal">This folder, subfolders, and files</code>:
					</p><pre class="literallayout"># smbcacls //server/example / -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator \
       --modify ACL:"AD\Domain Users":ALLOWED/OI|CI/READ</pre><h5><a id="deleting_an_acl_2"/>Deleting an ACL</h5><p>
						To delete an ACL, pass the <code class="literal">--delete</code> parameter with the exact ACL to the <code class="literal">smbcacls</code> utility. For example:
					</p><pre class="literallayout"># smbcacls //server/example / -U "<span class="emphasis"><em>DOMAIN</em></span>\administrator \
       --delete ACL:"AD\Domain Users":ALLOWED/OI|CI/READ</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="assembly_using-the-smbclient-utility_assembly_frequently-used-samba-command-line-utilities"/>Using the smbclient utility</h2></div></div></div><p>
					The smbclient utility enables you to access file shares on an SMB server, similarly to a command-line FTP client. You can use it, for example, to upload and download files to and from a share.
				</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="prerequisites-assembly_using-the-smbclient-utility"/>Prerequisites</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								The <code class="literal">samba-client</code> package is installed.
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="con_how-the-smbclient-interactive-mode-works_assembly_using-the-smbclient-utility"/>How the smbclient interactive mode works</h3></div></div></div><p>
						For example, to authenticate to the <code class="literal">example</code> share hosted on <code class="literal">server</code> using the <code class="literal"><span class="emphasis"><em>DOMAIN\user</em></span></code> account:
					</p><pre class="literallayout"># smbclient -U "<span class="emphasis"><em>DOMAIN\user</em></span>" //<span class="emphasis"><em>server</em></span>/<span class="emphasis"><em>example</em></span>
Enter <span class="emphasis"><em>domain\user</em></span>'s password:
Try "help" to get a list of possible commands.
smb: \&gt;</pre><p>
						After <code class="literal">smbclient</code> connected successfully to the share, the utility enters the interactive mode and shows the following prompt:
					</p><pre class="literallayout">smb: \&gt;</pre><p>
						To display all available commands in the interactive shell, enter:
					</p><pre class="literallayout">smb: \&gt; help</pre><p>
						To display the help for a specific command, enter:
					</p><pre class="literallayout">smb: \&gt; help <span class="emphasis"><em>command_name</em></span></pre><h5><a id="additional_resources_26"/>Additional resources</h5><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
								For further details and descriptions of the commands available in the interactive shell, see the <code class="literal">smbclient(1)</code> man page.
							</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_using-smbclient-in-interactive-mode_assembly_using-the-smbclient-utility"/>Using smbclient in interactive mode</h3></div></div></div><p>
						If you use <code class="literal">smbclient</code> without the <code class="literal">-c</code> parameter, the utility enters the interactive mode. The following procedure shows how to connect to an SMB share and download a file from a subdirectory.
					</p><h5><a id="procedure_41"/>Procedure</h5><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
								Connect to the share:
							</p><pre class="literallayout"># smbclient -U "<span class="emphasis"><em>DOMAIN\user_name</em></span>" //<span class="emphasis"><em>server_name</em></span>/<span class="emphasis"><em>share_name</em></span></pre></li><li class="listitem"><p class="simpara">
								Change into the <code class="literal">/example/</code> directory:
							</p><pre class="literallayout">smb: \&gt; cd /example/</pre></li><li class="listitem"><p class="simpara">
								List the files in the directory:
							</p><pre class="literallayout">smb: \example\&gt; ls
  .                    D         0  Thu Nov 1 10:00:00 2018
  ..                   D         0  Thu Nov 1 10:00:00 2018
  example.txt          N   1048576  Thu Nov 1 10:00:00 2018

         9950208 blocks of size 1024. 8247144 blocks available</pre></li><li class="listitem"><p class="simpara">
								Download the <code class="literal">example.txt</code> file:
							</p><pre class="literallayout">smb: \example\&gt; get example.txt
getting file \directory\subdirectory\example.txt of size 1048576 as example.txt (511975,0 KiloBytes/sec) (average 170666,7 KiloBytes/sec)</pre></li><li class="listitem"><p class="simpara">
								Disconnect from the share:
							</p><pre class="literallayout">smb: \example\&gt; exit</pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proc_using-smbclient-in-scripting-mode_assembly_using-the-smbclient-utility"/>Using smbclient in scripting mode</h3></div></div></div><p>
						If you pass the <code class="literal">-c</code> parameter to <code class="literal">smbclient</code>, you can automatically execute the commands on the remote SMB share. This enables you to use <code class="literal">smbclient</code> in scripts.
					</p><p>
						The following procedure shows how to connect to an SMB share and download a file from a subdirectory.
					</p><h5><a id="procedure_42"/>Procedure</h5><pre class="literallayout"># smbclient -U <span class="emphasis"><em>DOMAIN\user_name</em></span> //<span class="emphasis"><em>server_name</em></span>/<span class="emphasis"><em>share_name</em></span> \
       -c "cd /example/ ; get example.txt ; exit"</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_using-the-smbcontrol-utility_assembly_frequently-used-samba-command-line-utilities"/>Using the smbcontrol utility</h2></div></div></div><p>
					The <code class="literal">smbcontrol</code> utility enables you to send command messages to the <code class="literal">smbd</code>, <code class="literal">nmbd</code>, <code class="literal">winbindd</code>, or all of these services. These control messages instruct the service, for example, to reload its configuration.
				</p><p>
					The procedure in this section shows how to to reload the configuration of the <code class="literal">smbd</code>, <code class="literal">nmbd</code>, <code class="literal">winbindd</code> services by sending the <code class="literal">reload-config</code> message type to the <code class="literal">all</code> destination.
				</p><h4><a id="prerequisites_19"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">samba-common-tools</code> package is installed.
						</li></ul></div><h4><a id="procedure_43"/>Procedure</h4><pre class="literallayout"># smbcontrol all reload-config</pre><h4><a id="additional_resources_27"/>Additional resources</h4><p>
					For further details and a list of available command message types, see the <code class="literal">smbcontrol(1)</code> man page.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_using-the-smbpasswd-utility_assembly_frequently-used-samba-command-line-utilities"/>Using the smbpasswd utility</h2></div></div></div><p>
					The <code class="literal">smbpasswd</code> utility manages user accounts and passwords in the local Samba database.
				</p><h4><a id="prerequisites_20"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">samba-common-tools</code> package is installed.
						</li></ul></div><h4><a id="procedure_44"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							If you run the command as a user, <code class="literal">smbpasswd</code> changes the Samba password of the user who run the command. For example:
						</p><pre class="literallayout">[user@server ~]$ smbpasswd
New SMB password: <span class="emphasis"><em>password</em></span>
Retype new SMB password: <span class="emphasis"><em>password</em></span></pre></li><li class="listitem"><p class="simpara">
							If you run <code class="literal">smbpasswd</code> as the <code class="literal">root</code> user, you can use the utility, for example, to:
						</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
									Create a new user:
								</p><pre class="literallayout">[root@server ~]# smbpasswd -a <span class="emphasis"><em>user_name</em></span>
New SMB password: <span class="emphasis"><em>password</em></span>
Retype new SMB password: <span class="emphasis"><em>password</em></span>
Added user <span class="emphasis"><em>user_name</em></span>.</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
										Before you can add a user to the Samba database, you must create the account in the local operating system. See the <a class="link" href="https://doc-stage.usersys.redhat.com/documentation/en-us/red_hat_enterprise_linux/8_test/html/getting_started_with_system_administration/managing-users-groups-permissions/#sec-users-tools-users-add">Adding a new user</a> section in the Configuring and managing system administration guide.
									</p></div></li><li class="listitem"><p class="simpara">
									Enable a Samba user:
								</p><pre class="literallayout">[root@server ~]# smbpasswd -e <span class="emphasis"><em>user_name</em></span>
Enabled user <span class="emphasis"><em>user_name</em></span>.</pre></li><li class="listitem"><p class="simpara">
									Disable a Samba user:
								</p><pre class="literallayout">[root@server ~]# smbpasswd -x <span class="emphasis"><em>user_name</em></span>
Disabled user <span class="emphasis"><em>ser_name</em></span></pre></li><li class="listitem"><p class="simpara">
									Delete a user:
								</p><pre class="literallayout">[root@server ~]# smbpasswd -x <span class="emphasis"><em>user_name</em></span>
Deleted user <span class="emphasis"><em>user_name</em></span>.</pre></li></ul></div></li></ol></div><h4><a id="additional_resources_28"/>Additional resources</h4><p>
					For further details, see the <code class="literal">smbpasswd(8)</code> man page.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_using-the-smbstatus-utility_assembly_frequently-used-samba-command-line-utilities"/>Using the smbstatus utility</h2></div></div></div><p>
					The <code class="literal">smbstatus</code> utility reports on:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							Connections per PID of each <code class="literal">smbd</code> daemon to the Samba server. This report includes the user name, primary group, SMB protocol version, encryption, and signing information.
						</li><li class="listitem">
							Connections per Samba share. This report includes the PID of the <code class="literal">smbd</code> daemon, the IP of the connecting machine, the time stamp when the connection was established, encryption, and signing information.
						</li><li class="listitem">
							A list of locked files. The report entries include further details, such as opportunistic lock (oplock) types
						</li></ul></div><h4><a id="prerequisites_21"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">samba</code> package is installed.
						</li><li class="listitem">
							The <code class="literal">smbd</code> service is running.
						</li></ul></div><h4><a id="procedure_45"/>Procedure</h4><pre class="literallayout"># smbstatus

Samba version 4.7.1
PID  Username              Group                Machine                            Protocol Version  Encryption  Signing
-----------------------------------------------------------------------------------------------------------------------------
963  <span class="emphasis"><em>DOMAIN</em></span>\administrator  <span class="emphasis"><em>DOMAIN</em></span>\domain users  client-pc  (ipv4:192.0.2.1:57786)  SMB3_02           -           AES-128-CMAC

Service  pid  Machine    Connected at                  Encryption  Signing:
-------------------------------------------------------------------------------
example  969  192.0.2.1  Thu Nov  1 10:00:00 2018 CEST  -           AES-128-CMAC

Locked files:
Pid  Uid    DenyMode   Access    R/W     Oplock      SharePath           Name      Time
------------------------------------------------------------------------------------------------------------
969  10000  DENY_WRITE 0x120089  RDONLY  LEASE(RWH)  /srv/samba/example  file.txt  Thu Nov  1 10:00:00 2018</pre><h4><a id="additional_resources_29"/>Additional resources</h4><p>
					For further details, see the <code class="literal">smbstatus(1)</code> man page.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_using-the-smbtar-utility_assembly_frequently-used-samba-command-line-utilities"/>Using the smbtar utility</h2></div></div></div><p>
					The <code class="literal">smbtar</code> utility backs up the content of an SMB share or a subdirectory of it and stores the content in a <code class="literal">tar</code> archive. Alternatively, you can write the content to a tape device.
				</p><p>
					The procedure in this section describes how to back up the content of the <code class="literal">demo</code> directory on the <code class="literal">//server/example/</code> share and store the content in the <code class="literal">/root/example.tar</code> archive.
				</p><h4><a id="prerequisites_22"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">samba-client</code> package is installed.
						</li></ul></div><h4><a id="procedure_46"/>Procedure</h4><pre class="literallayout"># smbtar -s <span class="emphasis"><em>server</em></span> -x <span class="emphasis"><em>example</em></span> -u <span class="emphasis"><em>user_name</em></span> -p <span class="emphasis"><em>password</em></span> -t <span class="emphasis"><em>/root/example.tar</em></span></pre><h4><a id="additional_resources_30"/>Additional resources</h4><p>
					For further details, see the <code class="literal">smbtar(1)</code> man page.
				</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_using-the-testparm-utility_assembly_frequently-used-samba-command-line-utilities"/>Using the testparm utility</h2></div></div></div><p>
					The <code class="literal">testparm</code> utility verifies that the Samba configuration in the <code class="literal">/etc/samba/smb.conf</code> file is correct. The utility detects invalid parameters and values, but also incorrect settings, such as for ID mapping. If <code class="literal">testparm</code> reports no problem, the Samba services will successfully load the <code class="literal">/etc/samba/smb.conf</code> file. Note that <code class="literal">testparm</code> cannot verify that the configured services will be available or work as expected.
				</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
						Red Hat recommends that you verify the <code class="literal">/etc/samba/smb.conf</code> file by using <code class="literal">testparm</code> after each modification of this file.
					</p></div><h4><a id="procedure_47"/>Procedure</h4><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p class="simpara">
							Run the <code class="literal">testparm</code> utility as the <code class="literal">root</code> user:
						</p><pre class="literallayout"># testparm
Load smb config files from /etc/samba/smb.conf
rlimit_max: increasing rlimit_max (1024) to minimum Windows limit (16384)
<span class="strong"><strong>Unknown parameter encountered: "log levell"</strong></span>
Processing section "[example_share]"
Loaded services file OK.
<span class="strong"><strong>ERROR: The idmap range for the domain * (tdb) overlaps with the range of DOMAIN (ad)!</strong></span>

Server role: ROLE_DOMAIN_MEMBER

Press enter to see a dump of your service definitions

# Global parameters
[global]
	...

[example_share]
	...</pre><p class="simpara">
							The previous example output reports a non-existent parameter and an incorrect ID mapping configuration.
						</p></li><li class="listitem">
							If <code class="literal">testparm</code> reports incorrect parameters, values, or other errors in the configuration, fix the problem and run the utility again.
						</li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="proc_using-the-wbinfo-utility_assembly_frequently-used-samba-command-line-utilities"/>Using the wbinfo utility</h2></div></div></div><p>
					The <code class="literal">wbinfo</code> utility queries and returns information created and used by the <code class="literal">winbindd</code> service.
				</p><h4><a id="prerequisites_23"/>Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
							The <code class="literal">samba-winbind-clients</code> package is installed.
						</li></ul></div><h4><a id="procedure_48"/>Procedure</h4><p>
					You can use <code class="literal">wbinfo</code>, for example, to:
				</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
							List domain users:
						</p><pre class="literallayout"># wbinfo -u
AD\administrator
AD\guest
...</pre></li><li class="listitem"><p class="simpara">
							List domain groups:
						</p><pre class="literallayout"># wbinfo -g
AD\domain computers
AD\domain admins
AD\domain users
...</pre></li><li class="listitem"><p class="simpara">
							Display the SID of a user:
						</p><pre class="literallayout"># wbinfo --name-to-sid="AD\administrator"
<span class="emphasis"><em>S-1-5-21-1762709870-351891212-3141221786-500</em></span> SID_USER (1)</pre></li><li class="listitem"><p class="simpara">
							Display information about domains and trusts:
						</p><pre class="literallayout"># wbinfo --trusted-domains --verbose
Domain Name   DNS Domain            Trust Type  Transitive  In   Out
BUILTIN                             None        Yes         Yes  Yes
<span class="emphasis"><em>server</em></span>                              None        Yes         Yes  Yes
<span class="emphasis"><em>DOMAIN1</em></span>       <span class="emphasis"><em>domain1.example.com</em></span>   None        Yes         Yes  Yes
<span class="emphasis"><em>DOMAIN2</em></span>       <span class="emphasis"><em>domain2.example.com</em></span>   External    No          Yes  Yes</pre></li></ul></div><h4><a id="additional_resources_31"/>Additional resources</h4><p>
					For further details, see the <code class="literal">wbinfo(1)</code> man page.
				</p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="related-information-assembly_using-samba-as-a-server"/>Related information</h1></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara">
						The Red Hat Samba packages include manual pages for all Samba commands and configuration files the package installs. For example, to display the man page of the <code class="literal">/etc/samba/smb.conf</code> file that explains all configuration parameters you can set in this file:
					</p><pre class="literallayout"># man 5 smb.conf</pre></li><li class="listitem">
						The <code class="literal">/usr/share/docs/samba-version/</code> directory contains general documentation, example scripts, and LDAP schema files, provided by the Samba project.
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_gluster_storage/3.3/html/administration_guide/sect-smb">Red Hat Cluster Storage Administration Guide</a>: Provides information about setting up Samba and the Clustered Trivial Database (CDTB) to share directories stored on an GlusterFS volume.
					</li><li class="listitem">
						For details about mounting an SMB share on Red Hat Enterprise Linux, see the corresponding section in the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_and_managing_storage_and_filesystems/assembly_mounting-an-smb-share-on-red-hat-enterprise-linux_configuring-and-managing-storage-and-filesystems">Configuring and managing storage and file systems</a> documentation.
					</li></ul></div></div></div></body></html>