<html >
<head>
<title>档案支持</title>
<link href="book.css" rel="stylesheet" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.75.1">
<link rel="home" href="index.html" title="Xpand Documentation">
<link rel="up" href="uml2example.html" title="UML2 Example">
<link rel="prev" href="uml2example_codegen.html" title="Code generation">
<link rel="next" href="xsd_tutorial.html" title="XSD Tutorial">
</head>
<body bgcolor="white"  text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<h1 xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">档案支持</h1>
<div class="section" title="档案支持">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear:both">
<a name="uml2example_profiles"></a>档案支持</h2>
</div>
</div>
</div>
<p>Xpand附带了一个特殊的<span class="emphasis"><em>UML2配置文件</em></span>元模型实现。实现映射了Stereotypes <a name="N12FC5" class="indexterm"></a>到类型和标记值<a name="N12FC9" class="indexterm"></a>简单的属性。它还支持Enumerations <a name="N12FCD" class="indexterm"></a>在配置文件和Stereotype层次结构中定义。</p>
<div class="section" title="定义配置文件">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="uml2example_profiles_define"></a>定义配置文件</h3>
</div>
</div>
</div>
<p>要定义配置文件，您可以使用各种基于UML2的建模工具。假设他们确实正确地创建了配置文件定义（并非总是如此，因为我们必须痛苦地学习），创建配置文件并正确导出它是直截了当的。</p>
<p>在本节中，我们将解释“手动方式”，它有助于解释发生的情况，但对实际使用完全没用。您不希望使用下面解释的机制构建实际大小的模型。</p>
<p>您开始创建一个新的UML2文件（如上所示）。在示例中，我们将其<code class="filename">test.profile.uml</code> 。但是，根元素将是一个<span class="emphasis"><em>配置文件</em></span> ，而不是一个<span class="emphasis"><em>包</em></span> 。不要忘记为配置文件实际指定名称！它也应该是<code class="literal">test</code> 。</p>
<p>创建的<span class="emphasis"><em>Profile</em></span>我们称之为<code class="literal">test</code> 。在我们的例子中，我们希望使构造型适用于UML类 - 它们被定义为UML2元模型的一部分。所以我们必须首先导入该元模型。因此，您要做的是选择您的配置文件对象，然后转到UML2 Editor菜单（在Eclipse菜单栏中）并选择<span class="emphasis"><em>Profile  - &gt; Reference Metaclass</em></span> 。选择<code class="classname">uml::Class</code> 。然后，在您的配置文件中添加一个原型（在配置文件上单击鼠标右键 - &gt; <span class="emphasis"><em>New Child</em></span> - &gt; <span class="emphasis"><em>Owned Stereotype</em></span> - &gt; <span class="emphasis"><em>Stereotype）。</em>
</span>现在您可以定义构造型：从UML2 Editor菜单中选择<span class="emphasis"><em>Stereotype  - &gt; Create Extension</em></span> 。选择<code class="classname">uml::Class</code> 。这应该导致以下模型。保存它，您完成了配置文件定义。</p>
<div class="figure">
<a name="uml2example_profile"></a>
<p class="title">
<b>图5。建模配置文件</b>
</p>
<div class="figure-contents">
<div class="mediaobject">
<img src="images/uml2_example/profile.png" alt="建模配置文件">
</div>
</div>
</div>
<br class="figure-break">
</div>
<div class="section" title="应用个人资料">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="uml2example_profile_apply"></a>应用个人资料</h3>
</div>
</div>
</div>
<p>要使用配置文件，我们必须将其应用于某种模型。为此，我们将<code class="filename">example.uml</code>模型复制到<code class="filename">example-profiled.uml</code> 。然后我们打开该文件并加载资源，即我们刚刚定义的配置文件。这看起来有点像这样：</p>
<div class="figure">
<a name="uml2example_profileApp1"></a>
<p class="title">
<b>图6。加载个人资料</b>
</p>
<div class="figure-contents">
<div class="mediaobject">
<img src="images/uml2_example/profileApp1.gif" alt="加载个人资料">
</div>
</div>
</div>
<br class="figure-break">
<p>现在，要使以下内容有效，首先必须选择配置文件，然后从UML2 Editor菜单中选择<span class="emphasis"><em>Profile  - &gt; Define</em></span>操作。这会创建各种其他模型元素，您现在不应该关注这些元素。</p>
<p>现在，最后，您可以选择您的<code class="literal">cars</code>包（示例模型中的一个）并从UML2 Editor菜单中选择<span class="emphasis"><em>Package  - &gt; Apply Profile</em></span> 。选择要应用的测试配置文件。</p>
<p>出于此示例的目的，您现在应该将测试<code class="classname">PersonCar</code>型应用于<code class="classname">PersonCar</code>类。选择类，然后从UML2 Editor菜单中选择<span class="emphasis"><em>Element  - &gt; Apply Stereotype</em></span> 。这应该导致以下模型：</p>
<div class="figure">
<a name="uml2example_profileApp2"></a>
<p class="title">
<b>图7。定义配置文件</b>
</p>
<div class="figure-contents">
<div class="mediaobject">
<img src="images/uml2_example/profileApp2.png" alt="定义配置文件">
</div>
</div>
</div>
<br class="figure-break">
</div>
<div class="section" title="生成代码">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="uml2example_profiles_codegen"></a>生成代码</h3>
</div>
</div>
</div>
<p>请注意，上面的所有内容都与Xpand没有任何关系，它只是创建和应用配置文件到UML2模型的“裸骨”手段。拥有一个能够将模型存储为EMF UML2 XMI的UML2工具<a name="N13055" class="indexterm"></a>会使模型的创建更容易。由于我们无法假设您正在使用哪个UML2工具，因此本教程将以这种方式向您展示，如果不安装其他工具，它将始终有效。</p>
<p>我们必须改变两件事：工作流（特别是生成器组件的配置）需要知道配置文件，如果类应用了测试构造型，模板需要生成不同的代码。让我们先来看第二个方面。这是修改后的模板（在<code class="filename">RootWithProfile.xpt</code> ）：</p>
<pre class="programlisting">«DEFINE Root FOR uml::Model»
  «EXPAND PackageRoot FOREACH allOwnedElements().typeSelect(uml::Package)»
«ENDDEFINE»
 
«DEFINE PackageRoot FOR uml::Package»
  «EXPAND ClassRoot FOREACH ownedType.typeSelect(uml::Class)»
«ENDDEFINE»  
    
«DEFINE ClassRoot FOR uml::Class»
  «FILE name+".java"»  
    public class «name» {}
  «ENDFILE»
«ENDDEFINE» 

«DEFINE ClassRoot FOR test::test»
  «FILE name+".java"»  
    public class «name» {} // stereotyped
  «ENDFILE»
«ENDDEFINE»  </pre>
<p>正如您所看到的， <span class="bold"><strong>构造型就像一个类型</strong></span> ，甚至基类型（ <code class="classname">uml::Class</code> ）和<code class="classname">uml::Class</code>型之间的多态分派也起作用！</p>
<p>调整工作流文件也很简单（ <code class="filename">workflowWithProfile.mwe</code> ）。以下是使用新模型<code class="filename">example-profiled.uml</code>和扩展设置的修改后的模型组件：</p>
<pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;workflow&gt;
 &lt;!-- set up EMF for standalone execution --&gt;
 &lt;bean class="org.eclipse.emf.mwe.utils.StandaloneSetup" platformUri=".." /&gt;

 &lt;!-- prepare for performing uml --&gt;
 &lt;bean class="org.eclipse.xtend.typesystem.uml2.Setup" standardUML2Setup="true" /&gt;
    
 &lt;!--UML2 Profile - Metamodell--&gt;
 &lt;bean id="mm_profile" class="org.eclipse.xtend.typesystem.uml2.profile.ProfileMetaModel"&gt;
  &lt;profile value="platform:/resource/xpand.uml2.generator/src/test.profile.uml"/&gt;
 &lt;/bean&gt;

&lt;!-- load model and store it in slot 'model' --&gt;
&lt;component class="org.eclipse.emf.mwe.utils.Reader"&gt;
  &lt;uri value="platform:/resource/xpand.uml2.generator/src/example-profiled.uml" /&gt;
  &lt;modelSlot value="model" /&gt;
&lt;/component&gt;</pre>
<p>这是修改后的生成器组件：</p>
<pre class="programlisting">&lt;component id="generator" class="org.eclipse.xpand2.Generator" skipOnErrors="true"&gt;
  &lt;metaModel idRef="mm_profile"/&gt;
  &lt;expand value="templates::Root::Root FOR model"/&gt;
  &lt;fileEncoding value="ISO-8859-1"/&gt;
  &lt;outlet path="src-gen"&gt;
   &lt;postprocessor class="org.eclipse.xpand2.output.JavaBeautifier"/&gt;
  &lt;/outlet&gt;
&lt;/component&gt;
&lt;/workflow&gt;</pre>
<p>我们唯一要做的就是添加一个引用我们刚创建的配置文件的新元模型。</p>
</div>
</div>
</body>
</html>
