<?xml version="1.0" encoding="UTF-8" ?="">
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd" gtc:encodedoriginal="PCFET0NUWVBFIGh0bWwgUFVCTElDICItLy9XM0MvL0RURCBYSFRNTCAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvVFIveGh0bWwxMS9EVEQveGh0bWwxMS5kdGQiPg==">
<html  xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=UTF-8" http-equiv="CONTENT-TYPE">
<link rel="stylesheet" href="../../book.css" type="text/css">
<title>结构化活动</title>
</head>

<body >
	<h1>结构化活动</h1>

	<p>结构化活动可以被视为可以容纳一个或多个活动的容器。<strong>Palette</strong>的<strong>Controls</strong>部分包含所有<em>结构化活动</em> 。将其中一个拖放到绘图画布上时，BPEL Designer将创建活动的基本框架，并指定默认属性。
	</p>
	<p>所有结构化活动在被认为有效之前都需要一些额外的配置。例如，BPEL不允许空的Sequence活动。无效的结构化活动将使用类似于基本活动的错误图标进行修饰。</p>
	<p>通过单击图底部的加号和减号按钮，可以在绘图画布上展开和折叠结构化活动。下面的插图是折叠和扩展的序列：</p>

	<p><img src="../../..images/reference/BPEL_Designer_12.png" alt="折叠序列"></p>
	<p><b>折叠序列</b></p>
	
	<p><img src="../../../images/reference/BPEL_Designer_13.png" alt="扩展序列"></p>
	<p><b>扩展序列</b></p>

	<p>以下部分描述了结构化活动以及如何将每个活动配置为对BPEL有效。</p>

	<h5>如果</h5>
	<p><img src="../../../images/reference/BPEL_Designer_14.png" alt="如果，ElseIf和Else"></p>
	<p><b>如果，ElseIf和Else</b></p>
	<p>If活动允许有条件地执行一个或多个活动序列。它由If和可选ElseIf元素定义的一个或多个条件分支的序列组成。元素按从左到右的顺序进行评估（如果选择了水平布局，则从上到下进行评估）。如果没有其他条件为真，则将执行可选的Else分支。
	</p>
	<p>If活动必须定义条件（表示为XPath）和条件计算为true时执行的活动。要插入其他ElseIf和Else元素，请右键单击If图，然后从上下文菜单中选择所需的元素。上图显示了带有可选ElseIf和Else元素的完整If活动。
	</p>

	<h5>挑</h5>
	<p><img src="../../../images/reference/BPEL_Designer_15.png" alt="挑"></p>
	<p><b>挑</b></p>
	<p>Pick活动将使进程等待接收任意数量的消息之一。可以设置可选的计时器以限制等待接收这些消息的时间。Pick中定义了处理消息接收和计时器到期的活动。消息收据通过的onMessage活动（处理<a href="#Reference-Details_tab-OnMessage">的onMessage</a> ），并且计时器期满由OnAlaram活性（处理<a href="#Reference-Details_tab-OnAlarm">OnAlarm</a> ）。
	</p>

	<h5>而</h5>
	<p><img src="../../../images/reference/BPEL_Designer_16.png" alt="而"></p>
	<p><b>而</b></p>
	<p>只要条件在每次迭代开始时的计算结果为true，While活动就会重复执行包含的活动。While活动必须定义条件并且必须包含活动。
	</p>

	<h5>的ForEach</h5>
	<p><img src="../../../images/reference/BPEL_Designer_17.png" alt="的ForEach"></p>
	<p><b>的ForEach</b></p>
	<p>ForEach是一个循环活动，它以指定的次数执行其Scope中包含的活动。在ForEach属性详细信息选项卡中定义的计数器变量用于跟踪迭代。必须使用此计数器变量的起始和结束值表达式配置ForEach属性。计数器最初设置为起始值，并且执行范围中的活动，直到计数器超过结束值。
	</p>
	<p>此活动还可以配置为并行执行所有迭代，这意味着所包含的Scope活动的行为就像多个Scope包含在Flow活动中一样。
	</p>
	<p>可以定义可选的提前终止值，这将导致循环在计数器达到其结束值之前完成。当计数器等于顺序执行情况的此提前终止值时，ForEach将完成。对于并行执行情况，提前终止值是已完成迭代的数量。例如，当至少<em>一些</em> <em>一些行动</em>的<em>数量</em>已经完成了的ForEach完成。
	</p>
	
	<h5>RepeatUntil</h5>
	<p><img src="../../../images/reference/BPEL_Designer_18.png" alt="RepeatUntil"></p>
	<p><b>RepeatUntil</b></p>
	<p>只要条件在每次迭代结束时计算为true，RepeatUntil活动就会重复执行包含的活动。必须为RepeatUntil定义条件，并且它必须包含活动。
	</p>
	
	<h5>序列</h5>
	<p>Sequence是一个或多个其他活动的容器，按顺序执行（与Scope和Flow活动不同），没有其他特殊功能。因为条件活动（If，While，RepeatUntil和ForEach）只能有一个活动作为其执行目标，所以Sequence通常用于执行多个活动。
	</p>
	<p>例如，下面显示的If仅包含一个Assign活动：</p>
	
	<p><img src="../../../images/reference/BPEL_Designer_19.png" alt="序列"></p>
	<p><b>序列</b></p>
	<p>如果有必要执行赋值然后调用另一个Web服务，则Assign和Invoke可以包含在Sequence中。然后序列将成为If的目标：</p>

	<p><img src="../../../images/reference/BPEL_Designer_20.png" alt="序列"></p>
	<p><b>序列</b></p>
	
	<h2>注意</h2>
	<p>如果将第二个活动拖放到任何条件活动中，BPEL Designer将自动创建一个序列。
	</p>

	<h5>范围</h5>
	<p><img src="../../../images/reference/BPEL_Designer_21.png" alt="范围"></p>
	<p><b>范围</b></p>
	<p>范围为其附带的活动提供上下文。此上下文包括变量，合作伙伴链接，消息交换，关联集，事件处理程序，故障处理程序，补偿处理程序和终止处理程序。这些Scope上下文可以按层次嵌套，其中根上下文由进程本身提供。
	</p>
	<p>范围可以被认为是一个划分的子过程。如果声明Scope被<em>隔离</em> ，那么与进程共享的变量和伙伴链接将被锁定，以防止其他并发Scope在执行Scope时更改它们。范围也可以嵌套到任何深度，并且范围内定义的所有变量，伙伴链接和其他变量都由其子项继承。有关并发执行的讨论，请参阅<a href="#Reference-BPEL_Designer-Structured_Activities-Flow">Flow</a> 。
	</p>

	<p>为了有效，Scope必须具有单个活动。Scope活动的典型用法是调用服务并等待响应消息或超时。在上图中，Scope定义了一个消息变量和一个用于与被调用服务交互的伙伴链接。
	</p>
	
	<h5>流</h5>
	<p>Flow活动允许并行执行多个活动。BPEL引擎同时执行（或开始）Flow中包含的所有活动或活动序列。当所有封闭活动完成时，流程完成。
	</p>
	<p>并行处理通常用于通过一次执行多个操作来节省时间，从而加快处理速度。但是，在许多情况下，可以同时启动多个任务，但是一个或多个任务可能取决于其他任务的成功完成。此任务依赖性排序称为<em>同步</em> ，使用Links实现。
	</p>
	<p>例如，处理物料采购订单的流程需要：</p>

	<ol>
		<li><p>计算总订单价格</p></li>
		<li><p>计算订单的运费</p></li>
		<li><p>发送客户发票</p></li>
	</ol>

	<p>所有这些活动可以同时开始，但是必须在确定总订单价格之前完成运输成本，并且可以发送发票。
	</p>

	<p>要创建链接，请右键单击必须首先完成的活动（作为依赖项<em>源</em>的活动），然后从上下文菜单中选择“ <strong>添加链接</strong> ”。接下来，将鼠标移动到Flow中依赖于此活动（ <em>目标</em> ）的活动，然后单击鼠标左键以创建链接。
	</p>
	<p>链接由名称标识，该名称在流程中必须是唯一的。BPEL Designer生成合理的默认名称，但您可以在其属性中更改此名称。您还可以向链接添加测试，该测试定义了考虑完成活动的条件。例如，Flow中的活动可能需要由其他服务提供的两条信息才能继续。考虑以下流程：</p>

	<p><img src="../../../images/reference/BPEL_Designer_22.png" alt="流程示例"></p>
	<p><b>流程示例</b></p>
	<p>在此示例中， <em>开票</em>部门可以开始准备客户发票，但需要知道是否有足够的库存来完成订单，以及外部供应商是否需要提供订购的额外数量。以下条件将启用链接，以便可以继续执行价格计算和客户发票：</p>

	<p><img src="../../../images/reference/BPEL_Designer_23.png" alt="链接示例"></p>
	<p><b>链接示例</b></p>
	
	<p>此过程仅部分完成，因为它不考虑外部供应商的数量，或者是否可以填写订购的总数量。
	</p>
</body>
</html>
