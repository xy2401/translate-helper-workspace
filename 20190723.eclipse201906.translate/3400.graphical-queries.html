<html lang="zh-Hans" >
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>图形查询编辑器</title>
<link rel="stylesheet" href="asset?aid=1">
<link rel="stylesheet" href="./asciidoctor.css">
</head>
<body id="vgql-editor" class="article" >
<div id="header">
<h1>图形查询编辑器</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>本节介绍VIATRA 2.1（随Eclipse 2018-12发布）中包含的图形查询编辑器。此编辑器的目标是支持以图形语法创建模型查询，同时保持与VIATRA的现有基础结构的兼容性，包括运行时和查询开发环境。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_requirements_and_installation">要求和安装</h2>
<div class="sectionbody">
<div class="paragraph">
<p>当前版本的编辑器基于Sirius 6.0（因此也可以传递Eclipse Oxygen）。此外，它还需要安装当前版本的VIATRA 2.1 IDE。要下载该版本，请使用以下p2存储库： <code><a href="http://download.eclipse.org/viatra/updates/release/latest" class="bare">http://download.eclipse.org/viatra/updates/release/latest</a></code> ： <code><a href="http://download.eclipse.org/viatra/updates/release/latest" class="bare">http://download.eclipse.org/viatra/updates/release/latest</a></code></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/tools/vgql_install.png" alt="vgql安装" height="300"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_graphical_query_projects">图形查询项目</h2>
<div class="sectionbody">
<div class="paragraph">
<p>图形查询项目是专门的VIATRA查询项目，其中图形查询定义存储在一个源文件夹中，另一个源文件夹包含图形查询的文本等效项和生成的Java源代码，以将查询集成到现有应用程序中。</p>
</div>
<div class="paragraph">
<p>下图描述了默认的图形查询项目结构：源文件夹<code>src</code> （以红色显示）包含描述图形查询的<code>vgql</code>文件，在源文件夹中， <code>vgql-gen</code> （以蓝色显示）包含从图形查询定义生成的<code>vql</code>文件。每个生成的<code>vql</code>文件表示具有相同文件名的<code>vgql</code>文件，并且两者都存储在相应的Java包中。最后， <code>src-gen</code>文件夹（以绿色显示）用于存储vql文件中生成的Java代码。</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/tools/vgql_project.png" alt="vgql项目" height="300"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started_with_graphical_query_editing">图形查询编辑入门</h2>
<div class="sectionbody">
<div class="paragraph">
<p>可以使用适当的项目向导初始化图形查询项目。所有源文件夹和构建器都已正确设置，这意味着环境已准备好绘制图形模式，然后从中获取相应的生成代码。</p>
</div>
<div class="sect2">
<h3 id="_initializing_a_new_diagram">初始化新图表</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>创建图形查询项目<span class="image"><img src="images/tools/new_vgql_project.png" alt="新的vgql项目" height="300"></span></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>可以使用“ <code>Graphical Query Definition</code>向导创建图形查询模型，选择源文件夹（在图形查询项目中），包和文件名。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>创建图形查询定义<span class="image"><img src="images/tools/new_vgql_file.png" alt="新的vgql文件" height="300"></span></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>向导完成后，将为创建的文件打开一个新图表，其中可以使用常用工具编辑模式定义。</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_the_first_pattern">创建第一个模式</h3>
<div class="paragraph">
<p>在编辑之前，将在“属性”视图中将所需的ecore元模型添加到图中。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>添加一个Ecore Metamodel<span class="image"><img src="images/tools/vgql_add_metamodel.png" alt="vgql添加元模型" height="300"></span></p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">注意</div>
</td>
<td class="content">编辑器尝试自动将所需的插件依赖项添加到项目中。在极少数情况下，这可能会失败，导致生成的vql文件将是错误的。在这种情况下，生成的vql文件可以快速修复以将此依赖项添加到项目中。
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>元模型依赖<span class="image"><img src="images/tools/dependency_quick_fix.png" alt="依赖快速修复" height="300"></span></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>我们的第一个模式将用于枚举EClass <code>HostInstance</code>所有成员。为此，我们需要一个带有单个类型参数的模式。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>第一种模式<span class="image"><img src="images/tools/vgql_first_pattern.png" alt="vgql第一个模式" height="300"></span></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>为了确保创建的模式是格式良好的VIATRA查询，可以使用默认的基于Sirius的验证器验证查询：从<code>Validate Diagram</code>的弹出菜单中选择<code>Validate Diagram</code>图。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">注意</div>
</td>
<td class="content">如果规范中存在错误，生成的VQL文件将是错误的。在这种情况下，建议重新验证图表并查看提供的错误报告以解决问题。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_evaluating_query_results">评估查询结果</h3>
<div class="paragraph">
<p>当一切正常时，会自动从图形模式生成无错误的<code>vql</code>文件。此时，可以使用标准组件将模式加载到“ <code>Query Results</code>视图中。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>使用查询结果视图<span class="image"><img src="images/tools/vgql_query_results.png" alt="vgql查询结果" height="300"></span></p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">注意</div>
</td>
<td class="content">此集成假定生成了<code>vql</code>文件，因此需要保存查询定义，并且在保存视图以查看最新更改后可能需要短暂的延迟。如有疑问，请等待Eclipse构建作业完成。
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_missing_feature_and_known_issues">缺少功能和已知问题</h2>
<div class="sectionbody">
<div class="paragraph">
<p>VIATRA 2.1.0中的图形模式编辑器被认为是实验性的，并且计划在稍后的版本中解决一些已知问题。这些问题在<a href="https://bugs.eclipse.org/bugs/buglist.cgi?list_id=17930299&amp;product=Viatra&amp;query_format=advanced&amp;status_whiteboard=vgql-editor&amp;status_whiteboard_type=allwordssubstr">Bugzilla中</a>得到了保留。</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
</div>
</div>
</body>
</html>