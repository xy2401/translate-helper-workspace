<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>Graphical Query Editor</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
</head>
<body id="vgql-editor" class="article">
<div id="header">
<h1>Graphical Query Editor</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This section introduces the graphical query editor included in VIATRA 2.1 (released with Eclipse 2018-12). The goal of this editor is to support creating model queries in a graphical syntax, while maintaining compatibility with the existing infrastructure of VIATRA, including both the runtime and query development environment.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_requirements_and_installation">Requirements and Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The current version of the editor is based on Sirius 6.0 (and thus transitively requires Eclipse Oxygen as well). Furthermore, it requires a current version of VIATRA 2.1 IDE installed as well. To download that version, use the following p2 repository: <code><a href="http://download.eclipse.org/viatra/updates/release/latest" class="bare">http://download.eclipse.org/viatra/updates/release/latest</a></code></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/tools/vgql_install.png" alt="vgql install" height="300"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_graphical_query_projects">Graphical Query Projects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Graphical query projects are specialized VIATRA query projects where graphical query definitions are stored in one source folder, and another source folders contain the textual equivalents of the graphical queries and the generated Java source code to integrate the queries into existing applications.</p>
</div>
<div class="paragraph">
<p>The following figure describes the default graphical query project structure:  a source folder <code>src</code> (presented in red) contains <code>vgql</code> files describing graphical queries, and in a source folder <code>vgql-gen</code> (depicted in blue) contains <code>vql</code> files generated from the graphical query definitions. Each generated <code>vql</code> file represent a <code>vgql</code> file with the same filename, and both are stored in corresponding Java packages. Finally, a <code>src-gen</code> folder (depicted in green) is used to store the generated Java code from the vql files.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/tools/vgql_project.png" alt="vgql project" height="300"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started_with_graphical_query_editing">Getting Started with Graphical Query Editing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A Graphical Query Project can be initialized with an appropriate project wizard. All source folders and builders are correctly set up, meaning the environment is ready to draw graph patterns and then get the appropriate generated code from it.</p>
</div>
<div class="sect2">
<h3 id="_initializing_a_new_diagram">Initializing a New Diagram</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create Graphical Query Project
<span class="image"><img src="images/tools/new_vgql_project.png" alt="new vgql project" height="300"></span></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Graphical query models can be created with the <code>Graphical Query Definition</code> wizard, selecting a source folder (within a Graphical Query Project), a package and a file name.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create Graphical Query Definition
<span class="image"><img src="images/tools/new_vgql_file.png" alt="new vgql file" height="300"></span></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After the wizard finishes, a new diagram is opened for the created file, where the pattern definitions can be edited using the usual tools.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_the_first_pattern">Creating the First Pattern</h3>
<div class="paragraph">
<p>Before editing, the required ecore metamodels are to be added to the diagram in the Properties view.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add an Ecore Metamodel
<span class="image"><img src="images/tools/vgql_add_metamodel.png" alt="vgql add metamodel" height="300"></span></p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The editor tries to add the required plug-in dependencies automatically to the project. In rare case this may fail, causing the generated vql files will be erroneous. In such cases the generated vql files have a quick fix to add this dependency to the project.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Metamodel dependency
<span class="image"><img src="images/tools/dependency_quick_fix.png" alt="dependency quick fix" height="300"></span></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Our first pattern will be used to enumerate all members of the EClass <code>HostInstance</code>. For this, we need a pattern with a single, typed parameter.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>First pattern
<span class="image"><img src="images/tools/vgql_first_pattern.png" alt="vgql first pattern" height="300"></span></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In order to ensure the created patterns are well-formed VIATRA queries, the queries can be validated using the default Sirius-based validators: select <code>Validate Diagram</code> from the pop-up menu of the diagram.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In case of errors in the specification, the generated VQL files will be erroneous. In such cases it is recommended to re-validate the diagram and look at the provided error reports to fix the issues.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_evaluating_query_results">Evaluating Query Results</h3>
<div class="paragraph">
<p>When everything works, an error-free <code>vql</code> file is generated from the graphical patterns automatically. At this point, the patterns can be loaded to the <code>Query Results</code> view using the standard components.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Using the Query Results View
<span class="image"><img src="images/tools/vgql_query_results.png" alt="vgql query results" height="300"></span></p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This integration assumes that the <code>vql</code> file is generated, so it requires the query definitions to be saved, and a short delay may be necessary after save for the view to see the latest changes. When in doubt, wait until the Eclipse build job has finished.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_missing_feature_and_known_issues">Missing Feature and Known Issues</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The graphical pattern editor in VIATRA 2.1.0 is considered experimental, and there are a few known issues that are planned to be addressed in a later release. These issues are maintained in <a href="https://bugs.eclipse.org/bugs/buglist.cgi?list_id=17930299&amp;product=Viatra&amp;query_format=advanced&amp;status_whiteboard=vgql-editor&amp;status_whiteboard_type=allwordssubstr">Bugzilla</a>.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
</div>
</div>
</body>
</html>