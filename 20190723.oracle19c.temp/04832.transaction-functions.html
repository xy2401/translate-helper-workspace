<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="Lists and describes the transaction functions.">
      <meta name="description" content="Lists and describes the transaction functions.">
      <title>Transaction Functions</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Programmer's Guide">
      <meta property="og:description" content="Lists and describes the transaction functions.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Programmer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="oracle-call-interface-programmers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-14T08:46:00-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96204-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="thread-management-functions.html" title="Previous" type="text/html">
      <link rel="next" href="shard-functions.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Oracle Call Interface Programmer's Guide">
    <meta name="dcterms.isVersionOf" content="LNOCI">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="thread-management-functions.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="shard-functions.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Programmer's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="more-database-access-c-api.html" property="item" typeof="WebPage"><span property="name"> More Oracle Database Access C API</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Transaction Functions</li>
            </ol>
            <a id="GUID-69F748A0-89C2-431C-A126-1C0DF0552084" name="GUID-69F748A0-89C2-431C-A126-1C0DF0552084"></a><a id="LNOCI17276"></a><a id="LNOCI166"></a>
            
            <h2 id="LNOCI-GUID-69F748A0-89C2-431C-A126-1C0DF0552084" class="sect2"><span class="enumeration_section">26.7 </span>Transaction Functions
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>Lists and describes the transaction functions.</p>
               <div class="section">
                  <p><a href="transaction-functions.html#GUID-69F748A0-89C2-431C-A126-1C0DF0552084__CIHFIBHC" title="This table has 2 columns. Column 1 is the OCI function name and column 2 describes its purpose.">Table 26-6</a> lists the transaction functions that are described in this section.
                  </p>
               </div>
               <!-- class="section" -->
               <div class="tblformalwide" id="GUID-69F748A0-89C2-431C-A126-1C0DF0552084__CIHFIBHC">
                  <p class="titleintable">Table 26-6 Transaction Functions</p>
                  <table cellpadding="4" cellspacing="0" class="FormalWide" title="Transaction Functions" summary="This table has 2 columns. Column 1 is the OCI function name and column 2 describes its purpose. " width="100%" frame="hsides" border="1" rules="rows">
                     <thead>
                        <tr align="left" valign="top">
                           <th align="left" valign="bottom" width="61%" id="d223602e207">Function</th>
                           <th align="left" valign="bottom" width="39%" id="d223602e210">Purpose</th>
                        </tr>
                     </thead>
                     <tbody>
                        <tr align="left" valign="top">
                           <td align="left" valign="top" width="61%" id="d223602e215" headers="d223602e207 ">
                              <p><a href="transaction-functions.html#GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" title="Commits the transaction associated with a specified service context.">OCITransCommit()</a></p>
                           </td>
                           <td align="left" valign="top" width="39%" headers="d223602e215 d223602e210 ">
                              <p>Commit a transaction on a service context</p>
                           </td>
                        </tr>
                        <tr align="left" valign="top">
                           <td align="left" valign="top" width="61%" id="d223602e227" headers="d223602e207 ">
                              <p><a href="transaction-functions.html#GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09" title="Detaches a global transaction.">OCITransDetach()</a></p>
                           </td>
                           <td align="left" valign="top" width="39%" headers="d223602e227 d223602e210 ">
                              <p>Detach a transaction from a service context</p>
                           </td>
                        </tr>
                        <tr align="left" valign="top">
                           <td align="left" valign="top" width="61%" id="d223602e239" headers="d223602e207 ">
                              <p><a href="transaction-functions.html#GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00" title="Causes the server to forget a heuristically completed global transaction.">OCITransForget()</a></p>
                           </td>
                           <td align="left" valign="top" width="39%" headers="d223602e239 d223602e210 ">
                              <p>Forget a prepared global transaction</p>
                           </td>
                        </tr>
                        <tr align="left" valign="top">
                           <td align="left" valign="top" width="61%" id="d223602e251" headers="d223602e207 ">
                              <p><a href="transaction-functions.html#GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7" title="Prepares a transaction with multiple branches in a single call.">OCITransMultiPrepare() </a></p>
                           </td>
                           <td align="left" valign="top" width="39%" headers="d223602e251 d223602e210 ">
                              <p>Prepare a transaction with multiple branches in a single cell</p>
                           </td>
                        </tr>
                        <tr align="left" valign="top">
                           <td align="left" valign="top" width="61%" id="d223602e263" headers="d223602e207 ">
                              <p><a href="transaction-functions.html#GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3" title="Prepares a global transaction for commit.">OCITransPrepare()</a></p>
                           </td>
                           <td align="left" valign="top" width="39%" headers="d223602e263 d223602e210 ">
                              <p>Prepare a global transaction for commit</p>
                           </td>
                        </tr>
                        <tr align="left" valign="top">
                           <td align="left" valign="top" width="61%" id="d223602e275" headers="d223602e207 ">
                              <p><a href="transaction-functions.html#GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366" title="Rolls back the current transaction.">OCITransRollback()</a></p>
                           </td>
                           <td align="left" valign="top" width="39%" headers="d223602e275 d223602e210 ">
                              <p>Roll back a transaction</p>
                           </td>
                        </tr>
                        <tr align="left" valign="top">
                           <td align="left" valign="top" width="61%" id="d223602e287" headers="d223602e207 ">
                              <p><a href="transaction-functions.html#GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8" title="Sets the beginning of a transaction.">OCITransStart()</a></p>
                           </td>
                           <td align="left" valign="top" width="39%" headers="d223602e287 d223602e210 ">
                              <p>Start a transaction on a service context</p>
                           </td>
                        </tr>
                     </tbody>
                  </table>
               </div>
               <!-- class="inftblhruleinformal" -->
            </div><a id="LNOCI13112"></a><div class="props_rev_3"><a id="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" name="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4"></a><h3 id="LNOCI-GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" class="sect3"><span class="enumeration_section">26.7.1 </span>OCITransCommit()
               </h3>
               <div>
                  <p>Commits the transaction associated with a specified service context.</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4__GUID-EEC30B29-0E58-40F6-8C0E-A8DF541065C0">Purpose</p>
                     <p>Commits the transaction associated with a specified service context.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4__GUID-08C1266D-FCEF-45CE-9A65-9ED4F5067F3B">Syntax</p><pre class="oac_no_warn" dir="ltr">sword OCITransCommit ( OCISvcCtx    *svchp,
                       OCIError     *errhp,
                       ub4           flags );</pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4__GUID-0E9162B4-8DB6-41DA-A21F-B75F0D062919">Parameters</p>
                     <dl>
                        <dt class="dlterm"><a name="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4__GUID-F2FFDCD2-C177-4BE8-9989-98BCFF07B452">
                              <!-- --></a><span class="bold">svchp</span> (IN)
                        </dt>
                        <dd>
                           <p>The service context handle.</p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4__GUID-176CA3A7-9C2E-4886-B7B0-F90E94DD427C">
                              <!-- --></a><span class="bold">errhp</span> (IN)
                        </dt>
                        <dd>
                           <p>An error handle that you can pass to <code class="codeph">OCIErrorGet()</code> for diagnostic information when there is an error.
                           </p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4__GUID-45DB65B3-D111-49F2-8340-80B03783E248">
                              <!-- --></a><span class="bold">flags (IN)</span></dt>
                        <dd>
                           <p>A flag used for one-phase commit optimization in global transactions. </p>
                           <p><code class="codeph">OCI_DEFAULT</code> - If the transaction is nondistributed, the flags parameter is ignored, and <code class="codeph">OCI_DEFAULT</code> can be passed as its value. 
                           </p>
                           <p><code class="codeph">OCI_TRANS_TWOPHASE</code> - OCI applications managing global transactions should pass this value to the flags parameter for a two-phase commit. The default is one-phase commit.
                           </p>
                           <p><code class="codeph">OCI_TRANS_WRITEIMMED</code> - I/O is initiated by LGWR (Log Writer Process in the background) to write the (in-memory) redo buffers to the online redo logs. <code class="codeph">IMMEDIATE</code> means that the redo buffers of the transaction are written out immediately by sending a message to LGWR, which processes the message immediately.
                           </p>
                           <p><code class="codeph">OCI_TRANS_WRITEBATCH</code> - No I/O is issued by LGWR to write the in-memory redo buffers of the transaction to the online redo logs. <code class="codeph">BATCH</code> means that the LGWR batches the redo buffers before initiating I/O for the entire batch. An error occurs when you specify both <code class="codeph">BATCH</code> and <code class="codeph">IMMEDIATE</code>. <code class="codeph">IMMEDIATE</code> is the default.
                           </p>
                           <p><code class="codeph">OCI_TRANS_WRITEWAIT</code> - LGWR is requested to write the redo for the commit to the online redo logs, and the commit waits for the redo buffers to be written to the online redo logs. <code class="codeph">WAIT</code> means that the commit does not return until the in-memory redo buffers corresponding to the transaction are written in the (persistent) online redo logs. 
                           </p>
                           <p><code class="codeph">OCI_TRANS_WRITENOWAIT</code> - LGWR is requested to write the redo for the commit to the online redo logs, but the commit returns without waiting for the buffers to be written to the online redo logs. <code class="codeph">NOWAIT</code> means that the commit returns to the user before the in-memory redo buffers are flushed to the online redo logs. An error occurs when you specify both <code class="codeph">WAIT</code> and <code class="codeph">NOWAIT</code>. <code class="codeph">WAIT</code> is the default.
                           </p>
                           <div class="infoboxnote" id="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4__GUID-A46BB779-9928-4668-9C5A-49164B5A3A6B">
                              <p class="notep1">Note:</p>
                              <p>There is a potential for silent transaction loss when you use <code class="codeph">OCI_TRANS_WRITENOWAIT</code>. Transaction loss occurs silently with shutdown abort, startup force, and any instance or node failure. On an Oracle RAC system, asynchronously committed changes may not be immediately available to read on other instances.
                              </p>
                           </div>
                           <p>These last four options only affect the commit of top-level nondistributed transactions and are ignored for externally coordinated distributed transactions. They can be combined using the <code class="codeph">OR</code> operator, subject to the stated restrictions.
                           </p>
                        </dd>
                     </dl>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4__GUID-8C301DFF-2B62-4DAA-9F7D-47007103FAD3">Comments</p>
                     <p>The transaction currently associated with the service context is committed. If it is a global transaction that the server cannot commit, this call additionally retrieves the state of the transaction from the database to be returned to the user in the error handle.</p>
                     <p>If the application has defined multiple transactions, this function operates on the transaction currently associated with the service context. If the application is working with only the implicit local transaction created when database changes are made, that implicit transaction is committed.</p>
                     <p>If the application is running in the object mode, then the modified or updated objects in the object cache for this transaction are also flushed and committed.</p>
                     <p>Under normal circumstances, <code class="codeph">OCITransCommit()</code> returns with a status indicating that the transaction has either been committed or rolled back. With global transactions, it is possible that the transaction is now in doubt, meaning that it is neither committed nor terminated. In this case, <code class="codeph">OCITransCommit()</code> attempts to retrieve the status of the transaction from the server. The status is returned.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4__GUID-32C4D474-9872-40C7-A73D-E509D4D6CC76">Example</p>
                     <p>The following code example demonstrates the use of a simple local transaction, as described in <span class="q">"<a href="managing-scalable-platforms.html#GUID-7190D8FF-EA02-4D7B-9967-62A3FC458605" title="Many applications work with only simple local transactions.">Simple Local Transactions</a>"</span>.
                     </p>
                     <p>Using OCITransCommit() in a Simple Local Transaction</p><pre class="oac_no_warn" dir="ltr">
int main()
{
  OCIEnv *envhp;
  OCIServer *srvhp;
  OCIError *errhp;
  OCISvcCtx *svchp;
  OCIStmt *stmthp;
  void      *tmp;
  text sqlstmt[128];

  OCIEnvCreate(&amp;envhp, OCI_DEFAULT, (void  *)0, 0, 0, 0,
        (size_t)0, (void  *)0);

  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;errhp, (ub4) OCI_HTYPE_ERROR,
                (size_t)0, (void  **) 0);
  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;srvhp, (ub4) OCI_HTYPE_SERVER,
                (size_t)0, (void  **) 0);

  OCIServerAttach( srvhp, errhp, (text *) 0, (sb4) 0, (ub4) OCI_DEFAULT);

  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;svchp, (ub4) OCI_HTYPE_SVCCTX,
                (size_t)0, (void  **) 0);

  OCIHandleAlloc((void  *)envhp, (void  **)&amp;stmthp, OCI_HTYPE_STMT, 0, 0);

  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)srvhp, 0,
                  OCI_ATTR_SERVER, errhp);

  OCILogon(envhp, errhp, &amp;svchp, (text *)"HR", strlen("HR"),
                 (text *)"HR", strlen("HR"), 0, 0);

  /* update hr.employees employee_id=7902, increment salary */
  sprintf((char *)sqlstmt, "UPDATE EMPLOYEES SET SALARY = SALARY + 1 \
                                            WHERE  EMPLOYEE_ID = 7902");

  OCIStmtPrepare(stmthp, errhp, sqlstmt, strlen((char *)sqlstmt),
                 OCI_NTV_SYNTAX, 0);
  OCIStmtExecute(svchp, stmthp, errhp, 1, 0, 0, 0, 0);
  OCITransCommit(svchp, errhp, (ub4) 0);

  /* update hr.employees employee_id=7902, increment salary again, but rollback */
  OCIStmtExecute(svchp, stmthp, errhp, 1, 0, 0, 0, 0);
  OCITransRollback(svchp, errhp, (ub4) 0);
}
</pre></div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="transaction-functions.html#GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366" title="Rolls back the current transaction.">OCITransRollback()</a></li>
                        <li><a href="miscellaneous-functions.html#GUID-4B99087C-74F6-498A-8310-D6645172390A" title="Returns an error message and an Oracle Database error code.">OCIErrorGet()</a></li>
                     </ul>
                  </div>
               </div>
               
            </div><a id="LNOCI17277"></a><div class="props_rev_3"><a id="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09" name="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09"></a><h3 id="LNOCI-GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09" class="sect3"><span class="enumeration_section">26.7.2 </span>OCITransDetach()
               </h3>
               <div>
                  <p>Detaches a global transaction.</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09__GUID-C9C5AF56-03E9-48DC-A81D-2AC65BD899D8">Purpose</p>
                     <p>Detaches a global transaction.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09__GUID-AABF22E7-1CDB-43BB-BEC1-F2E1FFC92E8D">Syntax</p><pre class="oac_no_warn" dir="ltr">sword OCITransDetach ( OCISvcCtx    *svchp,
                       OCIError     *errhp,
                       ub4           flags );</pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09__GUID-B211FFD9-1A66-4D89-BFE5-8C37CB7A82A0">Parameters</p>
                     <dl>
                        <dt class="dlterm"><a name="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09__GUID-5379F0BF-8DF7-42D6-B8FA-2744C8215BC0">
                              <!-- --></a><span class="bold">svchp</span> (IN)
                        </dt>
                        <dd>
                           <p>The service context handle. </p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09__GUID-8DA3D419-4C2A-4641-9367-3097C3C57FF1">
                              <!-- --></a><span class="bold">errhp</span> (IN)
                        </dt>
                        <dd>
                           <p>An error handle that you can pass to <code class="codeph">OCIErrorGet()</code> for diagnostic information when there is an error.
                           </p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09__GUID-C1F25EAD-6D17-4D95-9A91-912900F4F8C7">
                              <!-- --></a><span class="bold">flags</span> (IN)
                        </dt>
                        <dd>
                           <p>You must pass a value of <code class="codeph">OCI_DEFAULT</code> for this parameter.
                           </p>
                        </dd>
                     </dl>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09__GUID-8A268D13-EC7C-4F99-B000-B4DEEEEA95CD">Comments</p>
                     <p>Detaches a global transaction from the service context handle. The transaction currently attached to the service context handle becomes inactive at the end of this call. The transaction may be resumed later by calling <code class="codeph">OCITransStart()</code>, specifying a flags value of <code class="codeph">OCI_TRANS_RESUME</code>.
                     </p>
                     <p>When a transaction is detached, the value that was specified in the <code class="codeph">timeout</code> parameter of <code class="codeph">OCITransStart()</code> when the transaction was started is used to determine the amount of time the branch can remain inactive before being deleted by the server's <code class="codeph">PMON</code> process.
                     </p>
                     <div class="infoboxnote" id="GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09__GUID-2B3BD6E7-81B9-47C4-B59B-3DE789B39609">
                        <p class="notep1">Note:</p>
                        <p>The transaction can be resumed by a different process than the one that detached it, if the transaction has the same authorization. If this function is called before a transaction is actually started, this function has no effect.</p>
                     </div>
                     <p>For example code demonstrating the use of <code class="codeph">OCITransDetach()</code>, see the Examples section of <code class="codeph">OCITransStart()</code>.
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="transaction-functions.html#GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8" title="Sets the beginning of a transaction.">OCITransStart()</a></li>
                        <li><a href="miscellaneous-functions.html#GUID-4B99087C-74F6-498A-8310-D6645172390A" title="Returns an error message and an Oracle Database error code.">OCIErrorGet()</a></li>
                     </ul>
                  </div>
               </div>
               
            </div><a id="LNOCI17278"></a><div class="props_rev_3"><a id="GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00" name="GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00"></a><h3 id="LNOCI-GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00" class="sect3"><span class="enumeration_section">26.7.3 </span>OCITransForget()
               </h3>
               <div>
                  <p>Causes the server to forget a heuristically completed global transaction.</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00__GUID-86C34B86-B4E2-419A-92D9-11435E9E9998">Purpose</p>
                     <p>Causes the server to forget a heuristically completed global transaction.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00__GUID-A928B2E0-CAA9-4EC9-85D9-2DCE11266E2D">Syntax</p><pre class="oac_no_warn" dir="ltr">sword OCITransForget ( OCISvcCtx     *svchp, 
                       OCIError      *errhp,
                       ub4            flags );</pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00__GUID-C8B38AC7-A6CA-4B26-BBC0-4ABABD235926"><span class="bold">Parameters</span></p>
                     <dl>
                        <dt class="dlterm"><a name="GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00__GUID-9E30D41E-0CC7-4349-A6B8-DB61CAA0EF3E">
                              <!-- --></a><span class="bold">svchp</span> (IN)
                        </dt>
                        <dd>
                           <p>The service context handle in which the transaction resides.</p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00__GUID-D268B6A8-DC7E-43D7-A799-5A4C01BC7E18">
                              <!-- --></a><span class="bold">errhp</span> (IN)
                        </dt>
                        <dd>
                           <p>An error handle that you can pass to <code class="codeph">OCIErrorGet()</code> for diagnostic information when there is an error.
                           </p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00__GUID-3FB91A76-F11C-4E94-AC37-A427116D1864">
                              <!-- --></a>flags (IN)
                        </dt>
                        <dd>
                           <p>You must pass <code class="codeph">OCI_DEFAULT</code> for this parameter.
                           </p>
                        </dd>
                     </dl>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00__GUID-64795878-86AD-462E-BDA4-405A2097DA55">Comments</p>
                     <p>Forgets a heuristically completed global transaction. The server deletes the status of the transaction from the system's pending transaction table.</p>
                     <p>You set the XID of the transaction to be forgotten as an attribute of the transaction handle (<code class="codeph">OCI_ATTR_XID</code>).
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="transaction-functions.html#GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" title="Commits the transaction associated with a specified service context.">OCITransCommit()</a></li>
                        <li><a href="transaction-functions.html#GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366" title="Rolls back the current transaction.">OCITransRollback()</a></li>
                        <li><a href="miscellaneous-functions.html#GUID-4B99087C-74F6-498A-8310-D6645172390A" title="Returns an error message and an Oracle Database error code.">OCIErrorGet()</a></li>
                     </ul>
                  </div>
               </div>
               
            </div><a id="LNOCI17279"></a><div class="props_rev_3"><a id="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7" name="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7"></a><h3 id="LNOCI-GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7" class="sect3"><span class="enumeration_section">26.7.4 </span>OCITransMultiPrepare() 
               </h3>
               <div>
                  <p>Prepares a transaction with multiple branches in a single call.</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7__GUID-329956AC-2CD5-48A0-BE00-20C0FFDD710C">Purpose</p>
                     <p>Prepares a transaction with multiple branches in a single call.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7__GUID-8F0D93C6-B342-4162-8628-14D1A5688742">Syntax</p><pre class="oac_no_warn" dir="ltr">sword OCITransMultiPrepare ( OCISvcCtx    *svchp, 
                             ub4           numBranches, 
                             OCITrans    **txns, 
                             OCIError    **errhp);</pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7__GUID-E8BFF08D-85F0-420F-8E7D-3F56AA47EE83"><span class="bold">Parameters</span></p>
                     <dl>
                        <dt class="dlterm"><a name="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7__GUID-70A94F00-E8BD-459C-AE69-EC25E072F567">
                              <!-- --></a>srvchp (IN) 
                        </dt>
                        <dd>
                           <p>The service context handle. </p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7__GUID-DB67F55E-54F6-4268-876B-F0D293E55BD5">
                              <!-- --></a>numBranches (IN)
                        </dt>
                        <dd>
                           <p>The number of branches expected. It is also the array size for the next two parameters.</p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7__GUID-32F5BC4B-2123-4E2D-AD15-2B0B75A7452D">
                              <!-- --></a>txns (IN)
                        </dt>
                        <dd>
                           <p>The array of transaction handles for the branches to prepare. They should all have the <code class="codeph">OCI_ATTR_XID</code> set. The global transaction ID should be the same.
                           </p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7__GUID-A4F40037-4E87-4A13-BA0D-6211F218076B">
                              <!-- --></a>errhp (IN)
                        </dt>
                        <dd>
                           <p>The array of error handles. If <code class="codeph">OCI_SUCCESS</code> is not returned, then these indicate which branches received which errors.
                           </p>
                        </dd>
                     </dl>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-8278951C-98FA-4C08-A48B-5F24EADA6BD7__GUID-7C2079DB-FC91-49ED-B523-E60398107F3D">Comments</p>
                     <p>Prepares the specified global transaction for commit. This call is valid only for distributed transactions. This call is an advanced performance feature intended for use only in situations where the caller is responsible for preparing all the branches in a transaction.</p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="transaction-functions.html#GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3" title="Prepares a global transaction for commit.">OCITransPrepare()</a></li>
                     </ul>
                  </div>
               </div>
               
            </div><a id="LNOCI17280"></a><div class="props_rev_3"><a id="GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3" name="GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3"></a><h3 id="LNOCI-GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3" class="sect3"><span class="enumeration_section">26.7.5 </span>OCITransPrepare()
               </h3>
               <div>
                  <p>Prepares a global transaction for commit.</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3__GUID-201EC530-CFC2-4C64-BCA9-E1637EAFB35F">Purpose</p>
                     <p>Prepares a global transaction for commit.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3__GUID-3B503B20-48F9-4AF3-8D57-8D91F3661DAB">Syntax</p><pre class="oac_no_warn" dir="ltr">sword OCITransPrepare ( OCISvcCtx    *svchp, 
                        OCIError     *errhp,
                        ub4           flags );</pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3__GUID-D323588C-124A-4663-9095-EBFE675BB81D"><span class="bold">Parameters</span></p>
                     <dl>
                        <dt class="dlterm"><a name="GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3__GUID-BAE1828C-ED34-4CAA-BAB3-D97473F3FC8C">
                              <!-- --></a><span class="bold">svchp</span> (IN)
                        </dt>
                        <dd>
                           <p>The service context handle. </p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3__GUID-25447DA7-DB1B-4ABC-9799-0598248D40E6">
                              <!-- --></a><span class="bold">errhp</span> (IN)
                        </dt>
                        <dd>
                           <p>An error handle that you can pass to <code class="codeph">OCIErrorGet()</code> for diagnostic information when there is an error.
                           </p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3__GUID-900E10FB-C0CA-4C81-A595-50903A9EB92B">
                              <!-- --></a>flags (IN)
                        </dt>
                        <dd>
                           <p>You must pass <code class="codeph">OCI_DEFAULT</code> for this parameter.
                           </p>
                        </dd>
                     </dl>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-B8ADEE8D-9A5F-48C6-A862-4FFE280BA0D3__GUID-667EAAAE-CB3D-4084-BBC3-D115E4EC706D">Comments</p>
                     <p>Prepares the specified global transaction for commit.</p>
                     <p>This call is valid only for global transactions.</p>
                     <p>The call returns <code class="codeph">OCI_SUCCESS_WITH_INFO</code> if the transaction has not made any changes. The error handle indicates that the transaction is read-only. The <code class="codeph">flags</code> parameter is not currently used. 
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="transaction-functions.html#GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" title="Commits the transaction associated with a specified service context.">OCITransCommit()</a></li>
                        <li><a href="transaction-functions.html#GUID-1BBB1A11-66F5-424D-B0CA-8034085C7E00" title="Causes the server to forget a heuristically completed global transaction.">OCITransForget()</a></li>
                        <li><a href="miscellaneous-functions.html#GUID-4B99087C-74F6-498A-8310-D6645172390A" title="Returns an error message and an Oracle Database error code.">OCIErrorGet()</a></li>
                     </ul>
                  </div>
               </div>
               
            </div><a id="LNOCI17281"></a><div class="props_rev_3"><a id="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366" name="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366"></a><h3 id="LNOCI-GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366" class="sect3"><span class="enumeration_section">26.7.6 </span>OCITransRollback()
               </h3>
               <div>
                  <p>Rolls back the current transaction.</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366__GUID-F3002757-A55A-4965-A9B0-1BA9F307DA42">Purpose</p>
                     <p>Rolls back the current transaction.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366__GUID-0F07F1F4-788A-4F77-9595-F4451DADB7BE">Syntax</p><pre class="oac_no_warn" dir="ltr">sword OCITransRollback ( void         *svchp, 
                         OCIError     *errhp,
                         ub4           flags );</pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366__GUID-C9BECF36-DB41-46B3-9A08-35416D459F94">Parameters</p>
                     <dl>
                        <dt class="dlterm"><a name="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366__GUID-AE70ED24-0E28-4901-BD15-C73716DE1703">
                              <!-- --></a><span class="bold">svchp </span>(IN)
                        </dt>
                        <dd>
                           <p>A service context handle. The transaction currently set in the service context handle is rolled back.</p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366__GUID-E73915F8-9EC3-4E9B-8002-F7B8453D1FF6">
                              <!-- --></a><span class="bold">errhp</span> (IN)
                        </dt>
                        <dd>
                           <p>An error handle that you can pass to <code class="codeph">OCIErrorGet()</code> for diagnostic information when there is an error.
                           </p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366__GUID-86DAAED8-945D-4FED-BFEF-47DDECC421CA">
                              <!-- --></a><span class="bold">flags</span> (IN)
                        </dt>
                        <dd>
                           <p>You must pass a value of <code class="codeph">OCI_DEFAULT</code> for this parameter.
                           </p>
                        </dd>
                     </dl>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366__GUID-D2637ACF-3825-4DC4-9EED-5D0DAB3CE212">Comments</p>
                     <p>The current transaction— defined as the set of statements executed since the last <code class="codeph">OCITransCommit()</code> or since <code class="codeph">OCISessionBegin()</code> —is rolled back.
                     </p>
                     <p>If the application is running under object mode, then the modified or updated objects in the object cache for this transaction are also rolled back.</p>
                     <p>Attempting to roll back a global transaction that is not currently active causes an error.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366__GUID-9122FF44-CCB6-462C-B80C-B704522A77C3">Examples</p>
                     <p>For example code demonstrating the use of <code class="codeph">OCITransRollback()</code> see the Examples section of <a href="transaction-functions.html#GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" title="Commits the transaction associated with a specified service context.">OCITransCommit()</a>.
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="transaction-functions.html#GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" title="Commits the transaction associated with a specified service context.">OCITransCommit()</a></li>
                        <li><a href="connect-authorize-and-initialize-functions.html#GUID-31B1FDB3-056E-4AF9-9B89-8DA6AA156947" title="Creates a user session and begins a user session for a given server.">OCISessionBegin()</a></li>
                        <li><a href="miscellaneous-functions.html#GUID-4B99087C-74F6-498A-8310-D6645172390A" title="Returns an error message and an Oracle Database error code.">OCIErrorGet()</a></li>
                     </ul>
                  </div>
               </div>
               
            </div><a id="LNOCI17282"></a><div class="props_rev_3"><a id="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8" name="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8"></a><h3 id="LNOCI-GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8" class="sect3"><span class="enumeration_section">26.7.7 </span>OCITransStart()
               </h3>
               <div>
                  <p>Sets the beginning of a transaction.</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8__GUID-FBC9198D-B206-4E74-8387-9EDB52244D42">Purpose</p>
                     <p>Sets the beginning of a transaction.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8__GUID-ACDB61EF-7119-4FF6-9B64-3A3234DB9BF9">Syntax</p><pre class="oac_no_warn" dir="ltr">sword OCITransStart ( OCISvcCtx    *svchp, 
                      OCIError     *errhp, 
                      uword         timeout,
                      ub4           flags );</pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8__GUID-38CF5412-0439-465B-AD25-41518926FF7B">Parameters</p>
                     <dl>
                        <dt class="dlterm"><a name="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8__GUID-8BF25001-5A67-4497-83BD-5698FC9240E7">
                              <!-- --></a><span class="bold">svchp</span> (IN/OUT)
                        </dt>
                        <dd>
                           <p>The service context handle. The transaction context in the service context handle is initialized at the end of the call if the flag specified a new transaction to be started.</p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8__GUID-B73FF5FF-B936-4376-919F-0D2B651DCED1">
                              <!-- --></a>errhp (IN/OUT)
                        </dt>
                        <dd>
                           <p>The OCI error handle. If there is an error, it is recorded in <code class="codeph">err</code> and this function returns <code class="codeph">OCI_ERROR</code>. Diagnostic information can be obtained by calling <code class="codeph">OCIErrorGet()</code>.
                           </p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8__GUID-75388E09-1371-4AF8-99FA-3A53B5FE6A9D">
                              <!-- --></a>timeout (IN)
                        </dt>
                        <dd>
                           <p>The time, in seconds, to wait for a transaction to become available for resumption when <code class="codeph">OCI_TRANS_RESUME</code> is specified. When <code class="codeph">OCI_TRANS_NEW</code> is specified, the timeout parameter indicates the number of seconds the transaction can be inactive before it is automatically terminated by the system. A transaction is inactive between the time it is detached (with <code class="codeph">OCITransDetach()</code>) and the time it is resumed with <code class="codeph">OCITransStart()</code>.
                           </p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8__GUID-22062DD4-2877-4E4F-9F18-37CB68F33402">
                              <!-- --></a>flags (IN)
                        </dt>
                        <dd>
                           <p>Specifies whether a new transaction is being started or an existing transaction is being resumed. Also specifies serializability or read-only status. More than a single value can be specified. By default, a read/write transaction is started. The flag values are:</p>
                        </dd>
                     </dl>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><code class="codeph">OCI_TRANS_NEW</code> - Starts a new transaction branch. By default starts a tightly coupled and migratable branch.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">OCI_TRANS_TIGHT</code> - Explicitly specifies a tightly coupled branch.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">OCI_TRANS_LOOSE</code> - Specifies a loosely coupled branch.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">OCI_TRANS_RESUME</code> - Resumes an existing transaction branch. 
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">OCI_TRANS_READONLY</code> - Starts a read-only transaction.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">OCI_TRANS_SERIALIZABLE</code> - Starts a serializable transaction.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">OCI_TRANS_SEPARABLE</code> - Separates the transaction after each call.
                           </p>
                           <p>This flag results in a warning that the transaction was started using <span class="italic">regular</span> transactions. Separated transactions are not supported through release 9.0.1 of the server.
                           </p>
                        </li>
                     </ul>
                     <p>An error message results if there is an error in your code or the transaction service. The error indicates that you attempted an action on a transaction that has already been prepared.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8__GUID-74DFE040-FF6C-439D-8B4B-CA35BE84811D">Comments</p>
                     <p>This function sets the beginning of a global or serializable transaction. The transaction context currently associated with the service context handle is initialized at the end of the call if the <code class="codeph">flags</code> parameter specifies that a new transaction should be started.
                     </p>
                     <p>The XID of the transaction is set as an attribute of the transaction handle (<code class="codeph">OCI_ATTR_XID</code>)
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-81E5963B-4DE7-47E1-ABB0-C1490AF3BAA8__GUID-2CD8B3E5-8089-4B2B-BEB7-B1D730CF9037">Examples</p>
                     <p>The following code example and the one following that one demonstrate the use of OCI transactional calls for manipulating global transactions. The concept for a single session operating on different branches, as shown in the following code example, is illustrated by <a href="managing-scalable-platforms.html#GUID-9C16201F-7975-4E14-8162-62695B1C9AE4__I433197">Figure 10-2</a>. 
                     </p>
                     <p>Using OCITransStart() in a Single Session Operating on Different Branches</p><pre class="oac_no_warn" dir="ltr">
int main()
{
  OCIEnv *envhp;
  OCIServer *srvhp;
  OCIError *errhp;
  OCISvcCtx *svchp;
  OCISession *usrhp;
  OCIStmt *stmthp1, *stmthp2;
  OCITrans *txnhp1, *txnhp2;
  void      *tmp;
  XID gxid;
  text sqlstmt[128];

  OCIEnvCreate(&amp;envhp, OCI_DEFAULT, (void  *)0, 0, 0, 0,
        (size_t)0, (void  *)0);

  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;errhp, (ub4)
                OCI_HTYPE_ERROR, 52, (void  **) &amp;tmp);
  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;srvhp, (ub4)
               OCI_HTYPE_SERVER, 52, (void  **) &amp;tmp);

  OCIServerAttach( srvhp, errhp, (text *) 0, (sb4) 0, (ub4) OCI_DEFAULT);

  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;svchp, (ub4) OCI_HTYPE_SVCCTX,
                52, (void  **) &amp;tmp);

  OCIHandleAlloc((void  *)envhp, (void  **)&amp;stmthp1, OCI_HTYPE_STMT, 0, 0);
  OCIHandleAlloc((void  *)envhp, (void  **)&amp;stmthp2, OCI_HTYPE_STMT, 0, 0);

  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)srvhp, 0,
                  OCI_ATTR_SERVER, errhp);

  /* set the external name and internal name in server handle */
  OCIAttrSet((void  *)srvhp, OCI_HTYPE_SERVER, (void  *) "demo", 0,
                  OCI_ATTR_EXTERNAL_NAME, errhp);
  OCIAttrSet((void  *)srvhp, OCI_HTYPE_SERVER, (void  *) "txn demo", 0,
                          OCI_ATTR_INTERNAL_NAME, errhp);

  /* allocate a user context handle */
  OCIHandleAlloc((void  *)envhp, (void  **)&amp;usrhp, (ub4) OCI_HTYPE_SESSION,
                (size_t) 0, (void  **) 0);

  OCIAttrSet((void  *)usrhp, (ub4)OCI_HTYPE_SESSION, (void  *)"HR",
             (ub4)strlen("HR"), OCI_ATTR_USERNAME, errhp);
  OCIAttrSet((void  *)usrhp, (ub4)OCI_HTYPE_SESSION, (void  *)"HR",
             (ub4)strlen("HR"),OCI_ATTR_PASSWORD, errhp);

  OCISessionBegin (svchp, errhp, usrhp, OCI_CRED_RDBMS, 0);

  OCIAttrSet((void  *)svchp, (ub4)OCI_HTYPE_SVCCTX,
                (void  *)usrhp, (ub4)0, OCI_ATTR_SESSION, errhp);

  /* allocate transaction handle 1 and set it in the service handle */
  OCIHandleAlloc((void  *)envhp, (void  **)&amp;txnhp1,  OCI_HTYPE_TRANS, 0, 0);
  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp1, 0,
                          OCI_ATTR_TRANS, errhp);

  /* start a transaction with global transaction id = [1000, 123, 1] */
  gxid.formatID = 1000; /* format id = 1000 */
  gxid.gtrid_length = 3; /* gtrid = 123 */
  gxid.data[0] = 1; gxid.data[1] = 2; gxid.data[2] = 3;
  gxid.bqual_length = 1; /* bqual = 1 */
  gxid.data[3] = 1;

  OCIAttrSet((void  *)txnhp1, OCI_HTYPE_TRANS, (void  *)&amp;gxid, sizeof(XID),
                          OCI_ATTR_XID, errhp);

  /* start global transaction 1 with 60-second time to live when detached */
  OCITransStart(svchp, errhp, 60, OCI_TRANS_NEW);

  /* update hr.employees employee_id=7902, increment salary */
  sprintf((char *)sqlstmt, "UPDATE EMPLOYEES SET SALARY = SALARY + 1 \
                                           WHERE EMPLOYEE_ID = 7902");
  OCIStmtPrepare(stmthp1, errhp, sqlstmt, strlen((char *)sqlstmt),
                 OCI_NTV_SYNTAX, 0);
  OCIStmtExecute(svchp, stmthp1, errhp, 1, 0, 0, 0, 0);

  /* detach the transaction */
  OCITransDetach(svchp, errhp, 0);

  /* allocate transaction handle 2 and set it in the service handle */
  OCIHandleAlloc((void  *)envhp, (void  **)&amp;txnhp2,  OCI_HTYPE_TRANS, 0, 0);

  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp2, 0,
                          OCI_ATTR_TRANS, errhp);

  /* start a transaction with global transaction id = [1000, 124, 1] */
  gxid.formatID = 1000; /* format id = 1000 */
  gxid.gtrid_length = 3; /* gtrid = 124 */
  gxid.data[0] = 1; gxid.data[1] = 2; gxid.data[2] = 4;
  gxid.bqual_length = 1; /* bqual = 1 */
  gxid.data[3] = 1;

  OCIAttrSet((void  *)txnhp2, OCI_HTYPE_TRANS, (void  *)&amp;gxid, sizeof(XID),
                          OCI_ATTR_XID, errhp);

  /* start global transaction 2 with 90 second time to live when detached */
  OCITransStart(svchp, errhp, 90, OCI_TRANS_NEW);

  /* update hr.employees employee_id=7934, increment salary */
  sprintf((char *)sqlstmt, "UPDATE EMPLOYEES SET SALARY = SALARY + 1 \
                                            WHERE EMPLOYEE_ID = 7934");
  OCIStmtPrepare(stmthp2, errhp, sqlstmt, strlen((char *)sqlstmt),
                 OCI_NTV_SYNTAX, 0);
  OCIStmtExecute(svchp, stmthp2, errhp, 1, 0, 0, 0, 0);

  /* detach the transaction */
  OCITransDetach(svchp, errhp, 0);

  /* Resume transaction 1, increment salary and commit it */
  /* Set transaction handle 1 into the service handle */
  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp1, 0,
                          OCI_ATTR_TRANS, errhp);

  /* attach to transaction 1, wait for 10 seconds if the transaction is busy */
  /* The wait is clearly not required in this example because no other */
  /* process/thread is using the transaction. It is only for illustration */
  OCITransStart(svchp, errhp, 10, OCI_TRANS_RESUME);
  OCIStmtExecute(svchp, stmthp1, errhp, 1, 0, 0, 0, 0);
  OCITransCommit(svchp, errhp, (ub4) 0);

  /* attach to transaction 2 and commit it */
  /* set transaction handle2 into the service handle */
  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp2, 0,
                          OCI_ATTR_TRANS, errhp);
  OCITransCommit(svchp, errhp, (ub4) 0);
}
</pre><p>Using OCITransStart() in a Single Session Operating on Multiple Branches Sharing the Same Transaction</p><pre class="oac_no_warn" dir="ltr">
int main()
{
  OCIEnv *envhp;
  OCIServer *srvhp;
  OCIError *errhp;
  OCISvcCtx *svchp;
  OCISession *usrhp;
  OCIStmt *stmthp;
  OCITrans *txnhp1, *txnhp2;
  void      *tmp;
  XID gxid;
  text sqlstmt[128];

  OCIEnvCreate(&amp;envhp, OCI_DEFAULT, (void  *)0, 0, 0, 0,
        (size_t)0, (void  *)0);

  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;errhp, (ub4) OCI_HTYPE_ERROR,
                52, (void  **) &amp;tmp);
  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;srvhp, (ub4) OCI_HTYPE_SERVER,
                52, (void  **) &amp;tmp);

  OCIServerAttach( srvhp, errhp, (text *) 0, (sb4) 0, (ub4) OCI_DEFAULT);

  OCIHandleAlloc( (void  *) envhp, (void  **) &amp;svchp, (ub4) OCI_HTYPE_SVCCTX,
                52, (void  **) &amp;tmp);

  OCIHandleAlloc((void  *)envhp, (void  **)&amp;stmthp, OCI_HTYPE_STMT, 0, 0);

  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)srvhp, 0,
                  OCI_ATTR_SERVER, errhp);

  /* set the external name and internal name in server handle */
  OCIAttrSet((void  *)srvhp, OCI_HTYPE_SERVER, (void  *) "demo", 0,
                  OCI_ATTR_EXTERNAL_NAME, errhp);
  OCIAttrSet((void  *)srvhp, OCI_HTYPE_SERVER, (void  *) "txn demo2", 0,
                  OCI_ATTR_INTERNAL_NAME, errhp);

  /* allocate a user context handle */
  OCIHandleAlloc((void  *)envhp, (void  **)&amp;usrhp, (ub4) OCI_HTYPE_SESSION,
                (size_t) 0, (void  **) 0);

  OCIAttrSet((void  *)usrhp, (ub4)OCI_HTYPE_SESSION, (void  *)"HR",
             (ub4)strlen("HR"), OCI_ATTR_USERNAME, errhp);
  OCIAttrSet((void  *)usrhp, (ub4)OCI_HTYPE_SESSION, (void  *)"HR",
             (ub4)strlen("HR"),OCI_ATTR_PASSWORD, errhp);

  OCISessionBegin (svchp, errhp, usrhp, OCI_CRED_RDBMS, 0);

  OCIAttrSet((void  *)svchp, (ub4)OCI_HTYPE_SVCCTX,
                (void  *)usrhp, (ub4)0, OCI_ATTR_SESSION, errhp);

  /* allocate transaction handle 1 and set it in the service handle */
  OCIHandleAlloc((void  *)envhp, (void  **)&amp;txnhp1,  OCI_HTYPE_TRANS, 0, 0);
  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp1, 0,
                          OCI_ATTR_TRANS, errhp);

  /* start a transaction with global transaction id = [1000, 123, 1] */
  gxid.formatID = 1000; /* format id = 1000 */
  gxid.gtrid_length = 3; /* gtrid = 123 */
  gxid.data[0] = 1; gxid.data[1] = 2; gxid.data[2] = 3;
  gxid.bqual_length = 1; /* bqual = 1 */
  gxid.data[3] = 1;

  OCIAttrSet((void  *)txnhp1, OCI_HTYPE_TRANS, (void  *)&amp;gxid, sizeof(XID),
                          OCI_ATTR_XID, errhp);

  /* start global transaction 1 with 60-second time to live when detached */
  OCITransStart(svchp, errhp, 60, OCI_TRANS_NEW);

  /* update hr.employees employee_id=7902, increment salary */
  sprintf((char *)sqlstmt, "UPDATE EMPLOYEES SET SALARY = SALARY + 1 \
                                            WHERE EMPLOYEE_ID = 7902");
  OCIStmtPrepare(stmthp, errhp, sqlstmt, strlen((char *)sqlstmt),
                 OCI_NTV_SYNTAX, 0);
  OCIStmtExecute(svchp, stmthp, errhp, 1, 0, 0, 0, 0);

  /* detach the transaction */
  OCITransDetach(svchp, errhp, 0);

  /* allocate transaction handle 2 and set it in the service handle */
  OCIHandleAlloc((void  *)envhp, (void  **)&amp;txnhp2,  OCI_HTYPE_TRANS, 0, 0);
  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp2, 0,
                          OCI_ATTR_TRANS, errhp);

  /* start a transaction with global transaction id = [1000, 123, 2] */
  /* The global transaction is tightly coupled with earlier transactions */
  /* There is not much practical value in doing this but the example */
  /* illustrates the use of tightly coupled transaction branches. */
  /* In a practical case, the second transaction that tightly couples with */
  /* the first can be executed from a different process/thread. */

  gxid.formatID = 1000; /* format id = 1000 */
  gxid.gtrid_length = 3; /* gtrid = 123 */
  gxid.data[0] = 1; gxid.data[1] = 2; gxid.data[2] = 3;
  gxid.bqual_length = 1; /* bqual = 2 */
  gxid.data[3] = 2;

  OCIAttrSet((void  *)txnhp2, OCI_HTYPE_TRANS, (void  *)&amp;gxid,
sizeof(XID), OCI_ATTR_XID, errhp);

  /* start global transaction 2 with 90-second time to live when detached */
  OCITransStart(svchp, errhp, 90, OCI_TRANS_NEW);

  /* update hr.employees employee_id=7902, increment salary */
  /* This is possible even if the earlier transaction has locked this row */
  /* because the two global transactions are tightly coupled */
  OCIStmtExecute(svchp, stmthp, errhp, 1, 0, 0, 0, 0);

  /* detach the transaction */
  OCITransDetach(svchp, errhp, 0);

  /* Resume transaction 1 and prepare it. This returns */
  /* OCI_SUCCESS_WITH_INFO because all branches except the last branch */
  /* are treated as read-only transactions for tightly coupled transactions */

  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp1, 0,
                          OCI_ATTR_TRANS, errhp);
  if (OCITransPrepare(svchp, errhp, (ub4) 0) == OCI_SUCCESS_WITH_INFO)
  {
    text errbuf[512];
    ub4 buflen;
    sb4 errcode;

    OCIErrorGet ((void  *) errhp, (ub4) 1, (text *) NULL, &amp;errcode,
    errbuf, (ub4) sizeof(errbuf), (ub4) OCI_HTYPE_ERROR);
    printf("OCITransPrepare - %s\n", errbuf);
  }

  /* attach to transaction 2 and commit it */
  /* set transaction handle2 into the service handle */
  OCIAttrSet((void  *)svchp, OCI_HTYPE_SVCCTX, (void  *)txnhp2, 0,
                          OCI_ATTR_TRANS, errhp);
  OCITransCommit(svchp, errhp, (ub4) 0);
}
</pre></div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="transaction-functions.html#GUID-03AB7BAB-C8F0-4DFF-BD10-7CE0F3C8CE09" title="Detaches a global transaction.">OCITransDetach()</a></li>
                        <li><a href="miscellaneous-functions.html#GUID-4B99087C-74F6-498A-8310-D6645172390A" title="Returns an error message and an Oracle Database error code.">OCIErrorGet()</a></li>
                     </ul>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>