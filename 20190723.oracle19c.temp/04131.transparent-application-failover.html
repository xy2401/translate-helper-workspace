<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Transparent Application Failover</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="JDBC Developer's Guide">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="JDBC Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="jdbc-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-02-13T13:20:37-08:00">
      <meta name="dcterms.title" content="JDBC Developer's Guide">
      <meta name="dcterms.dateCopyrighted" content="1999, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96471-02">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="JDBC-support-Oracle-FAN.html" title="Previous" type="text/html">
      <link rel="next" href="single-client-access-name.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="JJDBC">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="JDBC-support-Oracle-FAN.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="single-client-access-name.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">JDBC Developer's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="high-availablility.html" property="item" typeof="WebPage"><span property="name"> High Availability</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Transparent Application Failover </li>
            </ol>
            <a id="GUID-95B3215D-A988-4619-94BD-0C6F56B8F43C" name="GUID-95B3215D-A988-4619-94BD-0C6F56B8F43C"></a>
            
            <h2 id="JJDBC-GUID-95B3215D-A988-4619-94BD-0C6F56B8F43C" class="sect2"><span class="enumeration_chapter">31 </span> Transparent Application Failover 
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>This chapter contains the following sections:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="transparent-application-failover.html#GUID-CE4DC31A-56F6-45B3-B4AE-1DAC8414138B">Overview of Transparent Application Failover</a></p>
                  </li>
                  <li>
                     <p><a href="transparent-application-failover.html#GUID-2FE6BED0-3879-47AF-9381-E13E3C45B155">Failover Type Events</a></p>
                  </li>
                  <li>
                     <p><a href="transparent-application-failover.html#GUID-2B28C498-F588-45B9-B1A0-8F396FF6D756">TAF Callbacks</a></p>
                  </li>
                  <li>
                     <p><a href="transparent-application-failover.html#GUID-E3BA2E54-B332-46AB-BEB9-175B789F3FFC">Java TAF Callback Interface</a></p>
                  </li>
                  <li>
                     <p><a href="transparent-application-failover.html#GUID-0C2A0B68-6391-4CDD-A5D0-3A7B72966E79">Comparison of TAF and Fast Connection Failover</a></p>
                  </li>
               </ul>
            </div><a id="JJDBC28836"></a><div class="props_rev_3"><a id="GUID-CE4DC31A-56F6-45B3-B4AE-1DAC8414138B" name="GUID-CE4DC31A-56F6-45B3-B4AE-1DAC8414138B"></a><h3 id="JJDBC-GUID-CE4DC31A-56F6-45B3-B4AE-1DAC8414138B" class="sect3"><span class="enumeration_section">31.1 </span>Overview of Transparent Application Failover
               </h3>
               <div>
                  <p><a id="d79516e56" class="indexterm-anchor"></a>Transparent Application Failover (<a id="d79516e59" class="indexterm-anchor"></a>TAF) is a feature of the Java Database Connectivity (JDBC) Oracle Call Interface (OCI) driver. It enables the application to automatically reconnect to a database, if the database instance to which the connection is made fails. In this case, the active transactions roll back.
                  </p>
                  <p>When an instance to which a connection is established fails or is shut down, the connection on the client-side becomes stale and would throw exceptions to the caller trying to use it. TAF enables the application to transparently reconnect to a preconfigured secondary instance, creating a fresh connection, but identical to the connection that was established on the first original instance. That is, the connection properties are the same as that of the earlier connection. This is true regardless of how the connection was lost.</p>
                  <div class="infoboxnote" id="GUID-CE4DC31A-56F6-45B3-B4AE-1DAC8414138B__GUID-3DDE1848-D67F-4792-9D08-1BD830B74D8B">
                     <p class="notep1">Note:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>TAF is always active and does not have to be set.</p>
                        </li>
                        <li>
                           <p>TAF is not supported with LOB and XML types.</p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div><a id="JJDBC28837"></a><div class="props_rev_3"><a id="GUID-2FE6BED0-3879-47AF-9381-E13E3C45B155" name="GUID-2FE6BED0-3879-47AF-9381-E13E3C45B155"></a><h3 id="JJDBC-GUID-2FE6BED0-3879-47AF-9381-E13E3C45B155" class="sect3"><span class="enumeration_section">31.2 </span>Failover Type Events
               </h3>
               <div>
                  <div class="section">
                     <p>The following are possible failover events in the <code class="codeph">OracleOCIFailover</code> interface:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><code class="codeph">FO_SESSION</code></p>
                           <p>Is equivalent to <code class="codeph">FAILOVER_MODE=SESSION</code> in the <code class="codeph">tnsnames.ora</code> file <code class="codeph">CONNECT_DATA</code> flags. This means that only the user session is authenticated again on the server side, while open cursors in the OCI application need to be reprocessed.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">FO_SELECT</code></p>
                           <p>Is equivalent to <code class="codeph">FAILOVER_MODE=SELECT</code> in <code class="codeph">tnsnames.ora</code> file <code class="codeph">CONNECT_DATA</code> flags. This means that not only the user session is re-authenticated on the server side, but open cursors in the OCI can continue fetching. This implies that the client-side logic maintains fetch-state of each open cursor.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">FO_NONE</code></p>
                           <p>Is equivalent to <code class="codeph">FAILOVER_MODE=NONE</code> in the <code class="codeph">tnsnames.ora</code> file <code class="codeph">CONNECT_DATA</code> flags. This is the default, in which no failover functionality is used. This can also be explicitly specified to prevent failover from happening. Additionally, <code class="codeph">FO_TYPE_UNKNOWN</code> implies that a bad failover type was returned from the OCI driver.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">FO_BEGIN</code></p>
                           <p>Indicates that failover has detected a lost connection and failover is starting.</p>
                        </li>
                        <li>
                           <p><code class="codeph">FO_END</code></p>
                           <p>Indicates successful completion of failover.</p>
                        </li>
                        <li>
                           <p><code class="codeph">FO_ABORT</code></p>
                           <p>Indicates that failover was unsuccessful and there is no option of retrying.</p>
                        </li>
                        <li>
                           <p><code class="codeph">FO_REAUTH</code></p>
                           <p>Indicates that a user handle has been re-authenticated.</p>
                        </li>
                        <li>
                           <p><code class="codeph">FO_ERROR</code></p>
                           <p>Indicates that failover was temporarily unsuccessful, but it gives the application the opportunity to handle the error and retry failover. The usual method of error handling is to issue the <code class="codeph">sleep</code> method and retry by returning the value <code class="codeph">FO_RETRY</code>.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">FO_RETRY</code></p>
                           <p>Indicates that the application should retry failover.</p>
                        </li>
                        <li>
                           <p><code class="codeph">FO_EVENT_UNKNOWN</code></p>
                           <p>Indicates a bad failover event.</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDBC28838"></a><div class="props_rev_3"><a id="GUID-2B28C498-F588-45B9-B1A0-8F396FF6D756" name="GUID-2B28C498-F588-45B9-B1A0-8F396FF6D756"></a><h3 id="JJDBC-GUID-2B28C498-F588-45B9-B1A0-8F396FF6D756" class="sect3"><span class="enumeration_section">31.3 </span>TAF Callbacks
               </h3>
               <div>
                  <div class="section">
                     <p>TAF callbacks are used in the event of the failure of one database connection, and failover to another database connection. TAF callbacks are callbacks that are registered in case of failover. The callback is called during the failover to notify the JDBC application of events generated. The application also has some control of failover.</p>
                     <div class="infoboxnote" id="GUID-2B28C498-F588-45B9-B1A0-8F396FF6D756__GUID-DB9F898C-0942-4D32-A65F-C76E7A62F99D">
                        <p class="notep1">Note:</p>
                        <p>The callback setting is optional.</p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDBC28840"></a><a id="JJDBC28841"></a><a id="JJDBC28839"></a><div class="props_rev_3"><a id="GUID-E3BA2E54-B332-46AB-BEB9-175B789F3FFC" name="GUID-E3BA2E54-B332-46AB-BEB9-175B789F3FFC"></a><h3 id="JJDBC-GUID-E3BA2E54-B332-46AB-BEB9-175B789F3FFC" class="sect3"><span class="enumeration_section">31.4 </span>Java TAF Callback Interface
               </h3>
               <div>
                  <div class="section">
                     <p>The <code class="codeph">OracleOCIFailover</code> interface includes the <code class="codeph">callbackFn</code> method, supporting the following types and events:
                     </p><pre class="oac_no_warn" dir="ltr">public interface OracleOCIFailover{

// Possible Failover Types
public static final int FO_SESSION = 1;
public static final int FO_SELECT  = 2;
public static final int FO_NONE  = 3;
public static final int;

// Possible Failover events registered with callback
public static final int FO_BEGIN   = 1;
public static final int FO_END     = 2;
public static final int FO_ABORT   = 3;
public static final int FO_REAUTH  = 4;
public static final int FO_ERROR  = 5;
public static final int FO_RETRY  = 6;
public static final int FO_EVENT_UNKNOWN = 7;

public int callbackFn (Connection conn,
                       Object ctxt, // ANy thing the user wants to save
                       int type, // One of the possible Failover Types
                       int event ); // One of the possible Failover Events
</pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-E3BA2E54-B332-46AB-BEB9-175B789F3FFC__GUID-AC90627B-2F92-483D-BACE-13F715C9F02E">Handling the FO_ERROR Event</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>In case of an error while failing over to a new connection, the JDBC application is able to retry failover. Typically, the application sleeps for a while and then it retries, either indefinitely or for a limited amount of time, by having the callback return <code class="codeph">FO_RETRY</code>.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-E3BA2E54-B332-46AB-BEB9-175B789F3FFC__GUID-314F0FA3-FDF3-40BE-86D9-0EAF0B58BE76">Handling the FO_ABORT Event</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>Callback registered should return the <code class="codeph">FO_ABORT</code> event if the <code class="codeph">FO_ERROR</code> event is passed to it. 
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDBC28835"></a><div class="props_rev_3"><a id="GUID-0C2A0B68-6391-4CDD-A5D0-3A7B72966E79" name="GUID-0C2A0B68-6391-4CDD-A5D0-3A7B72966E79"></a><h3 id="JJDBC-GUID-0C2A0B68-6391-4CDD-A5D0-3A7B72966E79" class="sect3"><span class="enumeration_section">31.5 </span>Comparison of TAF and Fast Connection Failover
               </h3>
               <div>
                  <div class="section">
                     <p>Transparent Application Failover (TAF) differs from Fast Connection Failover in the following ways:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Application-level connection retries</p>
                           <p>TAF supports connection retries only at the OCI/Net layer. Fast Connection Failover supports application-level connection retries. This gives the application control of responding to connection failovers. The application can choose whether to retry the connection or to rethrow the exception.</p>
                        </li>
                        <li>
                           <p>Integration with the Universal Connection Pool</p>
                           <p>TAF works at the network level on a per-connection basis, which means that the connection cache cannot be notified of failures. Fast Connection Failover is well-integrated with the Universal Connection Pool, which enables the Connection Cache Manager to manage the cache for high availability. For example, failed connections are automatically invalidated in the cache.</p>
                        </li>
                        <li>
                           <p>Event-based</p>
                           <p>Fast Connection Failover is based on the Oracle RAC event mechanism. This means that Fast Connection Failover is efficient and detects failures quickly for both active and inactive connections.</p>
                        </li>
                        <li>
                           <p>Load-balancing support</p>
                           <p>Fast Connection Failover supports <code class="codeph">UP</code> event load balancing of connections and run-time work request distribution across active Oracle RAC instances.
                           </p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-0C2A0B68-6391-4CDD-A5D0-3A7B72966E79__GUID-E205D954-856A-45B7-8A47-7C4FBB394456">
                        <p class="notep1">See Also:</p>
                        <p><a href="../jjucp/fast-connection-failover.html#JJUCP08100" target="_blank"><span class="italic">Oracle Universal Connection Pool for JDBC Developer's Guide</span></a></p>
                     </div>
                     <div class="infoboxnote" id="GUID-0C2A0B68-6391-4CDD-A5D0-3A7B72966E79__GUID-169A8EF1-0EED-461C-A777-042F4B092428">
                        <p class="notep1">Note:</p>
                        <p>Oracle recommends <span class="italic">not</span> to use TAF and Fast Connection Failover in the same application.
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>