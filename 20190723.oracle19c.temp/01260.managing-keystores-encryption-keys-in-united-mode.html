<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="United mode enables you to create a common keystore for the CDB and the PDBs for which the keystore is in united mode.">
      <meta name="description" content="United mode enables you to create a common keystore for the CDB and the PDBs for which the keystore is in united mode.">
      <title>Managing Keystores and TDE Master Encryption Keys in United Mode</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Advanced Security Guide ">
      <meta property="og:description" content="United mode enables you to create a common keystore for the CDB and the PDBs for which the keystore is in united mode.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Advanced Security Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="advanced-security-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-03-13T09:26:12-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96301-02">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="managing-keystore-and-tde-master-encryption-key.html" title="Previous" type="text/html">
      <link rel="next" href="managing-keystores-encryption-keys-in-isolated-mode.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Advanced Security Guide">
    <meta name="dcterms.isVersionOf" content="ASOAG">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="managing-keystore-and-tde-master-encryption-key.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="managing-keystores-encryption-keys-in-isolated-mode.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Advanced Security Guide </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="asopart1.html" property="item" typeof="WebPage"><span property="name">Using Transparent Data Encryption</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Managing Keystores and TDE Master Encryption Keys in United Mode</li>
            </ol>
            <a id="GUID-FA569DEC-6FF3-4CA1-86AA-D27F29EDCA3C" name="GUID-FA569DEC-6FF3-4CA1-86AA-D27F29EDCA3C"></a>
            
            <h2 id="ASOAG-GUID-FA569DEC-6FF3-4CA1-86AA-D27F29EDCA3C" class="sect2"><span class="enumeration_chapter">5 </span>Managing Keystores and TDE Master Encryption Keys in United Mode
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>United mode enables you to create a common keystore for the CDB and the PDBs for which the keystore is in united mode.</p>
               <p>The keys for the CDB and the PDBs reside in the common keystore.</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-D3045557-FA85-4EA5-A85A-75EAE9D67E13">About Managing Keystores and TDE Master Encryption Keys in United Mode</a><br>In united mode, you create the keystore and TDE master encryption key for CDB and PDBs that reside in the same keystore.
                  </li>
                  <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-02343C2C-160B-4950-A191-48317B20C507">Operations That Are Allowed in United Mode</a><br>Many <code class="codeph">ADMINISTER KEY MANAGEMENT</code> operations performed in the CDB root apply to keystores and encryption keys in the united mode PDB. 
                  </li>
                  <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9AEE8527-91D4-4FD7-B4DF-BFA5A7B43143">Operations That Are Not Allowed in a United Mode PDB</a><br><code class="codeph">ADMINISTER KEY MANAGEMENT</code> operations that are not allowed in a united mode PDB can be performed in the CDB root.
                  </li>
                  <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-13AB7212-BA7A-488D-AD70-D84C3B651127">Configuring the Keystore Location and Type for United Mode</a><br>For united mode, you can configure the keystore location and type by using only parameters or a combination of parameters and the <code class="codeph">ALTER SYSTEM</code> statement. 
                  </li>
                  <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-2E40034B-4523-4D1C-9A2F-BCC3D58C570D">Configuring a Software Keystore for Use in United Mode</a><br>In united mode, the software keystore resides in the CDB root but the master keys from this keystore are available for the PDBs that have their keystore in united mode.
                  </li>
                  <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-540A5DBF-720E-49E5-9060-DF40D3D4F6B0">Configuring a Hardware Keystore in United Mode</a><br>In united mode, a hardware keystore resides in a hardware security module (HSM), which is designed to store encryption keys.
                  </li>
                  <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D">Administering Keystores and TDE Master Encryption Keys in United Mode</a><br>After you configure a keystore and master encryption key for use in united mode, you can perform tasks such as rekeying TDE master encryption keys. 
                  </li>
                  <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-59000EDC-011E-45BF-9ECB-AC0335EE2FED">Administering Transparent Data Encryption in United Mode</a><br>You can perform general administrative tasks with Transparent Data Encryption in united mode. 
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>Parent topic:</strong> <a href="asopart1.html" title="Part I describes how to use Transparent Data Encryption.">Using Transparent Data Encryption</a></p>
                  </div>
               </div>
            </div>
            
            <div class="sect2"><a id="GUID-D3045557-FA85-4EA5-A85A-75EAE9D67E13" name="GUID-D3045557-FA85-4EA5-A85A-75EAE9D67E13"></a><h3 id="ASOAG-GUID-D3045557-FA85-4EA5-A85A-75EAE9D67E13" class="sect3">About Managing Keystores and TDE Master Encryption Keys in United Mode</h3>
               <div>
                  <p>In united mode, you create the keystore and TDE master encryption key for CDB and PDBs that reside in the same keystore.</p>
                  <p>The keys for PDBs having keystore in united mode, can be created from CDB root or from the PDB. </p>
                  <p>This design enables you to have one keystore to manage the entire CDB environment, enabling the PDBs to share this keystore, but you can customize the behavior of this keystore in the individual united mode PDBs. For example, in a united mode PDB, you can configure a TDE master encryption key for the PDB in the united keystore that you created in the CDB root, open the keystore locally, and close the keystore locally. In order to perform these actions, the keystore in the CDB root must be open. </p>
                  <p>Before you configure your environment to use united mode or isolated mode, all the PDBs in the CDB environment are considered to be in united mode. </p>
                  <p>To use united mode, you must follow these general steps: </p>
                  <ol>
                     <li>
                        <p>In the CDB root, configure the database to use united mode by setting the <code class="codeph">WALLET_ROOT</code> and <code class="codeph">TDE_CONFIGURATION</code> parameters.
                        </p>
                        <p>The <code class="codeph">WALLET_ROOT</code> parameter sets the location for the wallet directory and the <code class="codeph">TDE_CONFIGURATION</code> parameter sets the type of keystore to use.
                        </p>
                     </li>
                     <li>
                        <p>Restart the database so that these settings take effect. </p>
                     </li>
                     <li>
                        <p>In the CDB root, create the keystore, open the keystore, and then create the TDE master encryption key. </p>
                     </li>
                     <li>
                        <p>In each united mode PDB, perform TDE master encryption key tasks as needed, such as opening the keystore locally in the united mode PDB and creating the TDE master encryption key for the PDB. Remember that the keystore is managed by the CDB root, but must contain a TDE master encryption key that is specific to the PDB for the PDB to be able to use TDE.</p>
                     </li>
                  </ol>
                  <p>When you run <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statements in united mode from the CDB root, if the statement accepts the <code class="codeph">CONTAINER</code> clause, and if you set it to <code class="codeph">ALL</code>, then the statement applies only to the CDB root and its associated united mode PDBs. Any PDB that is in isolated mode is not affected. 
                  </p>
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-FA569DEC-6FF3-4CA1-86AA-D27F29EDCA3C" title="United mode enables you to create a common keystore for the CDB and the PDBs for which the keystore is in united mode.">Managing Keystores and TDE Master Encryption Keys in United Mode</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-02343C2C-160B-4950-A191-48317B20C507" name="GUID-02343C2C-160B-4950-A191-48317B20C507"></a><h3 id="ASOAG-GUID-02343C2C-160B-4950-A191-48317B20C507" class="sect3">Operations That Are Allowed in United Mode</h3>
               <div>
                  <p>Many <code class="codeph">ADMINISTER KEY MANAGEMENT</code> operations performed in the CDB root apply to keystores and encryption keys in the united mode PDB. 
                  </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-02343C2C-160B-4950-A191-48317B20C507__GUID-B68B7001-E1F5-4B69-868F-99D33621EAE7">Available United Mode-Related Operations in a CDB Root</p>
                     <p><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-02343C2C-160B-4950-A191-48317B20C507__ADMINISTERKEYMANAGEMENTUNITEDMODECD-108ECF95" title="This table describes the ADMINISTER KEY MANAGEMENT operations that are affect a united mode PDB, the syntax that is used for each operations, and notes.">Table 5-1</a> describes the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> operations that you can perform in the CDB root. 
                     </p>
                     <div class="tblformal" id="GUID-02343C2C-160B-4950-A191-48317B20C507__ADMINISTERKEYMANAGEMENTUNITEDMODECD-108ECF95">
                        <p class="titleintable">Table 5-1 ADMINISTER KEY MANAGEMENT United Mode Operations in a CDB Root</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="ADMINISTER KEY MANAGEMENT United Mode Operations in a CDB Root" summary="This table describes the ADMINISTER KEY MANAGEMENT operations that are affect a united mode PDB, the syntax that is used for each operations, and notes." frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="20%" id="d28070e362">Operation</th>
                                 <th align="left" valign="bottom" width="20%" id="d28070e364">Syntax</th>
                                 <th align="left" valign="bottom" width="20%" id="d28070e366">United Mode Notes</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d28070e370" headers="d28070e362 ">
                                    <p>Creating a keystore</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d28070e370 d28070e364 "><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT
CREATE KEYSTORE 
['<span class="italic">keystore_location</span>']
IDENTIFIED BY <span class="italic">keystore_password</span>;</pre></td>
                                 <td align="left" valign="top" width="20%" headers="d28070e370 d28070e366 ">
                                    <p>After you create the keystore in the CDB root, by default it is available in the united mode PDBs. Do not include the <code class="codeph">CONTAINER</code> clause. 
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d28070e389" headers="d28070e362 ">
                                    <p>Opening a keystore</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d28070e389 d28070e364 "><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT 
SET KEYSTORE OPEN
IDENTIFIED BY
[EXTERNAL STORE | <span class="italic">keystore_password</span>]
[CONTAINER = ALL | CURRENT];</pre></td>
                                 <td align="left" valign="top" width="20%" headers="d28070e389 d28070e366 ">
                                    <p>In this operation, the <code class="codeph">EXTERNAL STORE</code> clause uses the password in the SSO wallet located in the <code class="codeph">tde_seps</code> directory under the per-PDB <code class="codeph">WALLET_ROOT</code> location. 
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d28070e411" headers="d28070e362 ">
                                    <p>Changing a keystore password</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d28070e411 d28070e364 "><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT 
ALTER KEYSTORE PASSWORD
IDENTIFIED BY <span class="italic">old_keystore_password</span>
SET <span class="italic">new_keystore_password</span>WITH BACKUP 
[USING '<span class="italic">backup_identifier</span>'];</pre></td>
                                 <td align="left" valign="top" width="20%" headers="d28070e411 d28070e366 ">
                                    <p>Do not include the <code class="codeph">CONTAINER</code> clause. 
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d28070e433" headers="d28070e362 ">
                                    <p>Backing up a keystore</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d28070e433 d28070e364 "><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT
BACKUP KEYSTORE 
[USING '<span class="italic">backup_identifier</span>']
[FORCE KEYSTORE]
IDENTIFIED BY [EXTERNAL STORE | <span class="italic">keystore_password</span>]
[TO '<span class="italic">keystore_location</span>'];</pre></td>
                                 <td align="left" valign="top" width="20%" headers="d28070e433 d28070e366 ">
                                    <p>Do not include the <code class="codeph">CONTAINER</code> clause. 
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d28070e455" headers="d28070e362 ">
                                    <p>Closing a keystore without force</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d28070e455 d28070e364 "><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT 
SET KEYSTORE CLOSE
[IDENTIFIED BY [EXTERNAL STORE | <span class="italic">keystore_password</span>]]
[CONTAINER = ALL | CURRENT];</pre></td>
                                 <td align="left" valign="top" width="20%" headers="d28070e455 d28070e366 ">
                                    <p>If an isolated mode PDB keystore is open, then this statement raises an <code class="codeph">ORA-46692 cannot close wallet</code> error.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d28070e471" headers="d28070e362 ">
                                    <p>Closing a keystore with force</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d28070e471 d28070e364 "><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT 
FORCE KEYSTORE CLOSE
[IDENTIFIED BY [EXTERNAL STORE | <span class="italic">keystore_password</span>]]
[CONTAINER = ALL | CURRENT];</pre></td>
                                 <td align="left" valign="top" width="20%" headers="d28070e471 d28070e366 ">
                                    <p>This operation allows the keystore to be closed in the CDB root when an isolated keystore is open. </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d28070e484" headers="d28070e362 ">
                                    <p>Creating and activating a new TDE master encryption key (rekeying)</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d28070e484 d28070e364 "><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT 
SET [ENCRYPTION] KEY 
[FORCE KEYSTORE]
[USING TAG '<span class="italic">tag_name</span>']
IDENTIFIED BY [EXTERNAL STORE | <span class="italic">keystore_password</span>]
[WITH BACKUP 
[USING '<span class="italic">backup_identifier</span>']]
[CONTAINER = ALL | CURRENT]</pre></td>
                                 <td align="left" valign="top" width="20%" headers="d28070e484 d28070e366 ">
                                    <p>-</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d28070e503" headers="d28070e362 ">
                                    <p>Creating a user-defined TDE master encryption key for either now (<code class="codeph">SET</code>) or later on (<code class="codeph">CREATE</code>)
                                    </p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d28070e503 d28070e364 "><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT [SET | CREATE] [ENCRYPTION] KEY
'<span class="italic">mkid</span>:<span class="italic">mk</span> | <span class="italic">mk</span>' 
[USING ALGORITHM <span class="italic">'algorithm'</span>] 
[FORCE KEYSTORE]
[USING TAG '<span class="italic">tag_name</span>']
IDENTIFIED BY [EXTERNAL STORE | <span class="italic">keystore_password</span>]
 [WITH BACKUP [USING '<span class="italic">backup_identifier</span>']]
[CONTAINER = CURRENT];</pre></td>
                                 <td align="left" valign="top" width="20%" headers="d28070e503 d28070e366 ">
                                    <p>-</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d28070e541" headers="d28070e362 ">
                                    <p>Activating an existing TDE master encryption key</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d28070e541 d28070e364 "><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT 
USE [ENCRYPTION] KEY '<span class="italic">key_id</span> 
[USING TAG 'tag']
IDENTIFIED BY [EXTERNAL STORE | <span class="italic">keystore_password</span>]
WITH BACKUP 
[USING '<span class="italic">backup_identifier</span>'];</pre></td>
                                 <td align="left" valign="top" width="20%" headers="d28070e541 d28070e366 ">
                                    <p>Do not include the <code class="codeph">CONTAINER</code> clause. 
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d28070e563" headers="d28070e362 ">
                                    <p>Tagging a TDE master encryption key</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d28070e563 d28070e364 "><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT 
SET TAG 'tag' FOR '<span class="italic">key_id</span>'
IDENTIFIED BY [EXTERNAL STORE | <span class="italic">keystore_password</span> ]
WITH BACKUP 
[USING '<span class="italic">backup_identifier</span>'];</pre></td>
                                 <td align="left" valign="top" width="20%" headers="d28070e563 d28070e366 ">
                                    <p>Do not include the <code class="codeph">CONTAINER</code> clause. 
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d28070e585" headers="d28070e362 ">
                                    <p>Moving a TDE master encryption key to a new keystore</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d28070e585 d28070e364 "><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT 
MOVE [ENCRYPTION] KEYS
TO NEW KEYSTORE '<span class="italic">keystore_location1</span>'
IDENTIFIED BY <span class="italic">keystore1_password</span>
FROM [FORCE] KEYSTORE
IDENTIFIED BY <span class="italic">keystore_password</span>
[WITH IDENTIFIER IN
{ '<span class="italic">key_id</span>' [, '<span class="italic">key_id</span>' ]... | ( <span class="italic">subquery</span> ) } ]
[WITH BACKUP 
[USING '<span class="italic">backup_identifier</span>'];</pre></td>
                                 <td align="left" valign="top" width="20%" headers="d28070e585 d28070e366 ">
                                    <p>You can only move the master encryption key to a keystore that is within the same container (for example, between keystores in the CDB root or between keystores in the same PDB). You cannot move the master encryption key from a keystore in the CDB root to a keystore in a PDB, and vice versa.</p>
                                    <p>Do not include the <code class="codeph">CONTAINER</code> clause. 
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-02343C2C-160B-4950-A191-48317B20C507__GUID-5A35A7C6-E9F5-45CE-AD20-2C88733A5342">Available Operations in a United Mode PDB</p>
                     <p><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-02343C2C-160B-4950-A191-48317B20C507__ADMINISTERKEYMANAGEMENTUNITEDMODEOP-F95BABC5" title="This table describes the ADMINISTER KEY MANAGEMENT operations that are allowed in a united mode PDB, and the syntax used for each operations">Table 5-2</a> describes the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> operations that you can perform in a united mode PDB. 
                     </p>
                     <div class="tblformal" id="GUID-02343C2C-160B-4950-A191-48317B20C507__ADMINISTERKEYMANAGEMENTUNITEDMODEOP-F95BABC5">
                        <p class="titleintable">Table 5-2 ADMINISTER KEY MANAGEMENT United Mode PDB Operations</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="ADMINISTER KEY MANAGEMENT United Mode PDB Operations" summary="This table describes the ADMINISTER KEY MANAGEMENT operations that are allowed in a united mode PDB, and the syntax used for each operations" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" id="d28070e644">Operation</th>
                                 <th align="left" valign="bottom" id="d28070e646">Syntax</th>
                                 <th align="left" valign="bottom" id="d28070e648">United Mode Notes</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d28070e652" headers="d28070e644 ">
                                    <p>Opening a keystore</p>
                                 </td>
                                 <td align="left" valign="top" headers="d28070e652 d28070e646 "><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT 
SET KEYSTORE OPEN
IDENTIFIED BY
[EXTERNAL STORE | <span class="italic">keystore_password</span>]
[CONTAINER = CURRENT];</pre></td>
                                 <td align="left" valign="top" headers="d28070e652 d28070e648 ">
                                    <p>In this operation, the <code class="codeph">EXTERNAL_STORE</code> clause uses the password in the Secure Sockets Layer (SSL) wallet. This wallet is located in the <code class="codeph">tde_seps</code> directory in the <code class="codeph">WALLET_ROOT</code> location.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d28070e674" headers="d28070e644 ">
                                    <p>Closing a keystore without force</p>
                                 </td>
                                 <td align="left" valign="top" headers="d28070e674 d28070e646 "><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT 
SET KEYSTORE CLOSE
[IDENTIFIED BY <span class="italic">keystore_password</span>]
[CONTAINER = CURRENT];</pre></td>
                                 <td align="left" valign="top" headers="d28070e674 d28070e648 ">
                                    <p>-</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d28070e687" headers="d28070e644 ">
                                    <p>Closing a keystore with force</p>
                                 </td>
                                 <td align="left" valign="top" headers="d28070e687 d28070e646 "><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT 
FORCE KEYSTORE CLOSE
IDENTIFIED BY
[EXTERNAL STORE | <span class="italic">keystore_password</span>]
[CONTAINER = CURRENT];</pre></td>
                                 <td align="left" valign="top" headers="d28070e687 d28070e648 ">
                                    <p>-</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d28070e700" headers="d28070e644 ">
                                    <p>Creating and activating a new TDE master encryption key (rekeying or rotating)</p>
                                 </td>
                                 <td align="left" valign="top" headers="d28070e700 d28070e646 "><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT 
SET [ENCRYPTION] KEY 
[FORCE KEYSTORE]
[USING TAG '<span class="italic">tag_name</span>']
IDENTIFIED BY [EXTERNAL STORE | <span class="italic">keystore_password</span>] 
[WITH BACKUP 
[USING '<span class="italic">backup_identifier</span>']]
[CONTAINER = CURRENT];</pre></td>
                                 <td align="left" valign="top" headers="d28070e700 d28070e648 ">
                                    <p>-</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d28070e719" headers="d28070e644 ">
                                    <p>Creating a user-defined TDE master encryption key for use either now  (<code class="codeph">SET</code>) or later on (<code class="codeph">CREATE</code>)
                                    </p>
                                 </td>
                                 <td align="left" valign="top" headers="d28070e719 d28070e646 "><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET | CREATE [ENCRYPTION] KEY
'<span class="italic">mkid</span>:<span class="italic">mk</span> | <span class="italic">mk</span>' 
[USING ALGORITHM <span class="italic">'algorithm'</span>] 
[FORCE KEYSTORE]
IDENTIFIED BY [EXTERNAL STORE | <span class="italic">keystore_password</span>] 
[WITH BACKUP [USING '<span class="italic">backup_identifier</span>']]
[CONTAINER = CURRENT];</pre></td>
                                 <td align="left" valign="top" headers="d28070e719 d28070e648 ">
                                    <p>-</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d28070e754" headers="d28070e644 ">
                                    <p>Activating an existing TDE master encryption key</p>
                                 </td>
                                 <td align="left" valign="top" headers="d28070e754 d28070e646 "><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT 
USE [ENCRYPTION] KEY '<span class="italic">key_id</span>' 
[USING TAG 'tag']
IDENTIFIED BY
[EXTERNAL STORE | <span class="italic">keystore_password</span>] 
[WITH BACKUP 
[USING '<span class="italic">backup_identifier</span>']];</pre></td>
                                 <td align="left" valign="top" headers="d28070e754 d28070e648 ">
                                    <p>Do not include the <code class="codeph">CONTAINER</code> clause. 
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d28070e776" headers="d28070e644 ">
                                    <p>Tagging a TDE master encryption key</p>
                                 </td>
                                 <td align="left" valign="top" headers="d28070e776 d28070e646 "><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT 
SET TAG 'tag' FOR '<span class="italic">key_id</span>'
[FORCE KEYSTORE]
IDENTIFIED BY [EXTERNAL STORE | <span class="italic">keystore_password</span>]
[WITH BACKUP 
[USING '<span class="italic">backup_identifier</span>']];</pre></td>
                                 <td align="left" valign="top" headers="d28070e776 d28070e648 ">
                                    <p>Do not include the <code class="codeph">CONTAINER</code> clause. 
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d28070e798" headers="d28070e644 ">
                                    <p>Moving an encryption key to a new keystore</p>
                                 </td>
                                 <td align="left" valign="top" headers="d28070e798 d28070e646 "><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT 
MOVE [ENCRYPTION] KEYS
TO NEW KEYSTORE '<span class="italic">keystore_location1</span>'
IDENTIFIED BY <span class="italic">keystore1_password</span>
FROM [FORCE] KEYSTORE
IDENTIFIED BY <span class="italic">keystore_password</span>
[WITH IDENTIFIER IN
{ '<span class="italic">key_id</span>' [, '<span class="italic">key_id</span>' ]... | ( <span class="italic">subquery</span> ) } ]
[WITH BACKUP 
[USING '<span class="italic">backup_identifier</span>']];</pre></td>
                                 <td align="left" valign="top" headers="d28070e798 d28070e648 ">
                                    <p>Do not include the <code class="codeph">CONTAINER</code> clause. 
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d28070e833" headers="d28070e644 ">
                                    <p>Moving a key from a united mode keystore in the CDB root to an isolated mode keystore in a PDB</p>
                                 </td>
                                 <td align="left" valign="top" headers="d28070e833 d28070e646 "><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT 
ISOLATE KEYSTORE
IDENTIFIED BY <span class="italic">isolated_keystore_password</span>
FROM ROOT KEYSTORE
[FORCE KEYSTORE]
IDENTIFIED BY
[EXTERNAL STORE | <span class="italic">united_keystore_password</span>]
[WITH BACKUP [USING <span class="italic">backup_id</span>]];</pre></td>
                                 <td align="left" valign="top" headers="d28070e833 d28070e648 ">
                                    <p>Do not include the <code class="codeph">CONTAINER</code> clause. 
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d28070e855" headers="d28070e644 ">
                                    <p>Using the <code class="codeph">FORCE</code> clause when a clone of a PDB is using the TDE master encryption key that is being isolated; then coping (rather than moving) the TDE master encryption keys from the keystore that is in the CDB root into the isolated mode keystore of the PDB
                                    </p>
                                 </td>
                                 <td align="left" valign="top" headers="d28070e855 d28070e646 "><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT 
[FORCE] ISOLATE KEYSTORE
IDENTIFIED BY <span class="italic">isolated_keystore_password</span>
FROM ROOT KEYSTORE
[FORCE KEYSTORE]
IDENTIFIED BY
[EXTERNAL STORE | <span class="italic">united_keystore_password</span>]
[WITH BACKUP [USING <span class="italic">backup_id</span>]];</pre></td>
                                 <td align="left" valign="top" headers="d28070e855 d28070e648 ">
                                    <p>-</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-FA569DEC-6FF3-4CA1-86AA-D27F29EDCA3C" title="United mode enables you to create a common keystore for the CDB and the PDBs for which the keystore is in united mode.">Managing Keystores and TDE Master Encryption Keys in United Mode</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-9AEE8527-91D4-4FD7-B4DF-BFA5A7B43143" name="GUID-9AEE8527-91D4-4FD7-B4DF-BFA5A7B43143"></a><h3 id="ASOAG-GUID-9AEE8527-91D4-4FD7-B4DF-BFA5A7B43143" class="sect3">Operations That Are Not Allowed in a United Mode PDB</h3>
               <div>
                  <p><code class="codeph">ADMINISTER KEY MANAGEMENT</code> operations that are not allowed in a united mode PDB can be performed in the CDB root.
                  </p>
                  <div class="section">
                     <p>These operations are as follows:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Keystore operations:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Performing merge operations on keystores</p>
                              </li>
                              <li>
                                 <p>Exporting a keystore</p>
                              </li>
                              <li>
                                 <p>Importing a keystore</p>
                              </li>
                              <li>
                                 <p>Migrating a keystore</p>
                              </li>
                              <li>
                                 <p>Reverse-migrating a keystore</p>
                              </li>
                              <li>
                                 <p>Moving the keys of a keystore that is in the CDB root into the keystores of a PDB</p>
                              </li>
                              <li>
                                 <p>Moving the keys from a PDB into a united mode keystore that is in the CDB root</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>Encryption key operations:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Using the <code class="codeph">CONTAINER = ALL</code> clause to create a new TDE master encryption key for later user in each pluggable database (PDB)
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>Client secret operations:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Adding client secrets</p>
                              </li>
                              <li>
                                 <p>Updating client secrets</p>
                              </li>
                              <li>
                                 <p>Deleting client secrets</p>
                              </li>
                           </ul>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-FA569DEC-6FF3-4CA1-86AA-D27F29EDCA3C" title="United mode enables you to create a common keystore for the CDB and the PDBs for which the keystore is in united mode.">Managing Keystores and TDE Master Encryption Keys in United Mode</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-13AB7212-BA7A-488D-AD70-D84C3B651127" name="GUID-13AB7212-BA7A-488D-AD70-D84C3B651127"></a><h3 id="ASOAG-GUID-13AB7212-BA7A-488D-AD70-D84C3B651127" class="sect3">Configuring the Keystore Location and Type for United Mode</h3>
               <div>
                  <p>For united mode, you can configure the keystore location and type by using only parameters or a combination of parameters and the <code class="codeph">ALTER SYSTEM</code> statement. 
                  </p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-3C9F5F0E-C5E2-4B9B-8CE8-CDB8B6750271">Configuring United Mode by Editing the Initialization Parameter File</a><br>You can configure united mode by setting both the <code class="codeph">WALLET_ROOT</code> and <code class="codeph">TDE_CONFIGURATION</code> parameters in the initialization parameter file.
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-CD6E4741-4916-4F24-9427-4DA25DF40587">Configuring United Mode with the Initialization Parameter File and ALTER SYSTEM</a><br>If your environment relies on server parameter files (spfile) or parameter files (pfile), then you can set <code class="codeph">TDE_CONFIGURATION</code> using <code class="codeph">ALTER SYSTEM</code> with <code class="codeph">SCOPE</code>.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-FA569DEC-6FF3-4CA1-86AA-D27F29EDCA3C" title="United mode enables you to create a common keystore for the CDB and the PDBs for which the keystore is in united mode.">Managing Keystores and TDE Master Encryption Keys in United Mode</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-3C9F5F0E-C5E2-4B9B-8CE8-CDB8B6750271" name="GUID-3C9F5F0E-C5E2-4B9B-8CE8-CDB8B6750271"></a><h4 id="ASOAG-GUID-3C9F5F0E-C5E2-4B9B-8CE8-CDB8B6750271" class="sect4">Configuring United Mode by Editing the Initialization Parameter File</h4>
                  <div>
                     <p>You can configure united mode by setting both the <code class="codeph">WALLET_ROOT</code> and <code class="codeph">TDE_CONFIGURATION</code> parameters in the initialization parameter file.
                     </p>
                     <ol>
                        <li class="stepexpand"><span>Log in to the server where the CDB root of the Oracle database resides. </span></li>
                        <li class="stepexpand"><span>If necessary, create a wallet directory. </span><div>Typically, the wallet directory is located in the <code class="codeph">$ORACLE_BASE/admin/<span class="codeinlineitalic">db_unique_name</span></code> directory, and it is named <code class="codeph">wallet</code>. Preferably, this directory should be empty.
                           </div>
                        </li>
                        <li class="stepexpand"><span>Edit the initialization parameter file, which by default is located in the <code class="codeph">$ORACLE_HOME/dbs</code> directory, to include the following parameters:</span><ul>
                              <li><code class="codeph">WALLET_ROOT</code>, to point to the location of the wallet directory. 
                                 <p>For example, for a database named <code class="codeph">orcl</code>:
                                 </p><pre class="oac_no_warn" dir="ltr">wallet_root=$ORACLE_BASE/admin/orcl/wallet</pre></li>
                              <li><code class="codeph">TDE_CONFIGURATION</code>, to specify one of the following keystore types:
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p><code class="codeph">FILE</code> specifies a software keystore.
                                       </p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">OKV</code> specifies an Oracle Key Vault keystore.
                                       </p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">HSM</code> specifies a hardware security module (HSM) keystore.
                                       </p>
                                    </li>
                                 </ul>
                                 <p>For example, to specify the TDE keystore type:</p><pre class="oac_no_warn" dir="ltr">tde_configuration="keystore_configuration=file"</pre></li>
                           </ul>
                        </li>
                        <li class="stepexpand"><span>Log in to the CDB root as a user who has been granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege.  </span><div>For example:<pre class="oac_no_warn" dir="ltr">sqlplus sec_admin as syskm
Enter password: <span class="italic">password</span></pre></div>
                        </li>
                        <li class="stepexpand"><span>Check the configuration settings. </span><ul>
                              <li>For the <code class="codeph">WALLET_ROOT</code> parameter:<pre class="oac_no_warn" dir="ltr">SHOW PARAMETER WALLET_ROOT</pre><p>The <code class="codeph">VALUE</code> column of the output should show the absolute path location of the <code class="codeph">wallet</code> directory.
                                 </p>
                              </li>
                              <li>For the <code class="codeph">TDE_CONFIGURATION</code> parameter:<pre class="oac_no_warn" dir="ltr">SHOW PARAMETER TDE_CONFIGURATION</pre><p>The <code class="codeph">VALUE</code> column should show the keystore type, prepended with <code class="codeph">KEYSTORE_CONFIGURATION=</code>. 
                                 </p>
                              </li>
                           </ul>
                           <div>If the values do not appear, then try restarting your database with the <code class="codeph">STARTUP</code> command pointing to the location of the initialization parameter file where you added these settings. For example: <pre class="oac_no_warn" dir="ltr">STARTUP PFILE = /u01/oracle/dbs/init.ora</pre></div>
                        </li>
                        <li class="stepexpand"><span>Confirm that the <code class="codeph">TDE_CONFIGURATION</code> parameter was set correctly.</span><div><pre class="oac_no_warn" dir="ltr">SELECT CON_ID, KEYSTORE_MODE FROM V$ENCRYPTION_WALLET;</pre><div class="p">The output should be similar to the following:<pre class="oac_no_warn" dir="ltr">    CON_ID KEYSTORE
---------- --------
         1 NONE
         2 UNITED
         3 UNITED
         4 UNITED
         5 UNITED
</pre>The CDB root (<code class="codeph">CON_ID 1</code>) will always be in the <code class="codeph">NONE</code> state, and at this stage, the remaining <code class="codeph">CON_ID</code>s should be set to <code class="codeph">UNITED</code>. PDBs can be either <code class="codeph">UNITED</code> or <code class="codeph">ISOLATED</code>, depending on how you configure them. When you query the <code class="codeph">V$ENCRYPTION_WALLET</code> view, if the <code class="codeph">ORA-46691: The value of the KEYSTORE_CONFIGURATION attribute is invalid</code> error appears, then check the initialization parameter file where you added this setting. 
                              </div>
                           </div>
                        </li>
                     </ol>
                     <div class="section">After you configure united mode, you can create keystores and master encryption keys, and when these are configured, you can encrypt data. </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-13AB7212-BA7A-488D-AD70-D84C3B651127" title="For united mode, you can configure the keystore location and type by using only parameters or a combination of parameters and the ALTER SYSTEM statement.">Configuring the Keystore Location and Type for United Mode</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-CD6E4741-4916-4F24-9427-4DA25DF40587" name="GUID-CD6E4741-4916-4F24-9427-4DA25DF40587"></a><h4 id="ASOAG-GUID-CD6E4741-4916-4F24-9427-4DA25DF40587" class="sect4">Configuring United Mode with the Initialization Parameter File and ALTER SYSTEM</h4>
                  <div>
                     <p>If your environment relies on server parameter files (spfile) or parameter files (pfile), then you can set <code class="codeph">TDE_CONFIGURATION</code> using <code class="codeph">ALTER SYSTEM</code> with <code class="codeph">SCOPE</code>.
                     </p>
                     <div class="section">With this method, you still set the <code class="codeph">WALLET_ROOT</code> static initialization parameter in the initialization parameter file. 
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Log in to the server where the CDB root of the Oracle database resides. </span></li>
                        <li class="stepexpand"><span>If necessary, create a wallet directory. </span><div>Typically, the wallet directory is located in the <code class="codeph">$ORACLE_BASE/admin/<span class="codeinlineitalic">db_unique_name</span></code> directory, and it is named <code class="codeph">wallet</code>. Preferably, this directory should be empty.
                           </div>
                        </li>
                        <li class="stepexpand"><span>Edit the initialization parameter file to include the <code class="codeph">WALLET_ROOT</code> static initialization parameter for the wallet directory.</span><div>By default, the initialization parameter file is located in the <code class="codeph">$ORACLE_HOME/dbs</code> directory. 
                           </div>
                           <div>For example, for a database instance named <code class="codeph">orcl</code>: <pre class="oac_no_warn" dir="ltr">wallet_root=$ORACLE_BASE/admin/orcl/wallet</pre></div>
                        </li>
                        <li class="stepexpand"><span>Log in to the CDB root as a user who has been granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege. </span><div>For example:<pre class="oac_no_warn" dir="ltr">sqlplus sec_admin as syskm
Enter password: <span class="italic">password</span></pre></div>
                        </li>
                        <li class="stepexpand"><span>Restart the database. </span><div><pre class="oac_no_warn" dir="ltr">SHUTDOWN IMMEDIATE
STARTUP</pre><p>To start the database by pointing to the location of the initialization file where you added the <code class="codeph">WALLET_ROOT</code> setting, issue a <code class="codeph">STARTUP</code> command similar to the following:
                              </p><pre class="oac_no_warn" dir="ltr">STARTUP PFILE = /u01/oracle/dbs/init.ora</pre></div>
                        </li>
                        <li class="stepexpand"><span>Check the <code class="codeph">WALLET_ROOT</code> setting. </span><div><pre class="oac_no_warn" dir="ltr">SHOW PARAMETER WALLET_ROOT</pre><p>The <code class="codeph">VALUE</code> column of the output should show the absolute path location of the <code class="codeph">wallet</code> directory.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Set the <code class="codeph">TDE_CONFIGURATION</code> dynamic initialization parameter to specify the keystore type, using the following syntax: </span><div><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM SET TDE_CONFIGURATION="KEYSTORE_CONFIGURATION=<span class="italic">keystore_type</span>" 
SCOPE=<span class="italic">scope_type</span>;</pre><p>In this specification:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><code class="codeph"><span class="codeinlineitalic">keystore_type</span></code> can be one of the following settings for united mode:
                                    </p>
                                    <ul style="list-style-type: disc;">
                                       <li>
                                          <p><code class="codeph">FILE</code> configures a TDE keystore.
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">OKV</code> configures an Oracle Key Vault keystore.
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">HSM</code> configures a hardware security module (HSM) keystore.
                                          </p>
                                       </li>
                                    </ul>
                                 </li>
                                 <li>
                                    <p><code class="codeph"><span class="codeinlineitalic">scope_type</span></code> sets the type of scope (for example, <code class="codeph">both</code>, <code class="codeph">memory</code>, <code class="codeph">spfile</code>, <code class="codeph">pfile</code>.
                                    </p>
                                 </li>
                              </ul>
                              <p>For example, to configure a TDE keystore if the parameter file (<code class="codeph">pfile</code>) is in use, set <code class="codeph">scope</code> to <code class="codeph">memory</code>:
                              </p><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM SET TDE_CONFIGURATION="KEYSTORE_CONFIGURATION=FILE" 
SCOPE=memory;</pre><p>To configure a TDE keystore if the server parameter file (<code class="codeph">spfile</code>) is in use, set scope to <code class="codeph">both</code>:
                              </p><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM SET TDE_CONFIGURATION="KEYSTORE_CONFIGURATION=FILE" 
SCOPE=both;</pre></div>
                        </li>
                        <li class="stepexpand"><span>Check the <code class="codeph">TDE_CONFIGURATION</code> parameter setting.</span><div><pre class="oac_no_warn" dir="ltr">SHOW PARAMETER TDE_CONFIGURATION
</pre><p>The <code class="codeph">VALUE</code> column should show the keystore type, prepended with <code class="codeph">KEYSTORE_CONFIGURATION=</code>. 
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Confirm that the <code class="codeph">TDE_CONFIGURATION</code> parameter was set correctly.</span><div><pre class="oac_no_warn" dir="ltr">SELECT CON_ID, KEYSTORE_MODE FROM V$ENCRYPTION_WALLET;</pre><div class="p">The output should be similar to the following:<pre class="oac_no_warn" dir="ltr">    CON_ID KEYSTORE
---------- --------
         1 NONE
         2 UNITED
         3 UNITED
         4 UNITED
         5 UNITED
</pre>The CDB root (<code class="codeph">CON_ID 1</code>) will always be in the <code class="codeph">NONE</code> state, and at this stage, the remaining <code class="codeph">CON_ID</code>s should be set to <code class="codeph">UNITED</code>. PDBs can be either <code class="codeph">UNITED</code> or <code class="codeph">ISOLATED</code>, depending on how you configure them. When you query the <code class="codeph">V$ENCRYPTION_WALLET</code> view, if the <code class="codeph">ORA-46691: The value of the KEYSTORE_CONFIGURATION attribute is invalid</code> error appears, then check the initialization parameter file where you added this setting. 
                              </div>
                           </div>
                        </li>
                     </ol>
                     <div class="section">After you configure united mode, you can create keystores and master encryption keys, and when these are configured, you can encrypt data. </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-13AB7212-BA7A-488D-AD70-D84C3B651127" title="For united mode, you can configure the keystore location and type by using only parameters or a combination of parameters and the ALTER SYSTEM statement.">Configuring the Keystore Location and Type for United Mode</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
            <div class="sect2"><a id="GUID-2E40034B-4523-4D1C-9A2F-BCC3D58C570D" name="GUID-2E40034B-4523-4D1C-9A2F-BCC3D58C570D"></a><h3 id="ASOAG-GUID-2E40034B-4523-4D1C-9A2F-BCC3D58C570D" class="sect3">Configuring a Software Keystore for Use in United Mode</h3>
               <div>
                  <p>In united mode, the software keystore resides in the CDB root but the master keys from this keystore are available for the PDBs that have their keystore in united mode.</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-864C19CD-C973-487D-8D4D-BCB8CD99BD6E">About Configuring a Software Keystore in United Mode</a><br>In united mode, the keystore that you create in the CDB root will be accessible by the united mode PDBs. 
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-3219B2E9-DA55-4404-B602-C47EE8DCE25A">Step 1: Create the Software Keystore</a><br>In united mode, you must create the keystore in the CDB root.
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-765C103D-67A0-4DF1-930E-CFFFA89B2DC2">Step 2: Open the Software Keystore in a United Mode PDB</a><br>To open a software keystore in united mode, you must use the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement with the <code class="codeph">SET KEYSTORE OPEN</code> clause.
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-8A6CF613-F182-4249-ACAE-764C145E210B">Step 3: Set the TDE Master Encryption Key in the Software Keystore in United Mode</a><br>To set the TDE master encryption key in the keystore when the PDB is configured in united mode, use the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement with the <code class="codeph">SET KEY</code> clause.
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-54A232F4-B303-40B1-B8A4-74FEB9B39239">Step 4: Encrypt Your Data in United Mode</a><br>Now that you have completed the keystore configuration and the PDB is configured in united mode, you can begin to encrypt data in the PDB.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-FA569DEC-6FF3-4CA1-86AA-D27F29EDCA3C" title="United mode enables you to create a common keystore for the CDB and the PDBs for which the keystore is in united mode.">Managing Keystores and TDE Master Encryption Keys in United Mode</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-864C19CD-C973-487D-8D4D-BCB8CD99BD6E" name="GUID-864C19CD-C973-487D-8D4D-BCB8CD99BD6E"></a><h4 id="ASOAG-GUID-864C19CD-C973-487D-8D4D-BCB8CD99BD6E" class="sect4">About Configuring a Software Keystore in United Mode</h4>
                  <div>
                     <p>In united mode, the keystore that you create in the CDB root will be accessible by the united mode PDBs. </p>
                     <p>In general, to configure a united mode software keystore after you have enabled united mode, you create and open the keystore in the CDB root, and then create a master encryption key for this keystore. Afterward, you can begin to encrypt data for tables and tablespaces that will be accessible throughout the CDB environment. </p>
                     <p>The <code class="codeph">V$ENCRYPTION_WALLET</code> dynamic view describes the status and location of the keystore. For example, the following query shows the open-closed status and the keystore location of the CDB root keystore (<code class="codeph">CON_ID 1</code>) and its associated united mode PDBs. The <code class="codeph">WRL_PARAMETER</code> column shows the CDB root keystore location being in the <code class="codeph">$ORACLE_BASE/wallet/tde</code> directory. 
                     </p><pre class="oac_no_warn" dir="ltr">SELECT CON_ID, STATUS, WRL_PARAMETER FROM V$ENCRYPTION_WALLET;

CON_ID STATUS WRL_PARAMETER
------ ------ -----------------------------
     1 OPEN   /app/oracle/wallet/tde/
     2 CLOSED 
     3 OPEN 
     4 OPEN
     5 OPEN  </pre><p>In this output, there is no keystore path listed for the other PDBs in this CDB because these PDBs use the keystore in the CDB root. If any of these PDBs are isolated and you create a keystore in the isolated mode PDB, then when you perform this query, the <code class="codeph">WRL_PARAMETER</code> column will show the keystore path for the isolated mode PDB.
                     </p>
                     <p>You can create a secure external store for the software keystore. This feature enables you to hide the password from the operating system: it removes the need for storing clear-text keystore passwords in scripts or other tools that can access the database without user intervention, such as overnight batch scripts. The location for this keystore is set by the <code class="codeph">EXTERNAL_KEYSTORE_CREDENTIAL_LOCATION</code> initialization parameter. In a multitenant environment, different PDBs can access this external store location when you run the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement using the <code class="codeph">IDENTIFIED BY EXTERNAL STORE</code> clause. This way, you can centrally locate the password and then update it only once in the external store.
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-2E40034B-4523-4D1C-9A2F-BCC3D58C570D" title="In united mode, the software keystore resides in the CDB root but the master keys from this keystore are available for the PDBs that have their keystore in united mode.">Configuring a Software Keystore for Use in United Mode</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-3219B2E9-DA55-4404-B602-C47EE8DCE25A" name="GUID-3219B2E9-DA55-4404-B602-C47EE8DCE25A"></a><h4 id="ASOAG-GUID-3219B2E9-DA55-4404-B602-C47EE8DCE25A" class="sect4">Step 1: Create the Software Keystore</h4>
                  <div>
                     <p>In united mode, you must create the keystore in the CDB root.</p>
                     <div class="section">After you create this keystore in the CDB root, it becomes available in any united mode PDB, but not in any isolated mode PDBs. </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Log in to the CDB root as a user who has been granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege.</span><div>For example:<pre class="oac_no_warn" dir="ltr">sqlplus c##sec_admin as syskm
Enter password: <span class="italic">password</span></pre></div>
                        </li>
                        <li class="stepexpand"><span>Run the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> SQL statement to create the keystore using the following syntax:</span><div><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT CREATE KEYSTORE 
['<span class="italic">keystore_location</span>'] 
IDENTIFIED BY <span class="italic">software_keystore_password</span>;
</pre><p>In this specification:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><span class="italic"><code class="codeph">keystore_location</code></span> is the path to the keystore directory location of the password-protected keystore for which you want to create the auto-login keystore. If the path that is set by the <code class="codeph">WALLET_ROOT</code> parameter is the path that you want to use, then you can omit the <span class="italic"><code class="codeph">keystore_location</code></span> setting.
                                    </p>
                                    <p>If you specify the <span class="italic"><code class="codeph">keystore_location</code></span>, then enclose it in single quotation marks (<code class="codeph">' '</code>). To find the default location, you can query the <code class="codeph">WRL_PARAMETER</code> column of the <code class="codeph">V$ENCRYPTION_WALLET</code> view. (If the keystore was not created in the default location, then the <code class="codeph">STATUS</code> column of the <code class="codeph">V$ENCRYPTION_WALLET</code> view is <code class="codeph">NOT_AVAILABLE</code>.)
                                    </p>
                                 </li>
                                 <li>
                                    <p><span class="italic"><code class="codeph">software_keystore_password</code></span> is the password of the keystore that you, the security administrator, creates. 
                                    </p>
                                 </li>
                              </ul>
                              <p>For example, to create the keystore in the default location, assuming that <code class="codeph">WALLET_ROOT</code> has been set:
                              </p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT CREATE KEYSTORE 
IDENTIFIED BY <span class="italic">password</span>;

keystore altered.
</pre></div>
                        </li>
                     </ol>
                     <div class="section">After you complete these steps, the <code class="codeph">ewallet.p12</code> file, which contains the keystore, appears in the designated keystore location. For example, if you had set the <code class="codeph">WALLET_ROOT</code> parameter to <code class="codeph">$ORACLE_BASE/wallet</code> and the <code class="codeph">TDE_CONFIGURATION</code> parameter to <code class="codeph">FILE</code> (for TDE, which creates a <code class="codeph">tde</code> directory in the wallet root location), then the keystore will be created in the <code class="codeph">$ORACLE_BASE/wallet/tde</code> directory. The name of the keystore is <code class="codeph">ewallet.p12</code>.
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-4F6206B6-A33F-4FB1-9223-DD61FFAD3F12" title="An external store for a keystore password stores the keystore password in a centrally accessed and managed location.">Configuring an External Store for a Keystore Password</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-2E40034B-4523-4D1C-9A2F-BCC3D58C570D" title="In united mode, the software keystore resides in the CDB root but the master keys from this keystore are available for the PDBs that have their keystore in united mode.">Configuring a Software Keystore for Use in United Mode</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-765C103D-67A0-4DF1-930E-CFFFA89B2DC2" name="GUID-765C103D-67A0-4DF1-930E-CFFFA89B2DC2"></a><h4 id="ASOAG-GUID-765C103D-67A0-4DF1-930E-CFFFA89B2DC2" class="sect4">Step 2: Open the Software Keystore in a United Mode PDB</h4>
                  <div>
                     <p>To open a software keystore in united mode, you must use the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement with the <code class="codeph">SET KEYSTORE OPEN</code> clause.
                     </p>
                     <ol>
                        <li class="stepexpand"><span>Log in to the CDB root as a common user who has been granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege.</span><div>For example:<pre class="oac_no_warn" dir="ltr">sqlplus c##sec_admin as syskm
Enter password: <span class="italic">password</span></pre></div>
                        </li>
                        <li class="stepexpand"><span>Open the keystore in the CDB root. </span><div>For example:<pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN 
IDENTIFIED BY <span class="italic">password</span>;

keystore altered.</pre><p>If the database instance is configured using the <code class="codeph">EXTERNAL_KEYSTORE_CREDENTIAL_LOCATION</code> instance initialization parameter and has a keystore at that location containing&nbsp;the credentials of the password-protected keystore, and you want to switch over from using an auto-login keystore to using the password-protected keystore&nbsp;with these credentials, you must include the <code class="codeph">FORCE KEYSTORE</code> clause and the&nbsp;<code class="codeph">IDENTIFIED BY EXTERNAL STORE</code> clause&nbsp;in the <code class="codeph">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN</code> statement, as follows:
                              </p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN 
FORCE KEYSTORE 
IDENTIFIED BY EXTERNAL STORE;

keystore altered.</pre><p>If the <code class="codeph">WALLET_ROOT</code> parameter has been set, then Oracle Database finds the external store by searching in this path in the CDB root: <code class="codeph"><span class="codeinlineitalic">WALLET_ROOT</span>/tde_seps</code>. 
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Ensure that the PDB in which you want to open the keystore is in <code class="codeph">READ WRITE</code> mode. </span><div>For example:<pre class="oac_no_warn" dir="ltr">SHOW PDBS

CON_ID CON_NAME   OPEN MODE    RESTRICTED
------ ---------- ------------ -----------
2      PDB$SEED   READ ONLY    NO
3      CDB1_PDB1  READ WRITE   NO</pre><p>If any PDB has an <code class="codeph">OPEN MODE</code> value that is different from <code class="codeph">READ WRITE</code>, then run the following statement to open the PDB, which will set it to <code class="codeph">READ WRITE</code> mode:
                              </p><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE CDB1_PDB1 OPEN;</pre><p>Now the keystore can be opened in both the CDB root and the PDB. </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Connect to the PDB. </span></li>
                        <li class="stepexpand"><span>Run the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement to open the keystore.</span><div><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN 
IDENTIFIED BY <span class="italic">password</span>;
keystore altered.</pre><p>To switch over to opening the password-protected software keystore when an auto-login keystore is configured and is currently open, specify the <code class="codeph">FORCE KEYSTORE</code> clause as follows. 
                              </p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN 
FORCE KEYSTORE 
IDENTIFIED BY EXTERNAL STORE;
keystore altered.</pre><p><code class="codeph">FORCE KEYSTORE</code> is also useful for databases that are heavily loaded. The <code class="codeph">IDENTIFIED BY EXTERNAL STORE</code> clause is included in the statement because the keystore credentials exist in an external store. This enables the&nbsp;password-protected keystore to be opened without specifying the keystore&nbsp;password within the statement itself.
                              </p>
                              <p>If the <code class="codeph">WALLET_ROOT</code> parameter has been set, then Oracle Database finds the external store by searching in this path: <code class="codeph"><span class="codeinlineitalic">WALLET_ROOT</span>/<span class="codeinlineitalic">PDB_GUID</span>/tde_seps</code>. 
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Confirm that the keystore is open.</span><div><pre class="oac_no_warn" dir="ltr">SELECT STATUS FROM V$ENCRYPTION_WALLET;</pre></div>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="configuring-transparent-data-encryption.html#GUID-F3652F6F-B1B8-485A-BCBE-32C0875E93E5" title="A password-protected software keystore must be open before any TDE master encryption keys can be created or accessed in the keystore.">About Opening Software Keystores</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-2E40034B-4523-4D1C-9A2F-BCC3D58C570D" title="In united mode, the software keystore resides in the CDB root but the master keys from this keystore are available for the PDBs that have their keystore in united mode.">Configuring a Software Keystore for Use in United Mode</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-8A6CF613-F182-4249-ACAE-764C145E210B" name="GUID-8A6CF613-F182-4249-ACAE-764C145E210B"></a><h4 id="ASOAG-GUID-8A6CF613-F182-4249-ACAE-764C145E210B" class="sect4">Step 3: Set the TDE Master Encryption Key in the Software Keystore in United Mode</h4>
                  <div>
                     <p>To set the TDE master encryption key in the keystore when the PDB is configured in united mode, use the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement with the <code class="codeph">SET KEY</code> clause.
                     </p>
                     <ol>
                        <li class="stepexpand"><span>Log in to the CDB root or to the PDB that is configured for united mode as a user who has been granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege.</span></li>
                        <li class="stepexpand"><span>Ensure that the database is open in <code class="codeph">READ WRITE</code> mode.</span><div>To find the status, run the <code class="codeph">show pdbs</code> command.
                           </div>
                        </li>
                        <li class="stepexpand"><span>Run the <code class="codeph">ADMINISTER KEY MANAGEMENT SET ENCRYPTION KEY</code> statement to create or rekey the TDE master encryption key in the keystore.</span><div>For example, if the keystore is password-protected and open, and you want to create or rekey the TDE master encryption key in the current container:<pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEY 
IDENTIFIED BY <span class="italic">keystore_password</span> 
WITH BACKUP USING 'emp_key_backup';

keystore altered.</pre><p>If the keystore is closed:</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEY 
FORCE KEYSTORE
IDENTIFIED BY <span class="italic">keystore_password</span> 
WITH BACKUP USING 'emp_key_backup';

keystore altered.</pre><p>In this specification:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><code class="codeph">FORCE KEYSTORE</code> should be included if the keystore is closed. This automatically opens the keystore before setting the TDE master encryption key. The <code class="codeph">FORCE KEYSTORE</code> clause also switches over&nbsp;to opening the password-protected software keystore when an auto-login keystore is configured and is currently open.
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">IDENTIFIED BY</code> specifies the keystore password. Alternatively, if the keystore password is in an external store, you can use the <code class="codeph">IDENTIFIED BY EXTERNAL STORE</code> clause.
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Confirm that the TDE master encryption key is set. </span><div><pre class="oac_no_warn" dir="ltr">SELECT MASTERKEY_ACTIVATED FROM V$DATABASE_KEY_INFO;</pre><p>The output should be <code class="codeph">YES</code>.
                              </p>
                           </div>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="configuring-transparent-data-encryption.html#GUID-C44968C5-9B77-4D19-82F4-5705268BF429" title="The TDE master encryption key is stored in the keystore.">About Setting the Software Keystore TDE Master Encryption Key</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-2E40034B-4523-4D1C-9A2F-BCC3D58C570D" title="In united mode, the software keystore resides in the CDB root but the master keys from this keystore are available for the PDBs that have their keystore in united mode.">Configuring a Software Keystore for Use in United Mode</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-54A232F4-B303-40B1-B8A4-74FEB9B39239" name="GUID-54A232F4-B303-40B1-B8A4-74FEB9B39239"></a><h4 id="ASOAG-GUID-54A232F4-B303-40B1-B8A4-74FEB9B39239" class="sect4">Step 4: Encrypt Your Data in United Mode</h4>
                  <div>
                     <p>Now that you have completed the keystore configuration and the PDB is configured in united mode, you can begin to encrypt data in the PDB.</p>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="configuring-transparent-data-encryption.html#GUID-A0E2C279-10F6-48D9-AB92-C547529C06EE" title="You can use Transparent Data Encryption to encrypt individual columns in database tables.">Encrypting Columns in Tables</a></li>
                           <li><a href="configuring-transparent-data-encryption.html#GUID-1CA947A5-164A-4AA9-AD75-F7D9D4F6FFF8" title="You can perform encryption operations on both offline and online tablespaces and databases.">Encryption Conversions for Tablespaces and Databases</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-2E40034B-4523-4D1C-9A2F-BCC3D58C570D" title="In united mode, the software keystore resides in the CDB root but the master keys from this keystore are available for the PDBs that have their keystore in united mode.">Configuring a Software Keystore for Use in United Mode</a></p>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-540A5DBF-720E-49E5-9060-DF40D3D4F6B0" name="GUID-540A5DBF-720E-49E5-9060-DF40D3D4F6B0"></a><h3 id="ASOAG-GUID-540A5DBF-720E-49E5-9060-DF40D3D4F6B0" class="sect3">Configuring a Hardware Keystore in United Mode</h3>
               <div>
                  <p>In united mode, a hardware keystore resides in a hardware security module (HSM), which is designed to store encryption keys.</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-E4D90305-E42D-4A48-9883-0F085DE04688">About Configuring a Hardware Keystore in United Mode</a><br>You must create a hardware keystore in a PDB using isolated mode but you can perform other tasks in united mode. 
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-2E85D8BB-9798-46B4-9BEC-BD99737D32E8">Step 1: Configure the United Mode Hardware Security Module</a><br>To configure a third-party hardware security module, you must copy the PKCS#11 library to the correct location and follow your vendor's instructions
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-D028AC50-36FA-4AB4-AC19-4A26CE3C90C7">Step 2: Open the Hardware Keystore in a United Mode PDB</a><br>To open a hardware keystore in united mode, you must use the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement with the <code class="codeph">SET KEYSTORE OPEN</code> clause.
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-4C0941AC-C684-43D0-B3E7-25D168C98FFB">Step 3: Set the TDE Master Encryption Key in the Hardware Keystore in United Mode</a><br>To set the TDE master encryption key in the keystore when the PDB is configured in united mode, use the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement with the <code class="codeph">SET KEY</code> clause.
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#unique_615684953">Step 4: Encrypt Your Data in United Mode</a><br>Now that you have completed the keystore configuration and the PDB is configured in united mode, you can begin to encrypt data in the PDB.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-FA569DEC-6FF3-4CA1-86AA-D27F29EDCA3C" title="United mode enables you to create a common keystore for the CDB and the PDBs for which the keystore is in united mode.">Managing Keystores and TDE Master Encryption Keys in United Mode</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-E4D90305-E42D-4A48-9883-0F085DE04688" name="GUID-E4D90305-E42D-4A48-9883-0F085DE04688"></a><h4 id="ASOAG-GUID-E4D90305-E42D-4A48-9883-0F085DE04688" class="sect4">About Configuring a Hardware Keystore in United Mode</h4>
                  <div>
                     <p>You must create a hardware keystore in a PDB using isolated mode but you can perform other tasks in united mode. </p>
                     <p>To configure a hardware keystore for a PDB in isolated mode, you first must set the <code class="codeph">WALLET_ROOT</code> parameter. This is necessary for two reasons: first, to have support for migrating to a software keystore in the future, and second, because the configuration file for Oracle Key Vault is retrieved from a location under <code class="codeph">WALLET_ROOT</code>. Afterwards, you must set the <code class="codeph">KEYSTORE_CONFIGURATION</code> attribute of the <code class="codeph">TDE_CONFIGURATION</code>&nbsp;parameter to <code class="codeph">HSM</code> or <code class="codeph">OKV</code>, open the configured hardware keystore, and then set the TDE master encryption key for the PDB. After you complete these tasks, you can begin to encrypt data in the PDB.
                     </p>
                     <p>How you specify the <code class="codeph">IDENTIFIED BY</code> clause when you run the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement depends on the type of hardware keystore. For a hardware security module (<code class="codeph">HSM</code>), you use the following syntax: 
                     </p><pre class="oac_no_warn" dir="ltr">IDENTIFIED BY "<span class="italic">user_name</span>:<span class="italic">password</span>"</pre><p>For an Oracle Key Vault keystore, you can omit the <code class="codeph"><span class="codeinlineitalic">user_name</span></code> and colon (but keep the quotation marks):
                     </p><pre class="oac_no_warn" dir="ltr">IDENTIFIED BY "<span class="italic">password</span>"</pre></div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-540A5DBF-720E-49E5-9060-DF40D3D4F6B0" title="In united mode, a hardware keystore resides in a hardware security module (HSM), which is designed to store encryption keys.">Configuring a Hardware Keystore in United Mode</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-2E85D8BB-9798-46B4-9BEC-BD99737D32E8" name="GUID-2E85D8BB-9798-46B4-9BEC-BD99737D32E8"></a><h4 id="ASOAG-GUID-2E85D8BB-9798-46B4-9BEC-BD99737D32E8" class="sect4">Step 1: Configure the United Mode Hardware Security Module</h4>
                  <div>
                     <p>To configure a third-party hardware security module, you must copy the PKCS#11 library to the correct location and follow your vendor's instructions</p>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="configuring-transparent-data-encryption.html#GUID-7838C4B8-FF6A-4B81-86C1-8583D3555291" title="To configure a third-party hardware security module, you must copy the PKCS#11 library to the correct location and follow your vendor's instructions.">Step 2: Configure the Hardware Security Module</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-540A5DBF-720E-49E5-9060-DF40D3D4F6B0" title="In united mode, a hardware keystore resides in a hardware security module (HSM), which is designed to store encryption keys.">Configuring a Hardware Keystore in United Mode</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-D028AC50-36FA-4AB4-AC19-4A26CE3C90C7" name="GUID-D028AC50-36FA-4AB4-AC19-4A26CE3C90C7"></a><h4 id="ASOAG-GUID-D028AC50-36FA-4AB4-AC19-4A26CE3C90C7" class="sect4">Step 2: Open the Hardware Keystore in a United Mode PDB</h4>
                  <div>
                     <p>To open a hardware keystore in united mode, you must use the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement with the <code class="codeph">SET KEYSTORE OPEN</code> clause.
                     </p>
                     <ol>
                        <li class="stepexpand"><span>Log in to the CDB root as a common user who has been granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege.</span><div>For example:<pre class="oac_no_warn" dir="ltr">sqlplus c##sec_admin as syskm
Enter password: <span class="italic">password</span></pre></div>
                        </li>
                        <li class="stepexpand"><span>Open the keystore in the CDB root by using the following syntax. </span><div><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN 
IDENTIFIED BY "<span class="italic">hardware_keystore_credentials</span>";
</pre><p>The type of hardware keystore determines how you specify the hardware keystore password. For hardware security modules, you must use the <code class="codeph"><span class="codeinlineitalic">user_name</span>:<span class="codeinlineitalic">password</span></code> syntax. For example:
                              </p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN 
IDENTIFIED BY "psmith:<span class="italic">password</span>";

keystore altered.</pre><p>For an Oracle Key Vault keystore, you can only provide the password. No user name is allowed in the <code class="codeph">IDENTIFIED BY</code> clause. Enclose the password in double quotation marks.
                              </p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN 
IDENTIFIED BY "<span class="italic">password</span>";</pre></div>
                        </li>
                        <li class="stepexpand"><span>Ensure that the PDB in which you want to open the keystore is in <code class="codeph">READ WRITE</code> mode. </span><div>For example:<pre class="oac_no_warn" dir="ltr">SHOW PDBS

CON_ID CON_NAME   OPEN MODE    RESTRICTED
------ ---------- ------------ -----------
2      PDB$SEED   READ ONLY    NO
3      CDB1_PDB1  READ WRITE   NO</pre><p>If any PDB has an <code class="codeph">OPEN MODE</code> value that is different from <code class="codeph">READ WRITE</code>, then run the following statement to open the PDB, which will set it to <code class="codeph">READ WRITE</code> mode:
                              </p><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE CDB1_PDB1 OPEN;</pre><p>Now the keystore can be opened in both the CDB root and the PDB. </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Connect to the PDB and run the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement to open the keystore.</span><div>For example, for an HSM:<pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN 
IDENTIFIED BY "psmith:<span class="italic">password</span>";

keystore altered.</pre><p>You can include the <code class="codeph">FORCE KEYSTORE</code> clause if there is a chance that the CDB root keystore has been closed, or the database is heavily loaded. 
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Confirm that the keystore is open.</span><div><pre class="oac_no_warn" dir="ltr">SELECT STATUS FROM V$ENCRYPTION_WALLET;</pre></div>
                        </li>
                        <li class="stepexpand"><span>Repeat this procedure each time you restart the database instance. </span></li>
                     </ol>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="configuring-transparent-data-encryption.html#GUID-CEDB143A-BC7E-43EF-AD41-59BD0ED36421" title="You must open the hardware keystore so that it is accessible to the database before you can perform any encryption or decryption.">About Opening Hardware Keystores</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-540A5DBF-720E-49E5-9060-DF40D3D4F6B0" title="In united mode, a hardware keystore resides in a hardware security module (HSM), which is designed to store encryption keys.">Configuring a Hardware Keystore in United Mode</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-4C0941AC-C684-43D0-B3E7-25D168C98FFB" name="GUID-4C0941AC-C684-43D0-B3E7-25D168C98FFB"></a><h4 id="ASOAG-GUID-4C0941AC-C684-43D0-B3E7-25D168C98FFB" class="sect4">Step 3: Set the TDE Master Encryption Key in the Hardware Keystore in United Mode</h4>
                  <div>
                     <p>To set the TDE master encryption key in the keystore when the PDB is configured in united mode, use the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement with the <code class="codeph">SET KEY</code> clause.
                     </p>
                     <ol>
                        <li class="stepexpand"><span>Log in to the CDB root or to the PDB that is configured for united mode as a user who has been granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege.</span></li>
                        <li class="stepexpand"><span>Ensure that the database is open in <code class="codeph">READ WRITE</code> mode. </span><div>To find the status, run the <code class="codeph">SHOW PDBS</code> command.
                           </div>
                        </li>
                        <li class="stepexpand"><span>Run the <code class="codeph">ADMINISTER KEY MANAGEMENT SET ENCRYPTION KEY</code> statement to create or rekey the TDE master encryption key in the keystore.</span><div><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEY 
[USING TAG '<span class="italic">tag</span>'] 
[FORCE KEYSTORE] 
IDENTIFIED BY [EXTERNAL STORE | "<span class="italic">hardware_keystore_credentials</span>"];
</pre><p>In this specification:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><code class="codeph">FORCE KEYSTORE</code> temporarily opens the password-protected keystore for this operation. You must open the keystore for this operation. 
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph"><span class="codeinlineitalic">hardware_keystore_credentials</span></code> refers to the credentials for either an HSM or an Oracle Key Vault hardware keystore. For an HSM, specify the credentials using this format, enclosed in quotation marks and separating the components with a colon: <code class="codeph"><span class="codeinlineitalic">user_name</span>:<span class="codeinlineitalic">password</span></code>, with <code class="codeph"><span class="codeinlineitalic">user_name</span></code> being the user who created the HSM and password being this users password. For Oracle Key Vault, enter only the password of the user who created the keystore. Enclose this password with quotation marks.
                                    </p>
                                 </li>
                              </ul>
                              <p>For example:</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEY 
FORCE KEYSTORE 
IDENTIFIED BY "psmith:<span class="italic">password</span>";

keystore altered.</pre></div>
                        </li>
                        <li class="stepexpand"><span>Confirm that the TDE master encryption key is set. </span><div><pre class="oac_no_warn" dir="ltr">SELECT MASTERKEY_ACTIVATED FROM V$DATABASE_KEY_INFO;</pre><p>The output should be <code class="codeph">YES</code>.
                              </p>
                           </div>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="configuring-transparent-data-encryption.html#GUID-E3DC7C57-A8F3-41D5-98FB-1DBE6EE10D1E" title="You must create a TDE master encryption key that is stored inside the hardware keystore.">About Setting the Hardware Keystore TDE Master Encryption Key</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-540A5DBF-720E-49E5-9060-DF40D3D4F6B0" title="In united mode, a hardware keystore resides in a hardware security module (HSM), which is designed to store encryption keys.">Configuring a Hardware Keystore in United Mode</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="unique_615684953" name="unique_615684953"></a><h4 id="ASOAG-unique_615684953" class="sect4">Step 4: Encrypt Your Data in United Mode</h4>
                  <div>
                     <p>Now that you have completed the keystore configuration and the PDB is configured in united mode, you can begin to encrypt data in the PDB.</p>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="configuring-transparent-data-encryption.html#GUID-A0E2C279-10F6-48D9-AB92-C547529C06EE" title="You can use Transparent Data Encryption to encrypt individual columns in database tables.">Encrypting Columns in Tables</a></li>
                           <li><a href="configuring-transparent-data-encryption.html#GUID-1CA947A5-164A-4AA9-AD75-F7D9D4F6FFF8" title="You can perform encryption operations on both offline and online tablespaces and databases.">Encryption Conversions for Tablespaces and Databases</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-540A5DBF-720E-49E5-9060-DF40D3D4F6B0" title="In united mode, a hardware keystore resides in a hardware security module (HSM), which is designed to store encryption keys.">Configuring a Hardware Keystore in United Mode</a></p>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" name="GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D"></a><h3 id="ASOAG-GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" class="sect3">Administering Keystores and TDE Master Encryption Keys in United Mode</h3>
               <div>
                  <p>After you configure a keystore and master encryption key for use in united mode, you can perform tasks such as rekeying TDE master encryption keys. </p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-57805BD1-8E32-44A9-BAAB-38D4533DB40B">Changing the Keystore Password in United Mode</a><br>You can change the password of either a software keystore or a hardware keystores only in the CDB root. 
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-FFAEFC19-5D87-4881-BDC3-B4A186F65277">Backing Up a Password-Protected Software Keystore in United Mode</a><br>The <code class="codeph">BACKUP KEYSTORE</code> clause of the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement backs up a password-protected software keystore.
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-DB6BC556-AD06-424F-9363-B3DE365532DA">Closing Keystores in United Mode</a><br>You can close both software and hardware keystores in united mode, unless the system tablespace is encrypted. 
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-7579CA90-26F9-487B-BBF8-FCD3AE428CF4">Creating a User-Defined TDE Master Encryption Key in United Mode</a><br>To create a user-defined TDE master encryption key, use the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement with the <code class="codeph">SET | CREATE [ENCRYPTION] KEY</code> clause. 
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-04564072-A35F-477F-BAF3-8631ECB9D0B2">Example: Creating a Master Encryption Key in All PDBs</a><br>You can use the <code class="codeph">ADMINISTER KEY MANAGEMENT CREATE KEY USING TAG</code> statement to create a TDE master encryption key in all PDBs.
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-C5B51467-0D33-446D-B914-188E6A253294">Creating a TDE Master Encryption Key for Later Use in United Mode</a><br>A keystore must be opened before you can create a TDE master encryption key for use later on in united mode.
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-710DD047-FBF9-42D7-B6AE-1327A53EEAC4">Activating a TDE Master Encryption Key in United Mode</a><br>To activate a TDE master encryption key in united mode, you must open the keystore and use <code class="codeph">ADMINISTER KEY MANAGEMENT</code> with the <code class="codeph">USE KEY</code> clause.
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-21B30284-823A-4226-AD38-0B66F20663C5">Rekeying the TDE Master Encryption Key in United Mode</a><br>You can use the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement with the <code class="codeph">SET KEY</code> clause to rekey a TDE master encryption key.
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-5E343820-7195-49F2-816C-E20941BB18E4">Finding the TDE Master Encryption Key That Is in Use in United Mode</a><br>A TDE master encryption key that is in use is the key that was activated most recently for the database. 
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-49328939-4225-4870-ACB1-E930CA5586D8">Creating a Custom Attribute Tag in United Mode</a><br>To create a custom attribute tag in united mode, you must use the <code class="codeph">SET TAG</code> clause of the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement. 
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-CBB8C6CC-CF87-4E10-9170-938C7CE7483B">Moving a TDE Master Encryption Key into a New Keystore in United Mode</a><br>In united mode, you can move an existing TDE master encryption key into a new keystore from an existing software password keystore. 
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-4E19B1E4-E5EF-4E9E-A5F4-BB62702EE7D8">Automatically Removing Inactive TDE Master Encryption Keys in United Mode</a><br>In united mode, the <code class="codeph">REMOVE_INACTIVE_STANDBY_TDE_MASTER_KEY</code> initialization parameter can configure the automatic removal of inactive TDE master encryption keys.
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-732D3890-6A80-4541-8489-B26A08BCEC17">Isolating a Pluggable Database Keystore</a><br>Isolating a PDB keystore moves the master encryption key from the CDB root keystore into an isolated mode keystore in the a PDB.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-FA569DEC-6FF3-4CA1-86AA-D27F29EDCA3C" title="United mode enables you to create a common keystore for the CDB and the PDBs for which the keystore is in united mode.">Managing Keystores and TDE Master Encryption Keys in United Mode</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-57805BD1-8E32-44A9-BAAB-38D4533DB40B" name="GUID-57805BD1-8E32-44A9-BAAB-38D4533DB40B"></a><h4 id="ASOAG-GUID-57805BD1-8E32-44A9-BAAB-38D4533DB40B" class="sect4">Changing the Keystore Password in United Mode</h4>
                  <div>
                     <p>You can change the password of either a software keystore or a hardware keystores only in the CDB root. </p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-F70FF221-D5AC-4047-AEE8-4616F44B7191">Changing the Password-Protected Software Keystore Password in United Mode</a><br>To change the password of a password-protected software keystore in united mode, you must use the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement in the CDB root.
                        </li>
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-DC6F874E-812F-4663-BE47-9528C6023196">Changing the Password of a Hardware Keystore in United Mode</a><br>To change the password of a hardware keystore, you must close the hardware keystore and then change the password from the hardware keystore management interface.
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="After you configure a keystore and master encryption key for use in united mode, you can perform tasks such as rekeying TDE master encryption keys.">Administering Keystores and TDE Master Encryption Keys in United Mode</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="props_rev_3"><a id="GUID-F70FF221-D5AC-4047-AEE8-4616F44B7191" name="GUID-F70FF221-D5AC-4047-AEE8-4616F44B7191"></a><h5 id="ASOAG-GUID-F70FF221-D5AC-4047-AEE8-4616F44B7191" class="sect5">Changing the Password-Protected Software Keystore Password in United Mode</h5>
                     <div>
                        <p>To change the password of a password-protected software keystore in united mode, you must use the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement in the CDB root.
                        </p>
                        <div class="section">You cannot change keystore passwords from a united mode PDB.</div>
                        <!-- class="section" -->
                        <div class="section">
                           <ol>
                              <li>
                                 <p>Log in to the CDB root as a user who has been granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege.
                                 </p>
                              </li>
                              <li>
                                 <p>Use the following syntax to change the password for the keystore: </p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT ALTER KEYSTORE PASSWORD 
[FORCE KEYSTORE] 
IDENTIFIED BY
<span class="italic">old_keystore_password</span> SET <span class="italic">new_keystore_password</span> 
[WITH BACKUP [USING '<span class="italic">backup_identifier</span>']];
</pre><p>In this specification:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p><code class="codeph">FORCE KEYSTORE</code> temporarily opens the password-protected keystore for this operation if the keystore is closed if an auto-login keystore is configured and is currently open, or if a password-protected keystore is configured and is currently closed. 
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">old_password</code></span> is the current keystore password that you want to change.
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">new_password</code></span> is the new password that you set for the keystore.
                                       </p>
                                    </li>
                                    <li>
                                       <p>You do not need to include the <code class="codeph">CONTAINER</code> clause because the password can only be changed locally, in the CDB root.
                                       </p>
                                    </li>
                                 </ul>
                                 <p>The following example creates a backup of the keystore and then changes the password:</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT ALTER KEYSTORE PASSWORD 
IDENTIFIED BY
<span class="italic">old_password</span> SET <span class="italic">new_password</span> 
WITH BACKUP USING 'pwd_change';

keystore altered.</pre><p>This example performs the same operation but uses the <code class="codeph">FORCE KEYSTORE</code> clause in case the auto-login software keystore is in use or the password-protected software keystore is closed.
                                 </p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT ALTER KEYSTORE PASSWORD
FORCE KEYSTORE 
IDENTIFIED BY
<span class="italic">old_password</span> SET <span class="italic">new_password</span> 
WITH BACKUP USING 'pwd_change';

keystore altered.</pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>Related Topics</strong></p>
                           <ul>
                              <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-AB8F896D-A068-47AC-AA26-DDA52BFE5699" title="Many ADMINISTER KEY MANAGEMENT operations require access to a keystore password, for both software and hardware keystores.">Performing Operations That Require a Keystore Password</a></li>
                              <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-56595198-9FD2-4857-9BB9-D908BA89904C" title="Oracle Database enables you to easily change password-protected software keystore passwords.">Changing the Password of a Software Keystore</a></li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-57805BD1-8E32-44A9-BAAB-38D4533DB40B" title="You can change the password of either a software keystore or a hardware keystores only in the CDB root.">Changing the Keystore Password in United Mode</a></p>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="props_rev_3"><a id="GUID-DC6F874E-812F-4663-BE47-9528C6023196" name="GUID-DC6F874E-812F-4663-BE47-9528C6023196"></a><h5 id="ASOAG-GUID-DC6F874E-812F-4663-BE47-9528C6023196" class="sect5">Changing the Password of a Hardware Keystore in United Mode</h5>
                     <div>
                        <p>To change the password of a hardware keystore, you must close the hardware keystore and then change the password from the hardware keystore management interface.</p>
                        <div class="section">You cannot change keystore passwords from a united mode PDB.</div>
                        <!-- class="section" -->
                        <div class="section">
                           <ol>
                              <li>
                                 <p>Log in to the CDB root as a user who has been granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege.
                                 </p>
                              </li>
                              <li>
                                 <p>Close the hardware keystore.</p>
                                 <p>For example, for an HSM:</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE CLOSE 
IDENTIFIED BY "psmith:<span class="italic">password</span>";
</pre><p>For a keystore whose password is stored externally:</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE CLOSE 
IDENTIFIED BY EXTERNAL STORE;</pre></li>
                              <li>
                                 <p>From the hardware security module management interface, create a new hardware security module password. </p>
                              </li>
                              <li>
                                 <p>Update the credentials of the HSM in the external store to use "<code class="codeph"><span class="codeinlineitalic">user_name</span>:<span class="codeinlineitalic">password</span>"</code>. 
                                 </p>
                                 <p>Currently, the external store contains the old HSM credentials, which would no longer work.</p>
                                 <p>For example:</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT
UPDATE SECRET '<span class="italic">user_name</span>:<span class="italic">password</span>' 
FOR CLIENT 'TDE_WALLET' 
TO LOCAL AUTO_LOGIN KEYSTORE '/etc/ORACLE/WALLETS/orcl/external_store';</pre></li>
                              <li>
                                 <p>In SQL*Plus, open the hardware keystore.</p>
                                 <p>For example, for an HSM: </p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN 
IDENTIFIED BY "psmith:<span class="italic">new_password</span>";
</pre><p>For a hardware keystore whose password is stored externally:</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN 
IDENTIFIED BY EXTERNAL STORE;</pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>Related Topics</strong></p>
                           <ul>
                              <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-AB8F896D-A068-47AC-AA26-DDA52BFE5699" title="Many ADMINISTER KEY MANAGEMENT operations require access to a keystore password, for both software and hardware keystores.">Performing Operations That Require a Keystore Password</a></li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-57805BD1-8E32-44A9-BAAB-38D4533DB40B" title="You can change the password of either a software keystore or a hardware keystores only in the CDB root.">Changing the Keystore Password in United Mode</a></p>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-FFAEFC19-5D87-4881-BDC3-B4A186F65277" name="GUID-FFAEFC19-5D87-4881-BDC3-B4A186F65277"></a><h4 id="ASOAG-GUID-FFAEFC19-5D87-4881-BDC3-B4A186F65277" class="sect4">Backing Up a Password-Protected Software Keystore in United Mode</h4>
                  <div>
                     <p>The <code class="codeph">BACKUP KEYSTORE</code> clause of the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement backs up a password-protected software keystore.
                     </p>
                     <div class="section">
                        <ol>
                           <li>
                              <p>Log in to the CDB root as a user who has been granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege.
                              </p>
                              <p>For example: </p><pre class="oac_no_warn" dir="ltr">sqlplus c##sec_admin@hrpdb as syskm
Enter password: <span class="italic">password</span>
Connected.
</pre></li>
                           <li>
                              <p>Back up the keystore by using the following syntax:</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT BACKUP KEYSTORE 
[USING '<span class="italic">backup_identifier</span>'] 
[FORCE KEYSTORE] 
IDENTIFIED BY [EXTERNAL STORE | <span class="italic">software_keystore_password</span>] 
[TO '<span class="italic">keystore_location</span>'];
</pre><p>In this specification:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><code class="codeph">USING</code> <span class="italic"><code class="codeph">backup_identifier</code></span> is an optional string that you can provide to identify the backup. Enclose this identifier in single quotation marks (<code class="codeph">'&nbsp;'</code>). This identifier is appended to the named keystore file (for example, <code class="codeph">ewallet_</code><span class="italic"><code class="codeph">time-stamp</code></span><code class="codeph">_emp_key_backup.p12</code>).
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">FORCE KEYSTORE</code> temporarily opens the password-protected keystore for this operation. You must open the keystore for this operation. 
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">IDENTIFIED BY</code> is required for the <code class="codeph">BACKUP KEYSTORE</code> operation on a password-protected keystore because although the backup is simply a copy of the existing keystore, the status of the TDE master encryption key in the password-protected keystore must be set to <code class="codeph">BACKED UP</code> and for this change the keystore password is required.
                                    </p>
                                 </li>
                                 <li>
                                    <p><span class="italic"><code class="codeph">keystore_location</code></span> is the path at which the backup keystore is stored. This setting is restricted to the PDB when the PDB lockdown profile <code class="codeph">EXTERNAL_FILE_ACCESS</code> setting is blocked in the PDB or when the <code class="codeph">PATH_PREFIX</code> variable was not set when the PDB was created. If you do not specify the <span class="italic"><code class="codeph">keystore_location</code></span>, then the backup is created in the same directory as the original keystore. Enclose this location in single quotation marks (<code class="codeph">' '</code>).
                                    </p>
                                 </li>
                                 <li>
                                    <p>You do not need to include the <code class="codeph">CONTAINER</code> clause because the keystore can only be backup up locally, in the CDB root.
                                    </p>
                                 </li>
                              </ul>
                              <p>The following example backs up a software keystore in the same location as the source keystore. </p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT BACKUP KEYSTORE 
USING 'hr.emp_keystore' 
FORCE KEYSTORE 
IDENTIFIED BY 
<span class="italic">software_keystore_password</span> ;

keystore altered.
</pre><p>In the following version, the password for the keystore is external, so the <code class="codeph">EXTERNAL STORE</code> clause is used.
                              </p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT BACKUP KEYSTORE 
USING 'hr.emp_keystore' 
FORCE KEYSTORE 
IDENTIFIED BY EXTERNAL STORE;</pre><p>After you run this statement, an <code class="codeph">ewallet_</code><span class="italic"><code class="codeph">identifier</code></span><code class="codeph">.p12</code> file (for example, <code class="codeph">ewallet_</code><span class="italic"><code class="codeph">time-stamp</code></span><code class="codeph">_hr.emp_keystore.p12</code>) appears in the keystore backup location.
                              </p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-43BBC184-F801-45A9-B4D0-BB7E9767AED0" title="When you back up a password-protected software keystore, you can create a backup identifier string to describe the backup type.">Backing Up Password-Protected Software Keystores</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="After you configure a keystore and master encryption key for use in united mode, you can perform tasks such as rekeying TDE master encryption keys.">Administering Keystores and TDE Master Encryption Keys in United Mode</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-DB6BC556-AD06-424F-9363-B3DE365532DA" name="GUID-DB6BC556-AD06-424F-9363-B3DE365532DA"></a><h4 id="ASOAG-GUID-DB6BC556-AD06-424F-9363-B3DE365532DA" class="sect4">Closing Keystores in United Mode</h4>
                  <div>
                     <p>You can close both software and hardware keystores in united mode, unless the system tablespace is encrypted. </p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-E63A31C2-E4E6-4C7E-8309-DEADDFFFA07F">Closing a Software Keystore in United Mode</a><br>You can close password-protected keystores, auto-login keystores, and local auto-login software keystores in united mode. 
                        </li>
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-CE1BC7D4-0942-46EF-A312-1066BB11CA0F">Closing a Hardware Keystore in United Mode</a><br>To close a hardware keystore, you must use the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement with the <code class="codeph">SET KEYSTORE CLOSE</code> clause.
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="After you configure a keystore and master encryption key for use in united mode, you can perform tasks such as rekeying TDE master encryption keys.">Administering Keystores and TDE Master Encryption Keys in United Mode</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="sect4"><a id="GUID-E63A31C2-E4E6-4C7E-8309-DEADDFFFA07F" name="GUID-E63A31C2-E4E6-4C7E-8309-DEADDFFFA07F"></a><h5 id="ASOAG-GUID-E63A31C2-E4E6-4C7E-8309-DEADDFFFA07F" class="sect5">Closing a Software Keystore in United Mode</h5>
                     <div>
                        <p>You can close password-protected keystores, auto-login keystores, and local auto-login software keystores in united mode. </p>
                        <div class="section">In the case of an auto-login keystore, which opens automatically when it is accessed, you must first move it to a new location where it cannot&nbsp;be automatically opened, then you must manually close it. You must do this if you are changing your configuration from an auto-login keystore to a password-protected keystore: you change the configuration to stop using the auto-login keystore (by moving the auto-login keystore to another location where&nbsp;it cannot be automatically opened), and then closing the auto-login keystore.</div>
                        <!-- class="section" -->
                        <ol>
                           <li><span>Log in to the CDB root or the united mode PDB as a user who has been granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege.</span></li>
                           <li><span>Close the software keystore.</span><ul>
                                 <li>For a password-protected software keystore, use the following syntax if you are in the CDB root: <pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET | FORCE KEYSTORE CLOSE 
[IDENTIFIED BY [EXTERNAL STORE | <span class="italic">software_keystore_password</span>]]
[CONTAINER = ALL | CURRENT];</pre><p>Use the <code class="codeph">SET</code> clause to close the keystore without force. If there is a dependent keystore that is open (for example, an isolated mode PDB keystore and you are trying to close the CDB root keystore), then an <code class="codeph">ORA-46692 cannot close wallet</code> error appears. If this happens, then use the <code class="codeph">FORCE</code> clause instead of <code class="codeph">SET</code> to temporarily close the dependent keystore during the close operation. The <code class="codeph">STATUS</code> column of the <code class="codeph">V$ENCRYPTION_WALLET</code> view shows if a keystore is open. 
                                    </p>
                                    <p>If you are in the united mode PDB, then either omit the <code class="codeph">CONTAINER</code> clause or set it to <code class="codeph">CURRENT</code>.
                                    </p>
                                 </li>
                                 <li>For an auto-login or local auto-login software keystore, use this syntax if you are in the CDB root: <pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE CLOSE
[CONTAINER =  ALL | CURRENT];</pre></li>
                              </ul>
                           </li>
                        </ol>
                        <div class="section">Closing a keystore disables all of the encryption and decryption operations. Any attempt to encrypt or decrypt data or access encrypted data results in an error.</div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>Related Topics</strong></p>
                           <ul>
                              <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-9777F9A7-EDB8-40DB-B7D8-FAC2FDFFBEB4" title="After you open a keystore, it remains open until you shut down the database instance.">About Closing Keystores</a></li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-DB6BC556-AD06-424F-9363-B3DE365532DA" title="You can close both software and hardware keystores in united mode, unless the system tablespace is encrypted.">Closing Keystores in United Mode</a></p>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-CE1BC7D4-0942-46EF-A312-1066BB11CA0F" name="GUID-CE1BC7D4-0942-46EF-A312-1066BB11CA0F"></a><h5 id="ASOAG-GUID-CE1BC7D4-0942-46EF-A312-1066BB11CA0F" class="sect5">Closing a Hardware Keystore in United Mode</h5>
                     <div>
                        <p>To close a hardware keystore, you must use the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement with the <code class="codeph">SET KEYSTORE CLOSE</code> clause.
                        </p>
                        <ol>
                           <li class="stepexpand"><span>Log in to the CDB root or the united mode PDB as a user who has been granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege.</span></li>
                           <li class="stepexpand"><span>Close the hardware keystore by using the following syntax:</span><div><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE CLOSE 
IDENTIFIED BY [EXTERNAL STORE | "<span class="italic">hardware_keystore_credentials</span>"]
[CONTAINER = ALL | CURRENT];</pre><p>For example, for an HSM:</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE CLOSE 
IDENTIFIED BY "psmith:<span class="italic">password</span>"
CONTAINER = ALL;</pre></div>
                              <div>If an <code class="codeph">ORA-46692 cannot close wallet</code> error appears, then check if any isolated mode keystores are open. To find the status of a keystore, query the <code class="codeph">STATUS</code> column of the <code class="codeph">V$ENCRYPTION_WALLET</code> view.
                              </div>
                           </li>
                        </ol>
                        <div class="section">Closing a keystore disables all of the encryption and decryption operations. Any attempt to encrypt or decrypt data or access encrypted data results in an error.</div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>Related Topics</strong></p>
                           <ul>
                              <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-9777F9A7-EDB8-40DB-B7D8-FAC2FDFFBEB4" title="After you open a keystore, it remains open until you shut down the database instance.">About Closing Keystores</a></li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-DB6BC556-AD06-424F-9363-B3DE365532DA" title="You can close both software and hardware keystores in united mode, unless the system tablespace is encrypted.">Closing Keystores in United Mode</a></p>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-7579CA90-26F9-487B-BBF8-FCD3AE428CF4" name="GUID-7579CA90-26F9-487B-BBF8-FCD3AE428CF4"></a><h4 id="ASOAG-GUID-7579CA90-26F9-487B-BBF8-FCD3AE428CF4" class="sect4">Creating a User-Defined TDE Master Encryption Key in United Mode</h4>
                  <div>
                     <p>To create a user-defined TDE master encryption key, use the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement with the <code class="codeph">SET | CREATE [ENCRYPTION] KEY</code> clause. 
                     </p>
                     <ol>
                        <li class="stepexpand"><span>Log in to the CDB root a user who has been granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege.</span><div>For example:<pre class="oac_no_warn" dir="ltr">sqlplus c##sec_admin as syskm
Enter password: <span class="italic">password</span></pre></div>
                        </li>
                        <li class="stepexpand"><span>Create the user-defined TDE master encryption key by using the following syntax:</span><div><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET | CREATE [ENCRYPTION] KEY
'<span class="italic">mkid</span>:<span class="italic">mk</span> | <span class="italic">mk</span>' 
[USING ALGORITHM '<span class="italic">algorithm</span>'] 
[FORCE KEYSTORE]
[USING TAG '<span class="italic">tag_name</span>']
IDENTIFIED BY [EXTERNAL STORE | <span class="italic">keystore_password</span>] 
[WITH BACKUP [USING '<span class="italic">backup_identifier</span>']]
[CONTAINER = CURRENT];</pre><p>In this specification: </p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><code class="codeph">SET | CREATE</code> : Enter <code class="codeph">SET</code> if you want to create the master and activate the TDE master encryption key now, or enter <code class="codeph">CREATE</code> if you want to create the key for later use, without activating it yet. 
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph"><span class="codeinlineitalic">mkid</span></code> and <code class="codeph"><span class="codeinlineitalic">mk</span></code>: 
                                    </p>
                                    <ul style="list-style-type: disc;">
                                       <li>
                                          <p><code class="codeph"><span class="codeinlineitalic">mkid</span></code>, the TDE master encryption key ID, is a 16&#x2013;byte hex-encoded value that you can specify or have Oracle Database generate. 
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph"><span class="codeinlineitalic">mk</span></code>, the TDE master encryption key, is a hex-encoded value that you can specify or have Oracle Database generate, either 32 bytes (for the for <code class="codeph">AES256</code>, <code class="codeph">ARIA256</code>, and <code class="codeph">GOST256</code> algorithms) or 16 bytes (for the <code class="codeph">SEED128</code> algorithm). 
                                          </p>
                                       </li>
                                    </ul>
                                    <p>If you omit the <code class="codeph"><span class="codeinlineitalic">mkid</span></code> value but include the <code class="codeph"><span class="codeinlineitalic">mk</span></code>, then Oracle Database generates the <code class="codeph"><span class="codeinlineitalic">mkid</span></code> for the <code class="codeph"><span class="codeinlineitalic">mk</span></code>. 
                                    </p>
                                    <p>If you omit the entire <code class="codeph"><span class="codeinlineitalic">mkid</span>:<span class="codeinlineitalic">mk</span>|<span class="codeinlineitalic">mkid</span></code> clause, then Oracle Database generates these values for you. 
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">USING ALGORITHM</code>: Specify one of the following supported algorithms:
                                    </p>
                                    <ul style="list-style-type: disc;">
                                       <li>
                                          <p><code class="codeph">AES256</code></p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">ARIA256</code> 
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">SEED128</code></p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">GOST256</code></p>
                                       </li>
                                    </ul>
                                    <p>If you omit the algorithm, then the default, <code class="codeph">AES256</code>, is used. 
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">FORCE KEYSTORE</code> temporarily opens the password-protected keystore for this operation. You must open the keystore for this operation. 
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">CONTAINER</code>: If you include this clause, then set it to <code class="codeph">CURRENT</code>. (<code class="codeph">CURRENT</code> is the default.) 
                                    </p>
                                 </li>
                              </ul>
                              <p>The following example includes a user-created TDE master encryption key but no TDE master encryption key ID, so that the TDE master encryption key is generated:</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET ENCRYPTION KEY 
'3D432109DF88967A541967062A6F4E460E892318E307F017BA048707B402493C' 
USING ALGORITHM 'GOST256'
FORCE KEYSTORE
IDENTIFIED BY <span class="italic">keystore_password</span>;</pre><p>The next example creates user-defined keys for both the master encryption ID and the TDE master encryption key. It omits the algorithm specification, so the default algorithm <code class="codeph">AES256</code> is used.
                              </p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT CREATE ENCRYPTION KEY 
'10203040506070801112131415161718:3D432109DF88967A541967062A6F4E460E892318E307F017BA048707B402493C' 
IDENTIFIED BY <span class="italic">keystore_password</span>
CONTAINER = CURRENT;</pre></div>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="introduction-to-transparent-data-encryption.html#GUID-AAE3C965-C6A8-45D6-BA5D-F88B300A301A" title="By default, Transparent Data Encryption (TDE) Column encryption uses the Advanced Encryption Standard (AES).">Supported Encryption and Integrity Algorithms</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="After you configure a keystore and master encryption key for use in united mode, you can perform tasks such as rekeying TDE master encryption keys.">Administering Keystores and TDE Master Encryption Keys in United Mode</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-04564072-A35F-477F-BAF3-8631ECB9D0B2" name="GUID-04564072-A35F-477F-BAF3-8631ECB9D0B2"></a><h4 id="ASOAG-GUID-04564072-A35F-477F-BAF3-8631ECB9D0B2" class="sect4">Example: Creating a Master Encryption Key in All PDBs</h4>
                  <div>
                     <p>You can use the <code class="codeph">ADMINISTER KEY MANAGEMENT CREATE KEY USING TAG</code> statement to create a TDE master encryption key in all PDBs.
                     </p>
                     <p><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-04564072-A35F-477F-BAF3-8631ECB9D0B2__CIHDJAEA">Example 5-1</a> shows how to create a master encryption key in all of the PDBs in a multitenant environment. It uses the <code class="codeph">FORCE KEYSTORE</code> clause in the event that the auto-login keystore in the CDB root is open. The password is stored externally, so the <code class="codeph">EXTERNAL STORE</code> setting is used for the <code class="codeph">IDENTIFIED BY</code> clause. After you execute this statement, a master encryption key is created in each PDB. You can find the identifiers for these keys as follows: 
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Log in to the PDB and then query the <code class="codeph">TAG</code> column of the <code class="codeph">V$ENCRYPTION_KEYS</code> view.
                           </p>
                        </li>
                        <li>
                           <p>Log in to the CDB root and then query the <code class="codeph">INST_ID</code> and <code class="codeph">TAG</code> columns of the <code class="codeph">GV$ENCRYPTION_KEYS</code> view.
                           </p>
                        </li>
                     </ul>
                     <p>You also can check the <code class="codeph">CREATION_TIME</code> column of these views to find the most recently created key, which would be the key that you created from this statement. After you create the keys, you can individually activate the keys in each of the PDBs.
                     </p>
                     <div class="example" id="GUID-04564072-A35F-477F-BAF3-8631ECB9D0B2__CIHDJAEA">
                        <p class="titleinexample">Example 5-1 Creating a Master Encryption Key in All of the PDBs</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT CREATE KEY USING TAG 
'scope:all pdbs;description:Create Key for ALL PDBS' 
FORCE KEYSTORE IDENTIFIED BY EXTERNAL STORE 
WITH BACKUP
CONTAINER = ALL;
 
keystore altered.
</pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="After you configure a keystore and master encryption key for use in united mode, you can perform tasks such as rekeying TDE master encryption keys.">Administering Keystores and TDE Master Encryption Keys in United Mode</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-C5B51467-0D33-446D-B914-188E6A253294" name="GUID-C5B51467-0D33-446D-B914-188E6A253294"></a><h4 id="ASOAG-GUID-C5B51467-0D33-446D-B914-188E6A253294" class="sect4">Creating a TDE Master Encryption Key for Later Use in United Mode</h4>
                  <div>
                     <p>A keystore must be opened before you can create a TDE master encryption key for use later on in united mode.</p>
                     <ol>
                        <li class="stepexpand"><span>Log in to the CDB root or the united mode PDB as a user who has been granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege.</span></li>
                        <li class="stepexpand"><span>Create the TDE master encryption key by using the following syntax:</span><div><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT CREATE [ENCRYPTION] KEY 
[FORCE KEYSTORE]
[USING TAG '<span class="italic">tag_name</span>']
IDENTIFIED BY [EXTERNAL STORE | <span class="italic">keystore_password</span>] 
[WITH BACKUP [USING '<span class="italic">backup_identifier</span>']]
[CONTAINER = ALL | CURRENT];
</pre><p>In this specification: </p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><code class="codeph">FORCE KEYSTORE</code> temporarily opens the password-protected keystore for this operation. You must open the keystore for this operation. 
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">CONTAINER</code>: In the CDB root, set <code class="codeph">CONTAINER</code> to either <code class="codeph">ALL</code> or <code class="codeph">CURRENT</code>. In a PDB, set it to <code class="codeph">CURRENT</code>. In both cases, omitting <code class="codeph">CONTAINER</code> defaults to <code class="codeph">CURRENT</code>. 
                                    </p>
                                    <p></p>
                                 </li>
                              </ul>
                              <p>For example:</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT CREATE KEY 
FORCE KEYSTORE 
IDENTIFIED BY <span class="italic">keystore_password</span>
WITH BACKUP
CONTAINER = CURRENT;</pre></div>
                        </li>
                        <li class="stepexpand"><span>If necessary, activate the TDE master encryption key.</span><ol type="a">
                              <li class="substepexpand"><span>Find the key ID.</span><div><pre class="oac_no_warn" dir="ltr">SELECT KEY_ID FROM V$ENCRYPTION_KEYS; 

KEY_ID
----------------------------------------------------
AWsHwVYC2U+Nv3RVphn/yAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</pre></div>
                              </li>
                              <li class="substepexpand"><span>Use this key ID to activate the key. </span><div><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT USE KEY 
'AWsHwVYC2U+Nv3RVphn/yAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' 
USING TAG 'quarter:second;description:Activate Key on standby' 
IDENTIFIED BY <span class="italic">password</span> 
WITH BACKUP;</pre></div>
                              </li>
                           </ol>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-EA686044-5B10-4F70-88F2-B45BF1DD1E55" title="You can create a TDE master encryption key that can be activated at a later date.">Creating TDE Master Encryption Keys for Later Use</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="After you configure a keystore and master encryption key for use in united mode, you can perform tasks such as rekeying TDE master encryption keys.">Administering Keystores and TDE Master Encryption Keys in United Mode</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-710DD047-FBF9-42D7-B6AE-1327A53EEAC4" name="GUID-710DD047-FBF9-42D7-B6AE-1327A53EEAC4"></a><h4 id="ASOAG-GUID-710DD047-FBF9-42D7-B6AE-1327A53EEAC4" class="sect4">Activating a TDE Master Encryption Key in United Mode</h4>
                  <div>
                     <p>To activate a TDE master encryption key in united mode, you must open the keystore and use <code class="codeph">ADMINISTER KEY MANAGEMENT</code> with the <code class="codeph">USE KEY</code> clause.
                     </p>
                     <div class="section">
                        <ol>
                           <li>
                              <p>Log in to the CDB root or the united mode PDB as a user who has been granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege.
                              </p>
                           </li>
                           <li>
                              <p>Query the <code class="codeph">ORIGIN</code> and <code class="codeph">KEY_ID</code> columns of the <code class="codeph">V$ENCRYPTION_KEYS</code> view to find the key identifier. 
                              </p>
                              <p>For example: </p><pre class="oac_no_warn" dir="ltr">SELECT ORIGIN, KEY_ID FROM V$ENCRYPTION_KEYS; 

ORIGIN  KEY_ID
------  ----------------------------------------------
LOCAL   ARaHD762tUkkvyLgPzAi6hMAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
</pre></li>
                           <li>
                              <p>Use this key identifier to activate the TDE master encryption key by using the following syntax: </p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT USE KEY '<span class="italic">key_identifier_from_V$ENCRYPTION_KEYS</span>' 
[USING TAG '<span class="italic">tag</span>'] 
[FORCE KEYSTORE] 
IDENTIFIED BY [EXTERNAL STORE | <span class="italic">keystore_password</span>] 
WITH BACKUP [USING '<span class="italic">backup_identifier</span>']
[CONTAINER = ALL | CURRENT];
</pre><p>In this specification: </p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><code class="codeph">FORCE KEYSTORE</code> temporarily opens the password-protected keystore for this operation. You must open the keystore for this operation. 
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">CONTAINER</code>: In the CDB root, set <code class="codeph">CONTAINER</code> to either <code class="codeph">ALL</code> or <code class="codeph">CURRENT</code>. In a PDB, omit the <code class="codeph">CONTAINER</code> clause. In both cases, omitting <code class="codeph">CONTAINER</code> defaults to <code class="codeph">CURRENT</code>. 
                                    </p>
                                 </li>
                              </ul>
                              <p>For example:</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT USE KEY 'ARaHD762tUkkvyLgPzAi6hMAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' 
FORCE KEYSTORE 
IDENTIFIED BY EXTERNAL STORE
WITH BACKUP
CONTAINER = ALL;</pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-0B645D42-A7FE-4199-9A88-AFD416F1ECF1" title="You can activate a previously created or imported TDE master encryption key by using the USE KEY clause of ADMINSTER KEY MANAGEMENT.">About Activating TDE Master Encryption Keys</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="After you configure a keystore and master encryption key for use in united mode, you can perform tasks such as rekeying TDE master encryption keys.">Administering Keystores and TDE Master Encryption Keys in United Mode</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-21B30284-823A-4226-AD38-0B66F20663C5" name="GUID-21B30284-823A-4226-AD38-0B66F20663C5"></a><h4 id="ASOAG-GUID-21B30284-823A-4226-AD38-0B66F20663C5" class="sect4">Rekeying the TDE Master Encryption Key in United Mode</h4>
                  <div>
                     <p>You can use the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement with the <code class="codeph">SET KEY</code> clause to rekey a TDE master encryption key.
                     </p>
                     <div class="section">
                        <ol>
                           <li>
                              <p>Log in to the CDB root or the united mode PDB as a user who has been granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege.
                              </p>
                           </li>
                           <li>
                              <p>If you are rekeying the TDE master encryption key for a keystore that has auto login enabled, then ensure that both the auto login keystore, identified by the <code class="codeph">.sso</code> file, and the encryption keystore, identified by the <code class="codeph">.p12</code> file, are present.
                              </p>
                              <p>You can find the location of these files by querying the <code class="codeph">WRL_PARAMETER</code> column of the <code class="codeph">V$ENCRYPTION_WALLET</code> view. To find the <code class="codeph">WRL_PARAMETER</code> values for all of the database instances, query the <code class="codeph">GV$ENCRYPTION_WALLET</code> view.
                              </p>
                           </li>
                           <li>
                              <p>Rekey the TDE master encryption key by using the following syntax: </p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET [ENCRYPTION] KEY 
[FORCE KEYSTORE]
[USING TAG '<span class="italic">tag_name</span>'] 
IDENTIFIED BY [EXTERNAL STORE | <span class="italic">keystore_password</span>] 
[WITH BACKUP [USING '<span class="italic">backup_identifier</span>']]
[CONTAINER = ALL | CURRENT];
</pre><p>In this specification:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><span class="italic"><code class="codeph">tag</code></span> is the associated attributes and information that you define. Enclose this setting in single quotation marks (<code class="codeph">' '</code>).
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">FORCE KEYSTORE</code> temporarily opens the password-protected keystore for this operation. You must open the keystore for this operation. 
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">IDENTIFIED BY</code> can be one of the following settings:
                                    </p>
                                    <ul style="list-style-type: disc;">
                                       <li>
                                          <p><code class="codeph">EXTERNAL STORE</code> uses the keystore password stored in the external store to perform the keystore operation.
                                          </p>
                                       </li>
                                       <li>
                                          <p><span class="italic"><code class="codeph">keystore_password</code></span> is the password that was created for this keystore. 
                                          </p>
                                       </li>
                                    </ul>
                                 </li>
                                 <li>
                                    <p><code class="codeph">CONTAINER</code>: In the CDB root, set <code class="codeph">CONTAINER</code> to either <code class="codeph">ALL</code> or <code class="codeph">CURRENT</code>. In a PDB, set it to <code class="codeph">CURRENT</code>. In both cases, omitting <code class="codeph">CONTAINER</code> defaults to <code class="codeph">CURRENT</code>. 
                                    </p>
                                 </li>
                              </ul>
                              <p>For example:</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEY 
FORCE KEYSTORE 
IDENTIFIED BY <span class="italic">keystore_password</span> 
WITH BACKUP USING 'emp_key_backup'
CONTAINER = CURRENT;

keystore altered.
</pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-B788CBF7-DB54-48D4-AB32-7AA06289153B" title="Oracle Database uses a unified TDE Master Encryption Key for both TDE column encryption and TDE tablespace encryption.">About Rekeying the TDE Master Encryption Key</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="After you configure a keystore and master encryption key for use in united mode, you can perform tasks such as rekeying TDE master encryption keys.">Administering Keystores and TDE Master Encryption Keys in United Mode</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-5E343820-7195-49F2-816C-E20941BB18E4" name="GUID-5E343820-7195-49F2-816C-E20941BB18E4"></a><h4 id="ASOAG-GUID-5E343820-7195-49F2-816C-E20941BB18E4" class="sect4">Finding the TDE Master Encryption Key That Is in Use in United Mode</h4>
                  <div>
                     <p>A TDE master encryption key that is in use is the key that was activated most recently for the database. </p>
                     <div class="section">In united mode, the TDE master encryption key in use of the PDB is the one that was activated most recently for that PDB.</div>
                     <!-- class="section" -->
                     <ul>
                        <li class="stepexpand"><span>To find the TDE master encryption key that is in use, query the <code class="codeph">V$ENCRYPTION_KEYS</code> dynamic view.</span><div>For example: <pre class="oac_no_warn" dir="ltr">SELECT KEY_ID 
FROM V$ENCRYPTION_KEYS 
WHERE ACTIVATION_TIME = (SELECT MAX(ACTIVATION_TIME) 
       FROM V$ENCRYPTION_KEYS
       WHERE ACTIVATING_PDBID = SYS_CONTEXT('USERENV', 'CON_ID'));</pre></div>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="After you configure a keystore and master encryption key for use in united mode, you can perform tasks such as rekeying TDE master encryption keys.">Administering Keystores and TDE Master Encryption Keys in United Mode</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="props_rev_3"><a id="GUID-49328939-4225-4870-ACB1-E930CA5586D8" name="GUID-49328939-4225-4870-ACB1-E930CA5586D8"></a><h4 id="ASOAG-GUID-49328939-4225-4870-ACB1-E930CA5586D8" class="sect4">Creating a Custom Attribute Tag in United Mode</h4>
                  <div>
                     <p>To create a custom attribute tag in united mode, you must use the <code class="codeph">SET TAG</code> clause of the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement. 
                     </p>
                     <div class="section">
                        <ol>
                           <li>
                              <p>Log in to the CDB root or the united mode PDB as a user who has been granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege.
                              </p>
                           </li>
                           <li>
                              <p>If necessary, query the <code class="codeph">TAG</code> column of the <code class="codeph">V$ENCRYPTION_KEY</code> dynamic view to find a listing of existing tags for the TDE master encryption keys.
                              </p>
                              <p>When you create a new tag for a TDE master encryption key, it overwrites the existing tag for that TDE master encryption key.</p>
                           </li>
                           <li>
                              <p>Create the custom attribute tag by using the following syntax: </p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET TAG 'tag' 
FOR '<span class="italic">master_key_identifier</span>' 
[FORCE KEYSTORE] 
IDENTIFIED BY [EXTERNAL STORE | <span class="italic">keystore_password</span>] 
WITH BACKUP [USING '<span class="italic">backup_identifier</span>'];
</pre><p>In this specification </p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><span class="italic"><code class="codeph">tag</code></span> is the associated attributes or information that you define. Enclose this information in single quotation marks (<code class="codeph">' '</code>).
                                    </p>
                                 </li>
                                 <li>
                                    <p><span class="italic"><code class="codeph">master_key_identifier</code></span> identifies the TDE master encryption key for which the <span class="italic"><code class="codeph">tag</code></span> is set. To find a list of TDE master encryption key identifiers, query the <code class="codeph">KEY_ID</code> column of the <code class="codeph">V$ENCRYPTION_KEYS</code> dynamic view. 
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">FORCE KEYSTORE</code> temporarily opens the password-protected keystore for this operation. You must open the keystore for this operation. 
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">IDENTIFIED BY</code> can be one of the following settings:
                                    </p>
                                    <ul style="list-style-type: disc;">
                                       <li>
                                          <p><code class="codeph">EXTERNAL STORE</code> uses the keystore password stored in the external store to perform the keystore operation.
                                          </p>
                                       </li>
                                       <li>
                                          <p><span class="italic"><code class="codeph">keystore_password</code></span> is the password that was created for this keystore.
                                          </p>
                                       </li>
                                    </ul>
                                 </li>
                                 <li>
                                    <p><span class="italic"><code class="codeph">backup_identifier</code></span> defines the tag values. Enclose this setting in single quotation marks (<code class="codeph">'&nbsp;')</code> and separate each value with a colon.
                                    </p>
                                 </li>
                              </ul>
                              <p>For example, to create a tag that uses two values, one to capture a specific session ID and the second to capture a specific terminal ID: </p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET ENCRYPTION KEY 
USING TAG 'sessionid=3205062574:terminal=xcvt' 
IDENTIFIED BY <span class="italic">keystore_password</span> 
WITH BACKUP;

keystore altered.
</pre><p>Both the session ID (<code class="codeph">3205062574</code>) and terminal ID (<code class="codeph">xcvt</code>) can derive their values by using either the <code class="codeph">SYS_CONTEXT</code> function with the <code class="codeph">USERENV</code> namespace, or by using the <code class="codeph">USERENV</code> function. 
                              </p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-2934A241-AB48-4EEF-8A65-3638209931AB" title="Attribute tags enable you to monitor specific activities users perform, such as accessing a particular terminal ID.">About Creating Custom Attribute Tags</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="After you configure a keystore and master encryption key for use in united mode, you can perform tasks such as rekeying TDE master encryption keys.">Administering Keystores and TDE Master Encryption Keys in United Mode</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-CBB8C6CC-CF87-4E10-9170-938C7CE7483B" name="GUID-CBB8C6CC-CF87-4E10-9170-938C7CE7483B"></a><h4 id="ASOAG-GUID-CBB8C6CC-CF87-4E10-9170-938C7CE7483B" class="sect4">Moving a TDE Master Encryption Key into a New Keystore in United Mode</h4>
                  <div>
                     <p>In united mode, you can move an existing TDE master encryption key into a new keystore from an existing software password keystore. </p>
                     <div class="section">This feature enables you to delete unused keys. After you move the key to a new keystore, you then can delete the old keystore. </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Log in to the CDB root or the united mode PDB as a user who has been granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege.</span></li>
                        <li class="stepexpand"><span>Query the <code class="codeph">KEY_ID</code> column of the <code class="codeph">V$ENCRYPTION_KEYS</code> view to find the key identifier of the keystore to which you want to move the keys.</span><div>For example:<pre class="oac_no_warn" dir="ltr">SELECT CREATION_TIME, KEY_ID FROM V$ENCRYPTION_KEYS; 

CREATION TIME
----------------------------------------------------
22-SEP-17 08.55.12.956170 PM +00:00

KEY_ID
----------------------------------------------------
ARaHD762tUkkvyLgPzAi6hMAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</pre></div>
                        </li>
                        <li class="stepexpand"><span>Move the key into a new keystore by using the following syntax:</span><div><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT 
MOVE [ENCRYPTION] KEYS
TO NEW KEYSTORE '<span class="italic">keystore_location1</span>'
IDENTIFIED BY <span class="italic">keystore1_password</span>
FROM [FORCE] KEYSTORE
IDENTIFIED BY <span class="italic">keystore_password</span>
[WITH IDENTIFIER IN
{ '<span class="italic">key_identififier</span>' [, '<span class="italic">key_identifier</span>' ]... | ( <span class="italic">subquery</span> ) } ]
[WITH BACKUP [USING '<span class="italic">backup_identifier</span>']];</pre><p>In this specification:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><code class="codeph"><span class="codeinlineitalic">keystore_location1</span></code> is the path to the <code class="codeph">wallet</code> directory that will store the new keystore <code class="codeph">.p12</code> file. By default, this directory is in <code class="codeph">$ORACLE_BASE/admin/<span class="codeinlineitalic">db_unique_name</span>/wallet</code>.
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">FORCE</code> temporarily opens the keystore for this operation. 
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph"><span class="codeinlineitalic">keystore_password</span></code> is the password for the keystore from which the key is moving.
                                    </p>
                                 </li>
                              </ul>
                              <p>For example: </p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT MOVE KEYS 
TO NEW KEYSTORE '$ORACLE_BASE/admin/orcl/wallet' 
IDENTIFIED BY <span class="italic">keystore_password</span> 
FROM FORCE KEYSTORE 
IDENTIFIED BY <span class="italic">keystore_password</span> 
WITH IDENTIFIER IN 
(SELECT KEY_ID FROM V$ENCRYPTION_KEYS WHERE ROWNUM &lt; 2)
WITH BACKUP;</pre></div>
                        </li>
                        <li class="stepexpand"><span>To delete the old keystore, go to the <code class="codeph">wallet</code> directory and then manually delete the <code class="codeph">.p12</code> file containing the keystore.</span><div>To find the location of the keystore, open the keystores, and then query the <code class="codeph">WRL_PARAMETER</code> column of the <code class="codeph">V$ENCRYPTION_WALLET</code> view.
                           </div>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-5CC83A60-8EA4-4984-AD2C-42BC12E5A16F" title="Oracle strongly recommends that you do not delete keystores until you have moved the keystore encryption key to a new keystore.">Dangers of Deleting Keystores</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="After you configure a keystore and master encryption key for use in united mode, you can perform tasks such as rekeying TDE master encryption keys.">Administering Keystores and TDE Master Encryption Keys in United Mode</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-4E19B1E4-E5EF-4E9E-A5F4-BB62702EE7D8" name="GUID-4E19B1E4-E5EF-4E9E-A5F4-BB62702EE7D8"></a><h4 id="ASOAG-GUID-4E19B1E4-E5EF-4E9E-A5F4-BB62702EE7D8" class="sect4">Automatically Removing Inactive TDE Master Encryption Keys in United Mode</h4>
                  <div>
                     <p>In united mode, the <code class="codeph">REMOVE_INACTIVE_STANDBY_TDE_MASTER_KEY</code> initialization parameter can configure the automatic removal of inactive TDE master encryption keys.
                     </p>
                     <ol>
                        <li class="stepexpand"><span>Log in to the server where the CDB root or the united mode PDB of the Oracle standby database resides. </span></li>
                        <li class="stepexpand"><span>Locate the initialization parameter file for the database. </span><div>By default, the initialization parameter fileis located in the <code class="codeph">$ORACLE_HOME/dbs</code> directory. 
                           </div>
                        </li>
                        <li class="stepexpand"><span>Edit the initialization parameter file to include the <code class="codeph">REMOVE_INACTIVE_STANDBY_TDE_MASTER_KEY</code> initialization parameter.</span><div>For example:<pre class="oac_no_warn" dir="ltr">remove_inactive_standby_tde_master_key = true</pre><p>Setting this parameter to <code class="codeph">TRUE</code> enables the automatic removal of inactive TDE master encryption keys; setting it to <code class="codeph">FALSE</code> disables the automatic removal. 
                              </p>
                           </div>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="After you configure a keystore and master encryption key for use in united mode, you can perform tasks such as rekeying TDE master encryption keys.">Administering Keystores and TDE Master Encryption Keys in United Mode</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-732D3890-6A80-4541-8489-B26A08BCEC17" name="GUID-732D3890-6A80-4541-8489-B26A08BCEC17"></a><h4 id="ASOAG-GUID-732D3890-6A80-4541-8489-B26A08BCEC17" class="sect4">Isolating a Pluggable Database Keystore</h4>
                  <div>
                     <p>Isolating a PDB keystore moves the master encryption key from the CDB root keystore into an isolated mode keystore in the a PDB.</p>
                     <div class="section">This process enables the keystore to be managed as a separate keystore in isolated mode. This way, an administrator who has been locally granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> privilege for the PDB can manage the keystore. 
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Log in to the united mode PDB as a user who has been granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege.</span><div>For example:<pre class="oac_no_warn" dir="ltr">sqlplus sec_admin@hrpdb as syskm
Enter password: <span class="italic">password</span>
Connected.
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Move the keys from the keystore of the CDB root into the isolated mode keystore of the PDB by using the following syntax:</span><div><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT [FORCE] ISOLATE KEYSTORE
IDENTIFIED BY <span class="italic">isolated_keystore_password</span>
FROM ROOT KEYSTORE
[FORCE KEYSTORE]
IDENTIFIED BY
[EXTERNAL STORE | <span class="italic">united_keystore_password</span>]
[WITH BACKUP [USING <span class="italic">backup_id</span>]];</pre><p>In this specification:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><code class="codeph">FORCE</code> is used when a clone of the PDB is using the master encryption key that is being isolated. The <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement then copies (rather than moves) the keys from the wallet of the CDB root into the isolated mode PDB. 
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">FORCE KEYSTORE</code> temporarily opens the password-protected keystore for this operation if an auto-login keystore is open (and in use) or if the keystore is closed. 
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph"><span class="codeinlineitalic">united_keystore_password</span></code>: Knowledge of this password does not enable the user who performs the <code class="codeph">ISOLATE KEYSTORE</code> operation privileges to perform <code class="codeph">ADMINISTER KEY MANAGEMENT UNITE KEYSTORE</code> operations on the CDB root. This password is the same as the keystore password in the CDB root.
                                    </p>
                                 </li>
                              </ul><pre class="oac_no_warn" dir="ltr"></pre></div>
                           <div>After the keystore of a CDB root has been united with that of a PDB, all of the previously active (historical) master encryption keys that were associated with the CDB are moved to the keystore of the PDB.</div>
                        </li>
                        <li class="stepexpand"><span>Confirm that the united mode PDB is now an isolated mode PDB.</span><div><pre class="oac_no_warn" dir="ltr">SELECT KEYSTORE_MODE FROM V$ENCRYPTION_WALLET;</pre><p>The output should be <code class="codeph">ISOLATED</code>.
                              </p>
                           </div>
                        </li>
                     </ol>
                     <div class="section">After the united mode PDB has been converted to an isolated mode PDB, you can change the password of the keystore. </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="After you configure a keystore and master encryption key for use in united mode, you can perform tasks such as rekeying TDE master encryption keys.">Administering Keystores and TDE Master Encryption Keys in United Mode</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
            <div class="sect2"><a id="GUID-59000EDC-011E-45BF-9ECB-AC0335EE2FED" name="GUID-59000EDC-011E-45BF-9ECB-AC0335EE2FED"></a><h3 id="ASOAG-GUID-59000EDC-011E-45BF-9ECB-AC0335EE2FED" class="sect3">Administering Transparent Data Encryption in United Mode</h3>
               <div>
                  <p>You can perform general administrative tasks with Transparent Data Encryption in united mode. </p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-5B665567-8414-4F8E-A08B-DC624690BCB8">Moving PDBs from One CDB to Another in United Mode</a><br>In united mode, you can automatically move a PDB from one CDB to another (for example, for load balancing or adding new functionality).
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-576582FE-7252-49BC-B795-121689258890">Unplugging and Plugging a PDB with Encrypted Data in a CDB in United Mode</a><br>In united mode, for a PDB that has encrypted data, you can plug it into a CDB. Conversely, you can unplug this PDB from the CDB. 
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-6DB427F1-D5B6-47E2-921E-7B6DB314B368">Managing Cloned PDBs with Encrypted Data in United Mode</a><br>In united mode, you can clone a PDB that has encrypted data in a CDB.
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-75855CB2-3FBC-41E4-BC89-8EA2078E633E">How Keystore Open and Close Operations Work in United Mode</a><br>You should be aware of how keystore open and close operations work in united mode.
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-8E05DC0C-D22F-44AF-9A6A-2564195F0649">Finding the Keystore Status for All of the PDBs in United Mode</a><br>You can create a convenience function that uses the <code class="codeph">V$ENCRYPTION_WALLET</code> view to find the status for keystores in all PDBs in a CDB.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-FA569DEC-6FF3-4CA1-86AA-D27F29EDCA3C" title="United mode enables you to create a common keystore for the CDB and the PDBs for which the keystore is in united mode.">Managing Keystores and TDE Master Encryption Keys in United Mode</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-5B665567-8414-4F8E-A08B-DC624690BCB8" name="GUID-5B665567-8414-4F8E-A08B-DC624690BCB8"></a><h4 id="ASOAG-GUID-5B665567-8414-4F8E-A08B-DC624690BCB8" class="sect4">Moving PDBs from One CDB to Another in United Mode</h4>
                  <div>
                     <p>In united mode, you can automatically move a PDB from one CDB to another (for example, for load balancing or adding new functionality).</p>
                     <div class="section">If the PDB has TDE-encrypted tables or tablespaces, then you can set the <code class="codeph">ONE_STEP_PLUGIN_FOR_PDB_WITH_TDE</code> dynamic system parameter to <code class="codeph">TRUE</code> to enable the PDB to include the TDE keys in the PDB move operation. This parameter avoids you having to manually provide a keystore password when you import the TDE keys into the PDB after it has moved to a different CDB. When <code class="codeph">ONE_STEP_PLUGIN_FOR_PDB_WITH_TDE</code> is set to <code class="codeph">TRUE</code>, the database caches the keystore password in memory, obfuscated at the system level, and then uses it for the import operation. The default for <code class="codeph">ONE_STEP_PLUGIN_FOR_PDB_WITH_TDE</code> is <code class="codeph">FALSE</code>. 
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Log in to the PDB as a user who has been granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege.</span></li>
                        <li class="stepexpand"><span>Set the <code class="codeph">ONE_STEP_PLUGIN_FOR_PDB_WITH_TDE</code> dynamic initialization parameter <code class="codeph">TRUE</code>.</span><div>For example:<pre class="oac_no_warn" dir="ltr">ALTER SYSTEM SET ONE_STEP_PLUGIN_FOR_PDB_WITH_TDE = TRUE;</pre></div>
                        </li>
                        <li class="stepexpand"><span>Move (relocate) the PDB. </span></li>
                     </ol>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="../multi/introduction-to-the-multitenant-architecture.html#MULTI-GUID-D84C3A7F-A1B3-4651-B99B-9F76E7331F83" target="_blank"><span><cite>Oracle Multitenant Administrator's Guide</cite></span></a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-59000EDC-011E-45BF-9ECB-AC0335EE2FED" title="You can perform general administrative tasks with Transparent Data Encryption in united mode.">Administering Transparent Data Encryption in United Mode</a></p>
                        </div>
                     </div>
                  </div>
               </div><a id="ASOAG10441"></a><div class="props_rev_3"><a id="GUID-576582FE-7252-49BC-B795-121689258890" name="GUID-576582FE-7252-49BC-B795-121689258890"></a><h4 id="ASOAG-GUID-576582FE-7252-49BC-B795-121689258890" class="sect4">Unplugging and Plugging a PDB with Encrypted Data in a CDB in United Mode</h4>
                  <div>
                     <p>In united mode, for a PDB that has encrypted data, you can plug it into a CDB. Conversely, you can unplug this PDB from the CDB. </p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-013D7499-0EF3-4D2B-AC24-490D0378EC37">Unplugging a PDB That Has Encrypted Data in United Mode</a><br>In united mode, you can unplug a PDB with encrypted data and export it into an XML metadata file or an archive file.
                        </li>
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-67812205-D0C9-4F5F-BA64-DAE282F3B516">Plugging a PDB That Has Encrypted Data into a CDB in United Mode</a><br>To plug a PDB that has encrypted data into a CDB, you first plug in the PDB and then you can set the keystore in the PDB.
                        </li>
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-E21E1DFE-7D97-4162-82D0-8804E30F5B0B">Unplugging a PDB That Has Master Encryption Keys Stored in a Hardware Keystore in United Mode</a><br>You can unplug a PDB from one CDB that has been configured with an HSM and then plug it into another CDB also configured with an hardware keystore. 
                        </li>
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-E64F2A04-0412-4779-80C9-66E769E88863">Plugging a PDB That Has Master Encryption Keys Stored in a Hardware Keystore in United Mode</a><br>The <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement can import a TDE master encryption key from a hardware keystore to a PDB that has been moved to another CDB. 
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-59000EDC-011E-45BF-9ECB-AC0335EE2FED" title="You can perform general administrative tasks with Transparent Data Encryption in united mode.">Administering Transparent Data Encryption in United Mode</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="ASOAG10609"></a><div class="props_rev_3"><a id="GUID-013D7499-0EF3-4D2B-AC24-490D0378EC37" name="GUID-013D7499-0EF3-4D2B-AC24-490D0378EC37"></a><h5 id="ASOAG-GUID-013D7499-0EF3-4D2B-AC24-490D0378EC37" class="sect5">Unplugging a PDB That Has Encrypted Data in United Mode</h5>
                     <div>
                        <p>In united mode, you can unplug a PDB with encrypted data and export it into an XML metadata file or an archive file.</p>
                        <div class="section">The database that is unplugged contains data files and other associated files. You can check if a PDB has been unplugged by querying the <code class="codeph">STATUS</code> column of the <code class="codeph">DBA_PDBS</code> data dictionary view. 
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>In the CDB root, query the <code class="codeph">V$ENCRYPTION_WALLET</code> dynamic view to ensure that the keystore is open. </span></li>
                           <li class="stepexpand"><span>Use the <code class="codeph">ENCRYPT USING <span class="codeinlineitalic">transport_secret</span></code> clause in the <code class="codeph">ALTER PLUGGABLE DATABASE</code> statement when you unplug the PDB. </span><div>You must use this clause if the PDB has encrypted data. Otherwise, an <code class="codeph">ORA-46680: master keys of the container database must be exported</code> error is returned. 
                              </div>
                              <ul>
                                 <li>For example, to export the PDB data into an XML file:<pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE CDB1_PDB2 
UNPLUG INTO '/tmp/cdb1_pdb2.xml' 
ENCRYPT USING <span class="italic">transport_secret</span>;</pre></li>
                                 <li>To export the PDB data into an archive file:<pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE CDB1_PDB2 
UNPLUG INTO '/tmp/cdb1_pdb2.pdb' 
ENCRYPT USING <span class="italic">transport_secret</span>; </pre></li>
                              </ul>
                           </li>
                        </ol>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>Related Topics</strong></p>
                           <ul>
                              <li><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-765C103D-67A0-4DF1-930E-CFFFA89B2DC2" title="To open a software keystore in united mode, you must use the ADMINISTER KEY MANAGEMENT statement with the SET KEYSTORE OPEN clause.">Step 2: Open the Software Keystore in a United Mode PDB</a></li>
                              <li><a href="../multi/removing-a-pdb.html#MULTI-GUID-75C46F1B-00D8-4FB9-A8E7-6F7FE3DE4CA0" target="_blank"><span><cite>Oracle Multitenant Administrator's Guide</cite></span></a></li>
                              <li><a href="../sqlrf/ALTER-PLUGGABLE-DATABASE.html#SQLRF-GUID-A29491AD-8F0F-4E52-9D94-57FC3FF8FBC7" target="_blank"><span><cite>Oracle Database SQL Language Reference</cite></span></a></li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-576582FE-7252-49BC-B795-121689258890" title="In united mode, for a PDB that has encrypted data, you can plug it into a CDB. Conversely, you can unplug this PDB from the CDB.">Unplugging and Plugging a PDB with Encrypted Data in a CDB in United Mode</a></p>
                           </div>
                        </div>
                     </div>
                  </div><a id="ASOAG10610"></a><div class="props_rev_3"><a id="GUID-67812205-D0C9-4F5F-BA64-DAE282F3B516" name="GUID-67812205-D0C9-4F5F-BA64-DAE282F3B516"></a><h5 id="ASOAG-GUID-67812205-D0C9-4F5F-BA64-DAE282F3B516" class="sect5">Plugging a PDB That Has Encrypted Data into a CDB in United Mode</h5>
                     <div>
                        <p>To plug a PDB that has encrypted data into a CDB, you first plug in the PDB and then you can set the keystore in the PDB.</p>
                        <div class="section">When you plug an unplugged PDB into another CDB, the key version is set to <code class="codeph">0</code> because this operation invalidates the history of the previous keys. You can check the key version by querying the <code class="codeph">KEY_VERSION</code> column of the <code class="codeph">V$ENCRYPTED_TABLESPACES</code> dynamic view. Similarly, if a control file is lost and recreated, then the previous history of the keys is reset to <code class="codeph">0</code>. You can check if a PDB has already been plugged in by querying the <code class="codeph">STATUS</code> column of the <code class="codeph">DBA_PDBS</code> data dictionary view.
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ol>
                              <li>
                                 <p>From the CDB root, create the PDB by plugging the unplugged PDB into the CDB.</p>
                                 <p>To perform this operation for united mode, include the <code class="codeph">DECRYPT USING <span class="codeinlineitalic">transport_secret</span></code> clause. 
                                 </p>
                                 <p>You must use this clause if the metadata or archive file for the PDB has encrypted data. Otherwise, an <code class="codeph">ORA-46680: master keys of the container database must be exported</code> error is returned. 
                                 </p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>For example, if you had exported the PDB data into a metadata XML file:</p><pre class="oac_no_warn" dir="ltr">CREATE PLUGGABLE DATABASE CDB1_PDB2 
USING '/tmp/cdb1_pdb2.xml' 
NOCOPY KEYSTORE 
IDENTIFIED BY <span class="italic">password</span> 
DECRYPT USING <span class="italic">transport_secret</span>;</pre></li>
                                    <li>
                                       <p>If you had exported the PDB into an archive file:</p><pre class="oac_no_warn" dir="ltr">CREATE PLUGGABLE DATABASE CDB1_PDB2 
USING '/tmp/cdb1_pdb2.pdb' 
DECRYPT USING <span class="italic">transport_secret</span>;</pre></li>
                                 </ul>
                                 <p>During the open operation of the PDB after the plug operation, Oracle Database determines if the PDB has encrypted data. If so, it opens the PDB in the <code class="codeph">RESTRICTED</code> mode. 
                                 </p>
                                 <p>If you want to create the PDB by cloning another PDB or from a non-CDB, and if the source database has encrypted data or a TDE master encryption key that has been set, then you must provide the keystore password by including the <code class="codeph">keystore identified by <span class="codeinlineitalic">keystore_password</span></code> clause in the <code class="codeph">CREATE PLUGGABLE DATABASE ... FROM</code> SQL statement. You must provide this password even if the source database is using an auto-login software keystore. You can find if the source database has encrypted data or a TDE master encryption key set in the keystore by querying the <code class="codeph">V$ENCRYPTION_KEYS</code> dynamic view
                                 </p>
                              </li>
                              <li>
                                 <p>Open the PDB.</p>
                                 <p>For example: </p><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE CDB1_PDB2 OPEN;</pre></li>
                              <li>
                                 <p>Open the keystore in the CDB root. </p>
                                 <p>For example:</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN 
IDENTIFIED BY <span class="italic">password</span>;</pre><p>Optionally, open the keystore in the PDB.</p>
                              </li>
                              <li>
                                 <p>In either the CDB root or the PDB (if the keystore is open in the PDB), set the TDE master encryption key for the PDB.</p>
                                 <p>For example:</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEY 
IDENTIFIED BY <span class="italic">keystore_password</span> 
WITH BACKUP USING 'emp_key_backup';</pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>Related Topics</strong></p>
                           <ul>
                              <li><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-765C103D-67A0-4DF1-930E-CFFFA89B2DC2" title="To open a software keystore in united mode, you must use the ADMINISTER KEY MANAGEMENT statement with the SET KEYSTORE OPEN clause.">Step 2: Open the Software Keystore in a United Mode PDB</a></li>
                              <li><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-8A6CF613-F182-4249-ACAE-764C145E210B" title="To set the TDE master encryption key in the keystore when the PDB is configured in united mode, use the ADMINISTER KEY MANAGEMENT statement with the SET KEY clause.">Step 3: Set the TDE Master Encryption Key in the Software Keystore in United Mode</a></li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-576582FE-7252-49BC-B795-121689258890" title="In united mode, for a PDB that has encrypted data, you can plug it into a CDB. Conversely, you can unplug this PDB from the CDB.">Unplugging and Plugging a PDB with Encrypted Data in a CDB in United Mode</a></p>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-E21E1DFE-7D97-4162-82D0-8804E30F5B0B" name="GUID-E21E1DFE-7D97-4162-82D0-8804E30F5B0B"></a><h5 id="ASOAG-GUID-E21E1DFE-7D97-4162-82D0-8804E30F5B0B" class="sect5">Unplugging a PDB That Has Master Encryption Keys Stored in a Hardware Keystore in United Mode</h5>
                     <div>
                        <p>You can unplug a PDB from one CDB that has been configured with an HSM and then plug it into another CDB also configured with an hardware keystore. </p>
                        <ol>
                           <li class="stepexpand"><span>Unplug the PDB.</span><div>You can check if a PDB has already been unplugged by querying the <code class="codeph">STATUS</code> column of the <code class="codeph">DBA_PDBS</code> data dictionary view.
                              </div>
                           </li>
                           <li class="stepexpand"><span>Move the master encryption keys of the unplugged PDB in the hardware keystore that was used at the source CDB to the hardware keystore that is in use at the destination CDB.</span><div>
                                 <p>Refer to the documentation for the hardware keystore for information about moving master encryption keys between hardware keystores.</p>
                              </div>
                           </li>
                        </ol>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>Related Topics</strong></p>
                           <ul>
                              <li><a href="../multi/index.html" target="_blank"><span><cite>Oracle Multitenant Administrator's Guide</cite></span></a></li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-576582FE-7252-49BC-B795-121689258890" title="In united mode, for a PDB that has encrypted data, you can plug it into a CDB. Conversely, you can unplug this PDB from the CDB.">Unplugging and Plugging a PDB with Encrypted Data in a CDB in United Mode</a></p>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-E64F2A04-0412-4779-80C9-66E769E88863" name="GUID-E64F2A04-0412-4779-80C9-66E769E88863"></a><h5 id="ASOAG-GUID-E64F2A04-0412-4779-80C9-66E769E88863" class="sect5">Plugging a PDB That Has Master Encryption Keys Stored in a Hardware Keystore in United Mode</h5>
                     <div>
                        <p>The <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement can import a TDE master encryption key from a hardware keystore to a PDB that has been moved to another CDB. 
                        </p>
                        <ol>
                           <li class="stepexpand"><span>Plug the unplugged PDB into the destination CDB that has been configured with the hardware keystore. </span><div>You can check if a PDB has already been plugged in by querying the <code class="codeph">STATUS</code> column of the <code class="codeph">DBA_PDBS</code> data dictionary view.
                              </div>
                              <div>After the plug-in operation, the PDB that has been plugged in will be in restricted mode. </div>
                           </li>
                           <li class="stepexpand"><span>Ensure that the master encryption keys from the hardware keystore that has been configured with the source CDB are available in the hardware keystore of the destination CDB. </span></li>
                           <li class="stepexpand"><span>Log in to the plugged PDB as a user who was granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege. </span><div>
                                 <p>For example:</p><pre class="oac_no_warn" dir="ltr">sqlplus sec_admin@hr_pdb as syskm
Enter password: <span class="italic">password</span>
Connected.
</pre><p>Contact your <code class="codeph">SYSDBA</code> administrator for the correct PDB. To check the current container, run the <code class="codeph">SHOW CON_NAME</code> command.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Open the master encryption key of the plugged PDB.</span><div>
                                 <p>For example, for a PDB called <code class="codeph">PDB1</code>:
                                 </p><pre class="oac_no_warn" dir="ltr">ALTER SESSION SET CONTAINER = PDB1;
ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN 
IDENTIFIED BY <span class="italic">keystore_passsword</span>;</pre></div>
                           </li>
                           <li class="stepexpand"><span>Import the hardware keystore master encryption key into the PDB.</span><div><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT IMPORT ENCRYPTION KEYS 
WITH SECRET "HSM" FROM 'HSM' 
IDENTIFIED BY <span class="italic">keystore_password</span>; </pre></div>
                           </li>
                           <li class="stepexpand"><span>Restart the PDB.</span><div><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE PDB1 CLOSE;
ALTER PLUGGABLE DATABASE PDB1 OPEN;</pre></div>
                           </li>
                        </ol>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>Related Topics</strong></p>
                           <ul>
                              <li><a href="../multi/plugging-in-a-pdb.html#MULTI-GUID-F23F5352-F456-48EE-AED7-71E3DEBAAED0" target="_blank"><span><cite>Oracle Multitenant Administrator's Guide</cite></span></a></li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-576582FE-7252-49BC-B795-121689258890" title="In united mode, for a PDB that has encrypted data, you can plug it into a CDB. Conversely, you can unplug this PDB from the CDB.">Unplugging and Plugging a PDB with Encrypted Data in a CDB in United Mode</a></p>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-6DB427F1-D5B6-47E2-921E-7B6DB314B368" name="GUID-6DB427F1-D5B6-47E2-921E-7B6DB314B368"></a><h4 id="ASOAG-GUID-6DB427F1-D5B6-47E2-921E-7B6DB314B368" class="sect4">Managing Cloned PDBs with Encrypted Data in United Mode</h4>
                  <div>
                     <p>In united mode, you can clone a PDB that has encrypted data in a CDB.</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-3A60285F-5CF7-4FA0-9F6E-EF19A1481AA4">About Managing Cloned PDBs That Have Encrypted Data in United Mode</a><br>When you clone a PDB, you must make the master encryption key of the source PDB available to cloned PDB.
                        </li>
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-34325A34-02A1-445E-BE5A-993CA5EDB926">Cloning a PDB with Encrypted Data in a CDB in United Mode</a><br>The <code class="codeph">CREATE PLUGGABLE DATABASE</code> statement with the <code class="codeph">KEYSTORE IDENTIFIED BY</code> clause can clone a PDB that has encrypted data.
                        </li>
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-2B2E9E7D-10E0-4D3E-B466-4767AC3D81C1">Performing a Remote Clone of PDB with Encrypted Data Between Two CDBs in United Mode</a><br>The <code class="codeph">CREATE PLUGGABLE DATABASE</code> statement with the <code class="codeph">KEYSTORE IDENTIFIED BY</code> clause can remotely clone a PDB that has encrypted data.
                        </li>
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-2D0FC0F4-6365-47C9-82CC-AED41286540A">Relocating Across CDBs a Cloned PDB with Encrypted Data in United Mode</a><br>The <code class="codeph">CREATE PLUGGABLE DATABASE</code> statement with the <code class="codeph">KEYSTORE IDENTIFIED BY</code> clause can relocate across CDBs a cloned PDB that has encrypted data.
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-59000EDC-011E-45BF-9ECB-AC0335EE2FED" title="You can perform general administrative tasks with Transparent Data Encryption in united mode.">Administering Transparent Data Encryption in United Mode</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="sect4"><a id="GUID-3A60285F-5CF7-4FA0-9F6E-EF19A1481AA4" name="GUID-3A60285F-5CF7-4FA0-9F6E-EF19A1481AA4"></a><h5 id="ASOAG-GUID-3A60285F-5CF7-4FA0-9F6E-EF19A1481AA4" class="sect5">About Managing Cloned PDBs That Have Encrypted Data in United Mode</h5>
                     <div>
                        <p>When you clone a PDB, you must make the master encryption key of the source PDB available to cloned PDB.</p>
                        <p>This allows a cloned PDB to operate on the encrypted data. To perform the clone, you do not need to export and import the keys because Oracle Database transports the keys for you even if the cloned PDB is in a remote CDB. However, you will need to provide the keystore password of the CDB where you are creating the clone.</p>
                        <p>If the PDBs have encrypted data, then you can perform remote clone operations on PDBs between CDBs, and relocate PDBs across CDBs. </p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-6DB427F1-D5B6-47E2-921E-7B6DB314B368" title="In united mode, you can clone a PDB that has encrypted data in a CDB.">Managing Cloned PDBs with Encrypted Data in United Mode</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-34325A34-02A1-445E-BE5A-993CA5EDB926" name="GUID-34325A34-02A1-445E-BE5A-993CA5EDB926"></a><h5 id="ASOAG-GUID-34325A34-02A1-445E-BE5A-993CA5EDB926" class="sect5">Cloning a PDB with Encrypted Data in a CDB in United Mode</h5>
                     <div>
                        <p>The <code class="codeph">CREATE PLUGGABLE DATABASE</code> statement with the <code class="codeph">KEYSTORE IDENTIFIED BY</code> clause can clone a PDB that has encrypted data.
                        </p>
                        <ol>
                           <li class="stepexpand"><span>In the CDB root, query the <code class="codeph">STATUS</code> column of the <code class="codeph">V$ENCRYPTION_WALLET</code> dynamic view to ensure that the keystore is open in the CDB root. </span></li>
                           <li class="stepexpand"><span>Log in to the PDB as a user who has been granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege.</span></li>
                           <li class="stepexpand"><span>Use the <code class="codeph">CREATE PLUGGABLE DATABASE</code> statement with the <code class="codeph">KEYSTORE IDENTIFIED BY</code> clause to clone the PDB.</span><div>
                                 <p>For example:</p><pre class="oac_no_warn" dir="ltr">CREATE PLUGGABLE DATABASE cdb1_pdb3 
FROM cdb1_pdb1 
FILE_NAME_CONVERT=('cdb1_pdb1', 'pdb3/cdb1_pdb3') KEYSTORE 
IDENTIFIED BY <span class="italic">keystore_password</span>;</pre></div>
                              <div>
                                 <p>Replace <code class="codeph"><span class="codeinlineitalic">keystore_password</span></code> with the password of the keystore of the CDB where the <code class="codeph">cdb1_pdb3</code> clone is created.
                                 </p>
                              </div>
                              <div>After you create the cloned PDB, encrypted data is still accessible by the clone using the master encryption key of the original PDB. After a PDB is cloned, there may be user data in the encrypted tablespaces. This encrypted data is still accessible because the master encryption key of the source PDB is copied over to the destination PDB. Because the clone is a copy of the source PDB but will eventually follow its own course and have its own data and security policies, you should rekey the master encrytion key of the cloned PDB.</div>
                           </li>
                           <li class="stepexpand"><span>Rekey the master encryption key of the cloned PDB.</span><div>
                                 <p>For example:</p><pre class="pre codeblock"><code>ADMINISTER KEY MANAGEMENT SET KEY 
FORCE KEYSTORE
IDENTIFIED BY <span class="italic">keystore_password</span> 
WITH BACKUP USING 'emp_key_backup';</code></pre><p>In this example, <code class="codeph">FORCE KEYSTORE</code> is included because the keystore must be open during the rekey operation.
                                 </p>
                              </div>
                              <div>Before you rekey the master encryption key of the cloned PDB, the clone can still use master encryption keys that belong to the original PDB. However, these master encryption keys do not appear in the cloned PDB <code class="codeph">V$</code> dynamic views. Rekeying the master encryption key ensures that the cloned PDB uses its own unique keys, which will be viewable in the <code class="codeph">V$</code> views.
                              </div>
                           </li>
                        </ol>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>Related Topics</strong></p>
                           <ul>
                              <li><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-765C103D-67A0-4DF1-930E-CFFFA89B2DC2" title="To open a software keystore in united mode, you must use the ADMINISTER KEY MANAGEMENT statement with the SET KEYSTORE OPEN clause.">Step 2: Open the Software Keystore in a United Mode PDB</a></li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-6DB427F1-D5B6-47E2-921E-7B6DB314B368" title="In united mode, you can clone a PDB that has encrypted data in a CDB.">Managing Cloned PDBs with Encrypted Data in United Mode</a></p>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-2B2E9E7D-10E0-4D3E-B466-4767AC3D81C1" name="GUID-2B2E9E7D-10E0-4D3E-B466-4767AC3D81C1"></a><h5 id="ASOAG-GUID-2B2E9E7D-10E0-4D3E-B466-4767AC3D81C1" class="sect5">Performing a Remote Clone of PDB with Encrypted Data Between Two CDBs in United Mode</h5>
                     <div>
                        <p>The <code class="codeph">CREATE PLUGGABLE DATABASE</code> statement with the <code class="codeph">KEYSTORE IDENTIFIED BY</code> clause can remotely clone a PDB that has encrypted data.
                        </p>
                        <ol>
                           <li class="stepexpand"><span>In the CDB root, query the <code class="codeph">STATUS</code> column of the <code class="codeph">V$ENCRYPTION_WALLET</code> dynamic view to ensure that the keystore is open in the CDB root. </span></li>
                           <li class="stepexpand"><span>Log in to the PDB as a user who has been granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege.</span></li>
                           <li class="stepexpand"><span>Create a database link for the PDB that you want to clone remotely. </span><div>Use the <code class="codeph">CREATE DATABASE LINK</code> SQL statement to create the database link. You must create the database link by following the database link prerequisites that are required for cloning a remote PDB or a non-CDB. 
                              </div>
                           </li>
                           <li class="stepexpand"><span>Use the <code class="codeph">CREATE PLUGGABLE DATABASE</code> statement with the <code class="codeph">KEYSTORE IDENTIFIED BY</code> clause to perform the clone of the PDB.</span><div>
                                 <p>For example:</p><pre class="oac_no_warn" dir="ltr">CREATE PLUGGABLE DATABASE cdb1_pdb3 
FROM cdb1_pdb1 
FILE_NAME_CONVERT=('cdb1_pdb1', 'pdb3/cdb1_pdb3') KEYSTORE 
IDENTIFIED BY <span class="italic">keystore_password</span>;</pre></div>
                              <div>
                                 <p>Replace <code class="codeph"><span class="codeinlineitalic">keystore_password</span></code> with the password of the keystore of the CDB where the <code class="codeph">cdb1_pdb3</code> clone is created.
                                 </p>
                              </div>
                              <div>After you create the cloned PDB, encrypted data is still accessible by the clone using the master encryption key of the original PDB. After a PDB is cloned, there may be user data in the encrypted tablespaces. This encrypted data is still accessible because the master encryption key of the source PDB is copied over to the destination PDB. Because the clone is a copy of the source PDB but will eventually follow its own course and have its own data and security policies, you should rekey the master encrytion key of the cloned PDB.</div>
                           </li>
                           <li class="stepexpand"><span>Rekey the master encryption key of the remotely cloned PDB.</span><div>
                                 <p>For example:</p><pre class="pre codeblock"><code>ADMINISTER KEY MANAGEMENT SET KEY 
FORCE KEYSTORE
IDENTIFIED BY <span class="italic">keystore_password</span> 
WITH BACKUP USING 'emp_key_backup';</code></pre><p>In this example, <code class="codeph">FORCE KEYSTORE</code> is included because the keystore must be open during the rekey operation.
                                 </p>
                              </div>
                              <div>Before you rekey the master encryption key of the cloned PDB, the clone can still use master encryption keys that belong to the original PDB. However, these master encryption keys do not appear in the cloned PDB <code class="codeph">V$</code> dynamic views. Rekeying the master encryption key ensures that the cloned PDB uses its own unique keys, which will be viewable in the <code class="codeph">V$</code> views.
                              </div>
                           </li>
                        </ol>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>Related Topics</strong></p>
                           <ul>
                              <li><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-765C103D-67A0-4DF1-930E-CFFFA89B2DC2" title="To open a software keystore in united mode, you must use the ADMINISTER KEY MANAGEMENT statement with the SET KEYSTORE OPEN clause.">Step 2: Open the Software Keystore in a United Mode PDB</a></li>
                              <li><a href="../multi/cloning-a-pdb.html#MULTI-GUID-D4900E43-DF38-4629-9A1F-D1C11EC8EC8F" target="_blank"><span><cite><span><cite>Oracle Multitenant Administrator's Guide</cite></span></cite></span></a></li>
                              <li><a href="../multi/cloning-a-pdb.html#MULTI-GUID-B5F57568-0FF8-4F86-AC3C-0EE46EE3ED0B" target="_blank"><span><cite><span><cite>Oracle Multitenant Administrator's Guide</cite></span></cite></span></a></li>
                              <li><a href="../sqlrf/CREATE-DATABASE-LINK.html#SQLRF-GUID-D966642A-B19E-449D-9968-1121AF06D793" target="_blank"><span><cite><span><cite>Oracle Database SQL Language Reference</cite></span></cite></span></a></li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-6DB427F1-D5B6-47E2-921E-7B6DB314B368" title="In united mode, you can clone a PDB that has encrypted data in a CDB.">Managing Cloned PDBs with Encrypted Data in United Mode</a></p>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-2D0FC0F4-6365-47C9-82CC-AED41286540A" name="GUID-2D0FC0F4-6365-47C9-82CC-AED41286540A"></a><h5 id="ASOAG-GUID-2D0FC0F4-6365-47C9-82CC-AED41286540A" class="sect5">Relocating Across CDBs a Cloned PDB with Encrypted Data in United Mode</h5>
                     <div>
                        <p>The <code class="codeph">CREATE PLUGGABLE DATABASE</code> statement with the <code class="codeph">KEYSTORE IDENTIFIED BY</code> clause can relocate across CDBs a cloned PDB that has encrypted data.
                        </p>
                        <ol>
                           <li class="stepexpand"><span>In the CDB root, query the <code class="codeph">STATUS</code> column of the <code class="codeph">V$ENCRYPTION_WALLET</code> dynamic view to ensure that the keystore is open in the CDB root. </span></li>
                           <li class="stepexpand"><span>Log in to the PDB as a user who has been granted the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> or <code class="codeph">SYSKM</code> privilege.</span></li>
                           <li class="stepexpand"><span>Create a database link for the PDB that you want to clone. </span><div>Use the <code class="codeph">CREATE DATABASE LINK</code> SQL statement to create the database link. You must create the database link by following the database link prerequisites that are required for cloning a remote PDB or a non-CDB. 
                              </div>
                           </li>
                           <li class="stepexpand"><span>Use the <code class="codeph">CREATE PLUGGABLE DATABASE</code> statement with the <code class="codeph">KEYSTORE IDENTIFIED BY</code> clause to clone the PDB.</span><div>
                                 <p>For example:</p><pre class="oac_no_warn" dir="ltr">CREATE PLUGGABLE DATABASE cdb1_pdb3 
FROM cdb1_pdb1 
FILE_NAME_CONVERT=('cdb1_pdb1', 'pdb3/cdb1_pdb3') KEYSTORE 
IDENTIFIED BY <span class="italic">keystore_password</span>;</pre></div>
                              <div>
                                 <p>Replace <code class="codeph"><span class="codeinlineitalic">keystore_password</span></code> with the password of the keystore of the CDB where the <code class="codeph">cdb1_pdb3</code> clone is created.
                                 </p>
                              </div>
                              <div>After you create the cloned PDB, encrypted data is still accessible by the clone using the master encryption key of the original PDB. After a PDB is cloned, there may be user data in the encrypted tablespaces. This encrypted data is still accessible because the master encryption key of the source PDB is copied over to the destination PDB. Because the clone is a copy of the source PDB but will eventually follow its own course and have its own data and security policies, you should rekey the master encrytion key of the cloned PDB.</div>
                           </li>
                           <li class="stepexpand"><span>Use the <code class="codeph">ALTER PLUGGABLE DATABASE</code> statement to perform the relocation operation. </span><div>For example:<pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE cdb1_pdb3
OPEN RELOCATE TO 'need instance name example';</pre></div>
                           </li>
                           <li class="stepexpand"><span>Rekey the master encryption key of the remotely cloned PDB.</span><div>
                                 <p>For example:</p><pre class="pre codeblock"><code>ADMINISTER KEY MANAGEMENT SET KEY 
FORCE KEYSTORE
IDENTIFIED BY <span class="italic">keystore_password</span> 
WITH BACKUP USING 'emp_key_backup';</code></pre><p>In this example, <code class="codeph">FORCE KEYSTORE</code> is included because the keystore must be open during the rekey operation.
                                 </p>
                              </div>
                              <div>Before you rekey the master encryption key of the cloned PDB, the clone can still use master encryption keys that belong to the original PDB. However, these master encryption keys do not appear in the cloned PDB <code class="codeph">V$</code> dynamic views. Rekeying the master encryption key ensures that the cloned PDB uses its own unique keys, which will be viewable in the <code class="codeph">V$</code> views.
                              </div>
                           </li>
                        </ol>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>Related Topics</strong></p>
                           <ul>
                              <li><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-765C103D-67A0-4DF1-930E-CFFFA89B2DC2" title="To open a software keystore in united mode, you must use the ADMINISTER KEY MANAGEMENT statement with the SET KEYSTORE OPEN clause.">Step 2: Open the Software Keystore in a United Mode PDB</a></li>
                              <li><a href="../multi/cloning-a-pdb.html#MULTI-GUID-D4900E43-DF38-4629-9A1F-D1C11EC8EC8F" target="_blank"><span><cite><span><cite>Oracle Multitenant Administrator's Guide</cite></span></cite></span></a></li>
                              <li><a href="../multi/cloning-a-pdb.html#MULTI-GUID-B5F57568-0FF8-4F86-AC3C-0EE46EE3ED0B" target="_blank"><span><cite><span><cite>Oracle Multitenant Administrator's Guide</cite></span></cite></span></a></li>
                              <li><a href="../sqlrf/CREATE-DATABASE-LINK.html#SQLRF-GUID-D966642A-B19E-449D-9968-1121AF06D793" target="_blank"><span><cite><span><cite>Oracle Database SQL Language Reference</cite></span></cite></span></a></li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-6DB427F1-D5B6-47E2-921E-7B6DB314B368" title="In united mode, you can clone a PDB that has encrypted data in a CDB.">Managing Cloned PDBs with Encrypted Data in United Mode</a></p>
                           </div>
                        </div>
                     </div>
                  </div>
               </div><a id="ASOAG10442"></a><div class="props_rev_3"><a id="GUID-75855CB2-3FBC-41E4-BC89-8EA2078E633E" name="GUID-75855CB2-3FBC-41E4-BC89-8EA2078E633E"></a><h4 id="ASOAG-GUID-75855CB2-3FBC-41E4-BC89-8EA2078E633E" class="sect4">How Keystore Open and Close Operations Work in United Mode</h4>
                  <div>
                     <p>You should be aware of how keystore open and close operations work in united mode.</p>
                     <p>For each PDB in united mode, you must explicitly open the password-protected software keystore or hardware keystore in the PDB to enable the Transparent Data Encryption operations to proceed. (Auto-login and local auto-login software keystores open automatically.) Closing a keystore on a PDB blocks all of the Transparent Data Encryption operations on that PDB. </p>
                     <p>The open and close keystore operations in a PDB depend on the open and close status of the keystore in the CDB root.</p>
                     <p>Note the following: </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>You can create a separate keystore password for each PDB in united mode. </p>
                        </li>
                        <li>
                           <p>Before you can manually open a software password-protected or hardware keystore in an individual PDB, you must open the keystore in the CDB root. </p>
                        </li>
                        <li>
                           <p>If an auto-login keystore is in use, or if the keystore is closed, then include the <code class="codeph">FORCE KEYSTORE</code> clause in the <code class="codeph">ADMINISTER KEY MANAGEMENT</code> statement when you open or close the keystore.
                           </p>
                        </li>
                        <li>
                           <p>If the keystore is a password-protected software keystore that uses an external store for passwords, then set the <code class="codeph">IDENTIFIED BY</code> clause to <code class="codeph">EXTERNAL STORE</code>.
                           </p>
                        </li>
                        <li>
                           <p>Before you can set a TDE master encryption key in an individual PDB, you must set the key in the CDB root.</p>
                        </li>
                        <li>
                           <p>Auto-login and local auto-login software keystores open automatically. You do not need to manually open these from the CDB root first, or from the PDB. </p>
                        </li>
                        <li>
                           <p>If you close the keystore in the CDB root, then the keystores in the dependent PDBs also close. A keystore close operation in the root is the equivalent of performing a keystore close operation with the <code class="codeph">CONTAINER</code> clause set to <code class="codeph">ALL</code>. 
                           </p>
                        </li>
                        <li>
                           <p>If you perform an <code class="codeph">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN</code> statement in the CDB root and set the <code class="codeph">CONTAINER</code> clause to <code class="codeph">ALL</code>, then the keystore will only be opened in each PDB that is configured in united mode, and any PDB that is configured in isolated mode is not opened.
                           </p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-59000EDC-011E-45BF-9ECB-AC0335EE2FED" title="You can perform general administrative tasks with Transparent Data Encryption in united mode.">Administering Transparent Data Encryption in United Mode</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ASOAG10444"></a><a id="ASOAG10443"></a><div class="props_rev_3"><a id="GUID-8E05DC0C-D22F-44AF-9A6A-2564195F0649" name="GUID-8E05DC0C-D22F-44AF-9A6A-2564195F0649"></a><h4 id="ASOAG-GUID-8E05DC0C-D22F-44AF-9A6A-2564195F0649" class="sect4">Finding the Keystore Status for All of the PDBs in United Mode</h4>
                  <div>
                     <p>You can create a convenience function that uses the <code class="codeph">V$ENCRYPTION_WALLET</code> view to find the status for keystores in all PDBs in a CDB.
                     </p>
                     <div class="section">
                        <p>The <code class="codeph">V$ENCRYPTION_WALLET</code> view displays the status of the keystore in a PDB, whether it is open, closed, uses a software or hardware keystore, and so on. 
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>To create a function that uses the<code class="codeph">V$ENCRYPTION_WALLET</code> view to find the keystore status, use the <code class="codeph">CREATE PROCEDURE</code> PL/SQL statement. 
                              </p>
                           </li>
                        </ul>
                        <p><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-8E05DC0C-D22F-44AF-9A6A-2564195F0649__CIHGECEI">Example 5-2</a> shows how to create this function.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-8E05DC0C-D22F-44AF-9A6A-2564195F0649__CIHGECEI">
                        <p class="titleinexample">Example 5-2 Function to Find the Keystore Status of All of the PDBs in a CDB</p><pre class="oac_no_warn" dir="ltr">CREATE OR REPLACE PROCEDURE all_pdb_v$encryption_wallet
IS
    err_occ            BOOLEAN;
    curr_pdb           VARCHAR2(30);
    pdb_name           VARCHAR2(30);
    wrl_type           VARCHAR2(20);
    status             VARCHAR2(30);
    wallet_type        VARCHAR2(20);
    wallet_order       VARCHAR2(12);
    fully_backed_up    VARCHAR2(15);
    wrl_parameter      VARCHAR2(4000);
    cursor sel_pdbs IS SELECT NAME FROM V$CONTAINERS
                       WHERE NAME &lt;&gt; 'PDB$SEED' order by con_id desc;
  BEGIN
 
    -- Store the original PDB name
    SELECT sys_context('userenv', 'con_name') INTO curr_pdb FROM DUAL;
    IF curr_pdb &lt;&gt; 'CDB$ROOT' THEN
      dbms_output.put_line('Operation valid in ROOT only');
    END IF;
 
    err_occ := FALSE;
    dbms_output.put_line('---');
    dbms_output.put_line('PDB_NAME                       WRL_TYPE STATUS                        ');
    dbms_output.put_line('------------------------------ -------- ------------------------------');
    dbms_output.put_line('WALLET_TYPE          WALLET_ORDER FULLY_BACKED_UP');
    dbms_output.put_line('-------------------- ------------ ---------------');
    dbms_output.put_line('WRL_PARAMETER');
    dbms_output.put_line('--------------------------------------------------------------------------');
    FOR pdbinfo IN sel_pdbs LOOP
 
      pdb_name := DBMS_ASSERT.ENQUOTE_NAME(pdbinfo.name, FALSE);
      EXECUTE IMMEDIATE 'ALTER SESSION SET CONTAINER = ' || pdb_name;
 
      BEGIN
        pdb_name := rpad(substr(pdb_name,1,30), 30, ' ');
        EXECUTE IMMEDIATE 'SELECT wrl_type from V$ENCRYPTION_WALLET' into wrl_type; 
        wrl_type := rpad(substr(wrl_type,1,8), 8, ' ');
        EXECUTE IMMEDIATE 'SELECT status from V$ENCRYPTION_WALLET' into status;
        status := rpad(substr(status,1,30), 30, ' ');
        EXECUTE IMMEDIATE 'SELECT wallet_type from V$ENCRYPTION_WALLET' into wallet_type;
        wallet_type := rpad(substr(wallet_type,1,20), 20, ' ');
        EXECUTE IMMEDIATE 'SELECT wallet_order from V$ENCRYPTION_WALLET' into wallet_order;        
        wallet_order := rpad(substr(wallet_order,1,9), 12, ' ');
        EXECUTE IMMEDIATE 'SELECT fully_backed_up from V$ENCRYPTION_WALLET' into fully_backed_up;
        fully_backed_up := rpad(substr(fully_backed_up,1,9), 15, ' ');
        EXECUTE IMMEDIATE 'SELECT wrl_parameter from V$ENCRYPTION_WALLET' into wrl_parameter;
        wrl_parameter := rpad(substr(wrl_parameter,1,79), 79, ' ');
        dbms_output.put_line(pdb_name || ' ' || wrl_type || ' ' || status);
        dbms_output.put_line(wallet_type || ' ' || wallet_order || ' ' || fully_backed_up);
        dbms_output.put_line(wrl_parameter);
 
      EXCEPTION
        WHEN OTHERS THEN
        err_occ := TRUE;
      END;
    END LOOP;
 
    IF err_occ = TRUE THEN
       dbms_output.put_line('One or more PDB resulted in an error');
    END IF;
  END;
.
/
set serveroutput on
exec all_pdb_v$encryption_wallet;</pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-59000EDC-011E-45BF-9ECB-AC0335EE2FED" title="You can perform general administrative tasks with Transparent Data Encryption in united mode.">Administering Transparent Data Encryption in United Mode</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>