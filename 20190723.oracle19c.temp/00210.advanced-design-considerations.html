<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Advanced Design Considerations</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Database SecureFiles and Large Objects Developer's Guide">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Database SecureFiles and Large Objects Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="securefiles-and-large-objects-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-02-12T02:58:18-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96333-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="LOB-storage-with-applications.html" title="Previous" type="text/html">
      <link rel="next" href="performance-guidelines.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="SecureFiles and Large Objects Developer's Guide">
    <meta name="dcterms.isVersionOf" content="ADLOB">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="LOB-storage-with-applications.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="performance-guidelines.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Database SecureFiles and Large Objects Developer's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="application-design-with-LOBs.html" property="item" typeof="WebPage"><span property="name">     Application Design with LOBs</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Advanced Design Considerations</li>
            </ol>
            <a id="GUID-1153755A-C4F4-4462-B592-6EE520F1C6A7" name="GUID-1153755A-C4F4-4462-B592-6EE520F1C6A7"></a><a id="ADLOB45318"></a>
            
            <h2 id="ADLOB-GUID-1153755A-C4F4-4462-B592-6EE520F1C6A7" class="sect2"><span class="enumeration_chapter">14 </span> Advanced Design Considerations
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>There are design considerations for more advanced application development issues. </p>
               <p>Topicss: </p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="advanced-design-considerations.html#GUID-B161D891-886D-4D53-89F0-BB42BD22C102">Opening Persistent LOBs with the OPEN and CLOSE Interfaces</a></p>
                  </li>
                  <li>
                     <p><a href="advanced-design-considerations.html#GUID-B1E476A2-F3FE-4D13-BC2B-FFB809698ED3">Read-Consistent Locators</a></p>
                  </li>
                  <li>
                     <p><a href="advanced-design-considerations.html#GUID-4DDA92CE-8C94-4DD1-9BA3-C6FC5ED7CAE0">LOB Locators and Transaction Boundaries </a></p>
                  </li>
                  <li>
                     <p><a href="advanced-design-considerations.html#GUID-4AA63439-3BCD-41A8-98D0-40923BFE0309">LOBs in the Object Cache</a></p>
                  </li>
                  <li>
                     <p><a href="advanced-design-considerations.html#GUID-FD6659DC-8792-4D7C-AC07-9EABEA02DF91">Terabyte-Size LOB Support</a></p>
                  </li>
                  <li>
                     <p><a href="advanced-design-considerations.html#GUID-B8E82069-4847-4116-9DA1-BFE6F99288C2">Guidelines for Creating Gigabyte LOBs</a></p>
                  </li>
               </ul>
            </div><a id="ADLOB1002"></a><div class="props_rev_3"><a id="GUID-B161D891-886D-4D53-89F0-BB42BD22C102" name="GUID-B161D891-886D-4D53-89F0-BB42BD22C102"></a><h3 id="ADLOB-GUID-B161D891-886D-4D53-89F0-BB42BD22C102" class="sect3">Opening Persistent LOBs with the OPEN and CLOSE Interfaces</h3>
               <div>
                  <div class="section">
                     <p>The <code class="codeph">OPEN</code> and <code class="codeph">CLOSE </code>interfaces enable you to explicitly open a persistent LOB instance. 
                     </p>
                     <p>When you open a LOB instance with the <code class="codeph">OPEN</code> interface, the instance remains open until you explicitly close the LOB using the <code class="codeph">CLOSE</code> interface. The <code class="codeph">ISOPEN</code> interface enables you to determine whether a persistent LOB is open. 
                     </p>
                     <p>Note that the open state of a LOB is associated with the LOB instance, not the LOB locator. The locator does not save any information indicating whether the LOB instance that it points to is open.</p>
                     <div class="infoboxnotealso" id="GUID-B161D891-886D-4D53-89F0-BB42BD22C102__GUID-7D365222-2E5E-407D-A4AC-74958528C67B">
                        <p class="notep1">See Also:</p>
                        <p><span class="q">"<a href="working-with-LOBs.html#GUID-20013E7E-EAAC-40C5-B190-20A759DBFF11" title="The LOB APIs include operations that enable you to explicitly open and close a LOB instance.">LOB Open and Close Operations0.</a>"</span>.
                        </p>
                     </div>
                     <p>Topics:</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="advanced-design-considerations.html#GUID-156DDAB9-8B9A-461B-9194-A91987198ECF">Index Performance Benefits of Explicitly Opening a LOB </a></p>
                        </li>
                        <li>
                           <p><a href="advanced-design-considerations.html#GUID-16CB7CF0-C7E9-4D91-88E6-DD2C9FD49783">Closing Explicitly Open LOB Instances </a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADLOB45330"></a><div class="props_rev_3"><a id="GUID-156DDAB9-8B9A-461B-9194-A91987198ECF" name="GUID-156DDAB9-8B9A-461B-9194-A91987198ECF"></a><h4 id="ADLOB-GUID-156DDAB9-8B9A-461B-9194-A91987198ECF" class="sect4">Index Performance Benefits of Explicitly Opening a LOB </h4>
                  <div>
                     <p>Explicitly opening a LOB instance can benefit performance of a persistent LOB in an indexed column. </p>
                     <p>If you do not explicitly open the LOB instance, then every modification to the LOB implicitly opens and closes the LOB instance. Any triggers on a domain index are fired each time the LOB is closed. Note that in this case, any domain indexes on the LOB are updated as soon as any modification to the LOB instance is made; the domain index is always valid and can be used at any time. </p>
                     <p>When you explicitly open a LOB instance, index triggers do not fire until you explicitly close the LOB. Using this technique can increase performance on index columns by eliminating unneeded indexing events until you explicitly close the LOB. Note that any index on the LOB column is not valid until you explicitly close the LOB. </p>
                  </div>
               </div><a id="ADLOB45331"></a><div class="props_rev_3"><a id="GUID-16CB7CF0-C7E9-4D91-88E6-DD2C9FD49783" name="GUID-16CB7CF0-C7E9-4D91-88E6-DD2C9FD49783"></a><h4 id="ADLOB-GUID-16CB7CF0-C7E9-4D91-88E6-DD2C9FD49783" class="sect4">Closing Explicitly Open LOB Instances </h4>
                  <div>
                     <div class="section">
                        <p>If you explicitly open a LOB instance, then you must close the LOB before you commit the transaction. </p>
                        <p>Committing a transaction on the open LOB instance causes an error. When this error occurs, the LOB instance is closed implicitly, any modifications to the LOB instance are saved, and the transaction is committed, but any indexes on the LOB column are not updated. In this situation, you must rebuild your indexes on the LOB column. </p>
                        <p>If you subsequently rollback the transaction, then the LOB instance is rolled back to its previous state, but the LOB instance is no longer explicitly open. </p>
                        <p>You must close any LOB instance that you explicitly open: </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Between DML statements that start a transaction, including <code class="codeph">SELECT</code> ... <code class="codeph">FOR</code> <code class="codeph">UPDATE</code> and <code class="codeph">COMMIT</code> 
                              </p>
                           </li>
                           <li>
                              <p>Within an autonomous transaction block</p>
                           </li>
                           <li>
                              <p>Before the end of a session (when there is no transaction involved) </p>
                              <p>If you do not explicitly close the LOB instance, then it is implicitly closed at the end of the session and no index triggers are fired. </p>
                           </li>
                        </ul>
                        <p>Keep track of the open or closed state of LOBs that you explicitly open. The following actions cause an error: </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Explicitly opening a LOB instance that has been explicitly open earlier. </p>
                           </li>
                           <li>
                              <p>Explicitly closing a LOB instance that is has been explicitly closed earlier. </p>
                           </li>
                        </ul>
                        <p>This occurs whether you access the LOB instance using the same locator or different locators. </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="ADLOB45332"></a><div class="props_rev_3"><a id="GUID-B1E476A2-F3FE-4D13-BC2B-FFB809698ED3" name="GUID-B1E476A2-F3FE-4D13-BC2B-FFB809698ED3"></a><h3 id="ADLOB-GUID-B1E476A2-F3FE-4D13-BC2B-FFB809698ED3" class="sect3">Read-Consistent Locators</h3>
               <div>
                  <p>Oracle Database provides the same read consistency mechanisms for LOBs as for all other database reads and updates of scalar quantities. </p>
                  <p>Read consistency has some special applications to LOB locators that you must understand. The following sections discuss read consistency and include examples which should be looked at in relationship to each other.</p>
                  <div class="infoboxnotealso" id="GUID-B1E476A2-F3FE-4D13-BC2B-FFB809698ED3__NOTE-134-DFDE2884">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="../cncpt/data-concurrency-and-consistency.html#CNCPT221" target="_blank"><span><cite>Oracle Database Concepts</cite></span></a> for general information about read consistency
                           </p>
                        </li>
                        <li>
                           <p><a href="working-with-LOBs.html#GUID-D71F0CBE-0717-41A2-BCD4-71E1DDF895D1" title="Many Oracle LOB examples use the print_media table of the Oracle Database Sample Schema PM.">Table for LOB Examples: The PM Schema print_media Table</a></p>
                        </li>
                     </ul>
                  </div>
                  <p>Topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="advanced-design-considerations.html#GUID-34EC32F1-51A9-4E72-ADDC-AA5B3D5E4BBC">A Selected Locator Becomes a Read-Consistent Locator</a></p>
                     </li>
                     <li>
                        <p><a href="advanced-design-considerations.html#GUID-0320FCED-13FE-4F6F-A68B-8A275F224780">Example of Updating LOBs and Read-Consistency</a></p>
                     </li>
                     <li>
                        <p><a href="advanced-design-considerations.html#GUID-9E8A72FB-D1A7-4151-B184-BB1FEC850BBD">Example of Updating LOBs Through Updated Locators</a></p>
                     </li>
                     <li>
                        <p><a href="advanced-design-considerations.html#GUID-A67D2857-7F83-4BCC-BF43-A0BA9C5EF9A0">Example of Updating a LOB Using SQL DML and DBMS_LOB</a></p>
                     </li>
                     <li>
                        <p><a href="advanced-design-considerations.html#GUID-58DED834-DFEB-4ED2-B24C-D1C0634F6A39">Example of Using One Locator to Update the Same LOB Value</a></p>
                     </li>
                     <li>
                        <p><a href="advanced-design-considerations.html#GUID-348E9FD8-2C50-4172-81B0-8BCC0D23144D">Example of Updating a LOB with a PL/SQL (DBMS_LOB) Bind Variable </a></p>
                     </li>
                  </ul>
               </div><a id="ADLOB45333"></a><div class="props_rev_3"><a id="GUID-34EC32F1-51A9-4E72-ADDC-AA5B3D5E4BBC" name="GUID-34EC32F1-51A9-4E72-ADDC-AA5B3D5E4BBC"></a><h4 id="ADLOB-GUID-34EC32F1-51A9-4E72-ADDC-AA5B3D5E4BBC" class="sect4">A Selected Locator Becomes a Read-Consistent Locator</h4>
                  <div>
                     <p><a id="d80928e567" class="indexterm-anchor"></a><a id="d80928e571" class="indexterm-anchor"></a><a id="d80928e575" class="indexterm-anchor"></a><a id="d80928e579" class="indexterm-anchor"></a><a id="d80928e583" class="indexterm-anchor"></a><a id="d80928e587" class="indexterm-anchor"></a>A selected locator, regardless of the existence of the <code class="codeph">FOR</code> <code class="codeph">UPDATE</code> clause, becomes a <span class="italic">read-consistent locator,</span> and remains a read-consistent locator until the LOB value is <a id="d80928e602" class="indexterm-anchor"></a><a id="d80928e606" class="indexterm-anchor"></a>updated through that locator. 
                     </p>
                     <p>A read-consistent locator contains the snapshot environment as of the point in time of the <code class="codeph">SELECT</code> operation. 
                     </p>
                     <p>This has some complex implications. Suppose you have created a read-consistent locator (<code class="codeph">L1</code>) by way of a <code class="codeph">SELECT</code> operation. In reading the value of the persistent LOB through <code class="codeph">L1</code>, note the following:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The LOB is read as of the point in time of the <code class="codeph">SELECT</code> statement even if the <code class="codeph">SELECT</code> statement includes a <code class="codeph">FOR</code> <code class="codeph">UPDATE</code>. 
                           </p>
                        </li>
                        <li>
                           <p>If the LOB value is updated through a different locator (<code class="codeph">L2</code>) in the same transaction, then <code class="codeph">L1</code> does not see the <code class="codeph">L2</code> updates. 
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">L1</code> does not see committed updates made to the LOB through another transaction.
                           </p>
                        </li>
                        <li>
                           <p>If the <a id="d80928e663" class="indexterm-anchor"></a><a id="d80928e665" class="indexterm-anchor"></a>read-consistent locator <code class="codeph">L1</code> is copied to another locator <code class="codeph">L2</code> (for example, by a PL/SQL assignment of two locator variables — <code class="codeph">L2:= L1</code>), then <code class="codeph">L2</code> becomes a read-consistent locator along with <code class="codeph">L1</code> and any data read is read as of the point in&nbsp;time of the <code class="codeph">SELECT</code> for <code class="codeph">L1</code>. 
                           </p>
                        </li>
                     </ul>
                     <p>You can use the existence of <a id="d80928e694" class="indexterm-anchor"></a>multiple locators to access different transformations of the LOB value. However, in doing so, you must keep track of the different values accessed by different locators. 
                     </p>
                  </div>
               </div><a id="ADLOB45334"></a><div class="props_rev_3"><a id="GUID-0320FCED-13FE-4F6F-A68B-8A275F224780" name="GUID-0320FCED-13FE-4F6F-A68B-8A275F224780"></a><h4 id="ADLOB-GUID-0320FCED-13FE-4F6F-A68B-8A275F224780" class="sect4">Example of Updating LOBs and Read-Consistency</h4>
                  <div>
                     <p>Read-consistent locators provide the same LOB value regardless of when the <code class="codeph">SELECT</code> occurs. 
                     </p>
                     <p>The following example demonstrates the relationship between read-consistency and updating in a simple example. Using the <code class="codeph">print_media</code> table described in <span class="q">"<a href="working-with-LOBs.html#GUID-D71F0CBE-0717-41A2-BCD4-71E1DDF895D1" title="Many Oracle LOB examples use the print_media table of the Oracle Database Sample Schema PM.">Table for LOB Examples: The PM Schema print_media Table</a>"</span> and PL/SQL, three <code class="codeph">CLOB</code> instances are created as potential locators: <code class="codeph">clob_selected</code>, <code class="codeph">clob_update</code>, and <code class="codeph">clob_copied</code>.
                     </p>
                     <p>Observe these progressions in the code, from times <code class="codeph">t1</code> through <code class="codeph">t6</code>:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>At the time of the first <code class="codeph">SELECT</code> <code class="codeph">INTO</code> (at <code class="codeph">t1</code>), the value in <code class="codeph">ad_sourcetext</code><span class="italic"> </span>is associated with the locator <code class="codeph">clob_selected</code><span class="italic">.</span> 
                           </p>
                        </li>
                        <li>
                           <p>In the second operation (at <code class="codeph">t2</code>), the value in <code class="codeph">ad_sourcetext</code><span class="italic"> </span>is associated with the locator <code class="codeph">clob_updated</code><span class="italic">.</span> Because there has been no change in the value of <code class="codeph">ad_sourcetext</code><span class="italic"> </span>between <code class="codeph">t1</code> and <code class="codeph">t2</code>, both <code class="codeph">clob_selected</code> and <code class="codeph">clob_updated</code> are read-consistent locators that effectively have the same value even though they reflect snapshots taken at different moments in time.
                           </p>
                        </li>
                        <li>
                           <p>The third operation (at <code class="codeph">t3</code>) copies the value in <code class="codeph">clob_selected</code> to <code class="codeph">clob_copied</code>. At this juncture, all three locators see the same value. The example demonstrates this with a series of <code class="codeph">DBMS_LOB</code>.<code class="codeph">READ()</code> calls. 
                           </p>
                        </li>
                        <li>
                           <p>At time <code class="codeph">t4</code>, the program uses <code class="codeph">DBMS_LOB</code>.<code class="codeph">WRITE()</code> to alter the value in <code class="codeph">clob_updated</code>, and a <code class="codeph">DBMS_LOB</code>.<code class="codeph">READ()</code> reveals a new value.
                           </p>
                        </li>
                        <li>
                           <p>However, a <code class="codeph">DBMS_LOB</code>.<code class="codeph">READ()</code> of the value through <code class="codeph">clob_selected</code> (at <code class="codeph">t5</code>) reveals that it is a read-consistent locator, continuing to refer to the same value as of the time of its <code class="codeph">SELECT</code>.
                           </p>
                        </li>
                        <li>
                           <p>Likewise, a <code class="codeph">DBMS_LOB</code>.<code class="codeph">READ()</code> of the value through <code class="codeph">clob_copied</code> (at <code class="codeph">t6</code>) reveals that it is a read-consistent locator, continuing to refer to the same value as <code class="codeph">clob_selected</code>.
                           </p>
                        </li>
                     </ul>
                     <div class="example" id="GUID-0320FCED-13FE-4F6F-A68B-8A275F224780__GUID-8E9FDC39-B5CE-4D31-8770-A7471CC2113E">
                        <p class="titleinexample">Example 14-1 </p><pre class="oac_no_warn" dir="ltr">INSERT INTO PRINT_MEDIA VALUES (2056, 20020, EMPTY_BLOB(), 
    'abcd', EMPTY_CLOB(), EMPTY_CLOB(), NULL, NULL, NULL, NULL);

COMMIT;

DECLARE
  num_var           INTEGER;
  clob_selected     CLOB;
  clob_updated      CLOB;
  clob_copied       CLOB;
  read_amount       INTEGER;
  read_offset       INTEGER;
  write_amount      INTEGER;
  write_offset      INTEGER;
  buffer            VARCHAR2(20);

BEGIN
  -- At time t1:
  SELECT ad_sourcetext INTO clob_selected
     FROM Print_media
     WHERE ad_id = 20020;

  -- At time t2:
  SELECT ad_sourcetext INTO clob_updated
     FROM Print_media
     WHERE ad_id = 20020
     FOR UPDATE;

  -- At time t3:
  clob_copied := clob_selected;
  -- After the assignment, both the clob_copied and the
  -- clob_selected have the same snapshot as of the point in time
  -- of the SELECT into clob_selected

  -- Reading from the clob_selected and the clob_copied does
  -- return the same LOB value. clob_updated also sees the same
  -- LOB value as of its select:
  read_amount := 10;
  read_offset := 1;
  dbms_lob.read(clob_selected, read_amount, read_offset, buffer);
  dbms_output.put_line('clob_selected value: ' || buffer);
  -- Produces the output 'abcd'

  read_amount := 10;
  dbms_lob.read(clob_copied, read_amount, read_offset, buffer);
  dbms_output.put_line('clob_copied value: ' || buffer);
  -- Produces the output 'abcd'

  read_amount := 10;
  dbms_lob.read(clob_updated, read_amount, read_offset, buffer);
  dbms_output.put_line('clob_updated value: ' || buffer);
  -- Produces the output 'abcd'

  -- At time t4:
  write_amount := 3;
  write_offset := 5;
  buffer := 'efg';
  dbms_lob.write(clob_updated, write_amount, write_offset, buffer);

  read_amount := 10;
  dbms_lob.read(clob_updated, read_amount, read_offset, buffer);
  dbms_output.put_line('clob_updated value: ' || buffer);
  -- Produces the output 'abcdefg'

  -- At time t5:
  read_amount := 10;
  dbms_lob.read(clob_selected, read_amount, read_offset, buffer);
  dbms_output.put_line('clob_selected value: ' || buffer);
  -- Produces the output 'abcd'

  -- At time t6:
  read_amount := 10;
  dbms_lob.read(clob_copied, read_amount, read_offset, buffer);
  dbms_output.put_line('clob_copied value: ' || buffer);
  -- Produces the output 'abcd'
END;
/</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="ADLOB45335"></a><div class="props_rev_3"><a id="GUID-9E8A72FB-D1A7-4151-B184-BB1FEC850BBD" name="GUID-9E8A72FB-D1A7-4151-B184-BB1FEC850BBD"></a><h4 id="ADLOB-GUID-9E8A72FB-D1A7-4151-B184-BB1FEC850BBD" class="sect4">Example of Updating LOBs Through Updated Locators</h4>
                  <div>
                     <p> <a id="d80928e1017" class="indexterm-anchor"></a>When you update the value of the persistent LOB through the LOB locator (<code class="codeph">L1</code>), <code class="codeph">L1</code> is updated to contain the current snapshot environment. 
                     </p>
                     <p>This snapshot is as of the time after the operation was completed on the LOB value through locator <code class="codeph">L1</code>. <code class="codeph">L1</code> is then termed an updated locator. This operation enables you to<span class="italic"> </span>see your own changes to the LOB value on the next read through the same locator, <code class="codeph">L1</code>.
                     </p>
                     <div class="infoboxnote" id="GUID-9E8A72FB-D1A7-4151-B184-BB1FEC850BBD__GUID-752D9A48-DEAE-43FE-89E3-C7A3E91C0D5A">
                        <p class="notep1">Note:</p>
                        <p>The snapshot environment in the locator is <span class="italic">not</span> updated if the locator is used to merely read the LOB value. It is only updated when you modify the LOB value through the locator using the PL/SQL <code class="codeph">DBMS_LOB</code> package or the OCI LOB APIs.
                        </p>
                     </div>
                     <p>Any committed updates made by a different transaction are seen by L1 only if your transaction is a read-committed transaction and if you use L1 to update the LOB value after the other transaction committed. </p>
                     <div class="infoboxnote" id="GUID-9E8A72FB-D1A7-4151-B184-BB1FEC850BBD__GUID-F5B165F6-9804-478E-B238-8A09441E318D">
                        <p class="notep1">Note:</p>
                        <p>When you update a persistent LOB value, the modification is always made to the most current LOB value.</p>
                     </div>
                     <p>Updating the value of the persistent LOB through any of the available methods, such as OCI LOB APIs or PL/SQL <code class="codeph">DBMS_LOB</code> package, updates the LOB value <span class="italic">and then reselects</span> the locator that refers to the new LOB value. 
                     </p>
                     <div class="infoboxnote" id="GUID-9E8A72FB-D1A7-4151-B184-BB1FEC850BBD__GUID-8AF165C7-9268-4D1A-B1ED-A4D2A3D4BBA3">
                        <p class="notep1">Note:</p>
                        <p>Once you have selected out a LOB locator by whatever means, you can read from the locator but not write into it.</p>
                        <p>Note that updating the LOB value through SQL is merely an <code class="codeph">UPDATE</code> statement. It is up to you to do the reselect of the LOB locator or use the <code class="codeph">RETURNING</code> clause in the <code class="codeph">UPDATE</code> statement so that the locator can see the changes made by the <code class="codeph">UPDATE</code> statement. Unless you reselect the LOB locator or use the <code class="codeph">RETURNING</code> clause, you may think you are reading the latest value when this is not the case. For this reason you should avoid mixing SQL DML with <code class="codeph">OCI</code> and <code class="codeph">DBMS_LOB</code> <a id="d80928e1091" class="indexterm-anchor"></a>piecewise operations.
                        </p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-9E8A72FB-D1A7-4151-B184-BB1FEC850BBD__GUID-673A1EC2-9B4A-4212-805C-A07C62B163A7">
                        <p class="notep1">See Also:</p>
                        <p><a href="../lnpls/overview.html#LNPLS-GUID-2FBCFBBE-6B42-4DB8-83F3-55B63B75B1EB" target="_blank"><span><cite>Oracle Database PL/SQL Language Reference</cite></span></a></p>
                     </div>
                  </div>
               </div><a id="ADLOB45336"></a><div class="props_rev_3"><a id="GUID-A67D2857-7F83-4BCC-BF43-A0BA9C5EF9A0" name="GUID-A67D2857-7F83-4BCC-BF43-A0BA9C5EF9A0"></a><h4 id="ADLOB-GUID-A67D2857-7F83-4BCC-BF43-A0BA9C5EF9A0" class="sect4">Example of Updating a LOB Using SQL DML and DBMS_LOB</h4>
                  <div>
                     <p>Using the <code class="codeph">Print_media</code> table in the following example, a <code class="codeph">CLOB</code> locator is created as <code class="codeph">clob_selected</code>. Note the following progressions in the example, from times <code class="codeph">t1</code> through <code class="codeph">t3</code>:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>At the time of the first <code class="codeph">SELECT</code> <code class="codeph">INTO</code> (at <code class="codeph">t1</code>), the value in <code class="codeph">ad_sourcetext</code> is associated with the locator <code class="codeph">clob_selected</code>.   
                           </p>
                        </li>
                        <li>
                           <p>In the second operation (at <code class="codeph">t2</code>), the value in <code class="codeph">ad_sourcetext</code> is modified through the <code class="codeph">SQL</code> <code class="codeph">UPDATE</code> statement, without affecting the <code class="codeph">clob_selected</code> locator. The locator still sees the value of the LOB as of the point in time of the original <code class="codeph">SELECT</code>. In other words, the locator does not see the update made using the SQL <code class="codeph">UPDATE</code> statement. This is illustrated by the subsequent <code class="codeph">DBMS_LOB</code>.<code class="codeph">READ()</code> call. 
                           </p>
                        </li>
                        <li>
                           <p>The third operation (at <code class="codeph">t3</code>) re-selects the LOB value into the locator <code class="codeph">clob_selected</code>. The locator is thus updated with the latest snapshot environment which allows the locator to see the change made by the previous SQL <code class="codeph">UPDATE</code> statement. Therefore, in the next <code class="codeph">DBMS_LOB</code>.<code class="codeph">READ()</code>, an error is returned because the LOB value is empty, that is, it does not contain any data.
                           </p>
                        </li>
                     </ul><pre class="oac_no_warn" dir="ltr">INSERT INTO Print_media VALUES (3247, 20010, EMPTY_BLOB(), 
    'abcd', EMPTY_CLOB(), EMPTY_CLOB(), NULL, NULL, NULL, NULL);

COMMIT;

DECLARE
  num_var           INTEGER;
  clob_selected     CLOB;
  read_amount       INTEGER;
  read_offset       INTEGER;
  buffer            VARCHAR2(20);

BEGIN

  -- At time t1:
  SELECT ad_sourcetext INTO clob_selected
  FROM Print_media
  WHERE ad_id = 20010;

  read_amount := 10;
  read_offset := 1;
  dbms_lob.read(clob_selected, read_amount, read_offset, buffer);
  dbms_output.put_line('clob_selected value: ' || buffer);
  -- Produces the output 'abcd'

  -- At time t2:
  UPDATE Print_media SET ad_sourcetext = empty_clob()
      WHERE ad_id = 20010;
  -- although the most current LOB value is now empty,
  -- clob_selected still sees the LOB value as of the point
  -- in time of the SELECT

  read_amount := 10;
  dbms_lob.read(clob_selected, read_amount, read_offset, buffer);
  dbms_output.put_line('clob_selected value: ' || buffer);
  -- Produces the output 'abcd'

  -- At time t3:
  SELECT ad_sourcetext INTO clob_selected FROM Print_media WHERE
       ad_id = 20010;
  -- the SELECT allows clob_selected to see the most current
  -- LOB value

  read_amount := 10;
  dbms_lob.read(clob_selected, read_amount, read_offset, buffer);
  -- ERROR: ORA-01403: no data found
END;
/</pre></div>
               </div><a id="ADLOB45337"></a><div class="props_rev_3"><a id="GUID-58DED834-DFEB-4ED2-B24C-D1C0634F6A39" name="GUID-58DED834-DFEB-4ED2-B24C-D1C0634F6A39"></a><h4 id="ADLOB-GUID-58DED834-DFEB-4ED2-B24C-D1C0634F6A39" class="sect4">Example of Using One Locator to Update the Same LOB Value</h4>
                  <div>
                     <div class="infoboxnote" id="GUID-58DED834-DFEB-4ED2-B24C-D1C0634F6A39__GUID-D926ECC0-DEF7-49B0-B23E-E4022CE5EACF">
                        <p class="notep1">Note:</p>
                        <p>Avoid <a id="d80928e1337" class="indexterm-anchor"></a>updating the same LOB with different locators. You may avoid many pitfalls if you use only one locator to update a given LOB value.
                        </p>
                     </div>
                     <p>In the following example, using table <code class="codeph">Print_media</code>, two <code class="codeph">CLOB</code>s are created as potential locators: clob_updated and clob_copied.
                     </p>
                     <p>Note these progressions in the example at times t1 through t5:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>At the time of the first <code class="codeph">SELECT</code> <code class="codeph">INTO</code> (at <code class="codeph">t1</code>), the value in <code class="codeph">ad_sourcetext</code> is associated with the locator <code class="codeph">clob_updated</code>. 
                           </p>
                        </li>
                        <li>
                           <p>The second operation (at time <code class="codeph">t2</code>) copies the value in <code class="codeph">clob_updated</code> to <code class="codeph">clob_copied</code>. At this time, both locators see the same value. The example demonstrates this with a series of <code class="codeph">DBMS_LOB</code>.<code class="codeph">READ()</code> calls. 
                           </p>
                        </li>
                        <li>
                           <p>At time <code class="codeph">t3</code>, the program uses <code class="codeph">DBMS_LOB</code>.<code class="codeph">WRITE()</code> to alter the value in <code class="codeph">clob_updated</code>, and a <code class="codeph">DBMS_LOB.READ()</code> reveals a new value. 
                           </p>
                        </li>
                        <li>
                           <p>However, a <code class="codeph">DBMS_LOB</code>.<code class="codeph">READ()</code> of the value through <code class="codeph">clob_copied</code> (at time<code class="codeph"> t4</code>) reveals that it still sees the value of the LOB as of the point in time of the assignment from <code class="codeph">clob_updated</code> (at <code class="codeph">t2</code>).
                           </p>
                        </li>
                        <li>
                           <p>It is not until <code class="codeph">clob_updated</code> is assigned to <code class="codeph">clob_copied</code> (<code class="codeph">t5</code>) that <code class="codeph">clob_copied</code> sees the modification made by <code class="codeph">clob_updated</code>. 
                           </p>
                        </li>
                     </ul><pre class="oac_no_warn" dir="ltr">INSERT INTO PRINT_MEDIA VALUES (2049, 20030, EMPTY_BLOB(), 
    'abcd', EMPTY_CLOB(), EMPTY_CLOB(), NULL, NULL, NULL, NULL);

COMMIT;

DECLARE
  num_var          INTEGER;
  clob_updated     CLOB;
  clob_copied      CLOB;
  read_amount      INTEGER;
  read_offset      INTEGER;
  write_amount     INTEGER;
  write_offset     INTEGER;
  buffer           VARCHAR2(20);
BEGIN

-- At time t1:
  SELECT ad_sourcetext INTO clob_updated FROM PRINT_MEDIA
      WHERE ad_id = 20030
      FOR UPDATE;

  -- At time t2:
  clob_copied := clob_updated;
  -- after the assign, clob_copied and clob_updated see the same
  -- LOB value

  read_amount := 10;
  read_offset := 1;
  dbms_lob.read(clob_updated, read_amount, read_offset, buffer);
  dbms_output.put_line('clob_updated value: ' || buffer);
  -- Produces the output 'abcd'

  read_amount := 10;
  dbms_lob.read(clob_copied, read_amount, read_offset, buffer);
  dbms_output.put_line('clob_copied value: ' || buffer);
  -- Produces the output 'abcd'

  -- At time t3:
  write_amount := 3;
  write_offset := 5;
  buffer := 'efg';
  dbms_lob.write(clob_updated, write_amount, write_offset,
        buffer);

  read_amount := 10;
  dbms_lob.read(clob_updated, read_amount, read_offset, buffer);
  dbms_output.put_line('clob_updated value: ' || buffer);
  -- Produces the output 'abcdefg'


  -- At time t4:
  read_amount := 10;
  dbms_lob.read(clob_copied, read_amount, read_offset, buffer);
  dbms_output.put_line('clob_copied value: ' || buffer);
  -- Produces the output 'abcd'

  -- At time t5:
  clob_copied := clob_updated;

  read_amount := 10;
  dbms_lob.read(clob_copied, read_amount, read_offset, buffer);
  dbms_output.put_line('clob_copied value: ' || buffer);
  -- Produces the output 'abcdefg'
END;
/</pre></div>
               </div><a id="ADLOB45338"></a><div class="props_rev_3"><a id="GUID-348E9FD8-2C50-4172-81B0-8BCC0D23144D" name="GUID-348E9FD8-2C50-4172-81B0-8BCC0D23144D"></a><h4 id="ADLOB-GUID-348E9FD8-2C50-4172-81B0-8BCC0D23144D" class="sect4">Example of Updating a LOB with a PL/SQL (DBMS_LOB) Bind Variable </h4>
                  <div>
                     <p>When a LOB locator is used as the source to update another persistent LOB (as in a SQL <code class="codeph">INSERT</code> or <code class="codeph">UPDATE</code> statement, the <code class="codeph">DBMS_LOB</code>.<code class="codeph">COPY</code> routine, and so on), the snapshot environment in the source LOB locator determines the LOB value that is used as the source.
                     </p>
                     <p>If the source locator (for example <code class="codeph">L1</code>) is a <a id="d80928e1551" class="indexterm-anchor"></a><a id="d80928e1553" class="indexterm-anchor"></a>read-consistent locator, then the LOB value as of the time of the <code class="codeph">SELECT</code> of <code class="codeph">L1</code> is used. If the source locator (for example <code class="codeph">L2</code>) is an updated locator, then the LOB value associated with the <code class="codeph">L2</code> snapshot environment at the time of the operation is used. 
                     </p>
                     <p>In the following example, three <code class="codeph">CLOB</code>s are created as potential locators: <code class="codeph">clob_selected</code>, clob_updated, and clob_copied.
                     </p>
                     <p>Note these progressions in the example at times <code class="codeph">t1</code> through <code class="codeph">t5</code>:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>At the time of the first <code class="codeph">SELECT</code> <code class="codeph">INTO</code> (at <code class="codeph">t1</code>), the value in <code class="codeph">ad_sourcetext</code> is associated with the locator <code class="codeph">clob_updated</code>. 
                           </p>
                        </li>
                        <li>
                           <p>The second operation (at <code class="codeph">t2</code>) copies the value in <code class="codeph">clob_updated</code> to <code class="codeph">clob_copied</code>. At this juncture, both locators see the same value. 
                           </p>
                        </li>
                        <li>
                           <p>Then (at <code class="codeph">t3</code>), the program uses <code class="codeph">DBMS_LOB</code>.<code class="codeph">WRITE()</code> to alter the value in<code class="codeph"> clob_updated</code><span class="italic">, </span>and a <code class="codeph">DBMS_LOB</code>.<code class="codeph">READ()</code> reveals a new value.
                           </p>
                        </li>
                        <li>
                           <p>However, a <code class="codeph">DBMS_LOB</code>.<code class="codeph">READ()</code> of the value through <code class="codeph">clob_copied</code> (at <code class="codeph">t4</code>) reveals that <code class="codeph">clob_copied</code> does not see the change made by <code class="codeph">clob_updated</code>. 
                           </p>
                        </li>
                        <li>
                           <p>Therefore (at <code class="codeph">t5</code>), when <code class="codeph">clob_copied</code> is used as the source for the value of the <code class="codeph">INSERT</code> statement, the value associated with <code class="codeph">clob_copied</code> (for example, without the new changes made by <code class="codeph">clob_updated</code>) is inserted. This is demonstrated by the subsequent <code class="codeph">DBMS_LOB</code>.<code class="codeph">READ()</code> of the value just inserted. 
                           </p>
                        </li>
                     </ul><pre class="oac_no_warn" dir="ltr">INSERT INTO PRINT_MEDIA VALUES (2056, 20020, EMPTY_BLOB(), 
    'abcd', EMPTY_CLOB(), EMPTY_CLOB(), NULL, NULL, NULL, NULL);

COMMIT;

DECLARE
  num_var           INTEGER;
  clob_selected     CLOB;
  clob_updated      CLOB;
  clob_copied       CLOB;
  read_amount       INTEGER;
  read_offset       INTEGER;
  write_amount      INTEGER;
  write_offset      INTEGER;
  buffer            VARCHAR2(20);
BEGIN

  -- At time t1:
  SELECT ad_sourcetext INTO clob_updated FROM PRINT_MEDIA
      WHERE ad_id = 20020
      FOR UPDATE;

  read_amount := 10;
  read_offset := 1;
  dbms_lob.read(clob_updated, read_amount, read_offset, buffer);
  dbms_output.put_line('clob_updated value: ' || buffer);
  -- Produces the output 'abcd'

  -- At time t2:
  clob_copied := clob_updated;


  -- At time t3:
  write_amount := 3;
  write_offset := 5;
  buffer := 'efg';
  dbms_lob.write(clob_updated, write_amount, write_offset, buffer);

  read_amount := 10;
  dbms_lob.read(clob_updated, read_amount, read_offset, buffer);
  dbms_output.put_line('clob_updated value: ' || buffer);
  -- Produces the output 'abcdefg'
  -- note that clob_copied does not see the write made before
  -- clob_updated


  -- At time t4:
  read_amount := 10;
  dbms_lob.read(clob_copied, read_amount, read_offset, buffer);
  dbms_output.put_line('clob_copied value: ' || buffer);
  -- Produces the output 'abcd'

  -- At time t5:
  -- the insert uses clob_copied view of the LOB value which does
  -- not include clob_updated changes
  INSERT INTO PRINT_MEDIA VALUES (2056, 20022, EMPTY_BLOB(), 
    clob_copied, EMPTY_CLOB(), EMPTY_CLOB(), NULL, NULL, NULL, NULL)
    RETURNING ad_sourcetext INTO clob_selected;

  read_amount := 10;
  dbms_lob.read(clob_selected, read_amount, read_offset, buffer);
  dbms_output.put_line('clob_selected value: ' || buffer);
  -- Produces the output 'abcd'
END;
/</pre></div>
               </div>
            </div><a id="ADLOB45339"></a><div class="props_rev_3"><a id="GUID-4DDA92CE-8C94-4DD1-9BA3-C6FC5ED7CAE0" name="GUID-4DDA92CE-8C94-4DD1-9BA3-C6FC5ED7CAE0"></a><h3 id="ADLOB-GUID-4DDA92CE-8C94-4DD1-9BA3-C6FC5ED7CAE0" class="sect3">LOB Locators and Transaction Boundaries </h3>
               <div>
                  <p>LOB locators can be used in transactions and transaction IDs. </p>
                  <div class="infoboxnotealso" id="GUID-4DDA92CE-8C94-4DD1-9BA3-C6FC5ED7CAE0__LOBLOCATORSANDBFILELOCATORSFORMOREI-DFDE82BC">
                     <p class="notep1">See Also:</p>
                     <p><a href="working-with-LOBs.html#GUID-747411EC-7E86-4756-A8DC-CE19923BF8A6" title="There are differences between the semantics of locators for the LOB types BLOB, CLOB, and NCLOB, and the semantics of locators for the BFILE type:">LOB Locators and BFILE Locators</a> for more information about LOB locators
                     </p>
                  </div>
                  <p>Topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="advanced-design-considerations.html#GUID-C4E6C558-239B-474C-B587-31D8452EBAB1">About LOB Locators and Transaction Boundaries</a></p>
                     </li>
                     <li>
                        <p><a href="advanced-design-considerations.html#GUID-F4B23AD1-2E5F-49ED-ABBE-10E6B109BE3E">Read and Write Operations on a LOB Using Locators</a></p>
                     </li>
                     <li>
                        <p><a href="advanced-design-considerations.html#GUID-1A6259F3-2F83-4AD5-B79F-0B0130D3608F">Selecting the Locator Outside of the Transaction Boundary</a></p>
                     </li>
                     <li>
                        <p><a href="advanced-design-considerations.html#GUID-5E2C762D-F4B4-4D03-AE92-0940671C21E3">Selecting the Locator Within a Transaction Boundary</a></p>
                     </li>
                     <li>
                        <p><a href="advanced-design-considerations.html#GUID-0FFBCC15-1C19-4B48-A570-F6BF197BB2B8">LOB Locators Cannot Span Transactions</a></p>
                     </li>
                     <li>
                        <p><a href="advanced-design-considerations.html#GUID-F973C33A-EA4D-4B1B-A7EA-C258BE6B44A8">Example of Locator Not Spanning a Transaction </a></p>
                     </li>
                  </ul>
               </div>
               <div class="props_rev_3"><a id="GUID-C4E6C558-239B-474C-B587-31D8452EBAB1" name="GUID-C4E6C558-239B-474C-B587-31D8452EBAB1"></a><h4 id="ADLOB-GUID-C4E6C558-239B-474C-B587-31D8452EBAB1" class="sect4">About LOB Locators and Transaction Boundaries</h4>
                  <div>
                     <p>Note the following regarding LOB locators and transactions: </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Locators contain <a id="d80928e1886" class="indexterm-anchor"></a>transaction IDs when:
                           </p>
                           <p>You Begin the Transaction, Then Select Locator:  If you begin a transaction and subsequently select a locator, then the locator contains the transaction ID. Note that you can implicitly be in a transaction without explicitly beginning one. For example, <code class="codeph">SELECT</code>... <code class="codeph">FOR</code> <code class="codeph">UPDATE</code> implicitly begins a transaction. In such a case, the locator contains a transaction ID. 
                           </p>
                        </li>
                        <li>
                           <p>Locators Do Not Contain Transaction IDs When...</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>You are Outside the Transaction, Then Select Locator:<span class="bold"> </span>By contrast, if you select a locator outside of a transaction, then the locator does not contain a transaction ID. 
                                 </p>
                              </li>
                              <li>
                                 <p>When Selected Prior to DML Statement Execution: A transaction ID is not assigned until the first DML statement executes. Therefore, locators that are selected prior to such a DML statement do not contain a transaction ID. </p>
                              </li>
                           </ul>
                        </li>
                     </ul>
                  </div>
               </div><a id="ADLOB45340"></a><div class="props_rev_3"><a id="GUID-F4B23AD1-2E5F-49ED-ABBE-10E6B109BE3E" name="GUID-F4B23AD1-2E5F-49ED-ABBE-10E6B109BE3E"></a><h4 id="ADLOB-GUID-F4B23AD1-2E5F-49ED-ABBE-10E6B109BE3E" class="sect4">Read and Write Operations on a LOB Using Locators</h4>
                  <div>
                     <p>You can always read LOB data using the locator irrespective of whether or not the locator contains a transaction ID. </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Cannot Write Using Locator:</p>
                           <p>If the locator contains a transaction ID, then you cannot write to the LOB outside of that particular transaction. </p>
                        </li>
                        <li>
                           <p>Can Write Using Locator: </p>
                           <p>If the locator <span class="italic">does not</span> contain a transaction ID, then you can write to the LOB after beginning a transaction either explicitly or implicitly. 
                           </p>
                        </li>
                        <li>
                           <p>Cannot Read or Write Using Locator With Serializable <a id="d80928e2004" class="indexterm-anchor"></a>Transactions: 
                           </p>
                           <p>If the locator contains a transaction ID of an older transaction, and the current transaction is serializable, then you cannot read or write using that locator. </p>
                        </li>
                        <li>
                           <p>Can Read, Not Write Using Locator With Non-Serializable <a id="d80928e2014" class="indexterm-anchor"></a>Transactions: 
                           </p>
                           <p>If the transaction is non-serializable, then you can read, but not write outside of that transaction.</p>
                        </li>
                     </ul>
                     <p>The examples <a href="advanced-design-considerations.html#GUID-1A6259F3-2F83-4AD5-B79F-0B0130D3608F">Selecting the Locator Outside of the Transaction Boundary</a>, <a href="advanced-design-considerations.html#GUID-5E2C762D-F4B4-4D03-AE92-0940671C21E3">Selecting the Locator Within a Transaction Boundary</a>, <a href="advanced-design-considerations.html#GUID-0FFBCC15-1C19-4B48-A570-F6BF197BB2B8">LOB Locators Cannot Span Transactions</a>, and <a href="advanced-design-considerations.html#GUID-F973C33A-EA4D-4B1B-A7EA-C258BE6B44A8">Example of Locator Not Spanning a Transaction </a>show the relationship between locators and <span class="italic">non-serializable</span> transactions
                     </p>
                  </div>
               </div><a id="ADLOB45342"></a><a id="ADLOB45343"></a><a id="ADLOB45341"></a><div class="props_rev_3"><a id="GUID-1A6259F3-2F83-4AD5-B79F-0B0130D3608F" name="GUID-1A6259F3-2F83-4AD5-B79F-0B0130D3608F"></a><h4 id="ADLOB-GUID-1A6259F3-2F83-4AD5-B79F-0B0130D3608F" class="sect4">Selecting the Locator Outside of the Transaction Boundary</h4>
                  <div>
                     <div class="section">
                        <p>Two scenarios describe techniques for using locators in non-serializable transactions when the locator is selected outside of a transaction. </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-1A6259F3-2F83-4AD5-B79F-0B0130D3608F__GUID-FD707175-9BA1-43D7-9D2B-33C70E3C3545">First Scenario:</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ol>
                           <li>
                              <p>Select the locator with no current transaction. At this point, the locator does not contain a transaction id.</p>
                           </li>
                           <li>
                              <p>Begin the transaction.</p>
                           </li>
                           <li>
                              <p>Use the locator to read data from the LOB.</p>
                           </li>
                           <li>
                              <p>Commit or rollback the transaction.</p>
                           </li>
                           <li>
                              <p>Use the locator to read data from the LOB.</p>
                           </li>
                           <li>
                              <p>Begin a transaction. The locator does not contain a transaction id.</p>
                           </li>
                           <li>
                              <p>Use the locator to write data to the LOB. This operation is valid because the locator did not contain a transaction id prior to the write. After this call, the locator contains a transaction id.</p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-1A6259F3-2F83-4AD5-B79F-0B0130D3608F__GUID-EE9BE963-90B1-4842-BECE-3A0A49FD4795">Second Scenario:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li><span>Select the locator with no current transaction. At this point, the locator does not contain a transaction id.</span></li>
                        <li><span>Begin the transaction. The locator does not contain a transaction id.</span></li>
                        <li><span>Use the locator to read data from the LOB. The locator does not contain a transaction id.</span></li>
                        <li><span>Use the locator to write data to the LOB. This operation is valid because the locator did not contain a transaction id prior to the write. After this call, the locator contains a transaction id. You can continue to read from or write to the LOB.</span></li>
                        <li><span>Commit or rollback the transaction. The locator continues to contain the transaction id.</span></li>
                        <li><span>Use the locator to read data from the LOB. This is a valid operation.</span></li>
                        <li><span>Begin a transaction. The locator contains the previous transaction id.</span></li>
                        <li><span>Use the locator to write data to the LOB. This write operation fails because the locator does not contain the transaction id that matches the current transaction.</span></li>
                     </ol>
                  </div>
               </div><a id="ADLOB45345"></a><a id="ADLOB45346"></a><a id="ADLOB45344"></a><div class="props_rev_3"><a id="GUID-5E2C762D-F4B4-4D03-AE92-0940671C21E3" name="GUID-5E2C762D-F4B4-4D03-AE92-0940671C21E3"></a><h4 id="ADLOB-GUID-5E2C762D-F4B4-4D03-AE92-0940671C21E3" class="sect4">Selecting the Locator Within a Transaction Boundary</h4>
                  <div>
                     <div class="section">
                        <p>Two scenarios describe techniques for using locators in non-serializable transactions when the locator is selected within a transaction. </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-5E2C762D-F4B4-4D03-AE92-0940671C21E3__GUID-833000E1-F340-44E0-8F6F-A67735BF0C64">First Scenario:</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ol>
                           <li>
                              <p>Select the locator within a transaction. At this point, the locator contains the transaction id.</p>
                           </li>
                           <li>
                              <p>Begin the transaction. The locator contains the previous transaction id.</p>
                           </li>
                           <li>
                              <p>Use the locator to read data from the LOB. This operation is valid even though the transaction id in the locator does not match the current transaction.</p>
                              <div class="infoboxnotealso" id="GUID-5E2C762D-F4B4-4D03-AE92-0940671C21E3__GUID-5ACAA208-E7F4-4FD7-9161-54BD3A6311CD">
                                 <p class="notep1">See Also:</p>
                                 <p><span class="q">"<a href="advanced-design-considerations.html#GUID-B1E476A2-F3FE-4D13-BC2B-FFB809698ED3">Read-Consistent Locators</a>"</span> for more information about using the locator to read LOB data.
                                 </p>
                              </div>
                           </li>
                           <li>
                              <p>Use the locator to write data to the LOB. This operation fails because the transaction id in the locator does not match the current transaction.</p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-5E2C762D-F4B4-4D03-AE92-0940671C21E3__GUID-708E4337-5B2F-4334-BABC-3A48EBA058CD">Second Scenario:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li><span>Begin a transaction.</span></li>
                        <li><span>Select the locator. The locator contains the transaction id because it was selected within a transaction.</span></li>
                        <li><span>Use the locator to read from or write to the LOB. These operations are valid.</span></li>
                        <li><span>Commit or rollback the transaction. The locator continues to contain the transaction id.</span></li>
                        <li><span>Use the locator to read data from the LOB. This operation is valid even though there is a transaction id in the locator and the transaction was previously committed or rolled back. </span></li>
                        <li><span>Use the locator to write data to the LOB. This operation fails because the transaction id in the locator is for a transaction that was previously committed or rolled back.</span></li>
                     </ol>
                  </div>
               </div><a id="ADLOB45347"></a><div class="props_rev_3"><a id="GUID-0FFBCC15-1C19-4B48-A570-F6BF197BB2B8" name="GUID-0FFBCC15-1C19-4B48-A570-F6BF197BB2B8"></a><h4 id="ADLOB-GUID-0FFBCC15-1C19-4B48-A570-F6BF197BB2B8" class="sect4">LOB Locators Cannot Span Transactions</h4>
                  <div>
                     <p><a id="d80928e2362" class="indexterm-anchor"></a><a id="d80928e2366" class="indexterm-anchor"></a>Modifying a persistent LOB value through the LOB locator using <code class="codeph">DBMS_LOB</code>, OCI, or SQL <code class="codeph">INSERT</code> or <code class="codeph">UPDATE</code> statements changes the locator from a <a id="d80928e2380" class="indexterm-anchor"></a><a id="d80928e2382" class="indexterm-anchor"></a>read-consistent locator to an updated locator. 
                     </p>
                     <p>The <code class="codeph">INSERT</code> or <code class="codeph">UPDATE</code> statement automatically starts a transaction and locks the row. Once this has occurred, the locator cannot be used outside the current transaction to modify the LOB value. In other words, LOB locators that are used to write data cannot span transactions. However, the locator can be used to read the LOB value unless you are in a serializable transaction.
                     </p>
                     <div class="infoboxnotealso" id="GUID-0FFBCC15-1C19-4B48-A570-F6BF197BB2B8__GUID-1B2250EF-98F1-40FF-BA86-94D58FEA560F">
                        <p class="notep1">See Also:</p>
                        <p><span class="q">"<a href="advanced-design-considerations.html#GUID-4DDA92CE-8C94-4DD1-9BA3-C6FC5ED7CAE0">LOB Locators and Transaction Boundaries </a>"</span>, for more information about the relationship between LOBs and transaction boundaries.
                        </p>
                     </div>
                     <p>In <a href="advanced-design-considerations.html#GUID-F973C33A-EA4D-4B1B-A7EA-C258BE6B44A8">Example of Locator Not Spanning a Transaction </a>, a <code class="codeph">CLOB</code> locator is created: <code class="codeph">clob_updated</code></p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>At the time of the first <code class="codeph">SELECT</code> <code class="codeph">INTO</code> (at t1), the value in <code class="codeph">ad_sourcetext</code> is associated with the locator <code class="codeph">clob_updated</code>. 
                           </p>
                        </li>
                        <li>
                           <p>The second operation (at t2), uses the <code class="codeph">DBMS_LOB</code>.<code class="codeph">WRITE</code> function to alter the value in <code class="codeph">clob_updated</code>, and a <code class="codeph">DBMS_LOB</code>.<code class="codeph">READ</code> reveals a new value.
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">commit</code> statement (at t3) ends the current transaction.
                           </p>
                        </li>
                        <li>
                           <p>Therefore (at t4), the subsequent <code class="codeph">DBMS_LOB</code>.<code class="codeph">WRITE</code> operation fails because the <code class="codeph">clob_updated</code> locator refers to a different (already committed) transaction. This is noted by the error returned. You must re-select the LOB locator before using it in further <code class="codeph">DBMS_LOB</code> (and OCI) modify operations.
                           </p>
                        </li>
                     </ul>
                  </div>
               </div><a id="ADLOB45348"></a><div class="props_rev_3"><a id="GUID-F973C33A-EA4D-4B1B-A7EA-C258BE6B44A8" name="GUID-F973C33A-EA4D-4B1B-A7EA-C258BE6B44A8"></a><h4 id="ADLOB-GUID-F973C33A-EA4D-4B1B-A7EA-C258BE6B44A8" class="sect4">Example of Locator Not Spanning a Transaction </h4>
                  <div>
                     <p>The example uses the <code class="codeph">print_media</code> table described in <span class="q">"<a href="working-with-LOBs.html#GUID-D71F0CBE-0717-41A2-BCD4-71E1DDF895D1" title="Many Oracle LOB examples use the print_media table of the Oracle Database Sample Schema PM.">Table for LOB Examples: The PM Schema print_media Table</a>"</span></p><pre class="oac_no_warn" dir="ltr">INSERT INTO PRINT_MEDIA VALUES (2056, 20010, EMPTY_BLOB(), 
    'abcd', EMPTY_CLOB(), EMPTY_CLOB(), NULL, NULL, NULL, NULL);

COMMIT;

DECLARE
  num_var          INTEGER;
  clob_updated     CLOB;
  read_amount      INTEGER;
  read_offset      INTEGER;
  write_amount     INTEGER;
  write_offset     INTEGER;
  buffer           VARCHAR2(20);

BEGIN
          -- At time t1:
     SELECT      ad_sourcetext
     INTO        clob_updated
     FROM        PRINT_MEDIA
     WHERE       ad_id = 20010
     FOR UPDATE;
     read_amount := 10;
     read_offset := 1;
     dbms_lob.read(clob_updated, read_amount, read_offset, buffer);
     dbms_output.put_line('clob_updated value: ' || buffer);
     -- This produces the output 'abcd'

     -- At time t2:
     write_amount := 3;
     write_offset := 5;
     buffer := 'efg';
     dbms_lob.write(clob_updated, write_amount, write_offset, buffer);
     read_amount := 10;
     dbms_lob.read(clob_updated, read_amount, read_offset, buffer);
     dbms_output.put_line('clob_updated value: ' || buffer);
     -- This produces the output 'abcdefg'

    -- At time t3:
    COMMIT;

     -- At time t4:
    dbms_lob.write(clob_updated , write_amount, write_offset, buffer);
    -- ERROR: ORA-22990: LOB locators cannot span transactions
END;
/</pre></div>
               </div>
            </div><a id="ADLOB45349"></a><div class="sect2"><a id="GUID-4AA63439-3BCD-41A8-98D0-40923BFE0309" name="GUID-4AA63439-3BCD-41A8-98D0-40923BFE0309"></a><h3 id="ADLOB-GUID-4AA63439-3BCD-41A8-98D0-40923BFE0309" class="sect3">LOBs in the Object Cache</h3>
               <div>
                  <p>When you copy one object to another in the object cache with a LOB locator attribute, only the LOB locator is copied. </p>
                  <p>This means that the LOB attribute in these two different objects contain exactly the same locator which refers to <span class="italic">one and the same </span>LOB<span class="italic"> value</span>. Only when the target object is flushed is a separate, physical copy of the LOB value made, which is distinct from the source LOB value. 
                  </p>
                  <div class="infoboxnotealso" id="GUID-4AA63439-3BCD-41A8-98D0-40923BFE0309__GUID-157C222F-614E-43AE-A1D2-BB6C241C3E2F">
                     <p class="notep1">See Also:</p>
                     <p><span class="q">"<a href="advanced-design-considerations.html#GUID-0320FCED-13FE-4F6F-A68B-8A275F224780">Example of Updating LOBs and Read-Consistency</a>"</span> for a description of what version of the LOB value is seen by each object if a write is performed through one of the locators.
                     </p>
                  </div>
                  <p>Therefore, in cases where you want to modify the LOB that was the target of the copy, <span class="italic"><span class="bold">you must flush the target object, refresh the target object, and then </span></span>write to the LOB through the locator attribute.
                  </p>
                  <p>Consider these object cache issues for internal and external LOB attributes:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Persistent LOB attributes: Creating an object in object cache, sets the LOB attribute to empty. <a id="d80928e2668" class="indexterm-anchor"></a><a id="d80928e2672" class="indexterm-anchor"></a><a id="d80928e2676" class="indexterm-anchor"></a></p>
                        <p>When you create an object in the object cache that contains a persistent LOB attribute, the LOB attribute is implicitly set to empty. You may not use this empty LOB locator to write data to the LOB. You must first flush the object, thereby inserting a row into the table and creating an empty LOB — that is, a LOB with 0 length. Once the object is refreshed in the object cache (use <code class="codeph">OCI_PIN_LATEST</code>), the real LOB locator is read into the attribute, and you can then call the OCI LOB API to write data to the LOB. 
                        </p>
                     </li>
                     <li>
                        <p>External LOB (<code class="codeph">BFILE</code>) attributes: Creating an object in object cache, sets the <code class="codeph">BFILE</code> attribute to <code class="codeph">NULL</code>. 
                        </p>
                        <p>When creating an object with an external LOB (<code class="codeph">BFILE)</code> attribute, the <code class="codeph">BFILE</code> is set to <code class="codeph">NULL</code>. It must be updated with a valid directory object name and file name before reading from the <code class="codeph">BFILE</code>. 
                        </p>
                     </li>
                  </ul>
               </div>
            </div><a id="ADLOB102"></a><div class="props_rev_3"><a id="GUID-FD6659DC-8792-4D7C-AC07-9EABEA02DF91" name="GUID-FD6659DC-8792-4D7C-AC07-9EABEA02DF91"></a><h3 id="ADLOB-GUID-FD6659DC-8792-4D7C-AC07-9EABEA02DF91" class="sect3">Terabyte-Size LOB Support</h3>
               <div>
                  <p><a id="d80928e2774" class="indexterm-anchor"></a><a id="d80928e2778" class="indexterm-anchor"></a><a id="d80928e2782" class="indexterm-anchor"></a>Terabyte-size LOBs are LOBs that are up to a maximum size of 8 to 128 terabytes depending on database block size. 
                  </p>
                  <p>Topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="advanced-design-considerations.html#GUID-74618664-CE35-48FB-85C6-E03CD2063BD1">About Terabyte-Size LOB Support</a></p>
                     </li>
                     <li>
                        <p><a href="advanced-design-considerations.html#GUID-A84520F4-05EF-48F3-B2A4-9CC001192B23">Maximum Storage Limit for Terabyte-Size LOBs</a></p>
                     </li>
                     <li>
                        <p><a href="advanced-design-considerations.html#GUID-0A6B471E-85EC-429C-AA20-29944A96939E">Using Terabyte-Size LOBs with JDBC</a></p>
                     </li>
                     <li>
                        <p><a href="advanced-design-considerations.html#GUID-1DEA56D9-5CBD-4211-88DB-87B4329B02F6">Using Terabyte-Size LOBs with the DBMS_LOB Package</a></p>
                     </li>
                     <li>
                        <p><a href="advanced-design-considerations.html#GUID-A40086A3-2F4D-4153-B4DE-7C02C7CE08A8">Using Terabyte-Size LOBs with OCI</a></p>
                     </li>
                  </ul>
               </div>
               <div class="props_rev_3"><a id="GUID-74618664-CE35-48FB-85C6-E03CD2063BD1" name="GUID-74618664-CE35-48FB-85C6-E03CD2063BD1"></a><h4 id="ADLOB-GUID-74618664-CE35-48FB-85C6-E03CD2063BD1" class="sect4">About Terabyte-Size LOB Support</h4>
                  <div>
                     <p>Terabyte-size LOBs are supported by the following APIs:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Java using JDBC (Java Database Connectivity)</p>
                        </li>
                        <li>
                           <p>PL/SQL using the DBMS_LOB Package</p>
                        </li>
                        <li>
                           <p>C using OCI (Oracle Call Interface)</p>
                        </li>
                     </ul>
                     <p>You cannot create and use LOB instances of size greater than 4 gigabytes "terabyte-size LOBs"— in the following programmatic environments: </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>COBOL using the Pro*COBOL Precompiler</p>
                        </li>
                        <li>
                           <p>C or C++ using the Pro*C/C++ Precompiler</p>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-74618664-CE35-48FB-85C6-E03CD2063BD1__GUID-11FE0E82-93ED-4571-B971-850B5123866D">
                        <p class="notep1">Note:</p>
                        <p>Oracle Database does not support <code class="codeph">BFILE</code>s larger than 2^64-1 bytes (<code class="codeph">UB8MAXVAL</code> in OCI) in any programmatic environment. Any additional file size limit imposed by your operating system also applies to <code class="codeph">BFILE</code>s.
                        </p>
                     </div>
                  </div>
               </div><a id="ADLOB45350"></a><div class="props_rev_3"><a id="GUID-A84520F4-05EF-48F3-B2A4-9CC001192B23" name="GUID-A84520F4-05EF-48F3-B2A4-9CC001192B23"></a><h4 id="ADLOB-GUID-A84520F4-05EF-48F3-B2A4-9CC001192B23" class="sect4">Maximum Storage Limit for Terabyte-Size LOBs</h4>
                  <div>
                     <p>In supported environments, you can create and manipulate LOBs that are up to the maximum storage size limit for your database configuration.</p>
                     <p>Oracle Database lets you create tablespaces with block sizes different from the database block size, and the maximum size of a LOB depends on the size of the tablespace blocks. <code class="codeph">CHUNK</code> is a parameter of LOB storage whose value is controlled by the block size of the tablespace in which the LOB is stored.
                     </p>
                     <div class="infoboxnote" id="GUID-A84520F4-05EF-48F3-B2A4-9CC001192B23__GUID-69693601-CFB9-42B9-B1B0-6F8CFD131081">
                        <p class="notep1">Note:</p>
                        <p>The <code class="codeph">CHUNK</code> parameter does not apply to SecureFiles. It is only used for BasicFiles LOBs.
                        </p>
                     </div>
                     <p>When you create a LOB column, you can specify a value for <code class="codeph">CHUNK</code>, which is the number of bytes to be allocated for LOB manipulation. The value must be a multiple of the tablespace block size, or Oracle Database rounds up to the next multiple. (If the tablespace block size is the same as the database block size, then <code class="codeph">CHUNK</code> is also a multiple of the database block size.) 
                     </p>
                     <p>The maximum allowable storage limit for your configuration depends on the tablespace block size setting, and is calculated as (4 gigabytes - 1) times the value obtained from <a id="d80928e2994" class="indexterm-anchor"></a><code class="codeph">DBMS_LOB.GETCHUNKSIZE</code> or <a id="d80928e2999" class="indexterm-anchor"></a><code class="codeph">OCILobGetChunkSize()</code>. This value, in number of bytes for <code class="codeph">BLOB</code>s or number of characters for <code class="codeph">CLOB</code>s, is actually less than the size of the <code class="codeph">CHUNK</code> parameter due to internal storage overhead. With the current allowable range for the tablespace block size from 2K to 32K, the storage limit ranges from 8 terabytes to 128 terabytes.
                     </p>
                     <p>For example, suppose your database block size is 32K bytes and you create a tablespace with a nonstandard block size of 8K. Further suppose that you create a table with a LOB column and specify a CHUNK size of 16K (which is a multiple of the 8K tablespace block size). Then the maximum size of a LOB in this column is (4 gigabytes - 1) * 16K.</p>
                     <div class="infoboxnotealso" id="GUID-A84520F4-05EF-48F3-B2A4-9CC001192B23__GUID-EA64EA3E-77FC-4BEC-A5C2-5946839B3D61">
                        <p class="notep1">See Also:</p>
                        <p> </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p> <a href="../admin/creating-and-configuring-an-oracle-database.html#ADMIN11099" target="_blank"><span class="italic">Oracle Database Administrator's Guide</span></a> for details on the initialization parameter setting for your database installation 
                              </p>
                           </li>
                           <li>
                              <p><span class="q">"<a href="LOB-storage-with-applications.html#GUID-A3D50A10-E688-4DB3-A3EB-07AC7D0019A6">CHUNK</a>"</span></p>
                           </li>
                        </ul>
                     </div>
                     <p>This storage limit applies to all LOB types in environments that support terabyte-size LOBs. However, note that <code class="codeph">CLOB</code> and <code class="codeph">NCLOB</code> types are sized in characters, while the <code class="codeph">BLOB</code> type is sized in bytes. 
                     </p>
                  </div>
               </div><a id="ADLOB45351"></a><div class="props_rev_3"><a id="GUID-0A6B471E-85EC-429C-AA20-29944A96939E" name="GUID-0A6B471E-85EC-429C-AA20-29944A96939E"></a><h4 id="ADLOB-GUID-0A6B471E-85EC-429C-AA20-29944A96939E" class="sect4">Using Terabyte-Size LOBs with JDBC</h4>
                  <div>
                     <p>You can use the LOB APIs included in the Oracle JDBC classes to access terabyte-size LOBs.</p>
                     <div class="infoboxnotealso" id="GUID-0A6B471E-85EC-429C-AA20-29944A96939E__GUID-1CD9F739-D2C0-4054-A23A-F66CED511B1C">
                        <p class="notep1">See Also:</p>
                        <p><span class="q">"<a href="overview-of-supplied-LOB-APIs.html#GUID-02CAA51A-FD04-4A40-8227-0B9108FAED8E">Using Java (JDBC) to Work With LOBs</a>"</span></p>
                     </div>
                  </div>
               </div><a id="ADLOB45352"></a><div class="props_rev_3"><a id="GUID-1DEA56D9-5CBD-4211-88DB-87B4329B02F6" name="GUID-1DEA56D9-5CBD-4211-88DB-87B4329B02F6"></a><h4 id="ADLOB-GUID-1DEA56D9-5CBD-4211-88DB-87B4329B02F6" class="sect4">Using Terabyte-Size LOBs with the DBMS_LOB Package</h4>
                  <div>
                     <p>You can access terabyte-size LOBs with all APIs in the DBMS_LOB PL/SQL package. </p>
                     <p>Use <code class="codeph">DBMS_LOB.GETCHUNKSIZE</code> to obtain the value to be used in reading and writing LOBs. The number of bytes stored in a chunk is actually less than the size of the <code class="codeph">CHUNK</code> parameter due to internal storage overhead. The <a id="d80928e3188" class="indexterm-anchor"></a><code class="codeph">DBMS_LOB.GET_STORAGE_LIMIT</code> function returns the storage limit for your database configuration. This is the maximum allowable size for LOBs. <code class="codeph">BLOB</code>s are sized in bytes, while <code class="codeph">CLOB</code>s and <code class="codeph">NCLOB</code>s are sized in characters.
                     </p>
                     <div class="infoboxnotealso" id="GUID-1DEA56D9-5CBD-4211-88DB-87B4329B02F6__GUID-D169ED0A-8BE4-4AEB-81BF-AB23BA553589">
                        <p class="notep1">See Also:</p>
                        <p><a href="../arpls/DBMS_LOB.html#ARPLS601" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a>for details on the initialization parameter setting for your database installation. 
                        </p>
                     </div>
                  </div>
               </div><a id="ADLOB45353"></a><div class="props_rev_3"><a id="GUID-A40086A3-2F4D-4153-B4DE-7C02C7CE08A8" name="GUID-A40086A3-2F4D-4153-B4DE-7C02C7CE08A8"></a><h4 id="ADLOB-GUID-A40086A3-2F4D-4153-B4DE-7C02C7CE08A8" class="sect4">Using Terabyte-Size LOBs with OCI</h4>
                  <div>
                     <p>The Oracle Call Interface API provides a set of functions for operations on LOBs of all sizes.</p>
                     <p><code class="codeph">OCILobGetChunkSize()</code> returns the value, in bytes for <code class="codeph">BLOB</code>s, or in characters for <code class="codeph">CLOB</code>s, to be used in reading and writing LOBs. For varying-width character sets, the value is the number of Unicode characters that fit. The number of bytes stored in a chunk is actually less than the size of the <code class="codeph">CHUNK</code> parameter due to internal storage overhead. The function <code class="codeph">OCILobGetStorageLimit()</code> returns the maximum allowable size, in bytes, of internal LOBs in the current database installation. If streaming mode is used, where the whole LOB is read, there is no requirement to get the chunk size.
                     </p>
                     <div class="infoboxnotealso" id="GUID-A40086A3-2F4D-4153-B4DE-7C02C7CE08A8__GUID-6793BAA5-DB0F-4BE7-911D-6F0C6418CBC2">
                        <p class="notep1">See Also:</p>
                        <p><a href="../lnoci/lobs-and-bfile-operations.html#LNOCI-GUID-EC49588A-0534-4E43-8CB1-3D0FAE205BAB" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for details about OCI functions that support LOBs
                        </p>
                     </div>
                  </div>
               </div>
            </div><a id="ADLOB45354"></a><div class="props_rev_3"><a id="GUID-B8E82069-4847-4116-9DA1-BFE6F99288C2" name="GUID-B8E82069-4847-4116-9DA1-BFE6F99288C2"></a><h3 id="ADLOB-GUID-B8E82069-4847-4116-9DA1-BFE6F99288C2" class="sect3">Guidelines for Creating Gigabyte LOBs</h3>
               <div>
                  <div class="section">
                     <p>To create gigabyte LOBs in supported environments, use the following guidelines to make use of all available space in the tablespace for LOB storage:</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Single Data File Size Restrictions: </p>
                           <p>There are restrictions on the size of a single data file for each operating system. For example, Solaris 2.5 only allows operating system files of up to 2 gigabytes. Hence, add more data files to the tablespace when the LOB grows larger than the maximum allowed file size of the operating system on which your Oracle Database runs. </p>
                        </li>
                        <li>
                           <p>Set PCT INCREASE Parameter to Zero: </p>
                           <p><code class="codeph">PCTINCREASE</code> parameter in the LOB storage clause specifies the percent growth of the new extent size. When a LOB is being filled up piece by piece in a tablespace, numerous new extents get created in the process. If the extent sizes keep increasing by the default value of 50 percent every time, then extents become unmanageable and eventually waste space in the tablespace. Therefore, the <code class="codeph">PCTINCREASE</code> parameter should be set to zero or a small value. 
                           </p>
                        </li>
                        <li>
                           <p>Set MAXEXTENTS to a Suitable Value or UNLIMITED: </p>
                           <p>The <code class="codeph">MAXEXTENTS</code> parameter limits the number of extents allowed for the LOB column. A large number of extents are created incrementally as the LOB size grows. Therefore, the parameter should be set to a value that is large enough to hold all the LOBs for the column. Alternatively, you could set it to <code class="codeph">UNLIMITED</code>.
                           </p>
                        </li>
                        <li>
                           <p>Use a Large Extent Size: </p>
                           <p>For every new extent created, Oracle generates undo information for the header and other metadata for the extent. If the number of extents is large, then the rollback segment can be saturated. To get around this, choose a large extent size, say 100 megabytes, to reduce the frequency of extent creation, or commit the transaction more often to reuse the space in the rollback segment. </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADLOB45355"></a><div class="sect3"><a id="GUID-D32C170D-F7A9-4338-B7C9-7384BC757166" name="GUID-D32C170D-F7A9-4338-B7C9-7384BC757166"></a><h4 id="ADLOB-GUID-D32C170D-F7A9-4338-B7C9-7384BC757166" class="sect4">Creating a Tablespace and Table to Store Gigabyte LOBs</h4>
                  <div>
                     <p>The following example illustrates how to create a tablespace and table to store gigabyte LOBs. </p><pre class="oac_no_warn" dir="ltr">CREATE TABLESPACE lobtbs1 DATAFILE '/your/own/data/directory/lobtbs_1.dat'
SIZE 2000M REUSE ONLINE NOLOGGING DEFAULT STORAGE (MAXEXTENTS UNLIMITED);
ALTER TABLESPACE lobtbs1 ADD DATAFILE
'/your/own/data/directory/lobtbs_2.dat' SIZE 2000M REUSE;

CREATE TABLE print_media_backup
  (product_id NUMBER(6), 
   ad_id NUMBER(6), 
   ad_composite BLOB, 
   ad_sourcetext CLOB, 
   ad_finaltext CLOB, 
   ad_fltextn NCLOB, 
   ad_textdocs_ntab textdoc_tab, 
   ad_photo BLOB, 
   ad_graphic BLOB, 
   ad_header adheader_typ)
   NESTED TABLE ad_textdocs_ntab STORE AS textdocs_nestedtab5 
   LOB(ad_sourcetext) STORE AS (TABLESPACE lobtbs1 CHUNK 32768 PCTVERSION 0 
                                NOCACHE NOLOGGING
                                STORAGE(INITIAL 100M NEXT 100M MAXEXTENTS 
                                UNLIMITED PCTINCREASE 0));
</pre><p>Note the following with respect to this example: </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The storage clause in this example is specified in the <code class="codeph">CREATE TABLESPACE</code> statement. 
                           </p>
                        </li>
                        <li>
                           <p>You can specify the storage clause in the <code class="codeph">CREATE TABLE</code> statement as an alternative. 
                           </p>
                        </li>
                        <li>
                           <p>The storage clause is not allowed in the <code class="codeph">CREATE TEMPORARY TABLESPACE </code>statement. 
                           </p>
                        </li>
                        <li>
                           <p>Setting the <code class="codeph">PCTINCREASE</code> parameter to 0 is recommended for gigabyte LOBs. For small, or medium size lobs, the default <code class="codeph">PCTINCREASE</code> value of 50 is recommended as it reduces the number of extent allocations. 
                           </p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>