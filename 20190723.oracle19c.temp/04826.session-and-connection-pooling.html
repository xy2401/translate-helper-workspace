<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="This chapter describes OCI session pooling and connection pooling features.">
      <meta name="description" content="This chapter describes OCI session pooling and connection pooling features.">
      <title>Session Pooling and Connection Pooling in OCI</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Programmer's Guide">
      <meta property="og:description" content="This chapter describes OCI session pooling and connection pooling features.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Programmer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="oracle-call-interface-programmers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-14T08:46:00-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96204-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="managing-scalable-platforms.html" title="Previous" type="text/html">
      <link rel="next" href="high-availability-in-oci.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Oracle Call Interface Programmer's Guide">
    <meta name="dcterms.isVersionOf" content="LNOCI">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="managing-scalable-platforms.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="high-availability-in-oci.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Programmer's Guide</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Session Pooling and Connection Pooling in OCI</li>
            </ol>
            <a id="GUID-FD512A09-1A33-424B-AD4D-728956AFDBD8" name="GUID-FD512A09-1A33-424B-AD4D-728956AFDBD8"></a><a id="LNOCI090"></a>
            
            <h2 id="LNOCI-GUID-FD512A09-1A33-424B-AD4D-728956AFDBD8" class="sect2"><span class="enumeration_chapter">11 </span>Session Pooling and Connection Pooling in OCI
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>This chapter describes OCI session pooling and connection pooling features.</p>
               <p>This chapter contains these topics:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="session-and-connection-pooling.html#GUID-F9662FFB-EAEF-495C-96FC-49C6D1D9625C" title="Session pooling means that the application creates and maintains a group of stateless sessions to the database.">Session Pooling in OCI</a></p>
                  </li>
                  <li>
                     <p><a href="session-and-connection-pooling.html#GUID-1E260CD3-2EF7-49FF-97FC-041C2EF60381" title="Database resident connection pooling (DRCP) provides a connection pool in the database server for typical web application usage scenarios where the application acquires a database connection, works on it for a relatively short duration, and then releases it.">Database Resident Connection Pooling</a></p>
                  </li>
                  <li>
                     <p><a href="session-and-connection-pooling.html#GUID-BF9AFFD6-537A-4252-BBFB-3A60EEAC3E61" title="Oracle Connection Manager in Traffic Director Mode is a proxy that is placed between supported database clients and database instances.">About Using Oracle Connection Manager in Traffic Director Mode</a></p>
                  </li>
                  <li>
                     <p><a href="session-and-connection-pooling.html#GUID-1C9A6E8F-EF5A-478D-B65E-CE39D4F00683" title="Connection pooling is the use of a group (the pool) of reusable physical connections by several sessions to balance loads.">Connection Pooling in OCI</a></p>
                  </li>
                  <li>
                     <p><a href="session-and-connection-pooling.html#GUID-8DD97D4D-C7AA-4EF7-9B55-8DC58BDC2726" title="Indicates the circumstances in which to use them or not.">When to Use Connection Pooling, Session Pooling, or Neither</a></p>
                  </li>
               </ul>
            </div><a id="LNOCI16617"></a><div class="props_rev_3"><a id="GUID-F9662FFB-EAEF-495C-96FC-49C6D1D9625C" name="GUID-F9662FFB-EAEF-495C-96FC-49C6D1D9625C"></a><h3 id="LNOCI-GUID-F9662FFB-EAEF-495C-96FC-49C6D1D9625C" class="sect3"><span class="enumeration_section">11.1 </span>Session Pooling in OCI
               </h3>
               <div>
                  <p><span class="italic">Session pooling</span> means that the application creates and maintains a group of stateless sessions to the database.
                  </p>
                  <p>These sessions are provided to thin clients as requested. If no sessions are available, a new one may be created. When the client is done with the session, the client releases it to the pool. Thus, the number of sessions in the pool can increase dynamically.</p>
                  <p>Some of the sessions in the pool may be tagged with certain properties. For instance, a user may request a default session, set certain attributes on it, label it or tag it, and return it to the pool. That user, or some other user, can require a session with the same attributes, and thus request a session with the same tag. There may be several sessions in the pool with the same tag. The tag on a session can be changed or reset.</p>
                  <p>Proxy sessions, too, can be created and maintained through session pooling in OCI. </p>
                  <p>The behavior of the application when no free sessions are available and the pool has reached its maximum size depends on certain attributes. A new session may be created or an error returned, or the thread may just block and wait for a session to become free.</p>
                  <p>The main benefit of session pooling is performance. Making a connection to the database is a time-consuming activity, especially when the database is remote. Thus, instead of a client spending time connecting to the server, authenticating its credentials, and then receiving a valid session, it can just pick one from the pool.</p>
                  <div class="p">This section includes the following topics:
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="session-and-connection-pooling.html#GUID-7D5BBEC4-38CF-4C63-B616-12231EF0DCAE" title="Describes tasks that session pooling can perform.">Functionality of OCI Session Pooling</a></p>
                        </li>
                        <li>
                           <p><a href="session-and-connection-pooling.html#GUID-DD2C2456-5F22-4BA0-AFE6-30CCF29A3688" title="A session pool can be either homogeneous or heterogeneous.">Homogeneous and Heterogeneous Session Pools</a></p>
                        </li>
                        <li>
                           <p><a href="session-and-connection-pooling.html#GUID-F7609D96-EB0F-487D-B825-E0138B16E2E9" title="Tags provide a way for users to customize sessions in the pool.">About Using Tags in Session Pools</a></p>
                        </li>
                        <li>
                           <p><a href="session-and-connection-pooling.html#GUID-35D322F2-E576-416B-A399-3A733F5487A1" title="What are the handle types for session pooling.">OCI Handles for Session Pooling</a></p>
                        </li>
                        <li>
                           <p><a href="session-and-connection-pooling.html#GUID-9DD6C967-B3F8-4D26-B7F8-7730AABA7E8E" title="Shows the steps to write a simple session pooling application that uses a user name and password.">Using OCI Session Pooling</a></p>
                        </li>
                        <li>
                           <p><a href="session-and-connection-pooling.html#GUID-CE43701B-ACB2-4F3A-B7CA-332CBD01DCCE" title="Describes the usages for OCI calls for session pooling.">OCI Calls for Session Pooling</a></p>
                        </li>
                        <li>
                           <p><a href="session-and-connection-pooling.html#GUID-72D13726-61B8-4CAB-9120-4E33714688AE" title="Where to find an example of session pooling in a tested complete program.">Example of OCI Session Pooling</a></p>
                        </li>
                     </ul>
                  </div>
                  <div class="infoboxnotealso" id="GUID-F9662FFB-EAEF-495C-96FC-49C6D1D9625C__GUID-18175688-A109-44F2-BE5D-B323818A1A7F">
                     <p class="notep1">See Also:</p>
                     <p> <a href="session-and-connection-pooling.html#GUID-F7609D96-EB0F-487D-B825-E0138B16E2E9" title="Tags provide a way for users to customize sessions in the pool.">About Using Tags in Session Pools</a></p>
                  </div>
               </div><a id="LNOCI16618"></a><div class="props_rev_3"><a id="GUID-7D5BBEC4-38CF-4C63-B616-12231EF0DCAE" name="GUID-7D5BBEC4-38CF-4C63-B616-12231EF0DCAE"></a><h4 id="LNOCI-GUID-7D5BBEC4-38CF-4C63-B616-12231EF0DCAE" class="sect4"><span class="enumeration_section">11.1.1 </span>Functionality of OCI Session Pooling 
                  </h4>
                  <div>
                     <p>Describes tasks that session pooling can perform.</p>
                     <p>Session pooling can perform the following tasks:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Create, maintain, and manage a pool of stateless sessions transparently.</p>
                        </li>
                        <li>
                           <p>Provide an interface for the application to create a pool and specify the minimum, increment, and maximum number of sessions in the pool. </p>
                        </li>
                        <li>
                           <p>Provide an interface for the user to obtain and release a default or tagged session to the pool. A tagged session is one with certain client-defined properties.</p>
                        </li>
                        <li>
                           <p>Allow the application to dynamically change the number of minimum and maximum number of sessions.</p>
                        </li>
                        <li>
                           <p>Provide a mechanism to always maintain an optimum number of open sessions, by closing sessions that have been idle for a very long time, and creating sessions when required.</p>
                        </li>
                        <li>
                           <p>Allow for session pooling with authentication.</p>
                        </li>
                     </ul>
                  </div>
               </div><a id="LNOCI16619"></a><div class="props_rev_3"><a id="GUID-DD2C2456-5F22-4BA0-AFE6-30CCF29A3688" name="GUID-DD2C2456-5F22-4BA0-AFE6-30CCF29A3688"></a><h4 id="LNOCI-GUID-DD2C2456-5F22-4BA0-AFE6-30CCF29A3688" class="sect4"><span class="enumeration_section">11.1.2 </span>Homogeneous and Heterogeneous Session Pools
                  </h4>
                  <div>
                     <p>A session pool can be either homogeneous or heterogeneous. </p>
                     <p><span class="italic">Homogeneous</span> session pooling means that sessions in the pool are alike for authentication (they have the same user name, password, and privileges). <span class="italic">Heterogeneous</span> session pooling means that you must provide authentication information because the sessions can have different security attributes and privileges.
                     </p>
                  </div>
               </div><a id="LNOCI16620"></a><div class="props_rev_3"><a id="GUID-F7609D96-EB0F-487D-B825-E0138B16E2E9" name="GUID-F7609D96-EB0F-487D-B825-E0138B16E2E9"></a><h4 id="LNOCI-GUID-F7609D96-EB0F-487D-B825-E0138B16E2E9" class="sect4"><span class="enumeration_section">11.1.3 </span>About Using Tags in Session Pools
                  </h4>
                  <div>
                     <p>Tags provide a way for users to customize sessions in the pool.</p>
                     <p>A client can get a default or untagged session from a pool, set certain attributes on the session (such as NLS settings), and return the session to the pool, labeling it with an appropriate tag in the <code class="codeph">OCISessionRelease(</code>) call.
                     </p>
                     <p>The original user, or some other user, can request a session with the same tags to have a session with the same attributes, and can do so by providing the same tag in the <code class="codeph">OCISessionGet()</code> call. 
                     </p>
                     <p>This section includes the following topic: <a href="session-and-connection-pooling.html#GUID-DFA21225-E83C-4177-A79A-B8BA29DC662C" title="Beginning with 12c Release 2 (12.2), a tag can have multiple properties. This is referred to as a multi-property tag.">Multi-Property Tags</a>.
                     </p>
                     <div class="infoboxnotealso" id="GUID-F7609D96-EB0F-487D-B825-E0138B16E2E9__GUID-673EB9A5-3100-4CC7-9FEB-5CFB14516BBB">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="connect-authorize-and-initialize-functions.html#GUID-DAAECC99-A432-48B5-AC33-0868C2FE762D" title="Releases a session that was retrieved using OCISessionGet().">OCISessionRelease()</a></p>
                           </li>
                           <li>
                              <p><a href="connect-authorize-and-initialize-functions.html#GUID-890DFBC4-718B-4339-A0EA-6226A25B8241" title="Gets a session.">OCISessionGet()</a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-DFA21225-E83C-4177-A79A-B8BA29DC662C" name="GUID-DFA21225-E83C-4177-A79A-B8BA29DC662C"></a><h5 id="LNOCI-GUID-DFA21225-E83C-4177-A79A-B8BA29DC662C" class="sect5"><span class="enumeration_section">11.1.3.1 </span>Multi-Property Tags
                     </h5>
                     <div>
                        <p>Beginning with 12<span class="italic">c</span> Release 2 (12.2), a tag can have multiple properties. This is referred to as a multi-property tag. 
                        </p>
                        <p>A multi-property tag is comprised of one or more &lt;property-name&gt;=&lt;property-value&gt; pairs separated by a semi-colon, where &lt;property-name&gt;=&lt;property-value&gt; are both strings. </p>
                        <p>During an <code class="codeph">OCISessionGet()</code> call, in the <code class="codeph">taginfo</code> parameter, the property name appearing first is given the highest property for finding a match and the property name appearing last is given the lowest priority. Therefore the ordering of the properties in the string is significant in determining a matching session in the pool.  The example that follows below the list of restrictions illustrates this point.
                        </p>
                        <p>This functionality also works with DRCP.</p>
                        <div class="p">The following restrictions apply to property names and property values that can be passed in a multi-property tag:
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Both the property name and the property value are case sensitive.</p>
                              </li>
                              <li>
                                 <p>A property name can occur only once in a tag.  In case the same property name is specified more than once, an error will be thrown. </p>
                              </li>
                              <li>
                                 <p>A non empty string should be specified for both the property name and the value. </p>
                              </li>
                              <li>
                                 <p>Leading and trailing spaces before and after a property name and leading and trailing space before and after a property value will be truncated. For example, “PDB      =       PDB1” is treated as  “PDB=PDB1”.</p>
                              </li>
                              <li>
                                 <p>There should be no white spaces in the property name and the property value. For example, NLS &lt;space&gt; LANGUAGE=French will result in an error because of the space between NLS and LANGUAGE.  </p>
                              </li>
                           </ul>
                        </div>
                        <p>To explain the notion of multiple properties, assume that the application to be deployed in a CDB environment requires that the session get requests should be satisfied with sessions from the same pluggable database  (for example, pdb1 ) as much as possible. Next, it also requires that the sessions belong to the same language  (for example, FRENCH), but gives a higher priority to sessions to pdb1. The application can then provide a multi-property-tag as follows:</p><pre class="pre codeblock"><code>char *props  = “PDB=pdb1;LANGUAGE=FRENCH”</code></pre><p>Now, assume that there are two sessions in the pool with properties as shown:</p><pre class="pre codeblock"><code>Session 1 = &gt;  “PDB=pdb1;LANGUAGE=CHINESE”</code></pre><pre class="pre codeblock"><code>Session 2 = &gt;  “PDB=pdb2;LANGUAGE=FRENCH” </code></pre><p>In this situation, the session get request (<code class="codeph">OCISessionGet()</code>) returns Session 1 because the  <code class="codeph">PDB</code> property implicitly carries a higher priority by being placed ahead of the <code class="codeph">LANGUAGE</code> property. 
                        </p>
                        <div class="infoboxnotealso" id="GUID-DFA21225-E83C-4177-A79A-B8BA29DC662C__GUID-53C1441D-B992-4770-B865-97A57A42FAC5">
                           <p class="notep1">See Also:</p>
                           <p><a href="connect-authorize-and-initialize-functions.html#GUID-890DFBC4-718B-4339-A0EA-6226A25B8241" title="Gets a session.">OCISessionGet()</a> for a further discussion of tagging sessions
                           </p>
                        </div>
                        <p> This section includes the following topic: <a href="session-and-connection-pooling.html#GUID-B853A020-752F-494A-8D88-D0396EF57177" title="When using multi-property tags, a PL/SQL based fix-up callback for the session state can be provided on the server.">PL/SQL Callback for Session State Fix Up</a>.
                        </p>
                     </div>
                     <div class="sect5"><a id="GUID-B853A020-752F-494A-8D88-D0396EF57177" name="GUID-B853A020-752F-494A-8D88-D0396EF57177"></a><h6 id="LNOCI-GUID-B853A020-752F-494A-8D88-D0396EF57177" class="sect6"><span class="enumeration_section">11.1.3.1.1 </span>PL/SQL Callback for Session State Fix Up
                        </h6>
                        <div>
                           <p>When using multi-property tags, a PL/SQL based fix-up callback for the session state can be provided on the server. </p>
                           <p>This application-provided callback transforms a session checked out from the pool to the desired state requested by the application as indicated by the multi-property tag. This callback works with or without Database Resident Connection Pooling (DRCP).</p>
                           <p>Using this callback can improve the performance of your application because the fix-up logic is run for the session state on the server. So, this feature eliminates application round-trips to the database for the fix-up logic. The callback is supplied by the user who connects using <code class="codeph">OCISessionGet()</code>. The callback must be provided as an attribute <code class="codeph">OCI_ATTR_FIXUP_CALLBACK</code> on the authentication handle passed to <code class="codeph">OCISessionGet()</code> for applications not using OCISessionPool or using custom pools. For applications using OCISessionPool this attribute must be set on the authentication handle, which in turn must be set on the session pool handle as the attribute <code class="codeph">OCI_ATTR_SPOOL_AUTH</code>. 
                           </p>
                           <div class="example" id="GUID-B853A020-752F-494A-8D88-D0396EF57177__GUID-077AD33B-4206-4107-A9B3-24753058756D">
                              <p class="titleinexample">Example 11-1 Example of PL/SQL Fix-Up Callback</p>
                              
                              <p>The following PL/SQL fix-up callback example code snippet handles tags whose
          <code class="codeph">key=value</code> properties can be used directly in an ALTER SESSION statement,
        such as <code class="codeph">TIME_ZONE=UTC;NLS_DATE_FORMAT=DD-MM-YYYY</code>:
                              </p>
                              <pre class="pre codeblock"><code>CREATE OR REPLACE PACKAGE myPackage AS
  TYPE property_t IS TABLE OF VARCHAR2(64) INDEX BY VARCHAR2(64);
  PROCEDURE buildTab(
    tag          IN  VARCHAR2,
    propertyTab  OUT property_t
  );
  PROCEDURE myPlsqlCallback (
    requestedTag IN  VARCHAR2,
    actualTag    IN  VARCHAR2
  );
END;
/

CREATE OR REPLACE PACKAGE BODY myPackage AS

  -- Parse the "property=value" pairs in the tag
  PROCEDURE buildTab(tag IN VARCHAR2, propertyTab OUT property_t) IS
    property  VARCHAR2(64);
    propertyName  VARCHAR2(64);
    propertyValue VARCHAR2(64);
    propertyEndPos NUMBER := 1;
    propertyStartPos NUMBER := 1;
    propertyNameEndPos NUMBER := 1;
  begin
    WHILE (LENGTH(tag) &gt; propertyEndPos)
    LOOP
      propertyEndPos := INSTR(tag, ';', propertyStartPos);
      IF (propertyEndPos = 0) THEN
        propertyEndPos := LENGTH(tag) + 1;
      END IF;
      propertyNameEndPos := INSTR(tag, '=', propertyStartPos);
      propertyName := SUBSTR(tag, propertyStartPos,
                   propertyNameEndPos - propertyStartPos);
      propertyValue := SUBSTR(tag, propertyNameEndPos + 1,
                    propertyEndPos - propertyNameEndPos - 1);
      propertyTab(propertyName) := propertyValue;
      propertyStartPos := propertyEndPos + 1;
    END LOOP;
  END;

  PROCEDURE myPlsqlCallback (
    requestedTag IN VARCHAR2,
    actualTag IN VARCHAR2
  ) IS
    reqPropTab property_t;
    actPropTab property_t;
    propertyName VARCHAR2(64);
  BEGIN
    buildTab(requestedTag, reqPropTab);
    buildTab(actualTag, actPropTab);

    -- Iterate over requested properties to set state when it's not
    -- currently set, or not set to the desired value
    propertyName := reqPropTab.FIRST;
    WHILE (propertyName IS NOT NULL)
    LOOP
      IF ((NOT actPropTab.exists(propertyName)) OR
         (actPropTab(propertyName) != reqPropTab(propertyName))) THEN
        EXECUTE IMMEDIATE 'ALTER SESSION SET ' || propertyName || '=''' || reqPropTab(propertyName) || '''';
      END IF;
      propertyName := reqPropTab.NEXT(propertyName);
    END LOOP;
    -- Could iterate over other actual props to reset any extra props to a default state
  END;
END myPackage;
/</code></pre></div>
                           <!-- class="example" -->
                           <div class="section">
                              <div class="infoboxnotealso" id="GUID-B853A020-752F-494A-8D88-D0396EF57177__GUID-D50AFE1B-9616-4198-A857-0ADF890AB1BA">
                                 <p class="notep1">See Also:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p><a href="handle-and-descriptor-attributes.html#GUID-0193473A-20FE-4727-850E-41269F94BAD4" title="Lists and describes authentication information handle attributes.">Authentication Information Handle Attributes</a> for more information about <code class="codeph">OCI_ATTR_FIXUP_CALLBACK</code></p>
                                    </li>
                                    <li>
                                       <p><a href="handle-and-descriptor-attributes.html#GUID-34071823-66D0-4C54-BFBB-6323BDEF8015" title="Lists and describes session pool handle attributes.">Session Pool Handle Attributes</a> for more information about <code class="codeph">OCI_ATTR_SPOOL_AUTH</code></p>
                                    </li>
                                 </ul>
                              </div>
                           </div>
                           <!-- class="section" -->
                        </div>
                     </div>
                  </div>
               </div><a id="LNOCI16621"></a><div class="props_rev_3"><a id="GUID-35D322F2-E576-416B-A399-3A733F5487A1" name="GUID-35D322F2-E576-416B-A399-3A733F5487A1"></a><h4 id="LNOCI-GUID-35D322F2-E576-416B-A399-3A733F5487A1" class="sect4"><span class="enumeration_section">11.1.4 </span>OCI Handles for Session Pooling
                  </h4>
                  <div>
                     <p>What are the handle types for session pooling.</p>
                     <div class="p">The following handle types are for session pooling:
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="session-and-connection-pooling.html#GUID-3EB716F7-7810-4E29-9F92-F5A76B88E662" title="This is the session pool handle.">OCISPool</a></p>
                           </li>
                           <li>
                              <p><a href="session-and-connection-pooling.html#GUID-0F8EA0EC-2018-476F-9353-208266BD822A" title="This is the authentication information handle.">OCIAuthInfo</a></p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="LNOCI16622"></a><div class="props_rev_3"><a id="GUID-3EB716F7-7810-4E29-9F92-F5A76B88E662" name="GUID-3EB716F7-7810-4E29-9F92-F5A76B88E662"></a><h5 id="LNOCI-GUID-3EB716F7-7810-4E29-9F92-F5A76B88E662" class="sect5"><span class="enumeration_section">11.1.4.1 </span>OCISPool
                     </h5>
                     <div>
                        <p>This is the session pool handle.</p>
                        <p>It is allocated using <code class="codeph">OCIHandleAlloc()</code>. It must be passed to <code class="codeph">OCISessionPoolCreate()</code> and <code class="codeph">OCISessionPoolDestroy()</code>. It has the attribute type <code class="codeph">OCI_HTYPE_SPOOL</code>.
                        </p>
                        <p>An example of the <code class="codeph">OCIHandleAlloc()</code> call follows:
                        </p><pre class="oac_no_warn" dir="ltr">OCISPool *spoolhp;
OCIHandleAlloc((void *) envhp, (void **) &amp;spoolhp, OCI_HTYPE_SPOOL, 
                        (size_t) 0, (void **) 0));
</pre><p>For an environment handle, multiple session pools can be created.</p>
                        <div class="infoboxnotealso" id="GUID-3EB716F7-7810-4E29-9F92-F5A76B88E662__GUID-2E5705C8-EAB6-457F-BAD7-222FDD9C22BC">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="handle-and-descriptor-functions.html#GUID-C5BF55F7-A110-4CB5-9663-5056590F12B5" title="Returns a pointer to an allocated and initialized handle.">OCIHandleAlloc()</a></p>
                              </li>
                              <li>
                                 <p><a href="connect-authorize-and-initialize-functions.html#GUID-1E929CFB-9D96-4E8E-9F24-904AD539E555" title="Initializes a session pool for use with OCI session pooling and database resident connection pooling (DRCP).">OCISessionPoolCreate()</a></p>
                              </li>
                              <li>
                                 <p><a href="connect-authorize-and-initialize-functions.html#GUID-2797C90C-C7AC-47FB-B1C2-CE41B743FB5C" title="Destroys a session pool.">OCISessionPoolDestroy()</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="LNOCI16623"></a><div class="props_rev_3"><a id="GUID-0F8EA0EC-2018-476F-9353-208266BD822A" name="GUID-0F8EA0EC-2018-476F-9353-208266BD822A"></a><h5 id="LNOCI-GUID-0F8EA0EC-2018-476F-9353-208266BD822A" class="sect5"><span class="enumeration_section">11.1.4.2 </span>OCIAuthInfo
                     </h5>
                     <div>
                        <p>This is the authentication information handle.</p>
                        <p>It is allocated using <code class="codeph">OCIHandleAlloc()</code>. It is passed to <code class="codeph">OCISessionGet()</code>. It supports all the attributes that are supported for a user session handle. The authentication information handle has the attribute type <code class="codeph">OCI_HTYPE_AUTHINFO</code> (see <a href="oci-programming-basics.html#GUID-5F13B2EC-E29C-4710-8AD7-E97E6C28085E__G466063" title="This table has 3 columns. Column 1 is the handle type description, column 2 is the C data type, and column 3 is the handle type constant.">Table 4-1</a>).
                        </p>
                        <p>An example of the <code class="codeph">OCIHandleAlloc()</code> call follows:
                        </p><pre class="oac_no_warn" dir="ltr">OCIAuthInfo *authp;
OCIHandleAlloc((void *) envhp, (void **) &amp;authp, OCI_HTYPE_AUTHINFO, 
                      (size_t) 0, (void **) 0));
</pre><div class="infoboxnotealso" id="GUID-0F8EA0EC-2018-476F-9353-208266BD822A__GUID-8F595AFE-3EDF-42F7-B84A-55B314C4FFD3">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="handle-and-descriptor-functions.html#GUID-C5BF55F7-A110-4CB5-9663-5056590F12B5" title="Returns a pointer to an allocated and initialized handle.">OCIHandleAlloc()</a></p>
                              </li>
                              <li>
                                 <p><a href="handle-and-descriptor-attributes.html#GUID-FB263210-118E-4DB3-A840-1769EF0CB977" title="Lists and describes user session handle attributes.">User Session Handle Attributes</a> for the attributes that belong to the authentication information handle
                                 </p>
                              </li>
                              <li>
                                 <p><a href="handle-and-descriptor-attributes.html#GUID-34071823-66D0-4C54-BFBB-6323BDEF8015" title="Lists and describes session pool handle attributes.">Session Pool Handle Attributes</a> for more information about the session pooling attributes
                                 </p>
                              </li>
                              <li>
                                 <p><a href="connect-authorize-and-initialize-functions.html#GUID-8EDDA0CC-6755-49D8-89D0-81713E10B156" title="Lists and describes connect, authorize, and initialize functions.">Connect, Authorize, and Initialize Functions</a> for complete information about the functions used in session pooling
                                 </p>
                              </li>
                              <li>
                                 <p>See <span class="q">"<a href="connect-authorize-and-initialize-functions.html#GUID-890DFBC4-718B-4339-A0EA-6226A25B8241" title="Gets a session.">OCISessionGet()</a>"</span> for details of the session handle attributes that you can use with this call
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
               </div><a id="LNOCI16624"></a><div class="props_rev_3"><a id="GUID-9DD6C967-B3F8-4D26-B7F8-7730AABA7E8E" name="GUID-9DD6C967-B3F8-4D26-B7F8-7730AABA7E8E"></a><h4 id="LNOCI-GUID-9DD6C967-B3F8-4D26-B7F8-7730AABA7E8E" class="sect4"><span class="enumeration_section">11.1.5 </span>Using OCI Session Pooling
                  </h4>
                  <div>
                     <p>Shows the steps to write a simple session pooling application that uses a user name and password.</p>
                     <div class="section">
                        <p>The steps in writing a simple session pooling application that uses a user name and password are as follows:</p>
                        <ol>
                           <li>
                              <p>Allocate the session pool handle using <code class="codeph">OCIHandleAlloc()</code> for an <code class="codeph">OCISPool</code> handle. Multiple session pools can be created for an environment handle.
                              </p>
                           </li>
                           <li>
                              <p>Create the session pool using <code class="codeph">OCISessionPoolCreate()</code> with <code class="codeph">mode</code> set to <code class="codeph">OCI_DEFAULT</code> (for a new session pool). See the function for a discussion of the other modes.
                              </p>
                           </li>
                           <li>
                              <p>Loop for each thread. Create the thread with a function that does the following:</p>
                              <ol type="a">
                                 <li>
                                    <p>Allocates an authentication information handle of type <code class="codeph">OCIAuthInfo</code> using <code class="codeph">OCIHandleAlloc()</code></p>
                                 </li>
                                 <li>
                                    <p>Sets the user name and password in the authentication information handle using <code class="codeph">OCIAttrSet()</code></p>
                                 </li>
                                 <li>
                                    <p>Gets a pooled session using <code class="codeph">OCISessionGet()</code> with <code class="codeph">mode</code> set to <code class="codeph">OCI_SESSGET_SPOOL</code></p>
                                 </li>
                                 <li>
                                    <p>Performs the transaction</p>
                                 </li>
                                 <li>
                                    <p>Allocates the handle</p>
                                 </li>
                                 <li>
                                    <p>Prepares the statement</p>
                                    <div class="infoboxnote" id="GUID-9DD6C967-B3F8-4D26-B7F8-7730AABA7E8E__GUID-05DB4D0E-C365-4A1E-AA5D-C0F873C13754">
                                       <p class="notep1">Note:</p>
                                       <p>When using service contexts obtained from OCI session pool, you are required to use the service context returned by <code class="codeph">OCISessionGet()</code> (or <code class="codeph">OCILogon2()</code>), and not create other service contexts outside of these calls.
                                       </p>
                                       <p>Any statement handle obtained using <code class="codeph">OCIStmtPrepare2()</code> with the service context should be subsequently used only in conjunction with the same service context, and never with a different service context.
                                       </p>
                                    </div>
                                 </li>
                                 <li>
                                    <p>Executes the statement</p>
                                 </li>
                                 <li>
                                    <p>Commits or rolls back the transactions</p>
                                 </li>
                                 <li>
                                    <p>Releases the session (log off) with <code class="codeph">OCISessionRelease()</code></p>
                                 </li>
                                 <li>
                                    <p>Frees the authentication information handle with <code class="codeph">OCIHandleFree()</code></p>
                                 </li>
                                 <li>
                                    <p>Ends the loop for each thread</p>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>Destroy the session pool using <code class="codeph">OCISessionPoolDestroy()</code>.
                              </p>
                           </li>
                        </ol>
                        <div class="infoboxnotealso" id="GUID-9DD6C967-B3F8-4D26-B7F8-7730AABA7E8E__GUID-BA450341-4516-4E24-A3C7-BB24B48886F9">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="connect-authorize-and-initialize-functions.html#GUID-1E929CFB-9D96-4E8E-9F24-904AD539E555" title="Initializes a session pool for use with OCI session pooling and database resident connection pooling (DRCP).">OCISessionPoolCreate()</a></p>
                              </li>
                              <li>
                                 <p><a href="handle-and-descriptor-functions.html#GUID-C5BF55F7-A110-4CB5-9663-5056590F12B5" title="Returns a pointer to an allocated and initialized handle.">OCIHandleAlloc()</a></p>
                              </li>
                              <li>
                                 <p><a href="handle-and-descriptor-functions.html#GUID-3741D7BD-7652-4D7A-8813-AC2AEA8D3B03" title="Sets the value of an attribute of a handle or a descriptor.">OCIAttrSet()</a></p>
                              </li>
                              <li>
                                 <p><a href="connect-authorize-and-initialize-functions.html#GUID-890DFBC4-718B-4339-A0EA-6226A25B8241" title="Gets a session.">OCISessionGet()</a></p>
                              </li>
                              <li>
                                 <p><a href="connect-authorize-and-initialize-functions.html#GUID-425D4B32-257C-480E-B69C-7112BE9482E6" title="Gets a session.">OCILogon2()</a></p>
                              </li>
                              <li>
                                 <p><a href="statement-functions.html#GUID-E6C1DC67-D464-4D2A-9F19-737423D31779" title="Prepares a SQL or PL/SQL statement for execution.">OCIStmtPrepare2()</a></p>
                              </li>
                              <li>
                                 <p><a href="connect-authorize-and-initialize-functions.html#GUID-DAAECC99-A432-48B5-AC33-0868C2FE762D" title="Releases a session that was retrieved using OCISessionGet().">OCISessionRelease()</a></p>
                              </li>
                              <li>
                                 <p><a href="handle-and-descriptor-functions.html#GUID-E87E9F91-D3DC-4F35-BE7C-F1EFBFEEBA0A" title="Explicitly deallocates a handle">OCIHandleFree()</a></p>
                              </li>
                              <li>
                                 <p><a href="connect-authorize-and-initialize-functions.html#GUID-2797C90C-C7AC-47FB-B1C2-CE41B743FB5C" title="Destroys a session pool.">OCISessionPoolDestroy()</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="LNOCI16625"></a><div class="props_rev_3"><a id="GUID-CE43701B-ACB2-4F3A-B7CA-332CBD01DCCE" name="GUID-CE43701B-ACB2-4F3A-B7CA-332CBD01DCCE"></a><h4 id="LNOCI-GUID-CE43701B-ACB2-4F3A-B7CA-332CBD01DCCE" class="sect4"><span class="enumeration_section">11.1.6 </span>OCI Calls for Session Pooling
                  </h4>
                  <div>
                     <p>Describes the usages for OCI calls for session pooling. </p>
                     <p>OCI provides calls for session pooling to perform the following tasks: </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="session-and-connection-pooling.html#GUID-C09AF9F9-34EB-4D1D-849E-9B962463C7A7" title="Connection pooling requires that the pool handle OCI_HTYPE_CPOOL be allocated by OCIHandleAlloc().">Allocate the Pool Handle</a></p>
                        </li>
                        <li>
                           <p><a href="session-and-connection-pooling.html#GUID-4298BCA2-0EE0-4B77-B9CB-88845562F44C" title="The function OCIConnectionPoolCreate() initializes the connection pool handle.">Create the Connection Pool</a></p>
                        </li>
                        <li>
                           <p><a href="session-and-connection-pooling.html#GUID-1DB08E60-053F-4D7B-A56D-FE42FE9463B5" title="The application can use one of several interfaces.">Log On to the Database</a></p>
                        </li>
                        <li>
                           <p><a href="session-and-connection-pooling.html#GUID-73DFAAA9-4EB2-44ED-9DEC-2B803B990AE2" title="Choose the appropriate call to log off from the database in connection pooling mode.">Log Off from the Database</a></p>
                        </li>
                        <li>
                           <p><a href="session-and-connection-pooling.html#GUID-CB0DC00D-C935-41BC-AF4B-29C3288B743B" title="OCIConnectionPoolDestroy() destroys it.">Destroy the Connection Pool</a></p>
                        </li>
                        <li>
                           <p><a href="session-and-connection-pooling.html#GUID-676CFBC3-69CC-447B-B0A5-B58BE827291E" title="The pool handle is freed using OCIHandleFree().">Free the Pool Handle</a></p>
                        </li>
                     </ul>
                  </div><a id="LNOCI16626"></a><div class="props_rev_3"><a id="GUID-1F691FCF-3986-43D7-AA27-82117745B105" name="GUID-1F691FCF-3986-43D7-AA27-82117745B105"></a><h5 id="LNOCI-GUID-1F691FCF-3986-43D7-AA27-82117745B105" class="sect5"><span class="enumeration_section">11.1.6.1 </span>Allocate the Pool Handle
                     </h5>
                     <div>
                        <p>Session pooling requires that the pool handle <code class="codeph">OCI_HTYPE_SPOOL</code> be allocated by calling <code class="codeph">OCIHandleAlloc()</code>.
                        </p>
                        <p>Multiple pools can be created for a given environment handle. For a single session pool, here is an allocation example: </p><pre class="oac_no_warn" dir="ltr">OCISPool *poolhp; 
OCIHandleAlloc((void *) envhp, (void **) &amp;poolhp, OCI_HTYPE_SPOOL, (size_t) 0,
               (void **) 0));</pre><div class="infoboxnotealso" id="GUID-1F691FCF-3986-43D7-AA27-82117745B105__GUID-F7541843-6EA7-4CB1-A88B-C9B4AF328810">
                           <p class="notep1">See Also:</p>
                           <p><a href="handle-and-descriptor-functions.html#GUID-C5BF55F7-A110-4CB5-9663-5056590F12B5" title="Returns a pointer to an allocated and initialized handle.">OCIHandleAlloc()</a></p>
                        </div>
                     </div>
                  </div><a id="LNOCI16627"></a><div class="props_rev_3"><a id="GUID-15516E6A-868C-4C7E-8272-92C270C160A4" name="GUID-15516E6A-868C-4C7E-8272-92C270C160A4"></a><h5 id="LNOCI-GUID-15516E6A-868C-4C7E-8272-92C270C160A4" class="sect5"><span class="enumeration_section">11.1.6.2 </span>Create the Pool Session
                     </h5>
                     <div>
                        <p>You can use the function <code class="codeph">OCISessionPoolCreate()</code> to create the session pool.
                        </p>
                        <p>Here is an example of how to use this call:</p><pre class="oac_no_warn" dir="ltr">OCISessionPoolCreate(envhp, errhp, poolhp, (OraText **)&amp;poolName, 
              (ub4 *)&amp;poolNameLen, database, 
              (ub4)strlen((const signed char *)database),
              sessMin, sessMax, sessIncr,
              (OraText *)appusername,
              (ub4)strlen((const signed char *)appusername),
              (OraText *)apppassword,
              (ub4)strlen((const signed char *)apppassword),
              OCI_DEFAULT);</pre><div class="infoboxnotealso" id="GUID-15516E6A-868C-4C7E-8272-92C270C160A4__GUID-72E883EB-155C-42CF-9305-E6E3C721F1E6">
                           <p class="notep1">See Also:</p>
                           <p><a href="connect-authorize-and-initialize-functions.html#GUID-1E929CFB-9D96-4E8E-9F24-904AD539E555" title="Initializes a session pool for use with OCI session pooling and database resident connection pooling (DRCP).">OCISessionPoolCreate()</a></p>
                        </div>
                     </div>
                  </div><a id="LNOCI16628"></a><div class="props_rev_3"><a id="GUID-7894AB6A-0CCD-4F22-9B84-5B40B2FC636C" name="GUID-7894AB6A-0CCD-4F22-9B84-5B40B2FC636C"></a><h5 id="LNOCI-GUID-7894AB6A-0CCD-4F22-9B84-5B40B2FC636C" class="sect5"><span class="enumeration_section">11.1.6.3 </span>Log On to the Database
                     </h5>
                     <div>
                        <p>You can use these calls to log on to the database in session pooling mode.</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">OCILogon2()</code></p>
                              <p>This is the simplest call. However, it does not give the user the option of using tagging. Here is an example of how to use <code class="codeph">OCILogon2()</code> to log on to the database in session pooling mode:
                              </p><pre class="oac_no_warn" dir="ltr">for (i = 0; i &lt; MAXTHREADS; ++i) 
{ 
  OCILogon2(envhp, errhp, &amp;svchp[i], "hr", 2, "hr", 2, poolName,
            poolNameLen, OCI_LOGON2_SPOOL));
}
</pre></li>
                           <li>
                              <p><code class="codeph">OCISessionGet()</code></p>
                              <p>This is the recommended call to use. It gives the user the option of using tagging to label sessions in the pool, which makes it easier to retrieve specific sessions. An example of using <code class="codeph">OCISessionGet()</code> follows. It is taken from <code class="codeph">cdemosp.c</code> in the <code class="codeph">demo</code> directory.
                              </p><pre class="oac_no_warn" dir="ltr">OCISessionGet(envhp, errhp, &amp;svchp, authInfop,
             (OraText *)database,strlen(database), tag,
             strlen(tag), &amp;retTag, &amp;retTagLen, &amp;found, 
             OCI_SESSGET_SPOOL);
</pre><p>When using service contexts obtained from an OCI session pool, you are required to use the service context returned by <code class="codeph">OCISessionGet()</code> (or <code class="codeph">OCILogon2()</code>), and not create other service contexts outside of these calls.
                              </p>
                              <p>Any statement handle obtained using <code class="codeph">OCIStmtPrepare2()</code> with the service context should be subsequently used only in conjunction with the same service context, and never with a different service context.
                              </p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-7894AB6A-0CCD-4F22-9B84-5B40B2FC636C__GUID-154E065D-9EC6-4EF6-A9BD-5B11B67C5A8B">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="connect-authorize-and-initialize-functions.html#GUID-425D4B32-257C-480E-B69C-7112BE9482E6" title="Gets a session.">OCILogon2()</a></p>
                              </li>
                              <li>
                                 <p><a href="connect-authorize-and-initialize-functions.html#GUID-890DFBC4-718B-4339-A0EA-6226A25B8241" title="Gets a session.">OCISessionGet()</a></p>
                              </li>
                              <li>
                                 <p><a href="statement-functions.html#GUID-E6C1DC67-D464-4D2A-9F19-737423D31779" title="Prepares a SQL or PL/SQL statement for execution.">OCIStmtPrepare2()</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="LNOCI16629"></a><div class="props_rev_3"><a id="GUID-618B7C74-0045-4170-B50E-163BB364AF04" name="GUID-618B7C74-0045-4170-B50E-163BB364AF04"></a><h5 id="LNOCI-GUID-618B7C74-0045-4170-B50E-163BB364AF04" class="sect5"><span class="enumeration_section">11.1.6.4 </span>Log Off from the Database
                     </h5>
                     <div>
                        <p>Indicates two ways in which to log off from the database in session pooling mode depending on the logon call.</p>
                        <p>From the following calls, choose the one that corresponds to the logon call and use it to log off from the database in session pooling mode.</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">OCILogoff()</code></p>
                              <p>If you used <code class="codeph">OCILogon2()</code> to make the connection, you must call <code class="codeph">OCILogoff()</code> to log off.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">OCISessionRelease()</code></p>
                              <p>If you used <code class="codeph">OCISessionGet()</code> to make the connection, then you must call <code class="codeph">OCISessionRelease()</code> to log off. Pending transactions are automatically committed.
                              </p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-618B7C74-0045-4170-B50E-163BB364AF04__GUID-68D3E9C1-3D30-4022-B84C-7889F33A4782">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="connect-authorize-and-initialize-functions.html#GUID-567DA731-ABC9-4348-B29C-7B2C6C1D7C36" title="Releases a session that was retrieved using OCILogon2() or OCILogon().">OCILogoff()</a></p>
                              </li>
                              <li>
                                 <p><a href="connect-authorize-and-initialize-functions.html#GUID-425D4B32-257C-480E-B69C-7112BE9482E6" title="Gets a session.">OCILogon2()</a></p>
                              </li>
                              <li>
                                 <p><a href="connect-authorize-and-initialize-functions.html#GUID-DAAECC99-A432-48B5-AC33-0868C2FE762D" title="Releases a session that was retrieved using OCISessionGet().">OCISessionRelease()</a></p>
                              </li>
                              <li>
                                 <p><a href="connect-authorize-and-initialize-functions.html#GUID-890DFBC4-718B-4339-A0EA-6226A25B8241" title="Gets a session.">OCISessionGet()</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="LNOCI16630"></a><div class="props_rev_3"><a id="GUID-4E12F09A-D461-4B10-AD8D-48C2E492D6BB" name="GUID-4E12F09A-D461-4B10-AD8D-48C2E492D6BB"></a><h5 id="LNOCI-GUID-4E12F09A-D461-4B10-AD8D-48C2E492D6BB" class="sect5"><span class="enumeration_section">11.1.6.5 </span>Destroy the Session Pool
                     </h5>
                     <div>
                        <p>Call <code class="codeph">OCISessionPoolDestroy()</code> to destroy the session pool.
                        </p>
                        <p>This is shown in the following example:</p><pre class="oac_no_warn" dir="ltr">OCISessionPoolDestroy(poolhp, errhp, OCI_DEFAULT);</pre><div class="infoboxnotealso" id="GUID-4E12F09A-D461-4B10-AD8D-48C2E492D6BB__GUID-98BE1EB0-6D0F-4752-A3BE-06A64D1F2089">
                           <p class="notep1">See Also:</p>
                           <p><a href="connect-authorize-and-initialize-functions.html#GUID-2797C90C-C7AC-47FB-B1C2-CE41B743FB5C" title="Destroys a session pool.">OCISessionPoolDestroy()</a></p>
                        </div>
                     </div>
                  </div><a id="LNOCI16631"></a><div class="props_rev_3"><a id="GUID-B28BBFF7-2965-4D2C-B554-9AAE174DB461" name="GUID-B28BBFF7-2965-4D2C-B554-9AAE174DB461"></a><h5 id="LNOCI-GUID-B28BBFF7-2965-4D2C-B554-9AAE174DB461" class="sect5"><span class="enumeration_section">11.1.6.6 </span>Free the Pool Handle
                     </h5>
                     <div>
                        <p>Call <code class="codeph">OCIHandleFree()</code> to free the session pool handle.
                        </p>
                        <p>This is shown in the following example:</p><pre class="oac_no_warn" dir="ltr">OCIHandleFree((void *)poolhp, OCI_HTYPE_SPOOL);
</pre><div class="infoboxnote" id="GUID-B28BBFF7-2965-4D2C-B554-9AAE174DB461__GUID-CD59014D-9D14-4EFE-B690-E4AC53CAC232">
                           <p class="notep1">Note:</p>
                           <p>Developers: You are advised to commit or roll back any open transaction before releasing the connection back to the pool. If this is not done, Oracle Database automatically commits any open transaction when the connection is released.</p>
                           <p>If an instance failure is detected while the session pool is being used, OCI tries to clean up the sessions to that instance.</p>
                        </div>
                        <div class="infoboxnotealso" id="GUID-B28BBFF7-2965-4D2C-B554-9AAE174DB461__GUID-B61E2625-FE1C-4B9A-B4FA-E8366591BF17">
                           <p class="notep1">See Also:</p>
                           <p><a href="handle-and-descriptor-functions.html#GUID-E87E9F91-D3DC-4F35-BE7C-F1EFBFEEBA0A" title="Explicitly deallocates a handle">OCIHandleFree()</a></p>
                        </div>
                     </div>
                  </div>
               </div><a id="LNOCI16632"></a><div class="props_rev_3"><a id="GUID-72D13726-61B8-4CAB-9120-4E33714688AE" name="GUID-72D13726-61B8-4CAB-9120-4E33714688AE"></a><h4 id="LNOCI-GUID-72D13726-61B8-4CAB-9120-4E33714688AE" class="sect4"><span class="enumeration_section">11.1.7 </span>Example of OCI Session Pooling
                  </h4>
                  <div>
                     <p>Where to find an example of session pooling in a tested complete program.</p>
                     <p>For an example of session pooling in a tested complete program, see <code class="codeph">cdemosp.c</code> in directory <code class="codeph">demo</code>.
                     </p>
                  </div>
               </div>
            </div><a id="LNOCI9110"></a><div class="props_rev_3"><a id="GUID-1E260CD3-2EF7-49FF-97FC-041C2EF60381" name="GUID-1E260CD3-2EF7-49FF-97FC-041C2EF60381"></a><h3 id="LNOCI-GUID-1E260CD3-2EF7-49FF-97FC-041C2EF60381" class="sect3"><span class="enumeration_section">11.2 </span>Database Resident Connection Pooling
               </h3>
               <div>
                  <p>Database resident connection pooling (DRCP) provides a connection pool in the database server for typical web application usage scenarios where the application acquires a database connection, works on it for a relatively short duration, and then releases it. </p>
                  <p>DRCP pools server processes, each of which is the equivalent of a dedicated server process and a database session combined. (Henceforth these "dedicated" server processes are referred to as <span class="italic">pooled servers</span>.) 
                  </p>
                  <p>DRCP complements middle-tier connection pools that share connections between threads in a middle-tier process. In addition, DRCP enables sharing of database connections across middle-tier processes on the same middle-tier host and even across middle-tier hosts. This results in significant reduction in key database resources needed to support a large number of client connections, thereby reducing the database tier memory footprint and boosting the scalability of both middle-tier and database tiers. Having a pool of readily available servers has the additional benefit of reducing the cost of creating and tearing down client connections. </p>
                  <p>DRCP is especially relevant for architectures with multiprocess single-threaded application servers (such as PHP/Apache) that cannot do middle-tier connection pooling. Using DRCP, the database can scale to tens of thousands of simultaneous connections.</p>
                  <div class="infoboxnotealso" id="GUID-1E260CD3-2EF7-49FF-97FC-041C2EF60381__GUID-7437CBB6-FBC4-4A2D-96A8-B55881510B27">
                     <p class="notep1">See Also:</p>
                     <p><a href="../adfns/performance-and-scalability.html#ADFNS228" target="_blank"><span><cite>Oracle Database Development Guide</cite></span></a> for complete information about DRCP 
                     </p>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-BF9AFFD6-537A-4252-BBFB-3A60EEAC3E61" name="GUID-BF9AFFD6-537A-4252-BBFB-3A60EEAC3E61"></a><h3 id="LNOCI-GUID-BF9AFFD6-537A-4252-BBFB-3A60EEAC3E61" class="sect3"><span class="enumeration_section">11.3 </span>About Using Oracle Connection Manager in Traffic Director Mode
               </h3>
               <div>
                  <p>Oracle Connection Manager in Traffic Director Mode is a proxy that is placed between supported database clients and database instances.</p>
                  <div class="p">Supported clients from Oracle Database 11<span class="italic">g</span> Release 2 (11.2) and later can connect to Oracle Connection Manager in Traffic Director Mode. Oracle Connection Manager in Traffic Director Mode provides improved high availability (HA) for planned and unplanned database server outages, connection multiplexing support, and load balancing. Support for Oracle Connection Manager in Traffic Director Mode is described in more detail in the following sections
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="session-and-connection-pooling.html#GUID-BF9AFFD6-537A-4252-BBFB-3A60EEAC3E61__MODESOFOPERATION-4FD4C8FE">Modes of Operation</a></p>
                        </li>
                        <li>
                           <p><a href="session-and-connection-pooling.html#GUID-BF9AFFD6-537A-4252-BBFB-3A60EEAC3E61__KEYFEATURES-4FD4D08F">Key Features</a></p>
                        </li>
                     </ul>
                  </div>
                  <div class="section" id="GUID-BF9AFFD6-537A-4252-BBFB-3A60EEAC3E61__MODESOFOPERATION-4FD4C8FE">
                     <p class="subhead2" id="GUID-BF9AFFD6-537A-4252-BBFB-3A60EEAC3E61__GUID-749BC524-93BC-42F1-B765-970605875B7F">Modes of Operation</p>
                     <p>Oracle Connection Manager in Traffic Director Mode supports the following modes of operation:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <div class="p">In pooled connection mode, Oracle Connection Manager in Traffic Director Mode supports any application using the following database client releases:
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>OCI, OCCI, and Open Source Drivers (Oracle Database 11<span class="italic">g</span> release 2 (11.2.0.4) and later))
                                    </p>
                                 </li>
                                 <li>
                                    <p>JDBC (Oracle Database 12<span class="italic">c</span> release 1 (12.1) and later)
                                    </p>
                                 </li>
                                 <li>
                                    <p>ODP.NET (Oracle Database 12<span class="italic">c</span> release 2 (12.2) and later)
                                    </p>
                                 </li>
                              </ul>
                           </div>
                           <p>In addition, applications must use DRCP. That is, the application must enable DRCP in the connect string (or in the <code class="codeph">tnsnames.ora</code> alias).
                           </p>
                        </li>
                        <li>
                           <p>In non-pooled connection (or dedicated) mode, Oracle Connection Manager in Traffic Director Mode supports any application using database client releases Oracle Database 11<span class="italic">g</span> release 2 (11.2.0.4) and later. In this mode, some capabilities, such as connection multiplexing are not available. 
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section" id="GUID-BF9AFFD6-537A-4252-BBFB-3A60EEAC3E61__KEYFEATURES-4FD4D08F">
                     <p class="subhead2" id="GUID-BF9AFFD6-537A-4252-BBFB-3A60EEAC3E61__GUID-3A52B2C3-D63C-4ACB-8FED-1BAFC3801338">Key Features</p>
                     <div class="p">Oracle Connection Manager in Traffic Director Mode furnishes support for the following:
                        <ul style="list-style-type: disc;">
                           <li>
                              <div class="p">Transparent performance enhancements and connection multiplexing, which includes:
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>Statement caching, rows prefetching, and result set caching are auto-enabled for all modes of operation.</p>
                                    </li>
                                    <li>
                                       <p>Database session multiplexing (pooled mode only) using the proxy resident connection pool (PRCP), where PRCP is a proxy mode of Database Resident Connection Pooling (DRCP). Applications get transparent connect-time load balancing and run-time load balancing between Oracle Connection Manager in Traffic Director Mode and the database.</p>
                                    </li>
                                    <li>
                                       <p>For multiple Oracle Connection Manager in Traffic Director Mode instances, applications get increased scalability through client-side connect time load balancing or with a load balancer (BIG-IP, NGINX, and others)</p>
                                    </li>
                                 </ul>
                              </div>
                           </li>
                           <li>
                              <div class="p">Zero application downtime
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <div class="p">Planned database maintenance or pluggable database (PDB) relocation
                                          <ul style="list-style-type: disc;">
                                             <li>
                                                <p>Pooled mode</p>
                                                <p>Oracle Connection Manager in Traffic Director Mode responds to Oracle Notification Service (ONS) events for planned outages and redirects work. Connections are drained from the pool on Oracle Connection Manager in Traffic Director Mode when the request completes. Service relocation is supported for Oracle Database 11<span class="italic">g</span> release 2 (11.2.0.4) and later.
                                                </p>
                                                <p>For PDB relocation, Oracle Connection Manager in Traffic Director Mode responds to in-band notifications when a PDB is relocated, that is even when ONS is not configured (for Oracle Database release 18c, version 18.1 and later server only)&nbsp;</p>
                                             </li>
                                             <li>
                                                <p>Non-pooled or dedicated mode</p>
                                                <div class="p">When there is no request boundary information from the client, Oracle Connection Manager in Traffic Director Mode supports planned outage for many applications (as long as only simple session state and cursor state need to be preserved across the request/transaction boundaries). This support includes:
                                                   <ul style="list-style-type: disc;">
                                                      <li>
                                                         <p>Stop service/PDB at the transaction boundary or it leverages Oracle Database release 18c&nbsp;continuous application availability&nbsp;to stop the service at the request boundary</p>
                                                      </li>
                                                      <li>
                                                         <p>Oracle Connection Manager in Traffic Director Mode leverages Transparent Application Failover (TAF) failover restore to reconnect and restore simple states.</p>
                                                      </li>
                                                   </ul>
                                                </div>
                                             </li>
                                          </ul>
                                       </div>
                                    </li>
                                    <li>
                                       <p>Unplanned database outages for read-mostly workloads</p>
                                    </li>
                                 </ul>
                              </div>
                           </li>
                           <li>
                              <div class="p">High Availability of Oracle Connection Manager in Traffic Director Mode to avoid a single point of failure. This is supported by:
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>Multiple instances of Oracle Connection Manager in Traffic Director Mode using a load balancer or client side load balancing/failover in the connect string</p>
                                    </li>
                                    <li>
                                       <p>Rolling upgrade of Oracle Connection Manager in Traffic Director Mode instances</p>
                                    </li>
                                    <li>
                                       <p>Graceful close of existing connections from client to Oracle Connection Manager in Traffic Director Mode for planned outages</p>
                                    </li>
                                    <li>
                                       <p>In-band notifications to Oracle Database release 18c and later clients</p>
                                    </li>
                                    <li>
                                       <p>For older clients, notifications are sent with the response of the current request</p>
                                    </li>
                                 </ul>
                              </div>
                           </li>
                           <li>
                              <div class="p">For security and isolation, Oracle Connection Manager in Traffic Director Mode furnishes:
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>Database Proxy supporting transmission control protocol/transmission control protocol secure (TCP/TCPS) and protocol conversion</p>
                                    </li>
                                    <li>
                                       <p>Firewall based on the IP address, service name, and secure socket layer/transport layer security (SSL/TLS) wallets</p>
                                    </li>
                                    <li>
                                       <p>Tenant isolation in a multi-tenant environment</p>
                                    </li>
                                    <li>
                                       <p>Protection against denial-of-service and fuzzing attacks</p>
                                    </li>
                                    <li>
                                       <p>Secure tunneling of database traffic across Oracle Database on-premises and Oracle Cloud</p>
                                    </li>
                                 </ul>
                              </div>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-BF9AFFD6-537A-4252-BBFB-3A60EEAC3E61__GUID-A2DD3A99-8792-4704-A482-B66B30AD1B85">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="../netag/configuring-oracle-connection-manager.html#NETAG-GUID-3917FC5D-4B23-4752-85BA-39A88C4D13F8" target="_blank"><span><cite>Oracle Database Net Services Administrator's Guide</cite></span></a> for information about configuring <code class="codeph">cman.ora</code> configuration file to set up Oracle Connection Manager in Traffic Director Mode
                              </p>
                           </li>
                           <li>
                              <p><a href="../netag/configuring-oracle-connection-manager.html#NETAG-GUID-58847B76-3836-41DB-9EB6-A81D5C397024" target="_blank"><span><cite>Oracle Database Net Services Administrator's Guide</cite></span></a> for information about configuring databases for Oracle Connection Manager in Traffic Director Mode proxy authentication
                              </p>
                           </li>
                           <li>
                              <p><a href="../netag/configuring-oracle-connection-manager.html#NETAG-GUID-96FA23BA-F32B-4D47-9CBB-69D27E8D94F6" target="_blank"><span><cite>Oracle Database Net Services Administrator's Guide</cite></span></a> for information about configuring Oracle Connection Manager in Traffic Director Mode for unplanned down events
                              </p>
                           </li>
                           <li>
                              <p><a href="../netag/configuring-oracle-connection-manager.html#NETAG-GUID-E73658E7-BBF7-4C13-AAD5-70D32062AD8D" target="_blank"><span><cite>Oracle Database Net Services Administrator's Guide</cite></span></a> for information about configuring Oracle Connection Manager in Traffic Director Mode for planned down events
                              </p>
                           </li>
                           <li>
                              <p><a href="../netag/configuring-oracle-connection-manager.html#NETAG-GUID-15756B12-5ED5-4EDE-9D4B-6B890D5BE9AF" target="_blank"><span><cite>Oracle Database Net Services Administrator's Guide</cite></span> </a> for information about configuring proxy resident connection pools for use by Oracle Connection Manager in Traffic Director Mode
                              </p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/lnoci&amp;id=NETAG-GUID-FC833F8F-CE5A-4C02-A962-244954158853" target="_blank"><span><cite>Oracle Database Net Services Administrator's Guide</cite></span></a> for information about functionality not supported for all drivers with Oracle Connection Manager in Traffic Director Mode
                              </p>
                           </li>
                           <li>
                              <p><a href="../netrf/index.html" target="_blank"><span><cite>Oracle Database Net Services Reference</cite></span></a> for an overview of Oracle CMAN configuration file
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="LNOCI16602"></a><div class="props_rev_3"><a id="GUID-1C9A6E8F-EF5A-478D-B65E-CE39D4F00683" name="GUID-1C9A6E8F-EF5A-478D-B65E-CE39D4F00683"></a><h3 id="LNOCI-GUID-1C9A6E8F-EF5A-478D-B65E-CE39D4F00683" class="sect3"><span class="enumeration_section">11.4 </span>Connection Pooling in OCI
               </h3>
               <div>
                  <p>Connection pooling is the use of a group (the pool) of reusable physical connections by several sessions to balance loads. </p>
                  <p>The pool is managed by OCI, not the application. Applications that can use connection pooling include middle-tier applications for web application servers and email servers.</p>
                  <p>One use of this feature is in a web application server connected to a back-end Oracle database. Suppose that a web application server gets several concurrent requests for data from the database server. The application can create a pool (or a set of pools) in each environment during application initialization.</p>
                  <div class="p">This section includes the following topics:
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="session-and-connection-pooling.html#GUID-C7AB12E8-E640-41F0-9C28-E68F7E683694" title="Connection pooling on the middletier is similar to what a shared server offers on the back end. Stateless sessions are serially reusable across mid-tier threads.You can use the advanced concept of multiple connection pools for different database connections. Transaction application failover (TAF) is enabled for connection pooling.">OCI Connection Pooling Concepts</a></p>
                        </li>
                        <li>
                           <p><a href="session-and-connection-pooling.html#GUID-322FF18E-48AE-4B94-8477-E91127F6BA86" title="Lists the steps you must follow to use connection pooling in your application.">Using OCI Calls for Connection Pooling</a></p>
                        </li>
                        <li>
                           <p><a href="session-and-connection-pooling.html#GUID-AE06BCB1-7333-458E-90F0-0761496EC5E1" title="Where to find examples of connection pooling in tested complete programs.">Examples of OCI Connection Pooling</a></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="LNOCI16603"></a><div class="props_rev_3"><a id="GUID-C7AB12E8-E640-41F0-9C28-E68F7E683694" name="GUID-C7AB12E8-E640-41F0-9C28-E68F7E683694"></a><h4 id="LNOCI-GUID-C7AB12E8-E640-41F0-9C28-E68F7E683694" class="sect4"><span class="enumeration_section">11.4.1 </span>OCI Connection Pooling Concepts
                  </h4>
                  <div>
                     <p>Oracle Database has several transaction monitoring capabilities such as the fine-grained management of database sessions and connections. Fine-grained management of database sessions is done by separating the notion of database sessions (user handles) from connections (server handles). By using OCI calls for session switching and session migration, an application server or transaction monitor can multiplex several sessions over fewer physical connections, thus achieving a high degree of scalability by pooling connections and back-end Oracle server processes.</p>
                     <p>The connection pool itself is normally configured with a shared pool of physical connections, translating to a back-end server pool containing an identical number of dedicated server processes.</p>
                     <p>The number of physical connections is less than the number of database sessions in use by the application. The number of physical connections and back-end server processes are also reduced by using connection pooling. Thus many more database sessions can be multiplexed. </p>
                     <div class="p">This section includes the following topics:
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="session-and-connection-pooling.html#GUID-3C6F8FF3-195D-4DCB-B684-8102004F4686" title="Connection pooling on the middletier is similar to what a shared server offers on the back end.">Similarities and Differences from a Shared Server</a></p>
                           </li>
                           <li>
                              <p><a href="session-and-connection-pooling.html#GUID-11F389B2-7D7A-4188-96AC-438C25139C4D" title="Stateless sessions are serially reusable across mid-tier threads.">Stateless Sessions Versus Stateful Sessions</a></p>
                           </li>
                           <li>
                              <p><a href="session-and-connection-pooling.html#GUID-46A224F5-1BF9-4AE0-BCF1-5222CB913B09" title="You can use the advanced concept of multiple connection pools for different database connections.">Multiple Connection Pools</a></p>
                           </li>
                           <li>
                              <p><a href="session-and-connection-pooling.html#GUID-55F39E75-40EB-464B-AEFB-75FF8ABD0169" title="Transaction application failover (TAF) is enabled for connection pooling.">Transparent Application Failover</a></p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="LNOCI16604"></a><div class="props_rev_3"><a id="GUID-3C6F8FF3-195D-4DCB-B684-8102004F4686" name="GUID-3C6F8FF3-195D-4DCB-B684-8102004F4686"></a><h5 id="LNOCI-GUID-3C6F8FF3-195D-4DCB-B684-8102004F4686" class="sect5"><span class="enumeration_section">11.4.1.1 </span>Similarities and Differences from a Shared Server
                     </h5>
                     <div>
                        <p>Connection pooling on the middletier is similar to what a shared server offers on the back end. </p>
                        <p>Connection pooling makes a dedicated server instance behave like a shared server instance by managing the session multiplexing logic on the middle tier. </p>
                        <p>The connection pool on the middle tier controls the pooling of dedicated server processes including incoming connections into the dedicated server processes. The main difference between connection pooling and a shared server is that in the latter case, the connection from the client is normally to a dispatcher in the database instance. The dispatcher is responsible for directing the client request to an appropriate shared server. However, the physical connection from the connection pool is established directly from the middletier to the dedicated server process in the back-end server pool. </p>
                        <p>Connection pooling is beneficial only if the middle tier is multithreaded. Each thread can maintain a session to the database. The actual connections to the database are maintained by the connection pool, and these connections (including the pool of dedicated database server processes) are shared among all the threads in the middle tier.</p>
                     </div>
                  </div><a id="LNOCI16605"></a><div class="props_rev_3"><a id="GUID-11F389B2-7D7A-4188-96AC-438C25139C4D" name="GUID-11F389B2-7D7A-4188-96AC-438C25139C4D"></a><h5 id="LNOCI-GUID-11F389B2-7D7A-4188-96AC-438C25139C4D" class="sect5"><span class="enumeration_section">11.4.1.2 </span>Stateless Sessions Versus Stateful Sessions
                     </h5>
                     <div>
                        <p>Stateless sessions are serially reusable across mid-tier threads.</p>
                        <p>After a thread is done processing a database request on behalf of a three-tier user, the same database session can be reused for a completely different request on behalf of a completely different three-tier user.</p>
                        <p>Stateful sessions to the database, however, are not serially reusable across mid-tier threads because they may have some particular state associated with a particular three-tier user. Examples of such state may include open transactions, the fetch state from a statement, or a PL/SQL package state. So long as the state exists, the session is not reusable for a different request.</p>
                        <div class="infoboxnote" id="GUID-11F389B2-7D7A-4188-96AC-438C25139C4D__GUID-8121CD53-9389-40B3-B6A7-F42107562E4B">
                           <p class="notep1">Note:</p>
                           <p>Stateless sessions too may have open transactions, open statement fetch state, and so on. However, such a state persists for a relatively short duration (only during the processing of a particular three-tier request by a mid-tier thread) that allows the session to be serially reused for a different three-tier user (when such state is cleaned up).</p>
                           <p>Stateless sessions are typically used in conjunction with statement caching.</p>
                        </div>
                        <p>What connection pooling offers is stateless connections and stateful sessions. </p>
                        <div class="infoboxnotealso" id="GUID-11F389B2-7D7A-4188-96AC-438C25139C4D__GUID-D99ECBE5-A379-48FF-B7AF-F87298C255F4">
                           <p class="notep1">See Also:</p>
                           <p><a href="session-and-connection-pooling.html#GUID-F9662FFB-EAEF-495C-96FC-49C6D1D9625C" title="Session pooling means that the application creates and maintains a group of stateless sessions to the database.">Session Pooling in OCI</a> if you must work with stateless sessions
                           </p>
                        </div>
                     </div>
                  </div><a id="LNOCI16607"></a><a id="LNOCI16606"></a><div class="props_rev_3"><a id="GUID-46A224F5-1BF9-4AE0-BCF1-5222CB913B09" name="GUID-46A224F5-1BF9-4AE0-BCF1-5222CB913B09"></a><h5 id="LNOCI-GUID-46A224F5-1BF9-4AE0-BCF1-5222CB913B09" class="sect5"><span class="enumeration_section">11.4.1.3 </span>Multiple Connection Pools
                     </h5>
                     <div>
                        <p>You can use the advanced concept of multiple connection pools for different database connections. </p>
                        <p>Multiple connection pools can also be used when different priorities are assigned to users. Different service-level guarantees can be implemented using connection pooling.</p>
                        <p><a href="session-and-connection-pooling.html#GUID-46A224F5-1BF9-4AE0-BCF1-5222CB913B09__CHDHJEDC">Figure 11-1</a> illustrates OCI connection pooling.
                        </p>
                        <div class="figure" id="GUID-46A224F5-1BF9-4AE0-BCF1-5222CB913B09__CHDHJEDC">
                           <p class="titleinfigure">Figure 11-1 OCI Connection Pooling</p><img src="img/lnoci043.gif" alt="Description of Figure 11-1 follows" title="Description of Figure 11-1 follows" longdesc="img_text/lnoci043.html"><br><a href="img_text/lnoci043.html">Description of "Figure 11-1 OCI Connection Pooling"</a></div>
                        <!-- class="figure" -->
                     </div>
                  </div><a id="LNOCI16608"></a><div class="props_rev_3"><a id="GUID-55F39E75-40EB-464B-AEFB-75FF8ABD0169" name="GUID-55F39E75-40EB-464B-AEFB-75FF8ABD0169"></a><h5 id="LNOCI-GUID-55F39E75-40EB-464B-AEFB-75FF8ABD0169" class="sect5"><span class="enumeration_section">11.4.1.4 </span>Transparent Application Failover
                     </h5>
                     <div>
                        <p>Transaction application failover (TAF) is enabled for connection pooling. </p>
                        <p>The concepts of TAF apply equally well with connections in the connection pool except that the <code class="codeph">BACKUP</code> and <code class="codeph">PRECONNECT</code> clauses should not be used in the connect string and do not work with connection pooling and TAF.
                        </p>
                        <p>When a connection in the connection pool fails over, it uses the primary connect string itself to connect. Sessions fail over when they use the pool for a database round-trip after their instance failure. The listener is configured to route the connection to a good instance if available, as is typical with service-based connect strings. </p>
                        <div class="infoboxnotealso" id="GUID-55F39E75-40EB-464B-AEFB-75FF8ABD0169__GUID-07806C44-89C5-4548-BED3-26D6214EBCDC">
                           <p class="notep1">See Also:</p>
                           <p><a href="../netag/enabling-advanced-features.html#NETAG0131" target="_blank"><span class="italic">Oracle Database Net Services Administrator's Guide</span></a>, the chapter about configuring transparent application failover 
                           </p>
                        </div>
                     </div>
                  </div>
               </div><a id="LNOCI091"></a><div class="props_rev_3"><a id="GUID-322FF18E-48AE-4B94-8477-E91127F6BA86" name="GUID-322FF18E-48AE-4B94-8477-E91127F6BA86"></a><h4 id="LNOCI-GUID-322FF18E-48AE-4B94-8477-E91127F6BA86" class="sect4"><span class="enumeration_section">11.4.2 </span>Using OCI Calls for Connection Pooling
                  </h4>
                  <div>
                     <p>Lists the steps you must follow to use connection pooling in your application.</p>
                     <div class="section">
                        <p>To use connection pooling in your application, you must:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li><span><a href="session-and-connection-pooling.html#GUID-C09AF9F9-34EB-4D1D-849E-9B962463C7A7" title="Connection pooling requires that the pool handle OCI_HTYPE_CPOOL be allocated by OCIHandleAlloc().">Allocate the Pool Handle</a></span></li>
                        <li><span><a href="session-and-connection-pooling.html#GUID-4298BCA2-0EE0-4B77-B9CB-88845562F44C" title="The function OCIConnectionPoolCreate() initializes the connection pool handle.">Create the Connection Pool</a></span></li>
                        <li><span><a href="session-and-connection-pooling.html#GUID-1DB08E60-053F-4D7B-A56D-FE42FE9463B5" title="The application can use one of several interfaces.">Log On to the Database</a></span></li>
                        <li><span><a href="session-and-connection-pooling.html#GUID-497689F0-20A0-4CEF-91DC-594DBACED921" title="With OCI_CPOOL mode (connection pooling), the session memory (UGA) in the back-end database comes out of the SGA.">Deal with SGA Limitations in Connection Pooling</a></span></li>
                        <li><span><a href="session-and-connection-pooling.html#GUID-73DFAAA9-4EB2-44ED-9DEC-2B803B990AE2" title="Choose the appropriate call to log off from the database in connection pooling mode.">Log Off from the Database</a></span></li>
                        <li><span><a href="session-and-connection-pooling.html#GUID-CB0DC00D-C935-41BC-AF4B-29C3288B743B" title="OCIConnectionPoolDestroy() destroys it.">Destroy the Connection Pool</a></span></li>
                        <li><span><a href="session-and-connection-pooling.html#GUID-676CFBC3-69CC-447B-B0A5-B58BE827291E" title="The pool handle is freed using OCIHandleFree().">Free the Pool Handle</a></span></li>
                     </ol>
                  </div><a id="LNOCI16609"></a><div class="props_rev_3"><a id="GUID-C09AF9F9-34EB-4D1D-849E-9B962463C7A7" name="GUID-C09AF9F9-34EB-4D1D-849E-9B962463C7A7"></a><h5 id="LNOCI-GUID-C09AF9F9-34EB-4D1D-849E-9B962463C7A7" class="sect5"><span class="enumeration_section">11.4.2.1 </span>Allocate the Pool Handle
                     </h5>
                     <div>
                        <p>Connection pooling requires that the pool handle <code class="codeph">OCI_HTYPE_CPOOL</code> be allocated by <code class="codeph">OCIHandleAlloc()</code>.
                        </p>
                        <div class="section">
                           <p>Multiple pools can be created for a given environment handle. </p>
                           <p>For a single connection pool, here is an allocation example:</p><pre class="oac_no_warn" dir="ltr">OCICPool *poolhp;
OCIHandleAlloc((void *) envhp, (void **) &amp;poolhp, OCI_HTYPE_CPOOL, 
                      (size_t) 0, (void **) 0));</pre><div class="infoboxnotealso" id="GUID-C09AF9F9-34EB-4D1D-849E-9B962463C7A7__GUID-D75099C1-D242-40F9-A937-82E507605152">
                              <p class="notep1">See Also:</p>
                              <p><a href="handle-and-descriptor-functions.html#GUID-C5BF55F7-A110-4CB5-9663-5056590F12B5" title="Returns a pointer to an allocated and initialized handle.">OCIHandleAlloc()</a></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="LNOCI16610"></a><div class="props_rev_3"><a id="GUID-4298BCA2-0EE0-4B77-B9CB-88845562F44C" name="GUID-4298BCA2-0EE0-4B77-B9CB-88845562F44C"></a><h5 id="LNOCI-GUID-4298BCA2-0EE0-4B77-B9CB-88845562F44C" class="sect5"><span class="enumeration_section">11.4.2.2 </span>Create the Connection Pool
                     </h5>
                     <div>
                        <p>The function <code class="codeph">OCIConnectionPoolCreate()</code> initializes the connection pool handle. 
                        </p>
                        <div class="section">
                           <p>It has these <code class="codeph">IN</code> parameters:
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">connMin</code>, the minimum number of connections to be opened when the pool is created.
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">connIncr</code>, the incremental number of connections to be opened when all the connections are busy and a call needs a connection. This increment is used only when the total number of open connections is less than the maximum number of connections that can be opened in that pool.
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">connMax</code>, the maximum number of connections that can be opened in the pool. When the maximum number of connections are open in the pool, and all the connections are busy, if a call needs a connection, it waits until it gets one. However, if the <code class="codeph">OCI_ATTR_CONN_NOWAIT</code> attribute is set for the pool, an error is returned.
                                 </p>
                              </li>
                              <li>
                                 <p>A <code class="codeph">poolUsername</code> and a <code class="codeph">poolPassword</code>, to allow user sessions to transparently migrate between connections in the pool.
                                 </p>
                              </li>
                              <li>
                                 <p>In addition, an attribute <code class="codeph">OCI_ATTR_CONN_TIMEOUT</code>, can be set to time out the connections in the pool. Connections idle for more than this time are terminated periodically to maintain an optimum number of open connections. If this attribute is not set, then the connections are never timed out.
                                 </p>
                              </li>
                           </ul>
                           <div class="infoboxnote" id="GUID-4298BCA2-0EE0-4B77-B9CB-88845562F44C__GUID-2A07D24D-88CC-4CC3-828D-1AFB8A3865BD">
                              <p class="notep1">Note:</p>
                              <p>Shrinkage of the pool only occurs when there is a network round-trip. If there are no operations, then the connections stay active.</p>
                           </div>
                           <p>Because all the preceding attributes can be configured dynamically, the application can read the current load (number of open connections and number of busy connections) and tune these attributes appropriately.</p>
                           <p>If the pool attributes (<code class="codeph">connMax</code>, <code class="codeph">connMin</code><span class="italic">,</span> <code class="codeph">connIncr</code>) are to be changed dynamically, <code class="codeph">OCIConnectionPoolCreate()</code> must be called with <code class="codeph">mode</code> set to <code class="codeph">OCI_CPOOL_REINITIALIZE</code>.
                           </p>
                           <p>The OUT parameters <code class="codeph">poolName</code> and <code class="codeph">poolNameLen</code> contain values to be used in subsequent <code class="codeph">OCIServerAttach()</code> and <code class="codeph">OCILogon2()</code> calls in place of the database name and the database name length arguments.
                           </p>
                           <p>There is no limit on the number of pools that can be created by an application. Middle-tier applications can create multiple pools to connect to the same server or to different servers, to balance the load based on the specific needs of the application.</p>
                           <p>Here is an example of this call:</p><pre class="oac_no_warn" dir="ltr">OCIConnectionPoolCreate((OCIEnv *)envhp,
                   (OCIError *)errhp, (OCICPool *)poolhp,
                   &amp;poolName, &amp;poolNameLen,
                   (text *)database,strlen(database),
                   (ub4) connMin, (ub4) connMax, (ub4) connIncr,
                   (text *)poolUsername,strlen(poolUserLen),
                   (text *)poolPassword,strlen(poolPassLen),
                   OCI_DEFAULT));</pre><div class="infoboxnotealso" id="GUID-4298BCA2-0EE0-4B77-B9CB-88845562F44C__GUID-6F1CEDE0-8FF2-4DA5-B83C-4266DF3E2336">
                              <p class="notep1">See Also:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><a href="connect-authorize-and-initialize-functions.html#GUID-7E5A69F2-0268-4655-845D-A7662902FAA2" title="Initializes the connection pool.">OCIConnectionPoolCreate()</a></p>
                                 </li>
                                 <li>
                                    <p><a href="handle-and-descriptor-attributes.html#GUID-400B741C-E4AA-4155-8279-09FD80A6B38F__CACFEFEB">OCI_ATTR_CONN_TIMEOUT</a></p>
                                 </li>
                                 <li>
                                    <p><a href="connect-authorize-and-initialize-functions.html#GUID-B6291228-DA2F-4CE9-870A-F94243141757" title="Creates an access path to a data source for OCI operations.">OCIServerAttach()</a></p>
                                 </li>
                                 <li>
                                    <p><a href="connect-authorize-and-initialize-functions.html#GUID-425D4B32-257C-480E-B69C-7112BE9482E6" title="Gets a session.">OCILogon2()</a></p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="LNOCI16611"></a><div class="props_rev_3"><a id="GUID-1DB08E60-053F-4D7B-A56D-FE42FE9463B5" name="GUID-1DB08E60-053F-4D7B-A56D-FE42FE9463B5"></a><h5 id="LNOCI-GUID-1DB08E60-053F-4D7B-A56D-FE42FE9463B5" class="sect5"><span class="enumeration_section">11.4.2.3 </span>Log On to the Database
                     </h5>
                     <div>
                        <p>The application can use one of several interfaces.</p>
                        <div class="section">
                           <p>The application must log on to the database for each thread, using one of the following interfaces.</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">OCILogon2()</code></p>
                                 <p>This is the simplest interface. Use this interface when you need a simple connection pool connection and do not need to alter any attributes of the session handle. This interface can also be used to make proxy connections to the database.</p>
                                 <p>Here is an example using <code class="codeph">OCILogon2()</code>: 
                                 </p><pre class="oac_no_warn" dir="ltr">for (i = 0; i &lt; MAXTHREADS; ++i) 
{ 
   OCILogon2(envhp, errhp, &amp;svchp[i], "hr", 2, "hr", 2, poolName,
             poolNameLen, OCI_LOGON2_CPOOL));

}
</pre><p>To use this interface to get a proxy connection, set the password parameter to <code class="codeph">NULL</code>.
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">OCISessionGet()</code></p>
                                 <p>This is the recommended interface. It gives the user the additional option of using external authentication methods, such as certificates, distinguished name, and so on. <code class="codeph">OCISessionGet()</code> is the recommended uniform function call to retrieve a session.
                                 </p>
                                 <p>Here is an example using <code class="codeph">OCISessionGet()</code>:
                                 </p><pre class="oac_no_warn" dir="ltr">for (i = 0; i &lt; MAXTHREADS; ++i) 
{ 
        OCISessionGet(envhp, errhp, &amp;svchp, authp,
                      (OraText *) poolName,
                      strlen(poolName), NULL, 0, NULL, NULL, NULL,
                      OCI_SESSGET_CPOOL)
 }
</pre></li>
                              <li>
                                 <p><code class="codeph">OCIServerAttach()</code> and <code class="codeph">OCISessionBegin()</code></p>
                                 <p>You can use another interface if the application must set any special attributes on the user session handle and server handle. For such a requirement, applications must allocate all the handles (connection pool handle, server handles, session handles, and service context handles). You would follow this sequence:</p>
                                 <ol>
                                    <li>
                                       <p>Create the connection pool. </p>
                                       <p>Connection pooling does the multiplexing of a virtual server handle over physical connections transparently, eliminating the need for users to do so. The user gets the feeling of a session having a dedicated (virtual) connection. Because the multiplexing is done transparently to the user, users must not attempt to multiplex sessions over the virtual server handles themselves. The concepts of session migration and session switching, which require explicit multiplexing at the user level, are defunct for connection pooling and should not be used.</p>
                                    </li>
                                    <li>
                                       <p>Call <code class="codeph">OCIServerAttach()</code> with mode set to <code class="codeph">OCI_CPOOL</code>. 
                                       </p>
                                       <p>In an OCI program, the user should create (<code class="codeph">OCIServerAttach()</code> with mode set to <code class="codeph">OCI_CPOOL</code>), a unique virtual server handle for each session that is created using the connection pool. There should be a one-to-one mapping between virtual server handles and sessions.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Call <code class="codeph">OCISessionBegin()</code> with mode set to <code class="codeph">OCI_DEFAULT</code>.
                                       </p>
                                       <p>Credentials can be set to <code class="codeph">OCI_CRED_RDBMS</code>, <code class="codeph">OCI_CRED_EXT</code>, or <code class="codeph">OCI_CRED_PROXY</code> using  <code class="codeph">OCISessionBegin()</code>. If the credentials are set to <code class="codeph">OCI_CRED_EXT</code>, no user name and no password need to be set on the session handle. If the credentials are set to <code class="codeph">OCI_CRED_PROXY</code>, only the user name must be set on the session handle. (no explicit primary session must be created and <code class="codeph">OCI_ATTR_MIGSESSION</code> need not be set).
                                       </p>
                                       <p>The user should not set <code class="codeph">OCI_MIGRATE</code> flag in the call to <code class="codeph">OCISessionBegin()</code> when the virtual server handle points to a connection pool (<code class="codeph">OCIServerAttach()</code> called with <code class="codeph">mode</code> set to <code class="codeph">OCI_CPOOL</code>). Oracle supports passing the <code class="codeph">OCI_MIGRATE</code> flag only for compatibility reasons. Do not use the <code class="codeph">OCI_MIGRATE</code> flag, because the perception that the user gets when using a connection pool is of sessions having their own dedicated (virtual) connections that are transparently multiplexed onto real connections. 
                                       </p>
                                    </li>
                                 </ol>
                              </li>
                           </ul>
                           <div class="infoboxnotealso" id="GUID-1DB08E60-053F-4D7B-A56D-FE42FE9463B5__GUID-45CD8766-90C4-48CD-96DB-11F5C568887E">
                              <p class="notep1">See Also:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><a href="connect-authorize-and-initialize-functions.html#GUID-425D4B32-257C-480E-B69C-7112BE9482E6" title="Gets a session.">OCILogon2()</a></p>
                                 </li>
                                 <li>
                                    <p><a href="connect-authorize-and-initialize-functions.html#GUID-890DFBC4-718B-4339-A0EA-6226A25B8241" title="Gets a session.">OCISessionGet()</a></p>
                                 </li>
                                 <li>
                                    <p><a href="connect-authorize-and-initialize-functions.html#GUID-B6291228-DA2F-4CE9-870A-F94243141757" title="Creates an access path to a data source for OCI operations.">OCIServerAttach()</a></p>
                                 </li>
                                 <li>
                                    <p><a href="connect-authorize-and-initialize-functions.html#GUID-31B1FDB3-056E-4AF9-9B89-8DA6AA156947" title="Creates a user session and begins a user session for a given server.">OCISessionBegin()</a></p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="LNOCI16612"></a><div class="props_rev_3"><a id="GUID-497689F0-20A0-4CEF-91DC-594DBACED921" name="GUID-497689F0-20A0-4CEF-91DC-594DBACED921"></a><h5 id="LNOCI-GUID-497689F0-20A0-4CEF-91DC-594DBACED921" class="sect5"><span class="enumeration_section">11.4.2.4 </span>Deal with SGA Limitations in Connection Pooling
                     </h5>
                     <div>
                        <p>With <code class="codeph">OCI_CPOOL</code> mode (connection pooling), the session memory (UGA) in the back-end database comes out of the SGA.
                        </p>
                        <p> This may require some SGA tuning on the back-end database to have a larger SGA if your application consumes more session memory than the SGA can accommodate. The memory tuning requirements for the back-end database are similar to configuring the LARGE POOL in a shared server back end except that the instance is still in dedicated mode.</p>
                        <p>If you are still running into the SGA limitation, you must consider: </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Reducing the session memory consumption by having fewer open statements for each session</p>
                           </li>
                           <li>
                              <p>Reducing the number of sessions in the back end by pooling sessions on the mid-tier</p>
                           </li>
                           <li>
                              <p>Or otherwise, turning off connection pooling</p>
                           </li>
                        </ul>
                        <p>The application must avoid using dedicated database links on the back end with connection pooling. </p>
                        <p>If the back end is a dedicated server, effective connection pooling is not possible because sessions using dedicated database links are tied to a physical connection rendering that same connection unusable by other sessions. If your application uses dedicated database links and you do not see effective sharing of back-end processes among your sessions, you must consider using shared database links.</p>
                        <div class="infoboxnotealso" id="GUID-497689F0-20A0-4CEF-91DC-594DBACED921__GUID-914FE48C-1B62-4CFB-B15B-BDC83FB1761A">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="../tgdba/tuning-shared-pool-and-large-pool.html#TGDBA558" target="_blank"><span><cite>Oracle Database Performance Tuning Guide</cite></span></a>, the section about configuring a shared server
                                 </p>
                              </li>
                              <li>
                                 <p><a href="../admin/distributed-database-concepts.html#ADMIN12083" target="_blank"><span><cite>Oracle Database Administrator’s Guide</cite></span></a>, the section on shared database links for more information about distributed databases 
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="LNOCI16613"></a><div class="props_rev_3"><a id="GUID-73DFAAA9-4EB2-44ED-9DEC-2B803B990AE2" name="GUID-73DFAAA9-4EB2-44ED-9DEC-2B803B990AE2"></a><h5 id="LNOCI-GUID-73DFAAA9-4EB2-44ED-9DEC-2B803B990AE2" class="sect5"><span class="enumeration_section">11.4.2.5 </span>Log Off from the Database
                     </h5>
                     <div>
                        <p>Choose the appropriate call to log off from the database in connection pooling mode.</p>
                        <p>From the following calls, choose the one that corresponds to the logon call and use it to log off from the database in connection pooling mode.</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">OCILogoff()</code>:
                              </p>
                              <p>If <code class="codeph">OCILogon2()</code> was used to make the connection, <code class="codeph">OCILogoff()</code> must be used to log off.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">OCISessionRelease()</code></p>
                              <p>If OCISessionGet() was called to make the connection, then <code class="codeph">OCISessionRelease()</code> must be called to log off.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">OCISessionEnd()</code> and <code class="codeph">OCIServerDetach()</code></p>
                              <p>If <code class="codeph">OCIServerAttach()</code> and <code class="codeph">OCISessionBegin()</code> were called to make the connection and start the session, then <code class="codeph">OCISessionEnd()</code> must be called to end the session and <code class="codeph">OCIServerDetach()</code> must be called to release the connection.
                              </p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-73DFAAA9-4EB2-44ED-9DEC-2B803B990AE2__GUID-F9190CE5-BE4A-420B-A4C9-ABC5488B1E0D">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="connect-authorize-and-initialize-functions.html#GUID-567DA731-ABC9-4348-B29C-7B2C6C1D7C36" title="Releases a session that was retrieved using OCILogon2() or OCILogon().">OCILogoff()</a></p>
                              </li>
                              <li>
                                 <p><a href="connect-authorize-and-initialize-functions.html#GUID-425D4B32-257C-480E-B69C-7112BE9482E6" title="Gets a session.">OCILogon2()</a></p>
                              </li>
                              <li>
                                 <p><a href="connect-authorize-and-initialize-functions.html#GUID-DAAECC99-A432-48B5-AC33-0868C2FE762D" title="Releases a session that was retrieved using OCISessionGet().">OCISessionRelease()</a></p>
                              </li>
                              <li>
                                 <p><a href="connect-authorize-and-initialize-functions.html#GUID-2AE88BDC-2C44-4958-B26A-434B0407F06F" title="Terminates a user session context created by OCISessionBegin().">OCISessionEnd()</a></p>
                              </li>
                              <li>
                                 <p><a href="connect-authorize-and-initialize-functions.html#GUID-402B540A-05FF-464B-B9C8-B2E7B4ABD564" title="Deletes an access path to a data source for OCI operations.">OCIServerDetach()</a></p>
                              </li>
                              <li>
                                 <p><a href="connect-authorize-and-initialize-functions.html#GUID-B6291228-DA2F-4CE9-870A-F94243141757" title="Creates an access path to a data source for OCI operations.">OCIServerAttach()</a></p>
                              </li>
                              <li>
                                 <p><a href="connect-authorize-and-initialize-functions.html#GUID-31B1FDB3-056E-4AF9-9B89-8DA6AA156947" title="Creates a user session and begins a user session for a given server.">OCISessionBegin()</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="LNOCI16614"></a><div class="props_rev_3"><a id="GUID-CB0DC00D-C935-41BC-AF4B-29C3288B743B" name="GUID-CB0DC00D-C935-41BC-AF4B-29C3288B743B"></a><h5 id="LNOCI-GUID-CB0DC00D-C935-41BC-AF4B-29C3288B743B" class="sect5"><span class="enumeration_section">11.4.2.6 </span>Destroy the Connection Pool
                     </h5>
                     <div>
                        <p><code class="codeph">OCIConnectionPoolDestroy()</code> destroys it.
                        </p>
                        <p>Use <code class="codeph">OCIConnectionPoolDestroy()</code> to destroy the connection pool. 
                        </p>
                        <div class="infoboxnotealso" id="GUID-CB0DC00D-C935-41BC-AF4B-29C3288B743B__GUID-7C1B4CEB-BC12-4EEE-BB78-52F94ED6B44A">
                           <p class="notep1">See Also:</p>
                           <p><a href="connect-authorize-and-initialize-functions.html#GUID-46720C8F-0A9F-4300-B6C4-4E47875A95C2" title="Destroys the connection pool.">OCIConnectionPoolDestroy()</a></p>
                        </div>
                     </div>
                  </div><a id="LNOCI16615"></a><div class="props_rev_3"><a id="GUID-676CFBC3-69CC-447B-B0A5-B58BE827291E" name="GUID-676CFBC3-69CC-447B-B0A5-B58BE827291E"></a><h5 id="LNOCI-GUID-676CFBC3-69CC-447B-B0A5-B58BE827291E" class="sect5"><span class="enumeration_section">11.4.2.7 </span>Free the Pool Handle
                     </h5>
                     <div>
                        <p>The pool handle is freed using <code class="codeph">OCIHandleFree()</code>.
                        </p>
                        <p>These last three actions are illustrated in this code fragment:</p><pre class="oac_no_warn" dir="ltr"> for (i = 0; i &lt; MAXTHREADS; ++i)
  {
    checkerr(errhp, OCILogoff((void *) svchp[i], errhp));
  }
  checkerr(errhp, OCIConnectionPoolDestroy(poolhp, errhp, OCI_DEFAULT));
  checkerr(errhp, OCIHandleFree((void *)poolhp, OCI_HTYPE_CPOOL));
</pre><div class="infoboxnotealso" id="GUID-676CFBC3-69CC-447B-B0A5-B58BE827291E__GUID-1B38A80D-B03C-4570-B418-705A28CBB173">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="handle-and-descriptor-functions.html#GUID-E87E9F91-D3DC-4F35-BE7C-F1EFBFEEBA0A" title="Explicitly deallocates a handle">OCIHandleFree()</a></p>
                              </li>
                              <li>
                                 <p><a href="handle-and-descriptor-attributes.html#GUID-400B741C-E4AA-4155-8279-09FD80A6B38F" title="Lists and describes connection pool handle attributes.">Connection Pool Handle Attributes</a></p>
                              </li>
                              <li>
                                 <p><a href="connect-authorize-and-initialize-functions.html#GUID-7E5A69F2-0268-4655-845D-A7662902FAA2" title="Initializes the connection pool.">OCIConnectionPoolCreate()</a>, <a href="connect-authorize-and-initialize-functions.html#GUID-425D4B32-257C-480E-B69C-7112BE9482E6" title="Gets a session.">OCILogon2()</a>, and <a href="connect-authorize-and-initialize-functions.html#GUID-46720C8F-0A9F-4300-B6C4-4E47875A95C2" title="Destroys the connection pool.">OCIConnectionPoolDestroy()</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
               </div><a id="LNOCI16616"></a><div class="props_rev_3"><a id="GUID-AE06BCB1-7333-458E-90F0-0761496EC5E1" name="GUID-AE06BCB1-7333-458E-90F0-0761496EC5E1"></a><h4 id="LNOCI-GUID-AE06BCB1-7333-458E-90F0-0761496EC5E1" class="sect4"><span class="enumeration_section">11.4.3 </span>Examples of OCI Connection Pooling
                  </h4>
                  <div>
                     <p>Where to find examples of connection pooling in tested complete programs.</p>
                     <p>Examples of connection pooling in tested complete programs can be found in <code class="codeph">cdemocp.c and cdemocpproxy.c</code> in directory <code class="codeph">demo</code>.
                     </p>
                  </div>
               </div>
            </div><a id="LNOCI16652"></a><div class="props_rev_3"><a id="GUID-8DD97D4D-C7AA-4EF7-9B55-8DC58BDC2726" name="GUID-8DD97D4D-C7AA-4EF7-9B55-8DC58BDC2726"></a><h3 id="LNOCI-GUID-8DD97D4D-C7AA-4EF7-9B55-8DC58BDC2726" class="sect3"><span class="enumeration_section">11.5 </span>When to Use Connection Pooling, Session Pooling, or Neither
               </h3>
               <div>
                  <p>Indicates the circumstances in which to use them or not.</p>
                  <p>If database sessions are not reusable by mid-tier threads (that is, they are stateful) and the number of back-end server processes may cause scaling problems on the database, use OCI connection pooling. </p>
                  <p>If database sessions are reusable by mid-tier threads (that is, they are stateless) and the number of back-end server processes may cause scaling problems on the database, use OCI session pooling. </p>
                  <p>If database sessions are not reusable by mid-tier threads (that is, they are stateful) and the number of back-end server processes is never large enough to potentially cause any scaling issue on the database, there is no need to use any pooling mechanism.</p>
                  <div class="infoboxnote" id="GUID-8DD97D4D-C7AA-4EF7-9B55-8DC58BDC2726__GUID-D3E22093-F8E4-4683-B214-360F978C66BD">
                     <p class="notep1">Note:</p>
                     <p>Having nonpooled sessions or connections results in tearing down and re-creating the database session/connection for every mid-tier user request. This can cause severe scaling problems on the database side and excessive latency for the fulfillment of the request. Hence, Oracle strongly recommends that you adopt one of the pooling strategies for mid-tier applications based on whether the database session is stateful or stateless.</p>
                  </div>
                  <p>In connection pooling, the pool element is a connection and in session pooling, the pool element is a session.</p>
                  <p>As with any pool, the pooled resource is locked by the application thread for a certain duration until the thread has done its job on the database and the resource is released. The resource is unavailable to other threads during its period of use. Hence, application developers must be aware that any kind of pooling works effectively with relatively short tasks. However, if the application is performing a long-running transaction, it may deny the pooled resource to other sharers for long periods of time, leading to starvation. Hence, pooling should be used in conjunction with short tasks, and the size of the pool should be sufficiently large to maintain the desired concurrency of transactions. </p>
                  <p>Note the following additional information about connection pooling and session pooling:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>OCI Connection Pooling</p>
                        <p>Connections to the database are pooled. Sessions are created and destroyed by the user. Each call to the database picks up an appropriate available connection from the pool.</p>
                        <p>The application is multiplexing several sessions over fewer physical connections to the database. The users can tune the pool configuration to achieve required concurrency. </p>
                        <p>The life-time of the application sessions is independent of the life-time of the cached pooled connections. </p>
                     </li>
                     <li>
                        <p>OCI Session Pooling</p>
                        <p>Sessions and connections are pooled by OCI. The application gets sessions from the pool and releases sessions back to the pool.</p>
                     </li>
                  </ul>
                  <div class="p">This section includes the following topics:
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="session-and-connection-pooling.html#GUID-A408F97E-C451-4D8C-BA8C-4F48DDA0EF26" title="There are a number of ways to create a session with varying functionality.">Functions for Session Creation</a></p>
                        </li>
                        <li>
                           <p><a href="session-and-connection-pooling.html#GUID-D952EB18-A7DE-4CF6-816D-E5E728AACE5E" title="How to choose the type od session to use.">About Choosing Between Different Types of OCI Sessions</a></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="LNOCI16653"></a><div class="props_rev_3"><a id="GUID-A408F97E-C451-4D8C-BA8C-4F48DDA0EF26" name="GUID-A408F97E-C451-4D8C-BA8C-4F48DDA0EF26"></a><h4 id="LNOCI-GUID-A408F97E-C451-4D8C-BA8C-4F48DDA0EF26" class="sect4"><span class="enumeration_section">11.5.1 </span>Functions for Session Creation
                  </h4>
                  <div>
                     <p>There are a number of ways to create a session with varying functionality.</p>
                     <p>OCI offers the following functions for session creation:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><code class="codeph">OCILogin</code></p>
                           <p>OCILogon() is the simplest way to get an OCI session. The advantage is ease of obtaining an OCI service context. The disadvantage is that you cannot perform any advance OCI operations, such as session migration, proxy authentication, or using a connection pool or a session pool.</p>
                        </li>
                        <li>
                           <p><code class="codeph">OCILogon2()</code></p>
                           <p>OCILogon2() includes the functionality of <code class="codeph">OCILogon()</code> to get a session. This session may be a new one with a new underlying connection, or one that is started over a virtual connection from an existing connection pool, or one from an existing session pool. The <code class="codeph">mode</code> parameter value that the function is called with determines its behavior.
                           </p>
                           <p>The user cannot modify the attributes (except <code class="codeph">OCI_ATTR_</code><code class="codeph">STMTCACHESIZE</code>) of the service context returned by OCI.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">OCISessionBegin()</code></p>
                           <p>OCISessionBegin() supports all the various options of an OCI session, such as proxy authentication, getting a session from a connection pool or a session pool, external credentials, and migratable sessions. This is the lowest level call, where all handles must be explicitly allocated and all attributes set. <code class="codeph">OCIServerAttach()</code> must be called before this call. 
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">OCISessionGet()</code></p>
                           <p>OCISessionGet() is now the recommended method to get a session. This session may be a new one with a new underlying connection, or one that is started over a virtual connection from an existing connection pool, or one from an existing session pool. The <code class="codeph">mode</code> parameter value that the function is called with determines its behavior. This works like <code class="codeph">OCILogon2()</code> but additionally enables you to specify tags for obtaining specific sessions from the pool.
                           </p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-A408F97E-C451-4D8C-BA8C-4F48DDA0EF26__GUID-C1757A87-6308-46A3-9658-BB5578DE80C4">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="connect-authorize-and-initialize-functions.html#GUID-F4592576-BE9D-4583-83AD-5D56D2E592E6" title="Creates a simple logon session.">OCILogon()</a></p>
                           </li>
                           <li>
                              <p><a href="oci-programming-basics.html#GUID-A4B693E9-7554-4721-A7F7-0B5B15589DEE" title="An application must call OCIEnvNlsCreate() to initialize the OCI environment handle. Existing applications may have used OCIEnvCreate().">Application Initialization, Connection, and Session Creation</a></p>
                           </li>
                           <li>
                              <p><a href="connect-authorize-and-initialize-functions.html#GUID-425D4B32-257C-480E-B69C-7112BE9482E6" title="Gets a session.">OCILogon2()</a></p>
                           </li>
                           <li>
                              <p><a href="connect-authorize-and-initialize-functions.html#GUID-31B1FDB3-056E-4AF9-9B89-8DA6AA156947" title="Creates a user session and begins a user session for a given server.">OCISessionBegin()</a></p>
                           </li>
                           <li>
                              <p><a href="connect-authorize-and-initialize-functions.html#GUID-890DFBC4-718B-4339-A0EA-6226A25B8241" title="Gets a session.">OCISessionGet()</a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="LNOCI16654"></a><div class="props_rev_3"><a id="GUID-D952EB18-A7DE-4CF6-816D-E5E728AACE5E" name="GUID-D952EB18-A7DE-4CF6-816D-E5E728AACE5E"></a><h4 id="LNOCI-GUID-D952EB18-A7DE-4CF6-816D-E5E728AACE5E" class="sect4"><span class="enumeration_section">11.5.2 </span>About Choosing Between Different Types of OCI Sessions
                  </h4>
                  <div>
                     <p>How to choose the type od session to use.</p>
                     <p>OCI includes the following types of sessions:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Basic OCI sessions</p>
                           <p>The basic OCI session works by using user name and password over a dedicated OCI server handle. This is the no-pool mechanism. See When to Use Connection Pooling, Session Pooling, or Neither for information of when to use it.</p>
                           <p>If authentication is obtained through external credentials, then a user name or password is not required.</p>
                        </li>
                        <li>
                           <p>Session pool sessions</p>
                           <p>Session pool sessions are from the session pool cache. Some sessions may be tagged. These are stateless sessions. Each <code class="codeph">OCISessionGet()</code> and <code class="codeph">OCISessionRelease()</code> call gets and releases a session from the session cache. This saves the server from creating and destroying sessions.
                           </p>
                           <p>See When to Use Connection Pooling, Session Pooling, or Neither on connection pool sessions versus session pooling sessions versus no-pooling sessions.</p>
                        </li>
                        <li>
                           <p>Connection pool sessions</p>
                           <p>Connection pool sessions are created using <code class="codeph">OCISessionGet()</code> and <code class="codeph">OCISessionBegin()</code> calls from an OCI connection pool. There is no session cache as these are stateful sessions. Each call creates a new session, and the user is responsible for terminating these sessions.
                           </p>
                           <p>The sessions are automatically migratable between the server handles of the connection pool. Each session can have user name and password or be a proxy session. See When to Use Connection Pooling, Session Pooling, or Neither on connection pool sessions versus session pooling sessions versus no-pooling sessions.</p>
                        </li>
                        <li>
                           <p>Sessions sharing a server handle</p>
                           <p>You can multiplex several OCI sessions over a few physical connections. The application does this manually by having the same server handle for these multiple sessions. It is preferred to have the session multiplexing details be left to OCI by using the OCI connection pool APIs.</p>
                        </li>
                        <li>
                           <p>Proxy sessions</p>
                           <p>Proxy sessions are useful if the password of the client must be protected from the middle tier. Proxy sessions can also be part of an OCI connection pool or an OCI session pool.</p>
                        </li>
                        <li>
                           <p>Migratable Sessions</p>
                        </li>
                     </ul>
                     <p>With transaction handles being migratable, there should be no need for applications to use migratable sessions, instead use OCI connection pooling. </p>
                     <div class="infoboxnotealso" id="GUID-D952EB18-A7DE-4CF6-816D-E5E728AACE5E__GUID-76245F52-3F50-4D26-B3EF-6EC042C1CE38">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="connect-authorize-and-initialize-functions.html#GUID-890DFBC4-718B-4339-A0EA-6226A25B8241" title="Gets a session.">OCISessionGet()</a></p>
                           </li>
                           <li>
                              <p><a href="connect-authorize-and-initialize-functions.html#GUID-DAAECC99-A432-48B5-AC33-0868C2FE762D" title="Releases a session that was retrieved using OCISessionGet().">OCISessionRelease()</a></p>
                           </li>
                           <li>
                              <p><a href="connect-authorize-and-initialize-functions.html#GUID-31B1FDB3-056E-4AF9-9B89-8DA6AA156947" title="Creates a user session and begins a user session for a given server.">OCISessionBegin()</a></p>
                           </li>
                           <li>
                              <p><a href="managing-scalable-platforms.html#GUID-A5830D58-3079-45DD-BE3A-81C41991DA70" title="A middle-tier application receives requests from browser clients.">Middle-Tier Applications in OCI</a> for more information about proxy sessions
                              </p>
                           </li>
                           <li>
                              <p><a href="managing-scalable-platforms.html#GUID-69A0AE8C-3F8D-4EDD-A817-730F17B3DF3E" title="Transaction servers that actively balance user load by multiplexing user sessions over a few server connections must group these connections into a server group.">OCI Session Management</a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>