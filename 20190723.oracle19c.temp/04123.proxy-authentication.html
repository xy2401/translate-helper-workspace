<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Proxy Authentication</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="JDBC Developer's Guide">
      <meta property="og:description" content>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="JDBC Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="jdbc-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-02-13T13:20:37-08:00">
      <meta name="dcterms.title" content="JDBC Developer's Guide">
      <meta name="dcterms.dateCopyrighted" content="1999, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96471-02">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="client-side-security.html" title="Previous" type="text/html">
      <link rel="next" href="data-access-and-manipulation.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="JJDBC">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="client-side-security.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="data-access-and-manipulation.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">JDBC Developer's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="connection-and-security.html" property="item" typeof="WebPage"><span property="name"> Connection and Security </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Proxy Authentication</li>
            </ol>
            <a id="GUID-07E0AF7F-2C9A-42E9-8B99-F2716DC3B746" name="GUID-07E0AF7F-2C9A-42E9-8B99-F2716DC3B746"></a><a id="JJDBC28352"></a>
            
            <h2 id="JJDBC-GUID-07E0AF7F-2C9A-42E9-8B99-F2716DC3B746" class="sect2"><span class="enumeration_chapter">10 </span> Proxy Authentication
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>Oracle Java Database Connectivity (JDBC) provides proxy authentication, also called N-tier authentication. This feature is supported through both the JDBC Oracle Call Interface (OCI) driver and the JDBC Thin driver. This chapter contains the following sections:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="proxy-authentication.html#GUID-9DEFC135-8D15-4A24-8ECF-1E6FDE9AAAC7">About Proxy Authentication</a></p>
                  </li>
                  <li>
                     <p><a href="proxy-authentication.html#GUID-D36EFAC7-3A70-4650-9B8B-046E738EFD76">Types of Proxy Connections</a></p>
                  </li>
                  <li>
                     <p><a href="proxy-authentication.html#GUID-BC74B296-1A83-4873-9293-2E9DC2A6C7DC">Creating Proxy Connections</a></p>
                  </li>
                  <li>
                     <p><a href="proxy-authentication.html#GUID-D8075A54-00DA-4879-B5D4-2362308EB861">Closing a Proxy Session</a></p>
                  </li>
                  <li>
                     <p><a href="proxy-authentication.html#GUID-E2501FD0-AB8F-47B6-9CEC-B9503852C83B">Caching Proxy Connections</a></p>
                  </li>
                  <li>
                     <p><a href="proxy-authentication.html#GUID-036AD953-9692-4DB0-89E2-CED6A49FCDB3">Limitations of Proxy Connections</a></p>
                  </li>
               </ul>
               <div class="infoboxnote" id="GUID-07E0AF7F-2C9A-42E9-8B99-F2716DC3B746__GUID-BDCDF9D2-7424-4C12-BD7F-F6470EF639E9">
                  <p class="notep1">Note:</p>
                  <p>Oracle Database supports proxy authentication functionality in three tiers <span class="italic">only</span>. It does not support it across multiple middle tiers.
                  </p>
               </div>
            </div><a id="JJDBC28353"></a><div class="props_rev_3"><a id="GUID-9DEFC135-8D15-4A24-8ECF-1E6FDE9AAAC7" name="GUID-9DEFC135-8D15-4A24-8ECF-1E6FDE9AAAC7"></a><h3 id="JJDBC-GUID-9DEFC135-8D15-4A24-8ECF-1E6FDE9AAAC7" class="sect3"><span class="enumeration_section">10.1 </span>About Proxy Authentication
               </h3>
               <div>
                  <p>Proxy authentication is the process of using a middle tier for user authentication. You can design a middle tier server to proxy clients in a secure fashion by using the following three forms of proxy authentication:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>The middle tier server authenticates itself with the database server and a client. In this case, an application user or another application, authenticates itself with the middle tier server. Client identities can be maintained all the way through to the database.</p>
                     </li>
                     <li>
                        <p>The client, that is, a database user, is not authenticated by the middle tier server. The client's identity and database password are passed through the middle tier server to the database server for authentication.</p>
                     </li>
                     <li>
                        <p>The client, that is, a global user, is authenticated by the middle tier server, and passes either a Distinguished name (DN) or a Certificate through the middle tier for retrieving the client's user name.</p>
                        <div class="infoboxnote" id="GUID-9DEFC135-8D15-4A24-8ECF-1E6FDE9AAAC7__GUID-C76A420C-7AD8-4BF4-B6EC-858638CD056B">
                           <p class="notep1">Note:</p>
                           <p>Operations done on behalf of a client by a middle tier server can be audited.</p>
                        </div>
                     </li>
                  </ul>
                  <p>In all cases, an administrator must authorize the middle tier server to proxy a client, that is, to act on behalf of the client. Suppose, the middle tier server initially connects to the database as user <code class="codeph">HR</code> and activates a proxy connection as user <code class="codeph">jeff</code>, and then issues the following statement to authorize the middle tier server to proxy a client: 
                  </p><pre class="oac_no_warn" dir="ltr">ALTER USER jeff GRANT CONNECT THROUGH HR;
</pre><p>You can also:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Specify roles that the middle tier is permitted to activate when connecting as the client. For example,</p><pre class="oac_no_warn" dir="ltr">CREATE ROLE role1; 
GRANT SELECT ON employees TO role1;
ALTER USER jeff GRANT CONNECT THROUGH HR ROLE role1;
</pre><p>The role clause limits the access only to those database objects that are mentioned in the list of the roles. The list of roles can be empty.</p>
                     </li>
                     <li>
                        <p>Find the users who are currently authorized to connect through a middle tier by querying the <code class="codeph">PROXY_USERS</code> data dictionary view.
                        </p>
                     </li>
                     <li>
                        <p>Disallow a proxy connection by using the <code class="codeph">REVOKE CONNECT THROUGH</code> clause of <code class="codeph">ALTER USER</code> statement.
                        </p>
                     </li>
                  </ul>
                  <div class="infoboxnote" id="GUID-9DEFC135-8D15-4A24-8ECF-1E6FDE9AAAC7__GUID-10AE64C5-A346-48D4-B1B6-F3EB57327FD1">
                     <p class="notep1">Note:</p>
                     <p>In case of proxy authentication, a JDBC connection to the database creates a database session during authentication, and then other sessions can be created during the life time of the connection.</p>
                  </div>
                  <p>You need to use the different fields and methods present in the <code class="codeph">oracle.jdbc.OracleConnection</code> interface to set up the different types of proxy connections.
                  </p>
               </div>
            </div><a id="JJDBC28354"></a><div class="props_rev_3"><a id="GUID-D36EFAC7-3A70-4650-9B8B-046E738EFD76" name="GUID-D36EFAC7-3A70-4650-9B8B-046E738EFD76"></a><h3 id="JJDBC-GUID-D36EFAC7-3A70-4650-9B8B-046E738EFD76" class="sect3"><span class="enumeration_section">10.2 </span>Types of Proxy Connections
               </h3>
               <div>
                  <div class="section">
                     <p>You can create proxy connections using any one of the following options:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><code class="codeph">USER NAME</code></p>
                           <p>This is done by supplying the user name or the password or both. The SQL statement for specifying authentication using password is:</p><pre class="oac_no_warn" dir="ltr">ALTER USER jeff GRANT CONNECT THROUGH HR AUTHENTICATED USING <span class="italic">password</span>;
</pre><p>In this case, <code class="codeph">jeff</code> is the user name and <code class="codeph">HR</code> is the proxy for <code class="codeph">jeff</code>. 
                           </p>
                           <p>The password option exists for additional security. Having no <code class="codeph">authenticated</code> clause implies default authentication, which is using only the user name without the password. The SQL statement for specifying default authentication is:
                           </p><pre class="oac_no_warn" dir="ltr">ALTER USER jeff GRANT CONNECT THROUGH HR
</pre></li>
                        <li>
                           <p><code class="codeph">DISTINGUISHED NAME</code></p>
                           <p>This is a global name in lieu of the password of the user being proxied for. An example of the corresponding SQL statement using a distinguished name is:</p><pre class="oac_no_warn" dir="ltr">CREATE USER jeff IDENTIFIED GLOBALLY AS 'CN=jeff,OU=americas,O=oracle,L=redwoodshores,ST=ca,C=us';
</pre><p>The string that follows the <code class="codeph">identified globally as</code> clause is the distinguished name. It is then necessary to authenticate using this distinguished name. The corresponding SQL statement to specify authentication using distinguished name is:
                           </p><pre class="oac_no_warn" dir="ltr">ALTER USER jeff GRANT CONNECT THROUGH HR AUTHENTICATED USING DISTINGUISHED NAME;
</pre></li>
                        <li>
                           <p><code class="codeph">CERTIFICATE</code></p>
                           <p>This is a more encrypted way of passing the credentials of the user, who is to be proxied, to the database. The certificate contains the distinguished name encoded in it. One way of generating the certificate is by creating a wallet and then decoding the wallet to get the certificate. The wallet can be created using <code class="codeph">runutl mkwallet</code>. It is then necessary to authenticate using the generated certificate. The SQL statement for specifying authentication using certificate is:
                           </p><pre class="oac_no_warn" dir="ltr">ALTER USER jeff GRANT CONNECT THROUGH HR AUTHENTICATED USING CERTIFICATE;
</pre><div class="infoboxnote" id="GUID-D36EFAC7-3A70-4650-9B8B-046E738EFD76__GUID-F3D43EBE-25FD-43EB-8C18-1AC999EA79C1">
                              <p class="notep1">Note:</p>
                              <p>The use of certificates for proxy authentication will be desupported in future Oracle Database releases.</p>
                           </div>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-D36EFAC7-3A70-4650-9B8B-046E738EFD76__GUID-9B8270E6-0D4F-4E22-9DF6-41A2B240E304">
                        <p class="notep1">Note:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>All the options can be associated with roles.</p>
                           </li>
                           <li>
                              <p>When opening a new proxied connection, a new session is started on the Database server. If you start a global transaction and then call the <code class="codeph">openProxySession</code> method, then, at this point, you are no longer a part of the global transaction and instead it is like you are in a freshly created JDBC connection. Typically, this never happens because the <code class="codeph">openProxySession</code> method is called prior to creating or resuming a global transaction. In such a case, you are still a part of the global transaction.
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDBC28355"></a><div class="props_rev_3"><a id="GUID-BC74B296-1A83-4873-9293-2E9DC2A6C7DC" name="GUID-BC74B296-1A83-4873-9293-2E9DC2A6C7DC"></a><h3 id="JJDBC-GUID-BC74B296-1A83-4873-9293-2E9DC2A6C7DC" class="sect3"><span class="enumeration_section">10.3 </span>Creating Proxy Connections
               </h3>
               <div>
                  <div class="section">
                     <p>A user, say <code class="codeph">jeff</code>, has to connect to the database through another user, say <code class="codeph">HR</code>. The proxy user, <code class="codeph">HR</code>, should have an active authenticated connection. A proxy session is then created on this active connection, with the driver issuing a command to the server to create a session for the user, <code class="codeph">jeff</code>. The server returns the new session ID, and the driver sends a session switch command to switch to this new session. 
                     </p>
                     <p>The JDBC OCI and Thin driver switch sessions in the same manner. The drivers permanently switch to the new session, <code class="codeph">jeff</code>. As a result, the proxy session, <code class="codeph">HR</code>, is not available until the new session, <code class="codeph">jeff</code>, is closed.
                     </p>
                     <div class="infoboxnote" id="GUID-BC74B296-1A83-4873-9293-2E9DC2A6C7DC__GUID-D1301ADB-63B2-4448-9274-61A946C5B763">
                        <p class="notep1">Note:</p>
                        <p>You can use the <code class="codeph">isProxySession</code> method from the <code class="codeph">oracle.jdbc.OracleConnection</code> interface to check if the current session associated with your connection is a proxy session. This method returns <code class="codeph">true</code> if the current session associated with the connection is a proxy session.
                        </p>
                     </div>
                     <p>A new proxy session is opened by using the following method from the <code class="codeph">oracle.jdbc.OracleConnection</code> interface:
                     </p><pre class="oac_no_warn" dir="ltr">void openProxySession(int type, java.util.Properties prop) throws SQLExceptionOpens
</pre><p>Where,</p>
                     <p><code class="codeph">type</code> is the type of the proxy session and can have the following values:
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><code class="codeph">OracleConnection.PROXYTYPE_USER_NAME</code></p>
                           <p>This type is used for specifying the user name. </p>
                        </li>
                        <li>
                           <p><code class="codeph">OracleConnection.PROXYTYPE_DISTINGUISHED_NAME</code></p>
                           <p>This type is used for specifying the distinguished name of the user.</p>
                        </li>
                        <li>
                           <p><code class="codeph">OracleConnection.PROXYTYPE_CERTIFICATE</code></p>
                           <p>This type is used for specifying the proxy certificate.</p>
                        </li>
                     </ul>
                     <p><code class="codeph">prop</code> is the property value of the proxy session and can have the following values:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><code class="codeph">PROXY_USER_NAME</code></p>
                           <p>This property value should be used with the type <code class="codeph">OracleConnection.PROXYTYPE_USER_NAME</code>. The value should be a <code class="codeph">java.lang.String</code>.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">PROXY_DISTINGUISHED_NAME</code></p>
                           <p>This property value should be used with the type <code class="codeph">OracleConnection.PROXYTYPE_DISTINGUISHED_NAME</code>. The value should be a <code class="codeph">java.lang.String</code>.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">PROXY_CERTIFICATE</code></p>
                           <p>This property value should be used with the type <code class="codeph">OracleConnection.PROXYTYPE_CERTIFICATE</code>. The value is a <code class="codeph">bytep[]</code> array that contains the certificate.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">PROXY_ROLES</code></p>
                           <p>This property value can be used with the following types:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">OracleConnection.PROXYTYPE_USER_NAME</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">OracleConnection.PROXYTYPE_DISTINGUISHED_NAME</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">OracleConnection.PROXYTYPE_CERTIFICATE</code></p>
                              </li>
                           </ul>
                           <p>The value should be a <code class="codeph">java.lang.String</code>.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">PROXY_SESSION</code></p>
                           <p>This property value is used with the <code class="codeph">close</code> method to close the proxy session.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">PROXY_USER_PASSWORD</code></p>
                           <p>This property value should be used with the type <code class="codeph">OracleConnection.PROXYTYPE_USER_NAME</code>. The value should be a <code class="codeph">java.lang.String</code>.
                           </p>
                        </li>
                     </ul>
                     <p>The following code snippet shows the use of the <code class="codeph">openProxySession</code> method:
                     </p><pre class="oac_no_warn" dir="ltr">    java.util.Properties prop = new java.util.Properties();
    prop.put(OracleConnection.PROXY_USER_NAME, "jeff");
    String[] roles = {"role1", "role2"};
    prop.put(OracleConnection.PROXY_ROLES, roles);
    conn.openProxySession(OracleConnection.PROXYTYPE_USER_NAME, prop);
    </pre></div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDBC28356"></a><div class="props_rev_3"><a id="GUID-D8075A54-00DA-4879-B5D4-2362308EB861" name="GUID-D8075A54-00DA-4879-B5D4-2362308EB861"></a><h3 id="JJDBC-GUID-D8075A54-00DA-4879-B5D4-2362308EB861" class="sect3"><span class="enumeration_section">10.4 </span>Closing a Proxy Session
               </h3>
               <div>
                  <div class="section">
                     <p>You can close the proxy session opened with the <code class="codeph">OracleConnection.openProxySession</code> method by passing the <code class="codeph">OracleConnection.PROXY_SESSION</code> parameter to the <code class="codeph">OracleConnection.close</code> method in the following way:
                     </p><pre class="oac_no_warn" dir="ltr"><code class="codeph">OracleConnection.close</code>(OracleConnection.PROXY_SESSION);
</pre><p>This is similar to closing a proxy session on a non-cached connection. The standard <code class="codeph">close</code> method must be called explicitly to close the connection itself. If the <code class="codeph">close</code> method is called directly, without closing the proxy session, then both the proxy session and the connection are closed. This can be achieved in the following way:
                     </p><pre class="oac_no_warn" dir="ltr">OracleConnection.close(OracleConnection.INVALID_CONNECTION);
</pre></div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDBC28357"></a><div class="props_rev_3"><a id="GUID-E2501FD0-AB8F-47B6-9CEC-B9503852C83B" name="GUID-E2501FD0-AB8F-47B6-9CEC-B9503852C83B"></a><h3 id="JJDBC-GUID-E2501FD0-AB8F-47B6-9CEC-B9503852C83B" class="sect3"><span class="enumeration_section">10.5 </span>Caching Proxy Connections
               </h3>
               <div>
                  <div class="section">
                     <p>Proxy connections, like standard connections, can be cached. Caching proxy connections enhances the performance. To cache a proxy connection, you need to create a connection using one of the <code class="codeph">getConnection</code> methods on a cache enabled <code class="codeph">OracleDataSource</code> object.
                     </p>
                     <p>A proxy connection may be cached in the connection cache using the connection attributes feature of the connection cache. Connection attributes are name/value pairs that are user-defined and help tag a connection before returning it to the connection cache for reuse. When the tagged connection is retrieved, it can be directly used without having to do a round-trip to create or close a proxy session. Universal Connection Pool supports caching of any user/password authenticated connection. Therefore, any user authenticated proxy connection can be cached and retrieved.</p>
                     <p>It is recommended that proxy connections should not be closed without applying the connection attributes. If a proxy connection is closed without applying the connection attributes, the connection is returned to the connection cache for reuse, but cannot be retrieved. The connection caching mechanism does not remember or reset session state.</p>
                     <p>A proxy connection can be removed from the connection cache by closing the connection directly.</p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDBC28359"></a><a id="JJDBC28360"></a><a id="JJDBC28358"></a><div class="props_rev_3"><a id="GUID-036AD953-9692-4DB0-89E2-CED6A49FCDB3" name="GUID-036AD953-9692-4DB0-89E2-CED6A49FCDB3"></a><h3 id="JJDBC-GUID-036AD953-9692-4DB0-89E2-CED6A49FCDB3" class="sect3"><span class="enumeration_section">10.6 </span>Limitations of Proxy Connections
               </h3>
               <div>
                  <div class="section">
                     <p>Closing a proxy connection automatically closes every SQL Statement created by the proxy connection, during the proxy session or prior to the proxy session. This may cause unexpected consequences on application pooling or statement caching. The following code samples explain this limitation of proxy connections:</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-036AD953-9692-4DB0-89E2-CED6A49FCDB3__GUID-81E0E070-4A7F-46B3-ABEB-8224F19699C0">Example 1</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section"><pre class="oac_no_warn" dir="ltr">....
public void displayName(String N)  // Any function using the Proxy feature
{
     Properties props = new Properties();
     props.put("PROXY_USER_NAME", proxyUser);
     c.openProxySession(OracleConnection.PROXYTYPE_USER_NAME, props);
     .......
     c.close(OracleConnection.PROXY_SESSION);
}
 
public static void main (String args[]) throws SQLException
{
    ............
    PreparedStatement pstmt = conn.prepareStatement("SELECT first_name FROM EMPLOYEES WHERE employee_id = ?");
    pstmt.setInt(1, 205);
    ResultSet rs = pstmt.executeQuery();
    while (rs.next())
    {
        displayName(rs.getString(1));
         if (rs.isClosed() // The ResultSet is already closed while closing the connection!
         {
             throw new Exception("Your ResultSet has been prematurely closed! 
Your Statement object is also dead now.");
         }
    }
}
</pre><p>In the preceding example, when you close the proxy connection in the <code class="codeph">displayName</code> method, then the <code class="codeph">PreparedStatement</code> object and the <code class="codeph">ResultSet</code> object also get closed. So, if you do not check the status of the <code class="codeph">ResultSet</code> object inside loop, then the loop will fail when the <code class="codeph">next</code> method is called for the second time.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-036AD953-9692-4DB0-89E2-CED6A49FCDB3__GUID-76175ADC-3FE5-4E72-A6C9-D2DCDAC67691">Example 2</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section"><pre class="oac_no_warn" dir="ltr">    ....
    PreparedStatement pstmt = conn.prepareStatement("SELECT first_name FROM EMPLOYEES WHERE employee_id = ?");
    pstmt.setString(1, "205");
    ResultSet rs = pstmt.executeQuery();
    while (rs.next())
    {
        ....
    }
 
    Properties props = new Properties();
    props.put("PROXY_USER_NAME", proxyUser);
 
    conn.openProxySession(OracleConnection.PROXYTYPE_USER_NAME, props);
    .......
    conn.close(OracleConnection.PROXY_SESSION);
 
    // Try to use the PreparedStatement again
    pstmt.setString(1, "28960");
// This line of code will fail because the Statement is already closed while closing the connection!
    rs = pstmt.executeQuery(); 
</pre><p>In the preceding example, the <code class="codeph">PreparedStatement</code> object and the <code class="codeph">ResultSet</code> object work fine before opening the proxy connection. But, if you try to execute the same <code class="codeph">PreparedStatement</code> object after closing the proxy connection, then the statement fails.
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>