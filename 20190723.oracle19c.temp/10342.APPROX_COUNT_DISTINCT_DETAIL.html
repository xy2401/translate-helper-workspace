<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>APPROX_COUNT_DISTINCT_DETAIL</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="SQL Language Reference ">
      <meta property="og:description" content>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="SQL Language Reference">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="sql-language-reference.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-02-12T15:36:36-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96310-02">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="APPROX_COUNT_DISTINCT_AGG.html" title="Previous" type="text/html">
      <link rel="next" href="APPROX_MEDIAN.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="SQL Language Reference">
    <meta name="dcterms.isVersionOf" content="SQLRF">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="APPROX_COUNT_DISTINCT_AGG.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="APPROX_MEDIAN.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">SQL Language Reference </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="Functions.html" property="item" typeof="WebPage"><span property="name">Functions</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">APPROX_COUNT_DISTINCT_DETAIL</li>
            </ol>
            <a id="GUID-8FBD2881-743D-425E-A104-472A720DEF50" name="GUID-8FBD2881-743D-425E-A104-472A720DEF50"></a>
            
            <h2 id="SQLRF-GUID-8FBD2881-743D-425E-A104-472A720DEF50" class="sect2">APPROX_COUNT_DISTINCT_DETAIL</h2>
         </header>
         <div class="ind">
            <div>
               <div class="section">
                  <p class="subhead1" id="GUID-8FBD2881-743D-425E-A104-472A720DEF50__GUID-3D35715C-C9AE-43DC-9A5C-55F4D72D22D2">Syntax</p>
                  <div class="figure" id="GUID-8FBD2881-743D-425E-A104-472A720DEF50__GUID-DC24AEE0-7F70-4ECB-B575-880DD275C611"><img src="img/approx_count_distinct_detail.gif" alt="Description of approx_count_distinct_detail.eps follows" title="Description of approx_count_distinct_detail.eps follows" longdesc="img_text/approx_count_distinct_detail.html"><br><a href="img_text/approx_count_distinct_detail.html">Description of the illustration approx_count_distinct_detail.eps</a></div>
                  <!-- class="figure" -->
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-8FBD2881-743D-425E-A104-472A720DEF50__GUID-A33AF009-F000-4729-9C80-BDF5797652E0">Purpose</p>
                  <p><code class="codeph">APPROX_COUNT_DISTINCT_DETAIL</code> calculates information about the approximate number of rows that contain a distinct value for expr and returns a BLOB value, called a detail, which contains that information in a special format.
                  </p>
                  <p>For <span class="italic"><code class="codeph">expr</code></span>, you can specify a column of any scalar data type other than <code class="codeph">BFILE</code>, <code class="codeph">BLOB</code>, <code class="codeph">CLOB</code>, <code class="codeph">LONG</code>, <code class="codeph">LONG</code> <code class="codeph">RAW</code>, or <code class="codeph">NCLOB</code>. This function ignores rows for which the value of <span class="italic"><code class="codeph">expr</code></span> is null.
                  </p>
                  <p>This function is commonly used with the <code class="codeph">GROUP</code> <code class="codeph">BY</code> clause in a <code class="codeph">SELECT</code> statement. When used in this way, it calculates approximate distinct value count information for <span class="italic"><code class="codeph">expr</code></span> within each group of rows and returns a single detail for each group.
                  </p>
                  <p>The details returned by <code class="codeph">APPROX_COUNT_DISTINCT_DETAIL</code> can be used as input to the <code class="codeph">APPROX_COUNT_DISTINCT_AGG</code> function, which enables you to perform aggregations of the details, or the <code class="codeph">TO_APPROX_COUNT_DISTINCT</code> function, which converts a detail to a human-readable distinct count value. You can use these three functions together to perform resource-intensive approximate count calculations once, store the resulting details, and then perform efficient aggregations and queries on those details. For example:
                  </p>
                  <ol>
                     <li>
                        <p>Use the <code class="codeph">APPROX_COUNT_DISTINCT_DETAIL</code> function to calculate approximate distinct value count information and store the resulting details in a table or materialized view. These could be highly-granular details, such as city demographic counts or daily sales counts.
                        </p>
                     </li>
                     <li>
                        <p>Use the <code class="codeph">APPROX_COUNT_DISTINCT_AGG</code> function to aggregate the details obtained in the previous step and store the resulting details in a table or materialized view. These could be details of lower granularity, such as state demographic counts or monthly sales counts.
                        </p>
                     </li>
                     <li>
                        <p>Use the <code class="codeph">TO_APPROX_COUNT_DISTINCT</code> function to convert the stored detail values to human-readable <code class="codeph">NUMBER</code> values. You can use the <code class="codeph">TO_APPROX_COUNT_DISTINCT</code> function to query detail values created by the <code class="codeph">APPROX_COUNT_DISTINCT_DETAIL</code> function or the <code class="codeph">APPROX_COUNT_DISTNCT_AGG</code> function.
                        </p>
                     </li>
                  </ol>
                  <div class="infoboxnotealso" id="GUID-8FBD2881-743D-425E-A104-472A720DEF50__GUID-DF2A73C0-B821-44D2-A144-EBE68564BCBC">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="APPROX_COUNT_DISTINCT_AGG.html#GUID-EEDA9388-A066-422A-B5C0-639A3076A10B">APPROX_COUNT_DISTINCT_AGG</a></p>
                        </li>
                        <li>
                           <p><a href="TO_APPROX_COUNT_DISTINCT.html#GUID-42A18FFB-C992-44A0-AC3E-F4BBF005846F">TO_APPROX_COUNT_DISTINCT</a></p>
                        </li>
                     </ul>
                  </div>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-8FBD2881-743D-425E-A104-472A720DEF50__GUID-CB7E3569-26BF-4FE1-9CF8-9B1A020E4C2C">Examples</p>
                  <p>The examples in this section demonstrate how to use the <code class="codeph">APPROX_COUNT_DISTINCT_DETAIL</code>, <code class="codeph">APPROX_COUNT_DISTINCT_AGG</code>, and <code class="codeph">TO_APPROX_COUNT_DISTINCT</code> functions together to perform resource-intensive approximate count calculations once, store the resulting details, and then perform efficient aggregations and queries on those details.
                  </p>
                  <p id="GUID-8FBD2881-743D-425E-A104-472A720DEF50__APPROX_COUNT_DISTINCT_DETAILEXAMPLE-08E856F2"><span class="bold">APPROX_COUNT_DISTINCT_DETAIL: Example</span></p>
                  <p>The following statement queries the tables <code class="codeph">sh</code>.<code class="codeph">times</code> and <code class="codeph">sh</code>.<code class="codeph">sales</code> for the approximate number of distinct products sold each day. The <code class="codeph">APPROX_COUNT_DISTINCT_DETAIL</code> function returns the information in a detail, called <code class="codeph">daily_detail</code>, for each day that products were sold. The returned details are stored in a materialized view called <code class="codeph">daily_prod_count_mv</code>.
                  </p><pre class="oac_no_warn" dir="ltr">CREATE MATERIALIZED VIEW daily_prod_count_mv AS
  SELECT t.calendar_year year,
         t.calendar_month_number month,
         t.day_number_in_month day,
         APPROX_COUNT_DISTINCT_DETAIL(s.prod_id) daily_detail
  FROM times t, sales s
  WHERE t.time_id = s.time_id
  GROUP BY t.calendar_year, t.calendar_month_number, t.day_number_in_month;</pre><p id="GUID-8FBD2881-743D-425E-A104-472A720DEF50__APPROX_COUNT_DISTINCT_AGGEXAMPLES-08E84F63"><span class="bold">APPROX_COUNT_DISTINCT_AGG: Examples</span></p>
                  <p>The following statement uses the <code class="codeph">APPROX_COUNT_DISTINCT_AGG</code> function to read the daily details stored in <code class="codeph">daily_prod_count_mv</code> and create aggregated details that contain the approximate number of distinct products sold each month. These aggregated details are stored in a materialized view called <code class="codeph">monthly_prod_count_mv</code>.
                  </p><pre class="oac_no_warn" dir="ltr">CREATE MATERIALIZED VIEW monthly_prod_count_mv AS
  SELECT year,
         month,
         APPROX_COUNT_DISTINCT_AGG(daily_detail) monthly_detail
  FROM daily_prod_count_mv
  GROUP BY year, month;</pre><p>The following statement is similar to the previous statement, except it creates aggregated details that contain the approximate number of distinct products sold each year. These aggregated details are stored in a materialized view called <code class="codeph">annual_prod_count_mv</code>.
                  </p><pre class="oac_no_warn" dir="ltr">CREATE MATERIALIZED VIEW annual_prod_count_mv AS
  SELECT year,
         APPROX_COUNT_DISTINCT_AGG(daily_detail) annual_detail
  FROM daily_prod_count_mv
  GROUP BY year;</pre><p id="GUID-8FBD2881-743D-425E-A104-472A720DEF50__TO_APPROX_COUNT_DISTINCTEXAMPLES-08E8528C"><span class="bold">TO_APPROX_COUNT_DISTINCT: Examples</span></p>
                  <p>The following statement uses the <code class="codeph">TO_APPROX_COUNT_DISTINCT</code> function to query the daily detail information stored in <code class="codeph">daily_prod_count_mv</code> and return the approximate number of distinct products sold each day:
                  </p><pre class="pre codeblock"><code>SELECT year,
       month,
       day,
       TO_APPROX_COUNT_DISTINCT(daily_detail) "NUM PRODUCTS"
  FROM daily_prod_count_mv
  ORDER BY year, month, day;

      YEAR      MONTH        DAY NUM PRODUCTS
---------- ---------- ---------- ------------
      1998          1          1           24
      1998          1          2           25
      1998          1          3           11
      1998          1          4           34
      1998          1          5           10
      1998          1          6            8
      1998          1          7           37
      1998          1          8           26
      1998          1          9           25
      1998          1         10           38
. . .</code></pre><p>The following statement uses the <code class="codeph">TO_APPROX_COUNT_DISTINCT</code> function to query the monthly detail information stored in <code class="codeph">monthly_prod_count_mv</code> and return the approximate number of distinct products sold each month:
                  </p><pre class="pre codeblock"><code>SELECT year,
       month,
       TO_APPROX_COUNT_DISTINCT(monthly_detail) "NUM PRODUCTS"
  FROM monthly_prod_count_mv
  ORDER BY year, month;

      YEAR      MONTH NUM PRODUCTS
---------- ---------- ------------
      1998          1           57
      1998          2           56
      1998          3           55
      1998          4           49
      1998          5           49
      1998          6           48
      1998          7           54
      1998          8           56
      1998          9           55
      1998         10           57
. . .</code></pre><p>The following statement uses the <code class="codeph">TO_APPROX_COUNT_DISTINCT</code> function to query the annual detail information stored in <code class="codeph">annual_prod_count_mv</code> and return the approximate number of distinct products sold each year:
                  </p><pre class="pre codeblock"><code>SELECT year,
       TO_APPROX_COUNT_DISTINCT(annual_detail) "NUM PRODUCTS"
  FROM annual_prod_count_mv
  ORDER BY year;

      YEAR NUM PRODUCTS
---------- ------------
      1998           60
      1999           72
      2000           72
      2001           71</code></pre></div>
               <!-- class="section" -->
            </div>
         </div>
      </article>
   </body>
</html>