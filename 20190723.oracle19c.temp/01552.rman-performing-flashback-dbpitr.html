<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Performing Flashback and Database Point-in-Time Recovery</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Backup and Recovery User's Guide">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Backup and Recovery User's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96241-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="rman-complete-database-recovery.html" title="Previous" type="text/html">
      <link rel="next" href="rman-block-media-recovery.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User's Guide">
    <meta name="dcterms.isVersionOf" content="BRADV">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="rman-complete-database-recovery.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="rman-block-media-recovery.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Backup and Recovery User's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-diagnosing-responding-failures.html" property="item" typeof="WebPage"><span property="name"> Diagnosing and Responding to Failures </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Performing Flashback and Database Point-in-Time Recovery</li>
            </ol>
            <a id="GUID-5463669A-DC89-4FF4-ACCE-136A72DF687B" name="GUID-5463669A-DC89-4FF4-ACCE-136A72DF687B"></a><a id="BRADV80055"></a>
            
            <h2 id="BRADV-GUID-5463669A-DC89-4FF4-ACCE-136A72DF687B" class="sect2"><span class="enumeration_chapter">18 </span> Performing Flashback and Database Point-in-Time Recovery
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>This chapter explains how to investigate unwanted database changes, and select and perform an appropriate recovery strategy based upon Oracle Flashback Technology and database backups. It contains the following topics:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="rman-performing-flashback-dbpitr.html#GUID-94B90ECF-69C9-40D4-A318-DC4AE9776557" title="This overview describes the purpose and basic concepts of Oracle Flashback Technology and database point-in-time recovery.">Overview of Oracle Flashback Technology and Database Point-in-Time Recovery</a></p>
                  </li>
                  <li>
                     <p><a href="rman-performing-flashback-dbpitr.html#GUID-FF315DFC-ABBC-410D-ABDB-75FA89D43255" title="Flashback Table uses information in the undo tablespace rather than restored backups to retrieve the table. When a Flashback Table operation occurs, new rows are deleted and old rows are reinserted. The rest of your database remains available while the flashback of the table is being performed.">Rewinding a Table with Flashback Table</a></p>
                  </li>
                  <li>
                     <p><a href="rman-performing-flashback-dbpitr.html#GUID-55EA5EB0-89E2-4561-A9D0-01A6242A2A87" title="You can retrieve objects from the recycle bin with the FLASHBACK TABLE ... TO BEFORE DROP statement.">Rewinding a DROP TABLE Operation with Flashback Drop</a></p>
                  </li>
                  <li>
                     <p><a href="rman-performing-flashback-dbpitr.html#GUID-953FA30D-BED2-4DBA-8361-9DA1B8FF073F" title="Flashback Database reverses unwanted changes by returning your database to its state at a previous point in time.">Rewinding a Database with Flashback Database</a></p>
                  </li>
                  <li>
                     <p><a href="rman-performing-flashback-dbpitr.html#GUID-7D3EE2F7-77A2-4264-8875-CC0AEC64ABE0" title="RMAN DBPITR restores the database from backups before the target time for recovery, then uses incremental backups and redo to roll the database forward to the target time. You can recover to an SCN, time, log sequence number, or restore point. Oracle recommends that you create restore points at important times to make point-in-time recovery more manageable if it ever becomes necessary.">Performing Database Point-in-Time Recovery</a></p>
                  </li>
                  <li>
                     <p><a href="rman-performing-flashback-dbpitr.html#GUID-F9C8CB5E-5954-4114-99D0-D121BA616058" title="This section describes variations of the basic Flashback Database and DBPITR scenarios.">Flashback and Database Point-in-Time Recovery Scenarios</a></p>
                  </li>
               </ul>
            </div><a id="BRADV89737"></a><div class="props_rev_3"><a id="GUID-94B90ECF-69C9-40D4-A318-DC4AE9776557" name="GUID-94B90ECF-69C9-40D4-A318-DC4AE9776557"></a><h3 id="BRADV-GUID-94B90ECF-69C9-40D4-A318-DC4AE9776557" class="sect3"><span class="enumeration_section">18.1 </span>Overview of Oracle Flashback Technology and Database Point-in-Time Recovery
               </h3>
               <p>This overview describes the purpose and basic concepts of Oracle Flashback Technology and database point-in-time recovery.</p><a id="BRADV89738"></a><div class="props_rev_3"><a id="GUID-D8DA9312-0556-4B1A-835C-0A8FF789E1A9" name="GUID-D8DA9312-0556-4B1A-835C-0A8FF789E1A9"></a><h4 id="BRADV-GUID-D8DA9312-0556-4B1A-835C-0A8FF789E1A9" class="sect4"><span class="enumeration_section">18.1.1 </span>Purpose of Flashback and Database Point-in-Time Recovery
                  </h4>
                  <div>
                     <p>Certain situations are suited for using point-in-time recovery or flashback features to return the database or database object to its state at a previous point in time.</p>
                     <p>Some typical situations include the following:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>A user error or corruption removes needed data or introduces corrupted data. For example, a user or DBA might erroneously delete or update the contents of one or more tables, drop database objects that are still needed during an update to an application, or run a large batch update that fails midway.</p>
                        </li>
                        <li>
                           <p>A database upgrade fails or an upgrade script goes awry.</p>
                        </li>
                        <li>
                           <p>A complete database recovery after a media failure cannot succeed because you do not have all of the needed redo logs or incremental backups.</p>
                        </li>
                     </ul>
                  </div>
               </div><a id="BRADV89739"></a><div class="props_rev_3"><a id="GUID-15D5CF76-8622-4117-8954-3D872A0B0A86" name="GUID-15D5CF76-8622-4117-8954-3D872A0B0A86"></a><h4 id="BRADV-GUID-15D5CF76-8622-4117-8954-3D872A0B0A86" class="sect4"><span class="enumeration_section">18.1.2 </span>Basic Concepts of Point-in-Time Recovery and Flashback Features
                  </h4>
                  <div>
                     <p>Database point-in-time recovery (DBPITR) and Flashback features enable you to recover your database to a prior point in time.</p>
                     <p>DBPITR is the most basic solution to unwanted database changes. It is sometimes called <a href="glossary.html#GUID-2D291374-0883-4A17-8A8E-0A4E2C8CC790"><span class="xrefglossterm">incomplete recovery</span></a> because it does not use all of the available redo or completely recover all changes to your database. In this case, you restore a whole database backup and then apply redo logs or incremental backups to re-create all changes up to a point in time before the unwanted change.
                     </p>
                     <p>If unwanted database changes are extensive but confined to specific tablespaces, then you can use <a href="glossary.html#GUID-8A257409-B3DC-41FD-A2AF-D47560FF9F18"><span class="xrefglossterm">tablespace point-in-time recovery (TSPITR)</span></a> to return these tablespaces to an earlier <a href="glossary.html#GUID-BBD8C5A5-1CB0-4BF6-9614-81DD64ABE59E"><span class="xrefglossterm">system change number (SCN)</span></a> while the unaffected tablespaces remain available.
                     </p>
                     <p>If unwanted database changes are limited to specific tables or table partitions, then you can use a previously created RMAN backup to return only these objects to a point in time before the unwanted changes occurred.</p>
                     <p>Oracle Database also provides a set of features collectively known as Flashback Technology that supports viewing past states of data, and winding and rewinding data back and forth in time, without requiring the restore of the database from backup. Depending on the changes to your database, Flashback Technology can often reverse the unwanted changes more quickly and with less impact on database availability.</p>
                     <div class="infoboxnotealso" id="GUID-15D5CF76-8622-4117-8954-3D872A0B0A86__GUID-5A5BAD2A-4D5E-436B-9D51-C86D250D2F65">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="performing-rman-tspitr.html#GUID-CAACDB53-7C3A-45B4-8249-C5D855D47571" title="To use RMAN tablespace point-in-time recovery (TSPITR) effectively, it is helpful to understand what types of problems it can resolve, its components, what RMAN does during TSPITR, and the various limitations and restrictions on when and how it can be run. This section explains the basic concepts, preparatory tasks, and modes of running RMAN TSPITR.Recovery Manager (RMAN) TSPITR enables quick recovery of one or more tablespaces in a database to an earlier time without affecting the rest of the tablespaces and objects in the database.Understand the concepts of RMAN TSPITR such as the terminology and modes used.This section defines some common entities that are used by RMAN TSPITR.There are several modes of running RMAN TSPITR. The difference between the various modes of operation corresponds to how much automation versus customization you require in your environment. Select tablespaces from the recovery set, an auxiliary destination, and a target time before you perform fully automated RMAN TSPITR (default).Some database problems cannot be resolved with TSPITR because of certain restrictions and limitations.There are some limitations to consider when performing TSPITR.Be aware of certain precautions when not using a recovery catalog during TSPITR.Certain steps must be completed when preparing to perform TSPITR.It is extremely important that you choose the right target time or SCN for your TSPITR. Note that after you bring a tablespace online after TSPITR, you cannot use any backup from a time earlier than the moment you brought the tablespace online. Initially, your recovery set includes the data files for the tablespaces that you intend to recover. However, if objects in the tablespaces that you need have relationships (such as constraints) to objects in other tablespaces, then you must account for these relationships before you can perform TSPITRRMAN TSPITR requires that the tablespace that is being recovered be self-contained and that no SYS-owned objects reside in the tablespace. When you perform RMAN TSPITR on a tablespace, objects created after the target recovery time are lost. You can preserve such objects after they are identified by exporting them before TSPITR with the Data Pump Export utility and reimporting them afterward with Data Pump Import.In the default mode, RMAN bases as much of the configuration for TSPITR as possible on the target database. You can customize some aspects of RMAN TSPITR while still mostly following the procedure for performing fully automated RMAN TSPITR.You may not want the recovery set data files restored and recovered in their original locations. The SET NEWNAME command enables you to specify a new destination. When you specify a new destination for the recovery set, RMAN does not remove the original data files of the tablespaces.Unlike recovery set data files, which are usually stored in their original locations, auxiliary set data files must not overwrite the corresponding original files in the target database. If you do not specify an auxiliary set file location that is different from its original location, then TSPITR fails. The failure occurs when RMAN attempts to overwrite the corresponding file in the original database and discovers the file in use.Auxiliary set data files can have Oracle Managed Files (OMF) in the target and can use Automatic Storage Management (ASM) or non-ASM storage. TSPITR performs name conversion differently when the DB_FILE_NAME_CONVERT initialization parameter is set and the OMF files are in ASM or non-ASM storage. You can use DB_FILE_NAME_CONVERT and LOG_FILE_NAME_CONVERT initialization parameters for the auxiliary database to specify the conversion of the disk group. RMAN uses the pattern to convert the ASM disk group name and generates a valid OMF file name in the converted disk group. Multiple methods are available to rename OMF (non-ASM) file names for the auxiliary database.To specify a new name for an auxiliary set data file, you can enclose RECOVER TABLESPACE in a RUN command and use a SET NEWNAME command within the RUN block to rename the file. When you do not want to use an auxiliary destination for all of your auxiliary set data files, but you also do not want to name every file individually, you can include a DB_FILE_NAME_CONVERT initialization parameter in the initialization parameter file used by the auxiliary database.Temp files are considered part of the auxiliary set for your database. When the auxiliary database is instantiated, RMAN recreates the temporary tablespaces of the target database and generates their names with the regular rules for the auxiliary data file names. TSPITR performance can be enhanced by redirecting RMAN to use existing image copies of the recovery set and auxiliary set data files. In this case, RMAN does not need to restore the data files from backup.The SET NEWNAME command enables you to specify the location of the image copies when performing TSPITR using image copies.The CONFIGURE AUXNAME command sets a persistent alternative location for an auxiliary set data file image copy, whereas the SET NEWNAME command sets an alternative location for the duration of a RUN command.This procedure uses CONFIGURE AUXNAME when performing TSPITR using image copies.The automatic auxiliary database uses a set of default initialization parameters. You can add other parameters, if required.If you use an initialization parameter file, then you can use the CONTROL_FILES initialization parameter to specify your own location for the control file of your auxiliary databaseTo perform recovery on the auxiliary and recovery sets after restoring them at the auxiliary database, RMAN may need to restore archived logs. When an auxiliary destination is being used, the archived logs are restored to that location.If you specify the LOG_FILE_NAME_CONVERT initialization parameter in your auxiliary database parameter file and the parameter successfully converts the names of the online redo logs of the target, then this parameter determines the online redo log location. Although Oracle recommends that you let RMAN manage all aspects of the auxiliary database, there may be times when you must create and manage your own auxiliary database. If you select this mode, you are responsible for setting up, starting, stopping and cleaning up the auxiliary database used in TSPITR.Creating an Oracle instance suitable for use as an auxiliary database requires you to perform a set of steps.There are multiple ways to create a password file for the auxiliary database.Use a text editor to create an initialization parameter file for the auxiliary database on the target database host. The auxiliary database must have a valid net service name. Before proceeding, use SQL*Plus to ensure that you can establish a SYSBACKUP or SYSDBA connection to the auxiliary database.Keep in mind certain guidelines when performing TSPITR with your own auxiliary instance.The default behavior for channels when you use your own auxiliary database for TSPITR can be overridden.You may want to use SET NEWNAME commands to refer to existing image copies of auxiliary set files to improve TSPITR performance, or to assign new names to the recovery set files for after TSPITR. Plan these commands, if necessary, and add them to the sequence of commands that you run for TSPITR.Complete the prerequisites and then follow the steps in this section to perform TSPITR with your own auxiliary database.Before beginning RMAN TSPITR, you must start the auxiliary database. Because the auxiliary database does not yet have a control file, you can only start the instance in NOMOUNT mode. Start RMAN and connect to the target database and the manually created auxiliary database.Use the RECOVER TABLESPACE command to perform TSPITR with your own auxiliary instance.This procedure uses the RECOVER TABLESPACE... UNTIL command to perform TSPITR.A variety of problems can cause RMAN TSPITR to fail. The problem must be identified and fixed.Name conflicts can occur between files in the target database, file names assigned by the SET NEWNAME or CONFIGURE AUXNAME commands, and file names generated by the effect of the DB_FILE_NAME_CONVERT parameter.During TSPITR, RMAN needs information about which tablespaces had undo segments at the TSPITR target time. This information is usually available in the recovery catalog, if one is used. If you are managing your own auxiliary database and TSPITR fails, do not attempt to rerun TSPITR without resolving the errors.">Performing RMAN Tablespace Point-in-Time Recovery (TSPITR)</a></p>
                           </li>
                           <li>
                              <p><a href="rman-recovering-tables-partitions.html#GUID-87B7F772-335F-4179-81C9-91678D026D01" title="The RMAN RECOVER command enables you to recover tables and table partitions from RMAN backups.RMAN enables you to recover one or more tables or table partitions to a specified point in time without affecting the remaining database objects. You can use previously-created RMAN backups to recover tables and table partitions to a specified point in time.To recover tables or table partitions, you need a full backup of undo, SYSTEM, SYSAUX, and the tablespace that contains the tables or table partitions. RMAN uses the RECOVER command to recover tables or table partitions to a specified point in time.RMAN performs a series of steps while automating the process of recovering tables or table partitions from an RMAN backup.RMAN creates an auxiliary database that it uses during the process of recovering the specified tables or table partitions. Multiple techniques are available to specify the location of auxiliary database files.After recovering tables or table partitions to the specified point in time on the auxiliary database, RMAN creates a Data Pump export dump file that contains the recovered objects. You can either specify a name and location for this dump file or allow RMAN to use a default name and location.By default, RMAN imports the recovered tables or table partitions, which are stored in the export dump file, into the target database. However, you can choose not to import the recovered tables or table partitions by using the NOTABLEIMPORT clause of the RESTORE command.Use the REMAP TABLE clause to rename recovered tables or table partitions in the target database. Recovering tables or table partitions into a different schema enables you to avoid name conflicts that may be caused by constraint, index, or trigger names that already existing in the source schema.Recovering tables and table partitions from RMAN backups by using the RECOVER command is subject to certain limitations.You must perform some preliminary tasks before you prepare to recover tables or table partitions .Certain prerequisites must be met before you recover tables or table partitions from RMAN backups.It is important to determine the exact point in time to which you want to recover the tables or table partitions. There are multiple ways to specify the point in time to which objects must be recovered.Use the RESTORE and RECOVER commands to recover tables or table partitions.RMAN enables you to use the RECOVER command to recover one or more tables or table partitions in a pluggable database (PDB) to a specified point-in-time, without impacting other objects in the PDB. This section contains examples that cover multiple scenarios for recovering tables and table partitions.This example recovers multiple tables to a specified point in time that is represented using SYSDATE.This example uses RMAN backups to recover multiple table partitions.This example recovers multiple tables into a new schema that is different from the source schema.">Recovering Tables and Table Partitions</a></p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="BRADV89740"></a><div class="props_rev_3"><a id="GUID-0B058026-43E6-4D39-A67A-B7289636B57F" name="GUID-0B058026-43E6-4D39-A67A-B7289636B57F"></a><h5 id="BRADV-GUID-0B058026-43E6-4D39-A67A-B7289636B57F" class="sect5"><span class="enumeration_section">18.1.2.1 </span>Basic Concepts of Database Point-in-Time Recovery for non-CDBs
                     </h5>
                     <div>
                        <p>DBPITR works at the physical level to return the data files to their state at a target time in the past.</p>
                        <p>In an RMAN DBPITR operation, you specify a target SCN, log sequence, restore point, or time. RMAN restores the database from backups created before the target time, and then applies incremental backups and logs to re-create all changes between the time of the data file backups and the end point of recovery. When the end point is specified as an SCN, the database applies the redo logs and stops after each redo thread or the specified SCN, whichever occurs first. When the end point is specified as a time, the database internally determines a suitable SCN for the specified time and then recovers to this SCN.</p>
                        <p>If your backup strategy is properly designed and your database is running in <code class="codeph">ARCHIVELOG</code> mode, then DBPITR is an option in nearly all circumstances. RMAN simplifies DBPITR in comparison to the user-managed DBPITR described in <span class="q">"<a href="user-managed-flashback-dbpitr.html#GUID-2BF2BE5E-3D1B-4F0C-9F10-25D5342F6DB3" title="Incomplete recovery is also known as database point-in-time recovery.">Performing Incomplete Database Recovery</a>"</span>. Given a target SCN, data files are restored from backup and recovered efficiently with no intervention from the user. Nevertheless, RMAN DBPITR has the following disadvantages:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>You cannot return selected objects to their earlier state, only the entire database.</p>
                           </li>
                           <li>
                              <p>Your entire database is unavailable during the DBPITR.</p>
                           </li>
                           <li>
                              <p>DBPITR can be time-consuming because RMAN must restore all data files. Also, RMAN may need to restore redo logs and incremental backups to recover the data files. If backups are on tape, then this process can take even longer.</p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="BRADV758"></a><div class="props_rev_3"><a id="GUID-35D290AC-CC01-4984-93D6-AE41A3D0D3B6" name="GUID-35D290AC-CC01-4984-93D6-AE41A3D0D3B6"></a><h5 id="BRADV-GUID-35D290AC-CC01-4984-93D6-AE41A3D0D3B6" class="sect5"><span class="enumeration_section">18.1.2.2 </span>Basic Concepts of Point-in-Time Recovery for PDBs
                     </h5>
                     <div>
                        <p>RMAN provides support for point-in-time recovery for one or more PDBs. To recover PDBs, you must connect to the root as a user with <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege. After recovery, old backups of the PDB remain valid and can be used if a media failure occurs.
                        </p>
                        <p>When you perform PITR of a PDB, all the data files for this PDB are recovered in-place. However, to recover the PDB to the specified target time, RMAN also needs the <code class="codeph">UNDO</code> tablespace as it existed at the target time. When shared undo is used, the <code class="codeph">UNDO</code> tablespace is shared by all PDBs and therefore it cannot be recovered in-place. RMAN restores the <code class="codeph">UNDO</code>, <code class="codeph">SYSTEM</code>, and <code class="codeph">SYSAUX</code> tablespaces in the root to an auxiliary database and then uses the undo information to recover the PDB to the target time. 
                        </p>
                        <p>If a fast recovery area is configured, Oracle Database uses it as the auxiliary destination. If the fast recovery area is not configured, then you must use the <code class="codeph">AUXILIARY DESTINATION</code> clause to specify the location used for auxiliary database files. Ensure that there is sufficient space in the fast recovery area to restore the root tablespaces and the undo tablespace. If the fast recovery area does not have the required space, use an alternate location by specifying the <code class="codeph">AUXILIARY DESTINATION</code> clause.
                        </p>
                        <p>In a Data Guard environment, for the standby database to follow a primary database in which a PDB was restored to a particular point in time, you may need to either flash back the entire standby database, restore the PDB, or flash back the PDB.</p>
                        <div class="infoboxnotealso" id="GUID-35D290AC-CC01-4984-93D6-AE41A3D0D3B6__GUID-3169C2EE-CF00-4747-99D5-83EE9CDC1C38">
                           <p class="notep1">See Also:</p>
                           <p><a href="rman-performing-flashback-dbpitr.html#GUID-031D9695-A9D2-4381-A840-39BD3CC19946" title="Use the RECOVER command to perform point-in-time recovery (PITR) of container databases (CDBs) and pluggable databases (PDBs). PITR of PDBs can only be performed using RMAN.">Performing Point-in-Time Recovery of CDBs and PDBs</a></p>
                        </div>
                     </div>
                  </div><a id="BRADV8702"></a><div class="props_rev_3"><a id="GUID-F2DE2466-1C9C-4FA7-8930-CD5D6DB62928" name="GUID-F2DE2466-1C9C-4FA7-8930-CD5D6DB62928"></a><h5 id="BRADV-GUID-F2DE2466-1C9C-4FA7-8930-CD5D6DB62928" class="sect5"><span class="enumeration_section">18.1.2.3 </span>Basic Concepts of Flashback Technology
                     </h5>
                     <p>The flashback features of the Oracle Database are more efficient than media recovery in most circumstances in which they are available. You can use them to investigate past states of the database.</p><a id="BRADV89741"></a><div class="props_rev_3"><a id="GUID-3F4DF6A3-137F-4487-B267-0F14E4B7657E" name="GUID-3F4DF6A3-137F-4487-B267-0F14E4B7657E"></a><h6 id="BRADV-GUID-3F4DF6A3-137F-4487-B267-0F14E4B7657E" class="sect6"><span class="enumeration_section">18.1.2.3.1 </span>About Physical Flashback Features Useful in Backup and Recovery
                        </h6>
                        <div>
                           <p>Oracle Flashback Database is the most efficient alternative to DBPITR.</p>
                           <p>Unlike the other flashback features, it operates at a physical level and reverts the current data files to their contents at a past time. The result is like the result of a DBPITR, including the <code class="codeph">OPEN RESETLOGS</code>, but Flashback Database is typically faster because it does not require you to restore data files and requires only limited application of redo compared to media recovery.
                           </p>
                           <p>A <a href="glossary.html#GUID-6E3CDD76-A573-4E5C-B12D-59C232C96C19"><span class="xrefglossterm">fast recovery area</span></a> is required for Flashback Database. To enable logging for Flashback Database, you must set the <a href="../refrn/DB_FLASHBACK_RETENTION_TARGET.html#REFRN10233" target="_blank"><code class="codeph">DB_FLASHBACK_RETENTION_TARGET</code></a> initialization parameter and issue the <code class="codeph">ALTER DATABASE FLASHBACK ON</code> statement. 
                           </p>
                           <p>During normal operation, the database periodically writes old images of data file blocks to the <a href="glossary.html#GUID-725ED3D7-5077-4F16-85AA-CDAD5BFCE554"><span class="xrefglossterm">flashback logs</span></a>. Flashback logs are written sequentially and often in bulk. In some respects, flashback logging is like a continuous backup. The database automatically creates, deletes, and resizes flashback logs in the recovery area. Flashback logs are not archived. You need only be aware of flashback logs for monitoring performance and determining disk space allocation for the recovery area.
                           </p>
                           <p>When you perform a Flashback Database operation, the database uses flashback logs to access past versions of data blocks and also uses some data in the archived redo logs. Consequently, you cannot enable Flashback Database <span class="italic">after</span> a failure is discovered and then use Flashback Database to rewind through this failure. You can use the related capability of guaranteed restore points to protect the contents of your database at a fixed point in time, such as immediately before a risky database change.
                           </p>
                           <p></p>
                           <p>If any unrecoverable operations are encountered during the small amount of redo apply required, then logically corrupt data blocks will result. This can lead to Oracle errors when such blocks are accessed.</p>
                           <div class="infoboxnotealso" id="GUID-3F4DF6A3-137F-4487-B267-0F14E4B7657E__GUID-C2E2A17F-F3B5-4715-A544-62A0018C3110">
                              <p class="notep1">See Also:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><a href="rman-performing-flashback-dbpitr.html#GUID-953FA30D-BED2-4DBA-8361-9DA1B8FF073F" title="Flashback Database reverses unwanted changes by returning your database to its state at a previous point in time.">Rewinding a Database with Flashback Database</a></p>
                                 </li>
                                 <li>
                                    <p><a href="configuring-rman-client-basic.html#GUID-302339EC-EE0F-45FB-9862-BB2BA138AA13" title="The fast recovery area feature enables you to set up a disk area where the database can create and manage a variety of files related to backup and recovery. Use of the fast recovery area is strongly recommended. Consider configuring a fast recovery area as a first step in implementing a backup strategy.">Configuring the Fast Recovery Area</a></p>
                                 </li>
                                 <li>
                                    <p><a href="../admin/repairing-corrupted-data.html#ADMIN-GUID-21282FF3-1E98-478E-8111-0A7CAFCFCD97" target="_blank"><span><cite>Oracle Database Administrator’s Guide</cite></span></a></p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                     </div><a id="BRADV89742"></a><div class="props_rev_3"><a id="GUID-8FA281D7-9297-4445-985F-4EC4F951CA39" name="GUID-8FA281D7-9297-4445-985F-4EC4F951CA39"></a><h6 id="BRADV-GUID-8FA281D7-9297-4445-985F-4EC4F951CA39" class="sect6"><span class="enumeration_section">18.1.2.3.2 </span>About Logical Flashback Features Useful in Backup and Recovery
                        </h6>
                        <div>
                           <p>Logical flashback features are used to recover tables and their contents to a past time.</p>
                           <p>The logical features are as follows:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Flashback Table</p>
                                 <p>You can recover a table or set of tables to a specified earlier point in time without taking any part of the database offline. In many cases, Flashback Table eliminates the need to perform more complicated point-in-time recovery operations. Flashback Table restores tables while automatically maintaining associated attributes such as current indexes, triggers, and constraints, and not requiring you to find and restore application-specific properties. </p>
                              </li>
                              <li>
                                 <p>Flashback Drop</p>
                                 <p>You can reverse the effects of a <code class="codeph">DROP TABLE</code> statement. 
                                 </p>
                              </li>
                           </ul>
                           <p>All logical flashback features except Flashback Drop rely on <strong class="term">undo data</strong>. Used primarily for providing read consistency for SQL queries and rolling back transactions, undo records contain the information required to reconstruct data as it existed at a past time and examine the record of changes since that past time. 
                           </p>
                           <p>Flashback Drop relies on a mechanism called the <a href="glossary.html#GUID-6D99D402-0A6E-4718-98E9-19528F3012B2"><span class="xrefglossterm">recycle bin</span></a>, which the database uses to manage dropped database objects until the space they occupied is needed for new data. There is no fixed amount of space allocated to the recycle bin, and no guarantee regarding how long dropped objects remain in the recycle bin. Depending on system activity, a dropped object may remain in the recycle bin for seconds or for months.
                           </p>
                           <div class="infoboxnotealso" id="GUID-8FA281D7-9297-4445-985F-4EC4F951CA39__GUID-D5746CEC-3E83-4D44-A4B8-4CEC4FDC35F2">
                              <p class="notep1">See Also:</p>
                              <p> </p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><a href="rman-performing-flashback-dbpitr.html#GUID-FF315DFC-ABBC-410D-ABDB-75FA89D43255" title="Flashback Table uses information in the undo tablespace rather than restored backups to retrieve the table. When a Flashback Table operation occurs, new rows are deleted and old rows are reinserted. The rest of your database remains available while the flashback of the table is being performed.">Rewinding a Table with Flashback Table</a></p>
                                 </li>
                                 <li>
                                    <p><a href="rman-performing-flashback-dbpitr.html#GUID-55EA5EB0-89E2-4561-A9D0-01A6242A2A87" title="You can retrieve objects from the recycle bin with the FLASHBACK TABLE ... TO BEFORE DROP statement.">Rewinding a DROP TABLE Operation with Flashback Drop</a></p>
                                 </li>
                                 <li>
                                    <p><a href="../admin/managing-undo.html#ADMIN013" target="_blank"><span><cite>Oracle Database Administrator’s Guide</cite></span></a> for more information about undo data and automatic undo management
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-A2146E48-16FC-40CC-B25D-902DEB93CB75" name="GUID-A2146E48-16FC-40CC-B25D-902DEB93CB75"></a><h4 id="BRADV-GUID-A2146E48-16FC-40CC-B25D-902DEB93CB75" class="sect4"><span class="enumeration_section">18.1.3 </span>Basic Concepts of Performing Flashback Database for CDBs and PDBs
                  </h4>
                  <div>
                     <p>You can perform a Flashback Database operation for a whole multitenant container database (CDB) or for a particular pluggable database (PDB).</p>
                     <p>Flashback Database for a whole CDB enables you to rewind the entire CDB, including all its PDBs, to a previous point in time. Flashback Database for a particular PDB enables you to reverse unwanted changes caused by logical data corruption or user errors in that PDB. When you perform a Flashback Database operation for a specific PDB, the other PDBs can be open and operational. </p>
                     <p>You can perform multiple flashback database operations on a single PDB. However, you can only perform a flashback operation on a PDB to one of its ancestor incarnations. A PDB must always stay in a past incarnation that is compatible with the overall database incarnation.</p>
                     <p>To perform a Flashback Database operation for a PDB, the desired target point in time can be specified using a PDB restore point, a <a href="glossary.html#GUID-6BFC6E77-175D-4055-8198-6091D47AD8F6"><span class="xrefglossterm">CDB restore point</span></a>, an SCN, or a time expression. A flashback operation on a PDB to a CDB restore point is equivalent to a flashback operation on the PDB to the restore point SCN on the CDB incarnation. In general, for PDBs, a flashback operation to a <a href="glossary.html#GUID-7C3A47D4-B9C5-40D3-89D0-8BD77281AAB1"><span class="xrefglossterm">PDB restore point</span></a> is more accurate than a flashback operation to a CDB restore point. This is because a PDB restore point represents the PDB sub-incarnation of the point in time at which it was created.
                     </p>
                     <p></p>
                     <p>You can also perform a Flashback Database operation for a PDB on a physical standby database after performing the same operation on the primary database.</p>
                     <p>Backups of a PDB continue to be valid even after a Flashback Database operation is performed on that PDB. In case of a media failure, you can recover from the failure by restoring these PDB backups. This type of PDB recovery can recover through database resetlogs and PDB resetlogs.</p>
                     <div class="infoboxnote" id="GUID-A2146E48-16FC-40CC-B25D-902DEB93CB75__GUID-CBAD26EF-4569-4BA5-A871-B91EE1539687">
                        <p class="notep1">Note:</p>
                        <p>You cannot perform a flashback operation only on the root, you must perform a flashback operation on the entire CDB.</p>
                     </div>
                     <div class="infoboxnote" id="GUID-A2146E48-16FC-40CC-B25D-902DEB93CB75__GUID-0A768208-8D82-4F9C-B7B6-3FEA705F9F69">
                        <p class="notep1">Note:</p>
                        <p>To perform a flashback operation for an application container, you must perform flashback operations for the application root and all the individual application PDBs that are part of the application container. Performing a flashback operation on the application root reverts only the application root to the specified point in time.</p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-A2146E48-16FC-40CC-B25D-902DEB93CB75__GUID-3028156A-8C67-4C69-B915-FDD812484308">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="rman-performing-flashback-dbpitr.html#GUID-8466CA3C-652A-4AAB-88EB-8815575D6266" title="You can perform a flashback database operation for a whole multitenant container database (CDB) using the FLASHBACK DATABASE command.">Performing a Flashback Database Operation for a Whole CDB</a></p>
                           </li>
                           <li>
                              <p><a href="rman-performing-flashback-dbpitr.html#GUID-C1215E86-9A7B-4EC9-9777-2A18BD627394" title="You can perform a flashback database operation for a single pluggable database (PDB) in a multitenant container database (CDB) using the FLASHBACK DATABASE command.">Performing a Flashback Database Operation for PDBs</a></p>
                           </li>
                           <li>
                              <p><a href="user-managed-flashback-dbpitr.html#GUID-2E5F3F62-17ED-472A-ABBD-FAAF107C6852" title="You can use SQL*Plus to perform flashback database operations on non-CDBs, multitenant container databases (CDBs), and pluggable databases (PDBs). Oracle Flashback Database returns your entire database or an entire PDB to a previous state without requiring you to restore files from backup.">Performing Flashback Database with SQL*Plus</a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-FA670699-C8AD-459A-9ED7-8B10F5196BCC" name="GUID-FA670699-C8AD-459A-9ED7-8B10F5196BCC"></a><h5 id="BRADV-GUID-FA670699-C8AD-459A-9ED7-8B10F5196BCC" class="sect5"><span class="enumeration_section">18.1.3.1 </span>About Flashback Database and PITR for PDBs
                     </h5>
                     <div>
                        <p></p>
                        <p>For pluggable databases (PDBs) that use local undo, database point-in-time recovery (PITR) and flashback operations are independent of each other.</p>
                        <p>For <a href="glossary.html#GUID-993BFB3F-3305-481C-999D-26132095DEC9"><span class="xrefglossterm">PDB</span></a>s that use shared undo, database point-in-time recovery and flashback operations are independent with the following caveat:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>If you perform a flashback operation for a PDB or recover a PDB to a particular point in time, Oracle Database may apply undo data during the PDB resetlogs operation to back out transactions that are not committed at that point in time.  If you subsequently recover the entire <a href="glossary.html#GUID-3E156A59-F6CC-4A2A-9749-DB7D1CE25F13"><span class="xrefglossterm">multitenant container database (CDB)</span></a> to a point in time that is in the middle of the PDB resetlogs operation, then you will receive a warning that some PDBs may not be opened. For such PDBs, you need to perform one of the following mutually exclusive actions:
                              </p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>Recover the entire CDB or perform a flashback operation for the entire CDB to a different SCN</p>
                                 </li>
                                 <li>
                                    <p>Recover all the affected PDBs or perform a flashback database operation for all the affected PDBs to a different SCN</p>
                                 </li>
                              </ul>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-FA670699-C8AD-459A-9ED7-8B10F5196BCC__GUID-9D8C7C05-BF18-4952-86E7-E540AE50DDED">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="rman-performing-flashback-dbpitr.html#GUID-A2146E48-16FC-40CC-B25D-902DEB93CB75" title="You can perform a Flashback Database operation for a whole multitenant container database (CDB) or for a particular pluggable database (PDB).">Basic Concepts of Performing Flashback Database for CDBs and PDBs</a></p>
                              </li>
                              <li>
                                 <p><a href="rman-performing-flashback-dbpitr.html#GUID-66B1A12D-1C92-43B5-A204-AA8A6D177ABD" title="A multitenant container database (CDB) can use shared undo or local undo. The technique used by RMAN to perform flashback database operations depends on the type of undo configuration for the CDB.">About Undo and Flashback Database Operations for PDBs</a></p>
                              </li>
                              <li>
                                 <p><a href="rman-performing-flashback-dbpitr.html#GUID-50F6CEE3-3B1B-44B0-9AF4-08E1ABC137B7" title="RMAN provides methods to manage redo corruption to data blocks in a PDB.">About Managing Redo Corruption in CDBs</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-66B1A12D-1C92-43B5-A204-AA8A6D177ABD" name="GUID-66B1A12D-1C92-43B5-A204-AA8A6D177ABD"></a><h5 id="BRADV-GUID-66B1A12D-1C92-43B5-A204-AA8A6D177ABD" class="sect5"><span class="enumeration_section">18.1.3.2 </span>About Undo and Flashback Database Operations for PDBs
                     </h5>
                     <div>
                        <p> A multitenant container database (CDB) can use shared undo or local undo. The technique used by RMAN to perform flashback database operations depends on the type of undo configuration for the CDB.</p>
                        <p>When a CDB uses local undo, performing a flashback database operation on a <a href="glossary.html#GUID-D4239448-A344-41EF-9566-0B7716FEAE72"><span class="xrefglossterm">pluggable database (PDB)</span></a> is straight-forward because only data files related to that PDB need to be modified.
                        </p>
                        <p>In the case of a CDB that uses shared undo, since one set of tablespaces is shared by all PDBs, undo data for multiple PDBs may be mixed within the undo tablespaces and even within individual data blocks. Therefore, to perform a flashback database operation for a PDB, RMAN automatically uses an auxiliary instance to restore shared undo tablespaces and certain tablespaces in the root and then recovers data to the required point in time. This process may involve restoring backups for a relatively small amount of data. When you perform a flashback database operation on a PDB to a clean PDB restore point, no auxiliary instance or restoring of backups is required.</p>
                        <p>By default, the auxiliary instance is created in the fast recovery area. You can use the <code class="codeph">AUXILIARY DESTINATION</code> clause in the <code class="codeph">FLASHBACK DATABASE</code> command to specify an alternate location for the auxiliary instance.
                        </p>
                        <div class="infoboxnotealso" id="GUID-66B1A12D-1C92-43B5-A204-AA8A6D177ABD__GUID-7636783C-D29A-426F-B1AA-EF61DDF4B025">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="rman-performing-flashback-dbpitr.html#GUID-A2146E48-16FC-40CC-B25D-902DEB93CB75" title="You can perform a Flashback Database operation for a whole multitenant container database (CDB) or for a particular pluggable database (PDB).">Basic Concepts of Performing Flashback Database for CDBs and PDBs</a></p>
                              </li>
                              <li>
                                 <p><a href="rman-performing-flashback-dbpitr.html#GUID-FA670699-C8AD-459A-9ED7-8B10F5196BCC">About Flashback Database and PITR for PDBs</a></p>
                              </li>
                              <li>
                                 <p><a href="rman-performing-flashback-dbpitr.html#GUID-50F6CEE3-3B1B-44B0-9AF4-08E1ABC137B7" title="RMAN provides methods to manage redo corruption to data blocks in a PDB.">About Managing Redo Corruption in CDBs</a></p>
                              </li>
                              <li>
                                 <p><a href="rman-performing-flashback-dbpitr.html#GUID-8466CA3C-652A-4AAB-88EB-8815575D6266" title="You can perform a flashback database operation for a whole multitenant container database (CDB) using the FLASHBACK DATABASE command.">Performing a Flashback Database Operation for a Whole CDB</a></p>
                              </li>
                              <li>
                                 <p><a href="rman-performing-flashback-dbpitr.html#GUID-C1215E86-9A7B-4EC9-9777-2A18BD627394" title="You can perform a flashback database operation for a single pluggable database (PDB) in a multitenant container database (CDB) using the FLASHBACK DATABASE command.">Performing a Flashback Database Operation for PDBs</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-50F6CEE3-3B1B-44B0-9AF4-08E1ABC137B7" name="GUID-50F6CEE3-3B1B-44B0-9AF4-08E1ABC137B7"></a><h5 id="BRADV-GUID-50F6CEE3-3B1B-44B0-9AF4-08E1ABC137B7" class="sect5"><span class="enumeration_section">18.1.3.3 </span>About Managing Redo Corruption in CDBs
                     </h5>
                     <div>
                        <p>RMAN provides methods to manage redo corruption to data blocks in a PDB.</p>
                        <p>In very rare circumstances, the redo logs in a <a href="glossary.html#GUID-3E156A59-F6CC-4A2A-9749-DB7D1CE25F13"><span class="xrefglossterm">multitenant container database (CDB)</span></a> may be corrupted. In such a scenario, if the affected data blocks reside only in one pluggable database (PDB), then you can do one of the following:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>perform a flashback operation on the PDB to a point in time before the corruption and then open the PDB with <code class="codeph">RESETLOGS</code></p>
                           </li>
                           <li>
                              <p>perform a point-in-time recovery of the PDB to a point in time before the corruption and then open the PDB with <code class="codeph">RESETLOGS</code></p>
                           </li>
                        </ul>
                        <p>After you perform one of these steps on the primary database, any standby database of this primary database can also skip the corrupted redo provided you perform the steps required to enable a standby to follow a primary after a PITR or Flashback on the PDB.</p>
                        <div class="infoboxnotealso" id="GUID-50F6CEE3-3B1B-44B0-9AF4-08E1ABC137B7__GUID-95B86396-0E20-420A-8744-FF911CB7EF3C">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="rman-performing-flashback-dbpitr.html#GUID-A2146E48-16FC-40CC-B25D-902DEB93CB75" title="You can perform a Flashback Database operation for a whole multitenant container database (CDB) or for a particular pluggable database (PDB).">Basic Concepts of Performing Flashback Database for CDBs and PDBs</a></p>
                              </li>
                              <li>
                                 <p><a href="../sbydb/examples-of-using-oracle-data-guard.html#SBYDB-GUID-8D948A24-A3B7-4E4F-917A-00B047CF3CAF" target="_blank"><span><cite>Oracle Data Guard Concepts and Administration</cite></span></a> for steps to enable a standby to follow a primary
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV81517"></a><div class="props_rev_3"><a id="GUID-FF315DFC-ABBC-410D-ABDB-75FA89D43255" name="GUID-FF315DFC-ABBC-410D-ABDB-75FA89D43255"></a><h3 id="BRADV-GUID-FF315DFC-ABBC-410D-ABDB-75FA89D43255" class="sect3"><span class="enumeration_section">18.2 </span>Rewinding a Table with Flashback Table
               </h3>
               <div>
                  <p>Flashback Table uses information in the undo tablespace rather than restored backups to retrieve the table. When a Flashback Table operation occurs, new rows are deleted and old rows are reinserted. The rest of your database remains available while the flashback of the table is being performed.</p>
                  <p><span class="bold">To rewind a table to a previous point in time:</span></p>
                  <ol>
                     <li>
                        <p>Ensure that the prerequisites described in <span class="q">"<a href="rman-performing-flashback-dbpitr.html#GUID-AA471072-D35C-410E-8C68-14E0DF8FB5D1" title="To perform a Flashback Table operation, the table must be eligible to be flashed back and the user performing the operation must have the required privileges.">Prerequisites for Flashback Table</a>"</span> are met.
                        </p>
                     </li>
                     <li>
                        <p>Perform a Flashback Table operation on the table, as described in <span class="q">"<a href="rman-performing-flashback-dbpitr.html#GUID-A7D05B55-F5EA-46BC-A025-09F423349BAF" title="To use the Flashback Table feature on one or more tables, use the FLASHBACK TABLE SQL statement with a target time or SCN.">Performing a Flashback Table Operation</a>"</span>.
                        </p>
                     </li>
                  </ol>
                  <div class="infoboxnotealso" id="GUID-FF315DFC-ABBC-410D-ABDB-75FA89D43255__GUID-961184FB-C9A8-41AE-B78C-3BDAB99BFAD0">
                     <p class="notep1">See Also:</p>
                     <p><a href="../admin/managing-undo.html#ADMIN013" target="_blank"><span><cite>Oracle Database Administrator’s Guide</cite></span></a> for more information about automatic undo management
                     </p>
                  </div>
               </div><a id="BRADV89743"></a><div class="props_rev_3"><a id="GUID-AA471072-D35C-410E-8C68-14E0DF8FB5D1" name="GUID-AA471072-D35C-410E-8C68-14E0DF8FB5D1"></a><h4 id="BRADV-GUID-AA471072-D35C-410E-8C68-14E0DF8FB5D1" class="sect4"><span class="enumeration_section">18.2.1 </span>Prerequisites for Flashback Table
                  </h4>
                  <div>
                     <p>To perform a Flashback Table operation, the table must be eligible to be flashed back and the user performing the operation must have the required privileges.</p>
                     <p>You must have the following privileges to use the Flashback Table feature:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>You must have been granted the <code class="codeph">FLASHBACK ANY TABLE</code> system privilege or you must have the <code class="codeph">FLASHBACK</code> object privilege on the table. 
                           </p>
                        </li>
                        <li>
                           <p>You must have <code class="codeph">READ</code> or <code class="codeph">SELECT</code>, <code class="codeph">INSERT</code>, <code class="codeph">DELETE</code>, and <code class="codeph">ALTER</code> privileges on the table.
                           </p>
                        </li>
                        <li>
                           <p>To flash back a table to a restore point, you must have the <code class="codeph">SELECT ANY DICTIONARY</code> or <code class="codeph">FLASHBACK ANY TABLE</code> system privilege or the <code class="codeph">SELECT_CATALOG_ROLE</code> role.
                           </p>
                        </li>
                     </ul>
                     <p>For an object to be eligible to be flashed back, the following prerequisites must be met:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The object must <span class="bold">not</span> be included the following categories: tables that are part of a cluster, materialized views, Advanced Queuing (AQ) tables, static data dictionary tables, system tables, remote tables, object tables, nested tables, or individual table partitions or subpartitions.
                           </p>
                        </li>
                        <li>
                           <p>The structure of the table must not have been changed between the current time and the target flashback time.</p>
                           <p>The following Data Definition Language (DDL) operations change the structure of a table: upgrading, moving, or truncating a table; adding a constraint to a table, adding a table to a cluster; modifying or dropping a column; adding, dropping, merging, splitting, coalescing, or truncating a partition or subpartition (except adding a range partition).</p>
                        </li>
                        <li>
                           <p>Row movement must be enabled on the table, which indicates that rowids change after the flashback occurs.</p>
                           <p>This restriction exists because if rowids before the flashback were stored by the application, then there is no guarantee that the rowids correspond to the same rows after the flashback. If your application depends on rowids, then you cannot use Flashback Table.</p>
                        </li>
                        <li>
                           <p>The undo data in the <a href="glossary.html#GUID-675711E4-849C-4D86-993A-D5AA94444D3A"><span class="xrefglossterm">undo tablespace</span></a> must extend far enough back in time to satisfy the flashback target time or SCN. 
                           </p>
                           <p>The point to which you can perform Flashback Table is determined by the <a href="glossary.html#GUID-C297DDAF-1A4D-40DA-B89C-46A31D5271E9"><span class="xrefglossterm">undo retention period</span></a>, which is the minimal time for which undo data is kept before being recycled, and tablespace characteristics. The undo data contains information about data blocks before they were changed. The flashback operation uses undo to re-create the original data.
                           </p>
                           <p>To ensure that the undo information is retained for Flashback Table operations, Oracle suggests setting the <code class="codeph">UNDO_RETENTION</code> parameter to 86400 seconds (24 hours) or greater for the undo tablespace. 
                           </p>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-AA471072-D35C-410E-8C68-14E0DF8FB5D1__GUID-203F9373-627B-40EC-9445-48D5342A92A4">
                        <p class="notep1">Note:</p>
                        <p><code class="codeph">FLASHBACK</code> <code class="codeph">TABLE </code><code class="codeph">...</code> <code class="codeph">TO</code> <code class="codeph">BEFORE</code> <code class="codeph">DROP</code> is a use of the Flashback Drop feature, not Flashback Table, and therefore is not subject to these prerequisites. See <span class="q">"<a href="rman-performing-flashback-dbpitr.html#GUID-55EA5EB0-89E2-4561-A9D0-01A6242A2A87" title="You can retrieve objects from the recycle bin with the FLASHBACK TABLE ... TO BEFORE DROP statement.">Rewinding a DROP TABLE Operation with Flashback Drop</a>"</span> for more information.
                        </p>
                     </div>
                  </div>
               </div><a id="BRADV341"></a><a id="BRADV89744"></a><div class="props_rev_3"><a id="GUID-A7D05B55-F5EA-46BC-A025-09F423349BAF" name="GUID-A7D05B55-F5EA-46BC-A025-09F423349BAF"></a><h4 id="BRADV-GUID-A7D05B55-F5EA-46BC-A025-09F423349BAF" class="sect4"><span class="enumeration_section">18.2.2 </span>Performing a Flashback Table Operation
                  </h4>
                  <div>
                     <p>To use the Flashback Table feature on one or more tables, use the <code class="codeph">FLASHBACK TABLE</code> SQL statement with a target time or SCN.
                     </p>
                     <div class="section">
                        <p>Assume that you want to perform a flashback of the <code class="codeph">hr.temp_employees</code> table after a user made some incorrect updates. Use the following steps:
                        </p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Ensure that the prerequisites that are described in <span class="q">"<a href="rman-performing-flashback-dbpitr.html#GUID-AA471072-D35C-410E-8C68-14E0DF8FB5D1" title="To perform a Flashback Table operation, the table must be eligible to be flashed back and the user performing the operation must have the required privileges.">Prerequisites for Flashback Table</a>"</span> are met.</span></li>
                        <li class="stepexpand"><span>Connect SQL*Plus to the target database and identify the current SCN. </span><div>
                              <p>You cannot roll back a <code class="codeph">FLASHBACK TABLE</code> statement, but you can issue another <code class="codeph">FLASHBACK TABLE</code> statement and specify a time just before the current time. Therefore, it is advisable to record the current SCN. You can obtain it by querying <code class="codeph">V$DATABASE</code> as follows:
                              </p><pre class="oac_no_warn" dir="ltr">SELECT CURRENT_SCN FROM V$DATABASE;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Identify the time, SCN, or restore point to which you want to return the table.</span><div>
                              <p>If you have created restore points, then you can list available restore points by executing the following query:</p><pre class="oac_no_warn" dir="ltr">SELECT NAME, SCN, TIME FROM V$RESTORE_POINT;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Ensure that enough undo data exists to rewind the table to the specified target.</span><div>
                              <p>If the <code class="codeph">UNDO_RETENTION</code> initialization parameter is set, and the undo retention guarantee is on, then you can use the following query to determine how long undo data is being retained:
                              </p><pre class="oac_no_warn" dir="ltr">SELECT NAME, VALUE/60 MINUTES_RETAINED
FROM   V$PARAMETER
WHERE  NAME = 'undo_retention';
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Ensure that row movement is enabled for all objects that you are rewinding with Flashback Table.</span><div>
                              <p>You can enable row movement for a table with the following SQL statement:</p><pre class="oac_no_warn" dir="ltr">ALTER TABLE <code class="codeph">hr.temp_employees</code> ENABLE ROW MOVEMENT;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Determine whether the table that you intend to flash back has dependencies on other tables. If dependencies exist, then decide whether to flash back these tables as well.</span><div>
                              <p>You can issue the following SQL query to determine the dependencies, where <span class="italic">schema_name</span> is the schema for the table to be flashed back and <span class="italic">table_name</span> is the name of the table:
                              </p><pre class="oac_no_warn" dir="ltr">SELECT other.owner, other.table_name
FROM   sys.all_constraints this, sys.all_constraints other
WHERE  this.owner = <span class="italic">schema_name</span>
AND    this.table_name = <span class="italic">table_name</span>
AND    this.r_owner = other.owner
AND    this.r_constraint_name = other.constraint_name
AND    this.constraint_type='R';
</pre></div>
                        </li>
                        <li class="stepexpand" id="GUID-A7D05B55-F5EA-46BC-A025-09F423349BAF__CHDHCAGI"><span>Execute a <code class="codeph">FLASHBACK TABLE</code> statement for the objects to flash back.</span><div>
                              <p>The following SQL statement returns the <code class="codeph">hr.temp_employees</code> table to the restore point named <code class="codeph">temp_employees_update</code>:
                              </p><pre class="oac_no_warn" dir="ltr">FLASHBACK TABLE hr.temp_employees
  TO RESTORE POINT temp_employees_update;
</pre><p>The following SQL statement rewinds the <code class="codeph">hr.temp_employees</code> table to its state when the database was at the time specified by the SCN:
                              </p><pre class="oac_no_warn" dir="ltr">FLASHBACK TABLE hr.temp_employees
  TO SCN 123456;
</pre><p>As shown in the following example, you can also specify the target point in time with <code class="codeph">TO_TIMESTAMP</code>:
                              </p><pre class="oac_no_warn" dir="ltr">FLASHBACK TABLE hr.temp_employees
  TO TIMESTAMP TO_TIMESTAMP('2013-10-17 09:30:00', 'YYYY-MM-DD HH:MI:SS');</pre><div class="infoboxnote" id="GUID-A7D05B55-F5EA-46BC-A025-09F423349BAF__GUID-4A748F8A-A374-45BE-852B-18EE762998F8">
                                 <p class="notep1">Note:</p>
                                 <p>The mapping of time stamps to SCNs is not always exact. When you use time stamps with the <code class="codeph">FLASHBACK</code> <code class="codeph">TABLE</code> statement, the time to which the table is flashed back can vary by up to approximately 3 seconds of the time specified for <code class="codeph">TO_TIMESTAMP</code>. If an exact point in time is required, then use an SCN rather than a time. 
                                 </p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Optionally, query the table to check the data.</span></li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-A7D05B55-F5EA-46BC-A025-09F423349BAF__GUID-919EDDE7-195F-46D0-84CE-4D3DA06E31E3">
                           <p class="notep1">See Also:</p><a href="rman-performing-flashback-dbpitr.html#GUID-3F9961EC-EF49-4E19-BAFD-3A11EDDE53C8" title="By default, the database disables triggers on the affected table before performing a FLASHBACK TABLE operation. After the operation, the database returns the triggers to the state they were in before the operation (enabled or disabled).">Keeping Triggers Enabled During Flashback Table</a></div>
                     </div>
                     <!-- class="section" -->
                  </div><a id="BRADV89745"></a><div class="props_rev_3"><a id="GUID-3F9961EC-EF49-4E19-BAFD-3A11EDDE53C8" name="GUID-3F9961EC-EF49-4E19-BAFD-3A11EDDE53C8"></a><h5 id="BRADV-GUID-3F9961EC-EF49-4E19-BAFD-3A11EDDE53C8" class="sect5"><span class="enumeration_section">18.2.2.1 </span>Keeping Triggers Enabled During Flashback Table
                     </h5>
                     <div>
                        <p>By default, the database disables triggers on the affected table before performing a <code class="codeph">FLASHBACK TABLE</code> operation. After the operation, the database returns the triggers to the state they were in before the operation (enabled or disabled). 
                        </p>
                        <div class="section">
                           <p>To keep triggers enabled during the flashback of the table, add an <code class="codeph">ENABLE TRIGGERS</code> clause to the <code class="codeph">FLASHBACK TABLE</code> statement.
                           </p>
                           <p>For example, assume that at 17:00 an HR administrator discovers that an employee is missing from the <code class="codeph">hr.temp_employees</code> table. This employee was included in the table at 14:00, the last time the report was run. Therefore, someone accidentally deleted the record for this employee between 14:00 and 17:00. The HR administrator uses Flashback Table to return the table to its state at 14:00, respecting any triggers set on the <code class="codeph">hr.temp_employees</code> table, by using the SQL statement in the following example:
                           </p><pre class="oac_no_warn" dir="ltr">FLASHBACK TABLE hr.temp_employees
  TO TIMESTAMP TO_TIMESTAMP('2013-03-03 14:00:00' , 'YYYY-MM-DD HH:MI:SS') 
  ENABLE TRIGGERS;</pre><div class="infoboxnotealso" id="GUID-3F9961EC-EF49-4E19-BAFD-3A11EDDE53C8__GUID-5C47F87D-FBB4-4080-9D69-9AA1BD8E3B55">
                              <p class="notep1">See Also:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><a href="../admin/managing-tables.html#ADMIN01512" target="_blank"><span><cite>Oracle Database Administrator’s Guide</cite></span></a> to learn how to recover tables with the Flashback Table feature
                                    </p>
                                 </li>
                                 <li>
                                    <p><a href="../sqlrf/FLASHBACK-TABLE.html#SQLRF01802" target="_blank"><span><cite>Oracle Database SQL Language Reference</cite></span></a> for a simple Flashback Table scenario
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div><a id="BRADV81511"></a><div class="props_rev_3"><a id="GUID-55EA5EB0-89E2-4561-A9D0-01A6242A2A87" name="GUID-55EA5EB0-89E2-4561-A9D0-01A6242A2A87"></a><h3 id="BRADV-GUID-55EA5EB0-89E2-4561-A9D0-01A6242A2A87" class="sect3"><span class="enumeration_section">18.3 </span>Rewinding a DROP TABLE Operation with Flashback Drop
               </h3>
               <div>
                  <p>You can retrieve objects from the recycle bin with the <code class="codeph">FLASHBACK TABLE ... TO BEFORE DROP</code> statement.
                  </p>
                  <p>This section contains the following topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="rman-performing-flashback-dbpitr.html#GUID-D953DEDB-4C98-4BA9-B5FE-CCBA68679C3F" title="Flashback Drop reverses the effects of a DROP TABLE operation. Flashback Drop is faster than other recovery mechanisms that can be used in this situation, such as point-in-time recovery, and does not lead to downtime or loss of recent transactions.">About Flashback Drop</a></p>
                     </li>
                     <li>
                        <p><a href="rman-performing-flashback-dbpitr.html#GUID-F5B66BE0-4941-4513-821B-74F7ACB6489E" title="Prerequisites must be met before you perform a Flashback Drop operation.">Prerequisites of Flashback Drop</a></p>
                     </li>
                     <li>
                        <p><a href="rman-performing-flashback-dbpitr.html#GUID-6AED5A17-B29C-4F92-80C0-49F06A62DE4F" title="Use the FLASHBACK TABLE ... TO BEFORE DROP statement to recover objects from the recycle bin. You can specify either the name of the table in the recycle bin or the original table name.">Performing a Flashback Drop Operation</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89746"></a><div class="props_rev_3"><a id="GUID-D953DEDB-4C98-4BA9-B5FE-CCBA68679C3F" name="GUID-D953DEDB-4C98-4BA9-B5FE-CCBA68679C3F"></a><h4 id="BRADV-GUID-D953DEDB-4C98-4BA9-B5FE-CCBA68679C3F" class="sect4"><span class="enumeration_section">18.3.1 </span>About Flashback Drop
                  </h4>
                  <div>
                     <p>Flashback Drop reverses the effects of a <code class="codeph">DROP TABLE</code> operation. Flashback Drop is faster than other recovery mechanisms that can be used in this situation, such as point-in-time recovery, and does not lead to downtime or loss of recent transactions.
                     </p>
                     <p>When you drop a table, the database does not immediately remove the space associated with the table. Instead, the table is renamed and, along with any associated objects, placed in the recycle bin. System-generated recycle bin object names are unique. You can query objects in the recycle bin, just as you can query other objects.</p>
                     <p>A flashback operation retrieves the table from the recycle bin. When retrieving dropped tables, you can specify either the original user-specified name of the table or the system-generated name.</p>
                     <p>When you drop a table, the table and all of its dependent objects go into the recycle bin together. Likewise, when you perform Flashback Drop, the objects are generally all retrieved together. When you restore a table from the recycle bin, dependent objects such as indexes do not get their original names back; they retain their system-generated recycle bin names. Oracle Database retrieves all indexes defined on the table except for bitmap join indexes, and all triggers and constraints defined on the table except for referential integrity constraints that reference other tables.</p>
                     <p>Some dependent objects such as indexes may possibly have been reclaimed because of space pressure. In such cases, the reclaimed dependent objects are not retrievable from the recycle bin.</p>
                  </div>
               </div><a id="BRADV89747"></a><div class="props_rev_3"><a id="GUID-F5B66BE0-4941-4513-821B-74F7ACB6489E" name="GUID-F5B66BE0-4941-4513-821B-74F7ACB6489E"></a><h4 id="BRADV-GUID-F5B66BE0-4941-4513-821B-74F7ACB6489E" class="sect4"><span class="enumeration_section">18.3.2 </span>Prerequisites of Flashback Drop
                  </h4>
                  <div>
                     <p>Prerequisites must be met before you perform a Flashback Drop operation.</p>
                     <p>The user privileges required for the operations related to Flashback Drop and the recycle bin are as follows:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><code class="codeph">DROP</code></p>
                           <p>Any user with <code class="codeph">DROP</code> privileges over an object can drop the object, placing it in the recycle bin.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">FLASHBACK TABLE ... TO BEFORE DROP</code></p>
                           <p>Privileges for this statement are tied to the privileges for <code class="codeph">DROP</code>. That is, any user who can drop an object can perform Flashback Drop to retrieve the dropped object from the recycle bin.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">PURGE</code></p>
                           <p>Privileges for a purge of the recycle bin are tied to the <code class="codeph">DROP</code> privileges. Any user having <code class="codeph">DROP</code> <code class="codeph">TABLE</code>, <code class="codeph">DROP</code> <code class="codeph">ANY</code> <code class="codeph">TABLE</code>, or <code class="codeph">PURGE</code> <code class="codeph">DBA_RECYCLE_BIN</code> privileges can purge the objects from the recycle bin.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">READ</code> or <code class="codeph">SELECT</code> and <code class="codeph">FLASHBACK</code> for objects in the Recycle Bin
                           </p>
                           <p>Users must have the <code class="codeph">READ</code> or <code class="codeph">SELECT</code> and <code class="codeph">FLASHBACK</code> privileges over an object in the recycle bin to query the object in the recycle bin. Any users who had the <code class="codeph">READ</code> or <code class="codeph">SELECT</code> privilege over an object before it was dropped continue to have the <code class="codeph">READ</code> or <code class="codeph">SELECT</code> privilege over the object in the recycle bin. Users must have <code class="codeph">FLASHBACK</code> privilege to query any object in the recycle bin, because these are objects from a past state of the database.
                           </p>
                        </li>
                     </ul>
                     <p>Objects must meet the following prerequisites to be eligible for retrieval from the recycle bin:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The recycle bin is only available for non-system, locally managed tablespaces. If a table is in a non-system, locally managed tablespace, but one or more of its dependent segments (objects) is in a dictionary-managed tablespace, then these objects are protected by the recycle bin.</p>
                        </li>
                        <li>
                           <p>Tables that have fine-grained auditing (FGA) and Virtual Private Database (VPD) policies defined over them are not protected by the recycle bin. </p>
                        </li>
                        <li>
                           <p>Partitioned index-organized tables are not protected by the recycle bin.</p>
                        </li>
                        <li>
                           <p>The table must not have been purged, either by a user or by Oracle Database during a space reclamation operation.</p>
                        </li>
                     </ul>
                  </div>
               </div><a id="BRADV342"></a><a id="BRADV89748"></a><div class="props_rev_3"><a id="GUID-6AED5A17-B29C-4F92-80C0-49F06A62DE4F" name="GUID-6AED5A17-B29C-4F92-80C0-49F06A62DE4F"></a><h4 id="BRADV-GUID-6AED5A17-B29C-4F92-80C0-49F06A62DE4F" class="sect4"><span class="enumeration_section">18.3.3 </span>Performing a Flashback Drop Operation
                  </h4>
                  <div>
                     <p>Use the <code class="codeph">FLASHBACK TABLE ... TO BEFORE DROP</code> statement to recover objects from the recycle bin. You can specify either the name of the table in the recycle bin or the original table name.
                     </p>
                     <div class="section">
                        <p>This section assumes a scenario in which you drop the wrong table. Many times you have been asked to drop tables in the test databases, but in this case you accidentally connect to the production database instead and drop <code class="codeph">hr.employee_demo</code>. You decide to use <code class="codeph">FLASHBACK TABLE</code> to retrieve the dropped object.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-6AED5A17-B29C-4F92-80C0-49F06A62DE4F__GUID-91AF9D54-7139-4D29-A47F-2B0CEE6F1954">To retrieve a dropped table:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Ensure that the prerequisites described in <span class="q">"<a href="rman-performing-flashback-dbpitr.html#GUID-F5B66BE0-4941-4513-821B-74F7ACB6489E" title="Prerequisites must be met before you perform a Flashback Drop operation.">Prerequisites of Flashback Drop</a>"</span> are met.</span></li>
                        <li class="stepexpand"><span>Connect SQL*Plus to the target database and obtain the name of the dropped table in the recycle bin.</span><div>
                              <p>You can use the SQL*Plus command <code class="codeph">SHOW RECYCLEBIN</code> as follows:
                              </p><pre class="oac_no_warn" dir="ltr">SHOW RECYCLEBIN;

ORIGINAL NAME    RECYCLEBIN NAME                   TYPE         DROP TIME
---------------- --------------------------------- ------------ -------------
EMPLOYEE_DEMO    BIN$gk3lsj/3akk5hg3j2lkl5j3d==$0  TABLE    2013-04-11:17:08:54
</pre><p>The <code class="codeph">ORIGINAL NAME</code> column shows the original name of the object, whereas the <code class="codeph">RECYCLEBIN NAME</code> column shows the name of the object as it exists in the bin.
                              </p>
                              <p>Alternatively, you can query <code class="codeph">USER_RECYCLEBIN</code> or <code class="codeph">DBA_RECYCLEBIN</code> to obtain the table name. The following example queries the <code class="codeph">RECYCLEBIN</code> view to determine the original names of dropped objects:
                              </p><pre class="oac_no_warn" dir="ltr">SELECT object_name AS recycle_name, original_name, type 
FROM   recyclebin;

RECYCLE_NAME                      ORIGINAL_NAME          TYPE
--------------------------------  ---------------------  ----------
BIN$gk3lsj/3akk5hg3j2lkl5j3d==$0  EMPLOYEE_DEMO          TABLE
BIN$JKS983293M1dsab4gsz/I249==$0  I_EMP_DEMO             INDEX
</pre><p>If you plan to manually restore original names for dependent objects, then ensure that you make note of each dependent object's system-generated recycle bin name before you restore the table.</p>
                              <div class="infoboxnote" id="GUID-6AED5A17-B29C-4F92-80C0-49F06A62DE4F__GUID-0D3C2A73-76B9-410C-8654-0055FA9D0511">
                                 <p class="notep1">Note:</p>
                                 <p>Object views such as <code class="codeph">DBA_TABLES</code> do not display the recycle bin objects.
                                 </p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Optionally, query the table in the recycle bin.</span><div>
                              <p>You must use the recycle bin name of the object in your query rather than the object's original name. The following example queries the table with the recycle bin name of <code class="codeph">BIN$gk3lsj/3akk5hg3j2lkl5j3d==$0</code>: 
                              </p><pre class="oac_no_warn" dir="ltr">SELECT * 
FROM  "BIN$gk3lsj/3akk5hg3j2lkl5j3d==$0";
</pre><p>Quotation marks are required because of the special characters in the recycle bin name. </p>
                              <div class="infoboxnote" id="GUID-6AED5A17-B29C-4F92-80C0-49F06A62DE4F__GUID-F65AC0E0-BB55-49FA-B1DA-4BACCA92084C">
                                 <p class="notep1">Note:</p>
                                 <p>If you have the necessary privileges, then you can also use Flashback Query on tables in the recycle bin, but only by using the recycle bin name rather than the original table name. You cannot use Data Manipulation Language (DML) or DDL statements on objects in the recycle bin.</p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Retrieve the dropped table.</span><div>
                              <p>Use the <code class="codeph">FLASHBACK TABLE ... TO BEFORE DROP</code> statement. The following example restores the <code class="codeph">BIN$gk3lsj/3akk5hg3j2lkl5j3d==$0</code> table, changes its name back to <code class="codeph">hr.employee_demo</code>, and purges its entry from the recycle bin:
                              </p><pre class="oac_no_warn" dir="ltr">FLASHBACK TABLE "BIN$gk3lsj/3akk5hg3j2lkl5j3d==$0" TO BEFORE DROP;
</pre><p>The table name is enclosed in quotation marks because of the possibility of special characters appearing in the recycle bin object names.</p>
                              <p>Alternatively, you can use the original name of the table:</p><pre class="oac_no_warn" dir="ltr">FLASHBACK TABLE HR.EMPLOYEE_DEMO TO BEFORE DROP;
</pre><p>You can also assign a new name to the restored table by specifying the <code class="codeph">RENAME TO</code> clause. For example:
                              </p><pre class="oac_no_warn" dir="ltr">FLASHBACK TABLE "BIN$gk3lsj/3akk5hg3j2lkl5j3d==$0" TO BEFORE DROP 
  RENAME TO hr.emp_demo;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Optionally, verify that all dependent objects retained their system-generated recycle bin names.</span><div>
                              <p>The following query determines the names of the indexes of the retrieved <code class="codeph">hr.employee_demo</code> table:
                              </p><pre class="oac_no_warn" dir="ltr">SELECT INDEX_NAME 
FROM   USER_INDEXES 
WHERE  TABLE_NAME = 'EMPLOYEE_DEMO';

INDEX_NAME
------------------------------
BIN$JKS983293M1dsab4gsz/I249==$0
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Optionally, rename the retrieved indexes to their original names.</span><div>
                              <p>The following statement renames the index to its original name of <code class="codeph">i_emp_demo</code>:
                              </p><pre class="oac_no_warn" dir="ltr">ALTER INDEX "BIN$JKS983293M1dsab4gsz/I249==$0" RENAME TO I_EMP_DEMO;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>If the retrieved table had referential constraints before it was placed in the recycle bin, then re-create them.</span><div>
                              <p>This step must be performed manually because the recycle bin does not preserve referential constraints on a table.</p>
                           </div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-6AED5A17-B29C-4F92-80C0-49F06A62DE4F__GUID-FA2CD6BF-F83C-4CEC-80E6-57FCEA964621">
                           <p class="notep1">See Also:</p>
                           <p><a href="rman-performing-flashback-dbpitr.html#GUID-C4927875-8F00-4AC7-8DDE-A56C3EEFE8AE" title="You can create, and then drop, several objects with the same original name. All dropped objects are stored in the recycle bin.">Retrieving Objects Using Flashback Drop When Multiple Objects Share the Same Original Name</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div><a id="BRADV343"></a><a id="BRADV344"></a><a id="BRADV89749"></a><div class="props_rev_3"><a id="GUID-C4927875-8F00-4AC7-8DDE-A56C3EEFE8AE" name="GUID-C4927875-8F00-4AC7-8DDE-A56C3EEFE8AE"></a><h5 id="BRADV-GUID-C4927875-8F00-4AC7-8DDE-A56C3EEFE8AE" class="sect5"><span class="enumeration_section">18.3.3.1 </span>Retrieving Objects Using Flashback Drop When Multiple Objects Share the Same Original Name
                     </h5>
                     <div>
                        <p>You can create, and then drop, several objects with the same original name. All dropped objects are stored in the recycle bin.</p>
                        <div class="section">
                           <p>For example, consider the SQL statements in the following example:</p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-C4927875-8F00-4AC7-8DDE-A56C3EEFE8AE__CHDHFEHA">
                           <p class="titleinexample">Example 18-1 Dropping Multiple Objects with the Same Name</p><pre class="oac_no_warn" dir="ltr">CREATE TABLE temp_employees ( <span class="italic">...columns</span> ); # temp_employees version 1
DROP TABLE temp_employees;

CREATE TABLE temp_employees ( <span class="italic">...columns</span> ); # temp_employees version 2
DROP TABLE temp_employees;

CREATE TABLE temp_employees ( <span class="italic">...columns</span> ); # temp_employees version 3
DROP TABLE temp_employees;
</pre><p>Each table <code class="codeph">temp_employees</code> is assigned a unique name in the recycle bin when it is dropped. You can use a <code class="codeph">FLASHBACK TABLE ... TO BEFORE DROP</code> statement with the original name of the table, as shown in this example:
                           </p><pre class="oac_no_warn" dir="ltr">FLASHBACK TABLE temp_employees TO BEFORE DROP;
</pre><p>The most recently dropped table with this original name is retrieved from the recycle bin, with its original name.</p>
                           <p>The following example shows the retrieval from the recycle bin of all three dropped <code class="codeph">temp_employees</code> tables from the previous example, with each assigned a new name.
                           </p>
                        </div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-C4927875-8F00-4AC7-8DDE-A56C3EEFE8AE__CHDHFEBA">
                           <p class="titleinexample">Example 18-2 Renaming Dropped Tables</p><pre class="oac_no_warn" dir="ltr">FLASHBACK TABLE temp_employees TO BEFORE DROP 
  RENAME TO temp_employees_VERSION_3;
FLASHBACK TABLE temp_employees TO BEFORE DROP 
  RENAME TO temp_employees_VERSION_2;
FLASHBACK TABLE temp_employees TO BEFORE DROP 
  RENAME TO temp_employees_VERSION_1;
</pre><p>Because the original name in <code class="codeph">FLASHBACK</code> <code class="codeph">TABLE</code> refers to the most recently dropped table with this name, the last table dropped is the first retrieved.
                           </p>
                           <p>You can also retrieve any table from the recycle bin, regardless of any collisions among original names, by using the unique recycle bin name of the table. For example, assume that you query the recycle bin as follows (sample output included):</p><pre class="oac_no_warn" dir="ltr">SELECT object_name, original_name, createtime 
FROM   recyclebin;    

OBJECT_NAME                    ORIGINAL_NAME   CREATETIME
------------------------------ --------------- -------------------
BIN$yrMKlZaLMhfgNAgAIMenRA==$0 TEMP_EMPLOYEES  2013-02-05:21:05:52
BIN$yrMKlZaVMhfgNAgAIMenRA==$0 TEMP_EMPLOYEES  2013-02-05:21:25:13
BIN$yrMKlZaQMhfgNAgAIMenRA==$0 TEMP_EMPLOYEES  2013-02-05:22:05:53
</pre><p>You can use the following command to retrieve the middle table:</p><pre class="oac_no_warn" dir="ltr">FLASHBACK TABLE BIN$yrMKlZaVMhfgNAgAIMenRA==$0 TO BEFORE DROP;</pre></div>
                        <!-- class="example" -->
                        <div class="section">
                           <div class="infoboxnotealso" id="GUID-C4927875-8F00-4AC7-8DDE-A56C3EEFE8AE__GUID-2A284595-F74F-4908-80B5-F074EB8268DB">
                              <p class="notep1">See Also:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><a href="../admin/managing-tables.html#ADMIN01511" target="_blank"><span><cite>Oracle Database Administrator’s Guide</cite></span></a> to learn how to use Flashback Drop and manage the recycle bin
                                    </p>
                                 </li>
                                 <li>
                                    <p><a href="../sqlrf/FLASHBACK-TABLE.html#SQLRF01802" target="_blank"><span><cite>Oracle Database SQL Language Reference</cite></span></a> for information about the <code class="codeph">FLASHBACK TABLE</code> statement
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div><a id="BRADV81330"></a><div class="props_rev_3"><a id="GUID-953FA30D-BED2-4DBA-8361-9DA1B8FF073F" name="GUID-953FA30D-BED2-4DBA-8361-9DA1B8FF073F"></a><h3 id="BRADV-GUID-953FA30D-BED2-4DBA-8361-9DA1B8FF073F" class="sect3"><span class="enumeration_section">18.4 </span>Rewinding a Database with Flashback Database
               </h3>
               <div>
                  <p>Flashback Database reverses unwanted changes by returning your database to its state at a previous point in time.</p>
                  <p>This section contains the following topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="rman-performing-flashback-dbpitr.html#GUID-6520BA73-8BFF-4D79-9970-589A2FDA0C82" title="Flashback Database works by undoing changes to the data files that exist at the moment that you run the command. Prerequisites must be met to perform a Flashback Database operation.">Prerequisites of Flashback Database</a></p>
                     </li>
                     <li>
                        <p><a href="rman-performing-flashback-dbpitr.html#GUID-3EB4D790-77C7-49CB-8D96-0940394E6BC8" title="A Flashback Database operation uses the FLASHBACK DATABASE command to rewind the database to a past point in time.">Performing a Flashback Database Operation</a></p>
                     </li>
                     <li>
                        <p><a href="rman-performing-flashback-dbpitr.html#GUID-8466CA3C-652A-4AAB-88EB-8815575D6266" title="You can perform a flashback database operation for a whole multitenant container database (CDB) using the FLASHBACK DATABASE command.">Performing a Flashback Database Operation for a Whole CDB</a></p>
                     </li>
                     <li>
                        <p><a href="rman-performing-flashback-dbpitr.html#GUID-C1215E86-9A7B-4EC9-9777-2A18BD627394" title="You can perform a flashback database operation for a single pluggable database (PDB) in a multitenant container database (CDB) using the FLASHBACK DATABASE command.">Performing a Flashback Database Operation for PDBs</a></p>
                     </li>
                     <li>
                        <p><a href="rman-performing-flashback-dbpitr.html#GUID-93BF7DBC-2520-4C7D-B059-663F963B68DA" title="Data dictionary views contain information that is used to monitor flashback database.">Monitoring Flashback Database</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89751"></a><div class="props_rev_3"><a id="GUID-6520BA73-8BFF-4D79-9970-589A2FDA0C82" name="GUID-6520BA73-8BFF-4D79-9970-589A2FDA0C82"></a><h4 id="BRADV-GUID-6520BA73-8BFF-4D79-9970-589A2FDA0C82" class="sect4"><span class="enumeration_section">18.4.1 </span>Prerequisites of Flashback Database
                  </h4>
                  <div>
                     <p>Flashback Database works by undoing changes to the data files that exist at the moment that you run the command. Prerequisites must be met to perform a Flashback Database operation.</p>
                     <p>To use the <code class="codeph">FLASHBACK DATABASE</code> command to return your database contents to points in time within the flashback window, your database must have been previously configured for flashback logging. To return the database to a guaranteed restore point, you must have previously defined a guaranteed restore point.
                     </p>
                     <p>Note the following important prerequisites:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>No current data files are lost or damaged. You can only use <code class="codeph">FLASHBACK DATABASE</code> to rewind changes to a data file made by an Oracle database, not to repair media failures.
                           </p>
                        </li>
                        <li>
                           <p>You are not trying to recover from accidental deletion of data files, undo a shrink data file operation, or undo a change to the database name.</p>
                        </li>
                        <li>
                           <p>You are not trying to use <code class="codeph">FLASHBACK DATABASE</code> to return to a point in time before the restore or re-creation of a control file. If the database control file is restored from backup or re-created, then all accumulated flashback log information is discarded. 
                           </p>
                        </li>
                        <li>
                           <p>You are not trying to use <code class="codeph">FLASHBACK DATABASE</code> to undo a compatibility change.
                           </p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-6520BA73-8BFF-4D79-9970-589A2FDA0C82__GUID-880F43E7-D0BE-4E33-9F13-9E50CEF4426A">
                        <p class="notep1">See Also:</p>
                        <div class="p"> 
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="q">"<a href="using-flasback-database-restore-points.html#GUID-FAA04D1F-36E2-4B20-954F-845E42386775" title="Oracle Flashback Database and restore points are related data protection features that enable you to rewind data back in time to correct any problems caused by logical data corruption or user errors within a designated time window.">Overview of Flashback Database, Restore Points and Guaranteed Restore Points</a>"</span></p>
                              </li>
                              <li>
                                 <p><span class="q">"<a href="using-flasback-database-restore-points.html#GUID-2C846D84-EDCC-4FAA-9F6A-05CD0C6C7C09" title="You can create, monitor, and drop both normal and guaranteed restore points.">Using Normal and Guaranteed Restore Points</a>"</span></p>
                              </li>
                              <li>
                                 <p><a href="../rcmrf/FLASHBACK-DATABASE.html#RCMRF194" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> for a complete list of command prerequisites and usage notes for <code class="codeph">FLASHBACK DATABASE</code></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
               </div><a id="BRADV345"></a><a id="BRADV89752"></a><div class="props_rev_3"><a id="GUID-3EB4D790-77C7-49CB-8D96-0940394E6BC8" name="GUID-3EB4D790-77C7-49CB-8D96-0940394E6BC8"></a><h4 id="BRADV-GUID-3EB4D790-77C7-49CB-8D96-0940394E6BC8" class="sect4"><span class="enumeration_section">18.4.2 </span>Performing a Flashback Database Operation
                  </h4>
                  <div>
                     <p>A Flashback Database operation uses the <code class="codeph">FLASHBACK DATABASE</code> command to rewind the database to a past point in time.
                     </p>
                     <div class="section">
                        <p>This topic presents a basic technique for performing a flashback of the database, specifying the desired target point in time with a time expression, the name of a normal or guaranteed restore point, or an SCN. It makes the following assumptions:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>You are rewinding the database to a point in time within the current database <a href="glossary.html#GUID-4CCAB7DD-FEA7-4237-AF2C-304BA3BD52B1"><span class="xrefglossterm">incarnation</span></a>.
                              </p>
                           </li>
                           <li>
                              <p>The SCN used in the <code class="codeph">FLASHBACK DATABASE</code> command refers to an SCN in the <a href="glossary.html#GUID-9FA6E4CA-C9C0-47E8-8FDF-2C2A313F8944"><span class="xrefglossterm">direct ancestral path</span></a> of the database incarnations. An incarnation is in this path if it was not abandoned after the database was previously opened with the <code class="codeph">RESETLOGS</code> option.
                              </p>
                           </li>
                        </ul>
                        <p><span class="bold">To perform a Flashback Database operation:</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Ensure that the prerequisites described in <span class="q">"<a href="rman-performing-flashback-dbpitr.html#GUID-6520BA73-8BFF-4D79-9970-589A2FDA0C82" title="Flashback Database works by undoing changes to the data files that exist at the moment that you run the command. Prerequisites must be met to perform a Flashback Database operation.">Prerequisites of Flashback Database</a>"</span> are met.</span></li>
                        <li class="stepexpand"><span>Connect SQL*Plus to the target database and determine the desired SCN, restore point, or point in time for the <code class="codeph">FLASHBACK DATABASE</code> command.</span><div>
                              <p>Obtain the earliest SCN in the flashback database window as follows:</p><pre class="oac_no_warn" dir="ltr">SELECT OLDEST_FLASHBACK_SCN, OLDEST_FLASHBACK_TIME
FROM   V$FLASHBACK_DATABASE_LOG;
</pre><p>The most recent SCN that can be reached with Flashback Database is the current SCN of the database. The following query returns the current SCN:</p><pre class="oac_no_warn" dir="ltr">SELECT CURRENT_SCN FROM V$DATABASE;
</pre><p>You can query available guaranteed restore points as follows (sample output included):</p><pre class="oac_no_warn" dir="ltr">SELECT NAME, SCN, TIME, DATABASE_INCARNATION#,
       GUARANTEE_FLASHBACK_DATABASE
FROM   V$RESTORE_POINT
WHERE  GUARANTEE_FLASHBACK_DATABASE='YES';
 
NAME                   SCN TIME                  DATABASE_INCARNATION# GUA
--------------- ---------- --------------------- --------------------- ---
BEFORE_CHANGES     5753126 04-MAR-12 12.39.45 AM                     2 YES</pre><div class="infoboxnote" id="GUID-3EB4D790-77C7-49CB-8D96-0940394E6BC8__GUID-53270E0A-7FA0-4E47-B7F1-C623688E40C6">
                                 <p class="notep1">Note:</p>
                                 <p>If the flashback window does not extend far enough back into the past to reach the desired target time, and if you do not have a guaranteed restore point at the desired time, then you can achieve similar results by using database point-in-time recovery, as described in <span class="q">"<a href="rman-performing-flashback-dbpitr.html#GUID-7D3EE2F7-77A2-4264-8875-CC0AEC64ABE0" title="RMAN DBPITR restores the database from backups before the target time for recovery, then uses incremental backups and redo to roll the database forward to the target time. You can recover to an SCN, time, log sequence number, or restore point. Oracle recommends that you create restore points at important times to make point-in-time recovery more manageable if it ever becomes necessary.">Performing Database Point-in-Time Recovery</a>"</span>.
                                 </p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Shut down the database consistently, ensure that it is not opened by any instance, and then mount it:</span><div><pre class="oac_no_warn" dir="ltr">SHUTDOWN IMMEDIATE;
STARTUP MOUNT;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Repeat the query in Step 2 of this procedure.</span><div>
                              <p>Some flashback logging data is generated when the database is shut down. If flashback logs were deleted due to space pressure in the fast recovery area, then your target SCN may not be reachable.</p>
                              <div class="infoboxnote" id="GUID-3EB4D790-77C7-49CB-8D96-0940394E6BC8__GUID-E7475A65-085D-4DA5-AC8C-FB3054E15F49">
                                 <p class="notep1">Note:</p>
                                 <p>If you run <code class="codeph">FLASHBACK</code> <code class="codeph">DATABASE</code> when your target SCN is outside the flashback window, then <code class="codeph">FLASHBACK</code> <code class="codeph">DATABASE</code> fails with an <code class="codeph">ORA-38729</code> error. In this case your database does not change.   
                                 </p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Start RMAN and connect to the target database, as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>.</span></li>
                        <li class="stepexpand"><span>Run the <code class="codeph">SHOW</code> command to see which channels are preconfigured.</span><div>
                              <p>During the flashback operation, RMAN may need to restore archived redo logs from backup. Enter the following command to see whether channels are configured (sample output is included):</p><pre class="oac_no_warn" dir="ltr">SHOW ALL;

RMAN configuration parameters for database with db_unique_name PROD1 are:
.
.
.
CONFIGURE DEFAULT DEVICE TYPE TO DISK; # default
CONFIGURE DEVICE TYPE DISK PARALLELISM 1 BACKUP TYPE TO BACKUPSET; # default
CONFIGURE DEVICE TYPE SBT_TAPE PARALLELISM 1 BACKUP TYPE TO BACKUPSET; # default
CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE' PARMS  "SBT_LIBRARY=/usr/local/oracle/backup/lib/libobk.so";
</pre><p>If the necessary devices and channels are configured, then no action is necessary. Otherwise, use the <code class="codeph">CONFIGURE</code> command to configure automatic channels, or include <code class="codeph">ALLOCATE CHANNEL</code> commands within a <code class="codeph">RUN</code> block.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Run the RMAN <code class="codeph">FLASHBACK DATABASE</code> command.</span><div>
                              <p>You can specify the target time by using a form of the command shown in the following examples:</p><pre class="oac_no_warn" dir="ltr">FLASHBACK DATABASE TO SCN 46963;

FLASHBACK DATABASE 
  TO RESTORE POINT BEFORE_CHANGES;

FLASHBACK DATABASE TO TIME   
  "TO_DATE('09/20/12','MM/DD/YY')";
</pre><p>When the <code class="codeph">FLASHBACK DATABASE</code> command completes, the database is left mounted and recovered to the specified target time.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Open the database read-only in SQL*Plus and run some queries to verify the database contents.</span><div>
                              <p>Open the database read-only as follows:</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN READ ONLY;
</pre><p>If you are satisfied with the state of the database, then end the procedure with Step <a href="rman-performing-flashback-dbpitr.html#GUID-3EB4D790-77C7-49CB-8D96-0940394E6BC8__CHDGDJAC">9</a>. If you are <span class="italic">not</span> satisfied with the state of the database, skip to Step <a href="rman-performing-flashback-dbpitr.html#GUID-3EB4D790-77C7-49CB-8D96-0940394E6BC8__CHDHCDBD">10</a>.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand" id="GUID-3EB4D790-77C7-49CB-8D96-0940394E6BC8__CHDGDJAC"><span>If you are satisfied with the results, then perform either of the following mutually exclusive actions:</span><div>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>Make the database available for updates by opening the database with the <code class="codeph">RESETLOGS</code> option. If the database is currently open read-only, then execute the following commands in SQL*Plus:
                                    </p><pre class="oac_no_warn" dir="ltr">SHUTDOWN IMMEDIATE
STARTUP MOUNT
ALTER DATABASE OPEN RESETLOGS;</pre><div class="infoboxnote" id="GUID-3EB4D790-77C7-49CB-8D96-0940394E6BC8__GUID-FF820FDC-E2BB-4A02-A447-7B5FD1D6CE59">
                                       <p class="notep1">Note:</p>
                                       <p>After you perform this <code class="codeph">OPEN</code> <code class="codeph">RESETLOGS</code> operation, all changes to the database after the target SCN for <code class="codeph">FLASHBACK DATABASE</code> are abandoned. Nevertheless, you can use the technique in <span class="q">"<a href="rman-performing-flashback-dbpitr.html#GUID-CECE183D-C000-485A-99DA-371768A79011" title="You can use Flashback Database to rewind a database to an abandoned database incarnation.">Rewinding the Database to an SCN in an Abandoned Incarnation Branch</a>"</span> to return the database to that range of SCNs while they remain in the flashback window.
                                       </p>
                                    </div>
                                 </li>
                                 <li>
                                    <p>Use Oracle Data Pump Export to make a logical backup of the objects whose state was corrupted. Afterward, use RMAN to recover the database to the present time:</p><pre class="oac_no_warn" dir="ltr">RECOVER DATABASE;
</pre><p>This step undoes the effect of the Flashback Database by reapplying all changes in the redo logs to the database, returning it to the most recent SCN. </p>
                                    <p>After reopening the database read/write, you can import the exported objects with the Data Pump Import utility. See <a href="../sutil/oracle-data-pump-overview.html#SUTIL100" target="_blank"><span><cite>Oracle Database Utilities</cite></span></a> to learn how to use Data Pump.
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand" id="GUID-3EB4D790-77C7-49CB-8D96-0940394E6BC8__CHDHCDBD"><span>If you find that you used the wrong restore point, time, or SCN for the flashback, then mount the database and perform one of the following mutually exclusive options:</span><div>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>If your chosen target time was not far enough in the past, then use another <code class="codeph">FLASHBACK DATABASE</code> command to rewind the database further back in time:
                                    </p><pre class="oac_no_warn" dir="ltr">FLASHBACK DATABASE TO SCN 42963;  #earlier than current SCN 
</pre></li>
                              </ul>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>If you chose a target SCN that is too far in the past, then use <code class="codeph">RECOVER DATABASE UNTIL</code> to wind the database forward in time to the desired SCN:
                                    </p><pre class="oac_no_warn" dir="ltr">RECOVER DATABASE UNTIL SCN 56963; #later than current SCN 
</pre></li>
                              </ul>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>If you want to completely undo the effect of the <code class="codeph">FLASHBACK DATABASE</code> command, then you can perform complete recovery of the database by using the <code class="codeph">RECOVER DATABASE</code> command without an <code class="codeph">UNTIL</code> clause or <code class="codeph">SET UNTIL</code> command:
                                    </p><pre class="oac_no_warn" dir="ltr">RECOVER DATABASE;
</pre><p>The <code class="codeph">RECOVER DATABASE</code> command reapplies all changes to the database, returning it to the most recent SCN.
                                    </p>
                                 </li>
                              </ul>
                              <div class="infoboxnotealso" id="GUID-3EB4D790-77C7-49CB-8D96-0940394E6BC8__GUID-B83615BC-8DB6-4622-A4EB-B91241B6E324">
                                 <p class="notep1">See Also:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p><span class="q">"<a href="rman-performing-flashback-dbpitr.html#GUID-7E39909E-E2D5-4D08-ADD8-0D5FEF028489" title="Flashback Database can be used to undo an OPEN RESETLOGS operation.">Rewinding an OPEN RESETLOGS Operation with Flashback Database</a>"</span> to return the database to the point in time immediately before the most recent <code class="codeph">OPEN RESETLOGS</code> operation 
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="q">"<a href="rman-performing-flashback-dbpitr.html#GUID-CECE183D-C000-485A-99DA-371768A79011" title="You can use Flashback Database to rewind a database to an abandoned database incarnation.">Rewinding the Database to an SCN in an Abandoned Incarnation Branch</a>"</span> to retrieve changes in abandoned incarnations
                                       </p>
                                    </li>
                                 </ul>
                              </div>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-8466CA3C-652A-4AAB-88EB-8815575D6266" name="GUID-8466CA3C-652A-4AAB-88EB-8815575D6266"></a><h4 id="BRADV-GUID-8466CA3C-652A-4AAB-88EB-8815575D6266" class="sect4"><span class="enumeration_section">18.4.3 </span>Performing a Flashback Database Operation for a Whole CDB
                  </h4>
                  <div>
                     <p>You can perform a flashback database operation for a whole multitenant container database (CDB) using the <code class="codeph">FLASHBACK DATABASE</code> command.
                     </p>
                     <div class="section">
                        <p>When the <code class="codeph">COMPATIBLE</code> initialization parameter is set to 12.1.0, in rare cases, performing a flashback database operation on a CDB across PDB (pluggable database) point-in-time recovery (PITR) or PDB flashback may result in the following error:
                        </p>
                        <p> <code class="codeph">ORA-39866: Data files for Pluggable Database &lt;PDB_name&gt; must be offline to flashback across special 12.1 PDB resetlogs</code></p>
                        <p>To resolve this error and perform a flashback operation on a CDB across PDB PITR or PDB flashback, use the steps described in “Performing Flashback Database Operations on a CDB When a PDB Was Recovered Using DBPITR” in the <span class="italic">Oracle Database Backup and Recovery User’s Guide 12c Release 1 (12.1)</span>.
                        </p>
                        <p>The steps to perform a Flashback Database operation for a CDB are similar to the ones used for non-CDBs, with the differences described in this topic.</p>
                        <p><span class="bold">To perform a flashback database operation for a whole CDB:</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Ensure that the prerequisites described in <span class="q">"<a href="rman-performing-flashback-dbpitr.html#GUID-6520BA73-8BFF-4D79-9970-589A2FDA0C82" title="Flashback Database works by undoing changes to the data files that exist at the moment that you run the command. Prerequisites must be met to perform a Flashback Database operation.">Prerequisites of Flashback Database</a>"</span> are met.</span></li>
                        <li class="stepexpand"><span>Connect SQL*Plus to the target CDB and determine the desired SCN, restore point, or point in time for the <code class="codeph">FLASHBACK DATABASE</code> command.</span><div>
                              <p>Obtain the earliest SCN in the flashback database window as follows:</p><pre class="oac_no_warn" dir="ltr">SELECT OLDEST_FLASHBACK_SCN, OLDEST_FLASHBACK_TIME
FROM   V$FLASHBACK_DATABASE_LOG;
</pre><p>The most recent SCN that can be reached with Flashback Database is the current SCN of the database. The following query returns the current SCN:</p><pre class="oac_no_warn" dir="ltr">SELECT CURRENT_SCN
FROM   V$DATABASE;
</pre><p>You can query available guaranteed restore points as follows (sample output included):</p><pre class="oac_no_warn" dir="ltr">SELECT NAME, SCN, TIME, DATABASE_INCARNATION#,
       GUARANTEE_FLASHBACK_DATABASE
FROM   V$RESTORE_POINT
WHERE  GUARANTEE_FLASHBACK_DATABASE='YES';
 
NAME                   SCN TIME                  DATABASE_INCARNATION# GUA
--------------- ---------- --------------------- --------------------- ---
BEFORE_CHANGES     5753126 04-MAR-12 12.39.45 AM                     2 YES</pre><div class="infoboxnote" id="GUID-8466CA3C-652A-4AAB-88EB-8815575D6266__GUID-764B6D6C-710F-45CE-89E4-A834AF142E23">
                                 <p class="notep1">Note:</p>
                                 <p>If the flashback window does not extend far enough back into the past to reach the desired target time, and if you do not have a guaranteed restore point at the desired time, then you can achieve similar results by using database point-in-time recovery, as described in <span class="q">"<a href="rman-performing-flashback-dbpitr.html#GUID-7572C8E9-05B8-4BCC-823F-BD6763C51B11" title="Use the RESTORE and RECOVER commands to perform point-in-time recovery for a whole CDB.">Performing Point-in-Time Recovery of a Whole CDB</a>"</span>.
                                 </p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Shut down the database consistently, ensure that it is not opened by any instance, and then mount it:</span><div><pre class="oac_no_warn" dir="ltr">SHUTDOWN IMMEDIATE;
STARTUP MOUNT;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Repeat the query in Step 2 of this procedure.</span><div>
                              <p>Some flashback logging data is generated when the database is shut down. If flashback logs were deleted due to space pressure in the fast recovery area, then your target SCN may not be reachable.</p>
                              <div class="infoboxnote" id="GUID-8466CA3C-652A-4AAB-88EB-8815575D6266__IFYOURUNFLASHBACKDATABASEWHENYOURTA-BFA04DC4">
                                 <p class="notep1">Note:</p>
                                 <p>If you run <code class="codeph">FLASHBACK DATABASE</code> when your target SCN is outside the flashback window, then <code class="codeph">FLASHBACK DATABASE</code> fails with an <code class="codeph">ORA-38729</code> error. In this case, your database does not change.   
                                 </p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Connect to the root as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege, as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>.</span></li>
                        <li class="stepexpand"><span>To see which channels are preconfigured, run the <code class="codeph">SHOW</code> command .</span><div>
                              <p>During the flashback operation, RMAN may need to restore archived redo logs from backup. To see whether channels are configured, enter the following command (sample output is included):</p><pre class="oac_no_warn" dir="ltr">SHOW ALL;
</pre><p>If the necessary devices and channels are configured, then no action is necessary. Otherwise, use the <code class="codeph">CONFIGURE</code> command to configure automatic channels, or include <code class="codeph">ALLOCATE CHANNEL</code> commands within a <code class="codeph">RUN</code> block.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Run the <code class="codeph">FLASHBACK DATABASE</code> command to perform a flashback operation for the whole CDB to a specified point in time.</span><div>
                              <p>You can specify the target time by using an SCN, a time expression, or a <a href="glossary.html#GUID-6BFC6E77-175D-4055-8198-6091D47AD8F6"><span class="xrefglossterm">CDB restore point</span></a>.
                              </p>
                              <p>The following examples perform a flashback database operation for the whole CDB:</p><pre class="pre codeblock"><code>FLASHBACK DATABASE TO SCN 345588;
FLASHBACK DATABASE TO RESTORE POINT cdb_before_upgrade;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Open the CDB read-only in SQL*Plus and run some queries to verify the database contents.</span><div>
                              <p>Open the CDB read-only as follows:</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN READ ONLY;
</pre><p>If you are satisfied with the state of the database, then end the procedure with Step <a href="rman-performing-flashback-dbpitr.html#GUID-3EB4D790-77C7-49CB-8D96-0940394E6BC8__CHDGDJAC">9</a>. If you are <span class="italic">not</span> satisfied with the state of the database, skip to Step <a href="rman-performing-flashback-dbpitr.html#GUID-3EB4D790-77C7-49CB-8D96-0940394E6BC8__CHDHCDBD">10</a>.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand" id="GUID-8466CA3C-652A-4AAB-88EB-8815575D6266__CHDGDJAC"><span>If you are satisfied with the results, then perform either of the following mutually exclusive actions:</span><div>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>Make the database available for updates by opening the database with the <code class="codeph">RESETLOGS</code> option. If the database is open read-only, then execute the following commands in SQL*Plus:
                                    </p><pre class="oac_no_warn" dir="ltr">SHUTDOWN IMMEDIATE
STARTUP MOUNT
ALTER DATABASE OPEN RESETLOGS;</pre><div class="infoboxnote" id="GUID-8466CA3C-652A-4AAB-88EB-8815575D6266__GUID-FF820FDC-E2BB-4A02-A447-7B5FD1D6CE59">
                                       <p class="notep1">Note:</p>
                                       <p>After you perform this <code class="codeph">OPEN RESETLOGS</code> operation, all changes to the database after the target SCN for <code class="codeph">FLASHBACK DATABASE</code> are abandoned. Nevertheless, you can use the technique in <span class="q">"<a href="rman-performing-flashback-dbpitr.html#GUID-CECE183D-C000-485A-99DA-371768A79011" title="You can use Flashback Database to rewind a database to an abandoned database incarnation.">Rewinding the Database to an SCN in an Abandoned Incarnation Branch</a>"</span> to return the database to that range of SCNs while they remain in the flashback window.
                                       </p>
                                    </div>
                                 </li>
                                 <li>
                                    <p>Make a logical backup of the objects whose state was corrupted by using Oracle Data Pump Export. Afterward, use RMAN to recover the database to the present time:</p><pre class="oac_no_warn" dir="ltr">RECOVER DATABASE;
</pre><p>This step undoes the effect of the Flashback Database by reapplying all changes in the redo logs to the database, returning it to the most recent SCN. </p>
                                    <p>After reopening the database read/write, you can import the exported objects with the Data Pump Import utility. See <a href="../sutil/oracle-data-pump-overview.html#SUTIL100" target="_blank"><span class="italic">Oracle Database Utilities</span></a> to learn how to use Data Pump.
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand" id="GUID-8466CA3C-652A-4AAB-88EB-8815575D6266__CHDHCDBD"><span>If you find that you used the wrong restore point, time, or SCN for the flashback, then mount the database and perform one of the following mutually exclusive options:</span><div>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>If your chosen target time was not far enough in the past, then use another <code class="codeph">FLASHBACK DATABASE</code> command to rewind the database further back in time:
                                    </p><pre class="oac_no_warn" dir="ltr">FLASHBACK DATABASE TO SCN 42963;  #earlier than current SCN 
</pre></li>
                              </ul>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>If you chose a target SCN that is too far in the past, then use <code class="codeph">RECOVER DATABASE UNTIL</code> to wind the database forward in time to the desired SCN:
                                    </p><pre class="oac_no_warn" dir="ltr">RECOVER DATABASE UNTIL SCN 56963; #later than current SCN 
</pre></li>
                              </ul>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>If you want to completely undo the effect of the <code class="codeph">FLASHBACK DATABASE</code> command, then you can perform complete recovery of the database by using the <code class="codeph">RECOVER DATABASE</code> command without an <code class="codeph">UNTIL</code> clause or <code class="codeph">SET UNTIL</code> command:
                                    </p><pre class="oac_no_warn" dir="ltr">RECOVER DATABASE;
</pre><p>The <code class="codeph">RECOVER DATABASE</code> command reapplies all changes to the database, returning it to the most recent SCN.
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Since the <a href="glossary.html#GUID-993BFB3F-3305-481C-999D-26132095DEC9"><span class="xrefglossterm">PDB</span></a>s are not automatically opened when the CDB is opened, open the PDBs.</span><div>
                              <p>The following command, when connected to the root, opens all the PDBs:</p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE ALL OPEN;</code></pre><p>If you want to open only some PDBs, then you can open each PDB separately. The following command, when connected to the root, opens the PDB <code class="codeph">my_pdb</code>.
                              </p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE my_pdb OPEN;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-8466CA3C-652A-4AAB-88EB-8815575D6266__GUID-4842C396-C523-4D93-85C5-4BAA31B7EB4A">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="using-flasback-database-restore-points.html#GUID-434CD26D-D3DC-454B-A598-70F64D7C01EB" title="A CDB restore point serves as an alias for an SCN or a point in time in a multitenant container database (CDB). It can be a normal restore point or a guaranteed restore point.">About CDB Restore Points</a></p>
                              </li>
                              <li>
                                 <p><a href="rman-performing-flashback-dbpitr.html#GUID-50F6CEE3-3B1B-44B0-9AF4-08E1ABC137B7" title="RMAN provides methods to manage redo corruption to data blocks in a PDB.">About Managing Redo Corruption in CDBs</a></p>
                              </li>
                              <li>
                                 <p><a href="rman-performing-flashback-dbpitr.html#GUID-C1215E86-9A7B-4EC9-9777-2A18BD627394" title="You can perform a flashback database operation for a single pluggable database (PDB) in a multitenant container database (CDB) using the FLASHBACK DATABASE command.">Performing a Flashback Database Operation for PDBs</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-C1215E86-9A7B-4EC9-9777-2A18BD627394" name="GUID-C1215E86-9A7B-4EC9-9777-2A18BD627394"></a><h4 id="BRADV-GUID-C1215E86-9A7B-4EC9-9777-2A18BD627394" class="sect4"><span class="enumeration_section">18.4.4 </span>Performing a Flashback Database Operation for PDBs
                  </h4>
                  <div>
                     <p>You can perform a flashback database operation for a single pluggable database (PDB) in a multitenant container database (CDB) using the <code class="codeph">FLASHBACK DATABASE</code> command.
                     </p>
                     <div class="section">Performing a Flashback Database operation on a particular <a href="glossary.html#GUID-993BFB3F-3305-481C-999D-26132095DEC9"><span class="xrefglossterm">PDB</span></a> modifies only data files related to that PDB. The other PDBs in the <a href="glossary.html#GUID-3D253996-C2C0-449A-AFA2-85A9DA323FD3"><span class="xrefglossterm">CDB</span></a> are not impacted and are available for use.
                     </div>
                     <!-- class="section" -->
                     <div class="section">When using restore points, you can perform a flashback database operation either to a <a href="glossary.html#GUID-6BFC6E77-175D-4055-8198-6091D47AD8F6"><span class="xrefglossterm">CDB restore point</span></a>, <a href="glossary.html#GUID-7C3A47D4-B9C5-40D3-89D0-8BD77281AAB1"><span class="xrefglossterm">PDB restore point</span></a>, PDB clean restore point, or PDB guaranteed restore point.
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-C1215E86-9A7B-4EC9-9777-2A18BD627394__GUID-2D8140FA-C59E-4E98-901B-824470F3F1C9">To perform a Flashback Database operation for a PDB:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Connect to the root as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege. </span><div>
                              <p>See <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Ensure that the CDB is open.</span><div>
                              <p>The following command, when connected to the root, displays the mode in which the CDB is open.</p><pre class="pre codeblock"><code>SELECT open_mode from V$DATABASE;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Determine the desired SCN, restore point, or point in time for the Flashback Database command.</span><div>Query the <code class="codeph">V$RESTORE_POINT</code> view to obtain the list of PDB restore points. <code class="codeph">V$FLASHBACK_DATABASE_LOG</code> displays the oldest SCN to which a flashback operation can be performed. 
                           </div>
                        </li>
                        <li class="stepexpand"><span>Ensure that the PDB for which the Flashback Database operation must be performed is closed. Other PDBs can be open and operational.</span><div>
                              <p>When connected to the root, the following <code class="codeph">ALTER PLUGGABLE DATABASE</code> command closes the PDB <code class="codeph">my_pdb</code>.
                              </p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE my_pdb CLOSE;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Perform a Flashback Database operation for the specified PDB to the desired point in time.</span><div>
                              <p>The following are some examples of flashback database operations for PDBs.</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>For a PDB that uses local undo:</p><pre class="pre codeblock"><code>FLASHBACK PLUGGABLE DATABASE my_pdb TO SCN 24368;
</code></pre><pre class="pre codeblock"><code>FLASHBACK PLUGGABLE DATABASE my_pdb TO RESTORE POINT guar_rp;</code></pre><pre class="pre codeblock"><code>FLASHBACK PLUGGABLE DATABASE my_pdb TO CLEAN RESTORE POINT clean_rp;</code></pre></li>
                                 <li>
                                    <p>For a PDB that uses shared undo, you can optionally include the <code class="codeph">AUXILIARY DESTINATION</code> clause to specify a location for the auxiliary instance that stores data files restored as part of the Flashback Database operation. If you omit this clause, then the auxiliary instance is created in the fast recovery area.
                                    </p><pre class="pre codeblock"><code>FLASHBACK PLUGGABLE DATABASE my_pdb TO SCN 24368 AUXILIARY DESTINATION '+data';
</code></pre><pre class="pre codeblock"><code>FLASHBACK PLUGGABLE DATABASE my_pdb TO RESTORE POINT before_appl_changes AUXILIARY DESTINATION '/temp/aux_dest';</code></pre><pre class="pre codeblock"><code>FLASHBACK PLUGGABLE DATABASE my_pdb TO TIME "TO_DATE('03/20/15','MM/DD/YY')";</code></pre></li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Open the PDB with <code class="codeph">RESETLOGS</code>.</span><div>
                              <p>The following command opens the PDB named <code class="codeph">my_pdb</code> with <code class="codeph">RESETLOGS</code>:
                              </p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE my_pdb OPEN RESETLOGS;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <p></p>
                        <div class="infoboxnote" id="GUID-C1215E86-9A7B-4EC9-9777-2A18BD627394__GUID-6064FA25-8BE6-46F4-B162-AE351B9ADC1E">
                           <p class="notep1">Note:</p>
                           <p>Flashback operations are not supported for proxy PDBs.</p>
                        </div>
                        <div class="infoboxnote" id="GUID-C1215E86-9A7B-4EC9-9777-2A18BD627394__GUID-7C17AD02-823F-4607-A2A3-A6C7F84B6213">
                           <p class="notep1">Note:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="using-flasback-database-restore-points.html#GUID-34C48821-B29D-4A2E-94DE-CD97CFA7784E" title="You can create normal and guaranteed restore points in a pluggable database (PDB). PDB restore points are accessible only to the PDB in which they are defined.">About Restore Points in PDBs</a></p>
                              </li>
                              <li>
                                 <p><a href="using-flasback-database-restore-points.html#GUID-1A583D44-66CB-4D21-B170-2A07CFF6EE65" title="You can use the V$RESTORE_POINT control file view to obtain information about all currently-defined restore points (normal and guaranteed), including CDB restore points and PDB restore points.">Listing Restore Points Using the V$RESTORE_POINT View</a></p>
                              </li>
                              <li>
                                 <p><a href="rman-performing-flashback-dbpitr.html#GUID-66B1A12D-1C92-43B5-A204-AA8A6D177ABD" title="A multitenant container database (CDB) can use shared undo or local undo. The technique used by RMAN to perform flashback database operations depends on the type of undo configuration for the CDB.">About Undo and Flashback Database Operations for PDBs</a></p>
                              </li>
                              <li>
                                 <p><a href="rman-performing-flashback-dbpitr.html#GUID-A2146E48-16FC-40CC-B25D-902DEB93CB75" title="You can perform a Flashback Database operation for a whole multitenant container database (CDB) or for a particular pluggable database (PDB).">Basic Concepts of Performing Flashback Database for CDBs and PDBs</a></p>
                              </li>
                              <li>
                                 <p><a href="rman-performing-flashback-dbpitr.html#GUID-8466CA3C-652A-4AAB-88EB-8815575D6266" title="You can perform a flashback database operation for a whole multitenant container database (CDB) using the FLASHBACK DATABASE command.">Performing a Flashback Database Operation for a Whole CDB</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV604"></a><a id="BRADV603"></a><div class="props_rev_3"><a id="GUID-93BF7DBC-2520-4C7D-B059-663F963B68DA" name="GUID-93BF7DBC-2520-4C7D-B059-663F963B68DA"></a><h4 id="BRADV-GUID-93BF7DBC-2520-4C7D-B059-663F963B68DA" class="sect4"><span class="enumeration_section">18.4.5 </span>Monitoring Flashback Database
                  </h4>
                  <div>
                     <p>Data dictionary views contain information that is used to monitor flashback database.</p>
                     <div class="section">
                        <p>When you use Flashback Database to rewind a database to a past target time, Flashback Database determines which blocks changed after the target time and restores them from the flashback logs. This is called the <span class="bold">restore phase</span>. After this phase completes, Flashback Database then uses redo logs to reapply changes that were made after these blocks were written to the flashback logs. This is called the <span class="bold">recovery phase</span>.
                        </p>
                        <p>The progress of Flashback Database during the restore phase can be monitored by querying the <code class="codeph">V$SESSION_LONGOPS</code> view. The <code class="codeph">opname</code> is <code class="codeph">Flashback Database</code>. Under the column <code class="codeph">TOTALWORK</code> is the number of megabytes of flashback logs that must be read. The column <code class="codeph">SOFAR</code>  in the following example lists the number of megabytes that have been currently read.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-93BF7DBC-2520-4C7D-B059-663F963B68DA__CHDBEJEJ">
                        <p class="titleinexample">Example 18-3 Tracking Flashback Database Progress - Restore Phase</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT sofar, totalwork, units FROM v$session_longops WHERE opname = 'Flashback Database';
 
SOFAR  TOTALWORK  UNITS
-----  ---------- --------------------------------
   17          60 Megabytes
</pre><p>The progress of Flashback Database during the recovery phase can be monitored by querying the view <code class="codeph">V$RECOVERY_PROGRESS</code>. 
                        </p>
                        <div class="infoboxnotealso" id="GUID-93BF7DBC-2520-4C7D-B059-663F963B68DA__GUID-63FBF987-0E46-457E-81D1-01B5CE01523C">
                           <p class="notep1">See Also:</p>
                           <p>The <a href="../refrn/V-RECOVERY_PROGRESS.html#REFRN30199" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> for information about the view <code class="codeph">V$RECOVERY_PROGRESS</code></p>
                        </div>
                     </div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div><a id="BRADV84152"></a><div class="props_rev_3"><a id="GUID-7D3EE2F7-77A2-4264-8875-CC0AEC64ABE0" name="GUID-7D3EE2F7-77A2-4264-8875-CC0AEC64ABE0"></a><h3 id="BRADV-GUID-7D3EE2F7-77A2-4264-8875-CC0AEC64ABE0" class="sect3"><span class="enumeration_section">18.5 </span>Performing Database Point-in-Time Recovery
               </h3>
               <div>
                  <p>RMAN DBPITR restores the database from backups before the target time for recovery, then uses incremental backups and redo to roll the database forward to the target time. You can recover to an SCN, time, log sequence number, or restore point. Oracle recommends that you create restore points at important times to make point-in-time recovery more manageable if it ever becomes necessary.</p>
                  <p>Oracle recommends that you perform Flashback Database rather than database point-in-time recovery if possible. Media recovery with backups are the last option when flashback technologies cannot be used to undo the most recent changes.</p>
                  <p>This section contains the following topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="rman-performing-flashback-dbpitr.html#GUID-2CF6EEFB-0344-4FD6-9BBB-F2D241172BC6" title="Certain prerequisites must be met to perform database point-in-time recovery (DBPITR).">Prerequisites of Database Point-in-Time Recovery</a></p>
                     </li>
                     <li>
                        <p><a href="rman-performing-flashback-dbpitr.html#GUID-5B964EB6-B498-4A0D-B480-5C6E0BACFA5D" title="Use the RESTORE and RECOVER commands to perform DBPITR.">Performing Database Point-in-Time Recovery</a></p>
                     </li>
                     <li>
                        <p><a href="rman-performing-flashback-dbpitr.html#GUID-031D9695-A9D2-4381-A840-39BD3CC19946" title="Use the RECOVER command to perform point-in-time recovery (PITR) of container databases (CDBs) and pluggable databases (PDBs). PITR of PDBs can only be performed using RMAN.">Performing Point-in-Time Recovery of CDBs and PDBs</a></p>
                     </li>
                     <li>
                        <p><a href="rman-performing-flashback-dbpitr.html#GUID-1414BF57-1CBF-4BE6-A4C1-2521B3CF8B5F" title="Use the RESTORE and RECOVER commands to perform point-in-time recovery of an application PDB.">Performing Point-in-Time Recovery of Application PDBs</a></p>
                     </li>
                     <li>
                        <p><a href="rman-performing-flashback-dbpitr.html#GUID-AB0D518A-4959-4714-AD88-01518969A939" title="Performing point-in-time recovery of sparse databases is similar to performing point-in-time recovery of normal databases.">Performing Point-in-Time Recovery of Sparse Databases</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89753"></a><div class="props_rev_3"><a id="GUID-2CF6EEFB-0344-4FD6-9BBB-F2D241172BC6" name="GUID-2CF6EEFB-0344-4FD6-9BBB-F2D241172BC6"></a><h4 id="BRADV-GUID-2CF6EEFB-0344-4FD6-9BBB-F2D241172BC6" class="sect4"><span class="enumeration_section">18.5.1 </span>Prerequisites of Database Point-in-Time Recovery
                  </h4>
                  <div>
                     <p>Certain prerequisites must be met to perform database point-in-time recovery (DBPITR).</p>
                     <p>This includes the following:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Your database must be running in <code class="codeph">ARCHIVELOG</code> mode. 
                           </p>
                        </li>
                        <li>
                           <p>You must have backups of all data files from before the target SCN for DBPITR and archived logs for the period between the SCN of the backups and the target SCN.</p>
                        </li>
                        <li>
                           <p>If the backups were created using transparent encryption, and if a password-based software keystore was used, then the keystore password must be provided before the restore operation is performed. Use the <code class="codeph">SET</code> command with the <code class="codeph">DECRYPTION WALLET OPEN IDENTIFIED BY</code> option to specify the password that must be used to open the password-based keystore. Note that this command is not required when an auto-login software keystore is used.
                           </p>
                        </li>
                        <li>
                           <p>If the backups were created using password-mode encryption, then you must provide the password used to decrypt backups before you run the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands. Use the <code class="codeph">SET DECRYPTION IDENTIFIED BY</code> command to specify the password used to decrypt the backups.
                           </p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-2CF6EEFB-0344-4FD6-9BBB-F2D241172BC6__GUID-FF696C48-2F94-4061-8918-1EAD3774C116">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">SET</code> command in <a href="../rcmrf/SET.html#RCMRF153" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> for the syntax and usage of this command
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">RECOVER</code> command in <a href="../rcmrf/RECOVER.html#RCMRF140" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> for a complete account of command prerequisites and usage notes
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="BRADV346"></a><a id="BRADV89754"></a><div class="props_rev_3"><a id="GUID-5B964EB6-B498-4A0D-B480-5C6E0BACFA5D" name="GUID-5B964EB6-B498-4A0D-B480-5C6E0BACFA5D"></a><h4 id="BRADV-GUID-5B964EB6-B498-4A0D-B480-5C6E0BACFA5D" class="sect4"><span class="enumeration_section">18.5.2 </span>Performing Database Point-in-Time Recovery
                  </h4>
                  <div>
                     <p>Use the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands to perform DBPITR.
                     </p>
                     <div class="section">
                        <p>When performing DBPITR, you can avoid errors by using the <code class="codeph">SET UNTIL</code> command to set the target time at the beginning of the procedure, rather than specifying the <code class="codeph">UNTIL</code> clause on the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands individually. This ensures that the data files restored from backup have time stamps early enough to be used in the subsequent <code class="codeph">RECOVER</code> operation.
                        </p>
                        <p>This section makes the following assumptions:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>You are performing DBPITR within the current database incarnation. If your target time is not in the current incarnation, then see <span class="q">"<a href="rman-performing-flashback-dbpitr.html#GUID-F1818201-98E5-4B70-BDFE-A61AB84397E6" title="To perform DPITR to an noncurrent database incarnation, you must explicitly execute the RESET DATABASE to reset the database to the incarnation that was current at the target SCN. You must also restore a control file from the database incarnation containing the target SCN.">Recovering the Database to an Ancestor Incarnation</a>"</span> for more information about DBPITR to ancestor incarnations. 
                              </p>
                           </li>
                           <li>
                              <p>The control file is current. If you must restore a backup control file, then see <span class="q">"<a href="rman-recovery-advanced.html#GUID-77C2B092-4BEB-4BAC-91F9-7368EA16A2B6" title="When all current control files are lost, you must restore a backup control file.">Performing Recovery with a Backup Control File</a>"</span>.
                              </p>
                           </li>
                           <li>
                              <p>Your database is using the current server parameter file. If you must restore a backup server parameter file, then see <span class="q">"<a href="rman-recovery-advanced.html#GUID-2B93E1AF-5ED1-4FAE-91BB-63362CADF7AD" title="RMAN can restore a lost server parameter file to its default location or to a location of your choice. Unlike the loss of the control file, the loss of the server parameter file does not cause the instance to immediately stop. The instance may continue operating, although you must shut it down and restart it after restoring the server parameter file.">Restoring the Server Parameter File</a>"</span>.
                              </p>
                           </li>
                        </ul>
                        <p><span class="bold">To perform DBPITR:</span></p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ol>
                           <li>
                              <p>Ensure that the prerequisites described in <span class="q">"<a href="rman-performing-flashback-dbpitr.html#GUID-2CF6EEFB-0344-4FD6-9BBB-F2D241172BC6" title="Certain prerequisites must be met to perform database point-in-time recovery (DBPITR).">Prerequisites of Database Point-in-Time Recovery</a>"</span> are met.
                              </p>
                           </li>
                           <li>
                              <p>Determine the time, SCN, restore point, or log sequence that ends recovery. </p>
                              <p>You can use the Flashback Query features to help you identify when the logical corruption occurred. If you have a <a href="glossary.html#GUID-2298E7F2-79F8-451F-B180-8A58300E29CB"><span class="xrefglossterm">flashback data archive</span></a> enabled for a table, then you can query data that existed far in the past.
                              </p>
                              <p>You can also use the alert log to try to determine the time of the event from which you must recover.</p>
                              <p>Alternatively, you can use a SQL query to determine the log sequence number that contains the target SCN and then recover through this log. For example, run the following query to list the logs in the current database incarnation (sample output included):</p><pre class="oac_no_warn" dir="ltr">SELECT RECID, STAMP, THREAD#, SEQUENCE#, FIRST_CHANGE#
       FIRST_TIME, NEXT_CHANGE#
FROM   V$ARCHIVED_LOG
WHERE  RESETLOGS_CHANGE# =
       ( SELECT RESETLOGS_CHANGE#
         FROM   V$DATABASE_INCARNATION
         WHERE  STATUS = 'CURRENT');

RECID      STAMP      THREAD#    SEQUENCE#  FIRST_CHAN FIRST_TIM NEXT_CHANG
---------- ---------- ---------- ---------- ---------- --------- ----------
         1  344890611          1          1      20037 24-SEP-13      20043
         2  344890615          1          2      20043 24-SEP-13      20045
         3  344890618          1          3      20045 24-SEP-13      20046
</pre><p>For example, if you discover that a user accidentally dropped a tablespace at 9:02 a.m., then you can recover to 9 a.m., just before the drop occurred. You lose all changes to the database made after this time.</p>
                           </li>
                           <li>
                              <p>If you are using a target time expression instead of a target SCN, then ensure that the time format environment variables are appropriate before invoking RMAN. </p>
                              <p>The following are sample Globalization Support settings:</p><pre class="oac_no_warn" dir="ltr">NLS_LANG = american_america.us7ascii
NLS_DATE_FORMAT="Mon DD YYYY HH24:MI:SS"
</pre></li>
                           <li>
                              <p>Connect RMAN to the target database, as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>. If applicable, connect to a recovery catalog.
                              </p>
                           </li>
                           <li>
                              <p>Bring the database to a mounted state using the following commands:</p><pre class="oac_no_warn" dir="ltr">SHUTDOWN IMMEDIATE;
STARTUP MOUNT;
</pre></li>
                           <li>
                              <p>Perform the following operations within a <code class="codeph">RUN</code> block:
                              </p>
                              <ol type="a">
                                 <li>
                                    <p>For DBPITR, use <code class="codeph">SET UNTIL</code> to specify the target time, SCN, or log sequence number, or use <code class="codeph">SET TO</code> to specify a restore point. If specifying a time, then use the date format specified in the <code class="codeph">NLS_LANG</code> and <code class="codeph">NLS_DATE_FORMAT</code> environment variables.
                                    </p>
                                 </li>
                                 <li>
                                    <p>If automatic channels are not configured, then manually allocate disk and tape channels as needed.</p>
                                 </li>
                                 <li>
                                    <p>Restore and recover the database.</p>
                                 </li>
                              </ol>
                              <p>The following example performs DBPITR on the target database until SCN 1000:</p><pre class="oac_no_warn" dir="ltr">RUN
{ 
  SET UNTIL SCN 1000;    
  RESTORE DATABASE;
  RECOVER DATABASE;
}
</pre><p>As shown in the following examples, you can also use time expressions, restore points, or log sequence numbers to specify the <code class="codeph">SET UNTIL</code> time:
                              </p><pre class="oac_no_warn" dir="ltr">SET UNTIL TIME 'Nov 15 2013 09:00:00';
SET UNTIL SEQUENCE 9923;  
SET TO RESTORE POINT before_update;
</pre><p>If the operation completes without errors, then DBPITR has succeeded.</p>
                           </li>
                           <li id="GUID-5B964EB6-B498-4A0D-B480-5C6E0BACFA5D__CHDDBIJB">
                              <p>Perform either of the following mutually exclusive actions:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>Open your database for read/write, abandoning all changes after the target SCN. In this case, you must shut down the database, mount it, and then execute the following command:</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN RESETLOGS;
</pre><p>The <code class="codeph">OPEN RESETLOGS</code> operation fails if a data file is offline unless the data file went offline normally or is read-only. You can bring files in read-only or offline normal tablespaces online after the <code class="codeph">RESETLOGS</code> because they do not need any redo.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Export one or more objects from your database with Data Pump Export. You can then recover the database to the current point in time and reimport the exported objects, thus returning these objects to their state before the unwanted change without abandoning all other changes.</p>
                                 </li>
                              </ul>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV804"></a><a id="BRADV640"></a><div class="props_rev_3"><a id="GUID-031D9695-A9D2-4381-A840-39BD3CC19946" name="GUID-031D9695-A9D2-4381-A840-39BD3CC19946"></a><h4 id="BRADV-GUID-031D9695-A9D2-4381-A840-39BD3CC19946" class="sect4"><span class="enumeration_section">18.5.3 </span>Performing Point-in-Time Recovery of CDBs and PDBs
                  </h4>
                  <div>
                     <p>Use the <code class="codeph">RECOVER</code> command to perform point-in-time recovery (PITR) of container databases (CDBs) and pluggable databases (PDBs). PITR of PDBs can only be performed using RMAN.
                     </p>
                     <p></p>
                     <p>The general information regarding PITR that is contained in this chapter applies to CDBs with the differences described in this section and its subsections.</p>
                     <div class="infoboxnote" id="GUID-031D9695-A9D2-4381-A840-39BD3CC19946__GUID-6775DBC1-2D35-436E-8195-B20E7FAC6A0D">
                        <p class="notep1">Note:</p>
                        <p>If you are not using a recovery catalog, it is recommended that you turn on control file auto backups. Otherwise, PITR for PDBs may not work effectively when RMAN needs to undo data file additions or deletions.</p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-031D9695-A9D2-4381-A840-39BD3CC19946__GUID-D252EB85-844A-4B5E-A7CD-E945DD15C90B">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="rman-performing-flashback-dbpitr.html#GUID-35D290AC-CC01-4984-93D6-AE41A3D0D3B6" title="RMAN provides support for point-in-time recovery for one or more PDBs. To recover PDBs, you must connect to the root as a user with SYSDBA or SYSBACKUP privilege. After recovery, old backups of the PDB remain valid and can be used if a media failure occurs.">Basic Concepts of Point-in-Time Recovery for PDBs</a></p>
                           </li>
                           <li>
                              <p><a href="rman-performing-flashback-dbpitr.html#GUID-7572C8E9-05B8-4BCC-823F-BD6763C51B11" title="Use the RESTORE and RECOVER commands to perform point-in-time recovery for a whole CDB.">Performing Point-in-Time Recovery of a Whole CDB</a></p>
                           </li>
                           <li>
                              <p><a href="rman-performing-flashback-dbpitr.html#GUID-26CD7EC8-12AC-4073-BB8D-A68502112E48" title="When you recover one or more PDBs to a specified point-in-time, the remaining PDBs in the CDB are not affected and they can be open and operational.">Performing Point-in-Time Recovery of PDBs</a></p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="BRADV806"></a><a id="BRADV805"></a><div class="props_rev_3"><a id="GUID-7572C8E9-05B8-4BCC-823F-BD6763C51B11" name="GUID-7572C8E9-05B8-4BCC-823F-BD6763C51B11"></a><h5 id="BRADV-GUID-7572C8E9-05B8-4BCC-823F-BD6763C51B11" class="sect5"><span class="enumeration_section">18.5.3.1 </span>Performing Point-in-Time Recovery of a Whole CDB
                     </h5>
                     <div>
                        <p>Use the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands to perform point-in-time recovery for a whole CDB.
                        </p>
                        <div class="section">
                           <p><span class="bold">To perform point-in-time recovery of a whole CDB:</span></p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Ensure that the prerequisites described in <span class="q">"<a href="rman-performing-flashback-dbpitr.html#GUID-2CF6EEFB-0344-4FD6-9BBB-F2D241172BC6" title="Certain prerequisites must be met to perform database point-in-time recovery (DBPITR).">Prerequisites of Database Point-in-Time Recovery</a>"</span> are met.</span></li>
                           <li class="stepexpand"><span>Determine the time, SCN, restore point, or log sequence that ends recovery.</span><div>
                                 <p>You can use the Flashback Query features to help you identify when the logical corruption occurred. If you have a <a href="glossary.html#GUID-2298E7F2-79F8-451F-B180-8A58300E29CB"><span class="xrefglossterm">flashback data archive</span></a> enabled for a table, then you can query data that existed far in the past.
                                 </p>
                                 <p>You can also use the alert log to try to determine the time of the event from which you must recover.</p>
                                 <p>Alternatively, you can use a SQL query to determine the log sequence number that contains the target SCN and then recover through this log. For example, run the following query to list the logs in the current database incarnation (sample output included):</p><pre class="oac_no_warn" dir="ltr">SELECT RECID, STAMP, THREAD#, SEQUENCE#, FIRST_CHANGE#
       FIRST_TIME, NEXT_CHANGE#
FROM   V$ARCHIVED_LOG
WHERE  RESETLOGS_CHANGE# =
       ( SELECT RESETLOGS_CHANGE#
         FROM   V$DATABASE_INCARNATION
         WHERE  STATUS = 'CURRENT');

RECID      STAMP      THREAD#    SEQUENCE#  FIRST_CHAN FIRST_TIM NEXT_CHANG
---------- ---------- ---------- ---------- ---------- --------- ----------
         1  344890611          1          1      20037 24-SEP-13      20043
         2  344890615          1          2      20043 24-SEP-13      20045
         3  344890618          1          3      20045 24-SEP-13      20046
</pre><p>For example, if you discover that a user accidentally dropped a tablespace at 9:02 a.m., then you can recover to 9 a.m., just before the drop occurred. You lose all changes to the database made after this time.</p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>If you are using a target time expression instead of a target SCN, then ensure that the time format environment variables are appropriate before invoking RMAN.</span><div>
                                 <p>The following are sample Globalization Support settings:</p><pre class="oac_no_warn" dir="ltr">NLS_LANG = american_america.us7ascii
NLS_DATE_FORMAT="Mon DD YYYY HH24:MI:SS"
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Connect RMAN to the root as a common user with the <code class="codeph">SYSBACKUP</code> or <code class="codeph">SYSDBA</code> privilege, as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D" title="There are several ways to connect as target to the root.">Connecting as Target to the Root</a>"</span>. If applicable, connect to a recovery catalog.</span></li>
                           <li class="stepexpand"><span>Bring the CDB to a mounted state.</span><div><pre class="oac_no_warn" dir="ltr">SHUTDOWN IMMEDIATE;
STARTUP MOUNT;
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Perform the following operations within a <code class="codeph">RUN</code> block:</span><ol type="a">
                                 <li><span>For DBPITR, use <code class="codeph">SET</code> <code class="codeph">UNTIL</code> to specify the target time, SCN, or log sequence number, or use <code class="codeph">SET</code> <code class="codeph">TO</code> to specify a restore point. If specifying a time, then use the date format specified in the <code class="codeph">NLS_LANG</code> and <code class="codeph">NLS_DATE_FORMAT</code> environment variables.</span></li>
                                 <li><span>If automatic channels are not configured, then manually allocate disk and tape channels as needed.</span></li>
                                 <li><span>Restore and recover the CDB.</span></li>
                              </ol>
                              <div>
                                 <p>The following example performs DBPITR on the target CDB until SCN 1000:</p><pre class="oac_no_warn" dir="ltr">RUN
{ 
  SET UNTIL SCN 1000;    
  RESTORE DATABASE;
  RECOVER DATABASE;
}
</pre><p>As shown in the following examples, you can also use time expressions, restore points, or log sequence numbers to specify the <code class="codeph">SET</code> <code class="codeph">UNTIL</code> time:
                                 </p><pre class="oac_no_warn" dir="ltr">SET UNTIL TIME 'Nov 15 2013 09:00:00';
SET UNTIL SEQUENCE 9923;  
SET TO RESTORE POINT before_update;
</pre><p>If the operation completes without errors, then DBPITR has succeeded.</p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Perform either of the following mutually exclusive actions:</span><div>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>Open your CDB for read/write, abandoning all changes after the target SCN. In this case, you must shut down the CDB, mount it, and then execute the following command:</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN RESETLOGS;
</pre><p>The <code class="codeph">OPEN RESETLOGS</code> operation fails if a data file is offline unless the data file went offline normally or is read-only. You can bring files in read-only or offline normal tablespaces online after the <code class="codeph">RESETLOGS</code> because they do not need any redo.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Export one or more objects from your CDB with Data Pump Export. You can then recover the CDB to the current point in time and reimport the exported objects, thus returning these objects to their state before the unwanted change without abandoning all other changes.</p>
                                    </li>
                                 </ul>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Open all the PDBs.</span><div>
                                 <p>PDBs are not opened when the CDB is opened. The following command, when connected to the <a href="glossary.html#GUID-EA3DB8F4-F68E-4FC5-A599-32A4886FFF8A"><span class="xrefglossterm">root</span></a>, opens all the PDBs.
                                 </p><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE ALL OPEN;
</pre><p>You can open each PDB separately.</p>
                              </div>
                           </li>
                        </ol>
                     </div>
                  </div><a id="BRADV644"></a><a id="BRADV807"></a><div class="props_rev_3"><a id="GUID-26CD7EC8-12AC-4073-BB8D-A68502112E48" name="GUID-26CD7EC8-12AC-4073-BB8D-A68502112E48"></a><h5 id="BRADV-GUID-26CD7EC8-12AC-4073-BB8D-A68502112E48" class="sect5"><span class="enumeration_section">18.5.3.2 </span>Performing Point-in-Time Recovery of PDBs
                     </h5>
                     <div>
                        <p>When you recover one or more PDBs to a specified point-in-time, the remaining PDBs in the CDB are not affected and they can be open and operational. </p>
                        <div class="section">
                           <p>When performing DBPITR on one or more PDBs in a CDB that uses shared undo, backups of the root and the CDB seed (<code class="codeph">PDB$SEED</code>) of the CDB that contains the PDBs are required.
                           </p>
                           <p>Starting with Oracle Database 12<span class="italic">c</span> Release 2 (12.2), if the <code class="codeph">COMPATIBLE</code> initialization parameter is set to 12.2.0 or higher, you can perform flashback database for a CDB across a PDB flashback operation or PDB PITR.
                           </p>
                           <p><span class="bold">To perform DBPITR on a PDB:</span></p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Ensure that the prerequisites described in <span class="q">"<a href="rman-performing-flashback-dbpitr.html#GUID-2CF6EEFB-0344-4FD6-9BBB-F2D241172BC6" title="Certain prerequisites must be met to perform database point-in-time recovery (DBPITR).">Prerequisites of Database Point-in-Time Recovery</a>"</span> are met.</span></li>
                           <li class="stepexpand"><span>Determine the time, SCN, restore point, or log sequence that ends recovery.</span><div>Use Flashback Query or the alert log to determine when the logicla corruption occurred. Or, use a SQL query to determine the log sequence number that contains the target SCN and then recover through this log.</div>
                           </li>
                           <li class="stepexpand"><span>If you are using a target time expression instead of a target SCN, then ensure that the time format environment variables are appropriate before invoking RMAN.</span><div>
                                 <p>The following are sample Globalization Support settings:</p><pre class="oac_no_warn" dir="ltr">NLS_LANG = american_america.us7ascii
NLS_DATE_FORMAT="Mon DD YYYY HH24:MI:SS"
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Connect RMAN to the root as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege, as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD" title="You can connect the RMAN client to multitenant container databases (CDBs) and pluggable databases (PDBs).">Making RMAN Connections to a CDB</a>"</span>.  If applicable, connect to a recovery catalog.</span></li>
                           <li class="stepexpand"><span>Close the PDB that is being recovered. The other PDBs and the CDB can remain open.</span><div><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE pdb1 CLOSE;
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Perform the following operations within a <code class="codeph">RUN</code> block:</span><ol type="a">
                                 <li><span>For DBPITR, use <code class="codeph">SET</code> <code class="codeph">UNTIL</code> to specify the target time, SCN, or log sequence number, or use <code class="codeph">SET</code> <code class="codeph">TO</code> to specify a restore point. If specifying a time, then use the date format specified in the <code class="codeph">NLS_LANG</code> and <code class="codeph">NLS_DATE_FORMAT</code> environment variables.</span></li>
                                 <li><span>If automatic channels are not configured, then manually allocate disk and tape channels as needed.</span></li>
                                 <li><span>Restore and recover the CDB.</span></li>
                              </ol>
                              <div>
                                 <p>The following example performs DBPITR on the PDB <code class="codeph">my_pdb</code> until SCN 1000:
                                 </p><pre class="oac_no_warn" dir="ltr">RUN
{ 
  SET UNTIL SCN 1000;    
  RESTORE PLUGGABLE DATABASE my_pdb;
  RECOVER PLUGGABLE DATABASE my_pdb;
}
</pre><p>If the operation completes without errors, then DBPITR has succeeded.</p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Open the PDB abandoning all changes after the target SCN. </span><div>
                                 <p>The following example opens the PDB named <code class="codeph">my_pdb</code>.
                                 </p><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE my_pdb OPEN RESETLOGS;
</pre></div>
                           </li>
                        </ol>
                        <div class="example" id="GUID-26CD7EC8-12AC-4073-BB8D-A68502112E48__GUID-1B85A9D7-662E-4936-B45C-93C454BD7D70">
                           <p class="titleinexample">Example 18-4 Recovering a PDB to a Specified Point-in-time</p>
                           <p>This example recovers a PDB named <code class="codeph">PDB5</code> up to the SCN 1066 and then opens it for read/write access. Connect to the root as a common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege and enter the following commands:
                           </p><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE pdb5 CLOSE;
run 
{
   SET UNTIL SCN 1066;
   RESTORE PLUGGABLE DATABASE pdb5;
   RECOVER PLUGGABLE DATABASE pdb5;
}
ALTER PLUGGABLE DATABASE pdb5 OPEN RESETLOGS;
</pre><p>This example assumes that a <a href="glossary.html#GUID-6E3CDD76-A573-4E5C-B12D-59C232C96C19"><span class="xrefglossterm">fast recovery area</span></a> is being used. If you do not use a fast recovery area, then you must specify the temporary location of the auxiliary set files by using the <code class="codeph">AUXILIARY DESTINATION</code> clause.
                           </p>
                           <p>Opening the PDB with <code class="codeph">RESETLOGS</code> creates a new PDB incarnation. You can query the <code class="codeph">V$PDB_INCARNATION</code> view for the incarnation number.
                           </p>
                           <div class="infoboxnotealso" id="GUID-26CD7EC8-12AC-4073-BB8D-A68502112E48__GUID-C028DC0C-B9DA-401E-BC3E-749D08534F57">
                              <p class="notep1">See Also:</p>
                              <p><span class="q">"<a href="rman-performing-flashback-dbpitr.html#GUID-35D290AC-CC01-4984-93D6-AE41A3D0D3B6" title="RMAN provides support for point-in-time recovery for one or more PDBs. To recover PDBs, you must connect to the root as a user with SYSDBA or SYSBACKUP privilege. After recovery, old backups of the PDB remain valid and can be used if a media failure occurs.">Basic Concepts of Point-in-Time Recovery for PDBs</a>"</span> for information about the fast recovery area usage during point-in-time recovery of PDBs
                              </p>
                           </div>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-1414BF57-1CBF-4BE6-A4C1-2521B3CF8B5F" name="GUID-1414BF57-1CBF-4BE6-A4C1-2521B3CF8B5F"></a><h4 id="BRADV-GUID-1414BF57-1CBF-4BE6-A4C1-2521B3CF8B5F" class="sect4"><span class="enumeration_section">18.5.4 </span>Performing Point-in-Time Recovery of Application PDBs
                  </h4>
                  <div>
                     <p>Use the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands to perform point-in-time recovery of an application PDB.
                     </p>
                     <div class="p">
                        <p></p>
                     </div>
                     <!-- class="section" -->
                     <div class="p">The <code class="codeph">COMPATIBLE</code> parameter for the CDB must be set to 12.2 or higher.
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><span class="bold">To perform point-in-time recovery of an application PDB:</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Ensure that the prerequisites for point-in-time recovery are met.</span></li>
                        <li class="stepexpand"><span>Start RMAN and connect to the <a href="glossary.html#GUID-CC9EB948-16BC-4AB6-A05E-08EEAFCDD05F"><span class="xrefglossterm">application root</span></a> as an application common user with the <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code> privilege.</span><div>The application root has its own service name and you can connect to the application root in the same way that you connect to a PDB.</div>
                        </li>
                        <li class="stepexpand"><span>Determine the time, SCN, restore point, or log sequence that ends recovery.</span></li>
                        <li class="stepexpand"><span>Close the <a href="glossary.html#GUID-6E2F65AE-C36C-446D-84D7-4F709C7DEBCE"><span class="xrefglossterm">application PDB</span></a> that must be recovered. </span><div>
                              <p>The following command closes the application PDB called <code class="codeph">hr_appcont_pdb1</code>.
                              </p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE hr_appcont_pdb1 CLOSE; </code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Perform the following operations within a <code class="codeph">RUN</code> block:</span><ol type="a">
                              <li><span>Use <code class="codeph">SET UNTIL</code> to specify the target time, SCN, or log sequence number, or use <code class="codeph">SET TO</code> to specify a restore point. If specifying a time, then use the date format specified in the <code class="codeph">NLS_LANG</code> and <code class="codeph">NLS_DATE_FORMAT</code> environment variables.</span></li>
                              <li><span>If automatic channels are not configured, then manually allocate disk and tape channels as needed.</span></li>
                              <li><span>Restore and recover the application container.</span></li>
                           </ol>
                           <div><pre class="pre codeblock"><code>RUN
{
SET UNTIL SCN 34506;
RESTORE PLUGGABLE DATABASE hr_appcont_pdb1;
RECOVER PLUGGABLE DATABASE hr_appcont_pdb1;
}
</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Open the application PDB with <code class="codeph">RESETLOGS</code>. This results in all changes after the target SCN being abandoned.</span><div><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE hr_appcont_pdb1 OPEN RESETLOGS;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-1414BF57-1CBF-4BE6-A4C1-2521B3CF8B5F__GUID-AA791871-6730-46C5-BE1A-FF3F3C0029A1">
                           <p class="notep1">See Also:</p>
                           <p><a href="starting-interacting-with-rman-client.html#GUID-B397ADD8-D9CF-4DDA-B6AC-8C5FF04447AD" title="You can connect the RMAN client to multitenant container databases (CDBs) and pluggable databases (PDBs).">Making RMAN Connections to a CDB</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-AB0D518A-4959-4714-AD88-01518969A939" name="GUID-AB0D518A-4959-4714-AD88-01518969A939"></a><h4 id="BRADV-GUID-AB0D518A-4959-4714-AD88-01518969A939" class="sect4"><span class="enumeration_section">18.5.5 </span>Performing Point-in-Time Recovery of Sparse Databases
                  </h4>
                  <div>
                     <p>Performing point-in-time recovery of sparse databases is similar to performing point-in-time recovery of normal databases. </p>
                     <p>Ensure that the <code class="codeph">COMPATIBLE</code> initialization parameter of the database being recovered is set to 12.2 or higher.
                     </p>
                     <div class="infoboxnote" id="GUID-AB0D518A-4959-4714-AD88-01518969A939__GUID-F231B9FF-FEC3-48A2-9943-20C1F99EA7F8">
                        <p class="notep1">Note:</p>
                        <p>The base (read-only) data files in a sparse database are not encrypted. Ensure that the base data files are stored in a protected storage and accessed using secured communications.</p>
                     </div>
                     <p><span class="bold">To perform point-in-time recovery of a sparse database:</span></p>
                     <ol>
                        <li>
                           <p>Ensure that the prerequisites described in <span class="q">"<a href="rman-performing-flashback-dbpitr.html#GUID-2CF6EEFB-0344-4FD6-9BBB-F2D241172BC6" title="Certain prerequisites must be met to perform database point-in-time recovery (DBPITR).">Prerequisites of Database Point-in-Time Recovery</a>"</span> are met.
                           </p>
                        </li>
                        <li>
                           <p>Determine the time, SCN, restore point, or log sequence that ends recovery. </p>
                           <p>You can use the Flashback Query features to help you identify when the logical corruption occurred. If you have a <a href="glossary.html#GUID-2298E7F2-79F8-451F-B180-8A58300E29CB"><span class="xrefglossterm">flashback data archive</span></a> enabled for a table, then you can query data that existed far in the past.
                           </p>
                           <p>You can also use the alert log to try to determine the time of the event from which you must recover.</p>
                           <p>Alternatively, you can use a SQL query to determine the log sequence number that contains the target SCN and then recover through this log. For example, run the following query to list the logs in the current database incarnation (sample output included):</p><pre class="oac_no_warn" dir="ltr">SELECT RECID, STAMP, THREAD#, SEQUENCE#, FIRST_CHANGE#
       FIRST_TIME, NEXT_CHANGE#
FROM   V$ARCHIVED_LOG
WHERE  RESETLOGS_CHANGE# =
       ( SELECT RESETLOGS_CHANGE#
         FROM   V$DATABASE_INCARNATION
         WHERE  STATUS = 'CURRENT');

RECID      STAMP      THREAD#    SEQUENCE#  FIRST_CHAN FIRST_TIM NEXT_CHANG
---------- ---------- ---------- ---------- ---------- --------- ----------
         1  344890611          1          1      20037 24-SEP-13      20043
         2  344890615          1          2      20043 24-SEP-13      20045
         3  344890618          1          3      20045 24-SEP-13      20046
</pre><p>For example, if you discover that a user accidentally dropped a tablespace at 9:02 a.m., then you can recover to 9 a.m., just before the drop occurred. You lose all changes to the database made after this time.</p>
                        </li>
                        <li>
                           <p>If you are using a target time expression instead of a target SCN, then ensure that the time format environment variables are appropriate before invoking RMAN. </p>
                           <p>The following are sample Globalization Support settings:</p><pre class="oac_no_warn" dir="ltr">NLS_LANG = american_america.us7ascii
NLS_DATE_FORMAT="Mon DD YYYY HH24:MI:SS"
</pre></li>
                        <li>
                           <p>Connect RMAN to the target database and, if applicable, the recovery catalog database, as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>.
                           </p>
                        </li>
                        <li>
                           <p>Bring the database to a mounted state.</p><pre class="oac_no_warn" dir="ltr">SHUTDOWN IMMEDIATE;
STARTUP MOUNT;
</pre><p>If the operation completes without errors, then DBPITR has succeeded.</p>
                        </li>
                        <li>
                           <div class="p">Perform the following operations within a <code class="codeph">RUN</code> block:
                              <ol type="a">
                                 <li>
                                    <p>For DBPITR, use <code class="codeph">SET</code> <code class="codeph">UNTIL</code> to specify the target time, SCN, or log sequence number, or use <code class="codeph">SET</code> <code class="codeph">TO</code> to specify a restore point. If specifying a time, then use the date format specified in the <code class="codeph">NLS_LANG</code> and <code class="codeph">NLS_DATE_FORMAT</code> environment variables.
                                    </p>
                                 </li>
                                 <li>
                                    <p>If automatic channels are not configured, then manually allocate disk and tape channels as needed.</p>
                                 </li>
                                 <li>
                                    <p>Restore and recover the sparse database with the <code class="codeph">FROM SPARSE</code> option.
                                    </p>
                                    <p>The following example performs point-in-time recovery for a sparse database till the SCN <code class="codeph">2775080</code>:
                                    </p><pre class="pre codeblock"><code>RUN 
{
SET UNTIL SCN 2775080; 
RESTORE FROM SPARSE DATABASE; 
RECOVER DATABASE; 
}</code></pre></li>
                              </ol>
                           </div>
                        </li>
                        <li>
                           <div class="p">Perform either of the following mutually exclusive actions:
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>Open your database for read/write, abandoning all changes after the target SCN. In this case, you must shut down the database, mount it, and then execute the following command:</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN RESETLOGS;
</pre><p>The <code class="codeph">OPEN RESETLOGS</code> operation fails if a data file is offline unless the data file went offline normally or is read-only. You can bring files in read-only or offline normal tablespaces online after the <code class="codeph">RESETLOGS</code> because they do not need any redo.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Export one or more objects from your database with Data Pump Export. You can then recover the database to the current point in time and reimport the exported objects, thus returning these objects to their state before the unwanted change without abandoning all other changes.</p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div>
            </div><a id="BRADV89755"></a><div class="props_rev_3"><a id="GUID-F9C8CB5E-5954-4114-99D0-D121BA616058" name="GUID-F9C8CB5E-5954-4114-99D0-D121BA616058"></a><h3 id="BRADV-GUID-F9C8CB5E-5954-4114-99D0-D121BA616058" class="sect3"><span class="enumeration_section">18.6 </span>Flashback and Database Point-in-Time Recovery Scenarios
               </h3>
               <div>
                  <p>This section describes variations of the basic Flashback Database and DBPITR scenarios.</p>
                  <p>This section contains the following topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="rman-performing-flashback-dbpitr.html#GUID-7E39909E-E2D5-4D08-ADD8-0D5FEF028489" title="Flashback Database can be used to undo an OPEN RESETLOGS operation.">Rewinding an OPEN RESETLOGS Operation with Flashback Database</a></p>
                     </li>
                     <li>
                        <p><a href="rman-performing-flashback-dbpitr.html#GUID-CECE183D-C000-485A-99DA-371768A79011" title="You can use Flashback Database to rewind a database to an abandoned database incarnation.">Rewinding the Database to an SCN in an Abandoned Incarnation Branch</a></p>
                     </li>
                     <li>
                        <p><a href="rman-performing-flashback-dbpitr.html#GUID-F1818201-98E5-4B70-BDFE-A61AB84397E6" title="To perform DPITR to an noncurrent database incarnation, you must explicitly execute the RESET DATABASE to reset the database to the incarnation that was current at the target SCN. You must also restore a control file from the database incarnation containing the target SCN.">Recovering the Database to an Ancestor Incarnation</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV347"></a><a id="BRADV85442"></a><div class="props_rev_3"><a id="GUID-7E39909E-E2D5-4D08-ADD8-0D5FEF028489" name="GUID-7E39909E-E2D5-4D08-ADD8-0D5FEF028489"></a><h4 id="BRADV-GUID-7E39909E-E2D5-4D08-ADD8-0D5FEF028489" class="sect4"><span class="enumeration_section">18.6.1 </span>Rewinding an OPEN RESETLOGS Operation with Flashback Database
                  </h4>
                  <div>
                     <p>Flashback Database can be used to undo an <code class="codeph">OPEN RESETLOGS</code> operation.
                     </p>
                     <div class="section">
                        <p>The procedure for using Flashback Database to reverse an unwanted <code class="codeph">ALTER DATABASE OPEN RESETLOGS</code> statement is similar to the general case described in <span class="q">"<a href="rman-performing-flashback-dbpitr.html#GUID-3EB4D790-77C7-49CB-8D96-0940394E6BC8" title="A Flashback Database operation uses the FLASHBACK DATABASE command to rewind the database to a past point in time.">Performing a Flashback Database Operation</a>"</span>. Rather than specifying a particular SCN or point in time for the <code class="codeph">FLASHBACK DATABASE</code> command, however, you use <code class="codeph">FLASHBACK DATABASE TO BEFORE RESETLOGS</code>.
                        </p>
                        <p><span class="bold">To undo an <code class="codeph">OPEN RESETLOGS</code> operation:</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Connect SQL*Plus to the target database and verify that the beginning of the flashback window is earlier than the time of the most recent <code class="codeph">OPEN RESETLOGS</code>.</span><div>
                              <p>Run the following queries:</p><pre class="oac_no_warn" dir="ltr">SELECT RESETLOGS_CHANGE# FROM V$DATABASE;
SELECT OLDEST_FLASHBACK_SCN FROM V$FLASHBACK_DATABASE_LOG;
</pre><p>If <code class="codeph">V$DATABASE.RESETLOGS_CHANGE#</code> is greater than <code class="codeph">V$FLASHBACK_DATABASE_LOG.OLDEST_FLASHBACK_SCN</code>, then you can use Flashback Database to reverse the <code class="codeph">OPEN RESETLOGS</code> operation.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Shut down the database, mount it, and recheck the flashback window. If the resetlogs SCN is still within the flashback window, then proceed to the next step.</span></li>
                        <li class="stepexpand"><span>Connect RMAN to the target database, as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>.</span></li>
                        <li class="stepexpand"><span>Perform a flashback to the SCN immediately before the <code class="codeph">RESETLOGS</code>.</span><div>
                              <p>Use the following form of the <code class="codeph">FLASHBACK DATABASE</code> command:
                              </p><pre class="oac_no_warn" dir="ltr">FLASHBACK DATABASE TO BEFORE RESETLOGS;
</pre><p>As with other uses of <code class="codeph">FLASHBACK DATABASE</code>, if the target SCN is before the beginning of the flashback database window, an error is returned and the database is not modified. If the command completes successfully, then the database is left mounted and recovered to the most recent SCN before the <code class="codeph">OPEN RESETLOGS</code> operation in the previous incarnation.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Open the database read-only in SQL*Plus and perform queries as needed to ensure that the effects of the logical corruption have been reversed.</span><div>
                              <p>Open the database read-only as follows:</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN READ ONLY;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>To make the database available for updates again, shut down the database, mount it, and then execute the following command:</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN RESETLOGS;</pre></div>
                        </li>
                     </ol>
                  </div><a id="BRADV89757"></a><div class="props_rev_3"><a id="GUID-FFA88389-D132-48BA-9BB6-CAEED6CDA228" name="GUID-FFA88389-D132-48BA-9BB6-CAEED6CDA228"></a><h5 id="BRADV-GUID-FFA88389-D132-48BA-9BB6-CAEED6CDA228" class="sect5"><span class="enumeration_section">18.6.1.1 </span>About Undoing an OPEN RESETLOGS on Standby Databases with Flashback Database
                     </h5>
                     <div>
                        <p>Flashback Database across <code class="codeph">OPEN RESETLOGS</code> may be used to perform multiple functions in a Data Guard environment.
                        </p>
                        <p> This includes the following:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Flashback to undo logical standby switchovers</p>
                              <p>In this case, the database reverts to its role (primary or standby) at the target time for the Flashback Database operation.</p>
                           </li>
                           <li>
                              <p>Undo of a physical standby activation </p>
                              <p>You can temporarily activate a physical standby database, use it for testing or reporting purposes, and then use Flashback Database to return it to its role as a physical standby.</p>
                           </li>
                           <li>
                              <p>Ongoing use of a standby database for testing</p>
                              <p>The use of Flashback Database means that you do not require the use of storage snapshots.</p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-FFA88389-D132-48BA-9BB6-CAEED6CDA228__GUID-F49D6FC3-3FA9-4B5A-8873-7BA30607B1B0">
                           <p class="notep1">See Also:</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=SBYDB00717" target="_blank"><span><cite>Oracle Data Guard Concepts and Administration</cite></span></a> for details on these advanced applications of Flashback Database with Data Guard
                           </p>
                        </div>
                     </div>
                  </div>
               </div><a id="BRADV348"></a><a id="BRADV89758"></a><div class="props_rev_3"><a id="GUID-CECE183D-C000-485A-99DA-371768A79011" name="GUID-CECE183D-C000-485A-99DA-371768A79011"></a><h4 id="BRADV-GUID-CECE183D-C000-485A-99DA-371768A79011" class="sect4"><span class="enumeration_section">18.6.2 </span>Rewinding the Database to an SCN in an Abandoned Incarnation Branch
                  </h4>
                  <div>
                     <p>You can use Flashback Database to rewind a database to an abandoned database incarnation.</p>
                     <div class="section">
                        <p>The effect of Flashback Database or DBPITR followed by an <code class="codeph">OPEN RESETLOGS</code> operation is to return the database to a previous SCN, and to abandon changes after this point. Therefore, some SCNs after that point can refer either to changes that were abandoned or changes in the current history of the database. In this way, a target SCN specified in <code class="codeph">FLASHBACK DATABASE</code> can be ambiguous.
                        </p>
                        <p>Unlike SCNs, time expressions and restore points are not ambiguous. A time expression is always associated with the incarnation that was current at that time. A restore point is always associated with the current incarnation when it was created. This is true even for times and restore points that correspond to abandoned database incarnations. The database incarnation is automatically reset to the incarnation that was current at the specified time or when the restore point was created.</p>
                        <p>You may want to use Flashback Database to rewind the database to an SCN in the parent incarnation that is later than the SCN of the <code class="codeph">OPEN RESETLOGS</code> operation at which the current incarnation path branched from the old incarnation. <a href="rman-data-repair-concepts.html#GUID-EC2E2F24-0AD3-486D-9289-407E7F1F5C9C__CHDCJGGD">Figure 14-1</a> shows how SCNs can be generated in an incarnation branch even after an <code class="codeph">OPEN RESETLOGS</code> operation creates a new incarnation. As shown in the diagram, the database could be at SCN 3000 in incarnation 3 when you must return to the abandoned SCN 1500 in incarnation 1.
                        </p>
                        <p>If the SCN to which you are rewinding is in the <a href="glossary.html#GUID-9FA6E4CA-C9C0-47E8-8FDF-2C2A313F8944"><span class="xrefglossterm">direct ancestral path</span></a>, or if you are rewinding the database to a <a href="glossary.html#GUID-A5A5E7B1-72B6-4F50-8E11-04C03EB5FFAE"><span class="xrefglossterm">restore point</span></a>, then an explicit <code class="codeph">RESET DATABASE</code> command is not necessary for Flashback Database. However, an explicit <code class="codeph">RESET DATABASE TO INCARNATION</code> command is required when you use <code class="codeph">FLASHBACK DATABASE</code> to rewind the database to an SCN in an abandoned database incarnation.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-CECE183D-C000-485A-99DA-371768A79011__GUID-0DA5EE26-05F4-40BC-8741-1E1391A50FFC">To rewind the database to an SCN in an abandoned incarnation branch:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Use SQL*Plus to connect to the target database and verify that the flashback logs contain enough information to flash back to the SCN.</span><div>
                              <p>For example, execute the following query:</p><pre class="oac_no_warn" dir="ltr">SELECT OLDEST_FLASHBACK_SCN FROM V$FLASHBACK_DATABASE_LOG;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Determine the target incarnation number for the Flashback Database operation, that is, the incarnation key for the parent incarnation.</span><div>
                              <p>For example, execute the following query:</p><pre class="oac_no_warn" dir="ltr">SELECT PRIOR_INCARNATION# 
FROM   V$DATABASE_INCARNATION 
WHERE  STATUS = 'CURRENT';
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Start RMAN and connect to the target database, as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>.</span></li>
                        <li class="stepexpand"><span>Shut down the database, and then mount it as follows:</span><div><pre class="oac_no_warn" dir="ltr">SHUTDOWN IMMEDIATE;
STARTUP MOUNT;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Set the database incarnation to the parent incarnation.</span><div>
                              <p>For example, use the following command to return to incarnation 1:</p><pre class="oac_no_warn" dir="ltr">RESET DATABASE TO INCARNATION 1;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Run the <code class="codeph">FLASHBACK DATABASE</code> command, specifying the target SCN.</span><div>
                              <p>For example, use the following command to rewind the database to SCN 1500:</p><pre class="oac_no_warn" dir="ltr">FLASHBACK DATABASE TO SCN 1500;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Open the database read-only in SQL*Plus and perform queries as needed to ensure that the effects of the logical corruption have been reversed.</span><div>
                              <p>Open the database read-only as follows:</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN READ ONLY;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>To make the database available for updates again, shut down the database, mount it, and then execute the following command:</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN RESETLOGS;</pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-CECE183D-C000-485A-99DA-371768A79011__GUID-6FA70F22-A044-4401-899F-599067B7B5BF">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="q">"<a href="rman-data-repair-concepts.html#GUID-9942AC94-A35D-4A06-9A45-A5A43B82B23D" title="A database incarnation is created whenever you open the database with the RESETLOGS option.">About Database Incarnations</a>"</span> for useful background information about database incarnations, abandoned changes, and the effects of <code class="codeph">ALTER DATABASE OPEN RESETLOGS</code> 
                                 </p>
                              </li>
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF148" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> for details about the <code class="codeph">RESET DATABASE</code> command
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV349"></a><a id="BRADV84153"></a><div class="props_rev_3"><a id="GUID-F1818201-98E5-4B70-BDFE-A61AB84397E6" name="GUID-F1818201-98E5-4B70-BDFE-A61AB84397E6"></a><h4 id="BRADV-GUID-F1818201-98E5-4B70-BDFE-A61AB84397E6" class="sect4"><span class="enumeration_section">18.6.3 </span>Recovering the Database to an Ancestor Incarnation
                  </h4>
                  <div>
                     <p>To perform DPITR to an noncurrent database incarnation, you must explicitly execute the <code class="codeph">RESET DATABASE</code> to reset the database to the incarnation that was current at the target SCN. You must also restore a control file from the database incarnation containing the target SCN.
                     </p>
                     <div class="section">
                        <p>When RMAN is connected to a recovery catalog, a <code class="codeph">RESTORE CONTROLFILE</code> command only searches the current database incarnation for the closest time specified in the <code class="codeph">UNTIL</code> clause. To restore a control file from a noncurrent incarnation, you must execute <code class="codeph">LIST INCARNATION</code> to identify the target database incarnation and specify this incarnation in the <code class="codeph">RESET DATABASE TO INCARNATION</code> command.
                        </p>
                        <p>When RMAN is not connected to a recovery catalog, you cannot execute the <code class="codeph">RESET DATABASE TO INCARNATION</code> command before the database is mounted. Thus, you must execute <code class="codeph">SET UNTIL</code>, restore the control file from autobackup, and then mount it.
                        </p>
                        <p>Assume the following situation:</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>RMAN is connected to a recovery catalog.</p>
                           </li>
                           <li>
                              <p>You have a backup of target database <code class="codeph">trgt</code> from October 2, 2013.
                              </p>
                           </li>
                           <li>
                              <p>DBPITR was performed on this database on October 10, 2013 to correct an earlier error. The <code class="codeph">OPEN</code> <code class="codeph">RESETLOGS</code> operation after that DBPITR started a new incarnation.
                              </p>
                           </li>
                        </ul>
                        <p>On October 25, you discover that you need crucial data that was dropped from the database at 8:00 a.m. on October 8, 2013. This time is before the beginning of the current incarnation.</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><span class="bold">To perform DBPITR to a noncurrent incarnation:</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Ensure that the prerequisites described in <span class="q">"<a href="rman-performing-flashback-dbpitr.html#GUID-2CF6EEFB-0344-4FD6-9BBB-F2D241172BC6" title="Certain prerequisites must be met to perform database point-in-time recovery (DBPITR).">Prerequisites of Database Point-in-Time Recovery</a>"</span> are met.</span></li>
                        <li class="stepexpand"><span>Start RMAN and connect to a target database and recovery catalog, if required, as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>.</span></li>
                        <li class="stepexpand"><span>Determine which database incarnation was current at the time of the backup.</span><div>
                              <p>Use <code class="codeph">LIST INCARNATION</code> to find the primary key of the incarnation that was current at the target time:
                              </p><pre class="oac_no_warn" dir="ltr">LIST INCARNATION OF DATABASE trgt;

List of Database Incarnations
DB Key  Inc Key   DB Name   DB ID       STATUS     Reset SCN    Reset Time
------- -------   -------   ------      -------    ----------   ----------
1       2         TRGT      1224038686  PARENT     1            02-OCT-13
1       582       TRGT      1224038686  CURRENT    59727        10-OCT-13
</pre><p>Look at the <code class="codeph">Reset SCN</code> and <code class="codeph">Reset Time</code> columns to identify the correct incarnation, and note the incarnation key in the <code class="codeph">Inc</code> <code class="codeph">Key</code> column. In this example, the backup was made 2 October 2013. In this case, the incarnation key value is 2. 
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Ensure that the database is started but not mounted.</span><div><pre class="oac_no_warn" dir="ltr">STARTUP FORCE NOMOUNT;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Reset the target database to the incarnation obtained in Step 2.</span><div>
                              <p>In this example, specify the incarnation current at the time of the backup of 2 October. Use the value from the <code class="codeph">Inc Key</code> column to identify the incarnation.
                              </p><pre class="oac_no_warn" dir="ltr">RESET DATABASE TO INCARNATION 2;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Restore and recover the database, performing the following actions in the <code class="codeph">RUN</code> command:</span><div>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>Set the end time for recovery to the time just before the loss of the data. </p>
                                 </li>
                                 <li>
                                    <p>Allocate any channels required that are not configured.</p>
                                 </li>
                                 <li>
                                    <p>Restore the control file from the October 2 backup and mount it.</p>
                                 </li>
                                 <li>
                                    <p>Restore the data files and recover the database. Use the <code class="codeph">RECOVER DATABASE ... UNTIL</code> command to perform DBPITR, bringing the database to the target time of 7:55 a.m. on October 8, just before the data was lost.
                                    </p>
                                 </li>
                              </ul>
                              <p>The following example shows all of the steps required in this case:</p><pre class="oac_no_warn" dir="ltr">RUN
{
  SET UNTIL TIME 'Oct 8 2013 07:55:00'; 
  RESTORE CONTROLFILE;
  # without recovery catalog, use RESTORE CONTROLFILE FROM AUTOBACKUP
  ALTER DATABASE MOUNT; 
  RESTORE DATABASE;
  RECOVER DATABASE;
}
ALTER DATABASE OPEN RESETLOGS;</pre><div class="infoboxnotealso" id="GUID-F1818201-98E5-4B70-BDFE-A61AB84397E6__GUID-13F6CB08-29CA-40C5-86AF-1279D7FE6D81">
                                 <p class="notep1">See Also:</p>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF148" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> for details about the <code class="codeph">RESET DATABASE</code> command
                                 </p>
                              </div>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>