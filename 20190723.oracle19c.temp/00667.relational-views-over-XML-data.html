<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="Relational database views over XML data provide conventional, relational access to XML content.">
      <meta name="description" content="Relational database views over XML data provide conventional, relational access to XML content.">
      <title>Relational Views over XML Data</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Developer's Guide ">
      <meta property="og:description" content="Relational database views over XML data provide conventional, relational access to XML content.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="xml-db-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-03-30T12:32:42-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="2002, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96222-03">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="generation-of-XML-data-from-relational-data.html" title="Previous" type="text/html">
      <link rel="next" href="XMLType-views.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="XML DB Developer's Guide">
    <meta name="dcterms.isVersionOf" content="ADXDB">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="generation-of-XML-data-from-relational-data.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="XMLType-views.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Developer's Guide </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="relational-data-to-and-from-XML-data.html" property="item" typeof="WebPage"><span property="name"> Relational Data To and From XML Data</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Relational Views over XML Data</li>
            </ol>
            <a id="GUID-420496CE-D62F-4EBE-A76E-861B932AE1E6" name="GUID-420496CE-D62F-4EBE-A76E-861B932AE1E6"></a><a id="ADXDB6124"></a>
            
            <h2 id="ADXDB-GUID-420496CE-D62F-4EBE-A76E-861B932AE1E6" class="sect2"><span class="enumeration_chapter">9 </span>Relational Views over XML Data
            </h2>
         </header>
         <div class="ind"><script type="text/javascript">window.name='relational-views-over-XML-data'</script><script type="text/javascript">
    function footdisplay(footnum,footnote) {
    var msg = window.open('about:blank', 'NewWindow' + footnum,
        'directories=no,height=100,location=no,menubar=no,resizable=yes,' +
        'scrollbars=yes,status=no,toolbar=no,width=598');
    msg.document.open('text/html');
    msg.document.write('<!DOCTYPE html ');
    msg.document.write('PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" ');
    msg.document.write('"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">'); 
    msg.document.write('<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us" dir="ltr"><head><title>');
   
    msg.document.write('Footnote&nbsp; ' + footnum);
    msg.document.write('<\/title><meta http-equiv="Content-Type" ');
    msg.document.write('content="text/html; charset=utf-8" />');
    msg.document.write('<meta http-equiv="Content-Script-Type" ');
    msg.document.write('content="text/javascript" />');
    msg.document.write('<style type="text/css"> <![CDATA[ ');
    msg.document.write('h1 {text-align: center; font-size: 14pt;}');
    msg.document.write('fieldset {border: none;}');
    msg.document.write('form {text-align: center;}');
    msg.document.write(' ]]\u003e <\/style>');
    msg.document.write('<\/head><body><div id="footnote"><h1>Footnote&nbsp; ' + footnum + '<\/h1><p>');
    msg.document.write(footnote);
    msg.document.write('<\/p><form action="" method="post"><fieldset>');
    msg.document.write('<input type="button" value="OK" ');
    msg.document.write('onclick="window.close();" />');
    msg.document.write('<\/fieldset><\/form><\/div><\/body><\/html>');
    msg.document.close();
    setTimeout(function() {
        var height = msg.document.getElementById('footnote').offsetHeight;
        msg.resizeTo(598, height + 100);
    }
    , 100);
    msg.focus();
}
            </script><noscript>
               <p>The script content on this page is for navigation purposes only and does not alter the content in any way.</p>
            </noscript>
            <div>
               <p>Relational database views over XML data provide conventional, relational access to XML content.</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="relational-views-over-XML-data.html#GUID-614FF4CF-E438-4DA7-A6EB-4B673A52A8CF">Introduction to Creating and Using Relational Views over XML Data</a><br>You can use the XML-specific functions and methods provided by Oracle XML&nbsp;DB to create conventional database views that provide relational access to XML content. This lets programmers, tools, and applications that understand Oracle Database, but not necessarily XML, work with XML content stored in the database. 
                  </li>
                  <li class="ulchildlink"><a href="relational-views-over-XML-data.html#GUID-72791BF5-0F8A-4164-9036-A8E1F920C3CF">Creating a Relational View over XML: One Row for Each XML Document</a><br>To expose each document in an <code class="codeph">XMLType</code> table as a row in a relational view, use <code class="codeph">CREATE OR REPLACE VIEW AS SELECT</code>, selecting from a join of the <code class="codeph">XMLType</code> table and a relational table that you create from the XML data using SQL/XML function <code class="codeph">XMLTable</code>. 
                  </li>
                  <li class="ulchildlink"><a href="relational-views-over-XML-data.html#GUID-E550E7D4-0D19-47CA-B86F-76825EE54CE1">Creating a Relational View over XML: Mapping XML Nodes to Columns</a><br>To expose data from multiple levels of an <code class="codeph">XMLType</code> table as individual rows in a relational view, apply SQL/XML function <code class="codeph">XMLTable</code> to each level. Use this technique whenever there is a one-to-<span class="italic">many</span> (1:N) relationship between documents in the <code class="codeph">XMLType</code> table and rows in the view.
                  </li>
                  <li class="ulchildlink"><a href="relational-views-over-XML-data.html#GUID-DFEC1462-BAD9-44CA-A9C4-88C27A0CD46C">Indexing Binary XML Data Exposed Using a Relational View</a><br>If the relational columns of the structured component of an <code class="codeph">XMLIndex</code> index over binary XML data match the columns of a relational view over that data, then the view too is effectively indexed.
                  </li>
                  <li class="ulchildlink"><a href="relational-views-over-XML-data.html#GUID-E01598F7-2AB9-406A-9C33-678943880812">Querying XML Content As Relational Data</a><br>Examples here show relational queries of XML data. They illustrate some of the benefits provided by creating relational views over <code class="codeph">XMLType</code> tables and columns.
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>Parent topic:</strong> <a href="relational-data-to-and-from-XML-data.html#GUID-52910135-EC23-41B2-97EC-116790BF6A3C" title="There are various ways that you can view existing relational data as XML data.">Relational Data To and From XML Data</a></p>
                  </div>
               </div>
            </div>
            <a id="ADXDB4134"></a><div class="props_rev_3"><a id="GUID-614FF4CF-E438-4DA7-A6EB-4B673A52A8CF" name="GUID-614FF4CF-E438-4DA7-A6EB-4B673A52A8CF"></a><h3 id="ADXDB-GUID-614FF4CF-E438-4DA7-A6EB-4B673A52A8CF" class="sect3"><span class="enumeration_section">9.1 </span>Introduction to Creating and Using Relational Views over XML Data
               </h3>
               <div>
                  <p>You can use the XML-specific functions and methods provided by Oracle XML&nbsp;DB to create conventional database views that provide relational access to XML content. This lets programmers, tools, and applications that understand Oracle Database, but not necessarily XML, work with XML content stored in the database. </p>
                  <p>The relational views can use XQuery expressions and SQL/XML functions such as <code class="codeph">XMLTable</code> to define a mapping between columns in the view and nodes in an XML document.
                  </p>
                  <div class="section"></div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="xquery-and-XML-DB.html#GUID-4F83A835-C94B-4D62-999B-111AB5E8A8F1" title="The XQuery language is one of the main ways that you interact with XML data in Oracle XML&nbsp;DB. Support for the language includes SQL*Plus commandXQUERY and SQL/XML functions XMLQuery, XMLTable, XMLExists, and XMLCast.">XQuery and Oracle XML&nbsp;DB</a></li>
                        <li><a href="indexes-for-XMLType-data.html#GUID-FE16BE28-035C-49EE-9683-6ED37876C3FC" title="You can create indexes on your XML data, to focus on particular parts of it that you query often and thus improve performance. There are various ways that you can index XMLType data, whether it is XML schema-based or non-schema-based, and regardless of the XMLType storage model you use.">Indexes for XMLType Data</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="relational-views-over-XML-data.html#GUID-420496CE-D62F-4EBE-A76E-861B932AE1E6" title="Relational database views over XML data provide conventional, relational access to XML content.">Relational Views over XML Data</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB4136"></a><a id="ADXDB4135"></a><div class="props_rev_3"><a id="GUID-72791BF5-0F8A-4164-9036-A8E1F920C3CF" name="GUID-72791BF5-0F8A-4164-9036-A8E1F920C3CF"></a><h3 id="ADXDB-GUID-72791BF5-0F8A-4164-9036-A8E1F920C3CF" class="sect3"><span class="enumeration_section">9.2 </span>Creating a Relational View over XML: One Row for Each XML Document
               </h3>
               <div>
                  <p>To expose each document in an <code class="codeph">XMLType</code> table as a row in a relational view, use <code class="codeph">CREATE OR REPLACE VIEW AS SELECT</code>, selecting from a join of the <code class="codeph">XMLType</code> table and a relational table that you create from the XML data using SQL/XML function <code class="codeph">XMLTable</code>. 
                  </p>
                  <div class="section">
                     <p>You use standard SQL/XML function <code class="codeph">XMLTable</code> to map nodes in the XML document to columns in the view. Use this technique whenever there is a one-to-<span class="italic">one</span> (1:1) relationship between documents in the <code class="codeph">XMLType</code> table and the rows in the view.
                     </p>
                     <p><a href="relational-views-over-XML-data.html#GUID-72791BF5-0F8A-4164-9036-A8E1F920C3CF__BJFCIHJE">Example 9-1</a> creates relational view <code class="codeph">purchaseorder_master_view</code>, which has one row for each row in <code class="codeph">XMLType</code> table <code class="codeph">po_binaryxml</code>. 
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-72791BF5-0F8A-4164-9036-A8E1F920C3CF__BJFCIHJE">
                     <p class="titleinexample">Example 9-1 Creating a Relational View of XML Content</p><pre class="pre codeblock"><code>CREATE TABLE po_binaryxml OF XMLType
  XMLTYPE STORE AS BINARY XML;

INSERT INTO po_binaryxml SELECT OBJECT_VALUE FROM OE.purchaseorder;

CREATE OR REPLACE VIEW <span class="bold">purchaseorder_master_view</span> AS
  SELECT <span class="bold">po.*</span>
    FROM po_binaryxml pur,
         XMLTable(
           '$p/PurchaseOrder' PASSING pur.OBJECT_VALUE as "p"
           COLUMNS
             reference       VARCHAR2(30)   PATH 'Reference',
             requestor       VARCHAR2(128)  PATH 'Requestor',
             userid          VARCHAR2(10)   PATH 'User',
             costcenter      VARCHAR2(4)    PATH 'CostCenter',
             ship_to_name    VARCHAR2(20)   PATH 'ShippingInstructions/name',
             ship_to_address VARCHAR2(256)  PATH 'ShippingInstructions/address',
             ship_to_phone   VARCHAR2(24)   PATH 'ShippingInstructions/telephone',
             instructions    VARCHAR2(2048) PATH 'SpecialInstructions') <span class="bold">po</span>;

View created.

DESCRIBE purchaseorder_master_view

Name            Null?    Type
--------------------------------------------
REFERENCE                VARCHAR2(30)
REQUESTOR                VARCHAR2(128)
USERID                   VARCHAR2(10)
COSTCENTER               VARCHAR2(4)
SHIP_TO_NAME             VARCHAR2(20)
SHIP_TO_ADDRESS          VARCHAR2(256)
SHIP_TO_PHONE            VARCHAR2(24)
INSTRUCTIONS             VARCHAR2(2048)
</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="relational-views-over-XML-data.html#GUID-420496CE-D62F-4EBE-A76E-861B932AE1E6" title="Relational database views over XML data provide conventional, relational access to XML content.">Relational Views over XML Data</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB4138"></a><a id="ADXDB4137"></a><div class="props_rev_3"><a id="GUID-E550E7D4-0D19-47CA-B86F-76825EE54CE1" name="GUID-E550E7D4-0D19-47CA-B86F-76825EE54CE1"></a><h3 id="ADXDB-GUID-E550E7D4-0D19-47CA-B86F-76825EE54CE1" class="sect3"><span class="enumeration_section">9.3 </span>Creating a Relational View over XML: Mapping XML Nodes to Columns
               </h3>
               <div>
                  <p>To expose data from multiple levels of an <code class="codeph">XMLType</code> table as individual rows in a relational view, apply SQL/XML function <code class="codeph">XMLTable</code> to each level. Use this technique whenever there is a one-to-<span class="italic">many</span> (1:N) relationship between documents in the <code class="codeph">XMLType</code> table and rows in the view.
                  </p>
                  <div class="section">
                     <p>That is, you use the same general approach as for breaking up a single level (see <a href="relational-views-over-XML-data.html#GUID-72791BF5-0F8A-4164-9036-A8E1F920C3CF" title="To expose each document in an XMLType table as a row in a relational view, use CREATE OR REPLACE VIEW AS SELECT, selecting from a join of the XMLType table and a relational table that you create from the XML data using SQL/XML function XMLTable.">Creating a Relational View over XML: One Row for Each XML Document</a>): Define the columns making up the view, and map the XML nodes to those columns. But in this case you apply <code class="codeph">XMLTable</code> to each document level that is to be broken up and stored in relational columns. 
                     </p>
                     <p>For example, each <code class="codeph">PurchaseOrder</code> element contains a <code class="codeph">LineItems</code> element, which in turn contains one or more <code class="codeph">LineItem</code> elements. Each <code class="codeph">LineItem</code> element has child elements, such as <code class="codeph">Description</code>, and an <code class="codeph">ItemNumber</code> attribute. To make such lower-level data accessible as a relational value, use <code class="codeph">XMLTable</code> to project both the <code class="codeph">PurchaseOrder</code> element and the <code class="codeph">LineItem</code> collection. 
                     </p>
                     <p>When element <code class="codeph">PurchaseOrder</code> is broken up, its descendant <code class="codeph">LineItem</code> element is mapped to a column of type <code class="codeph">XMLType</code>, which contains an XML fragment. That column is then passed to a second call to <code class="codeph">XMLTable</code> to be broken into its various parts as multiple columns of relational values.
                     </p>
                     <p><a href="relational-views-over-XML-data.html#GUID-E550E7D4-0D19-47CA-B86F-76825EE54CE1__CHDEEIFD">Example 9-2</a> illustrates this. It uses <code class="codeph">XMLTable</code> to effect a one-to-<span class="italic">many</span> (1:N) relationship between the documents in <code class="codeph">XMLType</code> table <code class="codeph">po_binaryxml</code> and the rows in relational view <code class="codeph">purchaseorder_detail_view</code>. The view provides access to the individual members of a collection and exposes the collection members as a set of rows.
                     </p>
                     <p>In <a href="relational-views-over-XML-data.html#GUID-E550E7D4-0D19-47CA-B86F-76825EE54CE1__CHDEEIFD">Example 9-2</a>, there is one row in view <code class="codeph">purchaseorder_detail_view</code> for each <code class="codeph">LineItem</code> element in the XML documents stored in <code class="codeph">XMLType</code> table <code class="codeph">po_binaryxml</code>. 
                     </p>
                     <p>The <code class="codeph">CREATE OR REPLACE VIEW</code> statement of <a href="relational-views-over-XML-data.html#GUID-E550E7D4-0D19-47CA-B86F-76825EE54CE1__CHDEEIFD">Example 9-2</a> defines the set of relational columns that make up the view. The <code class="codeph">SELECT</code> statement passes table <code class="codeph">po_binaryxml</code> as context to function <code class="codeph">XMLTable</code> to create virtual table <code class="codeph">p</code>, which has columns <code class="codeph">reference</code> and <code class="codeph">lineitem</code>. These columns contain the <code class="codeph">Reference</code> and <code class="codeph">LineItem</code> elements of the purchase-order documents, respectively. 
                     </p>
                     <p>Column <code class="codeph">lineitem</code> contains a collection of <code class="codeph">LineItem</code> elements as an <code class="codeph">XMLType</code> instance — one row for each element. These rows are in turn passed to a second <code class="codeph">XMLTable</code> expression to serve as its context. This second <code class="codeph">XMLTable</code> expression creates a virtual table of line-item rows, with columns corresponding to various descendant nodes of element <code class="codeph">LineItem</code>. Most of these descendants are attributes (<code class="codeph">ItemNumber</code>, <code class="codeph">Part/@Id</code>, and so on). One of the descendants is the child element <code class="codeph">Description</code>.
                     </p>
                     <p>Element <code class="codeph">Reference</code> is projected in view <code class="codeph">purchaseorder_detail_view</code> as column <code class="codeph">reference</code>. It provides a foreign key that can be used to join rows in view <code class="codeph">purchaseorder_detail_view</code> to corresponding rows in view <code class="codeph">purchaseorder_master_view</code>. The correlated join in the <code class="codeph">CREATE OR REPLACE VIEW</code> statement ensures that the one-to-many (1:N) relationship between element <code class="codeph">Reference</code> and the associated <code class="codeph">LineItem</code> elements is maintained whenever the view is accessed.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-E550E7D4-0D19-47CA-B86F-76825EE54CE1__CHDEEIFD">
                     <p class="titleinexample">Example 9-2 Accessing Individual Members of a Collection Using a View</p><pre class="oac_no_warn" dir="ltr">CREATE OR REPLACE VIEW <span class="bold">purchaseorder_detail_view</span> AS
  SELECT <span class="bold">po.reference</span>, <span class="bold">li.*</span>
    FROM po_binaryxml p,
         XMLTable('/PurchaseOrder' PASSING p.OBJECT_VALUE
                  COLUMNS
                    <span class="bold">reference</span> VARCHAR2(30) PATH 'Reference',
                    lineitem  XMLType      PATH 'LineItems/LineItem') <span class="bold">po</span>,
         XMLTable('/LineItem' PASSING po.lineitem
                  COLUMNS
                    itemno      NUMBER(38)    PATH '@ItemNumber',
                    description VARCHAR2(256) PATH 'Description',
                    partno      VARCHAR2(14)  PATH 'Part/@Id',
                    quantity    NUMBER(12, 2) PATH 'Part/@Quantity',
                    unitprice   NUMBER(8, 4)  PATH 'Part/@UnitPrice') <span class="bold">li</span>;

View created.

DESCRIBE purchaseorder_detail_view
Name           Null?    Type
----------------------------
REFERENCE               VARCHAR2(30)
ITEMNO                  NUMBER(38)
DESCRIPTION             VARCHAR2(256)
PARTNO                  VARCHAR2(14)
QUANTITY                NUMBER(12,2)
UNITPRICE               NUMBER(8,4)
</pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="relational-views-over-XML-data.html#GUID-420496CE-D62F-4EBE-A76E-861B932AE1E6" title="Relational database views over XML data provide conventional, relational access to XML content.">Relational Views over XML Data</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB6126"></a><a id="ADXDB6127"></a><a id="ADXDB6125"></a><div class="props_rev_3"><a id="GUID-DFEC1462-BAD9-44CA-A9C4-88C27A0CD46C" name="GUID-DFEC1462-BAD9-44CA-A9C4-88C27A0CD46C"></a><h3 id="ADXDB-GUID-DFEC1462-BAD9-44CA-A9C4-88C27A0CD46C" class="sect3"><span class="enumeration_section">9.4 </span>Indexing Binary XML Data Exposed Using a Relational View
               </h3>
               <div>
                  <p>If the relational columns of the structured component of an <code class="codeph">XMLIndex</code> index over binary XML data match the columns of a relational view over that data, then the view too is effectively indexed.
                  </p>
                  <div class="section">
                     <p>When the <code class="codeph">XMLType</code> data that is exposed in a relational view is stored as binary XML, you can typically improve performance by creating an <code class="codeph">XMLIndex</code> index that has a structured component that matches the view columns. Such an index projects parts of the XML data onto relational columns, just as the view does. When the columns of the index match the columns of the view, the view is itself indexed.
                     </p>
                     <p>To simplify the creation of such an <code class="codeph">XMLIndex</code> index, you can PL/SQL function <code class="codeph">DBMS_XMLSTORAGE_MANAGE.getSIDXDefFromView</code> to provide exactly the <code class="codeph">XMLTable</code> expression needed for creating the index. That is the sole purpose of this function: to return an <code class="codeph">XMLTable</code> expression that you can use to create an <code class="codeph">XMLIndex</code> index for a relational view. It takes the view as argument and returns a <code class="codeph">CLOB</code> instance. <a href="relational-views-over-XML-data.html#GUID-DFEC1462-BAD9-44CA-A9C4-88C27A0CD46C__BACDHEJH">Example 9-3</a> illustrates this. 
                     </p>
                     <p><a href="relational-views-over-XML-data.html#GUID-DFEC1462-BAD9-44CA-A9C4-88C27A0CD46C__BACDCDFI">Example 9-4</a> shows the <code class="codeph">XMLTable</code> expression used in <a href="relational-views-over-XML-data.html#GUID-DFEC1462-BAD9-44CA-A9C4-88C27A0CD46C__BACDHEJH">Example 9-3</a>.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-DFEC1462-BAD9-44CA-A9C4-88C27A0CD46C__GUID-AF4B1DCB-CFF7-4756-9BB7-EC47360DF2F4">
                        <p class="notep1">See Also:</p>
                        <p><a href="../arpls/DBMS_XMLSCHEMA_ANNOTATE.html#ARPLS74791" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for information about PL/SQL function <code class="codeph">DBMS_XMLSTORAGE_MANAGE.getSIDXDefFromView</code></p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-DFEC1462-BAD9-44CA-A9C4-88C27A0CD46C__BACDHEJH">
                     <p class="titleinexample">Example 9-3 XMLIndex Index that Matches Relational View Columns</p><pre class="oac_no_warn" dir="ltr">CALL DBMS_XMLINDEX.registerParameter(
  'my_param',
  DBMS_XMLSTORAGE_MANAGE.<span class="bold">getSIDXDefFromView</span>('PURCHASEORDER_MASTER_VIEW'));<a id="fn_1" name="fn_1" href="#fn_1" onclick="footdisplay(1, "The view-name argument to getSIDXDefFromView must be uppercase, because that is how the name is recorded.")"><sup>Foot&nbsp;1</sup></a>

CREATE INDEX my_idx on po_binaryxml (OBJECT_VALUE) INDEXTYPE IS XDB.XMLIndex
  PARAMETERS ('PARAM my_param');</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-DFEC1462-BAD9-44CA-A9C4-88C27A0CD46C__BACDCDFI">
                     <p class="titleinexample">Example 9-4 XMLTable Expression Returned by PL/SQL Function getSIDXDefFromView</p><pre class="oac_no_warn" dir="ltr">SELECT DBMS_XMLSTORAGE_MANAGE.getSIDXDefFromView('PURCHASEORDER_MASTER_VIEW')
  FROM DUAL;

XMLTABLE po_binaryxml_XTAB_1 '/PurchaseOrder' PASSING OBJECT_VALUE
  COLUMNS
    reference       VARCHAR2   (30) PATH 'Reference',
    requestor       VARCHAR2  (128) PATH 'Requestor',
    userid          VARCHAR2   (10) PATH 'User',
    costcenter      VARCHAR2    (4) PATH 'CostCenter',
    ship_to_name    VARCHAR2   (20) PATH 'ShippingInstructions/name',
    ship_to_address VARCHAR2  (256) PATH 'ShippingInstructions/address',
    ship_to_phone   VARCHAR2   (24) PATH 'ShippingInstructions/telephone',
    instructions    VARCHAR2 (2048) PATH 'SpecialInstructions'</pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="indexes-for-XMLType-data.html#GUID-476331FD-F58B-4980-BECD-015F0A794AC9" title="An XMLIndex structured component indexes specific islands of structure in your XML data.">Use of XMLIndex with a Structured Component</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="relational-views-over-XML-data.html#GUID-420496CE-D62F-4EBE-A76E-861B932AE1E6" title="Relational database views over XML data provide conventional, relational access to XML content.">Relational Views over XML Data</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="ADXDB4140"></a><a id="ADXDB6128"></a><a id="ADXDB4141"></a><a id="ADXDB4139"></a><div class="props_rev_3"><a id="GUID-E01598F7-2AB9-406A-9C33-678943880812" name="GUID-E01598F7-2AB9-406A-9C33-678943880812"></a><h3 id="ADXDB-GUID-E01598F7-2AB9-406A-9C33-678943880812" class="sect3"><span class="enumeration_section">9.5 </span>Querying XML Content As Relational Data
               </h3>
               <div>
                  <p>Examples here show relational queries of XML data. They illustrate some of the benefits provided by creating relational views over <code class="codeph">XMLType</code> tables and columns.
                  </p>
                  <div class="section">
                     <p><a href="relational-views-over-XML-data.html#GUID-E01598F7-2AB9-406A-9C33-678943880812__BJFCEJFA">Example 9-5</a> and <a href="relational-views-over-XML-data.html#GUID-E01598F7-2AB9-406A-9C33-678943880812__BACDJBDA">Example 9-6</a> show how to query master and detail relational views of XML data. <a href="relational-views-over-XML-data.html#GUID-E01598F7-2AB9-406A-9C33-678943880812__BJFCEJFA">Example 9-5</a> queries the master view to select the rows where column <code class="codeph">userid</code> starts with <code class="codeph">S</code>.
                     </p>
                     <p><a href="relational-views-over-XML-data.html#GUID-E01598F7-2AB9-406A-9C33-678943880812__BACDJBDA">Example 9-6</a> joins the master view and the detail view. It selects the <code class="codeph">purchaseorder_detail_view</code> rows where the value of column <code class="codeph">itemno</code> is <code class="codeph">1</code> and the corresponding <code class="codeph">purchaseorder_master_view</code> row contains a <code class="codeph">userid</code> column with the value <code class="codeph">SBELL</code>.
                     </p>
                     <p><a href="relational-views-over-XML-data.html#GUID-E01598F7-2AB9-406A-9C33-678943880812__BJFBEFDD">Example 9-7</a> shows how to use relational views over XML content to perform business-intelligence queries on XML documents. The example query selects <code class="codeph">PurchaseOrder</code> documents that contain orders for titles identified by UPC codes <code class="codeph">715515009058</code> and <code class="codeph">715515009126</code>. 
                     </p>
                     <p>The query in <a href="relational-views-over-XML-data.html#GUID-E01598F7-2AB9-406A-9C33-678943880812__BJFBEFDD">Example 9-7</a> determines the number of copies of each film title that are ordered in each <code class="codeph">PurchaseOrder</code> document. For example, for part number <code class="codeph">715515009126</code>, there are four <code class="codeph">PurchaseOrder</code> documents where one copy of the item is ordered and seven <code class="codeph">PurchaseOrder</code> documents where three copies of the item are ordered.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-E01598F7-2AB9-406A-9C33-678943880812__BJFCEJFA">
                     <p class="titleinexample">Example 9-5 Querying Master Relational View of XML Data</p><pre class="pre codeblock"><code>SELECT reference, costcenter, ship_to_name
  FROM purchaseorder_master_view
  WHERE userid LIKE 'S%';
 
REFERENCE                      COST SHIP_TO_NAME
------------------------------ ---- --------------
SBELL-20021009123336231PDT     S30  Sarah J. Bell
SBELL-20021009123336331PDT     S30  Sarah J. Bell
SKING-20021009123336321PDT     A10  Steven A. King
...
36 rows selected.
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-E01598F7-2AB9-406A-9C33-678943880812__BACDJBDA">
                     <p class="titleinexample">Example 9-6 Querying Master and Detail Relational Views of XML Data</p><pre class="pre codeblock"><code>SELECT d.reference, d.itemno, d.partno, d.description
  FROM purchaseorder_detail_view d, purchaseorder_master_view m
  WHERE m.reference = d.reference
    AND m.userid = 'SBELL'
    AND d.itemno = 1;

REFERENCE                          ITEMNO PARTNO         DESCRIPTION
------------------------------ ------------------------------------------------
SBELL-20021009123336231PDT              1 37429165829    Juliet of the Spirits
SBELL-20021009123336331PDT              1 715515009225   Salo
SBELL-20021009123337353PDT              1 37429141625    The Third Man
SBELL-20021009123338304PDT              1 715515009829   Nanook of the North
SBELL-20021009123338505PDT              1 37429122228    The 400 Blows
SBELL-20021009123335771PDT              1 37429139028    And the Ship Sails on
SBELL-20021009123335280PDT              1 715515011426   All That Heaven Allows
SBELL-2002100912333763PDT               1 715515010320   Life of Brian - Python
SBELL-2002100912333601PDT               1 715515009058   A Night to Remember
SBELL-20021009123336362PDT              1 715515012928   In the Mood for Love
SBELL-20021009123336532PDT              1 37429162422    Wild Strawberries
SBELL-20021009123338204PDT              1 37429168820    Red Beard
SBELL-20021009123337673PDT              1 37429156322    Cries and Whispers

13 rows selected.
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-E01598F7-2AB9-406A-9C33-678943880812__BJFBEFDD">
                     <p class="titleinexample">Example 9-7 Business-Intelligence Query of XML Data Using a View</p><pre class="pre codeblock"><code>SELECT partno, count(*) "No of Orders", quantity "No of Copies"
  FROM purchaseorder_detail_view
  WHERE partno IN (715515009126, 715515009058)
  GROUP BY rollup(partno, quantity);
 
PARTNO         No of Orders No of Copies
-------------- ------------ ------------
715515009058              7            1
715515009058              9            2
715515009058              5            3
715515009058              2            4
715515009058             23
715515009126              4            1
715515009126              7            3
715515009126             11
                         34 
9 rows selected.
</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="relational-views-over-XML-data.html#GUID-420496CE-D62F-4EBE-A76E-861B932AE1E6" title="Relational database views over XML data provide conventional, relational access to XML content.">Relational Views over XML Data</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <hr><br><p style="text-decoration:underline">Footnote Legend</p>Footnote&nbsp;1: 
            <p>The view-name argument to <code class="codeph">getSIDXDefFromView</code> must be uppercase, because that is how the name is recorded.
            </p><br></div>
      </article>
   </body>
</html>