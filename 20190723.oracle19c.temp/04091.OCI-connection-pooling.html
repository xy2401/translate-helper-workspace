<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>OCI Connection Pooling</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="JDBC Developer's Guide">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="JDBC Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="jdbc-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-02-13T13:20:37-08:00">
      <meta name="dcterms.title" content="JDBC Developer's Guide">
      <meta name="dcterms.dateCopyrighted" content="1999, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96471-02">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="high-speed-ingestion-of-data-streams.html" title="Previous" type="text/html">
      <link rel="next" href="database-resident-connection-pooling.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="JJDBC">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="high-speed-ingestion-of-data-streams.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="database-resident-connection-pooling.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">JDBC Developer's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="performance-and-scalability.html" property="item" typeof="WebPage"><span property="name"> Performance and Scalability</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> OCI Connection Pooling </li>
            </ol>
            <a id="GUID-B861DEA4-3E3E-4882-B42F-6A0EE949F907" name="GUID-B861DEA4-3E3E-4882-B42F-6A0EE949F907"></a><a id="JJDBC28789"></a>
            
            <h2 id="JJDBC-GUID-B861DEA4-3E3E-4882-B42F-6A0EE949F907" class="sect2"><span class="enumeration_chapter">23 </span> OCI Connection Pooling 
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>The Java Database Connectivity (JDBC) Oracle Call Interface (OCI) driver connection pooling functionality is part of the JDBC client. This functionality is provided by the <code class="codeph">OracleOCIConnectionPool</code> class.
               </p>
               <p>A JDBC application can have multiple pools at the same time. Multiple pools can correspond to multiple application servers or pools to different data sources. The connection pooling provided by the JDBC OCI driver enables applications to have multiple logical connections, all using a small set of physical connections. Each call on a logical connection gets routed on to the physical connection that is available at the time of call.</p>
               <p>This chapter contains the following sections:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="OCI-connection-pooling.html#GUID-8E4B0445-1B24-4D23-AAB1-5018F107914F">Background of OCI Driver Connection Pooling</a></p>
                  </li>
                  <li>
                     <p><a href="OCI-connection-pooling.html#GUID-399A9847-0DA8-4902-A0C9-61707C805466">Comparison Between OCI Driver Connection Pooling and Shared Servers</a></p>
                  </li>
                  <li>
                     <p><a href="OCI-connection-pooling.html#GUID-C45E9327-CFF5-4548-8C76-9FB419287ED5">About Defining an OCI Connection Pool</a></p>
                  </li>
                  <li>
                     <p><a href="OCI-connection-pooling.html#GUID-359ADFD2-2E7F-4818-A8B9-0E0057F2E918">About Connecting to an OCI Connection Pool</a></p>
                  </li>
                  <li>
                     <p><a href="OCI-connection-pooling.html#GUID-9BB4A52B-FE60-442B-8795-BEF3CE0CD621">Sample Code for OCI Connection Pooling</a></p>
                  </li>
                  <li>
                     <p><a href="OCI-connection-pooling.html#GUID-BA93E5C6-55DC-459D-82A7-E6DD38394CDE">Statement Handling and Caching</a></p>
                  </li>
                  <li>
                     <p><a href="OCI-connection-pooling.html#GUID-AC4883A3-9508-450A-9F98-CDE41D92027A">JNDI and the OCI Connection Pool</a></p>
                  </li>
               </ul>
               <div class="infoboxnote" id="GUID-B861DEA4-3E3E-4882-B42F-6A0EE949F907__GUID-9C1FFBA7-CFFF-4A93-A107-606CBD0EDC5A">
                  <p class="notep1">Note:</p>
                  <p>Use OCI connection pooling if you need session multiplexing. Otherwise, Oracle recommends using Universal Connection Pool.</p>
               </div>
            </div><a id="JJDBC28790"></a><div class="props_rev_3"><a id="GUID-8E4B0445-1B24-4D23-AAB1-5018F107914F" name="GUID-8E4B0445-1B24-4D23-AAB1-5018F107914F"></a><h3 id="JJDBC-GUID-8E4B0445-1B24-4D23-AAB1-5018F107914F" class="sect3"><span class="enumeration_section">23.1 </span>Background of OCI Driver Connection Pooling
               </h3>
               <div>
                  <p>The Oracle JDBC OCI driver provides several transaction monitor capabilities, such as the fine-grained management of Oracle sessions and connections. It is possible for a high-end application server or transaction monitor to multiplex several sessions over fewer physical connections on a call-level basis, thereby achieving a high degree of scalability by pooling of connections and back-end Oracle server processes.</p>
                  <p>The connection pooling provided by the <code class="codeph">OracleOCIConnectionPool</code> interface simplifies the session/connection separation interface hiding the management of the physical connection pool. The Oracle sessions are the <code class="codeph">OracleOCIConnection</code> objects obtained from <code class="codeph">OracleOCIConnectionPool</code>. The connection pool itself is usually configured with a much smaller shared pool of physical connections, translating to a back-end server pool containing an identical number of dedicated server processes. Note that many more Oracle sessions can be multiplexed over this pool of fewer shared connections and back-end Oracle processes.
                  </p>
               </div>
            </div><a id="JJDBC28791"></a><div class="props_rev_3"><a id="GUID-399A9847-0DA8-4902-A0C9-61707C805466" name="GUID-399A9847-0DA8-4902-A0C9-61707C805466"></a><h3 id="JJDBC-GUID-399A9847-0DA8-4902-A0C9-61707C805466" class="sect3"><span class="enumeration_section">23.2 </span>Comparison Between OCI Driver Connection Pooling and Shared Servers
               </h3>
               <div>
                  <p>In some ways, what OCI driver connection pooling offers on the middle tier is similar to what shared server processes offer on the back end. OCI driver connection pooling makes a dedicated server instance behaves as a shared instance by managing the session multiplexing logic on the middle tier. Therefore, the pooling of dedicated server processes and incoming connections into the dedicated server processes is controlled by the OCI connection pool on the middle tier. </p>
                  <p>The main difference between OCI connection pooling and shared servers is that in the case of shared servers, the connection from the client is typically to a dispatcher in the database instance. The dispatcher is responsible for directing the client request to an appropriate shared server. On the other hand, the physical connection from the OCI connection pool is established directly from the middle tier to the Oracle dedicated server process in the back-end server pool. </p>
                  <p>Note that OCI connection pool is mainly beneficial only if the middle tier is multithreaded. Each thread could maintain a session to the database. The actual connections to the database are maintained by <code class="codeph">OracleOCIConnectionPool</code>, and these connections, including the pool of dedicated database server processes, are shared among all the threads in the middle tier.
                  </p>
               </div>
            </div><a id="JJDBC28792"></a><div class="props_rev_3"><a id="GUID-C45E9327-CFF5-4548-8C76-9FB419287ED5" name="GUID-C45E9327-CFF5-4548-8C76-9FB419287ED5"></a><h3 id="JJDBC-GUID-C45E9327-CFF5-4548-8C76-9FB419287ED5" class="sect3"><span class="enumeration_section">23.3 </span>About Defining an OCI Connection Pool
               </h3>
               <div>
                  <p>This section describes the following concepts:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="OCI-connection-pooling.html#GUID-4EF0F14B-AC53-4BB1-9204-4ED3036A1A7D">Overview of Creating an OCI Connection Pool</a></p>
                     </li>
                     <li>
                        <p><a href="OCI-connection-pooling.html#GUID-C672201C-26FA-4FDD-ACBF-2D98C1F9BFFB">Importing the oracle.jdbc.pool and oracle.jdbc.oci Packages</a></p>
                     </li>
                     <li>
                        <p><a href="OCI-connection-pooling.html#GUID-331E646C-4AB1-4A0C-8DF2-150326C7A68E">Creating an OCI Connection Pool</a></p>
                     </li>
                     <li>
                        <p><a href="OCI-connection-pooling.html#GUID-C4717067-3D09-4E07-B981-6B729A5B54CB">Setting the OCI Connection Pool Parameters</a></p>
                     </li>
                     <li>
                        <p><a href="OCI-connection-pooling.html#GUID-4DE39D85-3CC4-48F5-A55E-8E33175CF97E">Checking the OCI Connection Pool Status</a></p>
                     </li>
                  </ul>
               </div>
               <div class="props_rev_3"><a id="GUID-4EF0F14B-AC53-4BB1-9204-4ED3036A1A7D" name="GUID-4EF0F14B-AC53-4BB1-9204-4ED3036A1A7D"></a><h4 id="JJDBC-GUID-4EF0F14B-AC53-4BB1-9204-4ED3036A1A7D" class="sect4"><span class="enumeration_section">23.3.1 </span>Overview of Creating an OCI Connection Pool
                  </h4>
                  <div>
                     <p>An OCI connection pool is created at the beginning of the application. Creating connections from a pool is quite similar to creating connections using the <code class="codeph">OracleDataSource</code> class.
                     </p>
                     <p>The <code class="codeph">oracle.jdbc.pool.OracleOCIConnectionPool</code> class, which extends the <code class="codeph">OracleDataSource</code> class, is used to create OCI connection pools. From an <code class="codeph">OracleOCIConnectionPool</code> instance, you can obtain logical connection objects. These connection objects are of the <code class="codeph">OracleOCIConnection</code> class type. This class implements the <code class="codeph">OracleConnection</code> interface. The <code class="codeph">Statement</code> objects you create from the <code class="codeph">OracleOCIConnection</code> instance have the same fields and methods as <code class="codeph">OracleStatement</code> objects you create from <code class="codeph">OracleConnection</code> instances.
                     </p>
                     <p>The following code shows header information for the <code class="codeph">OracleOCIConnectionPool</code> class:
                     </p><pre class="oac_no_warn" dir="ltr">/* 
   * @param us  ConnectionPool user-id. 
   * @param p   ConnectionPool password 
   * @param name  logical name of the pool. This needs to be one in the 
   *                   tnsnames.ora configuration file. 
     @param config (optional)  Properties of the pool, if the default does not 
                suffice. Default connection configuration is min =1, max=1,
                incr=0 
                  Please refer setPoolConfig for property names. 

                 Since this is optional, pass null if the default configuration 
                 suffices. 

   * @return 
   * 
   * Notes: Choose a userid and password that can act as proxy for the users 
   *        in the getProxyConnection() method. 

            If config is null, then the following default values will take
            effect 
            CONNPOOL_MIN_LIMIT = 1 
            CONNPOOL_MAX_LIMIT = 1 
            CONNPOOL_INCREMENT = 0 

*/ 

public synchronized OracleOCIConnectionPool 
  (String       user,    String   password,  String name, Properties config) 
  throws SQLException 

/* 
 * This will use the user-id, password and connection pool name values set 
   LATER using the methods setUser, setPassword, setConnectionPoolName. 

 * @return 
 * 
 * Notes: 

     No OracleOCIConnection objects can be created on 
     this class unless the methods setUser, setPassword, setPoolConfig 
     are invoked. 
     When invoking the setUser, setPassword later, choose a userid and 
     password that can act as proxy for the users 
 *   in the getProxyConnection() method. 
 */ 
  public synchronized OracleOCIConnectionPool () 
    throws SQLException 
</pre></div>
               </div>
               <div class="props_rev_3"><a id="GUID-C672201C-26FA-4FDD-ACBF-2D98C1F9BFFB" name="GUID-C672201C-26FA-4FDD-ACBF-2D98C1F9BFFB"></a><h4 id="JJDBC-GUID-C672201C-26FA-4FDD-ACBF-2D98C1F9BFFB" class="sect4"><span class="enumeration_section">23.3.2 </span>Importing the oracle.jdbc.pool and oracle.jdbc.oci Packages
                  </h4>
                  <div>
                     <div class="section">
                        <p>Before you create an OCI connection pool, import the following to have Oracle OCI connection pooling functionality:</p><pre class="oac_no_warn" dir="ltr">import oracle.jdbc.pool.*;
import oracle.jdbc.oci.*;
</pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-331E646C-4AB1-4A0C-8DF2-150326C7A68E" name="GUID-331E646C-4AB1-4A0C-8DF2-150326C7A68E"></a><h4 id="JJDBC-GUID-331E646C-4AB1-4A0C-8DF2-150326C7A68E" class="sect4"><span class="enumeration_section">23.3.3 </span>Creating an OCI Connection Pool
                  </h4>
                  <div>
                     <div class="section">
                        <p>The following code show how you create an instance of the <code class="codeph">OracleOCIConnectionPool</code> class called <code class="codeph">cpool</code>:
                        </p><pre class="oac_no_warn" dir="ltr">OracleOCIConnectionPool cpool = new OracleOCIConnectionPool
    ("HR", "hr", "jdbc:oracle:oci:@(description=(address=(host=
    localhost)(protocol=tcp)(port=5221))(connect_data=(INSTANCE_NAME=orcl)))",
    poolConfig);
</pre><p><code class="codeph">poolConfig</code> is a set of properties that specify the connection pool. If <code class="codeph">poolConfig</code> is null, then the default values are used. For example, consider the following:
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">poolConfig.put (OracleOCIConnectionPool.CONNPOOL_MIN_LIMIT, "4");</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">poolConfig.put (OracleOCIConnectionPool.CONNPOOL_MAX_LIMIT, "10");</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">poolConfig.put (OracleOCIConnectionPool.CONNPOOL_INCREMENT, "2");</code></p>
                           </li>
                        </ul>
                        <p>As an alternative to the constructor call, you can create an instance of the <code class="codeph">OracleOCIConnectionPool</code> class using individual methods to specify the user, password, and connection string.
                        </p><pre class="oac_no_warn" dir="ltr">OracleOCIConnectionPool cpool = new OracleOCIConnectionPool ( );
cpool.setUser("HR");
cpool.setPassword("hr");
cpool.setURL("jdbc:oracle:oci:@(description=(address=(host=
    localhost)(protocol=tcp)(port=5221))(connect_data=(INSTANCE_NAME=orcl)))");
cpool.setPoolConfig(poolConfig);  // In case you want to specify a different 
                                  // configuration other than the default 
                                  // values.
</pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-C4717067-3D09-4E07-B981-6B729A5B54CB" name="GUID-C4717067-3D09-4E07-B981-6B729A5B54CB"></a><h4 id="JJDBC-GUID-C4717067-3D09-4E07-B981-6B729A5B54CB" class="sect4"><span class="enumeration_section">23.3.4 </span>Setting the OCI Connection Pool Parameters
                  </h4>
                  <div>
                     <div class="section">
                        <p>The connection pool configuration is determined by the following <code class="codeph">OracleOCIConnectionPool</code> class attributes:
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">CONNPOOL_MIN_LIMIT</code> 
                              </p>
                              <p>Specifies the minimum number of physical connections that can be maintained by the pool.</p>
                           </li>
                           <li>
                              <p><code class="codeph">CONNPOOL_MAX_LIMIT</code> 
                              </p>
                              <p>Specifies the maximum number of physical connections that can be maintained by the pool.</p>
                           </li>
                           <li>
                              <p><code class="codeph">CONNPOOL_INCREMENT</code> 
                              </p>
                              <p>Specifies the incremental number of physical connections to be opened when all the existing ones are busy and a call needs one more connection; the increment is done only when the total number of open physical connections is less than the maximum number that can be opened in that pool.</p>
                           </li>
                           <li>
                              <p><code class="codeph">CONNPOOL_TIMEOUT</code> 
                              </p>
                              <p>Specifies how much time must pass before an idle physical connection is disconnected; this does not affect a logical connection.</p>
                           </li>
                           <li>
                              <p><code class="codeph">CONNPOOL_NOWAIT</code> 
                              </p>
                              <p>Specifies, if enabled, that an error is returned if a call needs a physical connection while the maximum number of connections in the pool are busy. If disabled, a call waits until a connection is available. Once this attribute is set to <code class="codeph">true</code>, it cannot be reset to <code class="codeph">false</code>.
                              </p>
                           </li>
                        </ul>
                        <p>You can configure all of these attributes dynamically. Therefore, an application has the flexibility of reading the current load, that is number of open connections and number of busy connections, and adjusting these attributes appropriately, using the <code class="codeph">setPoolConfig</code> method.
                        </p>
                        <div class="infoboxnote" id="GUID-C4717067-3D09-4E07-B981-6B729A5B54CB__GUID-B4D26142-87EC-4E06-86E9-13457B3F2593">
                           <p class="notep1">Note:</p>
                           <p>The default values for the <code class="codeph">CONNPOOL_MIN_LIMIT</code>, <code class="codeph">CONNPOOL_MAX_LIMIT</code>, and <code class="codeph">CONNPOOL_INCREMENT</code> parameters are <code class="codeph">1</code>, <code class="codeph">1</code>, and <code class="codeph">0</code>, respectively.
                           </p>
                        </div>
                        <p>The <code class="codeph">setPoolConfig</code> method is used to configure OCI connection pool properties. The following is a typical example of how the <code class="codeph">OracleOCIConnectionPool</code> class attributes can be set:<a id="d70197e440" class="indexterm-anchor"></a></p><pre class="oac_no_warn" dir="ltr">...
java.util.Properties p  = new java.util.Properties( );
p.put (OracleOCIConnectionPool.CONNPOOL_MIN_LIMIT, "1");
p.put (OracleOCIConnectionPool.CONNPOOL_MAX_LIMIT, "5");
p.put (OracleOCIConnectionPool.CONNPOOL_INCREMENT, "2");
p.put (OracleOCIConnectionPool.CONNPOOL_TIMEOUT, "10");
p.put (OracleOCIConnectionPool.CONNPOOL_NOWAIT, "true");
cpool.setPoolConfig(p);
...
</pre><p>Observe the following rules when setting these attributes:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">CONNPOOL_MIN_LIMIT</code>, <code class="codeph">CONNPOOL_MAX_LIMIT</code>, and <code class="codeph">CONNPOOL_INCREMENT</code> are mandatory.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">CONNPOOL_MIN_LIMIT</code> must be a value greater than zero.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">CONNPOOL_MAX_LIMIT</code> must be a value greater than or equal to <code class="codeph">CONNPOOL_MIN_LIMIT</code> plus <code class="codeph">CONNPOOL_INCREMENT</code>.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">CONNPOOL_INCREMENT</code> must be a value greater than or equal to zero.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">CONNPOOL_TIMEOUT</code> must be a value greater than zero.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">CONNPOOL_NOWAIT</code> must be <code class="codeph">true</code> or <code class="codeph">false.</code></p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-C4717067-3D09-4E07-B981-6B729A5B54CB__GUID-EAD851E9-5612-4B33-B0D7-EABD78A37A26">
                           <p class="notep1">See Also:</p>
                           <p><a href="../lnoci/session-and-connection-pooling.html#LNOCI091" target="_blank"><span class="italic">Oracle Call Interface Programmer's Guide</span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="JJDBC28796"></a><div class="props_rev_3"><a id="GUID-4DE39D85-3CC4-48F5-A55E-8E33175CF97E" name="GUID-4DE39D85-3CC4-48F5-A55E-8E33175CF97E"></a><h4 id="JJDBC-GUID-4DE39D85-3CC4-48F5-A55E-8E33175CF97E" class="sect4"><span class="enumeration_section">23.3.5 </span>Checking the OCI Connection Pool Status
                  </h4>
                  <div>
                     <div class="section">
                        <p class="subhead3" id="GUID-4DE39D85-3CC4-48F5-A55E-8E33175CF97E__GUID-2CA51A7C-6ABE-4B49-9DB8-F4DEA6BF1ED9"></p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>To check the status of the connection pool, use the following methods from the <code class="codeph">OracleOCIConnectionPool</code> class:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">int getMinLimit()</code></p>
                              <p>Retrieves the minimum number of physical connections that can be maintained by the pool.</p>
                           </li>
                           <li>
                              <p><code class="codeph">int getMaxLimit()</code></p>
                              <p>Retrieves the maximum number of physical connections that can be maintained by the pool.</p>
                           </li>
                           <li>
                              <p><code class="codeph">int getConnectionIncrement()</code></p>
                              <p>Retrieves the incremental number of physical connections to be opened when all the existing ones are busy and a call needs a connection.</p>
                           </li>
                           <li>
                              <p><code class="codeph">int getTimeout()</code></p>
                              <p>Retrieves the specified time (in seconds) that a physical connection in a pool can remain idle before it is disconnected; the age of a connection is based on the <a id="d70197e555" class="indexterm-anchor"></a>Least Recently Used (LRU) algorithm.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">String getNoWait()</code></p>
                              <p>Retrieves if the <code class="codeph">NOWAIT</code> property is enabled. It returns a string of "<code class="codeph">true</code>" or "<code class="codeph">false</code>".
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">int getPoolSize()</code></p>
                              <p>Retrieves the number of physical connections that are open. This should be used only as an estimate and for statistical analysis.</p>
                           </li>
                           <li>
                              <p><code class="codeph">int getActiveSize()</code></p>
                              <p>Retrieves the number of physical connections that are open and busy. This should be used only as an estimate and for statistical analysis.</p>
                           </li>
                           <li>
                              <p><code class="codeph">boolean isPoolCreated()</code></p>
                              <p>Retrieves if the pool has been created. The pool is actually created when <code class="codeph">OracleOCIConnection(user, password, url, poolConfig)</code> is called or when <code class="codeph">setUser</code>, <code class="codeph">setPassword</code>, and <code class="codeph">setURL</code> has been done after calling <code class="codeph">OracleOCIConnection()</code>.
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="JJDBC28797"></a><div class="props_rev_3"><a id="GUID-359ADFD2-2E7F-4818-A8B9-0E0057F2E918" name="GUID-359ADFD2-2E7F-4818-A8B9-0E0057F2E918"></a><h3 id="JJDBC-GUID-359ADFD2-2E7F-4818-A8B9-0E0057F2E918" class="sect3"><span class="enumeration_section">23.4 </span>About Connecting to an OCI Connection Pool
               </h3>
               <div>
                  <p>The <code class="codeph">OracleOCIConnectionPool</code> class, through a <code class="codeph">getConnection</code> method call, creates an instance of the <code class="codeph">OracleOCIConnection</code> class. This instance represents a connection.
                  </p>
                  <p>Because the <code class="codeph">OracleOCIConnection</code> class extends <code class="codeph">OracleConnection</code> class, it has the functionality of this class too. Close the <code class="codeph">OracleOCIConnection</code> objects once the user session is over, otherwise, they are closed when the pool instance is closed.
                  </p>
                  <p>There are two ways of calling <code class="codeph">getConnection</code>: 
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><code class="codeph">OracleConnection getConnection()</code></p>
                        <p>If you do not supply the user name and password, then the default user name and password used for the creation of the connection pool are used while creating the connection objects.</p>
                     </li>
                     <li>
                        <p><code class="codeph">OracleConnection getConnection(String user, String password)</code></p>
                        <p>If you this method, you will get a logical connection identified with the specified user name and password, which can be different from that used for pool creation.</p>
                     </li>
                  </ul>
                  <p>The following code shows the signatures of the overloaded <code class="codeph">getConnection</code> method:
                  </p><pre class="oac_no_warn" dir="ltr">public synchronized OracleConnection getConnection( ) 
                    throws SQLException 

/* 
 * For getting a connection to the database. 
 * 
 * @param us  Connection user-id 
 * @param p   Connection password 
 * @return     connection object 
 */ 
public synchronized OracleConnection getConnection(String us, String p) 
throws SQLException 
</pre><p>As an enhancement to <code class="codeph">OracleConnection</code>, the following new method is added into <code class="codeph">OracleOCIConnection</code> as a way to change the password for the user: 
                  </p><pre class="oac_no_warn" dir="ltr">void passwordChange (String user, String oldPassword, String newPassword) 
</pre></div>
            </div><a id="JJDBC28798"></a><div class="props_rev_3"><a id="GUID-9BB4A52B-FE60-442B-8795-BEF3CE0CD621" name="GUID-9BB4A52B-FE60-442B-8795-BEF3CE0CD621"></a><h3 id="JJDBC-GUID-9BB4A52B-FE60-442B-8795-BEF3CE0CD621" class="sect3"><span class="enumeration_section">23.5 </span>Sample Code for OCI Connection Pooling
               </h3>
               <div>
                  <div class="section">
                     <p>The following code illustrates the use of OCI connection pooling in a sample application:</p><pre class="oac_no_warn" dir="ltr">import java.sql.DriverManager;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.Properties;
import oracle.jdbc.OracleDriver;
import oracle.jdbc.pool.OracleOCIConnectionPool;
 
public class conPoolAppl extends Thread
{
  public static final String query = "SELECT object_name FROM all_objects WHERE rownum &lt; 300";
  static public void main(String args[]) throws SQLException
  {
    int _maxCount = 10;
    Connection []conn = new Connection[_maxCount];
    try
    {
      String s = null;   //System.getProperty ("JDBC_URL");
      String url = "jdbc:oracle:oci8:@localhost";
      OracleOCIConnectionPool cpool = new OracleOCIConnectionPool("HR", "hr", url, null);
 
      // Print out the default configuration for the OracleOCIConnectionPool
      System.out.println ("-- The default configuration for the OracleOCIConnectionPool --");
      displayPoolConfig(cpool);
 
      //Set up the initial pool configuration
      Properties p1  = new Properties();
      p1.put (OracleOCIConnectionPool.CONNPOOL_MIN_LIMIT, Integer.toString(1));
      p1.put (OracleOCIConnectionPool.CONNPOOL_MAX_LIMIT, Integer.toString(_maxCount));
      p1.put (OracleOCIConnectionPool.CONNPOOL_INCREMENT, Integer.toString(1));
  
      // Enable the initial configuration
      cpool.setPoolConfig(p1);
 
      Thread []t = new Thread[_maxCount];
      for (int i = 0; i &lt; _maxCount; ++i)
      {
        conn[i] = cpool.getConnection("HR", "hr");
        if ( conn[i] == null )
        {
          System.out.println("Unable to create connection.");
          return;
        }
        t[i] = new conPoolAppl (i, conn[i]);
        t[i].start ();
        //displayPoolConfig(cpool);
      }
 
      ((conPoolAppl)t[0]).startAllThreads ();
      try 
      { 
        Thread.sleep (200); 
      } 
      catch (Exception ea) {}
 
      displayPoolConfig(cpool);
      for (int i = 0; i &lt; _maxCount; ++i)
        t[i].join ();
    }
    catch(Exception ex)
    {
      System.out.println("Error: " + ex);
      ex.printStackTrace ();
      return;
    } 
    finally
    {
      for (int i = 0; i &lt; _maxCount; ++i)
        if (conn[i] != null)
        conn[i].close ();
    }
  } //end of main
 
  private Connection m_conn;
  private static boolean m_startThread = false;
  private int m_threadId;
  
  public conPoolAppl (int i, Connection conn)
  {
    m_threadId = i;
    m_conn = conn;
  }
 
  public void startAllThreads ()
  {
    m_startThread = true;
  }
 
  public void run ()
  {
    while (!m_startThread) Thread.yield ();
    try
    {
      doQuery (m_conn);
    }
    catch (SQLException ea)
    {
      System.out.println ("*** Thread id: " + m_threadId);
      ea.printStackTrace ();
    }
  } // end of run
 
  private static void doQuery (Connection conn) throws SQLException
  {
    PreparedStatement pstmt = null;
    ResultSet rs = null;
    try
    {
      pstmt = conn.prepareStatement (query);
      rs = pstmt.executeQuery ();
      while (rs.next ())
      {
        //System.out.println ("Object name: " +rs.getString (1));
      }
    }
    catch (Exception ea)
    {
      System.out.println ("Error during execution: " +ea);
      ea.printStackTrace ();
    }
    finally
    {
      if (rs != null)
        rs.close ();
      if (pstmt != null)
        pstmt.close ();
      if (conn != null)
        conn.close ();
    }
  }  // end of doQuery (Connection)
 
  // Display the current status of the OracleOCIConnectionPool
  private static void displayPoolConfig (OracleOCIConnectionPool cpool) throws SQLException
  {
    System.out.println (" Min poolsize Limit: " + cpool.getMinLimit());
    System.out.println (" Max poolsize Limit: " + cpool.getMaxLimit());
  /*
    System.out.println (" Connection Increment: " + cpool.getConnectionIncrement());
    System.out.println (" NoWait: " + cpool.getNoWait());
    System.out.println (" Timeout: " + cpool.getTimeout());
  */
    System.out.println (" PoolSize: " + cpool.getPoolSize());
    System.out.println (" ActiveSize: " + cpool.getActiveSize());
  }
 
}  // end of class conPoolAppl
</pre></div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDBC28799"></a><div class="props_rev_3"><a id="GUID-BA93E5C6-55DC-459D-82A7-E6DD38394CDE" name="GUID-BA93E5C6-55DC-459D-82A7-E6DD38394CDE"></a><h3 id="JJDBC-GUID-BA93E5C6-55DC-459D-82A7-E6DD38394CDE" class="sect3"><span class="enumeration_section">23.6 </span>Statement Handling and Caching
               </h3>
               <div>
                  <div class="section">
                     <p>Statement caching is supported with <code class="codeph">OracleOCIConnectionPool</code>. The caching improves performance by not having to open, parse, and close cursors. When <code class="codeph">OracleOCIConnection.prepareStatement</code> ("<span class="italic"><code class="codeph">a_SQL_query</code></span>") is processed, the statement cache is searched for a statement that matches the SQL query. If a match is found, then you can reuse the <code class="codeph">Statement</code> object instead of incurring the cost of creating another <code class="codeph">Statement</code> object. The cache size can be dynamically increased or decreased. The default cache size is zero.
                     </p>
                     <div class="infoboxnote" id="GUID-BA93E5C6-55DC-459D-82A7-E6DD38394CDE__GUID-790D2E4D-31AA-4DF7-8EC6-2ABEB84E4EFE">
                        <p class="notep1">Note:</p>
                        <p>The <code class="codeph">OracleStatement</code> object created from <code class="codeph">OracleOCIConnection</code> has the same behavior as one that is created from <code class="codeph">OracleConnection</code>.
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDBC28800"></a><div class="props_rev_3"><a id="GUID-AC4883A3-9508-450A-9F98-CDE41D92027A" name="GUID-AC4883A3-9508-450A-9F98-CDE41D92027A"></a><h3 id="JJDBC-GUID-AC4883A3-9508-450A-9F98-CDE41D92027A" class="sect3"><span class="enumeration_section">23.7 </span>JNDI and the OCI Connection Pool
               </h3>
               <div>
                  <div class="section">
                     <p>The Java Naming and Directory Interface (JNDI) feature makes the properties of a Java object persist, therefore these properties can be used to construct a new instance of the object, such as cloning the object. The benefit is that the old object can be freed, and at a later time a new object with exactly the same properties can be created. The <code class="codeph">InitialContext.bind</code> method makes the properties persist, either on file or in a database, while the <code class="codeph">InitialContext.lookup</code> method retrieves the properties from the persistent store and creates a new object with these properties. 
                     </p>
                     <p><code class="codeph">OracleOCIConnectionPool</code> objects can be bound and looked up using the JNDI feature. No new interface calls in <code class="codeph">OracleOCIConnectionPool</code> are necessary.
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>