<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Performing RMAN Recovery: Advanced Scenarios</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Backup and Recovery User's Guide">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Backup and Recovery User's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96241-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="rman-block-media-recovery.html" title="Previous" type="text/html">
      <link rel="next" href="performing-rman-tspitr.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User's Guide">
    <meta name="dcterms.isVersionOf" content="BRADV">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="rman-block-media-recovery.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="performing-rman-tspitr.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Backup and Recovery User's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-diagnosing-responding-failures.html" property="item" typeof="WebPage"><span property="name"> Diagnosing and Responding to Failures </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Performing RMAN Recovery: Advanced Scenarios</li>
            </ol>
            <a id="GUID-EA9DB3ED-2481-47DD-908B-A314D5C3F730" name="GUID-EA9DB3ED-2481-47DD-908B-A314D5C3F730"></a><a id="BRADV008"></a>
            
            <h2 id="BRADV-GUID-EA9DB3ED-2481-47DD-908B-A314D5C3F730" class="sect2"><span class="enumeration_chapter">20 </span> Performing RMAN Recovery: Advanced Scenarios
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>The preceding chapters in <a href="part-diagnosing-responding-failures.html#GUID-ED89DC53-A816-450B-BFF4-A712D2694EEC"> Diagnosing and Responding to Failures </a> cover the most basic recovery scenarios and are intended to be as generic as possible. The scenarios in this chapter are less common or are more complicated than the basic scenarios.
               </p>
               <p>This chapter contains the following topics:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="rman-recovery-advanced.html#GUID-18DC642E-DA14-47A9-9547-02F385CA47EA" title="You can perform limited recovery of changes to a database running in NOARCHIVELOG mode by applying incremental backups. The incremental backups must be consistent, like all backups of a database run in NOARCHIVELOG mode, so you cannot make backups of the database when it is open.">Recovering a NOARCHIVELOG Database with Incremental Backups</a></p>
                  </li>
                  <li>
                     <p><a href="rman-recovery-advanced.html#GUID-2B93E1AF-5ED1-4FAE-91BB-63362CADF7AD" title="RMAN can restore a lost server parameter file to its default location or to a location of your choice. Unlike the loss of the control file, the loss of the server parameter file does not cause the instance to immediately stop. The instance may continue operating, although you must shut it down and restart it after restoring the server parameter file.">Restoring the Server Parameter File</a></p>
                  </li>
                  <li>
                     <p><a href="rman-recovery-advanced.html#GUID-77C2B092-4BEB-4BAC-91F9-7368EA16A2B6" title="When all current control files are lost, you must restore a backup control file.">Performing Recovery with a Backup Control File</a></p>
                  </li>
                  <li>
                     <p><a href="rman-recovery-advanced.html#GUID-195E30B2-6077-446D-A255-089D3341268A" title="Disaster recovery includes the restoration and recovery of the target database after the loss of the entire target database, the recovery catalog database, all current control files, all online redo log files, and all parameter files.">Performing Disaster Recovery</a></p>
                  </li>
                  <li>
                     <p><a href="rman-recovery-advanced.html#GUID-6B71E7DF-A2B6-44F5-A8D5-B184BB41A768" title="Use the RESTORE and RECOVER commands to restore a database on a new host. Restoring a database on a new host is useful when you want to perform a test run of your disaster recovery procedures or to permanently move a database to a new host.">Restoring a Database on a New Host</a></p>
                  </li>
                  <li>
                     <p><a href="rman-recovery-advanced.html#GUID-8E64485B-3788-4389-A892-8C560F12443F" title="RMAN enables you to restore or recover files by connecting, over the network, to a physical standby database that contains the required files. You can restore an entire database, data files, control files, server parameter file, or tablespaces. Restoring files over the network is very useful in scenarios where you need to synchronize the primary and standby databases.">Restoring and Recovering Files Over the Network</a></p>
                  </li>
               </ul>
            </div><a id="BRADV362"></a><a id="BRADV89841"></a><div class="props_rev_3"><a id="GUID-18DC642E-DA14-47A9-9547-02F385CA47EA" name="GUID-18DC642E-DA14-47A9-9547-02F385CA47EA"></a><h3 id="BRADV-GUID-18DC642E-DA14-47A9-9547-02F385CA47EA" class="sect3"><span class="enumeration_section">20.1 </span>Recovering a NOARCHIVELOG Database with Incremental Backups
               </h3>
               <div>
                  <p>You can perform limited recovery of changes to a database running in <code class="codeph">NOARCHIVELOG</code> mode by applying incremental backups. The incremental backups must be consistent, like all backups of a database run in <code class="codeph">NOARCHIVELOG</code> mode, so you cannot make backups of the database when it is open.
                  </p>
                  <div class="section">
                     <p>Restoring a database running in <code class="codeph">NOARCHIVELOG</code> mode is similar to restoring a database in <code class="codeph">ARCHIVELOG</code> mode. The main differences are:
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Only consistent backups can be used in restoring a database in <code class="codeph">NOARCHIVELOG</code> mode.
                           </p>
                        </li>
                        <li>
                           <p>Media recovery is not possible because no archived redo logs exist.</p>
                        </li>
                     </ul>
                     <p>When you are recovering a <code class="codeph">NOARCHIVELOG</code> database, specify the <code class="codeph">NOREDO</code> option on the <code class="codeph">RECOVER</code> command to indicate that RMAN does not attempt to apply archived redo logs. Otherwise, RMAN returns an error.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p><span class="bold">To recover a NOARCHIVELOG database with incremental backups:</span></p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>After connecting to the target database and the recovery catalog, place the database in a mounted state:</span><div><pre class="oac_no_warn" dir="ltr">STARTUP FORCE MOUNT
</pre></div>
                     </li>
                     <li class="stepexpand"><span>Restore and recover the database.</span><div>
                           <p>For example, you can perform incomplete recovery with the following commands:</p><pre class="oac_no_warn" dir="ltr">RESTORE DATABASE 
  FROM TAG "consistent_whole_backup";
RECOVER DATABASE NOREDO;
</pre></div>
                     </li>
                     <li class="stepexpand"><span>Open the database with the <code class="codeph">RESETLOGS</code> option.</span><div>
                           <p>For example, enter the following command:</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN RESETLOGS;</pre></div>
                     </li>
                  </ol>
               </div>
            </div><a id="BRADV363"></a><a id="BRADV85339"></a><div class="props_rev_3"><a id="GUID-2B93E1AF-5ED1-4FAE-91BB-63362CADF7AD" name="GUID-2B93E1AF-5ED1-4FAE-91BB-63362CADF7AD"></a><h3 id="BRADV-GUID-2B93E1AF-5ED1-4FAE-91BB-63362CADF7AD" class="sect3"><span class="enumeration_section">20.2 </span>Restoring the Server Parameter File
               </h3>
               <div>
                  <p>RMAN can restore a lost server parameter file to its default location or to a location of your choice. Unlike the loss of the control file, the loss of the server parameter file does not cause the instance to immediately stop. The instance may continue operating, although you must shut it down and restart it after restoring the server parameter file. </p>
                  <div class="section">
                     <p>Note the following considerations when restoring the server parameter file:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>If the instance is already started with the server parameter file, then you cannot overwrite the existing server parameter file.</p>
                        </li>
                        <li>
                           <p>When the instance is started with a client-side initialization parameter file, RMAN restores the server parameter file to the default location if the <code class="codeph">TO</code> clause is not used in the restore command. The default location is platform-specific, for example, <code class="codeph">?</code><code class="codeph">/dbs/spfile.ora</code> on Linux.
                           </p>
                        </li>
                        <li>
                           <p>A recovery catalog simplifies the recovery procedure because you can avoid recording and remembering the DBID. This procedure assumes that you are <span class="italic">not</span> using a recovery catalog.
                           </p>
                        </li>
                     </ul>
                     <p><span class="bold">To restore the server parameter file from autobackup:</span></p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>Start RMAN and do one of the following:</span><div>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>If the database instance is started at the time of the loss of the server parameter file, then connect to the target database. </p>
                              </li>
                              <li>
                                 <p>If the database instance is not started when the server parameter file is lost, and if you are not using a recovery catalog, then run the <code class="codeph">SET DBID</code> command to set the DBID of the target database.
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </li>
                     <li class="stepexpand"><span>Shut down the database instance and restart it without mounting the database.</span><div>
                           <p>When the server parameter file is not available, RMAN starts the instance with a dummy parameter file. For example, enter the following command:</p><pre class="oac_no_warn" dir="ltr">STARTUP FORCE NOMOUNT;
</pre></div>
                     </li>
                     <li class="stepexpand"><span>Execute a <code class="codeph">RUN</code> command to restore the server parameter file.</span><div>
                           <p>Depending on the situation, you may need to execute multiple commands in the <code class="codeph">RUN</code> command. Note the following considerations:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>If restoring from tape, then use <code class="codeph">ALLOCATE CHANNEL</code> to allocate an SBT channel manually. If restoring from disk, then RMAN uses the default disk channel.
                                 </p>
                              </li>
                              <li>
                                 <p>If the autobackups were not produced with the default format (<code class="codeph">%F</code>), then use the <code class="codeph">SET CONTROLFILE AUTOBACKUP FOR DEVICE TYPE</code> command to specify the format in effect when the autobackup was performed.
                                 </p>
                              </li>
                              <li>
                                 <p>If the most recent autobackup was not created today, then use <code class="codeph">SET UNTIL</code> to specify the date from which to start the search.
                                 </p>
                              </li>
                              <li>
                                 <p>If RMAN is not connected to a recovery catalog, then use <code class="codeph">SET DBID</code> to set the DBID for the target database.
                                 </p>
                              </li>
                              <li>
                                 <p>To restore the server parameter file to a nondefault location, specify the <code class="codeph">TO</code> clause or <code class="codeph">TO PFILE</code> clause on the <code class="codeph">RESTORE SPFILE</code> command.
                                 </p>
                              </li>
                              <li>
                                 <p>If you know that RMAN never produces more than <span class="italic">n</span> autobackups each day, then you can set the <code class="codeph">RESTORE SPFILE FROM AUTOBACKUP ... MAXSEQ</code> parameter to <span class="italic">n</span> to reduce the search time. <code class="codeph">MAXSEQ</code> is set to 255 by default, and <code class="codeph">RESTORE</code> counts backward from <code class="codeph">MAXSEQ</code> to find the last backup of the day. To terminate the restore operation if you do not find the autobackup in the current day (or specified day), set <code class="codeph">MAXDAYS 1</code> on the <code class="codeph">RESTORE</code> command.
                                 </p>
                              </li>
                           </ul>
                           <p>The following example illustrates a <code class="codeph">RUN</code> command that restores a server parameter file from an autobackup on tape:
                           </p><pre class="oac_no_warn" dir="ltr">RUN 
{
  ALLOCATE CHANNEL c1 DEVICE TYPE sbt PARMS ...;
  SET UNTIL TIME 'SYSDATE-7';
  SET CONTROLFILE AUTOBACKUP FORMAT 
    FOR DEVICE TYPE sbt TO '/disk1/control_files/autobackup_%F';
  SET DBID 123456789;
  RESTORE SPFILE
    TO '/tmp/spfileTEMP.ora'
    FROM AUTOBACKUP MAXDAYS 10;
}
</pre></div>
                     </li>
                     <li class="stepexpand"><span>Restart the database instance with the restored file. </span><div>
                           <p>If you are restarting RMAN with a server parameter file in a nondefault location, then create an initialization parameter file with the line <code class="codeph">SPFILE=</code><span class="italic"><code class="codeph">new_location</code></span>, where <span class="italic"><code class="codeph">new_location</code></span> is the path name of the restored server parameter file. Then, restart the instance with the client-side initialization parameter file.
                           </p>
                           <p>For example, create a file <code class="codeph">/tmp/init.ora</code> which contains the single line:
                           </p><pre class="oac_no_warn" dir="ltr">SPFILE=/tmp/spfileTEMP.ora
</pre><p>You can use the following RMAN command to restart the instance with the restored server parameter file:</p><pre class="oac_no_warn" dir="ltr">STARTUP FORCE PFILE=/tmp/init.ora;</pre></div>
                     </li>
                  </ol>
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-2B93E1AF-5ED1-4FAE-91BB-63362CADF7AD__GUID-682AAC78-47F6-4F67-BA49-09F6BDD6D0B7">
                        <p class="notep1">See Also:</p>
                        <p><span class="q">"<a href="rman-complete-database-recovery.html#GUID-34BB2E4B-B2FC-4701-BB65-BFED027DB865" title="It is recommended that you record the DBID of your database.">Determining the DBID of the Database</a>"</span> for details on determining the DBID
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div><a id="BRADV364"></a><a id="BRADV89829"></a><div class="props_rev_3"><a id="GUID-8077F97F-76A7-49DC-8C1E-5FE8ADD0914F" name="GUID-8077F97F-76A7-49DC-8C1E-5FE8ADD0914F"></a><h4 id="BRADV-GUID-8077F97F-76A7-49DC-8C1E-5FE8ADD0914F" class="sect4"><span class="enumeration_section">20.2.1 </span>Restoring the Server Parameter File from a Control File Autobackup
                  </h4>
                  <div>
                     <p>If you have configured control file autobackups, then the server parameter file is backed up with the control file whenever an autobackup is taken. </p>
                     <div class="section">
                        <p><span class="bold">To restore the server parameter file from the control file autobackup:</span></p>
                        <ol>
                           <li>
                              <p>Set the DBID for your database.</p>
                           </li>
                           <li>
                              <p>Use the <code class="codeph">RESTORE SPFILE FROM AUTOBACKUP</code> command.
                              </p>
                              <p>If the autobackup is in a nondefault format, then first use the <code class="codeph">SET CONTROLFILE AUTOBACKUP FORMAT</code> command to specify the format.
                              </p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-8077F97F-76A7-49DC-8C1E-5FE8ADD0914F__CHDCEIII">
                        <p class="titleinexample">Example 20-1 Restoring the Server Parameter File from a Control File Autobackup</p>
                        <p>This example sets the DBID and restores the server parameter file from a control file autobackup in a nondefault location. RMAN uses the autobackup format and DBID to search for control file autobackups. If a control file autobackup is found, then RMAN restores the server parameter file from that backup to its default location.</p><pre class="oac_no_warn" dir="ltr">SET DBID 320066378;
RUN 
{
  SET CONTROLFILE AUTOBACKUP FORMAT 
    FOR DEVICE TYPE DISK TO '<span class="italic">autobackup_format</span>';
  RESTORE SPFILE FROM AUTOBACKUP;
}
</pre></div>
                     <!-- class="example" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-8077F97F-76A7-49DC-8C1E-5FE8ADD0914F__GUID-97387305-9495-4D48-823C-6E189A2F5018">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Description of <code class="codeph">CONFIGURE CONTROLFILE AUTOBACKUP FORMAT</code> in the entry for the <code class="codeph">CONFIGURE</code> command in <a href="../rcmrf/CONFIGURE.html#RCMRF113" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> to learn how to determine the correct value for <code class="codeph"><span class="codeinlineitalic">autobackup_format</span></code></p>
                              </li>
                              <li>
                                 <p><span class="q">"<a href="rman-complete-database-recovery.html#GUID-34BB2E4B-B2FC-4701-BB65-BFED027DB865" title="It is recommended that you record the DBID of your database.">Determining the DBID of the Database</a>"</span> for details on how to determine the DBID
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV89830"></a><div class="props_rev_3"><a id="GUID-AE7CD28F-3187-44DD-BEC2-E43839EC63E6" name="GUID-AE7CD28F-3187-44DD-BEC2-E43839EC63E6"></a><h4 id="BRADV-GUID-AE7CD28F-3187-44DD-BEC2-E43839EC63E6" class="sect4"><span class="enumeration_section">20.2.2 </span>Creating an Initialization Parameter File with RMAN
                  </h4>
                  <div>
                     <p>You can also restore the server parameter file as a client-side initialization parameter file with the <code class="codeph">TO PFILE '<span class="codeinlineitalic">filename</span>'</code> clause. 
                     </p>
                     <div class="section">
                        <p>The file name that you specify must be on a file system accessible from the host where the RMAN client is running. This file need not be accessible directly from the host running the instance. </p>
                        <p>The following RMAN command creates an initialization parameter file named <code class="codeph">/tmp/initTEMP.ora</code> on the system running the RMAN client:
                        </p><pre class="oac_no_warn" dir="ltr">RESTORE SPFILE TO PFILE '/tmp/initTEMP.ora';
</pre><p>To restart the instance with the initialization parameter file, use the following command, again running RMAN on the same client host:</p><pre class="oac_no_warn" dir="ltr">STARTUP FORCE PFILE='/tmp/initTEMP.ora';</pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV154"></a><div class="props_rev_3"><a id="GUID-77C2B092-4BEB-4BAC-91F9-7368EA16A2B6" name="GUID-77C2B092-4BEB-4BAC-91F9-7368EA16A2B6"></a><h3 id="BRADV-GUID-77C2B092-4BEB-4BAC-91F9-7368EA16A2B6" class="sect3"><span class="enumeration_section">20.3 </span>Performing Recovery with a Backup Control File
               </h3>
               <div>
                  <p>When all current control files are lost, you must restore a backup control file.</p>
                  <p>This section contains the following topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="rman-recovery-advanced.html#GUID-7B78C0E8-423A-4BE0-88D5-AB903DB49608" title="If all copies of the current control file are lost or damaged, then you must restore and mount a backup control file. You must then run the RECOVER command, even if no data files have been restored, and open the database with the RESETLOGS option.">About Recovery with a Backup Control File</a></p>
                     </li>
                     <li>
                        <p><a href="rman-recovery-advanced.html#GUID-927C5614-DC12-4B58-B261-EBD5F08A4202" title="Recovering a database with a backup control file and when no recovery catalog is used requires you to restore the control file from an autobackup.">Performing Recovery with a Backup Control File and No Recovery Catalog</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89834"></a><div class="props_rev_3"><a id="GUID-7B78C0E8-423A-4BE0-88D5-AB903DB49608" name="GUID-7B78C0E8-423A-4BE0-88D5-AB903DB49608"></a><h4 id="BRADV-GUID-7B78C0E8-423A-4BE0-88D5-AB903DB49608" class="sect4"><span class="enumeration_section">20.3.1 </span>About Recovery with a Backup Control File
                  </h4>
                  <div>
                     <p>If all copies of the current control file are lost or damaged, then you must restore and mount a backup control file. You must then run the <code class="codeph">RECOVER</code> command, even if no data files have been restored, and open the database with the <code class="codeph">RESETLOGS</code> option. 
                     </p>
                     <p>During recovery, RMAN automatically searches for online and archived logs that are not recorded in the RMAN repository and catalogs any that it finds. RMAN attempts to find a valid archived redo log in any current archiving destination with the current log format. The current format is specified in the initialization parameter file used to start the instance (or all instances in an Oracle RAC configuration). Similarly, RMAN attempts to find the online redo logs by using the file names listed in the control file.</p>
                     <p>If you changed the archiving destination or format during recovery, or if you added new online log members after the backup of the control file, then RMAN may not be able to automatically catalog a needed online or archived log. Whenever RMAN cannot find online redo logs and you did not specify an <code class="codeph">UNTIL</code> time, RMAN reports errors similar to the following: 
                     </p><pre class="oac_no_warn" dir="ltr">RMAN-00571: ===========================================================
RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============
RMAN-00571: ===========================================================
RMAN-03002: failure of recover command at 08/29/2013 14:23:09
RMAN-06054: media recovery requesting unknown log: thread 1 scn 86945
</pre><p>In this case, you must use the <code class="codeph">CATALOG</code> command to manually add the required redo logs to the repository so that recovery can proceed.
                     </p>
                     <div class="infoboxnote" id="GUID-7B78C0E8-423A-4BE0-88D5-AB903DB49608__GUID-4A57B8F8-D63B-41C6-8988-A530E79810CC">
                        <p class="notep1">Note:</p>
                        <p>If some copies of the current control file are usable, however, then you can follow the procedure in <span class="q">"<a href="user-managed-recovery-advanced.html#GUID-22AD5382-06ED-4FDF-BDD4-C8CD682F83E0">Responding to the Loss of a Subset of the Current Control Files</a>"</span> and avoid the recovery and <code class="codeph">RESETLOGS</code> operation.
                        </p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-7B78C0E8-423A-4BE0-88D5-AB903DB49608__GUID-7B4AEE7B-AFC2-4270-9FE2-89B78BD8312C">
                        <p class="notep1">See Also:</p>
                        <p>The discussion of <code class="codeph">RESTORE CONTROLFILE</code> in <a href="../rcmrf/RESTORE.html#RCMRF149" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> for more details about restrictions on using <code class="codeph">RESTORE CONTROLFILE</code> in different scenarios (such as when using a recovery catalog, or restoring from a specific backup)
                        </p>
                     </div>
                  </div><a id="BRADV89835"></a><div class="props_rev_3"><a id="GUID-64F583E8-2E1A-4F13-847B-5FCEFA9E008A" name="GUID-64F583E8-2E1A-4F13-847B-5FCEFA9E008A"></a><h5 id="BRADV-GUID-64F583E8-2E1A-4F13-847B-5FCEFA9E008A" class="sect5"><span class="enumeration_section">20.3.1.1 </span>About Control File Locations During RMAN Restore
                     </h5>
                     <div>
                        <p>When restoring the control file, the default destination is all of the locations defined in the <code class="codeph">CONTROL_FILES</code> initialization parameter. If the <code class="codeph">CONTROL_FILES</code> initialization parameter is not set, then the database uses the same rules to determine the destination for the restored control file that it uses when creating a control file if the <code class="codeph">CONTROL_FILES</code> parameter is not set.
                        </p>
                        <p>One way to restore the control file to one or more new locations is to change the <code class="codeph">CONTROL_FILES</code> initialization parameter, and then use the <code class="codeph">RESTORE CONTROLFILE</code> command with no arguments to restore the control file to the default locations. For example, if you are restoring your control file after a disk failure made some but not all <code class="codeph">CONTROL_FILES</code> locations unusable, you can change <code class="codeph">CONTROL_FILES</code> to replace references to the failed disk with path names pointing to another disk, and then run <code class="codeph">RESTORE CONTROLFILE</code> with no arguments.
                        </p>
                        <p>You can also restore the control file to any location that you choose other than the <code class="codeph">CONTROL_FILES</code> locations, by using the form <code class="codeph">RESTORE CONTROLFILE TO ' <span class="codeinlineitalic">filename</span>'</code>:
                        </p><pre class="oac_no_warn" dir="ltr">RESTORE CONTROLFILE TO '/tmp/my_controlfile';
</pre><p>You can perform this operation with the database in <code class="codeph">NOMOUNT</code>, <code class="codeph">MOUNT</code>, or <code class="codeph">OPEN</code> states, because you are not overwriting any of the control files currently in use. Any existing file named <code class="codeph">'<span class="codeinlineitalic">filename</span>'</code> is overwritten. After restoring the control file to a new location, you can then update the <code class="codeph">CONTROL_FILES</code> initialization parameter to include the new location.
                        </p>
                        <div class="infoboxnotealso" id="GUID-64F583E8-2E1A-4F13-847B-5FCEFA9E008A__GUID-D28E208B-1670-4B52-AFA2-6A4D9153A519">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p> The description of the <code class="codeph">CREATE CONTROLFILE</code> statement in <a href="../sqlrf/CREATE-CONTROLFILE.html#SQLRF01203" target="_blank"><span><cite>Oracle Database SQL Language Reference</cite></span></a> for the rules that determine the destination of restored control files
                                 </p>
                              </li>
                              <li>
                                 <p><a href="../rcmrf/RESTORE.html#RCMRF149" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> for <code class="codeph">RESTORE CONTROLFILE</code> syntax
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="BRADV365"></a><a id="BRADV89836"></a><div class="props_rev_3"><a id="GUID-FE57B2EA-428A-4408-BBB5-D9392D6B0F8B" name="GUID-FE57B2EA-428A-4408-BBB5-D9392D6B0F8B"></a><h5 id="BRADV-GUID-FE57B2EA-428A-4408-BBB5-D9392D6B0F8B" class="sect5"><span class="enumeration_section">20.3.1.2 </span>About RMAN Recovery With and Without a Recovery Catalog
                     </h5>
                     <div>
                        <p>The process of recovering a control file depends on whether a recovery catalog is used.</p>
                        <p>When RMAN is connected to a recovery catalog, the recovery procedure with a backup control file is identical to recovery with a current control file. The RMAN metadata missing from the backup control file is available from the recovery catalog. The only exception is if the database name is not unique in the catalog, in which case you must use <code class="codeph">SET DBID</code> command before restoring the control file.
                        </p>
                        <p>If you are not using a recovery catalog, then you must restore your control file from an autobackup. To restore the control file from autobackup, the database must be in a <code class="codeph">NOMOUNT</code> state. You must first set the DBID for your database, and then use the <code class="codeph">RESTORE CONTROLFILE FROM AUTOBACKUP</code> command.
                        </p>
                        <div class="example" id="GUID-FE57B2EA-428A-4408-BBB5-D9392D6B0F8B__CHDBHDJD">
                           <p class="titleinexample">Example 20-2 Setting the DBID and Restoring the Control File from Autobackup</p>
                           <p>In this example, RMAN uses the autobackup format and DBID to determine where to hunt for the control file autobackup. If one is found, RMAN restores the control file to all control file locations listed in the <code class="codeph">CONTROL_FILES</code> initialization parameter. 
                           </p><pre class="oac_no_warn" dir="ltr">SET DBID 320066378;
RUN
{
  SET CONTROLFILE AUTOBACKUP FORMAT 
    FOR DEVICE TYPE DISK TO '<span class="italic">autobackup_format</span>';
  RESTORE CONTROLFILE FROM AUTOBACKUP;
}
</pre><div class="infoboxnotealso" id="GUID-FE57B2EA-428A-4408-BBB5-D9392D6B0F8B__GUID-32787659-7CD3-492F-9608-62A17F77338F">
                              <p class="notep1">See Also:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><span class="q">"<a href="rman-complete-database-recovery.html#GUID-34BB2E4B-B2FC-4701-BB65-BFED027DB865" title="It is recommended that you record the DBID of your database.">Determining the DBID of the Database</a>"</span> to learn how to determine your DBID
                                    </p>
                                 </li>
                                 <li>
                                    <p>The description of <code class="codeph">CONFIGURE CONTROLFILE AUTOBACKUP FORMAT</code> in the entry for <code class="codeph">CONFIGURE</code> in <a href="../rcmrf/CONFIGURE.html#RCMRF113" target="_blank"><span><cite>Oracle Database Backup and Recovery Reference</cite></span></a> to learn how to determine the correct value for the autobackup format
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="BRADV89837"></a><div class="props_rev_3"><a id="GUID-918B5EE1-DBE9-464E-B8F9-454E1F94136A" name="GUID-918B5EE1-DBE9-464E-B8F9-454E1F94136A"></a><h5 id="BRADV-GUID-918B5EE1-DBE9-464E-B8F9-454E1F94136A" class="sect5"><span class="enumeration_section">20.3.1.3 </span>About RMAN Recovery When Using a Fast Recovery Area
                     </h5>
                     <div>
                        <p>The commands for restoring a control file are the same whether or not the database uses a fast recovery area.</p>
                        <p>If the database uses a fast recovery area, then RMAN updates a control file restored from backup by crosschecking all disk-based backups and image copies recorded in the control file. RMAN catalogs any backups in the recovery area that are not recorded. As a result, the restored control file has a complete and accurate record of all backups in the recovery area and any other backups known to the control file at the time of the backup.</p>
                        <p>RMAN does not automatically crosscheck tape backups after restoring a control file. If you are using tape backups, then you can restore and mount the control file, and optionally crosscheck the backups on tape, as shown in the following example:</p><pre class="oac_no_warn" dir="ltr">CROSSCHECK BACKUP DEVICE TYPE sbt;</pre></div>
                  </div>
               </div><a id="BRADV366"></a><a id="BRADV89838"></a><div class="props_rev_3"><a id="GUID-927C5614-DC12-4B58-B261-EBD5F08A4202" name="GUID-927C5614-DC12-4B58-B261-EBD5F08A4202"></a><h4 id="BRADV-GUID-927C5614-DC12-4B58-B261-EBD5F08A4202" class="sect4"><span class="enumeration_section">20.3.2 </span>Performing Recovery with a Backup Control File and No Recovery Catalog
                  </h4>
                  <div>
                     <p>Recovering a database with a backup control file and when no recovery catalog is used requires you to restore the control file from an autobackup.</p>
                     <div class="section">
                        <p>This section assumes that you have RMAN backups of the control file, but do not use a recovery catalog. It also assumes that you enabled the control file autobackup feature for the target database and can restore an autobackup of the control file. </p>
                        <p>Because the autobackup uses a well-known format, RMAN can restore it even though it does not have a repository available that lists the available backups. You can restore the autobackup to the default or a new location. RMAN replicates the control file to all <code class="codeph">CONTROL_FILES</code> locations automatically.
                        </p>
                        <div class="infoboxnote" id="GUID-927C5614-DC12-4B58-B261-EBD5F08A4202__GUID-8697184C-FD28-4DD8-AACE-EA08B73F576D">
                           <p class="notep1">Note:</p>
                           <p>If you know the backup piece name that contains the control file (for example, from the media manager or because the piece is on disk), then you can specify the piece name using the <code class="codeph">RESTORE CONTROLFILE FROM '<span class="codeinlineitalic">filename</span>'</code> command. The database records the location of every autobackup in the alert log.
                           </p>
                        </div>
                        <p>Because you are not connected to a recovery catalog, the RMAN repository contains only information about available backups at the time of the control file backup. If you know the location of other usable backup sets or image copies, then add them to the control file RMAN repository with the <code class="codeph">CATALOG</code> command.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><span class="bold">To recover the database with a control file autobackup in <code class="codeph">NOCATALOG</code> mode:</span></p>
                        <ol>
                           <li>
                              <p>Start RMAN and connect to a target database, as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>.
                              </p>
                           </li>
                           <li>
                              <p>Start the target database instance without mounting the database. For example:</p><pre class="oac_no_warn" dir="ltr">STARTUP NOMOUNT;
</pre></li>
                           <li>
                              <p>Set the database identifier for the target database with the <code class="codeph">SET DBID</code> command.
                              </p>
                              <p>RMAN displays the DBID whenever you connect to a target database. You can also obtain it by inspecting saved RMAN log files, querying the catalog, or looking at the file names of control file autobackup. For example, run:</p><pre class="oac_no_warn" dir="ltr">SET DBID 676549873;
</pre></li>
                           <li>
                              <p>Write an RMAN command file to restore the autobackup control file and perform recovery.</p>
                              <p>The command file contains the following steps:</p>
                              <ol type="a">
                                 <li>
                                    <p>Optionally, specify the most recent backup time stamp that RMAN can use when searching for a control file autobackup to restore.</p>
                                 </li>
                                 <li>
                                    <p>If you know that a different control file autobackup format was in effect when the control file autobackup was created, then specify a nondefault format for the restore of the control file.</p>
                                 </li>
                                 <li id="GUID-927C5614-DC12-4B58-B261-EBD5F08A4202__CHDIDAIJ">
                                    <p>If an <a href="glossary.html#GUID-2E48CE71-9547-4196-B715-5CE59033262E"><span class="xrefglossterm">SBT</span></a> channel created the control file autobackup, then allocate one or more SBT channels. Because no recovery catalog is available, you cannot use preconfigured channels.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Restore the autobackup of the control file, optionally setting the maximum number of days backward that RMAN can search and the initial sequence number that it uses in its search for the first day.</p>
                                 </li>
                                 <li>
                                    <p>If you know that the control file contains information about configured channels that is useful to you in the rest of the restore process, then you can exit RMAN to clear manually allocated channels from Step <a href="rman-recovery-advanced.html#GUID-927C5614-DC12-4B58-B261-EBD5F08A4202__CHDIDAIJ">4.c</a>. 
                                    </p>
                                    <p>If you restart the RMAN client and mount the database, then these configured channels are available for your use. If you do not care about using configured channels from your control file, then you can simply mount the database.</p>
                                 </li>
                                 <li>
                                    <p>This step depends on whether the online redo logs are available. The option <code class="codeph">OPEN RESETLOGS</code> is always required after recovery with a backup control file, regardless of whether logs are available.
                                    </p>
                                    <p>If the online redo logs are usable, then RMAN can find and apply these logs. Perform a complete restore and recovery as described in <span class="q">"<a href="rman-complete-database-recovery.html#GUID-5E09344A-76D0-4188-A39D-CBA07F0B5C25" title="During complete recovery RMAN restores one or more data files and then applies all the redo generated after the restored backup.">Performing Complete Database Recovery</a>"</span>.
                                    </p>
                                    <p>If the online redo logs are unusable, then perform DBPITR as described in <span class="q">"<a href="rman-performing-flashback-dbpitr.html#GUID-7D3EE2F7-77A2-4264-8875-CC0AEC64ABE0" title="RMAN DBPITR restores the database from backups before the target time for recovery, then uses incremental backups and redo to roll the database forward to the target time. You can recover to an SCN, time, log sequence number, or restore point. Oracle recommends that you create restore points at important times to make point-in-time recovery more manageable if it ever becomes necessary.">Performing Database Point-in-Time Recovery</a>"</span>. An <code class="codeph">UNTIL</code> clause is required to specify a target time, SCN, or log sequence number for the recovery before the first SCN of the online redo logs (otherwise, RMAN issues the <code class="codeph">RMAN-6054</code> error).
                                    </p>
                                    <p>When you perform DBPITR with a backup control file, before opening the database with <code class="codeph">RESETLOGS</code>, you can open the database read-only using SQL*Plus and run queries as needed to verify that the effects of the logical corruption have been reversed. If you are satisfied with the results, then you can open the database with <code class="codeph">RESETLOGS</code>.
                                    </p>
                                    <div class="infoboxnote" id="GUID-927C5614-DC12-4B58-B261-EBD5F08A4202__GUID-96220562-6887-4750-ACD6-8DD4C0E8211B">
                                       <p class="notep1">Note:</p>
                                       <p>When specifying log sequences, if the last created archived redo log has sequence <span class="italic">n</span>, then specify <code class="codeph">UNTIL SEQUENCE <span class="codeinlineitalic">n</span>+1</code> so that RMAN applies <span class="italic">n</span> and then stops.
                                       </p>
                                    </div>
                                 </li>
                              </ol>
                              <p>In the following example, the online redo log files have been lost, and the most recent archived redo log sequence number is 13243. This example shows how to restore the control file autobackup and recover through the latest log.</p><pre class="oac_no_warn" dir="ltr">RUN 
{
  # Optionally, set upper limit for eligible time stamps of control file 
  # backups
  # SET UNTIL TIME '09/10/2017 13:45:00';
  # Specify a nondefault autobackup format only if required
  # SET CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK 
  #   TO '?/oradata/%F.bck';
  ALLOCATE CHANNEL c1 DEVICE TYPE sbt PARMS '...'; # allocate manually
  RESTORE CONTROLFILE FROM AUTOBACKUP
    MAXSEQ 100           # start at sequence 100 and count down
    MAXDAYS 180;         # start at UNTIL TIME and search back 6 months
  ALTER DATABASE MOUNT;
}
# Now use automatic channels configured in restored control file
RESTORE DATABASE UNTIL SEQUENCE 13244;
RECOVER DATABASE UNTIL SEQUENCE 13244;
</pre></li>
                           <li>
                              <p>If recovery was successful, then open the database and reset the online logs:</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN RESETLOGS;</pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV156"></a><div class="props_rev_3"><a id="GUID-195E30B2-6077-446D-A255-089D3341268A" name="GUID-195E30B2-6077-446D-A255-089D3341268A"></a><h3 id="BRADV-GUID-195E30B2-6077-446D-A255-089D3341268A" class="sect3"><span class="enumeration_section">20.4 </span>Performing Disaster Recovery
               </h3>
               <div>
                  <p>Disaster recovery includes the restoration and recovery of the target database after the loss of the entire target database, the recovery catalog database, all current control files, all online redo log files, and all parameter files.</p>
                  <p>This section contains the following topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="rman-recovery-advanced.html#GUID-DC3C8F0E-403C-4AE4-BCD9-17A0812B9D13" title="Certain prerequisites must be met before you perform disaster recovery using RMAN.">Prerequisites of Disaster Recovery</a></p>
                     </li>
                     <li>
                        <p><a href="rman-recovery-advanced.html#GUID-8A4F7C00-AA51-48DB-BEF7-FA16B132E1D9" title="Assume that the Linux server on which your database was running has been damaged beyond repair. Fortunately, you backed up the database to Oracle Secure Backup and have the tapes available. You can recover the database by using these backups.">Recovering the Database After a Disaster</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89839"></a><div class="props_rev_3"><a id="GUID-DC3C8F0E-403C-4AE4-BCD9-17A0812B9D13" name="GUID-DC3C8F0E-403C-4AE4-BCD9-17A0812B9D13"></a><h4 id="BRADV-GUID-DC3C8F0E-403C-4AE4-BCD9-17A0812B9D13" class="sect4"><span class="enumeration_section">20.4.1 </span>Prerequisites of Disaster Recovery
                  </h4>
                  <div>
                     <p>Certain prerequisites must be met before you perform disaster recovery using RMAN.</p>
                     <p>You must have the following:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Backups of all data files </p>
                        </li>
                        <li>
                           <p>All archived redo logs generated after the creation time of the oldest backup that you intend to restore</p>
                        </li>
                        <li>
                           <p>At least one control file autobackup</p>
                        </li>
                        <li>
                           <p>A record of the DBID of the database</p>
                        </li>
                     </ul>
                  </div>
               </div><a id="BRADV367"></a><a id="BRADV89840"></a><div class="props_rev_3"><a id="GUID-8A4F7C00-AA51-48DB-BEF7-FA16B132E1D9" name="GUID-8A4F7C00-AA51-48DB-BEF7-FA16B132E1D9"></a><h4 id="BRADV-GUID-8A4F7C00-AA51-48DB-BEF7-FA16B132E1D9" class="sect4"><span class="enumeration_section">20.4.2 </span>Recovering the Database After a Disaster
                  </h4>
                  <div>
                     <p>Assume that the Linux server on which your database was running has been damaged beyond repair. Fortunately, you backed up the database to Oracle Secure Backup and have the tapes available. You can recover the database by using these backups.</p>
                     <div class="section">
                        <p>The procedure for disaster recovery is similar to the procedure for recovering the database with a backup control file in <code class="codeph">NOCATALOG</code> mode. If you are restoring the database to a new host, then review the considerations described in <span class="q">"<a href="rman-recovery-advanced.html#GUID-6B71E7DF-A2B6-44F5-A8D5-B184BB41A768" title="Use the RESTORE and RECOVER commands to restore a database on a new host. Restoring a database on a new host is useful when you want to perform a test run of your disaster recovery procedures or to permanently move a database to a new host.">Restoring a Database on a New Host</a>"</span>.
                        </p>
                        <p>. The scenario assumes the following:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Oracle Database is installed on the new host.</p>
                           </li>
                           <li>
                              <p>You are restoring the database to a new Linux host with the same directory structure as the old host.</p>
                           </li>
                           <li>
                              <p>You have one tape drive containing backups of all the data files and archived redo logs through log 1124, and autobackups of the control file and server parameter file.</p>
                           </li>
                           <li>
                              <p>You do not use a recovery catalog with the database.</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-8A4F7C00-AA51-48DB-BEF7-FA16B132E1D9__GUID-B3CF5EEF-9D36-4EB0-93CE-B05EB8307F58">To recover the database on the new host:</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ol>
                           <li>
                              <p>Ensure that the prerequisites described in <span class="q">"<a href="rman-recovery-advanced.html#GUID-DC3C8F0E-403C-4AE4-BCD9-17A0812B9D13" title="Certain prerequisites must be met before you perform disaster recovery using RMAN.">Prerequisites of Disaster Recovery</a>"</span> are met.
                              </p>
                           </li>
                           <li>
                              <p>If possible, restore or re-create all relevant network files such as <code class="codeph">tnsnames.ora</code> and <code class="codeph">listener.ora</code> and a password file.
                              </p>
                           </li>
                           <li>
                              <p>Start RMAN and connect to the target database instance, as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>. 
                              </p>
                              <p>At this stage, no initialization parameter file exists. If you have set <code class="codeph">ORACLE_SID</code> and <code class="codeph">ORACLE_HOME</code>, then you can use operating system authentication to connect as <code class="codeph">SYSDBA</code> or <code class="codeph">SYSBACKUP</code>.
                              </p>
                           </li>
                           <li>
                              <p>Specify the DBID for the target database with the <code class="codeph">SET</code> <code class="codeph">DBID</code> command, as described in <span class="q">"<a href="rman-recovery-advanced.html#GUID-2B93E1AF-5ED1-4FAE-91BB-63362CADF7AD" title="RMAN can restore a lost server parameter file to its default location or to a location of your choice. Unlike the loss of the control file, the loss of the server parameter file does not cause the instance to immediately stop. The instance may continue operating, although you must shut it down and restart it after restoring the server parameter file.">Restoring the Server Parameter File</a>"</span>.
                              </p>
                              <p>For example, enter the following command:</p><pre class="oac_no_warn" dir="ltr">SET DBID 676549873;
</pre></li>
                           <li>
                              <p>Run the <code class="codeph">STARTUP NOMOUNT</code> command. 
                              </p>
                              <p>When the server parameter file is not available, RMAN attempts to start the instance with a dummy server parameter file.</p>
                           </li>
                           <li>
                              <p>Allocate a channel to the media manager and then restore the server parameter file from autobackup.</p>
                              <p>For example, enter the following command to restore the server parameter file from Oracle Secure Backup:</p><pre class="oac_no_warn" dir="ltr">RUN
{
  ALLOCATE CHANNEL c1 DEVICE TYPE sbt;
  RESTORE SPFILE FROM AUTOBACKUP;
}
</pre></li>
                           <li>
                              <p>Restart the instance with the restored server parameter file.</p><pre class="oac_no_warn" dir="ltr">STARTUP FORCE NOMOUNT;
</pre></li>
                           <li>
                              <p>Write a command file to perform the restore and recovery operation, and then execute the command file. The command file must do the following:</p>
                              <ol type="a">
                                 <li>
                                    <p>Allocate a channel to the media manager.</p>
                                 </li>
                                 <li>
                                    <p>Restore a control file autobackup (see <span class="q">"<a href="rman-recovery-advanced.html#GUID-927C5614-DC12-4B58-B261-EBD5F08A4202" title="Recovering a database with a backup control file and when no recovery catalog is used requires you to restore the control file from an autobackup.">Performing Recovery with a Backup Control File and No Recovery Catalog</a>"</span>).
                                    </p>
                                 </li>
                                 <li>
                                    <p>Mount the restored control file.</p>
                                 </li>
                                 <li>
                                    <p>Catalog any backups not recorded in the repository with the <code class="codeph">CATALOG</code> command.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Restore the data files to their original locations. If volume names have changed, then run <code class="codeph">SET</code> <code class="codeph">NEWNAME</code> commands before the restore operation and perform a switch after the restore operation to update the control file with the new locations for the data files, as shown in the following example.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Recover the data files. RMAN stops recovery when it reaches the log sequence number specified.</p>
                                 </li>
                              </ol><pre class="oac_no_warn" dir="ltr">RMAN&gt; RUN
{
  # Manually allocate a channel to the media manager
  ALLOCATE CHANNEL t1 DEVICE TYPE sbt;
  # Restore autobackup of the control file. This example assumes that you have 
  # accepted the default format for the autobackup name.
  RESTORE CONTROLFILE FROM AUTOBACKUP;
  #  The set until command is used in case the database
  #  structure has changed in the most recent backups, and you want to
  #  recover to that point in time. In this way RMAN restores the database
  #  to the same structure that the database had at the specified time.
  ALTER DATABASE MOUNT;
  SET UNTIL SEQUENCE 1124 THREAD 1;
  RESTORE DATABASE;
  RECOVER DATABASE;
}
</pre><p>The following example of the <code class="codeph">RUN</code> command shows the same scenario except with new file names for the restored data files:
                              </p><pre class="oac_no_warn" dir="ltr">RMAN&gt; RUN
{
  #  If you must restore the files to new locations,
  #  use SET NEWNAME commands:
  SET NEWNAME FOR DATAFILE 1 TO '/dev/vgd_1_0/rlvt5_500M_1';
  SET NEWNAME FOR DATAFILE 2 TO '/dev/vgd_1_0/rlvt5_500M_2';
  SET NEWNAME FOR DATAFILE 3 TO '/dev/vgd_1_0/rlvt5_500M_3';
  ALLOCATE CHANNEL t1 DEVICE TYPE sbt;
  RESTORE CONTROLFILE FROM AUTOBACKUP;
  ALTER DATABASE MOUNT;
  SET UNTIL SEQUENCE 124 THREAD 1;
  RESTORE DATABASE;
  SWITCH DATAFILE ALL; # Update control file with new location of data files.
  RECOVER DATABASE;
}
</pre></li>
                           <li>
                              <p>If recovery was successful, then open the database and reset the online logs:</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN RESETLOGS;</pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV908"></a><div class="props_rev_3"><a id="GUID-6B71E7DF-A2B6-44F5-A8D5-B184BB41A768" name="GUID-6B71E7DF-A2B6-44F5-A8D5-B184BB41A768"></a><h3 id="BRADV-GUID-6B71E7DF-A2B6-44F5-A8D5-B184BB41A768" class="sect3"><span class="enumeration_section">20.5 </span>Restoring a Database on a New Host
               </h3>
               <div>
                  <p>Use the <code class="codeph">RESTORE</code> and <code class="codeph">RECOVER</code> commands to restore a database on a new host. Restoring a database on a new host is useful when you want to perform a test run of your disaster recovery procedures or to permanently move a database to a new host.
                  </p>
                  <p>If you use the procedure in this section, then the DBID for the restored database is the same as the DBID for the original database. Do not register a test database created in this way in the same recovery catalog as the source database. Because the DBID of the two databases is the same, the metadata for the test database can interfere with RMAN's ability to restore and recover the source database.</p>
                  <p>If your goal is to create a copy of your target database for ongoing use on a new host, then use the RMAN <code class="codeph">DUPLICATE</code> command instead of this procedure. The <code class="codeph">DUPLICATE</code> command assigns a new DBID to the database it creates, enabling it to be registered in the same recovery catalog as the original database. 
                  </p>
                  <p><span class="bold">To restore a database on a new host:</span></p>
                  <ol>
                     <li>
                        <p>Complete the steps that must be performed before you restore the database, as described in <span class="q">"<a href="rman-recovery-advanced.html#GUID-0EE8068A-5D2F-41FF-BDB9-DEEC8CBCCDB9" title="Certain steps must be preformed to prepare for the restoration of the database on a new host.">Preparing to Restore a Database on a New Host</a>"</span>.
                        </p>
                     </li>
                     <li>
                        <p>Transfer the target database backups to the new host and restore the backups, as described in <span class="q">"<a href="rman-recovery-advanced.html#GUID-6A176AA2-5E35-4F3D-A125-E7C32A1D672A" title="To move the database to a new host by using data file copies or backup sets on disk, you must transfer the files manually to the new host. This procedure assumes that RMAN is using a recovery catalog.">Restoring Disk Backups to a New Host</a>"</span>.
                        </p>
                     </li>
                  </ol>
                  <div class="infoboxnotealso" id="GUID-6B71E7DF-A2B6-44F5-A8D5-B184BB41A768__GUID-6FEE8087-73E4-4318-A4BC-5407AAE99C6E">
                     <p class="notep1">See Also:</p>
                     <p><a href="rman-recovery-advanced.html#GUID-23B34A02-C9D0-4C83-A0C8-C9B5446D5555" title="It is recommended that you test whether you can restore your database to a new host.">Testing the Restore of a Database on a New Host</a></p>
                  </div>
               </div><a id="BRADV89831"></a><div class="props_rev_3"><a id="GUID-0EE8068A-5D2F-41FF-BDB9-DEEC8CBCCDB9" name="GUID-0EE8068A-5D2F-41FF-BDB9-DEEC8CBCCDB9"></a><h4 id="BRADV-GUID-0EE8068A-5D2F-41FF-BDB9-DEEC8CBCCDB9" class="sect4"><span class="enumeration_section">20.5.1 </span>Preparing to Restore a Database on a New Host
                  </h4>
                  <div>
                     <p>Certain steps must be preformed to prepare for the restoration of the database on a new host.</p>
                     <div class="section">
                        <p>The steps include the following:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Record the DBID for your source database.</p>
                           </li>
                           <li>
                              <p>Make the source database initialization parameter file accessible on the new host. Copy the file from the old host to a new host by using an operating system utility.</p>
                           </li>
                           <li>
                              <p>If you perform a test restore operation only, then ensure that RMAN is <span class="italic">not </span>connected to the recovery catalog. Otherwise, RMAN records metadata about the restored data files in the recovery catalog. This metadata interferes with future attempts to restore and recover the primary database.
                              </p>
                              <p>If you must use a recovery catalog because the control file is not large enough to contain the RMAN repository data on all of the backups that you must restore, then use Oracle Data Pump to export the catalog and import it into a different schema or database. Afterward, use the copied recovery catalog for the test restore. Otherwise, the recovery catalog considers the restored database as the current target database.</p>
                           </li>
                           <li>
                              <p>Ensure that backups used for the restore operation are accessible on the restore host. For example, if the backups were made with a media manager, then verify that the tape device is connected to the new host. If you are using disk copies, then use the procedure in the following section.</p>
                           </li>
                           <li>
                              <p>If you are performing a trial restore of the production database, then perform either of the following actions before restoring the database in the test environment:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>If the test database will use a fast recovery area that is physically <span class="italic">different</span> from the recovery area used by the production database, then set <code class="codeph">DB_RECOVERY_FILE_DEST</code> in the test database instance to the new location.
                                    </p>
                                 </li>
                                 <li>
                                    <p>If the test database will use a fast recovery area that is physically the <span class="italic">same</span> as the recovery area used by the production database, then set <code class="codeph">DB_UNIQUE_NAME</code> in the test database instance to a different name from the production database.
                                    </p>
                                 </li>
                              </ul>
                              <p>If you do not perform either of the preceding actions, then RMAN assumes that you are restoring the production database and deletes flashback logs from the fast recovery area because they are considered unusable.</p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-0EE8068A-5D2F-41FF-BDB9-DEEC8CBCCDB9__GUID-F2C04D83-1034-4335-AB6E-C26BDF17E42A">
                           <p class="notep1">See Also:</p>
                           <p><span class="q">"<a href="rman-complete-database-recovery.html#GUID-34BB2E4B-B2FC-4701-BB65-BFED027DB865" title="It is recommended that you record the DBID of your database.">Determining the DBID of the Database</a>"</span> to learn how to determine the DBID fo your database
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV368"></a><a id="BRADV89832"></a><div class="props_rev_3"><a id="GUID-6A176AA2-5E35-4F3D-A125-E7C32A1D672A" name="GUID-6A176AA2-5E35-4F3D-A125-E7C32A1D672A"></a><h4 id="BRADV-GUID-6A176AA2-5E35-4F3D-A125-E7C32A1D672A" class="sect4"><span class="enumeration_section">20.5.2 </span>Restoring Disk Backups to a New Host
                  </h4>
                  <div>
                     <p>To move the database to a new host by using data file copies or backup sets on disk, you must transfer the files manually to the new host. This procedure assumes that RMAN is using a recovery catalog.</p>
                     <div class="section">
                        <p><span class="bold">To restore backup files to a new host:</span></p>
                        <ol>
                           <li>
                              <p>Start RMAN and connect to a target database and recovery catalog, as described in <span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span>.
                              </p>
                           </li>
                           <li>
                              <p>Run a <code class="codeph">LIST</code> command to see a listing of backups of the data file and control file autobackups.
                              </p>
                              <p>For example, enter the following command to view data file copies: </p><pre class="oac_no_warn" dir="ltr">LIST COPY;
</pre><p>For example, enter the following command to view control file backups: </p><pre class="oac_no_warn" dir="ltr">LIST BACKUP OF CONTROLFILE;
</pre><p>The piece name of the autobackup must use the <code class="codeph">%F</code> substitution variable, so the autobackup piece name includes the string <code class="codeph">c-IIIIIIIIII-YYYYMMDD-QQ</code>, where <code class="codeph">IIIIIIIIII</code> stands for the DBID, <code class="codeph">YYYYMMDD</code> is a time stamp in the Gregorian calendar of the day the backup is generated, and <code class="codeph">QQ</code> is the sequence in hexadecimal.
                              </p>
                           </li>
                           <li>
                              <p>Copy the backups to the new host with an operating system utility. </p>
                              <p>Enter a command such as the following to copy all data file copies to the <code class="codeph">?/oradata/trgt</code> directory on the new host:
                              </p><pre class="oac_no_warn" dir="ltr">% cp -r /disk1/*dbf /net/new_host/oracle/oradata/trgt
</pre><p>Enter a command such as the following to copy the autobackup backup piece to the <code class="codeph">/tmp</code> directory on the new host:
                              </p><pre class="oac_no_warn" dir="ltr">% cp -r /disk1/auto_bkp_loc/c-1618370911-20130208-00 /net/new_host/tmp
</pre><p>You must use the <code class="codeph">SET CONTROLFILE AUTOBACKUP FORMAT</code> command when restoring an autobackup from a nondefault location.
                              </p>
                           </li>
                        </ol>
                        <div class="infoboxnotealso" id="GUID-6A176AA2-5E35-4F3D-A125-E7C32A1D672A__GUID-06AEB6F1-581E-4310-9B64-CCAEF078008C">
                           <p class="notep1">See Also:</p>
                           <p><span class="q">"<a href="rman-recovery-advanced.html#GUID-8077F97F-76A7-49DC-8C1E-5FE8ADD0914F" title="If you have configured control file autobackups, then the server parameter file is backed up with the control file whenever an autobackup is taken.">Restoring the Server Parameter File from a Control File Autobackup</a>"</span></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV369"></a><a id="BRADV89833"></a><div class="props_rev_3"><a id="GUID-23B34A02-C9D0-4C83-A0C8-C9B5446D5555" name="GUID-23B34A02-C9D0-4C83-A0C8-C9B5446D5555"></a><h4 id="BRADV-GUID-23B34A02-C9D0-4C83-A0C8-C9B5446D5555" class="sect4"><span class="enumeration_section">20.5.3 </span>Testing the Restore of a Database on a New Host
                  </h4>
                  <div>
                     <p>It is recommended that you test whether you can restore your database to a new host.</p>
                     <div class="section">
                        <p>In this scenario, you have two networked Linux hosts, <code class="codeph">hosta</code> and <code class="codeph">hostb</code>. A target database named <code class="codeph">trgta</code> is on <code class="codeph">hosta</code> and is registered in recovery catalog <code class="codeph">catdb</code>. You want to test the restore and recovery of <code class="codeph">trgta</code> on <code class="codeph">hostb</code>, while keeping database <code class="codeph">trgta</code> up and running on <code class="codeph">hosta</code>.
                        </p>
                        <p>Now, assume that the directory structure of <code class="codeph">hostb</code> is different from <code class="codeph">hosta</code>. The target database is located in <code class="codeph">/net/hosta/dev3/oracle/dbs</code>, but you want to restore the database to <code class="codeph">/net/hostb/oracle/oradata/test</code>. You have tape backups of data files, control files, archived redo logs, and the server parameter file on a media manager accessible by both hosts. The <code class="codeph">ORACLE_SID</code> for the <code class="codeph">TRGTA</code> database is <code class="codeph">TRGTA</code> and does not change for the restored database.
                        </p>
                        <div class="infoboxnote" id="GUID-23B34A02-C9D0-4C83-A0C8-C9B5446D5555__GUID-0049ABAB-7529-4C00-AAFB-F14052BFF244">
                           <p class="notep1">Caution:</p>
                           <p>If you are restoring the database for test purposes, then <span class="italic">never</span> connect RMAN to the test database and the recovery catalog.
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><span class="bold">To restore the database on a new host:</span></p>
                        <ol>
                           <li>
                              <p>Ensure that the backups of the target database are accessible on the new host. </p>
                              <p>To test disaster recovery, you must have a recoverable backup of the target database. When preparing your disaster recovery strategy, ensure that the backups of the data files, control files, and server parameter file are restorable on <code class="codeph">hostb</code>. Thus, you must configure the media management software so that <code class="codeph">hostb</code> is a media manager client and can read the backup sets created on <code class="codeph">hosta</code>. Consult the media management vendor for support on this issue.
                              </p>
                           </li>
                           <li>
                              <p>Configure the <code class="codeph">ORACLE_SID</code> on <code class="codeph">hostb</code>.
                              </p>
                              <p>This scenario assumes that you want to start the RMAN client on <code class="codeph">hostb</code> and authenticate yourself through the operating system. However, you must be connected to <code class="codeph">hostb</code> either locally or through a net service name.
                              </p>
                              <p>After logging in to <code class="codeph">hostb</code> with administrator privileges, edit the <code class="codeph">/etc/group</code> file so that you are included in the DBA group:
                              </p><pre class="oac_no_warn" dir="ltr">dba:*:614:&lt;your_user_name&gt;
</pre><p>Set the <code class="codeph">ORACLE_SID</code> environment variable on <code class="codeph">hostb</code> to the same value used on <code class="codeph">hosta</code>:
                              </p><pre class="oac_no_warn" dir="ltr">% setenv ORACLE_SID trgta
</pre></li>
                           <li>
                              <p>Start RMAN on <code class="codeph">hostb</code> and connect to the target database <span class="italic">without</span> connecting to the recovery catalog. 
                              </p>
                              <p>For example, enter the following command:</p><pre class="oac_no_warn" dir="ltr">% rman NOCATALOG
RMAN&gt; CONNECT TARGET /
</pre></li>
                           <li>
                              <p>Set the DBID and start the database instance without mounting the database.</p>
                              <p>For example, run <code class="codeph">SET</code> <code class="codeph">DBID</code> to set the DBID, then run <code class="codeph">STARTUP</code> <code class="codeph">NOMOUNT</code>:
                              </p><pre class="oac_no_warn" dir="ltr">SET DBID 1340752057;
STARTUP NOMOUNT
</pre><p>RMAN fails to find the server parameter file, which has not yet been restored, but starts the instance with a "dummy" file. Sample output follows:</p><pre class="oac_no_warn" dir="ltr">startup failed: ORA-01078: failure in processing system parameters
LRM-00109: could not open parameter file '/net/hostb/oracle/dbs/inittrgta.ora'

trying to start the Oracle instance without parameter files ...
Oracle instance started
</pre></li>
                           <li>
                              <p>Restore and edit the server parameter file. </p>
                              <p>Because you enabled the control file autobackup feature when making your backups, the server parameter file is included in the backup. If you are restoring an autobackup that has a nondefault format, then use the <code class="codeph">SET CONTROLFILE AUTOBACKUP FORMAT</code> command to indicate the format.
                              </p>
                              <p>Allocate a channel to the media manager, then restore the server parameter file as a client-side parameter file and use the <code class="codeph">SET</code> command to indicate the location of the autobackup (in this example, the autobackup is in <code class="codeph">/tmp</code>): 
                              </p><pre class="oac_no_warn" dir="ltr">RUN
{
  ALLOCATE CHANNEL c1 DEVICE TYPE sbt PARMS '...';
  SET CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '/tmp/%F';
  RESTORE SPFILE 
    TO PFILE '?/oradata/test/inittrgta.ora' 
    FROM AUTOBACKUP;
  SHUTDOWN ABORT;
}
</pre></li>
                           <li>
                              <p>Edit the restored initialization parameter file. </p>
                              <p>Change any location-specific parameters, for example, those ending in <code class="codeph">_DEST</code>, to reflect the new directory structure. For example, edit the following parameters:
                              </p><pre class="oac_no_warn" dir="ltr">  - IFILE
  - LOG_ARCHIVE_DEST_1
  - CONTROL_FILES
</pre></li>
                           <li>
                              <p>Restart the instance with the edited initialization parameter file.</p>
                              <p>For example, enter the following command:</p><pre class="oac_no_warn" dir="ltr">STARTUP FORCE NOMOUNT PFILE='?/oradata/test/inittrgta.ora';
</pre></li>
                           <li>
                              <p>Restore the control file from an autobackup and then mount the database. </p>
                              <p>For example, enter the following command:</p><pre class="oac_no_warn" dir="ltr">RUN 
{
  ALLOCATE CHANNEL c1 DEVICE TYPE sbt PARMS '...';
  RESTORE CONTROLFILE FROM AUTOBACKUP;
  ALTER DATABASE MOUNT;
}
</pre><p>RMAN restores the control file to whatever locations you specified in the <code class="codeph">CONTROL_FILES</code> initialization parameter. 
                              </p>
                           </li>
                           <li>
                              <p>Catalog the data file copies that you copied in <span class="q">"<a href="rman-recovery-advanced.html#GUID-6A176AA2-5E35-4F3D-A125-E7C32A1D672A" title="To move the database to a new host by using data file copies or backup sets on disk, you must transfer the files manually to the new host. This procedure assumes that RMAN is using a recovery catalog.">Restoring Disk Backups to a New Host</a>"</span>, using their new file names or <code class="codeph">CATALOG START</code> <code class="codeph">WITH</code> (if you know all the files are in directories with a common prefix easily addressed with a <code class="codeph">CATALOG START WITH</code> command). For example, run:
                              </p><pre class="oac_no_warn" dir="ltr">CATALOG START WITH '/oracle/oradata/trgt/';
</pre><p>If you want to specify files individually, then you can execute a <code class="codeph">CATALOG</code> command as follows:
                              </p><pre class="oac_no_warn" dir="ltr">CATALOG DATAFILECOPY
  '/oracle/oradata/trgt/system01.dbf', '/oracle/oradata/trgt/undotbs01.dbf', 
  '/oracle/oradata/trgt/cwmlite01.dbf', '/oracle/oradata/trgt/drsys01.dbf',
  '/oracle/oradata/trgt/example01.dbf', '/oracle/oradata/trgt/indx01.dbf', 
  '/oracle/oradata/trgt/tools01.dbf', '/oracle/oradata/trgt/users01.dbf';
</pre></li>
                           <li>
                              <p>Start a SQL*Plus session on the new database and query the database file names recorded in the control file. </p>
                              <p>Because the control file is from the <code class="codeph">trgta</code> database, the recorded file names use the original <code class="codeph">hosta</code> file names. You can query <code class="codeph">V$</code> views to obtain this information. Run the following query in SQL*Plus:
                              </p><pre class="oac_no_warn" dir="ltr">COLUMN NAME FORMAT a60
SPOOL  LOG '/tmp/db_filenames.out'
SELECT FILE# AS "File/Grp#", NAME 
FROM   V$DATAFILE
UNION
SELECT GROUP#,MEMBER 
FROM   V$LOGFILE;
SPOOL OFF
EXIT
</pre></li>
                           <li>
                              <p>Write the RMAN restore and recovery script. The script must include the following steps:</p>
                              <ol type="a">
                                 <li>
                                    <p>For each data file on the destination host that is restored to a different path than it had on the source host, use a <code class="codeph">SET</code> <code class="codeph">NEWNAME</code> command to specify the new path on the destination host. If the file systems on the destination system are set up to have the same paths as the source host, then do not use <code class="codeph">SET NEWNAME</code> for those files restored to the same path as on the source host.
                                    </p>
                                 </li>
                                 <li>
                                    <p>For each online redo log that is to be created at a different location than it had on the source host, use SQL <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">RENAME</code> <code class="codeph">FILE</code> commands to specify the path name on the destination host. If the file systems on the destination system are set up to have the same paths as the source host, then do not use <code class="codeph">ALTER DATABASE RENAME FILE</code> for those files restored to the same path as on the source host.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Perform a <code class="codeph">SET UNTIL</code> operation to limit recovery to the end of the archived redo logs. The recovery stops with an error if no <code class="codeph">SET UNTIL</code> command is specified.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Restore and recover the database.</p>
                                 </li>
                                 <li>
                                    <p>Run the <code class="codeph">SWITCH DATAFILE ALL</code> command so that the control file recognizes the new path names as the official new names of the data files.
                                    </p>
                                 </li>
                              </ol>
                              <p>The following code shows the RMAN script <code class="codeph">reco_test.rman</code> that can perform the restore and recovery operation.
                              </p><pre class="oac_no_warn" dir="ltr">RUN
{
  # allocate a channel to the tape device
  ALLOCATE CHANNEL c1 DEVICE TYPE sbt PARMS '...';

  # rename the data files and online redo logs
  SET NEWNAME FOR DATAFILE 1 TO '?/oradata/test/system01.dbf';
  SET NEWNAME FOR DATAFILE 2 TO '?/oradata/test/undotbs01.dbf';
  SET NEWNAME FOR DATAFILE 3 TO '?/oradata/test/cwmlite01.dbf';
  SET NEWNAME FOR DATAFILE 4 TO '?/oradata/test/drsys01.dbf';
  SET NEWNAME FOR DATAFILE 5 TO '?/oradata/test/example01.dbf';
  SET NEWNAME FOR DATAFILE 6 TO '?/oradata/test/indx01.dbf';
  SET NEWNAME FOR DATAFILE 7 TO '?/oradata/test/tools01.dbf';
  SET NEWNAME FOR DATAFILE 8 TO '?/oradata/test/users01.dbf';
  ALTER DATABASE RENAME FILE '/dev3/oracle/dbs/redo01.log'
      TO '?/oradata/test/redo01.log';
  ALTER DATABASE RENAME FILE '/dev3/oracle/dbs/redo02.log'
      TO '?/oradata/test/redo02.log';

  # Do a SET UNTIL to prevent recovery of the online logs
  SET UNTIL SCN 123456;
  # restore the database and switch the data file names
  RESTORE DATABASE;
  SWITCH DATAFILE ALL;

  # recover the database
  RECOVER DATABASE;
}
EXIT
</pre></li>
                           <li>
                              <p>Execute the script created in the previous step.</p>
                              <p>For example, start RMAN to connect to the target database and run the <code class="codeph">@</code> command:
                              </p><pre class="oac_no_warn" dir="ltr">% rman TARGET / NOCATALOG
RMAN&gt; @reco_test.rman
</pre></li>
                           <li>
                              <p>Open the restored database with the <code class="codeph">RESETLOGS</code> option.
                              </p>
                              <p>From the RMAN prompt, open the database with the <code class="codeph">RESETLOGS</code> option:
                              </p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE OPEN RESETLOGS;</pre><div class="infoboxnote" id="GUID-23B34A02-C9D0-4C83-A0C8-C9B5446D5555__GUID-09A55798-F84C-496A-9832-AE6F616BD5C8">
                                 <p class="notep1">Caution:</p>
                                 <p>When you re-open your database in the next step, do not connect to the recovery catalog. Otherwise, the new database incarnation created is registered automatically in the recovery catalog, and the file names of the production database are replaced by the new file names specified in the script.</p>
                              </div>
                           </li>
                           <li>
                              <p>Optionally, delete the test database with all of its files. </p>
                              <div class="infoboxnote" id="GUID-23B34A02-C9D0-4C83-A0C8-C9B5446D5555__GUID-1A519371-8FD3-4DC8-BFA0-03C3248C845C">
                                 <p class="notep1">Note:</p>
                                 <p>If you used an ASM disk group, then the <code class="codeph">DROP DATABASE</code> command is the only way to safely remove the files of the test database. If you restored to non-ASM storage then you can also use operating system commands to remove the database.
                                 </p>
                              </div>
                              <p>Use the <code class="codeph">DROP DATABASE</code> command to delete all files associated with the database automatically. The following example deletes the database files:
                              </p><pre class="oac_no_warn" dir="ltr">STARTUP FORCE NOMOUNT PFILE='?/oradata/test/inittrgta.ora';
DROP DATABASE;
</pre><p>Because you did not perform the restore and recovery operation when connected to the recovery catalog, the recovery catalog contains no records for any of the restored files or the procedures performed during the test. Likewise, the control file of the <code class="codeph">trgta</code> database is completely unaffected by the test.
                              </p>
                           </li>
                        </ol>
                        <div class="infoboxnotealso" id="GUID-23B34A02-C9D0-4C83-A0C8-C9B5446D5555__GUID-7C9C8A3D-E400-4A21-9E11-3BD91530C303">
                           <p class="notep1">See Also:</p>
                           <p><span class="q">"<a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="You can create database connections from the RMAN client or the operating system command line. These database connection can be authenticated using a password file or with operating system authentication.">Making Database Connections with RMAN</a>"</span></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-759D9D57-D638-4557-BBCA-891E898CDC76" name="GUID-759D9D57-D638-4557-BBCA-891E898CDC76"></a><h3 id="BRADV-GUID-759D9D57-D638-4557-BBCA-891E898CDC76" class="sect3"><span class="enumeration_section">20.6 </span>Restoring Backups Created Using Older Versions of RMAN
               </h3>
               <div>
                  <p>You can restore backups that were created using older versions of RMAN, up to Oracle Database 9<span class="italic">i</span> Release 2 (9.2.0.8). 
                  </p>
                  <div class="section">There must be a supported upgrade path between the Oracle Database version on which the backups were created and the Oracle software version on which you want to run the restored database.</div>
                  <!-- class="section" -->
                  <div class="p">
                     <p>In this example, the source database is an Oracle Database 11<span class="italic">g</span> Release 2 database and it is configured to use a server parameter file (spfile). The database runs in <code class="codeph">ARCHIVELOG</code> mode and uses a fast recovery area. Control file autobackups are also configured. You then create RMAN backups of the source database, including the archived redo logs.
                     </p>
                     <p>The destination host on which these backups are restored has Oracle Database 12<span class="italic">c</span> Release 1 installed.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-759D9D57-D638-4557-BBCA-891E898CDC76__GUID-97C91D3A-D4EA-4806-8F9E-27BB034EE661">To restore RMAN backups that were created using an RMAN version that is older than the current target database version:</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>Verify that there is a supported upgrade path from the database version on which the backups were created to the Oracle server version on which you plan to restore the database.</span><div>
                           <p>For example, if your RMAN backups were created on Oracle Database 11g Release 2 (11.2.0.3) and you want to run the restored database on Oracle Database 12<span class="italic">c</span> Release 1 (12.1), then you must verify that there is a supported upgrade path from release 11.2.0.3 to release 12.1.
                           </p>
                           <div class="infoboxnotealso" id="GUID-759D9D57-D638-4557-BBCA-891E898CDC76__GUID-43FDDB18-61A6-4F85-AFCB-79D3F2CF7F34">
                              <p class="notep1">See Also:</p>
                              <p><a href="../upgrd/oracle-database-releases-that-support-direct-upgrade.html#UPGRD12358" target="_blank"><span class="italic">Oracle Database Upgrade Guide</span></a> for information about the database upgrade paths
                              </p>
                           </div>
                        </div>
                     </li>
                     <li class="stepexpand"><span>Ensure that the source database backups are available at the destination host on which they must be restored.</span><div>You can either use an operating system utility to copy the backups to the destination host or store the backups in a shared location that is accessible to the destination host.</div>
                     </li>
                     <li class="stepexpand"><span>Shut down the destination database.</span></li>
                     <li class="stepexpand"><span>On the destination host, set the <code class="codeph">ORACLE_SID</code> to the same value that was used on the source database.</span><div><pre class="oac_no_warn" dir="ltr">%  setenv ORACLE_SID db112</pre></div>
                     </li>
                     <li class="stepexpand"><span>Start RMAN on the destination host and connect to the target database using operating system authentication and without a recovery catalog.</span><div><pre class="oac_no_warn" dir="ltr">% rman target / NOCATALOG</pre></div>
                     </li>
                     <li class="stepexpand"><span>Set the DBID to the same value as the source database.</span><div>
                           <p>The following command sets the DBID to 699892390, which is the DBID of the source database whose backups are being restored.</p><pre class="oac_no_warn" dir="ltr">RMAN&gt; set DBID 699892390;</pre></div>
                     </li>
                     <li class="stepexpand"><span>Start the target database in nomount mode.</span><div><pre class="oac_no_warn" dir="ltr">RMAN&gt; startup nomount;</pre><p>RMAN fails to find the server parameter file, which has not yet been restored. However, the instance is started with a “dummy” file and the following output is displayed:</p><pre class="oac_no_warn" dir="ltr">startup failed: ORA-01078: failure in processing system parameters
LRM-00109: could not open parameter file '/oracle/dbs/inittrgta.ora'
trying to start the Oracle instance without parameter files ...
Oracle instance started</pre></div>
                     </li>
                     <li class="stepexpand"><span>Restore the server parameter file from the source database autobackup.</span><div>
                           <p>Because controlfile autobackups were enabled in the source database, the server parameter file is included in the backup. To restore an autobackup that has a nondefault format, use the <code class="codeph">SET CONTROLFILE AUTOBACKUP FORMAT</code> command to indicate the format.
                           </p>
                           <p>The following example sets the autobackup format, restores the spfile in the source database to the pfile <code class="codeph">/dev3/oracle/network/init_db112.ora</code>, and then shuts down the target database.
                           </p><pre class="oac_no_warn" dir="ltr">run
{
    set controlfile autobackup format for device type disk to '/scratch/fra/cf/%F.bck';
    restore spfile to pfile '/dev3/oracle/network/init_db112.ora' from autobackup recovery area '/scratch /fra/cf' db_name 'DB112';
    shutdown abort;
}</pre></div>
                     </li>
                     <li class="stepexpand"><span>Edit the restored initialization parameter file and modify the required initialization parameters. </span><div>
                           <p>This includes the <code class="codeph">COMPATIBLE</code> parameter, if the compatibility requirement for the target database is different from that set in the source database, and parameters that are deprecated in the target database release. Also update any location-specific parameters such as those ending with <code class="codeph">_DEST</code> to reflect the new directory structure.
                           </p>
                           <p>In this example, you must edit the pfile located at <code>/dev3/oracle/network/init_db112.ora</code>.
                           </p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>Restart the instance with the edited initialization parameter file.</span><div>
                           <p>The following command starts the database instance in nomount mode using the edited parameter file.</p><pre class="oac_no_warn" dir="ltr">RMAN&gt; startup force nomount pfile='/dev3/oracle/network/init_db112.ora';</pre></div>
                     </li>
                     <li class="stepexpand"><span>Restore the control file from an autobackup and then mount the database.</span><div>
                           <p>The following example sets the format for the control file autobackups, restores the control file from an autobackup, and then mounts the database.</p><pre class="oac_no_warn" dir="ltr">run
{
    set controlfile autobackup format for device type disk to '/scratch/fra/cf/%F.bck';
    restore controlfile from autobackup recovery area '/scratch/fra/cf' db_name 'DB112'; 
    alter database mount;
}</pre><p>The control file is restored to the location specified in the <code class="codeph">CONTROL_FILES</code> initialization parameter in the edited initialization parameter file.
                           </p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>Catalog data file copies of the source database that were made available to the destination host.</span><div>
                           <p>If all the files are in directories with a common prefix, then use the <code class="codeph">CATALOG START WITH</code> command. If you want to specify the file names individually, then use the <code class="codeph">CATALOG DATAFILECOPY</code> command.
                           </p>
                           <p>In the following example, all the data file copies are stored in a single folder <code>/scratch/fra/DB112/backupset</code> and so we use the <code class="codeph">CATALOG START WITH</code> command.
                           </p><pre class="oac_no_warn" dir="ltr">RMAN&gt; catalog start with '/scratch/fra/DB112/backupset';</pre></div>
                     </li>
                     <li class="stepexpand"><span>Restore and recover the source database.</span><div>
                           <p>If the data files are restored to a different path than those on the source database, you must specify a new path on the destination host by using the <code class="codeph">SET NEWNAME</code> command. If the online redo logs are to be created in a different location than those on the source database, then use the <code class="codeph">ALTER DATABASE RENAME FILE</code> command to specify the location of each redo log file on the destination database.
                           </p>
                           <p>In this example, the <code class="codeph">SET NEWNAME FOR DATABASE</code> command is used to specify the new location for all restored data files. The new location for each online redo log file is specified using an <code class="codeph">ALTER DATABASE RENAME FILE</code> command. Recovery is performed until the SCN specified in the command.
                           </p><pre class="oac_no_warn" dir="ltr">run
{
    set newname for database to '/ade/b/1885631999/oracle/dbs/%U.f';
    alter database rename file '/dev1/oracle/dbs/redo01.log' to '/dev3/oracle/dbs/redo1.log';
    alter database rename file '/dev1/oracle/dbs/redo02.log' to '/dev3/oracle/dbs/redo2.log';
    set until scn 1092435;
    restore database;
    switch datafile all;
    recover database;
}</pre></div>
                     </li>
                     <li class="stepexpand"><span>Open the restored database with the <code class="codeph">RESETLOGS</code> and <code class="codeph">UPGRADE</code> options.</span><div><pre class="oac_no_warn" dir="ltr">RMAN&gt; alter database open resetlogs upgrade;
Statement processed
RMAN-06900: WARNING: unable to generate V$RMAN_STATUS or V$RMAN_OUTPUT row
RMAN-06901: WARNING: disabling update of the V$RMAN_STATUS and V$RMAN_OUTPUT rows
ORACLE error from target database: 
ORA-04023: Object SYS.STANDARD could not be validated or authorized</pre><p>The error is caused by database packages that need to be revalidated as part of the upgrade process.</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>Exit RMAN.</span></li>
                     <li class="stepexpand"><span>Upgrade the target database to the desired Oracle release by performing the steps required to upgrade a database.</span><div>
                           <div class="infoboxnotealso" id="GUID-759D9D57-D638-4557-BBCA-891E898CDC76__GUID-E09568CA-36DC-4E93-9CC5-9246346692D5">
                              <p class="notep1">See Also:</p>
                              <p><a href="../upgrd/oracle-database-releases-that-support-direct-upgrade.html#UPGRD12358" target="_blank"><span class="italic">Oracle Database Upgrade Guide</span></a> for information about upgrading the database
                              </p>
                           </div>
                        </div>
                     </li>
                  </ol>
               </div>
            </div><a id="BRADV680"></a><div class="props_rev_3"><a id="GUID-8E64485B-3788-4389-A892-8C560F12443F" name="GUID-8E64485B-3788-4389-A892-8C560F12443F"></a><h3 id="BRADV-GUID-8E64485B-3788-4389-A892-8C560F12443F" class="sect3"><span class="enumeration_section">20.7 </span>Restoring and Recovering Files Over the Network
               </h3>
               <div>
                  <p>RMAN enables you to restore or recover files by connecting, over the network, to a physical standby database that contains the required files. You can restore an entire database, data files, control files, server parameter file, or tablespaces. Restoring files over the network is very useful in scenarios where you need to synchronize the primary and standby databases.</p>
                  <p>Backup sets are used to restore or recover files over the network. Therefore, you can use multisection backups, encryption, and compression to improve backup and restore performance.</p>
                  <p>Restoring and recovering files over the network is supported starting with Oracle Database 12<span class="italic">c</span> Release 1 (12.1).
                  </p>
                  <p>This section includes:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="rman-recovery-advanced.html#GUID-DF586DC2-A0F0-4EFD-AF8A-FC6C0B553C31" title="RMAN restores database files, over the network, from a physical standby database by using the FROM SERVICE clause of the RESTORE command.">About Restoring Files Over the Network</a></p>
                     </li>
                     <li>
                        <p><a href="rman-recovery-advanced.html#GUID-2ABBC0FC-D01E-4A1E-8FD6-9F04880D4E3F" title="You can perform recovery by fetching an incremental backup, over the network, from a primary database and then applying this incremental backup to the physical standby database.">About Recovering Files Over the Network</a></p>
                     </li>
                     <li>
                        <p><a href="rman-recovery-advanced.html#GUID-8466262D-9F86-431B-AA34-A7002A5498A1" title="Recovering files by connecting, over the network, to a physical standby database is useful in certain scenarios.">Scenarios for Restoring and Recovering Files Over the Network</a></p>
                     </li>
                     <li>
                        <p><a href="rman-recovery-advanced.html#GUID-43FF41E9-81D2-41A5-B2E6-8E2E2CE91EDB" title="Use the RESTORE command to restore lost or damaged data files by connecting over the network to a primary database or physical standby database.">Restoring Data Files Over the Network</a></p>
                     </li>
                     <li>
                        <p><a href="rman-recovery-advanced.html#GUID-93C8F7F1-E1FB-485D-ABC7-860757B24A98" title="RMAN rolls forward a physical standby database by creating an incremental backup that contains the changes to the primary database, transferring the incremental backup over the network to the physical standby database, and then applying the incremental backup to the physical standby database. All changes to data files on the primary database, beginning with the SCN in the standby data file header, are included in the incremental backup.">Rolling Forward a Physical Standby Database Using the RECOVER Command</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV681"></a><div class="props_rev_3"><a id="GUID-DF586DC2-A0F0-4EFD-AF8A-FC6C0B553C31" name="GUID-DF586DC2-A0F0-4EFD-AF8A-FC6C0B553C31"></a><h4 id="BRADV-GUID-DF586DC2-A0F0-4EFD-AF8A-FC6C0B553C31" class="sect4"><span class="enumeration_section">20.7.1 </span>About Restoring Files Over the Network
                  </h4>
                  <div>
                     <p>RMAN restores database files, over the network, from a physical standby database by using the <code class="codeph">FROM SERVICE</code> clause of the <code class="codeph">RESTORE</code> command. 
                     </p>
                     <p>The <code class="codeph">FROM SERVICE</code> clause provides the service name of the physical standby database from which the files must be restored. During the restore operation, RMAN creates backup sets, on the physical standby database, of the files that need to be restored and then transfers these backup sets to the target database over the network.
                     </p>
                     <p>Use the <code class="codeph">SECTION SIZE</code> clause of the <code class="codeph">RESTORE</code> command to perform a multisection restore operation. To encrypt the backup sets created on the physical standby database, use the <code class="codeph">SET ENCRYPTION</code> command before the <code class="codeph">RESTORE</code> command to specify the encryption algorithm used.
                     </p>
                     <p>To transfer files from the physical standby database as compressed backup sets, use the <code class="codeph">USING COMPRESSED BACKUPSET</code> clause in the <code class="codeph">RESTORE</code> command. By default, RMAN compresses backup sets using the algorithm that is set in the RMAN configuration. You can override the default and set a different algorithm by using the <code class="codeph">SET COMPRESSION ALGORITHM</code> command before the <code class="codeph">RESTORE</code> statement.
                     </p>
                  </div>
               </div><a id="BRADV682"></a><div class="props_rev_3"><a id="GUID-2ABBC0FC-D01E-4A1E-8FD6-9F04880D4E3F" name="GUID-2ABBC0FC-D01E-4A1E-8FD6-9F04880D4E3F"></a><h4 id="BRADV-GUID-2ABBC0FC-D01E-4A1E-8FD6-9F04880D4E3F" class="sect4"><span class="enumeration_section">20.7.2 </span>About Recovering Files Over the Network
                  </h4>
                  <div>
                     <p>You can perform recovery by fetching an incremental backup, over the network, from a primary database and then applying this incremental backup to the physical standby database. </p>
                     <p>RMAN is connected as <code class="codeph">TARGET</code> to the physical standby database. The recovery process is optimized by restoring only the used data blocks in a data file. Use the <code class="codeph">FROM SERVICE</code> clause to specify the service name of the primary database from which the incremental backup must be fetched.
                     </p>
                     <p>To use multisection backup sets during the recovery process, specify the <code class="codeph">SECTION SIZE</code> clause in the <code class="codeph">RECOVER</code> command. To transfer the required files from the primary database as encrypted backup sets, use the <code class="codeph">SET ENCRYPTION</code> command before the <code class="codeph">RESTORE</code> command to specify the encryption algorithm used to create the backup sets.
                     </p>
                     <p>To compress backup sets that are used to recover files over the network, use the <code class="codeph">USING COMPRESSED BACKUPSET</code>. RMAN compresses backup sets when it creates them on the primary database and then transfers these backup sets to the target database. 
                     </p>
                  </div>
               </div><a id="BRADV683"></a><div class="props_rev_3"><a id="GUID-8466262D-9F86-431B-AA34-A7002A5498A1" name="GUID-8466262D-9F86-431B-AA34-A7002A5498A1"></a><h4 id="BRADV-GUID-8466262D-9F86-431B-AA34-A7002A5498A1" class="sect4"><span class="enumeration_section">20.7.3 </span>Scenarios for Restoring and Recovering Files Over the Network
                  </h4>
                  <div>
                     <p>Recovering files by connecting, over the network, to a physical standby database is useful in certain scenarios.</p>
                     <p>These scenarios include the following:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>You need to roll-forward a physical standby database to make it in-sync with the primary database.</p>
                           <p>After creating an incremental backup of the latest changes on the primary database, you can restore the physical standby database using the incremental backup.</p>
                        </li>
                        <li>
                           <p>You want to restore lost data files, control files, or tablespaces on a primary database using the corresponding files on the physical standby database. You can also restore files on a physical standby database by using the primary database.</p>
                        </li>
                     </ul>
                  </div>
               </div><a id="BRADV684"></a><div class="props_rev_3"><a id="GUID-43FF41E9-81D2-41A5-B2E6-8E2E2CE91EDB" name="GUID-43FF41E9-81D2-41A5-B2E6-8E2E2CE91EDB"></a><h4 id="BRADV-GUID-43FF41E9-81D2-41A5-B2E6-8E2E2CE91EDB" class="sect4"><span class="enumeration_section">20.7.4 </span>Restoring Data Files Over the Network
                  </h4>
                  <div>
                     <p>Use the <code class="codeph">RESTORE</code> command to restore lost or damaged data files by connecting over the network to a primary database or physical standby database.
                     </p>
                     <div class="section">
                        <p>In this example, the <code class="codeph">DB_UNIQUE_NAME</code> of the primary database is <code class="codeph">MAIN</code> and the <code class="codeph">DB_UNIQUE_NAME</code> of the physical standby database is <code class="codeph">STANDBY</code>. The data file <code class="codeph">sales.dbf</code> on the primary database was lost. You want to restore this data file from the physical standby database. The service name of the physical standby database is <code class="codeph">standby_tns</code>. The <code class="codeph">RESTORE</code> command with the <code class="codeph">FROM SERVICE</code> clause enables you to restore the lost data file in the primary database by using the data file in the physical standby database. The password file in the primary database and the physical standby database are the same.
                        </p>
                        <p>Use the following steps to restore the data file <code class="codeph">sales.dbf</code> in the primary database by using the data file in the physical standby database:
                        </p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Connect to the primary database as a user with the <code class="codeph">SYSBACKUP</code> privilege.</span><div><pre class="oac_no_warn" dir="ltr">%RMAN
RMAN&gt; CONNECT TARGET "sbu@main AS SYSBACKUP";
</pre><p>Enter the password for the <code class="codeph">sbu</code> user when prompted.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Specify that the backup sets must be encrypted using the AES128 encryption algorithm</span><div><pre class="oac_no_warn" dir="ltr">RMAN&gt; SET ENCRYPTION ALGORITHM 'AES128';
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Ensure that the <code class="codeph">tnsnames.ora</code> file in the physical standby database contains an entry corresponding to the primary database. Also ensure that the password files on the primary and physical standby database are the same.</span></li>
                        <li class="stepexpand"><span>Restore the data file on the primary database by using the data file on the physical standby database. The following command creates multisection backup sets to perform the restore operation.</span><div><pre class="oac_no_warn" dir="ltr">RESTORE DATAFILE '/oradata/datafiles/sales.dbf'
FROM SERVICE standby_tns
SECTION SIZE 120M;
</pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV685"></a><div class="props_rev_3"><a id="GUID-93C8F7F1-E1FB-485D-ABC7-860757B24A98" name="GUID-93C8F7F1-E1FB-485D-ABC7-860757B24A98"></a><h4 id="BRADV-GUID-93C8F7F1-E1FB-485D-ABC7-860757B24A98" class="sect4"><span class="enumeration_section">20.7.5 </span>Rolling Forward a Physical Standby Database Using the RECOVER Command
                  </h4>
                  <div>
                     <p>RMAN rolls forward a physical standby database by creating an incremental backup that contains the changes to the primary database, transferring the incremental backup over the network to the physical standby database, and then applying the incremental backup to the physical standby database. All changes to data files on the primary database, beginning with the SCN in the standby data file header, are included in the incremental backup.</p>
                     <p>You can use the <code class="codeph">RECOVER ... FROM SERVICE</code> command to synchronize the data files on the physical standby database with those on the primary database. This command refreshes the standby data files and rolls them forward to the same point-in-time as the primary. However, the standby control file still contains old SCN values which are lower than the SCN values in the standby data files. Therefore, to complete the synchronization of the physical standby database, you must refresh the standby control file and then update the data file names, online redo log file names, and the standby redo log file names in the refreshed standby control file.
                     </p>
                     <p>If network resources are a constraint, then you can use the <code class="codeph">BACKUP INCREMENTAL</code> command to create incremental backups on the primary database, and then use the incremental backups to roll forward the physical standby database.
                     </p>
                     <p><span class="q">"<a href="rman-recovery-advanced.html#GUID-828A4953-3F7E-4975-ADA4-5469D6794BB0" title="Use the RECOVER STANDBY DATABASE command with the FROM SERVICE clause to refresh a physical standby database with changes that were made to the primary database.">Steps to Refresh a Physical Standby Database with Changes Made to the Primary Database</a>"</span> describes the steps to refresh a physical standby using the <code class="codeph">FROM SERVICE</code> clause.
                     </p>
                     <div class="infoboxnotealso" id="GUID-93C8F7F1-E1FB-485D-ABC7-860757B24A98__GUID-C3DCC851-E53E-4C67-AD21-F42B5F93F146">
                        <p class="notep1">See Also:</p>
                        <p><a href="../sbydb/managing-oracle-data-guard-physical-standby-databases.html#SBYDB-GUID-B140C38B-DE01-4252-8422-7154018DDFEC" target="_blank"><span><cite>Oracle Data Guard Concepts and Administration</cite></span></a> for information about using the <code class="codeph">BACKUP INCREMENTAL</code> command to roll forward a physical standby database
                        </p>
                     </div>
                  </div><a id="BRADV858"></a><div class="props_rev_3"><a id="GUID-828A4953-3F7E-4975-ADA4-5469D6794BB0" name="GUID-828A4953-3F7E-4975-ADA4-5469D6794BB0"></a><h5 id="BRADV-GUID-828A4953-3F7E-4975-ADA4-5469D6794BB0" class="sect5"><span class="enumeration_section">20.7.5.1 </span>Steps to Refresh a Physical Standby Database with Changes Made to the Primary Database
                     </h5>
                     <div>
                        <p>Use the <code class="codeph">RECOVER STANDBY DATABASE</code> command with the <code class="codeph">FROM SERVICE</code> clause to refresh a physical standby database with changes that were made to the primary database.
                        </p>
                        <div class="section">
                           <p></p>
                           <p>This example assumes that the <code class="codeph">DB_UNIQUE_NAME</code> of the primary database is <code class="codeph">MAIN</code> and its net service name is <code class="codeph">primary_db</code>. The <code class="codeph">DB_UNIQUE_NAME</code> of the standby database is <code class="codeph">STANDBY</code> and its net service name is <code class="codeph">standby_db</code>.
                           </p>
                           <p><span class="bold">To refresh the physical standby database with changes made to the primary database:</span></p>
                           <ol>
                              <li>
                                 <p>Ensure that the following prerequisites are met:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>Oracle Net connectivity is established between the physical standby database and the primary database.</p>
                                       <p>You can do this by adding an entry corresponding to the primary database in the <code class="codeph">tnsnames.ora</code> file of the physical standby database.
                                       </p>
                                    </li>
                                    <li>
                                       <p>The password files on the primary database and the physical standby database are the same.</p>
                                    </li>
                                    <li>
                                       <p>The <code class="codeph">COMPATIBLE</code> parameter in the initialization parameter file of the primary database and physical standby database is set to 12.0.
                                       </p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>Start RMAN and connect as target to the physical standby database. It is recommended that you also connect to a recovery catalog.</p>
                                 <p>The following commands connect as <code class="codeph">TARGET</code> to the physical standby database and as <code class="codeph">CATALOG</code> to the recovery catalog. The connection to the physical standby is established using the <code class="codeph">sbu</code> user, who has been granted <code class="codeph">SYSBACKUP</code> privilege. The net service name of the physical standby database is <code class="codeph">standby_db</code> and that of the recovery catalog is <code class="codeph">catdb</code>.
                                 </p><pre class="oac_no_warn" dir="ltr">CONNECT TARGET "sbu@standby_db AS SYSBACKUP";
CONNECT CATALOG rman@catdb;
</pre></li>
                              <li>
                                 <p>Roll forward the physical standby database using the <code class="codeph">RECOVER STANDBY DATABASE</code> command with the <code class="codeph">FROM SERVICE</code> clause.
                                 </p>
                                 <p>The <code class="codeph">FROM SERVICE</code> clause specifies the service name of the primary database using which the physical standby must be rolled forward. The standby database is restarted after the roll forward operation.
                                 </p>
                                 <p>The following example rolls forward the physical standby database using the primary database whose service name is <code class="codeph">primary_db</code>. 
                                 </p><pre class="pre codeblock"><code>RECOVER STANDBY DATABASE FROM SERVICE primary_db;</code></pre></li>
                              <li>
                                 <p>(For Active Data Guard only) Perform the following steps to recover redo data and open the physical standby database in read-only mode:</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE RECOVER MANAGED STANDBY DATABASE UNTIL CONSISTENT;
ALTER DATABASE OPEN READ ONLY;</pre></li>
                              <li>
                                 <p>Start the managed recovery processes on the physical standby database.</p>
                                 <p>The following command starts the managed recovery process:</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE RECOVER MANAGED STANDBY DATABASE DISCONNECT FROM SESSION;</pre><p>When using Data Guard Broker, use the following command to start the managed recovery process:</p><pre class="oac_no_warn" dir="ltr">DGMGRL&gt; edit database standby_db set state='APPLY-ON';</pre></li>
                           </ol>
                           <div class="infoboxnotealso" id="GUID-828A4953-3F7E-4975-ADA4-5469D6794BB0__GUID-30F15DA5-B540-41F4-BD7A-ED90E200DEB4">
                              <p class="notep1">See Also:</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=NETAG177" target="_blank"><span><cite>Oracle Database Net Services Administrator's Guide</cite></span></a> for information about establishing Oracle Net connectivity
                              </p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>