<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="A column of JSON data can be stored in the In-Memory Column Store (IM column store) to improve query performance.">
      <meta name="description" content="A column of JSON data can be stored in the In-Memory Column Store (IM column store) to improve query performance.">
      <title>In-Memory JSON Data</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="JSON Developer's Guide">
      <meta property="og:description" content="A column of JSON data can be stored in the In-Memory Column Store (IM column store) to improve query performance.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="JSON Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="json-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-02-22T10:58:31-08:00">
      <meta name="dcterms.title" content="JSON Developer's Guide">
      <meta name="dcterms.dateCopyrighted" content="2015, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96227-03">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="indexes-for-json-data.html" title="Previous" type="text/html">
      <link rel="next" href="oracle-json-restrictions.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="ADJSN">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="indexes-for-json-data.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="oracle-json-restrictions.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">JSON Developer's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="performance-tuning-for-json-data.html" property="item" typeof="WebPage"><span property="name">Performance Tuning for JSON</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">In-Memory JSON Data</li>
            </ol>
            <a id="GUID-857A2E95-28AB-4314-B654-4CB05C50D9CF" name="GUID-857A2E95-28AB-4314-B654-4CB05C50D9CF"></a>
            
            <h2 id="ADJSN-GUID-857A2E95-28AB-4314-B654-4CB05C50D9CF" class="sect2"><span class="enumeration_chapter">27 </span>In-Memory JSON Data
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>A column of JSON data can be stored in the In-Memory Column Store (IM column store) to improve query performance.</p>
               <div class="section"></div>
               <!-- class="section" -->
               <div class="section">
                  <div class="infoboxnotealso" id="GUID-857A2E95-28AB-4314-B654-4CB05C50D9CF__GUID-7F9B45ED-BE01-4403-BF81-FAC7DD2DCB8E">
                     <p class="notep1">See Also:</p><a href="../inmem/in-memory-column-store-architecture.html#INMEM-GUID-EEA265EE-8FBA-4457-8C3F-315B9EEA2224" target="_blank"><span><cite>Oracle Database In-Memory Guide</cite></span></a></div>
               </div>
               <!-- class="section" -->
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="in-memory-json-data.html#GUID-D75759D2-4889-42D2-A035-021F19CC720B">Overview of In-Memory JSON Data</a><br>You can move a table with a column of JSON data to the In-Memory Column Store (IM column store), to improve the performance of queries that share costly expressions by caching the expression results. This is especially useful for analytical queries that scan a large number of small JSON documents.
                  </li>
                  <li class="ulchildlink"><a href="in-memory-json-data.html#GUID-45A2965A-52D2-4512-AA00-17A88B20AB34">Populating JSON Data Into the In-Memory Column Store</a><br>You use <code class="codeph">ALTER TABLE INMEMORY</code> to populate a table with a column of JSON data into the In-Memory Column Store (IM column store), to improve the performance of queries that share costly expressions by caching the results of evaluating those expressions.
                  </li>
                  <li class="ulchildlink"><a href="in-memory-json-data.html#GUID-5508C598-1512-4F2E-A948-9EC32C8A4865">Upgrading Tables With JSON Data For Use With the In-Memory Column Store</a><br>A table with JSON columns created using a database that did not have a compatibility setting of at least 12.2 <span class="italic">or</span> did not have <code class="codeph">max_string_size = extended</code> must first be upgraded, before it can be populated into the In-Memory Column Store (IM column store). To do this, run script <code class="codeph">rdbms/admin/utlimcjson.sql</code>.
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>Parent topic:</strong> <a href="performance-tuning-for-json-data.html#GUID-D3A3F17B-8372-43A7-83A3-E37C22E9011E" title="To tune query performance you can index JSON fields in several ways, store their values in the In-Memory Column Store (IM column store), or expose them as non-JSON data using materialized views.">Performance Tuning for JSON</a></p>
                  </div>
               </div>
            </div>
            
            <div class="sect2"><a id="GUID-D75759D2-4889-42D2-A035-021F19CC720B" name="GUID-D75759D2-4889-42D2-A035-021F19CC720B"></a><h3 id="ADJSN-GUID-D75759D2-4889-42D2-A035-021F19CC720B" class="sect3"><span class="enumeration_section">27.1 </span>Overview of In-Memory JSON Data
               </h3>
               <div>
                  <p>You can move a table with a column of JSON data to the In-Memory Column Store (IM column store), to improve the performance of queries that share costly expressions by caching the expression results. This is especially useful for analytical queries that scan a large number of small JSON documents.</p>
                  <p>The IM column store is supported only for JSON documents smaller than 32,767 bytes. If you have a mixture of document sizes, those documents that are larger than 32,767 bytes are processed without the In-Memory optimization. For better performance, consider breaking up documents larger than 32,767 bytes into smaller documents.</p>
                  <p>The IM column store is an optional SGA pool that stores copies of tables and partitions in a special columnar format optimized for rapid scans. The IM column store supplements the row-based storage in the database buffer cache. You do not need to load the same object into both the IM column store and the buffer cache. The two caches are kept transactionally consistent. The database transparently sends online transaction processing (OLTP) queries (such as primary-key lookups) to the buffer cache and analytic and reporting queries to the IM column store.</p>
                  <p>You can think of the use of JSON data in memory as improving the performance of SQL/JSON path access. SQL/JSON functions <code class="codeph">json_table</code>, <code class="codeph">json_query</code>, and <code class="codeph">json_value</code>, and SQL condition <code class="codeph">json_exists</code> all accept a SQL/JSON path argument, and they can all benefit from loading JSON data into the IM column store. (Full-text search using SQL/JSON function <code class="codeph">json_textcontains</code> does <span class="italic">not</span> benefit from the IM column store.) Once JSON documents have been loaded into memory, any subsequent path-based operations on them use the In-Memory representation, which avoids the overhead associated with reading and parsing the on-disk format.
                  </p>
                  <p>If queried JSON data is populated into the IM column store, and if there are function-based indexes that can apply to that data, the optimizer chooses whether to use an index or to scan the data in memory. In general, if index probing results in few documents then a functional index can be preferred by the optimizer. In practice this means that the optimizer can prefer a functional index for very selective queries or DML statements.</p>
                  <p>On the other hand, if index probing results in many documents then the optimizer might choose to scan the data in memory, by scanning the function-based index expression as a virtual-column expression.</p>
                  <p>Ad hoc queries, that is, queries that are not used frequently to target a given SQL/JSON path expression, benefit in a general way from populating JSON data into the IM column store, by quickly scanning the data. But if you have some frequently used queries then you can often further improve their performance in these ways:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Creating <span class="italic">virtual columns</span> that project scalar values (not under an array) from a column of JSON data and loading those virtual columns into the IM column store. 
                        </p>
                     </li>
                     <li>
                        <p>Creating a <span class="italic">materialized view</span> on a frequently queried <code class="codeph">json_table</code> expression and loading the view into the IM column store.
                        </p>
                     </li>
                  </ul>
                  <p>However, if you have a function-based index that projects a scalar value using function <code class="codeph">json_value</code> then you need not explicitly create a virtual column to project it. As mentioned above, in this case the function-based index expression is automatically loaded into the IM column store as a virtual column. The optimizer can choose, based on estimated cost, whether to scan the function-based index in the usual manner or to scan the index expression as a virtual-column expression.
                  </p>
                  <div class="infoboxnote" id="GUID-D75759D2-4889-42D2-A035-021F19CC720B__GUID-6E273C18-4546-499A-BF7A-8D7FBEA8530C">
                     <p class="notep1">Note:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The advantages of a virtual column over a materialized view are that you can build an index on it and you can obtain statistics on it for the optimizer.</p>
                        </li>
                        <li>
                           <p>Virtual columns, like columns in general, are subject to the 1000-column limit for a given table.</p>
                        </li>
                     </ul>
                  </div>
                  <div class="section">
                     <p class="subhead2" id="GUID-D75759D2-4889-42D2-A035-021F19CC720B__GUID-D923A3C3-A437-462E-ACA0-CB6CE722F9E1">Prerequisites For Using JSON Data In Memory</p>
                     <p>To be able to take advantage of the IM column store for JSON data, the following must <span class="italic">all</span> be true:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Database compatibility is 12.2.0.0 or higher.</p>
                        </li>
                        <li>
                           <p>The values set for <code class="codeph">max_string_size</code> in the Oracle instance startup configuration file must be <code class="codeph">'extended'</code>.
                           </p>
                        </li>
                        <li>
                           <p>Sufficient SGA memory must be configured for  the IM column store.</p> 
                        </li>
                        <li>
                           <p>A DBA has specified that the tablespace, table, or materialized view that contains the JSON columns is eligible for population into the IM column store, using keyword <code class="codeph">INMEMORY</code> in a <code class="codeph">CREATE</code> or <code class="codeph">ALTER</code> statement.
                           </p>
                        </li>
                        <li>
                           <p>Initialization parameters are set as follows:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">IMMEMORY_EXPRESSIONS_USAGE</code> is <code class="codeph">STATIC_ONLY</code> or <code class="codeph">ENABLE</code>.
                                 </p>
                                 <p><code class="codeph">ENABLE</code> allows In-Memory materialization of dynamic expressions, if used in conjunction with PL/SQL procedure <code class="codeph">DBMS_INMEMORY.ime_capture_expressions</code>.
                                 </p>
                              </li>
                              <li>
                                 <p> <code class="codeph">IMMEMORY_VIRTUAL_COLUMNS</code> is <code class="codeph">ENABLE</code>, meaning that the IM column store populates all virtual columns. (The default value is <code class="codeph">MANUAL</code>.)
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>The columns storing the JSON data must each have <code class="codeph">is json</code> check constraints. (That is, the data must be known to be JSON data.)
                           </p>
                        </li>
                     </ul>
                     <p>You can check the value of each initialization parameter using command <code class="codeph">SHOW PARAMETER</code>. (You must be logged in as database user <code class="codeph">SYS</code> or equivalent for this.) For example:
                     </p><pre class="pre codeblock"><code>SHOW PARAMETER INMEMORY_VIRTUAL_COLUMNS</code></pre></div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="in-memory-json-data.html#GUID-45A2965A-52D2-4512-AA00-17A88B20AB34" title="You use ALTER TABLE INMEMORY to populate a table with a column of JSON data into the In-Memory Column Store (IM column store), to improve the performance of queries that share costly expressions by caching the results of evaluating those expressions.">Populating JSON Data Into the In-Memory Column Store</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="in-memory-json-data.html#GUID-857A2E95-28AB-4314-B654-4CB05C50D9CF" title="A column of JSON data can be stored in the In-Memory Column Store (IM column store) to improve query performance.">In-Memory JSON Data</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-45A2965A-52D2-4512-AA00-17A88B20AB34" name="GUID-45A2965A-52D2-4512-AA00-17A88B20AB34"></a><h3 id="ADJSN-GUID-45A2965A-52D2-4512-AA00-17A88B20AB34" class="sect3"><span class="enumeration_section">27.2 </span>Populating JSON Data Into the In-Memory Column Store
               </h3>
               <div>
                  <p>You use <code class="codeph">ALTER TABLE INMEMORY</code> to populate a table with a column of JSON data into the In-Memory Column Store (IM column store), to improve the performance of queries that share costly expressions by caching the results of evaluating those expressions.
                  </p>
                  <div class="section">
                     <p>The&nbsp;IM column store is an optional SGA pool that stores copies of tables and partitions in a special&nbsp;columnar format&nbsp;optimized for rapid scans. The IM column store supplements the row-based storage in the database buffer cache. (It does not replace the buffer cache, but you do not need to load the same object into both the IM column store and the buffer cache. The two caches are kept transactionally consistent.)</p>
                     <p>You specify that a table with a given JSON column (that is, a column that has an <code class="codeph">is json</code> check constraint) is to be populated into the IM column store by marking the table as <code class="codeph">INMEMORY</code>. <a href="in-memory-json-data.html#GUID-45A2965A-52D2-4512-AA00-17A88B20AB34__GUID-3CE54055-C619-499F-81EA-D9EE3D2102D0">Example 27-1</a> illustrates this. 
                     </p>
                     <p>The IM column store is used for queries of documents that are smaller than 32,767 bytes. Queries of documents that are larger than that do not benefit from the IM column store.</p>
                     <div class="infoboxnote" id="GUID-45A2965A-52D2-4512-AA00-17A88B20AB34__GUID-F8610E4D-9796-430B-B8AD-CC958C1A94B5">
                        <p class="notep1">Note:</p>
                        <p>If a JSON column in a table that is to be populated into the IM column store was created using a database that did not have a compatibility setting of at least 12.2 <span class="italic">or</span> did not have <code class="codeph">max_string_size</code> set to <code class="codeph">extended</code> (this is the case prior to Oracle Database 12c&nbsp;Release 2 (12.2.0.1), for instance) then you must first run script <code class="codeph">rdbms/admin/utlimcjson.sql</code>. It prepares <span class="italic">all</span> existing tables that have JSON columns to take advantage of the In-Memory JSON processing that was added in Release 12.2.0.1. See <a href="in-memory-json-data.html#GUID-5508C598-1512-4F2E-A948-9EC32C8A4865" title="A table with JSON columns created using a database that did not have a compatibility setting of at least 12.2 or did not have max_string_size = extended must first be upgraded, before it can be populated into the In-Memory Column Store (IM column store). To do this, run script rdbms/admin/utlimcjson.sql.">Upgrading Tables With JSON Data For Use With the In-Memory Column Store</a>.
                        </p>
                     </div>
                     <p>After you have marked a table that has JSON columns as <code class="codeph">INMEMORY</code>, an <span class="italic">In-Memory virtual column</span> is added to it for each JSON column. The corresponding virtual column is used for queries of a given JSON column. The virtual column contains the same JSON data as the corresponding JSON column, but in an Oracle binary format, <strong class="term">OSON</strong>.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-45A2965A-52D2-4512-AA00-17A88B20AB34__GUID-3CE54055-C619-499F-81EA-D9EE3D2102D0">
                     <p class="titleinexample">Example 27-1 Populating JSON Data Into the IM Column Store</p><pre class="pre codeblock"><code>SELECT COUNT(1) FROM j_purchaseorder
  WHERE json_exists(po_document,
                    '$.ShippingInstructions?(@.Address.zipCode == 99236)');

-- The execution plan shows: TABLE ACCESS FULL


-- Specify table as INMEMORY, with default PRIORITY setting of NONE,
-- so it is populated only when a full scan is triggered.

ALTER TABLE j_purchaseorder <span class="bold">INMEMORY</span>;

-- Query the table again, to populate it into the IM column store.
SELECT COUNT(1) FROM j_purchaseorder
  WHERE json_exists(po_document,
                    '$.ShippingInstructions?(@.Address.zipCode == 99236)');

-- The execution plan for the query now shows: TABLE ACCESS <span class="bold">INMEMORY</span> FULL
</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-45A2965A-52D2-4512-AA00-17A88B20AB34__GUID-67046660-6E09-474F-949B-439BA6D15F94">
                     <p class="notep1">See Also:</p>
                     <p><a href="../inmem/populating-objects-in-memory.html#INMEM-GUID-5D4B2A1F-815F-4FDC-91F8-E5CF7179985B" target="_blank"><span><cite>Oracle Database In-Memory Guide</cite></span></a></p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="in-memory-json-data.html#GUID-857A2E95-28AB-4314-B654-4CB05C50D9CF" title="A column of JSON data can be stored in the In-Memory Column Store (IM column store) to improve query performance.">In-Memory JSON Data</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-5508C598-1512-4F2E-A948-9EC32C8A4865" name="GUID-5508C598-1512-4F2E-A948-9EC32C8A4865"></a><h3 id="ADJSN-GUID-5508C598-1512-4F2E-A948-9EC32C8A4865" class="sect3"><span class="enumeration_section">27.3 </span>Upgrading Tables With JSON Data For Use With the In-Memory Column Store
               </h3>
               <div>
                  <p>A table with JSON columns created using a database that did not have a compatibility setting of at least 12.2 <span class="italic">or</span> did not have <code class="codeph">max_string_size = extended</code> must first be upgraded, before it can be populated into the In-Memory Column Store (IM column store). To do this, run script <code class="codeph">rdbms/admin/utlimcjson.sql</code>.
                  </p>
                  <div class="section">
                     <p>Script <code class="codeph">rdbms/admin/utlimcjson.sql</code> upgrades <span class="italic">all</span> existing tables that have JSON columns so they can be populated into the IM column store. To use it, <span class="italic">all</span> of the following must be true:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Database parameter <code class="codeph">compatible</code> must be set to <code class="codeph">12.2.0.0</code> or higher.
                           </p>
                        </li>
                        <li>
                           <p>Database parameter <code class="codeph">max_string_size</code> must be set to <code class="codeph">extended</code>.
                           </p>
                        </li>
                        <li>
                           <p>The JSON columns being upgraded must have an <code class="codeph">is json</code> check constraint defined on them.
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section"></div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="in-memory-json-data.html#GUID-D75759D2-4889-42D2-A035-021F19CC720B" title="You can move a table with a column of JSON data to the In-Memory Column Store (IM column store), to improve the performance of queries that share costly expressions by caching the expression results. This is especially useful for analytical queries that scan a large number of small JSON documents.">Overview of In-Memory JSON Data</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="in-memory-json-data.html#GUID-857A2E95-28AB-4314-B654-4CB05C50D9CF" title="A column of JSON data can be stored in the In-Memory Column Store (IM column store) to improve query performance.">In-Memory JSON Data</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>