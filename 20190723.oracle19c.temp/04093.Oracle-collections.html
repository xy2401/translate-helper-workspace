<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Working with Oracle Collections</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="JDBC Developer's Guide">
      <meta property="og:description" content>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="JDBC Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="jdbc-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-02-13T13:20:37-08:00">
      <meta name="dcterms.title" content="JDBC Developer's Guide">
      <meta name="dcterms.dateCopyrighted" content="1999, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96471-02">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="Oracle-object-references.html" title="Previous" type="text/html">
      <link rel="next" href="resultset.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="JJDBC">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="Oracle-object-references.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="resultset.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">JDBC Developer's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="data-access-and-manipulation.html" property="item" typeof="WebPage"><span property="name"> Data Access and Manipulation</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Working with Oracle Collections </li>
            </ol>
            <a id="GUID-338038DB-AE3A-4C82-BB8F-8C87F2D130C4" name="GUID-338038DB-AE3A-4C82-BB8F-8C87F2D130C4"></a><a id="JJDBC28574"></a>
            
            <h2 id="JJDBC-GUID-338038DB-AE3A-4C82-BB8F-8C87F2D130C4" class="sect2"><span class="enumeration_chapter">16 </span> Working with Oracle Collections 
            </h2>
         </header>
         <div class="ind">
            <div>
               <p><a id="d57778e21" class="indexterm-anchor"></a><a id="d57778e25" class="indexterm-anchor"></a>This chapter describes Oracle extensions to standard Java Database Connectivity (JDBC) that let you access and manipulate Oracle collections, which map to Java arrays, and their data. The following topics are discussed:
               </p>
               <div class="infoboxnote" id="GUID-338038DB-AE3A-4C82-BB8F-8C87F2D130C4__GUID-27A720D7-E1ED-4394-882E-F160C869C3FA">
                  <p class="notep1">Note:</p>
                  <p>Starting from Oracle Database 12<span class="italic">c </span>Release 1 (12.1), the <code class="codeph">oracle.sql.ARRAY</code> class is deprecated and replaced with the <code class="codeph">oracle.jdbc.OracleArray</code> interface, which is a part of the <code class="codeph">oracle.jdbc</code> package. Oracle recommends you to use the methods available in the <code class="codeph">java.sql</code> package, where possible, for standard compatibility and methods available in the <code class="codeph">oracle.jdbc</code> package for Oracle specific extensions. Refer to MoS Note 1364193.1 for more information about the <code class="codeph">oracle.jdbc.OracleArray</code> interface.
                  </p>
               </div>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="Oracle-collections.html#GUID-76466A35-B189-4A20-B068-578BD0939CD1">Oracle Extensions for Collections</a></p>
                  </li>
                  <li>
                     <p><a href="Oracle-collections.html#GUID-E57699B6-491C-4430-90EB-8FF1912440DA">Overview of Collection Functionality</a></p>
                  </li>
                  <li>
                     <p><a href="Oracle-collections.html#GUID-00517CE4-DC23-4D01-B878-9C50E19B3B0F">ARRAY Performance Extension Methods</a></p>
                  </li>
                  <li>
                     <p><a href="Oracle-collections.html#GUID-BC05FE69-643F-44AF-8D86-2E181F7E6628">Creating and Using Arrays</a></p>
                  </li>
                  <li>
                     <p><a href="Oracle-collections.html#GUID-22D90043-E417-4BC3-A838-0DBA954AF2AA">Using a Type Map to Map Array Elements</a></p>
                  </li>
               </ul>
            </div><a id="JJDBC28575"></a><div class="props_rev_3"><a id="GUID-76466A35-B189-4A20-B068-578BD0939CD1" name="GUID-76466A35-B189-4A20-B068-578BD0939CD1"></a><h3 id="JJDBC-GUID-76466A35-B189-4A20-B068-578BD0939CD1" class="sect3"><span class="enumeration_section">16.1 </span>Oracle Extensions for Collections
               </h3>
               <div>
                  <p>This section covers the following topics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="Oracle-collections.html#GUID-1EDB1964-71FF-4AB1-BD7D-86F15D609D4D">Overview of Oracle Collections</a></p>
                     </li>
                     <li>
                        <p><a href="Oracle-collections.html#GUID-5015B2F4-54A8-4B55-A02F-E10D66887003">Choices in Materializing Collections</a></p>
                     </li>
                     <li>
                        <p><a href="Oracle-collections.html#GUID-13E05667-1EFB-464F-B91F-32E99543DD3F">Creating Collections</a></p>
                     </li>
                     <li>
                        <p><a href="Oracle-collections.html#GUID-D2501ACA-FF2D-4973-B700-7A1024404948">Creating Multilevel Collection Types</a></p>
                     </li>
                  </ul>
               </div>
               <div class="props_rev_3"><a id="GUID-1EDB1964-71FF-4AB1-BD7D-86F15D609D4D" name="GUID-1EDB1964-71FF-4AB1-BD7D-86F15D609D4D"></a><h4 id="JJDBC-GUID-1EDB1964-71FF-4AB1-BD7D-86F15D609D4D" class="sect4"><span class="enumeration_section">16.1.1 </span>Overview of Oracle Collections
                  </h4>
                  <div>
                     <p>An Oracle coll<a id="d57778e147" class="indexterm-anchor"></a>ection, either a variable array (VARRAY) or a nested table in the database, maps to an array in Java. JDBC 2.0 arr<a id="d57778e152" class="indexterm-anchor"></a><a id="d57778e156" class="indexterm-anchor"></a>ays are used to materialize Oracle collections in Java. The terms collection and array are sometimes used interchangeably. However, collection is more appropriate on the database side and array is more appropriate on the JDBC application side.
                     </p>
                     <p>Oracle supports only <a id="d57778e163" class="indexterm-anchor"></a><a id="d57778e165" class="indexterm-anchor"></a>named collections, where you specify a SQL type name to describe a type of collection. JDBC enables you to use arrays as any of the following:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Columns in a <code class="codeph">SELECT</code> clause
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">IN</code> or <code class="codeph">OUT</code> bind variables
                           </p>
                        </li>
                        <li>
                           <p>Attributes in an Oracle object</p>
                        </li>
                        <li>
                           <p>Elements of other arrays</p>
                        </li>
                     </ul>
                  </div>
               </div><a id="JJDBC28576"></a><div class="props_rev_3"><a id="GUID-5015B2F4-54A8-4B55-A02F-E10D66887003" name="GUID-5015B2F4-54A8-4B55-A02F-E10D66887003"></a><h4 id="JJDBC-GUID-5015B2F4-54A8-4B55-A02F-E10D66887003" class="sect4"><span class="enumeration_section">16.1.2 </span>Choices in Materializing Collections
                  </h4>
                  <div>
                     <p>In your application, you have the choice of materializing a collection as an instance of the <code class="codeph">oracle.sql.ARRAY</code> class, which is weakly typed, or materializing it as an instance of a custom Java class that you have created in advance, which is strongly typed. Custom Java classes used for collections are referred to as cus<a id="d57778e218" class="indexterm-anchor"></a>tom collection classes. A custom collection class must implement the Oracle <code class="codeph">oracle.jdbc.OracleData</code> interface. In addition, the custom class or a companion class must implement <code class="codeph">oracle.jdbc.OracleDataFactory</code>. The standard <code class="codeph">java.sql.SQLData</code> interface is for mapping SQL object types only.
                     </p>
                     <p>The <code class="codeph">oracle.sql.ARRAY</code> class implements the standard <code class="codeph">java.sql.Array</code> interface. 
                     </p>
                     <p>The <code class="codeph">ARRAY</code> class includes functionality to retrieve the array as a whole, retrieve a subset of the array elements, and retrieve the SQL base type name of the array elements. However, you cannot write to the array, because there are no setter methods.
                     </p>
                     <p>Custom collection classes, as with the <code class="codeph">ARRAY</code> class, enable you to retrieve all or part of the array and get the SQL base type name. They also have the advantage of being strongly typed, which can help you find coding errors during compilation that might not otherwise be discovered until run time.
                     </p>
                     <div class="infoboxnote" id="GUID-5015B2F4-54A8-4B55-A02F-E10D66887003__GUID-784F5C91-A81F-4277-A272-D2FC108607CF">
                        <p class="notep1">Note:</p>
                        <p>There is no difference in the code between accessing VARRAYs and accessing nested tables. <code class="codeph">ARRAY</code> class methods can determine if they are being applied to a VARRAY or nested table, and respond by taking the appropriate actions. 
                        </p>
                     </div>
                  </div>
               </div><a id="JJDBC28577"></a><div class="props_rev_3"><a id="GUID-13E05667-1EFB-464F-B91F-32E99543DD3F" name="GUID-13E05667-1EFB-464F-B91F-32E99543DD3F"></a><h4 id="JJDBC-GUID-13E05667-1EFB-464F-B91F-32E99543DD3F" class="sect4"><span class="enumeration_section">16.1.3 </span>Creating Collections
                  </h4>
                  <div>
                     <div class="section">
                        <p>Because Oracle supports only named collections, you must declare a particular <code class="codeph">VARRAY</code> type name or nested table type name. VARRAY and nested table are not types themselves, but categories of types.
                        </p>
                        <p>A SQL type name is assigned to a collection when you create it using the SQL <code class="codeph">CREATE TYPE</code> statement:
                        </p><pre class="oac_no_warn" dir="ltr">CREATE TYPE &lt;<span class="italic">sql_type_name</span>&gt; AS &lt;<span class="italic">datatype</span>&gt;;
</pre><p>A VARRAY is an array of varying size. It has an ordered set of data elements, and all the elements are of the same data type. Each element has an index, which is a number corresponding to the position of the element in the VARRAY. The number of elements in a VARRAY is the size of the VARRAY. You must specify a maximum size when you declare the <code class="codeph">VARRAY</code> type. For example:
                        </p><pre class="oac_no_warn" dir="ltr">CREATE TYPE myNumType AS VARRAY(10) OF NUMBER;
</pre><p>This statement defines <code class="codeph">myNumType</code> as a SQL type name that describes a VARRAY of <code class="codeph">NUMBER</code> values that can contain no more than 10 elements.
                        </p>
                        <p>A nested table is an unordered set of data elements, all of the same data type. The database stores a nested table in a separate table which has a single column, and the type of that column is a built-in type or an object type. If the table is an object type, then it can also be viewed as a multi-column table, with a column for each attribute of the object type. You can create a nested table as follows:</p><pre class="oac_no_warn" dir="ltr">CREATE TYPE myNumList AS TABLE OF integer;
</pre><p>This statement identifies <code class="codeph">myNumList</code> as a SQL type name that defines the table type used for the nested tables of the type <code class="codeph">INTEGER</code>.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="JJDBC28578"></a><div class="props_rev_3"><a id="GUID-D2501ACA-FF2D-4973-B700-7A1024404948" name="GUID-D2501ACA-FF2D-4973-B700-7A1024404948"></a><h4 id="JJDBC-GUID-D2501ACA-FF2D-4973-B700-7A1024404948" class="sect4"><span class="enumeration_section">16.1.4 </span>Creating Multilevel Collection Types
                  </h4>
                  <div>
                     <div class="section">
                        <p>The most common way to create a new multilevel collection type in JDBC is to pass the SQL <code class="codeph">CREATE TYPE</code> statement to the <code class="codeph">execute</code> method of the <code class="codeph">java.sql.Statement</code> class. The following code creates a one-level nested table, <code class="codeph">first_level</code>, and a two- levels nested table, <code class="codeph">second_level</code>:
                        </p><pre class="oac_no_warn" dir="ltr">Connection conn = ....                            // make a database
                                                  // connection 
Statement stmt = conn.createStatement();          // open a database
                                                  // cursor 
stmt.execute("CREATE TYPE first_level AS TABLE OF NUMBER");  // create a nested
                                                  // table of number 
stmt.execute("CREATE TYPE second_level AS TABLE OF first_level"); // create a
           // two-levels nested table
...        // other operations here
stmt.close();                                     // release the
                                                  // resource 
conn.close();                                     // close the
                                                  // database connection
</pre><p>Once the multilevel collection types have been created, they can be used as both columns of a base table as well as attributes of a object type. </p>
                        <div class="infoboxnote" id="GUID-D2501ACA-FF2D-4973-B700-7A1024404948__GUID-5D0769DC-78A0-4B80-A442-702A2185F5C7">
                           <p class="notep1">Note:</p>
                           <p>Multilevel collection types are available only for Oracle9<span class="italic">i</span> and later.
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="JJDBC28580"></a><a id="JJDBC28581"></a><a id="JJDBC28579"></a><div class="props_rev_3"><a id="GUID-E57699B6-491C-4430-90EB-8FF1912440DA" name="GUID-E57699B6-491C-4430-90EB-8FF1912440DA"></a><h3 id="JJDBC-GUID-E57699B6-491C-4430-90EB-8FF1912440DA" class="sect3"><span class="enumeration_section">16.2 </span>Overview of Collection Functionality
               </h3>
               <div>
                  <div class="section">
                     <p>You can obtain collection data in an array instance through a result set or callable statement and pass it back as a bind variable in a prepared statement or callable statement.</p>
                     <p>The <code class="codeph">oracle.sql.ARRAY</code> class, which implements the standard <code class="codeph">java.sql.Array</code> interface, provides the necessary functionality to access and update the data of an Oracle collection.
                     </p>
                     <p>This section covers Array Getter and Setter Methods. Use the following result set, callable statement, and prepared statement methods to retrieve and pass collections as Java arrays.</p>
                     <div class="infoboxnote" id="GUID-E57699B6-491C-4430-90EB-8FF1912440DA__GUID-A1E8F2AA-B5BE-4916-8481-B043026B32CB">
                        <p class="notep1">Note:</p>
                        <p>Starting from Oracle Database 12<span class="italic">c </span>Release 1 (12.1), the <code class="codeph">oracle.sql.ARRAY</code> class is deprecated and replaced with the <code class="codeph">oracle.jdbc.OracleArray</code> interface, which is a part of the <code class="codeph">oracle.jdbc</code> package. Oracle recommends you to use the methods available in the <code class="codeph">java.sql</code> package, where possible, for standard compatibility and methods available in the <code class="codeph">oracle.jdbc</code> package for Oracle specific extensions. Refer to MoS Note 1364193.1 for more information about the <code class="codeph">oracle.jdbc.OracleArray</code> interface.
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-E57699B6-491C-4430-90EB-8FF1912440DA__GUID-C760E9B9-5EDC-4354-B4CC-A830A3FB886D">Result Set and Callable Statement Getter Methods</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>The <code class="codeph">OracleResultSet</code> and <code class="codeph">OracleCallableStatement</code> interfaces support <code class="codeph">getARRAY</code> and <code class="codeph">getArray</code> methods to retrieve <code class="codeph">ARRAY</code> objects as output parameters, either as <code class="codeph">oracle.sql.ARRAY</code> instances or <code class="codeph">java.sql.Array</code> instances. You can also use the <code class="codeph">getObject</code> method. These methods take as input a <code class="codeph">String</code> column name or <code class="codeph">int</code> column index.
                     </p>
                     <div class="infoboxnote" id="GUID-E57699B6-491C-4430-90EB-8FF1912440DA__GUID-BFEF1A4E-F3E5-4585-89AB-EE6BCA3A05FD">
                        <p class="notep1">Note:</p>
                        <p>The Oracle JDBC drivers cache array and structure descriptors. This provides enormous performance benefits; however, it means that if you change the underlying type definition of an array type in the database, the cached descriptor for that array type will become stale and your application will receive a <code class="codeph">SQLException</code>.
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-E57699B6-491C-4430-90EB-8FF1912440DA__GUID-4077765D-C4F8-4A3E-B2CD-13364B0F57F9">Prepared and Callable Statement Setter Methods</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>The <code class="codeph">OraclePreparedStatement</code> and <code class="codeph">OracleCallableStatement</code> classes support <code class="codeph">setARRAY</code> and <code class="codeph">setArray</code> methods to take updated <code class="codeph">ARRAY</code> objects as bind variables and pass them to the database. You can also use the <code class="codeph">setObject</code> method. These methods take as input a <code class="codeph">String</code> parameter name or <code class="codeph">int</code> parameter index as well as an <code class="codeph">oracle.sql.ARRAY</code> instance or a <code class="codeph">java.sql.Array</code> instance.
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDBC28585"></a><div class="props_rev_3"><a id="GUID-00517CE4-DC23-4D01-B878-9C50E19B3B0F" name="GUID-00517CE4-DC23-4D01-B878-9C50E19B3B0F"></a><h3 id="JJDBC-GUID-00517CE4-DC23-4D01-B878-9C50E19B3B0F" class="sect3"><span class="enumeration_section">16.3 </span>ARRAY Performance Extension Methods
               </h3>
               <div>
                  <div class="section">
                     <p>This section discusses the following topics:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="Oracle-collections.html#GUID-C51FE01E-CB73-4BFB-A0A3-3474C5DE5E6A">About Accessing oracle.sql.ARRAY Elements as Arrays of Java Primitive Types</a></p>
                        </li>
                        <li>
                           <p><a href="Oracle-collections.html#GUID-33CC8F2C-4E73-412B-990E-D4293173E199">ARRAY Automatic Element Buffering</a></p>
                        </li>
                        <li>
                           <p><a href="Oracle-collections.html#GUID-98DAE89F-6100-4D1F-8E65-546E7943A191">ARRAY Automatic Indexing</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="JJDBC28586"></a><div class="props_rev_3"><a id="GUID-C51FE01E-CB73-4BFB-A0A3-3474C5DE5E6A" name="GUID-C51FE01E-CB73-4BFB-A0A3-3474C5DE5E6A"></a><h4 id="JJDBC-GUID-C51FE01E-CB73-4BFB-A0A3-3474C5DE5E6A" class="sect4"><span class="enumeration_section">16.3.1 </span>About Accessing oracle.sql.ARRAY Elements as Arrays of Java Primitive Types
                  </h4>
                  <div>
                     <div class="section">
                        <p>The <code class="codeph">oracle.sql.ARRAY</code> class contains methods that return array elements as Java primitive types. These methods enable you to access collection elements more efficiently than accessing them as <code class="codeph">Datum</code> instances and then converting each <code class="codeph">Datum</code><a id="d57778e592" class="indexterm-anchor"></a> instance to its Java primitive value.
                        </p>
                        <div class="infoboxnote" id="GUID-C51FE01E-CB73-4BFB-A0A3-3474C5DE5E6A__GUID-425AD159-0FD8-47BD-B324-5E8129160CDF">
                           <p class="notep1">Note:</p>
                           <p>These specialized methods of the <code class="codeph">oracle.sql.ARRAY</code> class are restricted to numeric collections.
                           </p>
                        </div>
                        <p>Each method using the first signature returns collection elements as an <span class="italic"><code class="codeph">XXX</code></span><code class="codeph">[]</code>, where <span class="italic"><code class="codeph">XXX</code></span> is a Java primitive type. Each method using the second signature returns a slice of the collection containing the number of elements specified by <code class="codeph">count</code>, starting at the <code class="codeph">index</code> location.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="JJDBC28587"></a><div class="props_rev_3"><a id="GUID-33CC8F2C-4E73-412B-990E-D4293173E199" name="GUID-33CC8F2C-4E73-412B-990E-D4293173E199"></a><h4 id="JJDBC-GUID-33CC8F2C-4E73-412B-990E-D4293173E199" class="sect4"><span class="enumeration_section">16.3.2 </span>ARRAY Automatic Element Buffering
                  </h4>
                  <div>
                     <p>Oracle JDBC driver provides public methods to enable and disable buffering of <code class="codeph">ARRAY</code> contents.
                     </p>
                     <p>The following methods are included with the <code class="codeph">oracle.sql.ARRAY</code> class:<code class="codeph"></code></p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><code class="codeph">setAutoBuffering</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">getAutoBuffering</code></p>
                        </li>
                     </ul>
                     <p>It is advisable to enable auto-buffering in a JDBC application when the <code class="codeph">ARRAY</code> elements will be accessed more than once by the <code class="codeph">getAttributes</code> and <code class="codeph">getArray</code> methods, presuming the <code class="codeph">ARRAY</code> data is able to fit into the Java Virtual Machine (JVM) memory without overflow.
                     </p>
                     <div class="infoboxnote" id="GUID-33CC8F2C-4E73-412B-990E-D4293173E199__GUID-9448147D-D099-471B-A7D9-9EA37BBBAB02">
                        <p class="notep1">Note:</p>
                        <p>Buffering the converted elements may cause the JDBC application to consume a significant amount of memory.</p>
                     </div>
                     <p>When you enable auto-buffering, the <code class="codeph">oracle.sql.ARRAY</code> object keeps a local copy of all the converted elements. This data is retained so that a second access of this information does not require going through the data format conversion process.
                     </p>
                  </div>
               </div><a id="JJDBC28588"></a><div class="props_rev_3"><a id="GUID-98DAE89F-6100-4D1F-8E65-546E7943A191" name="GUID-98DAE89F-6100-4D1F-8E65-546E7943A191"></a><h4 id="JJDBC-GUID-98DAE89F-6100-4D1F-8E65-546E7943A191" class="sect4"><span class="enumeration_section">16.3.3 </span>ARRAY Automatic Indexing
                  </h4>
                  <div>
                     <div class="section">
                        <p>If an array is in auto-indexing mode, then the array object maintains an index table to hasten array element access.</p>
                        <p>The <code class="codeph">oracle.sql.ARRAY</code> class contains the following methods to support automatic array-indexing:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">setAutoIndexing(boolean)</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">setAutoIndexing(boolean, int)</code></p>
                           </li>
                        </ul>
                        <p>By default, auto-indexing is not enabled. For a JDBC application, enable auto-indexing for <code class="codeph">ARRAY</code> objects if random access of array elements may occur through the <code class="codeph">getArray</code> and <code class="codeph">getResultSet</code> methods. 
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="JJDBC28589"></a><div class="props_rev_3"><a id="GUID-BC05FE69-643F-44AF-8D86-2E181F7E6628" name="GUID-BC05FE69-643F-44AF-8D86-2E181F7E6628"></a><h3 id="JJDBC-GUID-BC05FE69-643F-44AF-8D86-2E181F7E6628" class="sect3"><span class="enumeration_section">16.4 </span>Creating and Using Arrays
               </h3>
               <div>
                  <p>This section discusses how to create array objects and how to retrieve and pass collections as array objects, including the following topics.</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="Oracle-collections.html#GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971">Creating ARRAY Objects</a></p>
                     </li>
                     <li>
                        <p><a href="Oracle-collections.html#GUID-ED588B9D-376A-4037-9C46-62642261E62D">Retrieving an Array and Its Elements</a></p>
                     </li>
                     <li>
                        <p><a href="Oracle-collections.html#GUID-BCCFF59D-D84C-410B-B681-BA5AA6285EC6">Passing Arrays to Statement Objects</a></p>
                     </li>
                  </ul>
               </div><a id="JJDBC28591"></a><a id="JJDBC28592"></a><a id="JJDBC28590"></a><div class="props_rev_3"><a id="GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971" name="GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971"></a><h4 id="JJDBC-GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971" class="sect4"><span class="enumeration_section">16.4.1 </span>Creating ARRAY Objects
                  </h4>
                  <div>
                     <div class="section">
                        <div class="infoboxnote" id="GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971__GUID-FA6524BD-94F4-4267-BFEB-79C71B2C0640">
                           <p class="notep1">Note:</p>
                           <p>Oracle JDBC does not support the JDBC 4.0 method <code class="codeph">createArrayOf</code> method of <code class="codeph">java.sql.Connection</code> interface. This method only allows anonymous array types, while all Oracle array types are named. Use the Oracle specific method <code class="codeph">oracle.jdbc.OracleConnection.createARRAY</code> instead.
                           </p>
                        </div>
                        <p>This section describes how to create <code class="codeph">ARRAY</code> objects. This section covers the following topics:
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="Oracle-collections.html#GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971__i1056527">Steps in Creating ARRAY Objects</a></p>
                           </li>
                           <li>
                              <p><a href="Oracle-collections.html#GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971__BABHIJHB">Example 16-1</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section" id="GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971__i1056527">
                        <p class="subhead3" id="GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971__GUID-63581558-994D-4D2F-9BE4-3E142B8BD9C2">Steps in Creating ARRAY Objects</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>Starting from Oracle Database 11<span class="italic">g</span> Release 1, you can use the <code class="codeph">createARRAY</code> factory method of <code class="codeph">oracle.jdbc.OracleConnection</code> interface to create an array object. The factory method for creating arrays has been defined as follows:
                        </p><pre class="oac_no_warn" dir="ltr">public ARRAY createARRAY(java.lang.String typeName,java.lang.Object elements)throws SQLException
</pre><p>where, <code class="codeph">typeName</code> is the name of the SQL type of the created object and <code class="codeph">elements</code> is the elements of the created object.
                        </p>
                        <p>Perform the following to create an array:<a id="d57778e854" class="indexterm-anchor"></a><a id="d57778e856" class="indexterm-anchor"></a></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Create a collection with the <code class="codeph">CREATE</code> <code class="codeph">TYPE</code> statement as follows:</span><div><pre class="oac_no_warn" dir="ltr">CREATE TYPE elements AS varray(22) OF NUMBER(5,2);
</pre><p>The two possibilities for the contents of <code class="codeph">elements</code> are: 
                              </p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>An array of Java primitives. For example, <code class="codeph">int[]</code>.
                                    </p>
                                 </li>
                                 <li>
                                    <p>An array of Java objects, such as <span class="italic"><code class="codeph">xxx</code></span><code class="codeph">[]</code>, where <span class="italic"><code class="codeph">xxx</code></span> is the name of a Java class. For example, <code class="codeph">Integer[]</code>.
                                    </p>
                                    <div class="infoboxnote" id="GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971__GUID-D9D54940-C7B1-4A46-974F-0CFCED523F53">
                                       <p class="notep1">Note:</p>
                                       <p>The <code class="codeph">setARRAY</code>, <code class="codeph">setArray</code>, and <code class="codeph">setObject</code> methods of the <code class="codeph">OraclePreparedStatement</code> class take an object of the type <code class="codeph">oracle.sql.ARRAY</code> as an argument, not an array of objects. 
                                       </p>
                                    </div>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Construct the <code class="codeph">ARRAY</code> object <a id="d57778e925" class="indexterm-anchor"></a>by passing the Java string specifying the user-defined SQL type name of the array and a Java object containing the individual elements you want the array to contain.</span><div><pre class="oac_no_warn" dir="ltr">ARRAY array = oracle.jdbc.OracleConnection.createARRAY(sql_type_name, elements);
</pre></div>
                        </li>
                     </ol>
                     <div class="example" id="GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971__GUID-C206255F-92D8-485B-AFA2-024913C943C6">
                        <div class="infoboxnote" id="GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971__GUID-05883EBC-F574-41CC-AFA4-EE2C7944C19C">
                           <p class="notep1">Note:</p>
                           <p>The name of the collection type is not the same as the type name of the elements. For example:</p><pre class="oac_no_warn" dir="ltr"><code class="codeph">CREATE TYPE person AS object </code>
<code class="codeph">            (c1 NUMBER(5), c2 VARCHAR2(30)); </code>
<code class="codeph">CREATE TYPE array_of_persons AS varray(10)</code>
            OF person; </pre><p>In the preceding statements, the name of the collection type is <code class="codeph">ARRAY_OF_PERSON</code>. The SQL type name of the collection elements is <code class="codeph">PERSON</code>.
                           </p>
                        </div>
                     </div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971__BABHIJHB">
                        <p class="titleinexample">Example 16-1 Creating Multilevel Collections</p>
                        <p>As with single-level collections, the JDBC application can create an <code class="codeph">oracle.sql.ARRAY</code> instance to represent a multilevel collection, and then send the instance to the database. The same <code class="codeph">createARRAY</code> factory method you use to create single-level collections, can be used to create multilevel collections as well. To create a single-level collection, the elements are a one dimensional Java array, while to create a multilevel collection, the elements can be either an array of <code class="codeph">oracle.sql.ARRAY[]</code> elements or a nested Java array or the combinations.
                        </p>
                        <p>The following code shows how to create collection types with a nested Java array:</p><pre class="oac_no_warn" dir="ltr">// prepare the multilevel collection elements as a nested Java array
int[][][] elements = { {{1}, {1, 2}}, {{2}, {2, 3}}, {{3}, {3, 4}} };

// create the ARRAY using the factory method
ARRAY array = oracle.jdbc.OracleConnection.createARRAY(sql_type_name, elements);

</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="JJDBC28595"></a><div class="props_rev_3"><a id="GUID-ED588B9D-376A-4037-9C46-62642261E62D" name="GUID-ED588B9D-376A-4037-9C46-62642261E62D"></a><h4 id="JJDBC-GUID-ED588B9D-376A-4037-9C46-62642261E62D" class="sect4"><span class="enumeration_section">16.4.2 </span>Retrieving an Array and Its Elements
                  </h4>
                  <div>
                     <div class="section">
                        <p>This section first discusses how to retrieve an <code class="codeph">ARRAY</code> instance as a whole from a result set, and then how to retrieve the elements from the <code class="codeph">ARRAY</code> instance. This section covers the following topics:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="Oracle-collections.html#GUID-54680CDD-B176-4E5C-9153-96740C48116E">About Retrieving the Array </a></p>
                           </li>
                           <li>
                              <p><a href="Oracle-collections.html#GUID-3BA98572-FD68-4137-B87E-0DC2AAAC65EE">Data Retrieval Methods</a></p>
                           </li>
                           <li>
                              <p><a href="Oracle-collections.html#GUID-E2AE8600-F9A9-458B-83B8-C01BCAD51365">Comparing the Data Retrieval Methods</a></p>
                           </li>
                           <li>
                              <p><a href="Oracle-collections.html#GUID-4872A6DE-E029-44CF-AF71-4C70979B8F63">Retrieving Elements of a Structured Object Array According to a Type Map</a></p>
                           </li>
                           <li>
                              <p><a href="Oracle-collections.html#GUID-6D8BD317-1F52-4CF6-8E4A-096989E8D2A6">Retrieving a Subset of Array Elements</a></p>
                           </li>
                           <li>
                              <p><a href="Oracle-collections.html#GUID-BCD2C704-39EA-4B52-B3CB-E192F715ED84">Retrieving Array Elements into an oracle.sql.Datum Array</a></p>
                           </li>
                           <li>
                              <p><a href="Oracle-collections.html#GUID-A374A861-2770-418F-9CF6-DBB807CE282C">About Accessing Multilevel Collection Elements</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div><a id="JJDBC28596"></a><div class="props_rev_3"><a id="GUID-54680CDD-B176-4E5C-9153-96740C48116E" name="GUID-54680CDD-B176-4E5C-9153-96740C48116E"></a><h5 id="JJDBC-GUID-54680CDD-B176-4E5C-9153-96740C48116E" class="sect5"><span class="enumeration_section">16.4.2.1 </span>About Retrieving the Array 
                     </h5>
                     <div>
                        <div class="section">
                           <p>You can retrieve a SQL array from a result set by casting the result set to <code class="codeph">OracleResultSet</code> and using the <code class="codeph">getARRAY</code> method, which returns an <code class="codeph">oracle.sql.ARRAY</code> object. If you want to avoid casting the result set, then you can get the data with the standard <code class="codeph">getObject</code> method specified by the <code class="codeph">java.sql.ResultSet</code> interface and cast the output to <code class="codeph">oracle.sql.ARRAY</code>.
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="JJDBC28598"></a><a id="JJDBC28599"></a><a id="JJDBC28600"></a><a id="JJDBC28597"></a><div class="props_rev_3"><a id="GUID-3BA98572-FD68-4137-B87E-0DC2AAAC65EE" name="GUID-3BA98572-FD68-4137-B87E-0DC2AAAC65EE"></a><h5 id="JJDBC-GUID-3BA98572-FD68-4137-B87E-0DC2AAAC65EE" class="sect5"><span class="enumeration_section">16.4.2.2 </span>Data Retrieval Methods
                     </h5>
                     <div>
                        <div class="section">
                           <p>Once you have an <code class="codeph">ARRAY</code> object, you can retrieve the data using one of these three overloaded methods of the <code class="codeph">oracle.sql.ARRAY</code> class:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">getArray</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">getOracleArray</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">getResultSet</code></p>
                              </li>
                           </ul>
                           <p>Oracle also provides methods that enable you to retrieve all the elements of an array, or a subset.</p>
                           <div class="infoboxnote" id="GUID-3BA98572-FD68-4137-B87E-0DC2AAAC65EE__GUID-2DDFB233-7A77-47C4-91F0-B0761B9DE5E4">
                              <p class="notep1">Note:</p>
                              <p>In case you are working with an array of structured objects, Oracle provides versions of these three methods that enable you to specify a type map so that you can choose how to map the objects to Java. </p>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-3BA98572-FD68-4137-B87E-0DC2AAAC65EE__GUID-6E425040-5336-45E5-A6CF-843BA6E0269E">getOracleArray</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>The <code class="codeph">getOracleArray</code> method is an Oracle-specific extension that is not specified in the standard <code class="codeph">Array</code> interface. The <code class="codeph">getOracleArray</code> method retrieves the element values of the array into a <code class="codeph">Datum[]</code> array. The elements are of the <code class="codeph">oracle.sql.*</code> data type corresponding to the SQL type of the data in the original array. 
                           </p>
                           <p>For an array of structured objects, this method will use <code class="codeph">oracle.jdbc.OracleStruct</code> instances for the elements.
                           </p>
                           <p>Oracle also provides a <code class="codeph">getOracleArray(</code><span class="italic"><code class="codeph">index</code></span><code class="codeph">,</code><span class="italic"><code class="codeph">count</code></span><code class="codeph">)</code> <code class="codeph">method</code> to get a subset of the array elements.
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-3BA98572-FD68-4137-B87E-0DC2AAAC65EE__GUID-D1C707D7-533E-4679-A0B2-645E1CB583F3">getResultSet</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>The <code class="codeph">getResultSet</code> method returns a result set that contains elements of the array designated by the <code class="codeph">ARRAY</code> object. The result set contains one row for each array element, with two columns in each row. The first column stores the index into the array for that element, and the second column stores the element value. In the case of VARRAYs, the index represents the position of the element in the array. In the case of nested tables, which are by definition unordered, the index reflects only the return order of the elements in the particular query. 
                           </p>
                           <p>Oracle recommends using <code class="codeph">getResultSet</code> when getting data from nested tables. Nested tables can have an unlimited number of elements. The <code class="codeph">ResultSet</code> object returned by the method initially points at the first row of data. You get the contents of the nested table by using the <code class="codeph">next</code> method and the appropriate <code class="codeph">get</code><span class="italic"><code class="codeph">XXX</code></span> method. In contrast, <code class="codeph">getArray</code> returns the entire contents of the nested table at one time. 
                           </p>
                           <p>The <code class="codeph">getResultSet</code> method uses the default type map of the connection to determine the mapping between the SQL type of the Oracle object and its corresponding Java data type. If you do not want to use the default type map of the connection, another version of the method, <code class="codeph">getResultSet(</code><span class="italic"><code class="codeph">map</code></span><code class="codeph">)</code>, enables you to specify an alternate type map. 
                           </p>
                           <p>Oracle also provides the <code class="codeph">getResultSet(</code><span class="italic"><code class="codeph">index</code></span><code class="codeph">,</code><span class="italic"><code class="codeph">count</code></span><code class="codeph">)</code> and <code class="codeph">getResultSet(</code><span class="italic"><code class="codeph">index</code></span><code class="codeph">,</code><span class="italic"><code class="codeph">count</code></span><code class="codeph">,</code><span class="italic"><code class="codeph">map</code></span><code class="codeph">)</code> methods to retrieve a subset of the array elements.
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-3BA98572-FD68-4137-B87E-0DC2AAAC65EE__GUID-1F2E7FD9-E75B-4390-B855-6511903382F8">getArray</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>The <code class="codeph">getArray</code> method is a standard JDBC method that returns the array elements as a <code class="codeph">java.lang.Object</code>, which you can cast as appropriate. The elements are converted to the Java types corresponding to the SQL type of the data in the original array.
                           </p>
                           <p>Oracle also provides a <code class="codeph">getArray(</code><span class="italic"><code class="codeph">index</code></span><code class="codeph">,</code><span class="italic"><code class="codeph">count</code></span><code class="codeph">)</code> method to retrieve a subset of the array elements.
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="JJDBC28601"></a><div class="props_rev_3"><a id="GUID-E2AE8600-F9A9-458B-83B8-C01BCAD51365" name="GUID-E2AE8600-F9A9-458B-83B8-C01BCAD51365"></a><h5 id="JJDBC-GUID-E2AE8600-F9A9-458B-83B8-C01BCAD51365" class="sect5"><span class="enumeration_section">16.4.2.3 </span>Comparing the Data Retrieval Methods
                     </h5>
                     <div>
                        <div class="section">
                           <p>If you use <code class="codeph">getOracleArray</code> to return the array elements, then the use by that method of <code class="codeph">oracle.sql.Datum</code> instances avoids the expense of data conversion from SQL to Java. The non-character data inside the instance of a <code class="codeph">Datum</code> class or any of its subclass remains in raw SQL format.
                           </p>
                           <p>If you use <code class="codeph">getResultSet</code> to return an array of primitive data types, then the JDBC driver returns a <code class="codeph">ResultSet</code> object that contains, for each element, the index into the array for the element and the element value. For example:
                           </p><pre class="oac_no_warn" dir="ltr">ResultSet rset = intArray.getResultSet();
</pre><p>In this case, the result set contains one row for each array element, with two columns in each row. The first column stores the index into the array and the second column stores the element value. </p>
                           <p>If the elements of an array are of a SQL type that maps to a Java type, then <code class="codeph">getArray</code> returns an array of elements of this Java type. The return type of the <code class="codeph">getArray</code> method is <code class="codeph">java.lang.Object</code>. Therefore, the result must be cast before it can be used.
                           </p><pre class="oac_no_warn" dir="ltr">BigDecimal[] values = (BigDecimal[]) intArray.getArray();
</pre><p>Here <code class="codeph">intArray</code> is an <code class="codeph">oracle.sql.ARRAY</code>, corresponding to a VARRAY of type <code class="codeph">NUMBER</code>. The <code class="codeph">values</code> array contains an array of elements of type <code class="codeph">java.math.BigDecimal</code>, because the SQL <code class="codeph">NUMBER</code> data type maps to Java <code class="codeph">BigDecimal</code>, by default, according to Oracle JDBC drivers.
                           </p>
                           <div class="infoboxnote" id="GUID-E2AE8600-F9A9-458B-83B8-C01BCAD51365__GUID-54762DD9-E0C6-4FFD-BCBE-4B016C1CB9F9">
                              <p class="notep1">Note:</p>
                              <p>Using <code class="codeph">BigDecimal</code> is a resource-intensive operation in Java. Because Oracle JDBC maps numeric SQL data to <code class="codeph">BigDecimal</code> by default, using <code class="codeph">getArray</code> may impact performance, and is not recommended for numeric collections.
                              </p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="JJDBC28602"></a><div class="props_rev_3"><a id="GUID-4872A6DE-E029-44CF-AF71-4C70979B8F63" name="GUID-4872A6DE-E029-44CF-AF71-4C70979B8F63"></a><h5 id="JJDBC-GUID-4872A6DE-E029-44CF-AF71-4C70979B8F63" class="sect5"><span class="enumeration_section">16.4.2.4 </span>Retrieving Elements of a Structured Object Array According to a Type Map
                     </h5>
                     <div>
                        <div class="section">
                           <p>By default, if you are working with an array whose elements are structured objects, and you use <code class="codeph">getArray</code> or <code class="codeph">getResultSet</code>, then the Oracle objects in the array will be mapped to their corresponding Java data types according to the default mapping. This is because these methods use the default <a id="d57778e1419" class="indexterm-anchor"></a>type map of the connection to determine the mapping. 
                           </p>
                           <p>However, if you do not want default behavior, then you can use the <code class="codeph">getArray(</code><span class="italic"><code class="codeph">map</code></span><code class="codeph">)</code> or <code class="codeph">getResultSet(</code><span class="italic"><code class="codeph">map</code></span><code class="codeph">)</code> method to specify a type map that contains alternate mappings. If there are entries in the type map corresponding to the Oracle objects in the array, then each object in the array is mapped to the corresponding Java type specified in the type map. For example: 
                           </p><pre class="oac_no_warn" dir="ltr">Object[] object = (Object[])objArray.getArray(map);
</pre><p>Where <code class="codeph">objArray</code> is an <code class="codeph">oracle.sql.ARRAY</code> object and <code class="codeph">map</code> is a <code class="codeph">java.util.Map</code> object.
                           </p>
                           <p>If the type map does not contain an entry for a particular Oracle object, then the element is returned as an <code class="codeph">oracle.jdbc.OracleStruct</code> object. 
                           </p>
                           <p>The <code class="codeph">getResultSet(</code><span class="italic"><code class="codeph">map</code></span><code class="codeph">)</code> method behaves similarly to the <code class="codeph">getArray(</code><span class="italic"><code class="codeph">map</code></span><code class="codeph">)</code> method.
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>Related Topics</strong></p>
                           <ul>
                              <li><a href="Oracle-collections.html#GUID-22D90043-E417-4BC3-A838-0DBA954AF2AA">Using a Type Map to Map Array Elements</a></li>
                           </ul>
                        </div>
                     </div>
                     
                  </div><a id="JJDBC28603"></a><div class="props_rev_3"><a id="GUID-6D8BD317-1F52-4CF6-8E4A-096989E8D2A6" name="GUID-6D8BD317-1F52-4CF6-8E4A-096989E8D2A6"></a><h5 id="JJDBC-GUID-6D8BD317-1F52-4CF6-8E4A-096989E8D2A6" class="sect5"><span class="enumeration_section">16.4.2.5 </span>Retrieving a Subset of Array Elements
                     </h5>
                     <div>
                        <div class="section">
                           <p>If you do not want to retrieve the entire contents of an array, then you can use signatures of <code class="codeph">getArray</code>, <code class="codeph">getResultSet</code>, and <code class="codeph">getOracleArray</code> that let you retrieve a subset. To retrieve a subset of the <a id="d57778e1524" class="indexterm-anchor"></a>array, pass in an index and a count to indicate where in the array you want to start and how many elements you want to retrieve. As previously described, you can specify a type map or use the default type map for your connection to convert to Java types. For example:
                           </p><pre class="oac_no_warn" dir="ltr">Object object = arr.getArray(<span class="italic">index</span>, <span class="italic">count</span>, <span class="italic">map</span>);
Object object = arr.getArray(<span class="italic">index</span>, <span class="italic">count</span>);
</pre><p>Similar examples using <code class="codeph">getResultSet</code> are:
                           </p><pre class="oac_no_warn" dir="ltr">ResultSet rset = arr.getResultSet(<span class="italic">index</span>, <span class="italic">count</span>, <span class="italic">map</span>);
ResultSet rset = arr.getResultSet(<span class="italic">index</span>, <span class="italic">count</span>);
</pre><p>A similar example using <code class="codeph">getOracleArray</code> is:
                           </p><pre class="oac_no_warn" dir="ltr">Datum[] arr = arr.getOracleArray(<span class="italic">index</span>, <span class="italic">count</span>);
</pre><p>Where <span class="italic"><code class="codeph">arr</code></span> is an <code class="codeph">oracle.sql.ARRAY</code> object, <span class="italic"><code class="codeph">index</code></span> is type <code class="codeph">long</code>, <span class="italic"><code class="codeph">count</code></span> is type <code class="codeph">int</code>, and <span class="italic"><code class="codeph">map</code></span> is a <code class="codeph">java.util.Map</code> object.
                           </p>
                           <div class="infoboxnote" id="GUID-6D8BD317-1F52-4CF6-8E4A-096989E8D2A6__GUID-8CD191CC-F240-4147-A6E4-320C66589320">
                              <p class="notep1">Note:</p>
                              <p>There is no performance advantage in retrieving a subset of an array, as opposed to the entire array.</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="JJDBC28604"></a><div class="props_rev_3"><a id="GUID-BCD2C704-39EA-4B52-B3CB-E192F715ED84" name="GUID-BCD2C704-39EA-4B52-B3CB-E192F715ED84"></a><h5 id="JJDBC-GUID-BCD2C704-39EA-4B52-B3CB-E192F715ED84" class="sect5"><span class="enumeration_section">16.4.2.6 </span>Retrieving Array Elements into an oracle.sql.Datum Array
                     </h5>
                     <div>
                        <div class="section">
                           <p>Use <code class="codeph">getOracleArray</code> to return an <code class="codeph">oracle.sql.Datum[]</code> array. The elements of the returned array is of <code class="codeph">oracle.sql.*</code> type that correspond to the SQL data type of the elements of the original array. For example:
                           </p><pre class="oac_no_warn" dir="ltr">Datum arraydata[] = arr.getOracleArray();
</pre><p><code class="codeph">arr</code> is an <code class="codeph">oracle.sql.ARRAY</code> object.
                           </p>
                           <p>The <a id="d57778e1661" class="indexterm-anchor"></a>following example assumes that a connection object <code class="codeph">conn</code> and a statement object <code class="codeph">stmt</code> have already been created. In the example, an array with the SQL type name <code class="codeph">NUM_ARRAY</code> is created to store a VARRAY of <code class="codeph">NUMBER</code> data. The <code class="codeph">NUM_ARRAY</code> is in turn stored in a table <code class="codeph">VARRAY_TABLE</code>. 
                           </p>
                           <p>A query selects the contents of the <code class="codeph">VARRAY_TABLE</code>. The result set is cast to <code class="codeph">OracleResultSet</code>. The <code class="codeph">getARRAY</code> method is applied to it to retrieve the array data into <code class="codeph">my_array</code>, which is an <code class="codeph">oracle.sql.ARRAY</code> object.
                           </p>
                           <p>Because <code class="codeph">my_array</code> is of type <code class="codeph">oracle.sql.ARRAY</code>, you can apply the methods <code class="codeph">getSQLTypeName</code> and <code class="codeph">getBaseType</code> to it to return the name of the SQL type of each element in the array and its integer code.
                           </p>
                           <p>The program then prints the contents of the array. Because the contents of <code class="codeph">NUM_ARRAY</code> are of the SQL data type <code class="codeph">NUMBER</code>, the elements of <code class="codeph">my_array</code> are of the type, <code class="codeph">BigDecimal</code>. Before you can use the elements, they must first be cast to <code class="codeph">BigDecimal</code>. In the <code class="codeph">for</code> loop, the individual values of the array are cast to <code class="codeph">BigDecimal</code> and printed to standard output. 
                           </p><pre class="oac_no_warn" dir="ltr">stmt.execute ("CREATE TYPE num_varray AS VARRAY(10) OF NUMBER(12, 2)");
stmt.execute ("CREATE TABLE varray_table (col1 num_varray)");
stmt.execute ("INSERT INTO varray_table VALUES (num_varray(100, 200))");

ResultSet rs = stmt.executeQuery("SELECT * FROM varray_table");
ARRAY my_array = ((OracleResultSet)rs).getARRAY(1);

// return the SQL type names, integer codes, 
// and lengths of the columns
System.out.println ("Array is of type " + array.getSQLTypeName());
System.out.println ("Array element is of type code " + array.getBaseType());
System.out.println ("Array is of length " + array.length());

// get Array elements 
BigDecimal[] values = (BigDecimal[]) my_array.getArray();

for (int i=0; i&lt;values.length; i++) 
{
   BigDecimal out_value = (BigDecimal) values[i];
   System.out.println("&gt;&gt; index " + i + " = " + out_value.intValue());
}
</pre><p>Note that if you use <code class="codeph">getResultSet</code> to obtain the array, then you must would first get the result set object, and then use the <code class="codeph">next</code> method to iterate through it. Notice the use of the parameter indexes in the <code class="codeph">getInt</code> method to retrieve the element index and the element value.
                           </p><pre class="oac_no_warn" dir="ltr">ResultSet rset = my_array.getResultSet();
while (rset.next())
{
    // The first column contains the element index and the 
    // second column contains the element value
    System.out.println("&gt;&gt; index " + rset.getInt(1)+" = " + rset.getInt(2));
}</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="JJDBC28605"></a><div class="props_rev_3"><a id="GUID-A374A861-2770-418F-9CF6-DBB807CE282C" name="GUID-A374A861-2770-418F-9CF6-DBB807CE282C"></a><h5 id="JJDBC-GUID-A374A861-2770-418F-9CF6-DBB807CE282C" class="sect5"><span class="enumeration_section">16.4.2.7 </span>About Accessing Multilevel Collection Elements
                     </h5>
                     <div>
                        <div class="section">
                           <p>The <code class="codeph">oracle.sql.ARRAY</code> class provides three methods, which are overloaded, to access collection elements. The JDBC drivers extend these methods to support multilevel collections. These methods are:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">getArray</code> method
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">getOracleArray</code> method
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">getResultSet</code> method
                                 </p>
                              </li>
                           </ul>
                           <p>The <code class="codeph">getArray</code> method returns a Java array that holds the collection elements. The array element type is determined by the collection element type and the JDBC default conversion matrix.
                           </p>
                           <p>For example, the <code class="codeph">getArray</code> method returns a <code class="codeph">java.math.BigDecimal</code> array for collection of SQL <code class="codeph">NUMBER</code>. The <code class="codeph">getOracleArray</code> method returns a <code class="codeph">Datum</code> array that holds the collection elements in <code class="codeph">Datum</code> format. For multilevel collections, the <code class="codeph">getArray</code> and <code class="codeph">getOracleArray</code> methods both return a Java array of <code class="codeph">oracle.sql.ARRAY</code> elements.
                           </p>
                           <p>The <code class="codeph">getResultSet</code> method returns a <code class="codeph">ResultSet</code> object that wraps the multilevel collection elements. For multilevel collections, the JDBC applications use the <code class="codeph">getObject</code>, <code class="codeph">getARRAY</code>, or <code class="codeph">getArray</code> method of the <code class="codeph">ResultSet</code> class to access the collection elements as instances of <code class="codeph">oracle.sql.ARRAY</code>. 
                           </p>
                           <p>The following code shows how to use the <code class="codeph">getOracleArray</code>, <code class="codeph">getArray</code>, and <code class="codeph">getResultSet</code> methods:
                           </p><pre class="oac_no_warn" dir="ltr">Connection conn = ...;          // make a JDBC connection 
Statement stmt = conn.createStatement (); 
ResultSet rset = stmt.executeQuery ("select col2 from tab2 where idx=1"); 

while (rset.next()) 
{ 
  ARRAY varray3 = (ARRAY) rset.getObject (1); 
  Object varrayElems = varray3.getArray (1);  
// access array elements of "varray3" 
  Datum[] varray3Elems = (Datum[]) varrayElems; 

  for (int i=0; i&lt;varray3Elems.length; i++) 
  { 
    ARRAY varray2 = (ARRAY) varray3Elems[i]; 
    Datum[] varray2Elems = varray2.getOracleArray(); 
    // access array elements of  "varray2" 

    for (int j=0; j&lt;varray2Elems.length; j++) 
    { 
      ARRAY varray1 = (ARRAY) varray2Elems[j]; 
      ResultSet varray1Elems = varray1.getResultSet(); 
      // access array elements   of "varray1" 

      while (varray1Elems.next()) 
        System.out.println ("idx="+varray1Elems.getInt(1)+"
          value="+varray1Elems.getInt(2)); 
    } 
  } 
} 
rset.close (); 
stmt.close (); 
conn.close (); </pre></div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="JJDBC28607"></a><a id="JJDBC28608"></a><a id="JJDBC28606"></a><div class="props_rev_3"><a id="GUID-BCCFF59D-D84C-410B-B681-BA5AA6285EC6" name="GUID-BCCFF59D-D84C-410B-B681-BA5AA6285EC6"></a><h4 id="JJDBC-GUID-BCCFF59D-D84C-410B-B681-BA5AA6285EC6" class="sect4"><span class="enumeration_section">16.4.3 </span>Passing Arrays to Statement Objects
                  </h4>
                  <div>
                     <div class="section">
                        <p>This section discusses how to pass arrays to prepared statement objects or callable statement objects.</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-BCCFF59D-D84C-410B-B681-BA5AA6285EC6__GUID-D37888C2-7F18-4112-8662-53D81AE5D3F4">Passing an Array to a Prepared Statement</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>Pass an array to a prepared statement as follows.</p>
                        <div class="infoboxnote" id="GUID-BCCFF59D-D84C-410B-B681-BA5AA6285EC6__GUID-277EE1DF-C607-4EB8-B182-7DF81BE4ADAD">
                           <p class="notep1">Note:</p>
                           <p>you can use arrays as either <code class="codeph">IN</code> or <code class="codeph">OUT</code> bind variables.
                           </p>
                        </div>
                        <ol>
                           <li>
                              <p>Define the array that you want to pass to the prepared statement as an <code class="codeph">oracle.sql.ARRAY</code> object.
                              </p><pre class="oac_no_warn" dir="ltr">ARRAY array = oracle.jdbc.OracleConnection.createARRAY(sql_type_name, elements);
</pre><p><code class="codeph">sql_type_name</code> is a Java string specifying the user-defined SQL type name of the array and <span class="italic"><code class="codeph">elements</code></span> is a <code class="codeph">java.lang.Object</code> containing a Java array of the elements. 
                              </p>
                           </li>
                           <li>
                              <p>Create a <code class="codeph">java.sql.PreparedStatement</code> object containing the SQL statement to be run.
                              </p>
                           </li>
                           <li>
                              <p>Cast your prepared statement to <code class="codeph">OraclePreparedStatement</code>, and use <code class="codeph">setARRAY</code> to pass the array to the prepared statement.
                              </p><pre class="oac_no_warn" dir="ltr">(OraclePreparedStatement)stmt.setARRAY(<span class="italic">parameterIndex</span>, <span class="italic">array</span>);
</pre><p><span class="italic"><code class="codeph">parameterIndex</code></span> is the parameter index and <span class="italic"><code class="codeph">array</code></span> is the <code class="codeph">oracle.sql.ARRAY</code> object you constructed previously.
                              </p>
                           </li>
                           <li>
                              <p>Run the prepared statement.</p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-BCCFF59D-D84C-410B-B681-BA5AA6285EC6__GUID-8C72E0CE-F7A1-4C97-BC1B-FA8FF70E893A">Passing an Array to a Callable Statement</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>To retrieve a <a id="d57778e1978" class="indexterm-anchor"></a>collection as an <code class="codeph">OUT</code> parameter in PL/SQL blocks, perform the following to register the bind type for your <code class="codeph">OUT</code> parameter.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Cast your callable statement to <code class="codeph">OracleCallableStatement</code>, as follows:</span><div><pre class="oac_no_warn" dir="ltr">OracleCallableStatement ocs = (OracleCallableStatement)conn.prepareCall("{? = call func()}");
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Register the <code class="codeph">OUT</code> parameter with the following form of the <code class="codeph">registerOutParameter</code> method:</span><div><pre class="oac_no_warn" dir="ltr">ocs.registerOutParameter
        (int <span class="italic">param_index</span>, int <span class="italic">sql_type</span>, string <span class="italic">sql_type_name</span>);
</pre><p><span class="italic"><code class="codeph">param_index</code></span> is the parameter index, <span class="italic"><code class="codeph">sql_type</code></span> is the SQL type code, and <span class="italic"><code class="codeph">sql_type_name</code></span> is the name of the array type. In this case, the <span class="italic"><code class="codeph">sql_type</code></span> is <code class="codeph">OracleTypes.ARRAY</code>.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Run the call, as follows:</span><div><pre class="oac_no_warn" dir="ltr">ocs.execute();
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Get the value, as follows:</span><div><pre class="oac_no_warn" dir="ltr">oracle.sql.ARRAY array = ocs.getARRAY(1);</pre></div>
                        </li>
                     </ol>
                  </div>
               </div>
            </div><a id="JJDBC28609"></a><div class="props_rev_3"><a id="GUID-22D90043-E417-4BC3-A838-0DBA954AF2AA" name="GUID-22D90043-E417-4BC3-A838-0DBA954AF2AA"></a><h3 id="JJDBC-GUID-22D90043-E417-4BC3-A838-0DBA954AF2AA" class="sect3"><span class="enumeration_section">16.5 </span>Using a Type Map to Map Array Elements
               </h3>
               <div>
                  <div class="section">
                     <p>If your <a id="d57778e2077" class="indexterm-anchor"></a><a id="d57778e2081" class="indexterm-anchor"></a>array contains Oracle objects, then you can use a type map to associate the objects in the array with the corresponding Java class. If you do not specify a type map, or if the type map does not contain an entry for a particular Oracle object, then each element is returned as an <code class="codeph">oracle.jdbc.OracleStruct</code> object.
                     </p>
                     <p>If you want the type map to determine the mapping between the Oracle objects in the array and their associated Java classes, then you must add an appropriate entry to the map.</p>
                     <p>The following example illustrates how you can use a type map to map the elements of an array to a custom Java object class. In this case, the array is a nested table. The example begins by defining an <code class="codeph">EMPLOYEE</code> object that has a name attribute and employee number attribute. <code class="codeph">EMPLOYEE_LIST</code> is a nested table type of <code class="codeph">EMPLOYEE</code> objects. Then an <code class="codeph">EMPLOYEE_TABLE</code> is created to store the names of departments within a corporation and the employees associated with each department. In the <code class="codeph">EMPLOYEE_TABLE</code>, the employees are stored in the form of <code class="codeph">EMPLOYEE_LIST</code> tables. 
                     </p><pre class="oac_no_warn" dir="ltr">stmt.execute("CREATE TYPE EMPLOYEE AS OBJECT
            (EmpName VARCHAR2(50),EmpNo INTEGER))");

stmt.execute("CREATE TYPE EMPLOYEE_LIST AS TABLE OF EMPLOYEE");

stmt.execute("CREATE TABLE EMPLOYEE_TABLE (DeptName VARCHAR2(20), 
     Employees EMPLOYEE_LIST) NESTED TABLE Employees STORE AS ntable1");

stmt.execute("INSERT INTO EMPLOYEE_TABLE VALUES ("SALES", EMPLOYEE_LIST
            (EMPLOYEE('Susan Smith', 123), EMPLOYEE('Lee Brown', 124)))");
</pre><p>If you want to retrieve all the employees belonging to the <code class="codeph">SALES</code> department into an array of instances of the custom object class <code class="codeph">EmployeeObj</code>, then you must add an entry to the type map to specify mapping between the <code class="codeph">EMPLOYEE</code> SQL type and the <code class="codeph">EmployeeObj</code> custom object class.
                     </p>
                     <p>To do this, first create your statement and result set objects, then select the <code class="codeph">EMPLOYEE_LIST</code> associated with the <code class="codeph">SALES</code> department into the result set. Cast the result set to <code class="codeph">OracleResultSet</code> so you can use the <code class="codeph">getARRAY</code> method to retrieve the <code class="codeph">EMPLOYEE_LIST</code> into an <code class="codeph">ARRAY</code> object (<code class="codeph">employeeArray</code> in the following example). 
                     </p>
                     <p>The <code class="codeph">EmployeeObj</code> custom object class in this example implements the <code class="codeph">SQLData</code> interface. 
                     </p><pre class="oac_no_warn" dir="ltr">Statement s = conn.createStatement();
OracleResultSet rs = (OracleResultSet)s.executeQuery
       ("SELECT Employees FROM employee_table WHERE DeptName = 'SALES'");

// get the array object 
ARRAY employeeArray = ((OracleResultSet)rs).getARRAY(1);
</pre><p>Now that you have the <code class="codeph">EMPLOYEE_LIST</code> object, get the existing type map and add an entry that maps the <code class="codeph">EMPLOYEE</code> SQL type to the <code class="codeph">EmployeeObj</code> Java type. 
                     </p><pre class="oac_no_warn" dir="ltr">// add type map entry to map SQL type 
// "EMPLOYEE" to Java type "EmployeeObj" 
Map map = conn.getTypeMap();
map.put("EMPLOYEE", Class.forName("EmployeeObj"));
</pre><p>Next, retrieve the SQL <code class="codeph">EMPLOYEE</code> objects from the <code class="codeph">EMPLOYEE_LIST</code>. To do this, call the <code class="codeph">getArray</code> method of the <code class="codeph">employeeArray</code> array object. This method returns an array of objects. The <code class="codeph">getArray</code> method returns the <code class="codeph">EMPLOYEE</code> objects into the <code class="codeph">employees</code> object array. 
                     </p><pre class="oac_no_warn" dir="ltr">// Retrieve array elements 
Object[] employees = (Object[]) employeeArray.getArray();
</pre><p>Finally, create a loop to assign each of the <code class="codeph">EMPLOYEE</code> SQL objects to the <code class="codeph">EmployeeObj</code> Java object <code class="codeph">emp</code>.
                     </p><pre class="oac_no_warn" dir="ltr">// Each array element is mapped to EmployeeObj object.
for (int i=0; i&lt;employees.length; i++)
{
   EmployeeObj emp = (EmployeeObj) employees[i];
   ...
}</pre></div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>