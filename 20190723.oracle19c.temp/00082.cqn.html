<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Using Continuous Query Notification (CQN)</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Database Development Guide">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Database Development Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="database-development-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-31T23:23:15-08:00">
      <meta name="dcterms.title" content="Database Development Guide">
      <meta name="dcterms.dateCopyrighted" content="1996, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96334-02">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="web-applications.html" title="Previous" type="text/html">
      <link rel="next" href="advanced-part.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="ADFNS">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="web-applications.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="advanced-part.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Database Development Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="plsql-for-application-developers.html" property="item" typeof="WebPage"><span property="name">PL/SQL for Application Developers</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Using Continuous Query Notification (CQN)</li>
            </ol>
            <a id="GUID-373BAF72-3E63-42FE-8BEA-8A2AEFBF1C35" name="GUID-373BAF72-3E63-42FE-8BEA-8A2AEFBF1C35"></a><a id="ADFNS1060"></a><a id="ADFNS018"></a>
            
            <h2 id="ADFNS-GUID-373BAF72-3E63-42FE-8BEA-8A2AEFBF1C35" class="sect2"><span class="enumeration_chapter">18 </span>Using Continuous Query Notification (CQN)
            </h2>
         </header>
         <div class="ind"><script type="text/javascript">window.name='cqn'</script><script type="text/javascript">
    function footdisplay(footnum,footnote) {
    var msg = window.open('about:blank', 'NewWindow' + footnum,
        'directories=no,height=100,location=no,menubar=no,resizable=yes,' +
        'scrollbars=yes,status=no,toolbar=no,width=598');
    msg.document.open('text/html');
    msg.document.write('<!DOCTYPE html ');
    msg.document.write('PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" ');
    msg.document.write('"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">'); 
    msg.document.write('<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us" dir="ltr"><head><title>');
   
    msg.document.write('Footnote&nbsp; ' + footnum);
    msg.document.write('<\/title><meta http-equiv="Content-Type" ');
    msg.document.write('content="text/html; charset=utf-8" />');
    msg.document.write('<meta http-equiv="Content-Script-Type" ');
    msg.document.write('content="text/javascript" />');
    msg.document.write('<style type="text/css"> <![CDATA[ ');
    msg.document.write('h1 {text-align: center; font-size: 14pt;}');
    msg.document.write('fieldset {border: none;}');
    msg.document.write('form {text-align: center;}');
    msg.document.write(' ]]\u003e <\/style>');
    msg.document.write('<\/head><body><div id="footnote"><h1>Footnote&nbsp; ' + footnum + '<\/h1><p>');
    msg.document.write(footnote);
    msg.document.write('<\/p><form action="" method="post"><fieldset>');
    msg.document.write('<input type="button" value="OK" ');
    msg.document.write('onclick="window.close();" />');
    msg.document.write('<\/fieldset><\/form><\/div><\/body><\/html>');
    msg.document.close();
    setTimeout(function() {
        var height = msg.document.getElementById('footnote').offsetHeight;
        msg.resizeTo(598, height + 100);
    }
    , 100);
    msg.focus();
}
            </script><noscript>
               <p>The script content on this page is for navigation purposes only and does not alter the content in any way.</p>
            </noscript>
            <div>
               <p><span class="bold">Continuous Query Notification (CQN)</span> lets an application register queries with the database for either object change notification (the default) or query result change notification. An object referenced by a registered query is a <span class="bold">registered object</span>.
               </p>
               <p>If a query is registered for <span class="bold">object change notification (OCN)</span>, the database notifies the application whenever a transaction changes an object that the query references and commits, regardless of whether the query result changed.
               </p>
               <p>If a query is registered for <span class="bold">query result change notification (QRCN)</span>, the database notifies the application whenever a transaction changes the result of the query and commits.
               </p>
               <p>A <span class="bold">CQN registration</span> associates a list of one or more queries with a notification type (OCN or QRCN) and a notification handler. To create a CQN registration, you can use either the PL/SQL interface or Oracle Call Interface (OCI). If you use the PL/SQL interface, the notification handler is a server-side PL/SQL stored procedure; if you use OCI, the notification handler is a client-side C callback procedure.
               </p>
               <p>This chapter explains general CQN concepts and explains how to use the PL/SQL CQN interface.</p>
               <div class="section">
                  <p class="subhead1" id="GUID-373BAF72-3E63-42FE-8BEA-8A2AEFBF1C35__GUID-FC277921-3E22-475F-BBE5-6E214591E263">Topics:</p>
               </div>
               <!-- class="section" -->
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="cqn.html#GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4">About Object Change Notification (OCN)</a></p>
                  </li>
                  <li>
                     <p><a href="cqn.html#GUID-2E64E453-ADBE-4DFA-94C0-39A0AA4081E9" title="Some types of queries are so simplified that invalidations are generated at object level; that is, whenever any object referenced in those queries changes. Examples of such queries are those that use unsupported column types or include subqueries. The solution to this problem is to rewrite the original queries.">About Query Result Change Notification (QRCN)</a></p>
                  </li>
                  <li>
                     <p><a href="cqn.html#GUID-C678472B-392F-4ABD-A811-259DC2BC3271">Events that Generate Notifications</a></p>
                  </li>
                  <li>
                     <p><a href="cqn.html#GUID-B65C2FEA-1A2C-4C47-9E93-4697442F4529">Notification Contents</a></p>
                  </li>
                  <li>
                     <p><a href="cqn.html#GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778">Good Candidates for CQN</a></p>
                  </li>
                  <li>
                     <p><a href="cqn.html#GUID-9F2A38D3-1E9B-484C-8793-6D6CA554044A">Creating CQN Registrations</a></p>
                  </li>
                  <li>
                     <p><a href="cqn.html#GUID-01E3E0A3-81AB-4EEE-8E26-4F3F2FE1D60E">Using PL/SQL to Create CQN Registrations</a></p>
                  </li>
                  <li>
                     <p><a href="cqn.html#GUID-0D38B15C-F5CD-44C9-B073-39DA78350D28">Using OCI to Create CQN Registrations</a></p>
                  </li>
                  <li>
                     <p><a href="cqn.html#GUID-A74B4631-B908-45C3-801E-B6986603918F">Querying CQN Registrations</a></p>
                  </li>
                  <li>
                     <p><a href="cqn.html#GUID-2A42CDAB-DBB9-4785-B67B-2E0803F1EAB2">Interpreting Notifications</a></p>
                  </li>
               </ul>
               <div class="infoboxnote" id="GUID-373BAF72-3E63-42FE-8BEA-8A2AEFBF1C35__GUID-8B2789CF-574F-4947-80A6-29229CEC5711">
                  <p class="notep1">Note:</p>
                  <p>The terms <span class="bold">OCN</span> and <span class="bold">QRCN</span> refer to both the notification type and the notification itself: An application registers a query <span class="italic">for OCN</span>, and the database sends the application <span class="italic">an OCN</span>; an application registers a query <span class="italic">for QRCN</span>, and the database sends the application <span class="italic">a QRCN</span>.
                  </p>
               </div>
               <div class="infoboxnotealso" id="GUID-373BAF72-3E63-42FE-8BEA-8A2AEFBF1C35__NOTE-139-CAD2C2E5">
                  <p class="notep1">See Also:</p>
                  <p><a href="../lnoci/index.html" target="_blank"><span class="italic">Oracle Call Interface Programmer's Guide</span></a> for information about using OCI for CQN
                  </p>
               </div>
            </div><a id="ADFNS545"></a><a id="ADFNS544"></a><div class="props_rev_3"><a id="GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4" name="GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4"></a><h3 id="ADFNS-GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4" class="sect3">About Object Change Notification (OCN)</h3>
               <div>
                  <p>If an application registers a query for object change notification (OCN), the database sends the application an OCN whenever a transaction changes an object associated with the query and commits, regardless of whether the result of the query changed.</p>
                  <p>For example, if an application registers the query in <a href="cqn.html#GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4__CHDIDFIB">Example 18-1</a> for OCN, and a user commits a transaction that changes the <code class="codeph">EMPLOYEES</code> table, the database sends the application an OCN, even if the changed row or rows did not satisfy the query predicate (for example, if <code class="codeph">DEPARTMENT_ID</code> = 5).
                  </p>
                  <div class="example" id="GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4__CHDIDFIB">
                     <p class="titleinexample">Example 18-1 Query to be Registered for Change Notification</p><pre class="oac_no_warn" dir="ltr">SELECT EMPLOYEE_ID, SALARY
FROM EMPLOYEES
WHERE DEPARTMENT_ID = 10;</pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="ADFNS1061"></a><a id="ADFNS546"></a><div class="props_rev_3"><a id="GUID-2E64E453-ADBE-4DFA-94C0-39A0AA4081E9" name="GUID-2E64E453-ADBE-4DFA-94C0-39A0AA4081E9"></a><h3 id="ADFNS-GUID-2E64E453-ADBE-4DFA-94C0-39A0AA4081E9" class="sect3">About Query Result Change Notification (QRCN)</h3>
               <div>
                  <div class="infoboxnote" id="GUID-2E64E453-ADBE-4DFA-94C0-39A0AA4081E9__GUID-8AF747A3-D94C-4D8D-9B32-FF71659BD48E">
                     <p class="notep1">Note:</p>
                     <p>For QRCN support, the <code class="codeph">COMPATIBLE</code> initialization parameter of the database must be at least 11.0.0, and Automatic Undo Management (AUM) must be enabled (as it is by default).
                     </p>
                  </div>
                  <p>If an application registers a query for query result change notification (QRCN), the database sends the application a QRCN whenever a transaction changes the result of the query and commits.</p>
                  <p>For example, if an application registers the query in <a href="cqn.html#GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4__CHDIDFIB">Example 18-1</a> for QRCN, the database sends the application a QRCN only if the query result set changes; that is, if one of these data manipulation language (DML) statements commits:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>An <code class="codeph">INSERT</code> or <code class="codeph">DELETE</code> of a row that satisfies the query predicate (<code class="codeph">DEPARTMENT_ID</code> = 10).
                        </p>
                     </li>
                     <li>
                        <p>An <code class="codeph">UPDATE</code> to the <code class="codeph">EMPLOYEE_ID</code> or <code class="codeph">SALARY</code> column of a row that satisfied the query predicate (<code class="codeph">DEPARTMENT_ID</code> = 10).
                        </p>
                     </li>
                     <li>
                        <p>An <code class="codeph">UPDATE</code> to the <code class="codeph">DEPARTMENT_ID</code> column of a row that changed its value from 10 to a value other than 10, causing the row to be deleted from the result set.
                        </p>
                     </li>
                     <li>
                        <p>An <code class="codeph">UPDATE</code> to the <code class="codeph">DEPARTMENT_ID</code> column of a row that changed its value to 10 from a value other than 10, causing the row to be added to the result set.
                        </p>
                     </li>
                  </ul>
                  <p>The default notification type is OCN. For QRCN, specify <code class="codeph">QOS_QUERY</code> in the <code class="codeph">QOSFLAGS</code> attribute of the <code class="codeph">CQ_NOTIFICATION$_REG_INFO</code> object.
                  </p>
                  <p>With QRCN, you have a choice of guaranteed mode (the default) or best-effort mode.</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-2E64E453-ADBE-4DFA-94C0-39A0AA4081E9__GUID-6B473A84-1FBE-44B9-B75A-E4E4C0337BEA">Topics:</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="cqn.html#GUID-4A320315-AF7F-4D60-BB63-AD9731D3640D">Guaranteed Mode</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-0766B418-4023-4BB7-8887-25AE98CBD351" title="Some types of queries are so simplified that invalidations are generated at object level; that is, whenever any object referenced in those queries changes. Examples of such queries are those that use unsupported column types or include subqueries. The solution to this problem is to rewrite the original queries.">Best-Effort Mode</a></p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-2E64E453-ADBE-4DFA-94C0-39A0AA4081E9__NOTE-1382-CAD3DEE1">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="../admin/creating-and-configuring-an-oracle-database.html#ADMIN11112" target="_blank"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about the <code class="codeph">COMPATIBLE</code> initialization parameter
                              </p>
                           </li>
                           <li>
                              <p><a href="../admin/managing-undo.html#ADMIN013" target="_blank"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about AUM
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS547"></a><div class="props_rev_3"><a id="GUID-4A320315-AF7F-4D60-BB63-AD9731D3640D" name="GUID-4A320315-AF7F-4D60-BB63-AD9731D3640D"></a><h4 id="ADFNS-GUID-4A320315-AF7F-4D60-BB63-AD9731D3640D" class="sect4">Guaranteed Mode</h4>
                  <div>
                     <p>In guaranteed mode, there are no false positives: the database sends the application a QRCN only when the query result set is guaranteed to have changed.</p>
                     <p>For example, suppose that an application registered the query in <a href="cqn.html#GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4__CHDIDFIB">Example 18-1</a> for QRCN, that employee 201 is in department 10, and that these statements are executed:
                     </p><pre class="oac_no_warn" dir="ltr">UPDATE EMPLOYEES
SET SALARY = SALARY + 10
WHERE EMPLOYEE_ID = 201;

UPDATE EMPLOYEES
SET SALARY = SALARY - 10
WHERE EMPLOYEE_ID = 201;

COMMIT;
</pre><p>Each <code class="codeph">UPDATE</code> statement in the preceding transaction changes the query result set, but together they have no effect on the query result set; therefore, the database does not send the application a QRCN for the transaction.
                     </p>
                     <p>For guaranteed mode, specify <code class="codeph">QOS_QUERY</code>, but not <code class="codeph">QOS_BEST_EFFORT</code>, in the <code class="codeph">QOSFLAGS</code> attribute of the <code class="codeph">CQ_NOTIFICATION$_REG_INFO</code> object.
                     </p>
                     <p>Some queries are too complex for QRCN in guaranteed mode.</p>
                     <div class="infoboxnotealso" id="GUID-4A320315-AF7F-4D60-BB63-AD9731D3640D__NOTE-127-CAD40C0F">
                        <p class="notep1">See Also:</p>
                        <p><a href="cqn.html#GUID-15F66C86-D79B-408F-977C-9BB614C3D91E">Queries that Can Be Registered for QRCN in Guaranteed Mode</a> for the characteristics of queries that can be registered in guaranteed mode
                        </p>
                     </div>
                  </div>
               </div><a id="ADFNS549"></a><a id="ADFNS550"></a><a id="ADFNS548"></a><div class="props_rev_3"><a id="GUID-0766B418-4023-4BB7-8887-25AE98CBD351" name="GUID-0766B418-4023-4BB7-8887-25AE98CBD351"></a><h4 id="ADFNS-GUID-0766B418-4023-4BB7-8887-25AE98CBD351" class="sect4">Best-Effort Mode</h4>
                  <div>
                     <p>Some queries that are too complex for guaranteed mode can be registered for QRCN in best-effort mode, in which CQN creates and registers simpler versions of them.</p>
                     <p>The following two examples demonstrate how this works:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="cqn.html#GUID-A6690455-55C2-4493-8BB2-7F11E1D580D8">Example: Query Too Complex for QRCN in Guaranteed Mode</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-37F7D32F-20F7-4876-A401-A9A9ED1622EE" title="Some types of queries are so simplified that invalidations are generated at object level; that is, whenever any object referenced in those queries changes. Examples of such queries are those that use unsupported column types or include subqueries. The solution to this problem is to rewrite the original queries.">Example: Query Whose Simplified Version Invalidates Objects</a></p>
                        </li>
                     </ul>
                  </div>
                  <div class="sect4"><a id="GUID-A6690455-55C2-4493-8BB2-7F11E1D580D8" name="GUID-A6690455-55C2-4493-8BB2-7F11E1D580D8"></a><h5 id="ADFNS-GUID-A6690455-55C2-4493-8BB2-7F11E1D580D8" class="sect5">Example: Query Too Complex for QRCN in Guaranteed Mode</h5>
                     <div>
                        <p>The query in <a href="cqn.html#GUID-A6690455-55C2-4493-8BB2-7F11E1D580D8__CHDEFDDD">Example 18-2</a> is too complex for QRCN in guaranteed mode because it contains the aggregate function <code class="codeph">SUM</code>.
                        </p>
                        <div class="example" id="GUID-A6690455-55C2-4493-8BB2-7F11E1D580D8__CHDEFDDD">
                           <p class="titleinexample">Example 18-2 Query Too Complex for QRCN in Guaranteed Mode</p><pre class="oac_no_warn" dir="ltr">SELECT <span class="bold">SUM(SALARY)</span>
FROM EMPLOYEES
WHERE DEPARTMENT_ID = 20;
</pre><p>In best-effort mode, CQN registers this simpler version of the query in this example:</p><pre class="oac_no_warn" dir="ltr">SELECT <span class="bold">SALARY</span>
FROM EMPLOYEES
WHERE DEPARTMENT_ID = 20;
</pre><p>Whenever the result of the original query changes, the result of its simpler version also changes; therefore, no notifications are lost from the simplification. However, the simplification might cause false positives, because the result of the simpler version can change when the result of the original query does not.</p>
                           <p>In best-effort mode, the database:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Minimizes the OLTP response overhead that is from notification-related processing, as follows:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>For a single-table query, the database determines whether the query result has changed by which columns changed and which predicates the changed rows satisfied.</p>
                                    </li>
                                    <li>
                                       <p>For a multiple-table query (a join), the database uses the primary-key/foreign-key constraint relationships between the tables to determine whether the query result has changed.</p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>Sends the application a QRCN whenever a DML statement changes the query result set, even if a subsequent DML statement nullifies the change made by the first DML statement.</p>
                              </li>
                           </ul>
                           <p>The overhead minimization of best-effort mode infrequently causes false positives, even for queries that CQN does not simplify. For example, consider the query in this example and the transaction in <a href="cqn.html#GUID-4A320315-AF7F-4D60-BB63-AD9731D3640D">Guaranteed Mode</a>. In best-effort mode, CQN does not simplify the query, but the transaction generates a false positive.
                           </p>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-37F7D32F-20F7-4876-A401-A9A9ED1622EE" name="GUID-37F7D32F-20F7-4876-A401-A9A9ED1622EE"></a><h5 id="ADFNS-GUID-37F7D32F-20F7-4876-A401-A9A9ED1622EE" class="sect5">Example: Query Whose Simplified Version Invalidates Objects</h5>
                     <div>
                        <p>Some types of queries are so simplified that invalidations are generated at object level; that is, whenever any object referenced in those queries changes. Examples of such queries are those that use unsupported column types or include subqueries. The solution to this problem is to rewrite the original queries.</p>
                        <p>For example, the query in <a href="cqn.html#GUID-37F7D32F-20F7-4876-A401-A9A9ED1622EE__CHDJBIFC">Example 18-3</a> is too complex for QRCN in guaranteed mode because it includes a subquery.
                        </p>
                        <div class="example" id="GUID-37F7D32F-20F7-4876-A401-A9A9ED1622EE__CHDJBIFC">
                           <p class="titleinexample">Example 18-3 Query Whose Simplified Version Invalidates Objects</p><pre class="oac_no_warn" dir="ltr">SELECT SALARY
FROM EMPLOYEES
WHERE DEPARTMENT_ID IN <span class="bold">(</span>
  <span class="bold">SELECT DEPARTMENT_ID</span>
  <span class="bold">FROM DEPARTMENTS</span>
  <span class="bold">WHERE LOCATION_ID = 1700</span>
<span class="bold">)</span>;
</pre><p>In best-effort mode, CQN simplifies the query in this example to this:</p><pre class="oac_no_warn" dir="ltr">SELECT * FROM EMPLOYEES, DEPARTMENTS;
</pre><p>The simplified query can cause objects to be invalidated. However, if you rewrite the original query as follows, you can register it in either guaranteed mode or best-effort mode:</p><pre class="oac_no_warn" dir="ltr">SELECT SALARY
FROM EMPLOYEES, DEPARTMENTS
WHERE EMPLOYEES.DEPARTMENT_ID = DEPARTMENTS.DEPARTMENT_ID
  AND DEPARTMENTS.LOCATION_ID = 1700;
</pre><p>Queries that can be registered only in best-effort mode are described in <a href="cqn.html#GUID-12872C24-0535-4EA9-B9DF-E2FE9FEC8908">Queries that Can Be Registered for QRCN Only in Best-Effort Mode</a>.
                           </p>
                           <p>The default for QRCN mode is guaranteed mode. For best-effort mode, specify <code class="codeph">QOS_BEST_EFFORT</code> in the <code class="codeph">QOSFLAGS</code> attribute of the <code class="codeph">CQ_NOTIFICATION$_REG_INFO</code> object.
                           </p>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div>
            </div><a id="ADFNS551"></a><div class="props_rev_3"><a id="GUID-C678472B-392F-4ABD-A811-259DC2BC3271" name="GUID-C678472B-392F-4ABD-A811-259DC2BC3271"></a><h3 id="ADFNS-GUID-C678472B-392F-4ABD-A811-259DC2BC3271" class="sect3">Events that Generate Notifications</h3>
               <div>
                  <p>These events generate notifications:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="cqn.html#GUID-2232C97C-60E4-4383-AE74-C6EF89983740">Committed DML Transactions</a></p>
                     </li>
                     <li>
                        <p><a href="cqn.html#GUID-8B0C2F8C-FD79-4AC9-A1E4-8BCA8035FCA8">Committed DDL Statements</a></p>
                     </li>
                     <li>
                        <p><a href="cqn.html#GUID-E18D6FE8-1389-4774-AC98-175BE374CC5F">Deregistration</a></p>
                     </li>
                     <li>
                        <p><a href="cqn.html#GUID-15D6BF5D-28B9-4E14-AF6B-A5311B8F034D">Global Events</a></p>
                     </li>
                  </ul>
               </div><a id="ADFNS552"></a><div class="props_rev_3"><a id="GUID-2232C97C-60E4-4383-AE74-C6EF89983740" name="GUID-2232C97C-60E4-4383-AE74-C6EF89983740"></a><h4 id="ADFNS-GUID-2232C97C-60E4-4383-AE74-C6EF89983740" class="sect4">Committed DML Transactions</h4>
                  <div>
                     <p>When the notification type is OCN, any DML transaction that changes one or more registered objects generates one notification for each object when it commits.</p>
                     <p>When the notification type is QRCN, any DML transaction that changes the result of one or more registered queries generates a notification when it commits. The notification includes the query IDs of the queries whose results changed.</p>
                     <p>For either notification type, the notification includes:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Name of each changed table</p>
                        </li>
                        <li>
                           <p>Operation type (<code class="codeph">INSERT</code>, <code class="codeph">UPDATE</code>, or <code class="codeph">DELETE</code>)
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">ROWID</code> of each changed row, if the registration was created with the <code class="codeph">ROWID</code> option and the number of modified rows was not too large.
                           </p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-2232C97C-60E4-4383-AE74-C6EF89983740__NOTE-125-CAD47A2E">
                        <p class="notep1">See Also:</p>
                        <p><a href="cqn.html#GUID-52166555-C4AB-46F0-ABB6-6AD64093E19F">ROWID Option</a></p>
                     </div>
                  </div>
               </div><a id="ADFNS553"></a><div class="props_rev_3"><a id="GUID-8B0C2F8C-FD79-4AC9-A1E4-8BCA8035FCA8" name="GUID-8B0C2F8C-FD79-4AC9-A1E4-8BCA8035FCA8"></a><h4 id="ADFNS-GUID-8B0C2F8C-FD79-4AC9-A1E4-8BCA8035FCA8" class="sect4">Committed DDL Statements</h4>
                  <div>
                     <p>For both OCN and QRCN, these data definition language (DDL) statements, when committed, generate notifications:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><code class="codeph">ALTER</code> <code class="codeph">TABLE</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">TRUNCATE</code> <code class="codeph">TABLE</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">FLASHBACK</code> <code class="codeph">TABLE</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">DROP</code> <code class="codeph">TABLE</code></p>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-8B0C2F8C-FD79-4AC9-A1E4-8BCA8035FCA8__GUID-BD9595AB-2F8D-465F-9EA6-982B3A0A1745">
                        <p class="notep1">Note:</p>
                        <p>When the notification type is OCN, a committed <code class="codeph">DROP</code> <code class="codeph">TABLE</code> statement generates a <code class="codeph">DROP</code> <code class="codeph">NOTIFICATION</code>.
                        </p>
                        <p>Any OCN registrations of queries on the dropped table become disassociated from that table (which no longer exists), but the registrations themselves continue to exist. If any of these registrations are associated with objects other than the dropped table, committed changes to those other objects continue to generate notifications. Registrations associated only with the dropped table also continue to exist, and their creator can add queries (and their referenced objects) to them.</p>
                        <p>An OCN registration is based on the version and definition of an object at the time the query was registered. If an object is dropped, registrations on that object are disassociated from it forever. If an object is created with the same name, and in the same schema, as the dropped object, the created object is not associated with OCN registrations that were associated with the dropped object.</p>
                     </div>
                     <p>When the notification type is QRCN:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The notification includes:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Query IDs of the queries whose results have changed</p>
                              </li>
                              <li>
                                 <p>Name of the modified table</p>
                              </li>
                              <li>
                                 <p>Type of DDL operation</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>Some DDL operations that invalidate registered queries can cause those queries to be deregistered.</p>
                           <p>For example, suppose that this query is registered for QRCN:</p><pre class="oac_no_warn" dir="ltr">SELECT COL1 FROM TEST_TABLE
  WHERE COL2 = 1;
</pre><p>Suppose that <code class="codeph">TEST_TABLE</code> has this schema:
                           </p><pre class="oac_no_warn" dir="ltr">(COL1 NUMBER, COL2 NUMBER, COL3 NUMBER)
</pre><p>This DDL statement, when committed, invalidates the query and causes it to be removed from the registration:</p><pre class="oac_no_warn" dir="ltr">ALTER TABLE DROP COLUMN COL2;</pre></li>
                     </ul>
                  </div>
               </div><a id="ADFNS554"></a><div class="props_rev_3"><a id="GUID-E18D6FE8-1389-4774-AC98-175BE374CC5F" name="GUID-E18D6FE8-1389-4774-AC98-175BE374CC5F"></a><h4 id="ADFNS-GUID-E18D6FE8-1389-4774-AC98-175BE374CC5F" class="sect4">Deregistration</h4>
                  <div>
                     <p>For both OCN and QRCN, deregistration—removal of a registration from the database—generates a notification. The reasons that the database removes a registration are:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Timeout</p>
                           <p>If <code class="codeph">TIMEOUT</code> is specified with a nonzero value when the queries are registered, the database purges the registration after the specified time interval.
                           </p>
                           <p>If <code class="codeph">QOS_DEREG_NFY</code> is specified when the queries are registered, the database purges the registration after it generates its first notification.
                           </p>
                        </li>
                        <li>
                           <p>Loss of privileges</p>
                           <p>If privileges are lost on an object associated with a registered query, and the notification type is OCN, the database purges the registration. (When the notification type is QRCN, the database removes that query from the registration, but does not purge the registration.)</p>
                        </li>
                     </ul>
                     <p>A notification is not generated when a client application performs an explicit deregistration.</p>
                     <div class="infoboxnotealso" id="GUID-E18D6FE8-1389-4774-AC98-175BE374CC5F__NOTE-124-CAD4A718">
                        <p class="notep1">See Also:</p><a href="cqn.html#GUID-63C99D7D-0C28-4925-8F5C-93D0202DB3F1">Prerequisites for Creating CQN Registrations</a> for privileges required to register queries
                     </div>
                  </div>
               </div><a id="ADFNS555"></a><div class="props_rev_3"><a id="GUID-15D6BF5D-28B9-4E14-AF6B-A5311B8F034D" name="GUID-15D6BF5D-28B9-4E14-AF6B-A5311B8F034D"></a><h4 id="ADFNS-GUID-15D6BF5D-28B9-4E14-AF6B-A5311B8F034D" class="sect4">Global Events</h4>
                  <div>
                     <p>The global events <code class="codeph">EVENT_STARTUP</code> and <code class="codeph">EVENT_SHUTDOWN</code> generate notifications.
                     </p>
                     <p>In an Oracle RAC environment, these events generate notifications:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><code class="codeph">EVENT_STARTUP</code> when the first instance of the database starts
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">EVENT_SHUTDOWN</code> when the last instance of the database shuts down
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">EVENT_SHUTDOWN_ANY</code> when any instance of the database shuts down
                           </p>
                        </li>
                     </ul>
                     <p>The preceding global events are constants defined in the <code class="codeph">DBMS_CQ_NOTIFICATION</code> package.
                     </p>
                     <div class="infoboxnotealso" id="GUID-15D6BF5D-28B9-4E14-AF6B-A5311B8F034D__GUID-85F2A03D-EB01-4CED-805E-4514B35E8584">
                        <p class="notep1">See Also:</p>
                        <p><a href="../arpls/DBMS_CQ_NOTIFICATION.html#ARPLS201" target="_blank"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about the <code class="codeph">DBMS_CQ_NOTIFICATION</code> package
                        </p>
                     </div>
                  </div>
               </div>
            </div><a id="ADFNS556"></a><div class="props_rev_3"><a id="GUID-B65C2FEA-1A2C-4C47-9E93-4697442F4529" name="GUID-B65C2FEA-1A2C-4C47-9E93-4697442F4529"></a><h3 id="ADFNS-GUID-B65C2FEA-1A2C-4C47-9E93-4697442F4529" class="sect3">Notification Contents</h3>
               <div>
                  <p>A notification contains some or all of this information:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Type of event, which is one of:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Startup</p>
                           </li>
                           <li>
                              <p>Object change</p>
                           </li>
                           <li>
                              <p>Query result change</p>
                           </li>
                           <li>
                              <p>Deregistration</p>
                           </li>
                           <li>
                              <p>Shutdown</p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>Registration ID of affected registration</p>
                     </li>
                     <li>
                        <p>Names of changed objects</p>
                     </li>
                     <li>
                        <p>If <code class="codeph">ROWID</code> option was specified, <code class="codeph">ROWID</code>s of changed rows
                        </p>
                     </li>
                     <li>
                        <p>If the notification type is QRCN: Query IDs of queries whose results changed</p>
                     </li>
                     <li>
                        <p>If notification resulted from a DML or DDL statement:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Array of names of modified tables</p>
                           </li>
                           <li>
                              <p>Operation type (for example, <code class="codeph">INSERT</code> or <code class="codeph">UPDATE</code>)
                              </p>
                           </li>
                        </ul>
                     </li>
                  </ul>
                  <p>A notification does not contain the changed data itself. For example, the notification does not say that a monthly salary increased from 5000 to 6000. To obtain more recent values for the changed objects or rows or query results, the application must query the database.</p>
               </div>
            </div><a id="ADFNS557"></a><a id="ADFNS558"></a><a id="ADFNS1015"></a><div class="props_rev_3"><a id="GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778" name="GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778"></a><h3 id="ADFNS-GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778" class="sect3">Good Candidates for CQN</h3>
               <div>
                  <p>Good candidates for CQN are applications that cache the result sets of queries on infrequently changed objects in the middle tier, to avoid network round trips to the database. These applications can use CQN to register the queries to be cached. When such an application receives a notification, it can refresh its cache by rerunning the registered queries.</p>
                  <p>An example of such an application is a web forum. Because its users need not view content as soon as it is inserted into the database, this application can cache information in the middle tier and have CQN tell it when it when to refresh the cache.</p>
                  <p><a href="cqn.html#GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778__BGBIFFAE">Figure 18-1</a> illustrates a typical scenario in which the database serves data that is cached in the middle tier and then accessed over the Internet.
                  </p>
                  <div class="figure" id="GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778__BGBIFFAE">
                     <p class="titleinfigure">Figure 18-1 Middle-Tier Caching</p><img width="401" src="img/adfns022.gif" alt="Description of Figure 18-1 follows" title="Description of Figure 18-1 follows" longdesc="img_text/adfns022.html"><br><a href="img_text/adfns022.html">Description of "Figure 18-1 Middle-Tier Caching"</a></div>
                  <!-- class="figure" -->
                  <p>Applications in the middle tier require rapid access to cached copies of database objects while keeping the cache as current as possible in relation to the database. Cached data becomes obsolete when a transaction modifies the data and commits, thereby putting the application at risk of accessing incorrect results. If the application uses CQN, the database can publish a notification when a change occurs to registered objects with details on what changed. In response to the notification, the application can refresh cached data by fetching it from the back-end database.</p>
                  <p><a href="cqn.html#GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778__CHECFHCH">Figure 18-2</a> illustrates the process by which middle-tier web clients receive and process notifications.
                  </p>
                  <div class="figure" id="GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778__CHECFHCH">
                     <p class="titleinfigure">Figure 18-2 Basic Process of Continuous Query Notification (CQN)</p><img width="401" src="img/adfns104.gif" alt="Description of Figure 18-2 follows" title="Description of Figure 18-2 follows" longdesc="img_text/adfns104.html"><br><a href="img_text/adfns104.html">Description of "Figure 18-2 Basic Process of Continuous Query Notification (CQN)"</a></div>
                  <!-- class="figure" -->
                  <p>Explanation of steps in <a href="cqn.html#GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778__CHECFHCH">Figure 18-2</a> (if registrations are created using PL/SQL and that the application has cached the result set of a query on <code class="codeph">HR</code>.<code class="codeph">EMPLOYEES</code>):
                  </p>
                  <ol>
                     <li>
                        <p>The developer uses PL/SQL to create a CQN registration for the query, which consists of creating a stored PL/SQL procedure to process notifications and then using the PL/SQL CQN interface to create a registration for the query, specifying the PL/SQL procedure as the notification handler.</p>
                     </li>
                     <li>
                        <p>The database populates the registration information in the data dictionary.</p>
                     </li>
                     <li>
                        <p>A user updates a row in the <code class="codeph">HR</code>.<code class="codeph">EMPLOYEES</code> table in the back-end database and commits the update, causing the query result to change. The data for <code class="codeph">HR</code>.<code class="codeph">EMPLOYEES</code> cached in the middle tier is now outdated.
                        </p>
                     </li>
                     <li>
                        <p>The database adds a message that describes the change to an internal queue.</p>
                     </li>
                     <li>
                        <p>The database notifies a <code class="codeph">JOBQ</code> background process of a notification message.
                        </p>
                     </li>
                     <li id="GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778__CHDCABFC">
                        <p>The <code class="codeph">JOBQ</code> process runs the stored procedure specified by the client application. In this example, <code class="codeph">JOBQ</code> passes the data to a server-side PL/SQL procedure. The implementation of the PL/SQL notification handler determines how the notification is handled.
                        </p>
                     </li>
                     <li>
                        <p>Inside the server-side PL/SQL procedure, the developer can implement logic to notify the middle-tier client application of the changes to the registered objects. For example, it notifies the application of the <code class="codeph">ROWID</code> of the changed row in <code class="codeph">HR</code>.<code class="codeph">EMPLOYEES</code>.
                        </p>
                     </li>
                     <li>
                        <p>The client application in the middle tier queries the back-end database to retrieve the data in the changed row.</p>
                     </li>
                     <li>
                        <p>The client application updates the cache with the data.</p>
                     </li>
                  </ol>
               </div>
            </div><a id="ADFNS1016"></a><div class="props_rev_3"><a id="GUID-9F2A38D3-1E9B-484C-8793-6D6CA554044A" name="GUID-9F2A38D3-1E9B-484C-8793-6D6CA554044A"></a><h3 id="ADFNS-GUID-9F2A38D3-1E9B-484C-8793-6D6CA554044A" class="sect3">Creating CQN Registrations</h3>
               <div>
                  <div class="section">
                     <p>A <span class="bold">CQN registration</span> associates a list of one or more queries with a notification type and a notification handler.
                     </p>
                     <p>The notification type is either OCN or QRCN.</p>
                     <p>To create a CQN registration, you can use one of two interfaces:</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>PL/SQL interface</p>
                           <p>If you use the PL/SQL interface, the notification handler is a server-side PL/SQL stored procedure.</p>
                        </li>
                        <li>
                           <p>Oracle Call Interface (OCI)</p>
                           <p>If you use OCI, the notification handler is a client-side C callback procedure.</p>
                        </li>
                     </ul>
                     <p>After being created, a registration is stored in the database. In an Oracle RAC environment, it is visible to all database instances. Transactions that change the query results in any database instance generate notifications.</p>
                     <p>By default, a registration survives until the application that created it explicitly deregisters it or until the database implicitly purges it (from loss of privileges, for example).</p>
                     <div class="infoboxnotealso" id="GUID-9F2A38D3-1E9B-484C-8793-6D6CA554044A__NOTE-1325-CAD4E28C">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="cqn.html#GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4">About Object Change Notification (OCN)</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-2E64E453-ADBE-4DFA-94C0-39A0AA4081E9" title="Some types of queries are so simplified that invalidations are generated at object level; that is, whenever any object referenced in those queries changes. Examples of such queries are those that use unsupported column types or include subqueries. The solution to this problem is to rewrite the original queries.">About Query Result Change Notification (QRCN)</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-01E3E0A3-81AB-4EEE-8E26-4F3F2FE1D60E">Using PL/SQL to Create CQN Registrations</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-0D38B15C-F5CD-44C9-B073-39DA78350D28">Using OCI to Create CQN Registrations</a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="ADFNS543"></a><a id="ADFNS542"></a><div class="props_rev_3"><a id="GUID-01E3E0A3-81AB-4EEE-8E26-4F3F2FE1D60E" name="GUID-01E3E0A3-81AB-4EEE-8E26-4F3F2FE1D60E"></a><h3 id="ADFNS-GUID-01E3E0A3-81AB-4EEE-8E26-4F3F2FE1D60E" class="sect3">Using PL/SQL to Create CQN Registrations</h3>
               <div>
                  <div class="section">
                     <p>This section describes using PL/SQL to create CQN registrations. When you use the PL/SQL interface, the notification handler is a server-side PL/SQL stored procedure.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-01E3E0A3-81AB-4EEE-8E26-4F3F2FE1D60E__GUID-B4B2E2DB-FB5E-4C43-A602-6075495C126C">Topics:</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="cqn.html#GUID-2F2BA54E-5EA9-41C3-BA67-87D709BE6343">PL/SQL CQN Registration Interface</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-04A011CB-ABBE-47C2-B9C7-A04A0C9FC8AE">CQN Registration Options</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-63C99D7D-0C28-4925-8F5C-93D0202DB3F1">Prerequisites for Creating CQN Registrations</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-2D04655A-3C16-4878-9F07-26311FD3149D">Queries that Can Be Registered for Object Change Notification (OCN)</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-B96D4FE6-465D-4400-89B1-7E8DBCD5829C">Queries that Can Be Registered for Query Result Change Notification (QRCN)</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-52D0C42D-EA7E-4282-A14B-BA42E11D9A6D">Using PL/SQL to Register Queries for CQN</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-069991BE-E98B-4733-BEB7-D4AE96D0DB87">Best Practices for CQN Registrations</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-FC45C32A-D57E-4925-A88B-97FAE4AD528D">Troubleshooting CQN Registrations</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-ABAB71A2-F950-4F0A-B413-FD2D67F335DF">Deleting Registrations</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-2D194274-3C78-42F3-959C-10B9F30B2F07">Configuring CQN: Scenario</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS559"></a><div class="props_rev_3"><a id="GUID-2F2BA54E-5EA9-41C3-BA67-87D709BE6343" name="GUID-2F2BA54E-5EA9-41C3-BA67-87D709BE6343"></a><h4 id="ADFNS-GUID-2F2BA54E-5EA9-41C3-BA67-87D709BE6343" class="sect4">PL/SQL CQN Registration Interface</h4>
                  <div>
                     <p>The PL/SQL CQN registration interface is implemented with the <code class="codeph">DBMS_CQ_NOTIFICATION</code> package. You use the <code class="codeph">DBMS_CQ_NOTIFICATION</code>.<code class="codeph">NEW_REG_START</code> function to open a registration block. You specify the registration details, including the notification type and notification handler, as part of the <code class="codeph">CQ_NOTIFICATION$_REG_INFO</code> object, which is passed as an argument to the <code class="codeph">NEW_REG_START</code> procedure. Every query that you run while the registration block is open is registered with CQN. If you specified notification type QRCN, the database assigns a query ID to each query. You can retrieve these query IDs with the <code class="codeph">DBMS_CQ_NOTIFICATION</code>.<code class="codeph">CQ_NOTIFICATION_QUERYID</code> function. To close the registration block, you use the <code class="codeph">DBMS_CQ_NOTIFICATION</code>.<code class="codeph">REG_END</code> function.
                     </p>
                     <div class="infoboxnotealso" id="GUID-2F2BA54E-5EA9-41C3-BA67-87D709BE6343__GUID-423A67C4-798D-45FE-99D6-3DC7EC42DD7F">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ARPLS201" target="_blank"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about the <code class="codeph">DBMS_CQ_NOTIFICATION</code> package
                              </p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-52D0C42D-EA7E-4282-A14B-BA42E11D9A6D">Using PL/SQL to Register Queries for CQN</a> 
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="ADFNS561"></a><a id="ADFNS1063"></a><a id="ADFNS560"></a><div class="props_rev_3"><a id="GUID-04A011CB-ABBE-47C2-B9C7-A04A0C9FC8AE" name="GUID-04A011CB-ABBE-47C2-B9C7-A04A0C9FC8AE"></a><h4 id="ADFNS-GUID-04A011CB-ABBE-47C2-B9C7-A04A0C9FC8AE" class="sect4">CQN Registration Options</h4>
                  <div>
                     <p>You can change the CQN registration defaults with the options summarized in <a href="cqn.html#GUID-04A011CB-ABBE-47C2-B9C7-A04A0C9FC8AE__g1826201" title="This table summarizes the Database Change Notification registration options.">Table 18-1</a>.
                     </p>
                     <div class="tblformal" id="GUID-04A011CB-ABBE-47C2-B9C7-A04A0C9FC8AE__g1826201">
                        <p class="titleintable">Table 18-1 Continuous Query Notification Registration Options</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="Continuous Query Notification Registration Options" summary="This table summarizes the Database Change Notification registration options." width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="28%" id="d102353e2667">Option</th>
                                 <th align="left" valign="bottom" width="72%" id="d102353e2670">Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d102353e2675" headers="d102353e2667 ">
                                    <p>Notification Type</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d102353e2675 d102353e2670 ">
                                    <p>Specifies QRCN (the default is OCN).</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d102353e2682" headers="d102353e2667 ">
                                    <p>QRCN Mode<a id="fn_1" name="fn_1" href="#fn_1" onclick="footdisplay(1, "Applies only when notification type is QRCN.")"><sup>Foot&nbsp;1</sup></a></p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d102353e2682 d102353e2670 ">
                                    <p>Specifies best-effort mode (the default is guaranteed mode).</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d102353e2692" headers="d102353e2667 ">
                                    <p><code class="codeph">ROWID</code></p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d102353e2692 d102353e2670 ">
                                    <p>Includes the value of the <code class="codeph">ROWID</code> pseudocolumn for each changed row in the notification.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d102353e2703" headers="d102353e2667 ">
                                    <p>Operations Filter<a id="GUID-04A011CB-ABBE-47C2-B9C7-A04A0C9FC8AE__CHDGJDDD" name="GUID-04A011CB-ABBE-47C2-B9C7-A04A0C9FC8AE__CHDGJDDD" href="#GUID-04A011CB-ABBE-47C2-B9C7-A04A0C9FC8AE__CHDGJDDD" onclick="footdisplay(2, "Applies only when notification type is OCN.")"><sup>Foot&nbsp;2</sup></a></p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d102353e2703 d102353e2670 ">
                                    <p>Publishes the notification only if the operation type matches the specified filter condition.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d102353e2713" headers="d102353e2667 ">
                                    <p>Transaction Lag<a id="fnsrc_d102353e2716" name="fnsrc_d102353e2716" href="#fnsrc_d102353e2716" onclick="footdisplay(2, "Applies only when notification type is OCN.")"><sup>Footref&nbsp;2</sup></a></p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d102353e2713 d102353e2670 ">
                                    <p>Deprecated. Use Notification Grouping instead.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d102353e2722" headers="d102353e2667 ">
                                    <p>Notification Grouping</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d102353e2722 d102353e2670 ">
                                    <p>Specifies how notifications are grouped.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d102353e2729" headers="d102353e2667 ">
                                    <p>Reliable</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d102353e2729 d102353e2670 ">
                                    <p>Stores notifications in a persistent database queue (instead of in shared memory, the default).</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d102353e2736" headers="d102353e2667 ">
                                    <p>Purge on Notify</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d102353e2736 d102353e2670 ">
                                    <p>Purges the registration after the first notification.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="28%" id="d102353e2743" headers="d102353e2667 ">
                                    <p>Timeout</p>
                                 </td>
                                 <td align="left" valign="top" width="72%" headers="d102353e2743 d102353e2670 ">
                                    <p>Purges the registration after a specified time interval.</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p class="tablefootnote"><sup class="tablefootnote">Footnote&nbsp;1 </sup></p><p>Applies only when notification type is QRCN.</p>
                     <p></p>
                     <p class="tablefootnote"><sup class="tablefootnote">Footnote&nbsp;2 </sup></p><p>Applies only when notification type is OCN.</p>
                     <p></p>
                     <div class="section">
                        <p class="subhead3" id="GUID-04A011CB-ABBE-47C2-B9C7-A04A0C9FC8AE__GUID-746DB27B-7B07-4DB5-A593-3A37EA2A7DD1">Topics:</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="cqn.html#GUID-CAEE5FDA-BE64-4449-9DAE-97AB89DE45E7">Notification Type Option</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-2CF1B8D6-75CE-4510-8B7A-4BFA43476B37">QRCN Mode (QRCN Notification Type Only)</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-52166555-C4AB-46F0-ABB6-6AD64093E19F">ROWID Option</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-8349364C-1340-4B13-B8BB-F23FC1152DED">Operations Filter Option (OCN Notification Type Only)</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-1B25459B-ED98-44B0-8F73-872E1CB84641">Transaction Lag Option (OCN Notification Type Only)</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-6E9DCC6A-BFD7-40D6-B5C0-8BF9311259E8">Notification Grouping Options</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-B920D116-298A-4024-84DC-B6B594E7F371">Reliable Option</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-52255F89-1799-48DA-881B-C7797BA548BF">Purge-on-Notify and Timeout Options</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div><a id="ADFNS562"></a><div class="props_rev_3"><a id="GUID-CAEE5FDA-BE64-4449-9DAE-97AB89DE45E7" name="GUID-CAEE5FDA-BE64-4449-9DAE-97AB89DE45E7"></a><h5 id="ADFNS-GUID-CAEE5FDA-BE64-4449-9DAE-97AB89DE45E7" class="sect5">Notification Type Option</h5>
                     <div>
                        <p>The notification types are OCN and QRCN .</p>
                        <div class="infoboxnotealso" id="GUID-CAEE5FDA-BE64-4449-9DAE-97AB89DE45E7__GUID-46C323C4-90AB-4604-86C3-39CD633895DE">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="cqn.html#GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4">About Object Change Notification (OCN)</a></p>
                              </li>
                              <li>
                                 <p><a href="cqn.html#GUID-2E64E453-ADBE-4DFA-94C0-39A0AA4081E9" title="Some types of queries are so simplified that invalidations are generated at object level; that is, whenever any object referenced in those queries changes. Examples of such queries are those that use unsupported column types or include subqueries. The solution to this problem is to rewrite the original queries.">About Query Result Change Notification (QRCN)</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="ADFNS563"></a><div class="props_rev_3"><a id="GUID-2CF1B8D6-75CE-4510-8B7A-4BFA43476B37" name="GUID-2CF1B8D6-75CE-4510-8B7A-4BFA43476B37"></a><h5 id="ADFNS-GUID-2CF1B8D6-75CE-4510-8B7A-4BFA43476B37" class="sect5">QRCN Mode (QRCN Notification Type Only)</h5>
                     <div>
                        <p>The QRCN mode option applies only when the notification type is QRCN. Instructions for setting the notification type to QRCN are in <a href="cqn.html#GUID-CAEE5FDA-BE64-4449-9DAE-97AB89DE45E7">Notification Type Option</a>.
                        </p>
                        <div class="p">QRCN modes are:
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>guaranteed</p>
                              </li>
                              <li>
                                 <p>best-effort</p>
                              </li>
                           </ul> 
                        </div>
                        <p>The default is guaranteed mode. For best-effort mode, specify <code class="codeph">QOS_BEST_EFFORT</code> in the <code class="codeph">QOSFLAGS</code> attribute of the <code class="codeph">CQ_NOTIFICATION$_REG_INFO</code> object.
                        </p>
                        <div class="infoboxnotealso" id="GUID-2CF1B8D6-75CE-4510-8B7A-4BFA43476B37__NOTE-124-CAD5B93A">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="cqn.html#GUID-4A320315-AF7F-4D60-BB63-AD9731D3640D">Guaranteed Mode</a></p>
                              </li>
                              <li>
                                 <p><a href="cqn.html#GUID-0766B418-4023-4BB7-8887-25AE98CBD351" title="Some types of queries are so simplified that invalidations are generated at object level; that is, whenever any object referenced in those queries changes. Examples of such queries are those that use unsupported column types or include subqueries. The solution to this problem is to rewrite the original queries.">Best-Effort Mode</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="ADFNS564"></a><div class="props_rev_3"><a id="GUID-52166555-C4AB-46F0-ABB6-6AD64093E19F" name="GUID-52166555-C4AB-46F0-ABB6-6AD64093E19F"></a><h5 id="ADFNS-GUID-52166555-C4AB-46F0-ABB6-6AD64093E19F" class="sect5">ROWID Option</h5>
                     <div>
                        <p>The <code class="codeph">ROWID</code> option includes the value of the <code class="codeph">ROWID</code> pseudocolumn (the rowid of the row) for each changed row in the notification. To include the <code class="codeph">ROWID</code> option of each changed row in the notification, specify <code class="codeph">QOS_ROWIDS</code> in the <code class="codeph">QOSFLAGS</code> attribute of the <code class="codeph">CQ_NOTIFICATION$_REG_INFO</code> object.
                        </p>
                        <div class="infoboxnote" id="GUID-52166555-C4AB-46F0-ABB6-6AD64093E19F__GUID-B54ACFC2-BCBD-4980-B1B3-8C4D59E70F1F">
                           <p class="notep1">Note:</p>
                           <p>When you update a row in a table compressed with Hybrid Columnar Compression (HCC), the <code class="codeph">ROWID</code> of the row changes. HCC, a feature of certain Oracle storage systems, is described in <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=CNCPT89198" target="_blank"><span class="italic">Oracle Database Concepts</span></a>.
                           </p>
                        </div>
                        <p>From the <code class="codeph">ROWID</code> information in the notification, the application can retrieve the contents of the changed rows by performing queries of this form:
                        </p><pre class="oac_no_warn" dir="ltr">SELECT * FROM <span class="italic">table_name_from_notification</span>
WHERE ROWID = <span class="italic">rowid_from_notification</span>;
</pre><p><code class="codeph">ROWID</code>s are published in the external string format. For a regular heap table, the length of a <code class="codeph">ROWID</code> is 18 character bytes. For an Index Organized Table (IOT), the length of the <code class="codeph">ROWID</code> depends on the size of the primary key, and might exceed 18 bytes.
                        </p>
                        <p>If the server does not have enough memory for the <code class="codeph">ROWID</code>s, the notification might be "rolled up" into a <code class="codeph">FULL-TABLE-NOTIFICATION</code>, indicated by a special flag in the notification descriptor. Possible reasons for a <code class="codeph">FULL-TABLE-NOTIFICATION</code> are:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Total shared memory consumption from <code class="codeph">ROWID</code>s exceeds 1% of the dynamic shared pool size.
                              </p>
                           </li>
                           <li>
                              <p>Too many rows were changed in a single registered object within a transaction (the upper limit is approximately 80).</p>
                           </li>
                           <li>
                              <p>Total length of the logical <code class="codeph">ROWID</code>s of modified rows for an IOT is too large (the upper limit is approximately 1800 bytes).
                              </p>
                           </li>
                           <li>
                              <p>You specified the Notification Grouping option <code class="codeph">NTFN_GROUPING_TYPE</code> with the value <code class="codeph">DBMS_CQ_NOTIFICATION</code>.<code class="codeph">NTFN_GROUPING_TYPE_SUMMARY</code>, described in <a href="cqn.html#GUID-6E9DCC6A-BFD7-40D6-B5C0-8BF9311259E8">Notification Grouping Options</a>.
                              </p>
                           </li>
                        </ul>
                        <p>Because a <code class="codeph">FULL-TABLE-NOTIFICATION</code> does not include <code class="codeph">ROWID</code>s, the application that receives it must assume that the entire table (that is, all rows) might have changed.
                        </p>
                     </div>
                  </div><a id="ADFNS565"></a><div class="props_rev_3"><a id="GUID-8349364C-1340-4B13-B8BB-F23FC1152DED" name="GUID-8349364C-1340-4B13-B8BB-F23FC1152DED"></a><h5 id="ADFNS-GUID-8349364C-1340-4B13-B8BB-F23FC1152DED" class="sect5">Operations Filter Option (OCN Notification Type Only)</h5>
                     <div>
                        <p>The Operations Filter option applies only when the notification type is OCN.</p>
                        <p>The Operations Filter option enables you to specify the types of operations that generate notifications.</p>
                        <p>The default is all operations. To specify that only some operations generate notifications, use the <code class="codeph">OPERATIONS_FILTER</code> attribute of the <code class="codeph">CQ_NOTIFICATION$_REG_INFO</code> object. With the <code class="codeph">OPERATIONS_FILTER</code> attribute, specify the type of operation with the constant that represents it, which is defined in the <code class="codeph">DBMS_CQ_NOTIFICATION</code> package, as follows:
                        </p>
                        <div class="tblformal" id="GUID-8349364C-1340-4B13-B8BB-F23FC1152DED__GUID-66600CE8-AEF6-409D-BBBA-4FD9EE029A1A">
                           <table cellpadding="4" cellspacing="0" class="Formal" title="" summary="This table summarizes the operations that can generate change notifications and the constants that represent them in the DBMS_CQ_NOTIFICATIONS package." width="100%" frame="hsides" border="1" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="18%" id="d102353e3372">Operation</th>
                                    <th align="left" valign="bottom" width="82%" id="d102353e3375">Constant</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="18%" id="d102353e3380" headers="d102353e3372 ">
                                       <p><code class="codeph">INSERT</code></p>
                                    </td>
                                    <td align="left" valign="top" width="82%" headers="d102353e3380 d102353e3375 ">
                                       <p><code class="codeph">DBMS_CQ_NOTIFICATION.INSERTOP</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="18%" id="d102353e3389" headers="d102353e3372 ">
                                       <p><code class="codeph">UPDATE</code></p>
                                    </td>
                                    <td align="left" valign="top" width="82%" headers="d102353e3389 d102353e3375 ">
                                       <p><code class="codeph">DBMS_CQ_NOTIFICATION.UPDATEOP</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="18%" id="d102353e3398" headers="d102353e3372 ">
                                       <p><code class="codeph">DELETE</code></p>
                                    </td>
                                    <td align="left" valign="top" width="82%" headers="d102353e3398 d102353e3375 ">
                                       <p><code class="codeph">DBMS_CQ_NOTIFICATION.DELETEOP</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="18%" id="d102353e3407" headers="d102353e3372 ">
                                       <p><code class="codeph">ALTEROP</code></p>
                                    </td>
                                    <td align="left" valign="top" width="82%" headers="d102353e3407 d102353e3375 ">
                                       <p><code class="codeph">DBMS_CQ_NOTIFICATION.ALTEROP</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="18%" id="d102353e3416" headers="d102353e3372 ">
                                       <p><code class="codeph">DROPOP</code></p>
                                    </td>
                                    <td align="left" valign="top" width="82%" headers="d102353e3416 d102353e3375 ">
                                       <p><code class="codeph">DBMS_CQ_NOTIFICATION.DROPOP</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="18%" id="d102353e3425" headers="d102353e3372 ">
                                       <p><code class="codeph">UNKNOWNOP</code></p>
                                    </td>
                                    <td align="left" valign="top" width="82%" headers="d102353e3425 d102353e3375 ">
                                       <p><code class="codeph">DBMS_CQ_NOTIFICATION.UNKNOWNOP</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="18%" id="d102353e3434" headers="d102353e3372 ">
                                       <p>All (default)</p>
                                    </td>
                                    <td align="left" valign="top" width="82%" headers="d102353e3434 d102353e3375 ">
                                       <p><code class="codeph">DBMS_CQ_NOTIFICATION.ALL_OPERATIONS</code></p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>To specify multiple operations, use bitwise <code class="codeph">OR</code>. For example:
                        </p><pre class="oac_no_warn" dir="ltr">DBMS_CQ_NOTIFICATION.INSERTOP + DBMS_CQ_NOTIFICATION.DELETEOP
</pre><p><code class="codeph">OPERATIONS_FILTER</code> has no effect if you also specify <code class="codeph">QOS_QUERY</code> in the <code class="codeph">QOSFLAGS</code> attribute, because <code class="codeph">QOS_QUERY</code> specifies notification type QRCN.
                        </p>
                        <div class="infoboxnotealso" id="GUID-8349364C-1340-4B13-B8BB-F23FC1152DED__GUID-A5ACC36D-49B4-40BF-81C4-7CFFE4C6E720">
                           <p class="notep1">See Also:</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ARPLS201" target="_blank"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about the <code class="codeph">DBMS_CQ_NOTIFICATION</code> package
                           </p>
                        </div>
                     </div>
                  </div><a id="ADFNS566"></a><div class="props_rev_3"><a id="GUID-1B25459B-ED98-44B0-8F73-872E1CB84641" name="GUID-1B25459B-ED98-44B0-8F73-872E1CB84641"></a><h5 id="ADFNS-GUID-1B25459B-ED98-44B0-8F73-872E1CB84641" class="sect5">Transaction Lag Option (OCN Notification Type Only)</h5>
                     <div>
                        <p>The Transaction Lag option applies only when the notification type is OCN.</p>
                        <div class="infoboxnote" id="GUID-1B25459B-ED98-44B0-8F73-872E1CB84641__GUID-D2BF19B0-F72E-4A93-A40F-0781C79E6A8E">
                           <p class="notep1">Note:</p>
                           <p>This option is deprecated. To implement flow-of-control notifications, use <a href="cqn.html#GUID-6E9DCC6A-BFD7-40D6-B5C0-8BF9311259E8">Notification Grouping Options</a>.
                           </p>
                        </div>
                        <p>The Transaction Lag option specifies the number of transactions by which the client application can lag behind the database. If the number is 0, every transaction that changes a registered object results in a notification. If the number is 5, every fifth transaction that changes a registered object results in a notification. The database tracks intervening changes at object granularity and includes them in the notification, so that the client does not lose them.</p>
                        <p>A transaction lag greater than 0 is useful only if an application implements flow-of-control notifications. Ensure that the application generates notifications frequently enough to satisfy the lag, so that they are not deferred indefinitely.</p>
                        <p>If you specify <code class="codeph">TRANSACTION_LAG</code>, then notifications do not include <code class="codeph">ROWID</code>s, even if you also specified <code class="codeph">QOS_ROWIDS</code>.
                        </p>
                     </div>
                  </div><a id="ADFNS567"></a><div class="props_rev_3"><a id="GUID-6E9DCC6A-BFD7-40D6-B5C0-8BF9311259E8" name="GUID-6E9DCC6A-BFD7-40D6-B5C0-8BF9311259E8"></a><h5 id="ADFNS-GUID-6E9DCC6A-BFD7-40D6-B5C0-8BF9311259E8" class="sect5">Notification Grouping Options</h5>
                     <div>
                        <p>By default, notifications are generated immediately after the event that causes them.</p>
                        <p>Notification Grouping options, which are attributes of the <code class="codeph">CQ_NOTIFICATION$_REG_INFO</code> object, are:
                        </p>
                        <div class="tblformal" id="GUID-6E9DCC6A-BFD7-40D6-B5C0-8BF9311259E8__GUID-C99F62EC-AB2B-46F6-A356-EB9B933B6F4A">
                           <table cellpadding="4" cellspacing="0" class="Formal" title="" summary="This table summarizes the notification grouping options." width="100%" frame="hsides" border="1" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="40%" id="d102353e3701">Attribute</th>
                                    <th align="left" valign="bottom" width="60%" id="d102353e3704">Description</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="40%" id="d102353e3709" headers="d102353e3701 ">
                                       <p><code class="codeph">NTFN_GROUPING_CLASS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="60%" headers="d102353e3709 d102353e3704 ">
                                       <p>Specifies the class by which to group notifications. The only allowed values are <code class="codeph">DBMS_CQ_NOTIFICATION</code>.<code class="codeph">NTFN_GROUPING_CLASS_TIME</code>, which groups notifications by time, and zero, which is the default (notifications are generated immediately after the event that causes them).
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="40%" id="d102353e3723" headers="d102353e3701 ">
                                       <p><code class="codeph">NTFN_GROUPING_VALUE</code></p>
                                    </td>
                                    <td align="left" valign="top" width="60%" headers="d102353e3723 d102353e3704 ">
                                       <p>Specifies the time interval that defines the group, in seconds. For example, if this value is 900, notifications generated in the same 15-minute interval are grouped.</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="40%" id="d102353e3731" headers="d102353e3701 ">
                                       <p><code class="codeph">NTFN_GROUPING_TYPE</code></p>
                                    </td>
                                    <td align="left" valign="top" width="60%" headers="d102353e3731 d102353e3704 ">
                                       <p>Specifies the type of grouping, which is either of:</p>
                                       <ul style="list-style-type: disc;">
                                          <li>
                                             <p><code class="codeph">DBMS_CQ_NOTIFICATION</code>.<code class="codeph">NTFN_GROUPING_TYPE_SUMMARY</code>: All notifications in the group are summarized into a single notification.
                                             </p>
                                             <p><span class="bold">Note:</span> The single notification does not include <code class="codeph">ROWID</code>s, even if you specified the <code class="codeph">ROWID</code> option.
                                             </p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">DBMS_CQ_NOTIFICATION</code>.<code class="codeph">NTFN_GROUPING_TYPE_LAST</code>: Only the last notification in the group is published and the earlier ones discarded.
                                             </p>
                                          </li>
                                       </ul>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="40%" id="d102353e3766" headers="d102353e3701 ">
                                       <p><code class="codeph">NTFN_GROUPING_START_TIME</code></p>
                                    </td>
                                    <td align="left" valign="top" width="60%" headers="d102353e3766 d102353e3704 ">
                                       <p>Specifies when to start generating notifications. If specified as <code class="codeph">NULL</code>, it defaults to the current system-generated time.
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="40%" id="d102353e3777" headers="d102353e3701 ">
                                       <p><code class="codeph">NTFN_GROUPING_REPEAT_COUNT</code></p>
                                    </td>
                                    <td align="left" valign="top" width="60%" headers="d102353e3777 d102353e3704 ">
                                       <p>Specifies how many times to repeat the notification. Set to <code class="codeph">DBMS_CQ_NOTIFICATION</code>.<code class="codeph">NTFN_GROUPING_FOREVER</code> to receive notifications for the life of the registration. To receive at most <span class="italic">n</span> notifications during the life of the registration, set to <span class="italic">n</span>.
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <div class="infoboxnote" id="GUID-6E9DCC6A-BFD7-40D6-B5C0-8BF9311259E8__GUID-FBC1F868-C660-4916-B436-16126CBD1EFA">
                           <p class="notep1">Note:</p>
                           <p>Notifications generated by timeouts, loss of privileges, and global events might be published before the specified grouping interval expires. If they are, any pending grouped notifications are also published before the interval expires.</p>
                        </div>
                     </div>
                  </div><a id="ADFNS568"></a><div class="props_rev_3"><a id="GUID-B920D116-298A-4024-84DC-B6B594E7F371" name="GUID-B920D116-298A-4024-84DC-B6B594E7F371"></a><h5 id="ADFNS-GUID-B920D116-298A-4024-84DC-B6B594E7F371" class="sect5">Reliable Option</h5>
                     <div>
                        <p>By default, a CQN registration is stored in shared memory. To store it in a persistent database queue instead—that is, to generate <span class="bold">reliable notifications</span>—specify <code class="codeph">QOS_RELIABLE</code> in the <code class="codeph">QOSFLAGS</code> attribute of the <code class="codeph">CQ_NOTIFICATION$_REG_INFO</code> object.
                        </p>
                        <p>The advantage of reliable notifications is that if the database fails after generating them, it can still deliver them after it restarts. In an Oracle RAC environment, a surviving database instance can deliver them.</p>
                        <p>The disadvantage of reliable notifications is that they have higher CPU and I/O costs than default notifications do.</p>
                     </div>
                  </div><a id="ADFNS569"></a><div class="props_rev_3"><a id="GUID-52255F89-1799-48DA-881B-C7797BA548BF" name="GUID-52255F89-1799-48DA-881B-C7797BA548BF"></a><h5 id="ADFNS-GUID-52255F89-1799-48DA-881B-C7797BA548BF" class="sect5">Purge-on-Notify and Timeout Options</h5>
                     <div>
                        <p>By default, a CQN registration survives until the application that created it explicitly deregisters it or until the database implicitly purges it (from loss of privileges, for example).</p>
                        <p>To purge the registration after it generates its first notification, specify <code class="codeph">QOS_DEREG_NFY</code> in the <code class="codeph">QOSFLAGS</code> attribute of the <code class="codeph">CQ_NOTIFICATION$_REG_INFO</code> object.
                        </p>
                        <p>To purge the registration after <span class="italic">n</span> seconds, specify <span class="italic">n</span> in the <code class="codeph">TIMEOUT</code> attribute of the <code class="codeph">CQ_NOTIFICATION$_REG_INFO</code> object.
                        </p>
                        <p>You can use the Purge-on-Notify and Timeout options together.</p>
                     </div>
                  </div>
               </div><a id="ADFNS570"></a><div class="props_rev_3"><a id="GUID-63C99D7D-0C28-4925-8F5C-93D0202DB3F1" name="GUID-63C99D7D-0C28-4925-8F5C-93D0202DB3F1"></a><h4 id="ADFNS-GUID-63C99D7D-0C28-4925-8F5C-93D0202DB3F1" class="sect4">Prerequisites for Creating CQN Registrations</h4>
                  <div>
                     <p>These are prerequisites for creating CQN registrations:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>You must have these privileges:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">EXECUTE</code> privilege on the <code class="codeph">DBMS_CQ_NOTIFICATION</code> package, whose subprograms you use to create a registration
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">CHANGE</code> <code class="codeph">NOTIFICATION</code> system privilege
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">READ</code> or <code class="codeph">SELECT</code> privilege on each object to be registered
                                 </p>
                              </li>
                           </ul>
                           <p>Loss of privileges on an object associated with a registered query generates a notification.</p>
                        </li>
                        <li>
                           <p>You must be connected as a non-SYS user.</p>
                        </li>
                        <li>
                           <p>You must not be in the middle of an uncommitted transaction.</p>
                        </li>
                        <li>
                           <p>The <code class="codeph">dml_locks</code> <code class="codeph">init</code>.<code class="codeph">ora</code> parameter must have a nonzero value (as its default value does).
                           </p>
                           <p>(This is also a prerequisite for receiving notifications.)</p>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-63C99D7D-0C28-4925-8F5C-93D0202DB3F1__GUID-B0DCEDF2-1AF4-457E-9A71-43129539BD15">
                        <p class="notep1">Note:</p>
                        <p>For QRCN support, the <code class="codeph">COMPATIBLE</code> setting of the database must be at least 11.0.0.
                        </p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-63C99D7D-0C28-4925-8F5C-93D0202DB3F1__NOTE-125-CAD62611">
                        <p class="notep1">See Also:</p>
                        <p><a href="cqn.html#GUID-E18D6FE8-1389-4774-AC98-175BE374CC5F">Deregistration</a></p>
                     </div>
                  </div>
               </div><a id="ADFNS571"></a><div class="props_rev_3"><a id="GUID-2D04655A-3C16-4878-9F07-26311FD3149D" name="GUID-2D04655A-3C16-4878-9F07-26311FD3149D"></a><h4 id="ADFNS-GUID-2D04655A-3C16-4878-9F07-26311FD3149D" class="sect4">Queries that Can Be Registered for Object Change Notification (OCN)</h4>
                  <div>
                     <p>Most queries can be registered for OCN, including those executed as part of stored procedures and <code class="codeph">REF</code> cursors.
                     </p>
                     <p>Queries that cannot be registered for OCN are:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Queries on fixed tables or fixed views</p>
                        </li>
                        <li>
                           <p>Queries on user views</p>
                        </li>
                        <li>
                           <p>Queries that contain database links (dblinks)</p>
                        </li>
                        <li>
                           <p>Queries over materialized views</p>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-2D04655A-3C16-4878-9F07-26311FD3149D__GUID-1D64D0C9-66B8-4FDB-A79E-E2A9234AB1BD">
                        <p class="notep1">Note:</p>
                        <p>You can use synonyms in OCN registrations, but not in QRCN registrations.</p>
                     </div>
                  </div>
               </div><a id="ADFNS1064"></a><a id="ADFNS572"></a><div class="props_rev_3"><a id="GUID-B96D4FE6-465D-4400-89B1-7E8DBCD5829C" name="GUID-B96D4FE6-465D-4400-89B1-7E8DBCD5829C"></a><h4 id="ADFNS-GUID-B96D4FE6-465D-4400-89B1-7E8DBCD5829C" class="sect4">Queries that Can Be Registered for Query Result Change Notification (QRCN)</h4>
                  <div>
                     <p>Some queries can be registered for QRCN in guaranteed mode, some can be registered for QRCN only in best-effort mode, and some cannot be registered for QRCN in either mode.</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-B96D4FE6-465D-4400-89B1-7E8DBCD5829C__GUID-26BA7F9D-13EE-43C4-B0F3-9FB731E1512C">Topics:</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="cqn.html#GUID-15F66C86-D79B-408F-977C-9BB614C3D91E">Queries that Can Be Registered for QRCN in Guaranteed Mode</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-12872C24-0535-4EA9-B9DF-E2FE9FEC8908">Queries that Can Be Registered for QRCN Only in Best-Effort Mode</a></p>
                           </li>
                           <li>
                              <p><a href="cqn.html#GUID-77B34385-509E-434C-9E78-C793A22AD0A8">Queries that Cannot Be Registered for QRCN in Either Mode</a></p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-B96D4FE6-465D-4400-89B1-7E8DBCD5829C__NOTE-1232-CAD658CF">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="cqn.html#GUID-4A320315-AF7F-4D60-BB63-AD9731D3640D">Guaranteed Mode</a> and 
                                 </p>
                              </li>
                              <li>
                                 <p><a href="cqn.html#GUID-0766B418-4023-4BB7-8887-25AE98CBD351" title="Some types of queries are so simplified that invalidations are generated at object level; that is, whenever any object referenced in those queries changes. Examples of such queries are those that use unsupported column types or include subqueries. The solution to this problem is to rewrite the original queries.">Best-Effort Mode</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div><a id="ADFNS573"></a><div class="props_rev_3"><a id="GUID-15F66C86-D79B-408F-977C-9BB614C3D91E" name="GUID-15F66C86-D79B-408F-977C-9BB614C3D91E"></a><h5 id="ADFNS-GUID-15F66C86-D79B-408F-977C-9BB614C3D91E" class="sect5">Queries that Can Be Registered for QRCN in Guaranteed Mode</h5>
                     <div>
                        <p>To be registered for QRCN in guaranteed mode, a query must conform to these rules:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Every column that it references is either a <code class="codeph">NUMBER</code> data type or a <code class="codeph">VARCHAR2</code> data type.
                              </p>
                           </li>
                           <li>
                              <p>Arithmetic operators in column expressions are limited to these binary operators, and their operands are columns with numeric data types:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><code class="codeph">+</code> (addition)
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">-</code> (subtraction, not unary minus)
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">*</code> (multiplication)
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">/</code> (division)
                                    </p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>Comparison operators in the predicate are limited to:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><code class="codeph">&lt;</code> (less than)
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">&lt;=</code> (less than or equal to)
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">=</code> (equal to)
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">&gt;=</code> (greater than or equal to)
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">&gt;</code> (greater than)
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">&lt;&gt;</code> or <code class="codeph">!=</code> (not equal to)
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">IS</code> <code class="codeph">NULL</code></p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">IS</code> <code class="codeph">NOT</code> <code class="codeph">NULL</code></p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>Boolean operators in the predicate are limited to <code class="codeph">AND</code>, <code class="codeph">OR</code>, and <code class="codeph">NOT</code>.
                              </p>
                           </li>
                           <li>
                              <p>The query contains no aggregate functions (such as <code class="codeph">SUM</code>, <code class="codeph">COUNT</code>, <code class="codeph">AVERAGE</code>, <code class="codeph">MIN</code>, and <code class="codeph">MAX</code>).
                              </p>
                           </li>
                        </ul>
                        <p>Guaranteed mode supports most queries on single tables and some inner equijoins, such as:</p><pre class="oac_no_warn" dir="ltr">SELECT SALARY FROM EMPLOYEES, DEPARTMENTS
  WHERE EMPLOYEES.DEPARTMENT_ID = DEPARTMENTS.DEPARTMENT_ID
    AND DEPARTMENTS.LOCATION_ID = 1700;</pre><div class="infoboxnote" id="GUID-15F66C86-D79B-408F-977C-9BB614C3D91E__GUID-A6E98C15-EECD-4F88-8A0C-98F76092DE07">
                           <p class="notep1">Note:</p>
                           <p></p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Sometimes the query optimizer uses an execution plan that makes a query incompatible for guaranteed mode (for example, <code class="codeph">OR</code>-expansion).
                                 </p>
                              </li>
                              <li>
                                 <p>Queries that can be registered in guaranteed mode can also be registered in best-effort mode, but results might differ, because best-effort mode can cause false positives even for queries that CQN does not simplify.</p>
                              </li>
                           </ul>
                        </div>
                        <div class="infoboxnotealso" id="GUID-15F66C86-D79B-408F-977C-9BB614C3D91E__NOTE-126-CAD69DC6">
                           <p class="notep1">See Also:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=SQLRF20035" target="_blank"><span class="italic">Oracle Database SQL Language Reference</span></a> for a list of SQL aggregate functions
                                 </p>
                              </li>
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=TGSQL193" target="_blank"><span class="italic">Oracle Database SQL Tuning Guide</span></a> for information about the query optimizer
                                 </p>
                              </li>
                              <li>
                                 <p><a href="cqn.html#GUID-0766B418-4023-4BB7-8887-25AE98CBD351" title="Some types of queries are so simplified that invalidations are generated at object level; that is, whenever any object referenced in those queries changes. Examples of such queries are those that use unsupported column types or include subqueries. The solution to this problem is to rewrite the original queries.">Best-Effort Mode</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="ADFNS574"></a><div class="props_rev_3"><a id="GUID-12872C24-0535-4EA9-B9DF-E2FE9FEC8908" name="GUID-12872C24-0535-4EA9-B9DF-E2FE9FEC8908"></a><h5 id="ADFNS-GUID-12872C24-0535-4EA9-B9DF-E2FE9FEC8908" class="sect5">Queries that Can Be Registered for QRCN Only in Best-Effort Mode</h5>
                     <div>
                        <p>A query that does any of the following can be registered for QRCN only in best-effort mode, and its simplified version generates notifications at object granularity:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Refers to columns that have encryption enabled</p>
                           </li>
                           <li>
                              <p>Has more than 10 items of the same type in the <code class="codeph">SELECT</code> list
                              </p>
                           </li>
                           <li>
                              <p>Has expressions that include any of these:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>String functions (such as <code class="codeph">SUBSTR</code>, <code class="codeph">LTRIM</code>, and <code class="codeph">RTRIM</code>)
                                    </p>
                                 </li>
                                 <li>
                                    <p>Arithmetic functions (such as <code class="codeph">TRUNC</code>, <code class="codeph">ABS</code>, and <code class="codeph">SQRT</code>)
                                    </p>
                                 </li>
                                 <li>
                                    <p>Pattern-matching conditions <code class="codeph">LIKE</code> and <code class="codeph">REGEXP_LIKE</code></p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">EXISTS</code> or <code class="codeph">NOT</code> <code class="codeph">EXISTS</code> condition
                                    </p>
                                 </li>
                              </ul>
                           </li>
                        </ul>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Has disjunctions involving predicates defined on columns from different tables. For example:</p><pre class="oac_no_warn" dir="ltr">SELECT EMPLOYEE_ID, DEPARTMENT_ID
  FROM EMPLOYEES, DEPARTMENTS
    WHERE EMPLOYEES.EMPLOYEE_ID = 10
      OR DEPARTMENTS.DEPARTMENT_ID = 'IT';
</pre></li>
                           <li>
                              <p>Has user rowid access. For example:</p><pre class="oac_no_warn" dir="ltr">SELECT DEPARTMENT_ID
  FROM DEPARTMENTS
    WHERE ROWID = 'AAANkdAABAAALinAAF';
</pre></li>
                           <li>
                              <p>Has any join other than an inner join</p>
                           </li>
                           <li>
                              <p>Has an execution plan that involves any of these:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>Bitmap join, domain, or function-based indexes</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">UNION</code> <code class="codeph">ALL</code> or <code class="codeph">CONCATENATION</code></p>
                                    <p>(Either in the query itself, or as the result of an <code class="codeph">OR</code>-expansion execution plan chosen by the query optimizer.)
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">ORDER</code> <code class="codeph">BY</code> or <code class="codeph">GROUP</code> <code class="codeph">BY</code></p>
                                    <p>(Either in the query itself, or as the result of a <code class="codeph">SORT</code> operation with an <code class="codeph">ORDER</code> <code class="codeph">BY</code> option in the execution plan chosen by the query optimizer.)
                                    </p>
                                 </li>
                                 <li>
                                    <p>Partitioned index-organized table (IOT) with overflow segment</p>
                                 </li>
                                 <li>
                                    <p>Clustered objects</p>
                                 </li>
                                 <li>
                                    <p>Parallel execution</p>
                                 </li>
                              </ul>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-12872C24-0535-4EA9-B9DF-E2FE9FEC8908__NOTE-124-CAD6FA93">
                           <p class="notep1">See Also:</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=SQLRF006" target="_blank"><span class="italic">Oracle Database SQL Language Reference</span></a> for a list of SQL functions
                           </p>
                        </div><pre class="pre codeblock"><code></code></pre></div>
                  </div><a id="ADFNS575"></a><div class="props_rev_3"><a id="GUID-77B34385-509E-434C-9E78-C793A22AD0A8" name="GUID-77B34385-509E-434C-9E78-C793A22AD0A8"></a><h5 id="ADFNS-GUID-77B34385-509E-434C-9E78-C793A22AD0A8" class="sect5">Queries that Cannot Be Registered for QRCN in Either Mode</h5>
                     <div>
                        <p>A query that refers to any of the following cannot be registered for QRCN in either guaranteed or best-effort mode:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Views</p>
                           </li>
                           <li>
                              <p>Tables that are fixed, remote, or have Virtual Private Database (VPD) policies enabled</p>
                           </li>
                           <li>
                              <p><code class="codeph">DUAL</code> (in the <code class="codeph">SELECT</code> list)
                              </p>
                           </li>
                           <li>
                              <p>Synonyms</p>
                           </li>
                           <li>
                              <p>Calls to user-defined PL/SQL subprograms</p>
                           </li>
                           <li>
                              <p>Operators not listed in <a href="cqn.html#GUID-15F66C86-D79B-408F-977C-9BB614C3D91E">Queries that Can Be Registered for QRCN in Guaranteed Mode</a></p>
                           </li>
                           <li>
                              <p>The aggregate function <code class="codeph">COUNT</code></p>
                              <p>(Other aggregate functions are allowed in best-effort mode, but not in guaranteed mode.)</p>
                           </li>
                           <li>
                              <p>Application contexts; for example:</p><pre class="oac_no_warn" dir="ltr">SELECT SALARY FROM EMPLOYEES
WHERE USER = SYS_CONTEXT('USERENV', 'SESSION_USER');
</pre></li>
                           <li>
                              <p><code class="codeph">SYSDATE</code>, <code class="codeph">SYSTIMESTAMP</code>, or <code class="codeph">CURRENT</code> <code class="codeph">TIMESTAMP</code></p>
                           </li>
                        </ul>
                        <p>Also, a query that the query optimizer has rewritten using a materialized view cannot be registered for QRCN.</p>
                        <div class="infoboxnotealso" id="GUID-77B34385-509E-434C-9E78-C793A22AD0A8__NOTE-124-CAD8825C">
                           <p class="notep1">See Also:</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=TGSQL193" target="_blank"><span class="italic">Oracle Database SQL Tuning Guide</span></a> for information about the query optimizer
                           </p>
                        </div>
                     </div>
                  </div>
               </div><a id="ADFNS1065"></a><a id="ADFNS576"></a><div class="props_rev_3"><a id="GUID-52D0C42D-EA7E-4282-A14B-BA42E11D9A6D" name="GUID-52D0C42D-EA7E-4282-A14B-BA42E11D9A6D"></a><h4 id="ADFNS-GUID-52D0C42D-EA7E-4282-A14B-BA42E11D9A6D" class="sect4">Using PL/SQL to Register Queries for CQN</h4>
                  <div>
                     <div class="section">
                        <p>To use PL/SQL to create a CQN registration, follow these steps:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Create a stored PL/SQL procedure to serve as the notification handler.</span><div>See <a href="cqn.html#GUID-FB04F169-2CC0-4059-9B47-1D852C131A05">Creating a PL/SQL Notification Handler</a>.
                           </div>
                        </li>
                        <li class="stepexpand"><span>Create a <code class="codeph">CQ_NOTIFICATION$_REG_INFO</code> object that specifies the name of the notification handler, the notification type, and other attributes of the registration.</span><div>See <a href="cqn.html#GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B">Creating a CQ_NOTIFICATION$_REG_INFO Object</a>.
                           </div>
                        </li>
                        <li class="stepexpand"><span>In your client application, use the <code class="codeph">DBMS_CQ_NOTIFICATION</code>.<code class="codeph">NEW_REG_START</code> function to open a registration block.</span><div>
                              <p>See <span class="italic">Oracle Database PL/SQL Packages and Types Reference</span> for more information about the <code class="codeph">CQ_NOTIFICATION$_REG_INFO</code> object and the functions <code class="codeph">NEW_REG_START</code> and <code class="codeph">REG_END</code>, all of which are defined in the <code class="codeph">DBMS_CQ_NOTIFICATION</code> package.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Run the queries to register. (Do not run DML or DDL operations.)</span><div>See the following topics for more information:
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><a href="cqn.html#GUID-55D2DA06-65E0-4FB7-A765-477688840831">Identifying Individual Queries in a Notification</a></p>
                                 </li>
                                 <li>
                                    <p><a href="cqn.html#GUID-7CBB4F5D-30F5-406C-8D5E-1E030B72E718">Adding Queries to an Existing Registration</a></p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Close the registration block, using the <code class="codeph">DBMS_CQ_NOTIFICATION</code>.<code class="codeph">REG_END</code> function.</span></li>
                     </ol>
                  </div><a id="ADFNS577"></a><div class="props_rev_3"><a id="GUID-FB04F169-2CC0-4059-9B47-1D852C131A05" name="GUID-FB04F169-2CC0-4059-9B47-1D852C131A05"></a><h5 id="ADFNS-GUID-FB04F169-2CC0-4059-9B47-1D852C131A05" class="sect5">Creating a PL/SQL Notification Handler</h5>
                     <div>
                        <div class="section">
                           <p>The PL/SQL stored procedure that you create to serve as the notification handler must have this signature:</p><pre class="oac_no_warn" dir="ltr">PROCEDURE <span class="italic">schema_name.proc_name</span>(<span class="italic">ntfnds</span> IN CQ_NOTIFICATION$_DESCRIPTOR)
</pre><p>In the preceding signature, <span class="italic"><code class="codeph">schema_name</code></span> is the name of the database schema, <span class="italic"><code class="codeph">proc_name</code></span> is the name of the stored procedure, and <span class="italic"><code class="codeph">ntfnds</code></span> is the notification descriptor.
                           </p>
                           <p>The notification descriptor is a <code class="codeph">CQ_NOTIFICATION$_DESCRIPTOR</code> object, whose attributes describe the details of the change (transaction ID, type of change, queries affected, tables modified, and so on).
                           </p>
                           <p>The <code class="codeph">JOBQ</code> process passes the notification descriptor, <span class="italic"><code class="codeph">ntfnds</code></span>, to the notification handler, <span class="italic"><code class="codeph">proc_name</code></span>, which handles the notification according to its application requirements. (This is step <a href="cqn.html#GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778__CHDCABFC">6</a> in <a href="cqn.html#GUID-98FB4276-0827-4A50-9506-E5C1CA0B7778__CHECFHCH">Figure 18-2</a>.)
                           </p>
                           <div class="infoboxnote" id="GUID-FB04F169-2CC0-4059-9B47-1D852C131A05__GUID-5CABB28C-D0F6-4D29-B781-662FE2948D24">
                              <p class="notep1">Note:</p>
                              <p>The notification handler runs inside a job queue process. The<code class="codeph">JOB_QUEUE_PROCESSES</code> initialization parameter specifies the maximum number of processes that can be created for the execution of jobs. You must set<code class="codeph">JOB_QUEUE_PROCESSES</code> to a nonzero value to receive PL/SQL notifications.
                              </p>
                           </div>
                           <div class="infoboxnotealso" id="GUID-FB04F169-2CC0-4059-9B47-1D852C131A05__NOTE-1217-CAD95645">
                              <p class="notep1">See Also:</p>
                              <p><code class="codeph"><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=REFRN10077" target="_blank">JOB_QUEUE_PROCESSES</a></code></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="ADFNS579"></a><a id="ADFNS580"></a><a id="ADFNS581"></a><a id="ADFNS578"></a><div class="props_rev_3"><a id="GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B" name="GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B"></a><h5 id="ADFNS-GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B" class="sect5">Creating a CQ_NOTIFICATION$_REG_INFO Object</h5>
                     <div>
                        <div class="section">
                           <p>An object of type <code class="codeph">CQ_NOTIFICATION$_REG_INFO</code> specifies the notification handler that the database runs when a registered objects changes. In SQL*Plus, you can view its type attributes by running this statement:
                           </p><pre class="oac_no_warn" dir="ltr">DESC CQ_NOTIFICATION$_REG_INFO
</pre><p><a href="cqn.html#GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B__CHEEDHCG" title="This table summarizes the attributes of the SYS.CHNF$_REG_INFO_OC4J datatype.">Table 18-2</a> describes the attributes of <code class="codeph">SYS</code>.<code class="codeph">CQ_NOTIFICATION$_REG_INFO</code>.
                           </p>
                           <div class="tblformal" id="GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B__CHEEDHCG">
                              <p class="titleintable">Table 18-2 Attributes of CQ_NOTIFICATION$_REG_INFO</p>
                              <table cellpadding="4" cellspacing="0" class="Formal" title="Attributes of CQ_NOTIFICATION$_REG_INFO" summary="This table summarizes the attributes of the SYS.CHNF$_REG_INFO_OC4J datatype." width="100%" frame="hsides" border="1" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="38%" id="d102353e5559">Attribute</th>
                                       <th align="left" valign="bottom" width="62%" id="d102353e5562">Description</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d102353e5567" headers="d102353e5559 ">
                                          <p><code class="codeph">CALLBACK</code></p>
                                       </td>
                                       <td align="left" valign="top" width="62%" headers="d102353e5567 d102353e5562 ">
                                          <p>Specifies the name of the PL/SQL procedure to be executed when a notification is generated (a notification handler). You must specify the name in the form <span class="italic"><code class="codeph">schema_name</code></span>.<span class="italic"><code class="codeph">procedure_name</code></span>, for example, <code class="codeph">hr</code>.<code class="codeph">dcn_callback</code>.
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d102353e5589" headers="d102353e5559 ">
                                          <p><code class="codeph">QOSFLAGS</code></p>
                                       </td>
                                       <td align="left" valign="top" width="62%" headers="d102353e5589 d102353e5562 ">
                                          <p>Specifies one or more quality-of-service flags, which are constants in the <code class="codeph">DBMS_CQ_NOTIFICATION</code> package. For their names and descriptions, see <a href="cqn.html#GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B__g4923183" title="This table summarizes the quality-of-service flags.">Table 18-3</a>.
                                          </p>
                                          <p>To specify multiple quality-of-service flags, use bitwise <code class="codeph">OR</code>. For example: <code class="codeph">DBMS_CQ_NOTIFICATION.QOS_RELIABLE + DBMS_CQ_NOTIFICATION.QOS_ROWIDS</code></p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d102353e5612" headers="d102353e5559 ">
                                          <p><code class="codeph">TIMEOUT</code></p>
                                       </td>
                                       <td align="left" valign="top" width="62%" headers="d102353e5612 d102353e5562 ">
                                          <p>Specifies the timeout period for registrations. If set to a nonzero value, it specifies the time in seconds after which the database purges the registration. If <code class="codeph">0</code> or <code class="codeph">NULL</code>, then the registration persists until the client explicitly deregisters it.
                                          </p>
                                          <p>Can be combined with the <code class="codeph">QOSFLAGS</code> attribute with its <code class="codeph">QOS_DEREG_NFY</code> flag.
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d102353e5634" headers="d102353e5559 ">
                                          <p><code class="codeph">OPERATIONS_FILTER</code></p>
                                       </td>
                                       <td align="left" valign="top" width="62%" headers="d102353e5634 d102353e5562 ">
                                          <p>Applies only to OCN (described in <a href="cqn.html#GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4">About Object Change Notification (OCN)</a>). Has no effect if you specify the <code class="codeph">QOS_FLAGS</code> attribute with its <code class="codeph">QOS_QUERY</code> flag.
                                          </p>
                                          <p>Filters messages based on types of SQL statement. You can specify these constants in the <code class="codeph">DBMS_CQ_NOTIFICATION</code> package:
                                          </p>
                                          <ul style="list-style-type: disc;">
                                             <li>
                                                <p><code class="codeph">ALL_OPERATIONS</code> notifies on all changes
                                                </p>
                                             </li>
                                             <li>
                                                <p><code class="codeph">INSERTOP</code> notifies on inserts
                                                </p>
                                             </li>
                                             <li>
                                                <p><code class="codeph">UPDATEOP</code> notifies on updates
                                                </p>
                                             </li>
                                             <li>
                                                <p><code class="codeph">DELETEOP</code> notifies on deletes
                                                </p>
                                             </li>
                                             <li>
                                                <p><code class="codeph">ALTEROP</code> notifies on <code class="codeph">ALTER</code> <code class="codeph">TABLE</code> operations
                                                </p>
                                             </li>
                                             <li>
                                                <p><code class="codeph">DROPOP</code> notifies on <code class="codeph">DROP</code> <code class="codeph">TABLE</code> operations
                                                </p>
                                             </li>
                                             <li>
                                                <p><code class="codeph">UNKNOWNOP</code> notifies on unknown operations
                                                </p>
                                             </li>
                                          </ul>
                                          <p>You can specify a combination of operations with a bitwise <code class="codeph">OR</code>. For example: <code class="codeph">DBMS_CQ_NOTIFICATION.INSERTOP</code> + <code class="codeph">DBMS_CQ_NOTIFICATION.DELETEOP</code>.
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d102353e5716" headers="d102353e5559 ">
                                          <p><code class="codeph">TRANSACTION_LAG</code></p>
                                       </td>
                                       <td align="left" valign="top" width="62%" headers="d102353e5716 d102353e5562 ">
                                          <p><span class="bold">Deprecated</span>. To implement flow-of-control notifications, use the <code class="codeph">NTFN_GROUPING_*</code> attributes.
                                          </p>
                                          <p>Applies only to OCN (described in <a href="cqn.html#GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4">About Object Change Notification (OCN)</a>). Has no effect if you specify the <code class="codeph">QOS_FLAGS</code> attribute with its <code class="codeph">QOS_QUERY</code> flag.
                                          </p>
                                          <p>Specifies the number of transactions or database changes by which the client can lag behind the database. If 0, then the client receives an invalidation message as soon as it is generated. If 5, then every fifth transaction that changes a registered object results in a notification. The database tracks intervening changes at an object granularity and bundles the changes along with the notification. Thus, the client does not lose intervening changes.</p>
                                          <p>Most applications that must be notified of changes to an object on transaction commit without further deferral are expected to chose 0 transaction lag. A nonzero transaction lag is useful only if an application implements flow control on notifications. When using nonzero transaction lag, Oracle recommends that the application workload has the property that notifications are generated at a reasonable frequency. Otherwise, notifications might be deferred indefinitely till the lag is satisfied.</p>
                                          <p>If you specify <code class="codeph">TRANSACTION_LAG</code>, then the <code class="codeph">ROWID</code> level granularity is unavailable in the notification messages even if you specified <code class="codeph">QOS_ROWIDS</code> during registration.
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d102353e5756" headers="d102353e5559 ">
                                          <p><code class="codeph">NTFN_GROUPING_CLASS</code></p>
                                       </td>
                                       <td align="left" valign="top" width="62%" headers="d102353e5756 d102353e5562 ">
                                          <p>Specifies the class by which to group notifications. The only allowed value is <code class="codeph">DBMS_CQ_NOTIFICATION</code>.<code class="codeph">NTFN_GROUPING_CLASS_TIME</code>, which groups notifications by time.
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d102353e5770" headers="d102353e5559 ">
                                          <p><code class="codeph">NTFN_GROUPING_VALUE</code></p>
                                       </td>
                                       <td align="left" valign="top" width="62%" headers="d102353e5770 d102353e5562 ">
                                          <p>Specifies the time interval that defines the group, in seconds. For example, if this value is 900, notifications generated in the same 15-minute interval are grouped.</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d102353e5778" headers="d102353e5559 ">
                                          <p><code class="codeph">NTFN_GROUPING_TYPE</code></p>
                                       </td>
                                       <td align="left" valign="top" width="62%" headers="d102353e5778 d102353e5562 ">
                                          <p>Specifies either of these types of grouping:</p>
                                          <ul style="list-style-type: disc;">
                                             <li>
                                                <p><code class="codeph">DBMS_CQ_NOTIFICATION</code>.<code class="codeph">NTFN_GROUPING_TYPE_SUMMARY</code>: All notifications in the group are summarized into a single notification.
                                                </p>
                                             </li>
                                             <li>
                                                <p><code class="codeph">DBMS_CQ_NOTIFICATION</code>.<code class="codeph">NTFN_GROUPING_TYPE_LAST</code>: Only the last notification in the group is published and the earlier ones discarded.
                                                </p>
                                             </li>
                                          </ul>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d102353e5803" headers="d102353e5559 ">
                                          <p><code class="codeph">NTFN_GROUPING_START_TIME</code></p>
                                       </td>
                                       <td align="left" valign="top" width="62%" headers="d102353e5803 d102353e5562 ">
                                          <p>Specifies when to start generating notifications. If specified as <code class="codeph">NULL</code>, it defaults to the current system-generated time.
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="38%" id="d102353e5814" headers="d102353e5559 ">
                                          <p><code class="codeph">NTFN_GROUPING_REPEAT_COUNT</code></p>
                                       </td>
                                       <td align="left" valign="top" width="62%" headers="d102353e5814 d102353e5562 ">
                                          <p>Specifies how many times to repeat the notification. Set to <code class="codeph">DBMS_CQ_NOTIFICATION</code>.<code class="codeph">NTFN_GROUPING_FOREVER</code> to receive notifications for the life of the registration. To receive at most <span class="italic">n</span> notifications during the life of the registration, set to <span class="italic">n</span>.
                                          </p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <p>The quality-of-service flags in <a href="cqn.html#GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B__g4923183" title="This table summarizes the quality-of-service flags.">Table 18-3</a> are constants in the <code class="codeph">DBMS_CQ_NOTIFICATION</code> package. You can specify them with the <code class="codeph">QOS_FLAGS</code> attribute of <code class="codeph">CQ_NOTIFICATION$_REG_INFO</code> (see <a href="cqn.html#GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B__CHEEDHCG" title="This table summarizes the attributes of the SYS.CHNF$_REG_INFO_OC4J datatype.">Table 18-2</a>).
                           </p>
                           <div class="tblformal" id="GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B__g4923183">
                              <p class="titleintable">Table 18-3 Quality-of-Service Flags</p>
                              <table cellpadding="4" cellspacing="0" class="Formal" title="Quality-of-Service Flags" summary="This table summarizes the quality-of-service flags." width="100%" frame="hsides" border="1" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="23%" id="d102353e5864">Flag</th>
                                       <th align="left" valign="bottom" width="77%" id="d102353e5867">Description</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="23%" id="d102353e5872" headers="d102353e5864 ">
                                          <p><code class="codeph">QOS_DEREG_NFY</code></p>
                                       </td>
                                       <td align="left" valign="top" width="77%" headers="d102353e5872 d102353e5867 ">
                                          <p>Purges the registration after the first notification.</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="23%" id="d102353e5880" headers="d102353e5864 ">
                                          <p><code class="codeph">QOS_RELIABLE</code></p>
                                       </td>
                                       <td align="left" valign="top" width="77%" headers="d102353e5880 d102353e5867 ">
                                          <p>Stores notifications in a persistent database queue.</p>
                                          <p>In an Oracle RAC environment, if a database instance fails, surviving database instances can deliver any queued notification messages.</p>
                                          <p><span class="bold">Default:</span> Notifications are stored in shared memory, which performs more efficiently.
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="23%" id="d102353e5894" headers="d102353e5864 ">
                                          <p><code class="codeph">QOS_ROWIDS</code></p>
                                       </td>
                                       <td align="left" valign="top" width="77%" headers="d102353e5894 d102353e5867 ">
                                          <p>Includes the <code class="codeph">ROWID</code> of each changed row in the notification.
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="23%" id="d102353e5905" headers="d102353e5864 ">
                                          <p><code class="codeph">QOS_QUERY</code></p>
                                       </td>
                                       <td align="left" valign="top" width="77%" headers="d102353e5905 d102353e5867 ">
                                          <p>Registers queries for QRCN, described in <a href="cqn.html#GUID-2E64E453-ADBE-4DFA-94C0-39A0AA4081E9" title="Some types of queries are so simplified that invalidations are generated at object level; that is, whenever any object referenced in those queries changes. Examples of such queries are those that use unsupported column types or include subqueries. The solution to this problem is to rewrite the original queries.">About Query Result Change Notification (QRCN)</a>.
                                          </p>
                                          <p>If a query cannot be registered for QRCN, an error is generated at registration time, unless you also specify <code class="codeph">QOS_BEST_EFFORT</code>.
                                          </p>
                                          <p><span class="bold">Default:</span> Queries are registered for OCN, described in <a href="cqn.html#GUID-C3EDF7E8-A478-42DB-8DA3-1AFDD9DA4CC4">About Object Change Notification (OCN)</a></p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="23%" id="d102353e5932" headers="d102353e5864 ">
                                          <p><code class="codeph">QOS_BEST_EFFORT</code></p>
                                       </td>
                                       <td align="left" valign="top" width="77%" headers="d102353e5932 d102353e5867 ">
                                          <p>Used with <code class="codeph">QOS_QUERY</code>. Registers simplified versions of queries that are too complex for query result change evaluation; in other words, registers queries for QRCN in best-effort mode, described in <a href="cqn.html#GUID-0766B418-4023-4BB7-8887-25AE98CBD351" title="Some types of queries are so simplified that invalidations are generated at object level; that is, whenever any object referenced in those queries changes. Examples of such queries are those that use unsupported column types or include subqueries. The solution to this problem is to rewrite the original queries.">Best-Effort Mode</a>.
                                          </p>
                                          <p>To see which queries were simplified, query the static data dictionary view <code class="codeph">DBA_CQ_NOTIFICATION_QUERIES</code> or <code class="codeph">USER_CQ_NOTIFICATION_QUERIES</code>. These views give the <code class="codeph">QUERYID</code> and the text of each registered query.
                                          </p>
                                          <p><span class="bold">Default:</span> Queries are registered for QRCN in guaranteed mode, described in <a href="cqn.html#GUID-4A320315-AF7F-4D60-BB63-AD9731D3640D">Guaranteed Mode</a></p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <p>Suppose that you must invoke the procedure <code class="codeph">HR</code>.<code class="codeph">dcn_callback</code> whenever a registered object changes. In <a href="cqn.html#GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B__BGBFBHFD">Example 18-4</a>, you create a <code class="codeph">CQ_NOTIFICATION$_REG_INFO</code> object that specifies that <code class="codeph">HR</code>.<code class="codeph">dcn_callback</code> receives notifications. To create the object you must have <code class="codeph">EXECUTE</code> privileges on the <code class="codeph">DBMS_CQ_NOTIFICATION</code> package.
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-05EB875B-7ED8-4C06-B862-D339FEC3571B__BGBFBHFD">
                           <p class="titleinexample">Example 18-4 Creating a CQ_NOTIFICATION$_REG_INFO Object</p><pre class="oac_no_warn" dir="ltr">DECLARE
  v_cn_addr CQ_NOTIFICATION$_REG_INFO;

BEGIN
  -- Create object:

  v_cn_addr := CQ_NOTIFICATION$_REG_INFO (
    'HR.dcn_callback',                 -- PL/SQL notification handler
    DBMS_CQ_NOTIFICATION.QOS_QUERY     -- notification type QRCN
    + DBMS_CQ_NOTIFICATION.QOS_ROWIDS, -- include rowids of changed objects
    0,                          -- registration persists until unregistered
    0,                          -- notify on all operations
    0                           -- notify immediately
    );

  -- Register queries: ...
END;
/</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="ADFNS582"></a><div class="props_rev_3"><a id="GUID-55D2DA06-65E0-4FB7-A765-477688840831" name="GUID-55D2DA06-65E0-4FB7-A765-477688840831"></a><h5 id="ADFNS-GUID-55D2DA06-65E0-4FB7-A765-477688840831" class="sect5">Identifying Individual Queries in a Notification</h5>
                     <div>
                        <div class="section">
                           <p>Any query in a registered list of queries can cause a continuous query notification. To know when a certain query causes a notification, use the <code class="codeph">DBMS_CQ_NOTIFICATION</code>.<code class="codeph">CQ_NOTIFICATION_QUERYID</code> function in the <code class="codeph">SELECT</code> list of that query. For example:
                           </p><pre class="oac_no_warn" dir="ltr">SELECT EMPLOYEE_ID, SALARY, <span class="bold">DBMS_CQ_NOTIFICATION.CQ_NOTIFICATION_QUERYID</span>
FROM EMPLOYEES
WHERE DEPARTMENT_ID = 10;
</pre><p>Result:</p><pre class="oac_no_warn" dir="ltr">EMPLOYEE_ID     SALARY <span class="bold">CQ_NOTIFICATION_QUERYID</span>
----------- ---------- -----------------------
        200       2800                       <span class="bold">0</span>
 
1 row selected.
</pre><p>When that query causes a notification, the notification includes the query ID.</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="ADFNS584"></a><a id="ADFNS583"></a><div class="props_rev_3"><a id="GUID-7CBB4F5D-30F5-406C-8D5E-1E030B72E718" name="GUID-7CBB4F5D-30F5-406C-8D5E-1E030B72E718"></a><h5 id="ADFNS-GUID-7CBB4F5D-30F5-406C-8D5E-1E030B72E718" class="sect5">Adding Queries to an Existing Registration</h5>
                     <div>
                        <div class="section">
                           <p>To add queries to an existing registration, follow these steps:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Retrieve the registration ID of the existing registration.</span><div>
                                 <p>You can retrieve it from either saved output or a query of <code class="codeph">*_CHANGE_NOTIFICATION_REGS</code>.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Open the existing registration by calling the procedure <code class="codeph">DBMS_CQ_NOTIFICATION</code>.<code class="codeph">ENABLE_REG</code> with the registration ID as the parameter.</span></li>
                           <li class="stepexpand"><span>Run the queries to register. (Do not run DML or DDL operations.)</span></li>
                           <li class="stepexpand"><span>Close the registration, using the <code class="codeph">DBMS_CQ_NOTIFICATION</code>.<code class="codeph">REG_END</code> function.</span><div>
                                 <p><a href="cqn.html#GUID-7CBB4F5D-30F5-406C-8D5E-1E030B72E718__BGBDIIBJ">Example 18-5</a> adds a query to an existing registration whose registration ID is 21.
                                 </p>
                              </div>
                           </li>
                        </ol>
                        <div class="example" id="GUID-7CBB4F5D-30F5-406C-8D5E-1E030B72E718__BGBDIIBJ">
                           <p class="titleinexample">Example 18-5 Adding a Query to an Existing Registration</p><pre class="oac_no_warn" dir="ltr">DECLARE
  v_cursor SYS_REFCURSOR;

BEGIN
  <span class="bold">-- Open existing registration</span>
  DBMS_CQ_NOTIFICATION.ENABLE_REG(21);
  OPEN v_cursor FOR
    <span class="bold">-- Run query to be registered</span>
    SELECT DEPARTMENT_ID
      FROM HR.DEPARTMENTS;  -- register this query
  CLOSE v_cursor;
  <span class="bold">-- Close registration</span>
  DBMS_CQ_NOTIFICATION.REG_END;
END;
/</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div><a id="ADFNS1303"></a><div class="props_rev_3"><a id="GUID-069991BE-E98B-4733-BEB7-D4AE96D0DB87" name="GUID-069991BE-E98B-4733-BEB7-D4AE96D0DB87"></a><h4 id="ADFNS-GUID-069991BE-E98B-4733-BEB7-D4AE96D0DB87" class="sect4">Best Practices for CQN Registrations</h4>
                  <div>
                     <p>For best CQN performance, follow these registration guidelines:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Register few queries—preferably those that reference objects that rarely change.</p>
                           <p>Extremely volatile registered objects cause numerous notifications, whose overhead slows OLTP throughput.</p>
                        </li>
                        <li>
                           <p>Minimize the number of duplicate registrations of any given object, to avoid replicating a notification message for multiple recipients.</p>
                        </li>
                     </ul>
                  </div>
               </div><a id="ADFNS1020"></a><div class="props_rev_3"><a id="GUID-FC45C32A-D57E-4925-A88B-97FAE4AD528D" name="GUID-FC45C32A-D57E-4925-A88B-97FAE4AD528D"></a><h4 id="ADFNS-GUID-FC45C32A-D57E-4925-A88B-97FAE4AD528D" class="sect4">Troubleshooting CQN Registrations</h4>
                  <div>
                     <div class="section">
                        <p>If you are unable to create a registration, or if you have created a registration but are not receiving the notifications that you expected, the problem might be one of these:</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>The <code class="codeph">JOB_QUEUE_PROCESSES</code> parameter is not set to a nonzero value.
                              </p>
                              <p>This prevents you from receiving PL/SQL notifications through the notification handler.</p>
                           </li>
                           <li>
                              <p>You were connected as a SYS user when you created the registrations.</p>
                              <p>You must be connected as a non-SYS user to create CQN registrations.</p>
                           </li>
                           <li>
                              <p>You changed a registered object, but did not commit the transaction.</p>
                              <p>Notifications are generated only when the transaction commits.</p>
                           </li>
                           <li>
                              <p>The registrations were not successfully created in the database.</p>
                              <p>To check, query the static data dictionary view <code class="codeph">*_CHANGE_NOTIFICATION_REGS</code>. For example, this statement displays all registrations and registered objects for the current user:
                              </p><pre class="oac_no_warn" dir="ltr">SELECT REGID, TABLE_NAME FROM USER_CHANGE_NOTIFICATION_REGS;
</pre></li>
                           <li>
                              <p>Runtime errors occurred during the execution of the notification handler.</p>
                              <p>If so, they were logged to the trace file of the <code class="codeph">JOBQ</code> process that tried to run the procedure. The name of the trace file usually has this form:
                              </p><pre class="oac_no_warn" dir="ltr"><span class="italic">ORACLE_SID</span>_j<span class="italic">number</span>_<span class="italic">PID</span>.trc
</pre><p>For example, if the ORACLE_SID is <code class="codeph">dbs1</code> and the process ID (PID) of the <code class="codeph">JOBQ</code> process is 12483, the name of the trace file is usually <code class="codeph">dbs1_j000_12483</code>.<code class="codeph">trc</code>.
                              </p>
                              <p>Suppose that a registration is created with <code class="codeph">'chnf_callback</code>' as the notification handler and registration ID 100. Suppose that <code class="codeph">'chnf_callback</code>' was not defined in the database. Then the <code class="codeph">JOBQ</code> trace file might contain a message of the form:
                              </p><pre class="oac_no_warn" dir="ltr">****************************************************************************
   Runtime error during execution of PL/SQL cbk <span class="bold">chnf_callback</span> for reg CHNF<span class="bold">100</span>.
   Error in PLSQL notification of msgid:
   Queue :
   Consumer Name :
   PLSQL function :<span class="bold">chnf_callback</span>
   Exception Occured, Error msg:
   ORA-00604: error occurred at recursive SQL level 2
   ORA-06550: line 1, column 7: 
   <span class="bold">PLS-00201: identifier 'CHNF_CALLBACK' must be declared</span>
   ORA-06550: line 1, column 7:
   PL/SQL: Statement ignored
****************************************************************************
</pre><p>If runtime errors occurred during the execution of the notification handler, create a very simple version of the notification handler to verify that you are receiving notifications, and then gradually add application logic.</p>
                              <p>An example of a very simple notification handler is:</p><pre class="oac_no_warn" dir="ltr">REM Create table in HR schema to hold count of notifications received.
CREATE TABLE nfcount(cnt NUMBER);
INSERT INTO nfcount (cnt) VALUES(0);
COMMIT;
CREATE OR REPLACE PROCEDURE chnf_callback
  (ntfnds IN CQ_NOTIFICATION$_DESCRIPTOR)
IS
BEGIN
  UPDATE nfcount SET cnt = cnt+1;
  COMMIT;
END;
/
</pre></li>
                           <li>
                              <p>There is a time lag between the commit of a transaction and the notification received by the end user.</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS593"></a><div class="props_rev_3"><a id="GUID-ABAB71A2-F950-4F0A-B413-FD2D67F335DF" name="GUID-ABAB71A2-F950-4F0A-B413-FD2D67F335DF"></a><h4 id="ADFNS-GUID-ABAB71A2-F950-4F0A-B413-FD2D67F335DF" class="sect4">Deleting Registrations</h4>
                  <div>
                     <div class="section">
                        <p>To delete a registration, call the procedure <code class="codeph">DBMS_CQ_NOTIFICATION</code>.<code class="codeph">DEREGISTER</code> with the registration ID as the parameter. For example, this statement deregisters the registration whose registration ID is 21:
                        </p><pre class="oac_no_warn" dir="ltr">DBMS_CQ_NOTIFICATION.DEREGISTER(21);
</pre><p>Only the user who created the registration or the SYS user can deregister it.</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS1067"></a><a id="ADFNS1302"></a><div class="props_rev_3"><a id="GUID-2D194274-3C78-42F3-959C-10B9F30B2F07" name="GUID-2D194274-3C78-42F3-959C-10B9F30B2F07"></a><h4 id="ADFNS-GUID-2D194274-3C78-42F3-959C-10B9F30B2F07" class="sect4">Configuring CQN: Scenario</h4>
                  <div>
                     <div class="section">
                        <p>In this scenario, you are a developer who manages a web application that provides employee data: name, location, phone number, and so on. The application, which runs on Oracle Application Server, is heavily used and processes frequent queries of the <code class="codeph">HR</code>.<code class="codeph">EMPLOYEES</code> and <code class="codeph">HR</code>.<code class="codeph">DEPARTMENTS</code> tables in the back-end database. Because these tables change relatively infrequently, the application can improve performance by caching the query results. Caching avoids a round trip to the back-end database and server-side execution latency.
                        </p>
                        <p>You can use the <code class="codeph">DBMS_CQ_NOTIFICATION</code> package to register queries based on <code class="codeph">HR</code>.<code class="codeph">EMPLOYEES</code> and <code class="codeph">HR</code>.<code class="codeph">DEPARTMENTS</code> tables. To configure CQN, you follow these steps:
                        </p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li id="GUID-2D194274-3C78-42F3-959C-10B9F30B2F07__CHDIDAHJ"><span>Create a server-side PL/SQL stored procedure to process the notifications, as instructed in <a href="cqn.html#GUID-8B697AA3-7A7D-49E6-B5D3-127F3F9FB89C">Creating a PL/SQL Notification Handler</a>.</span></li>
                        <li id="GUID-2D194274-3C78-42F3-959C-10B9F30B2F07__CHDCGHHG"><span>Register the queries on the <code class="codeph">HR</code>.<code class="codeph">EMPLOYEES</code> and <code class="codeph">HR</code>.<code class="codeph">DEPARTMENTS</code> tables for QRCN, as instructed in <a href="cqn.html#GUID-E1B5BA1A-AE5D-4F04-9627-190586835A9D">Registering the Queries</a>.</span></li>
                     </ol>
                     <div class="section">
                        <p>After you complete these steps, any committed change to the result of a query registered in step <a href="cqn.html#GUID-2D194274-3C78-42F3-959C-10B9F30B2F07__CHDCGHHG">2</a> causes the notification handler created in step <a href="cqn.html#GUID-2D194274-3C78-42F3-959C-10B9F30B2F07__CHDIDAHJ">1</a> to notify the web application of the change, whereupon the web application refreshes the cache by querying the back-end database.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div><a id="ADFNS595"></a><a id="ADFNS594"></a><div class="props_rev_3"><a id="GUID-8B697AA3-7A7D-49E6-B5D3-127F3F9FB89C" name="GUID-8B697AA3-7A7D-49E6-B5D3-127F3F9FB89C"></a><h5 id="ADFNS-GUID-8B697AA3-7A7D-49E6-B5D3-127F3F9FB89C" class="sect5">Creating a PL/SQL Notification Handler</h5>
                     <div>
                        <div class="section">
                           <p>Create a server-side stored PL/SQL procedure to process notifications as follows:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Connect to the database <code class="codeph">AS</code> <code class="codeph">SYSDBA</code>.</span></li>
                           <li class="stepexpand"><span>Grant the required privileges to <code class="codeph">HR</code>:</span><div><pre class="oac_no_warn" dir="ltr">GRANT EXECUTE ON DBMS_CQ_NOTIFICATION TO HR;
GRANT CHANGE NOTIFICATION TO HR;
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Enable the <code class="codeph">JOB_QUEUE_PROCESSES</code> parameter to receive notifications:</span><div><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM SET "JOB_QUEUE_PROCESSES"=4;
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Connect to the database as a non-SYS user (such as <code class="codeph">HR</code>).</span></li>
                           <li class="stepexpand"><span>Create database tables to hold records of notification events received:</span><div><pre class="oac_no_warn" dir="ltr">-- Create table to record notification events.
DROP TABLE nfevents;
CREATE TABLE nfevents (
  regid      NUMBER,
  event_type NUMBER
);

-- Create table to record notification queries:
DROP TABLE nfqueries;
CREATE TABLE nfqueries (
  qid NUMBER,
  qop NUMBER
);

-- Create table to record changes to registered tables:
DROP TABLE nftablechanges;
CREATE TABLE nftablechanges (
  qid             NUMBER,
  table_name      VARCHAR2(100),
  table_operation NUMBER
);

-- Create table to record ROWIDs of changed rows:
DROP TABLE nfrowchanges;
CREATE TABLE nfrowchanges (
  qid        NUMBER,
  table_name VARCHAR2(100),
  row_id     VARCHAR2(2000)
);
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Create the procedure <code class="codeph">HR</code>.<code class="codeph">chnf_callback</code>, as shown in <a href="cqn.html#GUID-8B697AA3-7A7D-49E6-B5D3-127F3F9FB89C__CHEJCBFE">Example 18-6</a>.</span></li>
                        </ol>
                        <div class="example" id="GUID-8B697AA3-7A7D-49E6-B5D3-127F3F9FB89C__CHEJCBFE">
                           <p class="titleinexample">Example 18-6 Creating Server-Side PL/SQL Notification Handler</p><pre class="oac_no_warn" dir="ltr">CREATE OR REPLACE PROCEDURE chnf_callback (
  ntfnds IN CQ_NOTIFICATION$_DESCRIPTOR
)
IS
  regid           NUMBER;
  tbname          VARCHAR2(60);
  event_type      NUMBER;
  numtables       NUMBER;
  operation_type  NUMBER;
  numrows         NUMBER;
  row_id          VARCHAR2(2000);
  numqueries      NUMBER;
  qid             NUMBER;
  qop             NUMBER;

BEGIN
  regid := ntfnds.registration_id;
  event_type := ntfnds.event_type;

  INSERT INTO nfevents (regid, event_type)
  VALUES (chnf_callback.regid, chnf_callback.event_type);

  numqueries :=0;

  IF (event_type = DBMS_CQ_NOTIFICATION.EVENT_QUERYCHANGE) THEN
    numqueries := ntfnds.query_desc_array.count;

    FOR i IN 1..numqueries LOOP  -- loop over queries
      qid := ntfnds.query_desc_array(i).queryid;
      qop := ntfnds.query_desc_array(i).queryop;

      INSERT INTO nfqueries (qid, qop)
      VALUES(chnf_callback.qid, chnf_callback.qop);

      numtables := 0;
      numtables := ntfnds.query_desc_array(i).table_desc_array.count;

      FOR j IN 1..numtables LOOP  -- loop over tables
        tbname :=
          ntfnds.query_desc_array(i).table_desc_array(j).table_name;
        operation_type :=
          ntfnds.query_desc_array(i).table_desc_array(j).Opflags;

        INSERT INTO nftablechanges (qid, table_name, table_operation) 
        VALUES (
          chnf_callback.qid,
          tbname,
          operation_type
        );

        IF (bitand(operation_type, DBMS_CQ_NOTIFICATION.ALL_ROWS) = 0) THEN
          numrows := ntfnds.query_desc_array(i).table_desc_array(j).numrows;
        ELSE
          numrows :=0;  -- ROWID info not available
        END IF;

        -- Body of loop does not run when numrows is zero.
        FOR k IN 1..numrows LOOP  -- loop over rows
          Row_id :=
 ntfnds.query_desc_array(i).table_desc_array(j).row_desc_array(k).row_id;

          INSERT INTO nfrowchanges (qid, table_name, row_id)
          VALUES (chnf_callback.qid, tbname, chnf_callback.Row_id);

        END LOOP;  -- loop over rows
      END LOOP;  -- loop over tables
    END LOOP;  -- loop over queries
  END IF;
  COMMIT;
END;
/</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="ADFNS597"></a><a id="ADFNS596"></a><div class="props_rev_3"><a id="GUID-E1B5BA1A-AE5D-4F04-9627-190586835A9D" name="GUID-E1B5BA1A-AE5D-4F04-9627-190586835A9D"></a><h5 id="ADFNS-GUID-E1B5BA1A-AE5D-4F04-9627-190586835A9D" class="sect5">Registering the Queries</h5>
                     <div>
                        <div class="section">
                           <p>After creating the notification handler, you register the queries for which you want to receive notifications, specifying <code class="codeph">HR</code>.<code class="codeph">chnf_callback</code> as the notification handler, as in <a href="cqn.html#GUID-E1B5BA1A-AE5D-4F04-9627-190586835A9D__CHEHHFFF">Example 18-7</a>.
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-E1B5BA1A-AE5D-4F04-9627-190586835A9D__CHEHHFFF">
                           <p class="titleinexample">Example 18-7 Registering a Query</p><pre class="oac_no_warn" dir="ltr">DECLARE
  reginfo   CQ_NOTIFICATION$_REG_INFO;
  mgr_id    NUMBER;
  dept_id   NUMBER;
  v_cursor  SYS_REFCURSOR;
  regid     NUMBER;

BEGIN
  /* Register two queries for QRNC: */
  /* 1. Construct registration information.
        chnf_callback is name of notification handler.
        QOS_QUERY specifies result-set-change notifications. */

  reginfo := cq_notification$_reg_info (
    'chnf_callback',
    DBMS_CQ_NOTIFICATION.QOS_QUERY,
    0, 0, 0
  );

  /* 2. Create registration. */

  regid := DBMS_CQ_NOTIFICATION.new_reg_start(reginfo);

  OPEN v_cursor FOR
    SELECT dbms_cq_notification.CQ_NOTIFICATION_QUERYID, manager_id
    FROM HR.EMPLOYEES
    WHERE employee_id = 7902;
  CLOSE v_cursor;

  OPEN v_cursor FOR
    SELECT dbms_cq_notification.CQ_NOTIFICATION_QUERYID, department_id
    FROM HR.departments
    WHERE department_name = 'IT';
  CLOSE v_cursor;

  DBMS_CQ_NOTIFICATION.reg_end;
END;
/
</pre><p>View the newly created registration:</p><pre class="oac_no_warn" dir="ltr">SELECT queryid, regid, TO_CHAR(querytext)
FROM user_cq_notification_queries;
</pre><p>Result is similar to:</p><pre class="oac_no_warn" dir="ltr">QUERYID REGID                               TO_CHAR(QUERYTEXT)
------- ----- ------------------------------------------------
     22    41 SELECT HR.DEPARTMENTS.DEPARTMENT_ID
                FROM HR.DEPARTMENTS
                  WHERE HR.DEPARTMENTS.DEPARTMENT_NAME  = 'IT'

     21    41 SELECT HR.EMPLOYEES.MANAGER_ID
                FROM HR.EMPLOYEES
                  WHERE HR.EMPLOYEES.EMPLOYEE_ID  = 7902
</pre><p>Run this transaction, which changes the result of the query with <code class="codeph">QUERYID</code> 22:
                           </p><pre class="oac_no_warn" dir="ltr">UPDATE DEPARTMENTS
SET DEPARTMENT_NAME = 'FINANCE'
WHERE department_name = 'IT';
</pre><p>The notification procedure <code class="codeph">chnf_callback</code> (which you created in <a href="cqn.html#GUID-8B697AA3-7A7D-49E6-B5D3-127F3F9FB89C__CHEJCBFE">Example 18-6</a>) runs.
                           </p>
                           <p>Query the table in which notification events are recorded:</p><pre class="oac_no_warn" dir="ltr">SELECT * FROM nfevents;
</pre><p>Result is similar to:</p><pre class="oac_no_warn" dir="ltr">REGID EVENT_TYPE
----- ----------
   61          7
</pre><p><code class="codeph">EVENT_TYPE</code> 7 corresponds to <code class="codeph">EVENT_QUERYCHANGE</code> (query result change).
                           </p>
                           <p>Query the table in which changes to registered tables are recorded:</p><pre class="oac_no_warn" dir="ltr">SELECT * FROM nftablechanges;
</pre><p>Result is similar to:</p><pre class="oac_no_warn" dir="ltr">REGID     TABLE_NAME TABLE_OPERATION
----- -------------- ---------------
   42 HR.DEPARTMENTS               4
</pre><p><code class="codeph">TABLE_OPERATION</code> 4 corresponds to <code class="codeph">UPDATEOP</code> (update operation).
                           </p>
                           <p>Query the table in which <code class="codeph">ROWID</code>s of changed rows are recorded:
                           </p><pre class="oac_no_warn" dir="ltr">SELECT * FROM nfrowchanges;
</pre><p>Result is similar to:</p><pre class="oac_no_warn" dir="ltr">REGID     TABLE_NAME              ROWID
----- -------------- ------------------
   61 HR.DEPARTMENTS AAANkdAABAAALinAAF</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div>
            </div><a id="ADFNS681"></a><a id="ADFNS680"></a><div class="props_rev_3"><a id="GUID-0D38B15C-F5CD-44C9-B073-39DA78350D28" name="GUID-0D38B15C-F5CD-44C9-B073-39DA78350D28"></a><h3 id="ADFNS-GUID-0D38B15C-F5CD-44C9-B073-39DA78350D28" class="sect3">Using OCI to Create CQN Registrations</h3>
               <div>
                  <div class="section">
                     <p>This section describes using OCI to create CQN registrations. When you use OCI, the notification handler is a client-side C callback procedure. </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-0D38B15C-F5CD-44C9-B073-39DA78350D28__GUID-8E0BBA51-78DE-44D4-8810-423BC3943F2A">Topics</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="cqn.html#GUID-78180E2A-7011-4F32-B1C1-81923C918647">Using OCI for Query Result Set Notifications</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-497F4BB3-33B1-4231-B664-F7BFD76F2AD0">Using OCI to Register a Continuous Query Notification</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-B6BE0F08-AFB7-4D6C-B5EB-8F85C43F1CD1">Using OCI Subscription Handle Attributes for Continuous Query Notification</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-96222028-5814-44E9-A37E-89D8EE897280">OCI_ATTR_CQ_QUERYID Attribute</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-D2A55BA3-C631-43B2-811F-DAEA7C5104FC">Using OCI Continuous Query Notification Descriptors</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-8CB2CED7-C1AC-4CD7-ADC2-240D2C5B9E22">Demonstrating Continuous Query Notification in an OCI Sample Program</a></p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-0D38B15C-F5CD-44C9-B073-39DA78350D28__GUID-C03C68D8-5049-4B64-847A-287F0E9454C3">
                        <p class="notep1">See Also:</p>
                        <p><span class="italic">Oracle Call Interface Programmer's Guide</span> for more information about <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI16713" target="_blank">publish-subscribe notification in OCI</a> 
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS682"></a><div class="props_rev_3"><a id="GUID-78180E2A-7011-4F32-B1C1-81923C918647" name="GUID-78180E2A-7011-4F32-B1C1-81923C918647"></a><h4 id="ADFNS-GUID-78180E2A-7011-4F32-B1C1-81923C918647" class="sect4">Using OCI for Query Result Set Notifications</h4>
                  <div>
                     <div class="section">
                        <p>To record QOS (quality of service flags) specific to continuous query (CQ) notifications, set the attribute <code class="codeph">OCI_ATTR_SUBSCR_CQ_QOSFLAGS</code> on the subscription handle <code class="codeph">OCI_HTYPE_SUBSCR</code>. To request that the registration is at query granularity, as opposed to object granularity, set the <code class="codeph">OCI_SUBSCR_CQ_QOS_QUERY</code> flag bit on the attribute <code class="codeph">OCI_ATTR_SUBSCR_CQ_QOSFLAGS</code>.
                        </p>
                        <p>The pseudocolumn <code class="codeph">CQ_NOTIFICATION_QUERY_ID</code> can be optionally specified to retrieve the query ID of a registered query. This does not automatically convert the granularity to query level. The value of the pseudocolumn on return is set to the unique query ID assigned to the query. The query ID pseudocolumn can be omitted for OCI-based registrations, in which case the query ID is returned as a <code class="codeph">READ</code> attribute of the statement handle. (This attribute is called <code class="codeph">OCI_ATTR_CQ_QUERYID</code>).
                        </p>
                        <p>During notifications, the client-specified callback is invoked and the top-level notification descriptor is passed as an argument.</p>
                        <p>Information about the query IDs of the changed queries is conveyed through a special descriptor type called <code class="codeph">OCI_DTYPE_CQDES</code>. A collection (<code class="codeph">OCIColl</code>) of query descriptors is embedded inside the top-level notification descriptor. Each descriptor is of type <code class="codeph">OCI_DTYPE_CQDES</code>. The query descriptor has the following attributes:
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">OCI_ATTR_CQDES_OPERATION</code> - can be one of <code class="codeph">OCI_EVENT_QUERYCHANGE</code> or <code class="codeph">OCI_EVENT_DEREG</code>.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">OCI_ATTR_CQDES_QUERYID</code> - query ID of the changed query.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">OCI_ATTR_CQDES_TABLE_CHANGES</code> - array of table descriptors describing DML operations on tables that led to the query result set change. Each table descriptor is of the type <code class="codeph">OCI_DTYPE_TABLE_CHDES</code>.
                              </p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-78180E2A-7011-4F32-B1C1-81923C918647__GUID-10E4CEB2-652A-4DC0-8150-C928FE77CAF2">
                           <p class="notep1">See Also:</p>
                           <p><a href="cqn.html#GUID-635139E3-40F9-49E2-8C3C-605771FB07D6">OCI_DTYPE_CHDES</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS683"></a><div class="props_rev_3"><a id="GUID-497F4BB3-33B1-4231-B664-F7BFD76F2AD0" name="GUID-497F4BB3-33B1-4231-B664-F7BFD76F2AD0"></a><h4 id="ADFNS-GUID-497F4BB3-33B1-4231-B664-F7BFD76F2AD0" class="sect4">Using OCI to Register a Continuous Query Notification</h4>
                  <div>
                     <div class="section">
                        <p>The calling session must have the <code class="codeph">CHANGE</code> <code class="codeph">NOTIFICATION</code> system privilege and <code class="codeph">SELECT</code> privileges on all objects that it attempts to register. A registration is a persistent entity that is recorded in the database, and is visible to all instances of Oracle RAC. If the registration was at query granularity, transactions that cause the query result set to change and commit in any instance of Oracle RAC generate notification.If the registration was at object granularity, transactions that modify registered objects in any instance of Oracle RAC generate notification.
                        </p>
                        <p>Queries involving materialized views or nonmaterialized views are <span class="italic">not</span> supported.
                        </p>
                        <p>The registration interface employs a callback to respond to changes in underlying objects of a query and uses a namespace extension (<code class="codeph">DBCHANGE</code>) to AQ.
                        </p>
                        <p>The steps in writing the registration are:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Create the environment in <code class="codeph">OCI_EVENTS</code> and <code class="codeph">OCI_OBJECT</code> mode.</span></li>
                        <li class="stepexpand"><span>Set the subscription handle attribute <code class="codeph">OCI_ATTR_SUBSCR_NAMESPACE</code> to namespace <code class="codeph">OCI_SUBSCR_NAMESPACE_DBCHANGE</code>. </span></li>
                        <li class="stepexpand"><span>Set the subscription handle attribute <code class="codeph">OCI_ATTR_SUBSCR_CALLBACK</code> to store the OCI callback associated with the query handle. The callback has the following prototype:</span><div><pre class="oac_no_warn" dir="ltr">void notification_callback (void *ctx, OCISubscription *subscrhp, 
                            void *payload, ub4 paylen, void *desc, ub4 mode);
</pre><p>The parameters are described in "<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI16723" target="_blank">Notification Callback in OCI</a>" in <span class="italic">Oracle Call Interface Programmer's Guide</span>.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Optionally associate a client-specific context using <code class="codeph">OCI_ATTR_SUBSCR_CTX</code> attribute.</span></li>
                        <li class="stepexpand"><span>Set the <code class="codeph">OCI_ATTR_SUBSCR_TIMEOUT</code> attribute to specify a <code class="codeph">ub4</code> timeout interval in seconds. If it is not set, there is no timeout.</span></li>
                        <li class="stepexpand"><span>Set the <code class="codeph">OCI_ATTR_SUBSCR_QOSFLAGS</code> attribute, the QOS (quality of service) levels, with the following values:</span><div>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>The <code class="codeph">OCI_SUBSCR_QOS_PURGE_ON_NTFN</code> flag allows the registration to be purged on the first notification.
                                    </p>
                                 </li>
                                 <li>
                                    <p>The <code class="codeph">OCI_SUBSCR_QOS_RELIABLE</code> flag allows notifications to be persistent. You can use surviving instances of Oracle RAC to send and retrieve continuous query notification messages, even after a node failure, because invalidations associated with this registration are queued persistently into the database. If <code class="codeph">FALSE</code>, then invalidations are enqueued into a fast in-memory queue. This option describes the persistence of notifications and not the persistence of registrations. Registrations are automatically persistent by default.
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Call <code class="codeph">OCISubscriptionRegister()</code> to create a new registration in the <code class="codeph">DBCHANGE</code> namespace.</span></li>
                        <li class="stepexpand"><span>Associate multiple query statements with the subscription handle by setting the attribute <code class="codeph">OCI_ATTR_CHNF_REGHANDLE</code> of the statement handle, <code class="codeph">OCI_HTYPE_STMT</code>. The registration is completed when the query is executed.</span><div>
                              <div class="infoboxnotealso" id="GUID-497F4BB3-33B1-4231-B664-F7BFD76F2AD0__GUID-681C929F-35B1-4A20-96B1-9E3020C8B9A8">
                                 <p class="notep1">See Also:</p>
                                 <p><span class="italic">Oracle Call Interface Programmer's Guide</span> for more information about <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI17861" target="_blank"><code class="codeph">OCI_ATTR_CHNF_REGHANDLE</code></a></p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Optionally unregister a subscription. The client can call the OCISubscriptionRegister() function with the subscription handle as a parameter.</span></li>
                     </ol>
                     <div class="section">
                        <p>A binding of a statement handle to a subscription handle is valid only for only the first execution of a query. If the application must use the same <span>OCI statement</span> handle for subsequent executions, it must repopulate the registration handle attribute of the statement handle. A binding of a subscription handle to a statement handle is permitted only when the statement is a query (determined at execute time). If a DML statement is executed as part of the execution, then an exception is issued. 
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS685"></a><a id="ADFNS686"></a><a id="ADFNS684"></a><div class="props_rev_3"><a id="GUID-B6BE0F08-AFB7-4D6C-B5EB-8F85C43F1CD1" name="GUID-B6BE0F08-AFB7-4D6C-B5EB-8F85C43F1CD1"></a><h4 id="ADFNS-GUID-B6BE0F08-AFB7-4D6C-B5EB-8F85C43F1CD1" class="sect4">Using OCI Subscription Handle Attributes for Continuous Query Notification</h4>
                  <div>
                     <div class="section">
                        <p>The subscription handle attributes for continuous query notification can be divided into generic attributes (common to all subscriptions) and namespace-specific attributes (particular to continuous query notification).</p>
                        <p>The <code class="codeph">WRITE</code> attributes on the statement handle can be modified only before the registration is created.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-B6BE0F08-AFB7-4D6C-B5EB-8F85C43F1CD1__GUID-BB5EB6C4-02C8-49BA-89D9-01D0CDE84B38">Generic Attributes - Common to All Subscriptions</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><code class="codeph">OCI_ATTR_SUBSCR_NAMESPACE</code> (<code class="codeph">WRITE</code>) - Set this attribute to <code class="codeph">OCI_SUBSCR_NAMESPACE_DBCHANGE</code> for subscription handles.
                        </p>
                        <p><code class="codeph">OCI_ATTR_SUBSCR_CALLBACK</code> (<code class="codeph">WRITE</code>) - Use this attribute to store the callback associated with the subscription handle. The callback is executed when a notification is received.
                        </p>
                        <p>When a new continuous query notification message becomes available, the callback is invoked in the listener thread with <code class="codeph">desc</code> pointing to a descriptor of type <code class="codeph">OCI_DTYPE_CHDES</code> that contains detailed information about the invalidation.
                        </p>
                        <p><code class="codeph">OCI_ATTR_SUBSCR_QOSFLAGS</code> - This attribute is a generic flag with the following values:
                        </p><pre class="oac_no_warn" dir="ltr">#define OCI_SUBSCR_QOS_RELIABLE             0x01                 /* reliable */
#define OCI_SUBSCR_QOS_PURGE_ON_NTFN        0x10      /* purge on first ntfn */
</pre><ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">OCI_SUBSCR_QOS_RELIABLE</code> - Set this bit to allow notifications to be persistent. Therefore, you can use surviving instances of an Oracle RAC cluster to send and retrieve invalidation messages, even after a node failure, because invalidations associated with this registration ID are queued persistently into the database. If this bit is <code class="codeph">FALSE</code>, then invalidations are enqueued in to a fast in-memory queue. This option describes the persistence of notifications and not the persistence of registrations. Registrations are automatically persistent by default.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">OCI_SUBSCR_QOS_PURGE_ON_NTFN</code> - Set this bit to allow the registration to be purged on the first notification.
                              </p>
                           </li>
                        </ul>
                        <p>A parallel example is presented in <span class="italic">Oracle Call Interface Programmer's Guide</span> in <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI16715" target="_blank">publish-subscribe registration functions in OCI</a>. 
                        </p>
                        <p><code class="codeph">OCI_ATTR_SUBSCR_CQ_QOSFLAGS</code> - This attribute describes the continuous query notification-specific QOS flags (mode is <code class="codeph">WRITE</code>, data type is <code class="codeph">ub4</code>), which are:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">0x1 OCI_SUBSCR_CQ_QOS_QUERY</code> - Set this flag to indicate that query-level granularity is required. Generate notification only if the query result set changes. By default, this level of QOS has no false positives. 
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">0x2 OCI_SUBSCR_CQ_QOS_BEST_EFFORT</code> - Set this flag to indicate that best effort filtering is acceptable. It can be used by caching applications. The database can use heuristics based on cost of evaluation and avoid full pruning in some cases.
                              </p>
                           </li>
                        </ul>
                        <p><code class="codeph">OCI_ATTR_SUBSCR_TIMEOUT</code> - Use this attribute to specify a <code class="codeph">ub4</code> timeout value defined in seconds. If the timeout value is 0 or not specified, then the registration is active until explicitly unregistered.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-B6BE0F08-AFB7-4D6C-B5EB-8F85C43F1CD1__GUID-1EDD50D8-7B16-4A67-960F-11C4737FDAFC">Namespace- Specific or Feature-Specific Attributes</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>The following attributes are namespace-specific or feature-specific to the continuous query notification feature.</p>
                        <p><code class="codeph">OCI_ATTR_CHNF_TABLENAMES</code> (data type is <code class="codeph">(OCIColl *)</code>) - These attributes are provided to retrieve the list of table names that were registered. These attributes are available from the subscription handle, after the query is executed.
                        </p>
                        <p><code class="codeph">OCI_ATTR_CHNF_ROWIDS</code> - A Boolean attribute (default <code class="codeph">FALSE</code>). If <code class="codeph">TRUE</code>, then the continuous query notification message includes row-level details such as operation type and <code class="codeph">ROWID</code>.
                        </p>
                        <p><code class="codeph">OCI_ATTR_CHNF_OPERATIONS</code> - Use this <code class="codeph">ub4</code> flag to selectively filter notifications based on operation type. This option is ignored if the registration is of query-level granularity. Flags stored are:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">OCI_OPCODE_ALL</code> - All operations
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">OCI_OPCODE_INSERT</code> - Insert operations on the table
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">OCI_OPCODE_UPDATE</code> - Update operations on the table
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">OCI_OPCODE_DELETE</code> - Delete operations on the table
                              </p>
                           </li>
                        </ul>
                        <p><code class="codeph">OCI_ATTR_CHNF_CHANGELAG</code> - The client can use this <code class="codeph">ub4</code> value to specify the number of transactions by which the client is willing to lag behind. The client can also use this option as a throttling mechanism for continuous query notification messages. When you choose this option, <code class="codeph">ROWID</code>-level granularity of information is unavailable in the notifications, even if <code class="codeph">OCI_ATTR_CHNF_ROWIDS</code> was <code class="codeph">TRUE</code>. This option is ignored if the registration is of query-level granularity.
                        </p>
                        <p>After the OCISubscriptionRegister() call is invoked, none of the preceding attributes (generic, name-specific, or feature-specific) can be modified on the registration already created. Any attempt to modify those attributes is not reflected on the registration already created, but it does take effect on newly created registrations that use the same registration handle.</p>
                        <div class="infoboxnotealso" id="GUID-B6BE0F08-AFB7-4D6C-B5EB-8F85C43F1CD1__GUID-922A5AB5-75DF-49FA-9B57-823603C7CEE2">
                           <p class="notep1">See Also:</p>
                           <p><span class="italic">Oracle Call Interface Programmer's Guide</span> for more information about <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI17976" target="_blank">continuous query notification descriptor attributes</a> 
                           </p>
                        </div>
                        <p>Notifications can be spaced out by using the grouping NTFN option. The relevant generic notification attributes are:</p><pre class="oac_no_warn" dir="ltr">OCI_ATTR_SUBSCR_NTFN_GROUPING_VALUE
OCI_ATTR_SUBSCR_NTFN_GROUPING_TYPE
OCI_ATTR_SUBSCR_NTFN_GROUPING_START_TIME
OCI_ATTR_SUBSCR_NTFN_GROUPING_REPEAT_COUNT</pre><div class="infoboxnotealso" id="GUID-B6BE0F08-AFB7-4D6C-B5EB-8F85C43F1CD1__GUID-F78C54FB-1BA6-43F1-8B07-94CDFEBFD250">
                           <p class="notep1">See Also:</p>
                           <p><span class="italic">Oracle Call Interface Programmer's Guide</span> for more details about these attributes in <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI16716" target="_blank">publish-subscribe register directly to the database</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS687"></a><div class="props_rev_3"><a id="GUID-96222028-5814-44E9-A37E-89D8EE897280" name="GUID-96222028-5814-44E9-A37E-89D8EE897280"></a><h4 id="ADFNS-GUID-96222028-5814-44E9-A37E-89D8EE897280" class="sect4">OCI_ATTR_CQ_QUERYID Attribute</h4>
                  <div>
                     <p>The attribute <code class="codeph">OCI_ATTR_CQ_QUERYID</code> on the statement handle, <code class="codeph">OCI_HTYPE_STMT</code>, obtains the query ID of a registered query after registration is made by the call to <code class="codeph">OCIStmtExecute()</code>.
                     </p>
                     <div class="infoboxnotealso" id="GUID-96222028-5814-44E9-A37E-89D8EE897280__GUID-FAF76643-8202-405E-B63F-CD9400A33FB9">
                        <p class="notep1">See Also:</p>
                        <p><span class="italic">Oracle Call Interface Programmer's Guide</span> for more information about <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI17862" target="_blank"><code class="codeph">OCI_ATTR_CQ_QUERYID</code></a> 
                        </p>
                     </div>
                  </div>
               </div><a id="ADFNS688"></a><div class="props_rev_3"><a id="GUID-D2A55BA3-C631-43B2-811F-DAEA7C5104FC" name="GUID-D2A55BA3-C631-43B2-811F-DAEA7C5104FC"></a><h4 id="ADFNS-GUID-D2A55BA3-C631-43B2-811F-DAEA7C5104FC" class="sect4">Using OCI Continuous Query Notification Descriptors</h4>
                  <div>
                     <div class="section">
                        <p>The continuous query notification descriptor is passed into the <code class="codeph">desc</code> parameter of the notification callback specified by the application. The following attributes are specific to continuous query notification. The OCI type constant of the continuous query notification descriptor is <code class="codeph">OCI_DTYPE_CHDES</code>. 
                        </p>
                        <p>The notification callback receives the top-level notification descriptor, <code class="codeph">OCI_DTYPE_CHDES</code>, as an argument. This descriptor in turn includes either a collection of <code class="codeph">OCI_DTYPE_CQDES</code> or <code class="codeph">OCI_DTYPE_TABLE_CHDES</code> descriptors based on whether the event type was <code class="codeph">OCI_EVENT_QUERYCHANGE</code> or <code class="codeph">OCI_EVENT_OBJCHANGE</code>. An array of table continuous query descriptors is embedded inside the continuous query descriptor for notifications of type <code class="codeph">OCI_EVENT_QUERYCHANGE</code>. If <code class="codeph">ROWID</code> level granularity of information was requested, each <code class="codeph">OCI_DTYPE_TABLE_CHDES</code> contains an array of row-level continuous query descriptors (<code class="codeph">OCI_DTYPE_ROW_CHDES</code>) corresponding to each modified <code class="codeph">ROWID</code>.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div><a id="ADFNS689"></a><div class="props_rev_3"><a id="GUID-635139E3-40F9-49E2-8C3C-605771FB07D6" name="GUID-635139E3-40F9-49E2-8C3C-605771FB07D6"></a><h5 id="ADFNS-GUID-635139E3-40F9-49E2-8C3C-605771FB07D6" class="sect5">OCI_DTYPE_CHDES</h5>
                     <div>
                        <div class="section">
                           <p>This is the top-level continuous query notification descriptor type.</p>
                           <p><code class="codeph">OCI_ATTR_CHDES_DBNAME</code> (<code class="codeph">oratext *</code>) - Name of the database (source of the continuous query notification)
                           </p>
                           <p><code class="codeph">OCI_ATTR_CHDES_XID</code> (<code class="codeph">RAW(8)</code>) - Message ID of the message
                           </p>
                           <p><code class="codeph">OCI_ATTR_CHDES_NFYTYPE</code> - Flags describing the notification type:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">0x0 OCI_EVENT_NONE</code> - No further information about the continuous query notification
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">0x1 OCI_EVENT_STARTUP</code> - Instance startup
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">0x2 OCI_EVENT_SHUTDOWN</code> - Instance shutdown
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">0x3 OCI_EVENT_SHUTDOWN_ANY</code> - Any instance shutdown - Oracle Real Application Clusters (Oracle RAC)
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">0x5 OCI_EVENT_DEREG</code> - Unregistered or timed out
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">0x6 OCI_EVENT_OBJCHANGE</code> - Object change notification
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">0x7 OCI_EVENT_QUERYCHANGE</code> - Query change notification
                                 </p>
                              </li>
                           </ul>
                           <p><code class="codeph">OCI_ATTR_CHDES_TABLE_CHANGES</code> - A collection type describing operations on tables of data type <code class="codeph">(OCIColl *)</code>. This attribute is present only if the <code class="codeph">OCI_ATTR_CHDES_NFTYPE</code> attribute was of type <code class="codeph">OCI_EVENT_OBJCHANGE</code>; otherwise, it is <code class="codeph">NULL</code>. Each element of the collection is a table of continuous query descriptors of type <code class="codeph">OCI_DTYPE_TABLE_CHDES</code>.
                           </p>
                           <p><code class="codeph">OCI_ATTR_CHDES_QUERIES</code> - A collection type describing the queries that were invalidated. Each member of the collection is of type <code class="codeph">OCI_DTYPE_CQDES</code>. This attribute is present only if the attribute <code class="codeph">OCI_ATTR_CHDES_NFTYPE</code> was of type <code class="codeph">OCI_EVENT_QUERYCHANGE</code>; otherwise, it is <code class="codeph">NULL</code>.
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div><a id="ADFNS690"></a><div class="props_rev_3"><a id="GUID-7C68A757-480C-44CB-9B57-A28363517F58" name="GUID-7C68A757-480C-44CB-9B57-A28363517F58"></a><h6 id="ADFNS-GUID-7C68A757-480C-44CB-9B57-A28363517F58" class="sect6">OCI_DTYPE_CQDES</h6>
                        <div>
                           <div class="section">
                              <p>This notification descriptor describes a query that was invalidated, usually in response to the commit of a DML or a DDL transaction. It has the following attributes:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><code class="codeph">OCI_ATTR_CQDES_OPERATION</code> (<code class="codeph">ub4</code>, <code class="codeph">READ</code>) - Operation that occurred on the query. It can be one of these values:
                                    </p>
                                    <ul style="list-style-type: disc;">
                                       <li>
                                          <p><code class="codeph">OCI_EVENT_QUERYCHANGE</code> - Query result set change
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">OCI_EVENT_DEREG</code> - Query unregistered
                                          </p>
                                       </li>
                                    </ul>
                                 </li>
                                 <li>
                                    <p><code class="codeph">OCI_ATTR_CQDES_TABLE_CHANGES</code> (<code class="codeph">OCIColl *</code>, <code class="codeph">READ</code>) - A collection of table continuous query descriptors describing DML or DDL operations on tables that caused the query result set change. Each element of the collection is of type <code class="codeph">OCI_DTYPE_TABLE_CHDES</code>. 
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">OCI_ATTR_CQDES_QUERYID</code> (<code class="codeph">ub8</code>, <code class="codeph">READ</code>) - Query ID of the query that was invalidated.
                                    </p>
                                 </li>
                              </ul>
                           </div>
                           <!-- class="section" -->
                        </div>
                     </div><a id="ADFNS691"></a><div class="props_rev_3"><a id="GUID-8F812E36-BF73-43F3-A8F6-DF7FBCD0CCF2" name="GUID-8F812E36-BF73-43F3-A8F6-DF7FBCD0CCF2"></a><h6 id="ADFNS-GUID-8F812E36-BF73-43F3-A8F6-DF7FBCD0CCF2" class="sect6">OCI_DTYPE_TABLE_CHDES</h6>
                        <div>
                           <div class="section">
                              <p>This notification descriptor conveys information about changes to a table involved in a registered query. It has the following attributes:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><code class="codeph">OCI_ATTR_CHDES_TABLE_NAME</code> <code class="codeph">(oratext *)</code> - Schema annotated table name.
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">OCI_ATTR_CHDES_TABLE_OPFLAGS</code> (<code class="codeph">ub4</code>) - Flag field describing the operations on the table. Each of the following flag fields is in a separate bit position in the attribute:
                                    </p>
                                    <ul style="list-style-type: disc;">
                                       <li>
                                          <p><code class="codeph">0x1 OCI_OPCODE_ALLROWS</code> - The table is completely invalidated.
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">0x2 OCI_OPCODE_INSERT</code> - Insert operations on the table.
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">0x4 OCI_OPCODE_UPDATE</code> - Update operations on the table.
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">0x8 OCI_OPCODE_DELETE</code> - Delete operations on the table.
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">0x10 OCI_OPCODE_ALTER</code> - Table altered (schema change). This includes DDL statements and internal operations that cause row migration.
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">0x20 OCI_OPCODE_DROP</code> - Table dropped.
                                          </p>
                                       </li>
                                    </ul>
                                 </li>
                                 <li>
                                    <p><code class="codeph">OCI_ATTR_CHDES_TABLE_ROW_CHANGES</code> - This is an embedded collection describing the changes to the rows within the table. Each element of the collection is a row continuous query descriptor of type <code class="codeph">OCI_DTYPE_ROW_CHDES</code> that has the following attributes:
                                    </p>
                                    <ul style="list-style-type: disc;">
                                       <li>
                                          <p><code class="codeph">OCI_ATTR_CHDES_ROW_ROWID</code> (<code class="codeph">OraText *</code>) - String representation of a <code class="codeph">ROWID</code>.
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">OCI_ATTR_CHDES_ROW_OPFLAGS</code> - Reflects the operation type: <code class="codeph">INSERT</code>, <code class="codeph">UPDATE</code>, <code class="codeph">DELETE</code>, or <code class="codeph">OTHER</code>.
                                          </p>
                                       </li>
                                    </ul>
                                 </li>
                              </ul>
                              <div class="infoboxnotealso" id="GUID-8F812E36-BF73-43F3-A8F6-DF7FBCD0CCF2__GUID-000DA2C4-C34B-4AC2-9143-3DDE7E788331">
                                 <p class="notep1">See Also:</p>
                                 <p><span class="italic">Oracle Call Interface Programmer's Guide</span> for more information about <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNOCI17976" target="_blank">continuous query notification descriptor attributes</a> 
                                 </p>
                              </div>
                           </div>
                           <!-- class="section" -->
                        </div>
                     </div>
                  </div>
               </div><a id="ADFNS693"></a><a id="ADFNS692"></a><div class="props_rev_3"><a id="GUID-8CB2CED7-C1AC-4CD7-ADC2-240D2C5B9E22" name="GUID-8CB2CED7-C1AC-4CD7-ADC2-240D2C5B9E22"></a><h4 id="ADFNS-GUID-8CB2CED7-C1AC-4CD7-ADC2-240D2C5B9E22" class="sect4">Demonstrating Continuous Query Notification in an OCI Sample Program</h4>
                  <div>
                     <div class="section">
                        <p><a href="cqn.html#GUID-8CB2CED7-C1AC-4CD7-ADC2-240D2C5B9E22__BAJHEGDB">Example 18-8</a> is a simple OCI program, <code class="codeph">demoquery.c</code>. See the comments in the listing. The calling session must have the <code class="codeph">CHANGE</code> <code class="codeph">NOTIFICATION</code> system privilege and <code class="codeph">SELECT</code> privileges on all objects that it attempts to register.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-8CB2CED7-C1AC-4CD7-ADC2-240D2C5B9E22__BAJHEGDB">
                        <p class="titleinexample">Example 18-8 Program Listing That Demonstrates Continuous Query Notification</p><pre class="oac_no_warn" dir="ltr">/* Copyright (c) 2010, Oracle. All rights reserved.  */
 
#ifndef S_ORACLE
# include &lt;oratypes.h&gt;
#endif
 
/**************************************************************************
 *This is a DEMO program. To test, compile the file to generate the executable
 *demoquery. Then demoquery can be invoked from a command prompt.
 *It will have the following output:
 
Initializing OCI Process
Registering query : select last_name, employees.department_id, department_name 
                     from employees, departments 
                     where employee_id = 200 
                     and employees.department_id = departments.department_id
Query Id 23
Waiting for Notifications

*Then from another session, log in as HR/<span class="italic">&lt;password&gt;</span> and perform the following
* DML transactions. It will cause two notifications to be generated.
 
update departments set department_name ='Global Admin' where department_id=10;
commit;
update departments set department_name ='Administration' where department_id=10;
commit;

*The demoquery program will now show the following output corresponding
*to the notifications received.
 
 
Query 23 is changed
Table changed is HR.DEPARTMENTS table_op 4
Row changed is AAAMBoAABAAAKX2AAA row_op 4
Query 23 is changed
Table changed is HR.DEPARTMENTS table_op 4
Row changed is AAAMBoAABAAAKX2AAA row_op 4
 
 
*The demo program waits for exactly 10 notifications to be received before
*logging off and unregistering the subscription.
 
***************************************************************************/
 
/*---------------------------------------------------------------------------
                     PRIVATE TYPES AND CONSTANTS
  ---------------------------------------------------------------------------*/

/*---------------------------------------------------------------------------
                     STATIC FUNCTION DECLARATIONS 
  ---------------------------------------------------------------------------*/
 
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;oci.h&gt;
 
#define MAXSTRLENGTH 1024
#define bit(a,b) ((a)&amp;(b))
 
static int notifications_processed = 0;
static OCISubscription *subhandle1 = (OCISubscription *)0;
static OCISubscription *subhandle2 = (OCISubscription *)0;
static void checker(/*_ OCIError *errhp, sword status _*/);
static void registerQuery(/*_ OCISvcCtx *svchp, OCIError *errhp, OCIStmt *stmthp,
                           OCIEnv *envhp _*/);
static void myCallback (/*_  dvoid *ctx, OCISubscription *subscrhp, 
                        dvoid *payload, ub4 *payl, dvoid *descriptor, 
                        ub4 mode _*/);
static int NotificationDriver(/*_ int argc, char *argv[]  _*/);
static sword status;
static boolean logged_on = FALSE;
static void processRowChanges(OCIEnv *envhp, OCIError *errhp, OCIStmt *stmthp, 
                               OCIColl *row_changes);
static void processTableChanges(OCIEnv *envhp, OCIError *errhp,
                 OCIStmt *stmthp, OCIColl *table_changes);
static void processQueryChanges(OCIEnv *envhp, OCIError *errhp, OCIStmt *stmthp,
                 OCIColl *query_changes);
static int nonractests2(/*_ int argc, char *argv[] _*/);
 
 
int main(int argc, char **argv)
{
 
  NotificationDriver(argc, argv);
  return 0;
}
 
 
int NotificationDriver(argc, argv)
int argc;
char *argv[];
{
  OCIEnv *envhp;
  OCISvcCtx *svchp, *svchp2;
  OCIError *errhp, *errhp2;
  OCISession *authp, *authp2;
  OCIStmt *stmthp, *stmthp2;
  OCIDuration dur, dur2;
  int i;
  dvoid *tmp;
  OCISession *usrhp;
  OCIServer *srvhp;
 
  printf("Initializing OCI Process\n");
/* Initialize the environment. The environment must be initialized
     with OCI_EVENTS and OCI_OBJECT to create a continuous query notification
     registration and receive notifications.
  */
  OCIEnvCreate( (OCIEnv **) &amp;envhp, OCI_EVENTS|OCI_OBJECT, (dvoid *)0,
                    (dvoid * (*)(dvoid *, size_t)) 0,
                    (dvoid * (*)(dvoid *, dvoid *, size_t))0,
                    (void (*)(dvoid *, dvoid *)) 0,
                    (size_t) 0, (dvoid **) 0 );
 
  OCIHandleAlloc( (dvoid *) envhp, (dvoid **) &amp;errhp, OCI_HTYPE_ERROR,
                         (size_t) 0, (dvoid **) 0);
   /* server contexts */
  OCIHandleAlloc((dvoid *) envhp, (dvoid **) &amp;srvhp, OCI_HTYPE_SERVER, 
                 (size_t) 0, (dvoid **) 0);
  OCIHandleAlloc((dvoid *) envhp, (dvoid **) &amp;svchp, OCI_HTYPE_SVCCTX,
                 (size_t) 0, (dvoid **) 0);
   checker(errhp,OCIServerAttach(srvhp, errhp, (text *) 0, (sb4) 0, 
                                 (ub4) OCI_DEFAULT));
  /* set attribute server context in the service context */
  OCIAttrSet( (dvoid *) svchp, (ub4) OCI_HTYPE_SVCCTX, (dvoid *)srvhp,
              (ub4) 0, (ub4) OCI_ATTR_SERVER, (OCIError *) errhp);
 
   /* allocate a user context handle */
  OCIHandleAlloc((dvoid *)envhp, (dvoid **)&amp;usrhp, (ub4) OCI_HTYPE_SESSION,
                               (size_t) 0, (dvoid **) 0);
 
  OCIAttrSet((dvoid *)usrhp, (ub4)OCI_HTYPE_SESSION,
             (dvoid *)((text *)"HR"), (ub4)strlen((char *)"HR"), 
              OCI_ATTR_USERNAME, errhp);
 
 OCIAttrSet((dvoid *)usrhp, (ub4)OCI_HTYPE_SESSION,
            (dvoid *)((text *)"HR"), (ub4)strlen((char *)"HR"),  
             OCI_ATTR_PASSWORD, errhp);
   checker(errhp,OCISessionBegin (svchp, errhp, usrhp, OCI_CRED_RDBMS,
           OCI_DEFAULT));
   /* Allocate a statement handle */
  OCIHandleAlloc( (dvoid *) envhp, (dvoid **) &amp;stmthp,
                                (ub4) OCI_HTYPE_STMT, 52, (dvoid **) &amp;tmp);
 
  OCIAttrSet((dvoid *)svchp, (ub4)OCI_HTYPE_SVCCTX, (dvoid *)usrhp, (ub4)0,
                       OCI_ATTR_SESSION, errhp);
 
  registerQuery(svchp, errhp, stmthp, envhp);
  printf("Waiting for Notifications\n");
  while (notifications_processed !=10)
  {
    sleep(1);
  }
  printf ("Going to unregister HR\n");
  fflush(stdout);
  /* Unregister HR */
  checker(errhp,
           OCISubscriptionUnRegister(svchp, subhandle1, errhp, OCI_DEFAULT));
  checker(errhp, OCISessionEnd(svchp, errhp, usrhp, (ub4) 0));
   printf("HR Logged off.\n");
 
  if (subhandle1)
     OCIHandleFree((dvoid *)subhandle1, OCI_HTYPE_SUBSCRIPTION);
  if (stmthp)
     OCIHandleFree((dvoid *)stmthp, OCI_HTYPE_STMT);
  if (srvhp)
     OCIHandleFree((dvoid *) srvhp, (ub4) OCI_HTYPE_SERVER);
  if (svchp)
     OCIHandleFree((dvoid *) svchp, (ub4) OCI_HTYPE_SVCCTX);
  if (authp)
     OCIHandleFree((dvoid *) usrhp, (ub4) OCI_HTYPE_SESSION);
  if (errhp)
     OCIHandleFree((dvoid *) errhp, (ub4) OCI_HTYPE_ERROR);
  if (envhp)
     OCIHandleFree((dvoid *) envhp, (ub4) OCI_HTYPE_ENV);
 
 
  return 0;
 
}
 
void checker(errhp, status)
OCIError *errhp;
sword status;
{
  text errbuf[512];
  sb4 errcode = 0;
  int retval = 1;
 
  switch (status)
  {
  case OCI_SUCCESS:
    retval = 0;
    break;
  case OCI_SUCCESS_WITH_INFO:
    (void) printf("Error - OCI_SUCCESS_WITH_INFO\n");
    break;
 case OCI_NEED_DATA:
    (void) printf("Error - OCI_NEED_DATA\n");
    break;
  case OCI_NO_DATA:
    (void) printf("Error - OCI_NODATA\n");
    break;
  case OCI_ERROR:
    (void) OCIErrorGet((dvoid *)errhp, (ub4) 1, (text *) NULL, &amp;errcode,
                        errbuf, (ub4) sizeof(errbuf), OCI_HTYPE_ERROR);
    (void) printf("Error - %.*s\n", 512, errbuf);
    break;
  case OCI_INVALID_HANDLE:
    (void) printf("Error - OCI_INVALID_HANDLE\n");
    break;
  case OCI_STILL_EXECUTING:
    (void) printf("Error - OCI_STILL_EXECUTE\n");
    break; 
  case OCI_CONTINUE:
    (void) printf("Error - OCI_CONTINUE\n");
    break; 
  default:
    break;
 }
  if (retval)
  {
    exit(1);
  }
}
 
 
void processRowChanges(OCIEnv *envhp, OCIError *errhp, OCIStmt *stmthp,
                         OCIColl *row_changes)
{
  dvoid **row_descp;
  dvoid *row_desc;
  boolean exist; 
  ub2 i, j;
  dvoid *elemind = (dvoid *)0;
  oratext *row_id;
  ub4 row_op;
 
 
   sb4 num_rows;
   if (!row_changes) return;
    checker(errhp, OCICollSize(envhp, errhp,
                    (CONST OCIColl *) row_changes, &amp;num_rows));
    for (i=0; i&lt;num_rows; i++)
    {
      checker(errhp, OCICollGetElem(envhp,
                     errhp, (OCIColl *) row_changes,
                     i, &amp;exist, &amp;row_descp, &amp;elemind));
 
      row_desc = *row_descp;
      checker(errhp, OCIAttrGet (row_desc, 
                  OCI_DTYPE_ROW_CHDES, (dvoid *)&amp;row_id,
                  NULL, OCI_ATTR_CHDES_ROW_ROWID, errhp));
      checker(errhp, OCIAttrGet (row_desc, 
                  OCI_DTYPE_ROW_CHDES, (dvoid *)&amp;row_op, 
                  NULL, OCI_ATTR_CHDES_ROW_OPFLAGS, errhp));
 
      printf ("Row changed is %s row_op %d\n", row_id, row_op);
      fflush(stdout); 
    }  
}
 
void processTableChanges(OCIEnv *envhp, OCIError *errhp, OCIStmt *stmthp,
                         OCIColl *table_changes)
{
  dvoid **table_descp;
  dvoid *table_desc;
  dvoid **row_descp;
  dvoid *row_desc;
  OCIColl *row_changes = (OCIColl *)0;
  boolean exist; 
  ub2 i, j;
  dvoid *elemind = (dvoid *)0;
  oratext *table_name;
  ub4 table_op;
 
 
   sb4 num_tables;
   if (!table_changes) return;
    checker(errhp, OCICollSize(envhp, errhp,
                    (CONST OCIColl *) table_changes, &amp;num_tables));
    for (i=0; i&lt;num_tables; i++)
    {
      checker(errhp, OCICollGetElem(envhp,
                     errhp, (OCIColl *) table_changes,
                     i, &amp;exist, &amp;table_descp, &amp;elemind));
 
      table_desc = *table_descp;
      checker(errhp, OCIAttrGet (table_desc, 
                  OCI_DTYPE_TABLE_CHDES, (dvoid *)&amp;table_name,
                  NULL, OCI_ATTR_CHDES_TABLE_NAME, errhp));
      checker(errhp, OCIAttrGet (table_desc, 
                  OCI_DTYPE_TABLE_CHDES, (dvoid *)&amp;table_op, 
                  NULL, OCI_ATTR_CHDES_TABLE_OPFLAGS, errhp));
      checker(errhp, OCIAttrGet (table_desc, 
                  OCI_DTYPE_TABLE_CHDES, (dvoid *)&amp;row_changes, 
                  NULL, OCI_ATTR_CHDES_TABLE_ROW_CHANGES, errhp));
 
      printf ("Table changed is %s table_op %d\n", table_name,table_op);
      fflush(stdout); 
     if (!bit(table_op, OCI_OPCODE_ALLROWS))
       processRowChanges(envhp, errhp, stmthp, row_changes);
    }  
}
 
void processQueryChanges(OCIEnv *envhp, OCIError *errhp, OCIStmt *stmthp,
                         OCIColl *query_changes)
{
  sb4 num_queries;
  ub8 queryid;
  OCINumber qidnum;
  ub4 queryop;
  dvoid *elemind = (dvoid *)0;
  dvoid *query_desc;
  dvoid **query_descp;
  ub2 i;
  boolean exist;
  OCIColl *table_changes = (OCIColl *)0;
  
  if (!query_changes) return;
  checker(errhp, OCICollSize(envhp, errhp,
                     (CONST OCIColl *) query_changes, &amp;num_queries));
  for (i=0; i &lt; num_queries; i++)
  {
    checker(errhp, OCICollGetElem(envhp,
                     errhp, (OCIColl *) query_changes,
                     i, &amp;exist, &amp;query_descp, &amp;elemind));
 
    query_desc = *query_descp;
    checker(errhp, OCIAttrGet (query_desc,
                  OCI_DTYPE_CQDES, (dvoid *)&amp;queryid,
                  NULL, OCI_ATTR_CQDES_QUERYID, errhp));
    checker(errhp, OCIAttrGet (query_desc,
                  OCI_DTYPE_CQDES, (dvoid *)&amp;queryop,
                  NULL, OCI_ATTR_CQDES_OPERATION, errhp));
    printf(" Query %d is changed\n", queryid);
    if (queryop == OCI_EVENT_DEREG)
      printf("Query Deregistered\n");
      checker(errhp, OCIAttrGet (query_desc,
                  OCI_DTYPE_CQDES, (dvoid *)&amp;table_changes,
                  NULL, OCI_ATTR_CQDES_TABLE_CHANGES, errhp));
      processTableChanges(envhp, errhp, stmthp, table_changes);
 
 
   }
}
 
   
void myCallback (ctx, subscrhp, payload, payl, descriptor, mode)
dvoid *ctx;
OCISubscription *subscrhp;
dvoid *payload;
ub4 *payl; 
dvoid *descriptor;
ub4 mode;
{
  OCIColl *table_changes = (OCIColl *)0;
  OCIColl *row_changes = (OCIColl *)0;
  dvoid *change_descriptor = descriptor;
  ub4 notify_type;
  ub2 i, j;
  OCIEnv *envhp;
  OCIError *errhp;
  OCIColl *query_changes = (OCIColl *)0;
  OCIServer *srvhp;
  OCISvcCtx *svchp;
  OCISession *usrhp;
  dvoid     *tmp; 
  OCIStmt *stmthp;
 
 (void)OCIEnvInit( (OCIEnv **) &amp;envhp, OCI_DEFAULT, (size_t)0, (dvoid **)0 );
  
  (void) OCIHandleAlloc( (dvoid *) envhp, (dvoid **) &amp;errhp, OCI_HTYPE_ERROR,
                   (size_t) 0, (dvoid **) 0);
   /* server contexts */
  (void) OCIHandleAlloc( (dvoid *) envhp, (dvoid **) &amp;srvhp, OCI_HTYPE_SERVER,
                   (size_t) 0, (dvoid **) 0);
 
  (void) OCIHandleAlloc( (dvoid *) envhp, (dvoid **) &amp;svchp, OCI_HTYPE_SVCCTX,
                   (size_t) 0, (dvoid **) 0);
 
  OCIAttrGet (change_descriptor, OCI_DTYPE_CHDES, (dvoid *) &amp;notify_type,
              NULL, OCI_ATTR_CHDES_NFYTYPE, errhp);
  fflush(stdout);
  if (notify_type == OCI_EVENT_SHUTDOWN ||
      notify_type == OCI_EVENT_SHUTDOWN_ANY)
  {
     printf("SHUTDOWN NOTIFICATION RECEIVED\n");
     fflush(stdout);
     notifications_processed++;
     return;
  }
 if (notify_type == OCI_EVENT_STARTUP)
  {
     printf("STARTUP NOTIFICATION RECEIVED\n");
     fflush(stdout);
     notifications_processed++; 
     return;
  }
  
  notifications_processed++;
  checker(errhp, OCIServerAttach( srvhp, errhp, (text *) 0, (sb4) 0,
                                  (ub4) OCI_DEFAULT));
 
  OCIHandleAlloc( (dvoid *) envhp, (dvoid **) &amp;svchp, (ub4) OCI_HTYPE_SVCCTX,
                  52, (dvoid **) &amp;tmp);
  /* set attribute server context in the service context */
  OCIAttrSet( (dvoid *) svchp, (ub4) OCI_HTYPE_SVCCTX, (dvoid *)srvhp,
              (ub4) 0, (ub4) OCI_ATTR_SERVER, (OCIError *) errhp);
 
  /* allocate a user context handle */
  OCIHandleAlloc((dvoid *)envhp, (dvoid **)&amp;usrhp, (ub4) OCI_HTYPE_SESSION,
           (size_t) 0, (dvoid **) 0);
 
  OCIAttrSet((dvoid *)usrhp, (ub4)OCI_HTYPE_SESSION,
           (dvoid *)"HR", (ub4)strlen("HR"), OCI_ATTR_USERNAME, errhp);
 
  OCIAttrSet((dvoid *)usrhp, (ub4)OCI_HTYPE_SESSION,
           (dvoid *)"HR", (ub4)strlen("HR"),
           OCI_ATTR_PASSWORD, errhp);
 
  checker(errhp, OCISessionBegin (svchp, errhp, usrhp, OCI_CRED_RDBMS,
                                   OCI_DEFAULT));
 
  OCIAttrSet((dvoid *)svchp, (ub4)OCI_HTYPE_SVCCTX,
           (dvoid *)usrhp, (ub4)0, OCI_ATTR_SESSION, errhp);
 
  /* Allocate a statement handle */
  OCIHandleAlloc( (dvoid *) envhp, (dvoid **) &amp;stmthp,
                  (ub4) OCI_HTYPE_STMT, 52, (dvoid **) &amp;tmp);
 
  if (notify_type == OCI_EVENT_OBJCHANGE)
  {
    checker(errhp, OCIAttrGet (change_descriptor,
                OCI_DTYPE_CHDES, &amp;table_changes, NULL,
                OCI_ATTR_CHDES_TABLE_CHANGES, errhp));
    processTableChanges(envhp, errhp, stmthp, table_changes);
  }
  else if (notify_type == OCI_EVENT_QUERYCHANGE)
  {
     checker(errhp, OCIAttrGet (change_descriptor,
                OCI_DTYPE_CHDES, &amp;query_changes, NULL,
                OCI_ATTR_CHDES_QUERIES, errhp));
      processQueryChanges(envhp, errhp, stmthp, query_changes);
  }
   checker(errhp, OCISessionEnd(svchp, errhp, usrhp, OCI_DEFAULT));
  checker(errhp, OCIServerDetach(srvhp, errhp, OCI_DEFAULT));
 if (stmthp)
    OCIHandleFree((dvoid *)stmthp, OCI_HTYPE_STMT);
  if (errhp)
    OCIHandleFree((dvoid *)errhp, OCI_HTYPE_ERROR);
  if (srvhp)
    OCIHandleFree((dvoid *)srvhp, OCI_HTYPE_SERVER);
  if (svchp)
    OCIHandleFree((dvoid *)svchp, OCI_HTYPE_SVCCTX);
  if (usrhp)
    OCIHandleFree((dvoid *)usrhp, OCI_HTYPE_SESSION);
  if (envhp)
    OCIHandleFree((dvoid *)envhp, OCI_HTYPE_ENV);
 
}
 
void registerQuery(svchp, errhp, stmthp, envhp)
OCISvcCtx *svchp; 
OCIError *errhp; 
OCIStmt *stmthp;
OCIEnv *envhp;
{
  OCISubscription *subscrhp;
  ub4 namespace = OCI_SUBSCR_NAMESPACE_DBCHANGE;
  ub4 timeout = 60;
  OCIDefine *defnp1 = (OCIDefine *)0;
  OCIDefine *defnp2 = (OCIDefine *)0;
  OCIDefine *defnp3 = (OCIDefine *)0;
  OCIDefine *defnp4 = (OCIDefine *)0;
  OCIDefine *defnp5 = (OCIDefine *)0;
  int mgr_id =0;
text query_text1[] = "select last_name, employees.department_id, department_name \
 from employees,departments where employee_id = 200 and employees.department_id =\
  departments.department_id";
 
  ub4 num_prefetch_rows = 0;
  ub4 num_reg_tables;
  OCIColl *table_names;
  ub2 i;
  boolean rowids = TRUE;
  ub4 qosflags = OCI_SUBSCR_CQ_QOS_QUERY  ;
  int empno=0;
  OCINumber qidnum;
  ub8 qid;
  char outstr[MAXSTRLENGTH], dname[MAXSTRLENGTH];
  int q3out;
 
    fflush(stdout);
  /* allocate subscription handle */
  OCIHandleAlloc ((dvoid *) envhp, (dvoid **) &amp;subscrhp,
                  OCI_HTYPE_SUBSCRIPTION, (size_t) 0, (dvoid **) 0);
  
  /* set the namespace to DBCHANGE */
  checker(errhp, OCIAttrSet (subscrhp, OCI_HTYPE_SUBSCRIPTION,
                  (dvoid *) &amp;namespace, sizeof(ub4),
                  OCI_ATTR_SUBSCR_NAMESPACE, errhp));
  
  /* Associate a notification callback with the subscription */
  checker(errhp, OCIAttrSet (subscrhp, OCI_HTYPE_SUBSCRIPTION,
                  (void *)myCallback, 0, OCI_ATTR_SUBSCR_CALLBACK, errhp));
 /* Allow extraction of rowid information */
  checker(errhp, OCIAttrSet (subscrhp, OCI_HTYPE_SUBSCRIPTION,
                  (dvoid *)&amp;rowids, sizeof(ub4), 
                  OCI_ATTR_CHNF_ROWIDS, errhp));
   
     checker(errhp, OCIAttrSet (subscrhp, OCI_HTYPE_SUBSCRIPTION,
                  (dvoid *)&amp;qosflags, sizeof(ub4),
                  OCI_ATTR_SUBSCR_CQ_QOSFLAGS, errhp));
 
  /* Create a new registration in the DBCHANGE namespace */
  checker(errhp,
           OCISubscriptionRegister(svchp, &amp;subscrhp, 1, errhp, OCI_DEFAULT));
 
  /* Multiple queries can now be associated with the subscription */
 
    subhandle1 = subscrhp;
 
 
    printf("Registering query : %s\n", (const signed char *)query_text1);
    /* Prepare the statement */
    checker(errhp, OCIStmtPrepare (stmthp, errhp, query_text1, 
            (ub4)strlen((const signed char *)query_text1), OCI_V7_SYNTAX,
            OCI_DEFAULT));
 
    checker(errhp,
           OCIDefineByPos(stmthp, &amp;defnp1,
                  errhp, 1, (dvoid *)outstr, MAXSTRLENGTH * sizeof(char),
                  SQLT_STR, (dvoid *)0, (ub2 *)0, (ub2 *)0, OCI_DEFAULT));
    checker(errhp,
           OCIDefineByPos(stmthp, &amp;defnp2,
                     errhp, 2, (dvoid *)&amp;empno, sizeof(empno),
                     SQLT_INT, (dvoid *)0, (ub2 *)0, (ub2 *)0, OCI_DEFAULT));
    checker(errhp,
           OCIDefineByPos(stmthp, &amp;defnp3,
                      errhp, 3, (dvoid *)&amp;dname, sizeof(dname),
                     SQLT_STR, (dvoid *)0, (ub2 *)0, (ub2 *)0, OCI_DEFAULT));
 
    /* Associate the statement with the subscription handle */
    OCIAttrSet (stmthp, OCI_HTYPE_STMT, subscrhp, 0,
              OCI_ATTR_CHNF_REGHANDLE, errhp);
 
    /* Execute the statement, the execution performs object registration */
    checker(errhp, OCIStmtExecute (svchp, stmthp, errhp, (ub4) 1, (ub4) 0,
                 (CONST OCISnapshot *) NULL, (OCISnapshot *) NULL ,
                 OCI_DEFAULT));
    fflush(stdout);
 
    OCIAttrGet(stmthp, OCI_HTYPE_STMT, &amp;qid, (ub4 *)0,
                OCI_ATTR_CQ_QUERYID, errhp);
    printf("Query Id %d\n", qid);
 
  /* commit */
  checker(errhp, OCITransCommit(svchp, errhp, (ub4) 0));
 
}
 
static void cleanup(envhp, svchp, srvhp, errhp, usrhp)
OCIEnv *envhp;
OCISvcCtx *svchp;
OCIServer *srvhp;
OCIError *errhp;
OCISession *usrhp;
{
  /* detach from the server */
  checker(errhp, OCISessionEnd(svchp, errhp, usrhp, OCI_DEFAULT));
  checker(errhp, OCIServerDetach(srvhp, errhp, (ub4)OCI_DEFAULT));
 
  if (usrhp)
    (void) OCIHandleFree((dvoid *) usrhp, (ub4) OCI_HTYPE_SESSION);
  if (svchp)
    (void) OCIHandleFree((dvoid *) svchp, (ub4) OCI_HTYPE_SVCCTX);
  if (srvhp)
    (void) OCIHandleFree((dvoid *) srvhp, (ub4) OCI_HTYPE_SERVER);
  if (errhp)
    (void) OCIHandleFree((dvoid *) errhp, (ub4) OCI_HTYPE_ERROR);
  if (envhp)
    (void) OCIHandleFree((dvoid *) envhp, (ub4) OCI_HTYPE_ENV);
 
}
</pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div><a id="ADFNS1301"></a><div class="props_rev_3"><a id="GUID-A74B4631-B908-45C3-801E-B6986603918F" name="GUID-A74B4631-B908-45C3-801E-B6986603918F"></a><h3 id="ADFNS-GUID-A74B4631-B908-45C3-801E-B6986603918F" class="sect3">Querying CQN Registrations</h3>
               <div>
                  <div class="section">
                     <p>To see top-level information about all registrations, including their QOS options, query the static data dictionary view <code class="codeph">*_CHANGE_NOTIFICATION_REGS</code>.
                     </p>
                     <p>For example, you can obtain the registration ID for a client and the list of objects for which it receives notifications. To view registration IDs and table names for <code class="codeph">HR</code>, use this query:
                     </p><pre class="oac_no_warn" dir="ltr">SELECT <span class="italic">regid</span>, <span class="italic">table_name</span> FROM USER_CHANGE_NOTIFICATION_REGS;
</pre><p>To see which queries are registered for QRCN, query the static data dictionary view <code class="codeph">USER_CQ_NOTIFICATION_QUERIES</code> or <code class="codeph">DBA_CQ_NOTIFICATION_QUERIES</code>. These views include information about any bind values that the queries use. In these views, bind values in the original query are included in the query text as constants. The query text is equivalent, but maybe not identical, to the original query that was registered.
                     </p>
                     <div class="infoboxnotealso" id="GUID-A74B4631-B908-45C3-801E-B6986603918F__GUID-8C05CB2A-C573-4340-AB18-083CE6429127">
                        <p class="notep1">See Also:</p>
                        <p><span class="italic">Oracle Database Reference</span> for more information about the static data dictionary views <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=REFRN23537" target="_blank"><code class="codeph">USER_CHANGE_NOTIFICATION_REGS</code></a> and <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=REFRN23626" target="_blank"><code class="codeph">DBA_CQ_NOTIFICATION_QUERIES</code></a></p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="ADFNS1066"></a><a id="ADFNS1017"></a><div class="props_rev_3"><a id="GUID-2A42CDAB-DBB9-4785-B67B-2E0803F1EAB2" name="GUID-2A42CDAB-DBB9-4785-B67B-2E0803F1EAB2"></a><h3 id="ADFNS-GUID-2A42CDAB-DBB9-4785-B67B-2E0803F1EAB2" class="sect3">Interpreting Notifications</h3>
               <div>
                  <div class="section">
                     <p>When a transaction commits, the database determines whether registered objects were modified in the transaction. If so, it runs the notification handler specified in the registration.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-2A42CDAB-DBB9-4785-B67B-2E0803F1EAB2__GUID-320C89CF-BDB0-41F3-85EE-00EC2ACB1690">Topics:</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="cqn.html#GUID-014D005B-34DA-41A9-93A6-AC347C9FAC19">Interpreting a CQ_NOTIFICATION$_DESCRIPTOR Object</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-7C3B9794-BE25-4D88-B4B8-9F5B6A271CC2">Interpreting a CQ_NOTIFICATION$_TABLE Object</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-03A79EF0-253A-4CA0-80F6-593EDC97532B">Interpreting a CQ_NOTIFICATION$_QUERY Object</a></p>
                        </li>
                        <li>
                           <p><a href="cqn.html#GUID-55474F05-0919-4771-964E-97113D66EC4F">Interpreting a CQ_NOTIFICATION$_ROW Object</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS586"></a><a id="ADFNS585"></a><div class="props_rev_3"><a id="GUID-014D005B-34DA-41A9-93A6-AC347C9FAC19" name="GUID-014D005B-34DA-41A9-93A6-AC347C9FAC19"></a><h4 id="ADFNS-GUID-014D005B-34DA-41A9-93A6-AC347C9FAC19" class="sect4">Interpreting a CQ_NOTIFICATION$_DESCRIPTOR Object</h4>
                  <div>
                     <div class="section">
                        <p><a id="d102353e9310" class="indexterm-anchor"></a>When a CQN registration generates a notification, the database passes a <code class="codeph">CQ_NOTIFICATION$_DESCRIPTOR</code> object to the notification handler. The notification handler can find the details of the database change in the attributes of the <code class="codeph">CQ_NOTIFICATION$_DESCRIPTOR</code> object.
                        </p>
                        <p>In SQL*Plus, you can list these attributes by connecting as <code class="codeph">SYS</code> and running this statement:
                        </p><pre class="oac_no_warn" dir="ltr">DESC CQ_NOTIFICATION$_DESCRIPTOR
</pre><p><a href="cqn.html#GUID-014D005B-34DA-41A9-93A6-AC347C9FAC19__CHEDAHIA" title="This table summarizes the attributes of the SYS.CHNF$_REG_INFO_OC4J datatype.">Table 18-4</a> summarizes the attributes of <code class="codeph">CQ_NOTIFICATION$_DESCRIPTOR</code>.
                        </p>
                        <div class="tblformal" id="GUID-014D005B-34DA-41A9-93A6-AC347C9FAC19__CHEDAHIA">
                           <p class="titleintable">Table 18-4 Attributes of CQ_NOTIFICATION$_DESCRIPTOR</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="Attributes of CQ_NOTIFICATION$_DESCRIPTOR" summary="This table summarizes the attributes of the SYS.CHNF$_REG_INFO_OC4J datatype." width="100%" frame="hsides" border="1" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="24%" id="d102353e9345">Attribute</th>
                                    <th align="left" valign="bottom" width="76%" id="d102353e9348">Description</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="24%" id="d102353e9353" headers="d102353e9345 ">
                                       <p><code class="codeph">REGISTRATION_ID</code></p>
                                    </td>
                                    <td align="left" valign="top" width="76%" headers="d102353e9353 d102353e9348 ">
                                       <p>The registration ID that was returned during registration.</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="24%" id="d102353e9361" headers="d102353e9345 ">
                                       <p><code class="codeph">TRANSACTION_ID</code></p>
                                    </td>
                                    <td align="left" valign="top" width="76%" headers="d102353e9361 d102353e9348 ">
                                       <p>The ID for the transaction that made the change.</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="24%" id="d102353e9369" headers="d102353e9345 ">
                                       <p><code class="codeph">DBNAME</code></p>
                                    </td>
                                    <td align="left" valign="top" width="76%" headers="d102353e9369 d102353e9348 ">
                                       <p>The name of the database in which the notification was generated.</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="24%" id="d102353e9377" headers="d102353e9345 ">
                                       <p><code class="codeph">EVENT_TYPE</code></p>
                                    </td>
                                    <td align="left" valign="top" width="76%" headers="d102353e9377 d102353e9348 ">
                                       <p>The database event that triggers a notification. For example, the attribute can contain these constants, which correspond to different database events:</p>
                                       <ul style="list-style-type: disc;">
                                          <li>
                                             <p><code class="codeph">EVENT_NONE</code></p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">EVENT_STARTUP</code> (Instance startup)
                                             </p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">EVENT_SHUTDOWN</code> (Instance shutdown - last instance shutdown for Oracle RAC)
                                             </p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">EVENT_SHUTDOWN_ANY</code> (Any instance shutdown for Oracle RAC)
                                             </p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">EVENT_DEREG</code> (Registration was removed)
                                             </p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">EVENT_OBJCHANGE</code> (Change to a registered table)
                                             </p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">EVENT_QUERYCHANGE</code> (Change to a registered result set)
                                             </p>
                                          </li>
                                       </ul>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="24%" id="d102353e9420" headers="d102353e9345 ">
                                       <p><code class="codeph">NUMTABLES</code></p>
                                    </td>
                                    <td align="left" valign="top" width="76%" headers="d102353e9420 d102353e9348 ">
                                       <p>The number of tables that were modified.</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="24%" id="d102353e9428" headers="d102353e9345 ">
                                       <p><code class="codeph">TABLE_DESC_ARRAY</code></p>
                                    </td>
                                    <td align="left" valign="top" width="76%" headers="d102353e9428 d102353e9348 ">
                                       <p>This field is present only for OCN registrations. For QRCN registrations, it is <code class="codeph">NULL</code>.
                                       </p>
                                       <p>If <code class="codeph">EVENT_TYPE</code> is <code class="codeph">EVENT_OBJCHANGE</code>]: a <code class="codeph">VARRAY</code> of table change descriptors of type <code class="codeph">CQ_NOTIFICATION$_TABLE</code>, each of which corresponds to a changed table. For attributes of <code class="codeph">CQ_NOTIFICATION$_TABLE</code>, see <a href="cqn.html#GUID-7C3B9794-BE25-4D88-B4B8-9F5B6A271CC2__CHEGCHEE" title="This table summarizes the attributes of the SYS.CHNF$_REG_INFO_OC4J datatype.">Table 18-5</a>.
                                       </p>
                                       <p>Otherwise: <code class="codeph">NULL</code>.
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="24%" id="d102353e9467" headers="d102353e9345 ">
                                       <p><code class="codeph">QUERY_DESC_ARRAY</code></p>
                                    </td>
                                    <td align="left" valign="top" width="76%" headers="d102353e9467 d102353e9348 ">
                                       <p>This field is present only for QRCN registrations. For OCN registrations, it is <code class="codeph">NULL</code>.
                                       </p>
                                       <p>If <code class="codeph">EVENT_TYPE</code> is <code class="codeph">EVENT_QUERYCHANGE</code>]: a <code class="codeph">VARRAY</code> of result set change descriptors of type <code class="codeph">CQ_NOTIFICATION$_QUERY</code>, each of which corresponds to a changed result set. For attributes of <code class="codeph">CQ_NOTIFICATION$_QUERY</code>, see <a href="cqn.html#GUID-03A79EF0-253A-4CA0-80F6-593EDC97532B__CHDGBGHJ" title="This table summarizes the attributes of the SYS.CHNF$_REG_INFO_OC4J datatype.">Table 18-6</a>.
                                       </p>
                                       <p>Otherwise: <code class="codeph">NULL</code>.
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS588"></a><a id="ADFNS587"></a><div class="props_rev_3"><a id="GUID-7C3B9794-BE25-4D88-B4B8-9F5B6A271CC2" name="GUID-7C3B9794-BE25-4D88-B4B8-9F5B6A271CC2"></a><h4 id="ADFNS-GUID-7C3B9794-BE25-4D88-B4B8-9F5B6A271CC2" class="sect4">Interpreting a CQ_NOTIFICATION$_TABLE Object</h4>
                  <div>
                     <div class="section">
                        <p>The <a id="d102353e9604" class="indexterm-anchor"></a><code class="codeph">CQ_NOTIFICATION$_DESCRIPTOR</code> type contains an attribute called <code class="codeph">TABLE_DESC_ARRAY</code>, which holds a <code class="codeph">VARRAY</code> of table descriptors of type <code class="codeph">CQ_NOTIFICATION$_TABLE</code>.
                        </p>
                        <p>In SQL*Plus, you can list these attributes by connecting as <code class="codeph">SYS</code> and running this statement:
                        </p><pre class="oac_no_warn" dir="ltr">DESC CQ_NOTIFICATION$_TABLE
</pre><p><a href="cqn.html#GUID-7C3B9794-BE25-4D88-B4B8-9F5B6A271CC2__CHEGCHEE" title="This table summarizes the attributes of the SYS.CHNF$_REG_INFO_OC4J datatype.">Table 18-5</a> summarizes the attributes of <code class="codeph">CQ_NOTIFICATION$_TABLE</code>.
                        </p>
                        <div class="tblformal" id="GUID-7C3B9794-BE25-4D88-B4B8-9F5B6A271CC2__CHEGCHEE">
                           <p class="titleintable">Table 18-5 Attributes of CQ_NOTIFICATION$_TABLE</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="Attributes of CQ_NOTIFICATION$_TABLE" summary="This table summarizes the attributes of the SYS.CHNF$_REG_INFO_OC4J datatype." width="100%" frame="hsides" border="1" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="21%" id="d102353e9644">Attribute</th>
                                    <th align="left" valign="bottom" width="79%" id="d102353e9647">Specifies . . .</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="21%" id="d102353e9652" headers="d102353e9644 ">
                                       <p><code class="codeph">OPFLAGS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="79%" headers="d102353e9652 d102353e9647 ">
                                       <p>The type of operation performed on the modified table. For example, the attribute can contain these constants, which correspond to different database operations:</p>
                                       <ul style="list-style-type: disc;">
                                          <li>
                                             <p><code class="codeph">ALL_ROWS</code> signifies that either the entire table is modified, as in a <code class="codeph">DELETE</code> <code class="codeph">*</code>, or row-level granularity of information is not requested or unavailable in the notification, and the recipient must assume that the entire table has changed
                                             </p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">UPDATEOP</code> signifies an update
                                             </p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">DELETEOP</code> signifies a deletion
                                             </p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">ALTEROP</code> signifies an <code class="codeph">ALTER</code> <code class="codeph">TABLE</code></p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">DROPOP</code> signifies a <code class="codeph">DROP</code> <code class="codeph">TABLE</code></p>
                                          </li>
                                          <li>
                                             <p><code class="codeph">UNKNOWNOP</code> signifies an unknown operation
                                             </p>
                                          </li>
                                       </ul>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="21%" id="d102353e9707" headers="d102353e9644 ">
                                       <p><code class="codeph">TABLE_NAME</code></p>
                                    </td>
                                    <td align="left" valign="top" width="79%" headers="d102353e9707 d102353e9647 ">
                                       <p>The name of the modified table.</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="21%" id="d102353e9715" headers="d102353e9644 ">
                                       <p><code class="codeph">NUMROWS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="79%" headers="d102353e9715 d102353e9647 ">
                                       <p>The number of modified rows.</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="21%" id="d102353e9723" headers="d102353e9644 ">
                                       <p><code class="codeph">ROW_DESC_ARRAY</code></p>
                                    </td>
                                    <td align="left" valign="top" width="79%" headers="d102353e9723 d102353e9647 ">
                                       <p>A <code class="codeph">VARRAY</code> of row descriptors of type <code class="codeph">CQ_NOTIFICATION$_ROW</code>, which <a href="cqn.html#GUID-55474F05-0919-4771-964E-97113D66EC4F__CHEBBJJB" title="This table summarizes the attributes of the SYS.CHNF$_REG_INFO_OC4J datatype.">Table 18-7</a> describes. If <code class="codeph">ALL_ROWS</code> was set in the <code class="codeph">opflags</code>, then the <code class="codeph">ROW_DESC_ARRAY</code> member is <code class="codeph">NULL</code>.
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS590"></a><a id="ADFNS589"></a><div class="props_rev_3"><a id="GUID-03A79EF0-253A-4CA0-80F6-593EDC97532B" name="GUID-03A79EF0-253A-4CA0-80F6-593EDC97532B"></a><h4 id="ADFNS-GUID-03A79EF0-253A-4CA0-80F6-593EDC97532B" class="sect4">Interpreting a CQ_NOTIFICATION$_QUERY Object</h4>
                  <div>
                     <div class="section">
                        <p>The <a id="d102353e9854" class="indexterm-anchor"></a><code class="codeph">CQ_NOTIFICATION$_DESCRIPTOR</code> type contains an attribute called <code class="codeph">QUERY_DESC_ARRAY</code>, which holds a <code class="codeph">VARRAY</code> of result set change descriptors of type <code class="codeph">CQ_NOTIFICATION$_QUERY</code>.
                        </p>
                        <p>In SQL*Plus, you can list these attributes by connecting as <code class="codeph">SYS</code> and running this statement:
                        </p><pre class="oac_no_warn" dir="ltr">DESC CQ_NOTIFICATION$_QUERY
</pre><p><a href="cqn.html#GUID-03A79EF0-253A-4CA0-80F6-593EDC97532B__CHDGBGHJ" title="This table summarizes the attributes of the SYS.CHNF$_REG_INFO_OC4J datatype.">Table 18-6</a> summarizes the attributes of <code class="codeph">CQ_NOTIFICATION$_QUERY</code>.
                        </p>
                        <div class="tblformal" id="GUID-03A79EF0-253A-4CA0-80F6-593EDC97532B__CHDGBGHJ">
                           <p class="titleintable">Table 18-6 Attributes of CQ_NOTIFICATION$_QUERY</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="Attributes of CQ_NOTIFICATION$_QUERY" summary="This table summarizes the attributes of the SYS.CHNF$_REG_INFO_OC4J datatype." width="100%" frame="hsides" border="1" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="27%" id="d102353e9894">Attribute</th>
                                    <th align="left" valign="bottom" width="73%" id="d102353e9897">Specifies . . .</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="27%" id="d102353e9902" headers="d102353e9894 ">
                                       <p><code class="codeph">QUERYID</code></p>
                                    </td>
                                    <td align="left" valign="top" width="73%" headers="d102353e9902 d102353e9897 ">
                                       <p>Query ID of the changed query.</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="27%" id="d102353e9910" headers="d102353e9894 ">
                                       <p><code class="codeph">QUERYOP</code></p>
                                    </td>
                                    <td align="left" valign="top" width="73%" headers="d102353e9910 d102353e9897 ">
                                       <p>Operation that changed the query (either <code class="codeph">EVENT_QUERYCHANGE</code> or <code class="codeph">EVENT_DEREG</code>).
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="27%" id="d102353e9924" headers="d102353e9894 ">
                                       <p><code class="codeph">TABLE_DESC_ARRAY</code></p>
                                    </td>
                                    <td align="left" valign="top" width="73%" headers="d102353e9924 d102353e9897 ">
                                       <p>A <code class="codeph">VARRAY</code> of table change descriptors of type <code class="codeph">CQ_NOTIFICATION$_TABLE</code>, each of which corresponds to a changed table that caused a change in the result set. For attributes of <code class="codeph">CQ_NOTIFICATION$_TABLE</code>, see <a href="cqn.html#GUID-7C3B9794-BE25-4D88-B4B8-9F5B6A271CC2__CHEGCHEE" title="This table summarizes the attributes of the SYS.CHNF$_REG_INFO_OC4J datatype.">Table 18-5</a>.
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS592"></a><a id="ADFNS591"></a><div class="props_rev_3"><a id="GUID-55474F05-0919-4771-964E-97113D66EC4F" name="GUID-55474F05-0919-4771-964E-97113D66EC4F"></a><h4 id="ADFNS-GUID-55474F05-0919-4771-964E-97113D66EC4F" class="sect4">Interpreting a CQ_NOTIFICATION$_ROW Object</h4>
                  <div>
                     <div class="section">
                        <p>If the <code class="codeph">ROWID</code> option was specified during registration, the <code class="codeph">CQ_NOTIFICATION$_TABLE</code> type has a <code class="codeph">ROW_DESC_ARRAY</code> attribute, a <code class="codeph">VARRAY</code> of type <a id="d102353e10056" class="indexterm-anchor"></a><code class="codeph">CQ_NOTIFICATION$_ROW</code> that contains the <code class="codeph">ROWID</code>s for the changed rows. If <code class="codeph">ALL_ROWS</code> was set in the <code class="codeph">OPFLAGS</code> field of the <code class="codeph">CQ_NOTIFICATION$_TABLE</code> object, then <code class="codeph">ROWID</code> information is unavailable.
                        </p>
                        <p><a href="cqn.html#GUID-55474F05-0919-4771-964E-97113D66EC4F__CHEBBJJB" title="This table summarizes the attributes of the SYS.CHNF$_REG_INFO_OC4J datatype.">Table 18-7</a> summarizes the attributes of <code class="codeph">CQ_NOTIFICATION$_ROW</code>.
                        </p>
                        <div class="tblformal" id="GUID-55474F05-0919-4771-964E-97113D66EC4F__CHEBBJJB">
                           <p class="titleintable">Table 18-7 Attributes of CQ_NOTIFICATION$_ROW</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="Attributes of CQ_NOTIFICATION$_ROW" summary="This table summarizes the attributes of the SYS.CHNF$_REG_INFO_OC4J datatype." width="100%" frame="hsides" border="1" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="27%" id="d102353e10096">Attribute</th>
                                    <th align="left" valign="bottom" width="73%" id="d102353e10099">Specifies . . .</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="27%" id="d102353e10104" headers="d102353e10096 ">
                                       <p><code class="codeph">OPFLAGS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="73%" headers="d102353e10104 d102353e10099 ">
                                       <p>The type of operation performed on the modified table. See the description of <code class="codeph">OPFLAGS</code> in <a href="cqn.html#GUID-7C3B9794-BE25-4D88-B4B8-9F5B6A271CC2__CHEGCHEE" title="This table summarizes the attributes of the SYS.CHNF$_REG_INFO_OC4J datatype.">Table 18-5</a>.
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="27%" id="d102353e10120" headers="d102353e10096 ">
                                       <p><code class="codeph">ROW_ID</code></p>
                                    </td>
                                    <td align="left" valign="top" width="73%" headers="d102353e10120 d102353e10099 ">
                                       <p>The <code class="codeph">ROWID</code> of the changed row.
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>