<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>About Harvesting Connections in UCP</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Universal Connection Pool Developer's Guide ">
      <meta property="og:description" content>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Universal Connection Pool Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="universal-connection-pool-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-02-13T06:57:38-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="1999, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96473-02">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="stale-ucp-connections.html" title="Previous" type="text/html">
      <link rel="next" href="caching-sql-statements.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Universal Connection Pool Developer's Guide">
    <meta name="dcterms.isVersionOf" content="JJUCP">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="stale-ucp-connections.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="caching-sql-statements.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Universal Connection Pool Developer's Guide </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="optimizing-ucp-behavior.html" property="item" typeof="WebPage"><span property="name">Optimizing Universal Connection Pool Behavior</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">About Harvesting Connections in UCP</li>
            </ol>
            <a id="GUID-1639B871-C332-4F30-8EE0-F753FF07BFB7" name="GUID-1639B871-C332-4F30-8EE0-F753FF07BFB7"></a><a id="JJUCP8158"></a>
            
            <h2 id="JJUCP-GUID-1639B871-C332-4F30-8EE0-F753FF07BFB7" class="sect2"><span class="enumeration_section">4.5 </span>About Harvesting Connections in UCP
            </h2>
         </header>
         <div class="ind">
            <div>
               <p><a id="d4934e33" class="indexterm-anchor"></a><a id="d4934e35" class="indexterm-anchor"></a>The connection harvesting feature allows a specified number of borrowed connections to be reclaimed when the connection pool reaches a specified number of available connections. This section describes the following concepts:
               </p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="harvesting-connections.html#GUID-9E1830DD-D7BD-414C-8706-5303EDA8B8C4">Overview of Harvesting Connections in UCP</a></p>
                  </li>
                  <li>
                     <p><a href="harvesting-connections.html#GUID-134CA847-2A70-4018-BE5C-03A0AAEFA462">Setting a Connection to Harvestable</a></p>
                  </li>
                  <li>
                     <p><a href="harvesting-connections.html#GUID-4E5EF90A-C571-4CD8-AE3E-A52B13C34B50">Setting the Harvest Trigger Count</a></p>
                  </li>
                  <li>
                     <p><a href="harvesting-connections.html#GUID-E15544F5-82FA-4290-A9DF-60E1A0F777EE">Setting the Harvest Maximum Count</a></p>
                  </li>
               </ul>
            </div>
            <div class="props_rev_3"><a id="GUID-9E1830DD-D7BD-414C-8706-5303EDA8B8C4" name="GUID-9E1830DD-D7BD-414C-8706-5303EDA8B8C4"></a><h3 id="JJUCP-GUID-9E1830DD-D7BD-414C-8706-5303EDA8B8C4" class="sect3"><span class="enumeration_section">4.5.1 </span>Overview of Harvesting Connections in UCP
               </h3>
               <div>
                  <p> This feature helps ensure that a certain number of connections are always available in the pool and helps maximize performance. The feature is particularly useful if an application caches connection handles. Caching is typically performed for performance reasons because it minimizes re-initialization of state necessary for connections to participate in a transaction.</p>
                  <p>For example, a connection is borrowed from the pool, initialized with necessary session state, and then held in a context object. Holding connections in this manner may cause the connection pool to run out of available connections. The connection harvest feature reclaims the borrowed connections, if appropriate, and allows the connections to be reused.</p>
                  <p>Connection harvesting is controlled using the <code class="codeph">HarvestableConnection</code> interface and configured or enabled using two pool properties: Connection Harvest Trigger Count and Connection Harvest Maximum Count. The interface and properties are used together when implementing the connection harvest feature.
                  </p>
               </div>
            </div><a id="JJUCP8159"></a><div class="props_rev_3"><a id="GUID-134CA847-2A70-4018-BE5C-03A0AAEFA462" name="GUID-134CA847-2A70-4018-BE5C-03A0AAEFA462"></a><h3 id="JJUCP-GUID-134CA847-2A70-4018-BE5C-03A0AAEFA462" class="sect3"><span class="enumeration_section">4.5.2 </span>Setting a Connection to Harvestable
               </h3>
               <div>
                  <div class="section">
                     <p><a id="d4934e139" class="indexterm-anchor"></a><a id="d4934e141" class="indexterm-anchor"></a>The <code class="codeph">setConnectionHarvestable(boolean)</code> method of the <code class="codeph">oracle.ucp.jdbc.HarvestableConnection</code> interface controls whether or not a connection will be harvested. This method is used as a locking mechanism when connection harvesting is enabled. For example, the method is set to <code class="codeph">false</code> on a connection when the connection is being used within a transaction and must not be harvested. After the transaction completes, the method is set to <code class="codeph">true</code> on the connection and the connection can be harvested if required.
                     </p>
                     <div class="infoboxnote" id="GUID-134CA847-2A70-4018-BE5C-03A0AAEFA462__GUID-7D4857E6-6988-4228-91B8-718AF4BD18A6">
                        <p class="notep1">Note:</p>
                        <p>All connections are harvestable, by default, when the connection harvest feature is enabled. If the feature is enabled, the <code class="codeph">setConnectionHarvestable</code> method should always be used to explicitly control whether a connection is harvestable.
                        </p>
                     </div>
                     <p>The following example demonstrates using the <code class="codeph">setConnectionHarvestable</code> method to indicate that a connection is not harvestable when the connection harvest feature attempts to harvest connections:
                     </p><pre class="oac_no_warn" dir="ltr">Connection conn = pds.getConnection();

((HarvestableConnection) conn).setConnectionHarvestable(false);</pre></div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="props_rev_3"><a id="GUID-4E5EF90A-C571-4CD8-AE3E-A52B13C34B50" name="GUID-4E5EF90A-C571-4CD8-AE3E-A52B13C34B50"></a><h3 id="JJUCP-GUID-4E5EF90A-C571-4CD8-AE3E-A52B13C34B50" class="sect3"><span class="enumeration_section">4.5.3 </span>Setting the Harvest Trigger Count
               </h3>
               <div>
                  <div class="section">
                     <p><a id="d4934e205" class="indexterm-anchor"></a><a id="d4934e209" class="indexterm-anchor"></a><a id="d4934e211" class="indexterm-anchor"></a>The connection harvest trigger count specifies the available connection threshold that triggers connection harvesting. For example, if the connection harvest trigger count is set to 10, then connection harvesting is triggered when the number of available connections in the pool drops to 10.
                     </p>
                     <p>A value of <code class="codeph">Integer.MAX_VALUE</code> (2147483647 by default) indicates that connection harvesting is disabled. The default value is <code class="codeph">Integer.MAX_VALUE</code>.
                     </p>
                     <p>The following example demonstrates enabling connection harvesting by configuring a connection harvest trigger count.</p><pre class="oac_no_warn" dir="ltr">pds.setConnectionHarvestTriggerCount(2);
</pre></div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJUCP8161"></a><div class="props_rev_3"><a id="GUID-E15544F5-82FA-4290-A9DF-60E1A0F777EE" name="GUID-E15544F5-82FA-4290-A9DF-60E1A0F777EE"></a><h3 id="JJUCP-GUID-E15544F5-82FA-4290-A9DF-60E1A0F777EE" class="sect3"><span class="enumeration_section">4.5.4 </span>Setting the Harvest Maximum Count
               </h3>
               <div>
                  <div class="section">
                     <p><a id="d4934e262" class="indexterm-anchor"></a><a id="d4934e266" class="indexterm-anchor"></a><a id="d4934e268" class="indexterm-anchor"></a>The connection harvest maximum count property specifies how many borrowed connections should be returned to the pool once the harvest trigger count has been reached. The number of connections actually harvested may be anywhere from 0 to the connection harvest maximum count value. Least recently used connections are harvested first which allows very active user sessions to keep their connections the most.
                     </p>
                     <p>The harvest maximum count value can range from <code class="codeph">0</code> to the maximum connection property value. The default value is <code class="codeph">1</code>. An SQLException is thrown if an out-of-range value is specified.
                     </p>
                     <p>The following example demonstrates configuring a connection harvest maximum count.</p><pre class="oac_no_warn" dir="ltr">pds.setConnectionHarvestMaxCount(5);
</pre><div class="infoboxnote" id="GUID-E15544F5-82FA-4290-A9DF-60E1A0F777EE__GUID-CB5E3B8D-6C1F-445C-8661-559563C62044">
                        <p class="notep1">Note:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>If connection harvesting and abandoned connection timeout features are enabled at the same time, then the timeout processing does not reclaim the connections that are designated as nonharvestable.</p>
                           </li>
                           <li>
                              <p>If connection harvesting and time-to-live connection timeout features are enabled at the same time, then the timeout processing reclaims the connections that are designated as nonharvestable.</p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="controlling-reclaimable-connection-behavior.html#GUID-B13613CF-F472-43BD-8ED0-4561C1449C14">Controlling Reclaimable Connection Behavior</a></li>
                     </ul>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>