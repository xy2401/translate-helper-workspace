<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="In some situations, parallel statements are queued while waiting for resources.">
      <meta name="description" content="In some situations, parallel statements are queued while waiting for resources.">
      <title>Parallel Statement Queuing</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="VLDB and Partitioning Guide">
      <meta property="og:description" content="In some situations, parallel statements are queued while waiting for resources.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="VLDB and Partitioning Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="vldb-and-partitioning-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-04-23T18:05:22-07:00">
      <meta name="dcterms.title" content="VLDB and Partitioning Guide">
      <meta name="dcterms.dateCopyrighted" content="2008, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96199-03">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="inmemory-parallel-exec.html" title="Previous" type="text/html">
      <link rel="next" href="types-parallelism.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="VLDBG">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="inmemory-parallel-exec.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="types-parallelism.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">VLDB and Partitioning Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="using-parallel.html" property="item" typeof="WebPage"><span property="name">Using Parallel Execution</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Parallel Statement Queuing</li>
            </ol>
            <a id="GUID-4A311C0C-8ABC-4E5A-A854-19F04DACBC36" name="GUID-4A311C0C-8ABC-4E5A-A854-19F04DACBC36"></a><a id="VLDBG1396"></a>
            
            <h2 id="VLDBG-GUID-4A311C0C-8ABC-4E5A-A854-19F04DACBC36" class="sect2">Parallel Statement Queuing</h2>
         </header>
         <div class="ind">
            <div>
               <p>In some situations, parallel statements are queued while waiting for resources.</p>
               <p>When the parameter <code class="codeph">PARALLEL_DEGREE_POLICY</code> is set to <code class="codeph">AUTO</code>, Oracle Database queues SQL statements that require parallel execution if the necessary number of parallel execution server processes are not available. After the necessary resources become available, the SQL statement is dequeued and allowed to execute. The default dequeue order is a simple first in, first out queue based on the time a statement was issued.
               </p>
               <p>The following is a summary of parallel statement processing.</p>
               <ol>
                  <li>
                     <p>A SQL statements is issued.</p>
                  </li>
                  <li>
                     <p>The statement is parsed and the DOP is automatically determined.</p>
                  </li>
                  <li>
                     <p>Available parallel resources are checked.</p>
                     <ol type="a">
                        <li>
                           <p>If there are sufficient parallel execution servers available and there are no statements ahead in the queue waiting for the resources, the SQL statement is executed.</p>
                        </li>
                        <li>
                           <p>If there are not sufficient parallel execution servers available, the SQL statement is queued based on specified conditions and dequeued from the front of the queue when specified conditions are met.</p>
                        </li>
                     </ol>
                  </li>
               </ol>
               <p>Parallel statements are queued if running the statements would increase the number of active parallel servers above the value of the <code class="codeph">PARALLEL_SERVERS_TARGET</code> initialization parameter. For example, if <code class="codeph">PARALLEL_SERVERS_TARGET</code> is set to <code class="codeph">64</code>, the number of current active servers is 60, and a new parallel statement needs 16 parallel servers, it would be queued because 16 added to 60 is greater than 64, the value of <code class="codeph">PARALLEL_SERVERS_TARGET</code>.
               </p>
               <p>This value is not the maximum number of parallel server processes allowed on the system, but the number available to run parallel statements before parallel statement queuing is used. It is set lower than the maximum number of parallel server processes allowed on the system (<code class="codeph">PARALLEL_MAX_SERVERS</code>) to ensure each parallel statement gets all of the parallel server resources required and to prevent overloading the system with parallel server processes. Note all serial (nonparallel) statements execute immediately even if parallel statement queuing has been activated.
               </p>
               <p>If a statement has been queued, it is identified by the <code class="codeph">resmgr:pq</code> <code class="codeph">queued</code> wait event.
               </p>
               <p>This section discusses the following topics:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="about-parallel-queuing.html#GUID-91782768-B249-43E1-B8D5-943C68B1459F" title="By default, the parallel statement queue operates as a first-in, first-out queue, but you can modify the default behavior with a resource plan.">About Managing Parallel Statement Queuing with Oracle Database Resource Manager</a></p>
                  </li>
                  <li>
                     <p><a href="about-parallel-queuing.html#GUID-A50AB580-F0D7-467F-8E71-69ABE5129D09" title="Often it is important for a report or batch job that consists of multiple parallel statements to complete as quickly as possible.">Grouping Parallel Statements with BEGIN_SQL_BLOCK END_SQL_BLOCK</a></p>
                  </li>
                  <li>
                     <p><a href="about-parallel-queuing.html#GUID-895A6883-D9E2-4385-8689-8BDA33EB9C50" title="You can use the NO_STATEMENT_QUEUING and STATEMENT_QUEUING hints in SQL statements to influence whether or not a statement is queued with parallel statement queuing.">About Managing Parallel Statement Queuing with Hints</a></p>
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-4A311C0C-8ABC-4E5A-A854-19F04DACBC36__GUID-7C05DB00-99F1-494D-9950-394D99B2B20B">
                  <p class="notep1">See Also:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="monitor-parallel-performance.html#GUID-1FF1855F-B438-422B-BFC2-1815B47766BB" title="You can monitor parallel execution performance with the V$RSRC_SESSION_INFO dynamic performance view.">V$RSRC_SESSION_INFO</a> and <a href="monitor-parallel-performance.html#GUID-95325AA4-3E5D-4A20-BF5F-AB34B8FA0DB2" title="You can monitor parallel execution performance with the V$RSRCMGRMETRIC dynamic performance view.">V$RSRCMGRMETRIC</a> for information about views for monitoring and analyzing parallel statement queuing
                        </p>
                     </li>
                     <li>
                        <p><a href="../refrn/PARALLEL_SERVERS_TARGET.html#REFRN10314" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> for more information about the <code class="codeph">PARALLEL_SERVERS_TARGET</code> initialization parameter
                        </p>
                     </li>
                  </ul>
               </div>
            </div><a id="VLDBG14020"></a><div class="props_rev_3"><a id="GUID-91782768-B249-43E1-B8D5-943C68B1459F" name="GUID-91782768-B249-43E1-B8D5-943C68B1459F"></a><h3 id="VLDBG-GUID-91782768-B249-43E1-B8D5-943C68B1459F" class="sect3">About Managing Parallel Statement Queuing with Oracle Database Resource Manager</h3>
               <div>
                  <p>By default, the parallel statement queue operates as a first-in, first-out queue, but you can modify the default behavior with a resource plan.</p>
                  <p>By configuring and setting a resource plan, you can control the order in which parallel statements are dequeued and the number of parallel execution servers used by each workload or consumer group.</p>
                  <p>Oracle Database Resource Manager operates based on the concept of consumer groups and resource plans. Consumer groups identify groups of users with identical resource privileges and requirements. A resource plan consists of a collection of directives for each consumer group which specify controls and allocations for various database resources, such as parallel servers. For multitenant container databases (CDBs) and pluggable databases (PDBs), the order of the parallel statement queue is managed by the directive called <code class="codeph">shares</code>. 
                  </p>
                  <p>A resource plan is enabled by setting the <code class="codeph">RESOURCE_MANAGER_PLAN</code> parameter to the name of the resource plan.
                  </p>
                  <p>You can use the directives described in the following sections to manage the processing of parallel statements for consumer groups when the parallel degree policy is set to <code class="codeph">AUTO</code>.
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="about-parallel-queuing.html#GUID-1E1CB1FA-529B-4087-9589-304A00711F51" title="You can use Oracle Database Resource Manager to manage the priority for dequeuing parallel statements from the parallel statement queue across multiple consumer groups.">About Managing the Order of the Parallel Statement Queue</a></p>
                     </li>
                     <li>
                        <p><a href="about-parallel-queuing.html#GUID-79E5E7E2-A235-4D38-9E6B-902CB7F3F353" title="You can use Oracle Database Resource Manager to limit the number of parallel servers that parallel statements from lower priority consumer groups can use for parallel statement processing.">About Limiting the Parallel Server Resources for a Consumer Group</a></p>
                     </li>
                     <li>
                        <p><a href="about-parallel-queuing.html#GUID-2E5BDF23-FCA0-443E-A8C9-66AAE89862E2" title="You can use Oracle Database Resource Manager to set specific maximum queue timeouts for consumer groups so that parallel statements do not stay in the queue for long periods of time.">Specifying a Parallel Statement Queue Timeout for Each Consumer Group</a></p>
                     </li>
                     <li>
                        <p><a href="about-parallel-queuing.html#GUID-44222E39-87C7-4206-8FE3-91DAF0D3573C" title="You can use Oracle Database Resource Manager to the limit the degree of parallelism for specific consumer groups.">Specifying a Degree of Parallelism Limit for Consumer Groups</a></p>
                     </li>
                     <li>
                        <p><a href="about-parallel-queuing.html#GUID-D779AB02-8638-4080-88EB-307D172A7426" title="The setting of the PARALLEL_STMT_CRITICAL parameter affects the critical designation of parallel statements in the plan directive with respect to the parallel statement queue.">Critical Parallel Statement Prioritization</a></p>
                     </li>
                     <li>
                        <p><a href="about-parallel-queuing.html#GUID-42B48208-FFF6-44D4-9FF8-4D2DDA575C41" title="This scenario discusses how to manage statements in the parallel queue with consumer groups set up with Oracle Database Resource Manager.">A Sample Scenario for Managing Statements in the Parallel Queue</a></p>
                     </li>
                  </ul>
                  <p>In all cases, the parallel statement queue of a given consumer group is managed as a single queue on an Oracle RAC database. Limits for each consumer group apply to all sessions across the Oracle RAC database that belong to that consumer group. The queuing of parallel statements occurs based on the sum of the values of the <code class="codeph">PARALLEL_SERVERS_TARGET</code> initialization parameter across all database instances.
                  </p>
                  <p>You can also manage parallel statement queuing for multitenant container databases (CDBs) and pluggable databases (PDBs).</p>
                  <div class="infoboxnotealso" id="GUID-91782768-B249-43E1-B8D5-943C68B1459F__GUID-4DDB813D-0971-4C3C-8734-3E60F62DFBBD">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="../admin/managing-resources-with-oracle-database-resource-manager.html#ADMIN027" target="_blank"><span><cite>Oracle Database Administrator’s Guide</cite></span></a> for information about managing Oracle Database resources with Oracle Database Resource Manager
                           </p>
                        </li>
                        <li>
                           <p><a href="../multi/using-oracle-resource-manager-for-pdbs-with-sql-plus.html#MULTI-GUID-1BE505F7-5D27-442D-9A9C-ACA56A7EE569" target="_blank"><span><cite>Oracle Multitenant Administrator's Guide</cite></span></a> for information about parallel execution (PX) servers and utilization limits for for multitenant container databases (CDBs) and pluggable databases (PDBs)
                           </p>
                        </li>
                        <li>
                           <p><a href="../refrn/dynamic-performance-views.html#REFRN003" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> for information about <code class="codeph">V$RSRC</code>* views, the <code class="codeph">DBA_HIST_RSRC_CONSUMER_GROUP</code> view, and parallel query wait events
                           </p>
                        </li>
                        <li>
                           <p><a href="../arpls/DBMS_RESOURCE_MANAGER.html#ARPLS050" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for information about the <code class="codeph">DBMS_RESOURCE_MANAGER</code> package
                           </p>
                        </li>
                     </ul>
                  </div>
               </div><a id="VLDBG14085"></a><div class="props_rev_3"><a id="GUID-1E1CB1FA-529B-4087-9589-304A00711F51" name="GUID-1E1CB1FA-529B-4087-9589-304A00711F51"></a><h4 id="VLDBG-GUID-1E1CB1FA-529B-4087-9589-304A00711F51" class="sect4">About Managing the Order of the Parallel Statement Queue</h4>
                  <div>
                     <p>You can use Oracle Database Resource Manager to manage the priority for dequeuing parallel statements from the parallel statement queue across multiple consumer groups.</p>
                     <p>The parallel statements for a particular consumer group are dequeued in FIFO order by default. With the directives <code class="codeph">shares</code>, you can determine the order in which the parallel statements of a consumer group are dequeued. You configure these directives with the <code class="codeph">CREATE_PLAN_DIRECTIVE</code> or <code class="codeph">UPDATE_PLAN_DIRECTIVE</code> procedure of the <code class="codeph">DBMS_RESOURCE_MANAGER</code> PL/SQL package. You can also set <code class="codeph">shares</code> in a CDB resource plan to manage the order of parallel statements among PDBs.
                     </p>
                     <p>For example, you can create the <code class="codeph">PQ_HIGH</code>, <code class="codeph">PQ_MEDIUM</code>, and <code class="codeph">PQ_LOW</code> consumer groups and map parallel statement sessions to these consumer groups based on priority. You then create a resource plan that sets <code class="codeph">shares=14</code> for <code class="codeph">PQ_HIGH</code>,  <code class="codeph">shares=5</code> for <code class="codeph">PQ_MEDIUM</code>, and <code class="codeph">shares=1</code> for <code class="codeph">PQ_LOW</code>. This indicates that <code class="codeph">PQ_HIGH</code> statements are dequeued with a probability of <code class="codeph">70%</code> (14/(14+5+1)=.70) of the time, <code class="codeph">PQ_MEDIUM</code> dequeued with a probability of <code class="codeph">25%</code> (5/(14+5+1)=.25) of the time, and <code class="codeph">PQ_LOW</code> dequeued with a probability of <code class="codeph">5%</code> (1/(14+5+1)=.05) of the time.
                     </p>
                     <p>If a parallel statement has been queued and you determine that the parallel statement must be run immediately, then you can run the <code class="codeph">DBMS_RESOURCE_MANAGER.DEQUEUE_PARALLEL_STATEMENT</code> PL/SQL procedure to dequeue the parallel statement.
                     </p>
                     <div class="infoboxnotealso" id="GUID-1E1CB1FA-529B-4087-9589-304A00711F51__ORACLEDATABASEPLSQLPACKAGESANDTYPES-2D67661D">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="../arpls/DBMS_RESOURCE_MANAGER.html#ARPLS050" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for information about procedures in the <code class="codeph">DBMS_RESOURCE_MANAGER</code> package
                              </p>
                           </li>
                           <li>
                              <p><a href="../admin/managing-resources-with-oracle-database-resource-manager.html#ADMIN-GUID-3BDCC024-22DD-479D-A7C3-92E7145C854F" target="_blank"><span><cite>Oracle Database Administrator’s Guide</cite></span></a> for information about creating resource plan directives
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="VLDBG14086"></a><div class="props_rev_3"><a id="GUID-79E5E7E2-A235-4D38-9E6B-902CB7F3F353" name="GUID-79E5E7E2-A235-4D38-9E6B-902CB7F3F353"></a><h4 id="VLDBG-GUID-79E5E7E2-A235-4D38-9E6B-902CB7F3F353" class="sect4">About Limiting the Parallel Server Resources for a Consumer Group</h4>
                  <div>
                     <p>You can use Oracle Database Resource Manager to limit the number of parallel servers that parallel statements from lower priority consumer groups can use for parallel statement processing. </p>
                     <p>Using Oracle Database Resource Manager you can map parallel statement sessions to different consumer groups that each have specific limits on the number of the parallel servers that can be used. Every consumer group has its own individual parallel statement queue. When these limits for consumer groups are specified, parallel statements from a consumer group are queued when its limit would be exceeded. </p>
                     <p>This limitation becomes useful when a database has high priority and low priority consumer groups. Without limits, a user may issue a large number of parallel statements from a low-priority consumer group that uses all parallel servers. When a parallel statement from a high priority consumer group is issued, the resource allocation directives can ensure that the high priority parallel statement is dequeued first. By limiting the number of parallel servers a low-priority consumer group can use, you can ensure that there are always some parallel servers available for a high priority consumer group.</p>
                     <p>To limit the parallel servers used by a consumer group, use the <code class="codeph">parallel_server_limit</code> parameter with the <code class="codeph">CREATE_PLAN_DIRECTIVE</code> procedure or the <code class="codeph">new_parallel_server_limit</code> parameter with the <code class="codeph">UPDATE_PLAN_DIRECTIVE</code> procedure in the <code class="codeph">DBMS_RESOURCE_MANAGER</code> package. The <code class="codeph">parallel_server_limit</code> parameter specifies the maximum percentage of the Oracle RAC-wide parallel server pool that is specified by <code class="codeph">PARALLEL_SERVERS_TARGET</code> that a consumer group can use. 
                     </p>
                     <p>For multitenant container database (CDB) resource plans, the parallel server limit applies to pluggable databases (PDBs). For PDB resource plans or non-CDB resource plans, this limit applies to consumer groups.</p>
                     <p>For example, on an Oracle RAC database in nonmultitenant configuration, the initialization parameter <code class="codeph">PARALLEL_SERVERS_TARGET</code> is set to <code class="codeph">32</code> on two nodes so there are a total of 32 x 2 = 64 parallel servers that can be used before queuing begins. You can set up the consumer group <code class="codeph">PQ_LOW</code> to use 50% of the available parallel servers (<code class="codeph">parallel_server_limit</code> = 50) and low priority statements can then be mapped to the <code class="codeph">PQ_LOW</code> consumer group. This scenario limits any parallel statements from the <code class="codeph">PQ_LOW</code> consumer group to 64 x 50% = 32 parallel servers, even though there are more inactive or unused parallel servers. In this scenario, after the statements from the <code class="codeph">PQ_LOW</code> consumer group have used 32 parallel servers, statements from that consumer group are queued.
                     </p>
                     <p>It is possible in one database to have some sessions with the parallelism degree policy set to <code class="codeph">MANUAL</code> and some sessions set to <code class="codeph">AUTO</code>. In this scenario, only the sessions with parallelism degree policy set to <code class="codeph">AUTO</code> can be queued. However, the parallel servers used in sessions where the parallelism degree policy is set to <code class="codeph">MANUAL</code> are included in the total of all parallel servers used by a consumer group.
                     </p>
                     <div class="infoboxnotealso" id="GUID-79E5E7E2-A235-4D38-9E6B-902CB7F3F353__GUID-B98363AD-4DB0-4385-94A7-4206D03D731F">
                        <p class="notep1">See Also:</p>
                        <p><a href="parameters-parallel-exec.html#GUID-52C07DB8-E805-44DA-8805-88CAC9187074" title="The PARALLEL_DEGREE_POLICY parameter specifies the number of parallel server processes allowed to run parallel statements before statement queuing is used.">PARALLEL_SERVERS_TARGET</a> for information about limiting parallel resources for users
                        </p>
                     </div>
                  </div>
               </div><a id="VLDBG14087"></a><div class="props_rev_3"><a id="GUID-2E5BDF23-FCA0-443E-A8C9-66AAE89862E2" name="GUID-2E5BDF23-FCA0-443E-A8C9-66AAE89862E2"></a><h4 id="VLDBG-GUID-2E5BDF23-FCA0-443E-A8C9-66AAE89862E2" class="sect4">Specifying a Parallel Statement Queue Timeout for Each Consumer Group</h4>
                  <div>
                     <p>You can use Oracle Database Resource Manager to set specific maximum queue timeouts for consumer groups so that parallel statements do not stay in the queue for long periods of time. </p>
                     <p>To manage the queue timeout, the <code class="codeph">parallel_queue_timeout</code> parameter is used with the <code class="codeph">CREATE_PLAN_DIRECTIVE</code> procedure or the <code class="codeph">new_parallel_queue_timeout</code> parameter is used with the <code class="codeph">UPDATE_PLAN_DIRECTIVE</code> procedure in the <code class="codeph">DBMS_RESOURCE_MANAGER</code> package. The <code class="codeph">parallel_queue_timeout</code> and <code class="codeph">new_parallel_queue_timeout</code> parameters specify the time in seconds that a statement can remain in a consumer group parallel statement queue. After the timeout period expires, the statement is either terminated with error <code class="codeph">ORA-7454</code> or removed from the parallel statement queue and enabled to run based on the value for the <code class="codeph">PQ_TIMEOUT_ACTION</code> directive in the resource manager plan.
                     </p>
                     <p>You can specify queue timeout actions for parallel statements using the <code class="codeph">PQ_TIMEOUT_ACTION</code> resource manager directive. Setting this directive to <code class="codeph">CANCEL</code> terminates the statement with the error <code class="codeph">ORA-7454</code>. Setting this directive to <code class="codeph">RUN</code> enables the statement to run.
                     </p>
                  </div>
               </div><a id="VLDBG14088"></a><div class="props_rev_3"><a id="GUID-44222E39-87C7-4206-8FE3-91DAF0D3573C" name="GUID-44222E39-87C7-4206-8FE3-91DAF0D3573C"></a><h4 id="VLDBG-GUID-44222E39-87C7-4206-8FE3-91DAF0D3573C" class="sect4">Specifying a Degree of Parallelism Limit for Consumer Groups</h4>
                  <div>
                     <p>You can use Oracle Database Resource Manager to the limit the degree of parallelism for specific consumer groups. </p>
                     <p>Using Oracle Database Resource Manager you can map parallel statement sessions to different consumer groups that each have specific limits for the degree of parallelism in a resource plan.</p>
                     <p>To manage the limit of parallelism in consumer groups, use the <code class="codeph">parallel_degree_limit_p1</code> parameter with the <code class="codeph">CREATE_PLAN_DIRECTIVE</code> procedure in the <code class="codeph">DBMS_RESOURCE_MANAGER</code> package or the <code class="codeph">new_parallel_degree_limit_p1</code> parameter with the <code class="codeph">UPDATE_PLAN_DIRECTIVE</code> procedure in the <code class="codeph">DBMS_RESOURCE_MANAGER</code> package. The <code class="codeph">parallel_degree_limit_p1</code> and <code class="codeph">new_parallel_degree_limit_p1</code> parameters specify a limit on the degree of parallelism for any operation.
                     </p>
                     <p>For example, you can create the PQ_HIGH, PQ_MEDIUM, and PQ_LOW consumer groups and map parallel statement sessions to these consumer groups based on priority. You then create a resource plan that specifies degree of parallelism limits so that the PQ_HIGH limit is set to 16, the PQ_MEDIUM limit is set to 8, and the PQ_LOW limit is set to 2.</p>
                     <p>The degree of parallelism limit is enforced, even if <code class="codeph">PARALLEL_DEGREE_POLICY</code> is not set to <code class="codeph">AUTO</code>.
                     </p>
                  </div>
               </div><a id="VLDBG14128"></a><div class="props_rev_3"><a id="GUID-D779AB02-8638-4080-88EB-307D172A7426" name="GUID-D779AB02-8638-4080-88EB-307D172A7426"></a><h4 id="VLDBG-GUID-D779AB02-8638-4080-88EB-307D172A7426" class="sect4">Critical Parallel Statement Prioritization</h4>
                  <div>
                     <p>The setting of the <code class="codeph">PARALLEL_STMT_CRITICAL</code> parameter affects the critical designation of parallel statements in the plan directive with respect to the parallel statement queue.
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>If the <code class="codeph">PARALLEL_STMT_CRITICAL</code> parameter is set to <code class="codeph">QUEUE</code>, then parallel statements that have <code class="codeph">PARALLEL_DEGREE_POLICY</code> set to <code class="codeph">MANUAL</code> are queued. 
                           </p>
                        </li>
                        <li>
                           <p>If the <code class="codeph">PARALLEL_STMT_CRITICAL</code> parameter is set to <code class="codeph">BYPASS_QUEUE</code>, then parallel statements bypass the parallel statement queue and execute immediately. 
                           </p>
                        </li>
                        <li>
                           <p>If <code class="codeph">PARALLEL_STMT_CRITICAL</code> is set to <code class="codeph">FALSE</code>, then that specifies the default behavior and no statement is designated as critical. 
                           </p>
                        </li>
                     </ul>
                     <p></p>
                     <p>Because critical parallel statements bypass the parallel statement queue, the system may encounter more active parallel servers than specified by the <code class="codeph">PARALLEL_SERVERS_TARGET</code> parameter. Critical parallel statements are allowed to run after the number of parallel servers reaches <code class="codeph">PARALLEL_MAX_SERVERS</code>, so some critical parallel statements may be downgraded.
                     </p>
                     <p>The <code class="codeph">PARALLEL_STMT_CRITICAL</code> column in the <code class="codeph">DBA_RSRC_PLAN_DIRECTIVES</code> view indicates whether parallel statements are from a consumer group that has been marked critical.
                     </p>
                  </div>
               </div><a id="VLDBG14090"></a><a id="VLDBG14089"></a><div class="props_rev_3"><a id="GUID-42B48208-FFF6-44D4-9FF8-4D2DDA575C41" name="GUID-42B48208-FFF6-44D4-9FF8-4D2DDA575C41"></a><h4 id="VLDBG-GUID-42B48208-FFF6-44D4-9FF8-4D2DDA575C41" class="sect4">A Sample Scenario for Managing Statements in the Parallel Queue</h4>
                  <div>
                     <p>This scenario discusses how to manage statements in the parallel queue with consumer groups set up with Oracle Database Resource Manager. </p>
                     <p>For this scenario, consider a data warehouse workload that consists of three types of SQL statements:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Short-running SQL statements</p>
                           <p>Short-running identifies statements running less than one minute. You expect these statements to have very good response times. </p>
                        </li>
                        <li>
                           <p>Medium-running SQL statements</p>
                           <p>Medium-running identifies statements running more than one minute, but less than 15 minutes. You expect these statements to have reasonably good response times. </p>
                        </li>
                        <li>
                           <p>Long-running SQL statements</p>
                           <p>Long-running identifies statements that are ad-hoc or complex queries running more than 15 minutes. You expect these statements to take a long time. </p>
                        </li>
                     </ul>
                     <p>For this data warehouse workload, you want better response times for the short-running statements. To achieve this goal, you must ensure that:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Long-running statements do not use all of the parallel server resources, forcing shorter statements to wait in the parallel statement queue.</p>
                        </li>
                        <li>
                           <p>When both short-running and long-running statements are queued, short-running statements should be dequeued ahead of long-running statements.</p>
                        </li>
                        <li>
                           <p>The DOP for short-running queries is limited because the speedup from a very high DOP is not significant enough to justify the use of a large number of parallel servers.</p>
                        </li>
                     </ul>
                     <p><a href="about-parallel-queuing.html#GUID-42B48208-FFF6-44D4-9FF8-4D2DDA575C41__BEIIGBCJ">Example 8-3</a> shows how to set up consumer groups using Oracle Database Resource Manager to set priorities for statements in the parallel statement queue. Note the following for this example:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>By default, users are assigned to the <code class="codeph">OTHER_GROUPS</code> consumer group. If the estimated execution time of a SQL statement is longer than 1 minute (60 seconds), then the user switches to <code class="codeph">MEDIUM_SQL_GROUP</code>. Because <code class="codeph">switch_for_call</code> is set to <code class="codeph">TRUE</code>, the user returns to <code class="codeph">OTHER_GROUPS</code> when the statement has completed. If the user is in <code class="codeph">MEDIUM_SQL_GROUP</code> and the estimated execution time of the statement is longer than 15 minutes (900 seconds), the user switches to <code class="codeph">LONG_SQL_GROUP</code>. Similarly, because <code class="codeph">switch_for_call</code> is set to <code class="codeph">TRUE</code>, the user returns to <code class="codeph">OTHER_GROUPS</code> when the query has completed. The directives used to accomplish the switch process are <code class="codeph">switch_time</code>, <code class="codeph">switch_estimate</code>, <code class="codeph">switch_for_call</code>, and <code class="codeph">switch_group</code>.
                           </p>
                        </li>
                        <li>
                           <p>After the number of active parallel servers reaches the value of the <code class="codeph">PARALLEL_SERVERS_TARGET</code> initialization parameter, subsequent parallel statements are queued. The <code class="codeph">shares</code> directives control the order in which parallel statements are dequeued when parallel servers become available. Because <code class="codeph">shares</code> is set to <code class="codeph">100%</code> for <code class="codeph">SYS_GROUP</code> in this example, parallel statements from <code class="codeph">SYS_GROUP</code> are always dequeued first. If no parallel statements from <code class="codeph">SYS_GROUP</code> are queued, then parallel statements from <code class="codeph">OTHER_GROUPS</code> are dequeued with probability 70%, from <code class="codeph">MEDIUM_SQL_GROUP</code> with probability 20%, and <code class="codeph">LONG_SQL_GROUP</code> with probability 10%.
                           </p>
                        </li>
                        <li>
                           <p>Parallel statements issued from <code class="codeph">OTHER_GROUPS</code> are limited to a DOP of 4 with the setting of the <code class="codeph">parallel_degree_limit_p1</code> directive.
                           </p>
                        </li>
                        <li>
                           <p>To prevent parallel statements of the <code class="codeph">LONG_SQL_GROUP</code> group from using all of the parallel servers, which could potentially cause parallel statements from <code class="codeph">OTHER_GROUPS</code> or <code class="codeph">MEDIUM_SQL_GROUP</code> to wait for long periods of time, its <code class="codeph">parallel_server_limit</code> directive is set to <code class="codeph">50%</code>. This setting means that after <code class="codeph">LONG_SQL_GROUP</code> has used up 50% of the parallel servers set with the <code class="codeph">PARALLEL_SERVERS_TARGET</code> initialization parameter, its parallel statements are forced to wait in the queue.
                           </p>
                        </li>
                        <li>
                           <p>Because parallel statements of the <code class="codeph">LONG_SQL_GROUP</code> group may be queued for a significant amount of time, a timeout is configured for 14400 seconds (4 hours). When a parallel statement from <code class="codeph">LONG_SQL_GROUP</code> has waited in the queue for 4 hours, the statement is terminated with the error ORA-7454.
                           </p>
                        </li>
                     </ul>
                     <div class="example" id="GUID-42B48208-FFF6-44D4-9FF8-4D2DDA575C41__BEIIGBCJ">
                        <p class="titleinexample">Example 8-3 Using consumer groups to set priorities in the parallel statement queue</p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_RESOURCE_MANAGER.CREATE_PENDING_AREA();
 
  /* Create consumer groups.
   * By default, users start in OTHER_GROUPS, which is automatically
   * created for every database.
   */
  DBMS_RESOURCE_MANAGER.CREATE_CONSUMER_GROUP(
    'MEDIUM_SQL_GROUP',
    'Medium-running SQL statements, between 1 and 15 minutes.  Medium priority.');

  DBMS_RESOURCE_MANAGER.CREATE_CONSUMER_GROUP(
    'LONG_SQL_GROUP',
    'Long-running SQL statements of over 15 minutes.  Low priority.');
 
  /* Create a plan to manage these consumer groups */
  DBMS_RESOURCE_MANAGER.CREATE_PLAN(
    'REPORTS_PLAN',
    'Plan for daytime that prioritizes short-running queries');
 
  DBMS_RESOURCE_MANAGER.CREATE_PLAN_DIRECTIVE(
    'REPORTS_PLAN', 'SYS_GROUP', 'Directive for sys activity',
    shares =&gt; 100);
 
  DBMS_RESOURCE_MANAGER.CREATE_PLAN_DIRECTIVE(
    'REPORTS_PLAN', 'OTHER_GROUPS', 'Directive for short-running queries',
    shares =&gt; 70,
    parallel_degree_limit_p1 =&gt; 4,
    switch_time =&gt; 60, switch_estimate =&gt; TRUE, switch_for_call =&gt; TRUE,
    switch_group =&gt; 'MEDIUM_SQL_GROUP');
 
  DBMS_RESOURCE_MANAGER.CREATE_PLAN_DIRECTIVE(
    'REPORTS_PLAN', 'MEDIUM_SQL_GROUP', 'Directive for medium-running queries',
    shares =&gt; 20,
    parallel_server_limit =&gt; 80,
    switch_time =&gt; 900, switch_estimate =&gt; TRUE, switch_for_call =&gt; TRUE,
    switch_group =&gt; 'LONG_SQL_GROUP');
 
  DBMS_RESOURCE_MANAGER.CREATE_PLAN_DIRECTIVE(
    'REPORTS_PLAN', 'LONG_SQL_GROUP', 'Directive for medium-running queries',
    shares =&gt; 10,
    parallel_server_limit =&gt; 50,
    parallel_queue_timeout =&gt; 14400);
 
  DBMS_RESOURCE_MANAGER.SUBMIT_PENDING_AREA();
END;
/

/* Allow all users to run in these consumer groups */
EXEC DBMS_RESOURCE_MANAGER_PRIVS.GRANT_SWITCH_CONSUMER_GROUP(
  'public', 'MEDIUM_SQL_GROUP', FALSE);
 
EXEC DBMS_RESOURCE_MANAGER_PRIVS.GRANT_SWITCH_CONSUMER_GROUP(
  'public', 'LONG_SQL_GROUP', FALSE);</pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div><a id="VLDBG14091"></a><div class="props_rev_3"><a id="GUID-A50AB580-F0D7-467F-8E71-69ABE5129D09" name="GUID-A50AB580-F0D7-467F-8E71-69ABE5129D09"></a><h3 id="VLDBG-GUID-A50AB580-F0D7-467F-8E71-69ABE5129D09" class="sect3">Grouping Parallel Statements with BEGIN_SQL_BLOCK END_SQL_BLOCK</h3>
               <div>
                  <p>Often it is important for a report or batch job that consists of multiple parallel statements to complete as quickly as possible.</p>
                  <p>For example, when many reports are launched simultaneously, you may want all of the reports to complete as quickly as possible. However, you also want some specific reports to complete first, rather than all reports finishing at the same time.</p>
                  <p>If a report contains multiple parallel statements and <code class="codeph">PARALLEL_DEGREE_POLICY</code> is set to <code class="codeph">AUTO</code>, then each parallel statement may be forced to wait in the queue on a busy database. For example, the following steps describe a scenario in SQL statement processing:
                  </p><pre class="oac_no_warn" dir="ltr">serial statement
parallel query - dop 8
  -&gt; wait in queue
serial statement
parallel query - dop 32
  -&gt; wait in queue
parallel query - dop 4
  -&gt; wait in queue
</pre><p>For a report to be completed quickly, the parallel statements must be grouped to produce the following behavior:</p><pre class="oac_no_warn" dir="ltr">start SQL block
serial statement
parallel query - dop 8
  -&gt; first parallel query: ok to wait in queue
serial statement
parallel query - dop 32
  -&gt; avoid or minimize wait
parallel query - dop 4
  -&gt; avoid or minimize wait
end SQL block
</pre><p>To group the parallel statements, you can use the <code class="codeph">BEGIN_SQL_BLOCK</code> and <code class="codeph">END_SQL_BLOCK</code> procedures in the <code class="codeph">DBMS_RESOURCE_MANAGER</code> PL/SQL package. For each consumer group, the parallel statement queue is ordered by the time associated with each of the consumer group's parallel statements. Typically, the time associated with a parallel statement is the time that the statement was enqueued, which means that the queue appears to be FIFO. When parallel statements are grouped in a SQL block with the <code class="codeph">BEGIN_SQL_BLOCK</code> and <code class="codeph">END_SQL_BLOCK</code> procedures, the first queued parallel statement also uses the time that it was enqueued. However, the second and all subsequent parallel statements receive special treatment and are enqueued using the enqueue time of the first queued parallel statement within the SQL block. With this functionality, the statements frequently move to the front of the parallel statement queue. This preferential treatment ensures that their wait time is minimized.
                  </p>
                  <div class="infoboxnotealso" id="GUID-A50AB580-F0D7-467F-8E71-69ABE5129D09__GUID-F30C2423-A6A1-47C4-8C76-36DA8AD9769F">
                     <p class="notep1">See Also:</p>
                     <p><a href="../arpls/DBMS_RESOURCE_MANAGER.html#ARPLS050" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for information about the <code class="codeph">DBMS_RESOURCE_MANAGER</code> package
                     </p>
                  </div>
               </div>
            </div><a id="VLDBG14092"></a><div class="props_rev_3"><a id="GUID-895A6883-D9E2-4385-8689-8BDA33EB9C50" name="GUID-895A6883-D9E2-4385-8689-8BDA33EB9C50"></a><h3 id="VLDBG-GUID-895A6883-D9E2-4385-8689-8BDA33EB9C50" class="sect3">About Managing Parallel Statement Queuing with Hints</h3>
               <div>
                  <p>You can use the <code class="codeph">NO_STATEMENT_QUEUING</code> and <code class="codeph">STATEMENT_QUEUING</code> hints in SQL statements to influence whether or not a statement is queued with parallel statement queuing.
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><code class="codeph">NO_STATEMENT_QUEUING</code></p>
                        <p>When <code class="codeph">PARALLEL_DEGREE_POLICY</code> is set to <code class="codeph">AUTO</code>, this hint enables a statement to bypass the parallel statement queue. However, a statement that bypasses the statement queue can potentially cause the system to exceed the maximum number of parallel execution servers defined by the value of the <code class="codeph">PARALLEL_SERVERS_TARGET</code> initialization parameter, which determines the limit at which parallel statement queuing is initiated. 
                        </p>
                        <p>There is no guarantee that the statement that bypasses the parallel statement queue receives the number of parallel execution servers requested because only the number of parallel execution servers available on the system, up to the value of the <code class="codeph">PARALLEL_MAX_SERVERS</code> initialization parameter, can be allocated.
                        </p>
                        <p>For example:</p><pre class="oac_no_warn" dir="ltr">SELECT /*+ NO_STATEMENT_QUEUING */ last_name, department_name 
  FROM employees e, departments d 
  WHERE e.department_id = d.department_id; 
</pre></li>
                     <li>
                        <p><code class="codeph">STATEMENT_QUEUING</code></p>
                        <p>When <code class="codeph">PARALLEL_DEGREE_POLICY</code> is not set to <code class="codeph">AUTO</code>, this hint enables a statement to be considered for parallel statement queuing, but to run only when enough parallel processes are available to run at the requested DOP. The number of available parallel execution servers, before queuing is enabled, is equal to the difference between the number of parallel execution servers in use and the maximum number allowed in the system, which is defined by the <code class="codeph">PARALLEL_SERVERS_TARGET</code> initialization parameter.
                        </p>
                        <p>For example:</p><pre class="oac_no_warn" dir="ltr">SELECT /*+ STATEMENT_QUEUING */ last_name, department_name 
  FROM employees e, departments d 
  WHERE e.department_id = d.department_id; </pre></li>
                  </ul>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>