<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>LOB的PL / SQL语义</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Database SecureFiles and Large Objects Developer&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Database SecureFiles and Large Objects Developer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="securefiles-and-large-objects-developers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-02-12T02:58:18-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96333-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="SQL-semantics-and-LOBs.html" title="Previous" type="text/html"></link>
      <link rel="next" href="data-interface-for-persistent-LOBs.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="SecureFiles and Large Objects Developer&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="ADLOB"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="SQL-semantics-and-LOBs.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="data-interface-for-persistent-LOBs.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Database SecureFiles和Large Objects Developer's Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="value-semantic-LOBs.html" property="item" typeof="WebPage"><span property="name">值语义LOB</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">LOB的PL / SQL语义</li>
            </ol>
            <a id="GUID-4147D9E6-173B-4D62-AC0A-C440CCE8A63D" name="GUID-4147D9E6-173B-4D62-AC0A-C440CCE8A63D"></a><a id="ADLOB45599"></a>
            
            <h2 id="ADLOB-GUID-4147D9E6-173B-4D62-AC0A-C440CCE8A63D" class="sect2"><span class="enumeration_chapter">8</span> LOB的PL / SQL语义</h2>
         </header>
         <div class="ind">
            <div>
               <p>话题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="PLSQL-semantics-for-LOBs.html#GUID-5F1EC0F4-4308-4AE4-B9C0-03BAE8CA4303">PL / SQL语句和变量</a></p>
                  </li>
                  <li>
                     <p><a href="PLSQL-semantics-for-LOBs.html#GUID-2C214444-948A-4F81-8C89-556CBF094EBF">CLOB和VARCHAR2之间的隐式转换</a></p>
                  </li>
                  <li>
                     <p><a href="PLSQL-semantics-for-LOBs.html#GUID-AFFA69B0-088E-4327-8B41-7295CFB914E6">显式转换函数</a></p>
                  </li>
                  <li>
                     <p><a href="PLSQL-semantics-for-LOBs.html#GUID-A380F6DF-84F4-4D86-AC57-3798E56A479F">远程LOB和BFILE的PL / SQL函数</a></p>
                  </li>
               </ul>
            </div><a id="ADLOB45600"></a><div class="props_rev_2"><a id="GUID-5F1EC0F4-4308-4AE4-B9C0-03BAE8CA4303" name="GUID-5F1EC0F4-4308-4AE4-B9C0-03BAE8CA4303"></a><h3 id="ADLOB-GUID-5F1EC0F4-4308-4AE4-B9C0-03BAE8CA4303" class="sect3">PL / SQL语句和变量</h3>
               <div>
                  <p>在PL / SQL中，已经进行了语义更改。</p>
                  <div class="infoboxnote" id="GUID-5F1EC0F4-4308-4AE4-B9C0-03BAE8CA4303__GUID-EE72CEEF-E803-4EA1-AA31-507F1F3C3D1A">
                     <p class="notep1">注意：</p>
                     <p>除非另有说明，否则大多数关于PL / SQL语义以及<code class="codeph">CLOB</code>和<code class="codeph">VARCHAR2</code>的讨论也适用于<code class="codeph">BLOB</code>和<code class="codeph">RAW</code> 。在文中，没有明确提到<code class="codeph">BLOB</code>和<code class="codeph">RAW</code> 。
                     </p>
                  </div>
                  <p>PL / SQL语义支持在以下部分中描述：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="PLSQL-semantics-for-LOBs.html#GUID-2C214444-948A-4F81-8C89-556CBF094EBF">CLOB和VARCHAR2之间的隐式转换</a></p>
                     </li>
                     <li>
                        <p><a href="PLSQL-semantics-for-LOBs.html#GUID-AFFA69B0-088E-4327-8B41-7295CFB914E6">显式转换函数</a></p>
                     </li>
                     <li>
                        <p><a href="PLSQL-semantics-for-LOBs.html#GUID-5BDAE26A-A294-408E-A250-187E3847D699">PL / SQL内置函数中的VARCHAR2和CLOB</a></p>
                     </li>
                  </ul>
               </div>
            </div><a id="ADLOB45602"></a><a id="ADLOB45603"></a><a id="ADLOB45601"></a><div class="props_rev_3"><a id="GUID-2C214444-948A-4F81-8C89-556CBF094EBF" name="GUID-2C214444-948A-4F81-8C89-556CBF094EBF"></a><h3 id="ADLOB-GUID-2C214444-948A-4F81-8C89-556CBF094EBF" class="sect3">CLOB和VARCHAR2之间的隐式转换</h3>
               <div>
                  <p>PL / SQL中允许从<code class="codeph">CLOB</code>到<code class="codeph">VARCHAR2</code>以及从<code class="codeph">VARCHAR2</code>到<code class="codeph">CLOB</code>数据类型的隐式转换。</p>
                  <p>通过这些转换，您可以在应用程序中执行以下操作：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>可以将<code class="codeph">CLOB</code>列选择为<code class="codeph">VARCHAR2</code> PL / SQL变量</p>
                     </li>
                     <li>
                        <p>可以将<code class="codeph">VARCHAR2</code>列选择为<code class="codeph">CLOB</code>变量</p>
                     </li>
                     <li>
                        <p><code class="codeph">CLOB</code>和<code class="codeph">VARCHAR2</code>之间的赋值和参数传递</p>
                     </li>
                  </ul>
                  <div class="section">
                     <p class="subhead2" id="GUID-2C214444-948A-4F81-8C89-556CBF094EBF__GUID-F1B4FEA4-8E49-40E7-AD7D-0975A87B2D43">在PL / SQL中将CLOB作为VARCHAR2访问</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>以下示例说明了将<code class="codeph">CLOB</code>视为<code class="codeph">VARCHAR2</code>时访问<code class="codeph">CLOB</code>数据的方式：</p><pre class="oac_no_warn" dir="ltr">声明myStoryBuf VARCHAR2（4001）; BEGIN SELECT ad_sourcetext INTO myStoryBuf FROM print_media WHERE ad_id = 12001; - 直接打印myStoryBuf显示故事END; /</pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-2C214444-948A-4F81-8C89-556CBF094EBF__GUID-AFB46D79-E59B-443E-8723-97126388A2F2">在CL / SQL中将CLOB分配给VARCHAR2</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section"><pre class="oac_no_warn" dir="ltr">声明myLOB CLOB; BEGIN SELECT'ABCDE'INTO myLOB FROM print_media WHERE ad_id = 11001; -  myLOB是一个临时LOB。 - 使用myLOB作为lob定位器DBMS_OUTPUT.PUT_LINE（'是临时？“|| DBMS_LOB.ISTEMPORARY（myLOB））;结束; /</pre></div>
                  <!-- class="section" -->
               </div>
            </div><a id="ADLOB45604"></a><div class="props_rev_3"><a id="GUID-AFFA69B0-088E-4327-8B41-7295CFB914E6" name="GUID-AFFA69B0-088E-4327-8B41-7295CFB914E6"></a><h3 id="ADLOB-GUID-AFFA69B0-088E-4327-8B41-7295CFB914E6" class="sect3">显式转换函数</h3>
               <div>
                  <p>在SQL和PL / SQL中，某些显式转换函数将其他数据类型转换为<code class="codeph">CLOB</code> ， <code class="codeph">NCLOB</code>和<code class="codeph">BLOB</code>作为<code class="codeph">LONG</code> -to-LOB迁移的一部分：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><code class="codeph">TO_CLOB()</code> ：从<code class="codeph">VARCHAR2</code> ， <code class="codeph">NVARCHAR2</code>或<code class="codeph">NCLOB</code>转换为<code class="codeph">CLOB</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">TO_NCLOB()</code> ：从<code class="codeph">VARCHAR2</code> ， <code class="codeph">NVARCHAR2</code>或<code class="codeph">CLOB</code>转换为<code class="codeph">NCLOB</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">TO_BLOB()</code> ：从<code class="codeph">RAW</code>转换为<code class="codeph">BLOB</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">TO_CHAR()</code>将<code class="codeph">CLOB</code>转换为<code class="codeph">CHAR</code>类型。使用此函数将字符LOB转换为数据库字符集时，如果要转换的<span>LOB</span>值大于目标类型，则数据库将返回错误。如果LOB数据不适合，隐式转换也会引发错误。
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">TO_NCHAR()</code>将<code class="codeph">NCLOB</code>转换为<code class="codeph">NCHAR</code>类型。当您使用此函数将字符LOB转换为国家字符集时，如果要转换的LOB值大于目标类型，则数据库将返回错误。如果LOB数据不适合，隐式转换也会引发错误。
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">CAST</code>不直接支持任何LOB数据类型。当您使用<code class="codeph">CAST</code>将<code class="codeph">CLOB</code>值转换为字符数据类型，将<code class="codeph">NCLOB</code>值转换为国家字符数据类型或将<code class="codeph">BLOB</code>值转换为<code class="codeph">RAW</code>数据类型时，数据库会隐式将LOB值转换为字符或原始数据，然后显式将结果值转换为目标数据类型。如果结果值大于目标类型，则数据库返回错误。
                        </p>
                     </li>
                  </ul>
                  <p>不支持其他显式转换函数，例如<code class="codeph">TO_NUMBER()</code> ，请参阅<a href="SQL-semantics-and-LOBs.html#GUID-D8F66A2A-4D17-49C3-ADB2-BE384510DD6D__G1016221" title="该表在前面的文本中描述">表7-1</a> 。
                  </p>
                  <div class="infoboxnote" id="GUID-AFFA69B0-088E-4327-8B41-7295CFB914E6__LOBSDONOTSUPPORTDUPLICATELONGBINDS.-DD5A0DF3">
                     <p class="notep1">注意：</p>
                     <p>LOB不支持重复的<code class="codeph">LONG</code>绑定。
                     </p>
                  </div>
                  <div class="infoboxnotealso" id="GUID-AFFA69B0-088E-4327-8B41-7295CFB914E6__NOTE-135-DD5A163A">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="migrating-columns-from-LONGs-to-LOBs.html#GUID-C6FC4583-4E71-4BDA-97CB-709EBC707773">将列从LONG迁移到LOB</a>以获取有关转换函数的更多信息</p>
                  </div>
               </div><a id="ADLOB45606"></a><a id="ADLOB45607"></a><a id="ADLOB45608"></a><a id="ADLOB45605"></a><div class="props_rev_3"><a id="GUID-5BDAE26A-A294-408E-A250-187E3847D699" name="GUID-5BDAE26A-A294-408E-A250-187E3847D699"></a><h4 id="ADLOB-GUID-5BDAE26A-A294-408E-A250-187E3847D699" class="sect4">PL / SQL内置函数中的VARCHAR2和CLOB</h4>
                  <div>
                     <p><code class="codeph">CLOB</code>和<code class="codeph">VARCHAR2</code>是两种不同的类型。
                     </p>
                     <p>但是，根据用途，CLOB可以传递给SQL和PL / SQL <code class="codeph">VARCHAR2</code>内置函数，与<code class="codeph">VARCHAR2</code>完全相同。或者可以将变量传递到<code class="codeph">DBMS_LOB</code> API，就像LOB定位器一样。请参阅以下组合示例<span class="q">“ <a href="PLSQL-semantics-for-LOBs.html#GUID-5BDAE26A-A294-408E-A250-187E3847D699__i1006221">PL / SQL中的CLOB变量</a> ”</span> 。
                     </p>
                     <p>PL / SQL <code class="codeph">VARCHAR2</code>函数和运算符可以将<code class="codeph">CLOB</code>作为参数或操作数。
                     </p>
                     <p>当<code class="codeph">VARCHAR2</code>变量的大小不足以包含来自返回<code class="codeph">CLOB</code>的函数或<code class="codeph">CLOB</code>列上的<code class="codeph">SELECT</code>的结果时，将引发错误并且不执行任何操作。这与<code class="codeph">VARCHAR2</code>语义一致。
                     </p>
                     <div class="section" id="GUID-5BDAE26A-A294-408E-A250-187E3847D699__i1006221">
                        <p class="subhead3" id="GUID-5BDAE26A-A294-408E-A250-187E3847D699__GUID-226AD67B-2CEE-49FB-8BB6-F987309CF854">PL / SQL中的CLOB变量</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section"><pre class="oac_no_warn" dir="ltr">1声明2 myStory CLOB; 3修订过的故事CLOB; 4 myGist VARCHAR2（100）; 5 modifiedGist VARCHAR2（100）; 6 BEGIN 7  - 选择CLOB列到CLOB变量8 SELECT Story INTO myStory FROM print_media WHERE product_id = 10; 9  - 对CLOB变量10执行VARCHAR2操作.RelatedStory：= UPPER（SUBSTR（myStory，100,1））; 11  -  revisedStory是一个临时的LOB 12  - 在一个CLOB 13的末尾Concat一个VARCHAR2修订的故事：= revisionStory || myGist; 14  - 以下语句引发错误，因为myStory为15  - 超过100个字节16 myGist：= myStory; 17结束;</pre><p>请注意，在<span class="q">“ <a href="PLSQL-semantics-for-LOBs.html#GUID-5BDAE26A-A294-408E-A250-187E3847D699__i1006221">PL / SQL中的CLOB变量</a> ”的</span>第10行中，隐式创建了一个临时<code class="codeph">CLOB</code> ，并由<code class="codeph">revisedStory</code> <code class="codeph">CLOB</code>定位器指向。在当前界面中，该行可以扩展为：</p><pre class="oac_no_warn" dir="ltr">buffer VARCHAR2（32000）DBMS_LOB.CREATETEMPORARY（revisedStory）; buffer：= UPPER（DBMS_LOB.SUBSTR（myStory，100,1））; DBMS_LOB.WRITE（modifiedStory，length（buffer），1，buffer）;</pre><p>在第13行中， <code class="codeph">myGist</code>附加到临时LOB的末尾，具有相同的效果：</p><pre class="oac_no_warn" dir="ltr">DBMS_LOB.WRITEAPPEND（modifiedStory，myGist，length（myGist））;</pre><p>在某些情况下，在PL / SQL语句中隐式创建的临时LOB可以更改先前定义的LOB定位符的表示形式。考虑下一个例子。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-5BDAE26A-A294-408E-A250-187E3847D699__GUID-0AB6376B-93E9-4B57-94AB-5F2FEE95D825">更改定位器 - 数据链接</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section"><pre class="oac_no_warn" dir="ltr">1声明2 myStory CLOB; 3 amt数：= 100; 4缓冲区VARCHAR2（100）：='某些数据'; 5 BEGIN 6  - 选择一个CLOB列到CLOB变量中7 SELECT Story INTO myStory FROM print_media WHERE product_id = 10; 8 DBMS_LOB.WRITE（myStory，amt，1，buf）; 9  - 写入表10中的持久LOB 11 myStory：= UPPER（SUBSTR（myStory，100,1））; 12  - 对CLOB变量执行VARCHAR2操作，创建临时LOB。13  - 从此时开始，更改不会反映在数据库表中。14 15 update print_media set Story = myStory WHERE product_id = 10; 16  - 需要更新以同步表中的数据。17结束;</pre><p>线7之后， <code class="codeph">myStory</code>表示在持久LOB <code class="codeph">print_media</code> 。
                        </p>
                        <p>第8行中的<code class="codeph">DBMS_LOB.WRITE</code>调用直接将数据写入表中。
                        </p>
                        <p>不需要<code class="codeph">UPDATE</code>语句。随后在第11行中，创建了一个临时LOB并将其分配给<code class="codeph">myStory</code>因为<code class="codeph">myStory</code>现在像本地<code class="codeph">VARCHAR2</code>变量一样使用。LOB定位器<code class="codeph">myStory</code>现在指向新创建的临时LOB。</p>
                        <p>因此，对<code class="codeph">myStory</code>修改不再反映在数据库中。要将更改传播到数据库表，现在需要<code class="codeph">UPDATE</code>语句。再次注意，对于先前的持久性LOB，不需要<code class="codeph">UPDATE</code> 。
                        </p>
                        <div class="infoboxnote" id="GUID-5BDAE26A-A294-408E-A250-187E3847D699__GUID-72D2880A-9241-4DCA-BCD9-C067B65EBCFF">
                           <p class="notep1">注意：</p>
                           <p>如果SQL语句返回LOB或LOB是PL / SQL函数或过程的<code class="codeph">OUT</code>参数，则必须测试它是否是临时LOB，如果是，则在完成后将其释放。
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-5BDAE26A-A294-408E-A250-187E3847D699__GUID-368D8477-749C-4CCA-A70E-9BF09AFD4288">自动和手动释放临时LOB</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>由于<code class="codeph">SELECT</code>或赋值而在程序块中创建的临时LOB在PL / SQL块或函数或过程结束时自动释放。您还必须释放使用<code class="codeph">DBMS_LOB.CREATETEMPORARY</code>创建的临时LOB以回收系统资源和临时表空间。通过在<code class="codeph">CLOB</code>变量上调用<code class="codeph">DBMS_LOB.FREETEMPORARY</code>来执行此操作。
                        </p><pre class="oac_no_warn" dir="ltr">声明Story1 CLOB; Story2 CLOB; StoryCombined CLOB; StoryLower CLOB; BEGIN SELECT故事INTO Story1 FROM print_media WHERE product_ID = 1;选择故事INTO Story2 FROM print_media WHERE product_ID = 2; StoryCombined：= Story1 || Story2; -  StoryCombined是一个临时LOB  - 免费使用StoryCombined来释放空间占用DBMS_LOB.FREETEMPORARY（StoryCombined）; StoryLower：= LOWER（Story1）|| LOWER（Story2）;结束; - 在块结束时，StoryLower被释放。
</pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="ADLOB45611"></a><div class="props_rev_3"><a id="GUID-A380F6DF-84F4-4D86-AC57-3798E56A479F" name="GUID-A380F6DF-84F4-4D86-AC57-3798E56A479F"></a><h3 id="ADLOB-GUID-A380F6DF-84F4-4D86-AC57-3798E56A479F" class="sect3">远程LOB和BFILE的PL / SQL函数</h3>
               <div>
                  <div class="infoboxnotealso" id="GUID-A380F6DF-84F4-4D86-AC57-3798E56A479F__FORPLSQLFUNCTIONSTHATSUPPORTREMOTEL-DD5A75EF">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="distributed-LOBs.html#GUID-FC1965B0-D822-4E80-AC2F-801B7BC00986">用于远程LOB</a>的PL / SQL函数<a href="distributed-LOBs.html#GUID-FC1965B0-D822-4E80-AC2F-801B7BC00986">和</a>用于支持远程<code class="codeph">LOBs</code>和<code class="codeph">BFILEs</code> PL / SQL函数的<code class="codeph">BFILEs</code></p>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>