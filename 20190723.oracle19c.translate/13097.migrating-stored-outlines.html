<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="Stored outline migration is the user-initiated process of converting stored outlines to SQL plan baselines. A SQL plan baseline is a set of plans proven to provide optimal performance.">
      <meta name="description" content="Stored outline migration is the user-initiated process of converting stored outlines to SQL plan baselines. A SQL plan baseline is a set of plans proven to provide optimal performance.">
      <title>Migrating Stored Outlines to SQL Plan Baselines</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="SQL Tuning Guide">
      <meta property="og:description" content="Stored outline migration is the user-initiated process of converting stored outlines to SQL plan baselines. A SQL plan baseline is a set of plans proven to provide optimal performance.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="SQL Tuning Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="sql-tuning-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-31T14:57:08-08:00">
      <meta name="dcterms.title" content="SQL Tuning Guide">
      <meta name="dcterms.dateCopyrighted" content="2013, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96095-03">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="managing-sql-plan-baselines.html" title="Previous" type="text/html">
      <link rel="next" href="glossary.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TGSQL">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="managing-sql-plan-baselines.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="glossary.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">SQL Tuning Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="sql-controls.html" property="item" typeof="WebPage"><span property="name">SQL Management Objects</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Migrating Stored Outlines to SQL Plan Baselines</li>
            </ol>
            <a id="GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A" name="GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A"></a><a id="TGSQL665"></a>
            
            <h2 id="TGSQL-GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A" class="sect2"><span class="enumeration_chapter">29 </span>Migrating Stored Outlines to SQL Plan Baselines
            </h2>
         </header>
         <div class="ind">
            <div>
               <p><strong class="term">Stored outline migration</strong> is the user-initiated process of converting stored outlines to SQL plan baselines. A SQL plan baseline is a set of plans proven to provide optimal performance.
               </p>
               <div class="infoboxnote" id="GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A__GUID-18B7AD6D-603D-49F0-91D2-31C2074E6AEB">
                  <p class="notep1">Note:</p>
                  <p>Starting in <span>Oracle Database 12c</span>, stored outlines are deprecated. See <span class="q">"<a href="migrating-stored-outlines.html#GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A" title="Stored outline migration is the user-initiated process of converting stored outlines to SQL plan baselines. A SQL plan baseline is a set of plans proven to provide optimal performance.">Migrating Stored Outlines to SQL Plan Baselines</a>"</span> for an alternative.
                  </p>
               </div>
               <p>This chapter explains the concepts and tasks relating to stored outline migration. This chapter contains the following topics:</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="migrating-stored-outlines.html#GUID-51C91B71-B6AC-4AD1-AE9A-4FE19B86D8A7">About Stored Outline Migration</a><br>A <strong class="term">stored outline</strong> is a set of hints for a SQL statement. 
                  </li>
                  <li class="ulchildlink"><a href="migrating-stored-outlines.html#GUID-729D65C2-5161-4229-BF71-5419B9FD1F85">Preparing for Stored Outline Migration</a><br>The goal is preparation is determining which stored outlines are eligible for migration.
                  </li>
                  <li class="ulchildlink"><a href="migrating-stored-outlines.html#GUID-58E6291D-F75D-44D7-A236-2E083ADAADC7">Migrating Outlines to Utilize SQL Plan Management Features</a><br>You can migrate stored outline to SQL plan baselines.
                  </li>
                  <li class="ulchildlink"><a href="migrating-stored-outlines.html#GUID-28D3E0A0-429F-4F60-B732-621CCD6F0C17">Migrating Outlines to Preserve Stored Outline Behavior</a><br>You can migrate stored outlines to SQL plan baselines and preserve the original behavior of the stored outlines by creating fixed plan baselines. 
                  </li>
                  <li class="ulchildlink"><a href="migrating-stored-outlines.html#GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B">Performing Follow-Up Tasks After Stored Outline Migration</a><br>After migrating outlines to SQL plan baselines, you must perform some follow-up work.
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>Parent topic:</strong> <a href="sql-controls.html#GUID-2889EBC8-1FAD-412F-9779-865028473607" title="A SQL management object is a feature that stabilizes the execution plans of individual SQL statements. SQL profiles and SQL plan baselines are SQL management objects.">SQL Management Objects</a></p>
                  </div>
               </div>
            </div>
            <a id="TGSQL666"></a><div class="props_rev_3"><a id="GUID-51C91B71-B6AC-4AD1-AE9A-4FE19B86D8A7" name="GUID-51C91B71-B6AC-4AD1-AE9A-4FE19B86D8A7"></a><h3 id="TGSQL-GUID-51C91B71-B6AC-4AD1-AE9A-4FE19B86D8A7" class="sect3"><span class="enumeration_section">29.1 </span>About Stored Outline Migration
               </h3>
               <div>
                  <p>A <strong class="term">stored outline</strong> is a set of hints for a SQL statement. 
                  </p>
                  <p>The hints direct the optimizer to choose a specific plan for the statement. A stored outline is a legacy technique for providing plan stability.</p>
                  <p>This section contains the following topics:</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="migrating-stored-outlines.html#GUID-423948E7-64CF-43C8-9F0B-D7179E72EE91">Purpose of Stored Outline Migration</a><br>If you rely on stored outlines to maintain plan stability and prevent performance regressions, then you can safely migrate from stored outlines to SQL plan baselines. After the migration, you can maintain the same plan stability while benefiting from the features provided by the SQL Plan Management framework.
                     </li>
                     <li class="ulchildlink"><a href="migrating-stored-outlines.html#GUID-98986AFF-0E41-4FF9-A9A4-628D9C7FCE8E">How Stored Outline Migration Works</a><br>Stored outline migration is a user-initiated process that goes through multiple stages.
                     </li>
                     <li class="ulchildlink"><a href="migrating-stored-outlines.html#GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224">User Interface for Stored Outline Migration</a><br>You can use the <code class="codeph">DBMS_SPM</code> package to perform the stored outline migration. 
                     </li>
                     <li class="ulchildlink"><a href="migrating-stored-outlines.html#GUID-B58E0B6B-5CFD-4C3A-8E91-ABCD49ADC8B8">Basic Steps in Stored Outline Migration</a><br>The basic process is to prepare, migrate, and then clean up.
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="migrating-stored-outlines.html#GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A" title="Stored outline migration is the user-initiated process of converting stored outlines to SQL plan baselines. A SQL plan baseline is a set of plans proven to provide optimal performance.">Migrating Stored Outlines to SQL Plan Baselines</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL667"></a><div class="props_rev_3"><a id="GUID-423948E7-64CF-43C8-9F0B-D7179E72EE91" name="GUID-423948E7-64CF-43C8-9F0B-D7179E72EE91"></a><h4 id="TGSQL-GUID-423948E7-64CF-43C8-9F0B-D7179E72EE91" class="sect4"><span class="enumeration_section">29.1.1 </span>Purpose of Stored Outline Migration
                  </h4>
                  <div>
                     <p>If you rely on stored outlines to maintain plan stability and prevent performance regressions, then you can safely migrate from stored outlines to SQL plan baselines. After the migration, you can maintain the same plan stability while benefiting from the features provided by the SQL Plan Management framework.</p>
                     <p>Stored outlines have the following disadvantages:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Stored outlines cannot automatically evolve over time. Consequently, a stored outline may be optimal when you create it, but become a suboptimal plan after a database change, leading to performance degradation.</p>
                        </li>
                        <li>
                           <p>Hints in a stored outline can become invalid, as with an index hint on a dropped index. In such cases, the database still uses the outlines but excludes the invalid hints, producing a plan that is often worse than the original plan or the current best-cost plan generated by the optimizer.</p>
                        </li>
                        <li>
                           <p>For a SQL statement, the optimizer can only choose the plan defined in the stored outline in the currently specified category. The optimizer cannot choose from other stored outlines in different categories or the current cost-based plan even if they improve performance.</p>
                        </li>
                        <li>
                           <p>Stored outlines are a reactive tuning technique, which means that you only use a stored outline to address a performance problem after it has occurred. For example, you may implement a stored outline to correct the plan of a SQL statement that became high-load. In this case, you used stored outlines instead of proactively tuning the statement before it became high-load.</p>
                        </li>
                     </ul>
                     <p>The stored outline migration PL/SQL API helps solve the preceding problems in the following ways:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>SQL plan baselines enable the optimizer to use the same optimal plan and allow this plan to evolve over time.</p>
                           <p>For a specified SQL statement, you can add new plans as SQL plan baselines after they are verified not to cause performance regressions.</p>
                        </li>
                        <li>
                           <p>SQL plan baselines prevent plans from becoming unreproducible because of invalid hints. </p>
                           <p>If hints stored in a plan baseline become invalid, then the plan may not be reproducible by the optimizer. In this case, the optimizer selects an alternative reproducible plan baseline or the current best-cost plan generated by optimizer.</p>
                        </li>
                        <li>
                           <p>For a specific SQL statement, the database can maintain multiple plan baselines. </p>
                           <p>The optimizer can choose from a set of optimal plans for a specific SQL statement instead of being restricted to a single plan per category, as required by stored outlines.</p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="migrating-stored-outlines.html#GUID-51C91B71-B6AC-4AD1-AE9A-4FE19B86D8A7" title="A stored outline is a set of hints for a SQL statement.">About Stored Outline Migration</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL668"></a><div class="props_rev_3"><a id="GUID-98986AFF-0E41-4FF9-A9A4-628D9C7FCE8E" name="GUID-98986AFF-0E41-4FF9-A9A4-628D9C7FCE8E"></a><h4 id="TGSQL-GUID-98986AFF-0E41-4FF9-A9A4-628D9C7FCE8E" class="sect4"><span class="enumeration_section">29.1.2 </span>How Stored Outline Migration Works
                  </h4>
                  <div>
                     <p>Stored outline migration is a user-initiated process that goes through multiple stages.</p>
                     <p>This section explains how the database migrates stored outlines to SQL plan baselines. This information is important for performing the task of migrating stored outlines.</p>
                     <p>This section contains the following topics:</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="migrating-stored-outlines.html#GUID-0DB9A2C7-3173-4D21-98FE-65C83C8F8A8C">Stages of Stored Outline Migration</a><br>To migrate stored outlines, you specify the stores outlines. The database then creates and updates SQL plan baselines.
                        </li>
                        <li class="ulchildlink"><a href="migrating-stored-outlines.html#GUID-75F926D8-04DA-4B7F-B750-33BD4505771E">Outline Categories and Baseline Modules</a><br>An outline is a set of hints, whereas a SQL plan baseline is a set of plans.
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="migrating-stored-outlines.html#GUID-51C91B71-B6AC-4AD1-AE9A-4FE19B86D8A7" title="A stored outline is a set of hints for a SQL statement.">About Stored Outline Migration</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL669"></a><div class="props_rev_3"><a id="GUID-0DB9A2C7-3173-4D21-98FE-65C83C8F8A8C" name="GUID-0DB9A2C7-3173-4D21-98FE-65C83C8F8A8C"></a><h5 id="TGSQL-GUID-0DB9A2C7-3173-4D21-98FE-65C83C8F8A8C" class="sect5"><span class="enumeration_section">29.1.2.1 </span>Stages of Stored Outline Migration
                     </h5>
                     <div>
                        <p>To migrate stored outlines, you specify the stores outlines. The database then creates and updates SQL plan baselines.</p>
                        <div class="figure" id="GUID-0DB9A2C7-3173-4D21-98FE-65C83C8F8A8C__GUID-AA907DD4-E803-458E-AD13-03D4A85A47B6">
                           <p class="titleinfigure">Figure 29-1 Stages of Stored Outline Migration</p><img src="img/pfgrf231.gif" alt="Description of Figure 29-1 follows" title="Description of Figure 29-1 follows" longdesc="img_text/pfgrf231.html"><br><a href="img_text/pfgrf231.html">Description of "Figure 29-1 Stages of Stored Outline Migration"</a></div>
                        <!-- class="figure" -->
                        <p>The migration process has the following stages:</p>
                        <ol>
                           <li>
                              <p>The user invokes a function that specifies which outlines to migrate.</p>
                           </li>
                           <li>
                              <p>The database processes the outlines as follows:</p>
                              <ol type="a">
                                 <li>
                                    <p>The database copies information in the outline needed by the plan baseline.</p>
                                    <p>The database copies it directly or calculates it based on information in the outline. For example, the text of the SQL statement exists in both schemas, so the database can copy the text from outline to baseline.</p>
                                 </li>
                                 <li>
                                    <p>The database reparses the hints to obtain information not in the outline.</p>
                                    <p>The plan hash value and plan cost cannot be derived from the existing information in the outline, which necessitates reparsing the hints.</p>
                                 </li>
                                 <li>
                                    <p>The database creates the baselines.</p>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>The database obtains missing information when it chooses the SQL plan baseline for the first time to execute the SQL statement.</p>
                              <p>The compilation environment and execution statistics are only available during execution when the plan baseline is parsed and compiled.</p>
                           </li>
                        </ol>
                        <p>The migration is complete only after the preceding phases complete.</p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="migrating-stored-outlines.html#GUID-98986AFF-0E41-4FF9-A9A4-628D9C7FCE8E" title="Stored outline migration is a user-initiated process that goes through multiple stages.">How Stored Outline Migration Works</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL671"></a><a id="TGSQL670"></a><div class="props_rev_3"><a id="GUID-75F926D8-04DA-4B7F-B750-33BD4505771E" name="GUID-75F926D8-04DA-4B7F-B750-33BD4505771E"></a><h5 id="TGSQL-GUID-75F926D8-04DA-4B7F-B750-33BD4505771E" class="sect5"><span class="enumeration_section">29.1.2.2 </span>Outline Categories and Baseline Modules
                     </h5>
                     <div>
                        <p>An outline is a set of hints, whereas a SQL plan baseline is a set of plans.</p>
                        <p>Because they are different technologies, some functionality of outlines does not map exactly to functionality of baselines. For example, a single SQL statement can have multiple outlines, each of which is in a different outline <span class="bold">category</span>, but the only category that currently exists for baselines is <code class="codeph">DEFAULT</code>. 
                        </p>
                        <p>The equivalent of a category for an outline is a module for a SQL plan baseline. <a href="migrating-stored-outlines.html#GUID-75F926D8-04DA-4B7F-B750-33BD4505771E__BHCEJBBI" title="Outline categories">Table 29-1</a> explains how outline categories map to modules.
                        </p>
                        <div class="tblformal" id="GUID-75F926D8-04DA-4B7F-B750-33BD4505771E__BHCEJBBI">
                           <p class="titleintable">Table 29-1 Outline Categories</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="Outline Categories" summary="Outline categories" width="100%" frame="hsides" border="1" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="30%" id="d148780e908">Concept</th>
                                    <th align="left" valign="bottom" width="30%" id="d148780e911">Description</th>
                                    <th align="left" valign="bottom" width="40%" id="d148780e914">Default Value</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="30%" id="d148780e919" headers="d148780e908 ">
                                       <p>Outline Category</p>
                                    </td>
                                    <td align="left" valign="top" width="30%" headers="d148780e919 d148780e911 ">
                                       <p>Specifies a user-defined grouping for a set of stored outlines. </p>
                                       <p>You can use categories to maintain different stored outlines for a SQL statement. For example, a single statement can have an outline in the <code class="codeph">OLTP</code> category and the <code class="codeph">DW</code> category.
                                       </p>
                                       <p>Each SQL statement can have one or more stored outlines. Each stored outline is in one and only one outline category. A statement can have multiple stored outlines in different categories, but only one stored outline exists for each category of each statement.</p>
                                       <p>During migration, the database maps each outline category to a SQL plan baseline module.</p>
                                    </td>
                                    <td align="left" valign="top" width="40%" headers="d148780e919 d148780e914 ">
                                       <p><code class="codeph">DEFAULT</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="30%" id="d148780e942" headers="d148780e908 ">
                                       <p>Baseline Module</p>
                                    </td>
                                    <td align="left" valign="top" width="30%" headers="d148780e942 d148780e911 ">
                                       <p>Specifies a high-level function being performed.</p>
                                       <p>A SQL plan baseline can belong to one and only one module.</p>
                                    </td>
                                    <td align="left" valign="top" width="40%" headers="d148780e942 d148780e914 ">
                                       <p>After an outline is migrated to a SQL plan baseline, the module name defaults to outline category name.</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="30%" id="d148780e954" headers="d148780e908 ">
                                       <p>Baseline Category</p>
                                    </td>
                                    <td align="left" valign="top" width="30%" headers="d148780e954 d148780e911 ">
                                       <p>Only one SQL plan baseline category exists. This category is named <code class="codeph">DEFAULT</code>. During stored outline migration, the module name of the SQL plan baseline is set to the category name of the stored outline.
                                       </p>
                                       <p>A statement can have multiple SQL plan baselines in the <code class="codeph">DEFAULT</code> category.
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="40%" headers="d148780e954 d148780e914 ">
                                       <p><code class="codeph">DEFAULT</code></p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>When migrating stored outlines to SQL plan baselines, Oracle Database maps every outline category to a SQL plan baseline module with the same name. As shown in the following diagram, the outline category <code class="codeph">OLTP</code> is mapped to the baseline module <code class="codeph">OLTP</code>. After migration, <code class="codeph">DEFAULT</code> is a super-category that contains all SQL plan baselines.
                        </p>
                        <div class="figure" id="GUID-75F926D8-04DA-4B7F-B750-33BD4505771E__GUID-5CBFB8FA-3B90-42C7-A5C6-3E29807A4599">
                           <p class="titleinfigure">Figure 29-2 DEFAULT Category</p><img src="img/pfgrf230.gif" alt="Description of Figure 29-2 follows" title="Description of Figure 29-2 follows" longdesc="img_text/pfgrf230.html"><br><a href="img_text/pfgrf230.html">Description of "Figure 29-2 DEFAULT Category"</a></div>
                        <!-- class="figure" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="migrating-stored-outlines.html#GUID-98986AFF-0E41-4FF9-A9A4-628D9C7FCE8E" title="Stored outline migration is a user-initiated process that goes through multiple stages.">How Stored Outline Migration Works</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="TGSQL673"></a><a id="TGSQL674"></a><a id="TGSQL675"></a><a id="TGSQL672"></a><div class="props_rev_3"><a id="GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224" name="GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224"></a><h4 id="TGSQL-GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224" class="sect4"><span class="enumeration_section">29.1.3 </span>User Interface for Stored Outline Migration
                  </h4>
                  <div>
                     <p>You can use the <code class="codeph">DBMS_SPM</code> package to perform the stored outline migration. 
                     </p>
                     <div class="tblformalwide" id="GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224__BHCHCGEH">
                        <p class="titleintable">Table 29-2 DBMS_SPM Functions Relating to Stored Outline Migration</p>
                        <table cellpadding="4" cellspacing="0" class="FormalWide" title="DBMS_SPM Functions Relating to Stored Outline Migration" summary="DBMS_SPM functions" width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="35%" id="d148780e1114">DBMS_SPM Function</th>
                                 <th align="left" valign="bottom" width="65%" id="d148780e1117">Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="35%" id="d148780e1122" headers="d148780e1114 ">
                                    <p><code class="codeph">MIGRATE_STORED_OUTLINE</code></p>
                                 </td>
                                 <td align="left" valign="top" width="65%" headers="d148780e1122 d148780e1117 ">
                                    <p>Migrates existing stored outlines to plan baselines. </p>
                                    <p>Use either of the following formats:</p>
                                    <ul style="list-style-type: disc;">
                                       <li>
                                          <p>Specify outline name, SQL text, outline category, or all stored outlines.</p>
                                       </li>
                                       <li>
                                          <p>Specify a list of outline names.</p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="35%" id="d148780e1139" headers="d148780e1114 ">
                                    <p><code class="codeph">ALTER_SQL_PLAN_BASELINE</code></p>
                                 </td>
                                 <td align="left" valign="top" width="65%" headers="d148780e1139 d148780e1117 ">
                                    <p>Changes an attribute of a single plan or all plans associated with a SQL statement.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="35%" id="d148780e1147" headers="d148780e1114 ">
                                    <p><code class="codeph">DROP_MIGRATED_STORED_OUTLINE</code></p>
                                 </td>
                                 <td align="left" valign="top" width="65%" headers="d148780e1147 d148780e1117 ">
                                    <p>Drops stored outlines that have been migrated to SQL plan baselines. </p>
                                    <p>The function finds stored outlines marked as <code class="codeph">MIGRATED</code> in the <code class="codeph">DBA_OUTLINES</code> view, and then drops these outlines from the database.
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="section">
                        <p>You can control stored outline and plan baseline behavior with initialization and session parameters. <a href="migrating-stored-outlines.html#GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224__BHCHDHGI" title="Initialization parameters">Table 29-3</a> describes the relevant parameters. See <a href="migrating-stored-outlines.html#GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__BHCGABFC" title="Explains interaction of parameters">Table 29-5</a> and <a href="migrating-stored-outlines.html#GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__BHCHICAJ" title="Explains interaction of parameters">Table 29-6</a> for an explanation of how these parameter settings interact.
                        </p>
                        <div class="tblformalwide" id="GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224__BHCHDHGI">
                           <p class="titleintable">Table 29-3 Parameters Relating to Stored Outline Migration</p>
                           <table cellpadding="4" cellspacing="0" class="FormalWide" title="Parameters Relating to Stored Outline Migration" summary="Initialization parameters" width="100%" frame="hsides" border="1" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="45%" id="d148780e1191">Initialization or Session Parameter</th>
                                    <th align="left" valign="bottom" width="36%" id="d148780e1194">Description</th>
                                    <th align="left" valign="bottom" width="19%" id="d148780e1197">Parameter Type</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="45%" id="d148780e1202" headers="d148780e1191 ">
                                       <p><code class="codeph">CREATE_STORED_OUTLINES</code></p>
                                    </td>
                                    <td align="left" valign="top" width="36%" headers="d148780e1202 d148780e1194 ">
                                       <p>Determines whether Oracle Database automatically creates and stores an outline for each query submitted during the session.</p>
                                    </td>
                                    <td align="left" valign="top" width="19%" headers="d148780e1202 d148780e1197 ">
                                       <p>Initialization parameter</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="45%" id="d148780e1213" headers="d148780e1191 ">
                                       <p><code class="codeph">OPTIMIZER_CAPTURE_SQL_PLAN_BASELINES</code></p>
                                    </td>
                                    <td align="left" valign="top" width="36%" headers="d148780e1213 d148780e1194 ">
                                       <p>Enables or disables the automatic recognition of repeatable SQL statement and the generation of SQL plan baselines for these statements.</p>
                                    </td>
                                    <td align="left" valign="top" width="19%" headers="d148780e1213 d148780e1197 ">
                                       <p>Initialization parameter</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="45%" id="d148780e1224" headers="d148780e1191 ">
                                       <p><code class="codeph">OPTIMIZER_USE_SQL_PLAN_BASELINES</code></p>
                                    </td>
                                    <td align="left" valign="top" width="36%" headers="d148780e1224 d148780e1194 ">
                                       <p>Enables or disables the use of SQL plan baselines stored in SQL Management Base.</p>
                                    </td>
                                    <td align="left" valign="top" width="19%" headers="d148780e1224 d148780e1197 ">
                                       <p>Initialization parameter</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="45%" id="d148780e1235" headers="d148780e1191 ">
                                       <p><code class="codeph">USE_STORED_OUTLINES</code></p>
                                    </td>
                                    <td align="left" valign="top" width="36%" headers="d148780e1235 d148780e1194 ">
                                       <p>Determines whether the optimizer uses stored outlines to generate execution plans.</p>
                                       <p><span class="bold">Note: </span>This is a <span class="italic">session</span> parameter, not an initialization parameter.
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="19%" headers="d148780e1235 d148780e1197 ">
                                       <p>Session</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>You can use database views to access information relating to stored outline migration. <a href="migrating-stored-outlines.html#GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224__BHCECCEC" title="Fixed views">Table 29-4</a> describes the following main views.
                        </p>
                        <div class="tblformal" id="GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224__BHCECCEC">
                           <p class="titleintable">Table 29-4 Views Relating to Stored Outline Migration</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="Views Relating to Stored Outline Migration" summary="Fixed views" width="100%" frame="hsides" border="1" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="35%" id="d148780e1269">View</th>
                                    <th align="left" valign="bottom" width="65%" id="d148780e1272">Description</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="35%" id="d148780e1277" headers="d148780e1269 ">
                                       <p><code class="codeph">DBA_OUTLINES</code></p>
                                    </td>
                                    <td align="left" valign="top" width="65%" headers="d148780e1277 d148780e1272 ">
                                       <p>Describes all stored outlines in the database.</p>
                                       <p>The <code class="codeph">MIGRATED</code> column is important for outline migration and shows one of the following values: <code class="codeph">NOT-MIGRATED</code> and <code class="codeph">MIGRATED</code>. When <code class="codeph">MIGRATED</code>, the stored outline has been migrated to a plan baseline and is not usable.
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="35%" id="d148780e1299" headers="d148780e1269 ">
                                       <p><code class="codeph">DBA_SQL_PLAN_BASELINES</code></p>
                                    </td>
                                    <td align="left" valign="top" width="65%" headers="d148780e1299 d148780e1272 ">
                                       <p>Displays information about the SQL plan baselines currently created for specific SQL statements.</p>
                                       <p>The <code class="codeph">ORIGIN</code> column 	indicates how the plan baseline was created. The value <code class="codeph">STORED-OUTLINE</code> indicates the baseline was created by migrating an outline.
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224__GUID-108E32D9-17DB-43D0-87EE-76314DD8D6E7">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="../arpls/DBMS_SPM.html#ARPLS150" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_SPM</code> package
                              </p>
                           </li>
                           <li>
                              <p><a href="../refrn/CREATE_STORED_OUTLINES.html#GUID-896CCB6B-6FBC-46B9-93DB-71AD1013E6D5" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">CREATE_STORED_OUTLINES</code> initialization parameter
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="migrating-stored-outlines.html#GUID-51C91B71-B6AC-4AD1-AE9A-4FE19B86D8A7" title="A stored outline is a set of hints for a SQL statement.">About Stored Outline Migration</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL676"></a><div class="props_rev_3"><a id="GUID-B58E0B6B-5CFD-4C3A-8E91-ABCD49ADC8B8" name="GUID-B58E0B6B-5CFD-4C3A-8E91-ABCD49ADC8B8"></a><h4 id="TGSQL-GUID-B58E0B6B-5CFD-4C3A-8E91-ABCD49ADC8B8" class="sect4"><span class="enumeration_section">29.1.4 </span>Basic Steps in Stored Outline Migration
                  </h4>
                  <div>
                     <p>The basic process is to prepare, migrate, and then clean up.</p>
                     <p>The basic steps are as follows:</p>
                     <ol>
                        <li>
                           <p>Prepare for stored outline migration.</p>
                           <p>Review the migration prerequisites and determine how you want the migrated plan baselines to behave.</p>
                           <p>See <span class="q">"<a href="migrating-stored-outlines.html#GUID-729D65C2-5161-4229-BF71-5419B9FD1F85" title="The goal is preparation is determining which stored outlines are eligible for migration.">Preparing for Stored Outline Migration</a>"</span>.
                           </p>
                        </li>
                        <li>
                           <p>Perform either of the following tasks:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Migrate to baselines to use SQL Plan Management features.</p>
                                 <p>See <span class="q">"<a href="migrating-stored-outlines.html#GUID-58E6291D-F75D-44D7-A236-2E083ADAADC7" title="You can migrate stored outline to SQL plan baselines.">Migrating Outlines to Utilize SQL Plan Management Features</a>"</span>.
                                 </p>
                              </li>
                              <li>
                                 <p>Migrate to baselines while exactly preserving the behavior of the stored outlines.</p>
                                 <p>See <span class="q">"<a href="migrating-stored-outlines.html#GUID-28D3E0A0-429F-4F60-B732-621CCD6F0C17" title="You can migrate stored outlines to SQL plan baselines and preserve the original behavior of the stored outlines by creating fixed plan baselines.">Migrating Outlines to Preserve Stored Outline Behavior</a>"</span>.
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>Perform post-migration confirmation and cleanup.</p>
                           <p>See <span class="q">"<a href="migrating-stored-outlines.html#GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B" title="After migrating outlines to SQL plan baselines, you must perform some follow-up work.">Performing Follow-Up Tasks After Stored Outline Migration</a>"</span>.
                           </p>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="migrating-stored-outlines.html#GUID-51C91B71-B6AC-4AD1-AE9A-4FE19B86D8A7" title="A stored outline is a set of hints for a SQL statement.">About Stored Outline Migration</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL677"></a><div class="props_rev_3"><a id="GUID-729D65C2-5161-4229-BF71-5419B9FD1F85" name="GUID-729D65C2-5161-4229-BF71-5419B9FD1F85"></a><h3 id="TGSQL-GUID-729D65C2-5161-4229-BF71-5419B9FD1F85" class="sect3"><span class="enumeration_section">29.2 </span>Preparing for Stored Outline Migration
               </h3>
               <div>
                  <p>The goal is preparation is determining which stored outlines are eligible for migration.</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-729D65C2-5161-4229-BF71-5419B9FD1F85__GUID-22385205-797C-49EB-ACF7-2C4C5B484117">To prepare for stored outline migration:</p>
                     <ol>
                        <li>
                           <p>Connect SQL*Plus to the database with <code class="codeph">SYSDBA</code> privileges or the <code class="codeph">EXECUTE</code> privilege on the <code class="codeph">DBMS_SPM</code> package.
                           </p>
                        </li>
                        <li>
                           <p>Query the stored outlines in the database.</p>
                           <p>The following example queries all stored outlines that have not been migrated to SQL plan baselines:</p><pre class="pre codeblock"><code>SELECT NAME, CATEGORY, SQL_TEXT
FROM   DBA_OUTLINES
WHERE  MIGRATED = 'NOT-MIGRATED';
</code></pre></li>
                        <li>
                           <p>Determine which stored outlines meet the following prerequisites for migration eligibility:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The statement must <span class="italic">not</span> be a run-time <code class="codeph">INSERT AS SELECT</code> statement.
                                 </p>
                              </li>
                              <li>
                                 <p>The statement must <span class="italic">not</span> reference a remote object.
                                 </p>
                              </li>
                              <li>
                                 <p>This statement must <span class="italic">not</span> be a private stored outline.
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>Decide whether to migrate all outlines, specified stored outlines, or outlines belonging to a specified outline category.</p>
                           <p>If you do not decide to migrate all outlines, then identify the outlines or categories that you intend to migrate.</p>
                        </li>
                        <li>
                           <p>Decide whether the stored outlines migrated to SQL plan baselines use <strong class="term">fixed plans</strong> or <strong class="term">nonfixed plans</strong>:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Fixed plans</p>
                                 <p>A fixed plan is frozen. If a fixed plan is reproducible using the hints stored in plan baseline, then the optimizer always chooses the lowest-cost fixed plan baseline over plan baselines that are not fixed. Essentially, a fixed plan baseline acts as a stored outline with valid hints.</p>
                                 <p>A fixed plan is reproducible when the database can parse the statement based on the hints stored in the plan baseline and create a plan with the same plan hash value as the one in the plan baseline. If one of more of the hints become invalid, then the database may not be able to create a plan with the same plan hash value. In this case, the plan is nonreproducible. </p>
                                 <p>If a fixed plan cannot be reproduced when parsed using its hints, then the optimizer chooses a different plan, which can be either of the following:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>Another plan for the SQL plan baseline</p>
                                    </li>
                                    <li>
                                       <p>The current cost-based plan created by the optimizer</p>
                                    </li>
                                 </ul>
                                 <p>In some cases, a performance regression occurs because of the different plan, requiring SQL tuning.</p>
                              </li>
                              <li>
                                 <p>Nonfixed plans</p>
                                 <p>If a plan baseline does not contain fixed plans, then SQL Plan Management considers the plans equally when picking a plan for a SQL statement.</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>Before beginning the actual migration, ensure that the Oracle database meets the following prerequisites:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The database must be Enterprise Edition.</p>
                              </li>
                              <li>
                                 <p>The database must be open and <span class="italic">not</span> in a suspended state.
                                 </p>
                              </li>
                              <li>
                                 <p>The database must <span class="italic">not</span> be in restricted access (DBA), read-only, or migrate mode.
                                 </p>
                              </li>
                              <li>
                                 <p>Oracle Call Interface (OCI) must be available.</p>
                              </li>
                           </ul>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-729D65C2-5161-4229-BF71-5419B9FD1F85__GUID-96EDF70D-2FBB-42BB-A585-0764ED151837">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="../admin/getting-started-with-database-administration.html#ADMIN11046" target="_blank"><span><cite>Oracle Database Administrators Guide</cite></span></a> to learn about administrator privileges
                           </p>
                        </li>
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=REFRN23153" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">DBA_OUTLINES</code> views
                           </p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="migrating-stored-outlines.html#GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A" title="Stored outline migration is the user-initiated process of converting stored outlines to SQL plan baselines. A SQL plan baseline is a set of plans proven to provide optimal performance.">Migrating Stored Outlines to SQL Plan Baselines</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="TGSQL94976"></a><a id="TGSQL678"></a><div class="props_rev_3"><a id="GUID-58E6291D-F75D-44D7-A236-2E083ADAADC7" name="GUID-58E6291D-F75D-44D7-A236-2E083ADAADC7"></a><h3 id="TGSQL-GUID-58E6291D-F75D-44D7-A236-2E083ADAADC7" class="sect3"><span class="enumeration_section">29.3 </span>Migrating Outlines to Utilize SQL Plan Management Features
               </h3>
               <div>
                  <p>You can migrate stored outline to SQL plan baselines.</p>
                  <div class="section">
                     <p>The goals of this task are as follows:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>To allow SQL Plan Management to select from all plans in a plan baseline for a SQL statement instead of applying the same fixed plan after migration</p>
                        </li>
                        <li>
                           <p>To allow the SQL plan baseline to evolve in the face of database changes by adding new plans to the baseline</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-58E6291D-F75D-44D7-A236-2E083ADAADC7__GUID-66814776-0A59-4593-BA34-BE49F6BCA2E2">Assumptions</p>
                     <p>This tutorial assumes the following:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>You migrate all outlines. </p>
                           <p>To migrate specific outlines, use the <code class="codeph">DBMS_SPM.MIGRATE_STORED_OUTLINE</code> function.
                           </p>
                        </li>
                        <li>
                           <p>You want the module names of the baselines to be identical to the category names of the migrated outlines.</p>
                        </li>
                        <li>
                           <p>You do <span class="italic">not</span> want the SQL plans to be fixed.
                           </p>
                           <p>By default, generated plans are not fixed and SQL Plan Management considers all plans equally when picking a plan for a SQL statement. This situation permits the advanced feature of plan evolution to capture new plans for a SQL statement, verify their performance, and accept these new plans into the plan baseline.</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-58E6291D-F75D-44D7-A236-2E083ADAADC7__GUID-03BECFDC-884B-459A-BD8B-4E37B388BD51">To migrate stored outlines to SQL plan baselines:</p>
                     <ol>
                        <li>
                           <p>Connect SQL*Plus to the database with the appropriate privileges.</p>
                        </li>
                        <li>
                           <p>Call PL/SQL function <code class="codeph">MIGRATE_STORED_OUTLINE</code>.
                           </p>
                           <p>The following sample PL/SQL block migrates all stored outlines to fixed baselines:</p><pre class="pre codeblock"><code>DECLARE
  my_report CLOB;
BEGIN
  my_outlines := DBMS_SPM.MIGRATE_STORED_OUTLINE( 
                   attribute_name =&gt; 'all' );
END;
/</code></pre></li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-58E6291D-F75D-44D7-A236-2E083ADAADC7__GUID-163A092C-10B5-42E3-A058-632679296367">
                     <p class="notep1">See Also:</p>
                     <p></p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS150" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_SPM</code> package
                           </p>
                        </li>
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=SQLRF00902" target="_blank"><span><cite>Oracle Database SQL Language Reference</cite></span></a> to learn about the <code class="codeph">ALTER SYSTEM</code> statement
                           </p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="migrating-stored-outlines.html#GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A" title="Stored outline migration is the user-initiated process of converting stored outlines to SQL plan baselines. A SQL plan baseline is a set of plans proven to provide optimal performance.">Migrating Stored Outlines to SQL Plan Baselines</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="TGSQL94977"></a><a id="TGSQL679"></a><div class="props_rev_3"><a id="GUID-28D3E0A0-429F-4F60-B732-621CCD6F0C17" name="GUID-28D3E0A0-429F-4F60-B732-621CCD6F0C17"></a><h3 id="TGSQL-GUID-28D3E0A0-429F-4F60-B732-621CCD6F0C17" class="sect3"><span class="enumeration_section">29.4 </span>Migrating Outlines to Preserve Stored Outline Behavior
               </h3>
               <div>
                  <p>You can migrate stored outlines to SQL plan baselines and preserve the original behavior of the stored outlines by creating fixed plan baselines. </p>
                  <div class="section">
                     <p>A fixed plan has higher priority over other plans for the same SQL statement. If a plan is fixed, then the plan baseline cannot be evolved. The database does not add new plans to a plan baseline that contains a fixed plan.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-28D3E0A0-429F-4F60-B732-621CCD6F0C17__GUID-139F0130-0CDB-4C84-A75C-E31DC1702499">Assumptions</p>
                     <p>This tutorial assumes the following:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>You want to migrate only the stored outlines in the category named <code class="codeph">firstrow</code>. 
                           </p>
                        </li>
                        <li>
                           <p>You want the module names of the baselines to be identical to the category names of the migrated outlines.</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-28D3E0A0-429F-4F60-B732-621CCD6F0C17__GUID-8AF5D896-BF36-4ABC-97AE-60D4E2ED4689">To migrate stored outlines to plan baselines:</p>
                     <ol>
                        <li>
                           <p>Connect SQL*Plus to the database with the appropriate privileges.</p>
                        </li>
                        <li>
                           <p>Call PL/SQL function <code class="codeph">MIGRATE_STORED_OUTLINE</code>.
                           </p>
                           <p>The following sample PL/SQL block migrates stored outlines in the category <code class="codeph">firstrow</code> to fixed baselines:
                           </p><pre class="pre codeblock"><code>DECLARE
  my_report CLOB;
BEGIN
  my_outlines := DBMS_SPM.MIGRATE_STORED_OUTLINE( 
    attribute_name =&gt; 'category', 
    attribute_value =&gt; 'firstrow',
    fixed =&gt; 'YES' );
END;
/
</code></pre><p>After migration, the SQL plan baselines is in module <code class="codeph">firstrow</code> and category <code class="codeph">DEFAULT</code>.
                           </p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-28D3E0A0-429F-4F60-B732-621CCD6F0C17__GUID-D51302BF-3786-44A3-898A-C2640025F23F">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="../arpls/DBMS_SPM.html#ARPLS150" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for syntax and semantics of the <code class="codeph">DBMS_SPM.MIGRATE_STORED_OUTLINE</code> function
                           </p>
                        </li>
                        <li>
                           <p><a href="../sqlrf/ALTER-SYSTEM.html#SQLRF00902" target="_blank"><span><cite>Oracle Database SQL Language Reference</cite></span></a> to learn about the <code class="codeph">ALTER SYSTEM</code> statement
                           </p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="migrating-stored-outlines.html#GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A" title="Stored outline migration is the user-initiated process of converting stored outlines to SQL plan baselines. A SQL plan baseline is a set of plans proven to provide optimal performance.">Migrating Stored Outlines to SQL Plan Baselines</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="TGSQL681"></a><a id="TGSQL682"></a><a id="TGSQL94978"></a><a id="TGSQL680"></a><div class="props_rev_3"><a id="GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B" name="GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B"></a><h3 id="TGSQL-GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B" class="sect3"><span class="enumeration_section">29.5 </span>Performing Follow-Up Tasks After Stored Outline Migration
               </h3>
               <div>
                  <p>After migrating outlines to SQL plan baselines, you must perform some follow-up work.</p>
                  <div class="section">
                     <p>The goals of this task are as follows:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>To configure the database to use plan baselines instead of stored outlines for stored outlines that have been migrated to SQL plan baselines</p>
                        </li>
                        <li>
                           <p>To create SQL plan baselines instead of stored outlines for future SQL statements</p>
                        </li>
                        <li>
                           <p>To drop the stored outlines that have been migrated to SQL plan baselines</p>
                        </li>
                     </ul>
                     <p>This section explains how to set initialization parameters relating to stored outlines and plan baselines. The <code class="codeph">OPTIMIZER_CAPTURE_SQL_PLAN_BASELINES</code> and <code class="codeph">CREATE_STORED_OUTLINES</code> initialization parameters determine how and when the database creates stored outlines and SQL plan baselines. <a href="migrating-stored-outlines.html#GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__BHCGABFC" title="Explains interaction of parameters">Table 29-5</a> explains the interaction between these parameters.
                     </p>
                     <div class="tblformal" id="GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__BHCGABFC">
                        <p class="titleintable">Table 29-5 Creation of Outlines and Baselines</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="Creation of Outlines and Baselines" summary="Explains interaction of parameters" width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="24%" id="d148780e2285">CREATE_STORED_OUTLINES Initialization Parameter</th>
                                 <th align="left" valign="bottom" width="28%" id="d148780e2288">OPTIMIZER_CAPTURE_SQL_PLAN_BASELINES Initialization Parameter</th>
                                 <th align="left" valign="bottom" width="48%" id="d148780e2291">Database Behavior</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d148780e2296" headers="d148780e2285 ">
                                    <p><code class="codeph">false</code></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2296 d148780e2288 ">
                                    <p><code class="codeph">false</code></p>
                                 </td>
                                 <td align="left" valign="top" width="48%" headers="d148780e2296 d148780e2291 ">
                                    <p>When executing a SQL statement, the database does not create stored outlines or SQL plan baselines.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d148780e2308" headers="d148780e2285 ">
                                    <p><code class="codeph">false</code></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2308 d148780e2288 ">
                                    <p><code class="codeph">true</code></p>
                                 </td>
                                 <td align="left" valign="top" width="48%" headers="d148780e2308 d148780e2291 ">
                                    <p>The automatic recognition of repeatable SQL statements and the generation of SQL plan baselines for these statements is enabled. When executing a SQL statement, the database creates only new SQL plan baselines (if they do not exist) with the category name <code class="codeph">DEFAULT</code> for the statement.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d148780e2323" headers="d148780e2285 ">
                                    <p><code class="codeph">true</code></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2323 d148780e2288 ">
                                    <p><code class="codeph">false</code></p>
                                 </td>
                                 <td align="left" valign="top" width="48%" headers="d148780e2323 d148780e2291 ">
                                    <p>Oracle Database automatically creates and stores an outline for each query submitted during the session. When executing a SQL statement, the database creates only new stored outlines (if they do not exist) with the category name <code class="codeph">DEFAULT</code> for the statement.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d148780e2338" headers="d148780e2285 ">
                                    <p><span class="italic"><code class="codeph">category</code></span></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2338 d148780e2288 ">
                                    <p><code class="codeph">false</code></p>
                                 </td>
                                 <td align="left" valign="top" width="48%" headers="d148780e2338 d148780e2291 ">
                                    <p>When executing a SQL statement, the database creates only new stored outlines (if they do not exist) with the specified category name for the statement.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d148780e2351" headers="d148780e2285 ">
                                    <p><code class="codeph">true</code></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2351 d148780e2288 ">
                                    <p><code class="codeph">true</code></p>
                                 </td>
                                 <td align="left" valign="top" width="48%" headers="d148780e2351 d148780e2291 ">
                                    <p>Oracle Database automatically creates and stores an outline for each query submitted during the session. The automatic recognition of repeatable SQL statements and the generation of SQL plan baselines for these statements is also enabled.</p>
                                    <p>When executing a SQL statement, the database creates both stored outlines and SQL plan baselines with the category name <code class="codeph">DEFAULT</code>.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d148780e2368" headers="d148780e2285 ">
                                    <p><span class="italic"><code class="codeph">category</code></span></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2368 d148780e2288 ">
                                    <p><code class="codeph">true</code></p>
                                 </td>
                                 <td align="left" valign="top" width="48%" headers="d148780e2368 d148780e2291 ">
                                    <p>Oracle Database automatically creates and stores an outline for each query submitted during the session. The automatic recognition of repeatable SQL statements and the generation of SQL plan baselines for these statements is also enabled.</p>
                                    <p>When executing a SQL statement, the database creates stored outlines with the specified category name and SQL plan baselines with the category name <code class="codeph">DEFAULT</code>.
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>The <code class="codeph">USE_STORED_OUTLINES</code> session parameter (it is <span class="italic">not</span> an initialization parameter) and <code class="codeph">OPTIMIZER_USE_SQL_PLAN_BASELINES</code> initialization parameter determine how the database uses stored outlines and plan baselines. <a href="migrating-stored-outlines.html#GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__BHCHICAJ" title="Explains interaction of parameters">Table 29-6</a> explains how these parameters interact.
                     </p>
                     <div class="tblformal" id="GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__BHCHICAJ">
                        <p class="titleintable">Table 29-6 Use of Stored Outlines and SQL Plan Baselines</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="Use of Stored Outlines and SQL Plan Baselines" summary="Explains interaction of parameters" width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="31%" id="d148780e2412">USE_STORED_OUTLINES Session Parameter</th>
                                 <th align="left" valign="bottom" width="28%" id="d148780e2415">OPTIMIZER_USE_SQL_PLAN_BASELINES Initialization Parameter</th>
                                 <th align="left" valign="bottom" width="41%" id="d148780e2418">Database Behavior</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d148780e2423" headers="d148780e2412 ">
                                    <p><code class="codeph">false</code></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2423 d148780e2415 ">
                                    <p><code class="codeph">false</code></p>
                                 </td>
                                 <td align="left" valign="top" width="41%" headers="d148780e2423 d148780e2418 ">
                                    <p>When choosing a plan for a SQL statement, the database does not use stored outlines or plan baselines.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d148780e2435" headers="d148780e2412 ">
                                    <p><code class="codeph">false</code></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2435 d148780e2415 ">
                                    <p><code class="codeph">true</code></p>
                                 </td>
                                 <td align="left" valign="top" width="41%" headers="d148780e2435 d148780e2418 ">
                                    <p>When choosing a plan for a SQL statement, the database uses only SQL plan baselines.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d148780e2447" headers="d148780e2412 ">
                                    <p><code class="codeph">true</code></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2447 d148780e2415 ">
                                    <p><code class="codeph">false</code></p>
                                 </td>
                                 <td align="left" valign="top" width="41%" headers="d148780e2447 d148780e2418 ">
                                    <p>When choosing a plan for a SQL statement, the database uses stored outlines with the category name <code class="codeph">DEFAULT</code>.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d148780e2462" headers="d148780e2412 ">
                                    <p><span class="italic"><code class="codeph">category</code></span></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2462 d148780e2415 ">
                                    <p><code class="codeph">false</code></p>
                                 </td>
                                 <td align="left" valign="top" width="41%" headers="d148780e2462 d148780e2418 ">
                                    <p>When choosing a plan for a SQL statement, the database uses stored outlines with the specified category name.</p>
                                    <p>If a stored outline with the specified category name does not exist, then the database uses a stored outline in the <code class="codeph">DEFAULT</code> category if it exists.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d148780e2480" headers="d148780e2412 ">
                                    <p><code class="codeph">true</code></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2480 d148780e2415 ">
                                    <p><code class="codeph">true</code></p>
                                 </td>
                                 <td align="left" valign="top" width="41%" headers="d148780e2480 d148780e2418 ">
                                    <p>When choosing a plan for a SQL statement, stored outlines take priority over plan baselines. </p>
                                    <p>If a stored outline with the category name <code class="codeph">DEFAULT</code> exists for the statement and is applicable, then the database applies the stored outline. Otherwise, the database uses SQL plan baselines. However, if the stored outline has the property <code class="codeph">MIGRATED</code>, then the database does not use the outline and uses the corresponding SQL plan baseline instead (if it exists).
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d148780e2500" headers="d148780e2412 ">
                                    <p><span class="italic"><code class="codeph">category</code></span></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2500 d148780e2415 ">
                                    <p><code class="codeph">true</code></p>
                                 </td>
                                 <td align="left" valign="top" width="41%" headers="d148780e2500 d148780e2418 ">
                                    <p>When choosing a plan for a SQL statement, stored outlines take priority over plan baselines. </p>
                                    <p>If a stored outline with the specified category name or the <code class="codeph">DEFAULT</code> category exists for the statement and is applicable, then the database applies the stored outline. Otherwise, the database uses SQL plan baselines. However, if the stored outline has the property <code class="codeph">MIGRATED</code>, then the database does not use the outline and uses the corresponding SQL plan baseline instead (if it exists).
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__GUID-A410D93F-2CF9-475D-A5C1-64B29086CD43">Assumptions</p>
                     <p>This tutorial assumes the following:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>You have completed the basic steps in the stored outline migration.</p>
                        </li>
                        <li>
                           <p>Some stored outlines may have been created before Oracle Database 10<span class="italic">g</span>.
                           </p>
                           <p>Hints in releases before Oracle Database 10<span class="italic">g</span> use a local hint format. After migration, hints stored in a plan baseline use the global hints format introduced in Oracle Database 10<span class="italic">g</span>.
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__GUID-1DF40F9F-53A7-41EA-AEFF-CB7BA42E849C">To place the database in the proper state after the migration:</p>
                     <ol>
                        <li>
                           <p>Connect SQL*Plus to the database with the appropriate privileges, and then check that SQL plan baselines have been created as the result of migration.</p>
                           <p>Ensure that the plans are enabled and accepted. For example, enter the following query (partial sample output included):</p><pre class="pre codeblock"><code>SELECT SQL_HANDLE, PLAN_NAME, ORIGIN, ENABLED, ACCEPTED, FIXED, MODULE
FROM   DBA_SQL_PLAN_BASELINES;

SQL_HANDLE                PLAN_NAME  ORIGIN         ENA ACC FIX MODULE
------------------------- ---------- -------------- --- --- --- ------
SYS_SQL_f44779f7089c8fab  STMT01     STORED-OUTLINE YES YES NO  DEFAULT
.
.
.
</code></pre></li>
                        <li>
                           <p>Optionally, change the attributes of the SQL plan baselines.</p>
                           <p>For example, the following statement changes the status of the baseline for the specified SQL statement to <code class="codeph">fixed</code>:
                           </p><pre class="pre codeblock"><code>DECLARE
  v_cnt PLS_INTEGER;
BEGIN 
  v_cnt := DBMS_SPM.ALTER_SQL_PLAN_BASELINE(               
                           sql_handle=&gt;'SYS_SQL_f44779f7089c8fab', 
                           attribute_name=&gt;'FIXED', 
                           attribute_value=&gt;'NO');
  DBMS_OUTPUT.PUT_LINE('Plans altered: ' || v_cnt);
END;
/
</code></pre></li>
                        <li>
                           <p>Check the status of the original stored outlines.</p>
                           <p>For example, enter the following query (partial sample output included):</p><pre class="pre codeblock"><code>SELECT NAME, OWNER, CATEGORY, USED, MIGRATED 
FROM   DBA_OUTLINES
ORDER BY NAME;

NAME       OWNER      CATEGORY   USED   MIGRATED
---------- ---------- ---------- ------ ------------
STMT01     SYS        DEFAULT    USED   MIGRATED
STMT02     SYS        DEFAULT    USED   MIGRATED
.
.
.
</code></pre></li>
                        <li>
                           <p>Drop all stored outlines that have been migrated to SQL plan baselines.</p>
                           <p>For example, the following statements drops all stored outlines with status <code class="codeph">MIGRATED</code> in <code class="codeph">DBA_OUTLINES</code>:
                           </p><pre class="pre codeblock"><code>DECLARE
  v_cnt PLS_INTEGER;
BEGIN 
  v_cnt := DBMS_SPM.DROP_MIGRATED_STORED_OUTLINE();
  DBMS_OUTPUT.PUT_LINE('Migrated stored outlines dropped: ' || v_cnt);
END;
/
</code></pre></li>
                        <li>
                           <p>	Set initialization parameters so that:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>When executing a SQL statement, the database creates plan baselines but does not create stored outlines.</p>
                              </li>
                              <li>
                                 <p>The database only uses stored outlines when the equivalent SQL plan baselines do not exist.</p>
                              </li>
                           </ul>
                           <p>For example, the following SQL statements instruct the database to create SQL plan baselines instead of stored outlines when a SQL statement is executed. The example also instructs the database to apply a stored outline in category <code class="codeph">allrows</code> or <code class="codeph">DEFAULT</code> only if it exists and has not been migrated to a SQL plan baseline. In other cases, the database applies SQL plan baselines instead.
                           </p><pre class="pre codeblock"><code>ALTER SYSTEM 
  SET CREATE_STORED_OUTLINE = false SCOPE = BOTH;

ALTER SYSTEM 
  SET OPTIMIZER_CAPTURE_SQL_PLAN_BASELINES = true SCOPE = BOTH;

ALTER SYSTEM 
   SET OPTIMIZER_USE_SQL_PLAN_BASELINES = true SCOPE = BOTH;

ALTER SESSION
   SET USE_STORED_OUTLINES = allrows SCOPE = BOTH;</code></pre></li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__GUID-E6FBB485-2D06-4F8F-8CC8-70CEE2554750">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><span class="q">"<a href="migrating-stored-outlines.html#GUID-B58E0B6B-5CFD-4C3A-8E91-ABCD49ADC8B8" title="The basic process is to prepare, migrate, and then clean up.">Basic Steps in Stored Outline Migration</a>"</span></p>
                        </li>
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS150" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> to learn about the <code class="codeph">DBMS_SPM</code> package
                           </p>
                        </li>
                        <li>
                           <p><a href="../refrn/CREATE_STORED_OUTLINES.html#GUID-896CCB6B-6FBC-46B9-93DB-71AD1013E6D5" target="_blank"><span><cite>Oracle Database Reference</cite></span></a> to learn about the <code class="codeph">CREATE_STORED_OUTLINES</code> initialization parameter
                           </p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="migrating-stored-outlines.html#GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A" title="Stored outline migration is the user-initiated process of converting stored outlines to SQL plan baselines. A SQL plan baseline is a set of plans proven to provide optimal performance.">Migrating Stored Outlines to SQL Plan Baselines</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>