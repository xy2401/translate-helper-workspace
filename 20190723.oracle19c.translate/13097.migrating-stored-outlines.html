<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="Stored outline migration is the user-initiated process of converting stored outlines to SQL plan baselines. A SQL plan baseline is a set of plans proven to provide optimal performance."></meta>
      <meta name="description" content="Stored outline migration is the user-initiated process of converting stored outlines to SQL plan baselines. A SQL plan baseline is a set of plans proven to provide optimal performance."></meta>
      <title>将存储的大纲迁移到SQL计划基准</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="SQL Tuning Guide"></meta>
      <meta property="og:description" content="Stored outline migration is the user-initiated process of converting stored outlines to SQL plan baselines. A SQL plan baseline is a set of plans proven to provide optimal performance."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="SQL Tuning Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="sql-tuning-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-31T14:57:08-08:00"></meta>
      <meta name="dcterms.title" content="SQL Tuning Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="2013, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96095-03"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="managing-sql-plan-baselines.html" title="Previous" type="text/html"></link>
      <link rel="next" href="glossary.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TGSQL"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="managing-sql-plan-baselines.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="glossary.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">SQL调优指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="sql-controls.html" property="item" typeof="WebPage"><span property="name">SQL管理对象</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">将存储的大纲迁移到SQL计划基准</li>
            </ol>
            <a id="GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A" name="GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A"></a><a id="TGSQL665"></a>
            
            <h2 id="TGSQL-GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A" class="sect2"><span class="enumeration_chapter">29将</span>存储的大纲迁移到SQL计划基准</h2>
         </header>
         <div class="ind">
            <div>
               <p><strong class="term">存储的大纲迁移</strong>是用户启动的将存储的大纲转换为SQL计划基线的过程。SQL计划基准是一组经证实可提供最佳性能的计划。
               </p>
               <div class="infoboxnote" id="GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A__GUID-18B7AD6D-603D-49F0-91D2-31C2074E6AEB">
                  <p class="notep1">注意：</p>
                  <p>从<span>Oracle Database 12c</span>开始，不推荐使用存储的大纲。有关替代方法，请参阅<span class="q">“将<a href="migrating-stored-outlines.html#GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A" title="存储的大纲迁移是用户启动的将存储的大纲转换为SQL计划基线的过程。SQL计划基准是一组经证实可提供最佳性能的计划。">存储的大纲迁移到SQL计划基准</a> ”</span> 。
                  </p>
               </div>
               <p>本章介绍与存储的大纲迁移相关的概念和任务。本章包含以下主题：</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="migrating-stored-outlines.html#GUID-51C91B71-B6AC-4AD1-AE9A-4FE19B86D8A7">关于存储大纲迁移</a><br><strong class="term">存储的大纲</strong>是SQL语句的一组提示。
                  </li>
                  <li class="ulchildlink"><a href="migrating-stored-outlines.html#GUID-729D65C2-5161-4229-BF71-5419B9FD1F85">准备存储大纲迁移</a><br>目标是准备确定哪些存储的轮廓符合迁移条件。
                  </li>
                  <li class="ulchildlink"><a href="migrating-stored-outlines.html#GUID-58E6291D-F75D-44D7-A236-2E083ADAADC7">迁移大纲以利用SQL计划管理功能</a><br>您可以将存储的大纲迁移到SQL计划基准。
                  </li>
                  <li class="ulchildlink"><a href="migrating-stored-outlines.html#GUID-28D3E0A0-429F-4F60-B732-621CCD6F0C17">迁移轮廓以保留存储的轮廓行为</a><br>您可以将存储的大纲迁移到SQL计划基准，并通过创建固定计划基准来保留存储的大纲的原始行为。
                  </li>
                  <li class="ulchildlink"><a href="migrating-stored-outlines.html#GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B">存储的大纲迁移后执行后续任务</a><br>将大纲迁移到SQL计划基准后，您必须执行一些后续工作。
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="sql-controls.html#GUID-2889EBC8-1FAD-412F-9779-865028473607" title="SQL管理对象是一种稳定单个SQL语句的执行计划的功能。SQL配置文件和SQL计划基准是SQL管理对象。">SQL管理对象</a></p>
                  </div>
               </div>
            </div>
            <a id="TGSQL666"></a><div class="props_rev_3"><a id="GUID-51C91B71-B6AC-4AD1-AE9A-4FE19B86D8A7" name="GUID-51C91B71-B6AC-4AD1-AE9A-4FE19B86D8A7"></a><h3 id="TGSQL-GUID-51C91B71-B6AC-4AD1-AE9A-4FE19B86D8A7" class="sect3"><span class="enumeration_section">29.1</span>关于存储大纲迁移</h3>
               <div>
                  <p><strong class="term">存储的大纲</strong>是SQL语句的一组提示。
                  </p>
                  <p>提示指示优化器为语句选择特定计划。存储的轮廓是用于提供计划稳定性的传统技术。</p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="migrating-stored-outlines.html#GUID-423948E7-64CF-43C8-9F0B-D7179E72EE91">存储大纲迁移的目的</a><br>如果您依赖存储的大纲来维护计划稳定性并防止性能下降，那么您可以安全地从存储的大纲迁移到SQL计划基准。迁移后，您可以保持相同的计划稳定性，同时受益于SQL计划管理框架提供的功能。
                     </li>
                     <li class="ulchildlink"><a href="migrating-stored-outlines.html#GUID-98986AFF-0E41-4FF9-A9A4-628D9C7FCE8E">存储大纲迁移的工作原理</a><br>存储的大纲迁移是一个用户启动的过程，经历了多个阶段。
                     </li>
                     <li class="ulchildlink"><a href="migrating-stored-outlines.html#GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224">存储大纲迁移的用户界面</a><br>您可以使用<code class="codeph">DBMS_SPM</code>程序包执行存储的大纲迁移。
                     </li>
                     <li class="ulchildlink"><a href="migrating-stored-outlines.html#GUID-B58E0B6B-5CFD-4C3A-8E91-ABCD49ADC8B8">存储大纲迁移的基本步骤</a><br>基本过程是准备，迁移，然后清理。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：将</strong> <a href="migrating-stored-outlines.html#GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A" title="存储的大纲迁移是用户启动的将存储的大纲转换为SQL计划基线的过程。SQL计划基准是一组经证实可提供最佳性能的计划。">存储的大纲迁移到SQL计划基准</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL667"></a><div class="props_rev_3"><a id="GUID-423948E7-64CF-43C8-9F0B-D7179E72EE91" name="GUID-423948E7-64CF-43C8-9F0B-D7179E72EE91"></a><h4 id="TGSQL-GUID-423948E7-64CF-43C8-9F0B-D7179E72EE91" class="sect4"><span class="enumeration_section">29.1.1</span>存储大纲迁移的目的</h4>
                  <div>
                     <p>如果您依赖存储的大纲来维护计划稳定性并防止性能下降，那么您可以安全地从存储的大纲迁移到SQL计划基准。迁移后，您可以保持相同的计划稳定性，同时受益于SQL计划管理框架提供的功能。</p>
                     <p>存储的轮廓具有以下缺点：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>存储的轮廓不能随着时间的推移自动发展。因此，存储的轮廓在创建时可能是最佳的，但在数据库更改后会成为次优计划，从而导致性能下降。</p>
                        </li>
                        <li>
                           <p>存储轮廓中的提示可能会变得无效，就像删除索引上的索引提示一样。在这种情况下，数据库仍然使用轮廓但排除了无效提示，产生的计划通常比原始计划或优化程序生成的当前最佳成本计划更差。</p>
                        </li>
                        <li>
                           <p>对于SQL语句，优化程序只能选择当前指定类别中存储大纲中定义的计划。优化程序无法从不同类别的其他存储轮廓或当前基于成本的计划中进行选择，即使它们可以提高性能。</p>
                        </li>
                        <li>
                           <p>存储的大纲是一种反应性调整技术，这意味着您只需使用存储的大纲来解决性能问题。例如，您可以实现存储的大纲来更正变为高负载的SQL语句的计划。在这种情况下，您使用存储的大纲而不是在语句变为高负载之前主动调整语句。</p>
                        </li>
                     </ul>
                     <p>存储的大纲迁移PL / SQL API通过以下方式帮助解决上述问题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>SQL计划基准使优化程序能够使用相同的最佳计划，并允许此计划随着时间的推移而发展。</p>
                           <p>对于指定的SQL语句，您可以在验证它们之后将新计划添加为SQL计划基准，以免导致性能下降。</p>
                        </li>
                        <li>
                           <p>SQL计划基准可防止计划因无效提示而无法生成。</p>
                           <p>如果存储在计划基准中的提示变为无效，则优化程序可能无法重现该计划。在这种情况下，优化程序会选择备用的可重现计划基准或优化程序生成的当前最佳成本计划。</p>
                        </li>
                        <li>
                           <p>对于特定的SQL语句，数据库可以维护多个计划基准。</p>
                           <p>优化程序可以从特定SQL语句的一组最佳计划中进行选择，而不是按存储的大纲要求限制为每个类别的单个计划。</p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="migrating-stored-outlines.html#GUID-51C91B71-B6AC-4AD1-AE9A-4FE19B86D8A7" title="存储的大纲是SQL语句的一组提示。">关于存储的大纲迁移</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL668"></a><div class="props_rev_3"><a id="GUID-98986AFF-0E41-4FF9-A9A4-628D9C7FCE8E" name="GUID-98986AFF-0E41-4FF9-A9A4-628D9C7FCE8E"></a><h4 id="TGSQL-GUID-98986AFF-0E41-4FF9-A9A4-628D9C7FCE8E" class="sect4"><span class="enumeration_section">29.1.2</span>存储大纲迁移的工作<span class="enumeration_section">原理</span></h4>
                  <div>
                     <p>存储的大纲迁移是一个用户启动的过程，经历了多个阶段。</p>
                     <p>本节介绍数据库如何将存储的轮廓迁移到SQL计划基准。此信息对于执行迁移存储的轮廓的任务非常重要。</p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="migrating-stored-outlines.html#GUID-0DB9A2C7-3173-4D21-98FE-65C83C8F8A8C">存储大纲迁移的阶段</a><br>要迁移存储的轮廓，请指定商店轮廓。然后，数据库将创建并更新SQL计划基准。
                        </li>
                        <li class="ulchildlink"><a href="migrating-stored-outlines.html#GUID-75F926D8-04DA-4B7F-B750-33BD4505771E">大纲类别和基准模块</a><br>大纲是一组提示，而SQL计划基准是一组计划。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="migrating-stored-outlines.html#GUID-51C91B71-B6AC-4AD1-AE9A-4FE19B86D8A7" title="存储的大纲是SQL语句的一组提示。">关于存储的大纲迁移</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL669"></a><div class="props_rev_3"><a id="GUID-0DB9A2C7-3173-4D21-98FE-65C83C8F8A8C" name="GUID-0DB9A2C7-3173-4D21-98FE-65C83C8F8A8C"></a><h5 id="TGSQL-GUID-0DB9A2C7-3173-4D21-98FE-65C83C8F8A8C" class="sect5"><span class="enumeration_section">29.1.2.1</span>存储大纲迁移的阶段</h5>
                     <div>
                        <p>要迁移存储的轮廓，请指定商店轮廓。然后，数据库将创建并更新SQL计划基准。</p>
                        <div class="figure" id="GUID-0DB9A2C7-3173-4D21-98FE-65C83C8F8A8C__GUID-AA907DD4-E803-458E-AD13-03D4A85A47B6">
                           <p class="titleinfigure">图29-1存储大纲迁移的阶段</p><img src="img/pfgrf231.gif" alt="下面是图29-1的描述" title="下面是图29-1的描述" longdesc="img_text/pfgrf231.html"><br><a href="img_text/pfgrf231.html">“图29-1存储轮廓迁移的阶段”的描述</a></div>
                        <!-- class="figure" -->
                        <p>迁移过程包括以下阶段：</p>
                        <ol>
                           <li>
                              <p>用户调用一个函数，指定要迁移的轮廓。</p>
                           </li>
                           <li>
                              <p>数据库按如下方式处理轮廓：</p>
                              <ol type="a">
                                 <li>
                                    <p>数据库复制计划基准所需的大纲中的信息。</p>
                                    <p>数据库直接复制或根据大纲中的信息进行计算。例如，SQL语句的文本存在于两个模式中，因此数据库可以将文本从大纲复制到基线。</p>
                                 </li>
                                 <li>
                                    <p>数据库重新提示提示以获取不在大纲中的信息。</p>
                                    <p>计划哈希值和计划成本不能从概要中的现有信息导出，这需要重新分析提示。</p>
                                 </li>
                                 <li>
                                    <p>数据库创建基线。</p>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>数据库在第一次选择SQL计划基准时执行SQL语句时获取缺少的信息。</p>
                              <p>编译环境和执行统计信息仅在解析和编译计划基准时在执行期间可用。</p>
                           </li>
                        </ol>
                        <p>只有在前面的阶段完成后才能完成迁移。</p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="migrating-stored-outlines.html#GUID-98986AFF-0E41-4FF9-A9A4-628D9C7FCE8E" title="存储的大纲迁移是一个用户启动的过程，经历了多个阶段。">存储大纲迁移的工作原理</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL671"></a><a id="TGSQL670"></a><div class="props_rev_3"><a id="GUID-75F926D8-04DA-4B7F-B750-33BD4505771E" name="GUID-75F926D8-04DA-4B7F-B750-33BD4505771E"></a><h5 id="TGSQL-GUID-75F926D8-04DA-4B7F-B750-33BD4505771E" class="sect5"><span class="enumeration_section">29.1.2.2</span>概述类别和基准模块</h5>
                     <div>
                        <p>大纲是一组提示，而SQL计划基准是一组计划。</p>
                        <p>由于它们是不同的技术，因此轮廓的某些功能并不完全映射到基线的功能。例如，单个SQL语句可以有多个轮廓，每个轮廓都在不同的轮廓<span class="bold">类别中</span> ，但目前基线存在的唯一类别是<code class="codeph">DEFAULT</code> 。</p>
                        <p>大纲类别的等效项是SQL计划基准的模块。<a href="migrating-stored-outlines.html#GUID-75F926D8-04DA-4B7F-B750-33BD4505771E__BHCEJBBI" title="大纲类别">表29-1</a>说明了大纲类别如何映射到模块。
                        </p>
                        <div class="tblformal" id="GUID-75F926D8-04DA-4B7F-B750-33BD4505771E__BHCEJBBI">
                           <p class="titleintable">表29-1大纲类别</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="大纲类别" width="100%" border="1" summary="Outline categories" frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="30%" id="d148780e908">概念</th>
                                    <th align="left" valign="bottom" width="30%" id="d148780e911">描述</th>
                                    <th align="left" valign="bottom" width="40%" id="d148780e914">默认值</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="30%" id="d148780e919" headers="d148780e908 ">
                                       <p>大纲类别</p>
                                    </td>
                                    <td align="left" valign="top" width="30%" headers="d148780e919 d148780e911 ">
                                       <p>为一组存储的轮廓指定用户定义的分组。</p>
                                       <p>您可以使用类别来维护SQL语句的不同存储大纲。例如，单个语句可以在<code class="codeph">OLTP</code>类别和<code class="codeph">DW</code>类别中具有轮廓。
                                       </p>
                                       <p>每个SQL语句都可以有一个或多个存储的轮廓。每个存储的轮廓都在一个且只有一个轮廓类别中。语句可以在不同类别中具有多个存储的轮廓，但每个语句的每个类别仅存在一个存储的轮廓。</p>
                                       <p>在迁移期间，数据库将每个大纲类别映射到SQL计划基准模块。</p>
                                    </td>
                                    <td align="left" valign="top" width="40%" headers="d148780e919 d148780e914 ">
                                       <p><code class="codeph">默认</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="30%" id="d148780e942" headers="d148780e908 ">
                                       <p>基线模块</p>
                                    </td>
                                    <td align="left" valign="top" width="30%" headers="d148780e942 d148780e911 ">
                                       <p>指定正在执行的高级功能。</p>
                                       <p>SQL计划基准可以属于一个且仅属于一个模块。</p>
                                    </td>
                                    <td align="left" valign="top" width="40%" headers="d148780e942 d148780e914 ">
                                       <p>将大纲迁移到SQL计划基准后，模块名称默认为大纲类别名称。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="30%" id="d148780e954" headers="d148780e908 ">
                                       <p>基线类别</p>
                                    </td>
                                    <td align="left" valign="top" width="30%" headers="d148780e954 d148780e911 ">
                                       <p>仅存在一个SQL计划基准类别。此类别名为<code class="codeph">DEFAULT</code> 。在存储的大纲迁移期间，SQL计划基准的模块名称将设置为存储的大纲的类别名称。
                                       </p>
                                       <p>语句可以在<code class="codeph">DEFAULT</code>类别中具有多个SQL计划基准。
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="40%" headers="d148780e954 d148780e914 ">
                                       <p><code class="codeph">默认</code></p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>将存储的轮廓迁移到SQL计划基准时，Oracle数据库会将每个大纲类别映射到具有相同名称的SQL计划基准模块。如下图所示，大纲类别<code class="codeph">OLTP</code>映射到基线模块<code class="codeph">OLTP</code> 。迁移后， <code class="codeph">DEFAULT</code>是一个包含所有SQL计划基准的超类别。
                        </p>
                        <div class="figure" id="GUID-75F926D8-04DA-4B7F-B750-33BD4505771E__GUID-5CBFB8FA-3B90-42C7-A5C6-3E29807A4599">
                           <p class="titleinfigure">图29-2 DEFAULT类别</p><img src="img/pfgrf230.gif" alt="下面是图29-2的描述" title="下面是图29-2的描述" longdesc="img_text/pfgrf230.html"><br><a href="img_text/pfgrf230.html">“图29-2默认类别”的说明</a></div>
                        <!-- class="figure" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="migrating-stored-outlines.html#GUID-98986AFF-0E41-4FF9-A9A4-628D9C7FCE8E" title="存储的大纲迁移是一个用户启动的过程，经历了多个阶段。">存储大纲迁移的工作原理</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="TGSQL673"></a><a id="TGSQL674"></a><a id="TGSQL675"></a><a id="TGSQL672"></a><div class="props_rev_3"><a id="GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224" name="GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224"></a><h4 id="TGSQL-GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224" class="sect4"><span class="enumeration_section">29.1.3</span>存储大纲迁移的用户界面</h4>
                  <div>
                     <p>您可以使用<code class="codeph">DBMS_SPM</code>程序包执行存储的大纲迁移。
                     </p>
                     <div class="tblformalwide" id="GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224__BHCHCGEH">
                        <p class="titleintable">表29-2与存储的大纲迁移相关的DBMS_SPM功能</p>
                        <table cellpadding="4" cellspacing="0" class="FormalWide" title="DBMS_SPM与存储的大纲迁移相关的功能" width="100%" border="1" summary="DBMS_SPM functions" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="35%" id="d148780e1114">DBMS_SPM功能</th>
                                 <th align="left" valign="bottom" width="65%" id="d148780e1117">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="35%" id="d148780e1122" headers="d148780e1114 ">
                                    <p><code class="codeph">MIGRATE_STORED_OUTLINE</code></p>
                                 </td>
                                 <td align="left" valign="top" width="65%" headers="d148780e1122 d148780e1117 ">
                                    <p>迁移现有存储的轮廓以规划基线。</p>
                                    <p>使用以下任一格式：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p>指定大纲名称，SQL文本，大纲类别或所有存储的大纲。</p>
                                       </li>
                                       <li>
                                          <p>指定大纲名称列表。</p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="35%" id="d148780e1139" headers="d148780e1114 ">
                                    <p><code class="codeph">ALTER_SQL_PLAN_BASELINE</code></p>
                                 </td>
                                 <td align="left" valign="top" width="65%" headers="d148780e1139 d148780e1117 ">
                                    <p>更改单个计划的属性或与SQL语句关联的所有计划。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="35%" id="d148780e1147" headers="d148780e1114 ">
                                    <p><code class="codeph">DROP_MIGRATED_STORED_OUTLINE</code></p>
                                 </td>
                                 <td align="left" valign="top" width="65%" headers="d148780e1147 d148780e1117 ">
                                    <p>删除已存储已迁移到SQL计划基准的轮廓。</p>
                                    <p>该函数发现存储概要标记为<code class="codeph">MIGRATED</code>在<code class="codeph">DBA_OUTLINES</code>视图，然后滴从数据库中这些轮廓。
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="section">
                        <p>您可以使用初始化和会话参数控制存储的大纲和计划基线行为。<a href="migrating-stored-outlines.html#GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224__BHCHDHGI" title="初始化参数">表29-3说明</a>了相关参数。有关这些参数设置如何交互的说明，请<a href="migrating-stored-outlines.html#GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__BHCGABFC" title="解释参数的相互作用">参见表29-5</a>和<a href="migrating-stored-outlines.html#GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__BHCHICAJ" title="解释参数的相互作用">表29-6</a> 。
                        </p>
                        <div class="tblformalwide" id="GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224__BHCHDHGI">
                           <p class="titleintable">表29-3存储的大纲迁移相关参数</p>
                           <table cellpadding="4" cellspacing="0" class="FormalWide" title="与存储的大纲迁移有关的参数" width="100%" border="1" summary="Initialization parameters" frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="45%" id="d148780e1191">初始化或会话参数</th>
                                    <th align="left" valign="bottom" width="36%" id="d148780e1194">描述</th>
                                    <th align="left" valign="bottom" width="19%" id="d148780e1197">参数类型</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="45%" id="d148780e1202" headers="d148780e1191 ">
                                       <p><code class="codeph">CREATE_STORED_OUTLINES</code></p>
                                    </td>
                                    <td align="left" valign="top" width="36%" headers="d148780e1202 d148780e1194 ">
                                       <p>确定Oracle数据库是否为会话期间提交的每个查询自动创建和存储大纲。</p>
                                    </td>
                                    <td align="left" valign="top" width="19%" headers="d148780e1202 d148780e1197 ">
                                       <p>初始化参数</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="45%" id="d148780e1213" headers="d148780e1191 ">
                                       <p><code class="codeph">OPTIMIZER_CAPTURE_SQL_PLAN_BASELINES</code></p>
                                    </td>
                                    <td align="left" valign="top" width="36%" headers="d148780e1213 d148780e1194 ">
                                       <p>启用或禁用可重复SQL语句的自动识别以及为这些语句生成SQL计划基准。</p>
                                    </td>
                                    <td align="left" valign="top" width="19%" headers="d148780e1213 d148780e1197 ">
                                       <p>初始化参数</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="45%" id="d148780e1224" headers="d148780e1191 ">
                                       <p><code class="codeph">OPTIMIZER_USE_SQL_PLAN_BASELINES</code></p>
                                    </td>
                                    <td align="left" valign="top" width="36%" headers="d148780e1224 d148780e1194 ">
                                       <p>启用或禁用SQL Management Base中存储的SQL计划基准的使用。</p>
                                    </td>
                                    <td align="left" valign="top" width="19%" headers="d148780e1224 d148780e1197 ">
                                       <p>初始化参数</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="45%" id="d148780e1235" headers="d148780e1191 ">
                                       <p><code class="codeph">USE_STORED_OUTLINES</code></p>
                                    </td>
                                    <td align="left" valign="top" width="36%" headers="d148780e1235 d148780e1194 ">
                                       <p>确定优化程序是否使用存储的轮廓生成执行计划。</p>
                                       <p><span class="bold">注意：</span>这是<span class="italic">会话</span>参数，而不是初始化参数。
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="19%" headers="d148780e1235 d148780e1197 ">
                                       <p>会议</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>您可以使用数据库视图来访问与存储的大纲迁移相关的信息。<a href="migrating-stored-outlines.html#GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224__BHCECCEC" title="固定视图">表29-4说明</a>了以下主要视图。
                        </p>
                        <div class="tblformal" id="GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224__BHCECCEC">
                           <p class="titleintable">表29-4与存储的大纲迁移相关的视图</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="与存储的大纲迁移有关的视图" width="100%" border="1" summary="Fixed views" frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="35%" id="d148780e1269">视图</th>
                                    <th align="left" valign="bottom" width="65%" id="d148780e1272">描述</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="35%" id="d148780e1277" headers="d148780e1269 ">
                                       <p><code class="codeph">DBA_OUTLINES</code></p>
                                    </td>
                                    <td align="left" valign="top" width="65%" headers="d148780e1277 d148780e1272 ">
                                       <p>描述数据库中所有存储的轮廓。</p>
                                       <p><code class="codeph">MIGRATED</code>列对轮廓偏移很重要，并显示以下值之一： <code class="codeph">NOT-MIGRATED</code>和<code class="codeph">MIGRATED</code> 。当<code class="codeph">MIGRATED</code> ，存储的大纲已迁移到计划基准并且不可用。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="35%" id="d148780e1299" headers="d148780e1269 ">
                                       <p><code class="codeph">DBA_SQL_PLAN_BASELINES</code></p>
                                    </td>
                                    <td align="left" valign="top" width="65%" headers="d148780e1299 d148780e1272 ">
                                       <p>显示有关当前为特定SQL语句创建的SQL计划基准的信息。</p>
                                       <p><code class="codeph">ORIGIN</code>列指示计划基线的创建方式。值<code class="codeph">STORED-OUTLINE</code>表示通过迁移轮廓创建基线。
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-44EABCC1-88B7-4447-9219-A9ABEF8AC224__GUID-108E32D9-17DB-43D0-87EE-76314DD8D6E7">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="../arpls/DBMS_SPM.html#ARPLS150" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_SPM</code>包</p>
                           </li>
                           <li>
                              <p><a href="../refrn/CREATE_STORED_OUTLINES.html#GUID-896CCB6B-6FBC-46B9-93DB-71AD1013E6D5" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">CREATE_STORED_OUTLINES</code>初始化参数</p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="migrating-stored-outlines.html#GUID-51C91B71-B6AC-4AD1-AE9A-4FE19B86D8A7" title="存储的大纲是SQL语句的一组提示。">关于存储的大纲迁移</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL676"></a><div class="props_rev_3"><a id="GUID-B58E0B6B-5CFD-4C3A-8E91-ABCD49ADC8B8" name="GUID-B58E0B6B-5CFD-4C3A-8E91-ABCD49ADC8B8"></a><h4 id="TGSQL-GUID-B58E0B6B-5CFD-4C3A-8E91-ABCD49ADC8B8" class="sect4"><span class="enumeration_section">29.1.4</span>存储大纲迁移的基本步骤</h4>
                  <div>
                     <p>基本过程是准备，迁移，然后清理。</p>
                     <p>基本步骤如下：</p>
                     <ol>
                        <li>
                           <p>准备存储的大纲迁移。</p>
                           <p>查看迁移先决条件并确定迁移计划基准的行为方式。</p>
                           <p>请参见<span class="q">“ <a href="migrating-stored-outlines.html#GUID-729D65C2-5161-4229-BF71-5419B9FD1F85" title="目标是准备确定哪些存储的轮廓符合迁移条件。">准备存储的大纲迁移</a> ”</span> 。
                           </p>
                        </li>
                        <li>
                           <p>执行以下任务之一：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>迁移到基准以使用SQL计划管理功能。</p>
                                 <p>请参阅<span class="q">“ <a href="migrating-stored-outlines.html#GUID-58E6291D-F75D-44D7-A236-2E083ADAADC7" title="您可以将存储的大纲迁移到SQL计划基准。">迁移大纲以利用SQL计划管理功能</a> ”</span> 。
                                 </p>
                              </li>
                              <li>
                                 <p>迁移到基线，同时完全保留存储的轮廓的行为。</p>
                                 <p>请参阅<span class="q">“ <a href="migrating-stored-outlines.html#GUID-28D3E0A0-429F-4F60-B732-621CCD6F0C17" title="您可以将存储的大纲迁移到SQL计划基准，并通过创建固定计划基准来保留存储的大纲的原始行为。">迁移轮廓以保留存储的轮廓行为</a> ”</span> 。
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>执行迁移后确认和清理。</p>
                           <p>请参阅<span class="q">“ <a href="migrating-stored-outlines.html#GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B" title="将大纲迁移到SQL计划基准后，您必须执行一些后续工作。">存储的大纲迁移后执行后续任务</a> ”</span> 。
                           </p>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="migrating-stored-outlines.html#GUID-51C91B71-B6AC-4AD1-AE9A-4FE19B86D8A7" title="存储的大纲是SQL语句的一组提示。">关于存储的大纲迁移</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL677"></a><div class="props_rev_3"><a id="GUID-729D65C2-5161-4229-BF71-5419B9FD1F85" name="GUID-729D65C2-5161-4229-BF71-5419B9FD1F85"></a><h3 id="TGSQL-GUID-729D65C2-5161-4229-BF71-5419B9FD1F85" class="sect3"><span class="enumeration_section">29.2</span>准备存储大纲迁移</h3>
               <div>
                  <p>目标是准备确定哪些存储的轮廓符合迁移条件。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-729D65C2-5161-4229-BF71-5419B9FD1F85__GUID-22385205-797C-49EB-ACF7-2C4C5B484117">准备存储的大纲迁移：</p>
                     <ol>
                        <li>
                           <p>使用<code class="codeph">SYSDBA</code>权限或<code class="codeph">DBMS_SPM</code>程序包的<code class="codeph">EXECUTE</code>权限将SQL * Plus连接到数据库。
                           </p>
                        </li>
                        <li>
                           <p>查询数据库中存储的轮廓。</p>
                           <p>以下示例查询尚未迁移到SQL计划基准的所有存储大纲：</p><pre class="pre codeblock"><code>SELECT NAME，CATEGORY，SQL_TEXT FROM DBA_OUTLINES MIGRATED ='NOT-MIGRATED';</code></pre></li>
                        <li>
                           <p>确定哪些存储的大纲符合迁移资格的以下先决条件：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>该语句<span class="italic">不能</span>是运行时<code class="codeph">INSERT AS SELECT</code>语句。
                                 </p>
                              </li>
                              <li>
                                 <p>该语句<span class="italic">不得</span>引用远程对象。
                                 </p>
                              </li>
                              <li>
                                 <p>此声明<span class="italic">不得</span>为私有存储大纲。
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>决定是否迁移属于指定大纲类别的所有轮廓，指定的存储轮廓或轮廓。</p>
                           <p>如果您不决定迁移所有大纲，请确定要迁移的大纲或类别。</p>
                        </li>
                        <li>
                           <p>确定迁移到SQL计划基准的存储轮廓是使用<strong class="term">固定计划</strong>还是非<strong class="term">固定计划</strong> ：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>固定计划</p>
                                 <p>固定计划被冻结。如果使用存储在计划基准中的提示可以重现固定计划，则优化程序始终选择最低成本的固定计划基准而不是未修复的计划基准。实质上，固定计划基线充当具有有效提示的存储轮廓。</p>
                                 <p>当数据库可以根据存储在计划基准中的提示解析语句并创建具有与计划基准中的计划哈希值相同的计划哈希值的计划时，可以重现固定计划。如果其中一个提示变为无效，则数据库可能无法创建具有相同计划哈希值的计划。在这种情况下，该计划是不可再现的。</p>
                                 <p>如果在使用其提示进行解析时无法再现固定计划，则优化程序会选择不同的计划，该计划可以是以下任一种：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>SQL计划基线的另一个计划</p>
                                    </li>
                                    <li>
                                       <p>当前基于成本的计划由优化程序创建</p>
                                    </li>
                                 </ul>
                                 <p>在某些情况下，由于计划不同而需要进行SQL调优，因此会发生性能回归。</p>
                              </li>
                              <li>
                                 <p>非固定计划</p>
                                 <p>如果计划基准不包含固定计划，则SQL计划管理在为SQL语句选择计划时会平等地考虑计划。</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>在开始实际迁移之前，请确保Oracle数据库满足以下先决条件：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>数据库必须是Enterprise Edition。</p>
                              </li>
                              <li>
                                 <p>数据库必须处于打开状态<span class="italic">且不</span>处于挂起状态。
                                 </p>
                              </li>
                              <li>
                                 <p>数据库<span class="italic">不得</span>处于受限访问（DBA），只读或迁移模式。
                                 </p>
                              </li>
                              <li>
                                 <p>Oracle调用接口（OCI）必须可用。</p>
                              </li>
                           </ul>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-729D65C2-5161-4229-BF71-5419B9FD1F85__GUID-96EDF70D-2FBB-42BB-A585-0764ED151837">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="../admin/getting-started-with-database-administration.html#ADMIN11046" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a> ，了解管理员权限</p>
                        </li>
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=REFRN23153" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">DBA_OUTLINES</code>视图</p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：将</strong> <a href="migrating-stored-outlines.html#GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A" title="存储的大纲迁移是用户启动的将存储的大纲转换为SQL计划基线的过程。SQL计划基准是一组经证实可提供最佳性能的计划。">存储的大纲迁移到SQL计划基准</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="TGSQL94976"></a><a id="TGSQL678"></a><div class="props_rev_3"><a id="GUID-58E6291D-F75D-44D7-A236-2E083ADAADC7" name="GUID-58E6291D-F75D-44D7-A236-2E083ADAADC7"></a><h3 id="TGSQL-GUID-58E6291D-F75D-44D7-A236-2E083ADAADC7" class="sect3"><span class="enumeration_section">29.3</span>迁移大纲以利用SQL计划管理功能</h3>
               <div>
                  <p>您可以将存储的大纲迁移到SQL计划基准。</p>
                  <div class="section">
                     <p>这项任务的目标如下：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>允许SQL计划管理从SQL语句的计划基准中的所有计划中进行选择，而不是在迁移后应用相同的固定计划</p>
                        </li>
                        <li>
                           <p>通过向基线添加新计划，允许SQL计划基线在数据库更改面前发展</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-58E6291D-F75D-44D7-A236-2E083ADAADC7__GUID-66814776-0A59-4593-BA34-BE49F6BCA2E2">假设</p>
                     <p>本教程假设以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>您迁移所有轮廓。</p>
                           <p>要迁移特定轮廓，请使用<code class="codeph">DBMS_SPM.MIGRATE_STORED_OUTLINE</code>函数。
                           </p>
                        </li>
                        <li>
                           <p>您希望基线的模块名称与迁移的轮廓的类别名称相同。</p>
                        </li>
                        <li>
                           <p>您<span class="italic">不</span>希望修复SQL计划。
                           </p>
                           <p>默认情况下，生成的计划不是固定的，SQL计划管理在为SQL语句选择计划时会平等地考虑所有计划。这种情况允许计划发展的高级功能捕获SQL语句的新计划，验证其性能，并将这些新计划接受到计划基准中。</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-58E6291D-F75D-44D7-A236-2E083ADAADC7__GUID-03BECFDC-884B-459A-BD8B-4E37B388BD51">要将存储的轮廓迁移到SQL计划基准：</p>
                     <ol>
                        <li>
                           <p>使用适当的权限将SQL * Plus连接到数据库。</p>
                        </li>
                        <li>
                           <p>调用PL / SQL函数<code class="codeph">MIGRATE_STORED_OUTLINE</code> 。</p>
                           <p>以下示例PL / SQL块将所有存储的轮廓迁移到固定基线：</p><pre class="pre codeblock"><code>DECLARE my_report CLOB; BEGIN my_outlines：= DBMS_SPM.MIGRATE_STORED_OUTLINE（attribute_name =&gt;'all'）;结束; /</code></pre></li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-58E6291D-F75D-44D7-A236-2E083ADAADC7__GUID-163A092C-10B5-42E3-A058-632679296367">
                     <p class="notep1">也可以看看：</p>
                     <p></p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS150" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_SPM</code>包</p>
                        </li>
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=SQLRF00902" target="_blank"><span><cite>Oracle Database SQL语言参考</cite></span></a> ，了解<code class="codeph">ALTER SYSTEM</code>语句</p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：将</strong> <a href="migrating-stored-outlines.html#GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A" title="存储的大纲迁移是用户启动的将存储的大纲转换为SQL计划基线的过程。SQL计划基准是一组经证实可提供最佳性能的计划。">存储的大纲迁移到SQL计划基准</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="TGSQL94977"></a><a id="TGSQL679"></a><div class="props_rev_3"><a id="GUID-28D3E0A0-429F-4F60-B732-621CCD6F0C17" name="GUID-28D3E0A0-429F-4F60-B732-621CCD6F0C17"></a><h3 id="TGSQL-GUID-28D3E0A0-429F-4F60-B732-621CCD6F0C17" class="sect3"><span class="enumeration_section">29.4</span>迁移轮廓以保留存储的轮廓行为</h3>
               <div>
                  <p>您可以将存储的大纲迁移到SQL计划基准，并通过创建固定计划基准来保留存储的大纲的原始行为。</p>
                  <div class="section">
                     <p>对于同一SQL语句，固定计划优先于其他计划。如果计划得到修复，那么计划基线就无法发展。数据库不会将新计划添加到包含固定计划的计划基准。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-28D3E0A0-429F-4F60-B732-621CCD6F0C17__GUID-139F0130-0CDB-4C84-A75C-E31DC1702499">假设</p>
                     <p>本教程假设以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>您只想迁移名为<code class="codeph">firstrow</code>的类别中存储的轮廓。
                           </p>
                        </li>
                        <li>
                           <p>您希望基线的模块名称与迁移的轮廓的类别名称相同。</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-28D3E0A0-429F-4F60-B732-621CCD6F0C17__GUID-8AF5D896-BF36-4ABC-97AE-60D4E2ED4689">要将存储的轮廓迁移到计划基线：</p>
                     <ol>
                        <li>
                           <p>使用适当的权限将SQL * Plus连接到数据库。</p>
                        </li>
                        <li>
                           <p>调用PL / SQL函数<code class="codeph">MIGRATE_STORED_OUTLINE</code> 。</p>
                           <p>以下示例PL / SQL块将<code class="codeph">firstrow</code>类别中存储的轮廓迁移到固定基线：</p><pre class="pre codeblock"><code>DECLARE my_report CLOB; BEGIN my_outlines：= DBMS_SPM.MIGRATE_STORED_OUTLINE（attribute_name =&gt;'category'，attribute_value =&gt;'firstrow'，fixed =&gt;'YES'）;结束; /</code></pre><p>迁移后，SQL计划基准位于模块<code class="codeph">firstrow</code>和类别<code class="codeph">DEFAULT</code> 。</p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-28D3E0A0-429F-4F60-B732-621CCD6F0C17__GUID-D51302BF-3786-44A3-898A-C2640025F23F">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="../arpls/DBMS_SPM.html#ARPLS150" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a> <code class="codeph">DBMS_SPM.MIGRATE_STORED_OUTLINE</code>函数的语法和语义</p>
                        </li>
                        <li>
                           <p><a href="../sqlrf/ALTER-SYSTEM.html#SQLRF00902" target="_blank"><span><cite>Oracle Database SQL语言参考</cite></span></a> ，了解<code class="codeph">ALTER SYSTEM</code>语句</p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：将</strong> <a href="migrating-stored-outlines.html#GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A" title="存储的大纲迁移是用户启动的将存储的大纲转换为SQL计划基线的过程。SQL计划基准是一组经证实可提供最佳性能的计划。">存储的大纲迁移到SQL计划基准</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="TGSQL681"></a><a id="TGSQL682"></a><a id="TGSQL94978"></a><a id="TGSQL680"></a><div class="props_rev_3"><a id="GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B" name="GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B"></a><h3 id="TGSQL-GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B" class="sect3"><span class="enumeration_section">29.5</span>存储轮廓迁移后执行后续任务</h3>
               <div>
                  <p>将大纲迁移到SQL计划基准后，您必须执行一些后续工作。</p>
                  <div class="section">
                     <p>这项任务的目标如下：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>配置数据库以使用计划基准，而不是已存储的已迁移到SQL计划基准的已存储轮廓的存储轮廓</p>
                        </li>
                        <li>
                           <p>为将来的SQL语句创建SQL计划基准而不是存储的轮廓</p>
                        </li>
                        <li>
                           <p>删除已迁移到SQL计划基准的已存储轮廓</p>
                        </li>
                     </ul>
                     <p>本节介绍如何设置与存储的轮廓和计划基线相关的初始化参数。<code class="codeph">OPTIMIZER_CAPTURE_SQL_PLAN_BASELINES</code>和<code class="codeph">CREATE_STORED_OUTLINES</code>初始化参数确定数据库创建存储的轮廓和SQL计划基线的方式和时间。<a href="migrating-stored-outlines.html#GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__BHCGABFC" title="解释参数的相互作用">表29-5</a>说明了这些参数之间的相互作用。
                     </p>
                     <div class="tblformal" id="GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__BHCGABFC">
                        <p class="titleintable">表29-5创建大纲和基线</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="创建大纲和基线" width="100%" border="1" summary="Explains interaction of parameters" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="24%" id="d148780e2285">CREATE_STORED_OUTLINES初始化参数</th>
                                 <th align="left" valign="bottom" width="28%" id="d148780e2288">OPTIMIZER_CAPTURE_SQL_PLAN_BASELINES初始化参数</th>
                                 <th align="left" valign="bottom" width="48%" id="d148780e2291">数据库行为</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d148780e2296" headers="d148780e2285 ">
                                    <p><code class="codeph">假</code></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2296 d148780e2288 ">
                                    <p><code class="codeph">假</code></p>
                                 </td>
                                 <td align="left" valign="top" width="48%" headers="d148780e2296 d148780e2291 ">
                                    <p>执行SQL语句时，数据库不会创建存储的大纲或SQL计划基准。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d148780e2308" headers="d148780e2285 ">
                                    <p><code class="codeph">假</code></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2308 d148780e2288 ">
                                    <p><code class="codeph">真正</code></p>
                                 </td>
                                 <td align="left" valign="top" width="48%" headers="d148780e2308 d148780e2291 ">
                                    <p>可以自动识别可重复的SQL语句并为这些语句生成SQL计划基准。执行SQL语句时，数据库仅创建具有该语句的类别名称<code class="codeph">DEFAULT</code>新SQL计划基准（如果它们不存在）。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d148780e2323" headers="d148780e2285 ">
                                    <p><code class="codeph">真正</code></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2323 d148780e2288 ">
                                    <p><code class="codeph">假</code></p>
                                 </td>
                                 <td align="left" valign="top" width="48%" headers="d148780e2323 d148780e2291 ">
                                    <p>Oracle数据库自动为会话期间提交的每个查询创建和存储大纲。执行SQL语句时，数据库仅创建新的存储轮廓（如果它们不存在），并且语句的类别名称为<code class="codeph">DEFAULT</code> 。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d148780e2338" headers="d148780e2285 ">
                                    <p><span class="italic"><code class="codeph">类别</code></span></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2338 d148780e2288 ">
                                    <p><code class="codeph">假</code></p>
                                 </td>
                                 <td align="left" valign="top" width="48%" headers="d148780e2338 d148780e2291 ">
                                    <p>执行SQL语句时，数据库仅创建具有指定的语句类别名称的新存储轮廓（如果它们不存在）。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d148780e2351" headers="d148780e2285 ">
                                    <p><code class="codeph">真正</code></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2351 d148780e2288 ">
                                    <p><code class="codeph">真正</code></p>
                                 </td>
                                 <td align="left" valign="top" width="48%" headers="d148780e2351 d148780e2291 ">
                                    <p>Oracle数据库自动为会话期间提交的每个查询创建和存储大纲。还启用了可重复SQL语句的自动识别以及这些语句的SQL计划基线的生成。</p>
                                    <p>执行SQL语句时，数据库会创建存储的大纲和SQL计划基线，类别名称为<code class="codeph">DEFAULT</code> 。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d148780e2368" headers="d148780e2285 ">
                                    <p><span class="italic"><code class="codeph">类别</code></span></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2368 d148780e2288 ">
                                    <p><code class="codeph">真正</code></p>
                                 </td>
                                 <td align="left" valign="top" width="48%" headers="d148780e2368 d148780e2291 ">
                                    <p>Oracle数据库自动为会话期间提交的每个查询创建和存储大纲。还启用了可重复SQL语句的自动识别以及这些语句的SQL计划基线的生成。</p>
                                    <p>执行SQL语句时，数据库会创建具有指定类别名称的存储大纲和具有类别名称<code class="codeph">DEFAULT</code> SQL计划基准。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p><code class="codeph">USE_STORED_OUTLINES</code>会话参数（它<span class="italic">不是</span>初始化参数）和<code class="codeph">OPTIMIZER_USE_SQL_PLAN_BASELINES</code>初始化参数确定数据库如何使用存储的轮廓和计划基线。<a href="migrating-stored-outlines.html#GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__BHCHICAJ" title="解释参数的相互作用">表29-6</a>说明了这些参数如何相互作用。
                     </p>
                     <div class="tblformal" id="GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__BHCHICAJ">
                        <p class="titleintable">表29-6存储的大纲和SQL计划基准的使用</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="使用存储的大纲和SQL计划基准" width="100%" border="1" summary="Explains interaction of parameters" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="31%" id="d148780e2412">USE_STORED_OUTLINES会话参数</th>
                                 <th align="left" valign="bottom" width="28%" id="d148780e2415">OPTIMIZER_USE_SQL_PLAN_BASELINES初始化参数</th>
                                 <th align="left" valign="bottom" width="41%" id="d148780e2418">数据库行为</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d148780e2423" headers="d148780e2412 ">
                                    <p><code class="codeph">假</code></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2423 d148780e2415 ">
                                    <p><code class="codeph">假</code></p>
                                 </td>
                                 <td align="left" valign="top" width="41%" headers="d148780e2423 d148780e2418 ">
                                    <p>在为SQL语句选择计划时，数据库不使用存储的轮廓或计划基线。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d148780e2435" headers="d148780e2412 ">
                                    <p><code class="codeph">假</code></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2435 d148780e2415 ">
                                    <p><code class="codeph">真正</code></p>
                                 </td>
                                 <td align="left" valign="top" width="41%" headers="d148780e2435 d148780e2418 ">
                                    <p>为SQL语句选择计划时，数据库仅使用SQL计划基准。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d148780e2447" headers="d148780e2412 ">
                                    <p><code class="codeph">真正</code></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2447 d148780e2415 ">
                                    <p><code class="codeph">假</code></p>
                                 </td>
                                 <td align="left" valign="top" width="41%" headers="d148780e2447 d148780e2418 ">
                                    <p>在为SQL语句选择计划时，数据库使用存储的大纲和类别名称<code class="codeph">DEFAULT</code> 。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d148780e2462" headers="d148780e2412 ">
                                    <p><span class="italic"><code class="codeph">类别</code></span></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2462 d148780e2415 ">
                                    <p><code class="codeph">假</code></p>
                                 </td>
                                 <td align="left" valign="top" width="41%" headers="d148780e2462 d148780e2418 ">
                                    <p>在为SQL语句选择计划时，数据库使用具有指定类别名称的存储轮廓。</p>
                                    <p>如果不存在具有指定类别名称的存储大纲，则数据库将使用<code class="codeph">DEFAULT</code>类别中存储的大纲（如果存在）。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d148780e2480" headers="d148780e2412 ">
                                    <p><code class="codeph">真正</code></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2480 d148780e2415 ">
                                    <p><code class="codeph">真正</code></p>
                                 </td>
                                 <td align="left" valign="top" width="41%" headers="d148780e2480 d148780e2418 ">
                                    <p>在为SQL语句选择计划时，存储的轮廓优先于计划基准。</p>
                                    <p>如果该语句存在具有类别名称<code class="codeph">DEFAULT</code>的存储大纲并且适用，则数据库将应用存储的大纲。否则，数据库使用SQL计划基准。但是，如果存储的大纲具有<code class="codeph">MIGRATED</code>属性，则数据库不使用大纲并使用相应的SQL计划基线（如果存在）。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="31%" id="d148780e2500" headers="d148780e2412 ">
                                    <p><span class="italic"><code class="codeph">类别</code></span></p>
                                 </td>
                                 <td align="left" valign="top" width="28%" headers="d148780e2500 d148780e2415 ">
                                    <p><code class="codeph">真正</code></p>
                                 </td>
                                 <td align="left" valign="top" width="41%" headers="d148780e2500 d148780e2418 ">
                                    <p>在为SQL语句选择计划时，存储的轮廓优先于计划基准。</p>
                                    <p>如果该语句存在具有指定类别名称或<code class="codeph">DEFAULT</code>类别的存储大纲并且适用，则数据库将应用存储的大纲。否则，数据库使用SQL计划基准。但是，如果存储的大纲具有<code class="codeph">MIGRATED</code>属性，则数据库不使用大纲并使用相应的SQL计划基线（如果存在）。
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__GUID-A410D93F-2CF9-475D-A5C1-64B29086CD43">假设</p>
                     <p>本教程假设以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>您已完成存储的大纲迁移中的基本步骤。</p>
                        </li>
                        <li>
                           <p>某些存储的轮廓可能是在Oracle Database <span class="italic">10g</span>之前创建的。
                           </p>
                           <p>Oracle Database <span class="italic">10g</span>之前的版本中的提示使用本地提示格式。迁移后，存储在计划基准中的提示使用Oracle数据库<span class="italic">10g中</span>引入的全局提示格式。
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__GUID-1DF40F9F-53A7-41EA-AEFF-CB7BA42E849C">要在迁移后将数据库置于正确的状态：</p>
                     <ol>
                        <li>
                           <p>使用适当的权限将SQL * Plus连接到数据库，然后检查是否已根据迁移创建了SQL计划基准。</p>
                           <p>确保已启用并接受计划。例如，输入以下查询（包括部分样本输出）：</p><pre class="pre codeblock"><code>从DBA_SQL_PLAN_BASELINES中选择SQL_HANDLE，PLAN_NAME，ORIGIN，ENABLED，ACCEPTED，FIXED，MODULE; SQL_HANDLE PLAN_NAME ORIGIN ENA ACC FIX MODULE ------------------------- ---------- -------- ------ --- --- --- ------ SYS_SQL_f44779f7089c8fab STMT01 STORED-OUTLINE YES YES NO DEFAULT。。。
</code></pre></li>
                        <li>
                           <p>（可选）更改SQL计划基准的属性。</p>
                           <p>例如，以下语句将指定SQL语句的基线状态更改为<code class="codeph">fixed</code> ：</p><pre class="pre codeblock"><code>DECLARE v_cnt PLS_INTEGER; BEGIN v_cnt：= DBMS_SPM.ALTER_SQL_PLAN_BASELINE（sql_handle =&gt;'SYS_SQL_f44779f7089c8fab'，attribute_name =&gt;'FIXED'，attribute_value =&gt;'NO'）; DBMS_OUTPUT.PUT_LINE（'计划已更改：'|| v_cnt）;结束; /</code></pre></li>
                        <li>
                           <p>检查原始存储轮廓的状态。</p>
                           <p>例如，输入以下查询（包括部分样本输出）：</p><pre class="pre codeblock"><code>选择名称，所有者，类别，使用，从名称移出DBA_OUTLINES;姓名所有者使用的移民类别---------- ---------- ---------- ------ --------- --- STMT01 SYS默认使用移动STMT02 SYS默认使用移动。。。
</code></pre></li>
                        <li>
                           <p>删除已迁移到SQL计划基准的所有存储轮廓。</p>
                           <p>例如，下面的语句删除与状态的所有存储概要<code class="codeph">MIGRATED</code>在<code class="codeph">DBA_OUTLINES</code> ：</p><pre class="pre codeblock"><code>DECLARE v_cnt PLS_INTEGER; BEGIN v_cnt：= DBMS_SPM.DROP_MIGRATED_STORED_OUTLINE（）; DBMS_OUTPUT.PUT_LINE（'已删除存储的已删除轮廓：'|| v_cnt）;结束; /</code></pre></li>
                        <li>
                           <p>设置初始化参数，以便：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>执行SQL语句时，数据库会创建计划基准，但不会创建存储的大纲。</p>
                              </li>
                              <li>
                                 <p>当等效的SQL计划基准不存在时，数据库仅使用存储的轮廓。</p>
                              </li>
                           </ul>
                           <p>例如，以下SQL语句指示数据库在执行SQL语句时创建SQL计划基准而不是存储的轮廓。该示例还指示数据库仅在类别为<code class="codeph">allrows</code>或<code class="codeph">DEFAULT</code>应用存储的大纲， <code class="codeph">allrows</code>是它存在且尚未迁移到SQL计划基准。在其他情况下，数据库会应用SQL计划基准。
                           </p><pre class="pre codeblock"><code>ALTER SYSTEM SET CREATE_STORED_OUTLINE = false SCOPE = BOTH; ALTER SYSTEM SET OPTIMIZER_CAPTURE_SQL_PLAN_BASELINES = true SCOPE = BOTH; ALTER SYSTEM SET OPTIMIZER_USE_SQL_PLAN_BASELINES = true SCOPE = BOTH; ALTER SESSION SET USE_STORED_OUTLINES = allrows SCOPE = BOTH;</code></pre></li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-37A25184-9436-4C3A-8BC2-76D9570EEA1B__GUID-E6FBB485-2D06-4F8F-8CC8-70CEE2554750">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="q">“ <a href="migrating-stored-outlines.html#GUID-B58E0B6B-5CFD-4C3A-8E91-ABCD49ADC8B8" title="基本过程是准备，迁移，然后清理。">存储大纲迁移的基本步骤</a> ”</span></p>
                        </li>
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS150" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_SPM</code>包</p>
                        </li>
                        <li>
                           <p><a href="../refrn/CREATE_STORED_OUTLINES.html#GUID-896CCB6B-6FBC-46B9-93DB-71AD1013E6D5" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">CREATE_STORED_OUTLINES</code>初始化参数</p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：将</strong> <a href="migrating-stored-outlines.html#GUID-E1CBB4DA-2F83-4F4D-845B-CAAA8333DF1A" title="存储的大纲迁移是用户启动的将存储的大纲转换为SQL计划基线的过程。SQL计划基准是一组经证实可提供最佳性能的计划。">存储的大纲迁移到SQL计划基准</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>