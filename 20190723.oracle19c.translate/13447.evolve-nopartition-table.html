<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="You can change a nonpartitioned table into a partitioned table."></meta>
      <meta name="description" content="You can change a nonpartitioned table into a partitioned table."></meta>
      <title>将非分区表更改为分区表</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="VLDB and Partitioning Guide"></meta>
      <meta property="og:description" content="You can change a nonpartitioned table into a partitioned table."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="VLDB and Partitioning Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="vldb-and-partitioning-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-04-23T18:05:22-07:00"></meta>
      <meta name="dcterms.title" content="VLDB and Partitioning Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="2008, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96199-03"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="drop-partition-table.html" title="Previous" type="text/html"></link>
      <link rel="next" href="manage_hypt.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="VLDBG"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="drop-partition-table.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="manage_hypt.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">VLDB和分区指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="partition-admin.html" property="item" typeof="WebPage"><span property="name">分区管理</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">将非分区表更改为分区表</li>
            </ol>
            <a id="GUID-6054142E-207A-4DF0-A62A-4C1A94DD36C4" name="GUID-6054142E-207A-4DF0-A62A-4C1A94DD36C4"></a><a id="VLDBG00302"></a>
            
            <h2 id="VLDBG-GUID-6054142E-207A-4DF0-A62A-4C1A94DD36C4" class="sect2">将非分区表更改为分区表</h2>
         </header>
         <div class="ind">
            <div>
               <p>您可以将非分区表更改为分区表。</p>
               <p>讨论了以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="evolve-nopartition-table.html#GUID-5C0F8D12-DDDF-42AB-B644-1880156832BC" title="Oracle数据库提供了一种机制来移动一个或多个分区或对分区的物理结构进行其他更改，而不会显着影响DML分区的可用性。此机制称为联机表重定义。">使用联机重定义来分区收集表</a></p>
                  </li>
                  <li>
                     <p><a href="evolve-nopartition-table.html#GUID-5FDB7D59-DD05-40E4-8AB4-AF82EA0D0FE5" title="可以将非分区表转换为分区表，并在ALTER TABLE SQL语句中添加MODIFY子句。">将非分区表转换为分区表</a></p>
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-6054142E-207A-4DF0-A62A-4C1A94DD36C4__GUID-0B6B57EA-7AED-4E05-A271-505D84D227BF">
                  <p class="notep1">也可以看看：</p>
                  <p>有关重新定义表分区的信息，请参见<a href="../admin/managing-tables.html#ADMIN11675" target="_blank"><span><cite>“Oracle数据库管理员指南”</cite></span></a></p>
               </div>
            </div><a id="VLDBG14075"></a><a id="VLDBG1197"></a><div class="props_rev_3"><a id="GUID-5C0F8D12-DDDF-42AB-B644-1880156832BC" name="GUID-5C0F8D12-DDDF-42AB-B644-1880156832BC"></a><h3 id="VLDBG-GUID-5C0F8D12-DDDF-42AB-B644-1880156832BC" class="sect3">使用联机重定义来分区收集表</h3>
               <div>
                  <p>Oracle数据库提供了一种机制来移动一个或多个分区或对分区的物理结构进行其他更改，而不会显着影响DML分区的可用性。此机制称为联机表重定义。</p>
                  <div class="section">
                     <p>您可以使用联机重定义将未分区的集合表复制到分区的集合表，Oracle数据库将行插入到集合表中的相应分区中。<a href="evolve-nopartition-table.html#GUID-5C0F8D12-DDDF-42AB-B644-1880156832BC__CHDHIDJJ">例4-40</a>说明了如何对Objects列中的嵌套表进行此操作;类似的示例适用于<code class="codeph">XMLType</code>表或列中的有序集合类型表。在<code class="codeph">copy_table_dependents</code>操作期间，为复制索引和约束指定<code class="codeph">0</code>或<code class="codeph">false</code> ，因为您要保留新定义的集合表的索引和约束。但是，Collection Tables及其分区的名称与临时表的名称相同（ <a href="evolve-nopartition-table.html#GUID-5C0F8D12-DDDF-42AB-B644-1880156832BC__CHDHIDJJ">例4-40中的</a> <code class="codeph">print_media2</code> ）。您必须采取明确的步骤来保留收集表名称。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-5C0F8D12-DDDF-42AB-B644-1880156832BC__CHDHIDJJ">
                     <p class="titleinexample">示例4-40使用集合表重新定义分区</p><pre class="oac_no_warn" dir="ltr">CONNECT / AS SYSDBA DROP USER eqnt CASCADE;创建由eqnt识别的用户eqnt; GRANT CONNECT，RESOURCE to eqnt; - 授予在线重新定义所需的权限。在DBMS_REDEFINITION上执行GRANT执行到eqnt;授予任何表格等待;授予任何表格的权利; GRANT LOCK ANY TABLE to eqnt;授予创建任何表格的权利; GRANT SELECT ANY TABLE to eqnt; - 执行克隆依赖对象所需的权限。授予创建任何触发器的权利;授予创建任何指数; CONNECT eqnt / eqnt CREATE TYPE textdoc_typ AS OBJECT（document_typ VARCHAR2（32））; / CREATE TYPE textdoc_tab AS table of textdoc_typ; /  - （旧）非分区嵌套表CREATE TABLE print_media（product_id NUMBER（6）主键，ad_textdocs_ntab textdoc_tab）NESTED TABLE ad_textdocs_ntab STORE AS equi_nestedtab（（document_typ NOT NULL）STORAGE（INITIAL 8M））</pre><pre class="oac_no_warn" dir="ltr">; - 插入基表INSERT INTO print_media VALUES（1，textdoc_tab（textdoc_typ（'xx'），textdoc_typ（'yy'）））; INSERT INTO print_media VALUES（11，textdoc_tab（textdoc_typ（'aa'），textdoc_typ（'bb'）））;承诺; - 插入嵌套表INSERT INTO TABLE（SELECT p.ad_textdocs_ntab FROM print_media p WHERE p.product_id = 11）VALUES（'cc'）; SELECT * FROM print_media; PRODUCT_ID AD_TEXTDOCS_NTAB（DOCUMENT_TYP）---------- ------------------------------ 1 TEXTDOC_TAB（TEXTDOC_TYP（ 'xx'），TEXTDOC_TYP（'yy'））11 TEXTDOC_TAB（TEXTDOC_TYP（'aa'），TEXTDOC_TYP（'bb'），TEXTDOC_TYP（'cc'）） - 创建分区的临时表CREATE TABLE print_media2（product_id NUMBER（6 ），ad_textdocs_ntab textdoc_tab）嵌套表ad_textdocs_ntab存储为equi_nestedtab2（（document_typ非空）存储（初始8M））按范围划分（product_id）（PARTITION P1值小于（10），PARTITION P2值小于（20））; EXEC dbms_redefinition.start_redef_table（'eqnt'，'print_media'，'print_media2'）; DECLARE error_count pls_integer：= 0; BEGIN dbms_redefinition.copy_table_dependents（'eqnt'，'print_media'，'print_media2'，0，true，false，true，false，error_count）; dbms_output.put_line（'errors：='|| to_char（error_count））;结束; / EXEC dbms_redefinition.finish_redef_table（'eqnt'，'print_media'，'print_media2'）; - 删除临时表DROP TABLE print_media2; -  print_media在此处对嵌套表进行了分区SELECT * FROM print_media PARTITION（p1）; PRODUCT_ID AD_TEXTDOCS_NTAB（DOCUMENT_TYP）---------- ------------------------------ 1 TEXTDOC_TAB（TEXTDOC_TYP（ 'xx'），TEXTDOC_TYP（'yy'））SELECT * FROM print_media PARTITION（p2）; PRODUCT_ID AD_TEXTDOCS_NTAB（DOCUMENT_TYP）---------- ------------------------------ 11 TEXTDOC_TAB（TEXTDOC_TYP（ 'aa'），TEXTDOC_TYP（'bb'），TEXTDOC_TYP（'cc'））</pre></div>
                  <!-- class="example" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-5FDB7D59-DD05-40E4-8AB4-AF82EA0D0FE5" name="GUID-5FDB7D59-DD05-40E4-8AB4-AF82EA0D0FE5"></a><h3 id="VLDBG-GUID-5FDB7D59-DD05-40E4-8AB4-AF82EA0D0FE5" class="sect3">将非分区表转换为分区表</h3>
               <div>
                  <p>可以将非分区表转换为分区表，并在<code class="codeph">ALTER</code> <code class="codeph">TABLE</code> SQL语句中添加<code class="codeph">MODIFY</code>子句。
                  </p>
                  <p>此外，可以指定关键字<code class="codeph">ONLINE</code> ，在转换过程中启用并发DML操作。
                  </p>
                  <p>以下是使用<code class="codeph">ONLINE</code>关键字进行在线转换为分区表的<code class="codeph">ALTER TABLE</code>语句的示例。
                  </p>
                  <div class="example" id="GUID-5FDB7D59-DD05-40E4-8AB4-AF82EA0D0FE5__GUID-7E992DD2-5B56-4FC6-BCA9-B517DF0353C9">
                     <p class="titleinexample">示例4-41使用ALTER TABLE的MODIFY子句将联机转换为分区表</p><pre class="oac_no_warn" dir="ltr">ALTER TABLE employees_convert按范围修改分区（employee_id）INTERVAL（100）（分区P1值小于（100），分区P2值小于（500））联机更新索引（IDX1_SALARY LOCAL，IDX2_EMP_ID按范围划分的全局分区（employee_id）（PARTITION IP1值低于（MAXVALUE）））;</pre></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-5FDB7D59-DD05-40E4-8AB4-AF82EA0D0FE5__GUID-FDDDBB01-038E-4FCF-BBF9-90D00DF3A794">使用UPDATE INDEXES子句时的注意事项</p>
                     <p>使用<code class="codeph">UPDATE</code> <code class="codeph">INDEXES</code>子句时，请注意以下内容。
                     </p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>此子句可用于更改索引的分区状态和要转换的索引的存储属性。</p>
                        </li>
                        <li>
                           <p><code class="codeph">UPDATE</code> <code class="codeph">INDEXES</code>子句的规范是可选的。
                           </p>
                           <p>保留索引以进行分区表的联机和脱机转换。</p>
                        </li>
                        <li>
                           <p>此子句不能更改定义原始索引列表的列。</p>
                        </li>
                        <li>
                           <p>此子句不能更改索引或任何其他索引属性的唯一性属性。</p>
                        </li>
                        <li>
                           <p>如果未为任何索引指定表空间，则应用以下表空间默认值。</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>转换后的本地索引与表分区并置。</p>
                              </li>
                              <li>
                                 <p>转换后的全局索引驻留在非分区表上的原始全局索引的同一表空间中。</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>如果未指定<code class="codeph">INDEXES</code>子句或<code class="codeph">INDEXES</code>子句未指定原始非分区表上的所有索引，则以下默认行为适用于所有未指定的索引。
                           </p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>全局分区索引保持不变并保留原始分区形状。</p>
                              </li>
                              <li>
                                 <p>非前缀索引成为全局非分区索引。</p>
                              </li>
                              <li>
                                 <p>带前缀的索引将转换为本地分区索引。</p>
                                 <p>前缀表示分区键列包含在索引定义中，但索引定义不限于仅包括分区键。</p>
                              </li>
                              <li>
                                 <p>无论它们是否带有前缀，位图索引都会成为本地分区索引。</p>
                                 <p>位图索引必须始终是本地分区索引。</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>如果存在域索引，则无法执行转换操作。</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>