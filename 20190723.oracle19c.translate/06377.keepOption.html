<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>keepOption</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Backup and Recovery Reference"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Backup and Recovery Reference"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-backup-and-recovery-reference.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T19:31:58-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96242-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="formatSpec.html" title="Previous" type="text/html"></link>
      <link rel="next" href="listObjList.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery Reference"></meta>
    <meta name="dcterms.isVersionOf" content="RCMRF"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="formatSpec.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="listObjList.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">备份和恢复参考</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="rman-subclauses.html" property="item" typeof="WebPage"><span property="name">RMAN子条款</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">keepOption</li>
            </ol>
            <a id="GUID-36E9008E-48A5-4AB9-8C9D-2D477342594B" name="GUID-36E9008E-48A5-4AB9-8C9D-2D477342594B"></a><a id="RCMRF90451"></a><a id="RCMRF90452"></a><a id="RCMRF90453"></a><a id="RCMRF131"></a>
            
            <h2 id="RCMRF-GUID-36E9008E-48A5-4AB9-8C9D-2D477342594B" class="sect2"><span class="enumeration_section">4.13</span> keepOption</h2>
         </header>
         <div class="ind">
            <div>
               <div class="section">
                  <p class="subhead1" id="GUID-36E9008E-48A5-4AB9-8C9D-2D477342594B__GUID-C0607CD2-5663-4391-B003-53E6A8088CBA">目的</p>
                  <p>使用<span class="italic"><code class="codeph">keepOption</code></span>子句指定与保留策略相关的备份或副本的状态。
                  </p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-36E9008E-48A5-4AB9-8C9D-2D477342594B__GUID-652EDF0C-C0FA-449E-983D-CC3889A25B13">句法</p>
                  <p id="GUID-36E9008E-48A5-4AB9-8C9D-2D477342594B__BABGDGCC"><span class="bold"><span class="italic">keepOption</span> :: =</span></p>
                  <div class="figure" id="GUID-36E9008E-48A5-4AB9-8C9D-2D477342594B__GUID-10C38AEC-CE36-424D-9474-5D14E52F23DE"><img src="img/keepoption.gif" alt="keepoption.eps的描述如下" title="keepoption.eps的描述如下" longdesc="img_text/keepoption.html"><br><a href="img_text/keepoption.html">插图说明keepoption.eps</a></div>
                  <!-- class="figure" -->
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-36E9008E-48A5-4AB9-8C9D-2D477342594B__GUID-966A2AA2-118C-4AEB-8F90-479E3A64104E">使用说明</p>
                  <p>在计算备份保留策略时，RMAN不考虑使用<code class="codeph">KEEP</code>选项的备份片段。如果可用，RMAN将这些备份用于灾难恢复还原操作，但其目的是生成可在其他系统上还原以进行测试或历史使用的数据库快照。
                  </p>
                  <p>使用<code class="codeph">KEEP</code>创建归档备份时，RMAN仅考虑具有相同标记的<code class="codeph">KEEP</code>备份。因此，在使用时<span class="italic"><code class="codeph">keepOption</code></span>与<span class="italic"><code class="codeph">notBackedUpSpec</code></span> ，RMAN只有如果发现指定的最大数跳过备份<code class="codeph">KEEP</code>具有相同标记的备份。其他备份不计算在内。
                  </p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-36E9008E-48A5-4AB9-8C9D-2D477342594B__GUID-335E302F-5C15-4E64-9F3C-ADD10F602108">语义</p>
                  <div class="tblformalwide" id="GUID-36E9008E-48A5-4AB9-8C9D-2D477342594B__GUID-B2FA5DFA-9EFD-4A52-9EFB-C2B9BC6364F5">
                     <table cellpadding="4" cellspacing="0" class="FormalWide" title="" width="100%" border="1" summary="Describes keepOption subclause parameters" frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="29%" id="d120532e146">语法元素</th>
                              <th align="left" valign="bottom" width="71%" id="d120532e149">描述</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d120532e154" headers="d120532e146 ">
                                 <p><code class="codeph">保持</code></p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d120532e154 d120532e149 ">
                                 <p>将备份指定为<strong class="term">归档备份</strong> ，该备份是免除配置的保留策略的自包含备份。
                                 </p>
                                 <p>归档备份是自包含的，因为它包含还原备份并将其恢复到一致状态所需的所有文件。如果数据库在备份期间处于打开状态，则RMAN会自动生成并备份使数据库备份保持一致所需的归档重做日志文件（请参阅<a href="BACKUP.html#GUID-73642FF2-43C5-48B2-9969-99001C52EB50__CHDCIBCJ">示例2-26</a> ）。
                                 </p>
                                 <p><span class="bold">注意：</span>仅在使用本地撤消时，PDB备份才是自包含的。使用共享撤消时，PDB备份不是自包含的。
                                 </p>
                                 <p>在计算保留策略时，RMAN不考虑使用<code class="codeph">KEEP</code>选项的备份片段。如果可用，RMAN将这些备份用于灾难恢复还原操作，但其目的是生成可在其他系统上还原以进行测试或历史使用的数据库快照。
                                 </p>
                                 <p><span class="bold">注意：</span>您无法使用<code class="codeph">KEEP</code>覆盖存储在快速恢复区域中的文件的保留策略。如果在备份到恢复区域时指定<code class="codeph">KEEP</code> ，则RMAN会发出错误。
                                 </p>
                                 <p>指定<code class="codeph">KEEP</code> ，RMAN会创建多个备份集。RMAN使用第一个<span class="italic"><code class="codeph">backupOperand</code></span>指定的选项备份数据文件，归档重做日志文件，控制文件和服务器参数文件。由于创建了控制文件的备份，因此不会创建控制文件的自动备份。RMAN对所有备份使用<code class="codeph">FORMAT</code> ， <code class="codeph">POOL</code>和<code class="codeph">TAG</code>参数。因此， <code class="codeph">FORMAT</code>字符串必须允许创建多个备份片段。指定<code class="codeph"><a href="formatSpec.html#GUID-E51F637A-57E0-4B06-803F-3F879DF5BEED__BABGHHGH">%U</a></code>是满足此要求的最简单方法。
                                 </p>
                                 <p><span class="bold">另请参阅：</span> <a href="CONFIGURE.html#GUID-B5094E73-C26C-4FED-AE39-8C2E9540050A">配置</a>和<span class="italic">Oracle数据库备份和恢复用户指南，</span>以了解有关控制文件的自动<span class="italic">备份的</span>更多信息。
                                 </p>
                                 <p>当使用<code class="codeph">INCREMENTAL LEVEL</code>指定<code class="codeph">KEEP</code> ，父备份必须是<code class="codeph">KEEP</code>备份并具有相同的<code class="codeph">TAG</code>字符串。除非满足这两个条件，否则无法创建备份。符合这些条件的备份不会干扰其他夜间或归档备份任务。
                                 </p>
                                 <p><span class="bold">注意：</span>只有<code class="codeph">KEEP FOREVER</code>需要恢复目录。没有其他<code class="codeph">KEEP</code>选项需要目录。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d120532e248" headers="d120532e146 ">
                                 <p><code class="codeph">永远</code></p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d120532e248 d120532e149 ">
                                 <p>指定备份或副本永远不会过时（请参阅<a href="BACKUP.html#GUID-73642FF2-43C5-48B2-9969-99001C52EB50__CHDJJIJG">示例2-27</a> ）。指定<code class="codeph">FOREVER</code>时需要恢复目录，因为备份记录最终会超出控制文件的范围。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d120532e261" headers="d120532e146 "><code class="codeph">UNTIL TIME</code> <code class="codeph">'</code> <span class="italic"><code class="codeph">date_string</code></span> <code class="codeph">'</code></td>
                              <td align="left" valign="top" width="71%" headers="d120532e261 d120532e149 ">
                                 <p>指定必须保留备份或副本的时间。在此时间之后，无论备份保留策略设置如何，备份都将过时。</p>
                                 <p>您可以使用当前的<code class="codeph">NLS_DATE_FORMAT</code>指定特定时间，也可以使用SQL日期表达式（例如<code class="codeph">'SYSDATE+365'</code>指定特定时间。如果指定<code class="codeph">KEEP TIME</code>例如<code class="codeph">01-JAN-13</code> ，则备份将在此日期的午夜后一秒钟过时。如果指定<code class="codeph">KEEP</code>时间（例如晚上9点），则备份将在晚上9:01过时</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d120532e293" headers="d120532e146 "><code class="codeph">RESTORE POINT</code> <span class="italic"><code class="codeph">restore_point_name</code></span></td>
                              <td align="left" valign="top" width="71%" headers="d120532e293 d120532e149 ">
                                 <p>创建与RMAN必须将备份恢复到一致状态的SCN匹配的正常还原点（请参见<a href="BACKUP.html#GUID-73642FF2-43C5-48B2-9969-99001C52EB50__CHDCIBCJ">示例2-26</a> ）。还原点名称必须不存在。
                                 </p>
                                 <p>在数据文件备份完成后立即捕获SCN。还原点是可以恢复和恢复此归档备份的SCN的标签，从而可以打开数据库。相反， <code class="codeph">UNTIL TIME</code>子句指定必须保留备份的日期。
                                 </p>
                                 <p><span class="bold">注意：</span> <code class="codeph">RESTORE POINT</code>参数对<code class="codeph"><a href="CHANGE.html#GUID-961151C6-EEFF-4347-AF1E-93EFDD5F5BF2">CHANGE</a></code>命令无效。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d120532e323" headers="d120532e146 ">
                                 <p><code class="codeph">NOKEEP</code></p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d120532e323 d120532e149 ">
                                 <p>指定任何<code class="codeph">KEEP</code>属性不再适用于备份。因此，备份是正常备份，受备份配置的备份保留策略的约束。如果未指定<code class="codeph">KEEP</code>选项，则这是默认行为。
                                 </p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-36E9008E-48A5-4AB9-8C9D-2D477342594B__GUID-49013940-0417-46B9-B2CF-51DEAB8DBC24">例子</p>
               </div>
               <!-- class="section" -->
               <div class="example" id="GUID-36E9008E-48A5-4AB9-8C9D-2D477342594B__GUID-F85B03E0-8FE1-45B1-B2E2-54F14AAB5BAB">
                  <p class="titleinexample">示例4-24为存档创建一致的数据库备份</p>
                  <p>此示例使用标记<code class="codeph">Q107</code>进行数据库备份，并指定它永远不会被视为过时（包括部分样本输出）。备份集中包含使数据文件保持一致所需的归档重做日志文件。
                  </p><pre class="oac_no_warn" dir="ltr">RMAN&gt;备份标签Q107数据库保持永久;在24-JAN-13当前日志归档分配的通道开始备份：ORA_SBT_TAPE_1通道ORA_SBT_TAPE_1：SID = 105设备类型= SBT_TAPE通道ORA_SBT_TAPE_1：Oracle Secure Backup备份永远不会过时从此备份恢复所需的归档日志将备份通道ORA_SBT_TAPE_1 ：启动完整数据文件备份集通道ORA_SBT_TAPE_1：指定备份集中的数据文件。。。</pre></div>
               <!-- class="example" -->
               <div class="example" id="GUID-36E9008E-48A5-4AB9-8C9D-2D477342594B__GUID-BE411489-C4D7-4F3E-A741-79661AFA73E4">
                  <p class="titleinexample">示例4-25删除备份的KEEP属性</p>
                  <p>此示例备份所有归档的重做日志文件。<code class="codeph">KEEP</code>子句指定在2013年1月1日午夜之后的一秒钟，备份被认为是过时的。
                  </p><pre class="oac_no_warn" dir="ltr">RMAN&gt;备份保持时间'01 -JAN-13'ARCHIVELOG ALL;</pre><p>以下命令将删除所有归档重做日志备份的<code class="codeph">KEEP</code>属性（包括示例输出）：</p><pre class="oac_no_warn" dir="ltr">RMAN&gt;更改ARCHIVELOG所有NOKEEP备份;使用通道ORA_SBT_TAPE_1分配通道：ORA_DISK_1通道ORA_DISK_1：SID = 77设备类型= DISK保留备份属性已删除备份集密钥= 330 RECID = 19 STAMP = 612722760保留备份属性已删除备份集密钥= 397 RECID = 22 STAMP = 612722884</pre></div>
               <!-- class="example" -->
            </div>
         </div>
      </article>
   </body>
</html>