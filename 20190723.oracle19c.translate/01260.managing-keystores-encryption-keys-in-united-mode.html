<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="United mode enables you to create a common keystore for the CDB and the PDBs for which the keystore is in united mode."></meta>
      <meta name="description" content="United mode enables you to create a common keystore for the CDB and the PDBs for which the keystore is in united mode."></meta>
      <title>在联合模式下管理密钥库和TDE主加密密钥</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Advanced Security Guide "></meta>
      <meta property="og:description" content="United mode enables you to create a common keystore for the CDB and the PDBs for which the keystore is in united mode."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Advanced Security Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="advanced-security-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-03-13T09:26:12-07:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96301-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="managing-keystore-and-tde-master-encryption-key.html" title="Previous" type="text/html"></link>
      <link rel="next" href="managing-keystores-encryption-keys-in-isolated-mode.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Advanced Security Guide"></meta>
    <meta name="dcterms.isVersionOf" content="ASOAG"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="managing-keystore-and-tde-master-encryption-key.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="managing-keystores-encryption-keys-in-isolated-mode.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">高级安全指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="asopart1.html" property="item" typeof="WebPage"><span property="name">使用透明数据加密</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">在联合模式下管理密钥库和TDE主加密密钥</li>
            </ol>
            <a id="GUID-FA569DEC-6FF3-4CA1-86AA-D27F29EDCA3C" name="GUID-FA569DEC-6FF3-4CA1-86AA-D27F29EDCA3C"></a>
            
            <h2 id="ASOAG-GUID-FA569DEC-6FF3-4CA1-86AA-D27F29EDCA3C" class="sect2"><span class="enumeration_chapter">5</span>在联合模式下管理密钥库和TDE主加密密钥</h2>
         </header>
         <div class="ind">
            <div>
               <p>通过联合模式，您可以为CDB和密钥库处于联合模式的PDB创建公共密钥库。</p>
               <p>CDB和PDB的密钥位于公共密钥库中。</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-D3045557-FA85-4EA5-A85A-75EAE9D67E13">关于在联合模式下管理密钥库和TDE主加密密钥</a><br>在联合模式下，您可以为驻留在同一密钥库中的CDB和PDB创建密钥库和TDE主加密密钥。
                  </li>
                  <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-02343C2C-160B-4950-A191-48317B20C507">联合模式允许的操作</a><br>在CDB根中执行的许多<code class="codeph">ADMINISTER KEY MANAGEMENT</code>操作适用于联合模式PDB中的密钥库和加密密钥。</li>
                  <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9AEE8527-91D4-4FD7-B4DF-BFA5A7B43143">联合模式PDB中不允许的操作</a><br>在统一模式PDB中不允许的<code class="codeph">ADMINISTER KEY MANAGEMENT</code>操作可以在CDB根中执行。
                  </li>
                  <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-13AB7212-BA7A-488D-AD70-D84C3B651127">为联合模式配置密钥库位置和类型</a><br>对于联合模式，您可以仅使用参数或参数组合以及<code class="codeph">ALTER SYSTEM</code>语句来配置密钥库位置和类型。
                  </li>
                  <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-2E40034B-4523-4D1C-9A2F-BCC3D58C570D">配置软件密钥库以在联合模式下使用</a><br>在联合模式下，软件密钥库位于CDB根目录中，但来自此密钥库的主密钥可用于其密钥库处于联合模式的PDB。
                  </li>
                  <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-540A5DBF-720E-49E5-9060-DF40D3D4F6B0">以联合模式配置硬件密钥库</a><br>在联合模式下，硬件密钥库驻留在硬件安全模块（HSM）中，该模块用于存储加密密钥。
                  </li>
                  <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D">在联合模式下管理密钥库和TDE主加密密钥</a><br>配置密钥库和主加密密钥以在联合模式下使用后，可以执行重新加密TDE主加密密钥等任务。
                  </li>
                  <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-59000EDC-011E-45BF-9ECB-AC0335EE2FED">在联合模式下管理透明数据加密</a><br>您可以在联合模式下使用透明数据加密执行常规管理任务。
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="asopart1.html" title="第一部分介绍了如何使用透明数据加密。">使用透明数据加密</a></p>
                  </div>
               </div>
            </div>
            
            <div class="sect2"><a id="GUID-D3045557-FA85-4EA5-A85A-75EAE9D67E13" name="GUID-D3045557-FA85-4EA5-A85A-75EAE9D67E13"></a><h3 id="ASOAG-GUID-D3045557-FA85-4EA5-A85A-75EAE9D67E13" class="sect3">关于在联合模式下管理密钥库和TDE主加密密钥</h3>
               <div>
                  <p>在联合模式下，您可以为驻留在同一密钥库中的CDB和PDB创建密钥库和TDE主加密密钥。</p>
                  <p>具有联合模式密钥库的PDB的密钥可以从CDB根或PDB创建。</p>
                  <p>此设计使您可以拥有一个密钥库来管理整个CDB环境，使PDB能够共享此密钥库，但您可以在单个联合模式PDB中自定义此密钥库的行为。例如，在联合模式PDB中，您可以为在CDB根目录中创建的联合密钥库中的PDB配置TDE主加密密钥，在本地打开密钥库，并在本地关闭密钥库。为了执行这些操作，必须打开CDB根目录中的密钥库。</p>
                  <p>在将环境配置为使用联合模式或隔离模式之前，CDB环境中的所有PDB都被视为处于联合模式。</p>
                  <p>要使用联合模式，您必须遵循以下常规步骤：</p>
                  <ol>
                     <li>
                        <p>在CDB根目录中，通过设置<code class="codeph">WALLET_ROOT</code>和<code class="codeph">TDE_CONFIGURATION</code>参数将数据库配置为使用联合模式。
                        </p>
                        <p><code class="codeph">WALLET_ROOT</code>参数设置wallet目录的位置， <code class="codeph">TDE_CONFIGURATION</code>参数设置要使用的密钥库的类型。
                        </p>
                     </li>
                     <li>
                        <p>重新启动数据库以使这些设置生效。</p>
                     </li>
                     <li>
                        <p>在CDB根目录中，创建密钥库，打开密钥库，然后创建TDE主加密密钥。</p>
                     </li>
                     <li>
                        <p>在每个联合模式PDB中，根据需要执行TDE主加密密钥任务，例如在联合模式PDB中本地打开密钥库并为PDB创建TDE主加密密钥。请记住，密钥库由CDB根管理，但必须包含特定于PDB的TDE主加密密钥，以便PDB能够使用TDE。</p>
                     </li>
                  </ol>
                  <p>当您从CDB根目录以联合模式运行<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句时，如果语句接受<code class="codeph">CONTAINER</code>子句，并且如果将其设置为<code class="codeph">ALL</code> ，则该语句仅适用于CDB根及其关联的联合模式PDB。处于隔离模式的任何PDB都不受影响。
                  </p>
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-FA569DEC-6FF3-4CA1-86AA-D27F29EDCA3C" title="通过联合模式，您可以为CDB和密钥库处于联合模式的PDB创建公共密钥库。">在联合模式下管理密钥库和TDE主加密密钥</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-02343C2C-160B-4950-A191-48317B20C507" name="GUID-02343C2C-160B-4950-A191-48317B20C507"></a><h3 id="ASOAG-GUID-02343C2C-160B-4950-A191-48317B20C507" class="sect3">联合模式允许的操作</h3>
               <div>
                  <p>在CDB根中执行的许多<code class="codeph">ADMINISTER KEY MANAGEMENT</code>操作适用于联合模式PDB中的密钥库和加密密钥。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-02343C2C-160B-4950-A191-48317B20C507__GUID-B68B7001-E1F5-4B69-868F-99D33621EAE7">CDB根目录中可用的与模式相关的操作</p>
                     <p><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-02343C2C-160B-4950-A191-48317B20C507__ADMINISTERKEYMANAGEMENTUNITEDMODECD-108ECF95" title="此表描述影响统一模式PDB的ADMINISTER KEY MANAGEMENT操作，用于每个操作的语法和注释。">表5-1</a>介绍了可以在CDB根目录中执行的<code class="codeph">ADMINISTER KEY MANAGEMENT</code>操作。
                     </p>
                     <div class="tblformal" id="GUID-02343C2C-160B-4950-A191-48317B20C507__ADMINISTERKEYMANAGEMENTUNITEDMODECD-108ECF95">
                        <p class="titleintable">表5-1管理员密钥管理CDB根中的联合模式操作</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="管理员密钥管理CDB根中的联合模式操作" border="1" summary="This table describes the ADMINISTER KEY MANAGEMENT operations that are affect a united mode PDB, the syntax that is used for each operations, and notes." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="20%" id="d28070e362">手术</th>
                                 <th align="left" valign="bottom" width="20%" id="d28070e364">句法</th>
                                 <th align="left" valign="bottom" width="20%" id="d28070e366">联合模式笔记</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d28070e370" headers="d28070e362 ">
                                    <p>创建密钥库</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d28070e370 d28070e364 "><pre class="oac_no_warn" dir="ltr">ADMINISTER密钥管理CREATE KEYSTORE [' <span class="italic">keystore_location</span> '] IDENTIFIED BY <span class="italic">keystore_password</span> ;</pre></td>
                                 <td align="left" valign="top" width="20%" headers="d28070e370 d28070e366 ">
                                    <p>在CDB根目录中创建密钥库后，默认情况下它在联合模式PDB中可用。不要包含<code class="codeph">CONTAINER</code>子句。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d28070e389" headers="d28070e362 ">
                                    <p>打开密钥库</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d28070e389 d28070e364 "><pre class="oac_no_warn" dir="ltr">管理员密钥管理设置KEYSTORE打开由[外部商店|确定] <span class="italic">keystore_password</span> ] [CONTAINER = ALL |当前];</pre></td>
                                 <td align="left" valign="top" width="20%" headers="d28070e389 d28070e366 ">
                                    <p>在此操作中， <code class="codeph">EXTERNAL STORE</code>子句使用位于每个PDB <code class="codeph">WALLET_ROOT</code>位置下的<code class="codeph">tde_seps</code>目录中的SSO钱包中的密码。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d28070e411" headers="d28070e362 ">
                                    <p>更改密钥库密码</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d28070e411 d28070e364 "><pre class="oac_no_warn" dir="ltr">管理员密钥管理ALTER KEYSTORE密码由<span class="italic">old_keystore_password</span>标识SET <span class="italic">new_keystore_password</span> WITH BACKUP [使用' <span class="italic">backup_identifier</span> '];</pre></td>
                                 <td align="left" valign="top" width="20%" headers="d28070e411 d28070e366 ">
                                    <p>不要包含<code class="codeph">CONTAINER</code>子句。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d28070e433" headers="d28070e362 ">
                                    <p>备份密钥库</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d28070e433 d28070e364 "><pre class="oac_no_warn" dir="ltr">管理员密钥管理备份KEYSTORE [使用' <span class="italic">backup_identifier</span> '] [FORCE KEYSTORE]由[EXTERNAL STORE | <span class="italic">keystore_password</span> ] [ <span class="italic">TO'keystore_location</span> '];</pre></td>
                                 <td align="left" valign="top" width="20%" headers="d28070e433 d28070e366 ">
                                    <p>不要包含<code class="codeph">CONTAINER</code>子句。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d28070e455" headers="d28070e362 ">
                                    <p>无需关闭密钥库</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d28070e455 d28070e364 "><pre class="oac_no_warn" dir="ltr">管理员密钥管理设置KEYSTORE关闭[由[外部商店|确定] <span class="italic">keystore_password</span> ]] [CONTAINER = ALL |当前];</pre></td>
                                 <td align="left" valign="top" width="20%" headers="d28070e455 d28070e366 ">
                                    <p>如果打开了隔离模式PDB密钥库，则此语句引发<code class="codeph">ORA-46692 cannot close wallet</code>错误。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d28070e471" headers="d28070e362 ">
                                    <p>用力关闭密钥库</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d28070e471 d28070e364 "><pre class="oac_no_warn" dir="ltr">管理员密钥管理力量KEYSTORE关闭[由[外部商店|确定] <span class="italic">keystore_password</span> ]] [CONTAINER = ALL |当前];</pre></td>
                                 <td align="left" valign="top" width="20%" headers="d28070e471 d28070e366 ">
                                    <p>此操作允许在打开隔离的密钥库时在CDB根目录中关闭密钥库。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d28070e484" headers="d28070e362 ">
                                    <p>创建并激活新的TDE主加密密钥（重新加密）</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d28070e484 d28070e364 "><pre class="oac_no_warn" dir="ltr">管理员密钥管理集[加密]密钥[FORCE KEYSTORE] [使用标记' <span class="italic">tag_name</span> ']由[EXTERNAL STORE | <span class="italic">keystore_password</span> ] [WITH BACKUP [使用' <span class="italic">backup_identifier</span> ']] [CONTAINER = ALL |当前]</pre></td>
                                 <td align="left" valign="top" width="20%" headers="d28070e484 d28070e366 ">
                                    <p>-</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d28070e503" headers="d28070e362 ">
                                    <p>为现在（ <code class="codeph">SET</code> ）或稍后（ <code class="codeph">CREATE</code> ）创建用户定义的TDE主加密密钥</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d28070e503 d28070e364 "><pre class="oac_no_warn" dir="ltr">管理员密钥管理[SET |创建] [ENCRYPTION] <span class="italic">KEY'mkid</span> ： <span class="italic">mk</span> | <span class="italic">MK</span> '[使用算法<span class="italic">'算法']</span> [FORCE密钥库] [使用标记' <span class="italic">TAG_NAME“]</span> IDENTIFIED BY [外挂| <span class="italic">keystore_password</span> ] [WITH BACKUP [使用' <span class="italic">backup_identifier</span> ']] [CONTAINER = CURRENT];</pre></td>
                                 <td align="left" valign="top" width="20%" headers="d28070e503 d28070e366 ">
                                    <p>-</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d28070e541" headers="d28070e362 ">
                                    <p>激活现有TDE主加密密钥</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d28070e541 d28070e364 "><pre class="oac_no_warn" dir="ltr">管理员密钥管理使用[加密]密钥' <span class="italic">key_id</span> [使用标记'标记']由[外部商店]识别<span class="italic">keystore_password</span> ] WITH BACKUP [使用' <span class="italic">backup_identifier</span> '];</pre></td>
                                 <td align="left" valign="top" width="20%" headers="d28070e541 d28070e366 ">
                                    <p>不要包含<code class="codeph">CONTAINER</code>子句。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d28070e563" headers="d28070e362 ">
                                    <p>标记TDE主加密密钥</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d28070e563 d28070e364 "><pre class="oac_no_warn" dir="ltr">管理员密钥管理设置标记'标记' <span class="italic">FOR'key_id</span> '由[外部商店|标识]识别<span class="italic">keystore_password</span> ] WITH BACKUP [使用' <span class="italic">backup_identifier</span> '];</pre></td>
                                 <td align="left" valign="top" width="20%" headers="d28070e563 d28070e366 ">
                                    <p>不要包含<code class="codeph">CONTAINER</code>子句。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d28070e585" headers="d28070e362 ">
                                    <p>将TDE主加密密钥移动到新密钥库</p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d28070e585 d28070e364 "><pre class="oac_no_warn" dir="ltr">ADMINISTER密钥管理MOVE [加密]键IDENTIFIED BY <span class="italic">keystore1_password</span> FROM新的密钥库<span class="italic">'keystore_location1'[FORCE]</span>密钥库IDENTIFIED BY <span class="italic">keystore_password</span> [WITH标识符{ <span class="italic">'KEY_ID'[</span> <span class="italic">'KEY_ID']</span> ... | （ <span class="italic">子查询</span> ）}] [WITH BACKUP [使用' <span class="italic">backup_identifier</span> '];</pre></td>
                                 <td align="left" valign="top" width="20%" headers="d28070e585 d28070e366 ">
                                    <p>您只能将主加密密钥移动到同一容器内的密钥库（例如，CDB根目录中的密钥库之间或同一PDB中的密钥库之间）。您无法将主加密密钥从CDB根目录中的密钥库移动到PDB中的密钥库，反之亦然。</p>
                                    <p>不要包含<code class="codeph">CONTAINER</code>子句。
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-02343C2C-160B-4950-A191-48317B20C507__GUID-5A35A7C6-E9F5-45CE-AD20-2C88733A5342">联合模式PDB中的可用操作</p>
                     <p><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-02343C2C-160B-4950-A191-48317B20C507__ADMINISTERKEYMANAGEMENTUNITEDMODEOP-F95BABC5" title="此表描述了统一模式PDB中允许的ADMINISTER KEY MANAGEMENT操作，以及用于每个操作的语法">表5-2</a>介绍了可以在统一模式PDB中执行的<code class="codeph">ADMINISTER KEY MANAGEMENT</code>操作。</p>
                     <div class="tblformal" id="GUID-02343C2C-160B-4950-A191-48317B20C507__ADMINISTERKEYMANAGEMENTUNITEDMODEOP-F95BABC5">
                        <p class="titleintable">表5-2管理员密钥管理联合模式PDB操作</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="管理员密钥管理联合模式PDB操作" border="1" summary="This table describes the ADMINISTER KEY MANAGEMENT operations that are allowed in a united mode PDB, and the syntax used for each operations" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" id="d28070e644">手术</th>
                                 <th align="left" valign="bottom" id="d28070e646">句法</th>
                                 <th align="left" valign="bottom" id="d28070e648">联合模式笔记</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d28070e652" headers="d28070e644 ">
                                    <p>打开密钥库</p>
                                 </td>
                                 <td align="left" valign="top" headers="d28070e652 d28070e646 "><pre class="oac_no_warn" dir="ltr">管理员密钥管理设置KEYSTORE打开由[外部商店|确定] <span class="italic">keystore_password</span> ] [CONTAINER = CURRENT];</pre></td>
                                 <td align="left" valign="top" headers="d28070e652 d28070e648 ">
                                    <p>在此操作中， <code class="codeph">EXTERNAL_STORE</code>子句使用安全套接字层（SSL）钱包中的密码。此钱包位于<code class="codeph">WALLET_ROOT</code>位置的<code class="codeph">tde_seps</code>目录中。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d28070e674" headers="d28070e644 ">
                                    <p>无需关闭密钥库</p>
                                 </td>
                                 <td align="left" valign="top" headers="d28070e674 d28070e646 "><pre class="oac_no_warn" dir="ltr">ADMINISTER密钥管理设置KEYSTORE CLOSE [由<span class="italic">keystore_password</span>标识] [CONTAINER = CURRENT];</pre></td>
                                 <td align="left" valign="top" headers="d28070e674 d28070e648 ">
                                    <p>-</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d28070e687" headers="d28070e644 ">
                                    <p>用力关闭密钥库</p>
                                 </td>
                                 <td align="left" valign="top" headers="d28070e687 d28070e646 "><pre class="oac_no_warn" dir="ltr">管理员密钥管理强制关键字由[外部商店|]识别<span class="italic">keystore_password</span> ] [CONTAINER = CURRENT];</pre></td>
                                 <td align="left" valign="top" headers="d28070e687 d28070e648 ">
                                    <p>-</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d28070e700" headers="d28070e644 ">
                                    <p>创建并激活新的TDE主加密密钥（重新加密或旋转）</p>
                                 </td>
                                 <td align="left" valign="top" headers="d28070e700 d28070e646 "><pre class="oac_no_warn" dir="ltr">管理员密钥管理集[加密]密钥[FORCE KEYSTORE] [使用标记' <span class="italic">tag_name</span> ']由[EXTERNAL STORE | <span class="italic">keystore_password</span> ] [WITH BACKUP [使用' <span class="italic">backup_identifier</span> ']] [CONTAINER = CURRENT];</pre></td>
                                 <td align="left" valign="top" headers="d28070e700 d28070e648 ">
                                    <p>-</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d28070e719" headers="d28070e644 ">
                                    <p>创建用户定义的TDE主加密密钥，以便现在（ <code class="codeph">SET</code> ）或稍后使用（ <code class="codeph">CREATE</code> ）</p>
                                 </td>
                                 <td align="left" valign="top" headers="d28070e719 d28070e646 "><pre class="oac_no_warn" dir="ltr">管理员密钥管理集|创建[ENCRYPTION] <span class="italic">KEY'mkid</span> ： <span class="italic">mk</span> | <span class="italic">mk</span> '[使用算法<span class="italic">'算法'</span> ] [FORCE KEYSTORE]由[EXTERNAL STORE]识别<span class="italic">keystore_password</span> ] [WITH BACKUP [使用' <span class="italic">backup_identifier</span> ']] [CONTAINER = CURRENT];</pre></td>
                                 <td align="left" valign="top" headers="d28070e719 d28070e648 ">
                                    <p>-</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d28070e754" headers="d28070e644 ">
                                    <p>激活现有TDE主加密密钥</p>
                                 </td>
                                 <td align="left" valign="top" headers="d28070e754 d28070e646 "><pre class="oac_no_warn" dir="ltr">管理员密钥管理使用[加密]密钥' <span class="italic">key_id</span> '[使用标签'标签']由[外部商店]识别<span class="italic">keystore_password</span> ] [WITH BACKUP [使用' <span class="italic">backup_identifier</span> ']];</pre></td>
                                 <td align="left" valign="top" headers="d28070e754 d28070e648 ">
                                    <p>不要包含<code class="codeph">CONTAINER</code>子句。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d28070e776" headers="d28070e644 ">
                                    <p>标记TDE主加密密钥</p>
                                 </td>
                                 <td align="left" valign="top" headers="d28070e776 d28070e646 "><pre class="oac_no_warn" dir="ltr">ADMINISTER密钥管理SET TAG '标记' FOR <span class="italic">'KEY_ID'[FORCE</span>密钥库] IDENTIFIED BY [外挂| <span class="italic">keystore_password</span> ] [WITH BACKUP [使用' <span class="italic">backup_identifier</span> ']];</pre></td>
                                 <td align="left" valign="top" headers="d28070e776 d28070e648 ">
                                    <p>不要包含<code class="codeph">CONTAINER</code>子句。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d28070e798" headers="d28070e644 ">
                                    <p>将加密密钥移动到新密钥库</p>
                                 </td>
                                 <td align="left" valign="top" headers="d28070e798 d28070e646 "><pre class="oac_no_warn" dir="ltr">ADMINISTER密钥管理MOVE [加密]键IDENTIFIED BY <span class="italic">keystore1_password</span> FROM新的密钥库<span class="italic">'keystore_location1'[FORCE]</span>密钥库IDENTIFIED BY <span class="italic">keystore_password</span> [WITH标识符{ <span class="italic">'KEY_ID'[</span> <span class="italic">'KEY_ID']</span> ... | （ <span class="italic">子查询</span> ）}] [WITH BACKUP [使用' <span class="italic">backup_identifier</span> ']];</pre></td>
                                 <td align="left" valign="top" headers="d28070e798 d28070e648 ">
                                    <p>不要包含<code class="codeph">CONTAINER</code>子句。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d28070e833" headers="d28070e644 ">
                                    <p>将密钥从CDB根目录中的联合模式密钥库移动到PDB中的隔离模式密钥库</p>
                                 </td>
                                 <td align="left" valign="top" headers="d28070e833 d28070e646 "><pre class="oac_no_warn" dir="ltr">ADMINISTER IDENTIFIED BY <span class="italic">isolated_keystore_password</span>从发根密钥库[FORCE密钥库] IDENTIFIED BY [外挂密钥管理密钥库ISOLATE | <span class="italic">united_keystore_password</span> ] [WITH BACKUP [USING <span class="italic">backup_id</span> ]];</pre></td>
                                 <td align="left" valign="top" headers="d28070e833 d28070e648 ">
                                    <p>不要包含<code class="codeph">CONTAINER</code>子句。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d28070e855" headers="d28070e644 ">
                                    <p>当PDB的克隆使用正被隔离的TDE主加密密钥时，使用<code class="codeph">FORCE</code>子句;然后将TDE主加密密钥从CDB根目录中的密钥库复制（而不是移动）到PDB的隔离模式密钥库中</p>
                                 </td>
                                 <td align="left" valign="top" headers="d28070e855 d28070e646 "><pre class="oac_no_warn" dir="ltr">ADMINISTER密钥管理FORCE] ISOLATE密钥库IDENTIFIED BY <span class="italic">isolated_keystore_password</span>从发根密钥库[FORCE密钥库] IDENTIFIED BY [外挂| <span class="italic">united_keystore_password</span> ] [WITH BACKUP [USING <span class="italic">backup_id</span> ]];</pre></td>
                                 <td align="left" valign="top" headers="d28070e855 d28070e648 ">
                                    <p>-</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-FA569DEC-6FF3-4CA1-86AA-D27F29EDCA3C" title="通过联合模式，您可以为CDB和密钥库处于联合模式的PDB创建公共密钥库。">在联合模式下管理密钥库和TDE主加密密钥</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-9AEE8527-91D4-4FD7-B4DF-BFA5A7B43143" name="GUID-9AEE8527-91D4-4FD7-B4DF-BFA5A7B43143"></a><h3 id="ASOAG-GUID-9AEE8527-91D4-4FD7-B4DF-BFA5A7B43143" class="sect3">联合模式PDB中不允许的操作</h3>
               <div>
                  <p>在统一模式PDB中不允许的<code class="codeph">ADMINISTER KEY MANAGEMENT</code>操作可以在CDB根中执行。
                  </p>
                  <div class="section">
                     <p>这些操作如下：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>密钥库操作：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>在密钥库上执行合并操作</p>
                              </li>
                              <li>
                                 <p>导出密钥库</p>
                              </li>
                              <li>
                                 <p>导入密钥库</p>
                              </li>
                              <li>
                                 <p>迁移密钥库</p>
                              </li>
                              <li>
                                 <p>反向迁移密钥库</p>
                              </li>
                              <li>
                                 <p>将CDB根目录中的密钥库的密钥移动到PDB的密钥库中</p>
                              </li>
                              <li>
                                 <p>将密钥从PDB移动到CDB根目录中的联合模式密钥库</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>加密密钥操作：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>使用<code class="codeph">CONTAINER = ALL</code>子句为每个可插拔数据库（PDB）中的后续用户创建新的TDE主加密密钥</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>客户秘密行动：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>添加客户端机密</p>
                              </li>
                              <li>
                                 <p>更新客户端机密</p>
                              </li>
                              <li>
                                 <p>删除客户机密</p>
                              </li>
                           </ul>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-FA569DEC-6FF3-4CA1-86AA-D27F29EDCA3C" title="通过联合模式，您可以为CDB和密钥库处于联合模式的PDB创建公共密钥库。">在联合模式下管理密钥库和TDE主加密密钥</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-13AB7212-BA7A-488D-AD70-D84C3B651127" name="GUID-13AB7212-BA7A-488D-AD70-D84C3B651127"></a><h3 id="ASOAG-GUID-13AB7212-BA7A-488D-AD70-D84C3B651127" class="sect3">为联合模式配置密钥库位置和类型</h3>
               <div>
                  <p>对于联合模式，您可以仅使用参数或参数组合以及<code class="codeph">ALTER SYSTEM</code>语句来配置密钥库位置和类型。
                  </p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-3C9F5F0E-C5E2-4B9B-8CE8-CDB8B6750271">通过编辑初始化参数文件配置联合模式</a><br>您可以通过在初始化参数文件中设置<code class="codeph">WALLET_ROOT</code>和<code class="codeph">TDE_CONFIGURATION</code>参数来配置联合模式。
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-CD6E4741-4916-4F24-9427-4DA25DF40587">使用初始化参数文件和ALTER SYSTEM配置联合模式</a><br>如果您的环境依赖于服务器参数文件（spfile）或参数文件（pfile），则可以使用带有<code class="codeph">SCOPE</code> <code class="codeph">ALTER SYSTEM</code>设置<code class="codeph">TDE_CONFIGURATION</code> 。</li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-FA569DEC-6FF3-4CA1-86AA-D27F29EDCA3C" title="通过联合模式，您可以为CDB和密钥库处于联合模式的PDB创建公共密钥库。">在联合模式下管理密钥库和TDE主加密密钥</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-3C9F5F0E-C5E2-4B9B-8CE8-CDB8B6750271" name="GUID-3C9F5F0E-C5E2-4B9B-8CE8-CDB8B6750271"></a><h4 id="ASOAG-GUID-3C9F5F0E-C5E2-4B9B-8CE8-CDB8B6750271" class="sect4">通过编辑初始化参数文件配置联合模式</h4>
                  <div>
                     <p>您可以通过在初始化参数文件中设置<code class="codeph">WALLET_ROOT</code>和<code class="codeph">TDE_CONFIGURATION</code>参数来配置联合模式。
                     </p>
                     <ol>
                        <li class="stepexpand"><span>登录Oracle数据库的CDB根所在的服务器。</span></li>
                        <li class="stepexpand"><span>如有必要，请创建一个钱包目录。</span><div>通常，wallet目录位于<code class="codeph">$ORACLE_BASE/admin/ <span class="codeinlineitalic">db_unique_name</span></code>目录中，名为<code class="codeph">wallet</code> 。优选地，该目录应该是空的。
                           </div>
                        </li>
                        <li class="stepexpand"><span>编辑初始化参数文件，该文件默认位于<code class="codeph">$ORACLE_HOME/dbs</code>目录中，以包含以下参数：</span><ul>
                              <li><code class="codeph">WALLET_ROOT</code> ，指向wallet目录的位置。
                                 <p>例如，对于名为<code class="codeph">orcl</code>的数据库：</p><pre class="oac_no_warn" dir="ltr">wallet_root = $ ORACLE_BASE /管理/ ORCL /钱包</pre></li>
                              <li><code class="codeph">TDE_CONFIGURATION</code> ，用于指定以下密钥库类型之一：<ul style="list-style-type:disc">
                                    <li>
                                       <p><code class="codeph">FILE</code>指定软件密钥库。
                                       </p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">OKV</code>指定Oracle Key Vault密钥库。
                                       </p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">HSM</code>指定硬件安全模块（HSM）密钥库。
                                       </p>
                                    </li>
                                 </ul>
                                 <p>例如，要指定TDE密钥库类型：</p><pre class="oac_no_warn" dir="ltr">tde_configuration = “keystore_configuration =文件”</pre></li>
                           </ul>
                        </li>
                        <li class="stepexpand"><span>以已被授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的用户身份登录CDB根目录。</span><div>例如：<pre class="oac_no_warn" dir="ltr">sqlplus sec_admin as syskm输入密码： <span class="italic">password</span></pre></div>
                        </li>
                        <li class="stepexpand"><span>检查配置设置。</span><ul>
                              <li>对于<code class="codeph">WALLET_ROOT</code>参数：<pre class="oac_no_warn" dir="ltr">显示参数WALLET_ROOT</pre><p>输出的<code class="codeph">VALUE</code>列应显示<code class="codeph">wallet</code>目录的绝对路径位置。
                                 </p>
                              </li>
                              <li>对于<code class="codeph">TDE_CONFIGURATION</code>参数：<pre class="oac_no_warn" dir="ltr">显示参数TDE_CONFIGURATION</pre><p><code class="codeph">VALUE</code>列应显示密钥库类型，前面加上<code class="codeph">KEYSTORE_CONFIGURATION=</code> 。
                                 </p>
                              </li>
                           </ul>
                           <div>如果未显示这些值，请尝试使用<code class="codeph">STARTUP</code>命令重新启动数据库，该命令指向添加了这些设置的初始化参数文件的位置。例如：<pre class="oac_no_warn" dir="ltr">STARTUP PFILE = /u01/oracle/dbs/init.ora</pre></div>
                        </li>
                        <li class="stepexpand"><span>确认已正确设置<code class="codeph">TDE_CONFIGURATION</code>参数。</span><div><pre class="oac_no_warn" dir="ltr">SELECT CON_ID，KEYSTORE_MODE FROM V $ ENCRYPTION_WALLET;</pre><div class="p">输出应类似于以下内容：<pre class="oac_no_warn" dir="ltr">CON_ID KEYSTORE ---------- -------- 1 NONE 2 UNITED 3 UNITED 4 UNITED 5 UNITED</pre>CDB根（ <code class="codeph">CON_ID 1</code> ）将始终处于<code class="codeph">NONE</code>状态，在此阶段，剩余的<code class="codeph">CON_ID</code>应设置为<code class="codeph">UNITED</code> 。 PDB可以是<code class="codeph">UNITED</code>或<code class="codeph">ISOLATED</code> ，具体取决于您配置它们的方式。查询<code class="codeph">V$ENCRYPTION_WALLET</code>视图时，如果出现<code class="codeph">ORA-46691: The value of the KEYSTORE_CONFIGURATION attribute is invalid</code>错误，则检查添加此设置的初始化参数文件。
                              </div>
                           </div>
                        </li>
                     </ol>
                     <div class="section">配置联合模式后，您可以创建密钥库和主加密密钥，配置这些密钥后，您可以加密数据。</div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-13AB7212-BA7A-488D-AD70-D84C3B651127" title="对于联合模式，您可以仅使用参数或参数组合以及ALTER SYSTEM语句来配置密钥库位置和类型。">为联合模式配置密钥库位置和类型</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-CD6E4741-4916-4F24-9427-4DA25DF40587" name="GUID-CD6E4741-4916-4F24-9427-4DA25DF40587"></a><h4 id="ASOAG-GUID-CD6E4741-4916-4F24-9427-4DA25DF40587" class="sect4">使用初始化参数文件和ALTER SYSTEM配置联合模式</h4>
                  <div>
                     <p>如果您的环境依赖于服务器参数文件（spfile）或参数文件（pfile），则可以使用带有<code class="codeph">SCOPE</code> <code class="codeph">ALTER SYSTEM</code>设置<code class="codeph">TDE_CONFIGURATION</code> 。</p>
                     <div class="section">使用此方法，仍然可以在初始化参数文件中设置<code class="codeph">WALLET_ROOT</code>静态初始化参数。
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>登录Oracle数据库的CDB根所在的服务器。</span></li>
                        <li class="stepexpand"><span>如有必要，请创建一个钱包目录。</span><div>通常，wallet目录位于<code class="codeph">$ORACLE_BASE/admin/ <span class="codeinlineitalic">db_unique_name</span></code>目录中，名为<code class="codeph">wallet</code> 。优选地，该目录应该是空的。
                           </div>
                        </li>
                        <li class="stepexpand"><span>编辑初始化参数文件以包含wallet目录的<code class="codeph">WALLET_ROOT</code>静态初始化参数。</span><div>默认情况下，初始化参数文件位于<code class="codeph">$ORACLE_HOME/dbs</code>目录中。
                           </div>
                           <div>例如，对于名为<code class="codeph">orcl</code>的数据库实例：<pre class="oac_no_warn" dir="ltr">wallet_root = $ ORACLE_BASE /管理/ ORCL /钱包</pre></div>
                        </li>
                        <li class="stepexpand"><span>以已被授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的用户身份登录CDB根目录。</span><div>例如：<pre class="oac_no_warn" dir="ltr">sqlplus sec_admin as syskm输入密码： <span class="italic">password</span></pre></div>
                        </li>
                        <li class="stepexpand"><span>重启数据库。</span><div><pre class="oac_no_warn" dir="ltr">关机立即启动</pre><p>要通过指向添加了<code class="codeph">WALLET_ROOT</code>设置的初始化文件的位置来启动数据库，请发出类似于以下内容的<code class="codeph">STARTUP</code>命令：</p><pre class="oac_no_warn" dir="ltr">STARTUP PFILE = /u01/oracle/dbs/init.ora</pre></div>
                        </li>
                        <li class="stepexpand"><span>检查<code class="codeph">WALLET_ROOT</code>设置。</span><div><pre class="oac_no_warn" dir="ltr">显示参数WALLET_ROOT</pre><p>输出的<code class="codeph">VALUE</code>列应显示<code class="codeph">wallet</code>目录的绝对路径位置。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>使用以下语法设置<code class="codeph">TDE_CONFIGURATION</code>动态初始化参数以指定密钥库类型：</span><div><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM SET TDE_CONFIGURATION =“KEYSTORE_CONFIGURATION = <span class="italic">keystore_type</span> ”SCOPE = <span class="italic">scope_type</span> ;</pre><p>在本规范中：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph"><span class="codeinlineitalic">keystore_type</span></code>可以是联合模式的以下设置之一：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><code class="codeph">FILE</code>配置TDE密钥库。
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">OKV</code>配置Oracle Key Vault密钥库。
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">HSM</code>配置硬件安全模块（HSM）密钥库。
                                          </p>
                                       </li>
                                    </ul>
                                 </li>
                                 <li>
                                    <p><code class="codeph"><span class="codeinlineitalic">scope_type</span></code>设置的范围的类型（例如， <code class="codeph">both</code> ， <code class="codeph">memory</code> ， <code class="codeph">spfile</code> ， <code class="codeph">pfile</code> 。
                                    </p>
                                 </li>
                              </ul>
                              <p>例如，要在参数文件（ <code class="codeph">pfile</code> ）正在使用时配置TDE密钥库，请将<code class="codeph">scope</code>设置为<code class="codeph">memory</code> ：</p><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM SET TDE_CONFIGURATION =“KEYSTORE_CONFIGURATION = FILE”SCOPE = memory;</pre><p>要配置TDE密钥库如果服务器参数文件（ <code class="codeph">spfile</code> ）在使用中，设定范围， <code class="codeph">both</code> ：</p><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM SET TDE_CONFIGURATION =“KEYSTORE_CONFIGURATION = FILE”SCOPE = both;</pre></div>
                        </li>
                        <li class="stepexpand"><span>检查<code class="codeph">TDE_CONFIGURATION</code>参数设置。</span><div><pre class="oac_no_warn" dir="ltr">显示参数TDE_CONFIGURATION</pre><p><code class="codeph">VALUE</code>列应显示密钥库类型，前面加上<code class="codeph">KEYSTORE_CONFIGURATION=</code> 。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>确认已正确设置<code class="codeph">TDE_CONFIGURATION</code>参数。</span><div><pre class="oac_no_warn" dir="ltr">SELECT CON_ID，KEYSTORE_MODE FROM V $ ENCRYPTION_WALLET;</pre><div class="p">输出应类似于以下内容：<pre class="oac_no_warn" dir="ltr">CON_ID KEYSTORE ---------- -------- 1 NONE 2 UNITED 3 UNITED 4 UNITED 5 UNITED</pre>CDB根（ <code class="codeph">CON_ID 1</code> ）将始终处于<code class="codeph">NONE</code>状态，在此阶段，剩余的<code class="codeph">CON_ID</code>应设置为<code class="codeph">UNITED</code> 。 PDB可以是<code class="codeph">UNITED</code>或<code class="codeph">ISOLATED</code> ，具体取决于您配置它们的方式。查询<code class="codeph">V$ENCRYPTION_WALLET</code>视图时，如果出现<code class="codeph">ORA-46691: The value of the KEYSTORE_CONFIGURATION attribute is invalid</code>错误，则检查添加此设置的初始化参数文件。
                              </div>
                           </div>
                        </li>
                     </ol>
                     <div class="section">配置联合模式后，您可以创建密钥库和主加密密钥，配置这些密钥后，您可以加密数据。</div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-13AB7212-BA7A-488D-AD70-D84C3B651127" title="对于联合模式，您可以仅使用参数或参数组合以及ALTER SYSTEM语句来配置密钥库位置和类型。">为联合模式配置密钥库位置和类型</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
            <div class="sect2"><a id="GUID-2E40034B-4523-4D1C-9A2F-BCC3D58C570D" name="GUID-2E40034B-4523-4D1C-9A2F-BCC3D58C570D"></a><h3 id="ASOAG-GUID-2E40034B-4523-4D1C-9A2F-BCC3D58C570D" class="sect3">配置软件密钥库以在联合模式下使用</h3>
               <div>
                  <p>在联合模式下，软件密钥库位于CDB根目录中，但来自此密钥库的主密钥可用于其密钥库处于联合模式的PDB。</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-864C19CD-C973-487D-8D4D-BCB8CD99BD6E">关于以联合模式配置软件密钥库</a><br>在联合模式下，您在CDB根目录中创建的密钥库将可由联合模式PDB访问。
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-3219B2E9-DA55-4404-B602-C47EE8DCE25A">第1步：创建软件密钥库</a><br>在联合模式下，您必须在CDB根目录中创建密钥库。
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-765C103D-67A0-4DF1-930E-CFFFA89B2DC2">步骤2：在联合模式PDB中打开软件密钥库</a><br>要以联合模式打开软件密钥库，必须将<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句与<code class="codeph">SET KEYSTORE OPEN</code>子句一起使用。
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-8A6CF613-F182-4249-ACAE-764C145E210B">步骤3：在联合模式下在软件密钥库中设置TDE主加密密钥</a><br>要在联合模式下配置PDB时在密钥库中设置TDE主加密密钥，请使用带有<code class="codeph">SET KEY</code>子句的<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句。
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-54A232F4-B303-40B1-B8A4-74FEB9B39239">第4步：以联合模式加密您的数据</a><br>现在您已完成密钥库配置并且PDB配置为联合模式，您可以开始加密PDB中的数据。</li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-FA569DEC-6FF3-4CA1-86AA-D27F29EDCA3C" title="通过联合模式，您可以为CDB和密钥库处于联合模式的PDB创建公共密钥库。">在联合模式下管理密钥库和TDE主加密密钥</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-864C19CD-C973-487D-8D4D-BCB8CD99BD6E" name="GUID-864C19CD-C973-487D-8D4D-BCB8CD99BD6E"></a><h4 id="ASOAG-GUID-864C19CD-C973-487D-8D4D-BCB8CD99BD6E" class="sect4">关于以联合模式配置软件密钥库</h4>
                  <div>
                     <p>在联合模式下，您在CDB根目录中创建的密钥库将可由联合模式PDB访问。</p>
                     <p>通常，要在启用联合模式后配置联合模式软件密钥库，请在CDB根目录中创建并打开密钥库，然后为此密钥库创建主加密密钥。之后，您可以开始加密可在整个CDB环境中访问的表和表空间的数据。</p>
                     <p><code class="codeph">V$ENCRYPTION_WALLET</code>动态视图描述了密钥库的状态和位置。例如，以下查询显示CDB根密钥库（ <code class="codeph">CON_ID 1</code> ）的打开关闭状态和密钥库位置及其关联的联合模式PDB。<code class="codeph">WRL_PARAMETER</code>列显示位于<code class="codeph">$ORACLE_BASE/wallet/tde</code>目录中的CDB根密钥库位置。
                     </p><pre class="oac_no_warn" dir="ltr">从V $ ENCRYPTION_WALLET中选择CON_ID，STATUS，WRL_PARAMETER; CON_ID STATUS WRL_PARAMETER ------ ------ ----------------------------- 1 OPEN / app / oracle / wallet / tde / 2 CLOSED 3 OPEN 4 OPEN 5 OPEN</pre><p>在此输出中，没有为此CDB中的其他PDB列出密钥库路径，因为这些PDB使用CDB根目录中的密钥库。如果隔离了任何这些PDB并在隔离模式PDB中创建密钥库，则在执行此查询时， <code class="codeph">WRL_PARAMETER</code>列将显示隔离模式PDB的密钥库路径。</p>
                     <p>您可以为软件密钥库创建安全的外部存储。此功能使您可以隐藏操作系统的密码：它无需在脚本或其他工具中存储明文密钥库密码，无需用户干预即可访问数据库，例如隔夜批处理脚本。此密钥库的位置由<code class="codeph">EXTERNAL_KEYSTORE_CREDENTIAL_LOCATION</code>初始化参数设置。在多租户环境中，当您使用<code class="codeph">IDENTIFIED BY EXTERNAL STORE</code>子句运行<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句时，不同的PDB可以访问此外部存储位置。这样，您可以集中找到密码，然后在外部存储中只更新一次。
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-2E40034B-4523-4D1C-9A2F-BCC3D58C570D" title="在联合模式下，软件密钥库位于CDB根目录中，但来自此密钥库的主密钥可用于其密钥库处于联合模式的PDB。">配置在联合模式下使用的软件密钥库</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-3219B2E9-DA55-4404-B602-C47EE8DCE25A" name="GUID-3219B2E9-DA55-4404-B602-C47EE8DCE25A"></a><h4 id="ASOAG-GUID-3219B2E9-DA55-4404-B602-C47EE8DCE25A" class="sect4">第1步：创建软件密钥库</h4>
                  <div>
                     <p>在联合模式下，您必须在CDB根目录中创建密钥库。</p>
                     <div class="section">在CDB根目录中创建此密钥库后，它将在任何联合模式PDB中可用，但不能在任何隔离模式PDB中使用。</div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>以已被授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的用户身份登录CDB根目录。</span><div>例如：<pre class="oac_no_warn" dir="ltr">sqlplus c ## sec_admin as syskm输入密码： <span class="italic">password</span></pre></div>
                        </li>
                        <li class="stepexpand"><span>运行<code class="codeph">ADMINISTER KEY MANAGEMENT</code> SQL语句以使用以下语法创建密钥库：</span><div><pre class="oac_no_warn" dir="ltr">ADMINISTER密钥管理CREATE KEYSTORE [' <span class="italic">keystore_location</span> ']通过<span class="italic">software_keystore_password</span>标识;</pre><p>在本规范中：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><span class="italic"><code class="codeph">keystore_location</code></span>是要为其创建自动登录密钥库的受密码保护的密钥库的密钥库目录位置的路径。如果<code class="codeph">WALLET_ROOT</code>参数设置的路径是您要使用的路径，则可以省略<span class="italic"><code class="codeph">keystore_location</code></span>设置。
                                    </p>
                                    <p>如果指定<span class="italic"><code class="codeph">keystore_location</code></span> ，则将其用单引号（ <code class="codeph">' '</code> ）括起来。要查找默认位置，可以查询<code class="codeph">V$ENCRYPTION_WALLET</code>视图的<code class="codeph">WRL_PARAMETER</code>列。（如果未在默认位置创建密钥库，则<code class="codeph">V$ENCRYPTION_WALLET</code>视图的<code class="codeph">STATUS</code> <code class="codeph">NOT_AVAILABLE</code> 。）
                                    </p>
                                 </li>
                                 <li>
                                    <p><span class="italic"><code class="codeph">software_keystore_password</code></span>是您（安全管理员）创建的密钥库的密码。
                                    </p>
                                 </li>
                              </ul>
                              <p>例如，要在默认位置创建密钥库，假设已设置<code class="codeph">WALLET_ROOT</code> ：</p><pre class="oac_no_warn" dir="ltr">管理员密钥管理创建由<span class="italic">密码</span>识别的<span class="italic">密钥</span> ;密钥库已更改。
</pre></div>
                        </li>
                     </ol>
                     <div class="section">完成这些步骤后，包含密钥库的<code class="codeph">ewallet.p12</code>文件将显示在指定的密钥库位置中。例如，如果您将<code class="codeph">WALLET_ROOT</code>参数设置为<code class="codeph">$ORACLE_BASE/wallet</code>并将<code class="codeph">TDE_CONFIGURATION</code>参数设置为<code class="codeph">FILE</code> （对于TDE，它在钱包根位置创建了一个<code class="codeph">tde</code>目录），则将在<code class="codeph">$ORACLE_BASE/wallet/tde</code>创建密钥库。 <code class="codeph">$ORACLE_BASE/wallet/tde</code>目录。密钥库的名称是<code class="codeph">ewallet.p12</code> 。
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-4F6206B6-A33F-4FB1-9223-DD61FFAD3F12" title="密钥库密码的外部存储将密钥库密码存储在集中访问和管理的位置。">为密钥库密码配置外部存储</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-2E40034B-4523-4D1C-9A2F-BCC3D58C570D" title="在联合模式下，软件密钥库位于CDB根目录中，但来自此密钥库的主密钥可用于其密钥库处于联合模式的PDB。">配置在联合模式下使用的软件密钥库</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-765C103D-67A0-4DF1-930E-CFFFA89B2DC2" name="GUID-765C103D-67A0-4DF1-930E-CFFFA89B2DC2"></a><h4 id="ASOAG-GUID-765C103D-67A0-4DF1-930E-CFFFA89B2DC2" class="sect4">步骤2：在联合模式PDB中打开软件密钥库</h4>
                  <div>
                     <p>要以联合模式打开软件密钥库，必须将<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句与<code class="codeph">SET KEYSTORE OPEN</code>子句一起使用。
                     </p>
                     <ol>
                        <li class="stepexpand"><span>以已被授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的普通用户身份登录CDB根目录。</span><div>例如：<pre class="oac_no_warn" dir="ltr">sqlplus c ## sec_admin as syskm输入密码： <span class="italic">password</span></pre></div>
                        </li>
                        <li class="stepexpand"><span>打开CDB根目录中的密钥库。</span><div>例如：<pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN由<span class="italic">密码</span>识别;密钥库已更改。</pre><p>如果使用<code class="codeph">EXTERNAL_KEYSTORE_CREDENTIAL_LOCATION</code>实例初始化参数配置数据库实例，并且该位置的密钥库包含受密码保护的密钥库的凭据，并且您希望从使用自动登录密钥库切换到使用受密码保护的密钥库在这些凭据中，您必须在<code class="codeph">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN</code>语句中包含<code class="codeph">FORCE KEYSTORE</code>子句和<code class="codeph">IDENTIFIED BY EXTERNAL STORE</code>子句，如下所示：</p><pre class="oac_no_warn" dir="ltr">管理员密钥管理设置KEYSTORE OPEN FORCE KEYORE由外部商店识别;密钥库已更改。</pre><p>如果已设置<code class="codeph">WALLET_ROOT</code>参数，则Oracle数据库通过在CDB根目录中搜索此路径来查找外部存储： <code class="codeph"><span class="codeinlineitalic">WALLET_ROOT</span> /tde_seps</code> 。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>确保要在其中打开密钥库的PDB处于<code class="codeph">READ WRITE</code>模式。</span><div>例如：<pre class="oac_no_warn" dir="ltr">显示PDBS CON_ID CON_NAME OPEN MODE RESTRICTED ------ ---------- ------------ ----------- 2 PDB $ SEED只读3 CDB1_PDB1 READ WRITE NO</pre><p>如果任何PDB的<code class="codeph">OPEN MODE</code>值与<code class="codeph">READ WRITE</code>不同，则运行以下语句打开PDB，将其设置为<code class="codeph">READ WRITE</code>模式：</p><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE CDB1_PDB1 OPEN;</pre><p>现在可以在CDB根目录和PDB中打开密钥库。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>连接到PDB。</span></li>
                        <li class="stepexpand"><span>运行<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句以打开密钥库。</span><div><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN由<span class="italic">密码</span>识别;密钥库已更改。</pre><p>要在配置自动登录密钥库并且当前处于打开状态时切换到打开受密码保护的软件密钥库，请按如下所示指定<code class="codeph">FORCE KEYSTORE</code>子句。
                              </p><pre class="oac_no_warn" dir="ltr">管理员密钥管理设置KEYSTORE OPEN FORCE KEYORE由外部商店识别;密钥库已更改。</pre><p><code class="codeph">FORCE KEYSTORE</code>对于负载很重的数据库也很有用。<code class="codeph">IDENTIFIED BY EXTERNAL STORE</code>子句包含在语句中，因为密钥库凭据存在于外部存储中。这样可以打开受密码保护的密钥库，而无需在语句本身中指定密钥库密码。
                              </p>
                              <p>如果已设置<code class="codeph">WALLET_ROOT</code>参数，则Oracle数据库通过在此路径中搜索来查找外部存储： <code class="codeph"><span class="codeinlineitalic">WALLET_ROOT</span> / <span class="codeinlineitalic">PDB_GUID</span> /tde_seps</code> 。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>确认密钥库已打开。</span><div><pre class="oac_no_warn" dir="ltr">从V $ ENCRYPTION_WALLET中选择状态;</pre></div>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="configuring-transparent-data-encryption.html#GUID-F3652F6F-B1B8-485A-BCBE-32C0875E93E5" title="必须先打开受密码保护的软件密钥库，然后才能在密钥库中创建或访问任何TDE主加密密钥。">关于打开软件密钥库</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-2E40034B-4523-4D1C-9A2F-BCC3D58C570D" title="在联合模式下，软件密钥库位于CDB根目录中，但来自此密钥库的主密钥可用于其密钥库处于联合模式的PDB。">配置在联合模式下使用的软件密钥库</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-8A6CF613-F182-4249-ACAE-764C145E210B" name="GUID-8A6CF613-F182-4249-ACAE-764C145E210B"></a><h4 id="ASOAG-GUID-8A6CF613-F182-4249-ACAE-764C145E210B" class="sect4">步骤3：在联合模式下在软件密钥库中设置TDE主加密密钥</h4>
                  <div>
                     <p>要在联合模式下配置PDB时在密钥库中设置TDE主加密密钥，请使用带有<code class="codeph">SET KEY</code>子句的<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句。
                     </p>
                     <ol>
                        <li class="stepexpand"><span>以已授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的用户身份登录CDB根目录或为联合模式配置的PDB。</span></li>
                        <li class="stepexpand"><span>确保数据库在<code class="codeph">READ WRITE</code>模式下打开。</span><div>要查找状态，请运行<code class="codeph">show pdbs</code>命令。
                           </div>
                        </li>
                        <li class="stepexpand"><span>运行<code class="codeph">ADMINISTER KEY MANAGEMENT SET ENCRYPTION KEY</code>语句以在密钥库中创建或重新生成TDE主加密密钥。</span><div>例如，如果密钥库受密码保护并且已打开，并且您要在当前容器中创建或重新生成TDE主加密密钥：<pre class="oac_no_warn" dir="ltr">通过<span class="italic">keystore_password</span>使用'emp_key_backup'和BACKUP来识别的ADMINISTER密钥管理集<span class="italic">密钥</span> ;密钥库已更改。</pre><p>如果密钥库已关闭：</p><pre class="oac_no_warn" dir="ltr">ADMINISTER密钥管理设置密钥强制关键字由<span class="italic">keystore_password</span>标识，带有备份使用'emp_key_backup';密钥库已更改。</pre><p>在本规范中：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>如果密钥库已关闭，则应包括<code class="codeph">FORCE KEYSTORE</code> 。这会在设置TDE主加密密钥之前自动打开密钥库。当配置自动登录密钥库并且当前打开时， <code class="codeph">FORCE KEYSTORE</code>子句还会切换到打开受密码保护的软件密钥库。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">IDENTIFIED BY</code>指定密钥库密码。或者，如果密钥库密码位于外部存储中，则可以使用<code class="codeph">IDENTIFIED BY EXTERNAL STORE</code>子句。
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>确认已设置TDE主加密密钥。</span><div><pre class="oac_no_warn" dir="ltr">从V $ DATABASE_KEY_INFO中选择MASTERKEY_ACTIVATED;</pre><p>输出应为<code class="codeph">YES</code> 。</p>
                           </div>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="configuring-transparent-data-encryption.html#GUID-C44968C5-9B77-4D19-82F4-5705268BF429" title="TDE主加密密钥存储在密钥库中。">关于设置软件密钥库TDE主加密密钥</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-2E40034B-4523-4D1C-9A2F-BCC3D58C570D" title="在联合模式下，软件密钥库位于CDB根目录中，但来自此密钥库的主密钥可用于其密钥库处于联合模式的PDB。">配置在联合模式下使用的软件密钥库</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-54A232F4-B303-40B1-B8A4-74FEB9B39239" name="GUID-54A232F4-B303-40B1-B8A4-74FEB9B39239"></a><h4 id="ASOAG-GUID-54A232F4-B303-40B1-B8A4-74FEB9B39239" class="sect4">第4步：以联合模式加密您的数据</h4>
                  <div>
                     <p>现在您已完成密钥库配置并且PDB配置为联合模式，您可以开始加密PDB中的数据。</p>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="configuring-transparent-data-encryption.html#GUID-A0E2C279-10F6-48D9-AB92-C547529C06EE" title="您可以使用透明数据加密来加密数据库表中的各个列。">加密表中的列</a></li>
                           <li><a href="configuring-transparent-data-encryption.html#GUID-1CA947A5-164A-4AA9-AD75-F7D9D4F6FFF8" title="您可以在脱机和联机表空间和数据库上执行加密操作。">表空间和数据库的加密转换</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-2E40034B-4523-4D1C-9A2F-BCC3D58C570D" title="在联合模式下，软件密钥库位于CDB根目录中，但来自此密钥库的主密钥可用于其密钥库处于联合模式的PDB。">配置在联合模式下使用的软件密钥库</a></p>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-540A5DBF-720E-49E5-9060-DF40D3D4F6B0" name="GUID-540A5DBF-720E-49E5-9060-DF40D3D4F6B0"></a><h3 id="ASOAG-GUID-540A5DBF-720E-49E5-9060-DF40D3D4F6B0" class="sect3">以联合模式配置硬件密钥库</h3>
               <div>
                  <p>在联合模式下，硬件密钥库驻留在硬件安全模块（HSM）中，该模块用于存储加密密钥。</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-E4D90305-E42D-4A48-9883-0F085DE04688">关于以联合模式配置硬件密钥库</a><br>您必须使用隔离模式在PDB中创建硬件密钥库，但您可以在联合模式下执行其他任务。
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-2E85D8BB-9798-46B4-9BEC-BD99737D32E8">步骤1：配置联合模式硬件安全模块</a><br>要配置第三方硬件安全模块，必须将PKCS＃11库复制到正确的位置，并按照供应商的说明进行操作</li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-D028AC50-36FA-4AB4-AC19-4A26CE3C90C7">步骤2：在联合模式PDB中打开硬件密钥库</a><br>要以联合模式打开硬件密钥库，必须使用<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句和<code class="codeph">SET KEYSTORE OPEN</code>子句。
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-4C0941AC-C684-43D0-B3E7-25D168C98FFB">步骤3：以联合模式在硬件密钥库中设置TDE主加密密钥</a><br>要在联合模式下配置PDB时在密钥库中设置TDE主加密密钥，请使用带有<code class="codeph">SET KEY</code>子句的<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句。
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#unique_615684953">第4步：以联合模式加密您的数据</a><br>现在您已完成密钥库配置并且PDB配置为联合模式，您可以开始加密PDB中的数据。</li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-FA569DEC-6FF3-4CA1-86AA-D27F29EDCA3C" title="通过联合模式，您可以为CDB和密钥库处于联合模式的PDB创建公共密钥库。">在联合模式下管理密钥库和TDE主加密密钥</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-E4D90305-E42D-4A48-9883-0F085DE04688" name="GUID-E4D90305-E42D-4A48-9883-0F085DE04688"></a><h4 id="ASOAG-GUID-E4D90305-E42D-4A48-9883-0F085DE04688" class="sect4">关于以联合模式配置硬件密钥库</h4>
                  <div>
                     <p>您必须使用隔离模式在PDB中创建硬件密钥库，但您可以在联合模式下执行其他任务。</p>
                     <p>要在隔离模式下为PDB配置硬件密钥库，首先必须设置<code class="codeph">WALLET_ROOT</code>参数。这有两个原因：第一，支持将来迁移到软件密钥库，第二，因为Oracle Key Vault的配置文件是从<code class="codeph">WALLET_ROOT</code>下的位置检索的。然后，必须将<code class="codeph">TDE_CONFIGURATION</code>参数的<code class="codeph">KEYSTORE_CONFIGURATION</code>属性设置为<code class="codeph">HSM</code>或<code class="codeph">OKV</code> ，打开配置的硬件密钥库，然后为PDB设置TDE主加密密钥。完成这些任务后，您可以开始加密PDB中的数据。</p>
                     <p>运行<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句时如何指定<code class="codeph">IDENTIFIED BY</code>子句取决于硬件密钥库的类型。对于硬件安全模块（ <code class="codeph">HSM</code> ），使用以下语法：</p><pre class="oac_no_warn" dir="ltr">由“ <span class="italic">user_name</span> ： <span class="italic">password</span> ”标识</pre><p>对于Oracle Key Vault密钥库，您可以省略<code class="codeph"><span class="codeinlineitalic">user_name</span></code>和冒号（但保留引号）：</p><pre class="oac_no_warn" dir="ltr">通过“ <span class="italic">密码</span> ”识别</pre></div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-540A5DBF-720E-49E5-9060-DF40D3D4F6B0" title="在联合模式下，硬件密钥库驻留在硬件安全模块（HSM）中，该模块用于存储加密密钥。">以联合模式配置硬件密钥库</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-2E85D8BB-9798-46B4-9BEC-BD99737D32E8" name="GUID-2E85D8BB-9798-46B4-9BEC-BD99737D32E8"></a><h4 id="ASOAG-GUID-2E85D8BB-9798-46B4-9BEC-BD99737D32E8" class="sect4">步骤1：配置联合模式硬件安全模块</h4>
                  <div>
                     <p>要配置第三方硬件安全模块，必须将PKCS＃11库复制到正确的位置，并按照供应商的说明进行操作</p>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="configuring-transparent-data-encryption.html#GUID-7838C4B8-FF6A-4B81-86C1-8583D3555291" title="要配置第三方硬件安全模块，必须将PKCS＃11库复制到正确的位置，并按照供应商的说明进行操作。">步骤2：配置硬件安全模块</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-540A5DBF-720E-49E5-9060-DF40D3D4F6B0" title="在联合模式下，硬件密钥库驻留在硬件安全模块（HSM）中，该模块用于存储加密密钥。">以联合模式配置硬件密钥库</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-D028AC50-36FA-4AB4-AC19-4A26CE3C90C7" name="GUID-D028AC50-36FA-4AB4-AC19-4A26CE3C90C7"></a><h4 id="ASOAG-GUID-D028AC50-36FA-4AB4-AC19-4A26CE3C90C7" class="sect4">步骤2：在联合模式PDB中打开硬件密钥库</h4>
                  <div>
                     <p>要以联合模式打开硬件密钥库，必须使用<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句和<code class="codeph">SET KEYSTORE OPEN</code>子句。
                     </p>
                     <ol>
                        <li class="stepexpand"><span>以已被授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的普通用户身份登录CDB根目录。</span><div>例如：<pre class="oac_no_warn" dir="ltr">sqlplus c ## sec_admin as syskm输入密码： <span class="italic">password</span></pre></div>
                        </li>
                        <li class="stepexpand"><span>使用以下语法打开CDB根目录中的密钥库。</span><div><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN由“ <span class="italic">hardware_keystore_credentials</span> ”识别;</pre><p>硬件密钥库的类型决定了如何指定硬件密钥库密码。对于硬件安全模块，必须使用<code class="codeph"><span class="codeinlineitalic">user_name</span> : <span class="codeinlineitalic">password</span></code>语法。例如：</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN由“psmith： <span class="italic">password</span> ”识别;密钥库已更改。</pre><p>对于Oracle Key Vault密钥库，您只能提供密码。<code class="codeph">IDENTIFIED BY</code>子句中不允许使用用户名。用双引号括起密码。
                              </p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN由“ <span class="italic">password</span> ”识别;</pre></div>
                        </li>
                        <li class="stepexpand"><span>确保要在其中打开密钥库的PDB处于<code class="codeph">READ WRITE</code>模式。</span><div>例如：<pre class="oac_no_warn" dir="ltr">显示PDBS CON_ID CON_NAME OPEN MODE RESTRICTED ------ ---------- ------------ ----------- 2 PDB $ SEED只读3 CDB1_PDB1 READ WRITE NO</pre><p>如果任何PDB的<code class="codeph">OPEN MODE</code>值与<code class="codeph">READ WRITE</code>不同，则运行以下语句打开PDB，将其设置为<code class="codeph">READ WRITE</code>模式：</p><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE CDB1_PDB1 OPEN;</pre><p>现在可以在CDB根目录和PDB中打开密钥库。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>连接到PDB并运行<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句以打开密钥库。</span><div>例如，对于HSM：<pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN由“psmith： <span class="italic">password</span> ”识别;密钥库已更改。</pre><p>如果CDB根密钥库可能已关闭，或者数据库负载过重，则可以包括<code class="codeph">FORCE KEYSTORE</code>子句。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>确认密钥库已打开。</span><div><pre class="oac_no_warn" dir="ltr">从V $ ENCRYPTION_WALLET中选择状态;</pre></div>
                        </li>
                        <li class="stepexpand"><span>每次重新启动数据库实例时重复此过程。</span></li>
                     </ol>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="configuring-transparent-data-encryption.html#GUID-CEDB143A-BC7E-43EF-AD41-59BD0ED36421" title="必须先打开硬件密钥库，以便数据库可以访问它，然后才能执行任何加密或解密。">关于打开硬件密钥库</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-540A5DBF-720E-49E5-9060-DF40D3D4F6B0" title="在联合模式下，硬件密钥库驻留在硬件安全模块（HSM）中，该模块用于存储加密密钥。">以联合模式配置硬件密钥库</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-4C0941AC-C684-43D0-B3E7-25D168C98FFB" name="GUID-4C0941AC-C684-43D0-B3E7-25D168C98FFB"></a><h4 id="ASOAG-GUID-4C0941AC-C684-43D0-B3E7-25D168C98FFB" class="sect4">步骤3：以联合模式在硬件密钥库中设置TDE主加密密钥</h4>
                  <div>
                     <p>要在联合模式下配置PDB时在密钥库中设置TDE主加密密钥，请使用带有<code class="codeph">SET KEY</code>子句的<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句。
                     </p>
                     <ol>
                        <li class="stepexpand"><span>以已授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的用户身份登录CDB根目录或为联合模式配置的PDB。</span></li>
                        <li class="stepexpand"><span>确保数据库在<code class="codeph">READ WRITE</code>模式下打开。</span><div>要查找状态，请运行<code class="codeph">SHOW PDBS</code>命令。
                           </div>
                        </li>
                        <li class="stepexpand"><span>运行<code class="codeph">ADMINISTER KEY MANAGEMENT SET ENCRYPTION KEY</code>语句以在密钥库中创建或重新生成TDE主加密密钥。</span><div><pre class="oac_no_warn" dir="ltr">管理员密钥管理集密钥[使用标记' <span class="italic">标记</span> '] [FORCE KEYSTORE]由[EXTERNAL STORE | “ <span class="italic">hardware_keystore_credentials</span> ”];</pre><p>在本规范中：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">FORCE KEYSTORE</code>临时打开此操作的受密码保护的密钥库。您必须打开此操作的密钥库。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph"><span class="codeinlineitalic">hardware_keystore_credentials</span></code>是指HSM或Oracle Key Vault硬件密钥库的凭据。对于HSM，请使用此格式指定凭据，用引号括起并用冒号分隔组件： <code class="codeph">“ <span class="codeinlineitalic">user_name</span> : <span class="codeinlineitalic">password</span> ”</code> ，其中<code class="codeph"><span class="codeinlineitalic">user_name</span></code>是创建HSM的用户，密码是此用户的密码。对于Oracle Key Vault，仅输入创建密钥库的用户的密码。用引号括起此密码。
                                    </p>
                                 </li>
                              </ul>
                              <p>例如：</p><pre class="oac_no_warn" dir="ltr">管理员密钥管理设置关键力量关键字由“psmith： <span class="italic">password</span> ”标识;密钥库已更改。</pre></div>
                        </li>
                        <li class="stepexpand"><span>确认已设置TDE主加密密钥。</span><div><pre class="oac_no_warn" dir="ltr">从V $ DATABASE_KEY_INFO中选择MASTERKEY_ACTIVATED;</pre><p>输出应为<code class="codeph">YES</code> 。</p>
                           </div>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="configuring-transparent-data-encryption.html#GUID-E3DC7C57-A8F3-41D5-98FB-1DBE6EE10D1E" title="您必须创建存储在硬件密钥库中的TDE主加密密钥。">关于设置硬件密钥库TDE主加密密钥</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-540A5DBF-720E-49E5-9060-DF40D3D4F6B0" title="在联合模式下，硬件密钥库驻留在硬件安全模块（HSM）中，该模块用于存储加密密钥。">以联合模式配置硬件密钥库</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="unique_615684953" name="unique_615684953"></a><h4 id="ASOAG-unique_615684953" class="sect4">第4步：以联合模式加密您的数据</h4>
                  <div>
                     <p>现在您已完成密钥库配置并且PDB配置为联合模式，您可以开始加密PDB中的数据。</p>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="configuring-transparent-data-encryption.html#GUID-A0E2C279-10F6-48D9-AB92-C547529C06EE" title="您可以使用透明数据加密来加密数据库表中的各个列。">加密表中的列</a></li>
                           <li><a href="configuring-transparent-data-encryption.html#GUID-1CA947A5-164A-4AA9-AD75-F7D9D4F6FFF8" title="您可以在脱机和联机表空间和数据库上执行加密操作。">表空间和数据库的加密转换</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-540A5DBF-720E-49E5-9060-DF40D3D4F6B0" title="在联合模式下，硬件密钥库驻留在硬件安全模块（HSM）中，该模块用于存储加密密钥。">以联合模式配置硬件密钥库</a></p>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" name="GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D"></a><h3 id="ASOAG-GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" class="sect3">在联合模式下管理密钥库和TDE主加密密钥</h3>
               <div>
                  <p>配置密钥库和主加密密钥以在联合模式下使用后，可以执行重新加密TDE主加密密钥等任务。</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-57805BD1-8E32-44A9-BAAB-38D4533DB40B">以联合模式更改密钥库密码</a><br>您只能在CDB根目录中更改软件密钥库或硬件密钥库的密码。
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-FFAEFC19-5D87-4881-BDC3-B4A186F65277">以联合模式备份受密码保护的软件密钥库</a><br><code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句的<code class="codeph">BACKUP KEYSTORE</code>子句备份受密码保护的软件密钥库。
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-DB6BC556-AD06-424F-9363-B3DE365532DA">以联合模式关闭密钥库</a><br>除非系统表空间已加密，否则您可以在联合模式下关闭软件和硬件密钥库。
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-7579CA90-26F9-487B-BBF8-FCD3AE428CF4">在联合模式下创建用户定义的TDE主加密密钥</a><br>要创建用户定义的TDE主加密密钥，请使用<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句和<code class="codeph">SET | CREATE [ENCRYPTION] KEY</code>子句。
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-04564072-A35F-477F-BAF3-8631ECB9D0B2">示例：在所有PDB中创建主加密密钥</a><br>您可以使用<code class="codeph">ADMINISTER KEY MANAGEMENT CREATE KEY USING TAG</code>语句在所有PDB中创建TDE主加密密钥。
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-C5B51467-0D33-446D-B914-188E6A253294">创建TDE主加密密钥以供以后在联合模式下使用</a><br>必须先打开密钥库，然后才能创建TDE主加密密钥，以便稍后在联合模式下使用。
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-710DD047-FBF9-42D7-B6AE-1327A53EEAC4">在联合模式下激活TDE主加密密钥</a><br>要在联合模式下激活TDE主加密密钥，您必须打开密钥库并使用<code class="codeph">ADMINISTER KEY MANAGEMENT</code>和<code class="codeph">USE KEY</code>子句。
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-21B30284-823A-4226-AD38-0B66F20663C5">在联合模式下重新加密TDE主加密密钥</a><br>您可以将<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句与<code class="codeph">SET KEY</code>子句一起使用，以重新生成TDE主加密密钥。
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-5E343820-7195-49F2-816C-E20941BB18E4">查找在联合模式下使用的TDE主加密密钥</a><br>正在使用的TDE主加密密钥是最近为数据库激活的密钥。
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-49328939-4225-4870-ACB1-E930CA5586D8">在联合模式下创建自定义属性标记</a><br>要在联合模式下创建自定义属性标记，必须使用<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句的<code class="codeph">SET TAG</code>子句。
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-CBB8C6CC-CF87-4E10-9170-938C7CE7483B">将TDE主加密密钥移动到联合模式下的新密钥库中</a><br>在联合模式下，您可以将现有TDE主加密密钥从现有软件密码密钥库移动到新密钥库中。
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-4E19B1E4-E5EF-4E9E-A5F4-BB62702EE7D8">在联合模式下自动删除非活动TDE主加密密钥</a><br>在联合模式下， <code class="codeph">REMOVE_INACTIVE_STANDBY_TDE_MASTER_KEY</code>初始化参数可以配置自动删除非活动TDE主加密密钥。
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-732D3890-6A80-4541-8489-B26A08BCEC17">隔离可插拔数据库密钥库</a><br>隔离PDB密钥库会将主加密密钥从CDB根密钥库移动到PDB中的隔离模式密钥库。</li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-FA569DEC-6FF3-4CA1-86AA-D27F29EDCA3C" title="通过联合模式，您可以为CDB和密钥库处于联合模式的PDB创建公共密钥库。">在联合模式下管理密钥库和TDE主加密密钥</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-57805BD1-8E32-44A9-BAAB-38D4533DB40B" name="GUID-57805BD1-8E32-44A9-BAAB-38D4533DB40B"></a><h4 id="ASOAG-GUID-57805BD1-8E32-44A9-BAAB-38D4533DB40B" class="sect4">以联合模式更改密钥库密码</h4>
                  <div>
                     <p>您只能在CDB根目录中更改软件密钥库或硬件密钥库的密码。</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-F70FF221-D5AC-4047-AEE8-4616F44B7191">以联合模式更改受密码保护的软件密钥库密码</a><br>要在联合模式下更改受密码保护的软件密钥库的密码，必须使用CDB根目录中的<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句。
                        </li>
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-DC6F874E-812F-4663-BE47-9528C6023196">以联合模式更改硬件密钥库的密码</a><br>要更改硬件密钥库的密码，必须关闭硬件密钥库，然后从硬件密钥库管理界面更改密码。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="配置密钥库和主加密密钥以在联合模式下使用后，可以执行重新加密TDE主加密密钥等任务。">在联合模式下管理密钥库和TDE主加密密钥</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="props_rev_3"><a id="GUID-F70FF221-D5AC-4047-AEE8-4616F44B7191" name="GUID-F70FF221-D5AC-4047-AEE8-4616F44B7191"></a><h5 id="ASOAG-GUID-F70FF221-D5AC-4047-AEE8-4616F44B7191" class="sect5">以联合模式更改受密码保护的软件密钥库密码</h5>
                     <div>
                        <p>要在联合模式下更改受密码保护的软件密钥库的密码，必须使用CDB根目录中的<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句。
                        </p>
                        <div class="section">您无法从统一模式PDB更改密钥库密码。</div>
                        <!-- class="section" -->
                        <div class="section">
                           <ol>
                              <li>
                                 <p>以已被授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的用户身份登录CDB根目录。
                                 </p>
                              </li>
                              <li>
                                 <p>使用以下语法更改密钥库的密码：</p><pre class="oac_no_warn" dir="ltr">ADMINISTER密钥管理ALTER存储密码[FORCE密钥库] IDENTIFIED BY <span class="italic">old_keystore_password</span> SET <span class="italic">new_keystore_password</span> [WITH BACKUP [USING <span class="italic">'backup_identifier']];</span></pre><p>在本规范中：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>如果在配置了自动登录密钥库且当前处于打开状态时密钥库已关闭，或者如果配置了密码保护密钥库且当前已关闭，则<code class="codeph">FORCE KEYSTORE</code>暂时打开此操作的受密码保护的密钥库。
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">old_password</code></span>是您要更改的当前密钥库密码。
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="italic"><code class="codeph">new_password</code></span>是您为密钥库设置的新密码。
                                       </p>
                                    </li>
                                    <li>
                                       <p>您不需要包含<code class="codeph">CONTAINER</code>子句，因为密码只能在CDB根目录中进行本地更改。
                                       </p>
                                    </li>
                                 </ul>
                                 <p>以下示例创建密钥库的备份，然后更改密码：</p><pre class="oac_no_warn" dir="ltr">通过<span class="italic">old_password</span>标识的ADMINISTER密钥管理ALTER KEYSTORE PASSWORD使用'pwd_change'设置<span class="italic">new_password</span> WITH BACKUP密钥库已更改。</pre><p>此示例执行相同的操作，但在使用自动登录软件密钥库或关闭受密码保护的软件密钥库的情况下使用<code class="codeph">FORCE KEYSTORE</code>子句。
                                 </p><pre class="oac_no_warn" dir="ltr">管理员密钥管理ALTER KEYSTORE PASSWORD FORCE KEYSTORE由<span class="italic">old_password</span>识别SET <span class="italic">new_password</span> WITH BACKUP使用'pwd_change';密钥库已更改。</pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-AB8F896D-A068-47AC-AA26-DDA52BFE5699" title="对于软件和硬件密钥库，许多ADMINISTER KEY MANAGEMENT操作都需要访问密钥库密码。">执行需要密钥库密码的操作</a></li>
                              <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-56595198-9FD2-4857-9BB9-D908BA89904C" title="Oracle数据库使您可以轻松更改受密码保护的软件密钥库密码。">更改软件密钥库的密码</a></li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-57805BD1-8E32-44A9-BAAB-38D4533DB40B" title="您只能在CDB根目录中更改软件密钥库或硬件密钥库的密码。">在联合模式下更改密钥库密码</a></p>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="props_rev_3"><a id="GUID-DC6F874E-812F-4663-BE47-9528C6023196" name="GUID-DC6F874E-812F-4663-BE47-9528C6023196"></a><h5 id="ASOAG-GUID-DC6F874E-812F-4663-BE47-9528C6023196" class="sect5">以联合模式更改硬件密钥库的密码</h5>
                     <div>
                        <p>要更改硬件密钥库的密码，必须关闭硬件密钥库，然后从硬件密钥库管理界面更改密码。</p>
                        <div class="section">您无法从统一模式PDB更改密钥库密码。</div>
                        <!-- class="section" -->
                        <div class="section">
                           <ol>
                              <li>
                                 <p>以已被授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的用户身份登录CDB根目录。
                                 </p>
                              </li>
                              <li>
                                 <p>关闭硬件密钥库。</p>
                                 <p>例如，对于HSM：</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE CLOSE由“psmith： <span class="italic">password</span> ”标识;</pre><p>对于密码存储在外部的密钥库：</p><pre class="oac_no_warn" dir="ltr">管理员密钥管理设置由外部商店识别的KEYSTORE CLOSE;</pre></li>
                              <li>
                                 <p>从硬件安全模块管理界面，创建新的硬件安全模块密码。</p>
                              </li>
                              <li>
                                 <p>更新外部存储中HSM的凭据以使用“ <code class="codeph"><span class="codeinlineitalic">user_name</span> : <span class="codeinlineitalic">password</span> "</code> 。
                                 </p>
                                 <p>目前，外部存储包含旧的HSM凭据，这些凭据将不再有效。</p>
                                 <p>例如：</p><pre class="oac_no_warn" dir="ltr">ADMINISTER密钥管理更新秘密' <span class="italic">user_name</span> ： <span class="italic">密码</span> 'FOR CLIENT'TDE_WALLET'到LOCAL AUTO_LOGIN KEYSTORE'/ etc / ORACLE / WALLETS / orcl / external_store';</pre></li>
                              <li>
                                 <p>在SQL * Plus中，打开硬件密钥库。</p>
                                 <p>例如，对于HSM：</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN由“psmith： <span class="italic">new_password</span> ”识别;</pre><p>对于其密码存储在外部的硬件密钥库：</p><pre class="oac_no_warn" dir="ltr">管理员密钥管理设置KEYSTORE OPEN由外部商店识别;</pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-AB8F896D-A068-47AC-AA26-DDA52BFE5699" title="对于软件和硬件密钥库，许多ADMINISTER KEY MANAGEMENT操作都需要访问密钥库密码。">执行需要密钥库密码的操作</a></li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-57805BD1-8E32-44A9-BAAB-38D4533DB40B" title="您只能在CDB根目录中更改软件密钥库或硬件密钥库的密码。">在联合模式下更改密钥库密码</a></p>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-FFAEFC19-5D87-4881-BDC3-B4A186F65277" name="GUID-FFAEFC19-5D87-4881-BDC3-B4A186F65277"></a><h4 id="ASOAG-GUID-FFAEFC19-5D87-4881-BDC3-B4A186F65277" class="sect4">以联合模式备份受密码保护的软件密钥库</h4>
                  <div>
                     <p><code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句的<code class="codeph">BACKUP KEYSTORE</code>子句备份受密码保护的软件密钥库。
                     </p>
                     <div class="section">
                        <ol>
                           <li>
                              <p>以已被授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的用户身份登录CDB根目录。
                              </p>
                              <p>例如：</p><pre class="oac_no_warn" dir="ltr">sqlplus c ## sec_admin @hrpdb as syskm输入密码： <span class="italic">password</span>已连接。
</pre></li>
                           <li>
                              <p>使用以下语法备份密钥库：</p><pre class="oac_no_warn" dir="ltr">管理员密钥管理备份KEYSTORE [使用' <span class="italic">backup_identifier</span> '] [FORCE KEYSTORE]由[EXTERNAL STORE | <span class="italic">software_keystore_password</span> ] [ <span class="italic">TO'keystore_location</span> '];</pre><p>在本规范中：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">USING</code> <span class="italic"><code class="codeph">backup_identifier</code></span>是一个可选字符串，您可以提供该字符串来标识备份。将此标识符括在单引号（ <code class="codeph">' '</code> ）中。此标识符附加到指定的密钥库文件（例如， <code class="codeph">ewallet_</code> <span class="italic"><code class="codeph">time-stamp</code></span> <code class="codeph">_emp_key_backup.p12</code> ）。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">FORCE KEYSTORE</code>临时打开此操作的受密码保护的密钥库。您必须打开此操作的密钥库。
                                    </p>
                                 </li>
                                 <li>
                                    <p>对于受密码保护的密钥库， <code class="codeph">BACKUP KEYSTORE</code>操作需要<code class="codeph">IDENTIFIED BY</code>因为尽管备份只是现有密钥库的副本，但密码保护密钥库中TDE主加密密钥的状态必须设置为<code class="codeph">BACKED UP</code>和for这个更改密钥库密码是必需的。
                                    </p>
                                 </li>
                                 <li>
                                    <p><span class="italic"><code class="codeph">keystore_location</code></span>是备份密钥库的存储路径。当在PDB中阻止PDB锁定配置文件<code class="codeph">EXTERNAL_FILE_ACCESS</code>设置或在创建PDB时未设置<code class="codeph">PATH_PREFIX</code>变量时，此设置仅限于PDB。如果未指定<span class="italic"><code class="codeph">keystore_location</code></span> ，则会在与原始密钥库相同的目录中创建备份。将此位置括在单引号（ <code class="codeph">' '</code> ）中。
                                    </p>
                                 </li>
                                 <li>
                                    <p>您不需要包含<code class="codeph">CONTAINER</code>子句，因为密钥库只能在CDB根目录中本地备份。
                                    </p>
                                 </li>
                              </ul>
                              <p>以下示例在与源密钥库相同的位置备份软件密钥库。</p><pre class="oac_no_warn" dir="ltr">ADMINISTER密钥管理密钥库备份使用'hr.emp_keystore' FORCE密钥库IDENTIFIED BY <span class="italic">software_keystore_password;</span>密钥库已更改。
</pre><p>在以下版本中，密钥库的密码是外部密码，因此使用<code class="codeph">EXTERNAL STORE</code>子句。
                              </p><pre class="oac_no_warn" dir="ltr">管理员密钥管理备份KEYSTORE使用'hr.emp_keystore'FORCE KEYSTORE由外部商店识别;</pre><p>运行此语句后，密钥库备份位置<code class="codeph">_hr.emp_keystore.p12</code>显示<code class="codeph">ewallet_</code> <span class="italic"><code class="codeph">identifier</code></span> <code class="codeph">.p12</code>文件（例如， <code class="codeph">ewallet_</code> <span class="italic"><code class="codeph">time-stamp</code></span> <code class="codeph">_hr.emp_keystore.p12</code> ）。
                              </p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-43BBC184-F801-45A9-B4D0-BB7E9767AED0" title="备份受密码保护的软件密钥库时，可以创建备份标识符字符串以描述备份类型。">备份受密码保护的软件密钥库</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="配置密钥库和主加密密钥以在联合模式下使用后，可以执行重新加密TDE主加密密钥等任务。">在联合模式下管理密钥库和TDE主加密密钥</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-DB6BC556-AD06-424F-9363-B3DE365532DA" name="GUID-DB6BC556-AD06-424F-9363-B3DE365532DA"></a><h4 id="ASOAG-GUID-DB6BC556-AD06-424F-9363-B3DE365532DA" class="sect4">以联合模式关闭密钥库</h4>
                  <div>
                     <p>除非系统表空间已加密，否则您可以在联合模式下关闭软件和硬件密钥库。</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-E63A31C2-E4E6-4C7E-8309-DEADDFFFA07F">以联合模式关闭软件密钥库</a><br>您可以在联合模式下关闭受密码保护的密钥库，自动登录密钥库和本地自动登录软件密钥库。
                        </li>
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-CE1BC7D4-0942-46EF-A312-1066BB11CA0F">以联合模式关闭硬件密钥库</a><br>要关闭硬件密钥库，必须将<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句与<code class="codeph">SET KEYSTORE CLOSE</code>子句一起使用。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="配置密钥库和主加密密钥以在联合模式下使用后，可以执行重新加密TDE主加密密钥等任务。">在联合模式下管理密钥库和TDE主加密密钥</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="sect4"><a id="GUID-E63A31C2-E4E6-4C7E-8309-DEADDFFFA07F" name="GUID-E63A31C2-E4E6-4C7E-8309-DEADDFFFA07F"></a><h5 id="ASOAG-GUID-E63A31C2-E4E6-4C7E-8309-DEADDFFFA07F" class="sect5">以联合模式关闭软件密钥库</h5>
                     <div>
                        <p>您可以在联合模式下关闭受密码保护的密钥库，自动登录密钥库和本地自动登录软件密钥库。</p>
                        <div class="section">如果自动登录密钥库在访问时自动打开，则必须先将其移动到无法自动打开的新位置，然后必须手动将其关闭。如果要将配置从自动登录密钥库更改为受密码保护的密钥库，则必须执行此操作：将配置更改为停止使用自动登录密钥库（通过将自动登录密钥库移动到不能使用自动登录密钥库的另一个位置）自动打开），然后关闭自动登录密钥库。</div>
                        <!-- class="section" -->
                        <ol>
                           <li><span>以已被授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的用户身份登录CDB根目录或联合模式PDB。</span></li>
                           <li><span>关闭软件密钥库。</span><ul>
                                 <li>对于受密码保护的软件密钥库，如果您位于CDB根目录中，请使用以下语法：<pre class="oac_no_warn" dir="ltr">管理员密钥管理集| FORCE KEYSTORE CLOSE [由[EXTERNAL STORE |。识别] <span class="italic">software_keystore_password</span> ]] [CONTAINER = ALL |当前];</pre><p>使用<code class="codeph">SET</code>子句无需关闭密钥库。如果存在已打开的从属密钥库（例如，隔离模式PDB密钥库，并且您尝试关闭CDB根密钥库），则会出现<code class="codeph">ORA-46692 cannot close wallet</code>错误。如果发生这种情况，则在关闭操作期间使用<code class="codeph">FORCE</code>子句而不是<code class="codeph">SET</code>来临时关闭从属密钥库。<code class="codeph">V$ENCRYPTION_WALLET</code>视图的<code class="codeph">STATUS</code>列显示密钥库是否已打开。
                                    </p>
                                    <p>如果您处于联合模式PDB，则省略<code class="codeph">CONTAINER</code>子句或将其设置为<code class="codeph">CURRENT</code> 。</p>
                                 </li>
                                 <li>对于自动登录或本地自动登录软件密钥库，如果您在CDB根目录中，请使用此语法：<pre class="oac_no_warn" dir="ltr">管理员密钥管理设置KEYSTORE CLOSE [CONTAINER = ALL |当前];</pre></li>
                              </ul>
                           </li>
                        </ol>
                        <div class="section">关闭密钥库将禁用所有加密和解密操作。任何加密或解密数据或访问加密数据的尝试都会导致错误。</div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-9777F9A7-EDB8-40DB-B7D8-FAC2FDFFBEB4" title="打开密钥库后，它将保持打开状态，直到您关闭数据库实例。">关于关闭密钥库</a></li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-DB6BC556-AD06-424F-9363-B3DE365532DA" title="除非系统表空间已加密，否则您可以在联合模式下关闭软件和硬件密钥库。">以联合模式关闭密钥库</a></p>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-CE1BC7D4-0942-46EF-A312-1066BB11CA0F" name="GUID-CE1BC7D4-0942-46EF-A312-1066BB11CA0F"></a><h5 id="ASOAG-GUID-CE1BC7D4-0942-46EF-A312-1066BB11CA0F" class="sect5">以联合模式关闭硬件密钥库</h5>
                     <div>
                        <p>要关闭硬件密钥库，必须将<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句与<code class="codeph">SET KEYSTORE CLOSE</code>子句一起使用。
                        </p>
                        <ol>
                           <li class="stepexpand"><span>以已被授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的用户身份登录CDB根目录或联合模式PDB。</span></li>
                           <li class="stepexpand"><span>使用以下语法关闭硬件密钥库：</span><div><pre class="oac_no_warn" dir="ltr">管理员密钥管理设置由[外部商店|]识别的KEYSTORE关闭“ <span class="italic">hardware_keystore_credentials</span> ”] [CONTAINER = ALL |当前];</pre><p>例如，对于HSM：</p><pre class="oac_no_warn" dir="ltr">管理员密钥管理设置KEYSTORE关闭由“psmith： <span class="italic">密码</span> ”CONTAINER = ALL识别;</pre></div>
                              <div>如果出现<code class="codeph">ORA-46692 cannot close wallet</code>错误，请检查是否有任何隔离模式密钥库已打开。要查找密钥库的<code class="codeph">STATUS</code> ，请查询<code class="codeph">V$ENCRYPTION_WALLET</code>视图的<code class="codeph">STATUS</code>列。
                              </div>
                           </li>
                        </ol>
                        <div class="section">关闭密钥库将禁用所有加密和解密操作。任何加密或解密数据或访问加密数据的尝试都会导致错误。</div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-9777F9A7-EDB8-40DB-B7D8-FAC2FDFFBEB4" title="打开密钥库后，它将保持打开状态，直到您关闭数据库实例。">关于关闭密钥库</a></li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-DB6BC556-AD06-424F-9363-B3DE365532DA" title="除非系统表空间已加密，否则您可以在联合模式下关闭软件和硬件密钥库。">以联合模式关闭密钥库</a></p>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-7579CA90-26F9-487B-BBF8-FCD3AE428CF4" name="GUID-7579CA90-26F9-487B-BBF8-FCD3AE428CF4"></a><h4 id="ASOAG-GUID-7579CA90-26F9-487B-BBF8-FCD3AE428CF4" class="sect4">在联合模式下创建用户定义的TDE主加密密钥</h4>
                  <div>
                     <p>要创建用户定义的TDE主加密密钥，请使用<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句和<code class="codeph">SET | CREATE [ENCRYPTION] KEY</code>子句。
                     </p>
                     <ol>
                        <li class="stepexpand"><span>登录已获得<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的用户的CDB根目录。</span><div>例如：<pre class="oac_no_warn" dir="ltr">sqlplus c ## sec_admin as syskm输入密码： <span class="italic">password</span></pre></div>
                        </li>
                        <li class="stepexpand"><span>使用以下语法创建用户定义的TDE主加密密钥：</span><div><pre class="oac_no_warn" dir="ltr">管理员密钥管理集|创建[ENCRYPTION] <span class="italic">KEY'mkid</span> ： <span class="italic">mk</span> | <span class="italic">MK</span> '[使用算法' <span class="italic">算法</span> '] [FORCE密钥库] [使用标记' <span class="italic">TAG_NAME“]</span> IDENTIFIED BY [外挂| <span class="italic">keystore_password</span> ] [WITH BACKUP [使用' <span class="italic">backup_identifier</span> ']] [CONTAINER = CURRENT];</pre><p>在本规范中：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">SET | CREATE</code> ：如果要立即创建主服务器并激活TDE主加密密钥，请输入<code class="codeph">SET</code>如果要创建密钥供以后使用，请输入<code class="codeph">CREATE</code> ，而不要激活它。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph"><span class="codeinlineitalic">mkid</span></code>和<code class="codeph"><span class="codeinlineitalic">mk</span></code> ：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><code class="codeph"><span class="codeinlineitalic">mkid</span></code>是TDE主加密密钥ID，是一个16字节的十六进制编码值，您可以指定或让Oracle数据库生成。
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph"><span class="codeinlineitalic">mk</span></code>是TDE主加密密钥，是一个十六进制编码的值，您可以指定或让Oracle数据库生成，32字节（对于<code class="codeph">AES256</code> ， <code class="codeph">ARIA256</code>和<code class="codeph">GOST256</code>算法）或16字节（对于<code class="codeph">SEED128</code>算法）。
                                          </p>
                                       </li>
                                    </ul>
                                    <p>如果省略<code class="codeph"><span class="codeinlineitalic">mkid</span></code>值但包含<code class="codeph"><span class="codeinlineitalic">mk</span></code> ，则Oracle Database <code class="codeph"><span class="codeinlineitalic">mkid</span></code>为<code class="codeph"><span class="codeinlineitalic">mk</span></code>生成<code class="codeph"><span class="codeinlineitalic">mkid</span></code> 。
                                    </p>
                                    <p>如果省略整个<code class="codeph"><span class="codeinlineitalic">mkid</span> : <span class="codeinlineitalic">mk</span> | <span class="codeinlineitalic">mkid</span></code>子句，然后Oracle数据库为您生成这些值。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">USING ALGORITHM</code> ：指定以下支持的算法之一：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><code class="codeph">AES256</code></p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">ARIA256</code> 
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">SEED128</code></p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">GOST256</code></p>
                                       </li>
                                    </ul>
                                    <p>如果省略算法，则使用默认值<code class="codeph">AES256</code> 。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">FORCE KEYSTORE</code>临时打开此操作的受密码保护的密钥库。您必须打开此操作的密钥库。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">CONTAINER</code> ：如果包含此子句，则将其设置为<code class="codeph">CURRENT</code> 。 （<code class="codeph">CURRENT</code>是默认值。）
                                    </p>
                                 </li>
                              </ul>
                              <p>以下示例包括用户创建的TDE主加密密钥，但没有TDE主加密密钥ID，因此生成TDE主加密密钥：</p><pre class="oac_no_warn" dir="ltr">管理员密钥管理集加密密钥'3D432109DF88967A541967062A6F4E460E892318E307F017BA048707B402493C'使用算法'GOST256'由<span class="italic">keystore_password</span>识别的FORCE KEYSTORE;</pre><p>下一个示例为主加密ID和TDE主加密密钥创建用户定义的密钥。它省略了算法规范，因此使用默认算法<code class="codeph">AES256</code> 。
                              </p><pre class="oac_no_warn" dir="ltr">管理员密钥管理创建加密密钥'10203040506070801112131415161718：3D432109DF88967A541967062A6F4E460E892318E307F017BA048707B402493C'由<span class="italic">keystore_password</span>标识CONTAINER = CURRENT;</pre></div>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="introduction-to-transparent-data-encryption.html#GUID-AAE3C965-C6A8-45D6-BA5D-F88B300A301A" title="默认情况下，透明数据加密（TDE）列加密使用高级加密标准（AES）。">支持的加密和完整性算法</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="配置密钥库和主加密密钥以在联合模式下使用后，可以执行重新加密TDE主加密密钥等任务。">在联合模式下管理密钥库和TDE主加密密钥</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-04564072-A35F-477F-BAF3-8631ECB9D0B2" name="GUID-04564072-A35F-477F-BAF3-8631ECB9D0B2"></a><h4 id="ASOAG-GUID-04564072-A35F-477F-BAF3-8631ECB9D0B2" class="sect4">示例：在所有PDB中创建主加密密钥</h4>
                  <div>
                     <p>您可以使用<code class="codeph">ADMINISTER KEY MANAGEMENT CREATE KEY USING TAG</code>语句在所有PDB中创建TDE主加密密钥。
                     </p>
                     <p><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-04564072-A35F-477F-BAF3-8631ECB9D0B2__CIHDJAEA">例5-1</a>显示了如何在多租户环境中的所有PDB中创建主加密密钥。如果CDB根目录中的自动登录密钥库已打开，它将使用<code class="codeph">FORCE KEYSTORE</code>子句。密码存储在外部，因此<code class="codeph">EXTERNAL STORE</code>设置用于<code class="codeph">IDENTIFIED BY</code>子句。执行此语句后，将在每个PDB中创建主加密密钥。您可以按如下方式找到这些密钥的标识符：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>登录PDB，然后查询<code class="codeph">V$ENCRYPTION_KEYS</code>视图的<code class="codeph">TAG</code>列。
                           </p>
                        </li>
                        <li>
                           <p>登录CDB根目录，然后查询<code class="codeph">GV$ENCRYPTION_KEYS</code>视图的<code class="codeph">INST_ID</code>和<code class="codeph">TAG</code>列。
                           </p>
                        </li>
                     </ul>
                     <p>您还可以检查这些视图的<code class="codeph">CREATION_TIME</code>列以查找最近创建的密钥，该密钥将是您从此语句创建的密钥。创建密钥后，您可以单独激活每个PDB中的密钥。
                     </p>
                     <div class="example" id="GUID-04564072-A35F-477F-BAF3-8631ECB9D0B2__CIHDJAEA">
                        <p class="titleinexample">示例5-1在所有PDB中创建主加密密钥</p><pre class="oac_no_warn" dir="ltr">ADMINISTER密钥管理创建密钥使用TAG'范围：所有pdbs;描述：为所有PDBS创建密钥'FORCE KEYSTORE由外部商店识别，具有备份容器= ALL;密钥库已更改。
</pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="配置密钥库和主加密密钥以在联合模式下使用后，可以执行重新加密TDE主加密密钥等任务。">在联合模式下管理密钥库和TDE主加密密钥</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-C5B51467-0D33-446D-B914-188E6A253294" name="GUID-C5B51467-0D33-446D-B914-188E6A253294"></a><h4 id="ASOAG-GUID-C5B51467-0D33-446D-B914-188E6A253294" class="sect4">创建TDE主加密密钥以供以后在联合模式下使用</h4>
                  <div>
                     <p>必须先打开密钥库，然后才能创建TDE主加密密钥，以便稍后在联合模式下使用。</p>
                     <ol>
                        <li class="stepexpand"><span>以已被授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的用户身份登录CDB根目录或联合模式PDB。</span></li>
                        <li class="stepexpand"><span>使用以下语法创建TDE主加密密钥：</span><div><pre class="oac_no_warn" dir="ltr">ADMINISTER密钥管理创建[加密]密钥[FORCE KEYSTORE] [使用标记' <span class="italic">tag_name</span> ']由[EXTERNAL STORE | <span class="italic">keystore_password</span> ] [WITH BACKUP [使用' <span class="italic">backup_identifier</span> ']] [CONTAINER = ALL |当前];</pre><p>在本规范中：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">FORCE KEYSTORE</code>临时打开此操作的受密码保护的密钥库。您必须打开此操作的密钥库。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">CONTAINER</code> ：在CDB根目录中，将<code class="codeph">CONTAINER</code>设置为<code class="codeph">ALL</code>或<code class="codeph">CURRENT</code> 。在PDB中，将其设置为<code class="codeph">CURRENT</code> 。在这两种情况下，省略<code class="codeph">CONTAINER</code>默认为<code class="codeph">CURRENT</code> 。</p>
                                    <p></p>
                                 </li>
                              </ul>
                              <p>例如：</p><pre class="oac_no_warn" dir="ltr">ADMINISTER密钥管理CREATE KEY FORCE KEYENORE由<span class="italic">keystore_password</span>识别，带有BACKUP CONTAINER = CURRENT;</pre></div>
                        </li>
                        <li class="stepexpand"><span>如有必要，请激活TDE主加密密钥。</span><ol type="a">
                              <li class="substepexpand"><span>找到密钥ID。</span><div><pre class="oac_no_warn" dir="ltr">SELECT KEY_ID FROM V $ ENCRYPTION_KEYS; KEY_ID ------------------------------------------------- --- AWsHwVYC2U + Nv3RVphn / yAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</pre></div>
                              </li>
                              <li class="substepexpand"><span>使用此密钥ID激活密钥。</span><div><pre class="oac_no_warn" dir="ltr">管理员密钥管理使用密钥'AWsHwVYC2U + Nv3RVphn / yAIAAAAAAAAAAAAAAAAAAAAAAAAAAAA'使用标签'季度：秒;描述：激活备用密钥'IDENTIFIED BY <span class="italic">密码</span> WITH BACKUP;</pre></div>
                              </li>
                           </ol>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-EA686044-5B10-4F70-88F2-B45BF1DD1E55" title="您可以创建可在以后激活的TDE主加密密钥。">创建TDE主加密密钥以供以后使用</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="配置密钥库和主加密密钥以在联合模式下使用后，可以执行重新加密TDE主加密密钥等任务。">在联合模式下管理密钥库和TDE主加密密钥</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-710DD047-FBF9-42D7-B6AE-1327A53EEAC4" name="GUID-710DD047-FBF9-42D7-B6AE-1327A53EEAC4"></a><h4 id="ASOAG-GUID-710DD047-FBF9-42D7-B6AE-1327A53EEAC4" class="sect4">在联合模式下激活TDE主加密密钥</h4>
                  <div>
                     <p>要在联合模式下激活TDE主加密密钥，您必须打开密钥库并使用<code class="codeph">ADMINISTER KEY MANAGEMENT</code>和<code class="codeph">USE KEY</code>子句。
                     </p>
                     <div class="section">
                        <ol>
                           <li>
                              <p>以已被授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的用户身份登录CDB根目录或联合模式PDB。
                              </p>
                           </li>
                           <li>
                              <p>查询<code class="codeph">V$ENCRYPTION_KEYS</code>视图的<code class="codeph">ORIGIN</code>和<code class="codeph">KEY_ID</code>列以查找密钥标识符。
                              </p>
                              <p>例如：</p><pre class="oac_no_warn" dir="ltr">SELECT ORIGIN，KEY_ID from V $ ENCRYPTION_KEYS; ORIGIN KEY_ID ------ ------------------------------------------ ---- LOCAL ARaHD762tUkkvyLgPzAi6hMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</pre></li>
                           <li>
                              <p>使用此密钥标识符可以使用以下语法激活TDE主加密密钥：</p><pre class="oac_no_warn" dir="ltr">ADMINISTER密钥管理使用密钥' <span class="italic">key_identifier_from_V $ ENCRYPTION_KEYS</span> '[使用标记' <span class="italic">标记</span> '] [FORCE KEYSTORE]由[EXTERNAL STORE | <span class="italic">keystore_password</span> ] WITH BACKUP [使用' <span class="italic">backup_identifier</span> '] [CONTAINER = ALL |当前];</pre><p>在本规范中：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">FORCE KEYSTORE</code>临时打开此操作的受密码保护的密钥库。您必须打开此操作的密钥库。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">CONTAINER</code> ：在CDB根目录中，将<code class="codeph">CONTAINER</code>设置为<code class="codeph">ALL</code>或<code class="codeph">CURRENT</code> 。在PDB中，省略<code class="codeph">CONTAINER</code>子句。在这两种情况下，省略<code class="codeph">CONTAINER</code>默认为<code class="codeph">CURRENT</code> 。</p>
                                 </li>
                              </ul>
                              <p>例如：</p><pre class="oac_no_warn" dir="ltr">管理员密钥管理使用密钥'ARaHD762tUkkvyLgPzAi6hMAAAAAAAAAAAAAAAAAAAAAAAAAAAA'由外部商店识别的FORCE KEYSTORE与备份容器= ALL;</pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-0B645D42-A7FE-4199-9A88-AFD416F1ECF1" title="您可以使用ADMINSTER KEY MANAGEMENT的USE KEY子句激活以前创建或导入的TDE主加密密钥。">关于激活TDE主加密密钥</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="配置密钥库和主加密密钥以在联合模式下使用后，可以执行重新加密TDE主加密密钥等任务。">在联合模式下管理密钥库和TDE主加密密钥</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-21B30284-823A-4226-AD38-0B66F20663C5" name="GUID-21B30284-823A-4226-AD38-0B66F20663C5"></a><h4 id="ASOAG-GUID-21B30284-823A-4226-AD38-0B66F20663C5" class="sect4">在联合模式下重新加密TDE主加密密钥</h4>
                  <div>
                     <p>您可以将<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句与<code class="codeph">SET KEY</code>子句一起使用，以重新生成TDE主加密密钥。
                     </p>
                     <div class="section">
                        <ol>
                           <li>
                              <p>以已被授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的用户身份登录CDB根目录或联合模式PDB。
                              </p>
                           </li>
                           <li>
                              <p>如果要为启用了自动登录的密钥库重新加密TDE主加密密钥，请确保存在由<code class="codeph">.sso</code>文件标识的自动登录密钥库和<code class="codeph">.p12</code>文件标识的加密密钥库。
                              </p>
                              <p>您可以通过查询<code class="codeph">V$ENCRYPTION_WALLET</code>视图的<code class="codeph">WRL_PARAMETER</code>列来查找这些文件的位置。要查找所有数据库实例的<code class="codeph">WRL_PARAMETER</code>值，请查询<code class="codeph">GV$ENCRYPTION_WALLET</code>视图。
                              </p>
                           </li>
                           <li>
                              <p>使用以下语法重新生成TDE主加密密钥：</p><pre class="oac_no_warn" dir="ltr">管理员密钥管理集[加密]密钥[FORCE KEYSTORE] [使用标记' <span class="italic">tag_name</span> ']由[EXTERNAL STORE | <span class="italic">keystore_password</span> ] [WITH BACKUP [使用' <span class="italic">backup_identifier</span> ']] [CONTAINER = ALL |当前];</pre><p>在本规范中：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><span class="italic"><code class="codeph">tag</code></span>是您定义的关联属性和信息。将此设置括在单引号（ <code class="codeph">' '</code> ）中。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">FORCE KEYSTORE</code>临时打开此操作的受密码保护的密钥库。您必须打开此操作的密钥库。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">IDENTIFIED BY</code>可以是以下设置之一：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><code class="codeph">EXTERNAL STORE</code>使用存储在外部存储中的密钥库密码来执行密钥库操作。
                                          </p>
                                       </li>
                                       <li>
                                          <p><span class="italic"><code class="codeph">keystore_password</code></span>是为此密钥库创建的密码。
                                          </p>
                                       </li>
                                    </ul>
                                 </li>
                                 <li>
                                    <p><code class="codeph">CONTAINER</code> ：在CDB根目录中，将<code class="codeph">CONTAINER</code>设置为<code class="codeph">ALL</code>或<code class="codeph">CURRENT</code> 。在PDB中，将其设置为<code class="codeph">CURRENT</code> 。在这两种情况下，省略<code class="codeph">CONTAINER</code>默认为<code class="codeph">CURRENT</code> 。</p>
                                 </li>
                              </ul>
                              <p>例如：</p><pre class="oac_no_warn" dir="ltr">ADMINISTER密钥管理设置密钥强制<span class="italic">密钥</span>由<span class="italic">keystore_password</span>标识，带有备份使用'emp_key_backup'CONTAINER = CURRENT;密钥库已更改。
</pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-B788CBF7-DB54-48D4-AB32-7AA06289153B" title="Oracle数据库使用统一的TDE主加密密钥进行TDE列加密和TDE表空间加密。">关于重新加密TDE主加密密钥</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="配置密钥库和主加密密钥以在联合模式下使用后，可以执行重新加密TDE主加密密钥等任务。">在联合模式下管理密钥库和TDE主加密密钥</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-5E343820-7195-49F2-816C-E20941BB18E4" name="GUID-5E343820-7195-49F2-816C-E20941BB18E4"></a><h4 id="ASOAG-GUID-5E343820-7195-49F2-816C-E20941BB18E4" class="sect4">查找在联合模式下使用的TDE主加密密钥</h4>
                  <div>
                     <p>正在使用的TDE主加密密钥是最近为数据库激活的密钥。</p>
                     <div class="section">在联合模式下，使用PDB的TDE主加密密钥是最近为该PDB激活的密钥。</div>
                     <!-- class="section" -->
                     <ul>
                        <li class="stepexpand"><span>要查找正在使用的TDE主加密密钥，请查询<code class="codeph">V$ENCRYPTION_KEYS</code>动态视图。</span><div>例如：<pre class="oac_no_warn" dir="ltr">SELECT KEY_ID FROM V $ ENCRYPTION_KEYS WHERE ACTIVATION_TIME =（SELECT MAX（ACTIVATION_TIME）FROM V $ ENCRYPTION_KEYS WHERE ACTIVATING_PDBID = SYS_CONTEXT（'USERENV'，'CON_ID'））;</pre></div>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="配置密钥库和主加密密钥以在联合模式下使用后，可以执行重新加密TDE主加密密钥等任务。">在联合模式下管理密钥库和TDE主加密密钥</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="props_rev_3"><a id="GUID-49328939-4225-4870-ACB1-E930CA5586D8" name="GUID-49328939-4225-4870-ACB1-E930CA5586D8"></a><h4 id="ASOAG-GUID-49328939-4225-4870-ACB1-E930CA5586D8" class="sect4">在联合模式下创建自定义属性标记</h4>
                  <div>
                     <p>要在联合模式下创建自定义属性标记，必须使用<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句的<code class="codeph">SET TAG</code>子句。
                     </p>
                     <div class="section">
                        <ol>
                           <li>
                              <p>以已被授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的用户身份登录CDB根目录或联合模式PDB。
                              </p>
                           </li>
                           <li>
                              <p>如有必要，请查询<code class="codeph">V$ENCRYPTION_KEY</code>动态视图的<code class="codeph">TAG</code>列，以查找TDE主加密密钥的现有标记列表。
                              </p>
                              <p>为TDE主加密密钥创建新标记时，它会覆盖该TDE主加密密钥的现有标记。</p>
                           </li>
                           <li>
                              <p>使用以下语法创建自定义属性标记：</p><pre class="oac_no_warn" dir="ltr">ADMINISTER密钥管理SET TAG '标签'已确定BY [外挂<span class="italic">'master_key_identifier'[FORCE</span>密钥库] | <span class="italic">keystore_password</span> ] WITH BACKUP [使用' <span class="italic">backup_identifier</span> '];</pre><p>在本说明书中</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><span class="italic"><code class="codeph">tag</code></span>是您定义的关联属性或信息。将此信息用单引号（ <code class="codeph">' '</code> ）括起来。
                                    </p>
                                 </li>
                                 <li>
                                    <p><span class="italic"><code class="codeph">master_key_identifier</code></span>标识为其设置<span class="italic"><code class="codeph">tag</code></span>的TDE主加密密钥。要查找TDE主加密密钥标识符列表，请查询<code class="codeph">V$ENCRYPTION_KEYS</code>动态视图的<code class="codeph">KEY_ID</code>列。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">FORCE KEYSTORE</code>临时打开此操作的受密码保护的密钥库。您必须打开此操作的密钥库。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">IDENTIFIED BY</code>可以是以下设置之一：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><code class="codeph">EXTERNAL STORE</code>使用存储在外部存储中的密钥库密码来执行密钥库操作。
                                          </p>
                                       </li>
                                       <li>
                                          <p><span class="italic"><code class="codeph">keystore_password</code></span>是为此密钥库创建的密码。
                                          </p>
                                       </li>
                                    </ul>
                                 </li>
                                 <li>
                                    <p><span class="italic"><code class="codeph">backup_identifier</code></span>定义标记值。将此设置括在单引号（ <code class="codeph">' ')</code>并用冒号分隔每个值。
                                    </p>
                                 </li>
                              </ul>
                              <p>例如，要创建使用两个值的标记，一个用于捕获特定的会话ID，另一个用于捕获特定的终端ID：</p><pre class="oac_no_warn" dir="ltr">ADMINISTER密钥管理集加密密钥使用标记'sessionid = 3205062574：terminal = xcvt'通过<span class="italic">keystore_password</span> IDENTIFIED WITH BACKUP;密钥库已更改。
</pre><p>会话ID（ <code class="codeph">3205062574</code> ）和终端ID（ <code class="codeph">xcvt</code> ）都可以通过使用带有<code class="codeph">USERENV</code>名称空间的<code class="codeph">SYS_CONTEXT</code>函数或使用<code class="codeph">USERENV</code>函数来派生它们的值。
                              </p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-2934A241-AB48-4EEF-8A65-3638209931AB" title="使用属性标记可以监视用户执行的特定活动，例如访问特定的终端ID。">关于创建自定义属性标记</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="配置密钥库和主加密密钥以在联合模式下使用后，可以执行重新加密TDE主加密密钥等任务。">在联合模式下管理密钥库和TDE主加密密钥</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-CBB8C6CC-CF87-4E10-9170-938C7CE7483B" name="GUID-CBB8C6CC-CF87-4E10-9170-938C7CE7483B"></a><h4 id="ASOAG-GUID-CBB8C6CC-CF87-4E10-9170-938C7CE7483B" class="sect4">将TDE主加密密钥移动到联合模式下的新密钥库中</h4>
                  <div>
                     <p>在联合模式下，您可以将现有TDE主加密密钥从现有软件密码密钥库移动到新密钥库中。</p>
                     <div class="section">此功能使您可以删除未使用的密钥。将密钥移动到新密钥库后，您可以删除旧密钥库。</div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>以已被授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的用户身份登录CDB根目录或联合模式PDB。</span></li>
                        <li class="stepexpand"><span>查询<code class="codeph">V$ENCRYPTION_KEYS</code>视图的<code class="codeph">KEY_ID</code>列以查找要将键移动到的密钥库的密钥标识符。</span><div>例如：<pre class="oac_no_warn" dir="ltr">SELECT CREATION_TIME，KEY_ID from V $ ENCRYPTION_KEYS;创造时间------------------------------------------------ ---- 22-SEP-17 08.55.12.956170 PM +00：00 KEY_ID -------------------------------- -------------------- ARaHD762tUkkvyLgPzAi6hMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</pre></div>
                        </li>
                        <li class="stepexpand"><span>使用以下语法将密钥移动到新的密钥库中：</span><div><pre class="oac_no_warn" dir="ltr">管理员密钥管理移动[加密]密钥到新密钥' <span class="italic">keystore_location1</span> '由<span class="italic">keystore1_password</span>标识FROM [FORCE] KEYSTORE由<span class="italic">keystore_password</span>标识[WITH IDENTIFIER IN {' <span class="italic">key_identififier</span> '[，' <span class="italic">key_identifier</span> '] ... | （ <span class="italic">子查询</span> ）}] [WITH BACKUP [使用' <span class="italic">backup_identifier</span> ']];</pre><p>在本规范中：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph"><span class="codeinlineitalic">keystore_location1</span></code>是将存储新密钥库<code class="codeph">.p12</code>文件的<code class="codeph">wallet</code>目录的路径。默认情况下，此目录位于<code class="codeph">$ORACLE_BASE/admin/ <span class="codeinlineitalic">db_unique_name</span> /wallet</code> 。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">FORCE</code>临时打开此操作的密钥库。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph"><span class="codeinlineitalic">keystore_password</span></code>是密钥从中移动的密钥<code class="codeph"><span class="codeinlineitalic">keystore_password</span></code>的密码。
                                    </p>
                                 </li>
                              </ul>
                              <p>例如：</p><pre class="oac_no_warn" dir="ltr">ADMINISTER密钥管理将密钥移动到新的KEYSTORE'$ ORACLE_BASE / admin / orcl / wallet'通过<span class="italic">keystore_password</span>标识来自FORCE KEYSTORE IDENTIFIED by <span class="italic">keystore_password</span> WITH IDENTIFIER IN（SELECT KEY_ID from V $ ENCRYPTION_KEYS WHERE ROWNUM &lt;2）WITH BACKUP;</pre></div>
                        </li>
                        <li class="stepexpand"><span>要删除旧密钥库，请转到<code class="codeph">wallet</code>目录，然后手动删除包含密钥库的<code class="codeph">.p12</code>文件。</span><div>要查找密钥库的位置，请打开密钥库，然后查询<code class="codeph">V$ENCRYPTION_WALLET</code>视图的<code class="codeph">WRL_PARAMETER</code>列。
                           </div>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="managing-keystore-and-tde-master-encryption-key.html#GUID-5CC83A60-8EA4-4984-AD2C-42BC12E5A16F" title="Oracle强烈建议您在将密钥库加密密钥移动到新密钥库之前不要删除密钥库。">删除密钥库的危险</a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="配置密钥库和主加密密钥以在联合模式下使用后，可以执行重新加密TDE主加密密钥等任务。">在联合模式下管理密钥库和TDE主加密密钥</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-4E19B1E4-E5EF-4E9E-A5F4-BB62702EE7D8" name="GUID-4E19B1E4-E5EF-4E9E-A5F4-BB62702EE7D8"></a><h4 id="ASOAG-GUID-4E19B1E4-E5EF-4E9E-A5F4-BB62702EE7D8" class="sect4">在联合模式下自动删除非活动TDE主加密密钥</h4>
                  <div>
                     <p>在联合模式下， <code class="codeph">REMOVE_INACTIVE_STANDBY_TDE_MASTER_KEY</code>初始化参数可以配置自动删除非活动TDE主加密密钥。
                     </p>
                     <ol>
                        <li class="stepexpand"><span>登录到Oracle备用数据库的CDB根目录或统一模式PDB所在的服务器。</span></li>
                        <li class="stepexpand"><span>找到数据库的初始化参数文件。</span><div>默认情况下，初始化参数file位于<code class="codeph">$ORACLE_HOME/dbs</code>目录中。
                           </div>
                        </li>
                        <li class="stepexpand"><span>编辑初始化参数文件以包含<code class="codeph">REMOVE_INACTIVE_STANDBY_TDE_MASTER_KEY</code>初始化参数。</span><div>例如：<pre class="oac_no_warn" dir="ltr">remove_inactive_standby_tde_master_key = true</pre><p>将此参数设置为<code class="codeph">TRUE</code>可以自动删除不活动的TDE主加密密钥;将其设置为<code class="codeph">FALSE</code>会禁用自动删除。
                              </p>
                           </div>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="配置密钥库和主加密密钥以在联合模式下使用后，可以执行重新加密TDE主加密密钥等任务。">在联合模式下管理密钥库和TDE主加密密钥</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-732D3890-6A80-4541-8489-B26A08BCEC17" name="GUID-732D3890-6A80-4541-8489-B26A08BCEC17"></a><h4 id="ASOAG-GUID-732D3890-6A80-4541-8489-B26A08BCEC17" class="sect4">隔离可插拔数据库密钥库</h4>
                  <div>
                     <p>隔离PDB密钥库会将主加密密钥从CDB根密钥库移动到PDB中的隔离模式密钥库。</p>
                     <div class="section">此过程使密钥库能够在隔离模式下作为单独的密钥库进行管理。这样，已在本地为PDB授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>特权的管理员可以管理密钥库。
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>以已被授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的用户身份登录到联合模式PDB。</span><div>例如：<pre class="oac_no_warn" dir="ltr">sqlplus sec_admin @hrpdb as syskm输入密码： <span class="italic">password</span>已连接。
</pre></div>
                        </li>
                        <li class="stepexpand"><span>使用以下语法将密钥从CDB根的密钥库移动到PDB的隔离模式密钥库：</span><div><pre class="oac_no_warn" dir="ltr">ADMINISTER密钥管理FORCE] ISOLATE密钥库IDENTIFIED BY <span class="italic">isolated_keystore_password</span>从发根密钥库[FORCE密钥库] IDENTIFIED BY [外挂| <span class="italic">united_keystore_password</span> ] [WITH BACKUP [USING <span class="italic">backup_id</span> ]];</pre><p>在本规范中：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>当PDB的克隆使用正被隔离的主加密密钥时，使用<code class="codeph">FORCE</code> 。然后， <code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句将密钥从CDB根的钱包复制（而不是移动）到隔离模式PDB。</p>
                                 </li>
                                 <li>
                                    <p>如果自动登录密钥库已打开（并且正在使用中）或密钥库已关闭， <code class="codeph">FORCE KEYSTORE</code>临时打开此操作的受密码保护的密钥库。
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph"><span class="codeinlineitalic">united_keystore_password</span></code> ：了解此密码不会使执行<code class="codeph">ISOLATE KEYSTORE</code>操作权限的用户在CDB根目录上执行<code class="codeph">ADMINISTER KEY MANAGEMENT UNITE KEYSTORE</code>操作。此密码与CDB根目录中的密钥库密码相同。
                                    </p>
                                 </li>
                              </ul><pre class="oac_no_warn" dir="ltr"></pre></div>
                           <div>在CDB根的密钥库与PDB的密钥库组合在一起之后，与CDB相关联的所有先前活动（历史）主加密密钥被移动到PDB的密钥库。</div>
                        </li>
                        <li class="stepexpand"><span>确认联合模式PDB现在是隔离模式PDB。</span><div><pre class="oac_no_warn" dir="ltr">从V $ ENCRYPTION_WALLET中选择KEYSTORE_MODE;</pre><p>输出应该是<code class="codeph">ISOLATED</code> 。</p>
                           </div>
                        </li>
                     </ol>
                     <div class="section">在联合模式PDB已转换为隔离模式PDB后，您可以更改密钥库的密码。</div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-9FAAC1BF-A161-4DB1-A7DF-0A63F7E9807D" title="配置密钥库和主加密密钥以在联合模式下使用后，可以执行重新加密TDE主加密密钥等任务。">在联合模式下管理密钥库和TDE主加密密钥</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
            <div class="sect2"><a id="GUID-59000EDC-011E-45BF-9ECB-AC0335EE2FED" name="GUID-59000EDC-011E-45BF-9ECB-AC0335EE2FED"></a><h3 id="ASOAG-GUID-59000EDC-011E-45BF-9ECB-AC0335EE2FED" class="sect3">在联合模式下管理透明数据加密</h3>
               <div>
                  <p>您可以在联合模式下使用透明数据加密执行常规管理任务。</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-5B665567-8414-4F8E-A08B-DC624690BCB8">在联合模式下将PDB从一个CDB移动到另一个CDB</a><br>在联合模式下，您可以自动将PDB从一个CDB移动到另一个CDB（例如，用于负载平衡或添加新功能）。
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-576582FE-7252-49BC-B795-121689258890">在联合模式下以CDB中的加密数据拔出和插入PDB</a><br>在联合模式下，对于具有加密数据的PDB，您可以将其插入CDB。相反，您可以从CDB拔下此PDB。</li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-6DB427F1-D5B6-47E2-921E-7B6DB314B368">在联合模式下使用加密数据管理克隆PDB</a><br>在联合模式下，您可以克隆在CDB中具有加密数据的PDB。</li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-75855CB2-3FBC-41E4-BC89-8EA2078E633E">密钥库打开和关闭操作如何在联合模式下工作</a><br>您应该了解密钥库打开和关闭操作如何在联合模式下工作。
                     </li>
                     <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-8E05DC0C-D22F-44AF-9A6A-2564195F0649">以联合模式查找所有PDB的密钥库状态</a><br>您可以创建一个使用<code class="codeph">V$ENCRYPTION_WALLET</code>视图的便捷函数来查找CDB中所有PDB中的密钥库的状态。</li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-FA569DEC-6FF3-4CA1-86AA-D27F29EDCA3C" title="通过联合模式，您可以为CDB和密钥库处于联合模式的PDB创建公共密钥库。">在联合模式下管理密钥库和TDE主加密密钥</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-5B665567-8414-4F8E-A08B-DC624690BCB8" name="GUID-5B665567-8414-4F8E-A08B-DC624690BCB8"></a><h4 id="ASOAG-GUID-5B665567-8414-4F8E-A08B-DC624690BCB8" class="sect4">在联合模式下将PDB从一个CDB移动到另一个CDB</h4>
                  <div>
                     <p>在联合模式下，您可以自动将PDB从一个CDB移动到另一个CDB（例如，用于负载平衡或添加新功能）。</p>
                     <div class="section">如果PDB具有TDE加密的表或表空间，则可以将<code class="codeph">ONE_STEP_PLUGIN_FOR_PDB_WITH_TDE</code>动态系统参数设置为<code class="codeph">TRUE</code>以使PDB能够在PDB移动操作中包含TDE密钥。此参数避免了在将TDE密钥移动到另一个CDB后将TDE密钥导入PDB时必须手动提供密钥库密码。当<code class="codeph">ONE_STEP_PLUGIN_FOR_PDB_WITH_TDE</code>设置为<code class="codeph">TRUE</code> ，数据库将密钥库密码缓存在内存中，在系统级进行模糊处理，然后将其用于导入操作。<code class="codeph">ONE_STEP_PLUGIN_FOR_PDB_WITH_TDE</code>的默认值为<code class="codeph">FALSE</code> 。</div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>以已被授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的用户身份登录PDB。</span></li>
                        <li class="stepexpand"><span>将<code class="codeph">ONE_STEP_PLUGIN_FOR_PDB_WITH_TDE</code>动态初始化参数设置为<code class="codeph">TRUE</code> 。</span><div>例如：<pre class="oac_no_warn" dir="ltr">ALTER SYSTEM SET ONE_STEP_PLUGIN_FOR_PDB_WITH_TDE = TRUE;</pre></div>
                        </li>
                        <li class="stepexpand"><span>移动（重新定位）PDB。</span></li>
                     </ol>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="../multi/introduction-to-the-multitenant-architecture.html#MULTI-GUID-D84C3A7F-A1B3-4651-B99B-9F76E7331F83" target="_blank"><span><cite>Oracle多租户管理员指南</cite></span></a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-59000EDC-011E-45BF-9ECB-AC0335EE2FED" title="您可以在联合模式下使用透明数据加密执行常规管理任务。">在联合模式下管理透明数据加密</a></p>
                        </div>
                     </div>
                  </div>
               </div><a id="ASOAG10441"></a><div class="props_rev_3"><a id="GUID-576582FE-7252-49BC-B795-121689258890" name="GUID-576582FE-7252-49BC-B795-121689258890"></a><h4 id="ASOAG-GUID-576582FE-7252-49BC-B795-121689258890" class="sect4">在联合模式下以CDB中的加密数据拔出和插入PDB</h4>
                  <div>
                     <p>在联合模式下，对于具有加密数据的PDB，您可以将其插入CDB。相反，您可以从CDB拔下此PDB。</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-013D7499-0EF3-4D2B-AC24-490D0378EC37">拔出已在联合模式下加密数据的PDB</a><br>在联合模式下，您可以使用加密数据拔出PDB并将其导出到XML元数据文件或存档文件中。
                        </li>
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-67812205-D0C9-4F5F-BA64-DAE282F3B516">在联合模式下将已加密数据的PDB插入CDB</a><br>要将具有加密数据的PDB插入CDB，首先插入PDB，然后可以在PDB中设置密钥库。</li>
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-E21E1DFE-7D97-4162-82D0-8804E30F5B0B">拔出具有主加密密钥的PDB以联合模式存储在硬件密钥库中</a><br>您可以从已使用HSM配置的一个CDB上拔下PDB，然后将其插入另一个也配置了硬件密钥库的CDB。
                        </li>
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-E64F2A04-0412-4779-80C9-66E769E88863">插入具有主加密密钥的PDB以联合模式存储在硬件密钥库中</a><br><code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句可以将TDE主加密密钥从硬件密钥库导入到已移动到另一个CDB的PDB。</li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-59000EDC-011E-45BF-9ECB-AC0335EE2FED" title="您可以在联合模式下使用透明数据加密执行常规管理任务。">在联合模式下管理透明数据加密</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="ASOAG10609"></a><div class="props_rev_3"><a id="GUID-013D7499-0EF3-4D2B-AC24-490D0378EC37" name="GUID-013D7499-0EF3-4D2B-AC24-490D0378EC37"></a><h5 id="ASOAG-GUID-013D7499-0EF3-4D2B-AC24-490D0378EC37" class="sect5">拔出已在联合模式下加密数据的PDB</h5>
                     <div>
                        <p>在联合模式下，您可以使用加密数据拔出PDB并将其导出到XML元数据文件或存档文件中。</p>
                        <div class="section">拔出的数据库包含数据文件和其他相关文件。您可以通过查询<code class="codeph">DBA_PDBS</code>数据字典视图的<code class="codeph">STATUS</code>列来检查PDB是否已被拔出。
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>在CDB根目录中，查询<code class="codeph">V$ENCRYPTION_WALLET</code>动态视图以确保密钥库已打开。</span></li>
                           <li class="stepexpand"><span>拔下PDB时，请在<code class="codeph">ALTER PLUGGABLE DATABASE</code>语句中使用<code class="codeph">ENCRYPT USING <span class="codeinlineitalic">transport_secret</span></code>子句。</span><div>如果PDB具有加密数据，则必须使用此子句。否则， <code class="codeph">ORA-46680: master keys of the container database must be exported</code>错误。
                              </div>
                              <ul>
                                 <li>例如，要将PDB数据导出到XML文件中：<pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE CDB1_PDB2 UNPLUG INTO'/tmp/cdb1_pdb2.xml'ENCRYPT使用<span class="italic">transport_secret</span> ;</pre></li>
                                 <li>要将PDB数据导出到存档文件中：<pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE CDB1_PDB2 UNPLUG INTO'/tmp/cdb1_pdb2.pdb'ENCRYPT使用<span class="italic">transport_secret</span> ;</pre></li>
                              </ul>
                           </li>
                        </ol>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-765C103D-67A0-4DF1-930E-CFFFA89B2DC2" title="要以联合模式打开软件密钥库，必须将ADMINISTER KEY MANAGEMENT语句与SET KEYSTORE OPEN子句一起使用。">步骤2：在联合模式PDB中打开软件密钥库</a></li>
                              <li><a href="../multi/removing-a-pdb.html#MULTI-GUID-75C46F1B-00D8-4FB9-A8E7-6F7FE3DE4CA0" target="_blank"><span><cite>Oracle多租户管理员指南</cite></span></a></li>
                              <li><a href="../sqlrf/ALTER-PLUGGABLE-DATABASE.html#SQLRF-GUID-A29491AD-8F0F-4E52-9D94-57FC3FF8FBC7" target="_blank"><span><cite>Oracle数据库SQL语言参考</cite></span></a></li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-576582FE-7252-49BC-B795-121689258890" title="在联合模式下，对于具有加密数据的PDB，您可以将其插入CDB。相反，您可以从CDB拔下此PDB。">在联合模式下以CDB中的加密数据拔出和插入PDB</a></p>
                           </div>
                        </div>
                     </div>
                  </div><a id="ASOAG10610"></a><div class="props_rev_3"><a id="GUID-67812205-D0C9-4F5F-BA64-DAE282F3B516" name="GUID-67812205-D0C9-4F5F-BA64-DAE282F3B516"></a><h5 id="ASOAG-GUID-67812205-D0C9-4F5F-BA64-DAE282F3B516" class="sect5">在联合模式下将已加密数据的PDB插入CDB</h5>
                     <div>
                        <p>要将具有加密数据的PDB插入CDB，首先插入PDB，然后可以在PDB中设置密钥库。</p>
                        <div class="section">将未插入的PDB插入另一个CDB时，密钥版本设置为<code class="codeph">0</code>因为此操作会使先前密钥的历史记录无效。您可以通过查询<code class="codeph">V$ENCRYPTED_TABLESPACES</code>动态视图的<code class="codeph">KEY_VERSION</code>列来检查密钥版本。同样，如果控制文件丢失并重新创建，则密钥的先前历史记录将重置为<code class="codeph">0</code> 。您可以通过查询<code class="codeph">DBA_PDBS</code>数据字典视图的<code class="codeph">STATUS</code>列来检查是否已插入PDB。
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ol>
                              <li>
                                 <p>从CDB根目录，通过将未插入的PDB插入CDB来创建PDB。</p>
                                 <p>要对联合模式执行此操作，请包括<code class="codeph">DECRYPT USING <span class="codeinlineitalic">transport_secret</span></code>子句。
                                 </p>
                                 <p>如果PDB的元数据或归档文件具有加密数据，则必须使用此子句。否则， <code class="codeph">ORA-46680: master keys of the container database must be exported</code>错误。
                                 </p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>例如，如果已将PDB数据导出到元数据XML文件中：</p><pre class="oac_no_warn" dir="ltr">CREATE PLUGGABLE DATABASE CDB1_PDB2 USING '/tmp/cdb1_pdb2.xml' NOCOPY密钥库IDENTIFIED BY <span class="italic">密码</span> DECRYPT USING <span class="italic">transport_secret;</span></pre></li>
                                    <li>
                                       <p>如果已将PDB导出到存档文件中：</p><pre class="oac_no_warn" dir="ltr">创建可插入数据库CDB1_PDB2使用'/tmp/cdb1_pdb2.pdb'解密使用<span class="italic">transport_secret</span> ;</pre></li>
                                 </ul>
                                 <p>在插件操作之后的PDB打开操作期间，Oracle数据库确定PDB是否具有加密数据。如果是这样，它将在<code class="codeph">RESTRICTED</code>模式下打开PDB。
                                 </p>
                                 <p>如果要通过克隆另一个PDB或从非CDB创建PDB，并且源数据库具有已设置的加密数据或TDE主加密密钥，则必须通过包含由以下<code class="codeph">keystore identified by <span class="codeinlineitalic">keystore_password</span></code>的<code class="codeph">keystore identified by <span class="codeinlineitalic">keystore_password</span></code>提供密钥库密码<code class="codeph">keystore identified by <span class="codeinlineitalic">keystore_password</span></code> <code class="codeph">CREATE PLUGGABLE DATABASE ...中的<code class="codeph"><span class="codeinlineitalic">keystore identified by keystore_password</span></code>子句<code class="codeph">CREATE PLUGGABLE DATABASE ...FROM</code> SQL语句。即使源数据库使用自动登录软件密钥库，您也必须提供此密码。通过查询<code class="codeph">V$ENCRYPTION_KEYS</code>动态视图，您可以查找源数据库是否在密钥库中设置了加密数据或TDE主加密密钥集</p>
                              </li>
                              <li>
                                 <p>打开PDB。</p>
                                 <p>例如：</p><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE CDB1_PDB2 OPEN;</pre></li>
                              <li>
                                 <p>打开CDB根目录中的密钥库。</p>
                                 <p>例如：</p><pre class="oac_no_warn" dir="ltr">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN由<span class="italic">密码</span>识别;</pre><p>（可选）在PDB中打开密钥库。</p>
                              </li>
                              <li>
                                 <p>在CDB根目录或PDB中（如果密钥库在PDB中打开），请为PDB设置TDE主加密密钥。</p>
                                 <p>例如：</p><pre class="oac_no_warn" dir="ltr">通过<span class="italic">keystore_password</span>使用'emp_key_backup'和BACKUP来识别的ADMINISTER密钥管理集<span class="italic">密钥</span> ;</pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-765C103D-67A0-4DF1-930E-CFFFA89B2DC2" title="要以联合模式打开软件密钥库，必须将ADMINISTER KEY MANAGEMENT语句与SET KEYSTORE OPEN子句一起使用。">步骤2：在联合模式PDB中打开软件密钥库</a></li>
                              <li><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-8A6CF613-F182-4249-ACAE-764C145E210B" title="要在联合模式下配置PDB时在密钥库中设置TDE主加密密钥，请使用带有SET KEY子句的ADMINISTER KEY MANAGEMENT语句。">步骤3：在联合模式下在软件密钥库中设置TDE主加密密钥</a></li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-576582FE-7252-49BC-B795-121689258890" title="在联合模式下，对于具有加密数据的PDB，您可以将其插入CDB。相反，您可以从CDB拔下此PDB。">在联合模式下以CDB中的加密数据拔出和插入PDB</a></p>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-E21E1DFE-7D97-4162-82D0-8804E30F5B0B" name="GUID-E21E1DFE-7D97-4162-82D0-8804E30F5B0B"></a><h5 id="ASOAG-GUID-E21E1DFE-7D97-4162-82D0-8804E30F5B0B" class="sect5">拔出具有主加密密钥的PDB以联合模式存储在硬件密钥库中</h5>
                     <div>
                        <p>您可以从已使用HSM配置的一个CDB上拔下PDB，然后将其插入另一个也配置了硬件密钥库的CDB。</p>
                        <ol>
                           <li class="stepexpand"><span>拔掉PDB。</span><div>您可以通过查询<code class="codeph">DBA_PDBS</code>数据字典视图的<code class="codeph">STATUS</code>列来检查PDB是否已被拔出。
                              </div>
                           </li>
                           <li class="stepexpand"><span>将源CDB中使用的硬件密钥库中未插入的PDB的主加密密钥移动到目标CDB上使用的硬件密钥库。</span><div>
                                 <p>有关在硬件密钥库之间移动主加密密钥的信息，请参阅硬件密钥库的文档。</p>
                              </div>
                           </li>
                        </ol>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="../multi/index.html" target="_blank"><span><cite>Oracle多租户管理员指南</cite></span></a></li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-576582FE-7252-49BC-B795-121689258890" title="在联合模式下，对于具有加密数据的PDB，您可以将其插入CDB。相反，您可以从CDB拔下此PDB。">在联合模式下以CDB中的加密数据拔出和插入PDB</a></p>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-E64F2A04-0412-4779-80C9-66E769E88863" name="GUID-E64F2A04-0412-4779-80C9-66E769E88863"></a><h5 id="ASOAG-GUID-E64F2A04-0412-4779-80C9-66E769E88863" class="sect5">插入具有主加密密钥的PDB以联合模式存储在硬件密钥库中</h5>
                     <div>
                        <p><code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句可以将TDE主加密密钥从硬件密钥库导入到已移动到另一个CDB的PDB。</p>
                        <ol>
                           <li class="stepexpand"><span>将未插入的PDB插入已使用硬件密钥库配置的目标CDB。</span><div>您可以通过查询<code class="codeph">DBA_PDBS</code>数据字典视图的<code class="codeph">STATUS</code>列来检查是否已插入PDB。
                              </div>
                              <div>在插件操作之后，已插入的PDB将处于受限模式。</div>
                           </li>
                           <li class="stepexpand"><span>确保已使用源CDB配置的硬件密钥库中的主加密密钥在目标CDB的硬件密钥库中可用。</span></li>
                           <li class="stepexpand"><span>以授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的用户身份登录到插入的PDB。</span><div>
                                 <p>例如：</p><pre class="oac_no_warn" dir="ltr">sqlplus sec_admin @ hr_pdb as syskm输入密码： <span class="italic">password</span>已连接。
</pre><p>请联系您的<code class="codeph">SYSDBA</code>管理员以获取正确的PDB。要检查当前容器，请运行<code class="codeph">SHOW CON_NAME</code>命令。
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>打开插入的PDB的主加密密钥。</span><div>
                                 <p>例如，对于名为<code class="codeph">PDB1</code>的PDB：</p><pre class="oac_no_warn" dir="ltr">ALTER SESSION SET CONTAINER = PDB1;管理员密钥管理设置KEYSTORE由<span class="italic">keystore_passsword</span>识别;</pre></div>
                           </li>
                           <li class="stepexpand"><span>将硬件密钥库主加密密钥导入PDB。</span><div><pre class="oac_no_warn" dir="ltr">管理员密钥管理导入加密<span class="italic">密钥</span> ， <span class="italic">密钥</span> “HSM”来自'HSM'，由<span class="italic">keystore_password</span>识别;</pre></div>
                           </li>
                           <li class="stepexpand"><span>重新启动PDB。</span><div><pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE PDB1 CLOSE; ALTER PLUGGABLE DATABASE PDB1 OPEN;</pre></div>
                           </li>
                        </ol>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="../multi/plugging-in-a-pdb.html#MULTI-GUID-F23F5352-F456-48EE-AED7-71E3DEBAAED0" target="_blank"><span><cite>Oracle多租户管理员指南</cite></span></a></li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-576582FE-7252-49BC-B795-121689258890" title="在联合模式下，对于具有加密数据的PDB，您可以将其插入CDB。相反，您可以从CDB拔下此PDB。">在联合模式下以CDB中的加密数据拔出和插入PDB</a></p>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-6DB427F1-D5B6-47E2-921E-7B6DB314B368" name="GUID-6DB427F1-D5B6-47E2-921E-7B6DB314B368"></a><h4 id="ASOAG-GUID-6DB427F1-D5B6-47E2-921E-7B6DB314B368" class="sect4">在联合模式下使用加密数据管理克隆PDB</h4>
                  <div>
                     <p>在联合模式下，您可以克隆在CDB中具有加密数据的PDB。</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-3A60285F-5CF7-4FA0-9F6E-EF19A1481AA4">关于管理以联合模式加密数据的克隆PDB</a><br>克隆PDB时，必须使源PDB的主加密密钥可用于克隆PDB。</li>
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-34325A34-02A1-445E-BE5A-993CA5EDB926">在联合模式下在CDB中使用加密数据克隆PDB</a><br>带有<code class="codeph">KEYSTORE IDENTIFIED BY</code>子句的<code class="codeph">CREATE PLUGGABLE DATABASE</code>语句可以克隆具有加密数据的PDB。
                        </li>
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-2B2E9E7D-10E0-4D3E-B466-4767AC3D81C1">在联合模式下使用两个CDB之间的加密数据执行PDB的远程克隆</a><br>具有<code class="codeph">KEYSTORE IDENTIFIED BY</code>子句的<code class="codeph">CREATE PLUGGABLE DATABASE</code>语句可以远程克隆具有加密数据的PDB。
                        </li>
                        <li class="ulchildlink"><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-2D0FC0F4-6365-47C9-82CC-AED41286540A">在联合模式下使用加密数据在CDB中重新定位克隆的PDB</a><br>带有<code class="codeph">KEYSTORE IDENTIFIED BY</code>子句的<code class="codeph">CREATE PLUGGABLE DATABASE</code>语句可以跨CDB重定位具有加密数据的克隆PDB。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-59000EDC-011E-45BF-9ECB-AC0335EE2FED" title="您可以在联合模式下使用透明数据加密执行常规管理任务。">在联合模式下管理透明数据加密</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="sect4"><a id="GUID-3A60285F-5CF7-4FA0-9F6E-EF19A1481AA4" name="GUID-3A60285F-5CF7-4FA0-9F6E-EF19A1481AA4"></a><h5 id="ASOAG-GUID-3A60285F-5CF7-4FA0-9F6E-EF19A1481AA4" class="sect5">关于管理以联合模式加密数据的克隆PDB</h5>
                     <div>
                        <p>克隆PDB时，必须使源PDB的主加密密钥可用于克隆PDB。</p>
                        <p>这允许克隆的PDB对加密数据进行操作。要执行克隆，您无需导出和导入密钥，因为即使克隆的PDB位于远程CDB中，Oracle数据库也会为您传输密钥。但是，您需要提供创建克隆的CDB的密钥库密码。</p>
                        <p>如果PDB具有加密数据，则可以在CDB之间的PDB上执行远程克隆操作，并在CDB之间重新定位PDB。</p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-6DB427F1-D5B6-47E2-921E-7B6DB314B368" title="在联合模式下，您可以克隆在CDB中具有加密数据的PDB。">在联合模式下使用加密数据管理克隆PDB</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-34325A34-02A1-445E-BE5A-993CA5EDB926" name="GUID-34325A34-02A1-445E-BE5A-993CA5EDB926"></a><h5 id="ASOAG-GUID-34325A34-02A1-445E-BE5A-993CA5EDB926" class="sect5">在联合模式下在CDB中使用加密数据克隆PDB</h5>
                     <div>
                        <p>带有<code class="codeph">KEYSTORE IDENTIFIED BY</code>子句的<code class="codeph">CREATE PLUGGABLE DATABASE</code>语句可以克隆具有加密数据的PDB。
                        </p>
                        <ol>
                           <li class="stepexpand"><span>在CDB根目录中，查询<code class="codeph">V$ENCRYPTION_WALLET</code>动态视图的<code class="codeph">STATUS</code>列，以确保在CDB根目录中打开密钥库。</span></li>
                           <li class="stepexpand"><span>以已被授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的用户身份登录PDB。</span></li>
                           <li class="stepexpand"><span>使用带有<code class="codeph">KEYSTORE IDENTIFIED BY</code>子句的<code class="codeph">CREATE PLUGGABLE DATABASE</code>语句克隆PDB。</span><div>
                                 <p>例如：</p><pre class="oac_no_warn" dir="ltr">CREATE PLUGGABLE DATABASE cdb1_pdb3 FROM cdb1_pdb1 FILE_NAME_CONVERT =（'cdb1_pdb1'，'pdb3 / cdb1_pdb3'）KEYSTORE IDENTIFIED BY <span class="italic">keystore_password</span> ;</pre></div>
                              <div>
                                 <p>将<code class="codeph"><span class="codeinlineitalic">keystore_password</span></code>替换为创建<code class="codeph">cdb1_pdb3</code>克隆的CDB <code class="codeph"><span class="codeinlineitalic">keystore_password</span></code>的密码。
                                 </p>
                              </div>
                              <div>创建克隆的PDB后，克隆仍然可以使用原始PDB的主加密密钥访问加密数据。克隆PDB后，加密表空间中可能存在用户数据。由于源PDB的主加密密钥被复制到目标PDB，因此仍可访问此加密数据。由于克隆是源PDB的副本，但最终会遵循自己的路线并拥有自己的数据和安全策略，因此您应该重新键入克隆PDB的主加密密钥。</div>
                           </li>
                           <li class="stepexpand"><span>重新键入克隆PDB的主加密密钥。</span><div>
                                 <p>例如：</p><pre class="pre codeblock"><code>ADMINISTER密钥管理设置密钥强制关键字由<span class="italic">keystore_password</span>标识，带有备份使用'emp_key_backup';</code></pre><p>在此示例中，包含<code class="codeph">FORCE KEYSTORE</code> ，因为密钥库必须在重定密钥操作期间打开。
                                 </p>
                              </div>
                              <div>在重新键入克隆的PDB的主加密密钥之前，克隆仍然可以使用属于原始PDB的主加密密钥。但是，这些主加密密钥不会出现在克隆的PDB <code class="codeph">V$</code>动态视图中。重新加密主加密密钥可确保克隆的PDB使用其自己的唯一密钥，这些密钥可在<code class="codeph">V$</code>视图中查看。
                              </div>
                           </li>
                        </ol>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-765C103D-67A0-4DF1-930E-CFFFA89B2DC2" title="要以联合模式打开软件密钥库，必须将ADMINISTER KEY MANAGEMENT语句与SET KEYSTORE OPEN子句一起使用。">步骤2：在联合模式PDB中打开软件密钥库</a></li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-6DB427F1-D5B6-47E2-921E-7B6DB314B368" title="在联合模式下，您可以克隆在CDB中具有加密数据的PDB。">在联合模式下使用加密数据管理克隆PDB</a></p>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-2B2E9E7D-10E0-4D3E-B466-4767AC3D81C1" name="GUID-2B2E9E7D-10E0-4D3E-B466-4767AC3D81C1"></a><h5 id="ASOAG-GUID-2B2E9E7D-10E0-4D3E-B466-4767AC3D81C1" class="sect5">在联合模式下使用两个CDB之间的加密数据执行PDB的远程克隆</h5>
                     <div>
                        <p>具有<code class="codeph">KEYSTORE IDENTIFIED BY</code>子句的<code class="codeph">CREATE PLUGGABLE DATABASE</code>语句可以远程克隆具有加密数据的PDB。
                        </p>
                        <ol>
                           <li class="stepexpand"><span>在CDB根目录中，查询<code class="codeph">V$ENCRYPTION_WALLET</code>动态视图的<code class="codeph">STATUS</code>列，以确保在CDB根目录中打开密钥库。</span></li>
                           <li class="stepexpand"><span>以已被授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的用户身份登录PDB。</span></li>
                           <li class="stepexpand"><span>为要远程克隆的PDB创建数据库链接。</span><div>使用<code class="codeph">CREATE DATABASE LINK</code> SQL语句创建数据库链接。您必须按照克隆远程PDB或非CDB所需的数据库链接先决条件来创建数据库链接。</div>
                           </li>
                           <li class="stepexpand"><span>使用带有<code class="codeph">KEYSTORE IDENTIFIED BY</code>子句的<code class="codeph">CREATE PLUGGABLE DATABASE</code>语句来执行PDB的克隆。</span><div>
                                 <p>例如：</p><pre class="oac_no_warn" dir="ltr">CREATE PLUGGABLE DATABASE cdb1_pdb3 FROM cdb1_pdb1 FILE_NAME_CONVERT =（'cdb1_pdb1'，'pdb3 / cdb1_pdb3'）KEYSTORE IDENTIFIED BY <span class="italic">keystore_password</span> ;</pre></div>
                              <div>
                                 <p>将<code class="codeph"><span class="codeinlineitalic">keystore_password</span></code>替换为创建<code class="codeph">cdb1_pdb3</code>克隆的CDB <code class="codeph"><span class="codeinlineitalic">keystore_password</span></code>的密码。
                                 </p>
                              </div>
                              <div>创建克隆的PDB后，克隆仍然可以使用原始PDB的主加密密钥访问加密数据。克隆PDB后，加密表空间中可能存在用户数据。由于源PDB的主加密密钥被复制到目标PDB，因此仍可访问此加密数据。由于克隆是源PDB的副本，但最终会遵循自己的路线并拥有自己的数据和安全策略，因此您应该重新键入克隆PDB的主加密密钥。</div>
                           </li>
                           <li class="stepexpand"><span>重新键入远程克隆的PDB的主加密密钥。</span><div>
                                 <p>例如：</p><pre class="pre codeblock"><code>ADMINISTER密钥管理设置密钥强制关键字由<span class="italic">keystore_password</span>标识，带有备份使用'emp_key_backup';</code></pre><p>在此示例中，包含<code class="codeph">FORCE KEYSTORE</code> ，因为密钥库必须在重定密钥操作期间打开。
                                 </p>
                              </div>
                              <div>在重新键入克隆的PDB的主加密密钥之前，克隆仍然可以使用属于原始PDB的主加密密钥。但是，这些主加密密钥不会出现在克隆的PDB <code class="codeph">V$</code>动态视图中。重新加密主加密密钥可确保克隆的PDB使用其自己的唯一密钥，这些密钥可在<code class="codeph">V$</code>视图中查看。
                              </div>
                           </li>
                        </ol>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-765C103D-67A0-4DF1-930E-CFFFA89B2DC2" title="要以联合模式打开软件密钥库，必须将ADMINISTER KEY MANAGEMENT语句与SET KEYSTORE OPEN子句一起使用。">步骤2：在联合模式PDB中打开软件密钥库</a></li>
                              <li><a href="../multi/cloning-a-pdb.html#MULTI-GUID-D4900E43-DF38-4629-9A1F-D1C11EC8EC8F" target="_blank"><span><cite><span><cite>Oracle多租户管理员指南</cite></span></cite></span></a></li>
                              <li><a href="../multi/cloning-a-pdb.html#MULTI-GUID-B5F57568-0FF8-4F86-AC3C-0EE46EE3ED0B" target="_blank"><span><cite><span><cite>Oracle多租户管理员指南</cite></span></cite></span></a></li>
                              <li><a href="../sqlrf/CREATE-DATABASE-LINK.html#SQLRF-GUID-D966642A-B19E-449D-9968-1121AF06D793" target="_blank"><span><cite><span><cite>Oracle数据库SQL语言参考</cite></span></cite></span></a></li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-6DB427F1-D5B6-47E2-921E-7B6DB314B368" title="在联合模式下，您可以克隆在CDB中具有加密数据的PDB。">在联合模式下使用加密数据管理克隆PDB</a></p>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-2D0FC0F4-6365-47C9-82CC-AED41286540A" name="GUID-2D0FC0F4-6365-47C9-82CC-AED41286540A"></a><h5 id="ASOAG-GUID-2D0FC0F4-6365-47C9-82CC-AED41286540A" class="sect5">在联合模式下使用加密数据在CDB中重新定位克隆的PDB</h5>
                     <div>
                        <p>带有<code class="codeph">KEYSTORE IDENTIFIED BY</code>子句的<code class="codeph">CREATE PLUGGABLE DATABASE</code>语句可以跨CDB重定位具有加密数据的克隆PDB。
                        </p>
                        <ol>
                           <li class="stepexpand"><span>在CDB根目录中，查询<code class="codeph">V$ENCRYPTION_WALLET</code>动态视图的<code class="codeph">STATUS</code>列，以确保在CDB根目录中打开密钥库。</span></li>
                           <li class="stepexpand"><span>以已被授予<code class="codeph">ADMINISTER KEY MANAGEMENT</code>或<code class="codeph">SYSKM</code>权限的用户身份登录PDB。</span></li>
                           <li class="stepexpand"><span>为要克隆的PDB创建数据库链接。</span><div>使用<code class="codeph">CREATE DATABASE LINK</code> SQL语句创建数据库链接。您必须按照克隆远程PDB或非CDB所需的数据库链接先决条件来创建数据库链接。</div>
                           </li>
                           <li class="stepexpand"><span>使用带有<code class="codeph">KEYSTORE IDENTIFIED BY</code>子句的<code class="codeph">CREATE PLUGGABLE DATABASE</code>语句克隆PDB。</span><div>
                                 <p>例如：</p><pre class="oac_no_warn" dir="ltr">CREATE PLUGGABLE DATABASE cdb1_pdb3 FROM cdb1_pdb1 FILE_NAME_CONVERT =（'cdb1_pdb1'，'pdb3 / cdb1_pdb3'）KEYSTORE IDENTIFIED BY <span class="italic">keystore_password</span> ;</pre></div>
                              <div>
                                 <p>将<code class="codeph"><span class="codeinlineitalic">keystore_password</span></code>替换为创建<code class="codeph">cdb1_pdb3</code>克隆的CDB <code class="codeph"><span class="codeinlineitalic">keystore_password</span></code>的密码。
                                 </p>
                              </div>
                              <div>创建克隆的PDB后，克隆仍然可以使用原始PDB的主加密密钥访问加密数据。克隆PDB后，加密表空间中可能存在用户数据。由于源PDB的主加密密钥被复制到目标PDB，因此仍可访问此加密数据。由于克隆是源PDB的副本，但最终会遵循自己的路线并拥有自己的数据和安全策略，因此您应该重新键入克隆PDB的主加密密钥。</div>
                           </li>
                           <li class="stepexpand"><span>使用<code class="codeph">ALTER PLUGGABLE DATABASE</code>语句执行重定位操作。</span><div>例如：<pre class="oac_no_warn" dir="ltr">ALTER PLUGGABLE DATABASE cdb1_pdb3 OPEN RELOCATE TO'need instance name example';</pre></div>
                           </li>
                           <li class="stepexpand"><span>重新键入远程克隆的PDB的主加密密钥。</span><div>
                                 <p>例如：</p><pre class="pre codeblock"><code>ADMINISTER密钥管理设置密钥强制关键字由<span class="italic">keystore_password</span>标识，带有备份使用'emp_key_backup';</code></pre><p>在此示例中，包含<code class="codeph">FORCE KEYSTORE</code> ，因为密钥库必须在重定密钥操作期间打开。
                                 </p>
                              </div>
                              <div>在重新键入克隆的PDB的主加密密钥之前，克隆仍然可以使用属于原始PDB的主加密密钥。但是，这些主加密密钥不会出现在克隆的PDB <code class="codeph">V$</code>动态视图中。重新加密主加密密钥可确保克隆的PDB使用其自己的唯一密钥，这些密钥可在<code class="codeph">V$</code>视图中查看。
                              </div>
                           </li>
                        </ol>
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-765C103D-67A0-4DF1-930E-CFFFA89B2DC2" title="要以联合模式打开软件密钥库，必须将ADMINISTER KEY MANAGEMENT语句与SET KEYSTORE OPEN子句一起使用。">步骤2：在联合模式PDB中打开软件密钥库</a></li>
                              <li><a href="../multi/cloning-a-pdb.html#MULTI-GUID-D4900E43-DF38-4629-9A1F-D1C11EC8EC8F" target="_blank"><span><cite><span><cite>Oracle多租户管理员指南</cite></span></cite></span></a></li>
                              <li><a href="../multi/cloning-a-pdb.html#MULTI-GUID-B5F57568-0FF8-4F86-AC3C-0EE46EE3ED0B" target="_blank"><span><cite><span><cite>Oracle多租户管理员指南</cite></span></cite></span></a></li>
                              <li><a href="../sqlrf/CREATE-DATABASE-LINK.html#SQLRF-GUID-D966642A-B19E-449D-9968-1121AF06D793" target="_blank"><span><cite><span><cite>Oracle数据库SQL语言参考</cite></span></cite></span></a></li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-6DB427F1-D5B6-47E2-921E-7B6DB314B368" title="在联合模式下，您可以克隆在CDB中具有加密数据的PDB。">在联合模式下使用加密数据管理克隆PDB</a></p>
                           </div>
                        </div>
                     </div>
                  </div>
               </div><a id="ASOAG10442"></a><div class="props_rev_3"><a id="GUID-75855CB2-3FBC-41E4-BC89-8EA2078E633E" name="GUID-75855CB2-3FBC-41E4-BC89-8EA2078E633E"></a><h4 id="ASOAG-GUID-75855CB2-3FBC-41E4-BC89-8EA2078E633E" class="sect4">密钥库打开和关闭操作如何在联合模式下工作</h4>
                  <div>
                     <p>您应该了解密钥库打开和关闭操作如何在联合模式下工作。</p>
                     <p>对于联合模式下的每个PDB，您必须在PDB中明确打开受密码保护的软件密钥库或硬件密钥库，以启用透明数据加密操作。（自动登录和本地自动登录软件密钥库自动打开。）关闭PDB上的密钥库将阻止该PDB上的所有透明数据加密操作。</p>
                     <p>PDB中的打开和关闭密钥库操作取决于CDB根目录中密钥库的打开和关闭状态。</p>
                     <p>请注意以下事项：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>您可以在联合模式下为每个PDB创建单独的密钥库密码。</p>
                        </li>
                        <li>
                           <p>在单个PDB中手动打开受密码保护的软件或硬件密钥库之前，必须在CDB根目录中打开密钥库。</p>
                        </li>
                        <li>
                           <p>如果正在使用自动登录密钥库，或者密钥库已关闭，则在打开或关闭密钥库时，请在<code class="codeph">ADMINISTER KEY MANAGEMENT</code>语句中包含<code class="codeph">FORCE KEYSTORE</code>子句。
                           </p>
                        </li>
                        <li>
                           <p>如果密钥库是使用外部存储区进行密码的受密码保护的软件密钥库，则将<code class="codeph">IDENTIFIED BY</code>子句设置为<code class="codeph">EXTERNAL STORE</code> 。</p>
                        </li>
                        <li>
                           <p>在单个PDB中设置TDE主加密密钥之前，必须在CDB根目录中设置密钥。</p>
                        </li>
                        <li>
                           <p>自动登录和本地自动登录软件密钥库自动打开。您不需要首先从CDB根目录或从PDB手动打开它们。</p>
                        </li>
                        <li>
                           <p>如果关闭CDB根目录中的密钥库，则从属PDB中的密钥库也会关闭。根中的密钥库关闭操作相当于在<code class="codeph">CONTAINER</code>子句设置为<code class="codeph">ALL</code>下执行密钥库关闭操作。</p>
                        </li>
                        <li>
                           <p>如果在CDB根目录中执行<code class="codeph">ADMINISTER KEY MANAGEMENT SET KEYSTORE OPEN</code>语句并将<code class="codeph">CONTAINER</code>子句设置为<code class="codeph">ALL</code> ，则只能在以联合模式配置的每个PDB中打开密钥库，并且在隔离模式下配置的任何PDB都是没开。
                           </p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-59000EDC-011E-45BF-9ECB-AC0335EE2FED" title="您可以在联合模式下使用透明数据加密执行常规管理任务。">在联合模式下管理透明数据加密</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="ASOAG10444"></a><a id="ASOAG10443"></a><div class="props_rev_3"><a id="GUID-8E05DC0C-D22F-44AF-9A6A-2564195F0649" name="GUID-8E05DC0C-D22F-44AF-9A6A-2564195F0649"></a><h4 id="ASOAG-GUID-8E05DC0C-D22F-44AF-9A6A-2564195F0649" class="sect4">以联合模式查找所有PDB的密钥库状态</h4>
                  <div>
                     <p>您可以创建一个使用<code class="codeph">V$ENCRYPTION_WALLET</code>视图的便捷函数来查找CDB中所有PDB中的密钥库的状态。</p>
                     <div class="section">
                        <p><code class="codeph">V$ENCRYPTION_WALLET</code>视图显示PDB中密钥库的状态，无论是打开，关闭，使用软件还是硬件密钥库等。
                        </p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>要创建使用<code class="codeph">V$ENCRYPTION_WALLET</code>视图查找密钥库状态的函数，请使用<code class="codeph">CREATE PROCEDURE</code> PL / SQL语句。
                              </p>
                           </li>
                        </ul>
                        <p><a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-8E05DC0C-D22F-44AF-9A6A-2564195F0649__CIHGECEI">例5-2</a>显示了如何创建此功能。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-8E05DC0C-D22F-44AF-9A6A-2564195F0649__CIHGECEI">
                        <p class="titleinexample">示例5-2查找CDB中所有PDB的密钥库状态的功能</p><pre class="oac_no_warn" dir="ltr">创建或替换程序all_pdb_v $ encryption_wallet ISr_occ BOOLEAN; curr_pdb VARCHAR2（30）; pdb_name VARCHAR2（30）; wrl_type VARCHAR2（20）; status VARCHAR2（30）; wallet_type VARCHAR2（20）; wallet_order VARCHAR2（12）; fully_backed_up VARCHAR2（15）; wrl_parameter VARCHAR2（4000）; cursor sel_pdbs是通过con_id desc从V $ CONTAINERS WHERE NAME中选择名称&lt;&gt;'PDB $ SEED'的顺序; BEGIN  - 存储原始PDB名称SELECT sys_context（'userenv'，'con_name'）INTO curr_pdb FROM DUAL;如果curr_pdb &lt;&gt;'CDB $ ROOT'那么dbms_output.put_line（'操作仅在ROOT中有效'）;万一; err_occ：= FALSE; DBMS_OUTPUT.PUT_LINE（ '---'）; dbms_output.put_line（'PDB_NAME WRL_TYPE STATUS'）; dbms_output.put_line（'------------------------------ -------- ------- -----------------------'）; dbms_output.put_line（'WALLET_TYPE WALLET_ORDER FULLY_BACKED_UP'）; dbms_output.put_line（'-------------------- ------------ ------------- - '）; DBMS_OUTPUT.PUT_LINE（ 'WRL_PARAMETER'）; DBMS_OUTPUT.PUT_LINE（'--------------------------------------------- -----------------------------'）; FOR pdbinfo IN sel_pdbs LOOP pdb_name：= DBMS_ASSERT.ENQUOTE_NAME（pdbinfo.name，FALSE）; EXECUTE IMMEDIATE'ALTER SESSION SET CONTAINER ='|| pdb_name; BEGIN pdb_name：= rpad（substr（pdb_name，1,30），30，''）;执行立即'从V $ ENCRYPTION_WALLET'中选择wrl_type到wrl_type; wrl_type：= rpad（substr（wrl_type，1,8），8，''）; EXECUTE IMMEDIATE'从V $ ENCRYPTION_WALLET'中选择状态进入状态; status：= rpad（substr（status，1,30），30，''）; EXECUTE IMMEDIATE'从VAL $ ENCRYPTION_WALLET'中选择wallet_type到wallet_type; wallet_type：= rpad（substr（wallet_type，1,20），20，''）; EXECUTE IMMEDIATE'从$ ENCRYPTION_WALLET'中选择wallet_order进入wallet_order; wallet_order：= rpad（substr（wallet_order，1,9），12，''）;执行IMMEDIATE'从$ ENCRYPTION_WALLET'中选择fully_backed_up到full_backed_up; fully_backed_up：= rpad（substr（fully_backed_up，1,9），15，''）;执行立即'从V $ ENCRYPTION_WALLET'中选择wrl_parameter到wrl_parameter; wrl_parameter：= rpad（substr（wrl_parameter，1,79），79，''）; dbms_output.put_line（pdb_name ||''|| wrl_type ||''|| status）; dbms_output.put_line（wallet_type ||''|| wallet_order ||''|| fully_backed_up）; DBMS_OUTPUT.PUT_LINE（wrl_parameter）;其他时间的例外情况：err_occ：= TRUE;结束;结束循环;如果err_occ = TRUE那么dbms_output.put_line（'一个或多个PDB导致错误'）;万一;结束; 。/在exec上设置serveroutput all_pdb_v $ encryption_wallet;</pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="managing-keystores-encryption-keys-in-united-mode.html#GUID-59000EDC-011E-45BF-9ECB-AC0335EE2FED" title="您可以在联合模式下使用透明数据加密执行常规管理任务。">在联合模式下管理透明数据加密</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>