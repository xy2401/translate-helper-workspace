<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>RMAN操作疑难解答</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96241-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="tuning-rman-performance.html" title="Previous" type="text/html"></link>
      <link rel="next" href="part-transfering-data-rman.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="BRADV"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="tuning-rman-performance.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="part-transfering-data-rman.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">备份和恢复用户指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-rman-tuning-troubleshooting.html" property="item" typeof="WebPage"><span property="name">调整和故障排除</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">RMAN操作疑难解答</li>
            </ol>
            <a id="GUID-ABFD58BD-5D3B-4A6C-AA46-E085AE234D73" name="GUID-ABFD58BD-5D3B-4A6C-AA46-E085AE234D73"></a><a id="BRADV012"></a>
            
            <h2 id="BRADV-GUID-ABFD58BD-5D3B-4A6C-AA46-E085AE234D73" class="sect2"><span class="enumeration_chapter">24</span> RMAN操作疑难解答</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍如何对Recovery Manager进行故障排除。本章包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="troubleshooting-rman-operations.html#GUID-FC95B894-86E6-414C-A0A7-69D9768CDDFC" title="Recovery Manager提供详细的错误消息，可帮助解决问题。">解释RMAN消息输出</a></p>
                  </li>
                  <li>
                     <p><a href="troubleshooting-rman-operations.html#GUID-AD353573-E722-4D76-9361-9C0CA4C29FEB" title="当LIST，REPORT和SHOW不提供RMAN操作所需的所有信息时，某些V $视图可以提供有用的详细信息。">使用V $视图进行RMAN故障排除</a></p>
                  </li>
                  <li>
                     <p><a href="troubleshooting-rman-operations.html#GUID-B1E9715D-BD07-4B80-8158-33981138E679" title="在某些平台上，Oracle提供了一个名为sbttest的诊断工具。该实用程序通过充当Oracle数据库服务器并尝试与媒体管理器通信来执行对媒体管理软件的简单测试。">测试Media Management API</a></p>
                  </li>
                  <li>
                     <p><a href="troubleshooting-rman-operations.html#GUID-772C8583-7763-48AB-B404-747188EC718A" title="有几种方法可以在执行过程中终止RMAN命令。">终止RMAN命令</a></p>
                  </li>
               </ul>
            </div><a id="BRADV174"></a><div class="props_rev_3"><a id="GUID-FC95B894-86E6-414C-A0A7-69D9768CDDFC" name="GUID-FC95B894-86E6-414C-A0A7-69D9768CDDFC"></a><h3 id="BRADV-GUID-FC95B894-86E6-414C-A0A7-69D9768CDDFC" class="sect3"><span class="enumeration_section">24.1</span>解释RMAN消息输出</h3>
               <div>
                  <p>Recovery Manager提供详细的错误消息，可帮助解决问题。</p>
                  <p>此外，Oracle数据库和第三方媒体供应商生成自己的有用调试输出。以下讨论说明了如何识别和解释您可能遇到的不同错误。</p>
               </div><a id="BRADV411"></a><a id="BRADV89865"></a><div class="props_rev_3"><a id="GUID-19A3AA88-4778-4127-A10E-1BD9F2F5D9F8" name="GUID-19A3AA88-4778-4127-A10E-1BD9F2F5D9F8"></a><h4 id="BRADV-GUID-19A3AA88-4778-4127-A10E-1BD9F2F5D9F8" class="sect4"><span class="enumeration_section">24.1.1</span>识别RMAN消息输出的类型</h4>
                  <div>
                     <p>对故障排除失败或无响应的RMAN作业有用的输出位于几个不同的位置。</p>
                     <p>下表概述了可用于解决RMAN备份问题的消息输出的位置。</p>
                     <div class="tblformalwide" id="GUID-19A3AA88-4778-4127-A10E-1BD9F2F5D9F8__BGBBABDH">
                        <p class="titleintable">表24-1消息输出的类型</p>
                        <table cellpadding="4" cellspacing="0" class="FormalWide" title="消息输出的类型" width="100%" border="1" summary="This table lists places to look for different message output useful in troubleshooting RMAN backup problems." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="12%" id="d105110e294">输出类型</th>
                                 <th align="left" valign="bottom" width="12%" id="d105110e298">由。。。生产</th>
                                 <th align="left" valign="bottom" width="38%" id="d105110e301">地点</th>
                                 <th align="left" valign="bottom" width="38%" id="d105110e304">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="12%" id="d105110e309" headers="d105110e294 ">
                                    <p>RMAN消息</p>
                                 </td>
                                 <td align="left" valign="top" width="12%" headers="d105110e309 d105110e298 ">
                                    <p>RMAN</p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d105110e309 d105110e301 ">
                                    <p>已完成的职位信息位于<code class="codeph">V$RMAN_STATUS</code>和<code class="codeph">RC_RMAN_STATUS</code> 。当前的职位信息是<code class="codeph">V$RMAN_OUTPUT</code> 。</p>
                                    <p>从命令行运行RMAN时，可以将输出定向到以下位置：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p>标准输出</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">LOG</code>在命令行或<code class="codeph">SPOOL</code> <code class="codeph">LOG</code>命令中指定的日志文件</p>
                                       </li>
                                       <li>
                                          <p>通过重定向RMAN输出创建的文件（例如，在UNIX中，使用' <code class="codeph">&gt;</code> '运算符）</p>
                                       </li>
                                    </ul>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d105110e309 d105110e304 ">
                                    <p>包含与RMAN作业相关的操作以及RMAN，数据库服务器和媒体供应商生成的错误消息。RMAN错误消息具有<code class="codeph">RMAN-</code>前缀。正常操作描述没有前缀。
                                    </p>
                                    <p>您可以执行以下PL / SQL以从<code class="codeph">V$RMAN_STATUS</code>删除所有条目：</p><pre class="oac_no_warn" dir="ltr">update node set high_rsr_recid = 0其中db_key = <span class="italic">our_target_database_db_ke</span> y;</pre><p>上述功能删除所有与作业相关的条目。在<code class="codeph">V$RMAN_BACKUP_JOB_DETAILS</code>中显示新的备份作业之前，没有行可见。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="12%" id="d105110e373" headers="d105110e294 ">
                                    <p><code class="codeph">alert_</code> <span class="italic">SID</span> <code class="codeph">.log</code></p>
                                 </td>
                                 <td align="left" valign="top" width="12%" headers="d105110e373 d105110e298 ">
                                    <p>Oracle数据库</p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d105110e373 d105110e301 ">
                                    <p><a href="glossary.html#GUID-BDCE90D1-13B7-4D2C-A761-1583A238A247"><span class="xrefglossterm">自动诊断信息库（ADR）</span></a>主目录的<code class="codeph">alert</code>子目录</p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d105110e373 d105110e304 ">
                                    <p>包含按时间顺序排列的错误日志，初始化参数设置和管理操作。记录覆盖的控制文件记录的值。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="12%" id="d105110e397" headers="d105110e294 ">
                                    <p>Oracle跟踪文件</p>
                                 </td>
                                 <td align="left" valign="top" width="12%" headers="d105110e397 d105110e298 ">
                                    <p>Oracle数据库</p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d105110e397 d105110e301 ">
                                    <p>ADR主目录的<code class="codeph">trace</code>子目录</p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d105110e397 d105110e304 ">
                                    <p>包含Oracle数据库进程生成的详细输出。发生<code class="codeph">ORA-600</code>或<code class="codeph">ORA-3113</code>错误消息时，只要RMAN无法分配通道，并且数据库无法加载媒体管理库，就会创建此文件。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="12%" id="d105110e419" headers="d105110e294 ">
                                    <p><code class="codeph">sbtio.log</code></p>
                                 </td>
                                 <td align="left" valign="top" width="12%" headers="d105110e419 d105110e298 ">
                                    <p>第三方媒体管理软件</p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d105110e419 d105110e301 ">
                                    <p>ADR主目录的<code class="codeph">trace</code>子目录</p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d105110e419 d105110e304 ">
                                    <p>包含由媒体管理软件编写的特定于供应商的信息。此日志不包含Oracle数据库或RMAN错误。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="12%" id="d105110e436" headers="d105110e294 ">
                                    <p>媒体管理器日志文件</p>
                                 </td>
                                 <td align="left" valign="top" width="12%" headers="d105110e436 d105110e298 ">
                                    <p>第三方媒体管理软件</p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d105110e436 d105110e301 ">
                                    <p>除<code class="codeph">sbtio.log</code>之外的任何媒体管理器日志的文件名由媒体管理软件确定。
                                    </p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d105110e436 d105110e304 ">
                                    <p>包含有关媒体管理设备功能的信息</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-908BC873-9AC8-402B-9B13-4ECBD1A50F80" name="GUID-908BC873-9AC8-402B-9B13-4ECBD1A50F80"></a><h4 id="BRADV-GUID-908BC873-9AC8-402B-9B13-4ECBD1A50F80" class="sect4"><span class="enumeration_section">24.1.2</span>对长时间运行的RMAN操作进行故障诊断</h4>
                  <div>
                     <p>RMAN消息输出提供有关备份和恢复操作进度的信息。使用此信息可以采取任何必要的操作来解决卡住或等待资源的操作。</p>
                     <p>大型数据库的某些操作（如备份，还原，恢复和复制）通常需要很长时间才能完成。但是，并不总是清楚操作是在进行还是在等待某些资源。从Oracle Database Release 18c开始，RMAN消息输出包含指示作业是否在等待资源的其他日志记录信息。每隔10分钟，RMAN会检查处理的块数是否有变化。如果处理的块没有变化，则RMAN显示带有相关等待事件的消息。</p>
                     <p>以下是<code class="codeph">RESTORE</code>操作的RMAN输出示例：</p><pre class="pre codeblock"><code>已分配通道：c1通道c1：SID = 123设备类型= SBT_TAPE通道c1：警告：Oracle Test Disk API在18-JAN-18通道c1开始还原：启动数据文件备份集还原通道c1：指定要从中还原的数据文件备份集通道c1：将数据文件00002还原到/ade/b/2776899351/oracle/dbs/tbs_ax1.f通道c1：从备份片01sov1t4_1_1读取*****在2018-01-18 04检测到挂起***** ：11：23表示通道c1，INSTID：1，SID：123，串行：35831读取块没有变化，因此显示等待事件[总块数= 192000，块读取/恢复= 41530] Seq_No事件等待时间（mirco秒） 602备份：MML读取备份件38094371 *****检测到挂起在2018-01-18 04:11:33通道c1，INSTID：1，SID：123，序列号：35831读取没有变化块，因此显示等待事件[总块= 192000，块读取/恢复= 41530] Seq_No事件等待时间（mirco秒）602备份：MML读取备份片48106104通道c1：片句句柄= 01sov1t4_1_1标签= TAG20180118T 040804通道c1：恢复备份1通道c1：恢复完成，经过时间：00：02：35完成恢复18-JAN-18发布通道：c1</code></pre><p>输出表明由于媒体管理器读取操作出现问题而导致恢复被卡住。读取操作完成后，RMAN还原成功。</p>
                  </div>
               </div><a id="BRADV412"></a><a id="BRADV89866"></a><div class="props_rev_3"><a id="GUID-A2497F34-9030-4A43-AE3A-248B514D7FAA" name="GUID-A2497F34-9030-4A43-AE3A-248B514D7FAA"></a><h4 id="BRADV-GUID-A2497F34-9030-4A43-AE3A-248B514D7FAA" class="sect4"><span class="enumeration_section">24.1.3</span>识别RMAN错误消息堆栈</h4>
                  <div>
                     <p>RMAN会在发生错误时报告错误。如果错误无法检索，即，如果RMAN无法执行故障转移到另一个通道以完成特定作业步骤，则RMAN还会在所有作业集完成后报告错误摘要。此功能称为延迟错误报告。</p>
                     <div class="section">
                        <p>确定RMAN是否遇到错误的一种方法是检查其返回码。第二种方法是在RMAN输出中搜索字符串<code class="codeph">RMAN-00569</code> ，该字符串是错误堆栈<code class="codeph">RMAN-00569</code>的消息号。所有RMAN错误都以此错误消息开头。如果在输出中没有看到<code class="codeph">RMAN-00569</code>消息，则表示没有错误。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-A2497F34-9030-4A43-AE3A-248B514D7FAA__BGBIHGBB">
                        <p class="titleinexample">例24-1 RMAN语法错误</p>
                        <p>此示例显示RMAN语法错误。<code class="codeph">RMAN-00569</code>消息后面跟着指示错误原因的其他错误消息。
                        </p><pre class="oac_no_warn" dir="ltr">RMAN-00571：============================================== ============= RMAN-00569：===============错误信息堆栈跟踪============== = RMAN-00571：============================================= ============== RMAN-00558：解析输入命令时遇到错误RMAN-01005：语法错误：找到“）”：期望以下之一：“archivelog，backup，backupset，controlfilecopy，current ，数据库，数据文件，datafilecopy，（加上，;，表空间“RMAN-01007：第1行第18列文件：标准输入</pre></div>
                     <!-- class="example" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-A2497F34-9030-4A43-AE3A-248B514D7FAA__GUID-F16E72D2-3B86-46AE-97BF-92D10B0099B5">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="troubleshooting-rman-operations.html#GUID-52F92FE9-4C46-4380-97CB-454E5C784E01" title="确定RMAN是否遇到错误的一种方法是检查其返回代码或退出状态。如果没有发生错误，RMAN客户端将0返回到调用它的shell，否则返回非零错误值。">识别RMAN返回代码</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV89867"></a><div class="props_rev_3"><a id="GUID-86207589-FA0F-4F24-BEEE-A212E0059C7F" name="GUID-86207589-FA0F-4F24-BEEE-A212E0059C7F"></a><h4 id="BRADV-GUID-86207589-FA0F-4F24-BEEE-A212E0059C7F" class="sect4"><span class="enumeration_section">24.1.4</span>识别RMAN错误代码</h4>
                  <div>
                     <p>您可以使用RMAN消息堆栈中的错误代码来解决RMAN命令的问题。</p>
                     <p>通常，您在RMAN消息堆栈中找到以下类型的错误代码：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>以<code class="codeph">RMAN-</code>为前缀的错误 -</p>
                           <p>这些是RMAN错误。</p>
                        </li>
                        <li>
                           <p>以<code class="codeph">ORA-</code>为前缀的错误</p>
                           <p>媒体管理器错误使用<code class="codeph">ORA-</code>前缀。
                           </p>
                        </li>
                        <li>
                           <p>行前面的错误<code class="codeph">Additional information:</code></p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-86207589-FA0F-4F24-BEEE-A212E0059C7F__GUID-2F0273F7-25AC-4D6D-AFCE-A5BD4117B9C0">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="troubleshooting-rman-operations.html#GUID-122ADB82-E15B-4104-B7C6-DE1752D8466E" title="RMAN error messages are prefixed with RMAN-.">RMAN错误消息数字</a>表示<a href="troubleshooting-rman-operations.html#GUID-122ADB82-E15B-4104-B7C6-DE1752D8466E" title="RMAN错误消息以RMAN-为前缀。">RMAN错误</a>的错误范围</p>
                           </li>
                           <li>
                              <p><a href="troubleshooting-rman-operations.html#GUID-B23435DA-149D-4BFF-BF03-0FA4B68D5020" title="如果发生媒体管理器错误，则发出ORA-19511信号，并且媒体管理器应该向RMAN提供描述性错误。RMAN显示媒体管理器传回给它的错误。">ORA-19511：介质管理器错误</a>的介质管理器错误的介质管理器错误</p>
                           </li>
                           <li>
                              <p><a href="../errmg/index.html" target="_blank"><span><cite>Oracle数据库错误消息参考，</cite></span></a>用于解释<code class="codeph">RMAN</code>和<code class="codeph">ORA</code>错误代码</p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="BRADV413"></a><a id="BRADV89868"></a><div class="props_rev_3"><a id="GUID-122ADB82-E15B-4104-B7C6-DE1752D8466E" name="GUID-122ADB82-E15B-4104-B7C6-DE1752D8466E"></a><h5 id="BRADV-GUID-122ADB82-E15B-4104-B7C6-DE1752D8466E" class="sect5"><span class="enumeration_section">24.1.4.1</span> RMAN错误消息号</h5>
                     <div>
                        <p>RMAN错误消息以RMAN-为前缀。</p>
                        <p>下表显示了常见RMAN错误消息的错误范围，所有这些消息都在<a href="../errmg/RMAN-00201.html#ERRMG-GUID-8CF36220-DF1E-4BC7-A0B7-A95824301C2A" target="_blank"><span><cite>Oracle数据库错误消息参考中</cite></span></a>进行了描述。
                        </p>
                        <div class="tblformal" id="GUID-122ADB82-E15B-4104-B7C6-DE1752D8466E__G1014492">
                           <p class="titleintable">表24-2 RMAN错误消息范围</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="RMAN错误消息范围" width="100%" border="1" summary="This table lists error number ranges associated with RMAN error messages and their likely causes." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="20%" id="d105110e879">误差范围</th>
                                    <th align="left" valign="bottom" width="80%" id="d105110e882">原因</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d105110e887" headers="d105110e879 ">
                                       <p>0550-0999</p>
                                    </td>
                                    <td align="left" valign="top" width="80%" headers="d105110e887 d105110e882 ">
                                       <p>命令行解释器</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d105110e894" headers="d105110e879 ">
                                       <p>1000-1999</p>
                                    </td>
                                    <td align="left" valign="top" width="80%" headers="d105110e894 d105110e882 ">
                                       <p>关键字分析器</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d105110e901" headers="d105110e879 ">
                                       <p>2000-2999</p>
                                    </td>
                                    <td align="left" valign="top" width="80%" headers="d105110e901 d105110e882 ">
                                       <p>语法分析器</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d105110e908" headers="d105110e879 ">
                                       <p>3000-3999</p>
                                    </td>
                                    <td align="left" valign="top" width="80%" headers="d105110e908 d105110e882 ">
                                       <p>主层</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d105110e915" headers="d105110e879 ">
                                       <p>4000-4999</p>
                                    </td>
                                    <td align="left" valign="top" width="80%" headers="d105110e915 d105110e882 ">
                                       <p>服务层</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d105110e922" headers="d105110e879 ">
                                       <p>5000-5499</p>
                                    </td>
                                    <td align="left" valign="top" width="80%" headers="d105110e922 d105110e882 ">
                                       <p>编译<code class="codeph">RESTORE</code>或<code class="codeph">RECOVER</code>命令</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d105110e935" headers="d105110e879 ">
                                       <p>5500-5999</p>
                                    </td>
                                    <td align="left" valign="top" width="80%" headers="d105110e935 d105110e882 ">
                                       <p>编译<code class="codeph">DUPLICATE</code>命令</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d105110e945" headers="d105110e879 ">
                                       <p>6000-6999</p>
                                    </td>
                                    <td align="left" valign="top" width="80%" headers="d105110e945 d105110e882 ">
                                       <p>一般编译</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d105110e952" headers="d105110e879 ">
                                       <p>7000-7999</p>
                                    </td>
                                    <td align="left" valign="top" width="80%" headers="d105110e952 d105110e882 ">
                                       <p>一般执行</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d105110e959" headers="d105110e879 ">
                                       <p>8000-8999</p>
                                    </td>
                                    <td align="left" valign="top" width="80%" headers="d105110e959 d105110e882 ">
                                       <p>PL / SQL程序</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d105110e966" headers="d105110e879 ">
                                       <p>9000-9999</p>
                                    </td>
                                    <td align="left" valign="top" width="80%" headers="d105110e966 d105110e882 ">
                                       <p>低级关键字分析器</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d105110e974" headers="d105110e879 ">
                                       <p>10000-10999</p>
                                    </td>
                                    <td align="left" valign="top" width="80%" headers="d105110e974 d105110e882 ">
                                       <p>服务器端执行</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d105110e981" headers="d105110e879 ">
                                       <p>11000-11999</p>
                                    </td>
                                    <td align="left" valign="top" width="80%" headers="d105110e981 d105110e882 ">
                                       <p>PL / SQL和RMAN之间的相间错误</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d105110e988" headers="d105110e879 ">
                                       <p>12000-12999</p>
                                    </td>
                                    <td align="left" valign="top" width="80%" headers="d105110e988 d105110e882 ">
                                       <p>恢复目录包</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                  </div><a id="BRADV414"></a><a id="BRADV89869"></a><div class="props_rev_3"><a id="GUID-B23435DA-149D-4BFF-BF03-0FA4B68D5020" name="GUID-B23435DA-149D-4BFF-BF03-0FA4B68D5020"></a><h5 id="BRADV-GUID-B23435DA-149D-4BFF-BF03-0FA4B68D5020" class="sect5"><span class="enumeration_section">24.1.4.2</span> ORA-19511：介质管理器错误</h5>
                     <div>
                        <p>如果发生媒体管理器错误，则发出<code class="codeph">ORA-19511</code>信号，并且媒体管理器应该向RMAN提供描述性错误。RMAN显示媒体管理器传回给它的错误。
                        </p>
                        <p>例如，您可能会看到：</p><pre class="oac_no_warn" dir="ltr">ORA-19511：从媒体管理器层收到错误，错误文本：sbtpvt_open_input：file。*不存在或无法访问，errno = 2</pre><p>来自媒体管理器的消息应该为您提供足够的信息，以便您解决根本问题。如果没有，请参阅媒体管理器的文档或与媒体管理供应商支持代表联系以获取更多信息。<code class="codeph">ORA-19511</code>错误源自媒体管理器，而不是Oracle数据库。数据库只传递来自媒体管理器的消息。原因只能由媒体管理供应商解决。
                        </p>
                        <p>如果您仍在使用符合SBT 1.1的媒体管理层，则可能会看到一些其他错误消息文本。符合SBT 1.1的媒体管理层的输出类似于以下内容：</p><pre class="oac_no_warn" dir="ltr">ORA-19507：无法检索顺序文件，handle =“c-140148591-20031014-06”，parms =“”ORA-27007：无法打开文件附加信息：7000附加信息：2 ORA-19511：从媒体收到错误管理器层，错误文本：SBT错误= 7000，错误= 0，sbtopen：找不到备份文件</pre><p>提供的“附加信息”使用特定于SBT 1.1的错误代码。显示的值对应于<a href="troubleshooting-rman-operations.html#GUID-B23435DA-149D-4BFF-BF03-0FA4B68D5020__G1014541" title="此表列出了SBT 1.1错误消息编号和相应的错误文本。">表24-3中</a>列出的媒体管理器消息编号和错误文本。RMAN再次发出错误信号，如<code class="codeph">Error received from media manager layer</code>的ORA-19511 <code class="codeph">Error received from media manager layer</code> ，然后显示与介质管理器返回的错误代码相关的一般错误消息，包括SBT 1.1错误编号。
                        </p>
                        <p>此处列出了SBT 1.1错误消息供您参考。<a href="troubleshooting-rman-operations.html#GUID-B23435DA-149D-4BFF-BF03-0FA4B68D5020__G1014541" title="此表列出了SBT 1.1错误消息编号和相应的错误文本。">表24-3</a>列出了介质管理器消息编号及其相应的错误文本。在错误代码中， <span class="italic"><code class="codeph">O/S</code></span>代表<span class="italic">操作系统</span> 。标有星号（*）的错误是内部错误，通常在正常操作期间看不到。
                        </p>
                        <div class="tblformal" id="GUID-B23435DA-149D-4BFF-BF03-0FA4B68D5020__G1014541">
                           <p class="titleintable">表24-3介质管理器错误消息范围</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="媒体管理器错误消息范围" width="100%" border="1" summary="This table lists SBT 1.1 error message numbers and corresponding error text.." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="20%" id="d105110e1129">原因</th>
                                    <th align="left" valign="bottom" width="20%" id="d105110e1132">没有。</th>
                                    <th align="left" valign="bottom" width="60%" id="d105110e1135">信息</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d105110e1140" headers="d105110e1129 ">
                                       <p>sbtopen</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d105110e1140 d105110e1132 ">
                                       <p>7000</p>
                                       <p>7001</p>
                                       <p>7002 *</p>
                                       <p>7003</p>
                                       <p>7004</p>
                                       <p>7005</p>
                                       <p>7006</p>
                                       <p>7007</p>
                                       <p>7008</p>
                                       <p>7009</p>
                                       <p>7010</p>
                                       <p>7011</p>
                                       <p>7012 *</p>
                                    </td>
                                    <td align="left" valign="top" width="60%" headers="d105110e1140 d105110e1135 ">
                                       <p>找不到备份文件（仅返回读取）</p>
                                       <p>文件存在（仅返回写入）</p>
                                       <p>指定了错误模式</p>
                                       <p>指定的块大小无效</p>
                                       <p>找不到磁带设备</p>
                                       <p>找到设备，但很忙;稍后再试</p>
                                       <p>未找到磁带卷</p>
                                       <p>磁带卷正在使用中</p>
                                       <p>I / O错误</p>
                                       <p>无法与媒体管理器连接</p>
                                       <p>没有权限</p>
                                       <p>O / S错误，例如malloc，fork错误</p>
                                       <p>sbtopen的参数无效</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d105110e1200" headers="d105110e1129 ">
                                       <p>sbtclose</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d105110e1200 d105110e1132 ">
                                       <p>7020 *</p>
                                       <p>7021 *</p>
                                       <p>7022</p>
                                       <p>7023</p>
                                       <p>7024 *</p>
                                       <p>7025</p>
                                    </td>
                                    <td align="left" valign="top" width="60%" headers="d105110e1200 d105110e1135 ">
                                       <p>无效的文件句柄或文件未打开</p>
                                       <p>sbtclose的标志无效</p>
                                       <p>I / O错误</p>
                                       <p>O / S错误</p>
                                       <p>sbtclose的参数无效</p>
                                       <p>无法与媒体管理器连接</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d105110e1230" headers="d105110e1129 ">
                                       <p>sbtwrite</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d105110e1230 d105110e1132 ">
                                       <p>7040 *</p>
                                       <p>7041</p>
                                       <p>7042</p>
                                       <p>7043</p>
                                       <p>7044 *</p>
                                    </td>
                                    <td align="left" valign="top" width="60%" headers="d105110e1230 d105110e1135 ">
                                       <p>无效的文件句柄或文件未打开</p>
                                       <p>达到成交量</p>
                                       <p>I / O错误</p>
                                       <p>O / S错误</p>
                                       <p>sbtwrite的参数无效</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d105110e1256" headers="d105110e1129 ">
                                       <p>sbtread</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d105110e1256 d105110e1132 ">
                                       <p>7060 *</p>
                                       <p>7061</p>
                                       <p>7062</p>
                                       <p>7063</p>
                                       <p>7064</p>
                                       <p>7065 *</p>
                                    </td>
                                    <td align="left" valign="top" width="60%" headers="d105110e1256 d105110e1135 ">
                                       <p>无效的文件句柄或文件未打开</p>
                                       <p>EOF遇到了</p>
                                       <p>达到成交量</p>
                                       <p>I / O错误</p>
                                       <p>O / S错误</p>
                                       <p>sbtread的参数无效</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d105110e1286" headers="d105110e1129 ">
                                       <p>sbtremove</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d105110e1286 d105110e1132 ">
                                       <p>7080</p>
                                       <p>7081</p>
                                       <p>7082</p>
                                       <p>7083</p>
                                       <p>7084</p>
                                       <p>7085</p>
                                       <p>7086 *</p>
                                    </td>
                                    <td align="left" valign="top" width="60%" headers="d105110e1286 d105110e1135 ">
                                       <p>找不到备份文件</p>
                                       <p>正在使用的备份文件</p>
                                       <p>I / O错误</p>
                                       <p>无法与媒体管理器连接</p>
                                       <p>没有权限</p>
                                       <p>O / S错误</p>
                                       <p>sbtremove的参数无效</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d105110e1320" headers="d105110e1129 ">
                                       <p>sbtinfo</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d105110e1320 d105110e1132 ">
                                       <p>7090</p>
                                       <p>7091</p>
                                       <p>7092</p>
                                       <p>7093</p>
                                       <p>7094</p>
                                       <p>7095 *</p>
                                    </td>
                                    <td align="left" valign="top" width="60%" headers="d105110e1320 d105110e1135 ">
                                       <p>找不到备份文件</p>
                                       <p>I / O错误</p>
                                       <p>无法与媒体管理器连接</p>
                                       <p>没有权限</p>
                                       <p>O / S错误</p>
                                       <p>sbtinfo的参数无效</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d105110e1350" headers="d105110e1129 ">
                                       <p>sbtinit</p>
                                    </td>
                                    <td align="left" valign="top" width="20%" headers="d105110e1350 d105110e1132 ">
                                       <p>7110 *</p>
                                       <p>7111</p>
                                    </td>
                                    <td align="left" valign="top" width="60%" headers="d105110e1350 d105110e1135 ">
                                       <p>sbtinit的参数无效</p>
                                       <p>O / S错误</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                  </div>
               </div><a id="BRADV89870"></a><div class="props_rev_3"><a id="GUID-018EEA85-F7B0-48EC-A688-FDF6B537CE3E" name="GUID-018EEA85-F7B0-48EC-A688-FDF6B537CE3E"></a><h4 id="BRADV-GUID-018EEA85-F7B0-48EC-A688-FDF6B537CE3E" class="sect4"><span class="enumeration_section">24.1.5</span>解释RMAN错误堆栈</h4>
                  <div>
                     <p>在RMAN错误堆栈中标识相关消息非常重要。</p>
                     <div class="section">
                        <p>在解释RMAN消息时，请注意以下提示和建议：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>从下往上阅读消息，因为这是RMAN发出消息的顺序。堆栈中显示的最后一个或两个错误通常是提供最多信息的。</p>
                           </li>
                           <li>
                              <p>当您使用SBT 1.1媒体管理层并且出现包含“ <code class="codeph">Additional information:</code> ”数字错误代码的SBT 1.1样式错误消息时，请查找<code class="codeph">ORA-19511</code>的<code class="codeph">ORA-19511</code>消息，以获取传递回RMAN的错误消息的文本由媒体经理。这些消息标识媒体管理层中的真实故障。
                              </p>
                           </li>
                           <li>
                              <p>在错误标题后面立即查找<code class="codeph">RMAN-03002</code>或<code class="codeph">RMAN-03009</code>消息（ <code class="codeph">RMAN-03009</code>等于<code class="codeph">RMAN-03002</code>但包括通道ID）。这些消息指示哪个命令失败。语法错误生成<code class="codeph">RMAN-00558</code> 。
                              </p>
                           </li>
                           <li>
                              <p>根据<a href="troubleshooting-rman-operations.html#GUID-122ADB82-E15B-4104-B7C6-DE1752D8466E__G1014492" title="此表列出了与RMAN错误消息及其可能原因相关的错误号范围。">表24-2中</a>的错误范围图表确定基本类型的错误，然后参阅错误消息以获取有关最重要消息的信息。
                              </p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-018EEA85-F7B0-48EC-A688-FDF6B537CE3E__GUID-3D2CB4D8-1920-451F-A936-A447C8E4D11B">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="troubleshooting-rman-operations.html#GUID-3F0A6F9D-1FD0-4507-8E2B-B1A205690BCC" title="由RMAN作为前缀的错误表示由RMAN命令引起的错误。">解释RMAN错误：示例</a>和<a href="troubleshooting-rman-operations.html#GUID-1143EB66-0ACB-4E32-9AC4-66031A889095" title="Errors from the server are prefixed with ORA-.">解释服务器错误：</a> RMAN错误消息<a href="troubleshooting-rman-operations.html#GUID-1143EB66-0ACB-4E32-9AC4-66031A889095" title="来自服务器的错误以ORA-为前缀。">示例</a>的示例</p>
                              </li>
                              <li>
                                 <p><a href="troubleshooting-rman-operations.html#GUID-EB1FDC10-6B32-41DC-A1F5-B4EC149B2337" title="此示例显示如何解释在媒体管理器级别导致的错误。">解释SBT 2.0介质管理错误：示例</a>和<a href="troubleshooting-rman-operations.html#GUID-37D6BF25-3EEF-473A-A500-D13F0FD9FC87" title="此示例显示具有错误介质管理错误的备份作业的输出。">解释SBT 1.1介质管理错误：</a>解释介质管理错误的示例示例</p>
                              </li>
                              <li>
                                 <p>有关错误消息的<a href="../errmg/index.html" target="_blank"><span class="italic">信息</span></a> ，请参阅<a href="../errmg/index.html" target="_blank"><span class="italic">Oracle数据库错误</span></a>消息</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div><a id="BRADV89871"></a><div class="props_rev_3"><a id="GUID-3F0A6F9D-1FD0-4507-8E2B-B1A205690BCC" name="GUID-3F0A6F9D-1FD0-4507-8E2B-B1A205690BCC"></a><h5 id="BRADV-GUID-3F0A6F9D-1FD0-4507-8E2B-B1A205690BCC" class="sect5"><span class="enumeration_section">24.1.5.1</span>解释RMAN错误：示例</h5>
                     <div>
                        <p>由RMAN作为前缀的错误表示由RMAN命令引起的错误。</p>
                        <p>您尝试备份表空间<code class="codeph">users</code>并收到以下消息：</p><pre class="oac_no_warn" dir="ltr">使用频道ORA_DISK_1 RMAN-00571在29-AUG-13开始备份：=================================== ======================== RMAN-00569：=============== ERROR MESSAGE STACK跟踪=== ============ RMAN-00571：================================== ========================= RMAN-03002：备份命令失败于08/29/2013 15:14:03 RMAN-20202：表空间没有在恢复目录中找到RMAN-06019：无法翻译表空间名称“USESR”</pre><p><code class="codeph">RMAN-03002</code>错误表示<code class="codeph">BACKUP</code>命令失败。您首先读取堆栈中的最后两条消息，然后立即看到问题：恢复目录中没有表空间<code class="codeph">users</code> ，因为您将该名称<code class="codeph">usesr</code>错误用作<code class="codeph">usesr</code> 。
                        </p>
                     </div>
                  </div><a id="BRADV89872"></a><div class="props_rev_3"><a id="GUID-1143EB66-0ACB-4E32-9AC4-66031A889095" name="GUID-1143EB66-0ACB-4E32-9AC4-66031A889095"></a><h5 id="BRADV-GUID-1143EB66-0ACB-4E32-9AC4-66031A889095" class="sect5"><span class="enumeration_section">24.1.5.2</span>解释服务器错误：示例</h5>
                     <div>
                        <p>来自服务器的错误以ORA-为前缀。</p>
                        <p>假设您尝试恢复表空间并收到以下错误：</p><pre class="oac_no_warn" dir="ltr">RMAN&gt; RECOVER TABLESPACE用户;使用渠道ORA_DISK_1在29-AUG-13开始恢复启动介质恢复介质恢复失败RMAN-00571：============================= ============================== RMAN-00569：===============错误消息堆栈如下：=============== RMAN-00571：============================ =============================== RMAN-03002：恢复命令失败于08/29/2013 15:18:43 RMAN-11003：解析/执行SQL语句时失败：如果需要，更改数据库恢复表空间USERS ORA-00283：由于错误而取消恢复会话ORA-01124：无法恢复数据文件8  - 文件正在使用或恢复ORA-01110：数据文件8：'/ oracle/oradata/trgt/users01.dbf'</pre><p>如建议的那样，你开始从下往上阅读。<code class="codeph">ORA-01110</code>消息说明恢复数据文件<code class="codeph">users01.dbf</code> 。第二个错误表示数据库无法恢复数据文件，因为它正在使用或正在恢复。剩余的RMAN错误表示由于服务器错误而取消了恢复会话。因此，您得出结论，因为您没有恢复此数据文件，问题必须是数据文件处于联机状态，您必须使其脱机并恢复备份。
                        </p>
                     </div>
                  </div><a id="BRADV89873"></a><div class="props_rev_3"><a id="GUID-EB1FDC10-6B32-41DC-A1F5-B4EC149B2337" name="GUID-EB1FDC10-6B32-41DC-A1F5-B4EC149B2337"></a><h5 id="BRADV-GUID-EB1FDC10-6B32-41DC-A1F5-B4EC149B2337" class="sect5"><span class="enumeration_section">24.1.5.3</span>解释SBT 2.0介质管理错误：示例</h5>
                     <div>
                        <p>此示例显示如何解释在媒体管理器级别导致的错误。</p>
                        <p>假设您在备份作业期间使用磁带驱动器并查看以下输出：</p><pre class="oac_no_warn" dir="ltr">RMAN-00571：============================================== ============= RMAN-00569：===============错误信息堆栈跟踪============== = RMAN-00571：============================================= ============== ORA-19624：操作失败，重试可能ORA-19507：无法检索顺序文件，handle =“/ tmp / mydir”，parms =“”ORA-27029： skgfrtrv：sbtrestore返回错误ORA-19511：从媒体管理器层收到错误，错误文本：sbtpvt_open_input：file / tmp / mydir不存在或无法访问，errno = 2</pre><p><code class="codeph">ORA-19511</code>错误后显示的错误文本由媒体管理器生成，描述了失败的真正原因。请参阅媒体管理器文档以解释此错误。
                        </p>
                     </div>
                  </div><a id="BRADV89874"></a><div class="props_rev_3"><a id="GUID-37D6BF25-3EEF-473A-A500-D13F0FD9FC87" name="GUID-37D6BF25-3EEF-473A-A500-D13F0FD9FC87"></a><h5 id="BRADV-GUID-37D6BF25-3EEF-473A-A500-D13F0FD9FC87" class="sect5"><span class="enumeration_section">24.1.5.4</span>解释SBT 1.1媒体管理错误：示例</h5>
                     <div>
                        <p>此示例显示具有错误介质管理错误的备份作业的输出。</p>
                        <p>假设您在备份作业期间使用磁带驱动器并查看以下输出：</p><pre class="oac_no_warn" dir="ltr">RMAN-00571：============================================== ============= RMAN-00569：===============错误信息堆栈跟踪============== = RMAN-00571：============================================= ============== RMAN-03009：c1频道上的备份命令失败于09/04/2013 13:18:19 ORA-19506：无法创建顺序文件，name =“07d36ecp_1_1 “，parms =”“ORA-27007：无法打开文件SVR4错误：2：没有此类文件或目录附加信息：7005附加信息：1 ORA-19511：从介质管理器层收到错误，错误文本：SBT错误= 7005 ，errno = 2，sbtopen：系统错误</pre><p>SBT 1.1媒体经理返回的主要信息是“附加信息”行中的错误代码：</p><pre class="oac_no_warn" dir="ltr">其他信息：7005</pre><p><a href="troubleshooting-rman-operations.html#GUID-B23435DA-149D-4BFF-BF03-0FA4B68D5020__G1014541" title="此表列出了SBT 1.1错误消息编号和相应的错误文本。">参见表24-3</a> ，您发现错误<code class="codeph">7005</code>表示媒体管理设备正忙。因此，媒体管理软件无法写入设备，因为它正在使用或存在问题。
                        </p>
                        <div class="infoboxnote" id="GUID-37D6BF25-3EEF-473A-A500-D13F0FD9FC87__GUID-1818CCDC-CEC3-48D7-9538-864C5A0B3FDA">
                           <p class="notep1">注意：</p>
                           <p><code class="codeph">sbtio.log</code>包含由媒体管理软件<span class="italic">而不是</span> Oracle数据库编写的信息。因此，您必须查阅媒体供应商文档以解释错误代码和消息。如果没有信息写入<code class="codeph">sbtio.log</code> ，请联系您的媒体管理器支持，询问他们是否在其他位置编写错误消息，或者是否必须采取措施才能在<code class="codeph">sbtio.log</code>显示媒体管理器错误。
                           </p>
                        </div>
                     </div>
                  </div>
               </div><a id="BRADV89875"></a><div class="props_rev_3"><a id="GUID-52F92FE9-4C46-4380-97CB-454E5C784E01" name="GUID-52F92FE9-4C46-4380-97CB-454E5C784E01"></a><h4 id="BRADV-GUID-52F92FE9-4C46-4380-97CB-454E5C784E01" class="sect4"><span class="enumeration_section">24.1.6</span>识别RMAN返回码</h4>
                  <div>
                     <p>确定RMAN是否遇到错误的一种方法是检查其返回代码或退出状态。如果没有发生错误，RMAN客户端将0返回到调用它的shell，否则返回非零错误值。</p>
                     <div class="section">
                        <p>如何访问此返回代码取决于您从中调用RMAN客户端的环境。例如，如果使用C shell运行UNIX，则在RMAN完成时，返回代码将放在名为<code class="codeph">$status</code>的shell变量中。返回退出状态的方法是特定于主机操作系统而不是RMAN客户端的细节。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV415"></a><a id="BRADV177"></a><div class="props_rev_3"><a id="GUID-AD353573-E722-4D76-9361-9C0CA4C29FEB" name="GUID-AD353573-E722-4D76-9361-9C0CA4C29FEB"></a><h3 id="BRADV-GUID-AD353573-E722-4D76-9361-9C0CA4C29FEB" class="sect3"><span class="enumeration_section">24.2</span>使用V $视图进行RMAN故障排除</h3>
               <div>
                  <p>当<code class="codeph">LIST</code> ， <code class="codeph">REPORT</code>和<code class="codeph">SHOW</code>不提供RMAN操作所需的所有信息时，某些V $视图可以提供有用的详细信息。
                  </p>
                  <p>有时，确切地确定执行备份和恢复作业的服务器会话正在执行的操作很有用。下表中描述的视图对于获取有关RMAN作业的信息非常有用。</p>
                  <div class="tblformal" id="GUID-AD353573-E722-4D76-9361-9C0CA4C29FEB__CHDCJGIE">
                     <p class="titleintable">表24-4有用的V $视图以进行故障排除</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="用于故障排除的有用V $视图" width="100%" border="1" summary="This table describes views that can assist in monitoring or obtaining information about RMAN jobs." frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="26%" id="d105110e2097">视图</th>
                              <th align="left" valign="bottom" width="74%" id="d105110e2100">描述</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="26%" id="d105110e2105" headers="d105110e2097 ">
                                 <p><code class="codeph">V $ PROCESS</code></p>
                              </td>
                              <td align="left" valign="top" width="74%" headers="d105110e2105 d105110e2100 ">
                                 <p>标识当前活动的进程</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="26%" id="d105110e2113" headers="d105110e2097 ">
                                 <p><code class="codeph">V $ SESSION</code></p>
                              </td>
                              <td align="left" valign="top" width="74%" headers="d105110e2113 d105110e2100 ">
                                 <p>标识当前活动的会话。使用此视图可确定哪些数据库服务器会话与哪些RMAN分配的通道相对应。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="26%" id="d105110e2121" headers="d105110e2097 ">
                                 <p><code class="codeph">V $ SESSION_WAIT</code></p>
                              </td>
                              <td align="left" valign="top" width="74%" headers="d105110e2121 d105110e2100 ">
                                 <p>列出会话等待的事件或资源</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <p>您可以使用上述视图执行以下任务：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="troubleshooting-rman-operations.html#GUID-6B323AE8-1E76-45E6-8434-3DCC5CE2E873" title="您可以使用动态性能事件视图中的事件名称来监视对媒体管理API的RMAN调用。事件名称与SBT功能一一对应。">监视RMAN与媒体管理器的交互</a></p>
                     </li>
                     <li>
                        <p><a href="troubleshooting-rman-operations.html#GUID-A73F567C-1F2D-403B-BED9-90B78B4CA7CD" title="要识别哪些服务器会话对应于哪些RMAN通道，您可以查询V $ SESSION和V $ PROCESS。">将服务器会话与RMAN通道相关联</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89876"></a><div class="props_rev_3"><a id="GUID-6B323AE8-1E76-45E6-8434-3DCC5CE2E873" name="GUID-6B323AE8-1E76-45E6-8434-3DCC5CE2E873"></a><h4 id="BRADV-GUID-6B323AE8-1E76-45E6-8434-3DCC5CE2E873" class="sect4"><span class="enumeration_section">24.2.1</span>监控RMAN与媒体管理器的交互</h4>
                  <div>
                     <p>您可以使用动态性能事件视图中的事件名称来监视对媒体管理API的RMAN调用。事件名称与SBT功能一一对应。</p>
                     <div class="section">
                        <p>请参阅以下示例：</p><pre class="oac_no_warn" dir="ltr">备份：MML v1打开备份片备份：MML v1读备份片备份：MML v1写备份片备份：MML v1查询备份片备份：MML v1删除备份片备份：MML v1关闭备份片。。。</pre><p>要获取SBT事件的完整列表，可以使用以下查询：</p><pre class="oac_no_warn" dir="ltr">从V $ EVENT_NAME中选择名称，其名称类似于'％MML％';</pre><p>在调用媒体管理API中的任何函数之前，服务器在<code class="codeph">V$SESSION_WAIT</code>添加一行，其中<code class="codeph">STATE</code>列包含字符串<code class="codeph">WAITING</code> 。 <code class="codeph">V$SESSION_WAIT.SECONDS_IN_WAIT</code>列显示服务器等待此调用返回的秒数。从媒体管理器返回SBT功能后，该行消失。
                        </p>
                        <p><code class="codeph">V$SESSION_WAIT</code>与SBT事件名称对应的行不表示存在问题，因为服务器在运行时更新这些行。在进行调用并返回时，行会显示和消失。但是，如果<code class="codeph">SECONDS_IN_WAIT</code>高，则可能会暂停媒体管理器。
                        </p>
                        <p>要监视SBT事件，可以运行以下SQL查询：</p><pre class="oac_no_warn" dir="ltr">列事件格式a17列SECONDS_IN_WAIT格式999列状态格式a15列CLIENT_INFO格式a30选择p。SPID，s。事件，s。SECONDS_IN_WAIT作为SEC_WAIT，sw。状态。CLIENT_INFO来自V $ SESSION_WAIT sw，V $ SESSION s，V $ PROCESS p WHERE sw。事件就像'％MML％'和s。SID = SW。SID和s。PADDR = P。ADDR;</pre><p>检查SQL输出以确定正在等待的SBT功能。例如，以下输出表明RMAN一直在等待<code class="codeph">sbtbackup</code>函数返回10分钟：</p><pre class="oac_no_warn" dir="ltr">SPID EVENT SEC_WAIT STATE CLIENT_INFO ---- ----------------- ---------- -------------- -  ------------------------------ 8642备份：MML creat 600 WAITING rman channel = ORA_SBT_TAPE_1</pre><div class="infoboxnote" id="GUID-6B323AE8-1E76-45E6-8434-3DCC5CE2E873__GUID-163B8CB1-180E-484A-BE88-B3421F31A3E7">
                           <p class="notep1">注意：</p>
                           <p><code class="codeph">V$SESSION_WAIT</code>视图仅显示数据库事件，而不显示媒体管理器事件。
                           </p>
                        </div>
                        <div class="infoboxnotealso" id="GUID-6B323AE8-1E76-45E6-8434-3DCC5CE2E873__GUID-9D1639EC-F414-4E6E-8842-7D9C93C288B2">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../refrn/V-SESSION_WAIT.html#REFRN30229" target="_blank"><span><cite>Oracle Database Reference，</cite></span></a>用于描述<code class="codeph">V$SESSION_WAIT</code>视图。
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV89877"></a><div class="props_rev_3"><a id="GUID-A73F567C-1F2D-403B-BED9-90B78B4CA7CD" name="GUID-A73F567C-1F2D-403B-BED9-90B78B4CA7CD"></a><h4 id="BRADV-GUID-A73F567C-1F2D-403B-BED9-90B78B4CA7CD" class="sect4"><span class="enumeration_section">24.2.2将</span>服务器会话与RMAN通道关联</h4>
                  <div>
                     <p>要识别哪些服务器会话对应于哪些RMAN通道，您可以查询<code class="codeph">V$SESSION</code>和<code class="codeph">V$PROCESS</code> 。</p>
                     <p><code class="codeph">V$PROCESS</code>的<code class="codeph">SPID</code>列标识进程或线程的操作系统标识号。例如，在UNIX上， <code class="codeph">SPID</code>列显示进程ID，而在Windows上， <code class="codeph">SPID</code>列显示线程ID。您有两种获取此信息的基本方法，具体取决于您是否同时激活多个RMAN会话。
                     </p>
                     <p>本节包含以下主题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="troubleshooting-rman-operations.html#GUID-3324872D-0863-42B1-89A0-A576CDC8C3CA" title="当只有一个RMAN会话处于活动状态时，确定RMAN通道的服务器会话ID的最简单方法是查询目标数据库。">当一个RMAN会话处于活动状态时，将服务器会话与通道匹配</a></p>
                        </li>
                        <li>
                           <p><a href="troubleshooting-rman-operations.html#GUID-CD0BD414-F561-4518-A2B3-4CCD36B7EBB1" title="如果多个RMAN会话处于活动状态，则V $ SESSION.CLIENT_INFO列可以为每个会话中的通道生成相同的信息。">在多个RMAN会话中将服务器会话与通道匹配</a></p>
                        </li>
                     </ul>
                  </div><a id="BRADV89878"></a><div class="props_rev_3"><a id="GUID-3324872D-0863-42B1-89A0-A576CDC8C3CA" name="GUID-3324872D-0863-42B1-89A0-A576CDC8C3CA"></a><h5 id="BRADV-GUID-3324872D-0863-42B1-89A0-A576CDC8C3CA" class="sect5"><span class="enumeration_section">24.2.2.1</span>当一个RMAN会话<span class="enumeration_section">处于活动状态时，将</span>服务器会话与通道匹配</h5>
                     <div>
                        <p>当只有一个RMAN会话处于活动状态时，确定RMAN通道的服务器会话ID的最简单方法是查询目标数据库。</p>
                        <div class="section">
                           <p>在执行RMAN作业时，在目标数据库上运行以下查询：</p><pre class="oac_no_warn" dir="ltr">COLUMN CLIENT_INFO FORMAT a30 COLUMN SID FORMAT 999 COLUMN SPID FORMAT 9999 SELECT s。SID，p。SPID，s。CLIENT_INFO FROM V $ PROCESS p，V $ SESSION s WHERE p。ADDR = s。PADDR和CLIENT_INFO喜欢'rman％';</pre><p>以下显示了示例输出：</p><pre class="oac_no_warn" dir="ltr">SID SPID CLIENT_INFO ---- ------------ ------------------------------ 14 8374 rman channel = ORA_SBT_TAPE_1</pre><p>如果使用RMAN <code class="codeph">SET COMMAND ID</code>命令而不是使用系统生成的默认ID设置ID，则在<code class="codeph">CLIENT_INFO</code>列中搜索该值，而不是<code class="codeph">'rman%'</code> 。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="BRADV89879"></a><div class="props_rev_3"><a id="GUID-CD0BD414-F561-4518-A2B3-4CCD36B7EBB1" name="GUID-CD0BD414-F561-4518-A2B3-4CCD36B7EBB1"></a><h5 id="BRADV-GUID-CD0BD414-F561-4518-A2B3-4CCD36B7EBB1" class="sect5"><span class="enumeration_section">24.2.2.2</span>在多个RMAN会话中匹配具有通道的服务器会话</h5>
                     <div>
                        <p>如果多个RMAN会话处于活动状态，则<code class="codeph">V$SESSION.CLIENT_INFO</code>列可以为每个会话中的通道生成相同的信息。
                        </p>
                        <div class="section">
                           <p>例如：</p><pre class="oac_no_warn" dir="ltr">SID SPID CLIENT_INFO ---- ------------ ------------------------------ 14 8374 rman channel = ORA_SBT_TAPE_1 9 8642 rman channel = ORA_SBT_TAPE_1</pre><p>在这种情况下，您可以使用以下方法确定哪个通道对应于哪个<code class="codeph">SID</code>值。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div><a id="BRADV89880"></a><div class="props_rev_3"><a id="GUID-B4AD9177-6648-426C-9978-26BEAD00FBB6" name="GUID-B4AD9177-6648-426C-9978-26BEAD00FBB6"></a><h6 id="BRADV-GUID-B4AD9177-6648-426C-9978-26BEAD00FBB6" class="sect6"><span class="enumeration_section">24.2.2.2.1</span>从RMAN输出中获取通道ID</h6>
                        <div>
                           <p>您必须首先从RMAN输出中获取<code class="codeph">sid</code>值，然后在SQL查询中使用这些值。
                           </p>
                           <div class="section">
                              <p><span class="bold">在备份期间将进程与通道关联：</span></p>
                           </div>
                           <!-- class="section" -->
                           <ol>
                              <li class="stepexpand"><span>在活动会话中，像往常一样运行RMAN作业并检查输出以获取通道的SID。例如，输出可能显示：</span><div><pre class="oac_no_warn" dir="ltr"><code class="codeph">Starting backup at 21-AUG-13</code> <code class="codeph">allocated channel: ORA_SBT_TAPE_1</code> <code class="codeph">Starting backup at 21-AUG-13</code> <code class="codeph">channel ORA_SBT_TAPE_1: sid=14 devtype=SBT_TAPE</code>
</pre></div>
                              </li>
                              <li class="stepexpand"><span>启动SQL * Plus会话，然后在<span class="italic">执行RMAN作业时</span>查询已加入的<code class="codeph">V$SESSION</code>和<code class="codeph">V$PROCESS</code>视图。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">COLUMN CLIENT_INFO FORMAT a30 COLUMN SID FORMAT 999 COLUMN SPID FORMAT 9999 SELECT s。SID，p。SPID，s。CLIENT_INFO FROM V $ PROCESS p，V $ SESSION s WHERE p。ADDR = s。PADDR和CLIENT_INFO就像'rman％'/</pre><p>使用从第一步获得的<code class="codeph">sid</code>值来确定哪个通道对应于哪个服务器会话：</p><pre class="oac_no_warn" dir="ltr">SID SPID CLIENT_INFO ---------- ------------ ------------------------- ----- 14 2036 rman channel = ORA_SBT_TAPE_1 12 2066 rman channel = ORA_SBT_TAPE_1</pre></div>
                              </li>
                           </ol>
                        </div>
                     </div><a id="BRADV89881"></a><div class="props_rev_3"><a id="GUID-21C49BC3-2505-481F-83B9-5474948614DF" name="GUID-21C49BC3-2505-481F-83B9-5474948614DF"></a><h6 id="BRADV-GUID-21C49BC3-2505-481F-83B9-5474948614DF" class="sect6"><span class="enumeration_section">24.2.2.2.2</span>使用SET COMMAND ID将服务器会话与通道关联</h6>
                        <div>
                           <p>您在RMAN备份脚本中指定命令ID字符串。然后，您可以查询此字符串的<code class="codeph">V$SESSION.CLIENT_INFO</code> 。
                           </p>
                           <div class="section">
                              <p><span class="bold">在备份期间将进程与通道关联：</span></p>
                           </div>
                           <!-- class="section" -->
                           <ol>
                              <li class="stepexpand"><span>在每个会话中， <span class="italic">在</span>分配通道<span class="italic">后将</span> <code class="codeph">COMMAND</code> <code class="codeph">ID</code>设置为不同的值，然后备份所需的对象。例如，在会话1中输入以下内容：</span><div><pre class="oac_no_warn" dir="ltr">运行{ALLOCATE CHANNEL c1 TYPE磁盘;将命令ID设置为'sess1';备份数据库<code class="codeph">;</code> <code class="codeph">}</code>
</pre><p>在会话2中运行的作业中将命令ID设置为字符串，例如<code class="codeph">sess2</code> ：</p><pre class="oac_no_warn" dir="ltr">RUN {ALLOCATE CHANNEL c1 TYPE sbt;将命令ID设置为'sess2';备份数据库<code class="codeph">;</code> <code class="codeph">}</code>
</pre></div>
                              </li>
                              <li class="stepexpand"><span>启动SQL * Plus会话，然后在<span class="italic">执行RMAN作业时</span>查询已加入的<code class="codeph">V$SESSION</code>和<code class="codeph">V$PROCESS</code>视图。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">SELECT SID，SPID，CLIENT_INFO FROM V $ PROCESS p，V $ SESSION s WHERE p。ADDR = s。PADDR和CLIENT_INFO类似'％id = sess％';</pre><p>如果在RMAN作业中运行<code class="codeph">SET</code> <code class="codeph">COMMAND</code> <code class="codeph">ID</code>命令，则<code class="codeph">CLIENT_INFO</code>列将以以下格式显示：</p><pre class="oac_no_warn" dir="ltr">id = <span class="italic">command_id</span> ，rman channel = <span class="italic">channel_id</span>
</pre><p>例如，以下显示了示例输出：</p><pre class="oac_no_warn" dir="ltr">SID SPID CLIENT_INFO ---- ------------ ------------------------------ 11 8358 id = sess1 15 8638 id = sess2 14 8374 id = sess1，rman channel = c1 9 8642 id = sess2，rman channel = c1</pre><p>包含字符串<code class="codeph">rman channel</code>的行显示执行备份的通道。其余行用于连接目标数据库。
                                    </p>
                                 </div>
                              </li>
                           </ol>
                           <div class="section">
                              <div class="infoboxnotealso" id="GUID-21C49BC3-2505-481F-83B9-5474948614DF__GUID-80936436-48E3-41A5-AF39-C16A09EDC7BE">
                                 <p class="notep1">也可以看看：</p>
                                 <p>有关<code class="codeph">V$SESSION</code>和<code class="codeph">V$PROCESS</code>更多信息，请参阅<code class="codeph">SET COMMAND ID</code>语法和<a href="../refrn/V-SESSION.html#REFRN-GUID-28E2DC75-E157-4C0A-94AB-117C205789B9" target="_blank"><span><cite>Oracle数据库参考的</cite></span></a> <a href="../rcmrf/SET.html#RCMRF153" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                              </div>
                           </div>
                           <!-- class="section" -->
                        </div>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV175"></a><div class="props_rev_3"><a id="GUID-B1E9715D-BD07-4B80-8158-33981138E679" name="GUID-B1E9715D-BD07-4B80-8158-33981138E679"></a><h3 id="BRADV-GUID-B1E9715D-BD07-4B80-8158-33981138E679" class="sect3"><span class="enumeration_section">24.3</span>测试Media Management API</h3>
               <div>
                  <p>在某些平台上，Oracle提供了一个名为<code class="codeph">sbttest</code>的诊断工具。该实用程序通过充当Oracle数据库服务器并尝试与媒体管理器通信来执行对媒体管理软件的简单测试。
                  </p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="troubleshooting-rman-operations.html#GUID-0780A6E4-4E5A-44CE-B083-F952597E72A7" title="sbttest实用程序的默认位置取决于平台。">获取sbttest实用程序</a></p>
                     </li>
                     <li>
                        <p><a href="troubleshooting-rman-operations.html#GUID-E29B9686-2435-47D1-8619-5DA3B6232376" title="使用不带参数的sbttest命令列出此程序的各种参数。">获取sbttest实用程序的在线文档</a></p>
                     </li>
                     <li>
                        <p><a href="troubleshooting-rman-operations.html#GUID-9396687F-2BE5-4998-9DB1-BC5F8AB50ECC" title="使用sbttest对媒体管理器进行快速测试。">使用sbttest实用程序</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89882"></a><div class="props_rev_3"><a id="GUID-0780A6E4-4E5A-44CE-B083-F952597E72A7" name="GUID-0780A6E4-4E5A-44CE-B083-F952597E72A7"></a><h4 id="BRADV-GUID-0780A6E4-4E5A-44CE-B083-F952597E72A7" class="sect4"><span class="enumeration_section">24.3.1</span>获得的sbttest工具</h4>
                  <div>
                     <p><code class="codeph">sbttest</code>实用程序的默认位置取决于平台。
                     </p>
                     <div class="section">
                        <p>在UNIX上， <code class="codeph">sbttest</code>实用程序通常位于<code class="codeph">$ORACLE_HOME/bin</code> 。如果由于某种原因该实用程序未包含在您的平台中，请联系Oracle支持服务以获取该程序的C版本。您可以在所有UNIX平台上编译此版本的程序。
                        </p>
                        <p>在Solaris等平台上，使用<code class="codeph">sbttest</code>时不必重新链接。在其他平台上，可能需要重新连接。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV89883"></a><div class="props_rev_3"><a id="GUID-E29B9686-2435-47D1-8619-5DA3B6232376" name="GUID-E29B9686-2435-47D1-8619-5DA3B6232376"></a><h4 id="BRADV-GUID-E29B9686-2435-47D1-8619-5DA3B6232376" class="sect4"><span class="enumeration_section">24.3.2</span>获取sbttest实用程序的在线文档</h4>
                  <div>
                     <p>使用不带参数的<code class="codeph">sbttest</code>命令列出此程序的各种参数。
                     </p>
                     <div class="section">
                        <p>有关<code class="codeph">sbttest</code>在线文档， <code class="codeph">sbttest</code>在命令行上发出以下命令：</p><pre class="oac_no_warn" dir="ltr">％sbttest</pre><p>该程序显示该程序的可能参数列表：</p><pre class="oac_no_warn" dir="ltr">错误：必须指定备份文件名用法：sbttest backup_file_name＃这是唯一必需的参数&lt;-dbname database_name&gt; &lt;-trace trace_file_name&gt; &lt;-remove_before&gt; &lt;-no_remove_after&gt; &lt;-read_only&gt; &lt;-no_regular_backup_restore&gt; &lt;-no_proxy_backup&gt; &lt; -no_proxy_restore&gt; &lt;-file_type n&gt; &lt;-copy_number n&gt; &lt;-media_pool n&gt; &lt;-os_res_size n&gt; &lt;-pl_res_size n&gt; &lt;-block_size block_size&gt; &lt;-block_count block_count&gt; &lt;-proxy_file os_file_name bk_file_name [os_res_size pl_res_size block_size block_count]&gt; &lt;-libname sbt_library_name&gt;</pre><p>显示屏还指示每个参数的含义。例如，以下是两个可选参数的说明：</p><pre class="oac_no_warn" dir="ltr">可选参数：-dbname指定SBT用于标识备份文件的数据库名称。默认值为“sbtdb”-trace指定介质管理软件将写入诊断消息的文件的名称。</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV89884"></a><div class="props_rev_3"><a id="GUID-9396687F-2BE5-4998-9DB1-BC5F8AB50ECC" name="GUID-9396687F-2BE5-4998-9DB1-BC5F8AB50ECC"></a><h4 id="BRADV-GUID-9396687F-2BE5-4998-9DB1-BC5F8AB50ECC" class="sect4"><span class="enumeration_section">24.3.3</span>使用sbttest实用程序</h4>
                  <div>
                     <p>使用<code class="codeph">sbttest</code>对媒体管理器进行快速测试。
                     </p>
                     <div class="section">
                        <p>如果<code class="codeph">sbttest</code>返回0，则测试运行时没有错误，这意味着媒体管理器已正确安装并且可以接受数据流并在请求时返回相同的数据。如果<code class="codeph">sbttest</code>返回非零值，则表示未安装介质管理器或未正确配置。
                        </p>
                        <p><span class="bold">要使用sbttest：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>通过在命令行键入<code class="codeph">sbttest</code>确认程序已安装并包含在系统路径中：</span><div><pre class="oac_no_warn" dir="ltr">％sbttest</pre><p>如果程序可以运行，那么您会看到在线文档的显示。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>执行程序，指定在线文档中描述的任何参数。例如，输入以下内容以创建测试文件<code class="codeph">some_file.f</code>并将输出写入<code class="codeph">sbtio.log</code> ：</span><div><pre class="oac_no_warn" dir="ltr">％sbttest some_file.f -trace sbtio.log</pre><p>您还可以测试现有数据文件的备份。例如，此命令测试数据库<code class="codeph">prod</code>数据文件<code class="codeph">tbs_33.f</code> ：</p><pre class="oac_no_warn" dir="ltr">％sbttest tbs_33.f -dbname prod</pre></div>
                        </li>
                        <li class="stepexpand"><span>检查输出。如果程序遇到错误，则它会提供描述失败的消息。例如，如果数据库找不到库，您会看到：</span><div><pre class="oac_no_warn" dir="ltr">libobk.so无法加载。检查它是否已正确安装，并且LD_LIBRARY_PATH环境变量（或您的平台上的等效项）包含可以找到此文件的目录。以下是有关此错误原因的一些其他信息：ld.so.1：sbttest：致命：libobk.so：打开失败：没有此类文件或目录</pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <p>在某些情况下， <code class="codeph">sbttest</code>可以工作，但RMAN备份不能。原因可能如下：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>启动<code class="codeph">sbttest</code>的用户不是Oracle数据库进程的所有者。
                              </p>
                           </li>
                           <li>
                              <p>如果数据库服务器未与媒体管理库链接或无法在需要时动态加载它，则对媒体管理器的RMAN备份将失败，但<code class="codeph">sbttest</code>仍可能正常工作。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">sbttest</code>程序传递来自shell的所有环境参数，但RMAN没有。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV176"></a><div class="props_rev_3"><a id="GUID-772C8583-7763-48AB-B404-747188EC718A" name="GUID-772C8583-7763-48AB-B404-747188EC718A"></a><h3 id="BRADV-GUID-772C8583-7763-48AB-B404-747188EC718A" class="sect3"><span class="enumeration_section">24.4</span>终止RMAN命令</h3>
               <div>
                  <p>有几种方法可以在执行过程中终止RMAN命令。</p>
                  <div class="section">
                     <p>它们包括以下内容：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>首选方法是在RMAN界面中按Ctrl + C（或系统的等效“注意”组合键）。这也会终止分配的通道，除非它们被暂停在介质管理代码中，例如，当它们等待磁带安装时。</p>
                        </li>
                        <li>
                           <p>您可以通过运行SQL <code class="codeph">ALTER SYSTEM KILL SESSION</code>语句来结束与RMAN通道对应的服务器会话，如<a href="troubleshooting-rman-operations.html#GUID-73F87310-9DDF-4775-9049-658E0A06BADC" title="要使用ALTER SYSTEM语句终止RMAN会话，您需要RMAN通道的Oracle会话ID和序列号。此信息包含在消息的RMAN日志中。">使用ALTER SYSTEM KILL SESSION终止会话中</a>所述。</p>
                        </li>
                        <li>
                           <p>您可以终止操作系统上与RMAN通道对应的服务器会话，如在<a href="troubleshooting-rman-operations.html#GUID-4C499544-02C9-40AA-94DC-03261D7F2B3E" title="查找和终止与服务器会话关联的进程是特定于操作系统的。在某些平台上，服务器会话根本不与任何进程相关联。有关更多信息，请参阅特定于操作系统的文档。">操作系统级别终止会话中所述</a> 。
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="BRADV89885"></a><div class="props_rev_3"><a id="GUID-73F87310-9DDF-4775-9049-658E0A06BADC" name="GUID-73F87310-9DDF-4775-9049-658E0A06BADC"></a><h4 id="BRADV-GUID-73F87310-9DDF-4775-9049-658E0A06BADC" class="sect4"><span class="enumeration_section">24.4.1</span>使用ALTER SYSTEM KILL SESSION终止会话</h4>
                  <div>
                     <p>要使用ALTER SYSTEM语句终止RMAN会话，您需要RMAN通道的Oracle会话ID和序列号。此信息包含在消息的RMAN日志中。</p>
                     <div class="section">
                        <p>使用以下示例中显示的格式搜索消息：</p><pre class="oac_no_warn" dir="ltr">通道ch1：sid = 15 devtype = SBT_TAPE</pre><p>为每个分配的通道显示<code class="codeph">sid</code>和<code class="codeph">devtype</code> 。Oracle数据库<code class="codeph">sid</code>与操作系统进程ID不同。您可以使用SQL <code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">KILL</code> <code class="codeph">SESSION</code>语句结束会话。
                        </p>
                        <p><code class="codeph">ALTER SYSTEM KILL SESSION</code>有两个参数，即在RMAN消息中打印的<code class="codeph">sid</code>和一个序列号，这两个参数都可以通过查询<code class="codeph">V$SESSION</code> 。</p>
                        <p>例如，运行以下语句，其中<span class="italic"><code class="codeph">sid_in_rman_output</code></span>是RMAN消息中的数字：</p><pre class="oac_no_warn" dir="ltr">SELECT SERIAL＃FROM V $ SESSION WHERE SID = <span class="italic"><code class="codeph">sid_in_rman_output</code></span> ;</pre><p>然后，运行以下语句，替换从查询中获取的<span class="italic"><code class="codeph">sid_in_rman_output</code></span>和序列号：</p><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM KILL <span class="italic"><code class="codeph">sid_in_rman_output</code></span> <span class="italic">，</span> <span class="italic"><code class="codeph">serial#</code></span> ';</pre><p>如果会话在媒体管理器代码中停止，则此语句对会话没有影响。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV89886"></a><div class="props_rev_3"><a id="GUID-4C499544-02C9-40AA-94DC-03261D7F2B3E" name="GUID-4C499544-02C9-40AA-94DC-03261D7F2B3E"></a><h4 id="BRADV-GUID-4C499544-02C9-40AA-94DC-03261D7F2B3E" class="sect4"><span class="enumeration_section">24.4.2</span>在操作系统级别终止会话</h4>
                  <div>
                     <p>查找和终止与服务器会话关联的进程是特定于操作系统的。在某些平台上，服务器会话根本不与任何进程相关联。有关更多信息，请参阅特定于操作系统的文档。</p>
                  </div>
               </div><a id="BRADV89887"></a><div class="props_rev_3"><a id="GUID-60B8AE45-4484-4926-811F-BBCA23CB19D2" name="GUID-60B8AE45-4484-4926-811F-BBCA23CB19D2"></a><h4 id="BRADV-GUID-60B8AE45-4484-4926-811F-BBCA23CB19D2" class="sect4"><span class="enumeration_section">24.4.3</span>终止在媒体管理器中没有响应的RMAN会话</h4>
                  <div>
                     <p>您有时可能需要终止在媒体管理器中没有响应的RMAN作业。当媒体管理器中的通道连接没有响应时，终止RMAN的最佳方法是终止媒体管理器中的会话。</p>
                     <p>如果此操作无法解决问题，那么在某些平台（如Linux）上，您可以终止连接的Oracle数据库进程。（终止Oracle进程可能会导致媒体管理器出现问题。有关详细信息，请参阅媒体经理文档。）</p>
                     <div class="p">本节包含以下主题：<ul style="list-style-type:disc">
                           <li>
                              <p><a href="troubleshooting-rman-operations.html#GUID-56D3592A-B975-4DAE-A02C-6E6693C3D471" title="RMAN会话的性质取决于操作系统。">RMAN会话的组件</a></p>
                           </li>
                           <li>
                              <p><a href="troubleshooting-rman-operations.html#GUID-4C2B84BF-D7FA-4137-B31C-8D02E5100405" title="RMAN通常会停止响应，因为通道连接正在磁带资源的介质管理器代码中等待。目录连接和默认通道似乎挂起，因为它们正在等待RMAN告诉它们要做什么。在RMAN进程的控制下轮询RPC时，轮询连接似乎处于无限循环中。">暂停作业期间的过程行为</a></p>
                           </li>
                           <li><a href="troubleshooting-rman-operations.html#GUID-8DE355DD-8001-482D-8453-AEF64BA72F3B" title="在终止媒体管理器代码中的无响应信道之后，RMAN进程检测到该终止并退出，移除除了仍在媒体管理层中操作的目标连接之外的所有连接。">终止RMAN会话：基本步骤</a></li>
                        </ul>
                     </div>
                  </div><a id="BRADV89888"></a><div class="props_rev_3"><a id="GUID-56D3592A-B975-4DAE-A02C-6E6693C3D471" name="GUID-56D3592A-B975-4DAE-A02C-6E6693C3D471"></a><h5 id="BRADV-GUID-56D3592A-B975-4DAE-A02C-6E6693C3D471" class="sect5"><span class="enumeration_section">24.4.3.1</span> RMAN会话的组件</h5>
                     <div>
                        <p>RMAN会话的性质取决于操作系统。</p>
                        <p>在UNIX中，RMAN会话具有以下与之关联的进程：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="italic">RMAN客户端进程</span>本身</p>
                           </li>
                           <li>
                              <p><span class="italic">默认通道</span> ，即与目标数据库的初始连接</p>
                           </li>
                           <li>
                              <p>与每个分配的通道对应的目标数据库的一个<span class="italic">目标连接</span></p>
                           </li>
                           <li>
                              <p>如果使用恢复目录，则与恢复目录数据库的<span class="italic">目录连接</span></p>
                           </li>
                           <li>
                              <p>在<code class="codeph">DUPLICATE</code>或TSPITR操作期间到辅助实例的<span class="italic">辅助连接</span></p>
                           </li>
                           <li>
                              <p>与目标数据库的<span class="italic">轮询连接</span> ，用于监视各种分配通道上的RMAN命令执行。默认情况下，RMAN进行一次轮询连接。如果在<code class="codeph">ALLOCATE CHANNEL</code>或<code class="codeph">CONFIGURE CHANNEL</code>命令中使用不同的连接字符串，RMAN将进行其他轮询连接。对于<code class="codeph">ALLOCATE CHANNEL</code>或<code class="codeph">CONFIGURE CHANNEL</code>命令中使用的每个不同连接字符串，存在一个轮询连接。
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="BRADV89889"></a><div class="props_rev_3"><a id="GUID-4C2B84BF-D7FA-4137-B31C-8D02E5100405" name="GUID-4C2B84BF-D7FA-4137-B31C-8D02E5100405"></a><h5 id="BRADV-GUID-4C2B84BF-D7FA-4137-B31C-8D02E5100405" class="sect5"><span class="enumeration_section">24.4.3.2</span>暂停作业期间的过程行为</h5>
                     <div>
                        <p>RMAN通常会停止响应，因为通道连接正在磁带资源的介质管理器代码中等待。目录连接和默认通道似乎挂起，因为它们正在等待RMAN告诉它们要做什么。在RMAN进程的控制下轮询RPC时，轮询连接似乎处于无限循环中。</p>
                        <p>如果您自己终止RMAN进程，则还终止目录连接，辅助连接，默认通道和轮询连接。如果目标和辅助连接被挂起但在执行媒体管理器代码时没有，它们也会终止。如果目标连接或任何辅助连接正在介质管理层中执行，则它们不会终止，直到在操作系统级别手动终止进程。</p>
                        <p>并非所有媒体经理都能检测到Oracle数据库进程的终止。那些不能保持资源忙或继续处理的人。有关详细信息，请参阅媒体经理文档</p>
                        <p>终止目录连接不会导致RMAN进程终止，因为RMAN在备份或还原过程中未执行目录操作。删除默认通道和轮询连接会导致RMAN进程检测到通道不再存在然后退出。在这种情况下，如前所述，与无响应信道的连接保持活动状态。</p>
                     </div>
                  </div><a id="BRADV89890"></a><div class="props_rev_3"><a id="GUID-8DE355DD-8001-482D-8453-AEF64BA72F3B" name="GUID-8DE355DD-8001-482D-8453-AEF64BA72F3B"></a><h5 id="BRADV-GUID-8DE355DD-8001-482D-8453-AEF64BA72F3B" class="sect5"><span class="enumeration_section">24.4.3.3</span>终止RMAN会话：基本步骤</h5>
                     <div>
                        <p>在终止媒体管理器代码中的无响应信道之后，RMAN进程检测到该终止并退出，移除除了仍在媒体管理层中操作的目标连接之外的所有连接。</p>
                        <div class="section">
                           <p>在这种情况下，有关媒体管理器资源的警告仍然适用。</p>
                           <p><span class="bold">要终止在媒体管理器中没有响应的Oracle数据库进程：</span></p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>查询<code class="codeph">V$SESSION</code>和<code class="codeph">V$SESSION_WAIT</code> ，如<span class="q">“ <a href="troubleshooting-rman-operations.html#GUID-AD353573-E722-4D76-9361-9C0CA4C29FEB" title="当LIST，REPORT和SHOW不提供RMAN操作所需的所有信息时，某些V $视图可以提供有用的详细信息。">使用V $视图进行RMAN故障排除</a> ”中所述</span> 。例如，执行以下查询：</span><div><pre class="oac_no_warn" dir="ltr">列事件格式a17列SECONDS_IN_WAIT格式999列状态格式a10列CLIENT_INFO格式a30选择p。SPID，s。事件，s。SECONDS_IN_WAIT作为SEC_WAIT，sw。状态。CLIENT_INFO来自V $ SESSION_WAIT sw，V $ SESSION s，V $ PROCESS p WHERE sw。事件就像'％MML％'和s。SID = SW。SID和s。PADDR = P。ADDR;</pre><p>检查SQL输出以确定正在等待的SBT功能。例如，输出可能如下：</p><pre class="oac_no_warn" dir="ltr">SPID EVENT SEC_WAIT STATE CLIENT_INFO ---- ----------------- ---------- ---------- ---- ------------------------- 8642备份：MML写600等待rman通道= ORA_SBT_TAPE_1 8374备份：MML写600等待rman通道= ORA_SBT_TAPE_2</pre></div>
                           </li>
                           <li class="stepexpand"><span>使用适合您平台的操作系统级工具，结束无响应的会话。例如，在Linux上执行<code class="codeph">kill</code> <code class="codeph">-9</code>命令：</span><div><pre class="oac_no_warn" dir="ltr">％kill -9 8642 8374</pre><p>某些平台包含一个名为<code class="codeph">orakill</code>的命令行实用程序，可以使您终止特定的线程。在命令提示符下，运行以下命令，其中<span class="italic"><code class="codeph">sid</code></span>标识要定位的数据库实例， <span class="italic"><code class="codeph">thread_id</code></span>是步骤1中查询的<code class="codeph">SPID</code>值：</p><pre class="oac_no_warn" dir="ltr">orakill <span class="italic">sid</span> <span class="italic">thread_id</span>
</pre></div>
                           </li>
                           <li class="stepexpand"><span>检查媒体管理器是否也清除其进程。如果仍有，则由于备份或还原操作中的先前问题，下一次备份或还原操作可能会再次冻结。在某些媒体管理器中，唯一的解决方案是关闭并重新启动媒体管理器。如果媒体管理器提供的文档未提供所需信息，请联系媒体经理的技术支持。</span><div>
                                 <div class="infoboxnotealso" id="GUID-8DE355DD-8001-482D-8453-AEF64BA72F3B__GUID-779D91FE-19C1-4007-9A50-04351F833C75">
                                    <p class="notep1">也可以看看：</p>
                                    <p>相关命令的操作系统特定文档</p>
                                 </div>
                              </div>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>