<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content>
      <meta name="description" content>
      <title>Introduction to Nashorn JavaScript Engine</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Java Developer's Guide ">
      <meta property="og:description" content>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Java Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="java-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-11T00:55:24-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="1999, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96468-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="setting-system-properties.html" title="Previous" type="text/html">
      <link rel="next" href="developing-Java-stored-procedures.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Java Developer's Guide">
    <meta name="dcterms.isVersionOf" content="JJDEV">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="setting-system-properties.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="developing-Java-stored-procedures.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Java Developer's Guide </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Introduction to Nashorn JavaScript Engine</li>
            </ol>
            <a id="GUID-9D7B5AF2-5F63-4484-968D-01EFB6A2D50F" name="GUID-9D7B5AF2-5F63-4484-968D-01EFB6A2D50F"></a>
            
            <h2 id="JJDEV-GUID-9D7B5AF2-5F63-4484-968D-01EFB6A2D50F" class="sect2"><span class="enumeration_chapter">5 </span>Introduction to Nashorn JavaScript Engine
            </h2>
         </header>
         <div class="ind">
            <div>
               <p></p>
               <p>Nashorn JavaScript engine enables running JavaScript directly in the database. The ability to reuse existing client-side JavaScript in the database, and then combining it with the Java SE libraries, enables the design of rich, powerful, and versatile data-bound applications that can run directly in RDBMS sessions. This section describes the Nashorn JavaScript Engine in the following sections:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="intro-to-nashorn.html#GUID-B2C0D602-3095-4EC9-9824-1DBF2F423786">About Using Nashorn JavaScript Engine</a></p>
                  </li>
                  <li>
                     <p><a href="intro-to-nashorn.html#GUID-E211FED9-B5C0-4A85-B392-2FA6106B8334">JavaScript Data Access using JDBC</a></p>
                  </li>
                  <li>
                     <p><a href="intro-to-nashorn.html#GUID-66EEBA84-8FD1-4F1A-BE4A-80A340B975B2">REST Enable Your JavaScript Application</a></p>
                  </li>
               </ul>
            </div>
            <div class="sect2"><a id="GUID-B2C0D602-3095-4EC9-9824-1DBF2F423786" name="GUID-B2C0D602-3095-4EC9-9824-1DBF2F423786"></a><h3 id="JJDEV-GUID-B2C0D602-3095-4EC9-9824-1DBF2F423786" class="sect3"><span class="enumeration_section">5.1 </span>About Using Nashorn JavaScript Engine
               </h3>
               <div>
                  <p></p>
                  <p>One of the important features of Java 8 is the Nashorn JavaScript engine. Starting from Oracle Database 12<span class="italic">c</span> Release 2 (12.2.0.1), Oracle JVM supports Java 8, so you can execute JavaScript in the database using the Nashorn JavaScript engine, built into Oracle JVM running Java 8 codebase. Executing JavaScript directly in the database provides the following benefits:
                  </p>
                  <div class="infoboxnotealso" id="GUID-B2C0D602-3095-4EC9-9824-1DBF2F423786__GUID-6D874E5D-F3E4-4A20-A664-4C7E59D8F006">
                     <p class="notep1">See Also:</p>
                     <p><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/scripting/nashorn/api.html" target="_blank">https://docs.oracle.com/javase/8/docs/technotes/guides/scripting/nashorn/api.html</a></p>
                  </div>
                  <div class="section">
                     <p class="subhead2" id="GUID-B2C0D602-3095-4EC9-9824-1DBF2F423786__GUID-65047517-E89B-4713-A7AE-5AB8AB855CA4">Benefits of Running JavaScript in Oracle Database</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Reusing existing skills and code.</p>
                        </li>
                        <li>
                           <p>Avoiding shipping data residing in Oracle Database. Executing JavaScript in the database enables in-place and faster processing of JSON documents inside the database. This enables avoiding shipping data to external infrastructure and improving performance as network overhead is avoided.</p>
                        </li>
                        <li>
                           <p>Achieving new database capabilities.</p>
                        </li>
                     </ul>
                     <p>For running JavaScript code, using the Nashorn engine of 12.2 Oracle JVM in your sessions, your schema must be granted the DBJAVASCRIPT role. This role includes the permissions that are required to run Nashorn in the database. The role can be granted by your DBA and must be done only once per user.</p>
                     <p>The preferred way to maintain JavaScript sources in Oracle Database is to load them into your schema as Java resources and then run the scripts within the database.</p>
                     <div class="infoboxnote" id="GUID-B2C0D602-3095-4EC9-9824-1DBF2F423786__GUID-7D883726-E058-4F20-9D30-78398DDD76CE">
                        <p class="notep1">Note:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>The direct invocation of Nashorn classes is restricted in Oracle JVM.</p>
                           </li>
                           <li>
                              <p>All scripting mode extensions are disabled in Oracle JVM.</p>
                           </li>
                           <li>
                              <p>You can run scripts either from strings or from file streams, using standard scripting APIs, but Oracle does not recommend it. Scripts invoked in this way can run only in sandboxed mode, with the default permissions.</p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
               <div class="sect3"><a id="GUID-73B9B983-0ACB-40C7-809B-580540B3DE35" name="GUID-73B9B983-0ACB-40C7-809B-580540B3DE35"></a><h4 id="JJDEV-GUID-73B9B983-0ACB-40C7-809B-580540B3DE35" class="sect4"><span class="enumeration_section">5.1.1 </span>Loading JavaScript Code into a Schema
                  </h4>
                  <div>
                     <p></p>
                     <div class="example" id="GUID-73B9B983-0ACB-40C7-809B-580540B3DE35__GUID-4E02E4DE-E435-4A61-971C-435D4141EED6">
                        <p>Use the <code class="codeph">loadjava</code> command to load your JavaScript code into your database schema. Scripts are loaded as Java resources. For example, suppose you have a JavaScript file <code class="codeph">hello.js</code> as follows:
                        </p><pre class="pre codeblock"><code>function hello()
{
/*
*This is a sample Javascript file that prints "Hello World".
*/
var hellow = "Hello World";
return hellow;
}

var output = hello();
print(output);
</code></pre><p>Use the following command to load the <code class="codeph">hello.js</code> script file into a schema named <code class="codeph">yourschema</code>:
                        </p><pre class="pre codeblock"><code>loadjava -v -u yourschema hello.js</code></pre><p>The <code class="codeph">loadjava</code> command prompts you for a password and then creates a schema-local resource <code class="codeph">hello.js</code> with the following output:
                        </p><pre class="pre codeblock"><code>arguments: '-u' 'yourschema/***' '-v' 'hello.js'
creating : resource hello.js
loading  : resource hello.js
Classes Loaded: 0
Resources Loaded: 1
Sources Loaded: 0
Published Interfaces: 0
Classes generated: 0
Classes skipped: 0
Synonyms Created: 0
Errors: 0</code></pre><p>You can also use the following command to verify whether you have successfully loaded the <code class="codeph">hello.js</code> file into the database or not:
                        </p><pre class="pre codeblock"><code>select object_name, object_type from user_objects;</code></pre><p>This resource can then be passed to the Nashorn engine using the ways mentioned in the following sections:</p>
                     </div>
                     <!-- class="example" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-418BCA95-6A94-40FF-A876-DE4A66FA2576" name="GUID-418BCA95-6A94-40FF-A876-DE4A66FA2576"></a><h4 id="JJDEV-GUID-418BCA95-6A94-40FF-A876-DE4A66FA2576" class="sect4"><span class="enumeration_section">5.1.2 </span>How to run JavaScript in Oracle JVM
                  </h4>
                  <div>
                     <p></p>
                     <p>After loading the scripts in the database, you can run them in the following three ways:</p>
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="intro-to-nashorn.html#GUID-474B59E3-8066-489D-A636-6F1E98FF81B4">Using the DBMS_JAVASCRIPT.RUN PL/SQL Procedure</a></p>
                           </li>
                           <li>
                              <p><a href="intro-to-nashorn.html#GUID-736C4BDB-DE57-4283-9377-B9C3FCDC7143">Using the DbmsJavaScript Java Class</a></p>
                           </li>
                           <li>
                              <p><a href="intro-to-nashorn.html#GUID-8CA560E8-C77D-480B-8D0F-7CABBC931AB1">Using the Standard javax.script Java Package</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div class="sect4"><a id="GUID-474B59E3-8066-489D-A636-6F1E98FF81B4" name="GUID-474B59E3-8066-489D-A636-6F1E98FF81B4"></a><h5 id="JJDEV-GUID-474B59E3-8066-489D-A636-6F1E98FF81B4" class="sect5"><span class="enumeration_section">5.1.2.1 </span>Using the DBMS_JAVASCRIPT.RUN PL/SQL Procedure
                     </h5>
                     <div>
                        <p></p>
                        <div class="example" id="GUID-474B59E3-8066-489D-A636-6F1E98FF81B4__GUID-37ED6AA7-FA2D-4AFC-AF73-A090AFBFB968">
                           <p>This approach is useful for JavaScript procedures that do not return any value. Invoke the <code class="codeph">DBMS_JAVASCRIPT.RUN</code> procedure for providing the resource name as the argument. Make sure that your schema is granted the <code class="codeph">DBJAVASCRIPT</code> role. The <code class="codeph">DBMS_JAVASCRIPT.RUN</code> procedure is a wrapper for the <code class="codeph">oracle.aurora.rdbms.DbmsJavaScript.run</code> Java method, which invokes Nashorn functionality internally.
                           </p>
                           <p><span class="bold">From SQL</span></p><pre class="pre codeblock"><code>call dbms_javascript.run('hello.js');</code></pre><p>If your JavaScript code returns an output value, then you must use the following instructions to display the value on the standard output device:</p><pre class="pre codeblock"><code>SQL&gt;set serveroutput on
SQL&gt;call dbms_java.set_output(20000);
SQL&gt;call dbms_javascript.run("hello.js");
</code></pre><p><span class="bold">From PL/SQL:</span></p><pre class="pre codeblock"><code>dbms_javascript.run('hello.js');</code></pre><p>If your JavaScript code returns an output value, then you must use the following instructions to display the value on the standard output device:</p><pre class="pre codeblock"><code>SQL&gt;set serveroutput on
SQL&gt;call dbms_java.set_output(20000);
SQL&gt;call dbms_javascript.run("hello.js");
</code></pre></div>
                        <!-- class="example" -->
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-736C4BDB-DE57-4283-9377-B9C3FCDC7143" name="GUID-736C4BDB-DE57-4283-9377-B9C3FCDC7143"></a><h5 id="JJDEV-GUID-736C4BDB-DE57-4283-9377-B9C3FCDC7143" class="sect5"><span class="enumeration_section">5.1.2.2 </span>Using the DbmsJavaScript Java Class
                     </h5>
                     <div>
                        <p></p>
                        <div class="example" id="GUID-736C4BDB-DE57-4283-9377-B9C3FCDC7143__GUID-37376D9A-D88E-424A-BC4C-BF8C10B170FE">
                           <p>This is the preferred way to invoke the scripts from Java code in Oracle JVM because it enables you to apply the schema permissions to the JavaScript code. Invoke the JavaScript that you loaded as resource <code class="codeph">hello.js</code> from your Java code running in the database. Invoke the method run of <code class="codeph">oracle.aurora.rdbms.DbmsJavaScript</code> class, passing in the resource name as the argument, as shown in the following code snippet:
                           </p>
                           <div class="infoboxnote" id="GUID-736C4BDB-DE57-4283-9377-B9C3FCDC7143__GUID-2C49DEBA-45BD-447E-B7C1-5FC5E8F19064">
                              <p class="notep1">Note:</p>
                              <p>Make sure that your schema is granted the <code class="codeph">DBJAVASCRIPT</code> role.
                              </p>
                           </div><pre class="pre codeblock"><code>import oracle.aurora.rdbms.DbmsJavaScript; 
â€¦
DbmsJavaScript.run("hello.js");</code></pre></div>
                        <!-- class="example" -->
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-8CA560E8-C77D-480B-8D0F-7CABBC931AB1" name="GUID-8CA560E8-C77D-480B-8D0F-7CABBC931AB1"></a><h5 id="JJDEV-GUID-8CA560E8-C77D-480B-8D0F-7CABBC931AB1" class="sect5"><span class="enumeration_section">5.1.2.3 </span>Using the Standard javax.script Java Package
                     </h5>
                     <div>
                        <p></p>
                        <div class="example" id="GUID-8CA560E8-C77D-480B-8D0F-7CABBC931AB1__GUID-75BD5768-FEB4-4784-BF81-A55FD51F95FD">
                           <p>This approach is useful for JavaScript functions that return values. Typically, you perform the following tasks:</p>
                           <div class="infoboxnote" id="GUID-8CA560E8-C77D-480B-8D0F-7CABBC931AB1__GUID-90B8D8C7-A6CE-433A-9E33-480FF888D771">
                              <p class="notep1">Note:</p>
                              <p>You must make sure that your schema is granted the <code class="codeph">DBJAVASCRIPT</code> role.
                              </p>
                           </div>
                           <ol>
                              <li>
                                 <p>Load the JavaScript in the database as a Java resource, using the <code class="codeph">loadjava</code> command.
                                 </p>
                              </li>
                              <li>
                                 <p>Use the <code class="codeph">javax.script</code> package to run the JavaScript.
                                 </p>
                              </li>
                              <li>
                                 <p>Instantiate a script manager</p>
                              </li>
                              <li>
                                 <p>Create an engine</p>
                              </li>
                              <li>
                                 <p>Pass your resource stream reader as the argument to the <code class="codeph">eval</code> method of the engine
                                 </p>
                              </li>
                           </ol>
                           <p>The following code snippet shows how to use the <code class="codeph">javax.script</code> package to run code from resource <code class="codeph">hello.js</code>:
                           </p><pre class="pre codeblock"><code>import javax.script.*;
import java.net.*;
import java.io.*;
...

// create a script engine manager
ScriptEngineManager factory = new ScriptEngineManager();
// create a JavaScript engine
ScriptEngine engine =
    factory.getEngineByName("javascript");
// create schema resource URL
URL url = Thread.currentThread()
    .getContextClassLoader().getResource("hello.js");
engine.eval(new InputStreamReader(url.openStream()));
...
</code></pre><p>You can also read the JavaScript code from a String. The following code snippet shows how to read and evaluate JavaScript code from a String:</p><pre class="pre codeblock"><code>// evaluate JavaScript code from String
engine.eval(new StringReader(<span class="italic">&lt;script&gt;</span>));</code></pre><p>Otherwise, you can also read the JavaScript code from a file. However, this involves extra privileges. The following code snippet shows how to read and evaluate JavaScript code from the <code class="codeph">script_name</code> file:
                           </p><pre class="pre codeblock"><code>import javax.script.*;
...
ScriptEngine engine = new ScriptEngineManager()
    .getEngineByName("JavaScript");
engine.eval(new FileReader("script_name"));</code></pre><p>After evaluating the JacaScript code, you typically perform the following tasks for invoking JavaScript functions:</p>
                           <ol>
                              <li>
                                 <p>Cast the Nashorn engine to <code class="codeph">Invocable</code> and use <code class="codeph">invokeFunction</code>.
                                 </p>
                                 <p>For example, if the <code class="codeph">hello.js</code> script defines a JavaScript function named <code class="codeph">hello</code>, then you can perform these tasks as shown in the following code snippet: 
                                 </p><pre class="pre codeblock"><code>// create a JavaScript engine as above
Invocable invocable = (Invocable) engine;
Object myResult = invocable.invokeFunction("hello");
...</code></pre><div class="infoboxnote" id="GUID-8CA560E8-C77D-480B-8D0F-7CABBC931AB1__GUID-E701ED6C-DC10-4FB8-BF27-8CEA11CE798F">
                                    <p class="notep1">Note:</p>
                                    <p>An alternative way to use the <code class="codeph">invocable.invokeFunction</code> is to pass the return value to a Java method invoked from inside of a script. This alternative way is preferable as it requires less boilerplate code and is compatible with the <code class="codeph">DBMSJAVASCRIPT.RUN</code> procedure.
                                    </p>
                                    <p>For example, suppose your JavaScript resource <code class="codeph">hello.js</code> defines the <code class="codeph">selectQuery</code> function, and you want to pass the result to the <code class="codeph">print()</code> Java method, which is defined in your class <code class="codeph">QueryTest</code> as follows:
                                    </p><pre class="pre codeblock"><code>&nbsp;&nbsp; public static void print (String results) { 
&nbsp;&nbsp; System.out.println("my results: \n" + results);
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</code></pre><p>Then, to achieve this from JavaScript, add the following lines to the <code class="codeph">hello.js</code> file:
                                    </p><pre class="pre codeblock"><code>   var queryTest = Java.type("QueryTest");
   queryTest.print(selectQuery("all")); </code></pre><p>Now, invoke <code class="codeph">hellp.js</code> in one of the following ways:
                                    </p><pre class="pre codeblock"><code>DbmsJavaScript.run("hello.js");

DBMS_JAVASCRIPT.RUN('hello.js');</code></pre></div>
                              </li>
                              <li>
                                 <p>Create a PL/SQL procedure for invoking the JavaScript application, as shown in the following example:</p><pre class="pre codeblock"><code>-- Create a procedure for select
CREATE OR REPLACE PROCEDURE selectproc(id IN varchar2)
IS
 output varchar2(10000);
BEGIN
 SELECT invokeScriptEval(id) INTO output from dual;
 htp.prn(output);
END;
/
SHOW ERRORS;</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-E211FED9-B5C0-4A85-B392-2FA6106B8334" name="GUID-E211FED9-B5C0-4A85-B392-2FA6106B8334"></a><h3 id="JJDEV-GUID-E211FED9-B5C0-4A85-B392-2FA6106B8334" class="sect3"><span class="enumeration_section">5.2 </span>JavaScript Data Access using JDBC
               </h3>
               <div>
                  <p></p>
                  <div class="section">This section describes how to access data in RDBMS using JavaScript. Currently, there is no JavaScript standard for accessing data in RDBMS. The Nashorn JavaScript engine enables using standard JDBC within JavaScript.</div>
                  <!-- class="section" -->
                  <div class="p">Perform the following steps to publish your application using JDBC with JavaScript as a service:</div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>Create a table in the database and populate it using JSON, as shown in the following example:</span><div><pre class="pre codeblock"><code>DROP TABLE employees PURGE;

CREATE TABLE employees (
  id    RAW(16) NOT NULL,
  data  CLOB,
  CONSTRAINT employees_pk PRIMARY KEY (id),
  CONSTRAINT employees_json_chk CHECK (data IS JSON)
);

TRUNCATE TABLE employees;

INSERT INTO employees (id, data)
VALUES (SYS_GUID(),
        '{
          "EmpId"     : "100",
          "FirstName" : "Kuassi",
          "LastName"  : "Mensah",
          "Job"       : "Manager",
          "Email"     : "kuassi@oracle.com",
          "Address"   : {
                          "City" : "Redwood",
                          "Country" : "US"
                        }
         }');

INSERT INTO employees (id, data)
VALUES (SYS_GUID(),
        '{
          "EmpId"     : "200",
          "FirstName" : "Nancy",
          "LastName"  : "Greenberg",
          "Job"       : "Manager",
          "Email"     : "Nancy@oracle.com",
          "Address"   : {
                          "City" : "Boston",
                          "Country" : "US"
                        }
         }');
INSERT INTO employees (id, data)
VALUES (SYS_GUID(),
        '{
          "EmpId"     : "300",
          "FirstName" : "Suresh",
          "LastName"  : "Mohan",
          "Job"       : "Developer",
          "Email"     : "Suresh@oracle.com",
          "Address"   : {
                          "City" : "Bangalore",
                          "Country" : "India"
                        }
         }');

INSERT INTO employees (id, data)
VALUES (SYS_GUID(),
        '{
          "EmpId"     : "400",
          "FirstName" : "Nirmala",
          "LastName"  : "Sundarappa",
          "Job"       : "Manager",
          "Email"     : "Nirmala@oracle.com",
          "Address"   : {
                          "City" : "Redwood",
                          "Country" : "US"
                        }
         }');

INSERT INTO employees (id, data)
VALUES (SYS_GUID(),
        '{
          "EmpId"     : "500",
          "FirstName" : "Amarnath",
          "LastName"  : "Chandana",
          "Job"       : "Test Devloper",
          "Email"     : "amarnath@oracle.com",
          "Address"   : {
                         "City" : "Bangalore", 
                         "Country" : "India"
                        }
         }');</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>Write a JavaScript application using JDBC, as shown in the following example and load the JavaScript code into a schema:</span><div><pre class="pre codeblock"><code>var selectQuery = function(id)
{
   var Driver = Packages.oracle.jdbc.OracleDriver;
   var oracleDriver = new Driver();
   var url = "jdbc:default:connection:";
   var output = "";
   var connection = oracleDriver.defaultConnection();
   var prepStmt;

   // Prepare statement
    if(id == 'all') {
       prepStmt = connection.prepareStatement("SELECT a.data FROM employees a");
      } else {
       prepStmt = connection.prepareStatement("SELECT a.data FROM employees a WHERE a.data.EmpId = ?");
       prepStmt.setInt(1, id);
       }

   // execute Query
    var resultSet = prepStmt.executeQuery();

   // display results
    while(resultSet.next()) {
        output = output + resultSet.getString(1) + "&lt;br&gt;";
    }

   // cleanup
    resultSet.close();
    prepStmt.close();
    connection.close();
    return output;
}</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>Create a Java resource, as shown in the following example:</span><div><pre class="pre codeblock"><code>create or replace and compile java source named "InvokeScript" as
import javax.script.*;
import java.net.*;
import java.io.*;

public class InvokeScript {
    public static String eval(String inputId) throws Exception {
	String output = new String();
    try {
        // create a script engine manager
        ScriptEngineManager factory = new ScriptEngineManager();

        // create a JavaScript engine
        ScriptEngine engine = factory.getEngineByName("javascript");

        //read the script as a java resource
				engine.eval(new InputStreamReader(InvokeScript.class.getResourceAsStream("select.js")));
				// Alternative approach
				//engine.eval(Thread.currentThread().getContextClassLoader().getResource("select.js"));


        Invocable invocable = (Invocable) engine;
        Object selectResult = invocable.invokeFunction("selectQuery", inputId);
        output = selectResult.toString();
    } catch(Exception e) {
		output =e.getMessage();
	}
        return output;
    }
}
/</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>Create a wrapper for the <code class="codeph">eval</code> method of the engine, as shown in the following example: </span><div><pre class="pre codeblock"><code>-- Create function
CREATE OR REPLACE FUNCTION invokeScriptEval(inputId varchar2) return varchar2 as language java 
name 'InvokeScript.eval(java.lang.String) return java.lang.String';
/</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>Invoke the <code class="codeph">invokeScriptEval</code> JavaScript function from SQL, as shown in the following example:</span><div><pre class="pre codeblock"><code>CREATE OR REPLACE PROCEDURE sqldemo(id IN varchar2)
IS
 output varchar2(10000);
BEGIN
 SELECT invokeScriptEval(id) INTO output from dual;
 dbms_output.put_line(output);
END;
/
SHOW ERRORS;</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>Invoke the <code class="codeph">sqldemo</code> procedure from SQL, as shown in the following example:</span><div><pre class="pre codeblock"><code>SQL&gt; set serveroutput on
SQL&gt; call dbms_java.set_output(5000);
SQL&gt; call sqldemo('100');</code></pre></div>
                     </li>
                  </ol>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="intro-to-nashorn.html#GUID-66EEBA84-8FD1-4F1A-BE4A-80A340B975B2">REST Enable Your JavaScript Application</a></li>
                     </ul>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-66EEBA84-8FD1-4F1A-BE4A-80A340B975B2" name="GUID-66EEBA84-8FD1-4F1A-BE4A-80A340B975B2"></a><h3 id="JJDEV-GUID-66EEBA84-8FD1-4F1A-BE4A-80A340B975B2" class="sect3"><span class="enumeration_section">5.3 </span>REST Enable Your JavaScript Application
               </h3>
               <div>
                  <p></p>
                  <div class="p">Perform the following steps to make your JavaScript application a cloud-enabled service using Oracle REST Data Services (ORDS):</div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>Download the Oracle REST Data Services (ORDS) installer file from the following location:</span><div>
                           <p><a href="http://www.oracle.com/technetwork/developer-tools/rest-data-services/downloads/index.html" target="_blank">http://www.oracle.com/technetwork/developer-tools/rest-data-services/downloads/index.html</a></p>
                           <div class="infoboxnote" id="GUID-66EEBA84-8FD1-4F1A-BE4A-80A340B975B2__GUID-92A48578-42DF-47C1-8051-F2BD042D95B0">
                              <p class="notep1">Note:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>You can perform similar steps for making your Java in the Database application a cloud-enabled service using Oracle REST Data Services (ORDS).</p>
                                 </li>
                                 <li>
                                    <p>For installing ORDS, you must have a USERS tablespace with at least 40 MB space.</p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                     </li>
                     <li class="stepexpand"><span>Install ORDS by selecting the default options, except the following:</span><div>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>When it prompts whether you want to use PL/SQL Gateway or not, select 2 for skipping the step.</p>
                              </li>
                              <li>
                                 <p>When it prompts you to specify passwords for Application Express RESTful  Services database users (APEX_LISTENER, APEX_REST_PUBLIC_USER), select 2 for skipping the step.</p>
                              </li>
                              <li>
                                 <p>When it prompts whether you wish to start the service in standalone mode or exit, select 1 for starting the service in standalone mode.</p>
                              </li>
                           </ul>
                        </div>
                     </li>
                     <li class="stepexpand"><span>Assign a listening port to the service. By default, port 8080 is used, but you may change this value in the <code class="codeph">ords_params.properties</code> file under the <code class="codeph">.../params</code> directory. Then, use the following command to bounce the jersey server:</span><div><pre class="pre codeblock"><code>java -jar ords.war</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>Create a procedure similar to the following as a wrapper to the <code class="codeph">invokeScriptEval</code> method:</span><div><pre class="pre codeblock"><code>Rem Create a procedure for select
CREATE OR REPLACE PROCEDURE selectproc(id IN varchar2)
IS
 output varchar2(10000);
BEGIN
 SELECT invokeScriptEval(id) INTO output from dual;
 htp.prn(output);
END;
/
SHOW ERRORS;</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>Create a procedure similar to the following for executing an external JavaScript SELECT query:</span><div><pre class="pre codeblock"><code>begin
  ords.create_service(
    p_module_name =&gt; 'load.routes' ,
    p_base_path   =&gt; '/load/routes/',
    p_pattern     =&gt; 'nashorn/selectbyid/:id',
    p_source_type =&gt; 'plsql/block',
    p_source      =&gt; 'begin selectproc(:id); end;'
);
   commit;
end;
/</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>Invoke the service from your browser, where the URL will be of the following format:</span><div><pre class="pre codeblock"><code>http://<span class="italic">&lt;server&gt;</span>:<span class="italic">&lt;port&gt;</span>/ords/<span class="italic">&lt;workspace&gt;</span>/load/routes/nashorn/<span class="italic">&lt;your_JSON_query&gt;</span>/<span class="italic">&lt;input&gt;</span></code></pre><p>For example:</p><pre class="pre codeblock"><code>http://localhost:8090/ords/ordstest/load/routes/nashorn/selectbyid/100</code></pre><p>Here, <span class="italic">100</span> specifies the employee ID of the employee, whose details need to be fetched. The following image illustrates the output:
                           </p>
                           <div class="figure" id="GUID-66EEBA84-8FD1-4F1A-BE4A-80A340B975B2__FIG-132635-3304199E">
                              <p class="titleinfigure">Figure 5-1 Output of the JavaScript Application</p><img src="img/nashorn_output.png" alt="Description of Figure 5-1 follows" title="Description of Figure 5-1 follows" longdesc="img_text/nashorn_output.html"><br><a href="img_text/nashorn_output.html">Description of "Figure 5-1 Output of the JavaScript Application"</a></div>
                           <!-- class="figure" -->
                        </div>
                     </li>
                  </ol>
                  <div class="section">The output is displayed in JSON format.</div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>