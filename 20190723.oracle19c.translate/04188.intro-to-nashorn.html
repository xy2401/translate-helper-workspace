<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content=""></meta>
      <meta name="description" content=""></meta>
      <title>Nashorn JavaScript引擎简介</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Java Developer&#39;s Guide "></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Java Developer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="java-developers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-11T00:55:24-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1999, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96468-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="setting-system-properties.html" title="Previous" type="text/html"></link>
      <link rel="next" href="developing-Java-stored-procedures.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Java Developer&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="JJDEV"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="setting-system-properties.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="developing-Java-stored-procedures.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Java开发人员指南</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Nashorn JavaScript引擎简介</li>
            </ol>
            <a id="GUID-9D7B5AF2-5F63-4484-968D-01EFB6A2D50F" name="GUID-9D7B5AF2-5F63-4484-968D-01EFB6A2D50F"></a>
            
            <h2 id="JJDEV-GUID-9D7B5AF2-5F63-4484-968D-01EFB6A2D50F" class="sect2"><span class="enumeration_chapter">5</span> Nashorn JavaScript引擎简介</h2>
         </header>
         <div class="ind">
            <div>
               <p></p>
               <p>Nashorn JavaScript引擎可以直接在数据库中运行JavaScript。能够在数据库中重用现有的客户端JavaScript，然后将其与Java SE库相结合，可以设计可以直接在RDBMS会话中运行的丰富，功能强大且通用的数据绑定应用程序。本节将在以下部分中介绍Nashorn JavaScript引擎：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="intro-to-nashorn.html#GUID-B2C0D602-3095-4EC9-9824-1DBF2F423786">关于使用Nashorn JavaScript引擎</a></p>
                  </li>
                  <li>
                     <p><a href="intro-to-nashorn.html#GUID-E211FED9-B5C0-4A85-B392-2FA6106B8334">使用JDBC进行JavaScript数据访问</a></p>
                  </li>
                  <li>
                     <p><a href="intro-to-nashorn.html#GUID-66EEBA84-8FD1-4F1A-BE4A-80A340B975B2">REST启用JavaScript应用程序</a></p>
                  </li>
               </ul>
            </div>
            <div class="sect2"><a id="GUID-B2C0D602-3095-4EC9-9824-1DBF2F423786" name="GUID-B2C0D602-3095-4EC9-9824-1DBF2F423786"></a><h3 id="JJDEV-GUID-B2C0D602-3095-4EC9-9824-1DBF2F423786" class="sect3"><span class="enumeration_section">5.1</span>关于使用Nashorn JavaScript引擎</h3>
               <div>
                  <p></p>
                  <p>Java 8的一个重要特性是Nashorn JavaScript引擎。从Oracle Database 12 <span class="italic">c</span>第2版（12.2.0.1）开始，Oracle JVM支持Java 8，因此您可以使用内置于运行Java 8代码库的Oracle JVM中的Nashorn JavaScript引擎在数据库中执行JavaScript。直接在数据库中执行JavaScript具有以下优点：</p>
                  <div class="infoboxnotealso" id="GUID-B2C0D602-3095-4EC9-9824-1DBF2F423786__GUID-6D874E5D-F3E4-4A20-A664-4C7E59D8F006">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/scripting/nashorn/api.html" target="_blank">https://docs.oracle.com/javase/8/docs/technotes/guides/scripting/nashorn/api.html</a></p>
                  </div>
                  <div class="section">
                     <p class="subhead2" id="GUID-B2C0D602-3095-4EC9-9824-1DBF2F423786__GUID-65047517-E89B-4713-A7AE-5AB8AB855CA4">在Oracle数据库中运行JavaScript的好处</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>重用现有技能和代码。</p>
                        </li>
                        <li>
                           <p>避免驻留在Oracle数据库中的运输数据。在数据库中执行JavaScript可以在数据库中就地生成JSON文档并加快处理速度。这样可以避免将数据传输到外部基础架构，并在避免网络开销时提高性能。</p>
                        </li>
                        <li>
                           <p>实现新的数据库功能。</p>
                        </li>
                     </ul>
                     <p>要运行JavaScript代码，在会话中使用12.2 Oracle JVM的Nashorn引擎，必须为您的架构授予DBJAVASCRIPT角色。此角色包括在数据库中运行Nashorn所需的权限。角色可以由您的DBA授予，每个用户只能执行一次。</p>
                     <p>在Oracle数据库中维护JavaScript源的首选方法是将它们作为Java资源加载到您的模式中，然后在数据库中运行脚本。</p>
                     <div class="infoboxnote" id="GUID-B2C0D602-3095-4EC9-9824-1DBF2F423786__GUID-7D883726-E058-4F20-9D30-78398DDD76CE">
                        <p class="notep1">注意：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>在Oracle JVM中限制直接调用Nashorn类。</p>
                           </li>
                           <li>
                              <p>Oracle JVM中禁用所有脚本模式扩展。</p>
                           </li>
                           <li>
                              <p>您可以使用标准脚本API从字符串或文件流运行脚本，但Oracle不建议使用它。以这种方式调用的脚本只能以沙盒模式运行，具有默认权限。</p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
               <div class="sect3"><a id="GUID-73B9B983-0ACB-40C7-809B-580540B3DE35" name="GUID-73B9B983-0ACB-40C7-809B-580540B3DE35"></a><h4 id="JJDEV-GUID-73B9B983-0ACB-40C7-809B-580540B3DE35" class="sect4"><span class="enumeration_section">5.1.1将</span> JavaScript代码加载到架构中</h4>
                  <div>
                     <p></p>
                     <div class="example" id="GUID-73B9B983-0ACB-40C7-809B-580540B3DE35__GUID-4E02E4DE-E435-4A61-971C-435D4141EED6">
                        <p>使用<code class="codeph">loadjava</code>命令将JavaScript代码加载到数据库模式中。脚本作为Java资源加载。例如，假设您有一个JavaScript文件<code class="codeph">hello.js</code> ，如下所示：</p><pre class="pre codeblock"><code>function hello（）{/ * *这是一个打印“Hello World”的示例Javascript文件。* / var hellow =“Hello World”;回归; } var output = hello（）;打印（输出）;</code></pre><p>使用以下命令将<code class="codeph">hello.js</code>脚本文件加载到名为<code class="codeph">yourschema</code>的模式中：</p><pre class="pre codeblock"><code>loadjava -v -u yourschema hello.js</code></pre><p><code class="codeph">loadjava</code>命令提示您输入密码，然后使用以下输出创建模式本地资源<code class="codeph">hello.js</code> ：</p><pre class="pre codeblock"><code>参数：'-u''yourschema / ***'' - '''hello.js'创建：resource hello.js loading：resource hello.js已加载类：0已加载资源：1已加载源：0已发布接口：0生成的类：0跳过的类：0同义词创建：0错误：0</code></pre><p>您还可以使用以下命令验证是否已成功将<code class="codeph">hello.js</code>文件加载到数据库中：</p><pre class="pre codeblock"><code>从user_objects中选择object_name，object_type;</code></pre><p>然后可以使用以下部分中提到的方法将此资源传递给Nashorn引擎：</p>
                     </div>
                     <!-- class="example" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-418BCA95-6A94-40FF-A876-DE4A66FA2576" name="GUID-418BCA95-6A94-40FF-A876-DE4A66FA2576"></a><h4 id="JJDEV-GUID-418BCA95-6A94-40FF-A876-DE4A66FA2576" class="sect4"><span class="enumeration_section">5.1.2</span>如何在Oracle JVM中运行JavaScript</h4>
                  <div>
                     <p></p>
                     <p>在数据库中加载脚本后，您可以通过以下三种方式运行它们：</p>
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="intro-to-nashorn.html#GUID-474B59E3-8066-489D-A636-6F1E98FF81B4">使用DBMS_JAVASCRIPT.RUN PL / SQL过程</a></p>
                           </li>
                           <li>
                              <p><a href="intro-to-nashorn.html#GUID-736C4BDB-DE57-4283-9377-B9C3FCDC7143">使用DbmsJavaScript Java类</a></p>
                           </li>
                           <li>
                              <p><a href="intro-to-nashorn.html#GUID-8CA560E8-C77D-480B-8D0F-7CABBC931AB1">使用标准的javax.script Java包</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div class="sect4"><a id="GUID-474B59E3-8066-489D-A636-6F1E98FF81B4" name="GUID-474B59E3-8066-489D-A636-6F1E98FF81B4"></a><h5 id="JJDEV-GUID-474B59E3-8066-489D-A636-6F1E98FF81B4" class="sect5"><span class="enumeration_section">5.1.2.1</span>使用DBMS_JAVASCRIPT.RUN PL / SQL过程</h5>
                     <div>
                        <p></p>
                        <div class="example" id="GUID-474B59E3-8066-489D-A636-6F1E98FF81B4__GUID-37ED6AA7-FA2D-4AFC-AF73-A090AFBFB968">
                           <p>此方法对于不返回任何值的JavaScript过程非常有用。调用<code class="codeph">DBMS_JAVASCRIPT.RUN</code>过程以提供资源名称作为参数。确保您的架构被授予<code class="codeph">DBJAVASCRIPT</code>角色。<code class="codeph">DBMS_JAVASCRIPT.RUN</code>过程是<code class="codeph">DBMS_JAVASCRIPT.RUN</code>的包装器<code class="codeph">oracle.aurora.rdbms.DbmsJavaScript.run</code> Java方法，在内部调用Nashorn功能。
                           </p>
                           <p><span class="bold">来自SQL</span></p><pre class="pre codeblock"><code>调用dbms_javascript.run（'hello.js'）;</code></pre><p>如果您的JavaScript代码返回输出值，则必须使用以下说明在标准输出设备上显示值：</p><pre class="pre codeblock"><code>SQL&gt;在SQL上设置serveroutput&gt;调用dbms_java.set_output（20000）; SQL&gt; call dbms_javascript.run（“hello.js”）;</code></pre><p><span class="bold">从PL / SQL：</span></p><pre class="pre codeblock"><code>dbms_javascript.run（ 'hello.js'）;</code></pre><p>如果您的JavaScript代码返回输出值，则必须使用以下说明在标准输出设备上显示值：</p><pre class="pre codeblock"><code>SQL&gt;在SQL上设置serveroutput&gt;调用dbms_java.set_output（20000）; SQL&gt; call dbms_javascript.run（“hello.js”）;</code></pre></div>
                        <!-- class="example" -->
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-736C4BDB-DE57-4283-9377-B9C3FCDC7143" name="GUID-736C4BDB-DE57-4283-9377-B9C3FCDC7143"></a><h5 id="JJDEV-GUID-736C4BDB-DE57-4283-9377-B9C3FCDC7143" class="sect5"><span class="enumeration_section">5.1.2.2</span>使用DbmsJavaScript Java类</h5>
                     <div>
                        <p></p>
                        <div class="example" id="GUID-736C4BDB-DE57-4283-9377-B9C3FCDC7143__GUID-37376D9A-D88E-424A-BC4C-BF8C10B170FE">
                           <p>这是从Oracle JVM中的Java代码调用脚本的首选方法，因为它使您可以将架构权限应用于JavaScript代码。从数据库中运行的Java代码调用作为资源<code class="codeph">hello.js</code>加载的JavaScript。调用<code class="codeph">oracle.aurora.rdbms.的方法运行<code class="codeph">oracle.aurora.rdbms.DbmsJavaScript</code>类，传入资源名称作为参数，如下面的代码片段所示：</p>
                           <div class="infoboxnote" id="GUID-736C4BDB-DE57-4283-9377-B9C3FCDC7143__GUID-2C49DEBA-45BD-447E-B7C1-5FC5E8F19064">
                              <p class="notep1">注意：</p>
                              <p>确保您的架构被授予<code class="codeph">DBJAVASCRIPT</code>角色。
                              </p>
                           </div><pre class="pre codeblock"><code>import oracle.aurora.rdbms。DbmsJavaScript; ... DbmsJavaScript.run（“hello.js”）;</code></pre></div>
                        <!-- class="example" -->
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-8CA560E8-C77D-480B-8D0F-7CABBC931AB1" name="GUID-8CA560E8-C77D-480B-8D0F-7CABBC931AB1"></a><h5 id="JJDEV-GUID-8CA560E8-C77D-480B-8D0F-7CABBC931AB1" class="sect5"><span class="enumeration_section">5.1.2.3</span>使用标准javax.script Java包</h5>
                     <div>
                        <p></p>
                        <div class="example" id="GUID-8CA560E8-C77D-480B-8D0F-7CABBC931AB1__GUID-75BD5768-FEB4-4784-BF81-A55FD51F95FD">
                           <p>此方法对返回值的JavaScript函数很有用。通常，您执行以下任务：</p>
                           <div class="infoboxnote" id="GUID-8CA560E8-C77D-480B-8D0F-7CABBC931AB1__GUID-90B8D8C7-A6CE-433A-9E33-480FF888D771">
                              <p class="notep1">注意：</p>
                              <p>您必须确保您的架构被授予<code class="codeph">DBJAVASCRIPT</code>角色。
                              </p>
                           </div>
                           <ol>
                              <li>
                                 <p>使用<code class="codeph">loadjava</code>命令将JavaScript作为Java资源加载到数据库中。
                                 </p>
                              </li>
                              <li>
                                 <p>使用<code class="codeph">javax.script</code>包来运行JavaScript。
                                 </p>
                              </li>
                              <li>
                                 <p>实例化脚本管理器</p>
                              </li>
                              <li>
                                 <p>创建一个引擎</p>
                              </li>
                              <li>
                                 <p>将您的资源流阅读器作为参数传递给引擎的<code class="codeph">eval</code>方法</p>
                              </li>
                           </ol>
                           <p>以下代码片段显示了如何使用<code class="codeph">javax.script</code>包从资源<code class="codeph">hello.js</code>运行代码：</p><pre class="pre codeblock"><code>import javax.script。*; import java.net。*; import java.io.*; ...//创建脚本引擎管理器ScriptEngineManager factory = new ScriptEngineManager（）; //创建JavaScript引擎ScriptEngine engine = factory.getEngineByName（“javascript”）; //创建模式资源URL URL url = Thread.currentThread（）。getContextClassLoader（）。getResource（“hello.js”）; engine.eval（new InputStreamReader（url.openStream（）））; ...
</code></pre><p>您还可以从String中读取JavaScript代码。以下代码段显示了如何从String中读取和评估JavaScript代码：</p><pre class="pre codeblock"><code>//从String engine.eval（new StringReader（ <span class="italic">&lt;script&gt;</span> ））评估JavaScript代码;</code></pre><p>否则，您还可以从文件中读取JavaScript代码。但是，这涉及额外的特权。以下代码段显示了如何从<code class="codeph">script_name</code>文件中读取和评估JavaScript代码：</p><pre class="pre codeblock"><code>import javax.script。*; ...ScriptEngine engine = new ScriptEngineManager（）。getEngineByName（“JavaScript”）; engine.eval（new FileReader（“script_name”））;</code></pre><p>在评估JacaScript代码之后，通常会执行以下任务来调用JavaScript函数：</p>
                           <ol>
                              <li>
                                 <p>将Nashorn引擎转换为<code class="codeph">Invocable</code>并使用<code class="codeph">invokeFunction</code> 。
                                 </p>
                                 <p>例如，如果<code class="codeph">hello.js</code>脚本定义了一个名为<code class="codeph">hello</code>的JavaScript函数，那么您可以执行以下代码片段中显示的这些任务：</p><pre class="pre codeblock"><code>//创建如上所述的JavaScript引擎Invocable invocable =（Invocable）engine;对象myResult = invocable.invokeFunction（“hello”）; ...</code></pre><div class="infoboxnote" id="GUID-8CA560E8-C77D-480B-8D0F-7CABBC931AB1__GUID-E701ED6C-DC10-4FB8-BF27-8CEA11CE798F">
                                    <p class="notep1">注意：</p>
                                    <p>使用<code class="codeph">invocable.invokeFunction</code>的另一种方法是将返回值传递给从脚本内部调用的Java方法。这种替代方法是优选的，因为它需要更少的样板代码并且与<code class="codeph">DBMSJAVASCRIPT.RUN</code>过程兼容。
                                    </p>
                                    <p>例如，假设您的JavaScript资源<code class="codeph">hello.js</code>定义了<code class="codeph">selectQuery</code>函数，并且您希望将结果传递给<code class="codeph">print()</code> Java方法，该方法在类<code class="codeph">QueryTest</code>定义，如下所示：</p><pre class="pre codeblock"><code>public static void print（String results）{System.out.println（“my results：\ n”+ results）; }</code></pre><p>然后，要从JavaScript实现此目的，请将以下行添加到<code class="codeph">hello.js</code>文件中：</p><pre class="pre codeblock"><code>var queryTest = Java.type（“QueryTest”）; queryTest.print（selectQuery（ “所有”））;</code></pre><p>现在，通过以下方式之一调用<code class="codeph">hellp.js</code> ：</p><pre class="pre codeblock"><code>DbmsJavaScript.run（ “hello.js”）; DBMS_JAVASCRIPT.RUN（ 'hello.js'）;</code></pre></div>
                              </li>
                              <li>
                                 <p>创建用于调用JavaScript应用程序的PL / SQL过程，如以下示例所示：</p><pre class="pre codeblock"><code>- 创建选择CREATE OR REPLACE PROCEDURE的过程selectproc（id IN varchar2）IS输出varchar2（10000）; BEGIN SELECT invokeScriptEval（id）INTO输出来自dual; htp.prn（输出）;结束; /显示错误;</code></pre></li>
                           </ol>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-E211FED9-B5C0-4A85-B392-2FA6106B8334" name="GUID-E211FED9-B5C0-4A85-B392-2FA6106B8334"></a><h3 id="JJDEV-GUID-E211FED9-B5C0-4A85-B392-2FA6106B8334" class="sect3"><span class="enumeration_section">5.2</span>使用JDBC进行JavaScript数据访问</h3>
               <div>
                  <p></p>
                  <div class="section">本节介绍如何使用JavaScript访问RDBMS中的数据。目前，没有用于访问RDBMS中的数据的JavaScript标准。 Nashorn JavaScript引擎支持在JavaScript中使用标准JDBC。</div>
                  <!-- class="section" -->
                  <div class="p">执行以下步骤以使用JDBC和JavaScript作为服务发布应用程序：</div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>在数据库中创建一个表并使用JSON填充它，如以下示例所示：</span><div><pre class="pre codeblock"><code>DROP TABLE员工PURGE; CREATE TABLE employees（id RAW（16）NOT NULL，data CLOB，CONSTRAINT employees_pk PRIMARY KEY（id），CONSTRAINT employees_json_chk CHECK（data IS JSON））; TRUNCATE TABLE员工; INSERT INTO员工（id，data）VALUES（SYS_GUID（），'{“EmpId”：“100”，“FirstName”：“Kuassi”，“LastName”：“Mensah”，“Job”：“Manager”，“Email” “：”kuassi @ oracle.com“，”地址“：{”城市“：”红木“，”国家“：”美国“}}'）; INSERT INTO员工（id，data）VALUES（SYS_GUID（），'{“EmpId”：“200”，“FirstName”：“Nancy”，“LastName”：“Greenberg”，“Job”：“Manager”，“Email” “：”“Nancy@oracle.com”，“地址”：{“城市”：“波士顿”，“国家”：“美国”}}'）; INSERT INTO员工（id，data）VALUES（SYS_GUID（），'{“EmpId”：“300”，“FirstName”：“Suresh”，“LastName”：“Mohan”，“Job”：“Developer”，“Email” “：”Suresh@oracle.com“，”地址“：{”城市“：”班加罗尔“，”国家“：”印度“}}'）; INSERT INTO员工（id，data）VALUES（SYS_GUID（），'{“EmpId”：“400”，“FirstName”：“Nirmala”，“LastName”：“Sundarappa”，“Job”：“Manager”，“Email” “：”“Nirmala@oracle.com”，“地址”：{“城市”：“红木”，“国家”：“美国”}}'）; INSERT INTO员工（id，data）VALUES（SYS_GUID（），'{“EmpId”：“500”，“FirstName”：“Amarnath”，“LastName”：“Chandana”，“Job”：“Test Devloper”，“电子邮件“：”amarnath@oracle.com“，”地址“：{”城市“：”班加罗尔“，”国家“：”印度“}}'）;</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>使用JDBC编写JavaScript应用程序，如以下示例所示，并将JavaScript代码加载到模式中：</span><div><pre class="pre codeblock"><code>var selectQuery = function（id）{var Driver = Packages.oracle.jdbc。一个OracleDriver; var oracleDriver = new Driver（）; var url =“jdbc：default：connection：”; var output =“”; var connection = oracleDriver.defaultConnection（）; var prepStmt; //准备语句if（id =='all'）{prepStmt = connection.prepareStatement（“SELECT a.data FROM employees a”）; } else {prepStmt = connection.prepareStatement（“SELECT a.data FROM employees a WHERE a.data。EmpId =？“）; prepStmt.setInt（1，id）;} //执行Query var resultSet = prepStmt.executeQuery（）; //显示结果while（resultSet.next（））{output = output + resultSet.getString（1）+ “&lt;br&gt;”;} //清理resultSet.close（）; prepStmt.close（）; connection.close（）;返回输出;}</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>创建Java资源，如以下示例所示：</span><div><pre class="pre codeblock"><code>创建或替换并编译名为“InvokeScript”的java源作为import javax.script。*; import java.net。*; import java.io.*; public class InvokeScript {public static String eval（String inputId）throws Exception {String output = new String（）; try {//创建脚本引擎管理器ScriptEngineManager factory = new ScriptEngineManager（）; //创建JavaScript引擎ScriptEngine engine = factory.getEngineByName（“javascript”）; //将脚本读取为java资源engine.eval（new InputStreamReader（InvokeScript.class.getResourceAsStream（“select.js”）））; //替代方法//engine.eval(Thread.currentThread().getContextClassLoader().getResource("select.js“））; Invocable invocable =（Invocable）引擎; Object selectResult = invocable.invokeFunction（“selectQuery”，inputId）; output = selectResult.toString（）; } catch（Exception e）{output = e.getMessage（）; } return output; } / /</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>为引擎的<code class="codeph">eval</code>方法创建一个包装器，如以下示例所示：</span><div><pre class="pre codeblock"><code>- 创建函数CREATE OR REPLACE FUNCTION invokeScriptEval（inputId varchar2）return varchar2 as language java name'InvokeScript.eval（java.lang。String）返回java.lang。串'; /</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>从SQL调用<code class="codeph">invokeScriptEval</code> JavaScript函数，如以下示例所示：</span><div><pre class="pre codeblock"><code>创建或替换过程sqldemo（id IN varchar2）IS输出varchar2（10000）; BEGIN SELECT invokeScriptEval（id）INTO输出来自dual; DBMS_OUTPUT.PUT_LINE（输出）;结束; /显示错误;</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>从SQL调用<code class="codeph">sqldemo</code>过程，如以下示例所示：</span><div><pre class="pre codeblock"><code>SQL&gt;在SQL上设置serveroutput&gt;调用dbms_java.set_output（5000）; SQL&gt; call sqldemo（'100'）;</code></pre></div>
                     </li>
                  </ol>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="intro-to-nashorn.html#GUID-66EEBA84-8FD1-4F1A-BE4A-80A340B975B2">REST启用JavaScript应用程序</a></li>
                     </ul>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-66EEBA84-8FD1-4F1A-BE4A-80A340B975B2" name="GUID-66EEBA84-8FD1-4F1A-BE4A-80A340B975B2"></a><h3 id="JJDEV-GUID-66EEBA84-8FD1-4F1A-BE4A-80A340B975B2" class="sect3"><span class="enumeration_section">5.3</span> REST启用JavaScript应用程序</h3>
               <div>
                  <p></p>
                  <div class="p">执行以下步骤，使用Oracle REST数据服务（ORDS）使JavaScript应用程序成为支持云的服务：</div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>从以下位置下载Oracle REST数据服务（ORDS）安装程序文件：</span><div>
                           <p><a href="http://www.oracle.com/technetwork/developer-tools/rest-data-services/downloads/index.html" target="_blank">http://www.oracle.com/technetwork/developer-tools/rest-data-services/downloads/index.html</a></p>
                           <div class="infoboxnote" id="GUID-66EEBA84-8FD1-4F1A-BE4A-80A340B975B2__GUID-92A48578-42DF-47C1-8051-F2BD042D95B0">
                              <p class="notep1">注意：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>您可以执行类似的步骤，使用Oracle REST数据服务（ORDS）使数据库应用程序中的Java成为支持云的服务。</p>
                                 </li>
                                 <li>
                                    <p>要安装ORDS，您必须具有至少40 MB空间的USERS表空间。</p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                     </li>
                     <li class="stepexpand"><span>通过选择默认选项安装ORDS，但以下情况除外：</span><div>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>当它提示您是否要使用PL / SQL网关时，请选择2以跳过该步骤。</p>
                              </li>
                              <li>
                                 <p>当它提示您为Application Express RESTful Services数据库用户（APEX_LISTENER，APEX_REST_PUBLIC_USER）指定密码时，请选择2以跳过该步骤。</p>
                              </li>
                              <li>
                                 <p>当它提示您是要在独立模式下启动服务还是退出时，选择1以在独立模式下启动服务。</p>
                              </li>
                           </ul>
                        </div>
                     </li>
                     <li class="stepexpand"><span>为服务分配侦听端口。默认情况下，使用端口8080，但您可以在<code class="codeph">.../params</code>目录下的<code class="codeph">ords_params.properties</code>文件中更改此值。然后，使用以下命令退回球衣服务器：</span><div><pre class="pre codeblock"><code>java -jar ords.war</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>创建类似于以下的过程作为<code class="codeph">invokeScriptEval</code>方法的包装器：</span><div><pre class="pre codeblock"><code>Rem创建一个选择CREATE OR REPLACE PROCEDURE的过程selectproc（id IN varchar2）IS输出varchar2（10000）; BEGIN SELECT invokeScriptEval（id）INTO输出来自dual; htp.prn（输出）;结束; /显示错误;</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>为执行外部JavaScript SELECT查询创建类似于以下的过程：</span><div><pre class="pre codeblock"><code>begin ords.create_service（p_module_name =&gt;'load.routes'，p_base_path =&gt;'/ load / routes /'，p_pattern =&gt;'nashorn / selectbyid /：id'，p_source_type =&gt;'plsql / block'，p_source =&gt;' begin selectproc（：id）; end;'）;承诺;结束; /</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>从您的浏览器调用服务，其中URL将具有以下格式：</span><div><pre class="pre codeblock"><code>http：// <span class="italic">&lt;server&gt;</span> ： <span class="italic">&lt;port&gt;</span> / ords / <span class="italic">&lt;workspace&gt;</span> / load / routes / nashorn / <span class="italic">&lt;your_JSON_query&gt;</span> / <span class="italic">&lt;input&gt;</span></code></pre><p>例如：</p><pre class="pre codeblock"><code>HTTP：//本地主机：8090 / ORDS / ordstest /装载/路由/犀牛/ selectbyid / 100</code></pre><p>这里， <span class="italic">100</span>指定员工的员工ID，其详细信息需要获取。下图说明了输出：</p>
                           <div class="figure" id="GUID-66EEBA84-8FD1-4F1A-BE4A-80A340B975B2__FIG-132635-3304199E">
                              <p class="titleinfigure">图5-1 JavaScript应用程序的输出</p><img src="img/nashorn_output.png" alt="下面是图5-1的描述" title="下面是图5-1的描述" longdesc="img_text/nashorn_output.html"><br><a href="img_text/nashorn_output.html">“图5-1 JavaScript应用程序输出”的描述</a></div>
                           <!-- class="figure" -->
                        </div>
                     </li>
                  </ol>
                  <div class="section">输出以JSON格式显示。</div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>