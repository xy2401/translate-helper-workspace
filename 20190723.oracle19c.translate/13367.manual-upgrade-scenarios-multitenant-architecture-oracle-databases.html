<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="To prepare for manual upgrades, review the manual upgrade scenarios and procedures for Oracle Database deployed with multitenant architecture."></meta>
      <meta name="description" content="To prepare for manual upgrades, review the manual upgrade scenarios and procedures for Oracle Database deployed with multitenant architecture."></meta>
      <title>多租户架构Oracle数据库的手动升级方案</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Database Upgrade Guide"></meta>
      <meta property="og:description" content="To prepare for manual upgrades, review the manual upgrade scenarios and procedures for Oracle Database deployed with multitenant architecture."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Database Upgrade Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-upgrade-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-04-25T08:26:31-07:00"></meta>
      <meta name="dcterms.title" content="Database Upgrade Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96252-05"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="example-manual-upgrade-windows-non-cdb-11203-to-122.html" title="Previous" type="text/html"></link>
      <link rel="next" href="improvements-data-dictionary-upgrade-and-upgrade-status-displays.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="UPGRD"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="example-manual-upgrade-windows-non-cdb-11203-to-122.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="improvements-data-dictionary-upgrade-and-upgrade-status-displays.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">数据库升级指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="upgrading-oracle-database.html" property="item" typeof="WebPage"><span property="name">升级Oracle数据库</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">多租户架构Oracle数据库的手动升级方案</li>
            </ol>
            <a id="GUID-8231CE50-ABEC-4BA3-A4AC-D461EB791ACD" name="GUID-8231CE50-ABEC-4BA3-A4AC-D461EB791ACD"></a><a id="UPGRD60130"></a>
            
            <h2 id="UPGRD-GUID-8231CE50-ABEC-4BA3-A4AC-D461EB791ACD" class="sect2">多租户架构Oracle数据库的手动升级方案</h2>
         </header>
         <div class="ind">
            <div>
               <p>要准备手动升级，请查看使用多租户体系结构部署的Oracle数据库的手动升级方案和过程。</p>
               <p>Oracle数据库<span class="italic">12c的</span>开始，多租户架构使得能够使用包含可插拔数据库（PDBS）的多租户数据库容器（CDB）的Oracle数据库部署。早于Oracle Database 12 <span class="italic">c第</span> 1版（12.1.0.1）的所有Oracle数据库版本都使用非CDB架构。
               </p>
               <div class="infoboxnote" id="GUID-8231CE50-ABEC-4BA3-A4AC-D461EB791ACD__GUID-EF4B9AAA-F549-4320-BCE2-3C550511A308">
                  <p class="notep1">警告：</p>
                  <p>将兼容的初始化参数设置为12.1.0.2或更高版本后，无法降级数据库。仅当兼容性设置为12.1.0.1时，才可以对可插拔数据库（PDB）进行降级。降级仍然存在限制。</p>
                  <p>Oracle强烈建议您在开始升级之前和开始降级之前将源数据库和目标数据库升级到最新的捆绑包补丁集更新（BP，PSU）。</p>
               </div>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-2424F203-D586-459E-9BC5-5332800A7D2F">关于Oracle Multitenant Oracle数据库升级</a><br>您可以并行或按顺序升级多租户架构上安装的Oracle数据库。
                  </li>
                  <li class="ulchildlink"><a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-553F6F33-84AD-4601-868C-2860EC6D69E9">使用多租户升级协调代理PDB的升级</a><br>协调CDB的升级，使代理PDB和PDB目标是相同的版本。
                  </li>
                  <li class="ulchildlink"><a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-7E127507-D2F5-4771-A8A9-BAF6E553831B">手动升级多租户容器Oracle数据库（CDB）</a><br>本节中的过程提供了使用命令行过程手动升级CDB的步骤。
                  </li>
                  <li class="ulchildlink"><a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-6471F9F4-5151-4FA3-B5EC-B5AEBD99B0AA">关于使用具有优先级列表的并行升级实用程序升级PDB</a><br>在Oracle Database 12.2和更高版本中，您可以使用优先级列表升级PDB，以便在其他PDB之前升级一组PDB，并且可以修改该升级优先级。
                  </li>
                  <li class="ulchildlink"><a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-55A00056-EFB3-4F81-8E28-3B8C9553B68F">关于使用优先级列表，包含列表和排除列表进行PDB升级</a><br>从Oracle Database 12 <span class="italic">c第</span> 2版（12.2）开始，您可以使用包含和排除列表以及优先级列表来控制PDB的升级方式。
                  </li>
                  <li class="ulchildlink"><a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-4CA89342-971B-447C-A643-9638DE4EB121">并行升级多租户架构</a><br>使用此技术升级多租户架构Oracle数据库版本（Oracle Database 12c第1版（12.1.0.1）及更高版本，升级容器数据库（CDB），然后并行升级多个可插拔数据库（PDB）。
                  </li>
                  <li class="ulchildlink"><a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-8F9AAFA1-690D-4F70-8448-E66D765AF136">使用Unplug-Plug顺序升级多租户架构</a><br>要升级早期版本多租户容器数据库（CDB），Oracle Database Release 12 <span class="italic">c</span> （12.1.0.1）及更高版本中的可插拔数据库（PDB），可以从早期版本的CDB中拔出PDB，并将PDB插入后来发布CDB。</li>
               </ul>
               <div class="infoboxnotealso" id="GUID-8231CE50-ABEC-4BA3-A4AC-D461EB791ACD__GUID-714CC914-140F-491C-87E5-D1246AF5773E">
                  <p class="notep1">也可以看看：</p>
                  <p> <a href="../multi/introduction-to-the-multitenant-architecture.html#CNCPT89234" target="_blank"><span class="italic">Oracle Database Concepts</span></a> ，概述了多租户架构</p>
                  <p>有关创建和配置CDB的完整信息，请参见<a href="../multi/creating-and-configuring-a-cdb.html#ADMIN13514" target="_blank"><span class="italic">“Oracle数据库管理员指南”</span></a></p>
               </div>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="upgrading-oracle-database.html#GUID-CC88F262-3370-4FFA-8604-EDA9F20F56D9" title="Oracle提供了一套全面的工具，用于以最短的停机时间升级Oracle数据库，以及将应用程序迁移到新版本。">升级Oracle数据库</a></p>
                  </div>
               </div>
            </div>
            
            <div class="props_rev_3"><a id="GUID-2424F203-D586-459E-9BC5-5332800A7D2F" name="GUID-2424F203-D586-459E-9BC5-5332800A7D2F"></a><h3 id="UPGRD-GUID-2424F203-D586-459E-9BC5-5332800A7D2F" class="sect3">关于Oracle Multitenant Oracle数据库升级</h3>
               <div>
                  <p>您可以并行或按顺序升级多租户架构上安装的Oracle数据库。</p>
                  <p>从Oracle Database 12c第1版（12.1）开始，Oracle提供了多租户架构，可以在容器数据库（CDB）中创建和管理可插拔数据库（PDB）。您可以使用Oracle数据库升级助手（DBUA）或使用并行升级实用程序升级多租户架构系统以执行手动升级。</p>
                  <p>使用多租户架构升级Oracle数据库有两种方法：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><span class="bold">并行</span> 。使用此技术，您可以执行一个升级CDB的升级操作，然后并行升级PDB。
                        </p>
                     </li>
                     <li>
                        <p><span class="bold">顺序</span> 。使用此技术，您可以安装新版本的CDB，从早期版本的CDB准备和拔出PDB，将PDB插入更高版本的CDB，然后完成每个PDB的升级。</p>
                     </li>
                  </ul>
                  <p>以下部分提供了每种升级技术的高级摘要。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-2424F203-D586-459E-9BC5-5332800A7D2F__GUID-37280374-6ED9-402F-A277-9F752E506F85">并行升级Oracle Multitenant</p>
                     <p>使用并行技术，首先使用并行升级实用程序（ <code class="codeph">catctl.pl</code> ）升级<code class="codeph">CDB$ROOT</code> ，使用参数设置并行处理程度和可用性：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">-n</code>参数定义运行升级的并行进程数，最多8个。
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">-M</code>参数确定<code class="codeph">CDB$ROOT</code>在整个升级过程中是保持<code class="codeph">UPGRADE</code>模式，还是在CDB升级完成后可用于访问。如果未使用<code class="codeph">-M</code>参数运行升级，则在完成<code class="codeph">CDB$ROOT</code>升级后，只要每个PDB完成升级，PDB就可以访问。如果使用<code class="codeph">–M</code>参数运行升级，则<code class="codeph">CDB$ROOT</code>保持<code class="codeph">UPGRADE</code>模式，并且在完成所有PDB的升级之前，PDB不可用。
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-2424F203-D586-459E-9BC5-5332800A7D2F__GUID-2F525046-63CA-4843-92A7-7D028B36DFE5">按顺序升级Oracle Multitenant</p>
                     <p>使用In Sequence技术，您可以安装新版本的多租户架构CDB。接下来，在早期版本的多租户架构CDB中，您发出SQL命令以运行预升级脚本以准备一个或多个要升级的PDB，并将其关闭。然后，拔下PDB，将其插入新版本多版本架构CDB，并按顺序完成每个PDB的升级。</p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-8231CE50-ABEC-4BA3-A4AC-D461EB791ACD" title="要准备手动升级，请查看使用多租户体系结构部署的Oracle数据库的手动升级方案和过程。">多租户架构Oracle数据库的手动升级方案</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-553F6F33-84AD-4601-868C-2860EC6D69E9" name="GUID-553F6F33-84AD-4601-868C-2860EC6D69E9"></a><h3 id="UPGRD-GUID-553F6F33-84AD-4601-868C-2860EC6D69E9" class="sect3">使用多租户升级协调代理PDB的升级</h3>
               <div>
                  <p>协调CDB的升级，使代理PDB和PDB目标是相同的版本。</p>
                  <p>在升级期间，升级Proxy PDB不会升级其相应的目标PDB。目标PDB的升级必须单独完成。</p>
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-8231CE50-ABEC-4BA3-A4AC-D461EB791ACD" title="要准备手动升级，请查看使用多租户体系结构部署的Oracle数据库的手动升级方案和过程。">多租户架构Oracle数据库的手动升级方案</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="UPGRD12408"></a><div class="props_rev_3"><a id="GUID-7E127507-D2F5-4771-A8A9-BAF6E553831B" name="GUID-7E127507-D2F5-4771-A8A9-BAF6E553831B"></a><h3 id="UPGRD-GUID-7E127507-D2F5-4771-A8A9-BAF6E553831B" class="sect3">手动升级多租户容器Oracle数据库（CDB）</h3>
               <div>
                  <p>本节中的过程提供了使用命令行过程手动升级CDB的步骤。</p>
                  <div class="section">
                     <p>在使用此过程之前，您必须完成以下步骤：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>安装适用于Oracle数据库的新版本软件</p>
                        </li>
                        <li>
                           <p>准备新的Oracle主页</p>
                        </li>
                        <li>
                           <p>运行升级前信息工具</p>
                        </li>
                     </ul>
                     <p>Oracle Database 12c引入了多租户架构，使Oracle数据库可以作为具有可插拔数据库的多租户容器数据库（CDB）。您可以使用DBUA升级CDB，并在此过程中同时升级连接到CDB的所有可插拔数据库。或者，在安装Oracle数据库软件并准备新的Oracle主目录后，可以继续进行手动命令行升级。</p>
                     <ol>
                        <li>
                           <p>如果尚未执行此操作，请运行升级前信息工具。在继续之前，请查看升级前信息工具输出并更正输出中记录的所有问题。</p>
                        </li>
                        <li>
                           <p>备份源数据库。</p>
                        </li>
                        <li>
                           <p>如果您还没有这样做，请准备新的Oracle主目录。</p>
                        </li>
                        <li>
                           <p>（视情况而定）仅对于Oracle RAC环境，输入以下命令将CLUSTER_DATABASE的初始化参数值设置为FALSE：</p><pre class="pre codeblock"><code>ALTER SYSTEM SET CLUSTER_DATABASE = FALSE SCOPE = SPFILE;</code></pre><p>更改<span class="parmname" translate="no">CLUSTER_DATABASE</span>参数后重新启动数据库。
                           </p>
                        </li>
                        <li>
                           <p>关闭数据库。（对于非CDB和CDB，语法相同。）</p><pre class="pre codeblock"><code>SQL&gt; SHUTDOWN IMMEDIATE</code></pre><div class="infoboxnote" id="GUID-7E127507-D2F5-4771-A8A9-BAF6E553831B__GUID-3DE49F19-CA51-49F7-AE3B-1D186A37A6D0">
                              <p class="notep1">注意：</p>
                              <p>要关闭PDB，可以从CDB根目录指定它： <code class="codeph">alter pluggable database <span class="variable" translate="no">PDBname</span> close</code> 。
                              </p>
                           </div>
                        </li>
                        <li>
                           <p>如果您的操作系统是Windows，请完成以下步骤：</p>
                           <ol type="a">
                              <li>
                                 <p>停止要升级的数据库的<code class="codeph">OracleService <span class="variable" translate="no">SID</span></code> Oracle服务，其中<code class="codeph"><span class="variable" translate="no">SID</span></code>是实例名称。例如，如果您的<code class="codeph"><span class="variable" translate="no">SID</span></code>是<code class="codeph">ORCL</code> ，则在命令提示符处输入以下内容：</p><pre class="pre codeblock"><code>C：\&gt; NET STOP OracleServiceORCL</code></pre></li>
                              <li>
                                 <p>使用<code class="codeph">ORADIM</code>在命令提示符处删除Oracle服务。</p>
                                 <p>如果您的<code class="codeph"><span class="variable" translate="no">SID</span></code>是<code class="codeph">ORCL</code> ，则输入以下命令，将您的SID替换为<code class="codeph"><span class="variable" translate="no">SID</span></code> 。</p><pre class="oac_no_warn" dir="ltr">C：\&gt; ORADIM -DELETE  - <span class="variable" translate="no">SID</span> ORCL</pre></li>
                              <li>
                                 <p>使用新Oracle Database发行版的<code>ORADIM</code>命令在命令提示符处为新版本Oracle Database创建服务。
                                 </p>
                                 <p>例如：</p><pre class="pre codeblock"><code>C：\&gt; ORADIM -NEW -SID <span class="variable" translate="no">SID</span> -SYSPWD <span class="variable" translate="no">PASSWORD</span> -MAXUSERS <span class="variable" translate="no">USERS</span> -STARTMODE AUTO -PILE <span class="variable" translate="no">ORACLE_HOME</span> \ DATABASE \ INIT <span class="variable" translate="no">SID</span> .ORA</code></pre><p>大多数Oracle数据库服务使用Oracle Home User的权限登录系统。该服务以该用户的权限运行。<code>ORADIM</code>命令会提示您输入此用户帐户的密码。您可以使用<code>ORADIM</code>指定其他选项。</p>
                                 <p>在此示例中，如果您的<code class="codeph"><span class="variable" translate="no">SID</span> value</code> <code class="codeph">ORCL</code> ，则您的<code class="codeph"><span class="variable" translate="no">password</span></code> （ <code class="codeph">SYSPWD</code> ）值为<code class="codeph">TWxy5791</code> ，最大用户数（ <code class="codeph">MAXUSERS</code> ）值为10，Oracle主路径为<code class="codeph">C:\ORACLE\PRODUCT\19.1.0\DB</code> ，然后输入以下命令：</p><pre class="pre codeblock"><code>C：\&gt; ORADIM -NEW -SID ORCL -SYSPWD TWxy5791 -MAXUSERS 10 -STARTMODE AUTO -PFILE C：\ ORACLE \ PRODUCT \ 19.1.0 \ DB \ DATABASE \ INITORCL.ORA</code></pre><p><code>ORADIM</code>将日志文件写入<code>ORACLE_HOME\database</code>目录。日志文件包含多租户数据库中PDB的名称。
                                 </p>
                              </li>
                           </ol>
                        </li>
                        <li>
                           <p>如果您的操作系统是Linux或UNIX，请执行以下检查：</p>
                           <ol type="a">
                              <li>
                                 <p>您的<code class="codeph">ORACLE_SID</code>设置正确</p>
                              </li>
                              <li>
                                 <p><code class="codeph">oratab</code>文件指向Oracle数据库12 <span class="italic">c</span>的Oracle主目录</p>
                              </li>
                              <li>
                                 <p>以下环境变量指向Oracle Database 12c目录：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><code class="codeph">ORACLE_HOME</code></p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">路径</code></p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>客户端用于设置<code class="codeph">$ORACLE_HOME</code>环境变量的任何脚本都必须指向新的Oracle主目录。
                                 </p>
                              </li>
                           </ol>
                           <div class="infoboxnote" id="GUID-7E127507-D2F5-4771-A8A9-BAF6E553831B__GUID-0585BC8F-BAC1-4773-8348-ABA318F429F3">
                              <p class="notep1">注意：</p>
                              <p>如果要升级Oracle Real Application Clusters数据库，请在Oracle Real Application Clusters数据库配置了实例的所有节点上执行这些检查。</p>
                           </div>
                           <div class="infoboxnotealso" id="GUID-7E127507-D2F5-4771-A8A9-BAF6E553831B__GUID-54C029BB-B323-481B-BD77-0DCD6AD07D41">
                              <p class="notep1">也可以看看：</p>
                              <p>有关在操作系统上设置其他重要环境变量的信息，请参见Oracle数据库和Oracle Clusterware安装指南</p>
                           </div>
                        </li>
                        <li>
                           <p>在新的Oracle数据库版本下以Oracle主目录的身份登录系统。</p>
                        </li>
                        <li>
                           <p>从路径<code class="codeph"><span class="variable" translate="no">Oracle_home</span> /rdbms/admin</code>目录中的新Oracle主目录中启动SQL * Plus。
                           </p>
                           <p>例如：</p><pre class="pre codeblock"><code>$ cd $ ORACLE_HOME / rdbms / admin $ pwd /u01/app/oracle/product/19.0.0/dbhome_1/rdbms/admin $ sqlplus</code></pre><p>在Windows平台上，要访问SQL * Plus，请将目录更改为<code class="codeph">%ORACLE_HOME%/bin</code></p>
                        </li>
                        <li>
                           <p>使用具有SYSDBA权限的帐户连接到要升级的数据库：</p><pre class="pre codeblock"><code>SQL&gt; CONNECT / AS SYSDBA</code></pre></li>
                        <li>
                           <p>以升级模式启动CDB：</p><pre class="pre codeblock"><code>SQL&gt;启动升级</code></pre></li>
                        <li id="GUID-7E127507-D2F5-4771-A8A9-BAF6E553831B__I1012182">
                           <p>通过在SQL * Plus中发出以下命令来启动实例：</p><pre class="pre codeblock"><code>SQL&gt; alter pluggable数据库全部打开升级;</code></pre><p>如果出现列出不支持的初始化参数的错误，请记下不支持的初始化参数并继续升级。下次关闭数据库时删除不支持的初始化参数。</p>
                           <div class="infoboxnote" id="GUID-7E127507-D2F5-4771-A8A9-BAF6E553831B__GUID-0C72C88B-7D9A-4308-9EEF-4F3C6C3FB1C7">
                              <p class="notep1">注意：</p>
                              <p>以<code class="codeph">UPGRADE</code>模式启动数据库会执行以下操作：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>使用新版本的Oracle数据库实例启动数据库</p>
                                 </li>
                                 <li>
                                    <p>将登录限制为SYSDBA</p>
                                 </li>
                                 <li>
                                    <p>禁用系统触发器</p>
                                 </li>
                                 <li>
                                    <p>执行准备数据库以进行升级的其他操作</p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li>
                           <p>在继续下一步之前退出SQL * Plus。</p>
                           <p>例如：</p><pre class="pre codeblock"><code>SQL&gt; EXIT</code></pre></li>
                        <li>
                           <p>要升级整个CDB，请从新的Oracle主<code>catctl.pl</code>运行并行升级实用程序（ <code>catctl.pl</code> ）。Parallel Upgrade Utility提供并行升级选项，可减少停机时间。您可以使用新Oracle主目录中的命令行脚本<code>dbupgrade</code>运行该命令。
                           </p>
                           <p>例如：</p>
                           <p>Linux的：</p><pre class="pre codeblock"><code>cd $ ORACLE_HOME / bin ./dbupgrade</code></pre><p>视窗：</p><pre class="pre codeblock"><code>cd％ORACLE_HOME％\ bin dbupgrade</code></pre><div class="infoboxnote" id="GUID-7E127507-D2F5-4771-A8A9-BAF6E553831B__GUID-B951FD5A-3870-4D4A-9054-BE70F095849F">
                              <p class="notep1">注意：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>使用<code class="codeph">-d</code>选项指定包含要处理的文件的目录。使用<code class="codeph">-l</code>选项指定要用于假脱机日志文件的目录。
                                    </p>
                                 </li>
                                 <li>
                                    <p>如果要升级整个CDB，并且<code class="codeph">CDB$ROOT</code>存在错误，则升级将中止。
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li>
                           <p>要升级CDB中的PDB子集，请指定包含列表或排除列表。</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>Linux或UNIX系统的此示例使用包含列表仅升级<code class="codeph">PDB1</code> ：</p><pre class="pre codeblock"><code>cd $ ORACLE_HOME / bin ./dbupgrade -c'PDB1'</code></pre></li>
                              <li>
                                 <p>Windows系统的此示例使用排除列表来升级除<code class="codeph">PDB1</code>之外的CDB中的所有<code class="codeph">PDB1</code> ：</p><pre class="pre codeblock"><code>cd $ ORACLE_HOME \ bin dbupgrade -C“PDB1”</code></pre></li>
                           </ul>
                           <div class="infoboxnote" id="GUID-7E127507-D2F5-4771-A8A9-BAF6E553831B__GUID-68D857C4-F8B5-4EAB-8347-56DC18BD5DE8">
                              <p class="notep1">注意：</p>
                              <p>您可以通过从早期版本的CDB中拔出它来升级单个PDB，然后将其插入到更高版本的CDB中。</p>
                              <p>对于Windows，当您使用包含（ <code class="codeph">-c</code> ）或排除（ <code class="codeph">-C</code> ）选项运行<code>dbupgrade</code>命令时，必须在CDB根名称和PDB种子名称周围指定带引号的选项。
                              </p>
                              <p>例如：</p>
                              <p>... <code class="codeph">-C "CDB$ROOT PDB$SEED"</code></p>
                           </div>
                        </li>
                        <li>
                           <p>对于CDB，以SYSDBA身份登录CDB并运行命令alter pluggable database all open以使数据库可用于重新编译代码。例如：</p><pre class="pre codeblock"><code>$ sqlplus / as sysdba SQL&gt; alter pluggable database all open;</code></pre></li>
                        <li>
                           <p>运行<code>catcon.pl</code> 。此命令启动<code>utlrp.sql</code>并重新编译任何剩余的存储的PL / SQL和Java代码。
                           </p>
                           <p>例如：</p><pre class="pre codeblock"><code>$ ORACLE_HOME / perl / bin / perl catcon.pl -n 1 -e -b utlrp -d'''。'''utlrp.sql</code></pre><p>因为使用<code class="codeph">-b utlrp0</code>运行命令，所以使用重新编译结果生成日志文件<code class="codeph">utlrp0.log</code> 。
                           </p>
                        </li>
                        <li>
                           <p>运行<code>postupgrade_fixups.sql</code> 。
                           </p>
                           <p>例如：</p><pre class="pre codeblock"><code>$ ORACLE_HOME / perl / bin / perl catcon.pl -n 1 -e -b postupgrade_fixups -d'''。'''postupgrade_fixups.sql</code></pre></li>
                        <li>
                           <p>运行<code>utlusts.sql</code> 。此命令验证是否已修复所有问题。
                           </p>
                           <p>例如，在CDB中：</p><pre class="pre codeblock"><code>$ ORACLE_HOME / perl / bin / perl catcon.pl -n 1 -e -b utlu122s -d'''。''''utlusts.sql</code></pre><p>因为使用<code class="codeph">-b utlu122s</code>运行命令， <code class="codeph">utlu122s0.log</code>会生成包含升级结果的日志文件<code class="codeph">utlu122s0.log</code> 。您可以查看<code class="codeph">upg_summary.log</code>文件以查看升级报告。
                           </p>
                           <p>要查看有关数据库状态的信息，请在完成升级后随时多次运行<code>utlusts.sql</code> 。如果<code>utlusts.sql</code>脚本返回错误，或者它显示未标记为<code class="codeph">VALID</code>组件，或者您运行的SQL脚本不是来自最新版本，请参阅本指南中的故障排除部分。
                           </p>
                        </li>
                        <li>
                           <p>使用<code class="codeph">DBMS_DST</code> PL / SQL程序包升级时区文件，确保时区数据文件是最新的。您还可以在升级后更新时区。如果更新时区，则必须更新<code class="codeph">CDB$ROOT</code>和PDB中的时区。
                           </p>
                        </li>
                        <li>
                           <p>退出SQL * Plus。</p>
                           <p>例如：</p><pre class="pre codeblock"><code>SQL&gt; EXIT</code></pre></li>
                        <li>
                           <p>（视情况而定）如果要升级Oracle Real Application Clusters数据库，请使用以下命令语法升级Oracle Clusterware中的数据库配置：</p><pre class="pre codeblock"><code>$ srvctl upgrade database -db <span class="variable" translate="no">db-unique-name</span> -oraclehome <span class="variable" translate="no">oraclehome</span></code></pre><p>在此示例中， <code class="codeph"><span class="variable" translate="no">db-unique-name</span></code>是分配的数据库名称（而不是实例名称）， <code class="codeph"><span class="variable" translate="no">oraclehome</span></code>是升级数据库的Oracle主目录位置。除了早期版本中使用的简短CLI选项之外， <code>SRVCTL</code>实用程序还支持长GNU样式选项。
                           </p>
                        </li>
                     </ol>
                     <p>您的数据库现已升级。您已准备好完成升级后的过程。</p>
                     <div class="infoboxnote" id="GUID-7E127507-D2F5-4771-A8A9-BAF6E553831B__GUID-ACC577D0-471E-4AF2-8EBC-B6FAD500DAF1">
                        <p class="notep1">警告：</p>
                        <p>如果您保留旧的Oracle软件，则永远不要使用旧软件启动升级的数据库。仅使用新Oracle Database主目录中的start命令启动Oracle数据库。</p>
                        <p>在删除旧的Oracle环境之前，请将该环境中的所有数据文件重定位到新的Oracle数据库环境。</p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-7E127507-D2F5-4771-A8A9-BAF6E553831B__GUID-3122BF73-6472-45A8-BF0B-1CBA9F96DDC2">
                        <p class="notep1">也可以看看：</p>
                        <p>有关重定位数据文件的信息，请参见<span><cite>“Oracle数据库管理员指南”</cite></span></p>
                     </div>
                     <p></p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="../admin/managing-data-files-and-temp-files.html#ADMIN012" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-8231CE50-ABEC-4BA3-A4AC-D461EB791ACD" title="要准备手动升级，请查看使用多租户体系结构部署的Oracle数据库的手动升级方案和过程。">多租户架构Oracle数据库的手动升级方案</a></p>
                     </div>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-6471F9F4-5151-4FA3-B5EC-B5AEBD99B0AA" name="GUID-6471F9F4-5151-4FA3-B5EC-B5AEBD99B0AA"></a><h3 id="UPGRD-GUID-6471F9F4-5151-4FA3-B5EC-B5AEBD99B0AA" class="sect3">关于使用具有优先级列表的并行升级实用程序升级PDB</h3>
               <div>
                  <p>在Oracle Database 12.2和更高版本中，您可以使用优先级列表升级PDB，以便在其他PDB之前升级一组PDB，并且可以修改该升级优先级。</p>
                  <div class="section">
                     <p>优先级列表使您可以根据优先级对PDB进行分组和升级。优先级列表是一个文本文件，其中包含定义升级优先级顺序的逗号分隔列表，以及每个数字优先级组中的PDB。使用<code>-L</code>选项运行并行升级实用程序（ <code>dbupgrade</code> ， <code>dbupgrade.cmd</code>或<code>catctl.pl</code> ）以使用优先级列表运行升级，并在升级运行时调用该列表。
                     </p>
                     <p>使用以下格式创建列表。在此格式示例中，变量<span class="variable" translate="no">numeral</span>是数值， <span class="variable" translate="no">pdbx</span>是PDB的名称。</p>
                     <p>号码，Pdb<br>
    <span class="variable" translate="no">numeral</span> ， <span class="variable" translate="no">pdb1</span> ， <span class="variable" translate="no">pdb2</span> ， <span class="variable" translate="no">pdb3</span><br>
    <span class="variable" translate="no">numeral</span> ， <span class="variable" translate="no">pdb4</span><br>
    <span class="variable" translate="no">numeral</span> ， <span class="variable" translate="no">pdb5</span> ， <span class="variable" translate="no">pdb6</span> ， <span class="variable" translate="no">pdb7</span> ， <span class="variable" translate="no">pdb8</span><br>。<br>。<br>。<br>
                        
                     </p>
                     <p>数字代表PDB的优先级。</p>
                     <p>PDB的优先事项如下：</p>
                     <ol>
                        <li>
                           <p>CDB $ ROOT：优先级1。首先升级容器数据库是必需的优先级。您无法更改容器数据库升级的优先级。始终首先处理CDB $ ROOT。</p>
                        </li>
                        <li>
                           <p>PDB $ SEED：优先级1。升级PDB种子数据库是必需的优先级。您无法更改PDB种子升级的优先级。PDB $ SEED总是在CDB $ ROOT之后升级，并且第一批PDB升级。</p>
                        </li>
                        <li>
                           <p>优先级列表1 PDB：优先级1是用户选择的最高优先级。在PDB $ SEED PDB升级的批次中，这些PDB在CDB $ ROOT之后升级第二。</p>
                        </li>
                        <li>
                           <p>优先级列表2 PDB：优先级2是第二高优先级PDB集。这些PDB在优先级1 PDB之后升级。</p>
                        </li>
                        <li>
                           <p>优先级列表3 PDB：优先级3是第三高优先级PDB集。这些PDBS在优先级2 PDB之后升级。</p>
                        </li>
                        <li>
                           <p>优先级列表4 PDB：优先级4是第四高优先级PDB集。这些PDBS在优先级3 PDB之后升级。</p>
                        </li>
                        <li>
                           <p>优先级列表5 PDB：优先级5是第五高优先级PDB集。这些PDBS在优先级4 PDB之后升级。</p>
                        </li>
                        <li>
                           <p>优先级列表6 PDB：优先级6是第六高优先级PDB集。这些PDBS在优先级7 PDB之后升级。</p>
                        </li>
                     </ol>
                     <p>运行并行升级实用程序时，以下处理规则适用：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>CDB $ ROOT和PDB $ SEED始终首先处理，即使它们不在优先级列表中。</p>
                        </li>
                        <li>
                           <p>优先级列表中的所有PDB按优先级顺序处理</p>
                        </li>
                        <li>
                           <p>未在优先级列表中列出的任何PDB将在优先级列表中指定的PDB之后处理。</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-6471F9F4-5151-4FA3-B5EC-B5AEBD99B0AA__GUID-4E069162-9199-4639-A9CA-FB94FA04C7FA">
                     <p>例如：</p><pre class="pre codeblock"><code>Number，Pdb 1，sales1，region2，receivables1 2，sales2 3，dss1，region3，region2，dss2，dss3</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-6471F9F4-5151-4FA3-B5EC-B5AEBD99B0AA__GUID-8EDC63B5-62A5-49AA-849D-2C0019F8F99A">
                     <p>使用以下语法使用优先级列表运行并行升级实用程序：</p><pre class="oac_no_warn" dir="ltr">dbupgrade -L <span class="variable" translate="no">priority_list_name</span></pre><p>例如，要使用Parallel Upgrade Utility批处理命令和名为<code class="codeph">My122Upgrade</code>的优先级列表在Windows系统上运行Parallel Upgrade Utility，请输入以下命令：</p><pre class="pre codeblock"><code>C：&gt; \ u01 \ app \ 19.1.0 \ db_home1 \ rdbms \ admin \ dbupgrade -L MyUpgrade</code></pre></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p>使用优先级列表完成升级以设置升级优先级后，这些PDB优先级状态将保留在PDB的CDB中。下一次升级将遵循先前升级中为PDB设置的优先级。</p>
                     <p>使用以下SQL命令语法更改PDB升级优先级状态，其中<code class="codeph"><span class="variable" translate="no">PDBName</span></code>是要更改其升级优先级的PDB的名称， <code class="codeph"><span class="variable" translate="no">PDBPriorityNumber</span></code>是要分配的新优先级值：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; alter session set container = CDB $ ROOT SQL&gt; alter pluggable database <span class="variable" translate="no">PDBName</span>升级优先级<span class="variable" translate="no">PDBPriorityNumber</span> </pre><p>例如：</p><pre class="pre codeblock"><code>SQL&gt; alter session set container = CDB $ ROOT SQL&gt; alter pluggable database region2 upgrade priority 2</code></pre><p>在此示例中，将前一示例中设置为升级优先级1的名为区域2的PDB更改为升级优先级2。</p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-8231CE50-ABEC-4BA3-A4AC-D461EB791ACD" title="要准备手动升级，请查看使用多租户体系结构部署的Oracle数据库的手动升级方案和过程。">多租户架构Oracle数据库的手动升级方案</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-55A00056-EFB3-4F81-8E28-3B8C9553B68F" name="GUID-55A00056-EFB3-4F81-8E28-3B8C9553B68F"></a><h3 id="UPGRD-GUID-55A00056-EFB3-4F81-8E28-3B8C9553B68F" class="sect3">关于使用优先级列表，包含列表和排除列表进行PDB升级</h3>
               <div>
                  <p>从Oracle Database 12 <span class="italic">c第</span> 2版（12.2）开始，您可以使用包含和排除列表以及优先级列表来控制PDB的升级方式。
                  </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-55A00056-EFB3-4F81-8E28-3B8C9553B68F__GUID-E5584CED-D425-4FDC-916E-1059A5952CFD">升级处理和列表</p>
                     <p>以下术语指定升级列表处理的类型：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><strong class="term">优先级列表</strong> ：以逗号分隔的列表，用于指定列表中PDB的升级优先级。
                           </p>
                        </li>
                        <li>
                           <p><strong class="term">包含列表</strong> ：指定要升级的PDB的逗号分隔列表。这些列表中的PDB在优先级列表中列出的PDB之后升级。
                           </p>
                        </li>
                        <li>
                           <p><strong class="term">排除列表</strong> ：以逗号分隔的列表，用于指定您不希望升级的PDB。
                           </p>
                        </li>
                     </ul>
                     <p>您可以通过以下方式使用包含列表和排除列表：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>单独包括或排除升级中的一组PDB</p>
                        </li>
                        <li>
                           <p>与优先级列表一起提供PDB升级顺序的详细规范，以及从升级中排除哪些PDB。</p>
                           <p>当包含列表与优先级列表一起使用时，包含列表中列出的PDB将根据它们在优先级列表中分配的优先级值进行升级。包含列表中列出但未在优先级列表中列出的PDB在优先级列表中的所有PDB升级后升级。</p>
                           <p>当排除列表与优先级列表一起使用时，排除列表中列出的PDB不会升级。</p>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-55A00056-EFB3-4F81-8E28-3B8C9553B68F__GUID-D5A0B39E-340E-40E7-8CA5-5B62E73DA37B">
                        <p class="notep1">注意：</p>
                        <p>使用纯文本编辑器创建优先级列表，例如Linux和UNIX上的<code class="codeph">vi</code>或Windows上的记事本。
                        </p>
                        <p>在本主题的示例中， <code class="codeph">cpu_count</code>值等于2。
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-55A00056-EFB3-4F81-8E28-3B8C9553B68F__GUID-CE75E627-370D-4843-8BB0-9482A57A670B">使用默认处理升级优先级</p>
                     <p>如果您未使用列表指定如何升级CDB中的PDB，则<strong class="term">默认处理</strong>是执行的升级处理。
                     </p>
                     <p>使用默认处理，升级CDB $ ROOT，然后升级PDB $ SEED。根据您设置的并行度，可以与PDB $ SEED并行更新一个或多个PDB。升级完成后，PDB会随着升级处理器的升级而升级。</p>
                     <p>以下示例使用以下CDB和PDB的多租户配置：</p><pre class="pre codeblock"><code>CDB $ ROOT PDB $ SEED CDB1_PDB1 CDB1_PDB2 CDB1_PDB3 CDB1_PDB4 CDB1_PDB5</code></pre><p>在默认处理中，您不指定要升级或排除升级的PDB的首选项。使用默认处理，首先升级CDB $ ROOT，并在升级的第一组PDB中更新PDB $ SEED。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-55A00056-EFB3-4F81-8E28-3B8C9553B68F__GUID-E48D5A30-827D-4ED4-9896-95EFC27F0BD1">
                     <p class="titleinexample">示例4-29指定完整的PDB升级优先级</p>
                     <p>以下优先级列表示例，其中所有PDB的优先级设置由列表设置：</p><pre class="pre codeblock"><code>1，CDB $ ROOT 1，PDB $ SEED 1，CDB1_PDB1 1，CDB1_PDB2 2，CDB1_PDB3 2，CDB1_PDB4 3，CDB1_PDB5</code></pre><p>以下是编写相同列表的另一种方法，在该列表中按优先级顺序对PDB进行分组：</p><pre class="pre codeblock"><code>1，CDB $ ROOT 1，PDB $ SEED 1，CDB1_PDB1，CDB1_PDB2 2，CDB1_PDB3，CDB1_PDB4 3，CDB1_PDB5</code></pre><p>在前面的示例中，优先级1中列出的PDB是CDB1_PDB1和CDB1_PDB2。这些PDB在CDB1_PDB3和CDB1_PDB4之前升级。</p>
                     <p>这是编写相同列表的另一种方法，使用容器ID值（CON_ID）来设置优先级顺序：</p><pre class="pre codeblock"><code>1，CDB $ ROOT 1，PDB $ SEED 1,3,4 2,5,6 3,7</code></pre><p>在前面的示例中，优先级1中列出的PDB是CDB1_PDB1（由CON_ID 3标识）和CDB1_PDB2（由CON_ID 4标识）。这些PDB在CDB1_PDB3（CON_ID 5）和CDB1_PDB4（CON_ID 6）之前升级。</p>
                     <p>使用CON_ID指定优先级时，第一个数字指定PDB组的优先级。第二个值或数字指定该优先级分组中的PDB（通过CON_ID）编号。CDB $ ROOT始终首先更新，并且PDB $ SEED始终在第一个升级优先级组中更新。</p>
                     <p>这些示例都显示了具有以下特征的优先级列表升级：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>排除处理：无</p>
                        </li>
                        <li>
                           <p>包含处理：无</p>
                        </li>
                        <li>
                           <p>默认处理：无</p>
                        </li>
                     </ul>
                     <p>升级顺序按以下顺序执行：</p>
                     <ol>
                        <li>
                           <p>CDB $ ROOT</p>
                        </li>
                        <li>
                           <p>PDB $ SEED，CDB1_PDB1</p>
                        </li>
                        <li>
                           <p>CDB1_PDB2，CDB1_PDB3</p>
                        </li>
                        <li>
                           <p>CDB1_PDB4，CDB1_PDB5</p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-55A00056-EFB3-4F81-8E28-3B8C9553B68F__GUID-AF71BFF8-667D-4E2E-B3C8-98CB92690074">
                     <p class="titleinexample">示例4-30指定PDB的优先级子集，并使用默认处理升级其他PDB</p>
                     <p>以下示例指定名为<code class="codeph">priority.lst</code>的优先级列表，该列表指定要升级的PDB子集：</p><pre class="pre codeblock"><code>catctl -L priority.lst catupgrd.sql 1，CDB $ ROOT 1，PDB $ SEED 1，CDB1_PDB1，CDB1_PDB2</code></pre><p>此示例显示具有以下特征的优先级列表升级：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>排除处理：无</p>
                        </li>
                        <li>
                           <p>包含处理：无</p>
                        </li>
                        <li>
                           <p>默认处理：CDB1_PDB3，CDB1_PDB4，CDB1_PDB5</p>
                        </li>
                     </ul>
                     <p>升级顺序按以下顺序执行：</p>
                     <ol>
                        <li>
                           <p>CDB $ ROOT</p>
                        </li>
                        <li>
                           <p>PDB $ SEED，CDB1_PDB1</p>
                        </li>
                        <li>
                           <p>CDB1_PDB2，CDB1_PDB3</p>
                        </li>
                        <li>
                           <p>CDB1_PDB4，CDB1_PDB5</p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-55A00056-EFB3-4F81-8E28-3B8C9553B68F__GUID-41C338F9-8B62-4101-99EB-645E4D65EDD6">
                     <p class="titleinexample">示例4-31指定PDB的优先级子集，以及使用包含列表升级其他PDB</p>
                     <p>以下示例指定名为<code class="codeph">priority.lst</code>的优先级列表，该列表指定用于升级的PDB的优先级子集：</p><pre class="pre codeblock"><code>catctl -L priority.lst -c'CDB1_PDB2 CDB1_PDB4 CDB1_PDB5'catupgrd.sql</code></pre><p>此命令引用以下优先级列表：</p><pre class="pre codeblock"><code>1，CDB $ ROOT 1，PDB $ SEED 1，CDB1_PDB2，CDB1_PDB4 2。CDB1_PDB5</code></pre><p>此示例显示具有以下特征的优先级列表升级：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>排除处理：无</p>
                        </li>
                        <li>
                           <p>包含处理：CDB1_PDB2 CDB1_PDB4 CDB1_PDB5</p>
                        </li>
                        <li>
                           <p>默认处理：无</p>
                        </li>
                     </ul>
                     <p>升级顺序按以下顺序执行：</p>
                     <ol>
                        <li>
                           <p>CDB1_PDB2，CDB1_PDB4</p>
                        </li>
                        <li>
                           <p>CDB1_PDB5</p>
                        </li>
                     </ol>
                     <p>并行升级实用程序仅处理包含列表中的PDB，并按优先级列表的顺序处理。</p>
                  </div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-55A00056-EFB3-4F81-8E28-3B8C9553B68F__GUID-074EF1CA-8B41-4640-B3D3-DCC45C0E3DB7">
                     <p class="titleinexample">示例4-32指定PDB的优先级子集，并使用排除列表排除CDB $ ROOT</p>
                     <p>以下示例使用名为<code class="codeph">priority.lst</code>的优先级列表运行<code>catctl</code> 。因为此命令使用<code class="codeph">-C</code>选项运行，所以它从升级中排除了CDB $ ROOT：</p><pre class="pre codeblock"><code>catctl -L priority.lst -C'CDB $ ROOT'catupgrd.sql</code></pre><p>这是优先级列表：</p><pre class="pre codeblock"><code>1，CDB $ ROOT 1，PDB $ SEED 1，CDB1_PDB1，CDB1_PDB2 2，CDB1_PDB3，CDB1_PDB4 3，CDB1_PDB5</code></pre><p>使用优先级列表处理升级以指定升级优先级。</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>包含处理：无</p>
                        </li>
                        <li>
                           <p>排除处理：CDB $ ROOT</p>
                        </li>
                        <li>
                           <p>优先处理：PDB $ SEED，CDB1_PDB1，CDB1_PDB2，CDB1_PDB3，CDB1_PDB4，CDB1_PDB5</p>
                        </li>
                     </ul>
                     <p>由于排除了CDB $ ROOT，优先级处理会发生变化。升级顺序按以下顺序执行：</p>
                     <ol>
                        <li>
                           <p>PDB $ SEED，CDB_PDB1</p>
                        </li>
                        <li>
                           <p>CDB_PDB2，CDB_PDB3</p>
                        </li>
                        <li>
                           <p>CDB1_PDB4，CDB1_PDB5</p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-55A00056-EFB3-4F81-8E28-3B8C9553B68F__GUID-671C1BE2-8FF5-4E18-9042-B48D7A432283">
                     <p class="titleinexample">示例4-33使用CATCTL_LISTONLY指定排除列表</p>
                     <p>以下示例指定名为<code class="codeph">priority.lst</code>的优先级列表，该列表指定要升级的PDB子集。使用CATCTL_LISTONLY选项，不在优先级列表中的PDB将从升级中排除：</p><pre class="pre codeblock"><code>catctl -L priority.lst -C'CATCTL_LISTONLY'catupgrd.sql</code></pre><p>优先清单：</p><pre class="pre codeblock"><code>1，CDB $ ROOT 1，PDB $ SEED 1，CDB1_PDB1，CDB1_PDB2 2，CDB1_PDB3 3，CDB1_PDB5</code></pre><ul style="list-style-type:disc">
                        <li>
                           <p>排除处理：CATCTL_LISTONLY（仅处理包含优先级列表）</p>
                        </li>
                        <li>
                           <p>包含处理：无</p>
                        </li>
                        <li>
                           <p>默认处理：无</p>
                        </li>
                     </ul>
                     <p>升级顺序按以下顺序执行：</p>
                     <ol>
                        <li>
                           <p>CDB $ ROOT</p>
                        </li>
                        <li>
                           <p>PDB $ SEED，CDB1_PDB1，CDB1_PDB2</p>
                        </li>
                        <li>
                           <p>CDB1_PDB3，CDB1_PDB5</p>
                        </li>
                     </ol>
                     <div class="infoboxnote" id="GUID-55A00056-EFB3-4F81-8E28-3B8C9553B68F__GUID-741A4472-8440-43EB-B3A3-D8D43D2F49C5">
                        <p class="notep1">注意：</p>
                        <p>在排除列表中指定关键字CATCTL_LISTONLY会将优先级列表转换为包含优先级列表。仅处理列表中的PDB。在此方案中没有进行默认处理，因此在此示例中，不处理CDB1_PDB4。</p>
                     </div>
                  </div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-55A00056-EFB3-4F81-8E28-3B8C9553B68F__GUID-3CF7D679-115C-40A4-8982-9D1FD6C9AB2E">
                     <p class="titleinexample">示例4-34使用CON_ID值指定优先级列表</p>
                     <p>以下示例指定名为<code class="codeph">priority.lst</code>的优先级列表，该列表指定要升级的PDB子集：</p><pre class="pre codeblock"><code>catctl -L priority.lst -C'CATCTL_LISTONLY'catupgrd.sql</code></pre><p>升级顺序由优先级列表优先级编号决定。在<code class="codeph">-L</code>参数， <code class="codeph">priority.lst</code>调用的列表中，升级优先级编号后面的数字是与PDB名称关联的CON_ID值：</p><pre class="pre codeblock"><code>1,3,4 2,5，CDB1_PDB4 3,7</code></pre><p>在前面的列表示例中，请注意您可以混合使用CON_ID编号和PDB名称。</p>
                     <p>优先级3中列出的PDB是CDB1_PDB1（由CON_ID 3标识）和CDB1_PDB2（由CON_ID 4标识）。这些PDB在CDB1_PDB3（CON_ID 5），CDB1_PDB4（由名称标识）和CDB1_PDB5（CON_ID 7）之前升级。</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>排除处理： <code class="codeph">-C CATCTL_LISTONLY</code> （仅处理包含优先级列表中的PDB）</p>
                        </li>
                        <li>
                           <p>排除处理：无</p>
                        </li>
                        <li>
                           <p>包含处理：在<code class="codeph">priority.lst</code>指定</p>
                        </li>
                        <li>
                           <p>默认处理：CDB $ ROOT，PDB $ SEED</p>
                        </li>
                     </ul>
                     <p>升级顺序由优先级列表确定，该列表使用与PDB关联的CON_ID号。</p>
                     <ol>
                        <li>
                           <p>CDB $ ROOT</p>
                        </li>
                        <li>
                           <p>PDB $ SEED，CDB1_PDB1</p>
                        </li>
                        <li>
                           <p>CDB1_PDB2，CDB1_PDB3</p>
                        </li>
                        <li>
                           <p>CDB1_PDB4，CDB1_PDB5</p>
                        </li>
                     </ol>
                     <div class="infoboxnote" id="GUID-55A00056-EFB3-4F81-8E28-3B8C9553B68F__GUID-FD690F88-AB20-465D-BD6D-811255806B34">
                        <p class="notep1">注意：</p>
                        <p>此示例演示如何使用CON_ID指定PDB，并从优先级列表中省略CDB $ ROOT和PDB $ SEED。CDB $ ROOT和PDB $ SEED使用默认处理进行处理。</p>
                     </div>
                  </div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-8231CE50-ABEC-4BA3-A4AC-D461EB791ACD" title="要准备手动升级，请查看使用多租户体系结构部署的Oracle数据库的手动升级方案和过程。">多租户架构Oracle数据库的手动升级方案</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-4CA89342-971B-447C-A643-9638DE4EB121" name="GUID-4CA89342-971B-447C-A643-9638DE4EB121"></a><h3 id="UPGRD-GUID-4CA89342-971B-447C-A643-9638DE4EB121" class="sect3">并行升级多租户架构</h3>
               <div>
                  <p>使用此技术升级多租户架构Oracle数据库版本（Oracle Database 12c第1版（12.1.0.1）及更高版本，升级容器数据库（CDB），然后并行升级多个可插拔数据库（PDB）。</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-8775B0AB-CBED-4173-9B76-4F6E34841EFB">关于并行升级可插拔数据库（PDB）</a><br>使用并行技术，您可以升级CDB，然后使用并行SQL处理器立即升级PDB。
                     </li>
                     <li class="ulchildlink"><a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-5C043DD3-309A-4C8A-B500-1CAFC2CAB875">并行升级多租户容器数据库</a><br>使用此技术在一次升级操作中升级CDB中的CDB $ ROOT，PDB $ SEED和所有PDBS。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-8231CE50-ABEC-4BA3-A4AC-D461EB791ACD" title="要准备手动升级，请查看使用多租户体系结构部署的Oracle数据库的手动升级方案和过程。">多租户架构Oracle数据库的手动升级方案</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-8775B0AB-CBED-4173-9B76-4F6E34841EFB" name="GUID-8775B0AB-CBED-4173-9B76-4F6E34841EFB"></a><h4 id="UPGRD-GUID-8775B0AB-CBED-4173-9B76-4F6E34841EFB" class="sect4">关于并行升级可插拔数据库（PDB）</h4>
                  <div>
                     <p>使用并行技术，您可以升级CDB，然后使用并行SQL处理器立即升级PDB。</p>
                     <p>容器数据库（CDB）可以包含零个，一个或多个可插拔数据库（PDB）。默认情况下，并行升级实用程序（ <code>catctl.pl</code> ）在同一升级窗口中更新CDB及其所有PDB。并行升级实用程序使用计算机处理单元（CPU）的数量来确定同时升级的最大PDB数。并行升级的PDB数量是通过将并行SQL进程计数（ <code class="codeph">-n</code>选项）除以并行PDB SQL进程计数（ <code class="codeph">-N</code>选项）来确定的。
                     </p>
                     <div class="infoboxnote" id="GUID-8775B0AB-CBED-4173-9B76-4F6E34841EFB__GUID-52D5F0B2-2B17-4333-8BDC-5132B664B1ED">
                        <p class="notep1">注意：</p>
                        <p>您必须规划升级窗口，以适应CDB上提供的所有数据库服务的常见停机时间。</p>
                     </div>
                     <div class="section">
                        <p class="subhead3" id="GUID-8775B0AB-CBED-4173-9B76-4F6E34841EFB__GUID-F883EE3A-D6EF-4013-86E3-37BB40975BD9">可插拔数据库升级语法</p>
                        <p><code class="codeph">dbupgrade [-M] -n</code> [-N]</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">-M</code>指定CDB $ ROOT是保持升级模式，还是在升级完成后可用：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>如果使用<code class="codeph">-M</code>参数运行并行升级实用程序，则升级会将CDB $ ROOT及其所有PDB置于升级模式，这可以减少总升级时间。但是，在CDB及其所有PDB升级之前，您无法启动任何PDB。
                                    </p>
                                 </li>
                                 <li>
                                    <p>如果不使用<code class="codeph">-M</code>参数运行Parallel Upgrade Utility，则会在正常模式下升级并重新启动CDB $ ROOT，并启动正常的后台进程。升级成功后，只能在读/写模式下打开CDB $ ROOT。所有PDB都处于MOUNT模式。随着每个PDB的升级，您可以将每个PDB联机，而其他PDB仍在升级。
                                    </p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p><code class="codeph">-n</code>指定并行PDB升级处理器的数量。
                              </p>
                              <p>如果未指定<code class="codeph">-n</code>的值，则<code class="codeph">-n</code>的<code class="codeph">CPU_COUNT</code>值为<code class="codeph">CPU_COUNT</code>值。
                              </p>
                              <p>如果为<code class="codeph">-n</code>指定了值，则该值用于确定并行SQL进程的数量。最大值是无限的。最小值为4。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">-N</code>指定升级PDB时要使用的SQL处理器数。最大值为8。最小值为1。如果未指定<code class="codeph">-N</code>的值，则默认值为2。
                              </p>
                           </li>
                           <li>
                              <p>同时运行的最大PDB升级是<code class="codeph">-n</code>的值除以<code class="codeph">-N</code>的值。</p>
                           </li>
                        </ul>
                        <p>以下是In Parallel PDB升级技术期间的高级操作列表：</p>
                        <ol>
                           <li>
                              <p>确保您的备份策略已完成。</p>
                           </li>
                           <li>
                              <p>运行升级前工具。修复报告的任何问题..升级前工具（ <code class="codeph">preupgrade.jar</code> ）随新的Oracle数据库版本一起提供。
                              </p>
                           </li>
                           <li>
                              <p>运行并行升级实用程序。按顺序，执行以下升级：</p>
                              <ol type="a">
                                 <li>
                                    <p>周期1：CDB $ ROOT升级到新的Oracle版本</p>
                                 </li>
                                 <li>
                                    <p>循环2到循环x：PDB $ SEED和PDB并行升级，升级循环次数由您使用<code class="codeph">-n</code>指定的参数设置确定。
                                    </p>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>完成升级后的步骤。</p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-8775B0AB-CBED-4173-9B76-4F6E34841EFB__GUID-A3DC5104-9402-45CD-82F0-6277064E9EEB">
                        <p class="titleinexample">示例4-35使用默认值进行多租户架构升级示例（无参数集）</p>
                        <p>在这种情况下，您的<code class="codeph">CPU_COUNT</code>值等于24。如果未使用<code class="codeph">-n</code>选项为并行PDB处理器指定值，则并行PDB处理器（ <code class="codeph">-n</code> ）的默认值等于24。如果未指定<code class="codeph">-N</code>的值，则SQL处理器数（ <code class="codeph">-N</code> ）的默认值为2。
                        </p>
                        <p>结果：</p>
                        <p>12个PDB并行升级（ <code class="codeph">CPU_COUNT</code>除以2，或24除以2）为每个PDB分配了2个并行SQL进程。</p>
                     </div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-8775B0AB-CBED-4173-9B76-4F6E34841EFB__GUID-9AA5D146-F428-40E0-858F-C3B8AF17D298">
                        <p class="titleinexample">例4-36使用64并行PDB升级处理器和4个并行SQL进程进行多租户架构升级的示例</p>
                        <p>在此方案中，通过指定选项<code class="codeph">-n 64</code>将并行PDB升级处理器的值设置为<code class="codeph">-n 64</code> 。通过指定选项<code class="codeph">-N 4</code> ，可以将并行SQL处理器的值指定为<code class="codeph">-N 4</code> 。
                        </p>
                        <p>结果：</p>
                        <p>16个PDB并行升级（64除以4）。每个PDB有4个并行SQL进程。</p>
                     </div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-8775B0AB-CBED-4173-9B76-4F6E34841EFB__GUID-4982DE61-7FBE-445F-82A7-C6D8F5245FD4">
                        <p class="titleinexample">例4-37使用20个并行PDB升级处理器和2个并行SQL进程进行多租户架构升级的示例</p>
                        <p>在此方案中，通过指定选项<code class="codeph">-n 20</code> ，可以将并行PDB升级处理器的值设置为<code class="codeph">-n 20</code> 。通过指定选项<code class="codeph">-N 2</code> ，可以将并行SQL处理器的值指定为<code class="codeph">-N 2</code> 。
                        </p>
                        <p>结果：</p>
                        <p>10个PDB并行升级（20除以2）。每个PDB有2个并行SQL进程。</p>
                     </div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-8775B0AB-CBED-4173-9B76-4F6E34841EFB__GUID-159AA1E9-EC16-48AB-A81E-52ED7AB9D872">
                        <p class="titleinexample">示例4-38使用10个并行PDB升级处理器和4个并行SQL进程进行多租户架构升级的示例</p>
                        <p>在此方案中，通过指定选项<code class="codeph">-n 10</code> ，可以将并行PDB升级处理器的值设置为<code class="codeph">-n 10</code> 。通过指定选项<code class="codeph">-N 4</code> ，可以将并行SQL处理器的值指定为2。
                        </p>
                        <p>结果：</p>
                        <p>2个PDB并行升级（10除以4）。每个PDB有4个并行SQL进程。</p>
                     </div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-4CA89342-971B-447C-A643-9638DE4EB121" title="使用此技术升级多租户架构Oracle数据库版本（Oracle Database 12c第1版（12.1.0.1）及更高版本，升级容器数据库（CDB），然后并行升级多个可插拔数据库（PDB）。">并行升级多租户架构</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-5C043DD3-309A-4C8A-B500-1CAFC2CAB875" name="GUID-5C043DD3-309A-4C8A-B500-1CAFC2CAB875"></a><h4 id="UPGRD-GUID-5C043DD3-309A-4C8A-B500-1CAFC2CAB875" class="sect4">并行升级多租户容器数据库</h4>
                  <div>
                     <p>使用此技术在一次升级操作中升级CDB中的CDB $ ROOT，PDB $ SEED和所有PDBS。</p>
                     <div class="section">如果您可以安排停机时间，Oracle建议您使用此方法，因为它提供了升级和维护简单的直接过程。使用此过程并行升级多租户架构容器数据库中的所有PDB，具体取决于服务器的可用处理器（CPU）。</div>
                     <!-- class="section" -->
                     <div class="p">
                        <div class="infoboxnote" id="GUID-5C043DD3-309A-4C8A-B500-1CAFC2CAB875__GUID-B9E56452-D917-4494-9CEA-1776AB539636">
                           <p class="notep1">注意：</p>
                           <p>使用并行升级方法升级整个容器时，必须关闭所有PDB。在计划的升级窗口中执行升级，以便可以关闭所有PDB。</p>
                        </div>
                        <div class="infoboxnote" id="GUID-5C043DD3-309A-4C8A-B500-1CAFC2CAB875__GUID-7E298C0B-771D-4F81-BFB5-1659CC483F66">
                           <p class="notep1">警告：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>始终在开始任何配置更改之前创建现有数据库的备份。</p>
                              </li>
                              <li>
                                 <p>设置兼容的初始化参数后，无法降级数据库。</p>
                              </li>
                              <li>
                                 <p>Oracle强烈建议您在开始升级之前将源数据库和目标数据库升级到最新的捆绑包修补程序或修补程序集更新（BP或PSU），并在开始降级之前将其升级到最新的版本更新。</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>确保您有适当的备份策略。</span></li>
                        <li class="stepexpand"><span>打开所有PDB。</span><div>
                              <p>例如：</p><pre class="pre codeblock"><code>SQL&gt; alter pluggable database all open;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>使用以下语法运行升级前信息工具（ <code class="codeph">preupgrade.jar</code> ）：</span><div><code class="codeph">/ java -jar <span class="variable" translate="no">$New_release_Oracle_home</span> /rdbms/admin/preupgrade.jar [TERMINAL | FILE | DIR outputdir] [TEXT | XML] [-c <span class="variable" translate="no">InclusionListOfPDBs</span> ] [-C <span class="variable" translate="no">ExclusionListOfPDBs</span> ]</code><p>对列表使用空格分隔。在Linux和UNIX上，通过将列表放在单引号内来定义列表： <code class="codeph">'</code> 。在Windows系统中，通过将双引号内的列表定义列表<code class="codeph">"</code> 。
                              </p>
                           </div>
                           <div>例如，运行以下命令以在PDB PDB1到PDB25上运行升级前信息工具，您可以在<code class="codeph">/u01/app/ oracle/product/12.2.0/dbhome_1/</code>为Oracle数据库Oracle主目录设置环境变量<code class="codeph">$ORACLE_HOME_12.2</code> <code class="codeph">/u01/app/ oracle/product/12.2.0/dbhome_1/</code> ，您已在<code>/u01/app/oracle/product/19.1.0/dbhome_1/</code>为新的Oracle数据库Oracle主目录设置了一个环境变量<code class="codeph">$ORACLE_HOME_19.1</code> ：<p>Linux和UNIX：</p><pre class="pre codeblock"><code>java -jar $ ORACLE_HOME_19.1 / rdbms / admin / preupgrade.jar \ -c'pdb1 pdb2 pdb3 pdb4 pdb5 pdb6 pdb7 pdb8 pdb9 pdb10 pdb11 pdb12 pdb13 \ pdb14 pdb15 pdb16 pdb17 pdb18 pdb19 pdb20 pdb21 pdb22 pdb23 pdb24 pdb25'</code></pre><p>视窗：</p><pre class="pre codeblock"><code>java -jar％ORACLE_HOME_19.1％/ rdbms / admin / preupgrade.jar \ -c“pdb1 pdb2 pdb3 pdb4 pdb5 pdb6 pdb7 pdb8 pdb9 pdb10 pdb11 pdb12 pdb13 \ pdb14 pdb15 pdb16 pdb17 pdb18 pdb19 pdb20 pdb21 pdb22 pdb23 pdb24 pdb25”</code></pre></div>
                           <div>
                              <div class="infoboxnote" id="GUID-5C043DD3-309A-4C8A-B500-1CAFC2CAB875__GUID-3CDD4AE3-9DFE-438B-82B3-2C4700E40E3D">
                                 <p class="notep1">注意：</p>
                                 <p>您必须使用Java 1.5或更高版本来运行升级前信息工具。默认情况下，您可以直接升级的Oracle数据库版本中的Java版本支持该工具。</p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>查看任何生成的修复脚本和日志文件。</span><div>
                              <p>默认情况下，如果定义了ORACLE_BASE，则修复文件将放置在以下路径之一中：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>Linux和UNIX：</p>
                                    <p><code>$ ORACLE_BASE / cfgtoollogs / <span class="variable" translate="no">db_unique_name</span> / preupgrade</code></p>
                                 </li>
                                 <li>
                                    <p>视窗</p>
                                    <p><code>％ORACLE_BASE％\ cfgtoollogs \ <span class="variable" translate="no">db_unique_name</span> \ preupgrade</code></p>
                                 </li>
                              </ul>
                              <p>如果未定义ORACLE_BASE，则修复文件将放置在以下路径之一中：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>Linux和UNIX：</p>
                                    <p><code class="codeph">$ ORACLE_HOME / cfgtoollogs / <span class="variable" translate="no">db_unique_name</span> / preupgrade</code></p>
                                 </li>
                                 <li>
                                    <p>视窗：</p>
                                    <p><code class="codeph">％ORACLE_HOME \ cfgtoollogs \ <span class="variable" translate="no">db_unique_name</span> \ preupgrade</code></p>
                                 </li>
                              </ul>
                              <p>在多租户架构Oracle数据库上，升级前信息工具还会创建一个合并的<code>preupgrade_fixups.sql</code>脚本。您可以使用<code>catcon.pl</code>运行整合的<code>catcon.pl</code>脚本。整合的fixup脚本在运行<code>preupgrade.jar</code>命令时打开的每个容器上运行。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>运行<code class="codeph">preupgrade_fixups</code>脚本或单个PDB脚本。<code class="codeph">preupgrade_fixups</code> SQL脚本解决了<code class="codeph">preupgrade</code>脚本报告的一些问题。</span><div>
                              <p>在多租户环境Oracle数据库部署中，您可以在源数据库上运行<code class="codeph">preupgrade_fixups <span class="variable" translate="no">pdb-name</span> .sql</code>脚本，其中<code class="codeph"><span class="variable" translate="no">pdb-name</span></code>是PDB名称。如果为PDB生成修复脚本，则会将PDB名称添加到fixup文件名中。
                              </p>
                              <p>除了单独的PDB <code>catcon.pl</code>脚本之外，您还可以使用<code>catcon.pl</code>来运行整合的<code>preupgrade_fixups.sql</code>脚本。统一脚本在运行<code>preupgrade.jar</code>时打开的每个容器上运行。
                              </p>
                              <div class="infoboxnote" id="GUID-5C043DD3-309A-4C8A-B500-1CAFC2CAB875__GUID-DAAD9892-D13C-4947-B51E-3E0655691C12">
                                 <p class="notep1">注意：</p>
                                 <p>因为$是操作系统上的保留符号，所以PDB $ SEED的修复脚本是<code>preupgrade_fixups_pdb_seed.sql</code> 。
                                 </p>
                              </div>
                           </div>
                           <div>
                              <p>完成升级前信息工具识别的任何其他预升级任务。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>（视情况而定）对于Oracle RAC数据库，将cluster database initialization参数设置为false：</span><div>
                              <p>例如;</p><pre class="pre codeblock"><code>ALTER SYSTEM SET cluster_database = FALSE SCOPE = spfile;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>关闭旧Oracle主目录中的数据库。</span><div>
                              <p>例如， <code class="codeph"><span class="variable" translate="no">db_unique_name</span></code>是您的数据库名称：</p><code class="codeph">$ srvctl stop database -d <span class="variable" translate="no">db_unique_name</span></code></div>
                        </li>
                        <li class="stepexpand"><span>将<code class="codeph">PFILE</code>或<code class="codeph">SPFILE</code>从旧的Oracle主目录复制到新的Oracle主目录</span></li>
                        <li class="stepexpand"><span>与SQL * Plus连接：</span><div><pre class="pre codeblock"><code>sqlplus / as sysdba</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>将CDB $ ROOT实例置于升级模式：</span><div><pre class="pre codeblock"><code>启动升级</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>将所有PDB置于升级模式：</span><div><pre class="pre codeblock"><code>ALTER PLOGGABLE DATABASE ALL OPEN UPGRADE;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>检查PDB的状态以确认它们已准备好升级：</span><div><pre class="pre codeblock"><code>显示PDBS</code></pre></div>
                           <div>对于所有PDB，请确保将状态设置为MIGRATE。</div>
                        </li>
                        <li class="stepexpand"><span>退出SQL * Plus，并将目录更改为新的Oracle主目录<code>$ORACLE_HOME/rdbms/admin</code> ：</span><div><pre class="pre codeblock"><code>SQL&gt; EXIT $ ORACLE_HOME / bin</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>使用并行升级实用程序（ <code class="codeph">catctl.pl</code> ，使用shell命令<code class="codeph">dbupgrade</code> ）开始升级，其中<code class="codeph">-d</code>指定目录的位置：</span><div><pre class="pre codeblock"><code>dbupgrade -d $ ORACLE_HOME / rdbms / admin</code></pre></div>
                           <div>
                              <p>如果未指定任何参数，则并行升级实用程序将以相当于CPU数量除以2的PDB数量并行运行升级。在具有64个CPU的服务器上，64除以2等于并行升级的32个PDB，每个PDB使用两个SQL处理器执行。 CDB $ ROOT在升级期间保持正常模式。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>通过查看<code class="codeph">upg_summary.log</code>确认升级是否成功。如有必要，请查看其他日志。</span></li>
                        <li class="stepexpand"><span>打开所有PDB，以便您可以重新编译数据库：</span><div><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE ALL OPEN;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>退出SQL * Plus，并将目录更改为新的Oracle主路径<code>$ORACLE_HOME/rdbms/admin</code> ：</span><div><pre class="pre codeblock"><code>SQL&gt; EXIT cd $ ORACLE_HOME / rdbms / admin</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>运行<code class="codeph">catcon.pl</code>脚本和新版Oracle数据库提供的<code class="codeph">postupgrade_fixups.sql</code>脚本。</span><div>
                              <p>以下示例显示了用于运行<code>catcon.pl</code>的命令字符串，使用<code class="codeph">-n</code>参数为每个PDB指定一个并行处理器，使用<code class="codeph">-d</code>参数指定要运行的预升级脚本所在的路径，使用<code class="codeph">-l</code>参数指定脚本放置日志文件的位置，并使用<code class="codeph">-b</code>标志指定<code class="codeph">postupgrade_fixups.sql</code>脚本的日志文件前缀：</p><pre class="pre codeblock"><code>$ ORACLE_HOME / perl / bin / perl $ ORACLE_HOME / rdbms / admin / catcon.pl -n 1 -d \ $ ORACLE_HOME / cfgtoollogs / cdbupgr / preupgrade -l / home / oracle / upgrdDBA -b \ postupgrade_fixups postupgrade_fixups.sql</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>运行<code>postupgrade_fixups.sql</code> 。</span><div>
                              <p>非国家开发银行：</p><pre class="pre codeblock"><code>SQL&gt; @ rdbms / admin / postupgrade_fixups.sql</code></pre><p>CDB：</p><pre class="pre codeblock"><code>$ ORACLE_HOME / perl / bin / perl catcon.pl -n 1 -e -b postupgradefixups -d'''。'''postupgradefixups.sql</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>运行<code>utlusts.sql</code>以验证没有升级问题。</span><div>
                              <p>非国开行：</p><pre class="pre codeblock"><code>SQL&gt; @ rdbms / admin / utlusts.sql</code></pre><p>CDB：</p><pre class="pre codeblock"><code>$ ORACLE_HOME / perl / bin / perl catcon.pl -n 1 -e -b utlu122s -d'''。''''utlusts.sql</code></pre></div>
                           <div>
                              <p>使用<code>catcon.pl</code>运行<code>utlusts.sql</code> ，会生成日志文件<code class="codeph">utlu122s0.log</code> 。日志文件提供升级结果。您还可以查看升级报告<code class="codeph">upg_summary.log</code> 。
                              </p>
                              <p>要查看有关数据库状态的信息，请在升级完成后随时多次运行<code>utlusts.sql</code> 。如果<code>utlusts.sql</code>脚本返回错误，或显示状态为<code class="codeph">VALID</code>的组件，或者为该组件列出的版本不是最新版本，则执行故障排除。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>（视情况而定）仅对于Oracle RAC环境，输入以下命令将<span class="parmname" translate="no">CLUSTER_DATABASE</span>的初始化参数值设置为<code class="codeph">TRUE</code> ，并启动Oracle RAC数据库，其中<code class="codeph"><span class="variable" translate="no">dbname</span></code>是Oracle RAC数据库的名称：</span><div><pre class="pre codeblock"><code>ALTER SYSTEM SET CLUSTER_DATABASE = TRUE SCOPE = SPFILE; srvctl start database -db <span class="variable" translate="no">db_unique_name</span></code></pre></div>
                           <div>
                              <p>您的数据库现已升级。</p>
                              <div class="infoboxnote" id="GUID-5C043DD3-309A-4C8A-B500-1CAFC2CAB875__GUID-ACC577D0-471E-4AF2-8EBC-B6FAD500DAF1">
                                 <p class="notep1">警告：</p>
                                 <p>如果您保留旧的Oracle软件，则永远不要使用旧软件启动升级的数据库。仅使用新Oracle Database主目录中的start命令启动Oracle数据库。</p>
                                 <p>在删除旧的Oracle环境之前，请将该环境中的所有数据文件重定位到新的Oracle数据库环境。</p>
                              </div>
                              <div class="infoboxnotealso" id="GUID-5C043DD3-309A-4C8A-B500-1CAFC2CAB875__GUID-4FD7BF4A-F3A5-4914-9645-22387E206000">
                                 <p class="notep1">也可以看看：</p>
                                 <p>有关重定位数据文件的信息，请参见<a href="../admin/managing-data-files-and-temp-files.html#ADMIN012" target="_blank"><span><cite>“Oracle数据库管理员指南”</cite></span></a></p>
                              </div>
                           </div>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-4CA89342-971B-447C-A643-9638DE4EB121" title="使用此技术升级多租户架构Oracle数据库版本（Oracle Database 12c第1版（12.1.0.1）及更高版本，升级容器数据库（CDB），然后并行升级多个可插拔数据库（PDB）。">并行升级多租户架构</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
            <div class="props_rev_3"><a id="GUID-8F9AAFA1-690D-4F70-8448-E66D765AF136" name="GUID-8F9AAFA1-690D-4F70-8448-E66D765AF136"></a><h3 id="UPGRD-GUID-8F9AAFA1-690D-4F70-8448-E66D765AF136" class="sect3">使用Unplug-Plug顺序升级多租户架构</h3>
               <div>
                  <p>要升级早期版本多租户容器数据库（CDB），Oracle Database Release 12 <span class="italic">c</span> （12.1.0.1）及更高版本中的可插拔数据库（PDB），可以从早期版本的CDB中拔出PDB，并将PDB插入后来发布CDB。</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-4CB1CB0C-E893-41F6-A1A5-2E2BE1A706AF">关于按顺序升级可插拔数据库（PDB）</a><br>您可以通过从早期版本的CDB中拔出PDB，将其插入更高版本的CDB，然后将该PDB升级到更高版本来升级PDB。
                     </li>
                     <li class="ulchildlink"><a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-F1F89935-A2F1-4C3F-8138-FF34B3F01168">从早期版本CDB中拔出早期版本PDB</a><br>要准备升级PDB，请使用此过程从早期版本的CDB中拔出PDB。</li>
                     <li class="ulchildlink"><a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-E188F65A-8AE8-494F-80BD-7060AE02769E">将早期版本PDB插入后期版本CDB</a><br>要将PDB从早期版本的CDB插入到更高版本的CDB，请使用<code class="codeph">CREATE PLUGGABLE DATABASE</code>命令。
                     </li>
                     <li class="ulchildlink"><a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-99657846-6859-43BF-A514-0C8A7786734D">将早期版本PDB升级到更高版本</a><br>在<code class="codeph">UPGRADE</code>模式下打开PDB使用并行升级实用程序将早期版本的PDB升级到CDB的发布级别。</li>
                     <li class="ulchildlink"><a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-466B8807-EE9F-477E-BE59-600044BA882B">使用包含或排除列表进行PDB升级</a><br>如果要升级早期版本PDB的子集，请使用包含或排除列表以避免重新升级处于新版本级别的CDB或PDB。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-8231CE50-ABEC-4BA3-A4AC-D461EB791ACD" title="要准备手动升级，请查看使用多租户体系结构部署的Oracle数据库的手动升级方案和过程。">多租户架构Oracle数据库的手动升级方案</a></p>
                     </div>
                  </div>
               </div>
               <a id="UPGRD60151"></a><div class="props_rev_3"><a id="GUID-4CB1CB0C-E893-41F6-A1A5-2E2BE1A706AF" name="GUID-4CB1CB0C-E893-41F6-A1A5-2E2BE1A706AF"></a><h4 id="UPGRD-GUID-4CB1CB0C-E893-41F6-A1A5-2E2BE1A706AF" class="sect4">关于按顺序升级可插拔数据库（PDB）</h4>
                  <div>
                     <p>您可以通过从早期版本的CDB中拔出PDB，将其插入更高版本的CDB，然后将该PDB升级到更高版本来升级PDB。</p>
                     <p>CDB可以包含零个，一个或多个可插拔数据库（PDB）。安装新的Oracle数据库版本后，或升级CDB（ <code class="codeph">CDB$ROOT</code> ）后，可以升级一个或多个PDB，而无需升级CDB上的所有PDB。</p>
                     <p>您可以选择满足服务交付需求的升级计划。例如，您可以使用Oracle数据库升级助手（DBUA）升级一组PDB，也可以使用手动升级单独升级PDB，或使用包含或排除列表。您可以升级CDB和所有PDB（并行手动升级），也可以升级CDB，然后使用包含或排除列表单独或成组升级PDB。</p>
                     <p>以下是顺序PDB升级所需步骤的高级列表：</p>
                     <ol>
                        <li>
                           <p>从早期版本的CDB中拔出早期版本的PDB。</p>
                        </li>
                        <li>
                           <p>从CDB中删除PDB。</p>
                        </li>
                        <li>
                           <p>将早期版本的PDB插入更高版本的CDB。</p>
                        </li>
                        <li>
                           <p>将早期版本的PDB升级到更高版本。</p>
                        </li>
                     </ol>
                     <div class="p">使用Oracle Database 12 <span class="italic">c</span>第2版（12.2）及更高版本，您可以向Parallel Upgrade Utility提供列表以升级PDB：<ul style="list-style-type:disc">
                           <li>
                              <p>优先级列表，用于设置PDB升级的顺序</p>
                           </li>
                           <li>
                              <p>包含列表，使您可以在升级优先级列表中列出的PDB后指定要升级的一组PDB</p>
                           </li>
                           <li>
                              <p>排除列表，使您可以指定一组未升级的PDB</p>
                           </li>
                        </ul>
                     </div>
                     <div class="infoboxnote" id="GUID-4CB1CB0C-E893-41F6-A1A5-2E2BE1A706AF__GUID-A679BA33-EE92-487D-839F-6426BE4B665B">
                        <p class="notep1">注意：</p>
                        <p>除非备份PDB，否则无法恢复PDB。使用创建CDB并插入PDB的方法进行升级后，请务必备份PDB。</p>
                     </div>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="../bradv/backing-up-database.html#BRADV428" target="_blank"><span><cite>Oracle数据库备份和恢复用户指南</cite></span></a></li>
                           <li><a href="../multi/removing-a-pdb.html#ADMIN13623" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-8F9AAFA1-690D-4F70-8448-E66D765AF136" title="要升级早期版本多租户容器数据库（CDB），Oracle Database Release 12c（12.1.0.1）及更高版本中的可插拔数据库（PDB），可以从早期版本的CDB中拔出PDB，并将PDB插入更高版本发布CDB。">使用Unplug-Plug顺序升级多租户架构</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-F1F89935-A2F1-4C3F-8138-FF34B3F01168" name="GUID-F1F89935-A2F1-4C3F-8138-FF34B3F01168"></a><h4 id="UPGRD-GUID-F1F89935-A2F1-4C3F-8138-FF34B3F01168" class="sect4">从早期版本CDB中拔出早期版本PDB</h4>
                  <div>
                     <p>要准备升级PDB，请使用此过程从早期版本的CDB中拔出PDB。</p>
                     <ol>
                        <li>
                           <p>在PDB上运行升级前信息工具。</p>
                           <p>例如，名为<code class="codeph">salespdb</code>的PDB在<code class="codeph">$ORACLE_HOME_12.2</code>中的CDB中运行：</p><pre class="pre codeblock"><code>$ ORACLE_HOME_12.2 / jdk / bin / java -jar $ ORACLE_HOME_19 / rdbms / admin / preupgrade.jar dir / tmp -c salespdb</code></pre></li>
                        <li>
                           <p>在源数据库上运行<code>preupgrade_fixups.sql</code> 。
                           </p>
                           <p>例如：</p><pre class="pre codeblock"><code>CONNECT / AS SYSDBA SQL&gt; ALTER SESSION SET CONTAINER = salespdb; SQL&gt; @ / tmp / preupgrade_fixups_salespdb.sql</code></pre></li>
                        <li>
                           <p>遵循<code class="codeph">preupgrade.log</code>列出的所有建议。
                           </p>
                        </li>
                        <li>
                           <p>关闭要拔出的PDB。</p>
                           <p>例如，使用以下命令关闭PDB <code class="codeph">salespdb</code> ：</p><pre class="pre codeblock"><code>SQL&gt; ALTER PLUGGABLE DATABASE salespdb CLOSE;</code></pre></li>
                        <li>
                           <div class="p">重新登录<code class="codeph">CDB$ROOT</code> ：<pre class="pre codeblock"><code>CONNECT / AS SYSDBA SQL&gt; ALTER SESSION SET CONTAINER = CDB $ ROOT;</code></pre></div>
                        </li>
                        <li>
                           <p>使用以下SQL命令语法拔出早期版本的PDB，其中<code class="codeph"><span class="variable" translate="no">pdb</span></code>是PDB的名称， <code class="codeph"><span class="variable" translate="no">path</span></code>是PDB XML文件的位置：</p><pre class="pre codeblock"><code>ALTER PLUGGABLE DATABASE <span class="variable" translate="no">pdb</span> UNPLUG INTO ' <span class="variable" translate="no">path</span> / <span class="variable" translate="no">pdb</span> .XML';</code></pre><p>例如，pdb名称为<code class="codeph">salespdb</code> ，路径为<code>/home/oracle/salespdb.xml</code> ：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER PLUGGABLE DATABASE salespdb UNPLUG INTO'/home/oracle/salespdb.xml';</pre><p>命令完成时会显示以下响应：</p><pre class="pre codeblock"><code>可插拔数据库已更改</code></pre></li>
                        <li>
                           <p>删除可插拔数据库<code class="codeph">salespdb</code> ，但保留数据文件。
                           </p>
                           <p>Oracle建议您在此过程后删除<code class="codeph">salespdb</code>以清除CDB视图中的剩余信息，并帮助避免将来出现问题。作为最佳实践指南，首先在目标CDB中备份PDB，然后在源上发出<code class="codeph">DROP</code>命令。
                           </p>
                           <div class="infoboxnote" id="GUID-F1F89935-A2F1-4C3F-8138-FF34B3F01168__GUID-C961895F-16A0-4D2A-9DCC-B2FDF92447E1">
                              <p class="notep1">警告：</p>
                              <p>从原始CDB中删除PDB后，无法使用以前执行的备份恢复它，因为<code class="codeph">DROP</code>命令会删除备份文件。
                              </p>
                           </div>
                           <p>要删除可插拔数据库，请输入以下命令：</p><pre class="pre codeblock"><code>SQL&gt; DROP PLUGGABLE DATABASE salespdb KEEP DATAFILES;</code></pre></li>
                        <li>
                           <p>出口。</p>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-8F9AAFA1-690D-4F70-8448-E66D765AF136" title="要升级早期版本多租户容器数据库（CDB），Oracle Database Release 12c（12.1.0.1）及更高版本中的可插拔数据库（PDB），可以从早期版本的CDB中拔出PDB，并将PDB插入更高版本发布CDB。">使用Unplug-Plug顺序升级多租户架构</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="props_rev_3"><a id="GUID-E188F65A-8AE8-494F-80BD-7060AE02769E" name="GUID-E188F65A-8AE8-494F-80BD-7060AE02769E"></a><h4 id="UPGRD-GUID-E188F65A-8AE8-494F-80BD-7060AE02769E" class="sect4">将早期版本PDB插入后期版本CDB</h4>
                  <div>
                     <p>要将PDB从早期版本的CDB插入到更高版本的CDB，请使用<code class="codeph">CREATE PLUGGABLE DATABASE</code>命令。
                     </p>
                     <p>此过程示例显示了在使用Oracle托管文件时如何插入PDB。有关插入PDB的其他信息，请参阅“ <cite>Oracle数据库管理员指南”</cite> 。
                     </p>
                     <ol>
                        <li>
                           <p>连接到更高版本的CDB。</p>
                        </li>
                        <li>
                           <p>使用以下SQL命令插入早期版本的PDB，其中<code class="codeph"><span class="variable" translate="no">pdb</span></code>是PDB的名称， <code class="codeph"><span class="variable" translate="no">path</span></code>是PDB XML文件所在的路径：</p>
                           <p><kbd class="userinput">使用' <span class="variable" translate="no">path</span> / <span class="variable" translate="no">pdb</span> .xml'创建可插入的数据库<span class="variable" translate="no">pdb</span> ;</kbd></p>
                           <p>例如：</p><pre class="pre codeblock"><code>SQL&gt; CREATE PLUGGABLE DATABASE salespdb使用'/home/oracle/salespdb.xml';</code></pre><p>命令完成时会显示以下响应：</p><pre class="pre codeblock"><code>可插拔数据库已创建。</code></pre></li>
                     </ol>
                     <div class="infoboxnote" id="GUID-E188F65A-8AE8-494F-80BD-7060AE02769E__GUID-BDDDAFBC-3C75-4D12-9D3F-D42AEC7037BD">
                        <p class="notep1">注意：</p>
                        <p>插入早期版本的PDB时，PDB处于受限模式。您只能打开PDB进行升级。</p>
                     </div>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="../multi/plugging-in-a-pdb.html#ADMIN13553" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a></li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-8F9AAFA1-690D-4F70-8448-E66D765AF136" title="要升级早期版本多租户容器数据库（CDB），Oracle Database Release 12c（12.1.0.1）及更高版本中的可插拔数据库（PDB），可以从早期版本的CDB中拔出PDB，并将PDB插入更高版本发布CDB。">使用Unplug-Plug顺序升级多租户架构</a></p>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-99657846-6859-43BF-A514-0C8A7786734D" name="GUID-99657846-6859-43BF-A514-0C8A7786734D"></a><h4 id="UPGRD-GUID-99657846-6859-43BF-A514-0C8A7786734D" class="sect4">将早期版本PDB升级到更高版本</h4>
                  <div>
                     <p>在<code class="codeph">UPGRADE</code>模式下打开PDB使用并行升级实用程序将早期版本的PDB升级到CDB的发布级别。</p>
                     <ol>
                        <li>
                           <p>如果需要，请切换到要升级的PDB。例如，输入以下命令切换到PDB <code class="codeph">salespdb</code> ：</p><pre class="pre codeblock"><code>SQL&gt; ALTER SESSION SET CONTAINER = salespdb;</code></pre></li>
                        <li>
                           <p>在UPGRADE模式下打开PDB。</p><pre class="pre codeblock"><code>SQL&gt; ALTER PLUGGABLE DATABASE OPEN UPGRADE;</code></pre></li>
                        <li>
                           <p>使用Parallel Upgrade Utility命令（ <code>catctl.pl</code>或shell实用程序<code>dbupgrade</code> ）升级PDB。
                           </p>
                           <p>升级PDB时，可以使用通常与并行升级实用程序一起使用的命令。但是，您还要添加选项<code class="codeph">-c <span class="variable" translate="no">PDBname</span></code>以指定要升级的PDB。使用名为<code class="codeph">salespdb</code>的PDB将PDB的名称大写，如以下示例所示：</p><pre class="pre codeblock"><code>$ ORACLE_HOME / perl / bin / perl $ ORACLE_HOME / rdbms / admin / catctl.pl -d \ $ ORACLE_HOME / rdbms / admin -c'salespdb'-l $ ORACLE_BASE catupgrd.sql</code></pre></li>
                        <li>
                           <p>审核结果。</p>
                           <p>日志的缺省文件路径位于<code><span class="variable" translate="no">Oracle_base</span> /cfgtoollogs/ <span class="variable" translate="no">dbname</span> / <span class="variable" translate="no">upgradedatetime</span></code>路径中，其中<code class="codeph"><span class="variable" translate="no">Oracle_base</span></code>是Oracle基本路径， <code class="codeph"><span class="variable" translate="no">dbname</span></code>是数据库名称， <code class="codeph"><span class="variable" translate="no">Oracle_base</span></code>是<code class="codeph"><span class="variable" translate="no">upgradedatetime</span></code>的日期和时间。日期和时间字符串采用字符串格式<span class="variable" translate="no">YYYY</span> <span class="variable" translate="no">MM</span> <span class="variable" translate="no">DD</span> <span class="variable" translate="no">HH</span> <span class="variable" translate="no">MM</span> <span class="variable" translate="no">SC</span> ，其中<span class="variable" translate="no">YYYY</span>表示年份， <span class="variable" translate="no">MM</span>表示月份， <span class="variable" translate="no">DD</span>表示日期， <span class="variable" translate="no">HH</span>表示小时， <span class="variable" translate="no">MM</span>表示分钟， <span class="variable" translate="no">SC</span>表示秒。
                           </p>
                           <p>例如：</p><pre class="pre codeblock"><code>$ ORACLE_BASE / cfgtoollogs / salespdb / upgrade20181015120001 / upg_summary.log</code></pre></li>
                        <li>
                           <p>登录到SQL * Plus，打开PDB以执行升级后修订，并重新编译数据库中的<code class="codeph">INVALID</code>对象：</p><pre class="pre codeblock"><code>SQL&gt; STARTUP; SQL&gt; ALTER SESSION SET CONTAINER = salespdb;</code></pre></li>
                        <li>
                           <p>使用实用程序<code>catcon.pl</code>运行脚本<code>postupgrade_fixups.sql</code> ：</p><pre class="pre codeblock"><code>$ ORACLE_HOME / perl / bin / perl catcon.pl -c'salespdb'-n 1 -e -b postfixups -d'''。'''/ tmp / cfgtotoogs / reportspdb /preupgrade / posttupgrade_fixups.sql</code></pre></li>
                        <li>
                           <p>使用实用程序<code class="codeph">catcon.pl</code>从<code>$ORACLE_HOME/rdbms/admin</code>目录运行<code>utlrp.sql</code> ：</p><pre class="pre codeblock"><code>$ ORACLE_HOME / perl / bin / perl catcon.pl -c'salespdb'-n 1 -e -b comp -d'''。''''utlrp.sql</code></pre><p>该脚本重新编译数据库中的<code class="codeph">INVALID</code>对象，并将日志文件放在当前目录中，名称为<code class="codeph">comp0.log</code> 。
                           </p>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-8F9AAFA1-690D-4F70-8448-E66D765AF136" title="要升级早期版本多租户容器数据库（CDB），Oracle Database Release 12c（12.1.0.1）及更高版本中的可插拔数据库（PDB），可以从早期版本的CDB中拔出PDB，并将PDB插入更高版本发布CDB。">使用Unplug-Plug顺序升级多租户架构</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-466B8807-EE9F-477E-BE59-600044BA882B" name="GUID-466B8807-EE9F-477E-BE59-600044BA882B"></a><h4 id="UPGRD-GUID-466B8807-EE9F-477E-BE59-600044BA882B" class="sect4">使用包含或排除列表进行PDB升级</h4>
                  <div>
                     <p>如果要升级早期版本PDB的子集，请使用包含或排除列表以避免重新升级处于新版本级别的CDB或PDB。</p>
                     <p>Oracle建议您记录升级的容器，并使用包含或排除列表将这些容器从连续的批量升级中排除。从连续批量升级中排除升级容器可确保升级仅在需要升级的PDB上运行。避免重新升级可以最大限度地缩短整体升级时间，并避免不必要的不可用性。</p>
                     <p>例如：如果您使用多租户架构部署安装了Oracle数据库，那么容器<code class="codeph">CDB$ROOT</code> ， <code class="codeph">PDB$SEED</code>以及创建CDB时创建的任何其他PDB都是新版多租户架构的一部分。如果升级了CDB，同时将一组PDB升级到新版本，则无需再次升级CDB容器或升级的PDB。
                     </p>
                     <div class="p">在任何一种情况下，当您插入早期版本的PDB然后升级它们时，请使用排除列表或包含列表升级PDB：<ul style="list-style-type:disc">
                           <li>
                              <p>使用包含列表仅指定要升级的PDB集。</p>
                           </li>
                           <li>
                              <p>使用排除列表排除已升级的CDB和PDB容器。</p>
                           </li>
                        </ul>如果不使用包含列表或排除列表来限制升级范围，则并行升级实用程序（ <code>catctl.pl</code> ）会尝试升级整个CDB，而不仅仅是需要升级的PDB。在升级过程中，您的系统会遇到不必要的停机时间。包含列表和排除列表选项是互斥的。
                     </div>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="manual-upgrade-scenarios-multitenant-architecture-oracle-databases.html#GUID-8F9AAFA1-690D-4F70-8448-E66D765AF136" title="要升级早期版本多租户容器数据库（CDB），Oracle Database Release 12c（12.1.0.1）及更高版本中的可插拔数据库（PDB），可以从早期版本的CDB中拔出PDB，并将PDB插入更高版本发布CDB。">使用Unplug-Plug顺序升级多租户架构</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>