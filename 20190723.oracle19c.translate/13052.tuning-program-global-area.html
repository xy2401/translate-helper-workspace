<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>调整计划全球区域</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Database Performance Tuning Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Database Performance Tuning Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-performance-tuning-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-03-12T22:26:14-07:00"></meta>
      <meta name="dcterms.title" content="Database Performance Tuning Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="2007, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96347-03"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="tuning-result-cache.html" title="Previous" type="text/html"></link>
      <link rel="next" href="part-IV-managing-system-resources.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TGDBA"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="tuning-result-cache.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="part-IV-managing-system-resources.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">数据库性能调优指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-III-tuning-database-memory.html" property="item" typeof="WebPage"><span property="name">调整数据库内存</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">调整计划全球区域</li>
            </ol>
            <a id="GUID-FE1954FB-FAC9-4302-896E-6F47EB6C8A73" name="GUID-FE1954FB-FAC9-4302-896E-6F47EB6C8A73"></a><a id="TGDBA346"></a>
            
            <h2 id="TGDBA-GUID-FE1954FB-FAC9-4302-896E-6F47EB6C8A73" class="sect2"><span class="enumeration_chapter">16</span>调整计划全球区域</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍如何调整程序全局区域（PGA）。如果使用自动内存管理来管理系统上的数据库内存，则无需按本章所述手动调整PGA。</p>
               <p>本章包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="tuning-program-global-area.html#GUID-C698E2D4-495D-4DD7-AB7F-916F9C6EE8D1">关于计划全球区域</a></p>
                  </li>
                  <li>
                     <p><a href="tuning-program-global-area.html#GUID-251F5619-7D47-492F-8B9B-C2BA6BA3BA66">使用自动内存管理调整程序全局区域的大小</a></p>
                  </li>
                  <li>
                     <p><a href="tuning-program-global-area.html#GUID-C1796FFD-5A7E-4FA7-945B-4B6CE374091A">使用硬限制调整程序全局区域的大小</a></p>
                  </li>
               </ul>
            </div><a id="TGDBA347"></a><div class="props_rev_3"><a id="GUID-C698E2D4-495D-4DD7-AB7F-916F9C6EE8D1" name="GUID-C698E2D4-495D-4DD7-AB7F-916F9C6EE8D1"></a><h3 id="TGDBA-GUID-C698E2D4-495D-4DD7-AB7F-916F9C6EE8D1" class="sect3"><span class="enumeration_section">16.1</span>关于计划全球区域</h3>
               <div>
                  <p>程序全局区域（PGA）是一个私有内存区域，包含服务器进程的数据和控制信息。只有服务器进程才能访问PGA。 Oracle数据库代表服务器进程在PGA中读取和写入信息。这种信息的一个例子是光标的运行时区域。每次执行游标时，都会在执行该游标的服务器进程的PGA内存区域中为该游标创建一个新的运行时区域。</p>
                  <div class="infoboxnote" id="GUID-C698E2D4-495D-4DD7-AB7F-916F9C6EE8D1__GUID-40D90668-E3DC-4E57-8B68-198A7C0A5593">
                     <p class="notep1">注意：</p>
                     <p>使用共享服务器时，部分运行时区域可位于共享全局区域（SGA）中。</p>
                  </div>
                  <p>对于复杂查询（例如决策支持查询），运行时区域的很大一部分专用于由内存密集型操作员分配的工作区域，包括：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>基于排序的运算符，例如<code class="codeph">ORDER</code> <code class="codeph">BY</code> ， <code class="codeph">GROUP</code> <code class="codeph">BY</code> ， <code class="codeph">ROLLUP</code>和窗口函数</p>
                     </li>
                     <li>
                        <p>哈希联接</p>
                     </li>
                     <li>
                        <p>位图合并</p>
                     </li>
                     <li>
                        <p>位图创建</p>
                     </li>
                     <li>
                        <p>写入批量加载操作使用的缓冲区</p>
                     </li>
                  </ul>
                  <p>排序运算符使用工作区（排序区域）来执行一组行的内存中排序。类似地，散列连接运算符使用工作区（散列区）从其左输入构建散列表。</p>
               </div><a id="TGDBA469"></a><div class="props_rev_3"><a id="GUID-41CAC946-617F-4708-A3C2-EFF28CCD0C5F" name="GUID-41CAC946-617F-4708-A3C2-EFF28CCD0C5F"></a><h4 id="TGDBA-GUID-41CAC946-617F-4708-A3C2-EFF28CCD0C5F" class="sect4"><span class="enumeration_section">16.1.1</span>工作区大小</h4>
                  <div>
                     <p>Oracle数据库使您可以控制和调整大小<a id="d49029e207" class="indexterm-anchor"></a><a id="d49029e211" class="indexterm-anchor"></a>工作区。通常，较大的工作区域可以以较高的存储器消耗为代价显着改善特定操作员的性能。可用的工作区域大小包括：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>最佳</p>
                           <p>最佳大小是当工作区的大小足够大以至于它可以容纳由其关联的SQL运算符分配的输入数据和辅助存储器结构时。这是工作区的理想尺寸。</p>
                        </li>
                        <li>
                           <p>一号通</p>
                           <p>一次通过大小是当工作区的大小低于最佳大小并且在部分输入数据上执行额外通过时。使用一次通过大小，响应时间增加。</p>
                        </li>
                        <li>
                           <p>多通</p>
                           <p>多次通过大小是指工作区域的大小低于一次通过阈值并且需要多次通过输入数据。对于多次通过大小，响应时间显着增加，因为与输入数据大小相比，工作区域的大小太小。</p>
                        </li>
                     </ul>
                     <p>例如，必须对10 GB数据进行排序的串行排序操作需要多于10 GB才能以最佳大小运行，并且至少需要40 MB才能作为一次通过大小运行。如果工作区小于40 MB，则排序操作必须对输入数据执行多次传递。</p>
                     <p>在确定工作区域大小时，目标是让大多数工作区域以最佳大小运行（纯OLTP系统超过90％，甚至100％），并且只有少数工作区域以一次通过大小运行（小于10％）。应避免多次执行，原因如下：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>多次执行会严重降低性能。</p>
                           <p>大量的多遍工作区域对其关联的SQL运算符的响应时间具有指数级的不利影响。</p>
                        </li>
                        <li>
                           <p>运行一次执行不需要大量内存。</p>
                           <p>在一次通过大小中排序1 GB数据只需要22 MB。</p>
                        </li>
                     </ul>
                     <p>即使对于运行大型排序和散列连接的DSS系统，一次执行的内存要求也相对较小。配置有合理数量的PGA存储器的系统不需要对输入数据执行多次传递。</p>
                  </div>
               </div>
            </div><a id="TGDBA363"></a><div class="props_rev_3"><a id="GUID-251F5619-7D47-492F-8B9B-C2BA6BA3BA66" name="GUID-251F5619-7D47-492F-8B9B-C2BA6BA3BA66"></a><h3 id="TGDBA-GUID-251F5619-7D47-492F-8B9B-C2BA6BA3BA66" class="sect3"><span class="enumeration_section">16.2</span>使用自动内存管理调整程序全局区域大小</h3>
               <div>
                  <p>自动PGA内存管理简化并改进了PGA内存的分配方式。默认情况下，启用PGA内存管理。在此模式下，Oracle数据库通过动态调整专用于工作区的PGA内存部分，根据SGA内存大小的20％自动调整PGA的大小。最小值为10MB。</p>
                  <div class="infoboxnote" id="GUID-251F5619-7D47-492F-8B9B-C2BA6BA3BA66__GUID-63A3F267-DED8-4F6D-A1E8-4B6D75E76882">
                     <p class="notep1">注意：</p>
                     <p>为了向后兼容，可以通过将<code class="codeph">PGA_AGGREGATE_TARGET</code>初始化参数的值设置为0来禁用自动PGA内存管理。禁用自动PGA内存管理时，可以使用关联的<code class="codeph">_AREA_SIZE</code>参数（例如<code class="codeph">SORT_AREA_SIZE</code>初始化参数）调整工作区的最大大小。
                     </p>
                  </div>
                  <p>本节介绍如何使用自动PGA内存管理调整PGA的大小，并包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="tuning-program-global-area.html#GUID-6D7A1290-77B1-4388-BA84-73B8594DCF44">配置自动PGA内存管理</a></p>
                     </li>
                     <li>
                        <p><a href="tuning-program-global-area.html#GUID-7A3C7085-C5F9-4E02-A57D-FDC491723FAD">设置PGA_AGGREGATE_TARGET的初始值</a></p>
                     </li>
                     <li>
                        <p><a href="tuning-program-global-area.html#GUID-903DB64B-3019-4272-8812-4F00A05371FB">监控自动PGA内存管理</a></p>
                     </li>
                     <li>
                        <p><a href="tuning-program-global-area.html#GUID-C8C6D009-CF38-4996-AD0E-D97CE0CECE3D">调整PGA_AGGREGATE_TARGET</a></p>
                     </li>
                  </ul>
               </div><a id="TGDBA470"></a><div class="props_rev_3"><a id="GUID-6D7A1290-77B1-4388-BA84-73B8594DCF44" name="GUID-6D7A1290-77B1-4388-BA84-73B8594DCF44"></a><h4 id="TGDBA-GUID-6D7A1290-77B1-4388-BA84-73B8594DCF44" class="sect4"><span class="enumeration_section">16.2.1</span>配置自动PGA内存管理</h4>
                  <div>
                     <div class="section">
                        <p>在自动PGA内存管理模式下运行Oracle数据库时，会自动调整所有会话的工作区大小，并且在此模式下运行的所有会话都会忽略<code class="codeph">*_AREA_SIZE</code>参数。Oracle数据库自动从<code class="codeph">PGA_AGGREGATE_TARGET</code>初始化参数派生可用于活动工作区的PGA内存总量。PGA内存量设置为<code class="codeph">PGA_AGGREGATE_TARGET</code>的值减去分配给系统其他组件的PGA内存量（例如会话分配的PGA内存）。然后，Oracle数据库根据特定的内存要求将生成的PGA内存分配给各个活动工作区。
                        </p>
                        <p>Oracle数据库尝试通过动态控制分配给工作区的PGA内存量来遵守DBA设置的<code class="codeph">PGA_AGGREGATE_TARGET</code>值。为此，Oracle数据库首先尝试最大化所有内存密集型SQL操作的最佳工作区数。其余工作区域以单通道模式执行，除非DBA设置的PGA内存限制（使用<code class="codeph">PGA_AGGREGATE_TARGET</code>参数）非常低，因此需要多次执行才能减少内存消耗以符合PGA目标限制。
                        </p>
                        <p>配置新数据库实例时，可能很难确定<code class="codeph">PGA_AGGREGATE_TARGET</code>的相应设置。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-6D7A1290-77B1-4388-BA84-73B8594DCF44__GUID-8405E02C-0202-4078-943E-D694E85F4A92">配置自动PGA内存管理：</p>
                        <ol>
                           <li>
                              <p>对<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的值进行初始估计，如<span class="q">“ <a href="tuning-program-global-area.html#GUID-7A3C7085-C5F9-4E02-A57D-FDC491723FAD">设置PGA_AGGREGATE_TARGET的初始值</a> ”中所述</span> 。
                              </p>
                           </li>
                           <li>
                              <p>在数据库实例上运行代表性工作负载并监视其性能，如<span class="q">“ <a href="tuning-program-global-area.html#GUID-903DB64B-3019-4272-8812-4F00A05371FB">监视自动PGA内存管理</a> ”中所述</span> 。
                              </p>
                           </li>
                           <li>
                              <p>调优的价值<code class="codeph">PGA_AGGREGATE_TARGET</code>为<span class="q">“</span>中所述使用Oracle PGA建议统计参数， <span class="q"><a href="tuning-program-global-area.html#GUID-C8C6D009-CF38-4996-AD0E-D97CE0CECE3D">调整PGA_AGGREGATE_TARGET</a> ”。</span>
                              </p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-6D7A1290-77B1-4388-BA84-73B8594DCF44__GUID-1253D2F9-042A-4B72-A7D5-8D238D964AD8">
                           <p class="notep1">也可以看看：</p>
                           <p>有关<code class="codeph">PGA_AGGREGATE_TARGET</code>初始化参数的信息，请<a href="../refrn/PGA_AGGREGATE_TARGET.html#REFRN-GUID-DEBBD3F7-9F6D-4AC8-952C-0E0B2E62312D" target="_blank"><span class="italic">参见Oracle数据库参考</span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="TGDBA471"></a><div class="props_rev_3"><a id="GUID-7A3C7085-C5F9-4E02-A57D-FDC491723FAD" name="GUID-7A3C7085-C5F9-4E02-A57D-FDC491723FAD"></a><h4 id="TGDBA-GUID-7A3C7085-C5F9-4E02-A57D-FDC491723FAD" class="sect4"><span class="enumeration_section">16.2.2</span>设置PGA_AGGREGATE_TARGET的初始值</h4>
                  <div>
                     <div class="section">
                        <p>根据Oracle数据库实例的可用内存量设置<code class="codeph">PGA_AGGREGATE_TARGET</code>初始化参数的初始值。然后可以在实例级别调整并动态修改此值。默认情况下，Oracle数据库使用20％的SGA大小作为此值。但是，对于大型DSS系统，此设置可能太低。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-7A3C7085-C5F9-4E02-A57D-FDC491723FAD__GUID-7CA439E8-F6B9-495E-9C16-83E5F943C09A">要设置PGA_AGGREGATE_TARGET的初始值：</p>
                        <ol>
                           <li>
                              <p>确定为同一系统上运行的操作系统和其他非Oracle应用程序保留的总物理内存量。</p>
                              <p>例如，您可能决定为操作系统和其他非Oracle应用程序保留总物理内存的20％，将系统内80％的内存专用于Oracle数据库实例。</p>
                           </li>
                           <li>
                              <p>除以SGA和PGA之间的剩余可用内存：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>对于OLTP系统，PGA内存通常占可用内存的一小部分，剩余大部分内存用于SGA。</p>
                                    <p>Oracle建议最初将20％的可用内存分配给PGA，将80％分配给SGA。因此，OLTP系统的<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的初始值可以计算为：</p>
                                    <p><code class="codeph">PGA_AGGREGATE_TARGET</code> =（ <span class="italic"><code class="codeph">total_mem</code></span> * 0.8）* 0.2其中<span class="italic"><code class="codeph">total_mem</code></span>是系统上可用的物理内存总量。
                                    </p>
                                 </li>
                                 <li>
                                    <p>对于运行大量内存密集型查询的DSS系统，PGA内存通常可以使用高达70％的可用内存。</p>
                                    <p>Oracle建议最初将50％的可用内存分配给PGA，将50％分配给SGA。因此，DSS系统的<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的初始值可以计算为：</p>
                                    <p><code class="codeph">PGA_AGGREGATE_TARGET</code> =（ <span class="italic"><code class="codeph">total_mem</code></span> * 0.8）* 0.5其中<span class="italic"><code class="codeph">total_mem</code></span>是系统上可用的物理内存总量。
                                    </p>
                                 </li>
                              </ul>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>例如，如果Oracle数据库实例配置为在具有4 GB物理内存的系统上运行，并且如果80％（或3.2 GB）内存专用于Oracle数据库实例，则最初将<code class="codeph">PGA_AGGREGATE_TARGET</code>设置为640 MB OLTP系统，或DSS系统1,600 MB。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="TGDBA472"></a><div class="props_rev_3"><a id="GUID-903DB64B-3019-4272-8812-4F00A05371FB" name="GUID-903DB64B-3019-4272-8812-4F00A05371FB"></a><h4 id="TGDBA-GUID-903DB64B-3019-4272-8812-4F00A05371FB" class="sect4"><span class="enumeration_section">16.2.3</span>监控自动PGA内存管理</h4>
                  <div>
                     <p>在开始调整过程之前，在数据库实例上运行代表性工作负载并监视其性能。Oracle数据库收集的PGA统计信息使您可以确定最大PGA大小是否配置不足或配置过多。通过监视这些统计信息，您可以评估自动PGA内存管理的性能，并相应地调整<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的值。
                     </p>
                     <p>本节介绍如何使用性能视图监视自动PGA内存管理，并包含以下主题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="tuning-program-global-area.html#GUID-892FC04E-16ED-435D-8DF3-8B74A379993B">使用V $ PGASTAT视图</a></p>
                        </li>
                        <li>
                           <p><a href="tuning-program-global-area.html#GUID-9C657D3F-C162-46E1-AC5A-BFF7AAA3B3BA">使用V $ PROCESS视图</a></p>
                        </li>
                        <li>
                           <p><a href="tuning-program-global-area.html#GUID-B837C371-5384-49B5-9C6D-12982A8DF3BD">使用V $ PROCESS_MEMORY视图</a></p>
                        </li>
                        <li>
                           <p><a href="tuning-program-global-area.html#GUID-58B5CC9D-1B5D-4A1E-8417-C6C18FD06811">使用V $ SQL_WORKAREA_HISTOGRAM视图</a></p>
                        </li>
                        <li>
                           <p><a href="tuning-program-global-area.html#GUID-E2A9A057-60C3-4021-B6AC-8ECA79049CD5">使用V $ WORKAREA_ACTIVE视图</a></p>
                        </li>
                        <li>
                           <p><a href="tuning-program-global-area.html#GUID-060EB774-7876-40E3-B690-03409346AA9A">使用V $ SQL_WORKAREA视图</a></p>
                        </li>
                     </ul>
                  </div><a id="TGDBA475"></a><a id="TGDBA474"></a><a id="TGDBA476"></a><a id="TGDBA473"></a><div class="props_rev_3"><a id="GUID-892FC04E-16ED-435D-8DF3-8B74A379993B" name="GUID-892FC04E-16ED-435D-8DF3-8B74A379993B"></a><h5 id="TGDBA-GUID-892FC04E-16ED-435D-8DF3-8B74A379993B" class="sect5"><span class="enumeration_section">16.2.3.1</span>使用V $ PGASTAT视图</h5>
                     <div>
                        <div class="section">
                           <p><code class="codeph">V$PGASTAT</code>视图提供有关PGA内存使用情况和自动PGA内存管理器的实例级统计信息。
                           </p>
                           <p>以下示例显示了此视图的查询。</p><pre class="oac_no_warn" dir="ltr">SELECT * FROM V $ PGASTAT;</pre><p>此查询的输出可能如下所示：</p><pre class="oac_no_warn" dir="ltr">NAME VALUE UNIT ----------------------------------------------- --------- ---------- ------------聚合PGA目标参数41156608字节聚合PGA自动目标21823488字节全局内存绑定2057216字节总PGA使用16899072字节总PGA分配35014656字节最大PGA分配136795136字节总可用PGA内存524288字节PGA内存释放回OS 1713242112字节总PGA用于自动工作区0字节最大PGA用于自动工作区2383872字节总PGA用于手动工作区0字节最大PGA用于手动工作区域8470528字节超过分配计数291字节处理2124600320字节额外字节读取/写入39949312字节高速缓存命中百分比98.15％</pre><p><a href="tuning-program-global-area.html#GUID-892FC04E-16ED-435D-8DF3-8B74A379993B__BGBFJJBJ" title="描述V $ PGASTAT视图中显示的主要统计信息。">表16-1</a>描述了<code class="codeph">V$PGASTAT</code>视图中显示的主要统计信息。
                           </p>
                           <div class="tblformal" id="GUID-892FC04E-16ED-435D-8DF3-8B74A379993B__BGBFJJBJ">
                              <p class="titleintable">表16-1 V $ PGASTAT视图中的统计信息</p>
                              <table cellpadding="4" cellspacing="0" class="Formal" title="V $ PGASTAT视图中的统计信息" width="100%" border="1" summary="Describes the main statistics shown in the V$PGASTAT view." frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="31%" id="d49029e741">统计</th>
                                       <th align="left" valign="bottom" width="69%" id="d49029e744">描述</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="31%" id="d49029e749" headers="d49029e741 ">
                                          <p><code class="codeph">聚合PGA目标参数</code></p>
                                       </td>
                                       <td align="left" valign="top" width="69%" headers="d49029e749 d49029e744 ">
                                          <p>此统计信息显示<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的当前值。默认值为SGA大小的20％。将此参数设置为0将禁用自动PGA内存管理。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="31%" id="d49029e760" headers="d49029e741 ">
                                          <p><code class="codeph">聚合PGA自动目标</code></p>
                                       </td>
                                       <td align="left" valign="top" width="69%" headers="d49029e760 d49029e744 ">
                                          <p>此统计信息显示Oracle数据库可用于在自动模式下运行的工作区的PGA内存量。此数量是从<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的值和当前工作区工作负载动态派生的。因此，它由Oracle数据库不断调整。如果此值与<code class="codeph">PGA_AGGREGATE_TARGET</code>值相比较小，那么大多数PGA内存将被其他系统组件（例如PL / SQL或Java）使用，并且很少留给工作区域。确保在自动模式下运行的工作区域保留足够的PGA内存。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="31%" id="d49029e774" headers="d49029e741 ">
                                          <p><code class="codeph">全局记忆界限</code></p>
                                       </td>
                                       <td align="left" valign="top" width="69%" headers="d49029e774 d49029e744 ">
                                          <p>此统计信息显示在自动模式下执行的工作区的最大大小。Oracle数据库不断调整此值以反映工作区工作负载的当前状态。当系统中活动工作区域的数量增加时，全局存储器限制通常会减少。根据经验，全局边界的值不应减少到小于1 MB。如果是，请增加<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的值。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="31%" id="d49029e785" headers="d49029e741 ">
                                          <p><code class="codeph">分配的总PGA</code></p>
                                       </td>
                                       <td align="left" valign="top" width="69%" headers="d49029e785 d49029e744 ">
                                          <p>此统计信息显示数据库实例分配的当前PGA内存量。Oracle数据库尝试将此数字保持为小于<code class="codeph">PGA_AGGREGATE_TARGET</code>值。但是，如果工作区工作负载快速增加或者<code class="codeph">PGA_AGGREGATE_TARGET</code>参数设置为过低的值，则分配的PGA可能会在短时间内超过此值一小部分。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="31%" id="d49029e799" headers="d49029e741 ">
                                          <p><code class="codeph">总可用PGA内存</code></p>
                                       </td>
                                       <td align="left" valign="top" width="69%" headers="d49029e799 d49029e744 ">
                                          <p>此统计信息表示可以释放多少分配的PGA内存。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="31%" id="d49029e807" headers="d49029e741 ">
                                          <p><code class="codeph">用于汽车工作区的总PGA</code></p>
                                       </td>
                                       <td align="left" valign="top" width="69%" headers="d49029e807 d49029e744 ">
                                          <p>此统计信息表示在自动模式下运行的工作区当前消耗了多少PGA内存。使用此数字可确定PGA内存的其他使用者（例如PL / SQL或Java）消耗了多少内存：</p><pre class="oac_no_warn" dir="ltr">PGA其他=分配的总PGA  - 用于自动工作区的总PGA</pre></td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="31%" id="d49029e817" headers="d49029e741 ">
                                          <p><code class="codeph">超额分配数</code></p>
                                       </td>
                                       <td align="left" valign="top" width="69%" headers="d49029e817 d49029e744 ">
                                          <p>此统计信息是从实例启动累积的。如果<code class="codeph">PGA_AGGREGATE_TARGET</code>值太小而无法容纳<code class="codeph">PGA other</code>组件以及执行工作区工作负载所需的最小内存，则可能会发生过度分配PGA内存。在这种情况下，Oracle数据库无法<code class="codeph">PGA_AGGREGATE_TARGET</code>值，必须分配额外的PGA内存。如果发生过度分配，请使用<code class="codeph">V$PGA_TARGET_ADVICE</code>视图提供的信息增加<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的值，如<span class="q">“ <a href="tuning-program-global-area.html#GUID-4ED57621-B8D5-438C-A1CB-B5204A6C0427">使用V $ PGA_TARGET_ADVICE视图</a> ”中所述</span> 。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="31%" id="d49029e846" headers="d49029e741 ">
                                          <p><code class="codeph">处理的总字节数</code></p>
                                       </td>
                                       <td align="left" valign="top" width="69%" headers="d49029e846 d49029e744 ">
                                          <p>此统计信息表示自实例启动以来内存密集型SQL运算符处理的字节数。例如，处理的字节数是排序操作的输入大小。此数字用于计算<code class="codeph">cache</code> <code class="codeph">hit</code> <code class="codeph">percentage</code>度量标准。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="31%" id="d49029e863" headers="d49029e741 ">
                                          <p><code class="codeph">额外的字节读/写</code></p>
                                       </td>
                                       <td align="left" valign="top" width="69%" headers="d49029e863 d49029e744 ">
                                          <p>当工作区域无法以最佳方式运行时，将对输入数据执行一次或多次额外传递。此统计信息表示自实例启动以来在这些额外传递期间处理的字节数。此数字还用于计算<code class="codeph">cache</code> <code class="codeph">hit</code> <code class="codeph">percentage</code>度量标准。理想情况下，与<code class="codeph">total bytes processed</code>相比，它应该很小。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="31%" id="d49029e883" headers="d49029e741 ">
                                          <p><code class="codeph">缓存命中百分比</code></p>
                                       </td>
                                       <td align="left" valign="top" width="69%" headers="d49029e883 d49029e744 ">
                                          <p>该指标由Oracle数据库计算，以反映PGA内存组件的性能。它是从实例启动累积的。值100％表示自实例启动以来系统执行的所有工作区都使用最佳数量的PGA内存。这是理想的，但除了纯OLTP系统外很少发生。通常，某些工作区域运行一次通过甚至多次通过，具体取决于PGA内存的总体大小。当工作区域无法以最佳方式运行时，将对输入数据执行一次或多次额外传递。这会降低<code class="codeph">cache</code> <code class="codeph">hit</code> <code class="codeph">percentage</code> ，与输入数据的大小和执行的额外通过次数成比例。有关如何计算此度量标准的示例，请参见<a href="tuning-program-global-area.html#GUID-892FC04E-16ED-435D-8DF3-8B74A379993B__BGBECDGE">示例16-1</a> 。
                                          </p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <p><a href="tuning-program-global-area.html#GUID-892FC04E-16ED-435D-8DF3-8B74A379993B__BGBECDGE">例16-1</a>显示了额外传递如何影响<code class="codeph">cache</code> <code class="codeph">hit</code> <code class="codeph">percentage</code>度量标准。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-892FC04E-16ED-435D-8DF3-8B74A379993B__BGBECDGE">
                           <p class="titleinexample">例16-1计算缓存命中百分比</p>
                           <p>已执行四种排序操作，三种是小型（1 MB输入数据），另一种是更大（100 MB输入数据）。四个操作处理的总字节数（BP）为103 MB。如果其中一个小类运行一次通过，则执行超过1 MB输入数据的额外通过。此1 MB值是<code class="codeph">read/written</code>的<code class="codeph">extra</code> <code class="codeph">bytes</code>数或EBP。</p>
                           <p><code class="codeph">cache</code> <code class="codeph">hit</code> <code class="codeph">percentage</code>使用以下公式计算：</p><pre class="oac_no_warn" dir="ltr">BP x 100 /（BP + EBP）</pre><p>在此示例中， <code class="codeph">cache</code> <code class="codeph">hit</code> <code class="codeph">percentage</code>为99.03％。该值反映了只有一个小型排序操作执行了额外的传递，而所有其他排序操作都能够以最佳大小运行。因此， <code class="codeph">cache</code> <code class="codeph">hit</code> <code class="codeph">percentage</code>几乎是100％，因为超过1 MB的额外传递代表一个微小的开销。但是，如果较大的排序操作以一次通过大小运行，则EBP为100 MB而不是1 MB，并且<code class="codeph">cache</code> <code class="codeph">hit</code> <code class="codeph">percentage</code>降至50.73％，因为额外的通过具有更大的影响。
                           </p>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="TGDBA478"></a><a id="TGDBA477"></a><div class="props_rev_3"><a id="GUID-9C657D3F-C162-46E1-AC5A-BFF7AAA3B3BA" name="GUID-9C657D3F-C162-46E1-AC5A-BFF7AAA3B3BA"></a><h5 id="TGDBA-GUID-9C657D3F-C162-46E1-AC5A-BFF7AAA3B3BA" class="sect5"><span class="enumeration_section">16.2.3.2</span>使用V $ PROCESS视图</h5>
                     <div>
                        <div class="section">
                           <p><code class="codeph">V$PROCESS</code>视图为连接到数据库实例的每个Oracle进程包含一行。使用此视图中的以下列来监视这些进程的PGA内存使用情况：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">PGA_USED_MEM</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">PGA_ALLOC_MEM</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">PGA_FREEABLE_MEM</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">PGA_MAX_MEM</code></p>
                              </li>
                           </ul>
                           <p><a href="tuning-program-global-area.html#GUID-9C657D3F-C162-46E1-AC5A-BFF7AAA3B3BA__BGBFGAGD">例16-2</a>显示了该视图的查询。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-9C657D3F-C162-46E1-AC5A-BFF7AAA3B3BA__BGBFGAGD">
                           <p class="titleinexample">例16-2查询V $ PROCESS视图</p><pre class="oac_no_warn" dir="ltr">SELECT程序，pga_used_mem，pga_alloc_mem，pga_freeable_mem，pga_max_mem FROM V $ PROCESS;</pre><p>此查询的输出可能如下所示：</p><pre class="oac_no_warn" dir="ltr">PROGRAM PGA_USED_MEM PGA_ALLOC_MEM PGA_FREEABLE_MEM PGA_MAX_MEM ----------------------- ------------ ---------- --- ---------------- ----------- PSEUDO 0 0 0 0 oracle @ examp1690（PMON）314540 685860 0 685860 oracle @ examp1690（MMAN ）313992 685860 0 685860 oracle @ examp1690（DBW0）696720 1063112 0 1063112 oracle @ examp1690（LGWR）10835108 22967940 0 22967940 oracle @ examp1690（CKPT）352716 710376 0 710376 oracle @ examp1690（SMON）541508 948004 0 1603364 oracle @ examp1690（RECO ）323688 685860 0 816932 oracle @ examp1690（q001）233508 585128 0 585128 oracle @ examp1690（QMNC）314332 685860 0 685860 oracle @ examp1690（MMON）885756 1996548 393216 1996548 oracle @ examp1690（MMNL）315068 685860 0 685860 oracle @ examp1690（q000 ）330872 716200 65536 716200 oracle @ examp1690（CJQ0）533476 1013540 0 1144612</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="TGDBA479"></a><div class="props_rev_3"><a id="GUID-B837C371-5384-49B5-9C6D-12982A8DF3BD" name="GUID-B837C371-5384-49B5-9C6D-12982A8DF3BD"></a><h5 id="TGDBA-GUID-B837C371-5384-49B5-9C6D-12982A8DF3BD" class="sect5"><span class="enumeration_section">16.2.3.3</span>使用V $ PROCESS_MEMORY视图</h5>
                     <div>
                        <div class="section">
                           <p><code class="codeph">V$PROCESS_MEMORY</code>视图按每个Oracle进程的命名组件类别显示动态PGA内存使用情况。此视图最多包含每个Oracle进程的六行，一行用于：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>每个命名的组件类别：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>Java的</p>
                                    </li>
                                    <li>
                                       <p>PL / SQL</p>
                                    </li>
                                    <li>
                                       <p>OLAP</p>
                                    </li>
                                    <li>
                                       <p>SQL</p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>Freeable</p>
                                 <p>已由操作系统分配给进程的内存，但不是特定类别的内存</p>
                              </li>
                              <li>
                                 <p>其他</p>
                                 <p>已分配给类别但未分配给命名类别的内存</p>
                              </li>
                           </ul>
                           <p>使用此视图中的以下列可动态监视六个类别中每个类别的Oracle进程的PGA内存使用情况：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">类别</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">ALLOCATED</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">用过的</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">MAX_ALLOCATED</code></p>
                              </li>
                           </ul>
                           <div class="infoboxnote" id="GUID-B837C371-5384-49B5-9C6D-12982A8DF3BD__GUID-7AE26004-F418-47DC-B893-F928457DD4BF">
                              <p class="notep1">注意：</p>
                              <p><code class="codeph">V$PROCESS_MEMORY_DETAIL</code>视图显示超过500 MB PGA使用率的Oracle进程的动态PGA内存使用情况。从Oracle Database 12 <span class="italic">c</span>第2版开始，可以使用<code class="codeph">V$PROCESS_MEMORY_DETAIL</code>视图。
                              </p>
                           </div>
                           <div class="infoboxnotealso" id="GUID-B837C371-5384-49B5-9C6D-12982A8DF3BD__GUID-518C46AB-7937-4422-B512-AE93AE46C1E0">
                              <p class="notep1">也可以看看：</p>
                              <p>有关<a href="../refrn/V-PROCESS_MEMORY_DETAIL.html#REFRN-GUID-D16BB4C3-C11D-4EAD-BA06-F96A5450F8E8" target="_blank"><code class="codeph">V$PROCESS_MEMORY</code></a>和<a href="../refrn/V-PROCESS_MEMORY_DETAIL.html#REFRN-GUID-D16BB4C3-C11D-4EAD-BA06-F96A5450F8E8" target="_blank"><code class="codeph">V$PROCESS_MEMORY_DETAIL</code></a>视图的详细信息，请<span class="italic">参见Oracle数据库参考</span></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="TGDBA481"></a><a id="TGDBA482"></a><a id="TGDBA480"></a><div class="props_rev_3"><a id="GUID-58B5CC9D-1B5D-4A1E-8417-C6C18FD06811" name="GUID-58B5CC9D-1B5D-4A1E-8417-C6C18FD06811"></a><h5 id="TGDBA-GUID-58B5CC9D-1B5D-4A1E-8417-C6C18FD06811" class="sect5"><span class="enumeration_section">16.2.3.4</span>使用V $ SQL_WORKAREA_HISTOGRAM视图</h5>
                     <div>
                        <div class="section">
                           <p><code class="codeph">V$SQL_WORKAREA_HISTOGRAM</code>视图显示自实例启动以来以最佳，一次通过和多次通过内存大小执行的工作区数。此视图中的统计信息分为多个桶。存储桶由工作区域的最佳存储器要求定义。每个存储桶由一系列最佳内存要求标识，由<code class="codeph">LOW_OPTIMAL_SIZE</code>和<code class="codeph">HIGH_OPTIMAL_SIZE</code>列中的值指定。
                           </p>
                           <p>例如，排序操作可能需要3 MB内存才能以最佳大小运行（缓存）。有关此排序操作使用的工作区的统计信息放在由以下内容定义的存储区中：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">LOW_OPTIMAL_SIZE</code> = 2097152（2 MB）</p>
                              </li>
                              <li>
                                 <p><code class="codeph">HIGH_OPTIMAL_SIZE</code> = 4194303（4 MB减去1个字节）</p>
                              </li>
                           </ul>
                           <p>统计数据按工作区大小进行细分，因为以最佳，一次通过或多次通过大小运行工作区的性能影响主要取决于工作区的大小。在此示例中，有关工作区的统计信息放在此存储桶中，因为3 MB位于此最佳大小范围内。</p>
                           <p><a href="tuning-program-global-area.html#GUID-58B5CC9D-1B5D-4A1E-8417-C6C18FD06811__BGBBCAEC">例16-3</a>和<a href="tuning-program-global-area.html#GUID-58B5CC9D-1B5D-4A1E-8417-C6C18FD06811__BGBIFJDF">例16-4</a>显示了查询该视图的两种方法。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-58B5CC9D-1B5D-4A1E-8417-C6C18FD06811__BGBBCAEC">
                           <p class="titleinexample">示例16-3查询V $ SQL_WORKAREA_HISTOGRAM视图：非空桶</p>
                           <p>以下查询显示所有非空桶的统计信息：</p><pre class="oac_no_warn" dir="ltr">SELECT low_optimal_size / 1024 low_kb，（high_optimal_size + 1）/ 1024 high_kb，optimal_executions，onepass_executions，multipasses_executions FROM V $ SQL_WORKAREA_HISTOGRAM WHERE total_executions！= 0;</pre><p>查询的结果可能如下所示：</p><pre class="oac_no_warn" dir="ltr">LOW_KB HIGH_KB OPTIMAL_EXECUTIONS ONEPASS_EXECUTIONS MULTIPASSES_EXECUTIONS ------ ------- ------------------ -------------- ---- ---------------------- 8 16 156255 0 0 16 32 150 0 0 32 64 89 0 0 64 128 13 0 0 128 256 60 0 0 256 512 8 0 0 512 1024 657 0 0 1024 2048 551 16 0 2048 4096 538 26 0 4096 8192 243 28 0 8192 16384 137 35 0 16384 32768 45 107 0 32768 65536 0 153 0 65536 131072 0 73 0 131072 262144 0 44 0 262144 524288 0 22 0</pre><p>在此示例中，输出显示 - 在1 MB到2 MB的bucket-551工作区中以最佳大小运行，而16个以一次通过大小运行且没有以多次通过大小运行。它还表明，1 MB以下的所有工作区域都能够以最佳尺寸运行。</p>
                        </div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-58B5CC9D-1B5D-4A1E-8417-C6C18FD06811__BGBIFJDF">
                           <p class="titleinexample">示例16-4查询V $ SQL_WORKAREA_HISTOGRAM视图：最佳百分比</p>
                           <p>以下查询显示自启动以来以最佳，一次通过或多次通过大小执行工作区的次数百分比。此查询仅考虑特定大小的工作区域，最佳内存要求至少为64 KB：</p><pre class="oac_no_warn" dir="ltr">SELECT optimal_count，ROUND（optimal_count * 100 / total，2）optimal_perc，onepass_count，ROUND（onepass_count * 100 / total，2）onepass_perc，multipass_count，ROUND（multipass_count * 100 / total，2）multipass_perc FROM（SELECT DECODE（SUM（total_executions） ），0,1，SUM（total_executions））total，SUM（optimal_executions）optimal_count，SUM（onepass_executions）onepass_count，SUM（multipass_executions）multipass_count FROM V $ SQL_WORKAREA_HISTOGRAM WHERE low_optimal_size&gt; = 64 * 1024）;</pre><p>此查询的输出可能如下所示：</p><pre class="oac_no_warn" dir="ltr">OPTIMAL_COUNT OPTIMAL_PERC ONEPASS_COUNT ONEPASS_PERC MULTIPASS_COUNT MULTIPASS_PERC ------------- ------------ ------------- ------ ------ --------------- -------------- 2239 81.63 504 18.37 0 0</pre><p>在此示例中，输出显示81.63％的工作区域能够以最佳大小运行。剩余的工作区域（18.37％）以一次通过的尺寸运行，并且没有一个以多次通过尺寸运行。</p>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="TGDBA484"></a><a id="TGDBA483"></a><div class="props_rev_3"><a id="GUID-E2A9A057-60C3-4021-B6AC-8ECA79049CD5" name="GUID-E2A9A057-60C3-4021-B6AC-8ECA79049CD5"></a><h5 id="TGDBA-GUID-E2A9A057-60C3-4021-B6AC-8ECA79049CD5" class="sect5"><span class="enumeration_section">16.2.3.5</span>使用V $ WORKAREA_ACTIVE视图</h5>
                     <div>
                        <div class="section">
                           <p><code class="codeph">V$WORKAREA_ACTIVE</code>视图显示数据库实例中活动（或执行）的工作区。此视图中排除了小的活动排序操作（低于64 KB）。使用此视图可精确监控所有活动工作区的大小，并确定这些活动工作区是否溢出到临时段。
                           </p>
                           <p><a href="tuning-program-global-area.html#GUID-E2A9A057-60C3-4021-B6AC-8ECA79049CD5__BGBDHADJ">例16-5</a>显示了该视图的查询。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-E2A9A057-60C3-4021-B6AC-8ECA79049CD5__BGBDHADJ">
                           <p class="titleinexample">示例16-5查询V $ WORKAREA_ACTIVE视图</p><pre class="oac_no_warn" dir="ltr">SELECT TO_NUMBER（DECODE（sid，65535，null，sid））sid，operation_type操作，TRUNC（expected_size / 1024）esize，TRUNC（actual_mem_used / 1024）mem，TRUNC（max_mem_used / 1024）“max mem”，number_passes pass，TRUNC （TEMPSEG_SIZE / 1024）tsize FROM V $ SQL_WORKAREA_ACTIVE ORDER BY 1,2;</pre><p>此查询的输出可能如下所示：</p><pre class="oac_no_warn" dir="ltr">SID OPERATION ESIZE MEM MAX MEM PASS TSIZE --- ----------------- --------- --------- ---- ----- ----- ------- 8 GROUP BY（SORT）315 280 904 0 8 HASH-JOIN 2995 2377 2430 1 20000 9 GROUP BY（SORT）34300 22688 22688 0 11 HASH-JOIN 18044 54482 54482 0 12 HASH-JOIN 18044 11406 21406 1 120000</pre><p>在此示例中，输出显示：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>会话12（ <code class="codeph">SID</code>列）在以一次通过大小运行的工作区中运行散列连接操作（ <code class="codeph">OPERATION</code>列）（ <code class="codeph">PASS</code>列）</p>
                              </li>
                              <li>
                                 <p>PGA内存管理器期望此散列连接操作使用的最大内存量为18044 KB（ <code class="codeph">ESIZE</code>列）</p>
                              </li>
                              <li>
                                 <p>工作区目前使用11406 KB内存（ <code class="codeph">MEM</code>列）</p>
                              </li>
                              <li>
                                 <p>工作区域过去使用了高达21406 KB的PGA存储器（ <code class="codeph">MAX</code> <code class="codeph">MEM</code>列）</p>
                              </li>
                              <li>
                                 <p>工作区域溢出到120000 KB的临时段（ <code class="codeph">TSIZE</code>列）</p>
                              </li>
                           </ul>
                           <p>当工作区被释放时 - 或者当其关联的SQL运算符的执行完成时 - 它将自动从该视图中删除。</p>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="TGDBA486"></a><a id="TGDBA485"></a><div class="props_rev_3"><a id="GUID-060EB774-7876-40E3-B690-03409346AA9A" name="GUID-060EB774-7876-40E3-B690-03409346AA9A"></a><h5 id="TGDBA-GUID-060EB774-7876-40E3-B690-03409346AA9A" class="sect5"><span class="enumeration_section">16.2.3.6</span>使用V $ SQL_WORKAREA视图</h5>
                     <div>
                        <div class="section">
                           <p>Oracle数据库维护每个加载游标的累积工作区统计信息，其执行计划使用一个或多个工作区。每次取消分配工作区时， <code class="codeph">V$SQL_WORKAREA</code>使用该工作区的执行统计信息更新<code class="codeph">V$SQL_WORKAREA</code>视图。
                           </p>
                           <p>您可以使用<code class="codeph">V$SQL</code>视图加入<code class="codeph">V$SQL_WORKAREA</code>视图以将工作区与游标相关联，并使用<code class="codeph">V$SQL_PLAN</code>视图来精确确定计划中的哪个运算符使用工作区。
                           </p>
                           <p><a href="tuning-program-global-area.html#GUID-060EB774-7876-40E3-B690-03409346AA9A__BGBGHEAG">例16-6</a>显示了该视图的三个查询。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-060EB774-7876-40E3-B690-03409346AA9A__BGBGHEAG">
                           <p class="titleinexample">示例16-6查询V $ SQL_WORKAREA视图</p>
                           <p>以下查询查找需要最多缓存内存的前10个工作区：</p><pre class="oac_no_warn" dir="ltr">SELECT * FROM（SELECT workarea_address，operation_type，policy，estimated_optimal_size FROM V $ SQL_WORKAREA ORDER BY estimated_optimal_size DESC）WHERE ROWNUM &lt;= 10;</pre><p>以下查询查找具有一个或多个工作区的游标，这些工作区已在一个或多个传递中执行：</p><pre class="oac_no_warn" dir="ltr">col sql_text格式A80包装SELECT sql_text，sum（ONEPASS_EXECUTIONS）onepass_cnt，sum（MULTIPASSES_EXECUTIONS）mpass_cnt FROM V $ SQL s，V $ SQL_WORKAREA wa WHERE s.address = wa.address GROUP BY sql_text HAVING sum（ONEPASS_EXECUTIONS + MULTIPASSES_EXECUTIONS）&gt; 0;</pre><p>使用特定游标的哈希值和地址，以下查询显示游标执行计划，包括有关相关工作区的信息：</p><pre class="oac_no_warn" dir="ltr">col“O / 1 / M”格式a10列名格式a20 SELECT操作，选项，object_name名称，trunc（bytes / 1024/1024）“input（MB）”，TRUNC（last_memory_used / 1024）last_mem，TRUNC（estimated_optimal_size / 1024 ）optimal_mem，TRUNC（estimated_onepass_size / 1024）onepass_mem，DECODE（optimal_executions，null，null，optimal_executions ||'/'|| onepass_executions ||'/'|| multipasses_executions）“O / 1 / M”FROM V $ SQL_PLAN p， V $ SQL_WORKAREA w WHERE p.address = w.address（+）AND p.hash_value = w.hash_value（+）AND p.id = w.operation_id（+）AND p.address = '88BB460C'AND p.hash_value = 3738161960;</pre><p>此查询的输出可能如下所示：</p><pre class="oac_no_warn" dir="ltr">操作选项名称输入（MB）LAST_MEM OPTIMAL_ME ONEPASS_ME O / 1 / M ------------ -------- -------- ------- -  -------- ---------- ---------- ------ SELECT STATE HASH GROUP BY 4582 8 16 16 16/0/0 HASH JOIN SEMI 4582 5976 5194 2187 16/0/0表访问全部订单51表访问FUL LINEITEM 1000</pre><p>您可以通过在查询中指定模式来从<code class="codeph">V$SQL</code>视图中获取地址和哈希值，如以下查询所示：</p><pre class="oac_no_warn" dir="ltr">SELECT地址，hash_value FROM V $ SQL WHERE sql_text LIKE'％ <span class="italic">my_pattern</span> ％';</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div><a id="TGDBA487"></a><div class="props_rev_3"><a id="GUID-C8C6D009-CF38-4996-AD0E-D97CE0CECE3D" name="GUID-C8C6D009-CF38-4996-AD0E-D97CE0CECE3D"></a><h4 id="TGDBA-GUID-C8C6D009-CF38-4996-AD0E-D97CE0CECE3D" class="sect4"><span class="enumeration_section">16.2.4</span>调整PGA_AGGREGATE_TARGET</h4>
                  <div>
                     <p>为了帮助您调整<code class="codeph">PGA_AGGREGATE_TARGET</code>初始化参数的值，Oracle数据库提供了两个PGA性能建议视图： <code class="codeph">V$PGA_TARGET_ADVICE</code>和<code class="codeph">V$PGA_TARGET_ADVICE_HISTOGRAM</code> 。通过使用这些视图，您无需使用经验方法来调整<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的值。相反，您可以使用这些视图来预测更改<code class="codeph">PGA_AGGREGATE_TARGET</code>参数值将如何影响关键PGA统计信息。
                     </p>
                     <p>本节介绍如何调整<code class="codeph">PGA_AGGREGATE_TARGET</code>初始化参数的值，并包含以下主题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="tuning-program-global-area.html#GUID-326DEB90-E13C-4511-8731-F8A37C4D83D6">启用自动生成PGA性能咨询视图</a></p>
                        </li>
                        <li>
                           <p><a href="tuning-program-global-area.html#GUID-4ED57621-B8D5-438C-A1CB-B5204A6C0427">使用V $ PGA_TARGET_ADVICE视图</a></p>
                        </li>
                        <li>
                           <p><a href="tuning-program-global-area.html#GUID-A2C80240-8436-42FC-B40F-B0358C955216">使用V $ PGA_TARGET_ADVICE_HISTOGRAM视图</a></p>
                        </li>
                        <li>
                           <p><a href="tuning-program-global-area.html#GUID-1E3F26AD-1F4A-4188-B775-53429DE27963">使用V $ SYSSTAT和V $ SESSTAT视图</a></p>
                        </li>
                        <li>
                           <p><a href="tuning-program-global-area.html#GUID-BC6CBF45-EA12-44AE-AB84-EE7DF7B09DE8">教程：如何调整PGA_AGGREGATE_TARGET</a></p>
                        </li>
                     </ul>
                  </div><a id="TGDBA488"></a><div class="props_rev_3"><a id="GUID-326DEB90-E13C-4511-8731-F8A37C4D83D6" name="GUID-326DEB90-E13C-4511-8731-F8A37C4D83D6"></a><h5 id="TGDBA-GUID-326DEB90-E13C-4511-8731-F8A37C4D83D6" class="sect5"><span class="enumeration_section">16.2.4.1</span>启用自动生成PGA性能咨询视图</h5>
                     <div>
                        <div class="section">
                           <p>Oracle数据库通过记录工作负载历史记录生成<code class="codeph">V$PGA_TARGET_ADVICE</code>和<code class="codeph">V$PGA_TARGET_ADVICE_HISTOGRAM</code>视图，然后针对<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的不同值模拟此历史记录。<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的值是从其当前值的分数和倍数导出的，以评估可能的更高和更低的值。这些值用于预测，范围从10 MB到最大256 GB。模拟过程在后台进行，并不断更新工作负载历史记录以生成模拟结果。您可以通过查询这些视图随时查看结果。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-326DEB90-E13C-4511-8731-F8A37C4D83D6__GUID-13320479-F08F-43BE-867D-2469FA60F3A2">要启用自动生成PGA性能建议视图：</p>
                           <ol>
                              <li>
                                 <p>设置<code class="codeph">PGA_AGGREGATE_TARGET</code>参数以启用自动PGA内存管理。
                                 </p>
                                 <p>将此参数设置为0将禁用自动PGA内存管理，不建议这样做。有关设置此参数的信息，请参阅<span class="q">“ <a href="tuning-program-global-area.html#GUID-7A3C7085-C5F9-4E02-A57D-FDC491723FAD">设置PGA_AGGREGATE_TARGET的初始值</a> ”</span> 。
                                 </p>
                              </li>
                              <li>
                                 <p>将<code class="codeph">STATISTICS_LEVEL</code>参数设置为<code class="codeph">TYPICAL</code> （默认值）或<code class="codeph">ALL</code> 。</p>
                                 <p>将此参数设置为<code class="codeph">BASIC</code>会禁用PGA性能建议视图的生成，因此不建议这样做。
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <div class="infoboxnote" id="GUID-326DEB90-E13C-4511-8731-F8A37C4D83D6__GUID-C0FC7DFB-9733-4004-879D-13BE54D78073">
                              <p class="notep1">注意：</p>
                              <p>在实例启动时或<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的值更改时，将重置PGA建议性能视图的内容。
                              </p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="TGDBA491"></a><a id="TGDBA490"></a><a id="TGDBA489"></a><div class="props_rev_3"><a id="GUID-4ED57621-B8D5-438C-A1CB-B5204A6C0427" name="GUID-4ED57621-B8D5-438C-A1CB-B5204A6C0427"></a><h5 id="TGDBA-GUID-4ED57621-B8D5-438C-A1CB-B5204A6C0427" class="sect5"><span class="enumeration_section">16.2.4.2</span>使用V $ PGA_TARGET_ADVICE视图</h5>
                     <div>
                        <div class="section">
                           <p><code class="codeph">V$PGA_TARGET_ADVICE</code>视图预测如何更改<code class="codeph">PGA_AGGREGATE_TARGET</code>初始化参数的值将影响<code class="codeph">V$PGASTAT</code>视图中的以下统计信息：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>缓存命中百分比</p>
                              </li>
                              <li>
                                 <p>超额分配数</p>
                              </li>
                           </ul>
                           <p>以下示例显示了此视图的查询。</p><pre class="oac_no_warn" dir="ltr">SELECT ROUND（pga_target_for_estimate / 1024/1024）target_mb，estd_pga_cache_hit_percentage cache_hit_perc，estd_overalloc_count FROM V $ PGA_TARGET_ADVICE;</pre><p>此查询的输出可能如下所示：</p><pre class="oac_no_warn" dir="ltr">TARGET_MB CACHE_HIT_PERC ESTD_OVERALLOC_COUNT ---------- -------------- -------------------- 63 23 367 125 24 30 250 30 3 375 39 0 500 58 0 600 59 0 700 59 0 800 60 0 900 60 0 1000 61 0 1500 67 0 2000 76 0 3000 83 0 4000 85 0</pre><p>下图说明了如何绘制此查询的结果。</p>
                           <div class="figure" id="GUID-4ED57621-B8D5-438C-A1CB-B5204A6C0427__BGBCEIAF">
                              <p class="titleinfigure">图16-1 V $ PGA_TARGET_ADVICE的图形表示</p><img src="img/figure_161_v_pga_target_advice.png" alt="下面是图16-1的描述" title="下面是图16-1的描述" longdesc="img_text/figure_161_v_pga_target_advice.html"><br><a href="img_text/figure_161_v_pga_target_advice.html">“图16-1 V $ PGA_TARGET_ADVICE的图形表示”的描述</a></div>
                           <!-- class="figure" -->
                           <p>该曲线显示PGA <code class="codeph">cache</code> <code class="codeph">hit</code> <code class="codeph">percentage</code>如何随着<code class="codeph">PGA_AGGREGATE_TARGET</code>参数值的增加而提高。图中的阴影区域表示<code class="codeph">over</code> <code class="codeph">allocation</code>区域，其中<code class="codeph">ESTD_OVERALLOCATION_COUNT</code>列的值不为零。此区域表示<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的值太小，无法满足最低PGA内存要求。如果在<code class="codeph">over</code> <code class="codeph">allocation</code>区域内设置了<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的值，则内存管理器将过度分配内存，并且消耗的实际PGA内存将超过设置的限制。因此，在该区域中设置<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的值是没有意义的。在此特定示例中， <code class="codeph">PGA_AGGREGATE_TARGET</code>参数应设置为至少375 MB。</p>
                           <p><code class="codeph">over</code> <code class="codeph">allocation</code>区域，PGA <code class="codeph">cache</code> <code class="codeph">hit</code> <code class="codeph">percentage</code>的值迅速增加。这是由于最佳或一次通过工作区域的数量增加以及多次执行次数的减少。在某些情况下，在该示例中约为500MB，曲线中的拐点对应于大多数（可能所有）工作区域可以以最佳或至少一次通过尺寸运行的点。除此之外， <code class="codeph">cache</code> <code class="codeph">hit</code> <code class="codeph">percentage</code>不断增加，但速度较慢，直至开始逐渐减少，并且随着<code class="codeph">PGA_AGGREGATE_TARGET</code>参数值的增加，只能实现轻微改善。在图中，当<code class="codeph">PGA_AGGREGATE_TARGET</code>达到3 GB时会发生这种情况。此时， <code class="codeph">cache</code> <code class="codeph">hit</code> <code class="codeph">percentage</code>为83％，只有一个额外千兆字节的PGA内存才能实现边际改善（2％）。在此示例中，3 GB是<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的最佳值。
                           </p>
                           <div class="infoboxnote" id="GUID-4ED57621-B8D5-438C-A1CB-B5204A6C0427__GUID-CC65C720-18FA-42A0-84BC-20B9111289FA">
                              <p class="notep1">注意：</p>
                              <p>尽管PGA <code class="codeph">cache</code> <code class="codeph">hit</code> <code class="codeph">percentage</code>的理论最大值是100％，但是即使<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的值进一步增加，也可能对可能阻止达到该理论最大值的工作区的最大大小存在实际限制。这应该仅在最佳内存要求很大的大型DSS系统中发生，并且可能导致<code class="codeph">cache</code> <code class="codeph">hit</code> <code class="codeph">percentage</code>的值以较低的百分比逐渐减小，例如90％。
                              </p>
                           </div>
                           <p>理想的是，的值<code class="codeph">PGA_AGGREGATE_TARGET</code>参数应设置为最佳值，或者至少在超出该区域的最大可能值<code class="codeph">over</code> <code class="codeph">allocation</code>区。根据经验，PGA <code class="codeph">cache</code> <code class="codeph">hit</code> <code class="codeph">percentage</code>应该高于60％，因为在60％的情况下，系统几乎处理了理想情况下实际需要处理的字节数的两倍。在此示例中， <code class="codeph">PGA_AGGREGATE_TARGET</code>参数的值应设置为至少500 MB，并尽可能接近3 GB。但是， <code class="codeph">PGA_AGGREGATE_TARGET</code>参数的正确设置取决于可以为PGA组件专用的内存量。通常，添加PGA内存需要减少某些SGA组件的内存 - 如共享池或缓冲区缓存 - 因为专用于数据库实例的总内存通常受系统上可用物理内存量的限制。因此，任何增加PGA内存的决定都必须在系统中可用内存的较大上下文和各种SGA组件的性能（您可以使用共享池建议和缓冲区缓存顾问统计信息监视）中进行。如果无法减少SGA组件的内存，请考虑向系统添加更多物理内存。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="TGDBA493"></a><a id="TGDBA492"></a><div class="props_rev_3"><a id="GUID-A2C80240-8436-42FC-B40F-B0358C955216" name="GUID-A2C80240-8436-42FC-B40F-B0358C955216"></a><h5 id="TGDBA-GUID-A2C80240-8436-42FC-B40F-B0358C955216" class="sect5"><span class="enumeration_section">16.2.4.3</span>使用V $ PGA_TARGET_ADVICE_HISTOGRAM视图</h5>
                     <div>
                        <div class="section">
                           <p><code class="codeph">V$PGA_TARGET_ADVICE_HISTOGRAM</code>视图预测如何更改<code class="codeph">PGA_AGGREGATE_TARGET</code>初始化参数的值将影响<code class="codeph">V$SQL_WORKAREA_HISTOGRAM</code>视图中的统计信息。使用此视图可显示有关用于预测的<code class="codeph">PGA_AGGREGATE_TARGET</code>值的预测最佳，一次通过和多次通过工作区执行次数的详细信息。
                           </p>
                           <p>的<code class="codeph">V$PGA_TARGET_ADVICE_HISTOGRAM</code>视图等同于<code class="codeph">V$SQL_WORKAREA_HISTOGRAM</code>视图，有两个附加列来表示<code class="codeph">PGA_AGGREGATE_TARGET</code>用于预测值。因此，可以在此视图上使用针对<code class="codeph">V$SQL_WORKAREA_HISTOGRAM</code>视图执行的任何查询，并使用附加谓词来选择<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的所需值。
                           </p>
                           <p><a href="tuning-program-global-area.html#GUID-A2C80240-8436-42FC-B40F-B0358C955216__BGBGCFAG">示例16-7</a>显示了此视图的查询，该查询显示<code class="codeph">V$SQL_WORKAREA_HISTOGRAM</code>视图的预测内容，其中<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的值设置为其当前值的两倍。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-A2C80240-8436-42FC-B40F-B0358C955216__BGBGCFAG">
                           <p class="titleinexample">例16-7查询V $ PGA_TARGET_ADVICE_HISTOGRAM视图</p><pre class="oac_no_warn" dir="ltr">SELECT low_optimal_size / 1024 low_kb，（high_optimal_size + 1）/ 1024 high_kb，estd_optimal_executions estd_opt_cnt，estd_onepass_executions estd_onepass_cnt，estd_multipasses_executions estd_mpass_cnt FROM V $ PGA_TARGET_ADVICE_HISTOGRAM WHERE pga_target_factor = 2 AND estd_total_executions！= 0 ORDER BY 1;</pre><p>此查询的输出可能如下所示：</p><pre class="oac_no_warn" dir="ltr">LOW_KB HIGH_KB ESTD_OPTIMAL_CNT ESTD_ONEPASS_CNT ESTD_MPASS_CNT ------ ------- ---------------- ---------------- -------------- 8 16 156107 0 0 16 32 148 0 0 32 64 89 0 0 64 128 13 0 0 128 256 58 0 0 256 512 10 0 0 512 1024 653 0 0 1024 2048 530 0 0 2048 4096 509 0 0 4096 8192 227 0 0 8192 16384 176 0 0 16384 32768 133 16 0 32768 65536 66 103 0 65536 131072 15 47 0 131072 262144 0 48 0 262144 524288 0 23 0</pre><p>在此示例中，输出显示将<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的值增加2倍将使16 MB以下的所有工作区域以最佳大小执行。
                           </p>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="TGDBA495"></a><a id="TGDBA494"></a><div class="props_rev_3"><a id="GUID-1E3F26AD-1F4A-4188-B775-53429DE27963" name="GUID-1E3F26AD-1F4A-4188-B775-53429DE27963"></a><h5 id="TGDBA-GUID-1E3F26AD-1F4A-4188-B775-53429DE27963" class="sect5"><span class="enumeration_section">16.2.4.4</span>使用V $ SYSSTAT和V $ SESSTAT视图</h5>
                     <div>
                        <div class="section">
                           <p><code class="codeph">V$SYSSTAT</code>和<code class="codeph">V$SESSTAT</code>视图中的统计<code class="codeph">V$SYSSTAT</code>显示了使用最佳，一次通过和多次通过内存大小执行的工作区总数。自实例或会话启动以来，这些统计信息是累积的。
                           </p>
                           <p><a href="tuning-program-global-area.html#GUID-1E3F26AD-1F4A-4188-B775-53429DE27963__BGBEEAEI">示例16-8</a>显示了<code class="codeph">V$SYSSTAT</code>视图的查询，该视图显示自实例启动以来以这三种大小执行工作区的总数和工作区的百分比：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-1E3F26AD-1F4A-4188-B775-53429DE27963__BGBEEAEI">
                           <p class="titleinexample">示例16-8查询V $ SYSSTAT视图</p><pre class="oac_no_warn" dir="ltr">SELECT name profile，cnt，DECODE（total，0,0，ROUND（cnt * 100 / total））percentage FROM（SELECT name，value cnt，（SUM（value）over（））total FROM V $ SYSSTAT WHERE name LIKE' workarea exec％'）;</pre><p>此查询的输出可能如下所示：</p><pre class="oac_no_warn" dir="ltr">PROFILE CNT PERCENTAGE ----------------------------------- ----------  - -------- workarea执行 - 最佳5395 95工作区执行 -  onepass 284 5 workarea执行 -  multipass 0 0</pre><p>在此示例中，输出显示以最佳大小执行了5,395个工作区执行（或95％），并且以一次通过大小执行了284个工作区执行（或5％）。</p>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="TGDBA496"></a><div class="props_rev_3"><a id="GUID-BC6CBF45-EA12-44AE-AB84-EE7DF7B09DE8" name="GUID-BC6CBF45-EA12-44AE-AB84-EE7DF7B09DE8"></a><h5 id="TGDBA-GUID-BC6CBF45-EA12-44AE-AB84-EE7DF7B09DE8" class="sect5"><span class="enumeration_section">16.2.4.5</span>教程：如何调整PGA_AGGREGATE_TARGET</h5>
                     <div>
                        <div class="section">
                           <p>本教程提供了使用本章中讨论的各种视图调整<code class="codeph">PGA_AGGREGATE_TARGET</code>参数值的指南。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-BC6CBF45-EA12-44AE-AB84-EE7DF7B09DE8__GUID-D8A4698C-EB6D-4566-82A0-A8ACD49D5A8B">调整PGA_AGGREGATE_TARGET：</p>
                           <ol>
                              <li>
                                 <p>设置<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的值以避免内存过量分配。
                                 </p>
                                 <p>使用<code class="codeph">V$PGA_TARGET_ADVICE</code>视图确保未在超分配区域内设置<code class="codeph">PGA_AGGREGATE_TARGET</code>值，如<span class="q">“ <a href="tuning-program-global-area.html#GUID-4ED57621-B8D5-438C-A1CB-B5204A6C0427">使用V $ PGA_TARGET_ADVICE视图</a> ”中所述</span> 。在例16-8中， <code class="codeph">PGA_AGGREGATE_TARGET</code>值应设置为至少375 MB。</p>
                              </li>
                              <li>
                                 <p>根据响应时间要求和内存限制，最大化PGA <code class="codeph">cache</code> <code class="codeph">hit</code> <code class="codeph">percentage</code> 。
                                 </p>
                                 <p>使用<code class="codeph">V$PGA_TARGET_ADVICE</code>视图确定<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的最佳值，并将其值设置为最佳值，或者设置为可能的最大值，如<span class="q">“ <a href="tuning-program-global-area.html#GUID-4ED57621-B8D5-438C-A1CB-B5204A6C0427">使用V $ PGA_TARGET_ADVICE视图</a> ”中所述</span> 。
                                 </p>
                                 <p>假设可以分配给PGA的内存限制为<span class="italic">X</span> ：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>如果限制<span class="italic">X</span>高于最佳值，请将<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的值设置为最佳值。
                                       </p>
                                       <p>在例16-8中，如果您有10 GB专用于PGA，请将<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的值设置为3 GB，并将剩余的7 GB专用于SGA。</p>
                                    </li>
                                    <li>
                                       <p>如果限制<span class="italic">X</span>小于最佳值，请将<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的值设置为<span class="italic">X.</span></p>
                                       <p>在示例16-8中，如果您只有2 GB专用于PGA，请将<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的值设置为2 GB并接受75％的<code class="codeph">cache</code> <code class="codeph">hit</code> <code class="codeph">percentage</code> 。
                                       </p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>验证<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的新值将导致所需的最佳和一次通过工作区执行次数，并避免执行任何多次通过工作区。
                                 </p>
                                 <p>使用<code class="codeph">V$PGA_TARGET_ADVICE_HISTOGRAM</code>视图预测最佳，一次通过和多次通过工作区执行的次数，如<span class="q">“ <a href="tuning-program-global-area.html#GUID-A2C80240-8436-42FC-B40F-B0358C955216">使用V $ PGA_TARGET_ADVICE_HISTOGRAM视图</a> ”中所述</span> 。
                                 </p>
                              </li>
                              <li>
                                 <p>如果需要更多PGA内存，则通过减少SGA组件的内存或向系统添加更多物理内存来增加PGA内存。</p>
                              </li>
                              <li>
                                 <p>在任何时候，确保最佳，一次通过和多次通过的工作区执行次数与预测相匹配，并在必要时调整<code class="codeph">PGA_AGGREGATE_TARGET</code>参数的值。
                                 </p>
                                 <p>使用<code class="codeph">V$SYSSTAT</code>和<code class="codeph">V$SESSTAT</code>视图分别验证自实例或会话启动以来最佳，一次通过和多次通过内存大小执行的工作区总数，如<span class="q">“ <a href="tuning-program-global-area.html#GUID-1E3F26AD-1F4A-4188-B775-53429DE27963">使用V $ SYSSTAT和V $ SESSTAT意见</a> “</span> 。
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div><a id="TGDBA95344"></a><div class="props_rev_3"><a id="GUID-C1796FFD-5A7E-4FA7-945B-4B6CE374091A" name="GUID-C1796FFD-5A7E-4FA7-945B-4B6CE374091A"></a><h3 id="TGDBA-GUID-C1796FFD-5A7E-4FA7-945B-4B6CE374091A" class="sect3"><span class="enumeration_section">16.3</span>通过指定绝对限制来确定程序全局区域的大小</h3>
               <div>
                  <p>在自动PGA内存管理模式下，Oracle数据库通过动态控制分配给工作区的PGA内存量来尝试遵循<code class="codeph">PGA_AGGREGATE_TARGET</code>值。但是，由于以下原因，PGA内存使用量有时可能超过<code class="codeph">PGA_AGGREGATE_TARGET</code>设置：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><code class="codeph">PGA_AGGREGATE_TARGET</code>设置充当目标，而不是限制。
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">PGA_AGGREGATE_TARGET</code>仅控制可调内存的分配。
                        </p>
                     </li>
                  </ul>
                  <div class="p">过多的PGA使用会导致高速交换。发生这种情况时，系统可能会变得无响应且不稳定。在这种情况下，请考虑使用以下任何方法来指定PGA内存使用的绝对限制：<ul style="list-style-type:disc">
                        <li>
                           <p>使用<code class="codeph">PGA_AGGREGATE_LIMIT</code>参数设置整体PGA内存使用的绝对限制。
                           </p>
                           <p>请参见<span class="q">“ <a href="tuning-program-global-area.html#GUID-2DAF0E1B-E24F-4463-BB5D-B1C89904C443">使用PGA_AGGREGATE_LIMIT参数调整程序全局区域大小</a> ”</span> 
                           </p>
                        </li>
                        <li>
                           <p>使用资源管理器过程<code class="codeph">DBMS_RESOURCE_MANAGER.CREATE_PLAN_DIRECTIVE</code>为特定使用者组中每个会话的PGA内存使用量设置绝对限制。
                           </p>
                           <p>请参阅<span class="q">“ <a href="tuning-program-global-area.html#GUID-5988E64F-5BE0-4976-BACF-9310154F24E7">使用资源管理器调整程序全局区域大小</a> ”</span></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="TGDBA95346"></a><div class="props_rev_3"><a id="GUID-2DAF0E1B-E24F-4463-BB5D-B1C89904C443" name="GUID-2DAF0E1B-E24F-4463-BB5D-B1C89904C443"></a><h4 id="TGDBA-GUID-2DAF0E1B-E24F-4463-BB5D-B1C89904C443" class="sect4"><span class="enumeration_section">16.3.1</span>使用PGA_AGGREGATE_LIMIT参数调整程序全局区域的大小</h4>
                  <div>
                     <div class="section">
                        <p><code class="codeph">PGA_AGGREGATE_LIMIT</code>初始化参数使您可以指定PGA内存使用的绝对限制。如果超出<code class="codeph">PGA_AGGREGATE_LIMIT</code>值，Oracle数据库将按以下顺序中止或终止消耗最不可用的PGA内存的会话或进程：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>对中断最耗尽的PGA内存的会话的调用将被中止。</p>
                           </li>
                           <li>
                              <p>如果PGA内存使用率仍超过<code class="codeph">PGA_AGGREGATE_LIMIT</code> ，则终止消耗最不可用的PGA内存的会话和进程。
                              </p>
                           </li>
                        </ul>
                        <p>在确定要中止或终止的会话和进程时，Oracle数据库将并行查询视为一个单元。</p>
                        <p>默认情况下， <code class="codeph">PGA_AGGREGATE_LIMIT</code>参数设置为2 GB， <code class="codeph">PGA_AGGREGATE_TARGET</code>值的200％或<code class="codeph">PROCESSES</code>参数值的3 MB的较大值。但是，它不会超过物理内存大小的120％减去总SGA大小。默认值将打印到警报日志中。如果无法确定系统上的物理内存量，则会在警报日志中打印警告消息。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-2DAF0E1B-E24F-4463-BB5D-B1C89904C443__GUID-D14D6529-8A07-49A5-A3C1-C3A4B56921B4">要设置PGA_AGGREGATE_LIMIT：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>将<code class="codeph">PGA_AGGREGATE_LIMIT</code>初始化参数设置为所需的字节数值。
                              </p>
                              <p>该值表示为数字，后跟<code class="codeph">K</code> （表示千字节）， <code class="codeph">M</code> （表示兆字节）或<code class="codeph">G</code> （表示千兆字节）。将值设置为0将禁用PGA内存的硬限制。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-2DAF0E1B-E24F-4463-BB5D-B1C89904C443__GUID-E8E34211-5CDA-4EDB-BDA0-C4DE7142D7B2">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关<code class="codeph">PGA_AGGREGATE_LIMIT</code>初始化参数的信息，请<a href="../refrn/PGA_AGGREGATE_LIMIT.html#REFRN10328" target="_blank"><span class="italic">参见Oracle数据库参考</span></a></p>
                              </li>
                              <li>
                                 <p>有关<code class="codeph">V$PGASTAT</code>视图的信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgdba&amp;id=REFRN30180" target="_blank"><span class="italic">参见Oracle数据库参考</span></a></p>
                              </li>
                              <li>
                                 <p><a href="../admin/managing-resources-with-oracle-database-resource-manager.html#ADMIN027" target="_blank"><span class="italic">“Oracle数据库管理员指南”</span></a> ，了解有关Oracle数据库资源管理器和使用者组的信息</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-5988E64F-5BE0-4976-BACF-9310154F24E7" name="GUID-5988E64F-5BE0-4976-BACF-9310154F24E7"></a><h4 id="TGDBA-GUID-5988E64F-5BE0-4976-BACF-9310154F24E7" class="sect4"><span class="enumeration_section">16.3.2</span>使用资源管理器调整程序全局区域的大小</h4>
                  <div>
                     <p>您可以使用Oracle数据库资源管理器的<code class="codeph">DBMS_RESOURCE_MANAGER.CREATE_PLAN_DIRECTIVE</code>过程的<code class="codeph">SESSION_PGA_LIMIT</code>参数，为可以分配给特定使用者组中的每个会话的PGA内存量设置绝对限制。如果会话超过为其使用者组设置的PGA内存限制，则该会话将以<code class="codeph">ORA-10260</code>错误消息终止。
                     </p>
                     <div class="infoboxnotealso" id="GUID-5988E64F-5BE0-4976-BACF-9310154F24E7__ORACLEDATABASEADMINISTRATIONGUIDE-0279DEF5">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="italic">Oracle数据库管理指南</span>主题：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><a href="../admin/managing-resources-with-oracle-database-resource-manager.html#ADMIN-GUID-6D549CB5-9AEB-43F2-9901-0092C7B76115" target="_blank"><span class="q">“程序全局区域（PGA）”</span></a> ，了解有关限制消费者组中每个会话的PGA内存的更多信息。
                                    </p>
                                 </li>
                                 <li>
                                    <p><a href="../admin/managing-resources-with-oracle-database-resource-manager.html#ADMIN-GUID-3BDCC024-22DD-479D-A7C3-92E7145C854F" target="_blank"><span class="q">“创建资源计划指令”</span></a> ，以获取有关使用<code class="codeph">DBMS_RESOURCE_MANAGER.CREATE_PLAN_DIRECTIVE</code>过程<a href="../admin/managing-resources-with-oracle-database-resource-manager.html#ADMIN-GUID-3BDCC024-22DD-479D-A7C3-92E7145C854F" target="_blank"><span class="q">创建资源计划指令</span></a>的更多信息。
                                    </p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p><a href="../arpls/DBMS_RESOURCE_MANAGER.html#ARPLS-GUID-8EC6C735-338D-46D4-B346-AD16D0622B30" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考</span></a> ，了解<code class="codeph">DBMS_RESOURCE_MANAGER.CREATE_PLAN_DIRECTIVE</code>过程的语法。
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>