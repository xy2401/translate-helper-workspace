<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="The map visualizer, as a set of Java Enterprise Edition packages, contains a collection of servers to provide mapping services.">
      <meta name="description" content="The map visualizer, as a set of Java Enterprise Edition packages, contains a collection of servers to provide mapping services.">
      <title>Map Visualization Servers</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Map Visualization Developer's Guide ">
      <meta property="og:description" content="The map visualizer, as a set of Java Enterprise Edition packages, contains a collection of servers to provide mapping services.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Map Visualization Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="spatial-and-graph-map-visualization-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-01-10T11:37:22-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2001, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E94797-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="map-visualization-concepts.html" title="Previous" type="text/html">
      <link rel="next" href="oracle-maps.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Spatial and Graph Map Visualization Developer's Guide">
    <meta name="dcterms.isVersionOf" content="JIMPV">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="map-visualization-concepts.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="oracle-maps.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Map Visualization Developer's Guide </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Map Visualization Servers</li>
            </ol>
            <a id="GUID-0D2CF483-95C0-45D0-B4E8-5A4578741A63" name="GUID-0D2CF483-95C0-45D0-B4E8-5A4578741A63"></a><a id="JIMPV3000"></a>
            
            <h2 id="JIMPV-GUID-0D2CF483-95C0-45D0-B4E8-5A4578741A63" class="sect2"><span class="enumeration_chapter">3 </span>Map Visualization Servers
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>The map visualizer, as a set of Java Enterprise Edition packages, contains a collection of servers to provide mapping services.</p>
               <p>These services include a map server, a map data server, a map tile server, a WMS server (see <a href="ogc-wms-support-map-visualzation-component.html#GUID-9B407D9F-0298-4890-A345-C22A99C50226" title="The map visualization component supports the rendering of data delivered using the Open GIS Consortium (OGC) Web Map Service (WMS) protocol, specifically the WMS 1.1.1 and 1.3.0 implementation specifications.">OGC WMS Support in the Map Visualization Component</a>), and a WMTS server (see <a href="ogc-wmts-support-map-visualzation-component.html#GUID-FD2428ED-0400-4D11-83F4-9AB59FE766C9" title="The map visualization component supports the rendering of data delivered using the Open GIS Consortium (OGC) Web Map Tile Service (WMTS) protocol, specifically the WMS 1.0.0 implementation specifications">OGC WMTS Support in the Map Visualization Component</a>).When you develop Oracle Maps applications, the Oracle Maps API and the map visualizer server will identify the needed service and then issue map service request to the proper server. You normally do not need to send service requests explicitly in your map applications; however, if you are familiar with the map visualizer servers described in this chapter, it can help if you need to debug or optimize the application.
               </p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-3A6C41AB-66DC-40D7-8B3A-9B2F7A1ED58F">Map Visualizer Map Data Server</a><br>The map visualizer map data server provides services for streaming live data from a database server to a client.
                  </li>
                  <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-7E88B130-FB2F-47D1-A8B2-909CFB1454AC">Map Tile Server</a><br>The map tile server is a map image caching engine that fetches, caches, and serves pregenerated, fixed-size map image tiles.
                  </li>
               </ul>
            </div>
            <a id="JIMPV10114"></a><div class="props_rev_3"><a id="GUID-3A6C41AB-66DC-40D7-8B3A-9B2F7A1ED58F" name="GUID-3A6C41AB-66DC-40D7-8B3A-9B2F7A1ED58F"></a><h3 id="JIMPV-GUID-3A6C41AB-66DC-40D7-8B3A-9B2F7A1ED58F" class="sect3"><span class="enumeration_section">3.1 </span>Map Visualizer Map Data Server
               </h3>
               <div>
                  <p>The map visualizer map data server provides services for streaming live data from a database server to a client.</p>
                  <p>The data can be consumed by the Oracle Maps JavaScript API client, or be edited by the API editing utilities. It is also used as the middle-tier component for handling data synchronization tasks.</p>
                  <p>At the most basic level, a client sends a request to the map data server, specifying the name of a theme and an optional bounding box. The server then returns the live data (including both geometries and attributes) in compressed GeoJSON format.</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-0A52EF92-14F4-414A-BE5E-D3B68427E8AC">Domains and Map Data Server URL Patterns</a><br></li>
                     <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-A4529184-3550-4058-8EBB-C4670BB4233B">Map Data Server Request Parameters</a><br></li>
                     <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-28D5721C-1246-4C56-8602-3DB9CC05D1F3">Interpreting Data Returned from the Map Data Server</a><br></li>
                     <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-13559073-0FDA-461A-8A71-826722F2AEC5">Map Data Server Error Handling</a><br></li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-0D2CF483-95C0-45D0-B4E8-5A4578741A63" title="The map visualizer, as a set of Java Enterprise Edition packages, contains a collection of servers to provide mapping services.">Map Visualization Servers</a></p>
                     </div>
                  </div>
               </div>
               <a id="JIMPV10115"></a><div class="props_rev_3"><a id="GUID-0A52EF92-14F4-414A-BE5E-D3B68427E8AC" name="GUID-0A52EF92-14F4-414A-BE5E-D3B68427E8AC"></a><h4 id="JIMPV-GUID-0A52EF92-14F4-414A-BE5E-D3B68427E8AC" class="sect4"><span class="enumeration_section">3.1.1 </span>Domains and Map Data Server URL Patterns
                  </h4>
                  <div>
                     <p>The map data server uses domains, where each <span class="bold">domain</span> corresponds to a map visualizer data source. For example, to request data from the <code class="codeph">mvdemo</code> data source, the URL must have the following pattern:
                     </p>
                     <p><code class="codeph">http://example.com:8080/mapviewer/dataserver/mvdemo?</code></p>
                     <p>In this URL request, <code class="codeph">/dataserver</code> refers to the map data server. <code class="codeph">/mvdemo</code> is the path information, which indicates which domain or data source this request is directed against. There is no need to specify the data source explicitly in the rest of the URL request. This URL pattern provides flexibility in terms of protection. A user or a web administrator can easily set up different levels of protection for different domains using such a URL pattern.
                     </p>
                     <p>To get a quick help regarding the full list of supported HTTP request parameters, you can issue a request that includes the help parameter. For example:</p>
                     <p><code class="codeph">http://example:8080/mapviewer/dataserver/mvdemo?help=true</code></p>
                     <p>This example returns a list of supported parameters. (Note that the <code class="codeph">/mvdemo</code> path is still required even for this help request.)
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-3A6C41AB-66DC-40D7-8B3A-9B2F7A1ED58F" title="The map visualizer map data server provides services for streaming live data from a database server to a client.">Map Visualizer Map Data Server</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="JIMPV10116"></a><div class="props_rev_3"><a id="GUID-A4529184-3550-4058-8EBB-C4670BB4233B" name="GUID-A4529184-3550-4058-8EBB-C4670BB4233B"></a><h4 id="JIMPV-GUID-A4529184-3550-4058-8EBB-C4670BB4233B" class="sect4"><span class="enumeration_section">3.1.2 </span>Map Data Server Request Parameters
                  </h4>
                  <div>
                     <p>In a map data server request to get data, the URL must include appropriate query parameters. The data could be from a map visualizer predefined geometry theme or JDBC theme.</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-2E270F13-ED13-4694-BFC4-2B92A2061A76">Getting Data from a Predefined Geometry Theme</a><br></li>
                        <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-1D3893BD-9CCC-48B8-88DD-B62FEA2E33EE">Getting Data from a JDBC Theme</a><br></li>
                        <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-11E24A20-1AA6-4A1E-A6DC-53FA29D94225">Getting Annotation Text from a JDBC Theme</a><br></li>
                        <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-7CDCDBF2-D41D-49B5-8F18-D73E016515F4">Getting Topology Data</a><br></li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-3A6C41AB-66DC-40D7-8B3A-9B2F7A1ED58F" title="The map visualizer map data server provides services for streaming live data from a database server to a client.">Map Visualizer Map Data Server</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="JIMPV10117"></a><div class="props_rev_3"><a id="GUID-2E270F13-ED13-4694-BFC4-2B92A2061A76" name="GUID-2E270F13-ED13-4694-BFC4-2B92A2061A76"></a><h5 id="JIMPV-GUID-2E270F13-ED13-4694-BFC4-2B92A2061A76" class="sect5"><span class="enumeration_section">3.1.2.1 </span>Getting Data from a Predefined Geometry Theme
                     </h5>
                     <div>
                        <p>Before getting data from a predefined geometry theme, be sure that the predefined geometry theme is properly defined. If it is not properly defined, modify its definition or create a new predefined geometry theme with the proper definition.</p>
                        <p>Besides the geometry column of a spatial table, if you also need some attribute columns for an application, then your geometry theme's STYLING_RULES column must have the <code class="codeph">&lt;hidden_info&gt;</code> element for defining needed attributes. For example, if your application needs a geometry theme (such as CUSTOMERS) to represent a spatial table, and if you also need each customer's name, city, and sales amount, then the STYLING_RULES should look similar to the following:
                        </p><pre class="oac_no_warn" dir="ltr">SQL&gt; select STYLING_RULES from user_sdo_themes where name='CUSTOMERS';
 
STYLING_RULES
--------------------------------------------------------------------------------
&lt;?xml version="1.0" standalone="yes"?&gt;
&lt;styling_rules&gt;
  &lt;hidden_info&gt;
    &lt;field column="name" name="Name"/&gt;
    &lt;field column="city" name="City"/&gt;
    &lt;field column="sales" name="Sales"/&gt;
  &lt;/hidden_info&gt;
  &lt;rule&gt;
    &lt;features style="M.STOPLIGHT_RED"&gt; &lt;/features&gt;
  &lt;/rule&gt;
&lt;/styling_rules&gt;
</pre><p>The Map Builder utility is the recommended tool for modifying or creating geometry themes.</p>
                        <p>For information using styling rules in a predefined geometry theme, see <a href="map-visualization-concepts.html#GUID-1A5A976B-8E3F-42DD-AB10-A35ED02385DD">Styling Rules in Predefined Spatial Geometry Themes</a>.
                        </p>
                        <p>The following parameters are available for a map data server request to get data from a map visualizer predefined geometry theme. The <code class="codeph">t</code> (theme name) parameter is required; the others are optional.
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">t</code>: Name of the theme.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">bbox</code>: Bounding box. Must be a comma-delimited list of <code class="codeph">minx,miny,maxx,maxy</code>.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">to_srid</code>: SRID (spatial reference system) in which to return the data.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">bbox_srid</code>: SRID (spatial reference system) of the bounding box, if different from the native SRID of the data.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">seq</code>: Sequence ID, to be used when getting data in multipart format.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">dadp</code>: Digits after decimal point: the maximum number of digits after the decimal point for the coordinates in the returned data.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">include_style_info</code>: Determines whether styling information (rendering/labeling style name and related columns) should be included with each feature. (The default is <code class="codeph">true</code>.)
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">include_label_box</code>: Determines whether a label box should be included with each polygon feature. (The default is <code class="codeph">true</code>.) A label box is a near maximum rectangle inside the polygon. A label placed inside this rectangle is guaranteed to be completely inside the polygon feature. This parameter is ignored for non-polygon features.
                              </p>
                           </li>
                        </ul>
                        <p>The following are some examples.</p>
                        <p>To get all the data from the CITIES table in the 3857 SRID:</p>
                        <p><code class="codeph">http://example:8080/mapviewer/dataserver/mvdemo?t=theme_demo_cities&amp;to_srid=3857</code></p>
                        <p>To get all the data from the CITIES table that interacts with a specified bbox in 3857 SRID:</p>
                        <p><code class="codeph">http://example:8080/mapviewer/dataserver/mvdemo?t=theme_demo_cities&amp;bbox=-122.0,25,-100,45&amp;to_srid=3857</code></p>
                        <p>To get all the data from the CITIES table that interacts with a specified bbox in 3857 SRID, with 3 digits after the decimal points, and without styling information:</p>
                        <p><code class="codeph">http://example:8080/mapviewer/dataserver/mvdemo?t=theme_demo_cities&amp;bbox=-122.0,25,-100,45&amp;to_srid=3857&amp;dadp=3&amp;include_style_info=no</code></p>
                        <p>To get all data from the COUNTIES table and include label boxes:</p>
                        <p><code class="codeph">http://example:8080/mapviewer/dataserver/mvdemo?t=theme_demo_counties&amp;include_label_box=yes</code></p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-A4529184-3550-4058-8EBB-C4670BB4233B">Map Data Server Request Parameters</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="JIMPV10118"></a><div class="props_rev_3"><a id="GUID-1D3893BD-9CCC-48B8-88DD-B62FEA2E33EE" name="GUID-1D3893BD-9CCC-48B8-88DD-B62FEA2E33EE"></a><h5 id="JIMPV-GUID-1D3893BD-9CCC-48B8-88DD-B62FEA2E33EE" class="sect5"><span class="enumeration_section">3.1.2.2 </span>Getting Data from a JDBC Theme
                     </h5>
                     <div>
                        <p>The following parameters are available for a map data server request to get data from a map visualizer theme based on a dynamic JDBC theme. The <code class="codeph">t</code> (theme name) and <code class="codeph">sql</code> (SQL query) parameters are required; the others are optional.
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">t</code>: Name of the theme.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">sql</code>: The complete SQL query, properly URL encoded.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">asis</code>: Determines whether the query should be executed "as is". The default is <code class="codeph">false</code>, which causes the map visualizer to embed the SQL query as a subquery of its spatial filter query. If the value is <code class="codeph">true</code>, the map visualizer does not attempt to modify the supplied query string.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">bbox</code>: Bounding box. Must be a comma-delimited list of <code class="codeph">minx,miny,maxx,maxy</code>.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">to_srid</code>: SRID (spatial reference system) in which to return the data.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">bbox_srid</code>: SRID (spatial reference system) of the bounding box, if different from the native SRID of the data.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">seq</code>: Sequence ID, to be used when getting data in multipart format.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">dadp</code>: Digits after decimal point: the maximum number of digits after the decimal point for the coordinates in the returned data.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">include_style_info</code>: Determines whether styling information (rendering/labeling style name and related columns) should be included with each feature. (The default is <code class="codeph">true</code>.)
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">include_label_box</code>: Determines whether a label box should be included with each polygon feature. (The default is <code class="codeph">true</code>.) A label box is a near maximum rectangle inside the polygon. A label placed inside this rectangle is guaranteed to be completely inside the polygon feature. This parameter is ignored for non-polygon features.
                              </p>
                           </li>
                        </ul>
                        <p>The following are some examples.</p>
                        <p>To get all the data of the CITIES table in SRID 3857:</p>
                        <p><code class="codeph">http://example:8080/mapviewer/dataserver/mvdemo?t=theme1&amp;sql=select+*+from+cities&amp;to_srid=3857</code></p>
                        <p>To get all the data of the table CITIES within a given bbox in SRID 3857:</p>
                        <p><code class="codeph">http://example:8080/mapviewer/dataserver/mvdemo?t=theme1&amp;sql=select+*+from+cities&amp;to_srid=3857&amp;bbox=-122.0,25,-100,45</code></p>
                        <p>To run the query as is, without a bbox and return data in SRID 3857:</p>
                        <p><code class="codeph">http://example:8080/mapviewer/dataserver/mvdemo?t=theme1&amp;sql=select+*+from+cities&amp;to_srid=3857&amp;bbox=-122.0,25,-100,45&amp;asis=t</code></p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-A4529184-3550-4058-8EBB-C4670BB4233B">Map Data Server Request Parameters</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="JIMPV10119"></a><div class="props_rev_3"><a id="GUID-11E24A20-1AA6-4A1E-A6DC-53FA29D94225" name="GUID-11E24A20-1AA6-4A1E-A6DC-53FA29D94225"></a><h5 id="JIMPV-GUID-11E24A20-1AA6-4A1E-A6DC-53FA29D94225" class="sect5"><span class="enumeration_section">3.1.2.3 </span>Getting Annotation Text from a JDBC Theme
                     </h5>
                     <div>
                        <p>A request to retrieve annotation text elements from a JDBC theme is similar to that in <a href="map-visualization-servers.html#GUID-1D3893BD-9CCC-48B8-88DD-B62FEA2E33EE">Getting Data from a JDBC Theme</a></p>
                        <p>The following parameters are available for a map data server request to get data from a map visualizer theme based on a dynamic JDBC theme. The <code class="codeph">t</code> (theme name), <code class="codeph">sql</code> (SQL query, <code class="codeph">geom_type</code>, and <code class="codeph">base_table</code> parameters are required; the others are optional.
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">t</code>: Name of the theme.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">sql</code>: The complete SQL query, properly URL encoded.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">geom_type</code>: Must be specified as <code class="codeph">annotation</code> to indicate that the spatial column is on annotation type.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">base_table</code>: The database table (for the server to read annotation text metadata information for that table).
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">asis</code>: Determines whether the query should be executed "as is". The default is <code class="codeph">false</code>, which causes the map visualizer to embed the SQL query as a subquery of its spatial filter query. If the value is <code class="codeph">true</code>, the map visualizer does not attempt to modify the supplied query string.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">bbox</code>: Bounding box. Must be a comma-delimited list of <code class="codeph">minx,miny,maxx,maxy</code>.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">to_srid</code>: SRID (spatial reference system) in which to return the data.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">bbox_srid</code>: SRID (spatial reference system) of the bounding box, if different from the native SRID of the data.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">seq</code>: Sequence ID, to be used when getting data in multipart format.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">dadp</code>: Digits after decimal point: the maximum number of digits after the decimal point for the coordinates in the returned data.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">include_style_info</code>: Determines whether styling information (rendering/labeling style name and related columns) should be included with each feature. (The default is <code class="codeph">true</code>.)
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">include_label_box</code>: Determines whether a label box should be included with each polygon feature. (The default is <code class="codeph">true</code>.) A label box is a near maximum rectangle inside the polygon. A label placed inside this rectangle is guaranteed to be completely inside the polygon feature. This parameter is ignored for non-polygon features.
                              </p>
                           </li>
                        </ul>
                        <p>The following example retrieves annotation text information:</p>
                        <p><code class="codeph">http://example:8080/mapviewer/dataserver/tilsmenv?t=theme1&amp;sql=select+*+from+annotext_table&amp;geom_col=textobj&amp;geom_type=annotation&amp;base_table=annotext_table&amp;bbox=0,0,10,10</code></p>
                        <p>A typical response includes the annotation text table metadata information plus the annotation text feature. Each annotation text feature can have one or more text elements. Each text element can be defined by a text value, a location, a leader line, and graphic attributes. Refer to OGC specification of annotation texts for additional information.</p>
                        <p>The response looks like the following:</p><pre class="oac_no_warn" dir="ltr">{"type":"AnnotationText",
"collectionName":"theme1",
"srs":0,
"geodetic":false,
"bbox":[0, 0, 10, 10],
"attr_names":["ID"],
"attr_types":["double"],
"default_text_attributes":{"fontWeight":"Normal","fontStyle":"Normal","textDecoration":"None","letterSpacing":"Normal","wordSpacing":"Normal","fill":"black","fill-opacity":1.0,"stroke":"black","strokeWidth":1.0,"stroke-opacity":1.0,"horizontalAlignment":"start","verticalAlignment":"top","multilineJustification":"left","multilineSpacing":0.0},
"metadata":{"textExpression":"name","textAttributes":{"fontFamily":"Serif","fontSize":14.0,"fill":"#ff0000"}},
"features":[
{"type":"AnnoText", "elements":[{"location":{"type":"Point", "coordinates":[1, 1]},"textValue":"Sample Label 1","leaderLine":{"type":"LineString", "coordinates":[0,0,1,1]}}],"envelope":{"type":"Rectangle", "coordinates":[0,0,1,1]},"properties":{"ID":"1.0"}},
{"type":"AnnoText", "elements":[{"location":{"type":"LineString", "coordinates":[2,5,4,5,6,5]},"leaderLine":{"type":"LineString", "coordinates":[4,3,4,5]},"textAttributes":{"fontFamily":"Dialog","fontSize":14.0,"fill":"blue"}}],"envelope":{"type":"Rectangle", "coordinates":[2,3,6,5]},"properties":{"ID":"3.0"}},
{"type":"AnnoText", "elements":[{"location":{"type":"Point", "coordinates":[10, 10]},"textValue":"Sample Label 2","leaderLine":{"type":"LineString", "coordinates":[5,10,10,10]}}],"envelope":{"type":"LineString", "coordinates":[5,10,10,10]},"properties":{"ID":"2.0"}}
]}</pre></div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-A4529184-3550-4058-8EBB-C4670BB4233B">Map Data Server Request Parameters</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="JIMPV10120"></a><div class="props_rev_3"><a id="GUID-7CDCDBF2-D41D-49B5-8F18-D73E016515F4" name="GUID-7CDCDBF2-D41D-49B5-8F18-D73E016515F4"></a><h5 id="JIMPV-GUID-7CDCDBF2-D41D-49B5-8F18-D73E016515F4" class="sect5"><span class="enumeration_section">3.1.2.4 </span>Getting Topology Data
                     </h5>
                     <div>
                        <p>A topology set is defined by a set of topology primitives (faces, edges, and nodes(. Each topology feature can be associated with one or more topology primitives.</p>
                        <p>A request to retrieve the topology primitives must contain the <code class="codeph">topology</code> parameter, as in the following example:
                        </p>
                        <p><code class="codeph">http://example:8080/mapviewer/dataserver/tilsmenv?topology=city_data&amp;bbox=10,10,35,35</code></p>
                        <p>The response includes all primitives that interact with input MBR:</p><pre class="oac_no_warn" dir="ltr">{"type":"TopologyPrimitives",
"topology":"city_data",
"srs":0,
"bbox":[0, 0, 62, 42],
"face_attr_names":["FACE_ID","BOUNDARY_EDGE_ID","ISLAND_EDGE_ID_LIST","ISLAND_NODE_ID_LIST"],
"face_attr_types":["integer","integer","array:integer","array:integer"],
"edge_attr_names":["EDGE_ID","START_NODE_ID","END_NODE_ID","NEXT_LEFT_EDGE_ID","PREV_LEFT_EDGE_ID","NEXT_RIGHT_EDGE_ID","PREV_RIGHT_EDGE_ID","LEFT_FACE_ID","RIGHT_FACE_ID"],
"edge_attr_types":["integer","integer","integer","integer","integer","integer","integer","integer","integer"],
"node_attr_names":["NODE_ID","EDGE_ID","FACE_ID"],
"node_attr_types":["integer","integer","integer"],
"primitives":[
{"type":"Face", "mbr_geometry":{"type":"Rectangle", "coordinates":[3,30,15,38]}, "properties":{"FACE_ID":"1", "BOUNDARY_EDGE_ID":"1", "ISLAND_EDGE_ID_LIST":[25]}},
{"type":"Face", "mbr_geometry":{"type":"Rectangle", "coordinates":[9,14,21,22]}, "properties":{"FACE_ID":"3", "BOUNDARY_EDGE_ID":"19"}},
{"type":"Face", "mbr_geometry":{"type":"Rectangle", "coordinates":[9,6,21,14]}, "properties":{"FACE_ID":"6", "BOUNDARY_EDGE_ID":"20"}},
{"type":"Face", "mbr_geometry":{"type":"Rectangle", "coordinates":[17,30,31,40]}, "properties":{"FACE_ID":"2", "BOUNDARY_EDGE_ID":"2", "ISLAND_NODE_ID_LIST":[4]}},
{"type":"Face", "mbr_geometry":{"type":"Rectangle", "coordinates":[21,6,35,14]}, "properties":{"FACE_ID":"7", "BOUNDARY_EDGE_ID":"10"}},
{"type":"Face", "mbr_geometry":{"type":"Rectangle", "coordinates":[21,14,35,22]}, "properties":{"FACE_ID":"4", "BOUNDARY_EDGE_ID":"17"}},
{"type":"Face", "mbr_geometry":{"type":"Rectangle", "coordinates":[35,14,47,22]}, "properties":{"FACE_ID":"5", "BOUNDARY_EDGE_ID":"15"}},
{"type":"Face", "mbr_geometry":{"type":"Rectangle", "coordinates":[35,6,47,14]}, "properties":{"FACE_ID":"8", "BOUNDARY_EDGE_ID":"16"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[8,30,16,30,16,38,3,38,3,30,8,30]}, "properties":{"EDGE_ID":"1", "START_NODE_ID":"1", "END_NODE_ID":"1", "NEXT_LEFT_EDGE_ID":"1", "PREV_LEFT_EDGE_ID":"1", "NEXT_RIGHT_EDGE_ID":"-1", "PREV_RIGHT_EDGE_ID":"-1", "LEFT_FACE_ID":"1", "RIGHT_FACE_ID":"-1"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[4,31,7,31,7,34,4,34,4,31]}, "properties":{"EDGE_ID":"26", "START_NODE_ID":"20", "END_NODE_ID":"20", "NEXT_LEFT_EDGE_ID":"26", "PREV_LEFT_EDGE_ID":"26", "NEXT_RIGHT_EDGE_ID":"-26", "PREV_RIGHT_EDGE_ID":"-26", "LEFT_FACE_ID":"9", "RIGHT_FACE_ID":"1"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[9,22,21,22]}, "properties":{"EDGE_ID":"6", "START_NODE_ID":"16", "END_NODE_ID":"17", "NEXT_LEFT_EDGE_ID":"7", "PREV_LEFT_EDGE_ID":"21", "NEXT_RIGHT_EDGE_ID":"-21", "PREV_RIGHT_EDGE_ID":"19", "LEFT_FACE_ID":"-1", "RIGHT_FACE_ID":"3"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[9,14,9,22]}, "properties":{"EDGE_ID":"21", "START_NODE_ID":"15", "END_NODE_ID":"16", "NEXT_LEFT_EDGE_ID":"6", "PREV_LEFT_EDGE_ID":"22", "NEXT_RIGHT_EDGE_ID":"9", "PREV_RIGHT_EDGE_ID":"-6", "LEFT_FACE_ID":"-1", "RIGHT_FACE_ID":"3"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[9,14,21,14]}, "properties":{"EDGE_ID":"9", "START_NODE_ID":"15", "END_NODE_ID":"14", "NEXT_LEFT_EDGE_ID":"19", "PREV_LEFT_EDGE_ID":"-21", "NEXT_RIGHT_EDGE_ID":"-22", "PREV_RIGHT_EDGE_ID":"20", "LEFT_FACE_ID":"3", "RIGHT_FACE_ID":"6"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[9,6,21,6]}, "properties":{"EDGE_ID":"12", "START_NODE_ID":"8", "END_NODE_ID":"9", "NEXT_LEFT_EDGE_ID":"20", "PREV_LEFT_EDGE_ID":"-22", "NEXT_RIGHT_EDGE_ID":"22", "PREV_RIGHT_EDGE_ID":"-13", "LEFT_FACE_ID":"6", "RIGHT_FACE_ID":"-1"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[9,35,13,35]}, "properties":{"EDGE_ID":"25", "START_NODE_ID":"21", "END_NODE_ID":"22", "NEXT_LEFT_EDGE_ID":"-25", "PREV_LEFT_EDGE_ID":"-25", "NEXT_RIGHT_EDGE_ID":"25", "PREV_RIGHT_EDGE_ID":"25", "LEFT_FACE_ID":"1", "RIGHT_FACE_ID":"1"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[9,6,9,14]}, "properties":{"EDGE_ID":"22", "START_NODE_ID":"8", "END_NODE_ID":"15", "NEXT_LEFT_EDGE_ID":"21", "PREV_LEFT_EDGE_ID":"-12", "NEXT_RIGHT_EDGE_ID":"12", "PREV_RIGHT_EDGE_ID":"-9", "LEFT_FACE_ID":"-1", "RIGHT_FACE_ID":"6"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[25,30,31,30,31,40,17,40,17,30,25,30]}, "properties":{"EDGE_ID":"2", "START_NODE_ID":"2", "END_NODE_ID":"2", "NEXT_LEFT_EDGE_ID":"3", "PREV_LEFT_EDGE_ID":"-3", "NEXT_RIGHT_EDGE_ID":"-2", "PREV_RIGHT_EDGE_ID":"-2", "LEFT_FACE_ID":"2", "RIGHT_FACE_ID":"-1"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[21,6,35,6]}, "properties":{"EDGE_ID":"13", "START_NODE_ID":"9", "END_NODE_ID":"10", "NEXT_LEFT_EDGE_ID":"18", "PREV_LEFT_EDGE_ID":"-20", "NEXT_RIGHT_EDGE_ID":"-12", "PREV_RIGHT_EDGE_ID":"-14", "LEFT_FACE_ID":"7", "RIGHT_FACE_ID":"-1"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[21,22,35,22]}, "properties":{"EDGE_ID":"7", "START_NODE_ID":"17", "END_NODE_ID":"18", "NEXT_LEFT_EDGE_ID":"8", "PREV_LEFT_EDGE_ID":"6", "NEXT_RIGHT_EDGE_ID":"-19", "PREV_RIGHT_EDGE_ID":"17", "LEFT_FACE_ID":"-1", "RIGHT_FACE_ID":"4"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[21,6,21,14]}, "properties":{"EDGE_ID":"20", "START_NODE_ID":"9", "END_NODE_ID":"14", "NEXT_LEFT_EDGE_ID":"-9", "PREV_LEFT_EDGE_ID":"12", "NEXT_RIGHT_EDGE_ID":"13", "PREV_RIGHT_EDGE_ID":"10", "LEFT_FACE_ID":"6", "RIGHT_FACE_ID":"7"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[35,14,21,14]}, "properties":{"EDGE_ID":"10", "START_NODE_ID":"13", "END_NODE_ID":"14", "NEXT_LEFT_EDGE_ID":"-20", "PREV_LEFT_EDGE_ID":"18", "NEXT_RIGHT_EDGE_ID":"17", "PREV_RIGHT_EDGE_ID":"-19", "LEFT_FACE_ID":"7", "RIGHT_FACE_ID":"4"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[21,14,21,22]}, "properties":{"EDGE_ID":"19", "START_NODE_ID":"14", "END_NODE_ID":"17", "NEXT_LEFT_EDGE_ID":"-6", "PREV_LEFT_EDGE_ID":"9", "NEXT_RIGHT_EDGE_ID":"-10", "PREV_RIGHT_EDGE_ID":"-7", "LEFT_FACE_ID":"3", "RIGHT_FACE_ID":"4"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[25,30,25,35]}, "properties":{"EDGE_ID":"3", "START_NODE_ID":"2", "END_NODE_ID":"3", "NEXT_LEFT_EDGE_ID":"-3", "PREV_LEFT_EDGE_ID":"2", "NEXT_RIGHT_EDGE_ID":"2", "PREV_RIGHT_EDGE_ID":"3", "LEFT_FACE_ID":"2", "RIGHT_FACE_ID":"2"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[35,6,47,6]}, "properties":{"EDGE_ID":"14", "START_NODE_ID":"10", "END_NODE_ID":"11", "NEXT_LEFT_EDGE_ID":"16", "PREV_LEFT_EDGE_ID":"-18", "NEXT_RIGHT_EDGE_ID":"-13", "PREV_RIGHT_EDGE_ID":"-16", "LEFT_FACE_ID":"8", "RIGHT_FACE_ID":"-1"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[35,14,47,14]}, "properties":{"EDGE_ID":"11", "START_NODE_ID":"13", "END_NODE_ID":"12", "NEXT_LEFT_EDGE_ID":"15", "PREV_LEFT_EDGE_ID":"-17", "NEXT_RIGHT_EDGE_ID":"-18", "PREV_RIGHT_EDGE_ID":"16", "LEFT_FACE_ID":"5", "RIGHT_FACE_ID":"8"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[35,6,35,14]}, "properties":{"EDGE_ID":"18", "START_NODE_ID":"10", "END_NODE_ID":"13", "NEXT_LEFT_EDGE_ID":"10", "PREV_LEFT_EDGE_ID":"13", "NEXT_RIGHT_EDGE_ID":"14", "PREV_RIGHT_EDGE_ID":"-11", "LEFT_FACE_ID":"7", "RIGHT_FACE_ID":"8"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[35,22,47,22]}, "properties":{"EDGE_ID":"8", "START_NODE_ID":"18", "END_NODE_ID":"19", "NEXT_LEFT_EDGE_ID":"-15", "PREV_LEFT_EDGE_ID":"7", "NEXT_RIGHT_EDGE_ID":"-17", "PREV_RIGHT_EDGE_ID":"15", "LEFT_FACE_ID":"-1", "RIGHT_FACE_ID":"5"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[35,14,35,22]}, "properties":{"EDGE_ID":"17", "START_NODE_ID":"13", "END_NODE_ID":"18", "NEXT_LEFT_EDGE_ID":"-7", "PREV_LEFT_EDGE_ID":"-10", "NEXT_RIGHT_EDGE_ID":"11", "PREV_RIGHT_EDGE_ID":"-8", "LEFT_FACE_ID":"4", "RIGHT_FACE_ID":"5"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[36,38,38,35,41,34,42,33,45,32,47,28,50,28,52,32,57,33]}, "properties":{"EDGE_ID":"4", "START_NODE_ID":"5", "END_NODE_ID":"6", "NEXT_LEFT_EDGE_ID":"-5", "PREV_LEFT_EDGE_ID":"-4", "NEXT_RIGHT_EDGE_ID":"4", "PREV_RIGHT_EDGE_ID":"5", "LEFT_FACE_ID":"-1", "RIGHT_FACE_ID":"-1"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[41,40,45,40,47,42,62,41,61,38,59,39,57,36,57,33]}, "properties":{"EDGE_ID":"5", "START_NODE_ID":"7", "END_NODE_ID":"6", "NEXT_LEFT_EDGE_ID":"-4", "PREV_LEFT_EDGE_ID":"-5", "NEXT_RIGHT_EDGE_ID":"5", "PREV_RIGHT_EDGE_ID":"4", "LEFT_FACE_ID":"-1", "RIGHT_FACE_ID":"-1"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[47,14,47,22]}, "properties":{"EDGE_ID":"15", "START_NODE_ID":"12", "END_NODE_ID":"19", "NEXT_LEFT_EDGE_ID":"-8", "PREV_LEFT_EDGE_ID":"11", "NEXT_RIGHT_EDGE_ID":"-16", "PREV_RIGHT_EDGE_ID":"8", "LEFT_FACE_ID":"5", "RIGHT_FACE_ID":"-1"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[47,6,47,14]}, "properties":{"EDGE_ID":"16", "START_NODE_ID":"11", "END_NODE_ID":"12", "NEXT_LEFT_EDGE_ID":"-11", "PREV_LEFT_EDGE_ID":"14", "NEXT_RIGHT_EDGE_ID":"-14", "PREV_RIGHT_EDGE_ID":"-15", "LEFT_FACE_ID":"8", "RIGHT_FACE_ID":"-1"}},
{"type":"Node", "geometry":{"type":"Point", "coordinates":[4, 31]}, "properties":{"NODE_ID":"20", "EDGE_ID":"26", "FACE_ID":"0"}},
{"type":"Node", "geometry":{"type":"Point", "coordinates":[8, 30]}, "properties":{"NODE_ID":"1", "EDGE_ID":"1", "FACE_ID":"0"}},
{"type":"Node", "geometry":{"type":"Point", "coordinates":[9, 6]}, "properties":{"NODE_ID":"8", "EDGE_ID":"12", "FACE_ID":"0"}},
{"type":"Node", "geometry":{"type":"Point", "coordinates":[9, 35]}, "properties":{"NODE_ID":"21", "EDGE_ID":"25", "FACE_ID":"0"}},
{"type":"Node", "geometry":{"type":"Point", "coordinates":[9, 14]}, "properties":{"NODE_ID":"15", "EDGE_ID":"21", "FACE_ID":"0"}},
{"type":"Node", "geometry":{"type":"Point", "coordinates":[9, 22]}, "properties":{"NODE_ID":"16", "EDGE_ID":"6", "FACE_ID":"0"}},
{"type":"Node", "geometry":{"type":"Point", "coordinates":[13, 35]}, "properties":{"NODE_ID":"22", "EDGE_ID":"-25", "FACE_ID":"0"}},
{"type":"Node", "geometry":{"type":"Point", "coordinates":[20, 37]}, "properties":{"NODE_ID":"4", "EDGE_ID":"0", "FACE_ID":"2"}},
{"type":"Node", "geometry":{"type":"Point", "coordinates":[21, 14]}, "properties":{"NODE_ID":"14", "EDGE_ID":"19", "FACE_ID":"0"}},
{"type":"Node", "geometry":{"type":"Point", "coordinates":[21, 22]}, "properties":{"NODE_ID":"17", "EDGE_ID":"7", "FACE_ID":"0"}},
{"type":"Node", "geometry":{"type":"Point", "coordinates":[21, 6]}, "properties":{"NODE_ID":"9", "EDGE_ID":"20", "FACE_ID":"0"}},
{"type":"Node", "geometry":{"type":"Point", "coordinates":[25, 30]}, "properties":{"NODE_ID":"2", "EDGE_ID":"2", "FACE_ID":"0"}},
{"type":"Node", "geometry":{"type":"Point", "coordinates":[25, 35]}, "properties":{"NODE_ID":"3", "EDGE_ID":"-3", "FACE_ID":"0"}},
{"type":"Node", "geometry":{"type":"Point", "coordinates":[35, 14]}, "properties":{"NODE_ID":"13", "EDGE_ID":"17", "FACE_ID":"0"}},
{"type":"Node", "geometry":{"type":"Point", "coordinates":[35, 6]}, "properties":{"NODE_ID":"10", "EDGE_ID":"18", "FACE_ID":"0"}},
{"type":"Node", "geometry":{"type":"Point", "coordinates":[35, 22]}, "properties":{"NODE_ID":"18", "EDGE_ID":"8", "FACE_ID":"0"}},
{"type":"Node", "geometry":{"type":"Point", "coordinates":[36, 38]}, "properties":{"NODE_ID":"5", "EDGE_ID":"4", "FACE_ID":"0"}},
{"type":"Node", "geometry":{"type":"Point", "coordinates":[41, 40]}, "properties":{"NODE_ID":"7", "EDGE_ID":"5", "FACE_ID":"0"}},
{"type":"Node", "geometry":{"type":"Point", "coordinates":[47, 14]}, "properties":{"NODE_ID":"12", "EDGE_ID":"15", "FACE_ID":"0"}},
{"type":"Node", "geometry":{"type":"Point", "coordinates":[47, 6]}, "properties":{"NODE_ID":"11", "EDGE_ID":"-14", "FACE_ID":"0"}},
{"type":"Node", "geometry":{"type":"Point", "coordinates":[47, 22]}, "properties":{"NODE_ID":"19", "EDGE_ID":"-15", "FACE_ID":"0"}},
{"type":"Node", "geometry":{"type":"Point", "coordinates":[57, 33]}, "properties":{"NODE_ID":"6", "EDGE_ID":"-4", "FACE_ID":"0"}}
]}
</pre><p>To retrieve topology features, the following example specifies the <code class="codeph">topology</code>, <code class="codeph">base_table</code>, and <code class="codeph">geom_col</code> parameters (where <code class="codeph">grom_col</code> refers to the topology column):
                        </p>
                        <p><code class="codeph">http://example:8080/mapviewer/dataserver/tilsmenv?topology=city_data&amp;base_table=land_parcels&amp;geom_col=feature</code></p>
                        <p>The response to this request is similar to the following:</p><pre class="oac_no_warn" dir="ltr">{"type":"TopologyFeatures",
"topology":"CITY_DATA",
"topology_id":5,
"topology_owner":"TILSZUSER",
"tolerance":5.0E-5,
"srs":0,
"table_schema":"TILSZUSER",
"table_name":"LAND_PARCELS",
"topo_column":"FEATURE",
"layer_id":1,
"layer_type":"POLYGON",
"layer_level":0,
"child_layer":0,
"node_sequence":"CITY_DATA_NODE_S",
"edge_sequence":"CITY_DATA_EDGE_S",
"face_sequence":"CITY_DATA_FACE_S",
"feature_sequence":"CITY_DATA_TG_S",
"digits_right_decimal":16,
"attr_names":["FEATURE_NAME"],
"attr_types":["string"],
"features":[
{"type":"topology", "tg_id":4, "primitives":[{"topo_id":3,"topo_type":3},{"topo_id":6,"topo_type":3}], "properties":{"FEATURE_NAME":"P1"}},
{"type":"topology", "tg_id":5, "primitives":[{"topo_id":4,"topo_type":3},{"topo_id":7,"topo_type":3}], "properties":{"FEATURE_NAME":"P2"}},
{"type":"topology", "tg_id":6, "primitives":[{"topo_id":5,"topo_type":3},{"topo_id":8,"topo_type":3}], "properties":{"FEATURE_NAME":"P3"}},
{"type":"topology", "tg_id":7, "primitives":[{"topo_id":2,"topo_type":3}], "properties":{"FEATURE_NAME":"P4"}},
{"type":"topology", "tg_id":8, "primitives":[{"topo_id":1,"topo_type":3}], "properties":{"FEATURE_NAME":"P5"}}
]}
</pre><p>To specific primitive faces, edges, and nodes, the following example define the primitive identifiers:</p>
                        <p><code class="codeph">http://example:8080/mapviewer/dataserver/tilsmenv?topology=city_data&amp;face_ids=-1&amp;edge_ids=3,4&amp;node_ids=5</code></p>
                        <p>The response to this request is similar to the following:</p><pre class="oac_no_warn" dir="ltr">{"type":"TopologyPrimitives",
"topology":"city_data",
"srs":0,
"bbox":[0, 0, 57, 38],
"face_attr_names":["FACE_ID","BOUNDARY_EDGE_ID","ISLAND_EDGE_ID_LIST","ISLAND_NODE_ID_LIST"],
"face_attr_types":["integer","integer","array:integer","array:integer"],
"edge_attr_names":["EDGE_ID","START_NODE_ID","END_NODE_ID","NEXT_LEFT_EDGE_ID","PREV_LEFT_EDGE_ID","NEXT_RIGHT_EDGE_ID","PREV_RIGHT_EDGE_ID","LEFT_FACE_ID","RIGHT_FACE_ID"],
"edge_attr_types":["integer","integer","integer","integer","integer","integer","integer","integer","integer"],
"node_attr_names":["NODE_ID","EDGE_ID","FACE_ID"],
"node_attr_types":["integer","integer","integer"],
"primitives":[
{"type":"Face", "properties":{"FACE_ID":"-1", "BOUNDARY_EDGE_ID":"0", "ISLAND_EDGE_ID_LIST":[-1,-2,4,6]}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[25,30,25,35]}, "properties":{"EDGE_ID":"3", "START_NODE_ID":"2", "END_NODE_ID":"3", "NEXT_LEFT_EDGE_ID":"-3", "PREV_LEFT_EDGE_ID":"2", "NEXT_RIGHT_EDGE_ID":"2", "PREV_RIGHT_EDGE_ID":"3", "LEFT_FACE_ID":"2", "RIGHT_FACE_ID":"2"}},
{"type":"Edge", "geometry":{"type":"LineString", "coordinates":[36,38,38,35,41,34,42,33,45,32,47,28,50,28,52,32,57,33]}, "properties":{"EDGE_ID":"4", "START_NODE_ID":"5", "END_NODE_ID":"6", "NEXT_LEFT_EDGE_ID":"-5", "PREV_LEFT_EDGE_ID":"-4", "NEXT_RIGHT_EDGE_ID":"4", "PREV_RIGHT_EDGE_ID":"5", "LEFT_FACE_ID":"-1", "RIGHT_FACE_ID":"-1"}},
{"type":"Node", "geometry":{"type":"Point", "coordinates":[36, 38]}, "properties":{"NODE_ID":"5", "EDGE_ID":"4", "FACE_ID":"0"}}
]}</pre></div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-A4529184-3550-4058-8EBB-C4670BB4233B">Map Data Server Request Parameters</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="JIMPV10121"></a><div class="props_rev_3"><a id="GUID-28D5721C-1246-4C56-8602-3DB9CC05D1F3" name="GUID-28D5721C-1246-4C56-8602-3DB9CC05D1F3"></a><h4 id="JIMPV-GUID-28D5721C-1246-4C56-8602-3DB9CC05D1F3" class="sect4"><span class="enumeration_section">3.1.3 </span>Interpreting Data Returned from the Map Data Server
                  </h4>
                  <div>
                     <p>The map data server returns data in a compressed GeoJSON format. Some minor changes and additions to the standard GeoJSON are made to improve performance and the usefulness of the information.</p>
                     <p>The following is a sample response:</p><pre class="oac_no_warn" dir="ltr">{"type":"FeatureCollection",
"collectionName":"theme1",
"srs":3857,
"geodetic":false,
"bbox":[-17566686.86258, 2414218.89842, -7905675.57465, 8629389.76988],
"attr_names":["CITY","STATE_ABRV","POP90","RANK90"],
"attr_types":["string","string","double","double"],
"features":[
{"type":"Feature","_id":"AAASQ3AAEAAAAMbAAA","geometry": {"type":"Point", "coordinates":[-119.99823, 38.9052]},"properties":{"CITY":"SOUTH LAKE TAHOE", "SALES":"125.8", "NAME":"FACTORY STORES AT THE Y", "_label_":"FACTORY STORES AT THE Y"},"styles":{"rendering":{"style":"M.SMALL CIRCLE"},"labeling":{"style":"T.RED STREET", "columns":["_label_"]}}},
{"type":"Feature","_id":"AAASQ3AAEAAAAMbAAB","geometry": {"type":"Point", "coordinates":[-121.95073, 37.53356]},"properties":{"CITY":"FREMONT", "SALES":"186.8", "NAME":"OHLONE VILLAGE", "_label_":"OHLONE VILLAGE"},"styles":{"rendering":{"style":"M.SMALL CIRCLE"},"labeling":{"style":"T.RED STREET", "columns":["_label_"]}}},
{"type":"Feature","_id":"AAASQ3AAEAAAAMbAAC","geometry": {"type":"Point", "coordinates":[-118.48844, 34.02353]},"properties":{"CITY":"SANTA MONICA", "SALES":"9.1", "NAME":"SANTA MONICA PLACE", "_label_":"SANTA MONICA PLACE"},"styles":{"rendering":{"style":"M.SMALL CIRCLE"},"labeling":{"style":"T.RED STREET", "columns":["_label_"]}}},
{"type":"Feature","_id":"AAASQ3AAEAAAAMbAAD","geometry": {"type":"Point", "coordinates":[-118.55093, 34.42104]},"properties":{"CITY":"SANTA CLARITA", "SALES":"52.6", "NAME":"VALENCIA TOWN CENTER", "_label_":"VALENCIA TOWN CENTER"},"styles":{"rendering":{"style":"M.SMALL CIRCLE"},"labeling":{"style":"T.RED STREET", "columns":["_label_"]}}},
{"type":"Feature","_id":"AAASQ3AAEAAAAMbAAE","geometry": {"type":"Point", "coordinates":[-122.56007, 38.08187]},"properties":{"CITY":"NOVATO", "SALES":"119.1", "NAME":"VINTAGE OAKS AT NOVATO", "_label_":"VINTAGE OAKS AT NOVATO"},"styles":{"rendering":{"style":"M.SMALL CIRCLE"},"labeling":{"style":"T.RED STREET", "columns":["_label_"]}}}]}
</pre><p>The response contains a minimal header plus an array of features. The header includes the spatial reference system (<code class="codeph">srs</code>) ID and the minimum bounding box of the result data. The array of features includes attribute names and their types. Possible type names include: <code class="codeph">"byte","short","int","long","float","double","char","string","boolean", "date"</code></p>
                     <p>For each feature, the following fields apply:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><code class="codeph">type</code>: Always <code class="codeph">Feature</code>.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">_id</code>: Optional ID or key attribute.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">geometry</code>: The actual geometry encoded in the modified GeoJSON format.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">properties</code>: An object containing all the properties (name-value pairs) for the feature.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">styles</code>: An optional styling information object. Contains two embedded objects, <code class="codeph">rendering</code> and <code class="codeph">labeling</code>, which share the same structure: basically an object containing a <code class="codeph">style</code> field and an optional <code class="codeph">columns</code> array. Currently only predefined themes support including styling information in the response; a dynamic theme's response contains no styling information.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">label_box</code>: A 4-element array specifying the <code class="codeph">minX</code>, <code class="codeph">minY</code>, <code class="codeph">maxX</code>, and <code class="codeph">maxY</code> of the label box. Only a polygon can have a label box.
                           </p>
                        </li>
                     </ul>
                     <p>Note that the labeling text is always included as a pseudo-property with the name <code class="codeph">_label_</code> in the property list.
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-3A6C41AB-66DC-40D7-8B3A-9B2F7A1ED58F" title="The map visualizer map data server provides services for streaming live data from a database server to a client.">Map Visualizer Map Data Server</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="JIMPV10122"></a><div class="props_rev_3"><a id="GUID-13559073-0FDA-461A-8A71-826722F2AEC5" name="GUID-13559073-0FDA-461A-8A71-826722F2AEC5"></a><h4 id="JIMPV-GUID-13559073-0FDA-461A-8A71-826722F2AEC5" class="sect4"><span class="enumeration_section">3.1.4 </span>Map Data Server Error Handling
                  </h4>
                  <div>
                     <p>If the map data server cannot process a data request, it will send a JSON response containing an error object. This JSON error object may look like the following:</p><pre class="oac_no_warn" dir="ltr">{"error":
  {"code": "ora-500",
   "message": "Table requested does not exist",
   "details": "maybe a stack trace here..."
  }
}
</pre><p>In the preceding JSON object, <code class="codeph">code</code> is the error code known only to the map data serve, <code class="codeph">message</code> contains a short message that can be displayed to the end user in a warning dialog, and <code class="codeph">details</code> is an optional field that may contain more details (such as the stack trace if included).
                     </p>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-3A6C41AB-66DC-40D7-8B3A-9B2F7A1ED58F" title="The map visualizer map data server provides services for streaming live data from a database server to a client.">Map Visualizer Map Data Server</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="JIMPV9794"></a><a id="JIMPV9793"></a><div class="props_rev_3"><a id="GUID-7E88B130-FB2F-47D1-A8B2-909CFB1454AC" name="GUID-7E88B130-FB2F-47D1-A8B2-909CFB1454AC"></a><h3 id="JIMPV-GUID-7E88B130-FB2F-47D1-A8B2-909CFB1454AC" class="sect3"><span class="enumeration_section">3.2 </span>Map Tile Server
               </h3>
               <div>
                  <p>The map tile server is a map image caching engine that fetches, caches, and serves pregenerated, fixed-size map image tiles.</p>
                  <p>It is implemented as a Java servlet that is part of the map visualizer server. The map tile server accepts requests that ask for map image tiles specified by tile zoom level and tile location (mesh code), and it sends the requested tiles back to clients.</p>
                  <p><a href="map-visualization-servers.html#GUID-7E88B130-FB2F-47D1-A8B2-909CFB1454AC__BABCGFGD">Figure 3-1</a> shows the basic workflow of the map tile server.
                  </p>
                  <div class="figure" id="GUID-7E88B130-FB2F-47D1-A8B2-909CFB1454AC__BABCGFGD">
                     <p class="titleinfigure">Figure 3-1 Workflow of the Map Tile Server</p><img src="img/workflow_omaps.jpg" alt="Description of Figure 3-1 follows" title="Description of Figure 3-1 follows" longdesc="img_text/workflow_omaps.html"><br><a href="img_text/workflow_omaps.html">Description of "Figure 3-1 Workflow of the Map Tile Server"</a></div>
                  <!-- class="figure" -->
                  <p>As shown in <a href="map-visualization-servers.html#GUID-7E88B130-FB2F-47D1-A8B2-909CFB1454AC__BABCGFGD">Figure 3-1</a>, when the map tile server receives a request for a map tile, it searches for the tile in the cache storage system. If the tile is cached, the map tile server sends the tile to the client. If the tile is not cached, the map tile server fetches the tile, saves it in the cache, and sends it to the client.
                  </p>
                  <p>You can use the map visualizer administration tool to manage the map tile server.</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-A151DBDD-2F04-4AFC-B658-E943C2E1CA1E">Map Tile Server Concepts</a><br></li>
                     <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-A144D404-681B-4BBE-A3FF-E9826A5DF605">Map Tile Server Configuration</a><br></li>
                     <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-A2E5CC6C-EC68-4C67-A1D1-09B8123BF3C3">Map Cache Auto-Update</a><br></li>
                     <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-9576FC06-D773-4C47-8F5F-DF3AD4567206">UTFGrid for Map Tiles: Including Text Information About Features</a><br></li>
                     <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-D58CA71F-B70B-4FFE-964A-CEE2859C7FC6">External Map Source Adapter</a><br></li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-0D2CF483-95C0-45D0-B4E8-5A4578741A63" title="The map visualizer, as a set of Java Enterprise Edition packages, contains a collection of servers to provide mapping services.">Map Visualization Servers</a></p>
                     </div>
                  </div>
               </div>
               <a id="JIMPV9795"></a><div class="props_rev_3"><a id="GUID-A151DBDD-2F04-4AFC-B658-E943C2E1CA1E" name="GUID-A151DBDD-2F04-4AFC-B658-E943C2E1CA1E"></a><h4 id="JIMPV-GUID-A151DBDD-2F04-4AFC-B658-E943C2E1CA1E" class="sect4"><span class="enumeration_section">3.2.1 </span>Map Tile Server Concepts
                  </h4>
                  <div>
                     <p>This section explains map tile server concepts that you need to know to be able to use Oracle Maps effectively.</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-B80231C4-6E0F-4CC4-9561-6CFEDCD93C68">Map Tile Layers and Map Tile Sources</a><br></li>
                        <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-F0DB152D-5F21-41E5-9D58-AAA71B82753B">Storage of Map Image Tiles</a><br></li>
                        <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-BEC4AE53-AFCF-4872-8C7C-2F21F025ECB0">Coordinate System for Map Tiles</a><br></li>
                        <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-9C11BC3A-B721-4B0A-B576-5773363196DC">Tile Mesh Codes</a><br></li>
                        <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-F0B40C14-40EC-4973-B68D-2EFD4C825E86">Map Tile Requests</a><br></li>
                        <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-F2CD1712-676D-4986-9233-4ACC7E3809B9">Tiling Rules</a><br></li>
                        <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-1D0E8411-88A0-4874-8EAD-BD558E752F08">Tile Background Color and Out-of-Bounds Color</a><br></li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-7E88B130-FB2F-47D1-A8B2-909CFB1454AC" title="The map tile server is a map image caching engine that fetches, caches, and serves pregenerated, fixed-size map image tiles.">Map Tile Server</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="JIMPV9796"></a><div class="props_rev_3"><a id="GUID-B80231C4-6E0F-4CC4-9561-6CFEDCD93C68" name="GUID-B80231C4-6E0F-4CC4-9561-6CFEDCD93C68"></a><h5 id="JIMPV-GUID-B80231C4-6E0F-4CC4-9561-6CFEDCD93C68" class="sect5"><span class="enumeration_section">3.2.1.1 </span>Map Tile Layers and Map Tile Sources
                     </h5>
                     <div>
                        <p>All map tile layers are managed by the map tile server. The <span class="bold">map tile server</span> fetches and stores the map image tiles that belong to the map tile layer and returns map image tiles to the client. The map tile server can manage multiple map tile layers.
                        </p>
                        <p>Each map tile layer can have multiple predefined zoom levels. Each zoom level is assigned a zoom level number ranging from 0 to n-1, where n is the total number of zoom levels. Zoom level 0 is the most zoomed out level and zoom level n-1 is the most zoomed in level.</p>
                        <p>The map is evenly divided into same-sized small map image tiles on each zoom level. Clients specify a map tile by its zoom level and tile mesh code.</p>
                        <p>A map tile layer can come from two different types of sources:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Internal map visualizer base maps rendered by the map visualizer map rendering engine. A map visualizer base map consists of a set of predefined themes and must be predefined in the database view USER_SDO_MAPS.</p>
                           </li>
                           <li>
                              <p>Maps rendered by an external web map services providers. An external web map services provider is a server that renders and serves maps upon client requests over the web. If you properly configure an adapter that can fetch maps from the external map services provider, the map tile server can fetch and cache map tiles generated by the external map services provider. (A map visualizer instance other than the map visualizer inside which the map tile server is running is also considered an external map services provider.)</p>
                           </li>
                        </ul>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-A151DBDD-2F04-4AFC-B658-E943C2E1CA1E">Map Tile Server Concepts</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="JIMPV9797"></a><div class="props_rev_3"><a id="GUID-F0DB152D-5F21-41E5-9D58-AAA71B82753B" name="GUID-F0DB152D-5F21-41E5-9D58-AAA71B82753B"></a><h5 id="JIMPV-GUID-F0DB152D-5F21-41E5-9D58-AAA71B82753B" class="sect5"><span class="enumeration_section">3.2.1.2 </span>Storage of Map Image Tiles
                     </h5>
                     <div>
                        <p>Oracle Maps has three options for handling the storage of map image tiles:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="map-visualization-servers.html#GUID-A61122F9-FD15-4797-A48D-DB5B6D3946DC">Store the tiles using the local file system</a>.
                              </p>
                              <p>If you use the local file system for caching, you can customize the path that is used for this storage as part of the map tile server configuration settings.</p>
                           </li>
                           <li>
                              <p><a href="map-visualization-servers.html#GUID-F9C62C09-CF22-40F0-B4D3-E9A5AC0FED32">Store the tiles in a database table</a>.
                              </p>
                              <p>If you use a database table for caching, you must create the database table, and set the TILES_TABLE column to that table for the tile layer in the USER_SDO_CACHED_MAPS view.</p>
                           </li>
                           <li>
                              <p><a href="map-visualization-servers.html#GUID-A4B8E43B-A59B-4D77-89C7-91A29602DE46">Stream the tiles directly without storing them</a>.
                              </p>
                              <p>If you do not want to cache any image tiles, you must indicate that in the tile layer's definition.</p>
                           </li>
                        </ul>
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-A61122F9-FD15-4797-A48D-DB5B6D3946DC">Store the tiles using the local file system</a><br></li>
                           <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-F9C62C09-CF22-40F0-B4D3-E9A5AC0FED32">Store the tiles in a database table</a><br></li>
                           <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-A4B8E43B-A59B-4D77-89C7-91A29602DE46">Stream the tiles directly without storing them</a><br></li>
                        </ul>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-A151DBDD-2F04-4AFC-B658-E943C2E1CA1E">Map Tile Server Concepts</a></p>
                           </div>
                        </div>
                     </div>
                     <a id="JIMPV10069"></a><div class="props_rev_3"><a id="GUID-A61122F9-FD15-4797-A48D-DB5B6D3946DC" name="GUID-A61122F9-FD15-4797-A48D-DB5B6D3946DC"></a><h6 id="JIMPV-GUID-A61122F9-FD15-4797-A48D-DB5B6D3946DC" class="sect6"><span class="enumeration_section">3.2.1.2.1 </span>Store the tiles using the local file system 
                        </h6>
                        <div>
                           <p>In a file system, each tile layer has its own storage root directory, which is specified by the <code class="codeph">&lt;cache_storage&gt;</code> element's <code class="codeph">root_path</code> attribute in the tile layer definition. If that attribute is not specified, then the default storage location specified in the <code class="codeph">mapViewerConfig.xml</code> file <code class="codeph">&lt;tile_storage&gt;</code> element is used as the root path. For example, if the root path is defined as <code class="codeph">/scratch/tilecache/</code>, and a data source named MVDEMO has a tile layer named DEMO_MAP with 19 zoom levels, after the server is instantiated the folder <code class="codeph">/scratch/tilecache/MVDEMO.DEMO_MAP</code> is created, and it contains 19 subfolders (<code class="codeph">/0</code>, <code class="codeph">/1</code>, , <code class="codeph">/18</code>), each for storing the image tiles in that zoom level.
                           </p>
                           <p>Under each zoom level, there are two options to organize its subfolders for map tiles. One is the default option, which uses a mesh code tree structure; the other, called xyz storage scheme, uses the tile's row and column values as subfolder and tile name to store the map tile. Both storage options start from the tile's mesh code value for each zoom level (see <a href="map-visualization-servers.html#GUID-9C11BC3A-B721-4B0A-B576-5773363196DC">Tile Mesh Codes</a> for details about the tile mesh code). Each tile in a zoom level can be represented using its mesh code value pair (<code class="codeph">mx, my</code>), where the <code class="codeph">mx</code> and <code class="codeph">my</code> are integer values in the horizontal and vertical directions respectively. The tile at the lower left corner has a value of (0, 0). A tile can also be located using its tile row and tile column value pair (<code class="codeph">tile_column, tile_row</code>). A tile at the upper left corner has a value of (0, 0).
                           </p>
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-F0DB152D-5F21-41E5-9D58-AAA71B82753B">Storage of Map Image Tiles</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="JIMPV10070"></a><div class="props_rev_3"><a id="GUID-F9C62C09-CF22-40F0-B4D3-E9A5AC0FED32" name="GUID-F9C62C09-CF22-40F0-B4D3-E9A5AC0FED32"></a><h6 id="JIMPV-GUID-F9C62C09-CF22-40F0-B4D3-E9A5AC0FED32" class="sect6"><span class="enumeration_section">3.2.1.2.2 </span>Store the tiles in a database table 
                        </h6>
                        <div>
                           <p>Image tiles can be stored in a database table, as follows.</p>
                           <ol>
                              <li>
                                 <p>Create a table for storing the image tiles. For example:</p><pre class="oac_no_warn" dir="ltr">CREATE TABLE tile_dbt (
  tile_layer varchar2(64),
  zoom_level number,
  x number,
  y number,
  modified TIMESTAMP,
  data BLOB);
COMMIT;
</pre></li>
                              <li>
                                 <p>Update the TILES_TABLE column in USER_SDO_CACHED_MAPS view for the tile layer. For example, if you have a tile layer DEMP_MAP and you want to use the table created in step 1 to store its map tiles, then update the tile layer's TILES_TABLE column as follows:</p><pre class="oac_no_warn" dir="ltr">UPDATE user_sdo_cached_maps SET tiles_table='tiles_dbt' WHERE name='DEMP_MAP';
</pre></li>
                              <li>
                                 <p>Restart the map visualizer server to make the changes take effect.</p>
                              </li>
                           </ol>
                           <p>Using this example, the map image tiles for tile layer DEMP_MAP will be stored in the database table TILE_DBT.</p>
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-F0DB152D-5F21-41E5-9D58-AAA71B82753B">Storage of Map Image Tiles</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="JIMPV10072"></a><a id="JIMPV10071"></a><div class="props_rev_3"><a id="GUID-A4B8E43B-A59B-4D77-89C7-91A29602DE46" name="GUID-A4B8E43B-A59B-4D77-89C7-91A29602DE46"></a><h6 id="JIMPV-GUID-A4B8E43B-A59B-4D77-89C7-91A29602DE46" class="sect6"><span class="enumeration_section">3.2.1.2.3 </span>Stream the tiles directly without storing them 
                        </h6>
                        <div>
                           <p>If the tile contents may change constantly (such as a real-time cloud cover satellite image map) or if you do not want to store the image tiles, you can stream the tiles directly without storing them.</p>
                           <p>To choose this option, set the <code class="codeph">persistent_tiles</code> attribute to <code class="codeph">false</code> in the <code class="codeph">&lt;map_tile_layer&gt;</code> element in the tile layer's definition. (The default value for the <code class="codeph">persistent_tiles</code> attribute is <code class="codeph">true</code>.). <a href="map-visualization-servers.html#GUID-A4B8E43B-A59B-4D77-89C7-91A29602DE46__BACGIBEF">Example 3-1</a> inserts a tile layer named DEMO_MAP, with the <code class="codeph">persistent_tiles</code> attribute sets to <code class="codeph">false</code> so that no map image tiles will be cached for this tile layer.
                           </p>
                           <div class="example" id="GUID-A4B8E43B-A59B-4D77-89C7-91A29602DE46__BACGIBEF">
                              <p class="titleinexample">Example 3-1 Streaming Tiles Without Storing Them</p><pre class="oac_no_warn" dir="ltr">INSERT INTO user_sdo_cached_maps values(
'DEMO_MAP',
'an example tile layer that does not cache image tiles',
'',
'YES',
'YES',
'&lt;map_tile_layer name="DEMO_MAP_TREEMESH" image_format="PNG" http_header_expires="168.0" concurrent_fetching_threads="3" <span class="bold">persistent_tiles="false"</span>&gt;
   &lt;internal_map_source data_source="mvdemo" base_map="DEMO_MAP" bgcolor="#dddddd" out_of_bounds_color="#eeddff"/&gt;
   &lt;tile_storage root_path="/temp" short_path="false" /&gt;
   &lt;coordinate_system srid="8307" minX="-180.0" maxX="180.0" minY="-90.0" maxY="90.0"/&gt;
   &lt;tile_image width="256" height="256"/&gt;
   &lt;tile_dpi  value="90.7142857"/&gt;
   &lt;tile_meters_per_unit  value="111319.49079327358"/&gt;
   &lt;zoom_levels levels="19" min_scale="2132.729583849784" max_scale="559082264.0287178"/&gt;
&lt;/map_tile_layer&gt;',
'DEMO_MAP',
'');
COMMIT;</pre></div>
                           <!-- class="example" -->
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-F0DB152D-5F21-41E5-9D58-AAA71B82753B">Storage of Map Image Tiles</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div><a id="JIMPV9799"></a><a id="JIMPV9798"></a><div class="props_rev_3"><a id="GUID-BEC4AE53-AFCF-4872-8C7C-2F21F025ECB0" name="GUID-BEC4AE53-AFCF-4872-8C7C-2F21F025ECB0"></a><h5 id="JIMPV-GUID-BEC4AE53-AFCF-4872-8C7C-2F21F025ECB0" class="sect5"><span class="enumeration_section">3.2.1.3 </span>Coordinate System for Map Tiles
                     </h5>
                     <div>
                        <p>Map images are cached and managed by the map tile server as small same-size rectangular image tiles. Currently we support tiling on any two-dimensional Cartesian coordinate system. A geodetic coordinate system can also be supported when it is mapped as if it is a Cartesian coordinate system, where longitude and latitude are treated simply as two perpendicular axes, as shown in <a href="map-visualization-servers.html#GUID-BEC4AE53-AFCF-4872-8C7C-2F21F025ECB0__BABJJCDG">Figure 3-2</a>.
                        </p>
                        <div class="figure" id="GUID-BEC4AE53-AFCF-4872-8C7C-2F21F025ECB0__BABJJCDG">
                           <p class="titleinfigure">Figure 3-2 Tiling with a Longitude/Latitude Coordinate System</p><img src="img/coord_sys_omaps.gif" alt="Description of Figure 3-2 follows" title="Description of Figure 3-2 follows" longdesc="img_text/coord_sys_omaps.html"><br><a href="img_text/coord_sys_omaps.html">Description of "Figure 3-2 Tiling with a Longitude/Latitude Coordinate System"</a></div>
                        <!-- class="figure" -->
                        <p>On each zoom level, the map tiles are created by equally dividing the whole map coordinate system along the two dimensions (X and Y, which in<a href="map-visualization-servers.html#GUID-BEC4AE53-AFCF-4872-8C7C-2F21F025ECB0__BABJJCDG">Figure 3-2</a> represent latitude and longitude). The map tile server needs this dimensional information of the map coordinate system in order to create map image tiles, and therefore you must include this information in the map tile layer configuration settings.
                        </p>
                        <p>The whole map coordinate system can be represented by a rectangle, and its boundary is specified by (Xmin, Ymin) and (Xmax, Ymax), where Xmin is the minimum X value allowed in the coordinate system, Ymin is the minimum Y value allowed, Xmax is the maximum X value allowed and Ymax is the maximum Y value allowed. In <a href="map-visualization-servers.html#GUID-BEC4AE53-AFCF-4872-8C7C-2F21F025ECB0__BABJJCDG">Figure 3-2</a>, Xmin is &#x2013;180, Ymin is &#x2013;90, Xmax is 180, and Ymax is 90.
                        </p>
                        <p>You must also specify the spatial referencing ID (SRID) of the coordinate system to enable the map tile server to calculate map scales.</p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-A151DBDD-2F04-4AFC-B658-E943C2E1CA1E">Map Tile Server Concepts</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="JIMPV9801"></a><a id="JIMPV9800"></a><div class="props_rev_3"><a id="GUID-9C11BC3A-B721-4B0A-B576-5773363196DC" name="GUID-9C11BC3A-B721-4B0A-B576-5773363196DC"></a><h5 id="JIMPV-GUID-9C11BC3A-B721-4B0A-B576-5773363196DC" class="sect5"><span class="enumeration_section">3.2.1.4 </span>Tile Mesh Codes
                     </h5>
                     <div>
                        <p>Each map tile is specified by a mesh code, which is defined as a pair of integers (Mx, My), where Mx specifies the X dimension index of the tile and My specifies the Y dimension index of the tile. If the tile is the <span class="italic">i</span>th tile on X dimension starting from Xmin, then Mx should be i-1. If the tile is the <span class="italic">j</span>th tile on Y dimension starting from Ymin, then My should be j-1. <a href="map-visualization-servers.html#GUID-9C11BC3A-B721-4B0A-B576-5773363196DC__BABEHBJJ">Figure 3-3</a> shows the mesh codes of the tiles on a map.
                        </p>
                        <div class="figure" id="GUID-9C11BC3A-B721-4B0A-B576-5773363196DC__BABEHBJJ">
                           <p class="titleinfigure">Figure 3-3 Tile Mesh Codes</p><img src="img/mesh_codes.gif" alt="Description of Figure 3-3 follows" title="Description of Figure 3-3 follows" longdesc="img_text/mesh_codes.html"><br><a href="img_text/mesh_codes.html">Description of "Figure 3-3 Tile Mesh Codes"</a></div>
                        <!-- class="figure" -->
                        <p>The JavaScript map client automatically calculates which tiles it needs for displaying the map in the web browser, and it sends requests with the mesh codes to the server. Mesh codes are transparent to the application, and application developers do not need to deal with mesh codes directly.</p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-A151DBDD-2F04-4AFC-B658-E943C2E1CA1E">Map Tile Server Concepts</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="JIMPV10123"></a><div class="props_rev_3"><a id="GUID-F0B40C14-40EC-4973-B68D-2EFD4C825E86" name="GUID-F0B40C14-40EC-4973-B68D-2EFD4C825E86"></a><h5 id="JIMPV-GUID-F0B40C14-40EC-4973-B68D-2EFD4C825E86" class="sect5"><span class="enumeration_section">3.2.1.5 </span>Map Tile Requests
                     </h5>
                     <div>
                        <p>The map tile server handles map tile requests. A map tile request can be in key/value pair format or REST format:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Map tile request in key/value pair format</p>
                              <p>For example, if data source DS_NAME has a tile layer TL_NAME, then to get a map tile image in PNG format from zoom level 2 and mesh code (3.2), the URL may be formatted as:</p><pre class="oac_no_warn" dir="ltr">http://localhost:8080/mapviewer/mcserver?request=gettile&amp;format=PNG&amp;zoomlevel=2&amp;mapcache=DS_NAME.TL_NAME&amp;mx=3&amp;my=2
</pre></li>
                           <li>
                              <p>Map tile request in REST format</p>
                              <p>A general format of a request in REST format is:</p><pre class="oac_no_warn" dir="ltr">http://localhost:8080/mapviewer/mcserver/DS_NAME/TL_NAME/{zoom}/{row}/{column}.png
</pre><p>For example, to send the same map tile request shown in the preceding key/value pair example but in a REST format, the URL may be:</p><pre class="oac_no_warn" dir="ltr">http://localhost:8080/mapviewer/mcserver/DS_NAME/TL_NAME/2/1/3.png
</pre></li>
                        </ul>
                        <p>The mesh code in the key/value pair format has an origin of the lower-left corner, but the REST format requests a tile's row and column, and thus the origin is at the upper-left corner. Because the two formats have different origins, the <code class="codeph">my</code> value is different from the <code class="codeph">row</code> value, but the <code class="codeph">mx</code> value is the same as the <code class="codeph">column</code> value.
                        </p>
                        <p>Normally, map tile requests are encapsulated in the map visualizer JavaScript API libraries, so the API handles map tile requests. However, if you are using a third party's JavaScript API to communicate with the map visualizer server, you may need to specify the map tile request format in your application. For example, if you use the Leaflet JavaScript API to get map tiles from a map visualizer server, you may need to set the URL template for its <code class="codeph">L.tileLayer</code> as:
                        </p><pre class="oac_no_warn" dir="ltr">http://localhost:8080/mapviewer/mcserver/DS_NAME/TL_NAME/{z}/{y}/{x}.png.</pre></div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-A151DBDD-2F04-4AFC-B658-E943C2E1CA1E">Map Tile Server Concepts</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="JIMPV9802"></a><div class="props_rev_3"><a id="GUID-F2CD1712-676D-4986-9233-4ACC7E3809B9" name="GUID-F2CD1712-676D-4986-9233-4ACC7E3809B9"></a><h5 id="JIMPV-GUID-F2CD1712-676D-4986-9233-4ACC7E3809B9" class="sect5"><span class="enumeration_section">3.2.1.6 </span>Tiling Rules
                     </h5>
                     <div>
                        <p>You must create tiling rules that determine how the map is divided and how tiles are created. The map tile server uses these tiling rules to divide the map into small map image tiles that are stored in the tile storage system. These rules are also used by the JavaScript map client.</p>
                        <p>Because all tiles on a given zoom level are the same size, the map tile server needs to know the following information to perform the tile division:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>The map tile image size (width and height), specified in screen pixels. This is the physical size of the tile images.</p>
                           </li>
                           <li>
                              <p>The tile size specified according to the map coordinate system. For example, if the map uses a geodetic coordinate system, the tile width and height should be defined in degrees. The size can be specified either explicitly by tile width and height or implicitly by map scale. (Map scale, combined with tile image size, can be used to derive the tile width and height according to the map coordinate system.)</p>
                           </li>
                        </ul>
                        <p>The preceding information constitutes the tiling rule for a given zoom level. Each zoom level must have its own tiling rule. You must define the tiling rules when you specify the configuration settings for the map tile server, as described in <a href="map-visualization-servers.html#GUID-A144D404-681B-4BBE-A3FF-E9826A5DF605">Map Tile Server Configuration</a>.
                        </p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-A151DBDD-2F04-4AFC-B658-E943C2E1CA1E">Map Tile Server Concepts</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="JIMPV9994"></a><div class="props_rev_3"><a id="GUID-1D0E8411-88A0-4874-8EAD-BD558E752F08" name="GUID-1D0E8411-88A0-4874-8EAD-BD558E752F08"></a><h5 id="JIMPV-GUID-1D0E8411-88A0-4874-8EAD-BD558E752F08" class="sect5"><span class="enumeration_section">3.2.1.7 </span>Tile Background Color and Out-of-Bounds Color
                     </h5>
                     <div>
                        <p>Two attributes in a tile layer metadata definition which affect a tile's color: <code class="codeph">bgcolor</code> (background color) and <code class="codeph">out_of_bounds_color</code> (out-of-bounds color). The <code class="codeph">bgcolor</code> attribute value is used for filling areas within the valid data area of a tile layer (the valid data area is defined by <code class="codeph">minX, minY, maxY, maxY</code>), while the <code class="codeph">out_of_bounds_color</code> attribute value is used for filling areas that are outside the valid data area. Both attributes have the same default values (<code class="codeph">Color(192, 192, 192)</code>).
                        </p>
                        <p>If a tile-fetching process failed due to an exception on the attempt to generate a tile, then the tile filled with out-of-bounds color is used as its substitute, regardless of whether it is within the valid data area. However, such a substitute tile due to tile-fetching exception is not permanently stored on disk; rather, it is streamed to the client on a temporary basis. The map visualizer will retry the tile generation on subsequent requests, if the temporary tile data in the client browser's cache is purged or if a different client initiates the request.</p>
                        <p>If <code class="codeph">bgcolor</code> is set to <code class="codeph">none</code>, then the tile becomes transparent; that is, the background color of the HTML page replaces the attribute values for both <code class="codeph">bgcolor</code> and <code class="codeph">out_of_bounds_color</code>.
                        </p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-A151DBDD-2F04-4AFC-B658-E943C2E1CA1E">Map Tile Server Concepts</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="JIMPV9803"></a><div class="props_rev_3"><a id="GUID-A144D404-681B-4BBE-A3FF-E9826A5DF605" name="GUID-A144D404-681B-4BBE-A3FF-E9826A5DF605"></a><h4 id="JIMPV-GUID-A144D404-681B-4BBE-A3FF-E9826A5DF605" class="sect4"><span class="enumeration_section">3.2.2 </span>Map Tile Server Configuration
                  </h4>
                  <div>
                     <p>Map tile server configuration settings are stored in local configuration files and in database views. You can customize these settings.</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-247681EA-BA75-488E-9CAE-C2139AA37E40">Global Map Tile Server Configuration</a><br></li>
                        <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-5CF7DC08-0B32-4C72-B9D0-F3762A7E6171">Map Tile Layer Configuration</a><br></li>
                        <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-9956C928-09A1-43E8-AB72-410F9A9B94EB">Map Tile Storage Schemes: Internal Mesh Code or XYZ</a><br></li>
                        <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-25DD5A19-EC7F-4BB7-B1BA-E1CC2651EC04">Creating a Map Tile Layer Using an External Web Map Source</a><br></li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-7E88B130-FB2F-47D1-A8B2-909CFB1454AC" title="The map tile server is a map image caching engine that fetches, caches, and serves pregenerated, fixed-size map image tiles.">Map Tile Server</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="JIMPV9804"></a><div class="props_rev_3"><a id="GUID-247681EA-BA75-488E-9CAE-C2139AA37E40" name="GUID-247681EA-BA75-488E-9CAE-C2139AA37E40"></a><h5 id="JIMPV-GUID-247681EA-BA75-488E-9CAE-C2139AA37E40" class="sect5"><span class="enumeration_section">3.2.2.1 </span>Global Map Tile Server Configuration
                     </h5>
                     <div>
                        <p>Global map tile server settings, such as logging options and the default cache storage directory, are stored in the map visualizer configuration file <code class="codeph">mapViewerConfig.xml</code>, which is under the directory <span class="italic"><code class="codeph">$MAPVIEWER_HOME</code></span><code class="codeph">/web/WEB-INF/conf</code>. 
                        </p>
                        <p>The map tile server configuration settings are defined in element <code class="codeph">&lt;map_tile_server&gt;</code> inside the top-level <code class="codeph">&lt;mapperConfig&gt;</code> element, as shown in the following example:
                        </p><pre class="oac_no_warn" dir="ltr">&lt;map_tile_server&gt;
   &lt;tile_storage default_root_path="/scratch/tilecache/"/&gt;
&lt;/map_tile_server&gt;
</pre><p>The <code class="codeph">&lt;</code><code class="codeph">tile_storage&gt;</code> element specifies the map tiles storage settings. The <code class="codeph">default_root_path</code> attribute specifies the default file system directory under which the cached tile images are to be stored. If the default root directory is not set or not valid, the default root directory is <span class="italic"><code class="codeph">$MAPVIEWER_HOME</code></span><code class="codeph">/web/tilecache</code>. A subdirectory under this directory will be created and used for a map tile layer if the map tile layer configuration does not specify the map tiles storage directory for itself. The name of the subdirectory will be the same as the name of the map tile layer.
                        </p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-A144D404-681B-4BBE-A3FF-E9826A5DF605">Map Tile Server Configuration</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="JIMPV9807"></a><a id="JIMPV10124"></a><a id="JIMPV9808"></a><a id="JIMPV9805"></a><div class="props_rev_3"><a id="GUID-5CF7DC08-0B32-4C72-B9D0-F3762A7E6171" name="GUID-5CF7DC08-0B32-4C72-B9D0-F3762A7E6171"></a><h5 id="JIMPV-GUID-5CF7DC08-0B32-4C72-B9D0-F3762A7E6171" class="sect5"><span class="enumeration_section">3.2.2.2 </span>Map Tile Layer Configuration
                     </h5>
                     <div>
                        <p>The configuration settings for a map tile layer are stored in the USER_SDO_CACHED_MAPS metadata view, which is described in <a href="map-visualization-concepts.html#GUID-820FD52E-E02D-4371-B85B-88B76FAC50FF">xxx_SDO_CACHED_MAPS Views</a>. You should normally not manipulate this view directly, but should instead use the map visualizer administration tool, which uses this view to configure map tile layers.
                        </p>
                        <p>Each database user (schema) has its own USER_SDO_CACHED_MAPS view. Each entry in this view stores the configuration settings for one map tile layer. If the map tile layer is based on an internal map visualizer base map or themes, the base map or themes associated with the map tile layer must be defined in the same database schema where the map tile layer configuration settings are stored.</p>
                        <p>The map tile server obtains the map source configuration by querying the USER_SDO_CACHED_MAPS view using the database connections specified by the map visualizer data sources. This happens when the map tile server is started or a new data source is added to the map visualizer as the result of a map visualizer administration request.</p>
                        <p>For the DEFINITION column in the USER_SDO_CACHED_MAPS view, the map source definition has the following general format:</p><pre class="oac_no_warn" dir="ltr">  &lt;map_tile_layer 
     name = "map tile layer name"
     image_format ="tile-image-format"&gt;
    &lt;internal_map_source 
      data_source="name-of-data-source"
      base_map="name-of-MapViewer-base-map"
      bgcolor="base-map-background-color"
      antialias="whether-to-turn-on-antialiasing"
      /&gt;
    &lt;/internal_map_source&gt;
    &lt;external_map_source 
       url="external-map-service-url" 
       adapter_class="name-of-adapter-class"
       proxy_host=" proxy-server-host "
       proxy_port="proxy-server-port"
       timeout="request-timeout"
       request_method="http-request-method: 'GET'|'POST'"&gt;
      &lt;properties&gt;
        &lt;property name="property-name" value="property-value"/&gt;
        
      &lt;/properties&gt;
    &lt;/external_map_source&gt;
    &lt;tile_storage 
       root_path="disk-path-of-cache-root-directory"
    &lt;/tile_storage&gt;
    &lt;coordinate_system
       srid="coordinate-system-srid" 
       minX="minimum-allowed-X-value" 
       maxX="maximum-allowed-X-value"
       minY="minimum-allowed-Y-value" 
       maxY="maximum-allowed-Y-value"&gt;
    &lt;/coordinate_system&gt;
    &lt;tile_image
       width="tile-image-width-in-screen-pixels" 
       height="tile-image-height-in-screen-pixels" &gt;
    &lt;/tile_image&gt;
    &lt;tile_bound&gt;
       &lt;coordinates&gt;  &lt;/coordinates&gt;
    &lt;/tile_bound&gt;
    &lt;zoom_levels
       levels="number-of-zoom-levels"
       min_scale="map-scale-at-highest-zoom-level" 
       max_scale="map-scale-at-lowest-zoom-level"
       min_tile_width="tile-width-specified-in-map-data-units-at-
                       highest-zoom-level" 
       max_tile_width="tile-width-specified-in-map-data-units-at-
                       lowest-zoom-level"&gt;
      &lt;zoom_level 
         description="zoom-level-description"
         level_name="zoom-level-name"
         scale="map-scale-of-zoom-level"
         tile_width ="tile-width-specified-in-map-data-units"
         tile_height ="tile-height-specified-in-map-data-units"&gt;
        &lt;tile_bound&gt;
          &lt;coordinates&gt;  &lt;/coordinates&gt;
        &lt;/tile_bound&gt;
      &lt;/zoom_level&gt;
      
    &lt;/zoom_levels&gt;
  &lt;/map_tile_layer&gt;
</pre><p>The DTD of the map tile layer definition XML is listed in <a href="xml-formats-map-visualizer.html#GUID-8B972AAC-B614-459B-91E2-18ADA5EF234F" title="An Oracle Maps map tile layer which assembles and displays pregenerated map image tiles from the map tile server,">Map Tile Layers</a>.
                        </p>
                        <p><a href="map-visualization-servers.html#GUID-5CF7DC08-0B32-4C72-B9D0-F3762A7E6171__BABEHBBH">Example 3-2</a> shows the XML definition of an internal map tile layer that is based on a base map; <a href="map-visualization-servers.html#GUID-5CF7DC08-0B32-4C72-B9D0-F3762A7E6171__BACBHEBD">Example 3-3</a> shows the XML definition of an internal map tile layer that is based on themes (not on a base map); and <a href="map-visualization-servers.html#GUID-5CF7DC08-0B32-4C72-B9D0-F3762A7E6171__BABGDIBD">Example 3-4</a> shows the XML definition of an external map tile layer. Explanations of the <code class="codeph">&lt;map_tile_layer&gt;</code> element and its subelements follow these examples.
                        </p>
                        <div class="example" id="GUID-5CF7DC08-0B32-4C72-B9D0-F3762A7E6171__BABEHBBH">
                           <p class="titleinexample">Example 3-2 XML Definition of an Internal Map Tile Layer Based on a Base Map</p><pre class="oac_no_warn" dir="ltr">&lt;?xml version = '1.0'?&gt;
&lt;!-- XML definition of an internal map tile layer.
--&gt;
   &lt;map_tile_layer image_format="PNG"&gt;
      &lt;internal_map_source base_map="demo_map"/&gt;
      &lt;tile_storage root_path="/scratch/mapcache/"/&gt;
      &lt;coordinate_system 
         srid="8307"
         minX="-180" maxX="180" 
         minY="-90" maxY="90"/&gt;
      &lt;tile_image width="250" height="250"/&gt;
      &lt;zoom_levels&gt;
         &lt;zoom_level description="continent level" scale="10000000"/&gt;
         &lt;zoom_level description="country level" scale="3000000"/&gt;
         &lt;zoom_level description="state level" scale="1000000"/&gt;
         &lt;zoom_level description="county level" scale="300000"/&gt;
         &lt;zoom_level description="city level" scale="100000"/&gt;
         &lt;zoom_level description="street level" scale="30000"/&gt;
         &lt;zoom_level description="local street level" scale="10000"/&gt;
      &lt;/zoom_levels&gt;
   &lt;/map_tile_layer&gt;</pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-5CF7DC08-0B32-4C72-B9D0-F3762A7E6171__BACBHEBD">
                           <p class="titleinexample">Example 3-3 XML Definition of an Internal Map Tile Layer Based on Themes</p><pre class="oac_no_warn" dir="ltr">&lt;?xml version = '1.0' encoding = 'UTF-8'?&gt;
&lt;map_tile_layer name="TL1" image_format="PNG" http_header_expires="168.0" utfgrid="true" utfgrid_resolution="4" concurrent_fetching_threads="3"&gt;
     &lt;internal_map_source data_source="MVDEMO" bgcolor="none" out_of_bounds_color="#ffffff" base_map="" db_tile_table=""/&gt;
     &lt;tile_storage root_path="/temp" xyz_storage_scheme="true"/&gt;
     &lt;coordinate_system srid="3857" minX="-2.0037508E7" minY="-2.0037508E7" maxX="2.0037508E7" maxY="2.0037508E7"/&gt;
     &lt;tile_image width="256" height="256"/&gt;
     &lt;tile_dpi value="90.714"/&gt;
     &lt;tile_meters_per_unit value="1.0"/&gt;
     &lt;zoom_levels levels="19" min_scale="2132.72958384" max_scale="5.59082264028E8" min_tile_width="152.874538064" max_tile_width="4.00751429065E7"&gt;
          &lt;zoom_level level="0" name="level0" tile_width="4.00751429065E7" tile_height="4.00751429065E7"/&gt;
          &lt;zoom_level level="1" name="level1" tile_width="2.003757145325E7" tile_height="2.003757145325E7"/&gt;
          &lt;zoom_level level="2" name="level2" tile_width="1.0018785726625258E7" tile_height="1.001878572662E7"/&gt;
          &lt;zoom_level level="3" name="level3" tile_width="5009392.86331" tile_height="5009392.86331"/&gt;
          &lt;zoom_level level="4" name="level4" tile_width="2504696.431656" tile_height="2504696.431656"/&gt;
          &lt;zoom_level level="5" name="level5" tile_width="1252348.215828" tile_height="1252348.215828"/&gt;
          &lt;zoom_level level="6" name="level6" tile_width="626174.1079140786" tile_height="626174.107914"/&gt;
          &lt;zoom_level level="7" name="level7" tile_width="313087.0539570393" tile_height="313087.053957"/&gt;
          &lt;zoom_level level="8" name="level8" tile_width="156543.5269785" tile_height="156543.5269785"/&gt;
          &lt;zoom_level level="9" name="level9" tile_width="78271.763489" tile_height="78271.763489"/&gt;
          &lt;zoom_level level="10" name="level10" tile_width="39135.8817446" tile_height="39135.8817446"/&gt;
          &lt;zoom_level level="11" name="level11" tile_width="19567.9408723" tile_height="19567.9408723"/&gt;
          &lt;zoom_level level="12" name="level12" tile_width="9783.9704361" tile_height="9783.9704361"/&gt;
          &lt;zoom_level level="13" name="level13" tile_width="4891.9852180" tile_height="4891.9852180"/&gt;
          &lt;zoom_level level="14" name="level14" tile_width="2445.9926090" tile_height="2445.99260903"/&gt;
          &lt;zoom_level level="15" name="level15" tile_width="1222.99630451" tile_height="1222.99630451"/&gt;
          &lt;zoom_level level="16" name="level16" tile_width="611.49815225" tile_height="611.49815225"/&gt;
          &lt;zoom_level level="17" name="level17" tile_width="305.74907612" tile_height="305.74907612"/&gt;
          &lt;zoom_level level="18" name="level18" tile_width="152.87453806" tile_height="152.87453806"/&gt;
   &lt;/zoom_levels&gt;
     &lt;auto_update finest_level_to_refresh="13" dirty_mbr_batch="100" dirty_mbr_cap="1000"&gt;
          &lt;dirty_mbr_table name="TL1MBR"/&gt;
          &lt;logtable name="TL1LOG"/&gt;
   &lt;/auto_update&gt;
     &lt;themes&gt;
          &lt;theme name="UTFGRID_THEME_DEMO_STATES" from_level="0" to_level="18"/&gt;
          &lt;theme name="UTFGRID_THEME_DEMO_COUNTIES" from_level="0" to_level="18"/&gt;
          &lt;theme name="UTFGRID_THEME_DEMO_HIGHWAYS" from_level="0" to_level="18"/&gt;
          &lt;theme name="UTFGRID_THEME_DEMO_CITIES" from_level="0" to_level="18"/&gt;
   &lt;/themes&gt;
&lt;/map_tile_layer&gt;</pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-5CF7DC08-0B32-4C72-B9D0-F3762A7E6171__BABGDIBD">
                           <p class="titleinexample">Example 3-4 XML Definition of an External Map Tile Layer</p><pre class="oac_no_warn" dir="ltr">&lt;?xml version = '1.0'?&gt;
&lt;!-- XML definition of an external map tile layer.--&gt;
&lt;map_tile_layer name="TILELAYER1" image_format="PNG"&gt;
   &lt;external_map_source
     url="http://mycorp.com:7001/mapviewer/wms/"
     request_method="GET"
     adapter_class="oracle.lbs.mapcache.adapter.WMSAdapter"
     adapter_class_path=""&gt;
      &lt;properties&gt;
         &lt;property name="datasource" value="mvdemo"/&gt;
         &lt;property name="version" value="1.1.1"/&gt;
         &lt;property name="srs" value="EPSG:4326"/&gt;
         &lt;property name="layers" value="THEME_DEMO_COUNTIES,THEME_DEMO_HIGHWAYS"/&gt;
         &lt;property name="format" value="image/png"/&gt;
         &lt;property name="transparent" value="true"/&gt;
      &lt;/properties&gt;
   &lt;/external_map_source&gt;
   &lt;tile_storage root_path="/scratch/tmp/"/&gt;
   &lt;coordinate_system srid="8307" minX="-180.0" minY="-90.0" maxX="180.0" maxY="90.0"/&gt;
   &lt;tile_image width="256" height="256"/&gt;
   &lt;!
         The following &lt;zoom_levels&gt; element does not have any
         &lt;zoom_level&gt; element inside it. But since it has its levels,
         min_scale and max_scale attributes set, map tile server will
         automatically generate the &lt;zoom_level&gt; elements for the 10
         zoom levels.
   --&gt;
   &lt;zoom_levels levels="10" min_scale="1000.0" max_scale="2.5E8"&gt;
   &lt;/zoom_levels&gt;
&lt;/map_tile_layer&gt;
</pre><p>The top-level element is <code class="codeph">&lt;map_tile_layer&gt;</code>. The <code class="codeph">image_format</code> attribute specifies the tile image format; the currently supported values for this attribute are <code class="codeph">PNG</code>, <code class="codeph">GIF</code>, and <code class="codeph">JPG</code>. PNG and GIF images are generally better for vector base maps, while JPG images are generally better for raster maps, such as satellite imagery, because of a better compression ratio. Currently, only tile images in PNG format can have transparent background.
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The <code class="codeph">http_header_expires</code> attribute specifies the number of hours after which a cached tile layer can be considered stale.
                                 </p>
                              </li>
                              <li>
                                 <p>The <code class="codeph">utfgrid</code> attribute, when set to <code class="codeph">true</code>, indicates that a companion UTFGrid dataset for an image file will be generated. (The default value is <code class="codeph">false</code>.)
                                 </p>
                              </li>
                              <li>
                                 <p>The <code class="codeph">utfgrid_resolution</code> attribute specifies how fine the grid data is compared to the image tile. For example, a value of 4 (the default) indicates that one grid cell represents 4 by 4 pixels in its companion image tile.
                                 </p>
                              </li>
                              <li>
                                 <p>The <code class="codeph">concurrent_fetching_threads</code> attribute defines the maximum number of concurrent tile fetching threads that may be created for fetching image tiles for this tile layer. (The default value is 3.)
                                 </p>
                              </li>
                              <li>
                                 <p>The <code class="codeph">fetch_larger_tile</code> attribute , when <code class="codeph">true</code> (the default), tells the tile server that if the tile is not available in the cache, the tile's adjacent tiles will also be generated. This parameter does bot affect the <code class="codeph">getTile</code> performance when the requested tiles are already available in the cache. The default setting (<code class="codeph">true</code>) is intended to improve server response time.
                                 </p>
                              </li>
                              <li>
                                 <p>The <code class="codeph">persistent_tiles</code> attribute, when <code class="codeph">true</code> (the default), specifies that image tiles will be saved is the server's disk cache. If this attribute is set to false, then each getTile request invokes an image tile rendering process in the map visualizer server, and the newly acquired image tile is not cached for future use. Cases where you may want to specify <code class="codeph">false</code> include (A) a GeoRaster theme is used by a tile layer and you do not want duplicate raster images in the map visualizer's disk cache, or (B) you want the tile server always to provide up-to-date image tiles.
                                 </p>
                              </li>
                           </ul>
                           <p>The <code class="codeph">&lt;internal_map_source&gt;</code> element is required only if the map tiles are rendered by the local map visualizer instance.
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The <code class="codeph">base_map</code> attribute is required and specifies the predefined map visualizer base map that is cached by the map tile server; its value should match an entry in the BASE_MAP column in the USER_SDO_CACHED_MAPS view.
                                 </p>
                              </li>
                              <li>
                                 <p>The <code class="codeph">bgcolor</code> attribute is optional and specifies the background color of the map. If the value of this attribute is set to <code class="codeph">NONE</code>, the background will be transparent. (Currently, only tile images in PNG format can have a transparent background.)
                                 </p>
                              </li>
                              <li>
                                 <p>The <code class="codeph">out_of_bounds_color</code> attribute is optional and specifies the color for areas that are outside the data boundaries. The data boundaries are specified by the attributes of the <code class="codeph">&lt;coordinate_system&gt;</code> element.
                                 </p>
                              </li>
                              <li>
                                 <p>The <code class="codeph">db_tile_table</code> attribute is optional, specifies the database table in which to cache the tile layer's image tiles. If the attribute is not specified, the tiles are cached in the map visualizer's disk cache.
                                 </p>
                              </li>
                           </ul>
                           <p>The <code class="codeph">&lt;external_map_source&gt;</code> element is required only if the map tiles are rendered by an external map services provider. This element has the following attributes: 
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The <code class="codeph">url</code> attribute is required and specifies the map service URL from which the map tiles can be fetched (for example, <code class="codeph">http://myhost/mapviewer/omserver</code>).
                                 </p>
                              </li>
                              <li>
                                 <p>The <code class="codeph">adapter_class</code> attribute is required and specifies the full name of the map adapter class, including the package names (for example, <code class="codeph">mcsadapter.MVAdapter</code>).
                                 </p>
                              </li>
                              <li>
                                 <p>The <code class="codeph">proxy_host</code> and <code class="codeph">proxy_port</code> attributes are needed only if the external map provider server must be accessed through a proxy server; these attributes specify the host name and port number, respectively, of the proxy server. If <code class="codeph">proxy_host</code> is specified as <code class="codeph">NONE</code>, all map tile requests will be sent directly to the remote server without going through any proxy server. If <code class="codeph">proxy_host</code> is omitted or specifies an empty string, the global map visualizer proxy setting defined in the <code class="codeph">mapViewerConfig.xml file</code> will be used when map tile requests are sent.
                                 </p>
                              </li>
                              <li>
                                 <p>The <code class="codeph">timeout</code> attribute is optional and specifies the number of milliseconds for which the map tile server must wait for an external map tile image before giving up the attempt. The default timeout value is 15000.
                                 </p>
                              </li>
                              <li>
                                 <p>The <code class="codeph">request_method</code> attribute is optional and the HTTP request method for sending map tile requests; its value can be <code class="codeph">POST</code> (the default) or <code class="codeph">GET</code>.
                                 </p>
                              </li>
                           </ul>
                           <p>For more information about external map tile layers and an example, see <a href="map-visualization-servers.html#GUID-25DD5A19-EC7F-4BB7-B1BA-E1CC2651EC04">Creating a Map Tile Layer Using an External Web Map Source</a>.
                           </p>
                           <p>The &lt;properties&gt; element in the <code class="codeph">&lt;external_map_source&gt;</code> element can include multiple <code class="codeph">&lt;property&gt;</code> elements, each of which specifies a user-defined parameter for use by the map adapter when it fetches map tiles. The same map source adapter can use different set of parameters to fetch different map tile layers. For example, the sample map visualizer adapter <code class="codeph">mcsadapter.MVAdapter</code> shipped with the map visualizer accepts parameters defined as follows:
                           </p><pre class="oac_no_warn" dir="ltr">&lt;properties&gt;
   &lt;property name="data_source" value="elocation"/&gt;
   &lt;property name="base_map" value="us_base_map"/&gt;
&lt;/properties&gt;
</pre><p>However, by changing the <code class="codeph">value</code> attribute values, you can use this adapter to fetch a different base map from the same data source or a different data source.
                           </p>
                           <p>The <code class="codeph">&lt;tile_storage&gt;</code> element specifies storage settings for the map tile layer.
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The optional <code class="codeph">root_path</code> attribute specifies the file system directory to be used as the root directory of the tile storage. If this attribute is omitted or invalid, the default root directory defined in the <code class="codeph">mapViewerConfig.xml</code> file is used.
                                 </p>
                              </li>
                              <li>
                                 <p>The optional <code class="codeph">xyz_storage_scheme</code> element controls how the directory structure of map tiles in the disk cache is organized. The default value (<code class="codeph">false</code>) causes the map visualizer internal mesh code storage scheme to be used. The value <code class="codeph">true</code> causes the XYZ storage scheme to be used. For more information, see <a href="map-visualization-servers.html#GUID-9956C928-09A1-43E8-AB72-410F9A9B94EB">Map Tile Storage Schemes: Internal Mesh Code or XYZ</a></p>
                              </li>
                           </ul>
                           <p>The <code class="codeph">&lt;coordinate_system&gt;</code> element specifies the map coordinate system, and it has several required attributes. The <code class="codeph">srid</code> attribute specifies the spatial reference ID of the coordinate system. The <code class="codeph">minX</code> attribute specifies the lower bound of the X dimension; the <code class="codeph">minY</code> attribute specifies the lower bound of the Y dimension; the <code class="codeph">maxX</code> attribute specifies the upper bound of the X dimension; and the <code class="codeph">maxY</code> attribute specifies the upper bound of the Y dimension. For the standard longitude/latitude (WGS 84) coordinate system, the <code class="codeph">srid</code> value is 8307; and the <code class="codeph">minX</code>, <code class="codeph">minY</code>, <code class="codeph">maxX</code>, and <code class="codeph">maxY</code> values are -180, -90, 180, and 90, respectively. 
                           </p>
                           <p>For an internal map tile layer, the map coordinate system can be different from the data coordinate system. If the two are different, the map tile server transforms the map data into the coordinate system defined in the <code class="codeph">&lt;coordinate_system&gt;</code> element and renders map tile images using this coordinate system.
                           </p>
                           <p>The <code class="codeph">&lt;tile_image&gt;</code> element specifies the tile image size settings, and it has the following required attributes: <code class="codeph">width</code> specifies the width of the tile images in screen pixels, and <code class="codeph">height</code> specifies the height of the tile images in screen pixels.
                           </p>
                           <p>The optional <code class="codeph">&lt;tile_bound&gt;</code> element specifies the bounding box of the cached map tiles. The map tile server only fetches tiles inside this box, and returns a blank tile if the requested tile is outside this box. The bounding box is specified by a rectangle in the map data coordinate system. The rectangle is specified by a <code class="codeph">&lt;coordinates&gt;</code> element in the following format:
                           </p><pre class="oac_no_warn" dir="ltr">&lt;coordinates&gt;minX, minY, maxX, maxY&lt;/coordinates&gt;
</pre><p>The default cache bounding box is the same bounding box specified in the <code class="codeph">&lt;coordinate_system&gt;</code> element.
                           </p>
                           <p>The optional <code class="codeph">&lt;tile_dpi&gt;</code> element specifies the map display screen resolution as a "dots per inch" value. If this element is not specified, the value specified in the <code class="codeph">mapViewerConfig.xml</code> file will be assigned to the tile layer. If the map visualizer must comply with OGC standards in exposing the tile layer in its WMTS service, then you must specify this element with the following value: <code class="codeph">90.714</code></p>
                           <p>The optional <code class="codeph">&lt;tile_meters_per_unit&gt;</code> element specifies the meters per unit. The unit is defined indirectly by the <code class="codeph">srid</code> attribute in the <code class="codeph">&lt;coordinate_system&gt;</code> element. For example, if the <code class="codeph">srid</code> is 3857, its unit is meters, and thus the value for this attribute must be 1.0; or if the <code class="codeph">srid</code> is 8307, its unit is decimal degrees, and thus the value may be set to 111319.49. If this element is not specified, a map visualizer internal process calculates the value according to the data bounds, and the result is very close to 111319.49. If this tile layer is to be exposed by the map visualizer to provide WMTS services, and if <code class="codeph">srid</code> is 8307, then you must set this element's value to 111319.49 to comply with OGC standards.
                           </p>
                           <p>The <code class="codeph">&lt;zoom_levels&gt;</code> element specifies the predefined zoom levels. Only image tiles at predefined zoom levels will be cached and served by the map tile server. The <code class="codeph">&lt;zoom_levels&gt;</code> element can have multiple <code class="codeph">&lt;zoom_level&gt;</code> elements, each of which specifies one predefined zoom level. If there are no <code class="codeph">&lt;zoom_level&gt;</code> elements, the map tile server automatically generates the <code class="codeph">&lt;zoom_level&gt;</code> elements by using the following attributes inside the <code class="codeph">&lt;zoom_levels&gt;</code> element. (These attributes can be omitted and will be ignored if any <code class="codeph">&lt;zoom_level&gt;</code> elements exist.)
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">levels</code> specifies the total number of zoom levels.
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">min_scale</code> specifies the scale of map images at the highest (zoomed in the most) zoom level.
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">max_scale</code> specifies the scale of map images at the lowest (zoomed out the most) zoom level.
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">min_tile_width</code> specifies the width of map tiles at the highest zoom level. The width is specified in map data units.
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">max_tile_width</code> specifies the width of the map tiles at the lowest zoom level. The width is specified in map data units.
                                 </p>
                              </li>
                           </ul>
                           <p>For the map tile server to be able to generate the definitions of individual zoom levels automatically, you must specify either of the following combinations of the preceding attributes:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">levels</code>, <code class="codeph">min_scale</code>, and <code class="codeph">max_scale</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">levels</code>, <code class="codeph">min_tile_width</code>, and <code class="codeph">max_tile_width</code></p>
                              </li>
                           </ul>
                           <p>When the zoom levels are defined this way, the map tile server automatically derives the definition of all the individual zoom levels and updates the XML definition with the <code class="codeph">&lt;zoom_level&gt;</code> elements generated for the zoom levels. You can then make adjustments to each zoom level if you want.
                           </p>
                           <p>Each zoom level is assigned a zoom level number by the map tile server based on the order in which the zoom levels are defined. The first zoom level defined in the <code class="codeph">&lt;zoom_levels&gt;</code> element is zoom level 0, the second zoom level is zoom level 1, and so on. These zoom level numbers are used in the tile requests to refer to the predefined zoom levels.
                           </p>
                           <p>The <code class="codeph">&lt;zoom_level&gt;</code> element specifies a predefined zoom level, and it has several attributes. The <code class="codeph">description</code> attribute is optional and specifies the text description of the zoom level. The <code class="codeph">level_name</code> attribute is optional and specifies the name of the zoom level. The <code class="codeph">scale</code> attribute specifies the map scale of the zoom level; it is required if the attributes <code class="codeph">tile_width</code> and <code class="codeph">tile_height</code> are not defined. The <code class="codeph">tile_width</code> and <code class="codeph">tile_height</code> attributes specify the tile width and height, respectively, in map data units. The <code class="codeph">fetch_larger_tiles</code> attribute is optional and specifies whether to fetch larger map images instead of the small map image tiles; a value of <code class="codeph">TRUE</code> (the default) means that larger map images that may consist multiple map tiles will be fetched and broken into small map image tiles, which might save network round trips between the map tile server and the map services provider.
                           </p>
                           <p>In the <code class="codeph">&lt;zoom_level&gt;</code> element, you must specify either the <code class="codeph">scale</code> attribute or both the <code class="codeph">tile_width</code> and <code class="codeph">tile_height</code> elements.
                           </p>
                           <p>The <code class="codeph">&lt;tile_bound&gt;</code> element within the <code class="codeph">&lt;zoom_level&gt;</code> element optionally specifies the bounding box of the cached map tiles for the zoom level. The map tile server only fetches tiles inside this box, and returns a blank tile if the requested tile is outside this box. The bounding box is specified by a rectangle specified in map data coordinate system. The rectangle is specified by a <code class="codeph">&lt;coordinates&gt;</code> element (explained earlier in this topic) If you specify the <code class="codeph">&lt;tile_bound&gt;</code> element within the <code class="codeph">&lt;zoom_level&gt;</code> element, it overrides the overall cache bounding box settings specified by the <code class="codeph">&lt;tile_bound&gt;</code> element that is above it in the XML hierarchy.
                           </p>
                           <p>The <code class="codeph">&lt;auto_update&gt;</code> element defines how the tile layer's disk cache is to be automatically updated when spatial data in the base table is modified, For details, see <a href="map-visualization-servers.html#GUID-5D18BF91-F92B-46BE-B3EE-79CCECA6DF09">Add the &lt;auto_update&gt; element to tile layer definition</a>.
                           </p>
                           <p>The <code class="codeph">&lt;themes&gt;</code> element defines a layer based on themes (as opposed to a layer based on a base map). The themes to be used to render image tiles are listed in its subelements. In each subelement <code class="codeph">&lt;theme&gt;</code>, the <code class="codeph">name</code> attribute is required to specify a predefined theme in the metadata. The other two optional attributes, <code class="codeph">from_level</code> and <code class="codeph">to_level</code>, define the visibility of the that theme. The default values for those two attributes are <code class="codeph">from_level</code> of 0 (which contains the least map detail) and <code class="codeph">to_level</code> of the last level (which contains the most map detail).
                           </p>
                        </div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-A144D404-681B-4BBE-A3FF-E9826A5DF605">Map Tile Server Configuration</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="JIMPV10126"></a><a id="JIMPV10125"></a><div class="props_rev_3"><a id="GUID-9956C928-09A1-43E8-AB72-410F9A9B94EB" name="GUID-9956C928-09A1-43E8-AB72-410F9A9B94EB"></a><h5 id="JIMPV-GUID-9956C928-09A1-43E8-AB72-410F9A9B94EB" class="sect5"><span class="enumeration_section">3.2.2.3 </span>Map Tile Storage Schemes: Internal Mesh Code or XYZ
                     </h5>
                     <div>
                        <p>The <code class="codeph">xyz_storage_scheme</code> attribute of the <code class="codeph">&lt;file_storage&gt;</code> element (described in <a href="map-visualization-servers.html#GUID-5CF7DC08-0B32-4C72-B9D0-F3762A7E6171">Map Tile Layer Configuration</a>) controls how the directory structure of map tiles in the disk cache is organized. The default scheme uses the map visualizer's internal mesh codes, but you can instead choose the XYZ storage scheme.
                        </p>
                        <p>Figure <a href="map-visualization-servers.html#GUID-9956C928-09A1-43E8-AB72-410F9A9B94EB__BACBCJAG">Figure 3-4</a> shows both storage schemes.
                        </p>
                        <div class="figure" id="GUID-9956C928-09A1-43E8-AB72-410F9A9B94EB__BACBCJAG">
                           <p class="titleinfigure">Figure 3-4 Internal Mesh Code and XYZ Map Tile Storage Schemes</p><img src="img/tile_storage_schemes.jpg" alt="Description of Figure 3-4 follows" title="Description of Figure 3-4 follows" longdesc="img_text/tile_storage_schemes.html"><br><a href="img_text/tile_storage_schemes.html">Description of "Figure 3-4 Internal Mesh Code and XYZ Map Tile Storage Schemes"</a></div>
                        <!-- class="figure" -->
                        <p>The details of the map visualizer internal mesh code are nor important for users. You need only know that there are two different storage scheme options, and that the XYZ storage scheme is analogous to the scheme used by several map data providers. Therefore, if you want to export tiles from some zoom levels for an offline project (local tile layer), if you find the XYZ storage scheme more intuitive, you can specify it.</p>
                        <p>In the map visualizer XYZ storage scheme, the naming of subdirectories is in the form <code class="codeph">/z/y/x</code>, where <code class="codeph">z</code> is the zoom level, <code class="codeph">y</code> is the tile's row number, and <code class="codeph">x</code> in the tile's column number. For example, in <a href="map-visualization-servers.html#GUID-9956C928-09A1-43E8-AB72-410F9A9B94EB__BACBCJAG">Figure 3-4</a>, the map visualizer XYX storage scheme shows the images (<code class="codeph">74.png</code>, <code class="codeph">75.png</code>, <code class="codeph">76,png</code>, <code class="codeph">77.png</code>) in the tile columns for tile row 33 for zoom level 8.
                        </p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-A144D404-681B-4BBE-A3FF-E9826A5DF605">Map Tile Server Configuration</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="JIMPV10073"></a><div class="props_rev_3"><a id="GUID-25DD5A19-EC7F-4BB7-B1BA-E1CC2651EC04" name="GUID-25DD5A19-EC7F-4BB7-B1BA-E1CC2651EC04"></a><h5 id="JIMPV-GUID-25DD5A19-EC7F-4BB7-B1BA-E1CC2651EC04" class="sect5"><span class="enumeration_section">3.2.2.4 </span>Creating a Map Tile Layer Using an External Web Map Source
                     </h5>
                     <div>
                        <div class="section">
                           <p>You can use an external web map source to create a map tile layer, as follows:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Log in to the map visualizer administrative console.</span></li>
                           <li class="stepexpand"><span>Click <span class="bold">Create Tile Layer</span>.</span></li>
                           <li class="stepexpand"><span>Select <span class="bold">External</span> as this tile layer's map image source, and click <span class="bold">Continue</span>.</span></li>
                           <li class="stepexpand"><span>On the Create a map tile layer for external map source page, enter the appropriate information:</span><div>
                                 <p><span class="bold">Name</span>: Tile layer name. Example: <code class="codeph">TILELAYER1</code></p>
                                 <p><span class="bold">Data Source</span>: Name of the data source for the tile layer. Example MVDEMO
                                 </p>
                                 <p><span class="bold">Max browser tile cache age (hours)</span>: Maximum number of hours in the cache before a tile is refreshed. Example: 168
                                 </p>
                                 <p><span class="bold">Map Service URL</span>: Example: <code class="codeph">http://mycorp.com:7001/mapviewer/wms</code></p>
                                 <p><span class="bold">Request Method</span>: <code class="codeph">HTTP GET</code></p>
                                 <p><span class="bold">Adapter class</span>: <code class="codeph">oracle.lbs.mapcache.adapter.WMSAdapter</code></p>
                                 <p><span class="bold">Jar file location</span>: Example: <code class="codeph">adapterlibs/</code></p>
                                 <p><span class="bold">Background</span>: <code class="codeph">transparent</code></p>
                                 <p><span class="bold">Adapter properties</span>: (Check it and click <span class="bold">Add</span> multiple times as appropriate, entering the values for the following each time.)
                                 </p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p><span class="bold">datasource</span>: Example: <code class="codeph">mvdemo</code></p>
                                    </li>
                                    <li>
                                       <p><span class="bold">version</span>: <code class="codeph">1.1.1</code></p>
                                    </li>
                                    <li>
                                       <p><span class="bold">srs</span>: <code class="codeph">EPSG:4326</code></p>
                                    </li>
                                    <li>
                                       <p><span class="bold">layers</span>: Example: <code class="codeph">THEME_DEMO_COUNTIES,THEME_DEMO_HIGHWAYS</code></p>
                                    </li>
                                    <li>
                                       <p><span class="bold">format</span>: <code class="codeph">image/png</code></p>
                                    </li>
                                    <li>
                                       <p><span class="bold">transparent</span>: <code class="codeph">true</code></p>
                                    </li>
                                 </ul>
                                 <p><span class="bold">Tile storage</span>: Example: <code class="codeph">C:\temp</code></p>
                                 <p><span class="bold">SRID</span>: <code class="codeph">8307</code></p>
                                 <p><span class="bold">Min X</span>: -<code class="codeph">180.0</code></p>
                                 <p><span class="bold">Max X</span>: <code class="codeph">180.0</code></p>
                                 <p><span class="bold">Min Y</span>: <code class="codeph">-90.0</code></p>
                                 <p><span class="bold">Max Y</span>: <code class="codeph">90.0</code></p>
                                 <p><span class="bold">Tile width (pixels)</span>: <code class="codeph">256</code></p>
                                 <p><span class="bold">Tile height (pixels)</span>: <code class="codeph">256</code></p>
                                 <p><span class="bold">File format</span>: <code class="codeph">PNG</code></p>
                                 <p><span class="bold"># Zoom Levels</span>: <code class="codeph">10</code></p>
                                 <p><span class="bold">Minimum map scale</span>: <code class="codeph">1000</code></p>
                                 <p><span class="bold">Maximum map scale</span>: <code class="codeph">250000000</code></p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Click <span class="bold">Submit</span> to create the tile layer.</span><div>
                                 <p>The message <span class="italic">Information: </span><span class="italic">New map tile layer created successfully</span> is displayed.
                                 </p>
                              </div>
                           </li>
                        </ol>
                        <div class="section">
                           <p>To verify the created layer, you can click <span class="bold">Manage Tile Layers</span> on the left, select the tile layer, and click <span class="bold">View map / Manage tiles</span> to preview the map.
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-A144D404-681B-4BBE-A3FF-E9826A5DF605">Map Tile Server Configuration</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="JIMPV9995"></a><div class="props_rev_3"><a id="GUID-A2E5CC6C-EC68-4C67-A1D1-09B8123BF3C3" name="GUID-A2E5CC6C-EC68-4C67-A1D1-09B8123BF3C3"></a><h4 id="JIMPV-GUID-A2E5CC6C-EC68-4C67-A1D1-09B8123BF3C3" class="sect4"><span class="enumeration_section">3.2.3 </span>Map Cache Auto-Update
                  </h4>
                  <div>
                     <p>The map cache auto-update feature periodically updates cached map tiles when they become "dirty". A cached map tile becomes <span class="bold">dirty</span> when data in base tables is changed by an update, insert, or delete operation, because such changes may affect the shape, annotation, or choice of rendering style for the already cached map tiles.Updating a dirty tile invokes one of the following operations: a) Refresh: delete the cached dirty tiles and then re-fetch them; or b) Clear: only delete the cached dirty tiles. To enable automatic updating for a tile layer, you perform the following major steps:
                     </p>
                     <ol>
                        <li>
                           <p><a href="map-visualization-servers.html#GUID-8761BE2F-D8AA-4B18-B403-0D707021FB2F">Add the &lt;dirty_tile_auto_update&gt; element to the mapViewerConfig.xml configuration file</a>.
                           </p>
                        </li>
                        <li>
                           <p><a href="map-visualization-servers.html#GUID-5D18BF91-F92B-46BE-B3EE-79CCECA6DF09">Add the &lt;auto_update&gt; element to tile layer definition</a>.
                           </p>
                        </li>
                        <li>
                           <p><a href="map-visualization-servers.html#GUID-58F058AE-426D-4951-AE2D-484708A92EA4">Create the dirty MBR table, base tables' log table, and triggers</a>.
                           </p>
                        </li>
                     </ol>
                     <p>To test the automatic tile updating, follow the instructions in <a href="map-visualization-servers.html#GUID-4BC91BF6-09DC-4B02-8754-61237959CCAE">Start the map visualizer server and test the map cache auto-update feature</a>.
                     </p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-8761BE2F-D8AA-4B18-B403-0D707021FB2F">Add the &lt;dirty_tile_auto_update&gt; element to the mapViewerConfig.xml configuration file</a><br></li>
                        <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-5D18BF91-F92B-46BE-B3EE-79CCECA6DF09">Add the &lt;auto_update&gt; element to tile layer definition</a><br></li>
                        <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-58F058AE-426D-4951-AE2D-484708A92EA4">Create the dirty MBR table, base tables' log table, and triggers</a><br></li>
                        <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-4BC91BF6-09DC-4B02-8754-61237959CCAE">Start the map visualizer server and test the map cache auto-update feature</a><br></li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-7E88B130-FB2F-47D1-A8B2-909CFB1454AC" title="The map tile server is a map image caching engine that fetches, caches, and serves pregenerated, fixed-size map image tiles.">Map Tile Server</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="JIMPV9996"></a><div class="props_rev_3"><a id="GUID-8761BE2F-D8AA-4B18-B403-0D707021FB2F" name="GUID-8761BE2F-D8AA-4B18-B403-0D707021FB2F"></a><h5 id="JIMPV-GUID-8761BE2F-D8AA-4B18-B403-0D707021FB2F" class="sect5"><span class="enumeration_section">3.2.3.1 </span>Add the &lt;dirty_tile_auto_update&gt; element to the mapViewerConfig.xml configuration file
                     </h5>
                     <div>
                        <p>Add the <code class="codeph">&lt;dirty_tile_auto_update&gt;</code> element as a child element of the <code class="codeph">&lt;map_tile_server&gt;</code> element. For example:
                        </p><pre class="oac_no_warn" dir="ltr">&lt;map_tile_server&gt;
   &lt;tile_storage default_root_path="/scratch/tilecache/"/&gt;
   <span class="bold">&lt;dirty_tile_auto_update</span>
     <span class="bold">auto_update="true"</span>
     <span class="bold">auto_update_interval="1"</span>
     <span class="bold">recycle_interval="168"/&gt;</span>
&lt;/map_tile_server&gt;
</pre><p>The <code class="codeph">auto_update</code> attribute enables server's automatic update when set to <code class="codeph">true</code> (the default is <code class="codeph">false</code>). If this attribute is set to <code class="codeph">true</code>, all qualified tile layers on the server will be automatically updated. To qualify, a tile layer must have a proper definition (see <a href="map-visualization-servers.html#GUID-5D18BF91-F92B-46BE-B3EE-79CCECA6DF09">Add the &lt;auto_update&gt; element to tile layer definition</a>).
                        </p>
                        <p>The <code class="codeph">auto_update_interval</code> attribute sets the recurring interval for checking the base tables' log table and the dirty MBR table. Its value is in minutes, and the default value is 1. The value should not be more than a few minutes, and it should not be very large (even if you update the base tables far less frequently, such as daily or weekly). The base tables' log table and the dirty MBR table should be created before starting the map visualizer server. Sample scripts for creating these two tables and related sequences and triggers are included in <a href="map-visualization-servers.html#GUID-58F058AE-426D-4951-AE2D-484708A92EA4">Create the dirty MBR table, base tables' log table, and triggers</a>.
                        </p>
                        <p>The <code class="codeph">recycle_interval</code> attribute specifies how long to keep a processed row in the log table and dirty MBR table. Its value is in hours, and the default value is 168. Processed rows older than that will be deleted.
                        </p>
                        <p>When the map visualizer starts, it loads the <code class="codeph">&lt;dirty_tile_auto_update&gt;</code> element from <code class="codeph">mapViewerConfig.xml</code> configuration file, and the element is applied to all tile layers of this server. If that element is not found, then the server disables any tile layer's auto-update capability.
                        </p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-A2E5CC6C-EC68-4C67-A1D1-09B8123BF3C3">Map Cache Auto-Update</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="JIMPV9997"></a><div class="props_rev_3"><a id="GUID-5D18BF91-F92B-46BE-B3EE-79CCECA6DF09" name="GUID-5D18BF91-F92B-46BE-B3EE-79CCECA6DF09"></a><h5 id="JIMPV-GUID-5D18BF91-F92B-46BE-B3EE-79CCECA6DF09" class="sect5"><span class="enumeration_section">3.2.3.2 </span>Add the &lt;auto_update&gt; element to tile layer definition
                     </h5>
                     <div>
                        <p>Add an <code class="codeph">&lt;auto_update&gt;</code> element after the <code class="codeph">&lt;zoom_levels&gt;</code> element in a tile layer definition. You can add this element manually or using the map visualizer web console. For example:
                        </p><pre class="oac_no_warn" dir="ltr"> &lt;auto_update
      finest_level_to_refresh="15"
      dirty_mbr_batch="100"
      dirty_mbr_cap="1000"&gt;
      &lt;dirty_mbr_table name="mbr_mcau"/&gt;
      &lt;logtable name="log_mcau_tl"/&gt;
   &lt;/auto_update&gt;
</pre><p>The <code class="codeph">finest_level_to_refresh</code> attribute specifies the finest level to refresh. Levels starting from level 0, level 1, level 2, , until this specified level will be refreshed, and dirty tiles in the remaining zoom levels will be cleared. If the data modifications in the base tables are often geographically small features (as most data modifications should be), such as changing the name of a restaurant or inserting a newly developed street, the value can be the finest zoom level found in the tile layer definition. For example, if there are 19 zoom levels from 0 to 18, then this attribute can be set to 18.
                        </p>
                        <p>The <code class="codeph">dirty_mbr_batch</code> attribute specifies the maximum number of rows from the dirty MBR table for an update. The default value is 100. This value prevents the server from getting a very large number of tiles to update at one time. Instead, if a large number of dirty tiles need a refresh or clear operation, these tiles will be processed in many updates, and one interval processes just one batch. To determine an optimal value for this attribute, consider the following factors:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>The  <code class="codeph">auto_update_interval</code> value (see <a href="map-visualization-servers.html#GUID-8761BE2F-D8AA-4B18-B403-0D707021FB2F">Add the &lt;dirty_tile_auto_update&gt; element to the mapViewerConfig.xml configuration file</a>)and how many tiles the server is able finish in the interval
                              </p>
                           </li>
                           <li>
                              <p>The amount of memory that the server can use</p>
                           </li>
                           <li>
                              <p>The number of tile layers that are enabled for map cache auto update and the frequency and magnitude of the changes in their base tables</p>
                           </li>
                        </ul>
                        <p>Because there is no formula for a precise calculation of an optimal <code class="codeph">dirty_mbr_batch</code> value, the best practice is to set up an environment to test different settings. When selecting a value, consider the worst case scenario. Two extreme scenarios to avoid are: a) the value is so small that the server is idling after finishing a refresh operation while the number of dirty MBR rows in the dirty MBR table keeps growing; or b) the value is so large that the server runs out of memory, throws an out-of-memory exception, and shuts down all services.
                        </p>
                        <p>The <code class="codeph">dirty_mbr_cap</code> attribute specifies the maximum number of dirty tiles for a log table to generate in one interval. This constraint may affect the finest zoom level for refresh operation, and the remaining zoom levels are then set for a clear operation. The accumulation counter for dirty tiles starts from zoom level 0, to level 1, level 2, and so on, until the cap is reached or the finest level to refresh is reached. 
                        </p>
                        <p>When a cap is reached at level <span class="italic">n</span> before reaching the specified finest level to refresh, the already counted tiles in level 0, level 1, level 2, , and level <span class="italic">n</span>-1 are for a refresh operation (delete and then re-fetch), and the current zoom level (level <span class="italic">n</span> in this example) and all other finer levels are for a clear operation (delete from the map tile cache and no re-fetch). For example, if the cap is given a value of 1000, the dirty tile counter reaches the cap at zoom level 4, then all the counted dirty tiles from level 0 to level 3 are for refresh. After that, each dirty tile in level 3 will be used to define a rectangle (the rectangular area the tile covers on the ground), and this rectangle is taken as an MBR to clear all zoom levels starting from level 4, level 5, and all other finer levels in this tile layer.
                        </p>
                        <p>The <code class="codeph">&lt;dirty_mbr_table&gt;</code> element specifies the name of the dirty MBR table, where the dirty MBRs are to be stored, retrieved, and updated. You need to manually create this table before starting the map visualizer server (see the example in <a href="map-visualization-servers.html#GUID-58F058AE-426D-4951-AE2D-484708A92EA4">Create the dirty MBR table, base tables' log table, and triggers</a>).
                        </p>
                        <p>The <code class="codeph">&lt;logtable&gt;</code> element specifies the name of the base table's log table. If a tile layer depends on more than one base table (as is often the case), then every change in each base table should be inserted into this log table by its trigger; if the schema is accessed by more than one data source defined in <code class="codeph">mapViewerConfig.xml</code>, then one change in a base table should insert one row for each data source.
                        </p>
                        <p>It is recommended that each tile layer have its own log table and its own dirty MBR table. Both tables should be manually created before starting the server (see the example in <a href="map-visualization-servers.html#GUID-58F058AE-426D-4951-AE2D-484708A92EA4">Create the dirty MBR table, base tables' log table, and triggers</a>). 
                        </p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-A2E5CC6C-EC68-4C67-A1D1-09B8123BF3C3">Map Cache Auto-Update</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="JIMPV9998"></a><div class="props_rev_3"><a id="GUID-58F058AE-426D-4951-AE2D-484708A92EA4" name="GUID-58F058AE-426D-4951-AE2D-484708A92EA4"></a><h5 id="JIMPV-GUID-58F058AE-426D-4951-AE2D-484708A92EA4" class="sect5"><span class="enumeration_section">3.2.3.3 </span>Create the dirty MBR table, base tables' log table, and triggers
                     </h5>
                     <div>
                        <p>This section contains examples that, when taken together, show the actions to create the dirty MBR table, base tables' log table, and triggers. The example segments assume that a base map named DEMO_MAP is already defined and that there is one data source named MVDEMO accessing the schema.</p>
                        <p>The example code segments include explanatory comments, and they perform the following actions:</p>
                        <ol>
                           <li>
                              <p>Create a tile layer that includes an <code class="codeph">&lt;auto_update&gt;</code> element.
                              </p><pre class="oac_no_warn" dir="ltr">insert into user_sdo_cached_maps values(
'MCAU_TL',
'a test case for map cache auto update',
'',
'YES',
'YES',
'&lt;map_tile_layer name="MCAU_TL" image_format="PNG" http_header_expires="168.0" concurrent_fetching_threads="3" fetch_larger_tiles="false"&gt;
   &lt;internal_map_source data_source="mvdemo" base_map="DEMO_MAP"/&gt;
   &lt;coordinate_system srid="8307" minX="-180.0" maxX="180.0" minY="-90.0" maxY="90.0"/&gt;
   &lt;tile_image width="256" height="256"/&gt;
   &lt;tile_dpi value="90.7142857"/&gt;
   &lt;tile_meters_per_unit value="111319.49079327358"/&gt;
   &lt;zoom_levels levels="19" min_scale="2132.729583849784" max_scale="559082264.0287178"&gt;
   &lt;/zoom_levels&gt;
  <span class="bold"> &lt;auto_update</span>
      <span class="bold">finest_level_to_refresh="15"</span>
      <span class="bold">dirty_mbr_batch="100"</span>
      <span class="bold">dirty_mbr_cap="1000"&gt;</span>
      <span class="bold">&lt;dirty_mbr_table name="mbr_MCAU_TL"/&gt;</span>
      <span class="bold">&lt;logtable name="log_MCAU_TL"/&gt;</span>
   <span class="bold">&lt;/auto_update&gt;</span>
&lt;/map_tile_layer&gt;',
'DEMO_MAP',
'');
commit;
</pre></li>
                           <li>
                              <p>Create a dirty MBR table and its trigger.</p>
                              <p>The dirty MBR table stores the dirty MBRs for refresh and clear operations. This table is populated using the geometries from the log table. There is also a sequence and a trigger created for generating unique IDs for this table's ID column.</p><pre class="oac_no_warn" dir="ltr">-- create the dirty MBR table
CREATE TABLE mbr_MCAU_TL (     -- dirty MBR table name
  id             number,       -- id, used for tracking the status
  datasource     varchar2(32), -- data source name
  tile_layer     varchar2(32), -- tile layer name
  logtable       varchar2(32), -- basetable's log-table
  refresh_status varchar2(1),  -- n: not refreshed, y: refreshed, p:pending, f: failed
  clear_status   varchar2(1),  -- n: not cleared,   y: cleared,   p:pending, f: failed
  mbr_to_clear   varchar2(1),  -- y/n: use tile's mbr for clearing finer levels
  zoom_level     number,       -- zoom level of this tile
  mx             number,       -- mesh x ordinate 
  my             number,       -- mesh Y ordinate 
  minx           number,       -- tile's minimum x coordinate
  miny           number,       -- tile's minimum y coordinate
  maxx           number,       -- tile's maximum x coordinate
  maxy           number,       -- tile's maximum y coordinate
  insert_time    Date,         -- when the tile MBR was inserted into this table
  update_time    Date          -- most recent update (refresh/clear) time
  );
 
-- create a sequence for mbr_MCAU_TL
CREATE SEQUENCE mbr_MCAU_TL_seq
  START WITH 1
  INCREMENT BY 1
  CYCLE
  MAXVALUE 9999999999;
 
-- create a trigger to get a unique id
create or replace trigger mbr_MCAU_TL_br
 before insert on mbr_MCAU_TL   -- before inserting the row
 referencing new as new old as old
 for each row  -- for each row 
begin
  select mbr_MCAU_TL_seq.nextval INTO :new.id FROM dual;
end;
/</pre></li>
                           <li>
                              <p>Create a log table.</p>
                              <p>The base tables' log table is for recording the rows changed in the base tables of the tile layer. Because each tile layer depends on the data in its base tables when generating a map tile, any change made to the base table (such as modifications of geometries or changes to attributes values) may affect their representation in their corresponding map tile. The change log table records such changes through a trigger created on its base table.</p>
                              <p>The following statements create a log table, a sequence, and a trigger on the table using the sequence to generate unique ID values.</p><pre class="oac_no_warn" dir="ltr">-- create the log table
create table log_MCAU_TL(  
  id number,
  geomO sdo_geometry,  -- the affected geometry or its attributes, original geometry
  geomN sdo_geometry,  -- the affected geometry or its attributes, new geometry
  modified Date,       -- when the modified occurred
  status varchar2(1),  -- y: processed, n: not processed
  datasource varchar2(32), -- data source name, more than one ds may access the same log
  tile_layer varchar2(32), -- tile layer name
  basetable  varchar2(32) -- base table name, more than one base table may insert into this log
);
 
-- create a sequence for log_MCAU_TL
CREATE SEQUENCE log_MCAU_TL_seq 
  START WITH 1
  INCREMENT BY 1
  CYCLE
  MAXVALUE 9999999999;
 
-- create a trigger for log_MCAU_TL to create a unique id
create or replace trigger log_MCAU_TL_br
 before insert on log_MCAU_TL   -- before inserting
 referencing new as new old as old
 for each row                          -- for each row 
begin
  select log_MCAU_TL_seq.nextval INTO :new.id FROM dual;
end;
/
</pre></li>
                           <li>
                              <p>Create a trigger on each base table to insert changes into the log table.</p>
                              <p>In a base table's trigger, any geometries inserted into the log table are transformed into the same spatial reference system (coordinate system) as the tile layer. If there are multiple data sources defined in the <code class="codeph">mapViewerConfig.xml</code> configuration file accessing the same schema, then one INSERT statement should be used for each of these data sources in each trigger definition.
                              </p>
                              <p>The following statements make these assumptions:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>One data source named MVDEMO is accessing the schema that contains the MCAU_TL tile layer. (Thus, there is only one INSERT statement in each trigger definition.)</p>
                                 </li>
                                 <li>
                                    <p>The tile layer's spatial reference system (SRID) is 8307 (WGS 84 longitude/latitude).</p>
                                 </li>
                                 <li>
                                    <p>There are four base tables to monitor for this tile layer: states, counties, interstates, and cities.</p>
                                 </li>
                              </ul><pre class="oac_no_warn" dir="ltr"><span class="bold">--states trigger</span>
create or replace trigger states_MCAU_TL_ar
 after insert or update or delete on states   -- any change
 referencing new as new old as old
 for each row                                
 when (old.geom IS NOT NULL OR new.geom IS NOT NULL)
declare
  oldGeom SDO_GEOMETRY;
  newGeom SDO_GEOMETRY;
  tileSRID  number;
begin
   tileSRID := 8307;
   oldGeom  := :old.geom;
   if (:old.geom IS NOT NULL) then
     if (:old.geom.SDO_SRID != tileSRID) then
       select sdo_cs.transform(:old.geom, tileSRID)  into oldGeom from dual;
     end if;
   end if;
   newGeom:=:new.geom;
   if (:new.geom IS NOT NULL) then
     if (:new.geom.SDO_SRID!= tileSRID) then
       select sdo_cs.transform(:new.geom, tileSRID)  into newGeom from dual;
     end if;
   end if;
 
   insert into log_MCAU_TL (id, geomO, geomN, modified, status, datasource, tile_layer, basetable)
        values(null, oldGeom, newGeom, sysdate, 'n', 'MVDEMO', 'MCAU_TL', 'states');
end;
/
 
<span class="bold">--counties trigger</span>
create or replace trigger counties_MCAU_TL_ar
 after insert or update or delete on counties
 referencing new as new old as old
 for each row 
 when (old.geom IS NOT NULL OR new.geom IS NOT NULL)
declare
  oldGeom SDO_GEOMETRY;
  newGeom SDO_GEOMETRY;
  tileSRID  number;
begin
   tileSRID := 8307;
   oldGeom  := :old.geom;
   if (:old.geom IS NOT NULL) then
     if (:old.geom.SDO_SRID!=tileSRID) then
       select sdo_cs.transform(:old.geom, tileSRID)  into oldGeom from dual;
     end if;
   end if;
   newGeom:=:new.geom;
   if (:new.geom IS NOT NULL) then
     if (:new.geom.SDO_SRID!= tileSRID) then
       select sdo_cs.transform(:new.geom, tileSRID)  into newGeom from dual;
     end if;
   end if;
   insert into log_MCAU_TL (id, geomO, geomN, modified, status, datasource, tile_layer, basetable)
        values(null, oldGeom, newGeom, sysdate, 'n', 'MVDEMO', 'MCAU_TL', 'counties');
end;
/
 
<span class="bold">--interstates trigger</span>
create or replace trigger interstates_MCAU_TL_ar
 after insert or update or delete on interstates 
 referencing new as new old as old
 for each row  
 when (old.geom IS NOT NULL OR new.geom IS NOT NULL)
declare
  oldGeom SDO_GEOMETRY;
  newGeom SDO_GEOMETRY;
  tileSRID  number;
begin
   tileSRID := 8307;
   oldGeom  := :old.geom;
   if (:old.geom IS NOT NULL) then
     if (:old.geom.SDO_SRID!=tileSRID) then
       select sdo_cs.transform(:old.geom, tileSRID)  into oldGeom from dual;
     end if;
   end if;
   newGeom:=:new.geom;
   if (:new.geom IS NOT NULL) then
     if (:new.geom.SDO_SRID!= tileSRID) then
       select sdo_cs.transform(:new.geom, tileSRID)  into newGeom from dual;
     end if;
   end if;
 
   insert into log_MCAU_TL (id, geomO, geomN, modified, status, datasource, tile_layer, basetable)
        values(null, oldGeom, newGeom, sysdate, 'n', 'MVDEMO', 'MCAU_TL', 'interstates');
    
end;
/
 
<span class="bold">--cities trigger</span>
create or replace trigger cities_MCAU_TL_ar
 after insert or update or delete on cities  
 referencing new as new old as old
 for each row
 when (old.location IS NOT NULL OR new.location IS NOT NULL)
declare
  oldGeom SDO_GEOMETRY;
  newGeom SDO_GEOMETRY;
  tileSRID  number;
begin
   tileSRID := 8307;
   oldGeom  := :old.location;
   if (:old.location IS NOT NULL) then
     if (:old.location.SDO_SRID!=tileSRID) then
       select sdo_cs.transform(:old.location, tileSRID)  into oldGeom from dual;
     end if;
   end if;
   newGeom:=:new.location;
   if (:new.location IS NOT NULL) then
     if (:new.location.SDO_SRID!= tileSRID) then
       select sdo_cs.transform(:new.location, tileSRID)  into newGeom from dual;
     end if;
   end if;
 
  insert into log_MCAU_TL (id, geomO, geomN, modified, status, datasource, tile_layer, basetable)
      values(null, oldGeom, newGeom, sysdate, 'n', 'MVDEMO', 'MCAU_TL', 'cities');
end;
/
commit;</pre></li>
                        </ol>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-A2E5CC6C-EC68-4C67-A1D1-09B8123BF3C3">Map Cache Auto-Update</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="JIMPV9999"></a><div class="props_rev_3"><a id="GUID-4BC91BF6-09DC-4B02-8754-61237959CCAE" name="GUID-4BC91BF6-09DC-4B02-8754-61237959CCAE"></a><h5 id="JIMPV-GUID-4BC91BF6-09DC-4B02-8754-61237959CCAE" class="sect5"><span class="enumeration_section">3.2.3.4 </span>Start the map visualizer server and test the map cache auto-update feature
                     </h5>
                     <div>
                        <p>To test the automatic tile updating, start the map visualizer server and then change one or more rows in the base table.</p>
                        <ol>
                           <li>
                              <p>Modify a row in the base table. For example:</p><pre class="oac_no_warn" dir="ltr">update cities set city='Worcester' where city='Worcester' and state_abrv='MA';
</pre></li>
                           <li>
                              <p>Check the log table. For example:</p><pre class="oac_no_warn" dir="ltr">select * from log_mcau_tl;
</pre><p>The result should include a row that was just inserted by the base table's trigger.</p>
                           </li>
                           <li>
                              <p>Wait for about one interval (one minute in this example), then check the dirty MBR table. For example:</p><pre class="oac_no_warn" dir="ltr">select count(*) from mbr_mcau_tl;
</pre><p>The result should include some dirty MBR rows inserted by the server.</p>
                           </li>
                        </ol>
                        <p>You can also look for changes in the <code class="codeph">refresh_status</code> column in the dirty MBR table. When rows are initially inserted, the status is set to <code class="codeph">n</code> for <span class="italic">not processed</span>; then it changes to <code class="codeph">p</code> for <span class="italic">pending</span> when they are being processed; and after the update is done, it changes to <code class="codeph">y</code> for <span class="italic">processed</span>. Meanwhile, on the server you can see that the server has been updating the tiles (the server's logger needs to be set to <code class="codeph">finest</code> level to see the finest logging information).
                        </p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-A2E5CC6C-EC68-4C67-A1D1-09B8123BF3C3">Map Cache Auto-Update</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="JIMPV10127"></a><div class="props_rev_3"><a id="GUID-9576FC06-D773-4C47-8F5F-DF3AD4567206" name="GUID-9576FC06-D773-4C47-8F5F-DF3AD4567206"></a><h4 id="JIMPV-GUID-9576FC06-D773-4C47-8F5F-DF3AD4567206" class="sect4"><span class="enumeration_section">3.2.4 </span>UTFGrid for Map Tiles: Including Text Information About Features
                  </h4>
                  <div>
                     <p>When a tile layer has UTFGrid enabled, a data set named UTFGrid becomes a "companion" of an image tile, containing text information about features in the image tile. This text information can be displayed by the browser when responding to a mouse event, such as mouse click on a map feature.</p>
                     <p>A UTFGrid data set is stored in JSON format, and has two components: (a) a grid data set that mirrors its companion image tile, and (b) attributes of all grid cells. The value at each grid cell serves as the key to link the image tile cell and its attributes. Each image pixel on a map is associated with a UTFGrid grid cell, and the cell's value indicates where its attributes (as text strings) can be retrieved. For storage efficiency, the value of each grid cell is encoded in a revised UTF-8 encoding scheme.</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-C8A62EAE-5C58-43F8-93C0-B964927F8C11">Enabling the UTFGrid Option for a Tile Layer</a><br></li>
                        <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-748AD86A-956E-4624-9242-A6F827D66C49">Encoding a Key and Decoding a Grid Cell's Value</a><br></li>
                        <li class="ulchildlink"><a href="map-visualization-servers.html#GUID-FFBDBD49-AB91-470C-9182-31D6D19DFFC0">Building a UTFGrid Test Case</a><br></li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-7E88B130-FB2F-47D1-A8B2-909CFB1454AC" title="The map tile server is a map image caching engine that fetches, caches, and serves pregenerated, fixed-size map image tiles.">Map Tile Server</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="JIMPV10128"></a><div class="props_rev_3"><a id="GUID-C8A62EAE-5C58-43F8-93C0-B964927F8C11" name="GUID-C8A62EAE-5C58-43F8-93C0-B964927F8C11"></a><h5 id="JIMPV-GUID-C8A62EAE-5C58-43F8-93C0-B964927F8C11" class="sect5"><span class="enumeration_section">3.2.4.1 </span>Enabling the UTFGrid Option for a Tile Layer
                     </h5>
                     <div>
                        <p>To enable the UTFGrid option for a map tile layer, then in the USER_ADO_CACHED_MAPS row for the tile layer, specify <code class="codeph">utfgrid="true"</code> in the <code class="codeph">&lt;map_tile_layer&gt;</code> element, and optionally specify the UTFGrid resolution with the <code class="codeph">utfgrid_resolution</code> attribute (the default is 4). For example:
                        </p><pre class="oac_no_warn" dir="ltr">insert into user_sdo_cached_maps values(
'UTFGRID_TL',
'utfgrid enalbled test case ',
'',
'YES',
'YES',
'&lt;map_tile_layer name="UTFGRID_TL" image_format="PNG" http_header_expires="168.0" concurrent_fetching_threads="3" fetch_larger_tiles="false"
    persistent_tiles="true" <span class="bold">utfgrid="true" utfgrid_resolution="4"</span>&gt;
   &lt;internal_map_source data_source="mvdemo" base_map="UTFGRID_BASEMAP" bgcolor="#dddddd" out_of_bounds_color="#eeddff"/&gt;
   &lt;tile_storage root_path="/temp" xyz_storage_scheme="true"/&gt;
   &lt;coordinate_system srid="8307" minX="-180.0" maxX="180.0" minY="-90.0" maxY="90.0"/&gt;
   &lt;tile_image width="256" height="256"/&gt;
   &lt;tile_dpi  value="90.7142857"/&gt;
   &lt;tile_meters_per_unit  value="111319.49079327358"/&gt;
   &lt;zoom_levels levels="19" min_scale="2132.729583849784" max_scale="559082264.0287178"&gt;
   &lt;/zoom_levels&gt;
&lt;/map_tile_layer&gt;',
'UTFGRID_BASEMAP',
'');
commit;
</pre><p>The <code class="codeph">utfgrid_resolution</code> attribute determines how fine the grid cells are in an UTFGrid data set, and the default value of 4 indicates that one grid cell represents 4 by 4 image pixels in its companion image tile. For example, if 256x256 is an image's dimension, then the grid's dimension will be 64x64, and a grid cell at row=10, column=20 represents the pixels in the tile image from row 40 to row 43 and from column 80 to column 83 (note that one grid cell represents 16 image tile pixels). When multiple features in the map image tile fall into one grid cell at the indicated resolution, then the feature with the majority or plurality of the pixels is assigned to the grid cell. The value stored in the grid cell is encoded using UTF-8 encoding.
                        </p>
                        <p>If a tile layer has UTFGrid enabled, when the map server generates a map image tile, it will also generate an UTFGrid data set stored in JSON format. When a client requests a map image tile, both the image tile and its UTFGrid JSON file will be returned in the response.</p>
                        <p>In the map visualizer server, the UTFGrid JSON files are stored in the same location with their image tiles. For example, if an image tile is cached at <code class="codeph">/mapcache/MVDEMO.UTFGRID_TL/0/1/2.PNG</code>, you should also see its companion UTFGrid file <code class="codeph">/mapcache/MVDEMO.UTFGRID_TL/0/1/2.JSON</code>.
                        </p>
                        <p>This UTFGrid option is currently not supported if the image tiles are stored in a database table (see <a href="map-visualization-servers.html#GUID-F9C62C09-CF22-40F0-B4D3-E9A5AC0FED32">Store the tiles in a database table</a>) when disk cache is disabled for a tile layer (see <a href="map-visualization-servers.html#GUID-A4B8E43B-A59B-4D77-89C7-91A29602DE46">Stream the tiles directly without storing them</a>).
                        </p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-9576FC06-D773-4C47-8F5F-DF3AD4567206">UTFGrid for Map Tiles: Including Text Information About Features</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="JIMPV10129"></a><div class="props_rev_3"><a id="GUID-748AD86A-956E-4624-9242-A6F827D66C49" name="GUID-748AD86A-956E-4624-9242-A6F827D66C49"></a><h5 id="JIMPV-GUID-748AD86A-956E-4624-9242-A6F827D66C49" class="sect5"><span class="enumeration_section">3.2.4.2 </span>Encoding a Key and Decoding a Grid Cell's Value
                     </h5>
                     <div>
                        <p>A tile layer can contain multiple data layers or themes. Each theme will have its own grid data set, and an UTFGrid JSON object may contain multiple grid data sets. In each theme's grid, features shown in its image tile are also "drawn" using styles to render each feature. As for its associated image tile, a feature is drawn using its key, and the key is an ordinal number assigned to each feature. This number is used to assign a UTF-8 encoded value for the cell's value.</p>
                        <p>When a mouse event is triggered on a feature in an image tile, the image pixel's corresponding grid cell can be located, and the cell's value (an UTF-8 encoded value) can then be retrieved. This UTF-8 encoded value can then be decoded to derive its key, an ordinal number. Using this key, the attribute stored can be obtained. (See the examples near the end of <a href="map-visualization-servers.html#GUID-FFBDBD49-AB91-470C-9182-31D6D19DFFC0">Building a UTFGrid Test Case</a>.)
                        </p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-9576FC06-D773-4C47-8F5F-DF3AD4567206">UTFGrid for Map Tiles: Including Text Information About Features</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="JIMPV10130"></a><div class="props_rev_3"><a id="GUID-FFBDBD49-AB91-470C-9182-31D6D19DFFC0" name="GUID-FFBDBD49-AB91-470C-9182-31D6D19DFFC0"></a><h5 id="JIMPV-GUID-FFBDBD49-AB91-470C-9182-31D6D19DFFC0" class="sect5"><span class="enumeration_section">3.2.4.3 </span>Building a UTFGrid Test Case
                     </h5>
                     <div>
                        <div class="section">
                           <p>This test case focuses on the server side. It has two major steps: creating a UTFGrid-enabled tile layer, and sending some hard-coded requests to the server. (In a real application, you need to have a client side map application to make use of the tile layer.)</p>
                           <ol>
                              <li>
                                 <p>Create a UTFGrid-enabled tile layer.</p>
                                 <p>If all the spatial base tables and styles exist in the metadata, the following example creates four themes, a basemap, and an UTFGrid-enabled tile layer. Because the feature attributes stored in an UTFGrid JSON object come from the <code class="codeph">&lt;hidden_info&gt;</code> element of a theme, the <code class="codeph">&lt;hidden_info&gt;</code> element is defined in three of the four themes. (If none of the four themes has the <code class="codeph">&lt;hidden_info&gt;</code> element defined, then enabling this tile layer's UTFGrid option would not make sense, because the UTFGrid object would be empty and creating it would still consume server resources.)
                                 </p><pre class="oac_no_warn" dir="ltr">-- insert  theme 1
insert into USER_SDO_THEMES (name, description, base_table, geometry_column, styling_rules) 
values (
 'UTFGRID_THEME_DEMO_STATES', 
 'for utfgrid testing',
 'STATES',
 'GEOM',
 '&lt;?xml version="1.0" standalone="yes"?&gt;
&lt;styling_rules&gt;
  &lt;hidden_info&gt;
    &lt;field column="STATE" name="State"/&gt;
    &lt;field column="STATE_ABRV" name="Abrv."/&gt;
    &lt;field column="TOTPOP" name="Population"/&gt;
  &lt;/hidden_info&gt;
  &lt;rule&gt;
    &lt;features style="C.S02_COUNTRY_AREA"&gt; &lt;/features&gt;
    &lt;label column="STATE_ABRV" style="T.S02_STATE_ABBREVS"&gt; 1 &lt;/label&gt;
  &lt;/rule&gt;
&lt;/styling_rules&gt;');
 
 
-- insert theme 2
insert into USER_SDO_THEMES (name, description, base_table, geometry_column, styling_rules)
values (
 'UTFGRID_THEME_DEMO_COUNTIES',
 'for utfgrid testing',
 'COUNTIES',
 'GEOM',
 '&lt;?xml version="1.0" standalone="yes"?&gt;
&lt;styling_rules&gt;
  &lt;!--&lt;hidden_info&gt;
    &lt;field column="COUNTY" name="County"/&gt;
    &lt;field column="FIPSSTCO" name="Fips"/&gt;
    &lt;field column="TOTPOP" name="Population"/&gt;
    &lt;field column="STATE_ABRV" name="State"/&gt;
  &lt;/hidden_info&gt;--&gt;
  &lt;rule&gt;
    &lt;features style="L.S06_BORDER_STATE"&gt; &lt;/features&gt;
  &lt;/rule&gt;
&lt;/styling_rules&gt;');
 
-- insert theme 3
insert into USER_SDO_THEMES (name, description, base_table, geometry_column, styling_rules)
values (
 'UTFGRID_THEME_DEMO_HIGHWAYS',
 'for utfgrid testing',
 'INTERSTATES',
 'GEOM',
 '&lt;?xml version="1.0" standalone="yes"?&gt;
&lt;styling_rules&gt;
  &lt;hidden_info&gt;
    &lt;field column="HIGHWAY" name="Highway"/&gt;
    &lt;field column="ROUTEN" name="No."/&gt;
  &lt;/hidden_info&gt;
  &lt;rule&gt;
    &lt;features style="L.S04_ROAD_INTERSTATE"&gt; &lt;/features&gt;
    &lt;label column="routen" style="M.HWY_USA_INTERSTATE_NARROW"&gt; (3-length(routen)) &lt;/label&gt;
  &lt;/rule&gt;
&lt;/styling_rules&gt;');
 
-- insert theme 4
insert into USER_SDO_THEMES (name, description, base_table, geometry_column, styling_rules)
values (
 'UTFGRID_THEME_DEMO_CITIES',
 'for utfgrid testing',
 'CITIES',
 'LOCATION',
 '&lt;?xml version="1.0" standalone="yes"?&gt;
&lt;styling_rules&gt;
  &lt;hidden_info&gt;
    &lt;field column="CITY" name="City"/&gt;
    &lt;field column="POP90" name="Population"/&gt;
  &lt;/hidden_info&gt;
  &lt;rule&gt;
    &lt;features style="M.ALL_CITY_L2"&gt; (pop90 between 200000 AND 1000000 ) &lt;/features&gt;
    &lt;label column="city" style="T.S07_CITIES_L2"&gt; 1 &lt;/label&gt;
  &lt;/rule&gt;
  &lt;rule&gt;
    &lt;features style="M.ALL_CITY_L3"&gt; (pop90 between 0 and  200000) &lt;/features&gt;
    &lt;label column="city" style="T.S07_CITIES_L3"&gt; 1 &lt;/label&gt;
  &lt;/rule&gt;
&lt;/styling_rules&gt;');
 
-- insert a basemap
INSERT INTO USER_SDO_MAPS (name, description, definition)
values (
 'UTFGRID_BASEMAP',
 'for utfgrid testing',
 '&lt;?xml version="1.0" standalone="yes"?&gt;
  &lt;map_definition&gt;
    &lt;theme name="UTFGRID_THEME_DEMO_STATES" min_scale="1.5E8" max_scale="0.0" scale_mode="RATIO"/&gt;
    &lt;theme name="UTFGRID_THEME_DEMO_COUNTIES" min_scale="8500000.0" max_scale="0.0" scale_mode="RATIO"/&gt;
    &lt;theme name="UTFGRID_THEME_DEMO_HIGHWAYS" min_scale="4.5E7" max_scale="0.0" scale_mode="RATIO"/&gt;
    &lt;theme name="UTFGRID_THEME_DEMO_CITIES" min_scale="7500000.0" max_scale="0.0" scale_mode="RATIO"/&gt;
  &lt;/map_definition&gt;' );
 
-- insert the UTFGrid enabled tile layer
insert into user_sdo_cached_maps values(
 'UTFGRID_TL',
 'a utfgrid ',
 '',
 'YES',
 'YES',
 '&lt;map_tile_layer name="UTFGRID_TL" image_format="PNG" http_header_expires="168.0" concurrent_fetching_threads="3" fetch_larger_tiles="false"
    persistent_tiles="true" utfgrid="true" utfgrid_resolution="8"&gt;
   &lt;internal_map_source data_source="mvdemo" base_map="UTFGRID_BASEMAP" bgcolor="#dddddd" out_of_bounds_color="#eeddff"/&gt;
   &lt;tile_storage root_path="/temp" xyz_storage_scheme="true"/&gt;
   &lt;coordinate_system srid="8307" minX="-180.0" maxX="180.0" minY="-90.0" maxY="90.0"/&gt;
   &lt;tile_image width="256" height="256"/&gt;
   &lt;tile_dpi  value="90.7142857"/&gt;
   &lt;tile_meters_per_unit  value="111319.49079327358"/&gt;
   &lt;zoom_levels levels="19" min_scale="2132.729583849784" max_scale="559082264.0287178"&gt;
   &lt;/zoom_levels&gt;
&lt;/map_tile_layer&gt;',
 'UTFGRID_BASEMAP',
 '');
commit;
</pre></li>
                              <li>
                                 <p>Request the map image and its UTFGrid object.</p>
                                 <p>In an actual application, requesting a map image tile and its companion UTFGrid JSON file is handled by the map visualizer HTML5 API; however, for illustration purposes, two substeps with hard-coded requests are shown here.</p>
                                 <ol type="a">
                                    <li>
                                       <p>Request an image tile from the server. For example:</p>
                                       <p><code class="codeph">http://localhost:8080/mapviewer/mcserver?request=gettile&amp;format=png&amp;zoomlevel=8&amp;mapcache=MVDEMO.UTFGRID_TL&amp;mx=77&amp;my=94</code></p>
                                       <p>The server's response:</p>
                                       <div class="figure" id="GUID-FFBDBD49-AB91-470C-9182-31D6D19DFFC0__GUID-31F0EE31-1F94-4C8F-858C-F3A1FC4FFCC4"><img src="img/utfgrid_example_image_tile.jpg" alt="Description of utfgrid_example_image_tile.jpg follows" title="Description of utfgrid_example_image_tile.jpg follows" longdesc="img_text/utfgrid_example_image_tile.html"><br><a href="img_text/utfgrid_example_image_tile.html">Description of the illustration utfgrid_example_image_tile.jpg</a></div>
                                       <!-- class="figure" -->
                                    </li>
                                    <li>
                                       <p>Request the image tile's companion UTFGrid from the server. For example:</p>
                                       <p><code class="codeph">http://localhost:8080/mapviewer/mcserver?request=getutfgrid&amp;format=json&amp;zoomlevel=8&amp;mapcache=MVDEMO.UTFGRID_TL&amp;mx=77&amp;my=94</code></p>
                                       <p>The server's response:</p><pre class="oac_no_warn" dir="ltr">{"UTFGRID_THEME_DEMO_STATES":
{"keys":["1","2","3"],
"data":{
"1":{"State":"New Hampshire","Abrv.":"NH","Population":"1109252"},
"2":{"State":"Maine","Abrv.":"ME","Population":"1227928"},
"3":{"State":"Massachusetts","Abrv.":"MA","Population":"6016424"}},
"grid":[
"!!!!!!!!!!!!!!!!!###############",
"!!!!!!!!!!!!!!!!!###############",
"!!!!!!!!!!!!!!!!!############## ",
"!!!!!!!!!!!!!!!!!###############",
"!!!!!!!!!!!!!!!!!############## ",
"!!!!!!!!!!!!!!!!!#############  ",
"!!!!!!!!!!!!!!!!!!#########     ",
"!!!!!!!!!!!!!!!!!!!########     ",
"!!!!!!!!!!!!!!!!!!!!#######     ",
"!!!!!!!!!!!!!!!!!!!!######      ",
"!!!!!!!!!!!!!!!!!!!!######      ",
"!!!!!!!!!!!!!!!!!!!!!!###       ",
"!!!!!!!!!!!!!!!!!!!!!!!#        ",
"!!!!!!!!!!!!!!!!!!!!!!!         ",
"!!!!!!!!!!!!!!!!!!!!!!          ",
"!!!!!!!!!!!!!!!!!!!!!!          ",
"!!!!!!!!!!!!!!!!!$$!!           ",
"!!!!!!!!!!!!!!!$$$$$$           ",
"!!!!!!!!!!!!$$$$$$$$$           ",
"!!!!!!!!!!!$$$$$$$$$$$          ",
"$$$$$!!!!$$$$$$$$$$$$$$ $$      ",
"$$$$$$$$$$$$$$$$$$$$$$$$$$      ",
"$$$$$$$$$$$$$$$$$$$$$$$$$$      ",
"$$$$$$$$$$$$$$$$$$$$$$$$$       ",
"$$$$$$$$$$$$$$$$$$$$$           ",
"$$$$$$$$$$$$$$$$$$$$            ",
"$$$$$$$$$$$$$$$$$$$             ",
"$$$$$$$$$$$$$$$$$$              ",
"$$$$$$$$$$$$$$$$$$              ",
"$$$$$$$$$$$$$$$$$$$$            ",
"$$$$$$$$$$$$$$$$$$$$$$          ",
"$$$$$$$$$$$$$$$$$$$$$$$         "]},
"UTFGRID_THEME_DEMO_HIGHWAYS":{
"keys":["1","2","3","4","5","6","7","8","9"],
"data":{
"1":{"Highway":"I 93","No.":"93"},
"2":{"Highway":"I 95","No.":"95"},
"3":{"Highway":"I 89","No.":"89"},
"4":{"Highway":"I 293","No.":"293"},
"5":{"Highway":"I 495","No.":"495"},
"6":{"Highway":"I 190","No.":"190"},
"7":{"Highway":"88","No.":"99"},
"8":{"Highway":"I 290","No.":"290"},
"9":{"Highway":"I 90","No.":"90"}},
"grid":[
"  !                          ## ",
"  !                        ###  ",
"  !!                       ##   ",
"  !!                      ##    ",
"  !                      ##     ",
"  !                      ##     ",
"  !!                    ##      ",
"   !!                   ##      ",
"$  !!                   #       ",
"$$$$!                  ##       ",
"    !!                ###       ",
"     !              ###         ",
"     %!             ##          ",
"     %!!           ##           ",
"     %%!           #            ",
"       !!         ##            ",
"        !!        ##            ",
"         !!   &amp;&amp;&amp;&amp;#             ",
"          !! &amp;&amp;&amp; ##             ",
"          !! &amp;   #              ",
"           !&amp;&amp;  ##              ",
"         &amp;&amp;&amp;!   ##              ",
"       &amp;&amp;&amp;&amp; !   ##              ",
"    &amp;&amp;&amp;&amp;    !!  ##              ",
"'  &amp;&amp;&amp;     ##!###               ",
"' &amp;&amp;&amp;     #((!!                 ",
"  &amp;&amp;      #( !!                 ",
"  &amp;&amp;      (  !!!                ",
")))&amp;  *********!                ",
")  &amp;***** ##   !                ",
"*****      ##  !                ",
"***&amp;&amp;      ##!!!                "]},
"UTFGRID_THEME_DEMO_CITIES":{
"keys":["1","2"],
"data":{
"1":{"City":"Lowell","Population":"103439"},
"2":{"City":"Boston","Population":"574283"}},
"grid":[
"                                ",
"                                ",
"                                ",
"                                ",
"                                ",
"                                ",
"                                ",
"                                ",
"                                ",
"                                ",
"                                ",
"                                ",
"                                ",
"                                ",
"                                ",
"                                ",
"                                ",
"                                ",
"                                ",
"                                ",
"                                ",
"        !!                      ",
"                                ",
"                                ",
"                                ",
"                                ",
"                                ",
"                                ",
"               ##               ",
"                                ",
"                                ",
"                                "]},
"resolution":"8","rows":"32","columns":"32"}
</pre><p>The preceding response shows a UTFGrid object that contains properties for the themes <code class="codeph">UTFGRID_THEME_DEMO_STATES</code>, <code class="codeph">UTFGRID_THEME_DEMO_HIGHWAYS</code>, and <code class="codeph">UTFGRID_THEME_DEMO_CITIES</code>. (The theme <code class="codeph">UTFGRID_THEME_DEMO_COUNTIES</code> did not define the <code class="codeph">&lt;hidden_info&gt;</code> element, and so nothing about that theme is listed in the response.)
                                       </p>
                                    </li>
                                 </ol>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-9576FC06-D773-4C47-8F5F-DF3AD4567206">UTFGrid for Map Tiles: Including Text Information About Features</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="JIMPV9810"></a><a id="JIMPV9811"></a><a id="JIMPV9809"></a><div class="props_rev_3"><a id="GUID-D58CA71F-B70B-4FFE-964A-CEE2859C7FC6" name="GUID-D58CA71F-B70B-4FFE-964A-CEE2859C7FC6"></a><h4 id="JIMPV-GUID-D58CA71F-B70B-4FFE-964A-CEE2859C7FC6" class="sect4"><span class="enumeration_section">3.2.5 </span>External Map Source Adapter
                  </h4>
                  <div>
                     <p>An external map source adapter is the interface between a map tile server and an external map services provider. When a map image tile needs to be fetched from the external map services provider, the map tile server calls the adapter with information about the zoom level, size, and location of the tile. The adapter then constructs a provider-specific request, sends the request to the external map services provider, and return the resulting image tile to the map tile server.</p>
                     <p>The external map source adapter is a Java class that must extends the abstract Java class <code class="codeph">oracle.mapviewer.share.mapcache.MapSourceAdapter</code>, which is defined as follows:
                     </p><pre class="oac_no_warn" dir="ltr">public abstract class MapSourceAdapter
{
   public abstract String getMapTileRequest(TileDefinition tile);
   public byte[] getTileImageBytes(TileDefinition tile) ;
   public Properties getProperties() ;
}
</pre><p>An adapter that extends this class must implement the following method:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><code class="codeph">public String getMapTileRequest(TileDefinition tile)</code></p>
                           <p>This method should implement the logic to construct the HTTP request string that can be sent to the map services provider to fetch the map image tile. For example, if the URL of a map tile is <code class="codeph">http://myhost/mymapserver?par1=v1&amp;par2=v2&amp;par3=v3</code>, the HTTP request string returned by this method should be <code class="codeph">par1_v1&amp;par2=v2&amp;par3=v3</code>.
                           </p>
                           <p>When the map tile server cannot find a specific map tile, it calls the <code class="codeph">getTileImageBytes</code> method to fetch the binary data of the tile image, and that method calls the <code class="codeph">getMapTileRequest</code> method to construct the map tile request before fetching the tile. The <code class="codeph">getMapTileRequest</code> method takes one parameter: a <code class="codeph">TileDefinition</code> object that specifies the zoom level, bounding box, image size and image format of the requested tile. This method returns the HTTP request string.
                           </p>
                        </li>
                     </ul>
                     <p>The map source adapter also inherits all methods implemented in class <code class="codeph">MapSourceAdapter</code>. Among them, the following methods are more important than the others:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><code class="codeph">public byte[] getTileImageBytes(TileDefinition tile)</code></p>
                           <p>This method fetches the actual binary map tile image data from the external map service provider. This method is already implemented. It calls the abstract method <code class="codeph">getMapTileRequest</code> to construct the map tile request and sends the request to the external map services provider. If the map tiles cannot be fetched by sending HTTP requests, you can override this method to implement the appropriate logic to fetch an image tile from the map source. This method takes one parameter: a <code class="codeph">TileDefinition</code> object that specifies the zoom level, bounding box, image size, and image format of the requested tile. This method returns the binary tile image data encoded in the image format specified in the map tile layer configuration settings.
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">public Properties getProperties()</code></p>
                           <p>This method returns the provider-specific parameters defined in the map tile layer configuration settings explained in <a href="map-visualization-servers.html#GUID-5CF7DC08-0B32-4C72-B9D0-F3762A7E6171">Map Tile Layer Configuration</a>.
                           </p>
                        </li>
                     </ul>
                     <p>The <code class="codeph">MapSourceAdapter</code> and <code class="codeph">TileDefinition</code> classes are packaged inside <code class="codeph">mvclient.jar</code>, which can be found under the directory <span class="italic"><code class="codeph">$MAPVIEWER_HOME</code></span><code class="codeph">/web/WEB/lib</code>.
                     </p>
                     <p><a href="map-visualization-servers.html#GUID-D58CA71F-B70B-4FFE-964A-CEE2859C7FC6__BABGCHJB">Example 3-5</a> shows an external map source adapter.
                     </p>
                     <div class="example" id="GUID-D58CA71F-B70B-4FFE-964A-CEE2859C7FC6__BABGCHJB">
                        <p class="titleinexample">Example 3-5 External Map Source Adapter</p><pre class="oac_no_warn" dir="ltr">/**
 * This is a sample map source adapter that can be used to fetch map 
 * tiles from a map visualizer instance.
 */
package mcsadapter ;
 
import java.awt.Dimension;
import java.net.URL;
import java.util.Properties;
import oracle.lbs.mapclient.MapViewer;
import oracle.lbs.mapcommon.MapResponse;
import oracle.mapviewer.share.mapcache.*;
 
/**
 * The map source adapter must extend class
 * oracle.lbs.mapcache.cache.MapSourceAdapter.
 */
 
public class MVAdapter extends MapSourceAdapter
{
  /**
   * Gets the map tile request string that is to be sent to the map 
   * service provider URL.
   * @param tile tile definition
   * @return request string
   */
  public String getMapTileRequest(TileDefinition tile)
  {
    // Get map source specified parameters
    Properties props = this.getProperties() ;
    String dataSource = props.getProperty("data_source") ;
    String baseMap = props.getProperty("base_map") ;
    // Use oracle.lbs.mapclient.MapViewer to construct the request string
    MapViewer mv = new MapViewer(this.getMapServiceURL()) ;
    mv.setDataSourceName(dataSource);
    mv.setBaseMapName(baseMap);
    mv.setDeviceSize(new Dimension(tile.getImageWidth(), 
                                   tile.getImageHeight()));
    mv.setCenterAndSize(tile.getBoundingBox().getCenterX(), 
                        tile.getBoundingBox().getCenterY(),
                        tile.getBoundingBox().getHeight());
    int format = MapResponse.FORMAT_PNG_STREAM ;
    String req = null ;
    switch(tile.getImageFormat())
    {
      case TileDefinition.FORMAT_GIF:
        mv.setImageFormat(MapResponse.FORMAT_GIF_URL);
        req = mv.getMapRequest().toXMLString().replaceFirst(
                        "format=\"GIF_URL\"", "format=\"GIF_STREAM\"") ;
        break ;
      case TileDefinition.FORMAT_PNG:
        mv.setImageFormat(MapResponse.FORMAT_PNG_URL);
        req = mv.getMapRequest().toXMLString().replaceFirst(
                        "format=\"PNG_URL\"", "format=\"PNG_STREAM\"") ;
        break ;
      case TileDefinition.FORMAT_JPEG:
        mv.setImageFormat(MapResponse.FORMAT_JPEG_URL);
        req = mv.getMapRequest().toXMLString().replaceFirst(
                        "format=\"JPEG_URL\"", "format=\"JPEG_STREAM\"");
        break ;
    }
    
    byte[] reqStr = null ;
    try
    {
      reqStr = req.getBytes("UTF8") ;
    }
    catch(Exception e)
    {}
    // Return the request string.
    return "xml_request="+ new String(reqStr);
  }
}
</pre><p><a href="map-visualization-servers.html#GUID-D58CA71F-B70B-4FFE-964A-CEE2859C7FC6__BABDAHAG">Example 3-6</a> shows the implementation of the <code class="codeph">MapSourceAdapter.getTileImageBytes</code> method.
                        </p>
                     </div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-D58CA71F-B70B-4FFE-964A-CEE2859C7FC6__BABDAHAG">
                        <p class="titleinexample">Example 3-6 MapSourceAdapter.getTileImageBytes Implementation</p><pre class="oac_no_warn" dir="ltr">/**
 * Fetches the map image tile from the external map service provider by 
 * sending the HTTP map tile request to the map service provider, and 
 * return the binary tile image data. You can rewrite this method so that 
 * the adapter can fetch the tile from an external map service provider 
 * that does not accept HTTP requests at all. 
 * @param tile the tile definition
 * @return the binary tile image data. 
 * @throws Exception
 */
public byte[] getTileImageBytes(TileDefinition tile)
  throws Exception
{
  // construct request string
  String request = getMapTileRequest(tile) ;
  
  if(request == null) 
  {
    throw new Exception("Null map tile request string in map source adapter!") ;
  }
 
  // set proxy settings
    Proxy proxy = null ;
 
  /* If the proxyHost is "NONE", the request is sent directly to the 
   * external server. If the proxyHost is a valid host, that host will 
   * be used as the proxy server. If the proxyHost is empty of omitted,  
   * the global proxy setting in mapViewerConfig.xml will be in effect.
   */
  boolean noProxy = "NONE".equalsIgnoreCase(getProxyHost()) ;
  if(getProxyHost()!=null &amp;&amp; !noProxy)
  {
    SocketAddress addr = new InetSocketAddress(proxyHost, proxyPort);
    proxy = new Proxy(Proxy.Type.HTTP, addr);
  }
    
  // send the request and get the tile image binary  
  PrintWriter wr = null ;
  BufferedInputStream bis = null;
  try 
  {
    String urlStr = mapServiceURL ;
    if("GET".equalsIgnoreCase(httpMethod))
      urlStr = mapServiceURL + "?" + request ;
    log.finest("http "+httpMethod+": "+urlStr);
      
    URL url = new URL(urlStr);
    // Open a URL connection based on current proxy setting
    URLConnection conn = 
      proxy!=null? url.openConnection(proxy):
                   (noProxy? url.openConnection(Proxy.NO_PROXY):
                             url.openConnection()) ;
    conn.setConnectTimeout(timeOut);
    if("GET".equalsIgnoreCase(getHTTPMethod()))
      conn.connect();
    else
    {
      conn.setDoOutput(true);
      wr = new PrintWriter(conn.getOutputStream());
      wr.print(request);
      wr.flush();
      wr.close();
      wr = null ;
    }
    bis = new BufferedInputStream(conn.getInputStream());
    byte[] result = toBytes(bis) ;
    bis.close();
    bis = null ;
    return result;
  }
  catch(Exception ioe) 
  {
    throw new Exception("Failed to fetch external map tile.", ioe);
  }
  finally 
  {
    try 
    {
      if(bis != null) 
      {
        bis.close();
        bis = null;
      }
      if(wr != null) 
      {
        wr.close();
        wr = null;
      }
    }
    catch(IOException ioee) 
    {
      throw ioee;
    }
  }
} </pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>Parent topic:</strong> <a href="map-visualization-servers.html#GUID-7E88B130-FB2F-47D1-A8B2-909CFB1454AC" title="The map tile server is a map image caching engine that fetches, caches, and serves pregenerated, fixed-size map image tiles.">Map Tile Server</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>