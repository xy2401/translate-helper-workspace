<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>Oracle数据库高级队列</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Programmer&#39;s Guide "></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Programmer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="oracle-c-call-interface-programmers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-03-06T02:31:59-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1999, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96205-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="globalization-and-unicode-support.html" title="Previous" type="text/html"></link>
      <link rel="next" href="oracle-xa-library.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Oracle C++ Call Interface Programmer&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="LNCPP"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="globalization-and-unicode-support.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="oracle-xa-library.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">程序员指南</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Oracle数据库高级队列</li>
            </ol>
            <a id="GUID-BDEC4D8E-2388-494B-A587-47308ABC6382" name="GUID-BDEC4D8E-2388-494B-A587-47308ABC6382"></a><a id="LNCPP010"></a>
            
            <h2 id="LNCPP-GUID-BDEC4D8E-2388-494B-A587-47308ABC6382" class="sect2"><span class="enumeration_chapter">10</span> Oracle数据库高级队列</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍了OCCI实现的Oracle数据库高级排队（AQ）消息。</p>
               <p>本章包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="oracle-streams-advanced-queueing.html#GUID-4A34B665-1E00-4773-84AE-F107B851442F">Oracle数据库高级队列概述</a></p>
                  </li>
                  <li>
                     <p><a href="oracle-streams-advanced-queueing.html#GUID-730D9965-D1D2-47A2-B568-34203CA2223B">关于OCCI中的AQ实施</a></p>
                  </li>
                  <li>
                     <p><a href="oracle-streams-advanced-queueing.html#GUID-DF06D106-1A56-49EE-980A-DEA390794E21">关于创建消息</a></p>
                  </li>
                  <li>
                     <p><a href="oracle-streams-advanced-queueing.html#GUID-CCA3666A-DC8A-44FB-B062-1226015BC985">排队邮件</a></p>
                  </li>
                  <li>
                     <p><a href="oracle-streams-advanced-queueing.html#GUID-E7FEEE76-4001-4EDD-8922-0E5B20CBE8E8">出列消息</a></p>
                  </li>
                  <li>
                     <p><a href="oracle-streams-advanced-queueing.html#GUID-DD67A071-D1EC-43F5-9252-949DE4319821">听取消息</a></p>
                  </li>
                  <li>
                     <p><a href="oracle-streams-advanced-queueing.html#GUID-956BDB8B-86B6-414F-8531-5599D66510FA">关于注册通知</a></p>
                  </li>
                  <li>
                     <p><a href="oracle-streams-advanced-queueing.html#GUID-2949A76A-680E-481B-AE66-0E8F184199D3">关于消息格式转换</a></p>
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-BDEC4D8E-2388-494B-A587-47308ABC6382__GUID-248BAD5B-8551-4BC9-A80E-D63AB5E275F5">
                  <p class="notep1">也可以看看：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="../adque/aq-introduction.html#ADQUE0100" target="_blank"><span><cite>Oracle数据库高级队列用户指南</cite></span></a> ，了解高级队列的基本概念</p>
                     </li>
                     <li>
                        <p><a href="occi-application-programing-interface.html#GUID-3C824380-073E-4F32-AA6E-928A18D52F4B">OCCI应用程序编程接口</a></p>
                     </li>
                  </ul>
               </div>
            </div><a id="LNCPP20424"></a><div class="props_rev_3"><a id="GUID-4A34B665-1E00-4773-84AE-F107B851442F" name="GUID-4A34B665-1E00-4773-84AE-F107B851442F"></a><h3 id="LNCPP-GUID-4A34B665-1E00-4773-84AE-F107B851442F" class="sect3"><span class="enumeration_section">10.1</span> Oracle数据库高级队列概述</h3>
               <div>
                  <p>Oracle Streams是一种新的信息共享功能，可提供复制，消息队列，数据仓库加载和事件通知。它也是Oracle数据库高级队列（AQ）的基础。</p>
                  <p>高级队列是集成的消息队列功能，它公开了Oracle Database AQ的消息队列功能，使应用程序能够：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>执行与Oracle数据库中的SQL操作类似的消息队列操作</p>
                     </li>
                     <li>
                        <p>通过AQ队列中的消息异步通信</p>
                     </li>
                     <li>
                        <p>与数据库集成，实现消息队列的前所未有的操作简单性，可靠性和安全性</p>
                     </li>
                     <li>
                        <p>审核并跟踪消息</p>
                     </li>
                     <li>
                        <p>支持同步和异步通信模式</p>
                     </li>
                  </ul>
                  <p>在OCCI应用程序中使用AQ的优点包括：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>创建以一致，可靠，安全和自主的方式相互通信的应用程序</p>
                     </li>
                     <li>
                        <p>将消息存储在数据库表中，将数据库的可靠性和可恢复性带到消息传递基础结构中</p>
                     </li>
                     <li>
                        <p>自动保留数据库中的消息以进行审计和商业智能</p>
                     </li>
                     <li>
                        <p>创建利用消息传递的应用程序，而无需处理不同的安全性，数据类型或操作模式</p>
                     </li>
                     <li>
                        <p>利用数据库的事务特征</p>
                     </li>
                  </ul>
                  <p>由于传统的消息传递解决方案具有单个订户队列，因此必须为彼此通信的每对应用程序创建一个队列。AQ的发布/订阅协议可以轻松地将其他应用程序（订阅者）添加到多个应用程序之间的对话中。</p>
               </div>
            </div><a id="LNCPP20425"></a><div class="props_rev_3"><a id="GUID-730D9965-D1D2-47A2-B568-34203CA2223B" name="GUID-730D9965-D1D2-47A2-B568-34203CA2223B"></a><h3 id="LNCPP-GUID-730D9965-D1D2-47A2-B568-34203CA2223B" class="sect3"><span class="enumeration_section">10.2</span>关于OCCI中的AQ实施</h3>
               <div>
                  <p>OCCI AQ是一组接口，允许消息传递客户端访问Oracle的高级队列功能，以用于企业消息传递应用程序。目前，OCCI AQ仅支持操作接口而不支持管理接口，但可以通过嵌入式PL / SQL调用访问管理操作。</p>
                  <div class="infoboxnotealso" id="GUID-730D9965-D1D2-47A2-B568-34203CA2223B__GUID-5E9C50E7-4B55-4CD6-B973-D2BEB79244A8">
                     <p class="notep1">也可以看看：</p>
                     <p>在<a href="../arpls/DBMS_AQADM.html#ARPLS005" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考中</cite></span></a>打包<a href="../arpls/DBMS_AQADM.html#ARPLS005" target="_blank"><code class="codeph">DBMS_AQADM</code></a> ，用于通过PL / SQL在AQ支持中进行管理操作</p>
                  </div>
                  <p>AQ功能可与OCCI提供的其他接口一起使用，以便在启用消息的数据库中进行发送，接收，发布和订阅。基于消息选择规则可以使用同步和异步消息消耗。</p>
                  <p>排队是指向队列发送消息，而出列是指接收消息。客户端应用程序可以创建消息，在其上设置所需的属性，并通过将消息存储在队列（数据库中的表）中来对其进行入队。将消息出列时，应用程序可以通过调用队列上的接收方法来同步出列，也可以通过等待来自数据库的通知来异步出列。</p>
                  <div class="p">AQ功能通过以下抽象实现：<ul style="list-style-type:disc">
                        <li>
                           <p><a href="oracle-streams-advanced-queueing.html#GUID-263CB45B-4476-4892-B972-0DD6B41C2F78">信息</a></p>
                        </li>
                        <li>
                           <p><a href="oracle-streams-advanced-queueing.html#GUID-D51AF7E0-1F48-45DC-B6A1-B15BB14067C9">代理人</a></p>
                        </li>
                        <li>
                           <p><a href="oracle-streams-advanced-queueing.html#GUID-E69EEAA8-9523-4D1E-83AA-1B6CD4A1406E">制片人</a></p>
                        </li>
                        <li>
                           <p><a href="oracle-streams-advanced-queueing.html#GUID-76B45715-1DF9-413D-AC52-EEB3C3932AA0">消费者</a></p>
                        </li>
                        <li>
                           <p><a href="oracle-streams-advanced-queueing.html#GUID-8C7458B6-7B21-46C8-8A70-2EDE510CBD12">倾听者</a></p>
                        </li>
                        <li>
                           <p><a href="oracle-streams-advanced-queueing.html#GUID-F3238A37-C3E0-4C3B-80DB-295ADC73346D">订阅</a></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="LNCPP20426"></a><div class="props_rev_3"><a id="GUID-263CB45B-4476-4892-B972-0DD6B41C2F78" name="GUID-263CB45B-4476-4892-B972-0DD6B41C2F78"></a><h4 id="LNCPP-GUID-263CB45B-4476-4892-B972-0DD6B41C2F78" class="sect4"><span class="enumeration_section">10.2.1</span>消息</h4>
                  <div>
                     <p>消息是插入队列和从队列中检索的基本信息单元。消息由控制信息和有效载荷数据组成。控制信息表示AQ用于管理消息的消息属性。有效载荷数据是存储在队列中的信息，对AQ是透明的。</p>
                     <div class="infoboxnotealso" id="GUID-263CB45B-4476-4892-B972-0DD6B41C2F78__GUID-AE5C2898-B631-4108-B06D-76D1CD432133">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="occi-application-programing-interface.html#GUID-3C824380-073E-4F32-AA6E-928A18D52F4B">OCCI应用程序编程接口中的</a> <a href="message-class.html#GUID-138CFABF-72CE-4BAF-B996-B42C36A55691">消息类</a>文档</p>
                     </div>
                  </div>
               </div><a id="LNCPP20428"></a><a id="LNCPP20427"></a><div class="props_rev_3"><a id="GUID-D51AF7E0-1F48-45DC-B6A1-B15BB14067C9" name="GUID-D51AF7E0-1F48-45DC-B6A1-B15BB14067C9"></a><h4 id="LNCPP-GUID-D51AF7E0-1F48-45DC-B6A1-B15BB14067C9" class="sect4"><span class="enumeration_section">10.2.2</span>代理</h4>
                  <div>
                     <p><code class="codeph">Agent</code>表示并标识队列的用户，消息的生产者或消费者，最终用户或应用程序。<code class="codeph">Agent</code>由名称，地址和协议标识。名称可以由应用程序分配，也可以是应用程序本身。地址根据通信协议确定。如果协议为<code class="codeph">0</code> （默认），则地址的格式为<code class="codeph">[schema.]queuename[@dblink]</code> ，即数据库链接。
                     </p>
                     <p>同一队列上的<code class="codeph">Agent</code>必须具有名称，地址和协议的唯一组合。<a href="oracle-streams-advanced-queueing.html#GUID-D51AF7E0-1F48-45DC-B6A1-B15BB14067C9__BABCBDDA">例10-1</a>演示了客户端程序中新<code class="codeph">Agent</code>对象的实例化。
                     </p>
                     <div class="infoboxnotealso" id="GUID-D51AF7E0-1F48-45DC-B6A1-B15BB14067C9__GUID-C3F0910D-6CB9-42E0-8DE1-D2AC33D88522">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="occi-application-programing-interface.html#GUID-3C824380-073E-4F32-AA6E-928A18D52F4B">OCCI应用程序编程接口中的</a> <a href="agent-class.html#GUID-DD4B0970-353D-41DB-8C43-0024A7575DCA">代理类</a>文档</p>
                     </div>
                     <div class="example" id="GUID-D51AF7E0-1F48-45DC-B6A1-B15BB14067C9__BABCBDDA">
                        <p class="titleinexample">示例10-1创建代理</p><pre class="oac_no_warn" dir="ltr">代理agt（env，“Billing_app”，“billqueue”，0）;</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="LNCPP20429"></a><div class="props_rev_3"><a id="GUID-E69EEAA8-9523-4D1E-83AA-1B6CD4A1406E" name="GUID-E69EEAA8-9523-4D1E-83AA-1B6CD4A1406E"></a><h4 id="LNCPP-GUID-E69EEAA8-9523-4D1E-83AA-1B6CD4A1406E" class="sect4"><span class="enumeration_section">10.2.3</span>制片人</h4>
                  <div>
                     <p>客户端使用<code class="codeph">Producer</code>对象将<code class="codeph">Message</code> s排入队列。它还用于指定各种入队选项。
                     </p>
                     <div class="infoboxnotealso" id="GUID-E69EEAA8-9523-4D1E-83AA-1B6CD4A1406E__GUID-62625942-B005-4505-9B5A-D29CD4DB5131">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="occi-application-programing-interface.html#GUID-3C824380-073E-4F32-AA6E-928A18D52F4B">OCCI应用程序编程接口中的</a> <a href="producer-class.html#GUID-C6324876-EA2C-450A-B003-2FA2D087A560">生产者类</a>文档</p>
                     </div>
                  </div>
               </div><a id="LNCPP20431"></a><a id="LNCPP20430"></a><div class="props_rev_3"><a id="GUID-76B45715-1DF9-413D-AC52-EEB3C3932AA0" name="GUID-76B45715-1DF9-413D-AC52-EEB3C3932AA0"></a><h4 id="LNCPP-GUID-76B45715-1DF9-413D-AC52-EEB3C3932AA0" class="sect4"><span class="enumeration_section">10.2.4</span>消费者</h4>
                  <div>
                     <p>客户端使用<code class="codeph">Consumer</code>对象将已传递到队列的<code class="codeph">Message</code>出列。它还指定了各种出列选项。
                     </p>
                     <p>在消费者可以接收消息之前</p>
                     <div class="infoboxnotealso" id="GUID-76B45715-1DF9-413D-AC52-EEB3C3932AA0__GUID-ACCD7286-F71D-4105-9758-2030DC679E7A">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="occi-application-programing-interface.html#GUID-3C824380-073E-4F32-AA6E-928A18D52F4B">OCCI应用程序编程接口中的</a> <a href="consumer-class.html#GUID-8BD5D6C3-8C06-4D57-85DD-AA903DECB1D4">消费者类</a>文档</p>
                     </div>
                     <div class="example" id="GUID-76B45715-1DF9-413D-AC52-EEB3C3932AA0__GUID-CEE11EF0-5992-44FE-85B1-8E78D475D27E">
                        <p class="titleinexample">示例10-2在使用者上设置代理</p><pre class="oac_no_warn" dir="ltr">消费者利益（conn）; ...cons.setAgent（AG）; cons.receive（）;</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="LNCPP20432"></a><div class="props_rev_3"><a id="GUID-8C7458B6-7B21-46C8-8A70-2EDE510CBD12" name="GUID-8C7458B6-7B21-46C8-8A70-2EDE510CBD12"></a><h4 id="LNCPP-GUID-8C7458B6-7B21-46C8-8A70-2EDE510CBD12" class="sect4"><span class="enumeration_section">10.2.5</span>听众</h4>
                  <div>
                     <p><code class="codeph">Listener</code>在指定的队列中侦听已注册<code class="codeph">Agent</code>的<code class="codeph">Message</code> 。
                     </p>
                     <div class="infoboxnotealso" id="GUID-8C7458B6-7B21-46C8-8A70-2EDE510CBD12__GUID-43176773-6632-4072-8425-CFB8D2585712">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="occi-application-programing-interface.html#GUID-3C824380-073E-4F32-AA6E-928A18D52F4B">OCCI应用程序编程接口中的</a> <a href="listener-class.html#GUID-D3F604C2-F378-4CF7-8631-117CA88D8989">监听器类</a>文档</p>
                     </div>
                  </div>
               </div><a id="LNCPP20433"></a><div class="props_rev_3"><a id="GUID-F3238A37-C3E0-4C3B-80DB-295ADC73346D" name="GUID-F3238A37-C3E0-4C3B-80DB-295ADC73346D"></a><h4 id="LNCPP-GUID-F3238A37-C3E0-4C3B-80DB-295ADC73346D" class="sect4"><span class="enumeration_section">10.2.6</span>订阅</h4>
                  <div>
                     <p><code class="codeph">Subscription</code>封装了注册订阅者通知所需的信息和操作。
                     </p>
                  </div>
               </div>
            </div><a id="LNCPP20434"></a><div class="props_rev_3"><a id="GUID-DF06D106-1A56-49EE-980A-DEA390794E21" name="GUID-DF06D106-1A56-49EE-980A-DEA390794E21"></a><h3 id="LNCPP-GUID-DF06D106-1A56-49EE-980A-DEA390794E21" class="sect3"><span class="enumeration_section">10.3</span>关于创建消息</h3>
               <div>
                  <p>如前所述， <code class="codeph">Message</code>是一个基本的信息单元，它包含消息的属性及其内容或<span class="bold">有效负载</span> 。每条消息都由<code class="codeph">Producer</code>排队，并由<code class="codeph">Consumer</code>对象排队。
                  </p>
                  <div class="p">本节包括以下主题：<ul style="list-style-type:disc">
                        <li>
                           <p><a href="oracle-streams-advanced-queueing.html#GUID-CCB750C3-8706-4EC5-8DF0-A0DA7E6AAEF6">关于消息有效负载</a></p>
                        </li>
                        <li>
                           <p><a href="oracle-streams-advanced-queueing.html#GUID-80AECA53-2449-4FE4-BF21-34BF0672DB7F">消息属性</a></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="LNCPP20435"></a><div class="props_rev_3"><a id="GUID-CCB750C3-8706-4EC5-8DF0-A0DA7E6AAEF6" name="GUID-CCB750C3-8706-4EC5-8DF0-A0DA7E6AAEF6"></a><h4 id="LNCPP-GUID-CCB750C3-8706-4EC5-8DF0-A0DA7E6AAEF6" class="sect4"><span class="enumeration_section">10.3.1</span>关于消息有效负载</h4>
                  <div>
                     <div class="p">OCCI支持三种类型的消息有效负载：<ul style="list-style-type:disc">
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-FEE6018F-2F99-4DB6-A6F7-A315BF4AE414">生的</a></p>
                           </li>
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-DDFF33B8-C746-4CC7-9133-8675C27B4900">AnyDATA公司</a></p>
                           </li>
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-33A776E8-66C0-4B2B-9931-64AAD0031D51">使用用户定义的类型作为有效负载</a></p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="LNCPP20436"></a><div class="props_rev_3"><a id="GUID-FEE6018F-2F99-4DB6-A6F7-A315BF4AE414" name="GUID-FEE6018F-2F99-4DB6-A6F7-A315BF4AE414"></a><h5 id="LNCPP-GUID-FEE6018F-2F99-4DB6-A6F7-A315BF4AE414" class="sect5"><span class="enumeration_section">10.3.1.1</span> RAW</h5>
                     <div>
                        <p><code class="codeph">RAW</code>有效负载被映射为OCCI中<a href="bytes-class.html#GUID-394F58FA-D5CC-472B-8190-0BF92CE52299">字节类的</a>对象。</p>
                     </div>
                  </div><a id="LNCPP20438"></a><a id="LNCPP20439"></a><a id="LNCPP20437"></a><div class="props_rev_3"><a id="GUID-DDFF33B8-C746-4CC7-9133-8675C27B4900" name="GUID-DDFF33B8-C746-4CC7-9133-8675C27B4900"></a><h5 id="LNCPP-GUID-DDFF33B8-C746-4CC7-9133-8675C27B4900" class="sect5"><span class="enumeration_section">10.3.1.2</span> AnyData</h5>
                     <div>
                        <p><code class="codeph">AnyData</code>类型模拟自描述数据封装;它包含类型信息和实际数据值。大多数SQL类型的数据值可以转换为<code class="codeph">AnyData</code> ，然后转换为原始数据类型。<code class="codeph">AnyData</code>还支持用户定义的数据类型。使用<code class="codeph">AnyData</code>有效负载的优点是它确保了在排队和出队过程之后的类型保留，并且它允许用户对应用程序中使用的所有类型使用单个队列。<a href="oracle-streams-advanced-queueing.html#GUID-DDFF33B8-C746-4CC7-9133-8675C27B4900__BABJIIGJ">例10-3</a>演示了如何创建<code class="codeph">AnyData</code>消息。<a href="oracle-streams-advanced-queueing.html#GUID-DDFF33B8-C746-4CC7-9133-8675C27B4900__BABBEEHC">例10-4</a>显示了如何从消息中检索原始数据类型。
                        </p>
                        <div class="example" id="GUID-DDFF33B8-C746-4CC7-9133-8675C27B4900__BABJIIGJ">
                           <p class="titleinexample">示例10-3使用字符串有效负载创建AnyData消息</p><pre class="oac_no_warn" dir="ltr">AnyData any（conn）; any.setFromString（ “ITEM1”）;消息mes（env）; mes.setAnyData（任意）;</pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-DDFF33B8-C746-4CC7-9133-8675C27B4900__BABBEEHC">
                           <p class="titleinexample">示例10-4确定AnyData消息中的有效负载类型</p><pre class="oac_no_warn" dir="ltr">TypeCode tc = any.getType（）;</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="LNCPP20441"></a><a id="LNCPP20440"></a><div class="props_rev_3"><a id="GUID-33A776E8-66C0-4B2B-9931-64AAD0031D51" name="GUID-33A776E8-66C0-4B2B-9931-64AAD0031D51"></a><h5 id="LNCPP-GUID-33A776E8-66C0-4B2B-9931-64AAD0031D51" class="sect5"><span class="enumeration_section">10.3.1.3</span>使用用户定义的类型作为有效<span class="enumeration_section">负载</span></h5>
                     <div>
                        <div class="section">
                           <p>OCCI支持将用户定义类型作为有效负载排队和出列。<a href="oracle-streams-advanced-queueing.html#GUID-33A776E8-66C0-4B2B-9931-64AAD0031D51__BABBGFDC">示例10-5</a>演示了如何使用用户定义的<code class="codeph">Employee</code>对象创建有效内容。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-33A776E8-66C0-4B2B-9931-64AAD0031D51__BABBGFDC">
                           <p class="titleinexample">示例10-5创建用户定义的有效负载</p><pre class="oac_no_warn" dir="ltr">//假设类型为Employee（名称为varchar2（25），// deptid number（10），// manager varchar2（25））Employee * emp = new Employee（）; emp.setName（ “斯科特”）; emp.setDeptid（10）; emp.setManager（ “詹姆斯”）;消息mes（env）; mes.setObject（EMP）;</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div><a id="LNCPP20442"></a><div class="props_rev_3"><a id="GUID-80AECA53-2449-4FE4-BF21-34BF0672DB7F" name="GUID-80AECA53-2449-4FE4-BF21-34BF0672DB7F"></a><h4 id="LNCPP-GUID-80AECA53-2449-4FE4-BF21-34BF0672DB7F" class="sect4"><span class="enumeration_section">10.3.2</span>消息属性</h4>
                  <div>
                     <div class="p">除了有效负载之外，用户还可以指定其他几个消息属性，例如：<ul style="list-style-type:disc">
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-1443AFED-1A63-4C86-B3D8-8B083D84CA35">关联</a></p>
                           </li>
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-6AA29BF9-D531-483F-B3C5-83E6369B3787">寄件人</a></p>
                           </li>
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-0DCB1659-7B7B-4083-9886-03279E9F9ECA">延迟和到期</a></p>
                           </li>
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-A9FFAA5C-FD8E-42E0-8BA5-689E759D7DCF">收件人</a></p>
                           </li>
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-628C72AE-375A-4087-AED8-E78034E04DE3">优先顺序和订购</a></p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="LNCPP20444"></a><a id="LNCPP20443"></a><div class="props_rev_3"><a id="GUID-1443AFED-1A63-4C86-B3D8-8B083D84CA35" name="GUID-1443AFED-1A63-4C86-B3D8-8B083D84CA35"></a><h5 id="LNCPP-GUID-1443AFED-1A63-4C86-B3D8-8B083D84CA35" class="sect5"><span class="enumeration_section">10.3.2.1</span>相关性</h5>
                     <div>
                        <p>应用程序可以在排队过程中指定消息的相关标识符，如<a href="oracle-streams-advanced-queueing.html#GUID-1443AFED-1A63-4C86-B3D8-8B083D84CA35__BABDEDEI">例10-6所示</a> 。然后，该标识符可以由出列应用程序使用。
                        </p>
                        <div class="example" id="GUID-1443AFED-1A63-4C86-B3D8-8B083D84CA35__BABDEDEI">
                           <p class="titleinexample">示例10-6指定关联标识符</p><pre class="oac_no_warn" dir="ltr">mes.setCorrelationId（ “enq_corr_di”）;</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="LNCPP20446"></a><a id="LNCPP20445"></a><div class="props_rev_3"><a id="GUID-6AA29BF9-D531-483F-B3C5-83E6369B3787" name="GUID-6AA29BF9-D531-483F-B3C5-83E6369B3787"></a><h5 id="LNCPP-GUID-6AA29BF9-D531-483F-B3C5-83E6369B3787" class="sect5"><span class="enumeration_section">10.3.2.2</span>发件人</h5>
                     <div>
                        <p>应用程序可以指定消息的发送方，如<a href="oracle-streams-advanced-queueing.html#GUID-6AA29BF9-D531-483F-B3C5-83E6369B3787__BABCCAGF">例10-7所示</a> 。然后，发送者标识符可以由消息的接收者使用。
                        </p>
                        <div class="example" id="GUID-6AA29BF9-D531-483F-B3C5-83E6369B3787__BABCCAGF">
                           <p class="titleinexample">示例10-7指定发件人标识符</p><pre class="oac_no_warn" dir="ltr">mes.setSenderId（AGT）;</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="LNCPP20448"></a><a id="LNCPP20447"></a><div class="props_rev_3"><a id="GUID-0DCB1659-7B7B-4083-9886-03279E9F9ECA" name="GUID-0DCB1659-7B7B-4083-9886-03279E9F9ECA"></a><h5 id="LNCPP-GUID-0DCB1659-7B7B-4083-9886-03279E9F9ECA" class="sect5"><span class="enumeration_section">10.3.2.3</span>延迟和到期</h5>
                     <div>
                        <p>时间设置以秒为单位控制消息的延迟和到期时间，如<a href="oracle-streams-advanced-queueing.html#GUID-0DCB1659-7B7B-4083-9886-03279E9F9ECA__BABDCBFB">例10-8所示</a> 。
                        </p>
                        <div class="example" id="GUID-0DCB1659-7B7B-4083-9886-03279E9F9ECA__BABDCBFB">
                           <p class="titleinexample">示例10-8指定消息的延迟和到期时间</p><pre class="oac_no_warn" dir="ltr">mes.setDelay（10）; mes.setExpirationTime（60）;</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="LNCPP20450"></a><a id="LNCPP20449"></a><div class="props_rev_3"><a id="GUID-A9FFAA5C-FD8E-42E0-8BA5-689E759D7DCF" name="GUID-A9FFAA5C-FD8E-42E0-8BA5-689E759D7DCF"></a><h5 id="LNCPP-GUID-A9FFAA5C-FD8E-42E0-8BA5-689E759D7DCF" class="sect5"><span class="enumeration_section">10.3.2.4</span>收件人</h5>
                     <div>
                        <p>可以在消息编码期间指定消息所针对的代理，如<a href="oracle-streams-advanced-queueing.html#GUID-A9FFAA5C-FD8E-42E0-8BA5-689E759D7DCF__BABCHFIA">例10-9所示</a> 。这可确保只有指定的收件人才能访问该邮件。
                        </p>
                        <div class="example" id="GUID-A9FFAA5C-FD8E-42E0-8BA5-689E759D7DCF__BABCHFIA">
                           <p class="titleinexample">示例10-9指定邮件收件人</p><pre class="oac_no_warn" dir="ltr">vector &lt;Agent&gt; agt_list; for（i = 0; i &lt;num_recipients; i ++）agt_list.push_back（代理（名称，地址，协议））; mes.setRecipientList（agt_list）;</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="LNCPP20452"></a><a id="LNCPP20451"></a><div class="props_rev_3"><a id="GUID-628C72AE-375A-4087-AED8-E78034E04DE3" name="GUID-628C72AE-375A-4087-AED8-E78034E04DE3"></a><h5 id="LNCPP-GUID-628C72AE-375A-4087-AED8-E78034E04DE3" class="sect5"><span class="enumeration_section">10.3.2.5</span>优先顺序和订购</h5>
                     <div>
                        <p>通过为消息分配优先级，发送方可以控制消息由接收方出列的顺序。<a href="oracle-streams-advanced-queueing.html#GUID-628C72AE-375A-4087-AED8-E78034E04DE3__BABHJGCG">例10-10</a>演示了如何设置消息的优先级。
                        </p>
                        <div class="example" id="GUID-628C72AE-375A-4087-AED8-E78034E04DE3__BABHJGCG">
                           <p class="titleinexample">示例10-10指定消息的优先级</p><pre class="oac_no_warn" dir="ltr">mes.setPriority（3）;</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div>
            </div><a id="LNCPP20454"></a><a id="LNCPP20453"></a><div class="props_rev_3"><a id="GUID-CCA3666A-DC8A-44FB-B062-1226015BC985" name="GUID-CCA3666A-DC8A-44FB-B062-1226015BC985"></a><h3 id="LNCPP-GUID-CCA3666A-DC8A-44FB-B062-1226015BC985" class="sect3"><span class="enumeration_section">10.4</span>排队消息</h3>
               <div>
                  <div class="section">
                     <p>消息由Producer排队。<a href="producer-class.html#GUID-C6324876-EA2C-450A-B003-2FA2D087A560">Producer类</a>还用于指定入队选项。可以在执行入队的有效连接上创建<code class="codeph">Producer</code>对象，如<a href="oracle-streams-advanced-queueing.html#GUID-CCA3666A-DC8A-44FB-B062-1226015BC985__BABJABDC">例10-11所示</a> 。
                     </p>
                     <p>可以基于应用程序要求来定义入队操作的事务行为。应用程序可以使排队操作的效果在完成之后立即在外部可见，如<a href="oracle-streams-advanced-queueing.html#GUID-CCA3666A-DC8A-44FB-B062-1226015BC985__BABJABDC">例10-11所示</a> ，或者仅在提交封闭事务之后。
                     </p>
                     <p>要将消息排入队列，请使用<code class="codeph">send()</code>方法，如<a href="oracle-streams-advanced-queueing.html#GUID-CCA3666A-DC8A-44FB-B062-1226015BC985__BABJABDC">例10-11所示</a> 。客户端可以在发送<code class="codeph">Message</code>对象后对其进行保留，修改并再次发送。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-CCA3666A-DC8A-44FB-B062-1226015BC985__BABJABDC">
                     <p class="titleinexample">示例10-11创建生产者，设置可见性和排队消息</p><pre class="oac_no_warn" dir="ltr">制片人prod（conn）; ...prod.setVisibility（监制:: ENQ_IMMEDIATE）; ...消息mes（env）; ...mes.setBytes（OBJ）; // obj表示消息prod.send（mes，queueName）的内容; // queueName是队列的名称</pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="LNCPP20456"></a><a id="LNCPP20457"></a><a id="LNCPP20455"></a><div class="props_rev_3"><a id="GUID-E7FEEE76-4001-4EDD-8922-0E5B20CBE8E8" name="GUID-E7FEEE76-4001-4EDD-8922-0E5B20CBE8E8"></a><h3 id="LNCPP-GUID-E7FEEE76-4001-4EDD-8922-0E5B20CBE8E8" class="sect3"><span class="enumeration_section">10.5出</span>列消息</h3>
               <div>
                  <div class="section">
                     <p>发送到队列的消息由<code class="codeph">Consumer</code>消隐。<a href="consumer-class.html#GUID-8BD5D6C3-8C06-4D57-85DD-AA903DECB1D4">Consumer Class</a>还用于指定出列选项。可以在与存在队列的数据库的有效连接上创建<code class="codeph">Consumer</code>对象，如<a href="oracle-streams-advanced-queueing.html#GUID-E7FEEE76-4001-4EDD-8922-0E5B20CBE8E8__BABIDDIB">例10-12所示</a> 。
                     </p>
                     <p>在支持同一队列中的多个使用者的应用程序中，必须将使用者的名称指定为队列的注册订阅者，如<a href="oracle-streams-advanced-queueing.html#GUID-E7FEEE76-4001-4EDD-8922-0E5B20CBE8E8__BABIDDIB">例10-12</a>所示。
                     </p>
                     <p>要使消息出列，请使用<code class="codeph">receive()</code>方法，如<a href="oracle-streams-advanced-queueing.html#GUID-E7FEEE76-4001-4EDD-8922-0E5B20CBE8E8__BABIDDIB">例10-12所示</a> 。<code class="codeph">receive()</code>方法的<code class="codeph">typeName</code>和<code class="codeph">schemaName</code>参数指定有效负载的类型和有效负载类型的模式。
                     </p>
                     <p>当队列有效内容类型为<a href="oracle-streams-advanced-queueing.html#GUID-FEE6018F-2F99-4DB6-A6F7-A315BF4AE414">RAW</a>或<a href="oracle-streams-advanced-queueing.html#GUID-DDFF33B8-C746-4CC7-9133-8675C27B4900">AnyData时</a> ， <code class="codeph">schemaName</code>和<code class="codeph">typeName</code>是可选的，但在使用用户定义的有效负载时，必须显式指定这些参数。这在<a href="oracle-streams-advanced-queueing.html#GUID-E7FEEE76-4001-4EDD-8922-0E5B20CBE8E8__BABICACA">例10-13中</a>说明。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-E7FEEE76-4001-4EDD-8922-0E5B20CBE8E8__BABIDDIB">
                     <p class="titleinexample">示例10-12创建使用者，命名使用者和接收消息</p><pre class="oac_no_warn" dir="ltr">消费者利益（conn）; ...//必须通过管理界面cons.setConsumerName（“BillApp”）向队列注册名称; cons.setQueueName（QUEUENAME）; ...消息mes = cons.receive（Message :: OBJECT，“BILL_TYPE”，“BILL_PROCESSOR”）; ...// obj被赋予消息内容obj = mes.getObject（）;</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-E7FEEE76-4001-4EDD-8922-0E5B20CBE8E8__BABICACA">
                     <p class="titleinexample">例10-13接收消息</p><pre class="oac_no_warn" dir="ltr">//接收RAW消息消息mes = cons.receive（Message :: RAW）; ...//接收ANYDATA消息消息mes = cons.receive（Message :: ANYDATA）; ...
</pre></div>
                  <!-- class="example" -->
                  <div class="section">本节包括以下主题： <a href="oracle-streams-advanced-queueing.html#GUID-FD4CEEC3-B10A-4175-BEAE-3BBBF800E9DB">关于出列选项</a> 。
                  </div>
                  <!-- class="section" -->
               </div><a id="LNCPP20458"></a><div class="props_rev_3"><a id="GUID-FD4CEEC3-B10A-4175-BEAE-3BBBF800E9DB" name="GUID-FD4CEEC3-B10A-4175-BEAE-3BBBF800E9DB"></a><h4 id="LNCPP-GUID-FD4CEEC3-B10A-4175-BEAE-3BBBF800E9DB" class="sect4"><span class="enumeration_section">10.5.1</span>关于出列选项</h4>
                  <div>
                     <div class="p">出列应用程序可以在开始接收消息之前指定多个出列选项。这些包括：<ul style="list-style-type:disc">
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-BF63AFF1-149D-4EA8-A161-F32067FDF1B5">关联</a></p>
                           </li>
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-C27BAA95-F06F-4E61-84E6-EC9C4199AF32">模式</a></p>
                           </li>
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-9E8A9D24-B28D-41BE-9C69-E5B5D3498D47">导航</a></p>
                           </li>
                        </ul> 
                     </div>
                  </div><a id="LNCPP20459"></a><div class="props_rev_3"><a id="GUID-BF63AFF1-149D-4EA8-A161-F32067FDF1B5" name="GUID-BF63AFF1-149D-4EA8-A161-F32067FDF1B5"></a><h5 id="LNCPP-GUID-BF63AFF1-149D-4EA8-A161-F32067FDF1B5" class="sect5"><span class="enumeration_section">10.5.1.1</span>相关性</h5>
                     <div>
                        <p>可以使用<code class="codeph">setCorrelationId()</code>方法根据其相关标识符的值将消息出列，如<a href="oracle-streams-advanced-queueing.html#GUID-9E8A9D24-B28D-41BE-9C69-E5B5D3498D47__BABIABHI">例10-14</a>所示。
                        </p>
                     </div>
                  </div><a id="LNCPP20460"></a><div class="props_rev_3"><a id="GUID-C27BAA95-F06F-4E61-84E6-EC9C4199AF32" name="GUID-C27BAA95-F06F-4E61-84E6-EC9C4199AF32"></a><h5 id="LNCPP-GUID-C27BAA95-F06F-4E61-84E6-EC9C4199AF32" class="sect5"><span class="enumeration_section">10.5.1.2</span>模式</h5>
                     <div>
                        <p>根据应用程序要求，用户可以选择仅浏览队列中的消息，从队列中删除消息，或使用<code class="codeph">setDequeueMode()</code>方法锁定消息，如<a href="oracle-streams-advanced-queueing.html#GUID-9E8A9D24-B28D-41BE-9C69-E5B5D3498D47__BABIABHI">例10-14</a>所示。
                        </p>
                     </div>
                  </div><a id="LNCPP20462"></a><a id="LNCPP20461"></a><div class="props_rev_3"><a id="GUID-9E8A9D24-B28D-41BE-9C69-E5B5D3498D47" name="GUID-9E8A9D24-B28D-41BE-9C69-E5B5D3498D47"></a><h5 id="LNCPP-GUID-9E8A9D24-B28D-41BE-9C69-E5B5D3498D47" class="sect5"><span class="enumeration_section">10.5.1.3</span>导航</h5>
                     <div>
                        <p>通过实现<code class="codeph">setPositionOfMessage()</code>方法，可以将单个事务中排队的消息视为单个组，如<a href="oracle-streams-advanced-queueing.html#GUID-9E8A9D24-B28D-41BE-9C69-E5B5D3498D47__BABIABHI">例10-14</a>所示。
                        </p>
                        <div class="example" id="GUID-9E8A9D24-B28D-41BE-9C69-E5B5D3498D47__BABIABHI">
                           <p class="titleinexample">示例10-14指定出列选项</p><pre class="oac_no_warn" dir="ltr">cons.setCorrelationId（走廊里）; ...cons.setDequeueMode（deqMode）; ...cons.setPositionOfMessage（消费者:: DEQ_NEXT_TRANSACTION）;</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div>
            </div><a id="LNCPP20464"></a><a id="LNCPP20463"></a><div class="props_rev_3"><a id="GUID-DD67A071-D1EC-43F5-9252-949DE4319821" name="GUID-DD67A071-D1EC-43F5-9252-949DE4319821"></a><h3 id="LNCPP-GUID-DD67A071-D1EC-43F5-9252-949DE4319821" class="sect3"><span class="enumeration_section">10.6</span>听取消息</h3>
               <div>
                  <div class="section">
                     <p>监听器代表其注册的客户端侦听队列上的消息。<a href="listener-class.html#GUID-D3F604C2-F378-4CF7-8631-117CA88D8989">Listener类</a>实现<code class="codeph">listen()</code>方法，该方法是一个阻塞调用，当队列有注册代理的消息时返回，或者在超时期限到期时抛出错误。<a href="oracle-streams-advanced-queueing.html#GUID-DD67A071-D1EC-43F5-9252-949DE4319821__BABJJHGH">例10-15</a>说明了监听协议。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-DD67A071-D1EC-43F5-9252-949DE4319821__BABJJHGH">
                     <p class="titleinexample">示例10-15收听消息</p><pre class="oac_no_warn" dir="ltr">听众听众（conn）; vector &lt;Agent&gt; agtList; for（int i = 0; i &lt;num_agents; i ++）agtList.push_back（Agent（name，address，protocol）; listener.setAgentList（agtList）; listener.setTimeOutForListen（10）; agent agt（env）; try {agt = listener.listen（）;} catch {cout &lt;&lt; e.getMessage（）&lt;&lt; endl;}</pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="LNCPP20465"></a><div class="props_rev_3"><a id="GUID-956BDB8B-86B6-414F-8531-5599D66510FA" name="GUID-956BDB8B-86B6-414F-8531-5599D66510FA"></a><h3 id="LNCPP-GUID-956BDB8B-86B6-414F-8531-5599D66510FA" class="sect3"><span class="enumeration_section">10.7</span>关于注册通知</h3>
               <div>
                  <p><a href="subscription-class.html#GUID-5183EF2D-D831-4A29-892B-7DDB34701339">订阅类</a>实现发布 - 订阅通知功能。它允许OCCI AQ应用程序直接接收客户端通知，注册可以发送通知的电子邮件地址，注册可以发布通知的HTTP URL，或者注册要在通知上调用的PL / SQL过程。触发事件时或在显式AQ队列中异步通知已注册的客户端。客户端不必连接到数据库。
                  </p>
                  <p>OCCI应用程序可以执行以下所有操作：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>在AQ名称空间中注册对通知的兴趣，并在发生入队时通知。</p>
                     </li>
                     <li>
                        <p>注册对数据库事件订阅的兴趣，并在触发这些事件时接收通知。</p>
                     </li>
                     <li>
                        <p>管理注册，例如暂时禁用注册或完全删除注册。</p>
                     </li>
                     <li>
                        <p>向注册客户发布（或发送）通知。</p>
                     </li>
                  </ul>
                  <div class="p">本节包括以下主题：<ul style="list-style-type:disc">
                        <li>
                           <p><a href="oracle-streams-advanced-queueing.html#GUID-BF37AB9C-A8FE-4E42-95F5-BB89DB0FA4A0">发布 - 订阅通知</a></p>
                        </li>
                        <li>
                           <p><a href="oracle-streams-advanced-queueing.html#GUID-2949A76A-680E-481B-AE66-0E8F184199D3">关于消息格式转换</a></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="LNCPP20466"></a><div class="props_rev_3"><a id="GUID-BF37AB9C-A8FE-4E42-95F5-BB89DB0FA4A0" name="GUID-BF37AB9C-A8FE-4E42-95F5-BB89DB0FA4A0"></a><h4 id="LNCPP-GUID-BF37AB9C-A8FE-4E42-95F5-BB89DB0FA4A0" class="sect4"><span class="enumeration_section">10.7.1</span>发布 - 订阅通知</h4>
                  <div>
                     <p>通知可以以多种方式工作。他们可以：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>由OCCI申请直接收到</p>
                        </li>
                        <li>
                           <p>发送到预先指定的电子邮件地址</p>
                        </li>
                        <li>
                           <p>发送到预定义的HTTP URL</p>
                        </li>
                        <li>
                           <p>调用预先指定的数据库PL / SQL过程</p>
                        </li>
                     </ul>
                     <div class="p">触发事件时，或在显式AQ队列上异步通知已注册的客户端。客户端不必连接到数据库以使通知正常工作。注册可以完成如下：<ul style="list-style-type:disc">
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-E1FD90EA-5E64-4BD3-8C8E-B753B15DAD3C">如何使用直接注册</a></p>
                           </li>
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-FDCA6B2A-C784-4360-BF89-2239E23F0D4F">使用开放注册</a></p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="LNCPP20468"></a><a id="LNCPP20467"></a><div class="props_rev_3"><a id="GUID-E1FD90EA-5E64-4BD3-8C8E-B753B15DAD3C" name="GUID-E1FD90EA-5E64-4BD3-8C8E-B753B15DAD3C"></a><h5 id="LNCPP-GUID-E1FD90EA-5E64-4BD3-8C8E-B753B15DAD3C" class="sect5"><span class="enumeration_section">10.7.1.1</span>如何使用直接注册</h5>
                     <div>
                        <div class="section">
                           <p>您可以直接在数据库中注册。这相对简单，注册立即生效。<a href="oracle-streams-advanced-queueing.html#GUID-E1FD90EA-5E64-4BD3-8C8E-B753B15DAD3C__BABHDBCF">例10-16</a>概述了成功注册直接事件通知所需的步骤。假设存在适当的事件触发器或队列，并且初始化参数<code class="codeph">COMPATIBLE</code>被设置为<code class="codeph">8.1</code>或更高。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-E1FD90EA-5E64-4BD3-8C8E-B753B15DAD3C__BABHDBCF">
                           <p class="titleinexample">例10-16如何注册通知;直接注册</p>
                           <ol>
                              <li>
                                 <p>在<code class="codeph">Environment::EVENTS</code>模式下创建环境。
                                 </p>
                              </li>
                              <li>
                                 <p>创建<code class="codeph">Subscription</code>对象。
                                 </p>
                              </li>
                              <li>
                                 <p>设置这些<code class="codeph">Subscription</code>属性。
                                 </p>
                                 <p><code class="codeph">namespace</code>可以设置为以下选项：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>要从AQ队列接收通知，必须将<code class="codeph">namespace</code>设置为<code class="codeph">Subscription::NS_AQ</code> 。在单个使用者队列上注册时，订阅名称可以是<code class="codeph">SCHEMA.QUEUE</code>格式，也可以是在多队列队列上注册时的<code class="codeph">SCHEMA.QUEUE:</code> <span class="italic"><code class="codeph">CONSUMER_NAME</code></span> 。
                                       </p>
                                    </li>
                                    <li>
                                       <p>要从其他使用<code class="codeph">conn-&gt;postToSubscription()</code>方法的应用程序接收通知，必须将<code class="codeph">namespace</code>设置为<code class="codeph">Subscription::NS_ANONYMOUS</code></p>
                                    </li>
                                 </ul>
                                 <p><code class="codeph">protocol</code>可以设置为以下选项：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>如果OCCI客户端必须接收事件通知，则应将此属性设置为<code class="codeph">Subscription::PROTO_CBK</code> 。您还必须在注册<code class="codeph">Subscription</code>之前设置通知回调和订阅上下文。事件发生时会调用通知回调。
                                       </p>
                                    </li>
                                    <li>
                                       <p>对于电子邮件通知，请将协议设置为<code class="codeph">Subscription::PROTO_MAIL</code> 。您必须在订阅之前设置收件人名称以避免应用程序错误。
                                       </p>
                                    </li>
                                    <li>
                                       <p>对于HTTP URL通知，请将协议设置为<code class="codeph">Subscription::HTTP</code> 。您必须在订阅之前设置收件人名称以避免应用程序错误。
                                       </p>
                                    </li>
                                    <li>
                                       <p>要在事件通知中调用数据库中的PL / SQL过程，请将protocol设置为<code class="codeph">Subscription::PROTO_SERVER</code> 。您必须在订阅之前设置收件人名称以避免应用程序错误。
                                       </p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>使用<code class="codeph">connection-&gt;registerSubscriptions()</code>注册订阅。
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="LNCPP20470"></a><a id="LNCPP20469"></a><div class="props_rev_2"><a id="GUID-FDCA6B2A-C784-4360-BF89-2239E23F0D4F" name="GUID-FDCA6B2A-C784-4360-BF89-2239E23F0D4F"></a><h5 id="LNCPP-GUID-FDCA6B2A-C784-4360-BF89-2239E23F0D4F" class="sect5"><span class="enumeration_section">10.7.1.2</span>使用开放注册</h5>
                     <div>
                        <div class="section">
                           <p>您还可以通过将注册请求发送到数据库的中间LDAP进行注册。当客户端无法建立直接数据库连接时使用此选项;例如，客户端希望在数据库关闭时注册打开事件。当客户想要同时在多个数据库中注册相同的事件时，也使用这种方法。</p>
                           <p><a href="oracle-streams-advanced-queueing.html#GUID-FDCA6B2A-C784-4360-BF89-2239E23F0D4F__BABBIBJJ">例10-17</a>概述了使用Oracle Enterprise Security Manager（OESM）进行的LDAP打开注册。开放注册具有以下先决条件：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>客户端必须是企业用户</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>在每个企业域中，创建企业角色<code class="codeph">ENTERPRISE_AQ_USER_ROLE</code></p>
                                    </li>
                                    <li>
                                       <p>对于企业域中的每个数据库，将全局角色<code class="codeph">GLOBAL_AQ_USER_ROLE</code>添加到企业角色<code class="codeph">ENTERPRISE_AQ_USER_ROLE</code> 。</p>
                                    </li>
                                    <li>
                                       <p>对于每个企业域，在管理上下文中的<code class="codeph">cn=oraclecontext</code>下将企业角色<code class="codeph">ENTERPRISE_AQ_USER_ROLE</code>添加到权限组<code class="codeph">cn=OracleDBAQUsers</code></p>
                                    </li>
                                    <li>
                                       <p>对于有权在数据库中注册事件的每个企业用户，授予企业角色<code class="codeph">ENTERPRISE_AQ_USER_ROLE</code></p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>数据库的兼容性必须为9.0或更高</p>
                              </li>
                              <li>
                                 <p><code class="codeph">LDAP_REGISTRATION_ENABLED</code>必须设置为<code class="codeph">TRUE</code> （默认值为<code class="codeph">FALSE</code> ）：</p><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM SET LDAP_REGISTRATION_ENABLED = TRUE</pre></li>
                              <li>
                                 <p>必须将<code class="codeph">LDAP_REG_SYNC_INTERVAL</code>设置为<code class="codeph">time_interval</code> （以秒为单位）才能刷新LDAP的注册（默认为<code class="codeph">0</code> ，不刷新）：</p><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM SET LDAP_REG_SYNC_INTERVAL = time_interval</pre></li>
                           </ul>
                           <p>要立即强制数据库刷新LDAP注册信息，请发出以下命令：</p><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM刷新LDAP_REGISTRATION</pre><p>当数据库访问LDAP以获取新注册时，开放注册将生效。拾取频率由<code class="codeph">REG_SYNC_INTERVAL</code>的值<code class="codeph">REG_SYNC_INTERVAL</code> 。</p>
                           <p>客户端可以暂时禁用订阅，重新启用订阅，或从将来的通知中永久取消注册。</p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-FDCA6B2A-C784-4360-BF89-2239E23F0D4F__BABBIBJJ">
                           <p class="titleinexample">示例10-17如何使用LDAP进行开放式注册</p>
                           <ol>
                              <li>
                                 <p>在<code class="codeph">Environment::EVENTS|Environment::USE_LDAP</code>模式下创建环境。
                                 </p>
                              </li>
                              <li>
                                 <p>设置用于访问LDAP的<code class="codeph">Environment</code>对象：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>LDAP服务器驻留和侦听的主机和端口</p>
                                    </li>
                                    <li>
                                       <p>认证方法;目前仅支持简单的用户名和密码验证</p>
                                    </li>
                                    <li>
                                       <p>用于LDAP服务器身份验证的用户名（可分辨名称）和密码</p>
                                    </li>
                                    <li>
                                       <p>LDAP服务器中Oracle的管理上下文</p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>创建<code class="codeph">Subscription</code>对象。
                                 </p>
                              </li>
                              <li>
                                 <p>设置客户端希望在<code class="codeph">Subscription</code>对象上接收通知的数据库的可分辨名称。
                                 </p>
                              </li>
                              <li>
                                 <p>设置这些<code class="codeph">Subscription</code>属性。
                                 </p>
                                 <p><code class="codeph">namespace</code>可以设置为以下选项：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>要从AQ队列接收通知，必须将<code class="codeph">namespace</code>设置为<code class="codeph">Subscription::NS_AQ</code> 。在单个使用者队列上注册时，订阅名称可以是<code class="codeph">SCHEMA.QUEUE</code>格式，也可以是在多队列队列上注册时的<code class="codeph">SCHEMA.QUEUE:</code> <span class="italic"><code class="codeph">CONSUMER_NAME</code></span> 。
                                       </p>
                                    </li>
                                    <li>
                                       <p>要从其他使用<code class="codeph">conn-&gt;postToSubscription()</code>方法的应用程序接收通知，必须将<code class="codeph">namespace</code>设置为<code class="codeph">Subscription::NS_ANONYMOUS</code></p>
                                    </li>
                                 </ul>
                                 <p><code class="codeph">protocol</code>可以设置为以下选项：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>如果OCCI客户端必须接收事件通知，则应将此属性设置为<code class="codeph">Subscription::PROTO_CBK</code> 。您还必须在注册<code class="codeph">Subscription</code>之前设置通知回调和订阅上下文。事件发生时会调用通知回调。
                                       </p>
                                    </li>
                                    <li>
                                       <p>对于电子邮件通知，请将协议设置为<code class="codeph">Subscription::PROTO_MAIL</code> 。然后，您必须将收件人名称设置为必须将通知发送到的电子邮件地址。
                                       </p>
                                    </li>
                                    <li>
                                       <p>对于HTTP URL通知，请将协议设置为<code class="codeph">Subscription::HTTP</code> 。您必须将收件人名称设置为必须将通知发布到的URL。
                                       </p>
                                    </li>
                                    <li>
                                       <p>要在事件通知中调用数据库中的PL / SQL过程，请将protocol设置为<code class="codeph">Subscription::PROTO_SERVER</code> 。您必须将收件人名称设置为通知时调用的数据库过程。
                                       </p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>注册订阅： <code class="codeph">environment-&gt;registerSubscriptions()</code> 。
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div><a id="LNCPP20472"></a><a id="LNCPP20471"></a><div class="props_rev_3"><a id="GUID-EB87993D-5649-4B73-AD24-6382DA1F8DAB" name="GUID-EB87993D-5649-4B73-AD24-6382DA1F8DAB"></a><h4 id="LNCPP-GUID-EB87993D-5649-4B73-AD24-6382DA1F8DAB" class="sect4"><span class="enumeration_section">10.7.2</span>关于通知回调</h4>
                  <div>
                     <p>客户端必须注册通知回调。仅当已注册订阅上存在某些活动时，才会调用此回调。在Database AQ命名空间中，当感兴趣的消息入队时会发生这种情况。</p>
                     <p>回调必须返回<code class="codeph">0</code> ，并且必须具有以下规范：</p><pre class="oac_no_warn" dir="ltr">typedef unsigned int（* callbackfn）（Subscription＆sub，NotifyResult * nr）;</pre><p>哪里：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">sub</code>参数是在注册回调时使用的<code class="codeph">Subscription</code>对象。
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">nr</code>参数是保存通知信息的<code class="codeph">NotifyResult</code>对象。
                           </p>
                        </li>
                     </ul>
                     <p>确保用于注册通知的订阅对象在明确取消注册订阅之前不会被销毁。</p>
                     <p>用户可以从<code class="codeph">NotifyResult</code>对象中检索有效负载，消息，消息ID，队列名称和使用者名称，具体取决于通知源。这些结果总结在<a href="oracle-streams-advanced-queueing.html#GUID-EB87993D-5649-4B73-AD24-6382DA1F8DAB__BABFAACC" title="该表有4列。第1列是通知结果属性，第2列是ANONYMOUS命名空间，第3列是针对具有持久队列的AQ命名空间，第4列是针对非持久队列的AQ命名空间。">表10-1中</a> 。当前仅支持一个字节有效负载，您必须显式地从AQ名称空间中的持久队列中出列消息。如果通知来自非持久性队列，则消息可直接用于回调;仅支持<code class="codeph">RAW</code>有效负载。如果通知来自持久队列，则必须明确地将消息出列;支持所有有效负载类型。
                     </p>
                     <div class="tblformal" id="GUID-EB87993D-5649-4B73-AD24-6382DA1F8DAB__BABFAACC">
                        <p class="titleintable">表10-1通知结果属性; ANONYMOUS和AQ命名空间</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="通知结果属性; ANONYMOUS和AQ命名空间" width="100%" border="1" summary="This table has 4 columns. Column 1 is the Notification Result attributes, column 2 is for ANONYMOUS namespace, column 3 is for AQ namespace with persistent queues, and column 4 is for AQ namespace for non-persistent queues." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="23%" id="d72225e3052">通知结果属性</th>
                                 <th align="left" valign="bottom" width="21%" id="d72225e3055">ANONYMOUS命名空间</th>
                                 <th align="left" valign="bottom" width="21%" id="d72225e3058">AQ命名空间，持久队列</th>
                                 <th align="left" valign="bottom" width="35%" id="d72225e3061">AQ命名空间，非持久队列</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d72225e3066" headers="d72225e3052 ">
                                    <p>有效载荷</p>
                                 </td>
                                 <td align="left" valign="top" width="21%" headers="d72225e3066 d72225e3055 ">
                                    <p>有效</p>
                                 </td>
                                 <td align="left" valign="top" width="21%" headers="d72225e3066 d72225e3058 ">
                                    <p>无效</p>
                                 </td>
                                 <td align="left" valign="top" width="35%" headers="d72225e3066 d72225e3061 ">
                                    <p>无效</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d72225e3079" headers="d72225e3052 ">
                                    <p>信息</p>
                                 </td>
                                 <td align="left" valign="top" width="21%" headers="d72225e3079 d72225e3055 ">
                                    <p>无效</p>
                                 </td>
                                 <td align="left" valign="top" width="21%" headers="d72225e3079 d72225e3058 ">
                                    <p>无效</p>
                                 </td>
                                 <td align="left" valign="top" width="35%" headers="d72225e3079 d72225e3061 ">
                                    <p>有效</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d72225e3092" headers="d72225e3052 ">
                                    <p>MESSAGEID</p>
                                 </td>
                                 <td align="left" valign="top" width="21%" headers="d72225e3092 d72225e3055 ">
                                    <p>无效</p>
                                 </td>
                                 <td align="left" valign="top" width="21%" headers="d72225e3092 d72225e3058 ">
                                    <p>有效</p>
                                 </td>
                                 <td align="left" valign="top" width="35%" headers="d72225e3092 d72225e3061 ">
                                    <p>有效</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d72225e3105" headers="d72225e3052 ">
                                    <p>消费者名称</p>
                                 </td>
                                 <td align="left" valign="top" width="21%" headers="d72225e3105 d72225e3055 ">
                                    <p>无效</p>
                                 </td>
                                 <td align="left" valign="top" width="21%" headers="d72225e3105 d72225e3058 ">
                                    <p>有效</p>
                                 </td>
                                 <td align="left" valign="top" width="35%" headers="d72225e3105 d72225e3061 ">
                                    <p>有效</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d72225e3118" headers="d72225e3052 ">
                                    <p>队列名称</p>
                                 </td>
                                 <td align="left" valign="top" width="21%" headers="d72225e3118 d72225e3055 ">
                                    <p>无效</p>
                                 </td>
                                 <td align="left" valign="top" width="21%" headers="d72225e3118 d72225e3058 ">
                                    <p>有效</p>
                                 </td>
                                 <td align="left" valign="top" width="35%" headers="d72225e3118 d72225e3061 ">
                                    <p>有效</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
               </div>
            </div><a id="LNCPP20473"></a><div class="props_rev_3"><a id="GUID-2949A76A-680E-481B-AE66-0E8F184199D3" name="GUID-2949A76A-680E-481B-AE66-0E8F184199D3"></a><h3 id="LNCPP-GUID-2949A76A-680E-481B-AE66-0E8F184199D3" class="sect3"><span class="enumeration_section">10.8</span>关于消息格式转换</h3>
               <div>
                  <p>应用程序通常使用不同格式的数据，这需要进行类型转换。转换是作为SQL函数实现的，它将源数据类型作为输入并返回目标数据类型的对象。当消息入队，出队或者传播到远程用户时，可以应用转换。</p>
                  <div class="infoboxnotealso" id="GUID-2949A76A-680E-481B-AE66-0E8F184199D3__GUID-6DB5B199-F08B-4974-AF0D-F659B8FB0330">
                     <p class="notep1">也可以看看：</p>
                     <p>有关格式转换的信息，请参阅“ <a href="../adque/index.html" target="_blank"><span><cite>Oracle数据库高级队列用户指南</cite></span></a> ”的以下章节：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="../adque/aq-messaging-gateway-views.html#ADQUE0900" target="_blank">Oracle Streams AQ管理界面</a></p>
                        </li>
                        <li>
                           <p><a href="../adque/aq-introduction.html#ADQUE0100" target="_blank">Oracle Streams AQ管理界面：视图</a></p>
                        </li>
                        <li>
                           <p><a href="../adque/aq-operations-using-pl-sql.html#ADQUE1000" target="_blank">Oracle Streams AQ操作界面：基本操作</a></p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>