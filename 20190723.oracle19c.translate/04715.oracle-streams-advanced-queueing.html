<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Oracle Database Advanced Queuing</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Programmer's Guide ">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Programmer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="oracle-c-call-interface-programmers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-03-06T02:31:59-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="1999, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E96205-02">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19">
      
      <link rel="prev" href="globalization-and-unicode-support.html" title="Previous" type="text/html">
      <link rel="next" href="oracle-xa-library.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Oracle C++ Call Interface Programmer's Guide">
    <meta name="dcterms.isVersionOf" content="LNCPP">
    <meta name="dcterms.release" content="Release 19">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="globalization-and-unicode-support.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="oracle-xa-library.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Programmer's Guide </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Oracle Database Advanced Queuing</li>
            </ol>
            <a id="GUID-BDEC4D8E-2388-494B-A587-47308ABC6382" name="GUID-BDEC4D8E-2388-494B-A587-47308ABC6382"></a><a id="LNCPP010"></a>
            
            <h2 id="LNCPP-GUID-BDEC4D8E-2388-494B-A587-47308ABC6382" class="sect2"><span class="enumeration_chapter">10 </span> Oracle Database Advanced Queuing
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>This chapter describes the OCCI implementation of Oracle Database Advanced Queuing
            (AQ) for messages.</p>
               <p>This chapter contains these topics:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="oracle-streams-advanced-queueing.html#GUID-4A34B665-1E00-4773-84AE-F107B851442F">Overview of Oracle Database Advanced Queuing</a></p>
                  </li>
                  <li>
                     <p><a href="oracle-streams-advanced-queueing.html#GUID-730D9965-D1D2-47A2-B568-34203CA2223B">About AQ Implementation in OCCI</a></p>
                  </li>
                  <li>
                     <p><a href="oracle-streams-advanced-queueing.html#GUID-DF06D106-1A56-49EE-980A-DEA390794E21">About Creating Messages</a></p>
                  </li>
                  <li>
                     <p><a href="oracle-streams-advanced-queueing.html#GUID-CCA3666A-DC8A-44FB-B062-1226015BC985">Enqueuing Messages</a></p>
                  </li>
                  <li>
                     <p><a href="oracle-streams-advanced-queueing.html#GUID-E7FEEE76-4001-4EDD-8922-0E5B20CBE8E8">Dequeuing Messages</a></p>
                  </li>
                  <li>
                     <p><a href="oracle-streams-advanced-queueing.html#GUID-DD67A071-D1EC-43F5-9252-949DE4319821">Listening for Messages</a></p>
                  </li>
                  <li>
                     <p><a href="oracle-streams-advanced-queueing.html#GUID-956BDB8B-86B6-414F-8531-5599D66510FA">About Registering for Notification</a></p>
                  </li>
                  <li>
                     <p><a href="oracle-streams-advanced-queueing.html#GUID-2949A76A-680E-481B-AE66-0E8F184199D3">About Message Format Transformation</a></p>
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-BDEC4D8E-2388-494B-A587-47308ABC6382__GUID-248BAD5B-8551-4BC9-A80E-D63AB5E275F5">
                  <p class="notep1">See Also:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="../adque/aq-introduction.html#ADQUE0100" target="_blank"><span><cite>Oracle Database Advanced Queuing User's Guide</cite></span></a> for basic concepts of Advanced Queuing
                        </p>
                     </li>
                     <li>
                        <p><a href="occi-application-programing-interface.html#GUID-3C824380-073E-4F32-AA6E-928A18D52F4B">OCCI Application Programming Interface</a></p>
                     </li>
                  </ul>
               </div>
            </div><a id="LNCPP20424"></a><div class="props_rev_3"><a id="GUID-4A34B665-1E00-4773-84AE-F107B851442F" name="GUID-4A34B665-1E00-4773-84AE-F107B851442F"></a><h3 id="LNCPP-GUID-4A34B665-1E00-4773-84AE-F107B851442F" class="sect3"><span class="enumeration_section">10.1 </span>Overview of Oracle Database Advanced
        Queuing
               </h3>
               <div>
                  <p>Oracle Streams is a new information sharing feature that provides replication,
            message queuing, data warehouse loading, and event notification. It is also the
            foundation behind Oracle Database Advanced Queuing (AQ). </p>
                  <p>Advanced Queuing is the integrated message queuing feature that exposes message
            queuing capabilities of Oracle Database AQ enables applications to:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Perform message queuing operations similar to SQL operations from the Oracle database</p>
                     </li>
                     <li>
                        <p>Communicate asynchronously through messages in AQ queues</p>
                     </li>
                     <li>
                        <p>Integrate with database for unprecedented levels of operational simplicity, reliability, and security to message queuing</p>
                     </li>
                     <li>
                        <p>Audit and track messages </p>
                     </li>
                     <li>
                        <p> Supports both synchronous and asynchronous modes of communication</p>
                     </li>
                  </ul>
                  <p>The advantages of using AQ in OCCI applications include:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Create applications that communicate with each other in a consistent, reliable, secure, and autonomous manner</p>
                     </li>
                     <li>
                        <p>Store messages in database tables, bringing the reliability and recoverability of the database to your messaging infrastructure</p>
                     </li>
                     <li>
                        <p>Retain messages in the database automatically for auditing and business intelligence</p>
                     </li>
                     <li>
                        <p>Create applications that leverage messaging without having to deal with a different security, data type, or operational mode</p>
                     </li>
                     <li>
                        <p>Leverage transactional characteristics of the database</p>
                     </li>
                  </ul>
                  <p>Since traditional messaging solutions have single subscriber queues, a queue must be created for each pair of applications that communicate with each other. The publish/subscribe protocol of the AQ makes it easy to add additional applications (subscribers) to a conversation between multiple applications.</p>
               </div>
            </div><a id="LNCPP20425"></a><div class="props_rev_3"><a id="GUID-730D9965-D1D2-47A2-B568-34203CA2223B" name="GUID-730D9965-D1D2-47A2-B568-34203CA2223B"></a><h3 id="LNCPP-GUID-730D9965-D1D2-47A2-B568-34203CA2223B" class="sect3"><span class="enumeration_section">10.2 </span>About AQ Implementation in OCCI
               </h3>
               <div>
                  <p>OCCI AQ is a set of interfaces that allows messaging clients to access the Advanced Queuing feature of Oracle for enterprise messaging applications. Currently, OCCI AQ supports only the operational interfaces and not the administrative interface, but administrative operations can be accessed through embedded PL/SQL calls. </p>
                  <div class="infoboxnotealso" id="GUID-730D9965-D1D2-47A2-B568-34203CA2223B__GUID-5E9C50E7-4B55-4CD6-B973-D2BEB79244A8">
                     <p class="notep1">See Also:</p>
                     <p>Package <a href="../arpls/DBMS_AQADM.html#ARPLS005" target="_blank"><code class="codeph">DBMS_AQADM</code></a> in <a href="../arpls/DBMS_AQADM.html#ARPLS005" target="_blank"><span><cite>Oracle Database PL/SQL Packages and Types Reference</cite></span></a> for administrative operations in AQ support through PL/SQL
                     </p>
                  </div>
                  <p>The AQ feature can be used with other interfaces available through OCCI for sending, receiving, publishing, and subscribing in a message-enabled database. Synchronous and asynchronous message consumption is available based on a message selection rule. </p>
                  <p>Enqueuing refers to sending a message to a queue and dequeuing refers to receiving one. A client application can create a message, set the desired properties on it and enqueue it by storing the message in the queue, a table in the database. When dequeuing a message, an application can either dequeue it synchronously by calling receive methods on the queue, or asynchronously by waiting for a notification from the database.</p>
                  <div class="p">The AQ feature is implemented through the following abstractions:
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="oracle-streams-advanced-queueing.html#GUID-263CB45B-4476-4892-B972-0DD6B41C2F78">Message</a></p>
                        </li>
                        <li>
                           <p><a href="oracle-streams-advanced-queueing.html#GUID-D51AF7E0-1F48-45DC-B6A1-B15BB14067C9">Agent</a></p>
                        </li>
                        <li>
                           <p><a href="oracle-streams-advanced-queueing.html#GUID-E69EEAA8-9523-4D1E-83AA-1B6CD4A1406E">Producer</a></p>
                        </li>
                        <li>
                           <p><a href="oracle-streams-advanced-queueing.html#GUID-76B45715-1DF9-413D-AC52-EEB3C3932AA0">Consumer</a></p>
                        </li>
                        <li>
                           <p><a href="oracle-streams-advanced-queueing.html#GUID-8C7458B6-7B21-46C8-8A70-2EDE510CBD12">Listener</a></p>
                        </li>
                        <li>
                           <p><a href="oracle-streams-advanced-queueing.html#GUID-F3238A37-C3E0-4C3B-80DB-295ADC73346D">Subscription</a></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="LNCPP20426"></a><div class="props_rev_3"><a id="GUID-263CB45B-4476-4892-B972-0DD6B41C2F78" name="GUID-263CB45B-4476-4892-B972-0DD6B41C2F78"></a><h4 id="LNCPP-GUID-263CB45B-4476-4892-B972-0DD6B41C2F78" class="sect4"><span class="enumeration_section">10.2.1 </span>Message
                  </h4>
                  <div>
                     <p>A message is the basic unit of information being inserted into and retrieved from a queue. A message consists of control information and payload data. The control information represents message properties used by AQ to manage messages. The payload data is the information stored in the queue and is transparent to AQ.</p>
                     <div class="infoboxnotealso" id="GUID-263CB45B-4476-4892-B972-0DD6B41C2F78__GUID-AE5C2898-B631-4108-B06D-76D1CD432133">
                        <p class="notep1">See Also:</p>
                        <p><a href="message-class.html#GUID-138CFABF-72CE-4BAF-B996-B42C36A55691">Message Class</a> documentation in <a href="occi-application-programing-interface.html#GUID-3C824380-073E-4F32-AA6E-928A18D52F4B">OCCI Application Programming Interface</a></p>
                     </div>
                  </div>
               </div><a id="LNCPP20428"></a><a id="LNCPP20427"></a><div class="props_rev_3"><a id="GUID-D51AF7E0-1F48-45DC-B6A1-B15BB14067C9" name="GUID-D51AF7E0-1F48-45DC-B6A1-B15BB14067C9"></a><h4 id="LNCPP-GUID-D51AF7E0-1F48-45DC-B6A1-B15BB14067C9" class="sect4"><span class="enumeration_section">10.2.2 </span>Agent
                  </h4>
                  <div>
                     <p>An <code class="codeph">Agent</code> represents and identifies a user of the queue, either producer or consumer of the message, either an end-user or an application. An <code class="codeph">Agent</code> is identified by a name, an address and a protocol. The name can be either assigned by the application, or be the application itself. The address is determined in terms of the communication protocol. If the protocol is <code class="codeph">0</code> (default), the address is of the form<code class="codeph">[schema.]queuename[@dblink]</code>, a database link. 
                     </p>
                     <p><code class="codeph">Agent</code>s on the same queue must have a unique combination of name, address, and protocol. <a href="oracle-streams-advanced-queueing.html#GUID-D51AF7E0-1F48-45DC-B6A1-B15BB14067C9__BABCBDDA">Example 10-1</a> demonstrates an instantiation of a new <code class="codeph">Agent</code> object in a client program.
                     </p>
                     <div class="infoboxnotealso" id="GUID-D51AF7E0-1F48-45DC-B6A1-B15BB14067C9__GUID-C3F0910D-6CB9-42E0-8DE1-D2AC33D88522">
                        <p class="notep1">See Also:</p>
                        <p><a href="agent-class.html#GUID-DD4B0970-353D-41DB-8C43-0024A7575DCA">Agent Class</a> documentation in <a href="occi-application-programing-interface.html#GUID-3C824380-073E-4F32-AA6E-928A18D52F4B">OCCI Application Programming Interface</a></p>
                     </div>
                     <div class="example" id="GUID-D51AF7E0-1F48-45DC-B6A1-B15BB14067C9__BABCBDDA">
                        <p class="titleinexample">Example 10-1 Creating an Agent</p><pre class="oac_no_warn" dir="ltr">Agent agt(env, "Billing_app", "billqueue", 0);</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="LNCPP20429"></a><div class="props_rev_3"><a id="GUID-E69EEAA8-9523-4D1E-83AA-1B6CD4A1406E" name="GUID-E69EEAA8-9523-4D1E-83AA-1B6CD4A1406E"></a><h4 id="LNCPP-GUID-E69EEAA8-9523-4D1E-83AA-1B6CD4A1406E" class="sect4"><span class="enumeration_section">10.2.3 </span>Producer
                  </h4>
                  <div>
                     <p>A client uses a <code class="codeph">Producer</code> object to enqueue <code class="codeph">Message</code>s into a queue. It is also used to specify various enqueue options.
                     </p>
                     <div class="infoboxnotealso" id="GUID-E69EEAA8-9523-4D1E-83AA-1B6CD4A1406E__GUID-62625942-B005-4505-9B5A-D29CD4DB5131">
                        <p class="notep1">See Also:</p>
                        <p><a href="producer-class.html#GUID-C6324876-EA2C-450A-B003-2FA2D087A560">Producer Class</a> documentation in <a href="occi-application-programing-interface.html#GUID-3C824380-073E-4F32-AA6E-928A18D52F4B">OCCI Application Programming Interface</a></p>
                     </div>
                  </div>
               </div><a id="LNCPP20431"></a><a id="LNCPP20430"></a><div class="props_rev_3"><a id="GUID-76B45715-1DF9-413D-AC52-EEB3C3932AA0" name="GUID-76B45715-1DF9-413D-AC52-EEB3C3932AA0"></a><h4 id="LNCPP-GUID-76B45715-1DF9-413D-AC52-EEB3C3932AA0" class="sect4"><span class="enumeration_section">10.2.4 </span>Consumer
                  </h4>
                  <div>
                     <p>A client uses a <code class="codeph">Consumer</code> object to dequeue <code class="codeph">Message</code>s that have been delivered to a queue. It also specifies various dequeuing options.
                     </p>
                     <p>Before a consumer can receive messages, </p>
                     <div class="infoboxnotealso" id="GUID-76B45715-1DF9-413D-AC52-EEB3C3932AA0__GUID-ACCD7286-F71D-4105-9758-2030DC679E7A">
                        <p class="notep1">See Also:</p>
                        <p><a href="consumer-class.html#GUID-8BD5D6C3-8C06-4D57-85DD-AA903DECB1D4">Consumer Class</a> documentation in <a href="occi-application-programing-interface.html#GUID-3C824380-073E-4F32-AA6E-928A18D52F4B">OCCI Application Programming Interface</a></p>
                     </div>
                     <div class="example" id="GUID-76B45715-1DF9-413D-AC52-EEB3C3932AA0__GUID-CEE11EF0-5992-44FE-85B1-8E78D475D27E">
                        <p class="titleinexample">Example 10-2 Setting the Agent on the Consumer</p><pre class="oac_no_warn" dir="ltr">Consumer cons(conn);
...
cons.setAgent(ag);
cons.receive();
</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="LNCPP20432"></a><div class="props_rev_3"><a id="GUID-8C7458B6-7B21-46C8-8A70-2EDE510CBD12" name="GUID-8C7458B6-7B21-46C8-8A70-2EDE510CBD12"></a><h4 id="LNCPP-GUID-8C7458B6-7B21-46C8-8A70-2EDE510CBD12" class="sect4"><span class="enumeration_section">10.2.5 </span>Listener
                  </h4>
                  <div>
                     <p>A <code class="codeph">Listener</code> listens for <code class="codeph">Message</code>s for registered <code class="codeph">Agent</code>s at specified queues.
                     </p>
                     <div class="infoboxnotealso" id="GUID-8C7458B6-7B21-46C8-8A70-2EDE510CBD12__GUID-43176773-6632-4072-8425-CFB8D2585712">
                        <p class="notep1">See Also:</p>
                        <p><a href="listener-class.html#GUID-D3F604C2-F378-4CF7-8631-117CA88D8989">Listener Class</a> documentation in <a href="occi-application-programing-interface.html#GUID-3C824380-073E-4F32-AA6E-928A18D52F4B">OCCI Application Programming Interface</a></p>
                     </div>
                  </div>
               </div><a id="LNCPP20433"></a><div class="props_rev_3"><a id="GUID-F3238A37-C3E0-4C3B-80DB-295ADC73346D" name="GUID-F3238A37-C3E0-4C3B-80DB-295ADC73346D"></a><h4 id="LNCPP-GUID-F3238A37-C3E0-4C3B-80DB-295ADC73346D" class="sect4"><span class="enumeration_section">10.2.6 </span>Subscription
                  </h4>
                  <div>
                     <p>A <code class="codeph">Subscription</code> encapsulates the information and operations necessary for registering a subscriber for notifications.
                     </p>
                  </div>
               </div>
            </div><a id="LNCPP20434"></a><div class="props_rev_3"><a id="GUID-DF06D106-1A56-49EE-980A-DEA390794E21" name="GUID-DF06D106-1A56-49EE-980A-DEA390794E21"></a><h3 id="LNCPP-GUID-DF06D106-1A56-49EE-980A-DEA390794E21" class="sect3"><span class="enumeration_section">10.3 </span>About Creating Messages
               </h3>
               <div>
                  <p>As mentioned previously, a <code class="codeph">Message</code> is a basic unit of information that contains both the properties of the message and its content, or <span class="bold">payload</span>. Each message is enqueued by the <code class="codeph">Producer</code> and dequeued by the <code class="codeph">Consumer</code> objects.
                  </p>
                  <div class="p">This section includes the following topics:
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="oracle-streams-advanced-queueing.html#GUID-CCB750C3-8706-4EC5-8DF0-A0DA7E6AAEF6">About Message Payloads</a></p>
                        </li>
                        <li>
                           <p><a href="oracle-streams-advanced-queueing.html#GUID-80AECA53-2449-4FE4-BF21-34BF0672DB7F">Message Properties</a></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="LNCPP20435"></a><div class="props_rev_3"><a id="GUID-CCB750C3-8706-4EC5-8DF0-A0DA7E6AAEF6" name="GUID-CCB750C3-8706-4EC5-8DF0-A0DA7E6AAEF6"></a><h4 id="LNCPP-GUID-CCB750C3-8706-4EC5-8DF0-A0DA7E6AAEF6" class="sect4"><span class="enumeration_section">10.3.1 </span>About Message Payloads
                  </h4>
                  <div>
                     <div class="p">OCCI supports three types of message payloads: 
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-FEE6018F-2F99-4DB6-A6F7-A315BF4AE414">RAW</a></p>
                           </li>
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-DDFF33B8-C746-4CC7-9133-8675C27B4900">AnyData</a></p>
                           </li>
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-33A776E8-66C0-4B2B-9931-64AAD0031D51">Using User-defined Types as Payloads</a></p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="LNCPP20436"></a><div class="props_rev_3"><a id="GUID-FEE6018F-2F99-4DB6-A6F7-A315BF4AE414" name="GUID-FEE6018F-2F99-4DB6-A6F7-A315BF4AE414"></a><h5 id="LNCPP-GUID-FEE6018F-2F99-4DB6-A6F7-A315BF4AE414" class="sect5"><span class="enumeration_section">10.3.1.1 </span>RAW
                     </h5>
                     <div>
                        <p><code class="codeph">RAW</code> payloads are mapped as objects of the <a href="bytes-class.html#GUID-394F58FA-D5CC-472B-8190-0BF92CE52299">Bytes Class</a> in OCCI.
                        </p>
                     </div>
                  </div><a id="LNCPP20438"></a><a id="LNCPP20439"></a><a id="LNCPP20437"></a><div class="props_rev_3"><a id="GUID-DDFF33B8-C746-4CC7-9133-8675C27B4900" name="GUID-DDFF33B8-C746-4CC7-9133-8675C27B4900"></a><h5 id="LNCPP-GUID-DDFF33B8-C746-4CC7-9133-8675C27B4900" class="sect5"><span class="enumeration_section">10.3.1.2 </span>AnyData
                     </h5>
                     <div>
                        <p>The <code class="codeph">AnyData</code> type models self-descriptive data encapsulation; it contains both the type information and the actual data value. Data values of most SQL types can be converted to <code class="codeph">AnyData</code>, and then be converted to the original data type. <code class="codeph">AnyData</code> also supports user-defined data types. The advantage of using <code class="codeph">AnyData</code> payloads is that it ensures both type preservation after an enqueue and dequeue process, and that it allows the user to use a single queue for all types used in the application. <a href="oracle-streams-advanced-queueing.html#GUID-DDFF33B8-C746-4CC7-9133-8675C27B4900__BABJIIGJ">Example 10-3</a> demonstrates how to create an <code class="codeph">AnyData </code>message. <a href="oracle-streams-advanced-queueing.html#GUID-DDFF33B8-C746-4CC7-9133-8675C27B4900__BABBEEHC">Example 10-4</a> shows how to retrieve the original data type from the message.
                        </p>
                        <div class="example" id="GUID-DDFF33B8-C746-4CC7-9133-8675C27B4900__BABJIIGJ">
                           <p class="titleinexample">Example 10-3 Creating an AnyData Message with a String Payload</p><pre class="oac_no_warn" dir="ltr">AnyData any(conn);
any.setFromString("item1");
Message mes(env);
mes.setAnyData(any);</pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-DDFF33B8-C746-4CC7-9133-8675C27B4900__BABBEEHC">
                           <p class="titleinexample">Example 10-4 Determining the Type of the Payload in an AnyData Message</p><pre class="oac_no_warn" dir="ltr">TypeCode tc = any.getType();</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="LNCPP20441"></a><a id="LNCPP20440"></a><div class="props_rev_3"><a id="GUID-33A776E8-66C0-4B2B-9931-64AAD0031D51" name="GUID-33A776E8-66C0-4B2B-9931-64AAD0031D51"></a><h5 id="LNCPP-GUID-33A776E8-66C0-4B2B-9931-64AAD0031D51" class="sect5"><span class="enumeration_section">10.3.1.3 </span>Using User-defined Types as Payloads
                     </h5>
                     <div>
                        <div class="section">
                           <p>OCCI supports enqueuing and dequeuing of user-defined types as payloads. <a href="oracle-streams-advanced-queueing.html#GUID-33A776E8-66C0-4B2B-9931-64AAD0031D51__BABBGFDC">Example 10-5</a> demonstrates how to create a payload with a user-defined <code class="codeph">Employee</code> object.
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-33A776E8-66C0-4B2B-9931-64AAD0031D51__BABBGFDC">
                           <p class="titleinexample">Example 10-5 Creating an User-defined Payload</p><pre class="oac_no_warn" dir="ltr">// Assuming type Employee ( name varchar2(25),
//                          deptid number(10),
//                          manager varchar2(25) )
Employee *emp = new Employee();
emp.setName("Scott");
emp.setDeptid(10);
emp.setManager("James");
Message mes(env);
mes.setObject(emp);</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div><a id="LNCPP20442"></a><div class="props_rev_3"><a id="GUID-80AECA53-2449-4FE4-BF21-34BF0672DB7F" name="GUID-80AECA53-2449-4FE4-BF21-34BF0672DB7F"></a><h4 id="LNCPP-GUID-80AECA53-2449-4FE4-BF21-34BF0672DB7F" class="sect4"><span class="enumeration_section">10.3.2 </span>Message Properties
                  </h4>
                  <div>
                     <div class="p">Aside from payloads, the user can specify several additional message properties, such as:
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-1443AFED-1A63-4C86-B3D8-8B083D84CA35">Correlation</a></p>
                           </li>
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-6AA29BF9-D531-483F-B3C5-83E6369B3787">Sender</a></p>
                           </li>
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-0DCB1659-7B7B-4083-9886-03279E9F9ECA">Delay and Expiration</a></p>
                           </li>
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-A9FFAA5C-FD8E-42E0-8BA5-689E759D7DCF">Recipients</a></p>
                           </li>
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-628C72AE-375A-4087-AED8-E78034E04DE3">Priority and Ordering</a></p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="LNCPP20444"></a><a id="LNCPP20443"></a><div class="props_rev_3"><a id="GUID-1443AFED-1A63-4C86-B3D8-8B083D84CA35" name="GUID-1443AFED-1A63-4C86-B3D8-8B083D84CA35"></a><h5 id="LNCPP-GUID-1443AFED-1A63-4C86-B3D8-8B083D84CA35" class="sect5"><span class="enumeration_section">10.3.2.1 </span>Correlation
                     </h5>
                     <div>
                        <p>Applications can specify a correlation identifier of the message during the enqueuing process, as demonstrated in <a href="oracle-streams-advanced-queueing.html#GUID-1443AFED-1A63-4C86-B3D8-8B083D84CA35__BABDEDEI">Example 10-6</a>. This identifier can then be used by the dequeuing application.
                        </p>
                        <div class="example" id="GUID-1443AFED-1A63-4C86-B3D8-8B083D84CA35__BABDEDEI">
                           <p class="titleinexample">Example 10-6 Specifying the Correlation identifier</p><pre class="oac_no_warn" dir="ltr">mes.setCorrelationId("enq_corr_di");</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="LNCPP20446"></a><a id="LNCPP20445"></a><div class="props_rev_3"><a id="GUID-6AA29BF9-D531-483F-B3C5-83E6369B3787" name="GUID-6AA29BF9-D531-483F-B3C5-83E6369B3787"></a><h5 id="LNCPP-GUID-6AA29BF9-D531-483F-B3C5-83E6369B3787" class="sect5"><span class="enumeration_section">10.3.2.2 </span>Sender
                     </h5>
                     <div>
                        <p>Applications can specify the sender of the message, as demonstrated in <a href="oracle-streams-advanced-queueing.html#GUID-6AA29BF9-D531-483F-B3C5-83E6369B3787__BABCCAGF">Example 10-7</a>. The sender identifier can then be used by the receiver of the message.
                        </p>
                        <div class="example" id="GUID-6AA29BF9-D531-483F-B3C5-83E6369B3787__BABCCAGF">
                           <p class="titleinexample">Example 10-7 Specifying the Sender identifier</p><pre class="oac_no_warn" dir="ltr">mes.setSenderId(agt);</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="LNCPP20448"></a><a id="LNCPP20447"></a><div class="props_rev_3"><a id="GUID-0DCB1659-7B7B-4083-9886-03279E9F9ECA" name="GUID-0DCB1659-7B7B-4083-9886-03279E9F9ECA"></a><h5 id="LNCPP-GUID-0DCB1659-7B7B-4083-9886-03279E9F9ECA" class="sect5"><span class="enumeration_section">10.3.2.3 </span>Delay and Expiration
                     </h5>
                     <div>
                        <p>Time settings control the delay and expiration times of the message in seconds, as demonstrated in <a href="oracle-streams-advanced-queueing.html#GUID-0DCB1659-7B7B-4083-9886-03279E9F9ECA__BABDCBFB">Example 10-8</a>.
                        </p>
                        <div class="example" id="GUID-0DCB1659-7B7B-4083-9886-03279E9F9ECA__BABDCBFB">
                           <p class="titleinexample">Example 10-8 Specifying the Delay and Expiration times of the message</p><pre class="oac_no_warn" dir="ltr">mes.setDelay(10);
mes.setExpirationTime(60);</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="LNCPP20450"></a><a id="LNCPP20449"></a><div class="props_rev_3"><a id="GUID-A9FFAA5C-FD8E-42E0-8BA5-689E759D7DCF" name="GUID-A9FFAA5C-FD8E-42E0-8BA5-689E759D7DCF"></a><h5 id="LNCPP-GUID-A9FFAA5C-FD8E-42E0-8BA5-689E759D7DCF" class="sect5"><span class="enumeration_section">10.3.2.4 </span>Recipients
                     </h5>
                     <div>
                        <p>The agents for whom the message is intended can be specified during message encoding, as demonstrated in <a href="oracle-streams-advanced-queueing.html#GUID-A9FFAA5C-FD8E-42E0-8BA5-689E759D7DCF__BABCHFIA">Example 10-9</a>. This ensures that only the specified recipients can access the message.
                        </p>
                        <div class="example" id="GUID-A9FFAA5C-FD8E-42E0-8BA5-689E759D7DCF__BABCHFIA">
                           <p class="titleinexample">Example 10-9 Specifying message recipients</p><pre class="oac_no_warn" dir="ltr">vector&lt;Agent&gt; agt_list;
for (i=0; i&lt;num_recipients; i++)
   agt_list.push_back(Agent(name, address, protocol));
mes.setRecipientList(agt_list);</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="LNCPP20452"></a><a id="LNCPP20451"></a><div class="props_rev_3"><a id="GUID-628C72AE-375A-4087-AED8-E78034E04DE3" name="GUID-628C72AE-375A-4087-AED8-E78034E04DE3"></a><h5 id="LNCPP-GUID-628C72AE-375A-4087-AED8-E78034E04DE3" class="sect5"><span class="enumeration_section">10.3.2.5 </span>Priority and Ordering
                     </h5>
                     <div>
                        <p>By assigning a priority level to a message, the sender can control the order in which the messages are dequeued by the receiver. <a href="oracle-streams-advanced-queueing.html#GUID-628C72AE-375A-4087-AED8-E78034E04DE3__BABHJGCG">Example 10-10</a> demonstrates how to set the priority of a message.
                        </p>
                        <div class="example" id="GUID-628C72AE-375A-4087-AED8-E78034E04DE3__BABHJGCG">
                           <p class="titleinexample">Example 10-10 Specifying the Priority of a Message</p><pre class="oac_no_warn" dir="ltr">mes.setPriority(3);</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div>
            </div><a id="LNCPP20454"></a><a id="LNCPP20453"></a><div class="props_rev_3"><a id="GUID-CCA3666A-DC8A-44FB-B062-1226015BC985" name="GUID-CCA3666A-DC8A-44FB-B062-1226015BC985"></a><h3 id="LNCPP-GUID-CCA3666A-DC8A-44FB-B062-1226015BC985" class="sect3"><span class="enumeration_section">10.4 </span>Enqueuing Messages
               </h3>
               <div>
                  <div class="section">
                     <p>Messages are enqueued by the Producer. The <a href="producer-class.html#GUID-C6324876-EA2C-450A-B003-2FA2D087A560">Producer Class</a> is also used to specify enqueue options. A <code class="codeph">Producer</code> object can be created on a valid connection where enqueuing is performed, as illustrated in <a href="oracle-streams-advanced-queueing.html#GUID-CCA3666A-DC8A-44FB-B062-1226015BC985__BABJABDC">Example 10-11</a>.
                     </p>
                     <p>The transactional behavior of the enqueue operation can be defined based on application requirements. The application can make the effect of the enqueue operation visible externally either immediately after it is completed, as in <a href="oracle-streams-advanced-queueing.html#GUID-CCA3666A-DC8A-44FB-B062-1226015BC985__BABJABDC">Example 10-11</a>, or only after the enclosing transaction has been committed.
                     </p>
                     <p>To enqueue the message, use the <code class="codeph">send()</code> method, as demonstrated in <a href="oracle-streams-advanced-queueing.html#GUID-CCA3666A-DC8A-44FB-B062-1226015BC985__BABJABDC">Example 10-11</a>. A client may retain the <code class="codeph">Message</code> object after it is sent, modify it, and send it again.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-CCA3666A-DC8A-44FB-B062-1226015BC985__BABJABDC">
                     <p class="titleinexample">Example 10-11 Creating a Producer, Setting Visibility, and Enqueuing the Message</p><pre class="oac_no_warn" dir="ltr">Producer prod(conn);
...
prod.setVisibility(Producer::ENQ_IMMEDIATE);
...
Message mes(env);
...
mes.setBytes(obj);            // obj represents the content of the message
prod.send(mes, queueName);    // queueName is the name of the queue
</pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="LNCPP20456"></a><a id="LNCPP20457"></a><a id="LNCPP20455"></a><div class="props_rev_3"><a id="GUID-E7FEEE76-4001-4EDD-8922-0E5B20CBE8E8" name="GUID-E7FEEE76-4001-4EDD-8922-0E5B20CBE8E8"></a><h3 id="LNCPP-GUID-E7FEEE76-4001-4EDD-8922-0E5B20CBE8E8" class="sect3"><span class="enumeration_section">10.5 </span>Dequeuing Messages
               </h3>
               <div>
                  <div class="section">
                     <p>Messages delivered to a queue are dequeued by the <code class="codeph">Consumer</code>. The <a href="consumer-class.html#GUID-8BD5D6C3-8C06-4D57-85DD-AA903DECB1D4">Consumer Class</a> is also used to specify dequeue options. A <code class="codeph">Consumer</code> object can be created on a valid connection to the database where a queue exists, as demonstrated in <a href="oracle-streams-advanced-queueing.html#GUID-E7FEEE76-4001-4EDD-8922-0E5B20CBE8E8__BABIDDIB">Example 10-12</a>. 
                     </p>
                     <p>In applications that support multiple consumers in the same queue, the name of the consumer has to be specified as a registered subscriber to the queue, as shown in <a href="oracle-streams-advanced-queueing.html#GUID-E7FEEE76-4001-4EDD-8922-0E5B20CBE8E8__BABIDDIB">Example 10-12</a>.
                     </p>
                     <p>To dequeue the message, use the <code class="codeph">receive()</code> method, as demonstrated in <a href="oracle-streams-advanced-queueing.html#GUID-E7FEEE76-4001-4EDD-8922-0E5B20CBE8E8__BABIDDIB">Example 10-12</a>. The <code class="codeph">typeName</code> and <code class="codeph">schemaName</code> parameters of the <code class="codeph">receive()</code> method specify the type of payload and the schema of the payload type.
                     </p>
                     <p>When the queue payload type is either <a href="oracle-streams-advanced-queueing.html#GUID-FEE6018F-2F99-4DB6-A6F7-A315BF4AE414">RAW</a> or <a href="oracle-streams-advanced-queueing.html#GUID-DDFF33B8-C746-4CC7-9133-8675C27B4900">AnyData</a>, <code class="codeph">schemaName</code> and <code class="codeph">typeName</code> are optional, but you must specify these parameters explicitly when working with user-defined payloads. This is illustrated in <a href="oracle-streams-advanced-queueing.html#GUID-E7FEEE76-4001-4EDD-8922-0E5B20CBE8E8__BABICACA">Example 10-13</a>.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-E7FEEE76-4001-4EDD-8922-0E5B20CBE8E8__BABIDDIB">
                     <p class="titleinexample">Example 10-12 Creating a Consumer, Naming the Consumer, and Receiving a Message</p><pre class="oac_no_warn" dir="ltr">Consumer cons(conn);
...
// Name must be registered with the queue through administrative interface
cons.setConsumerName("BillApp");
cons.setQueueName(queueName);
...
Message mes = cons.receive(Message::OBJECT, "BILL_TYPE", "BILL_PROCESSOR");
...
// obj is is assigned the content of the message
obj = mes.getObject();
</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-E7FEEE76-4001-4EDD-8922-0E5B20CBE8E8__BABICACA">
                     <p class="titleinexample">Example 10-13 Receiving a Message</p><pre class="oac_no_warn" dir="ltr">//receiving a RAW message
Message mes = cons.receive(Message::RAW);
...
//receiving an ANYDATA message
Message mes = cons.receive(Message::ANYDATA);
...
</pre></div>
                  <!-- class="example" -->
                  <div class="section">This section includes the following topic: <a href="oracle-streams-advanced-queueing.html#GUID-FD4CEEC3-B10A-4175-BEAE-3BBBF800E9DB">About Dequeuing Options</a>.
                  </div>
                  <!-- class="section" -->
               </div><a id="LNCPP20458"></a><div class="props_rev_3"><a id="GUID-FD4CEEC3-B10A-4175-BEAE-3BBBF800E9DB" name="GUID-FD4CEEC3-B10A-4175-BEAE-3BBBF800E9DB"></a><h4 id="LNCPP-GUID-FD4CEEC3-B10A-4175-BEAE-3BBBF800E9DB" class="sect4"><span class="enumeration_section">10.5.1 </span>About Dequeuing Options
                  </h4>
                  <div>
                     <div class="p">The dequeuing application can specify several dequeuing options before it begins to receive messages. These include:
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-BF63AFF1-149D-4EA8-A161-F32067FDF1B5">Correlation</a></p>
                           </li>
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-C27BAA95-F06F-4E61-84E6-EC9C4199AF32">Mode</a></p>
                           </li>
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-9E8A9D24-B28D-41BE-9C69-E5B5D3498D47">Navigation</a></p>
                           </li>
                        </ul> 
                     </div>
                  </div><a id="LNCPP20459"></a><div class="props_rev_3"><a id="GUID-BF63AFF1-149D-4EA8-A161-F32067FDF1B5" name="GUID-BF63AFF1-149D-4EA8-A161-F32067FDF1B5"></a><h5 id="LNCPP-GUID-BF63AFF1-149D-4EA8-A161-F32067FDF1B5" class="sect5"><span class="enumeration_section">10.5.1.1 </span>Correlation
                     </h5>
                     <div>
                        <p>The message can be dequeued based on the value of its correlation identifier using the <code class="codeph">setCorrelationId()</code> method, as shown in <a href="oracle-streams-advanced-queueing.html#GUID-9E8A9D24-B28D-41BE-9C69-E5B5D3498D47__BABIABHI">Example 10-14</a>.
                        </p>
                     </div>
                  </div><a id="LNCPP20460"></a><div class="props_rev_3"><a id="GUID-C27BAA95-F06F-4E61-84E6-EC9C4199AF32" name="GUID-C27BAA95-F06F-4E61-84E6-EC9C4199AF32"></a><h5 id="LNCPP-GUID-C27BAA95-F06F-4E61-84E6-EC9C4199AF32" class="sect5"><span class="enumeration_section">10.5.1.2 </span>Mode
                     </h5>
                     <div>
                        <p>Based on application requirements, the user can choose to only browse through messages in the queue, remove the messages from the queue, or lock messages using the <code class="codeph">setDequeueMode()</code> method, as shown in <a href="oracle-streams-advanced-queueing.html#GUID-9E8A9D24-B28D-41BE-9C69-E5B5D3498D47__BABIABHI">Example 10-14</a>.
                        </p>
                     </div>
                  </div><a id="LNCPP20462"></a><a id="LNCPP20461"></a><div class="props_rev_3"><a id="GUID-9E8A9D24-B28D-41BE-9C69-E5B5D3498D47" name="GUID-9E8A9D24-B28D-41BE-9C69-E5B5D3498D47"></a><h5 id="LNCPP-GUID-9E8A9D24-B28D-41BE-9C69-E5B5D3498D47" class="sect5"><span class="enumeration_section">10.5.1.3 </span>Navigation
                     </h5>
                     <div>
                        <p>Messages enqueued in a single transaction can be viewed as a single group by implementing the <code class="codeph">setPositionOfMessage()</code> method, as shown in <a href="oracle-streams-advanced-queueing.html#GUID-9E8A9D24-B28D-41BE-9C69-E5B5D3498D47__BABIABHI">Example 10-14</a>.
                        </p>
                        <div class="example" id="GUID-9E8A9D24-B28D-41BE-9C69-E5B5D3498D47__BABIABHI">
                           <p class="titleinexample">Example 10-14 Specifying dequeuing options</p><pre class="oac_no_warn" dir="ltr">cons.setCorrelationId(corrId);
...
cons.setDequeueMode(deqMode);
...
cons.setPositionOfMessage(Consumer::DEQ_NEXT_TRANSACTION);</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div>
            </div><a id="LNCPP20464"></a><a id="LNCPP20463"></a><div class="props_rev_3"><a id="GUID-DD67A071-D1EC-43F5-9252-949DE4319821" name="GUID-DD67A071-D1EC-43F5-9252-949DE4319821"></a><h3 id="LNCPP-GUID-DD67A071-D1EC-43F5-9252-949DE4319821" class="sect3"><span class="enumeration_section">10.6 </span>Listening for Messages
               </h3>
               <div>
                  <div class="section">
                     <p>The Listener listens for messages on queues on behalf of its registered clients. The <a href="listener-class.html#GUID-D3F604C2-F378-4CF7-8631-117CA88D8989">Listener Class</a> implements the <code class="codeph">listen()</code> method, which is a blocking call that returns when a queue has a message for a registered agent, or throws an error when the time out period expires. <a href="oracle-streams-advanced-queueing.html#GUID-DD67A071-D1EC-43F5-9252-949DE4319821__BABJJHGH">Example 10-15</a> illustrates the listening protocol.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-DD67A071-D1EC-43F5-9252-949DE4319821__BABJJHGH">
                     <p class="titleinexample">Example 10-15 Listening for messages</p><pre class="oac_no_warn" dir="ltr">Listener listener(conn);

vector&lt;Agent&gt; agtList;
for( int i=0; i&lt;num_agents; i++)
&nbsp;&nbsp;&nbsp;agtList.push_back( Agent( name, address, protocol);

listener.setAgentList(agtList);
listener.setTimeOutForListen(10);

Agent agt(env);

try{
&nbsp;&nbsp;&nbsp;agt = listener.listen();
}
catch{
&nbsp;&nbsp;&nbsp;cout&lt;&lt;e.getMessage()&lt;&lt;endl;
}</pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="LNCPP20465"></a><div class="props_rev_3"><a id="GUID-956BDB8B-86B6-414F-8531-5599D66510FA" name="GUID-956BDB8B-86B6-414F-8531-5599D66510FA"></a><h3 id="LNCPP-GUID-956BDB8B-86B6-414F-8531-5599D66510FA" class="sect3"><span class="enumeration_section">10.7 </span>About Registering for Notification
               </h3>
               <div>
                  <p>The <a href="subscription-class.html#GUID-5183EF2D-D831-4A29-892B-7DDB34701339">Subscription Class</a> implements the publish-subscribe notification feature. It allows an OCCI AQ application to receive client notifications directly, register an e-mail address to which notifications can be sent, register an HTTP URL to which notifications can be posted, or register a PL/SQL procedure to be invoked on a notification. Registered clients are notified asynchronously when events are triggered or on an explicit AQ enqueue. Clients do not have to be connected to a database. 
                  </p>
                  <p>An OCCI application can do all of the following:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Register interest in notification in the AQ namespace, and be notified when an enqueue occurs.</p>
                     </li>
                     <li>
                        <p>Register interest in subscriptions to database events, and receive notifications when these events are triggered.</p>
                     </li>
                     <li>
                        <p>Manage registrations, such as disable registrations temporarily, or dropping registrations entirely.</p>
                     </li>
                     <li>
                        <p>Post (or send) notifications to registered clients.</p>
                     </li>
                  </ul>
                  <div class="p">This section includes the following topics:
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="oracle-streams-advanced-queueing.html#GUID-BF37AB9C-A8FE-4E42-95F5-BB89DB0FA4A0">Publish-Subscribe Notifications</a></p>
                        </li>
                        <li>
                           <p><a href="oracle-streams-advanced-queueing.html#GUID-2949A76A-680E-481B-AE66-0E8F184199D3">About Message Format Transformation</a></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="LNCPP20466"></a><div class="props_rev_3"><a id="GUID-BF37AB9C-A8FE-4E42-95F5-BB89DB0FA4A0" name="GUID-BF37AB9C-A8FE-4E42-95F5-BB89DB0FA4A0"></a><h4 id="LNCPP-GUID-BF37AB9C-A8FE-4E42-95F5-BB89DB0FA4A0" class="sect4"><span class="enumeration_section">10.7.1 </span>Publish-Subscribe Notifications
                  </h4>
                  <div>
                     <p>Notifications can work in several ways. They can be:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>received directly by the OCCI application</p>
                        </li>
                        <li>
                           <p>sent to a pre-specified e-mail address</p>
                        </li>
                        <li>
                           <p>sent to a pre-defined HTTP URL</p>
                        </li>
                        <li>
                           <p>invoke a pre-specified database PL/SQL procedure</p>
                        </li>
                     </ul>
                     <div class="p">Registered clients are notified asynchronously when events are triggered, or on an explicit AQ enqueue. Clients do not have to be connected to a database for notifications to work. Registration can be accomplished either as:
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-E1FD90EA-5E64-4BD3-8C8E-B753B15DAD3C">How to Use Direct Registration</a></p>
                           </li>
                           <li>
                              <p><a href="oracle-streams-advanced-queueing.html#GUID-FDCA6B2A-C784-4360-BF89-2239E23F0D4F">Using Open Registration</a></p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="LNCPP20468"></a><a id="LNCPP20467"></a><div class="props_rev_3"><a id="GUID-E1FD90EA-5E64-4BD3-8C8E-B753B15DAD3C" name="GUID-E1FD90EA-5E64-4BD3-8C8E-B753B15DAD3C"></a><h5 id="LNCPP-GUID-E1FD90EA-5E64-4BD3-8C8E-B753B15DAD3C" class="sect5"><span class="enumeration_section">10.7.1.1 </span>How to Use Direct Registration
                     </h5>
                     <div>
                        <div class="section">
                           <p>You can register directly with the database. This is relatively simple, and the registration takes effect immediately. <a href="oracle-streams-advanced-queueing.html#GUID-E1FD90EA-5E64-4BD3-8C8E-B753B15DAD3C__BABHDBCF">Example 10-16</a> outlines the required steps to successfully register for direct event notification. It is assumed that the appropriate event trigger or queue is in existence, and that the initialization parameter <code class="codeph">COMPATIBLE</code> is set to <code class="codeph">8.1</code> or higher.
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-E1FD90EA-5E64-4BD3-8C8E-B753B15DAD3C__BABHDBCF">
                           <p class="titleinexample">Example 10-16 How to Register for Notifications; Direct Registration</p>
                           <ol>
                              <li>
                                 <p>Create the environment in <code class="codeph">Environment::EVENTS</code> mode.
                                 </p>
                              </li>
                              <li>
                                 <p>Create the <code class="codeph">Subscription</code> object.
                                 </p>
                              </li>
                              <li>
                                 <p>Set these <code class="codeph">Subscription</code> attributes.
                                 </p>
                                 <p>The <code class="codeph">namespace</code> can be set to these options:
                                 </p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>To receive notifications from AQ queues, <code class="codeph">namespace</code> must be set to <code class="codeph">Subscription::NS_AQ</code>. The subscription name is then either of the form <code class="codeph">SCHEMA.QUEUE</code> when registering on a single consumer queue, or <code class="codeph">SCHEMA.QUEUE:</code><span class="italic"><code class="codeph">CONSUMER_NAME</code></span> when registering on a multiconsumer queue.
                                       </p>
                                    </li>
                                    <li>
                                       <p>To receive notifications from other applications that use <code class="codeph">conn-&gt;postToSubscription()</code> method, <code class="codeph">namespace</code> must be set to <code class="codeph">Subscription::NS_ANONYMOUS</code></p>
                                    </li>
                                 </ul>
                                 <p>The <code class="codeph">protocol</code> can be set to these options:
                                 </p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>If an OCCI client must receive an event notification, this attribute should be set to <code class="codeph">Subscription::PROTO_CBK</code>. You also must set the notification callback and the subscription context before registering the <code class="codeph">Subscription</code>. The notification callback is called when the event occurs.
                                       </p>
                                    </li>
                                    <li>
                                       <p>For an e-mail notification, set the protocol to <code class="codeph">Subscription::PROTO_MAIL</code>. You must set the recipient name before subscribing to avoid an application error.
                                       </p>
                                    </li>
                                    <li>
                                       <p>For an HTTP URL notification, set the protocol to <code class="codeph">Subscription::HTTP</code>. You must set the recipient name before subscribing to avoid an application error.
                                       </p>
                                    </li>
                                    <li>
                                       <p>To invoke PL/SQL procedures in the database on event notification, set protocol to <code class="codeph">Subscription::PROTO_SERVER</code>. You must set the recipient name before subscribing to avoid an application error.
                                       </p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>Register the subscriptions using <code class="codeph">connection-&gt;registerSubscriptions()</code>.
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="LNCPP20470"></a><a id="LNCPP20469"></a><div class="props_rev_2"><a id="GUID-FDCA6B2A-C784-4360-BF89-2239E23F0D4F" name="GUID-FDCA6B2A-C784-4360-BF89-2239E23F0D4F"></a><h5 id="LNCPP-GUID-FDCA6B2A-C784-4360-BF89-2239E23F0D4F" class="sect5"><span class="enumeration_section">10.7.1.2 </span>Using Open Registration
                     </h5>
                     <div>
                        <div class="section">
                           <p>You can also register through an intermediate LDAP that sends the registration request to the database. This is used when the client cannot have a direct database connection; for example, the client wants to register for an open event while the database is down. This approach is also used when a client wants to register for the same event(s) in multiple databases, concurrently.</p>
                           <p><a href="oracle-streams-advanced-queueing.html#GUID-FDCA6B2A-C784-4360-BF89-2239E23F0D4F__BABBIBJJ">Example 10-17</a> outlines the LDAP open registration using the Oracle Enterprise Security Manager (OESM). Open registration has these prerequisites:
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The client must be an enterprise user</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>In each enterprise domain, create an enterprise role <code class="codeph">ENTERPRISE_AQ_USER_ROLE</code></p>
                                    </li>
                                    <li>
                                       <p>For each database in the enterprise domain, add a global role <code class="codeph">GLOBAL_AQ_USER_ROLE</code> to enterprise the role <code class="codeph">ENTERPRISE_AQ_USER_ROLE</code>.
                                       </p>
                                    </li>
                                    <li>
                                       <p>For each enterprise domain, add an enterprise role <code class="codeph">ENTERPRISE_AQ_USER_ROLE</code> to the privilege group <code class="codeph">cn=OracleDBAQUsers</code> under <code class="codeph">cn=oraclecontext</code> in the administrative context
                                       </p>
                                    </li>
                                    <li>
                                       <p>For each enterprise user that is authorized to register for events in the database, grant enterprise the role <code class="codeph">ENTERPRISE_AQ_USER_ROLE</code></p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>The compatibility of the database must be 9.0 or higher</p>
                              </li>
                              <li>
                                 <p><code class="codeph">LDAP_REGISTRATION_ENABLED</code> must be set to <code class="codeph">TRUE</code> (default is <code class="codeph">FALSE</code>):
                                 </p><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM SET LDAP_REGISTRATION_ENABLED=TRUE
</pre></li>
                              <li>
                                 <p><code class="codeph">LDAP_REG_SYNC_INTERVAL</code> must be set to the <code class="codeph">time_interval</code> (in seconds) to refresh registrations from LDAP (default is <code class="codeph">0</code>, do not refresh):
                                 </p><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM SET LDAP_REG_SYNC_INTERVAL = time_interval
</pre></li>
                           </ul>
                           <p>To force a database refresh of LDAP registration information immediately, issue this command:</p><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM REFRESH LDAP_REGISTRATION</pre><p>Open registration takes effect when the database accesses LDAP to pick up new registrations. The frequency of pick-ups is determined by the value of <code class="codeph">REG_SYNC_INTERVAL</code>.
                           </p>
                           <p>Clients can temporarily disable subscriptions, re-enable them, or permanently unregister from future notifications.</p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-FDCA6B2A-C784-4360-BF89-2239E23F0D4F__BABBIBJJ">
                           <p class="titleinexample">Example 10-17 How to Use Open Registration with LDAP </p>
                           <ol>
                              <li>
                                 <p>Create the environment in <code class="codeph">Environment::EVENTS|Environment::USE_LDAP</code> mode.
                                 </p>
                              </li>
                              <li>
                                 <p>Set the <code class="codeph">Environment</code> object for accessing LDAP: 
                                 </p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>The host and port on which the LDAP server is residing and listening</p>
                                    </li>
                                    <li>
                                       <p>The authentication method; only simple username and password authentication is currently supported</p>
                                    </li>
                                    <li>
                                       <p>The username (distinguished name) and password for authentication with the LDAP server</p>
                                    </li>
                                    <li>
                                       <p>The administrative context for Oracle in the LDAP server</p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>Create the <code class="codeph">Subscription</code> object.
                                 </p>
                              </li>
                              <li>
                                 <p>Set the distinguished names of the databases in which the client wants to receive notifications on the <code class="codeph">Subscription</code> object.
                                 </p>
                              </li>
                              <li>
                                 <p>Set these <code class="codeph">Subscription</code> attributes.
                                 </p>
                                 <p>The <code class="codeph">namespace</code> can be set to these options:
                                 </p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>To receive notifications from AQ queues, <code class="codeph">namespace</code> must be set to <code class="codeph">Subscription::NS_AQ</code>. The subscription name is then either of the form <code class="codeph">SCHEMA.QUEUE</code> when registering on a single consumer queue, or <code class="codeph">SCHEMA.QUEUE:</code><span class="italic"><code class="codeph">CONSUMER_NAME</code></span> when registering on a multiconsumer queue.
                                       </p>
                                    </li>
                                    <li>
                                       <p>To receive notifications from other applications that use <code class="codeph">conn-&gt;postToSubscription()</code> method, <code class="codeph">namespace</code> must be set to <code class="codeph">Subscription::NS_ANONYMOUS</code></p>
                                    </li>
                                 </ul>
                                 <p>The <code class="codeph">protocol</code> can be set to these options:
                                 </p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>If an OCCI client must receive an event notification, this attribute should be set to <code class="codeph">Subscription::PROTO_CBK</code>. You also must set the notification callback and the subscription context before registering the <code class="codeph">Subscription</code>. The notification callback is called when the event occurs.
                                       </p>
                                    </li>
                                    <li>
                                       <p>For an e-mail notification, set the protocol to <code class="codeph">Subscription::PROTO_MAIL</code>. You must then set the recipient name to the e-mail address to which the notifications must be sent.
                                       </p>
                                    </li>
                                    <li>
                                       <p>For an HTTP URL notification, set the protocol to <code class="codeph">Subscription::HTTP</code>. You must set the recipient name to the URL to which the notification must be posted.
                                       </p>
                                    </li>
                                    <li>
                                       <p>To invoke PL/SQL procedures in the database on event notification, set protocol to <code class="codeph">Subscription::PROTO_SERVER</code>. You must set the recipient name to the database procedure invoked on notification.
                                       </p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>Register the subscription: <code class="codeph">environment-&gt;registerSubscriptions()</code>.
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div><a id="LNCPP20472"></a><a id="LNCPP20471"></a><div class="props_rev_3"><a id="GUID-EB87993D-5649-4B73-AD24-6382DA1F8DAB" name="GUID-EB87993D-5649-4B73-AD24-6382DA1F8DAB"></a><h4 id="LNCPP-GUID-EB87993D-5649-4B73-AD24-6382DA1F8DAB" class="sect4"><span class="enumeration_section">10.7.2 </span>About Notification Callback
                  </h4>
                  <div>
                     <p>The client must register a notification callback. This callback is invoked only when
            there is some activity on the registered subscription. In the Database AQ namespace,
            this happens when a message of interest is enqueued.</p>
                     <p>The callback must return <code class="codeph">0</code>, and it must have the following specification:
                     </p><pre class="oac_no_warn" dir="ltr">typedef unsigned int (*callbackfn) (Subscription &amp;sub, NotifyResult *nr);
</pre><p>where:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The <code class="codeph">sub</code> parameter is the <code class="codeph">Subscription</code> object which was used when the callback was registered.
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">nr</code> parameter is the <code class="codeph">NotifyResult</code> object holding the notification info.
                           </p>
                        </li>
                     </ul>
                     <p>Ensure that the subscription object used to register for notifications is not destroyed until it explicitly unregisters the subscription.</p>
                     <p>The user can retrieve the payload, message, message id, queue name and consumer name from the <code class="codeph">NotifyResult</code> object, depending on the source of notification. These results are summarized in <a href="oracle-streams-advanced-queueing.html#GUID-EB87993D-5649-4B73-AD24-6382DA1F8DAB__BABFAACC" title="This table has 4 columns. Column 1 is the Notification Result attributes, column 2 is for ANONYMOUS namespace, column 3 is for AQ namespace with persistent queues, and column 4 is for AQ namespace for non-persistent queues.">Table 10-1</a>. Only a bytes payload is currently supported, and you must explicitly dequeue messages from persistent queues in the AQ namespace. If notifications come from non-persistent queues, messages are available to the callback directly; only <code class="codeph">RAW</code> payloads are supported. If notifications come from persistent queues, the message has to be explicitly dequeued; all payload types are supported.
                     </p>
                     <div class="tblformal" id="GUID-EB87993D-5649-4B73-AD24-6382DA1F8DAB__BABFAACC">
                        <p class="titleintable">Table 10-1 Notification Result Attributes; ANONYMOUS and AQ Namespace</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="Notification Result Attributes; ANONYMOUS and AQ Namespace" summary="This table has 4 columns. Column 1 is the Notification Result attributes, column 2 is for ANONYMOUS namespace, column 3 is for AQ namespace with persistent queues, and column 4 is for AQ namespace for non-persistent queues." width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="23%" id="d72225e3052">Notification Result Attribute</th>
                                 <th align="left" valign="bottom" width="21%" id="d72225e3055">ANONYMOUS Namespace</th>
                                 <th align="left" valign="bottom" width="21%" id="d72225e3058">AQ Namespace, Persistent Queue</th>
                                 <th align="left" valign="bottom" width="35%" id="d72225e3061">AQ Namespace, Non-Persistent Queue</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d72225e3066" headers="d72225e3052 ">
                                    <p>payload</p>
                                 </td>
                                 <td align="left" valign="top" width="21%" headers="d72225e3066 d72225e3055 ">
                                    <p>valid</p>
                                 </td>
                                 <td align="left" valign="top" width="21%" headers="d72225e3066 d72225e3058 ">
                                    <p>invalid</p>
                                 </td>
                                 <td align="left" valign="top" width="35%" headers="d72225e3066 d72225e3061 ">
                                    <p>invalid</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d72225e3079" headers="d72225e3052 ">
                                    <p>message</p>
                                 </td>
                                 <td align="left" valign="top" width="21%" headers="d72225e3079 d72225e3055 ">
                                    <p>invalid</p>
                                 </td>
                                 <td align="left" valign="top" width="21%" headers="d72225e3079 d72225e3058 ">
                                    <p>invalid</p>
                                 </td>
                                 <td align="left" valign="top" width="35%" headers="d72225e3079 d72225e3061 ">
                                    <p>valid</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d72225e3092" headers="d72225e3052 ">
                                    <p>messageID</p>
                                 </td>
                                 <td align="left" valign="top" width="21%" headers="d72225e3092 d72225e3055 ">
                                    <p>invalid</p>
                                 </td>
                                 <td align="left" valign="top" width="21%" headers="d72225e3092 d72225e3058 ">
                                    <p>valid</p>
                                 </td>
                                 <td align="left" valign="top" width="35%" headers="d72225e3092 d72225e3061 ">
                                    <p>valid</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d72225e3105" headers="d72225e3052 ">
                                    <p>consumer name</p>
                                 </td>
                                 <td align="left" valign="top" width="21%" headers="d72225e3105 d72225e3055 ">
                                    <p>invalid</p>
                                 </td>
                                 <td align="left" valign="top" width="21%" headers="d72225e3105 d72225e3058 ">
                                    <p>valid</p>
                                 </td>
                                 <td align="left" valign="top" width="35%" headers="d72225e3105 d72225e3061 ">
                                    <p>valid</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d72225e3118" headers="d72225e3052 ">
                                    <p>queue name</p>
                                 </td>
                                 <td align="left" valign="top" width="21%" headers="d72225e3118 d72225e3055 ">
                                    <p>invalid</p>
                                 </td>
                                 <td align="left" valign="top" width="21%" headers="d72225e3118 d72225e3058 ">
                                    <p>valid</p>
                                 </td>
                                 <td align="left" valign="top" width="35%" headers="d72225e3118 d72225e3061 ">
                                    <p>valid</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
               </div>
            </div><a id="LNCPP20473"></a><div class="props_rev_3"><a id="GUID-2949A76A-680E-481B-AE66-0E8F184199D3" name="GUID-2949A76A-680E-481B-AE66-0E8F184199D3"></a><h3 id="LNCPP-GUID-2949A76A-680E-481B-AE66-0E8F184199D3" class="sect3"><span class="enumeration_section">10.8 </span>About Message Format Transformation
               </h3>
               <div>
                  <p>Applications often use data in different formats, and this requires a type transformation. A transformation is implemented as a SQL function that takes the source data type as input and returns an object of the target data type.Transformations can be applied when message are enqueued, dequeued, or when they are propagated to a remote subscriber.</p>
                  <div class="infoboxnotealso" id="GUID-2949A76A-680E-481B-AE66-0E8F184199D3__GUID-6DB5B199-F08B-4974-AF0D-F659B8FB0330">
                     <p class="notep1">See Also:</p>
                     <p>The following chapters of the <a href="../adque/index.html" target="_blank"><span><cite>Oracle Database Advanced Queuing User's Guide</cite></span></a> for information of format transformation:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="../adque/aq-messaging-gateway-views.html#ADQUE0900" target="_blank">Oracle Streams AQ Administrative Interface</a></p>
                        </li>
                        <li>
                           <p><a href="../adque/aq-introduction.html#ADQUE0100" target="_blank">Oracle Streams AQ Administrative Interface: Views</a></p>
                        </li>
                        <li>
                           <p><a href="../adque/aq-operations-using-pl-sql.html#ADQUE1000" target="_blank">Oracle Streams AQ Operational Interface: Basic Operations</a></p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>