<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>执行RMAN表空间时间点恢复（TSPITR）</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96241-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="rman-recovery-advanced.html" title="Previous" type="text/html"></link>
      <link rel="next" href="rman-recovering-tables-partitions.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="BRADV"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="rman-recovery-advanced.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="rman-recovering-tables-partitions.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">备份和恢复用户指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-diagnosing-responding-failures.html" property="item" typeof="WebPage"><span property="name">诊断和应对失败</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">执行RMAN表空间时间点恢复（TSPITR）</li>
            </ol>
            <a id="GUID-CAACDB53-7C3A-45B4-8249-C5D855D47571" name="GUID-CAACDB53-7C3A-45B4-8249-C5D855D47571"></a><a id="BRADV009"></a>
            
            <h2 id="BRADV-GUID-CAACDB53-7C3A-45B4-8249-C5D855D47571" class="sect2"><span class="enumeration_chapter">21</span>执行RMAN表空间时间点恢复（TSPITR）</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍如何执行RMAN表空间时间点恢复。本章包含以下部分：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><span><a href="performing-rman-tspitr.html#GUID-416AF503-9611-46AA-81A9-7B9E1A0A5AC1" title="要有效地使用RMAN表空间时间点恢复（TSPITR），了解它可以解决的问题类型，组件，RMAN在TSPITR期间所执行的操作以及对何时以及如何进行的各种限制和限制很有帮助。跑。本节介绍运行RMAN TSPITR的基本概念，准备任务和模式。">RMAN TSPITR概述</a></span></p>
                  </li>
                  <li>
                     <p><span><a href="performing-rman-tspitr.html#GUID-26A140F5-652B-4F58-900A-C10AE2780BC3" title="由于某些限制和限制，TSPITR无法解决某些数据库问题。">TSPITR限制，特殊情况和限制</a></span></p>
                  </li>
                  <li>
                     <p><span><a href="performing-rman-tspitr.html#GUID-EDF19841-06BC-4542-BD91-DC6699B3932A" title="准备执行TSPITR时必须完成某些步骤。">规划和准备TSPITR</a></span></p>
                  </li>
                  <li>
                     <p>运行RMAN TSPITR：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span><a href="performing-rman-tspitr.html#GUID-B878E5C6-8E83-4A13-AFC7-249A5B310CFA" title="在默认模式下，RMAN在目标数据库上尽可能多地使用TSPITR的配置。">执行全自动RMAN TSPITR</a></span></p>
                        </li>
                        <li>
                           <p><span><a href="performing-rman-tspitr.html#GUID-6252E21A-E6C5-4269-8666-B5C652558A47" title="您可以自定义RMAN TSPITR的某些方面，同时仍然主要遵循执行全自动RMAN TSPITR的过程。">使用RMAN管理的辅助数据库覆盖RMAN TSPITR的默认值</a></span></p>
                        </li>
                        <li>
                           <p><span><a href="performing-rman-tspitr.html#GUID-D0A465A5-B0D8-4E60-8941-D98DD8AC44D0" title="虽然Oracle建议您让RMAN管理辅助数据库的所有方面，但有时您可能必须创建和管理自己的辅助数据库。如果选择此模式，则负责设置，启动，停止和清理TSPITR中使用的辅助数据库。">使用您自己的辅助数据库执行RMAN TSPITR</a></span></p>
                        </li>
                     </ul>
                  </li>
                  <li>
                     <p><span><a href="performing-rman-tspitr.html#GUID-9B0BADD4-750E-4D74-A816-07E075B0AA96" title="各种问题都可能导致RMAN TSPITR失败。必须确定并修复问题。">RMAN TSPITR疑难解答</a></span></p>
                  </li>
               </ul>
            </div><a id="BRADV89787"></a><div class="props_rev_3"><a id="GUID-416AF503-9611-46AA-81A9-7B9E1A0A5AC1" name="GUID-416AF503-9611-46AA-81A9-7B9E1A0A5AC1"></a><h3 id="BRADV-GUID-416AF503-9611-46AA-81A9-7B9E1A0A5AC1" class="sect3"><span class="enumeration_section">21.1</span> RMAN TSPITR概述</h3>
               <div>
                  <p>要有效地使用RMAN表空间时间点恢复（TSPITR），了解它可以解决的问题类型，组件，RMAN在TSPITR期间所执行的操作以及对何时以及如何进行的各种限制和限制很有帮助。跑。本节介绍运行RMAN TSPITR的基本概念，准备任务和模式。</p>
                  <p></p>
                  <p>要为CDB和PDB执行TSPITR，必须以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的用户身份连接到root。要执行另外一个PDB的TSPITR，您必须备份包含PDB的CDB的根和CDB种子。
                  </p>
               </div><a id="BRADV89788"></a><div class="props_rev_3"><a id="GUID-4ADE81D7-CB75-4C39-AD08-589637C5E750" name="GUID-4ADE81D7-CB75-4C39-AD08-589637C5E750"></a><h4 id="BRADV-GUID-4ADE81D7-CB75-4C39-AD08-589637C5E750" class="sect4"><span class="enumeration_section">21.1.1</span> RMAN TSPITR的目的</h4>
                  <div>
                     <p>Recovery Manager（RMAN）TSPITR可以将数据库中的一个或多个表空间快速恢复到较早的时间，而不会影响数据库中的其余表空间和对象。</p>
                     <p>RMAN TSPITR对以下情况最有用：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>当多个逻辑数据库存在于一个物理数据库的单独表空间中时，将逻辑数据库恢复到与物理数据库的其余部分不同的点。例如，您在<code class="codeph">orders</code>和<code class="codeph">personnel</code>表空间中维护逻辑数据库。不正确的批处理作业或数据操作语言（DML）语句仅在一个表空间中破坏数据。
                           </p>
                        </li>
                        <li>
                           <p>在恢复表结构的数据定义语言（DDL）操作之后恢复丢失的数据。您不能使用闪回表将表回滚到结构更改之前，例如截断表操作。</p>
                        </li>
                        <li>
                           <p>使用<code class="codeph">PURGE</code>选项删除表后恢复表。
                           </p>
                        </li>
                        <li>
                           <p>从表的逻辑损坏中恢复。</p>
                        </li>
                        <li>
                           <p>恢复丢弃的表空间。实际上，即使未使用恢复目录，RMAN也可以在删除的表空间上执行TSPITR。</p>
                        </li>
                     </ul>
                     <p>您也可以使用闪回数据库来回滚数据，但您必须回滚整个数据库而不仅仅是一个子集。此外，与TSPITR不同，闪回数据库功能需要维护闪回日志的开销。您可以闪回数据库的时间点比TSPITR窗口更有限，该窗口可以延伸回最早的可恢复备份。</p>
                  </div>
               </div><a id="BRADV160"></a><div class="props_rev_3"><a id="GUID-635E6A2B-A2AE-4179-9CFE-9E4BA9DAA6C7" name="GUID-635E6A2B-A2AE-4179-9CFE-9E4BA9DAA6C7"></a><h4 id="BRADV-GUID-635E6A2B-A2AE-4179-9CFE-9E4BA9DAA6C7" class="sect4"><span class="enumeration_section">21.1.2</span> RMAN TSPITR的基本概念</h4>
                  <div>
                     <p>了解RMAN TSPITR的概念，例如使用的术语和模式。</p>
                     <p>本节包含以下主题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="performing-rman-tspitr.html#GUID-12D4E92D-884D-4B3D-B415-D3A8BF0A2CA0" title="本节定义了RMAN TSPITR使用的一些公共实体。">RMAN TSPITR的通用术语</a></p>
                        </li>
                        <li>
                           <p><a href="performing-rman-tspitr.html#GUID-84A7CEA3-35C4-4AD6-A640-55F734C45C4E" title="有几种运行RMAN TSPITR的模式。各种操作模式之间的差异对应于您的环境中需要多少自动化与自定义。">RMAN TSPITR的模式</a></p>
                        </li>
                        <li>
                           <p><a href="performing-rman-tspitr.html#GUID-40A9A54A-8742-42D9-AB47-F0B61439A100" title="在执行完全自动化的RMAN TSPITR（默认）之前，从恢复集，辅助目标和目标时间中选择表空间。">RMAN TSPITR如何与RMAN管理的辅助数据库一起使用</a></p>
                        </li>
                     </ul>
                  </div><a id="BRADV372"></a><a id="BRADV371"></a><div class="props_rev_3"><a id="GUID-12D4E92D-884D-4B3D-B415-D3A8BF0A2CA0" name="GUID-12D4E92D-884D-4B3D-B415-D3A8BF0A2CA0"></a><h5 id="BRADV-GUID-12D4E92D-884D-4B3D-B415-D3A8BF0A2CA0" class="sect5"><span class="enumeration_section">21.1.2.1</span> RMAN TSPITR的通用术语</h5>
                     <div>
                        <p>本节定义了RMAN TSPITR使用的一些公共实体。</p>
                        <div class="tblformal" id="GUID-12D4E92D-884D-4B3D-B415-D3A8BF0A2CA0__CIHEAFBF">
                           <p class="titleintable">表21-1 RMAN TSPITR实体</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="RMAN TSPITR实体" width="100%" border="1" summary="TSPITR terms" frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="31%" id="d92175e509">名称</th>
                                    <th align="left" valign="bottom" width="69%" id="d92175e512">说明</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d92175e517" headers="d92175e509 ">
                                       <p>目标实例</p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d92175e517 d92175e512 ">
                                       <p>包含要恢复到目标时间的表空间</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d92175e524" headers="d92175e509 ">
                                       <p>目标时间</p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d92175e524 d92175e512 ">
                                       <p>TSPITR完成后的表空间的时间点或SCN</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d92175e531" headers="d92175e509 ">
                                       <p>辅助数据库</p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d92175e531 d92175e512 ">
                                       <p>用于恢复过程的数据库，用于执行恢复工作。辅助数据库具有与之关联的其他文件。有关完整列表，请参阅辅助集。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d92175e538" headers="d92175e509 ">
                                       <p>辅助目的地</p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d92175e538 d92175e512 ">
                                       <p>RMAN用于临时存储辅助集文件的可选磁盘位置。辅助目标仅用于RMAN管理的辅助数据库。使用用户管理的辅助数据库指定辅助目标会导致错误。</p>
                                       <p>本章中对辅助目标的所有引用都假定使用RMAN管理的辅助数据库。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d92175e547" headers="d92175e509 ">
                                       <p>恢复集</p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d92175e547 d92175e512 ">
                                       <p>要恢复的表空间中的数据文件</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d92175e554" headers="d92175e509 ">
                                       <p>辅助装置</p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d92175e554 d92175e512 ">
                                       <p>TSPITR所需的数据文件不属于恢复集。辅助装置通常包括：</p>
                                       <ul style="list-style-type:disc">
                                          <li>
                                             <p><code class="codeph">SYSTEM</code>和<code class="codeph">SYSAUX</code>表空间。
                                             </p>
                                          </li>
                                          <li>
                                             <p>包含目标数据库实例中的回滚或还原段的数据文件。</p>
                                          </li>
                                          <li>
                                             <p>临时表空间。</p>
                                          </li>
                                          <li>
                                             <p>从源数据库控制文件。</p>
                                          </li>
                                          <li>
                                             <p>必须还原的归档重做日志，以将辅助数据库恢复到指定的时间点。</p>
                                          </li>
                                          <li>
                                             <p>辅助数据库的联机重做日志。这些日志与源数据库的联机重做日志不同。使用<code class="codeph">RESETLOGS</code>选项打开辅助数据库时会创建它们。
                                             </p>
                                          </li>
                                       </ul>
                                       <p>辅助集不包括参数文件，密码文件或关联的网络文件。</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                  </div><a id="BRADV373"></a><div class="props_rev_3"><a id="GUID-84A7CEA3-35C4-4AD6-A640-55F734C45C4E" name="GUID-84A7CEA3-35C4-4AD6-A640-55F734C45C4E"></a><h5 id="BRADV-GUID-84A7CEA3-35C4-4AD6-A640-55F734C45C4E" class="sect5"><span class="enumeration_section">21.1.2.2</span> RMAN TSPITR的模式</h5>
                     <div>
                        <p>有几种运行RMAN TSPITR的模式。各种操作模式之间的差异对应于您的环境中需要多少自动化与自定义。</p>
                        <p>使用RMAN <code class="codeph">RECOVER TABLESPACE</code>命令启动RMAN TSPITR。有三种方法可以运行该实用程序：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>全自动（默认）</p>
                              <p>在此模式下，RMAN管理整个TSPITR进程，包括辅助数据库。您可以指定恢复集的表空间，辅助目标，目标时间，并允许RMAN管理TSPITR的所有其他方面。</p>
                              <p>建议使用默认模式，除非您在TSPITR，TSPITR期间的辅助设置文件，通道设置和参数或辅助数据库的某些其他方面特别需要更多地控制恢复集文件的位置。</p>
                           </li>
                           <li>
                              <p>自动化：带有用户设置的RMAN管理辅助数据库</p>
                              <p>您仍可以使用RMAN管理的辅助数据库和目标来覆盖RMAN TSPITR的某些默认值。默认模式的这种变化使您可以从RMAN TSITR提供的一些内置管理中受益，同时能够指定：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>辅助集或恢复集文件的位置</p>
                                 </li>
                                 <li>
                                    <p>初始化参数</p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>非自动化：TSPITR和用户管理的辅助数据库</p>
                              <p>RMAN TSPITR的这种模式要求您设置和管理辅助数据库的所有方面以及TSPITR过程的某些方面。例如，如果您必须为用户管理的辅助数据库分配不同数量的通道或更改通道参数，则此模式可能是合适的。</p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-84A7CEA3-35C4-4AD6-A640-55F734C45C4E__GUID-AB86B149-8494-487B-9A43-A91FA564319E">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="performing-rman-tspitr.html#GUID-B878E5C6-8E83-4A13-AFC7-249A5B310CFA" title="在默认模式下，RMAN在目标数据库上尽可能多地使用TSPITR的配置。">执行全自动RMAN TSPITR</a></p>
                              </li>
                              <li>
                                 <p><a href="performing-rman-tspitr.html#GUID-6252E21A-E6C5-4269-8666-B5C652558A47" title="您可以自定义RMAN TSPITR的某些方面，同时仍然主要遵循执行全自动RMAN TSPITR的过程。">使用RMAN管理的辅助数据库覆盖RMAN TSPITR的默认值</a></p>
                              </li>
                              <li>
                                 <p><a href="performing-rman-tspitr.html#GUID-D0A465A5-B0D8-4E60-8941-D98DD8AC44D0" title="虽然Oracle建议您让RMAN管理辅助数据库的所有方面，但有时您可能必须创建和管理自己的辅助数据库。如果选择此模式，则负责设置，启动，停止和清理TSPITR中使用的辅助数据库。">使用您自己的辅助数据库执行RMAN TSPITR</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="BRADV374"></a><div class="props_rev_3"><a id="GUID-40A9A54A-8742-42D9-AB47-F0B61439A100" name="GUID-40A9A54A-8742-42D9-AB47-F0B61439A100"></a><h5 id="BRADV-GUID-40A9A54A-8742-42D9-AB47-F0B61439A100" class="sect5"><span class="enumeration_section">21.1.2.3</span> RMAN <span class="enumeration_section">TSPITR</span>如何与RMAN管理的辅助数据库一起使用</h5>
                     <div>
                        <p>在执行完全自动化的RMAN TSPITR（默认）之前，从恢复集，辅助目标和目标时间中选择表空间。</p>
                        <p>RMAN TSPITR的自动化模式共享许多这些高级处理步骤。RMAN TSPITR自动执行以下操作：</p>
                        <ol>
                           <li>
                              <p>如果尚未删除恢复集中的表空间，请通过对恢复集表空间执行<code class="codeph">DBMS_TTS.TRANSPORT_SET_CHECK</code>检查它们是否是自包含的，然后检查视图<code class="codeph">TRANSPORT_SET_VIOLATIONS</code>是否为空。如果查询返回行，RMAN将停止TSPITR处理。在TSPITR可以继续之前，您必须解决任何表空间包含违规。<a href="performing-rman-tspitr.html#GUID-06BAA701-860F-4E3C-AA70-277CCCB7F425__CHDFCCFH">例21-1</a>显示了在调用RMAN TSPITR之前如何设置和运行查询。</p>
                           </li>
                           <li>
                              <p>检查是否提供了与用户管理的辅助数据库的连接。如果是，则RMAN TSPITR使用它。如果没有，RMAN TSPITR将创建辅助数据库，启动它并连接到它。</p>
                           </li>
                           <li>
                              <p>如果尚未删除恢复集中的表空间，则使目标数据库中的表空间在目标数据库中脱机恢复。</p>
                           </li>
                           <li>
                              <p>从目标时间之前的时间点将备份控制文件还原到辅助数据库。</p>
                           </li>
                           <li>
                              <p>将数据文件从恢复集和辅助集还原到辅助数据库。</p>
                              <p>文件在以下位置恢复：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>您为每个文件指定的位置</p>
                                 </li>
                                 <li>
                                    <p>文件的原始位置（用于恢复集数据文件）</p>
                                 </li>
                                 <li>
                                    <p>辅助目标（如果使用了<code class="codeph">RECOVER TABLESPACE</code>的<code class="codeph">AUXILIARY DESTINATION</code>参数和RMAN管理的辅助数据库）</p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>将辅助数据库中已还原的数据文件恢复到指定的时间。</p>
                           </li>
                           <li>
                              <p>使用<code class="codeph">RESETLOGS</code>选项打开辅助数据库。
                              </p>
                           </li>
                           <li>
                              <p>使恢复集表空间在辅助数据库中是只读的。</p>
                           </li>
                           <li>
                              <p>使用Data Pump实用程序从辅助数据库导出恢复集表空间，以生成可传输的表空间转储文件。</p>
                           </li>
                           <li>
                              <p>关闭辅助数据库。</p>
                           </li>
                           <li>
                              <p>从目标中删除恢复集表空间。</p>
                           </li>
                           <li>
                              <p>Data Pump实用程序读取可传输的表空间转储文件，并将恢复集表空间插入目标。</p>
                           </li>
                           <li>
                              <p>使放入目标数据库的表空间可读/写，并立即使它们脱机。</p>
                           </li>
                           <li>
                              <p>删除所有辅助集文件。</p>
                           </li>
                        </ol>
                        <p>此时，RMAN TSPITR已经完成。恢复集数据文件在指定的时间点返回到其内容，并且属于目标数据库。</p>
                        <p>恢复集表空间保持脱机状态，您可以备份然后重新联机。这些最后的步骤遵循Oracle的建议以及TSPITR完成后立即备份恢复的表空间的最佳实践。</p>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV89790"></a><div class="props_rev_3"><a id="GUID-26A140F5-652B-4F58-900A-C10AE2780BC3" name="GUID-26A140F5-652B-4F58-900A-C10AE2780BC3"></a><h3 id="BRADV-GUID-26A140F5-652B-4F58-900A-C10AE2780BC3" class="sect3"><span class="enumeration_section">21.2</span> TSPITR限制，特殊情况和限制</h3>
               <div>
                  <p>由于某些限制和限制，TSPITR无法解决某些数据库问题。</p>
                  <p>以下列表说明了何时<span class="italic">无法</span>执行TSPITR：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>如果没有归档重做日志或数据库在<code class="codeph">NOARCHIVELOG</code>模式下运行。
                        </p>
                     </li>
                     <li>
                        <p>如果使用TSPITR将重命名的表空间恢复到重命名之前的某个时间点，则必须使用表空间的先前名称来执行恢复操作。</p>
                        <p>在这种情况下，当TSPITR完成时，目标数据库包含同一表空间的两个副本，具有新名称的原始表空间和具有旧名称的TSPITR表空间。如果这不是您的目标，那么您可以使用新名称删除新的表空间。</p>
                     </li>
                     <li>
                        <p>如果表空间<code class="codeph">tbs2</code>中包含表空间<code class="codeph">tbs1</code>中的表的约束，那么在不恢复<code class="codeph">tbs2</code>情况下无法恢复<code class="codeph">tbs1</code> 。
                        </p>
                     </li>
                     <li>
                        <p>如果表及其索引存储在不同的表空间中，则必须在执行TSPITR之前删除索引。</p>
                     </li>
                     <li>
                        <p>您无法使用TSPITR来恢复当前的默认表空间。</p>
                     </li>
                     <li>
                        <p>您不能使用TSPITR来恢复包含以下任何对象的表空间：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>具有基础对象（例如物化视图）或包含对象（例如分区表）的对象，除非所有底层或包含的对象都在恢复集中。此外，如果分区表的分区存储在不同的表空间中，则必须在执行TSPITR之前删除该表，或者在执行TSPITR之前将所有分区移动到同一表空间。</p>
                           </li>
                           <li>
                              <p>撤消或回滚段</p>
                           </li>
                           <li>
                              <p>与多个收件人兼容的Oracle8兼容高级队列</p>
                           </li>
                           <li>
                              <p>用户<code class="codeph">SYS</code>拥有的对象。这些类型的对象的示例是：PL / SQL，Java类，标注程序，视图，同义词，用户，特权，维度，目录和序列。
                              </p>
                           </li>
                        </ul>
                     </li>
                  </ul>
               </div><a id="BRADV89791"></a><div class="props_rev_3"><a id="GUID-CED74BCC-D938-46A4-AEE5-3F9A80B16F3D" name="GUID-CED74BCC-D938-46A4-AEE5-3F9A80B16F3D"></a><h4 id="BRADV-GUID-CED74BCC-D938-46A4-AEE5-3F9A80B16F3D" class="sect4"><span class="enumeration_section">21.2.1</span> TSPITR的局限性</h4>
                  <div>
                     <p>执行TSPITR时需要考虑一些限制。</p>
                     <p>TSPITR完成后，RMAN将恢复集中的数据文件恢复到目标时间。请注意以下特殊情况：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>TSPITR不会恢复已恢复对象的查询优化程序统计信息。您必须在TSPITR完成后收集新的统计信息。</p>
                        </li>
                        <li>
                           <p>如果你在一个表空间运行TSPITR与<span class="italic">时刻</span>带来的表空间联机，那么之前时间<span class="italic">t</span>创建的表空间的备份不再与当前控制文件恢复使用。您不能使用当前控制文件将数据库恢复到小于或等于<span class="italic">t的</span>任何时间。
                           </p>
                        </li>
                        <li>
                           <p>如果恢复集中的一个或多个数据文件具有Oracle托管文件（OMF）名称，并且目标数据库中的兼容性设置为10.1或更早版本，则RMAN无法重用该数据文件。即使没有为数据文件提供SET NEWNAME命令，此限制也是如此。为恢复集数据文件创建新的OMF名称。此操作会暂时将数据文件的空间要求加倍。这是因为<code class="codeph">DB_CREATE_FILE_DEST</code>具有数据文件的两个副本（原始数据文件和TSPITR使用的文件），直到在目标中删除表空间并删除原始数据文件。
                           </p>
                        </li>
                     </ul>
                     <p>RMAN使用可传输表空间功能来执行TSPITR。因此，对可传输表空间的任何限制也适用于TSPITR。</p>
                     <div class="infoboxnotealso" id="GUID-CED74BCC-D938-46A4-AEE5-3F9A80B16F3D__GUID-74D09E41-B50D-46AE-8C7A-599DF8A0E674">
                        <p class="notep1">也可以看看：</p>
                        <p>有关可传输表空间限制的信息，请参见<a href="../admin/transporting-data.html#ADMIN13896" target="_blank"><span><cite>“Oracle数据库管理员指南”</cite></span></a></p>
                     </div>
                  </div>
               </div><a id="BRADV89792"></a><div class="props_rev_3"><a id="GUID-AB95A6DD-C28E-4788-9B2E-916541F38119" name="GUID-AB95A6DD-C28E-4788-9B2E-916541F38119"></a><h4 id="BRADV-GUID-AB95A6DD-C28E-4788-9B2E-916541F38119" class="sect4"><span class="enumeration_section">21.2.2</span>关于不使用恢复目录时的特殊注意事项</h4>
                  <div>
                     <p>在TSPITR期间不使用恢复目录时，请注意某些预防措施。</p>
                     <p>预防措施包括以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>由于RMAN在控制文件中没有撤消的历史记录，因此RMAN假定当前具有回滚或撤消段的表空间集与执行恢复时存在的设置相同。如果表空间集自那时起已更改，则当前回滚段或还原段是执行恢复时存在的相同段。如果自那时以来撤消段已更改，则可以使用<code class="codeph">UNDO TABLESPACE</code>在恢复表空间的时间点使用undo指示正确的表空间集。
                           </p>
                        </li>
                        <li>
                           <p>如果Oracle数据库重用了所需备份的控制文件记录，则TSPITR到太旧的时间可能会失败。（在规划数据库时，将<code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code>初始化参数设置为足够大的值，以确保保留TSPITR所需的控制文件记录。）
                           </p>
                        </li>
                        <li>
                           <p>要在不使用恢复目录时重新运行TSPITR，必须首先从目标数据库中删除TSPITR使用的表空间。</p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div><a id="BRADV161"></a><div class="props_rev_3"><a id="GUID-EDF19841-06BC-4542-BD91-DC6699B3932A" name="GUID-EDF19841-06BC-4542-BD91-DC6699B3932A"></a><h3 id="BRADV-GUID-EDF19841-06BC-4542-BD91-DC6699B3932A" class="sect3"><span class="enumeration_section">21.3</span>规划和准备TSPITR</h3>
               <div>
                  <p>准备执行TSPITR时必须完成某些步骤。</p>
                  <div class="p">
                     <p><span class="bold">为TSPITR做准备：</span></p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li><span>阅读并理解<span class="q">“ <a href="performing-rman-tspitr.html#GUID-26A140F5-652B-4F58-900A-C10AE2780BC3" title="由于某些限制和限制，TSPITR无法解决某些数据库问题。">TSPITR限制，特殊情况和限制</a> ”中</span>描述的注意事项。</span></li>
                     <li><span>选择必须恢复表空间的目标时间，如<span class="q">“ <a href="performing-rman-tspitr.html#GUID-02085787-2BE7-47DD-9D82-1DA6BBBE4366" title="为TSPITR选择正确的目标时间或SCN非常重要。请注意，在TSPITR之后将表空间联机后，您不能在使表空间联机的时间之前使用任何备份。">为TSPITR选择正确的目标时间</a> ”中所述</span> 。</span></li>
                     <li><span>确定恢复集，如<span class="q">“ <a href="performing-rman-tspitr.html#GUID-06C4F27C-F044-4FC3-87E9-44CF0FF7CD66" title="最初，恢复集包括要恢复的表空间的数据文件。但是，如果表空间中的对象需要与其他表空间中的对象建立关系（例如约束），则必须先考虑这些关系才能执行TSPITR">确定恢复集</a> ”中所述</span> 。</span></li>
                     <li><span>识别并保留在TSPITR操作完成后将丢失的对象，如<span class="q">“ <a href="performing-rman-tspitr.html#GUID-9276F56B-D7A7-4583-9011-9743365AAF38" title="在表空间上执行RMAN TSPITR时，在目标恢复时间之后创建的对象将丢失。您可以通过在TSPITR之前使用数据泵导出实用程序导出这些对象并在之后使用数据泵导入重新导入这些对象来保留这些对象。">识别和保留TSPITR之后丢失的对象</a> ”中所述</span> 。</span></li>
                  </ol>
               </div><a id="BRADV910"></a><div class="props_rev_3"><a id="GUID-02085787-2BE7-47DD-9D82-1DA6BBBE4366" name="GUID-02085787-2BE7-47DD-9D82-1DA6BBBE4366"></a><h4 id="BRADV-GUID-02085787-2BE7-47DD-9D82-1DA6BBBE4366" class="sect4"><span class="enumeration_section">21.3.1为TSPITR</span>选择正确的目标时间</h4>
                  <div>
                     <p>为TSPITR选择正确的目标时间或SCN非常重要。请注意，在TSPITR之后将表空间联机后，您不能在使表空间联机的时间之前使用任何备份。</p>
                     <div class="section">
                        <p>如果您有恢复目录，则可以对不同的目标时间执行重复的TSPITR操作，因为目录包含表空间历史记录信息。但是，如果RMAN仅使用控制文件，则只有在删除表空间后才能重复TSPITR，因为控制文件没有表空间历史记录。在这种情况下，RMAN只知道当前的表空间集。执行TSPITR的表空间的创建时间等于联机时间。</p>
                        <p>要确定TSPITR的目标时间，请调查数据的过去状态，并使用以下技术之一找到发生意外更改的时间点：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>闪回查询</p>
                           </li>
                           <li>
                              <p>Oracle事务查询</p>
                           </li>
                           <li>
                              <p>闪回版本查询</p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-02085787-2BE7-47DD-9D82-1DA6BBBE4366__GUID-373E7070-F660-45B8-BF1A-814809AC09C6">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="performing-rman-tspitr.html#GUID-26A140F5-652B-4F58-900A-C10AE2780BC3" title="由于某些限制和限制，TSPITR无法解决某些数据库问题。">TSPITR限制，特殊情况和限制</a> ”</span></p>
                              </li>
                              <li>
                                 <p>有关闪回查询，闪回事务查询和闪回版本查询的详细信息，请参阅<a href="../adfns/flashback.html#ADFNS1008" target="_blank"><span><cite>“Oracle数据库开发指南”</cite></span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV89793"></a><div class="props_rev_3"><a id="GUID-06C4F27C-F044-4FC3-87E9-44CF0FF7CD66" name="GUID-06C4F27C-F044-4FC3-87E9-44CF0FF7CD66"></a><h4 id="BRADV-GUID-06C4F27C-F044-4FC3-87E9-44CF0FF7CD66" class="sect4"><span class="enumeration_section">21.3.2</span>确定恢复集</h4>
                  <div>
                     <p>最初，恢复集包括要恢复的表空间的数据文件。但是，如果表空间中的对象需要与其他表空间中的对象建立关系（例如约束），则必须先考虑这些关系才能执行TSPITR</p>
                     <div class="section">
                        <p>面对这样的关系时，您有以下选择：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>将包含相关对象的表空间添加到恢复集</p>
                           </li>
                           <li>
                              <p>删除关系</p>
                           </li>
                           <li>
                              <p>暂停TSPITR持续时间的关系</p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-06C4F27C-F044-4FC3-87E9-44CF0FF7CD66__GUID-0DC4035E-6FD6-41C5-9A5E-454BD3CCF5F8">
                           <p class="notep1">也可以看看：</p>
                           <p><span class="q">“ <a href="performing-rman-tspitr.html#GUID-06BAA701-860F-4E3C-AA70-277CCCB7F425" title="RMAN TSPITR要求正在恢复的表空间是自包含的，并且表空间中不存在SYS拥有的对象。">识别并解决主数据库上的依赖关系</a> ”，</span>以获取有关解析与其他表空间的关系的信息</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div><a id="BRADV375"></a><a id="BRADV89794"></a><div class="props_rev_3"><a id="GUID-06BAA701-860F-4E3C-AA70-277CCCB7F425" name="GUID-06BAA701-860F-4E3C-AA70-277CCCB7F425"></a><h5 id="BRADV-GUID-06BAA701-860F-4E3C-AA70-277CCCB7F425" class="sect5"><span class="enumeration_section">21.3.2.1</span>识别和解决主数据库的依赖关系</h5>
                     <div>
                        <p>RMAN TSPITR要求正在恢复的表空间是自包含的，并且没有<code class="codeph">SYS</code>拥有的对象驻留在表空间中。
                        </p>
                        <div class="section">
                           <p><span class="bold">识别和解决依赖关系：</span></p>
                           <ol>
                              <li>
                                 <p>使用<code class="codeph">DBMS_TTS.TRANSPORT_SET_CHECK</code>过程查找表空间外的对象，并标识跨越恢复集边界的对象之间的关系。
                                 </p>
                                 <p>如果<code class="codeph">TRANSPORT_SET_VIOLATIONS</code>视图返回行，则必须根据<span class="q">“ <a href="performing-rman-tspitr.html#GUID-06C4F27C-F044-4FC3-87E9-44CF0FF7CD66" title="最初，恢复集包括要恢复的表空间的数据文件。但是，如果表空间中的对象需要与其他表空间中的对象建立关系（例如约束），则必须先考虑这些关系才能执行TSPITR">确定恢复集</a> ”中</span>描述的选项调查并更正问题。
                                 </p>
                              </li>
                              <li>
                                 <p>记录在此步骤中执行的所有操作，以便您可以在完成TSPITR后重新创建任何已暂停或已删除的关系。</p>
                                 <p><span class="italic">仅</span>当<code class="codeph">TRANSPORT_SET_VIOLATIONS</code>视图对于恢复集中的表空间为空时， <span class="italic">才</span>继续执行TSPITR。
                                 </p>
                              </li>
                           </ol>
                           <div class="infoboxnote" id="GUID-06BAA701-860F-4E3C-AA70-277CCCB7F425__GUID-AC28A0EE-8DFF-46AD-9BCC-8549B851C4C2">
                              <p class="notep1">注意：</p>
                              <p>如果已删除恢复集中的一个或多个表空间，则RMAN TSPITR无法运行<code class="codeph">DBMS_TTS.TRANSPORT_SET_CHECK</code>过程。在这种情况下， <code class="codeph">DBMS_TTS.TRANSPORT_SET_CHECK</code>在辅助数据库的数据泵导出时运行。就像RMAN TSPITR一样，如果导出操作遇到任何非自包含的表空间，它将失败。
                              </p>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-06BAA701-860F-4E3C-AA70-277CCCB7F425__CHDFCCFH">
                           <p class="titleinexample">示例21-1查询表空间子集的DBMS_TTS.TRANSPORT_SET_CHECK</p>
                           <p>此示例说明如何将<code class="codeph">DBMS_TTS.TRANSPORT_SET_CHECK</code>过程用于由表空间<code class="codeph">tools</code>和<code class="codeph">users</code>组成的初始恢复集。它查询可传输的表空间违例表以管理任何依赖项。管理所有依赖项时，不会从此查询返回任何行。
                           </p><pre class="oac_no_warn" dir="ltr">BEGIN DBMS_TTS.TRANSPORT_SET_CHECK（'USERS，TOOLS'，TRUE，TRUE）;结束; / SELECT * FROM TRANSPORT_SET_VIOLATIONS;</pre><div class="infoboxnotealso" id="GUID-06BAA701-860F-4E3C-AA70-277CCCB7F425__GUID-35ACE992-C02B-498D-AAC9-E6E4CBBC91BC">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="../arpls/DBMS_TTS.html#ARPLS68936" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>有关<code class="codeph">DBMS_TTS.TRANSPORT_SET_CHECK</code>过程和相应视图的更多信息</p>
                           </div>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div><a id="BRADV376"></a><a id="BRADV377"></a><a id="BRADV378"></a><a id="BRADV89795"></a><div class="props_rev_3"><a id="GUID-9276F56B-D7A7-4583-9011-9743365AAF38" name="GUID-9276F56B-D7A7-4583-9011-9743365AAF38"></a><h4 id="BRADV-GUID-9276F56B-D7A7-4583-9011-9743365AAF38" class="sect4"><span class="enumeration_section">21.3.3</span>识别和保留TSPITR后丢失的对象</h4>
                  <div>
                     <p>在表空间上执行RMAN TSPITR时，在目标恢复时间之后创建的对象将丢失。您可以通过在TSPITR之前使用数据泵导出实用程序导出这些对象并在之后使用数据泵导入重新导入这些对象来保留这些对象。</p>
                     <div class="section">
                        <p>要确定在TSPITR中丢失了哪些对象，请查询主数据库上的<code class="codeph">TS_PITR_OBJECTS_TO_BE_DROPPED</code>视图。过滤<code class="codeph">CREATION_TIME</code>在TSPITR目标时间之后的对象的视图。下表描述了视图的内容。
                        </p>
                        <div class="tblformal" id="GUID-9276F56B-D7A7-4583-9011-9743365AAF38__G1040808">
                           <p class="titleintable">表21-2 TS_PITR_OBJECTS_TO_BE_DROPPED视图</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="TS_PITR_OBJECTS_TO_BE_DROPPED查看" width="100%" border="1" summary="This table describes columns in the TS_PITR_OBJECTS_TO_BE_DROPPED view." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="33%" id="d92175e1766">列名称</th>
                                    <th align="left" valign="bottom" width="67%" id="d92175e1769">含义</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="33%" id="d92175e1774" headers="d92175e1766 ">
                                       <p><code class="codeph">所有者</code></p>
                                    </td>
                                    <td align="left" valign="top" width="67%" headers="d92175e1774 d92175e1769 ">
                                       <p>要删除的对象的所有者</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="33%" id="d92175e1782" headers="d92175e1766 ">
                                       <p><code class="codeph">名称</code></p>
                                    </td>
                                    <td align="left" valign="top" width="67%" headers="d92175e1782 d92175e1769 ">
                                       <p>通过TSPITR丢失的对象的名称</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="33%" id="d92175e1790" headers="d92175e1766 ">
                                       <p><code class="codeph">CREATION_TIME</code></p>
                                    </td>
                                    <td align="left" valign="top" width="67%" headers="d92175e1790 d92175e1769 ">
                                       <p>对象的创建时间戳</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="33%" id="d92175e1798" headers="d92175e1766 ">
                                       <p><code class="codeph">TABLESPACE_NAME</code></p>
                                    </td>
                                    <td align="left" valign="top" width="67%" headers="d92175e1798 d92175e1769 ">
                                       <p>包含该对象的表空间的名称</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-9276F56B-D7A7-4583-9011-9743365AAF38__CHDJAEFG">
                        <p class="titleinexample">例21-2查询TS_PITR_OBJECTS_TO_BE_DROPPED</p>
                        <p>此示例显示执行TSPITR时需要保留的对象，其中恢复集由<code class="codeph">users</code>和<code class="codeph">tools</code>组成，恢复时间为2017年11月2日上午7:03:11。
                        </p><pre class="oac_no_warn" dir="ltr">选择所有者，NAME，TABLESPACE_NAME，TO_CHAR（CREATION_TIME，'YYYY-MM-DD：HH24：MI：SS'）来自TS_PITR_OBJECTS_TO_BE_DROPPED TABLESPACE_NAME IN（'USERS'，'TOOLS'）和CREATION_TIME&gt; TO_DATE（'02 -NOV-17 ：07：03：11'，'YY-MON-DD：HH24：MI：SS'）由TABLESPACE_NAME订购，CREATION_TIME;</pre><p><code class="codeph">TO_CHAR</code>和<code class="codeph">TO_DATE</code>函数用于避免使用不同的国家日期格式。当然，您可以在自己的工作中使用本地日期格式。
                        </p>
                     </div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-9276F56B-D7A7-4583-9011-9743365AAF38__CIHJBAFB">
                        <p class="titleinexample">例21-3使用SCN和TS_PITR_OBJECTS_TO_BE_DROPPED</p>
                        <p>如果恢复表空间<code class="codeph">USERS</code>和<code class="codeph">TOOLS</code>的SCN是1645870，则此示例确定要删除的对象。使用转换函数确定与SCN关联的时间戳和丢弃的对象。
                        </p><pre class="oac_no_warn" dir="ltr">选择所有者，名称，TABLESPACE_NAME，TO_CHAR（CREATION_TIME，'YYYY-MM-DD：HH24：MI：SS'）来自TS_PITR_OBJECTS_TO_BE_DROPPED在哪里TABLESPACE_NAME IN（'USERS'，'TOOLS'）和CREATION_TIME&gt; TO_DATE（TO_CHAR（SCN_TO_TIMESTAMP（1645870）） ，'MM / DD / YYYY HH24：MI：SS'），'MM / DD / YYYY HH24：MI：SS'）TABLESPACE_NAME订购，CREATION_TIME;</pre><div class="infoboxnotealso" id="GUID-9276F56B-D7A7-4583-9011-9743365AAF38__GUID-F6E456DF-1C35-4152-9A39-231167BA8776">
                           <p class="notep1">也可以看看：</p>
                           <p>有关<code class="codeph">TS_PITR_OBJECTS_TO_BE_DROPPED</code>视图的更多信息，请<code class="codeph">TS_PITR_OBJECTS_TO_BE_DROPPED</code> <a href="../refrn/TS_PITR_OBJECTS_TO_BE_DROPPED.html#REFRN29022" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div><a id="BRADV379"></a><a id="BRADV89796"></a><div class="props_rev_3"><a id="GUID-B878E5C6-8E83-4A13-AFC7-249A5B310CFA" name="GUID-B878E5C6-8E83-4A13-AFC7-249A5B310CFA"></a><h3 id="BRADV-GUID-B878E5C6-8E83-4A13-AFC7-249A5B310CFA" class="sect3"><span class="enumeration_section">21.4</span>执行全自动RMAN TSPITR</h3>
               <div>
                  <p>在默认模式下，RMAN在目标数据库上尽可能多地使用TSPITR的配置。</p>
                  <div class="section">
                     <p>在TSPITR期间，恢复集数据文件将写入目标数据库的当前位置（对于OMF文件，请参阅<span class="q">“ <a href="performing-rman-tspitr.html#GUID-CED74BCC-D938-46A4-AEE5-3F9A80B16F3D" title="执行TSPITR时需要考虑一些限制。">TSPITR的限制</a> ”</span> ）。从备份还原文件时，辅助数据库上将使用相同的目标数据库通道配置。然而，辅助设置数据文件和其他辅助数据库文件存储在辅助目的地中。
                     </p>
                     <p>使用<code class="codeph">AUXILIARY DESTINATION</code>参数设置RMAN用于辅助集数据文件的位置。辅助目标必须是磁盘上的位置，并且有足够的空间来容纳辅助设置数据文件。即使您使用其他技术重命名部分或全部辅助集数据文件，指定<code class="codeph">AUXILIARY DESTINATION</code>参数也会为未指定名称的辅助集数据文件提供默认位置。如果您无意中未提供所有辅助设置数据文件的名称，则TSPITR不会失败。
                     </p>
                     <p>要执行完全自动化的RMAN TSPITR，执行TSPITR的用户必须能够使用操作系统身份验证连接<code class="codeph">SYSBACKUP</code>或<code class="codeph">SYSDBA</code>权限。
                     </p>
                     <p><span class="bold">要执行全自动RMAN TSPITR：</span></p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>查看<span class="q">“ <a href="performing-rman-tspitr.html#GUID-26A140F5-652B-4F58-900A-C10AE2780BC3" title="由于某些限制和限制，TSPITR无法解决某些数据库问题。">TSPITR限制，特殊情况和限制</a> ”中的信息</span> 。</span></li>
                     <li class="stepexpand"><span>执行<span class="q">“ <a href="performing-rman-tspitr.html#GUID-EDF19841-06BC-4542-BD91-DC6699B3932A" title="准备执行TSPITR时必须完成某些步骤。">规划和准备TSPITR</a> ”中</span>的任务。</span></li>
                     <li class="stepexpand"><span>在目标数据库上启动RMAN会话，并在适用的情况下连接到恢复目录，如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a> ”中所述</span> 。</span><div>
                           <div class="infoboxnote" id="GUID-B878E5C6-8E83-4A13-AFC7-249A5B310CFA__GUID-6815E5FF-3DFF-4760-B06D-09208680E111">
                              <p class="notep1">注意：</p>
                              <p>启动自动TSPITR的RMAN客户端时，请勿连接到辅助数据库。如果在运行<code class="codeph">RECOVER TABLESPACE</code>时RMAN连接到辅助数据库，则RMAN假定您正在管理自己的辅助数据库，如<span class="q">“ <a href="performing-rman-tspitr.html#GUID-D0A465A5-B0D8-4E60-8941-D98DD8AC44D0" title="虽然Oracle建议您让RMAN管理辅助数据库的所有方面，但有时您可能必须创建和管理自己的辅助数据库。如果选择此模式，则负责设置，启动，停止和清理TSPITR中使用的辅助数据库。">使用您自己的辅助数据库执行RMAN TSPITR</a> ”中所述</span> ，并尝试将连接的辅助用于TSPITR。</p>
                           </div>
                        </div>
                     </li>
                     <li class="stepexpand"><span>在目标实例上配置TSPITR所需的任何通道。</span><div>
                           <p>执行TSPITR时，辅助数据库使用与目标实例相同的通道配置。</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>运行<code class="codeph">RECOVER TABLESPACE</code>命令，同时指定<code class="codeph">UNTIL</code>子句和<code class="codeph">AUXILIARY DESTINATION</code>参数。</span><div>
                           <p>此示例将<code class="codeph">USERS</code>和<code class="codeph">TOOLS</code>表空间返回到日志序列号1299的末尾，并将辅助集文件存储在<code class="codeph">/disk1/auxdest</code>目录中。
                           </p><pre class="oac_no_warn" dir="ltr">RECOVER TABLESPACE用户，工具UNTIL LOGSEQ 1300 THREAD 1 AUXILIARY DESTINATION'/ disk1 / auxdest';</pre></div>
                     </li>
                     <li class="stepexpand"><span>查看<code class="codeph">RECOVER</code>命令的结果以确定要采取的步骤：</span><div>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>如果在TSPITR期间没有发生错误，则继续执行步骤<a href="performing-rman-tspitr.html#GUID-B878E5C6-8E83-4A13-AFC7-249A5B310CFA__CHDCGEEF">7</a> 。
                                 </p>
                                 <p>表空间由RMAN脱机，从备份恢复并恢复到辅助数据库上的所需时间点，然后重新导入到目标数据库。表空间保持脱机状态。从辅助目标清除所有辅助设置数据文件和其他辅助数据库文件。</p>
                              </li>
                              <li>
                                 <p>如果在TSPITR期间发生错误，则继续执行<span class="q">“ <a href="performing-rman-tspitr.html#GUID-9B0BADD4-750E-4D74-A816-07E075B0AA96" title="各种问题都可能导致RMAN TSPITR失败。必须确定并修复问题。">RMAN TSPITR故障排除</a> ”</span> 。
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </li>
                     <li class="stepexpand" id="GUID-B878E5C6-8E83-4A13-AFC7-249A5B310CFA__CHDCGEEF"><span>如果TSPITR成功完成，则在将恢复的表空间联机之前备份它们。</span><div>
                           <p>例如，输入以下命令：</p><pre class="oac_no_warn" dir="ltr">BACKUP TABLESPACE用户，工具;</pre><p>在表空间上执行TSPITR后，在TSPITR成功完成后，您将无法再使用该表空间的先前备份。如果在不进行备份的情况下使用恢复的表空间，则运行数据库而不使用这些表空间的可用备份。</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>将表空间重新联机。</span><div>
                           <p>例如，输入以下命令：</p><pre class="oac_no_warn" dir="ltr">RMAN&gt; ALTER TABLESPACE用户，工具ONLINE;</pre><p>您恢复的表空间现在可以使用了。</p>
                        </div>
                     </li>
                  </ol>
               </div>
            </div><a id="BRADV89797"></a><div class="props_rev_3"><a id="GUID-6252E21A-E6C5-4269-8666-B5C652558A47" name="GUID-6252E21A-E6C5-4269-8666-B5C652558A47"></a><h3 id="BRADV-GUID-6252E21A-E6C5-4269-8666-B5C652558A47" class="sect3"><span class="enumeration_section">21.5</span>使用RMAN管理的辅助数据库覆盖RMAN TSPITR的默认值</h3>
               <div>
                  <p>您可以自定义RMAN TSPITR的某些方面，同时仍然主要遵循执行全自动RMAN TSPITR的过程。</p>
                  <p>这些包括以下内容：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>重命名或重定位恢复集数据文件，以便构成恢复的表空间的数据文件不会存储在TSPITR之后的原始位置。如果最初包含表空间的磁盘不可用，则可能需要这样做。</p>
                     </li>
                     <li>
                        <p>为某些或所有辅助设置数据文件指定辅助目标以外的位置。如果磁盘上没有单个位置具有足够的空间用于所有辅助集文件，则可以选择此选项。</p>
                     </li>
                     <li>
                        <p>以Oracle托管文件格式重命名文件。</p>
                     </li>
                     <li>
                        <p>提前设置辅助设置数据文件的映像副本备份，以避免在TSPITR期间恢复数据文件。</p>
                     </li>
                     <li>
                        <p>自定义RMAN管理的辅助数据库的初始化参数。</p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-6252E21A-E6C5-4269-8666-B5C652558A47__GUID-A7070A19-BE4E-410B-A285-BCA8A98DE18E">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="q">“ <a href="performing-rman-tspitr.html#GUID-1C46D7E5-1A2B-486D-9BE0-88F4B71C7C49" title="您可能不希望恢复集数据文件在其原始位置恢复和恢复。SET NEWNAME命令可用于指定新目标。为恢复集指定新目标时，RMAN不会删除表空间的原始数据文件。">使用SET NEWNAME重命名TSPITR恢复集数据文件</a> ”</span></p>
                        </li>
                        <li>
                           <p><span class="q">“ <a href="performing-rman-tspitr.html#GUID-A834CFEB-C099-40A5-AEAF-349BE084AC70" title="与通常存储在其原始位置的恢复集数据文件不同，辅助集数据文件不得覆盖目标数据库中的相应原始文件。如果未指定与其原始位置不同的辅助集文件位置，则TSPITR将失败。当RMAN尝试覆盖原始数据库中的相应文件并发现正在使用的文件时，会发生故障。">命名TSPITR辅助设置数据文件</a> ”</span></p>
                        </li>
                        <li>
                           <p><span class="q">“ <a href="performing-rman-tspitr.html#GUID-1E3933FC-9FA4-4012-B59D-A27406A86419" title="辅助集数据文件可以在目标中具有Oracle管理文件（OMF），并且可以使用自动存储管理（ASM）或非ASM存储。当设置了DB_FILE_NAME_CONVERT初始化参数且OMF文件位于ASM或非ASM存储中时，TSPITR以不同方式执行名称转换。">在TSPITR中重命名OMF辅助设置文件时的注意事项</a> ”</span></p>
                        </li>
                        <li>
                           <p><span class="q">“ <a href="performing-rman-tspitr.html#GUID-C3ACA139-02C3-4DED-978D-DCD785724AC4" title="通过重定向RMAN以使用恢复集和辅助集数据文件的现有映像副本，可以增强TSPITR性能。在这种情况下，RMAN不需要从备份还原数据文件。">使用映像副本实现更快的RMAN TSPITR性能</a> ”</span></p>
                        </li>
                        <li>
                           <p><span class="q">“ <a href="performing-rman-tspitr.html#GUID-A86E8164-690C-49B7-B978-85E460DA2AC6" title="自动辅助数据库使用一组默认初始化参数。如果需要，您可以添加其他参数。">自定义TSPITR中自动辅助数据库的初始化参数</a> ”</span></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="BRADV381"></a><a id="BRADV89799"></a><div class="props_rev_3"><a id="GUID-1C46D7E5-1A2B-486D-9BE0-88F4B71C7C49" name="GUID-1C46D7E5-1A2B-486D-9BE0-88F4B71C7C49"></a><h4 id="BRADV-GUID-1C46D7E5-1A2B-486D-9BE0-88F4B71C7C49" class="sect4"><span class="enumeration_section">21.5.1</span>使用SET NEWNAME重命名TSPITR恢复集数据文件</h4>
                  <div>
                     <p>您可能不希望恢复集数据文件在其原始位置恢复和恢复。<code class="codeph">SET NEWNAME</code>命令可用于指定新目标。为恢复集指定新目标时，RMAN不会删除表空间的原始数据文件。
                     </p>
                     <div class="section">
                        <p>要指定新的恢复集文件名，请创建一个<code class="codeph">RUN</code>块并在其中使用<code class="codeph">SET NEWNAME</code>命令。请务必指定彼此不冲突的名称或与当前数据文件的名称冲突的名称。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-1C46D7E5-1A2B-486D-9BE0-88F4B71C7C49__CHDBDCCA">
                        <p class="titleinexample">示例21-4重命名恢复集文件</p>
                        <p>此示例为恢复集数据文件指定新名称。在此示例中，RMAN执行以下操作：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>在TSPITR期间将每个指定的数据文件还原到新位置。</p>
                           </li>
                           <li>
                              <p>如果映像副本存在于指定位置且其检查点位于指定时间点之前，则使用映像副本。如果不满足此条件，则RMAN将覆盖映像副本。</p>
                           </li>
                           <li>
                              <p>将新恢复的数据文件插入目标控制文件。</p>
                           </li>
                        </ul>
                        <p>在实际恢复之前，RMAN不会检测使用<code class="codeph">SET NEWNAME</code>设置的名称与目标数据库上的当前数据文件名之间的冲突。如果RMAN检测到冲突，则TSPITR失败并且RMAN报告错误。有效数据文件不会被覆盖。
                        </p><pre class="oac_no_warn" dir="ltr">跑 { 。。。FOR DATAFILE <span class="italic">'ORACLE_HOME</span> /oradata/trgt/users01.dbf' TO '/newfs/users01.dbf' SET NEWNAME; <span class="italic">...其他SET NEWNAME命令......</span>RECOVER TABLESPACE用户，工具UNTIL SEQUENCE 1300 THREAD 1; }</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="BRADV382"></a><a id="BRADV89800"></a><div class="props_rev_3"><a id="GUID-A834CFEB-C099-40A5-AEAF-349BE084AC70" name="GUID-A834CFEB-C099-40A5-AEAF-349BE084AC70"></a><h4 id="BRADV-GUID-A834CFEB-C099-40A5-AEAF-349BE084AC70" class="sect4"><span class="enumeration_section">21.5.2</span>命名TSPITR辅助集数据文件</h4>
                  <div>
                     <p>与通常存储在其原始位置的恢复集数据文件不同，辅助集数据文件不得覆盖目标数据库中的相应原始文件。如果未指定与其原始位置不同的辅助集文件位置，则TSPITR将失败。当RMAN尝试覆盖原始数据库中的相应文件并发现正在使用的文件时，会发生故障。</p>
                     <div class="section">
                        <p>为辅助集数据文件提供位置的最简单方法是为TSPITR指定辅助目标。但是，RMAN支持以下备选方案来控制辅助集数据文件的位置，这些文件按<a href="performing-rman-tspitr.html#GUID-A834CFEB-C099-40A5-AEAF-349BE084AC70__CHDGAFGB" title="描述优先顺序：set newname，configure auxname，db_file_name_convert和辅助目标">表21-3中</a>所示的优先顺序列出。
                        </p>
                        <div class="tblformal" id="GUID-A834CFEB-C099-40A5-AEAF-349BE084AC70__CHDGAFGB">
                           <p class="titleintable">表21-3命名文件的优先顺序</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="命名文件的优先顺序" width="100%" border="1" summary="Describes order of precedence: set newname, configure auxname, db_file_name_convert, and auxiliary destination" frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="12%" id="d92175e2419">订购</th>
                                    <th align="left" valign="bottom" width="38%" id="d92175e2422">技术</th>
                                    <th align="left" valign="bottom" width="50%" id="d92175e2425">部分</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="12%" id="d92175e2430" headers="d92175e2419 ">
                                       <p>1</p>
                                    </td>
                                    <td align="left" valign="top" width="38%" headers="d92175e2430 d92175e2422 ">
                                       <p><code class="codeph">设置NEWNAME</code> 
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="50%" headers="d92175e2430 d92175e2425 ">
                                       <p><span class="q">“ <a href="performing-rman-tspitr.html#GUID-0B5AE21B-E444-46C7-8C1E-0E824CDF80A9" title="要为辅助集数据文件指定新名称，可以将RECOVER TABLESPACE包含在RUN命令中，并使用RUN块中的SET NEWNAME命令重命名该文件。">在TSPITR期间使用SET NEWNAME命名辅助设置数据文件</a> ”</span></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="12%" id="d92175e2459" headers="d92175e2419 ">
                                       <p>2</p>
                                    </td>
                                    <td align="left" valign="top" width="38%" headers="d92175e2459 d92175e2422 ">
                                       <p><code class="codeph">配置AUXNAME</code> 
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="50%" headers="d92175e2459 d92175e2425 ">
                                       <p><span class="q">“ <a href="performing-rman-tspitr.html#GUID-FC741E8C-D422-4856-A3E3-709F91547914" title="CONFIGURE AUXNAME命令为辅助集数据文件映像副本设置持久备用位置，而SET NEWNAME命令为RUN命令的持续时间设置备用位置。">使用SET NEWNAME和CONFIGURE AUXNAME与辅助设置图像副本</a> ”</span></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="12%" id="d92175e2485" headers="d92175e2419 ">
                                       <p>3</p>
                                    </td>
                                    <td align="left" valign="top" width="38%" headers="d92175e2485 d92175e2422 ">
                                       <p><code class="codeph">DB_FILE_NAME_CONVERT</code></p>
                                    </td>
                                    <td align="left" valign="top" width="50%" headers="d92175e2485 d92175e2425 ">
                                       <p><span class="q">“ <a href="performing-rman-tspitr.html#GUID-310586B1-F08C-456C-8398-62CB6930DD4C" title="如果您不想为所有辅助集数据文件使用辅助目标，但又不想单独命名每个文件，则可以在辅助数据库使用的初始化参数文件中包含DB_FILE_NAME_CONVERT初始化参数。">在TSPITR期间使用DB_FILE_NAME_CONVERT命名辅助设置数据文件</a> ”</span> 。
                                       </p>
                                       <p>如果目标数据库使用OMF名称作为辅助集，则无法使用<code class="codeph">DB_FILE_NAME_CONVERT</code> 。请参阅<span class="q">“ <a href="performing-rman-tspitr.html#GUID-1E3933FC-9FA4-4012-B59D-A27406A86419" title="辅助集数据文件可以在目标中具有Oracle管理文件（OMF），并且可以使用自动存储管理（ASM）或非ASM存储。当设置了DB_FILE_NAME_CONVERT初始化参数且OMF文件位于ASM或非ASM存储中时，TSPITR以不同方式执行名称转换。">在TSPITR中重命名OMF辅助设置文件时的注意事项</a> ”</span> 。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="12%" id="d92175e2520" headers="d92175e2419 ">
                                       <p>4</p>
                                    </td>
                                    <td align="left" valign="top" width="38%" headers="d92175e2520 d92175e2422 ">
                                       <p>使用RMAN管理的辅助数据库时， <code class="codeph">RECOVER TABLESPACE</code> <code class="codeph">AUXILIARY DESTINATION</code>参数</p>
                                    </td>
                                    <td align="left" valign="top" width="50%" headers="d92175e2520 d92175e2425 ">
                                       <p></p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>在应用了两者的情况下，列表中较高的设置会覆盖列表中较低的设置。例如，您可以运行<code class="codeph">RECOVER TABLESPACE...当某些辅助设置数据文件具有使用<code class="codeph">CONFIGURE AUXNAME</code>配置的辅助名称时，目标数据库上的AUXILIARY DESTINATION</code>目标。</p>
                        <p>即使您打算使用上述任一技术为特定文件提供位置，Oracle建议您在使用RMAN管理的辅助数据库时向<code class="codeph">RECOVER TABLESPACE</code>提供<code class="codeph">AUXILIARY DESTINATION</code>参数。如果忽略重命名一些辅助设置数据文件，那么TSPITR仍然会成功。未以其他方式重命名的任何文件都放在辅助目标中。
                        </p>
                        <div class="infoboxnote" id="GUID-A834CFEB-C099-40A5-AEAF-349BE084AC70__GUID-D54D44CF-E0BC-484D-B3B8-A4256B985D82">
                           <p class="notep1">注意：</p>
                           <p>您可以通过运行<code class="codeph">SHOW AUXNAME</code>命令查看任何当前的<code class="codeph">CONFIGURE AUXNAME</code>设置，该命令在<a href="../rcmrf/SHOW.html#RCMRF154" target="_blank"><span><cite>Oracle数据库备份和恢复参考中</cite></span></a>有所描述。
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div><a id="BRADV383"></a><div class="props_rev_3"><a id="GUID-1E3933FC-9FA4-4012-B59D-A27406A86419" name="GUID-1E3933FC-9FA4-4012-B59D-A27406A86419"></a><h5 id="BRADV-GUID-1E3933FC-9FA4-4012-B59D-A27406A86419" class="sect5"><span class="enumeration_section">21.5.2.1</span>在TSPITR中重命名OMF辅助设置文件时的注意事项</h5>
                     <p>辅助集数据文件可以在目标中具有Oracle管理文件（OMF），并且可以使用自动存储管理（ASM）或非ASM存储。当设置了<code class="codeph">DB_FILE_NAME_CONVERT</code>初始化参数且OMF文件位于ASM或非ASM存储中时， <code class="codeph">DB_FILE_NAME_CONVERT</code>以不同方式执行名称转换。
                     </p><a id="BRADV385"></a><a id="BRADV384"></a><div class="props_rev_3"><a id="GUID-5E7FEE1C-7F4C-42CD-9349-251EF4FFEA74" name="GUID-5E7FEE1C-7F4C-42CD-9349-251EF4FFEA74"></a><h6 id="BRADV-GUID-5E7FEE1C-7F4C-42CD-9349-251EF4FFEA74" class="sect6"><span class="enumeration_section">21.5.2.1.1</span>使用ASM存储</h6>
                        <div>
                           <p>您可以使用辅助数据库的<code class="codeph">DB_FILE_NAME_CONVERT</code>和<code class="codeph">LOG_FILE_NAME_CONVERT</code>初始化参数来指定磁盘组的转换。RMAN使用该模式转换ASM磁盘组名称，并在转换后的磁盘组中生成有效的OMF文件名。
                           </p>
                           <div class="section">
                              <p>对于使用ASM存储的Oracle Managed Files（OMF），数据库仅将磁盘组名称转换为：+ DISK1到+ DISK2。</p>
                              <p>以下命令指定日志文件的转换：</p><pre class="oac_no_warn" dir="ltr">LOG_FILE_NAME_CONVERT = '+ onlinelogs'， '+ tmpasm'</pre><p>如果<code class="codeph">DB_FILE_NAME_CONVERT</code>和<code class="codeph">LOG_FILE_NAME_CONVERT</code>参数更改了磁盘组名称以外的子字符串，则会忽略转换并使用生成的磁盘组名称。例如：</p><pre class="oac_no_warn" dir="ltr">DB_FILE_NAME_CONVERT = '+ DATAFILE / PROD'， '+ DATAFILE / TSPITR'</pre><p>上述命令导致ASM OMF文件名无效，忽略更改。而是在磁盘组名称+ DATAFILE中创建文件，并发出以下消息：</p><pre class="oac_no_warn" dir="ltr">警告：DB_FILE_NAME_CONVERT导致ASM名称无效;名称仅更改为磁盘组</pre><p>如果辅助集数据文件存储在ASM磁盘组中，则可以使用<code class="codeph">SET NEWNAME</code>命令将单个文件重定向到可从辅助数据库访问的特定磁盘组（并允许数据库在磁盘组中生成文件名）。
                              </p>
                           </div>
                           <!-- class="section" -->
                           <div class="example" id="GUID-5E7FEE1C-7F4C-42CD-9349-251EF4FFEA74__CIHHGCGF">
                              <p class="titleinexample">示例21-5重定向ASM文件</p>
                              <p>此示例显示如何使用<code class="codeph">SET NEWNAME</code>命令将单个文件重定向到特定磁盘组。
                              </p><pre class="oac_no_warn" dir="ltr">运行{为数据文件1设置NEWNAME到“+ DISK2”;将DATAFILE 2的NEWNAME设置为“+ DISK3”; RECOVER TABLESPACE用户，工具UNTIL LOGSEQ 1300 THREAD 1 AUXILIARY DESTINATION'/ disk1 / auxdest'; }</pre></div>
                           <!-- class="example" -->
                        </div>
                     </div><a id="BRADV386"></a><div class="props_rev_3"><a id="GUID-AEA2C5F4-214B-4795-86DE-69BC307832EE" name="GUID-AEA2C5F4-214B-4795-86DE-69BC307832EE"></a><h6 id="BRADV-GUID-AEA2C5F4-214B-4795-86DE-69BC307832EE" class="sect6"><span class="enumeration_section">21.5.2.1.2</span>使用非ASM存储</h6>
                        <div>
                           <p>有多种方法可用于重命名辅助数据库的OMF（非ASM）文件名。</p>
                           <div class="section">
                              <p>初始化参数<code class="codeph">DB_FILE_NAME_CONVERT</code>和<code class="codeph">LOG_FILE_NAME_CONVERT</code>不能用于重命名辅助数据库的OMF（非ASM）文件名，因为此方法会生成无效的OMF文件名。如果必须控制不使用ASM存储的新OMF文件名的生成，则必须使用以下备用技术之一重命名它们。
                              </p>
                              <p>从最推荐到最不推荐的顺序列出了各种命名选项。</p>
                           </div>
                           <!-- class="section" -->
                           <ol>
                              <li class="stepexpand"><span>使用辅助目标，如<span class="q">“ <a href="performing-rman-tspitr.html#GUID-B878E5C6-8E83-4A13-AFC7-249A5B310CFA" title="在默认模式下，RMAN在目标数据库上尽可能多地使用TSPITR的配置。">执行全自动RMAN TSPITR</a> ”中所述</span> 。</span></li>
                              <li class="stepexpand"><span>使用辅助数据库的一个或多个OMF初始化参数指定新OMF文件的位置，以便处理所有必需的OMF文件：</span><div>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><code class="codeph">DB_CREATE_FILE_DEST</code>用于辅助集数据文件</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">DB_CREATE_ONLINE_LOG_DEST_ <span class="codeinlineitalic">n</span></code> ，如果未在<code class="codeph">DB_CREATE_FILE_DEST</code>创建联机日志，则使用<code class="codeph">DB_CREATE_FILE_DEST</code>作为辅助数据库的联机重做日志</p>
                                       </li>
                                    </ul>
                                 </div>
                              </li>
                           </ol>
                        </div>
                     </div>
                  </div><a id="BRADV387"></a><a id="BRADV89801"></a><div class="props_rev_3"><a id="GUID-0B5AE21B-E444-46C7-8C1E-0E824CDF80A9" name="GUID-0B5AE21B-E444-46C7-8C1E-0E824CDF80A9"></a><h5 id="BRADV-GUID-0B5AE21B-E444-46C7-8C1E-0E824CDF80A9" class="sect5"><span class="enumeration_section">21.5.2.2</span>在TSPITR期间使用SET NEWNAME命名辅助设置数据文件</h5>
                     <div>
                        <p>要为辅助集数据文件指定新名称，可以将<code class="codeph">RECOVER TABLESPACE</code>在<code class="codeph">RUN</code>命令中，并使用<code class="codeph">RUN</code>块中的<code class="codeph">SET NEWNAME</code>命令重命名该文件。
                        </p>
                        <div class="section"></div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-0B5AE21B-E444-46C7-8C1E-0E824CDF80A9__CHDIAAAJ">
                           <p class="titleinexample">示例21-6在TSPITR中重命名辅助集Oracle托管文件（OMF）</p>
                           <p>此示例说明了使用SET NEWNAME重命名文件的基本技巧。结果取决于执行<code class="codeph">RECOVER TABLESPACE</code>时是否存在<code class="codeph">/disk1/auxdest/system01.dbf</code> 。如果<code class="codeph">?/oradata/system01.dbf</code>存在于指定位置，并且在TSPITR的<code class="codeph">UNTIL</code>时间之前在SCN处创建，然后使用<code class="codeph">DATAFILECOPY</code>并且不需要还原操作。否则，RMAN将辅助集数据文件还原为<code class="codeph">NEWNAME</code>而不是默认位置。如果您打算控制辅助集数据文件的存储位置，请确保在执行TSPITR之前没有文件存储在<code class="codeph">SET NEWNAME</code>指定的位置。</p><pre class="oac_no_warn" dir="ltr">RUN {SET NEWNAME FOR DATAFILE'？/oradata/prod/system01.dbf'TO'/disk1/auxdest/system01.dbf';为DATAFILE设置NEWNAME'？/oradata/prod/sysaux01.dbf'TO'/disk1/auxdest/sysaux01.dbf';为DATAFILE设置NEWNAME'？/oradata/prod/undotbs01.dbf'TO'/disk1/auxdest/undotbs01.dbf'; RECOVER TABLESPACE用户，工具UNTIL LOGSEQ 1300 THREAD 1 AUXILIARY DESTINATION'/ disk1 / auxdest'; }</pre></div>
                        <!-- class="example" -->
                        <div class="section">
                           <div class="infoboxnotealso" id="GUID-0B5AE21B-E444-46C7-8C1E-0E824CDF80A9__GUID-0D7DCAE4-0388-4AB3-9BAA-4E82E87FC6E6">
                              <p class="notep1">也可以看看：</p>
                              <p><span class="q">“ <a href="performing-rman-tspitr.html#GUID-FC741E8C-D422-4856-A3E3-709F91547914" title="CONFIGURE AUXNAME命令为辅助集数据文件映像副本设置持久备用位置，而SET NEWNAME命令为RUN命令的持续时间设置备用位置。">使用SET NEWNAME和CONFIGURE AUXNAME与辅助设置图像副本</a> ”</span></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="BRADV89802"></a><div class="props_rev_3"><a id="GUID-310586B1-F08C-456C-8398-62CB6930DD4C" name="GUID-310586B1-F08C-456C-8398-62CB6930DD4C"></a><h5 id="BRADV-GUID-310586B1-F08C-456C-8398-62CB6930DD4C" class="sect5"><span class="enumeration_section">21.5.2.3</span>在TSPITR期间使用DB_FILE_NAME_CONVERT命名辅助设置数据文件</h5>
                     <div>
                        <p>如果您不想为所有辅助集数据文件使用辅助目标，但又不想单独命名每个文件，则可以在辅助数据库使用的初始化参数文件中包含<code class="codeph">DB_FILE_NAME_CONVERT</code>初始化参数。
                        </p>
                        <div class="section">
                           <p>仅当存在以下某种情况时，才能使用此技术：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>您可以为自动管理的辅助数据库创建自己的初始化参数文件，如<span class="q">“ <a href="performing-rman-tspitr.html#GUID-A86E8164-690C-49B7-B978-85E460DA2AC6" title="自动辅助数据库使用一组默认初始化参数。如果需要，您可以添加其他参数。">在TSPITR中自定义自动辅助数据库的初始化参数</a> ”中所述</span></p>
                              </li>
                              <li>
                                 <p>您可以创建自己的辅助数据库，如<span class="q">“ <a href="performing-rman-tspitr.html#GUID-D0A465A5-B0D8-4E60-8941-D98DD8AC44D0" title="虽然Oracle建议您让RMAN管理辅助数据库的所有方面，但有时您可能必须创建和管理自己的辅助数据库。如果选择此模式，则负责设置，启动，停止和清理TSPITR中使用的辅助数据库。">使用您自己的辅助数据库执行RMAN TSPITR</a> ”中所述</span></p>
                              </li>
                           </ul>
                           <p>辅助数据库中的<code class="codeph">DB_FILE_NAME_CONVERT</code>初始化参数指定如何从目标数据库实例中相应文件的原始名称派生辅助数据库中文件的名称。该参数由一对字符串组成。对于包含一对的第一个字符串作为子字符串的任何文件名，通过将该对中的第二个字符串替换为原始文件名来生成辅助数据库中相应文件的名称。
                           </p>
                           <p>例如，假设目标实例包含以下文件：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">？<code class="codeph">SYSTEM</code>表空间的/oradata/trgt/system01.dbf</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">？<code class="codeph">SYSAUX</code>表空间的/oradata/trgt/sysaux01.dbf</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">？/oradata/trgt/undotbs01.dbf</code>的的<code class="codeph">undotbs</code>表空间</p>
                              </li>
                           </ul>
                           <p>要将辅助数据库的相应文件放在<code class="codeph">/bigtmp</code> ，请将以下行添加到辅助数据库参数文件中：</p><pre class="oac_no_warn" dir="ltr">DB_FILE_NAME_CONVERT =（'？/ oradata / trgt'，'/ bigtmp'）</pre><p>对于相应的辅助数据库文件的新文件名是<code class="codeph">/bigtmp/trgt/system01.dbf</code> ， <code class="codeph">/bigtmp/trgt/sysaux01.dbf</code>和<code class="codeph">/bigtmp/trgt/undotbs01.dbf</code> 。
                           </p>
                           <p>要记住的最重要的一点是<code class="codeph">DB_FILE_NAME_CONVERT</code> <span class="italic">必须</span>存在于辅助数据库参数文件中。如果手动创建辅助数据库，则将<code class="codeph">DB_FILE_NAME_CONVERT</code>添加到辅助数据库参数文件。
                           </p>
                           <p>您仍然可以使用<code class="codeph">SET NEWNAME</code>或<code class="codeph">CONFIGURE AUXNAME</code>命令重命名各个辅助集数据文件。此外，不会重命名与<code class="codeph">DB_FILE_NAME_CONVERT</code>中提供的模式不匹配的文件。使用RMAN管理的辅助数据库时，可以使用<code class="codeph">RECOVER TABLESPACE</code>命令的<code class="codeph">AUXILIARY DESTINATION</code>参数来确保将所有辅助集数据文件发送到某个目标。如果重命名方法没有为辅助数据库中的文件提供新名称，则TSPITR将失败。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div><a id="BRADV89804"></a><div class="props_rev_3"><a id="GUID-CA2BABC5-F8BF-40B1-943B-5C5E92A82325" name="GUID-CA2BABC5-F8BF-40B1-943B-5C5E92A82325"></a><h6 id="BRADV-GUID-CA2BABC5-F8BF-40B1-943B-5C5E92A82325" class="sect6"><span class="enumeration_section">21.5.2.3.1</span>在TSPITR期间重命名临时文件</h6>
                        <div>
                           <p>临时文件被视为数据库辅助集的一部分。在实例化辅助数据库时，RMAN将重新创建目标数据库的临时表空间，并使用辅助数据文件名的常规规则生成其名称。</p>
                           <div class="section">
                              <p>要重命名临时文件，可以使用以下方法之一：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">SET NEWNAME FOR TEMPFILE</code>命令</p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">DB_FILE_NAME_CONVERT</code>辅助数据库的初始化参数。如果临时文件具有非ASM Oracle托管文件名，则无法使用此参数选项。
                                    </p>
                                 </li>
                                 <li>
                                    <p>使用RMAN管理的辅助数据库时， <code class="codeph">RECOVER</code>命令的<code class="codeph">AUXILIARY DESTINATION</code>子句</p>
                                 </li>
                              </ul>
                              <div class="infoboxnotealso" id="GUID-CA2BABC5-F8BF-40B1-943B-5C5E92A82325__GUID-5183FE63-61D8-4C40-809F-1C2C1D227DBD">
                                 <p class="notep1">也可以看看：</p>
                                 <p><a href="performing-rman-tspitr.html#GUID-1E3933FC-9FA4-4012-B59D-A27406A86419" title="辅助集数据文件可以在目标中具有Oracle管理文件（OMF），并且可以使用自动存储管理（ASM）或非ASM存储。当设置了DB_FILE_NAME_CONVERT初始化参数且OMF文件位于ASM或非ASM存储中时，TSPITR以不同方式执行名称转换。">在TSPITR中重命名OMF辅助设置文件时的注意事项</a></p>
                              </div>
                           </div>
                           <!-- class="section" -->
                        </div>
                     </div>
                  </div>
               </div><a id="BRADV89805"></a><div class="props_rev_3"><a id="GUID-C3ACA139-02C3-4DED-978D-DCD785724AC4" name="GUID-C3ACA139-02C3-4DED-978D-DCD785724AC4"></a><h4 id="BRADV-GUID-C3ACA139-02C3-4DED-978D-DCD785724AC4" class="sect4"><span class="enumeration_section">21.5.3</span>使用映像副本实现更快的RMAN TSPITR性能</h4>
                  <div>
                     <p>通过重定向RMAN以使用恢复集和辅助集数据文件的现有映像副本，可以增强TSPITR性能。在这种情况下，RMAN不需要从备份还原数据文件。</p>
                     <p>通常，如果指定位置中有合适的映像副本，则RMAN使用映像副本执行TSPITR，并且数据文件副本从目标控制文件中取消编目。</p>
                     <p>您可以使用以下技术告知RMAN可能存在数据文件的映像副本：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>使用<code class="codeph">CONFIGURE AUXNAME</code>命令和辅助设置数据文件的映像副本</p>
                        </li>
                        <li>
                           <p>使用<code class="codeph">SET NEWNAME</code>命令以及恢复集数据文件或辅助集数据文件的映像副本</p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-C3ACA139-02C3-4DED-978D-DCD785724AC4__GUID-AB753FDD-DFF5-4199-AD50-D847FDAC3009">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="performing-rman-tspitr.html#GUID-FC741E8C-D422-4856-A3E3-709F91547914" title="CONFIGURE AUXNAME命令为辅助集数据文件映像副本设置持久备用位置，而SET NEWNAME命令为RUN命令的持续时间设置备用位置。">使用SET NEWNAME和CONFIGURE AUXNAME与辅助设置图像副本</a></p>
                           </li>
                           <li>
                              <p><a href="performing-rman-tspitr.html#GUID-D826F45A-EDD7-4CBC-A726-E235BB848FFF" title="使用SET NEWNAME命令可以在使用映像副本执行TSPITR时指定映像副本的位置。">将SET NEWNAME与恢复集图像副本一起使用</a></p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="BRADV388"></a><a id="BRADV89806"></a><div class="props_rev_3"><a id="GUID-D826F45A-EDD7-4CBC-A726-E235BB848FFF" name="GUID-D826F45A-EDD7-4CBC-A726-E235BB848FFF"></a><h5 id="BRADV-GUID-D826F45A-EDD7-4CBC-A726-E235BB848FFF" class="sect5"><span class="enumeration_section">21.5.3.1</span>将SET NEWNAME与恢复集图像副本一起使用</h5>
                     <div>
                        <p>使用<code class="codeph">SET NEWNAME</code>命令可以在使用映像副本执行TSPITR时指定映像副本的位置。
                        </p>
                        <div class="section">
                           <p>在TSPITR期间，RMAN在指定的<code class="codeph">NEWNAME</code>位置查找数据文件。RMAN检查数据文件的映像副本备份是否与数据文件检查点SCN一起存在，以便可以恢复到目标时间。如果RMAN找到可用的映像副本，则RMAN在TSPITR中使用它。否则，RMAN会将数据文件还原到<code class="codeph">NEWNAME</code>位置。<code class="codeph">NEWNAME</code>指定的位置中的任何文件都将被覆盖。TSPITR完成后，指定的<code class="codeph">NEWNAME</code>将成为目标数据库中数据文件的名称。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-D826F45A-EDD7-4CBC-A726-E235BB848FFF__CHDFHFCJ">
                           <p class="titleinexample">例21-7使用SET NEWNAME</p>
                           <p>此示例使用恢复集文件的映像副本执行TSPITR。<code class="codeph">SET NEWNAME</code>命令指定指定表空间的映像副本的位置。
                           </p><pre class="oac_no_warn" dir="ltr">RUN {SET NEWNAME FOR DATAFILE <span class="italic">'ORACLE_HOME</span> /oradata/trgt/users01.dbf' TO '/newfs/users1.dbf'; <span class="italic">...其他RMAN命令，如果有的话......</span>RECOVER TABLESPACE用户，工具UNTIL SEQUENCE 1300 THREAD 1; }</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="BRADV89807"></a><div class="props_rev_3"><a id="GUID-FC741E8C-D422-4856-A3E3-709F91547914" name="GUID-FC741E8C-D422-4856-A3E3-709F91547914"></a><h5 id="BRADV-GUID-FC741E8C-D422-4856-A3E3-709F91547914" class="sect5"><span class="enumeration_section">21.5.3.2</span>使用SET NEWNAME和CONFIGURE AUXNAME以及辅助设置图像副本</h5>
                     <div>
                        <p><code class="codeph">CONFIGURE AUXNAME</code>命令为辅助集数据文件映像副本设置持久备用位置，而<code class="codeph">SET NEWNAME</code>命令为<code class="codeph">RUN</code>命令的持续时间设置备用位置。
                        </p>
                        <div class="section">
                           <p>假设您使用<code class="codeph">SET NEWNAME</code>或<code class="codeph">CONFIGURE AUXNAME</code>为辅助集数据文件指定新位置。还假设在该位置存在具有可在TSPITR中使用的SCN的映像副本。在这种情况下，RMAN使用图像副本。但是，如果该位置没有可用的映像副本，则RMAN将从备份还原可用的副本。（如果存在映像副本，但SCN在TSPITR的目标时间之后，则数据文件将被还原的文件覆盖。）
                           </p>
                           <p>与所有辅助设置文件一样，在TSPITR之后删除该文件。无论是在TSPITR之前创建的映像副本还是在TSPITR期间由RMAN还原，都会发生此行为。</p>
                           <p><code class="codeph">CONFIGURE AUXNAME</code>的主要用途是通过消除恢复时间来加快TSPITR。如果您预计执行TSPITR，则可以在备份例程中包含辅助集数据文件的一组映像副本的维护，并定期更新这些副本到您希望执行TSPITR的最早点。推荐的使用模式是：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li><span>在设置此策略时，为文件配置一次<code class="codeph">AUXNAME</code> 。</span></li>
                           <li><span>定期执行<code class="codeph">BACKUP AS COPY DATAFILE <span class="codeinlineitalic">n</span> FORMAT <span class="codeinlineitalic">auxname</span></code>以维护更新的图像副本。为了获得更好的性能，请使用逐步更新的备份策略，以使映像副本保持最新，而无需执行数据文件的完整备份。</span></li>
                           <li><span>需要TSPITR时，指定上次更新映像副本后的目标时间。</span></li>
                        </ol>
                     </div>
                  </div><a id="BRADV89808"></a><div class="props_rev_3"><a id="GUID-BA6F7010-407B-4E16-8F53-597FD49B64E3" name="GUID-BA6F7010-407B-4E16-8F53-597FD49B64E3"></a><h5 id="BRADV-GUID-BA6F7010-407B-4E16-8F53-597FD49B64E3" class="sect5"><span class="enumeration_section">21.5.3.3</span>使用配置AUXNAME和映像副本执行TSPITR：场景</h5>
                     <div>
                        <p>使用映像副本执行TSPITR时，此过程使用<code class="codeph">CONFIGURE AUXNAME</code> 。
                        </p>
                        <div class="section">
                           <p>假设您有足够的磁盘空间来保存整个数据库的映像副本，以便在TSPITR中使用。为了准备TSPITR，您可以执行以下操作：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>使用以下格式的命令为辅助集中的每个数据文件配置<code class="codeph">AUXNAME</code> ：</p><pre class="oac_no_warn" dir="ltr">配置数据文件的AUXNAME <span class="italic">n</span>到<span class="italic">auxname_n</span> ;</pre></li>
                              <li>
                                 <p>使用以下形式的命令每周日拍摄辅助集的图像副本：</p><pre class="oac_no_warn" dir="ltr">BACKUP AS COPY DATAFILE <span class="italic">n</span> FORMAT <span class="italic">auxname_n</span>
</pre><p>如果映像副本全部位于磁盘上的相同位置，并且它们的命名方式与原始数据文件类似，则可以避免对每个数据文件执行备份。相反，您可以使用<code class="codeph">BACKUP</code>命令的<code class="codeph">FORMAT</code>或<code class="codeph">DB_FILE_NAME_CONVERT</code>选项并使用<code class="codeph">BACKUP AS COPY DATABASE</code> 。例如，如果配置的辅助名称是位置<code class="codeph">maindisk</code>到<code class="codeph">auxdisk</code> ，则使用以下命令：</p><pre class="oac_no_warn" dir="ltr">备份为COPY DATABASE DB_FILE_NAME_CONVERT（maindisk，auxdisk）;</pre><div class="infoboxnote" id="GUID-BA6F7010-407B-4E16-8F53-597FD49B64E3__GUID-FAA5F005-6949-43B6-A772-6BD9EDE0BD74">
                                    <p class="notep1">注意：</p>
                                    <p>由于Oracle托管文件名通常不能使用简单替换进行转换，因此通常不能使用<code class="codeph">DB_FILE_NAME_CONVERT</code>为存储在OMF中的映像副本生成名称。</p>
                                 </div>
                              </li>
                           </ul>
                           <p>完成这些步骤后，您就可以为TSPITR做好准备，而无需从备份中恢复辅助集。例如，如果错误的批处理作业（从2013年11月15日19:00:00开始）错误地更新了表空间<code class="codeph">parts</code>中的表，则使用以下命令对表空间<code class="codeph">parts</code>执行TSPITR：</p><pre class="oac_no_warn" dir="ltr">RECOVER TABLESPACE部件直到2013年11月15日，19：00：00';</pre><p>由于<code class="codeph">AUXNAME</code>位置已配置并在TSPITR目标时间之前从SCN引用数据文件副本，因此不会从备份恢复辅助集。相反，数据文件副本用于恢复，这减少了恢复开销。
                           </p>
                           <p>您还可以阻止恢复恢复集。您必须频繁获取表空间的映像副本，并使用<code class="codeph">SET NEWNAME</code>指定这些副本的位置。此方法可确保在TSPITR成功完成后不恢复恢复集并且表空间更改位置。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="BRADV389"></a><a id="BRADV89809"></a><div class="props_rev_3"><a id="GUID-A86E8164-690C-49B7-B978-85E460DA2AC6" name="GUID-A86E8164-690C-49B7-B978-85E460DA2AC6"></a><h4 id="BRADV-GUID-A86E8164-690C-49B7-B978-85E460DA2AC6" class="sect4"><span class="enumeration_section">21.5.4</span>自定义<span class="enumeration_section">TSPITR</span>中自动辅助数据库的初始化参数</h4>
                  <div>
                     <p>自动辅助数据库使用一组默认初始化参数。如果需要，您可以添加其他参数。</p>
                     <p>自动辅助数据库查找其他初始化参数，以补充与操作系统相关的位置中的默认参数。例如，在UNIX中，此位置为： <code class="codeph">?/rdbms/admin/params_auxinst.ora</code> 。RMAN在执行TSPITR时始终为RMAN自动辅助数据库查找此附加参数文件。如果找不到该文件，则RMAN不会生成错误。相反，RMAN使用下表中列出的默认参数来管理RMAN管理的自动辅助数据库。
                     </p>
                     <div class="tblformal" id="GUID-A86E8164-690C-49B7-B978-85E460DA2AC6__CHDJIJAF">
                        <p class="titleintable">表21-4 RMAN管理的辅助数据库的默认初始化参数</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="RMAN管理的辅助数据库的默认初始化参数" width="100%" border="1" summary="Default initialization parameters" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="33%" id="d92175e3866">初始化参数</th>
                                 <th align="left" valign="bottom" width="67%" id="d92175e3869">值</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="33%" id="d92175e3874" headers="d92175e3866 ">
                                    <p><code class="codeph">DB_NAME</code> 
                                    </p>
                                 </td>
                                 <td align="left" valign="top" width="67%" headers="d92175e3874 d92175e3869 ">
                                    <p>与源数据库的<code class="codeph">DB_NAME</code>相同</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="33%" id="d92175e3886" headers="d92175e3866 ">
                                    <p><code class="codeph">兼容</code></p>
                                 </td>
                                 <td align="left" valign="top" width="67%" headers="d92175e3886 d92175e3869 ">
                                    <p>与目标数据库的<code class="codeph">COMPATIBLE</code>设置相同</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="33%" id="d92175e3897" headers="d92175e3866 ">
                                    <p><code class="codeph">DB_UNIQUE_NAME</code></p>
                                 </td>
                                 <td align="left" valign="top" width="67%" headers="d92175e3897 d92175e3869 ">
                                    <p>RMAN基于<code class="codeph">DB_NAME</code>自动生成唯一值</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="33%" id="d92175e3907" headers="d92175e3866 ">
                                    <p><code class="codeph">DB_BLOCK_SIZE</code></p>
                                 </td>
                                 <td align="left" valign="top" width="67%" headers="d92175e3907 d92175e3869 ">
                                    <p>与目标数据库的<code class="codeph">DB_BLOCK_SIZE</code>相同</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="33%" id="d92175e3918" headers="d92175e3866 ">
                                    <p><code class="codeph">DB_CREATE_FILE_DEST</code></p>
                                 </td>
                                 <td align="left" valign="top" width="67%" headers="d92175e3918 d92175e3869 ">
                                    <p>辅助目标（仅当使用RMAN管理的辅助数据库时指定了<code class="codeph">AUXILIARY DESTINATION</code>参数）。RMAN为此位置的辅助集文件创建Oracle Managed Files。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="33%" id="d92175e3929" headers="d92175e3866 ">
                                    <p><code class="codeph">LOG_ARCHIVE_DEST_1</code></p>
                                 </td>
                                 <td align="left" valign="top" width="67%" headers="d92175e3929 d92175e3869 ">
                                    <p>辅助目标（仅当使用RMAN管理的辅助数据库时指定了<code class="codeph">AUXILIARY DESTINATION</code>子句）。恢复所需的存档日志将恢复到此位置。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="33%" id="d92175e3940" headers="d92175e3866 ">
                                    <p><code class="codeph">SGA_TARGET</code></p>
                                 </td>
                                 <td align="left" valign="top" width="67%" headers="d92175e3940 d92175e3869 ">
                                    <p><code class="codeph">280M</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="33%" id="d92175e3949" headers="d92175e3866 ">
                                    <p><code class="codeph">DB_FILES</code></p>
                                 </td>
                                 <td align="left" valign="top" width="67%" headers="d92175e3949 d92175e3869 ">
                                    <p>与目标数据库的<code class="codeph">DB_FILES</code>相同</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="33%" id="d92175e3960" headers="d92175e3866 ">
                                    <p><code class="codeph">PROCESSES</code></p>
                                 </td>
                                 <td align="left" valign="top" width="67%" headers="d92175e3960 d92175e3869 ">
                                    <p><code class="codeph">50</code></p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>通常，不必更改或添加这些初始化参数的值，尤其是在使用RMAN管理的辅助数据库时为<code class="codeph">RECOVER TABLESPACE</code>命令提供<code class="codeph">AUXILIARY DESTINATION</code>子句时。如果使用不适当的值覆盖<a href="performing-rman-tspitr.html#GUID-A86E8164-690C-49B7-B978-85E460DA2AC6__CHDJIJAF" title="默认初始化参数">表21-4中</a>的初始化参数，则TSPITR可能会因辅助数据库问题而失败。不过，如果需要，您可以添加除这些基本参数之外的其他参数。例如，您可以使用<code class="codeph">DB_FILE_NAME_CONVERT</code>指定辅助和恢复集中的数据文件的名称。
                     </p>
                     <p>要覆盖或指定自动辅助数据库的参数，可以执行以下任一操作：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>将初始化参数放在操作系统特定的默认辅助参数文件名中。例如，在UNIX中，文件名是： <code class="codeph">?/rdbms/admin/params_auxinst.ora</code> 。
                           </p>
                        </li>
                        <li>
                           <p>执行以下步骤：</p>
                           <ol>
                              <li>
                                 <p>将初始化参数放在一个文件中。</p>
                              </li>
                              <li>
                                 <p>在执行TSPITR之前，使用<code class="codeph">SET AUXILIARY INSTANCE PARAMETER FILE</code>命令指定此文件的位置。</p>
                              </li>
                           </ol>
                        </li>
                     </ul>
                     <p>无论选择哪种方法，您指定的参数优先于默认值，并且可以覆盖<code class="codeph">AUXILIARY DESTINATION</code>子句的值。
                     </p>
                     <p>本节包含以下主题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="performing-rman-tspitr.html#GUID-E3EDE63E-79D4-4FEC-9AB4-6ADBE28FA7A9" title="要在辅助数据库上还原辅助数据库和恢复集后执行恢复，RMAN可能需要还原存档日志。使用辅助目标时，存档日志将还原到该位置。">在TSPITR中指定辅助数据库存档日志</a></p>
                        </li>
                        <li>
                           <p><a href="performing-rman-tspitr.html#GUID-9561F2D0-D174-4571-8D4F-4249FA12AFED" title="如果使用初始化参数文件，则可以使用CONTROL_FILES初始化参数为辅助数据库的控制文件指定自己的位置">在TSPITR中指定辅助数据库控制文件位置</a></p>
                        </li>
                        <li>
                           <p><a href="performing-rman-tspitr.html#GUID-19B9240A-6158-4353-939C-BB6DB1F02984" title="如果在辅助数据库参数文件中指定LOG_FILE_NAME_CONVERT初始化参数，并且参数成功转换目标的联机重做日志的名称，则此参数将确定联机重做日志位置。">在TSPITR中指定辅助数据库联机日志位置</a></p>
                        </li>
                     </ul>
                  </div><a id="BRADV89810"></a><div class="props_rev_3"><a id="GUID-9561F2D0-D174-4571-8D4F-4249FA12AFED" name="GUID-9561F2D0-D174-4571-8D4F-4249FA12AFED"></a><h5 id="BRADV-GUID-9561F2D0-D174-4571-8D4F-4249FA12AFED" class="sect5"><span class="enumeration_section">21.5.4.1</span>在<span class="enumeration_section">TSPITR中</span>指定辅助数据库控制文件位置</h5>
                     <div>
                        <p>如果使用初始化参数文件，则可以使用<code class="codeph">CONTROL_FILES</code>初始化参数为辅助数据库的控制文件指定自己的位置</p>
                        <div class="section">
                           <p>如果未明确指定控制文件位置，并且使用<code class="codeph">AUXILIARY DESTINATION</code>子句，则RMAN会在辅助目标中找到控制文件。如果不使用<code class="codeph">AUXILIARY DESTINATION</code>子句，则辅助数据库控制文件存储在特定于操作系统的位置。
                           </p>
                           <p>无论您在何处存储辅助数据库控制文件，都会在TSPITR操作结束时将其删除。由于控制文件相对较小，因此RMAN很少遇到创建辅助控制文件的问题。但是，如果没有足够的空间来创建控制文件，则TSPITR会失败。</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="BRADV390"></a><div class="props_rev_3"><a id="GUID-E3EDE63E-79D4-4FEC-9AB4-6ADBE28FA7A9" name="GUID-E3EDE63E-79D4-4FEC-9AB4-6ADBE28FA7A9"></a><h5 id="BRADV-GUID-E3EDE63E-79D4-4FEC-9AB4-6ADBE28FA7A9" class="sect5"><span class="enumeration_section">21.5.4.2</span>在<span class="enumeration_section">TSPITR中</span>指定辅助数据库存档日志</h5>
                     <div>
                        <p>要在辅助数据库上还原辅助数据库和恢复集后执行恢复，RMAN可能需要还原存档日志。使用辅助目标时，存档日志将还原到该位置。</p>
                        <div class="section">
                           <p>在没有辅助目标和任何其他初始化参数的情况下，归档日志将还原到特定于操作系统的位置。有关详细信息，请参阅操作系统特定文档。您可以使用<code class="codeph">LOG_ARCHIVE_DEST_1</code>初始化参数指定还原存档日志的备用位置。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="BRADV89811"></a><div class="props_rev_3"><a id="GUID-19B9240A-6158-4353-939C-BB6DB1F02984" name="GUID-19B9240A-6158-4353-939C-BB6DB1F02984"></a><h5 id="BRADV-GUID-19B9240A-6158-4353-939C-BB6DB1F02984" class="sect5"><span class="enumeration_section">21.5.4.3</span>在<span class="enumeration_section">TSPITR中</span>指定辅助数据库在线日志位置</h5>
                     <div>
                        <p>如果在辅助数据库参数文件中指定<code class="codeph">LOG_FILE_NAME_CONVERT</code>初始化参数，并且参数成功转换目标的联机重做日志的名称，则此参数将确定联机重做日志位置。
                        </p>
                        <div class="section">
                           <p>适用于OMF数据文件的相同限制（如<span class="q">“ <a href="performing-rman-tspitr.html#GUID-1E3933FC-9FA4-4012-B59D-A27406A86419" title="辅助集数据文件可以在目标中具有Oracle管理文件（OMF），并且可以使用自动存储管理（ASM）或非ASM存储。当设置了DB_FILE_NAME_CONVERT初始化参数且OMF文件位于ASM或非ASM存储中时，TSPITR以不同方式执行名称转换。">在TSPITR中重命名OMF辅助设置文件时的注意事项</a> ”中所述</span> ）适用于OMF联机重做日志。如果RMAN正在管理辅助数据库并指定了辅助目标，则RMAN会在辅助目标中创建联机重做日志。
                           </p>
                           <p>或者，您可以使用<code class="codeph">DB_CREATE_FILE_DEST</code>或<code class="codeph">DB_CREATE_FILE_DEST</code>和<code class="codeph">DB_CREATE_ONLINE_LOG_1</code>指定创建辅助数据库重做日志的位置。如果选择后一个选项，则必须将<code class="codeph">DB_CREATE_ONLINE_LOG_1</code>与<code class="codeph">DB_CREATE_FILE_DEST</code> <code class="codeph">DB_CREATE_ONLINE_LOG_1</code>使用。</p>
                           <p>如果您未使用以下方法之一为TSPITR指定位置，则TSPITR无法创建联机重做日志：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">LOG_FILE_NAME_CONVERT</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">DB_CREATE_FILE_DEST</code> 
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">DB_CREATE_FILE_DEST</code>和<code class="codeph">DB_CREATE_ONLINE_LOG_1</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">辅助目的地</code></p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div><a id="BRADV89812"></a><div class="props_rev_3"><a id="GUID-D0A465A5-B0D8-4E60-8941-D98DD8AC44D0" name="GUID-D0A465A5-B0D8-4E60-8941-D98DD8AC44D0"></a><h3 id="BRADV-GUID-D0A465A5-B0D8-4E60-8941-D98DD8AC44D0" class="sect3"><span class="enumeration_section">21.6</span>使用您自己的辅助数据库执行RMAN TSPITR</h3>
               <div>
                  <p>虽然Oracle建议您让RMAN管理辅助数据库的所有方面，但有时您可能必须创建和管理自己的辅助数据库。如果选择此模式，则负责设置，启动，停止和清理TSPITR中使用的辅助数据库。</p>
                  <p>您可能想要创建自己的实例的一个原因是控制TSPITR中使用的通道。自动辅助数据库使用目标数据库的已配置通道作为在辅助数据库上配置的通道的基础，并在还原操作期间使用。您可能需要不同的通道设置，可能不希望使用<code class="codeph">CONFIGURE</code>命令更改目标数据库上的设置。在这种情况下，您可以操作自己的辅助数据库。通过在调用<code class="codeph">RECOVER</code>之前连接到辅助数据库，运行块可以使用<code class="codeph">ALLOCATE AUXILIARY CHANNEL</code>命令提供特定的通道分配。
                  </p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="performing-rman-tspitr.html#GUID-5E937BD4-2187-491A-AAD1-7A6EDF1E8D8F" title="创建适合用作辅助数据库的Oracle实例需要您执行一组步骤。">为RMAN TSPITR准备自己的辅助数据库</a></p>
                     </li>
                     <li>
                        <p><a href="performing-rman-tspitr.html#GUID-41F8F223-E065-445C-AF4B-2343F13813AD" title="使用您自己的辅助实例执行TSPITR时，请记住某些准则。">使用您自己的辅助数据库为TSPITR准备RMAN命令</a></p>
                     </li>
                     <li>
                        <p><a href="performing-rman-tspitr.html#GUID-D4736F75-8BEB-44AB-9CEA-84A534248FB9" title="完成先决条件，然后按照本节中的步骤使用您自己的辅助数据库执行TSPITR。">使用您自己的辅助数据库执行TSPITR</a></p>
                     </li>
                     <li>
                        <p><a href="performing-rman-tspitr.html#GUID-90328C26-FD61-4BE7-A1C7-0C25E62B73AC" title="此过程使用RECOVER TABLESPACE ...UNTIL命令执行TSPITR。">使用您自己的辅助数据库执行TSPITR：场景</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89813"></a><div class="props_rev_3"><a id="GUID-5E937BD4-2187-491A-AAD1-7A6EDF1E8D8F" name="GUID-5E937BD4-2187-491A-AAD1-7A6EDF1E8D8F"></a><h4 id="BRADV-GUID-5E937BD4-2187-491A-AAD1-7A6EDF1E8D8F" class="sect4"><span class="enumeration_section">21.6.1</span>为RMAN TSPITR准备自己的辅助数据库</h4>
                  <div>
                     <p>创建适合用作辅助数据库的Oracle实例需要您执行一组步骤。</p>
                     <div class="section">
                        <p>步骤包括以下内容：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="performing-rman-tspitr.html#GUID-8A3B6A3A-A6E2-463E-AB04-C6E3BECBF052" title="有多种方法可以为辅助数据库创建密码文件。">步骤1：为辅助数据库创建Oracle密码文件</a></p>
                           </li>
                           <li>
                              <p><a href="performing-rman-tspitr.html#GUID-CB6CF781-476B-4E65-A966-3ED4ED3A81FB" title="使用文本编辑器为目标数据库主机上的辅助数据库创建初始化参数文件。">步骤2：为辅助数据库创建初始化参数文件</a></p>
                           </li>
                           <li>
                              <p><a href="performing-rman-tspitr.html#GUID-6485155B-83CB-48B1-ABEB-DEDF86E7E38E" title="辅助数据库必须具有有效的网络服务名称。在继续之前，请使用SQL * Plus确保您可以与辅助数据库建立SYSBACKUP或SYSDBA连接。">步骤3：检查Oracle Net Connectivity到辅助数据库</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div><a id="BRADV89814"></a><div class="props_rev_3"><a id="GUID-8A3B6A3A-A6E2-463E-AB04-C6E3BECBF052" name="GUID-8A3B6A3A-A6E2-463E-AB04-C6E3BECBF052"></a><h5 id="BRADV-GUID-8A3B6A3A-A6E2-463E-AB04-C6E3BECBF052" class="sect5"><span class="enumeration_section">21.6.1.1</span>步骤1：为辅助数据库创建Oracle密码文件</h5>
                     <div>
                        <p>有多种方法可以为辅助数据库创建密码文件。</p>
                        <div class="section">
                           <div class="infoboxnotealso" id="GUID-8A3B6A3A-A6E2-463E-AB04-C6E3BECBF052__GUID-21A83444-A0C2-46F6-B9A0-68BC05918C6D">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="../admin/getting-started-with-database-administration.html#ADMIN10241" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a> ，了解如何创建和维护Oracle密码文件</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="BRADV391"></a><a id="BRADV89815"></a><div class="props_rev_3"><a id="GUID-CB6CF781-476B-4E65-A966-3ED4ED3A81FB" name="GUID-CB6CF781-476B-4E65-A966-3ED4ED3A81FB"></a><h5 id="BRADV-GUID-CB6CF781-476B-4E65-A966-3ED4ED3A81FB" class="sect5"><span class="enumeration_section">21.6.1.2</span>步骤2：为辅助数据库创建初始化参数文件</h5>
                     <div>
                        <p>使用文本编辑器为目标数据库主机上的辅助数据库创建初始化参数文件。</p>
                        <div class="section">
                           <div class="infoboxnote" id="GUID-CB6CF781-476B-4E65-A966-3ED4ED3A81FB__GUID-2EDC3F15-B6D8-4EE6-9622-99CE6241ADC9">
                              <p class="notep1">注意：</p>
                              <p>对于TSPITR，目标和辅助数据库实例必须位于同一主机上。</p>
                           </div>
                           <p>在此示例中，假设您的参数文件位于<code class="codeph">/tmp/initAux.ora</code> 。设置下表中描述的参数：</p>
                           <div class="tblformalwide" id="GUID-CB6CF781-476B-4E65-A966-3ED4ED3A81FB__CHDFJCCF">
                              <p class="titleintable">表21-5用户管理的辅助数据库中的初始化参数</p>
                              <table cellpadding="4" cellspacing="0" class="FormalWide" title="用户管理的辅助数据库中的初始化参数" width="100%" border="1" summary="This table is described in the preceding text." frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="43%" id="d92175e4763">初始化参数</th>
                                       <th align="left" valign="bottom" width="14%" id="d92175e4766">强制性？</th>
                                       <th align="left" valign="bottom" width="43%" id="d92175e4769">值</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="43%" id="d92175e4774" headers="d92175e4763 ">
                                          <p><code class="codeph">DB_NAME</code></p>
                                       </td>
                                       <td align="left" valign="top" width="14%" headers="d92175e4774 d92175e4766 ">
                                          <p>是</p>
                                       </td>
                                       <td align="left" valign="top" width="43%" headers="d92175e4774 d92175e4769 ">
                                          <p>与目标数据库同名</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="43%" id="d92175e4785" headers="d92175e4763 ">
                                          <p><code class="codeph">DB_UNIQUE_NAME</code></p>
                                       </td>
                                       <td align="left" valign="top" width="14%" headers="d92175e4785 d92175e4766 ">
                                          <p>是</p>
                                       </td>
                                       <td align="left" valign="top" width="43%" headers="d92175e4785 d92175e4769 ">
                                          <p>与同一Oracle主目录中的任何数据库不同的值。为简单起见，请指定<code class="codeph">_</code> <span class="italic"><code class="codeph">dbname</code></span> 。例如，如果目标数据库名称<code class="codeph">trgt</code> ，然后指定<code class="codeph">_trgt</code> 。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="43%" id="d92175e4808" headers="d92175e4763 ">
                                          <p><code class="codeph">REMOTE_LOGIN_PASSWORDFILE</code></p>
                                       </td>
                                       <td align="left" valign="top" width="14%" headers="d92175e4808 d92175e4766 ">
                                          <p>是</p>
                                       </td>
                                       <td align="left" valign="top" width="43%" headers="d92175e4808 d92175e4769 ">
                                          <p>使用密码文件连接到辅助数据库时设置为<code class="codeph">EXCLUSIVE</code> 。否则，设置为<code class="codeph">NONE</code> 。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="43%" id="d92175e4825" headers="d92175e4763 ">
                                          <p><code class="codeph">兼容</code></p>
                                       </td>
                                       <td align="left" valign="top" width="14%" headers="d92175e4825 d92175e4766 ">
                                          <p>是</p>
                                       </td>
                                       <td align="left" valign="top" width="43%" headers="d92175e4825 d92175e4769 ">
                                          <p>与目标数据库中的参数值相同</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="43%" id="d92175e4836" headers="d92175e4763 ">
                                          <p><code class="codeph">DB_BLOCK_SIZE</code></p>
                                       </td>
                                       <td align="left" valign="top" width="14%" headers="d92175e4836 d92175e4766 ">
                                          <p>是</p>
                                       </td>
                                       <td align="left" valign="top" width="43%" headers="d92175e4836 d92175e4769 ">
                                          <p>如果在目标数据库中设置了此初始化参数，则必须将其设置为辅助数据库中的相同值。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="43%" id="d92175e4847" headers="d92175e4763 ">
                                          <p><code class="codeph">LOG_FILE_NAME_CONVERT</code></p>
                                       </td>
                                       <td align="left" valign="top" width="14%" headers="d92175e4847 d92175e4766 ">
                                          <p>没有</p>
                                       </td>
                                       <td align="left" valign="top" width="43%" headers="d92175e4847 d92175e4769 ">
                                          <p>用于根据目标数据库的联机重做日志名称为辅助数据库的联机重做日志生成文件名的模式。查询<code class="codeph">V$LOGFILE.MEMBER</code>以获取目标实例联机重做日志文件名，并确保转换模式与视图中显示的文件名的格式匹配。
                                          </p>
                                          <p><span class="bold">注意：</span>某些平台不支持以正斜杠或反斜杠（ <code class="codeph">\</code>或<code class="codeph">/</code> ）结束模式。
                                          </p>
                                          <p><span class="bold">另请参阅：</span> <span class="q">“ <a href="performing-rman-tspitr.html#GUID-19B9240A-6158-4353-939C-BB6DB1F02984" title="如果在辅助数据库参数文件中指定LOG_FILE_NAME_CONVERT初始化参数，并且参数成功转换目标的联机重做日志的名称，则此参数将确定联机重做日志位置。">在TSPITR中指定辅助数据库联机日志位置</a> ”，</span>以限制带有OMF文件名的<code class="codeph">LOG_FILE_NAME_CONVERT</code>可能值和<span class="q">“ <a href="performing-rman-tspitr.html#GUID-1E3933FC-9FA4-4012-B59D-A27406A86419" title="辅助集数据文件可以在目标中具有Oracle管理文件（OMF），并且可以使用自动存储管理（ASM）或非ASM存储。当设置了DB_FILE_NAME_CONVERT初始化参数且OMF文件位于ASM或非ASM存储中时，TSPITR以不同方式执行名称转换。">在TSPITR中重命名OMF辅助集文件时的注意事项</a> ”</span></p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="43%" id="d92175e4897" headers="d92175e4763 ">
                                          <p><code class="codeph">DB_FILE_NAME_CONVERT</code></p>
                                       </td>
                                       <td align="left" valign="top" width="14%" headers="d92175e4897 d92175e4766 ">
                                          <p>没有</p>
                                       </td>
                                       <td align="left" valign="top" width="43%" headers="d92175e4897 d92175e4769 ">
                                          <p>用于转换辅助数据库的数据文件的文件名的模式。您可以使用此参数为那些未使用<code class="codeph">SET</code> <code class="codeph">NEWNAME</code>或<code class="codeph">CONFIGURE</code> <code class="codeph">AUXNAME</code>命名的文件生成文件名。通过查询<code class="codeph">V$DATAFILE.NAME</code>获取数据文件名，并确保转换模式与视图中显示的文件名的格式相匹配。
                                          </p>
                                          <p><span class="bold">注意：</span>某些平台不支持以正斜杠或反斜杠（ <code class="codeph">\</code>或<code class="codeph">/</code> ）结束模式。
                                          </p>
                                          <p><span class="bold">另请参阅：</span> <span class="q">“ <a href="performing-rman-tspitr.html#GUID-310586B1-F08C-456C-8398-62CB6930DD4C" title="When you do not want to use an auxiliary destination for all of your auxiliary set data files, but you also do not want to name every file individually, you can include a DB_FILE_NAME_CONVERT initialization parameter in the initialization parameter file used by the auxiliary database.">在TSPITR期间使用DB_FILE_NAME_CONVERT命名辅助设置数据文件</a> ”</span>和<span class="q">“</span> <span class="q"><a href="performing-rman-tspitr.html#GUID-310586B1-F08C-456C-8398-62CB6930DD4C" title="如果您不想为所有辅助集数据文件使用辅助目标，但又不想单独命名每个文件，则可以在辅助数据库使用的初始化参数文件中包含DB_FILE_NAME_CONVERT初始化参数。">在TSPITR中</a></span> <span class="q"><a href="performing-rman-tspitr.html#GUID-1E3933FC-9FA4-4012-B59D-A27406A86419" title="辅助集数据文件可以在目标中具有Oracle管理文件（OMF），并且可以使用自动存储管理（ASM）或非ASM存储。当设置了DB_FILE_NAME_CONVERT初始化参数且OMF文件位于ASM或非ASM存储中时，TSPITR以不同方式执行名称转换。">重命名OMF辅助设置文件时的注意事项</a> ”</span> 。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="43%" id="d92175e4957" headers="d92175e4763 ">
                                          <p><code class="codeph">DB_CREATE_FILE_DEST</code></p>
                                       </td>
                                       <td align="left" valign="top" width="14%" headers="d92175e4957 d92175e4766 ">
                                          <p>没有</p>
                                       </td>
                                       <td align="left" valign="top" width="43%" headers="d92175e4957 d92175e4769 ">
                                          <p>标识所有辅助集文件的位置。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="43%" id="d92175e4968" headers="d92175e4763 ">
                                          <p><code class="codeph">LOG_ARCHIVE_DEST_</code> <span class="italic"><code class="codeph">n</code></span></p>
                                       </td>
                                       <td align="left" valign="top" width="14%" headers="d92175e4968 d92175e4766 ">
                                          <p>没有</p>
                                       </td>
                                       <td align="left" valign="top" width="43%" headers="d92175e4968 d92175e4769 ">
                                          <p>标识创建恢复所需的归档日志的位置。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="43%" id="d92175e4982" headers="d92175e4763 ">
                                          <p><code class="codeph">DB_CREATE_ONLINE_LOG_</code> <span class="italic"><code class="codeph">n</code></span></p>
                                       </td>
                                       <td align="left" valign="top" width="14%" headers="d92175e4982 d92175e4766 ">
                                          <p>没有</p>
                                       </td>
                                       <td align="left" valign="top" width="43%" headers="d92175e4982 d92175e4769 ">
                                          <p>使用<code class="codeph">DB_CREATE_FILE_DEST</code>标识创建联机重做日志的其他位置。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="43%" id="d92175e4999" headers="d92175e4763 ">
                                          <p><code class="codeph">CONTROL_FILES</code></p>
                                       </td>
                                       <td align="left" valign="top" width="14%" headers="d92175e4999 d92175e4766 ">
                                          <p>没有</p>
                                       </td>
                                       <td align="left" valign="top" width="43%" headers="d92175e4999 d92175e4769 ">
                                          <p>与目标实例（或任何其他现有文件）的控制文件名不冲突的文件名。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="43%" id="d92175e5011" headers="d92175e4763 ">
                                          <p><code class="codeph">SGA_TARGET</code></p>
                                       </td>
                                       <td align="left" valign="top" width="14%" headers="d92175e5011 d92175e4766 ">
                                          <p>不（推荐）</p>
                                       </td>
                                       <td align="left" valign="top" width="43%" headers="d92175e5011 d92175e4769 ">
                                          <p><code class="codeph">280M</code></p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="43%" id="d92175e5023" headers="d92175e4763 ">
                                          <p><code class="codeph">STREAMS_POOL_SIZE</code></p>
                                       </td>
                                       <td align="left" valign="top" width="14%" headers="d92175e5023 d92175e4766 ">
                                          <p>没有</p>
                                          <p>是</p>
                                       </td>
                                       <td align="left" valign="top" width="43%" headers="d92175e5023 d92175e4769 ">
                                          <p>如果设置了<code class="codeph">SGA_TARGET</code></p>
                                          <p>如果未设置<code class="codeph">SGA_TARGET</code></p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <p>根据需要设置其他参数，包括指定辅助数据库使用多少内存的参数。</p>
                           <p>以下示例显示了TSPITR的辅助数据库的可能初始化参数设置：</p><pre class="oac_no_warn" dir="ltr">DB_NAME = trgt DB_UNIQUE_NAME = _trgt CONTROL_FILES = / tmp / control01.ctl DB_FILE_NAME_CONVERT =（'/ oracle / oradata / trgt /'，'/ tmp /'）LOG_FILE_NAME_CONVERT =（'/ oracle / oradata / trgt / redo'，'/ tmp / redo'）REMOTE_LOGIN_PASSWORDFILE = exclusive COMPATIBLE = 11.0.0 DB_BLOCK_SIZE = 8192</pre><div class="infoboxnote" id="GUID-CB6CF781-476B-4E65-A966-3ED4ED3A81FB__GUID-A7F17125-27C6-499E-884E-FB6E0CE2A29E">
                              <p class="notep1">注意：</p>
                              <p>设置这些初始化参数后，请确保不要覆盖目标数据库上生产文件的初始化设置。</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="BRADV89816"></a><div class="props_rev_3"><a id="GUID-6485155B-83CB-48B1-ABEB-DEDF86E7E38E" name="GUID-6485155B-83CB-48B1-ABEB-DEDF86E7E38E"></a><h5 id="BRADV-GUID-6485155B-83CB-48B1-ABEB-DEDF86E7E38E" class="sect5"><span class="enumeration_section">21.6.1.3</span>步骤3：检查Oracle Net Connectivity到辅助数据库</h5>
                     <div>
                        <p>辅助数据库必须具有有效的网络服务名称。在继续之前，请使用SQL * Plus确保您可以与辅助数据库建立<code class="codeph">SYSBACKUP</code>或<code class="codeph">SYSDBA</code>连接。
                        </p>
                        <div class="section">
                           <div class="infoboxnotealso" id="GUID-6485155B-83CB-48B1-ABEB-DEDF86E7E38E__GUID-BD7A9395-B62A-4FBF-8B5A-3E8B17A75FB3">
                              <p class="notep1">也可以看看：</p>
                              <p>有关Oracle Net的更多信息，请参见<a href="../netag/identifying-and-accessing-database.html#NETAG177" target="_blank"><span><cite>“Oracle数据库管理员指南”</cite></span></a></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="BRADV89817"></a><div class="props_rev_3"><a id="GUID-41F8F223-E065-445C-AF4B-2343F13813AD" name="GUID-41F8F223-E065-445C-AF4B-2343F13813AD"></a><h4 id="BRADV-GUID-41F8F223-E065-445C-AF4B-2343F13813AD" class="sect4"><span class="enumeration_section">21.6.2</span>使用您自己的辅助数据库为TSPITR准备RMAN命令</h4>
                  <div>
                     <p>使用您自己的辅助实例执行TSPITR时，请记住某些准则。</p>
                     <p>如果运行自己的辅助数据库，那么TSPITR所需的命令序列可能很长。分配复杂通道配置以从备份还原时，可能会发生这种情况，并且您没有使用<code class="codeph">DB_CREATE_FILE_DEST</code>来确定辅助集文件的文件命名。
                     </p>
                     <p>您可能希望将一系列TSPITR命令存储在RMAN命令文件中。仔细检查命令文件以捕获任何错误。要将命令文件读入RMAN，请使用<code class="codeph">@</code>命令（或启动RMAN时的<code class="codeph">CMDFILE</code>命令行参数）。
                     </p>
                     <p>以下示例运行名为<code class="codeph">/tmp/tspitr.rman</code>的命令文件：</p><pre class="oac_no_warn" dir="ltr">@ / TMP / tspitr.rman;</pre><div class="infoboxnotealso" id="GUID-41F8F223-E065-445C-AF4B-2343F13813AD__GUID-AAB70C5F-E819-4CB9-9027-15E31F1D624D">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-5FF51A4E-BC27-41A9-AA83-FF6E761C2535" title="对于重复性任务，您可以创建包含RMAN命令的文本文件，并使用@参数启动RMAN客户端，然后使用文件名。">将命令文件与RMAN一起使用</a> ”</span></p>
                     </div>
                  </div><a id="BRADV89818"></a><div class="sect4"><a id="GUID-DA6FD63F-4E85-4550-A49F-C6E793BD5FC9" name="GUID-DA6FD63F-4E85-4550-A49F-C6E793BD5FC9"></a><h5 id="BRADV-GUID-DA6FD63F-4E85-4550-A49F-C6E793BD5FC9" class="sect5"><span class="enumeration_section">21.6.2.1</span>使用您自己的辅助数据库规划<span class="enumeration_section">TSPITR的</span>通道</h5>
                     <div>
                        <p>可以覆盖使用自己的辅助数据库进行TSPITR时通道的默认行为。</p>
                        <p>运行自己的辅助数据库时，默认行为是使用目标数据库的自动通道配置。如果您决定使用不同的配置分配自己的通道（更改通道数或通道参数），则可以在<code class="codeph">RUN</code>块中包含<code class="codeph">ALLOCATE AUXILIARY CHANNEL</code>命令以及TSPITR的<code class="codeph">RECOVER TABLESPACE</code>命令。如有必要，请计划这些命令，并将它们添加到为TSPITR运行的命令序列中。</p>
                        <div class="infoboxnotealso" id="GUID-DA6FD63F-4E85-4550-A49F-C6E793BD5FC9__GUID-8CB9DE45-B9EA-421B-A579-ACD876C22E26">
                           <p class="notep1">也可以看看：</p>
                           <p><span class="q">“ <a href="performing-rman-tspitr.html#GUID-90328C26-FD61-4BE7-A1C7-0C25E62B73AC" title="此过程使用RECOVER TABLESPACE ...UNTIL命令执行TSPITR。">使用您自己的辅助数据库执行TSPITR：场景</a> ”</span>以了解如何在TSPITR脚本中包含通道分配</p>
                        </div>
                     </div>
                  </div><a id="BRADV89819"></a><div class="props_rev_3"><a id="GUID-56BC4D66-320B-4607-8443-64F577CE28C5" name="GUID-56BC4D66-320B-4607-8443-64F577CE28C5"></a><h5 id="BRADV-GUID-56BC4D66-320B-4607-8443-64F577CE28C5" class="sect5"><span class="enumeration_section">21.6.2.2</span>使用您自己的辅助数据库规划数据文件名：SET NEWNAME</h5>
                     <div>
                        <p>您可能希望使用<code class="codeph">SET NEWNAME</code>命令来引用辅助集文件的现有映像副本以提高TSPITR性能，或者为TSPITR之后的恢复集文件分配新名称。如有必要，请计划这些命令，并将它们添加到为TSPITR运行的命令序列中。</p>
                        <div class="infoboxnotealso" id="GUID-56BC4D66-320B-4607-8443-64F577CE28C5__GUID-6010502B-CC40-4119-97BA-23AB99CB3C68">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="performing-rman-tspitr.html#GUID-1C46D7E5-1A2B-486D-9BE0-88F4B71C7C49" title="您可能不希望恢复集数据文件在其原始位置恢复和恢复。SET NEWNAME命令可用于指定新目标。为恢复集指定新目标时，RMAN不会删除表空间的原始数据文件。">使用SET NEWNAME重命名TSPITR恢复集数据文件</a></p>
                        </div>
                     </div>
                  </div>
               </div><a id="BRADV89820"></a><div class="props_rev_3"><a id="GUID-D4736F75-8BEB-44AB-9CEA-84A534248FB9" name="GUID-D4736F75-8BEB-44AB-9CEA-84A534248FB9"></a><h4 id="BRADV-GUID-D4736F75-8BEB-44AB-9CEA-84A534248FB9" class="sect4"><span class="enumeration_section">21.6.3</span>使用您自己的辅助数据库执行TSPITR</h4>
                  <div>
                     <p>完成先决条件，然后按照本节中的步骤使用您自己的辅助数据库执行TSPITR。</p>
                     <div class="section">
                        <p>执行此任务的先决条件包括：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="performing-rman-tspitr.html#GUID-5E937BD4-2187-491A-AAD1-7A6EDF1E8D8F" title="创建适合用作辅助数据库的Oracle实例需要您执行一组步骤。">为RMAN TSPITR准备自己的辅助数据库</a> ”</span></p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="performing-rman-tspitr.html#GUID-41F8F223-E065-445C-AF4B-2343F13813AD" title="使用您自己的辅助实例执行TSPITR时，请记住某些准则。">使用您自己的辅助数据库为TSPITR准备RMAN命令</a> ”</span></p>
                           </li>
                        </ul>
                        <p>使用以下步骤使用您自己的辅助实例执行TSPITR：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="performing-rman-tspitr.html#GUID-B11C4436-C191-4C77-983C-A2C76C4E94D2" title="在开始RMAN TSPITR之前，必须启动辅助数据库。由于辅助数据库还没有控制文件，因此只能以NOMOUNT模式启动实例。">步骤1：以NOMOUNT模式启动辅助数据库</a></p>
                           </li>
                           <li>
                              <p><a href="performing-rman-tspitr.html#GUID-B13317BE-C92E-45F4-974E-A4B6A44EFA79" title="启动RMAN并连接到目标数据库和手动创建的辅助数据库。">步骤2：将RMAN客户端连接到目标和辅助数据库</a></p>
                           </li>
                           <li>
                              <p><a href="performing-rman-tspitr.html#GUID-17B6A748-6DDF-42C1-B171-86AB8151AA4B" title="使用RECOVER TABLESPACE命令使用您自己的辅助实例执行TSPITR。">第3步：执行RECOVER TABLESPACE命令</a></p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-D4736F75-8BEB-44AB-9CEA-84A534248FB9__GUID-62B85911-23FC-4115-9CBF-27CEB9FFBCEF">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="performing-rman-tspitr.html#GUID-90328C26-FD61-4BE7-A1C7-0C25E62B73AC" title="此过程使用RECOVER TABLESPACE ...UNTIL命令执行TSPITR。">使用您自己的辅助数据库执行TSPITR：场景</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div><a id="BRADV89821"></a><div class="props_rev_3"><a id="GUID-B11C4436-C191-4C77-983C-A2C76C4E94D2" name="GUID-B11C4436-C191-4C77-983C-A2C76C4E94D2"></a><h5 id="BRADV-GUID-B11C4436-C191-4C77-983C-A2C76C4E94D2" class="sect5"><span class="enumeration_section">21.6.3.1</span>步骤1：以NOMOUNT模式启动辅助数据库</h5>
                     <div>
                        <p>在开始RMAN TSPITR之前，必须启动辅助数据库。由于辅助数据库还没有控制文件，因此只能以<code class="codeph">NOMOUNT</code>模式启动实例。
                        </p>
                        <div class="section">
                           <p>不要创建控制文件或尝试为TSPITR安装或打开辅助数据库。</p>
                           <p><span class="bold">要启动辅助数据库：</span></p>
                           <ol>
                              <li>
                                 <p>启动SQL * Plus并使用<code class="codeph">SYSOPER</code>权限连接到辅助数据库。
                                 </p>
                              </li>
                              <li>
                                 <p>以<code class="codeph">NOMOUNT</code>模式启动辅助数据库，必要时指定参数文件。
                                 </p>
                                 <p>例如，输入以下SQL * Plus命令：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; STARTUP NOMOUNT PFILE ='/ tmp / initAux.ora'</pre><p>请记住，如果你指定<code class="codeph">PFILE</code> ，那么对于路径<code class="codeph">PFILE</code>是从中运行的SQL * Plus主机上的客户端的路径。
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="BRADV89822"></a><div class="props_rev_3"><a id="GUID-B13317BE-C92E-45F4-974E-A4B6A44EFA79" name="GUID-B13317BE-C92E-45F4-974E-A4B6A44EFA79"></a><h5 id="BRADV-GUID-B13317BE-C92E-45F4-974E-A4B6A44EFA79" class="sect5"><span class="enumeration_section">21.6.3.2</span>步骤2：将RMAN客户端连接到目标和辅助数据库</h5>
                     <div>
                        <p>启动RMAN并连接到目标数据库和手动创建的辅助数据库。</p>
                        <div class="section">
                           <p>例如，使用如下命令：</p><pre class="oac_no_warn" dir="ltr">rman target dba AUXILIARY auxusr @ aux</pre><div class="infoboxnotealso" id="GUID-B13317BE-C92E-45F4-974E-A4B6A44EFA79__GUID-C6A327B7-49F9-4183-9648-0DB15C9B7BAA">
                              <p class="notep1">也可以看看：</p>
                              <p><span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a> ”</span></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="BRADV89823"></a><div class="props_rev_3"><a id="GUID-17B6A748-6DDF-42C1-B171-86AB8151AA4B" name="GUID-17B6A748-6DDF-42C1-B171-86AB8151AA4B"></a><h5 id="BRADV-GUID-17B6A748-6DDF-42C1-B171-86AB8151AA4B" class="sect5"><span class="enumeration_section">21.6.3.3</span>第3步：执行RECOVER TABLESPACE命令</h5>
                     <div>
                        <p>使用<code class="codeph">RECOVER TABLESPACE</code>命令使用您自己的辅助实例执行TSPITR。
                        </p>
                        <div class="section">
                           <p>在最简单的情况下，运行<code class="codeph">RECOVER TABLESPACE...在RMAN提示符下的UNTIL</code>命令如下：</p><pre class="oac_no_warn" dir="ltr">RECOVER TABLESPACE <span class="italic">ts1，ts2 ......</span> 直到' <span class="italic">时间</span> ';</pre><p>如果要使用<code class="codeph">ALLOCATE AUXILIARY CHANNEL</code>或<code class="codeph">SET NEWNAME</code>命令，请在<code class="codeph">RUN</code>命令中的<code class="codeph">RECOVER TABLESPACE</code>命令之前包含这些命令。以下示例说明了此技术：</p><pre class="oac_no_warn" dir="ltr">RUN {ALLOCATE AUXILIARY CHANNEL c1 DEVICE TYPE DISK; ALLOCATE AUXILIARY CHANNEL c2 DEVICE TYPE sbt; ＃ 等等...RECOVER TABLESPACE <span class="italic">ts1，ts2</span>直到'时间'; }</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="BRADV89825"></a><div class="props_rev_3"><a id="GUID-90328C26-FD61-4BE7-A1C7-0C25E62B73AC" name="GUID-90328C26-FD61-4BE7-A1C7-0C25E62B73AC"></a><h4 id="BRADV-GUID-90328C26-FD61-4BE7-A1C7-0C25E62B73AC" class="sect4"><span class="enumeration_section">21.6.4</span>使用您自己的辅助数据库执行TSPITR：场景</h4>
                  <div>
                     <p>此过程使用<code class="codeph">RECOVER TABLESPACE...UNTIL</code>命令执行TSPITR。</p>
                     <div class="section">
                        <p>此方案说明了RMAN TSPITR的以下功能：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>管理您自己的辅助数据库</p>
                           </li>
                           <li>
                              <p>配置从磁盘和<a href="glossary.html#GUID-2E48CE71-9547-4196-B715-5CE59033262E"><span class="xrefglossterm">SBT</span></a>设备还原备份的通道</p>
                           </li>
                           <li>
                              <p>使用<code class="codeph">SET NEWNAME</code>为某些辅助设置数据文件使用可恢复的映像副本</p>
                           </li>
                           <li>
                              <p>使用<code class="codeph">SET NEWNAME</code>为恢复集数据文件指定新名称</p>
                           </li>
                        </ul>
                        <p><span class="bold">要将TSPITR与您自己的辅助数据库一起使用：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>准备辅助数据库，如<span class="q">“ <a href="performing-rman-tspitr.html#GUID-5E937BD4-2187-491A-AAD1-7A6EDF1E8D8F" title="创建适合用作辅助数据库的Oracle实例需要您执行一组步骤。">为RMAN TSPITR准备自己的辅助数据库</a> ”中所述</span> 。在密码文件中指定辅助数据库的密码，并使用以下设置设置辅助数据库参数文件<code class="codeph">/bigtmp/init_tspitr_prod.ora</code> ：</span><div><pre class="oac_no_warn" dir="ltr">DB_NAME = PROD DB_UNIQUE_NAME = tspitr_PROD CONTROL_FILES = / bigtmp / tspitr_cntrl.dbf DB_CREATE_FILE_DEST = / bigtmp COMPATIBLE = 11.0.0 BLOCK_SIZE = 8192 REMOTE_LOGIN_PASSWORD = exclusive</pre></div>
                        </li>
                        <li class="stepexpand"><span>为辅助数据库创建服务名称<code class="codeph">pitprod</code> ，并检查连接。</span></li>
                        <li class="stepexpand"><span>使用SQL * Plus，使用<code class="codeph">SYSOPER</code>权限连接到辅助数据库。以<code class="codeph">NOMOUNT</code>模式启动实例：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; STARTUP NOMOUNT PFILE = / bigtmp / init_tspitr_prod.ora</pre></div>
                        </li>
                        <li class="stepexpand"><span>启动RMAN并连接到目标和辅助数据库实例，如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a> ”中所述</span> 。</span><div><pre class="oac_no_warn" dir="ltr">rman目标/辅助'“sbu @ pitprod AS SYSBACKUP”'</pre></div>
                        </li>
                        <li class="stepexpand"><span>在<code class="codeph">RUN</code>块中输入以下命令以设置和执行TSPITR：</span><div><pre class="oac_no_warn" dir="ltr">RUN {＃为恢复集数据文件指定NEWNAME为TABLESPACE客户端设置NEWNAME'？/ ORADATA / PROD / REC /％B'; ＃为一些具有有效图像副本的辅助集＃数据文件指定NEWNAMES以避免恢复：SET NEWNAME FOR DATAFILE'？/oradata/prod/system01.dbf'TO'/backups/prod/system01_monday_noon.dbf';为DATAFILE设置NEWNAME'？/oradata/prod/system02.dbf'TO'/backups/prod/system02_monday_noon.dbf';为DATAFILE设置NEWNAME'？/oradata/prod/sysaux01.dbf'TO'/backups/prod/sysaux01_monday_noon.dbf';为DATAFILE设置NEWNAME'？/oradata/prod/undo01.dbf'TO'/backups/prod/undo01_monday_noon.dbf'; ＃指定要使用的通道类型ALLOCATE AUXILIARY CHANNEL c1 DEVICE TYPE DISK; ALLOCATE AUXILIARY CHANNEL t1 DEVICE TYPE sbt; ＃将客户表空间恢复到24小时前：RECOVER TABLESPACE客户端直到'sysdate-1'; }</pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <p>考虑将此命令序列存储在命令文件中并执行命令文件。</p>
                        <p>如果TSPITR操作成功，则结果为：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>恢复集数据文件以<code class="codeph">SET NEWNAME</code>指定的名称在目标数据库控制文件中注册，其内容截至TSPITR的指定时间。</p>
                           </li>
                           <li>
                              <p>RMAN删除辅助文件，包括辅助数据库的控制文件，在线日志和辅助设置数据文件。</p>
                           </li>
                           <li>
                              <p>辅助数据库已关闭。</p>
                           </li>
                        </ul>
                        <p>如果TSPITR操作失败，则删除辅助集文件并关闭辅助数据库。恢复集文件保留在指定位置，并且在失败的TSPITR运行中处于未解决状态。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV99978"></a><div class="props_rev_3"><a id="GUID-9B0BADD4-750E-4D74-A816-07E075B0AA96" name="GUID-9B0BADD4-750E-4D74-A816-07E075B0AA96"></a><h3 id="BRADV-GUID-9B0BADD4-750E-4D74-A816-07E075B0AA96" class="sect3"><span class="enumeration_section">21.7</span> RMAN TSPITR故障排除</h3>
               <div>
                  <p>各种问题都可能导致RMAN TSPITR失败。必须确定并修复问题。</p>
                  <div class="section">
                     <p>要检查和修复的一些可能区域如下：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>文件名冲突</p>
                        </li>
                        <li>
                           <p>表空间和还原段的TSPITR目标时间不匹配或不正确</p>
                        </li>
                        <li>
                           <p>辅助数据库的管理问题不是由RMAN创建的</p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-9B0BADD4-750E-4D74-A816-07E075B0AA96__GUID-B41FF55C-20D0-464C-B567-19BFDAA13D6A">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="performing-rman-tspitr.html#GUID-686CCC72-9402-422C-A7B7-82ABDECE3ACD" title="目标数据库中的文件，SET NEWNAME或CONFIGURE AUXNAME命令分配的文件名以及DB_FILE_NAME_CONVERT参数的效果生成的文件名之间可能会发生名称冲突。">在TSPITR期间解决文件名冲突问题</a></p>
                           </li>
                           <li>
                              <p><a href="performing-rman-tspitr.html#GUID-D4786A53-826B-4503-83DE-B21B98591C0A" title="在TSPITR期间，RMAN需要有关哪些表空间在TSPITR目标时间具有还原段的信息。如果使用此信息，通常可在恢复目录中使用此信息。">在TSPITR期间使用撤消段标识表空间的故障排除</a></p>
                           </li>
                           <li>
                              <p><a href="performing-rman-tspitr.html#GUID-DAF577E1-0177-4EBC-ABF8-3D821BD21BB0" title="如果您正在管理自己的辅助数据库并且TSPITR失败，请不要尝试在不解决错误的情况下重新运行TSPITR。">TSPITR失败后重新启动手动辅助数据库的故障排除</a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div><a id="BRADV89826"></a><div class="props_rev_3"><a id="GUID-686CCC72-9402-422C-A7B7-82ABDECE3ACD" name="GUID-686CCC72-9402-422C-A7B7-82ABDECE3ACD"></a><h4 id="BRADV-GUID-686CCC72-9402-422C-A7B7-82ABDECE3ACD" class="sect4"><span class="enumeration_section">21.7.1</span>在TSPITR期间排除文件名冲突</h4>
                  <div>
                     <p>目标数据库中的文件， <code class="codeph">SET NEWNAME</code>或<code class="codeph">CONFIGURE AUXNAME</code>命令分配的文件名以及<code class="codeph">DB_FILE_NAME_CONVERT</code>参数的效果生成的文件名之间可能会发生名称冲突。
                     </p>
                     <div class="section">
                        <p>假设<code class="codeph">SET NEWNAME</code> ， <code class="codeph">CONFIGURE AUXNAME</code>和<code class="codeph">DB_FILE_NAME_CONVERT</code>导致辅助或恢复集中的多个文件具有相同的名称。在这种情况下，RMAN在TSPITR期间报告错误。要更正此问题，请为这些参数使用不同的值。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV89827"></a><div class="props_rev_3"><a id="GUID-D4786A53-826B-4503-83DE-B21B98591C0A" name="GUID-D4786A53-826B-4503-83DE-B21B98591C0A"></a><h4 id="BRADV-GUID-D4786A53-826B-4503-83DE-B21B98591C0A" class="sect4"><span class="enumeration_section">21.7.2</span>在TSPITR期间对具有撤消段的表空间标识进行故障排除</h4>
                  <div>
                     <p>在TSPITR期间，RMAN需要有关哪些表空间在TSPITR目标时间具有还原段的信息。如果使用此信息，通常可在恢复目录中使用此信息。</p>
                     <div class="section">
                        <p>如果没有恢复目录或者在恢复目录中找不到该信息，则RMAN假定在目标时间具有还原段的表空间集合等于当前具有还原段的表空间集合。如果此假设不正确，则TSPITR会因错误而失败。在这种情况下，使用<code class="codeph">UNDO TABLESPACE</code>子句在目标时间提供具有还原段的表空间列表。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV89828"></a><div class="props_rev_3"><a id="GUID-DAF577E1-0177-4EBC-ABF8-3D821BD21BB0" name="GUID-DAF577E1-0177-4EBC-ABF8-3D821BD21BB0"></a><h4 id="BRADV-GUID-DAF577E1-0177-4EBC-ABF8-3D821BD21BB0" class="sect4"><span class="enumeration_section">21.7.3</span> TSPITR失败后重启手动辅助数据库的故障排除</h4>
                  <div>
                     <p>如果您正在管理自己的辅助数据库并且TSPITR失败，请不要尝试在不解决错误的情况下重新运行TSPITR。</p>
                     <div class="section">
                        <p>你必须遵循这种方法：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li><span>确定并解决阻止TSPITR成功运行的问题。</span></li>
                        <li><span>以<code class="codeph">NOMOUNT</code>启动辅助数据库。</span></li>
                        <li><span>再次运行TSPITR。</span></li>
                     </ol>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>