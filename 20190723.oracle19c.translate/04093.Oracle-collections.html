<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>使用Oracle Collections</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="JDBC Developer&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="JDBC Developer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="jdbc-developers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-02-13T13:20:37-08:00"></meta>
      <meta name="dcterms.title" content="JDBC Developer&#39;s Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="1999, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96471-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="Oracle-object-references.html" title="Previous" type="text/html"></link>
      <link rel="next" href="resultset.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="JJDBC"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="Oracle-object-references.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="resultset.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">JDBC开发人员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="data-access-and-manipulation.html" property="item" typeof="WebPage"><span property="name">数据访问和操作</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">使用Oracle Collections</li>
            </ol>
            <a id="GUID-338038DB-AE3A-4C82-BB8F-8C87F2D130C4" name="GUID-338038DB-AE3A-4C82-BB8F-8C87F2D130C4"></a><a id="JJDBC28574"></a>
            
            <h2 id="JJDBC-GUID-338038DB-AE3A-4C82-BB8F-8C87F2D130C4" class="sect2"><span class="enumeration_chapter">16</span>使用Oracle Collections</h2>
         </header>
         <div class="ind">
            <div>
               <p><a id="d57778e21" class="indexterm-anchor"></a><a id="d57778e25" class="indexterm-anchor"></a>本章介绍Oracle标准Java数据库连接（JDBC）的扩展，它允许您访问和操作映射到Java阵列及其数据的Oracle集合。讨论了以下主题：</p>
               <div class="infoboxnote" id="GUID-338038DB-AE3A-4C82-BB8F-8C87F2D130C4__GUID-27A720D7-E1ED-4394-882E-F160C869C3FA">
                  <p class="notep1">注意：</p>
                  <p>从Oracle Database 12 <span class="italic">c</span>第1版（12.1）开始， <code class="codeph">oracle.sql.不推荐使用ARRAY</code>类，并将其替换为<code class="codeph">oracle.jdbc.OracleArray</code>接口，它是<code class="codeph">oracle.jdbc</code>包的一部分。Oracle建议您尽可能使用<code class="codeph">java.sql</code>包中提供的方法，以<code class="codeph">java.sql</code> Oracle特定扩展的<code class="codeph">oracle.jdbc</code>包中提供的标准兼容性和方法。有关<code class="codeph">oracle.jdbc.更多信息，请参阅MoS Note 1364193.1 <code class="codeph">oracle.jdbc.OracleArray</code>接口。
                  </p>
               </div>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="Oracle-collections.html#GUID-76466A35-B189-4A20-B068-578BD0939CD1">Oracle集合扩展</a></p>
                  </li>
                  <li>
                     <p><a href="Oracle-collections.html#GUID-E57699B6-491C-4430-90EB-8FF1912440DA">集合功能概述</a></p>
                  </li>
                  <li>
                     <p><a href="Oracle-collections.html#GUID-00517CE4-DC23-4D01-B878-9C50E19B3B0F">ARRAY性能扩展方法</a></p>
                  </li>
                  <li>
                     <p><a href="Oracle-collections.html#GUID-BC05FE69-643F-44AF-8D86-2E181F7E6628">创建和使用数组</a></p>
                  </li>
                  <li>
                     <p><a href="Oracle-collections.html#GUID-22D90043-E417-4BC3-A838-0DBA954AF2AA">使用类型映射来映射数组元素</a></p>
                  </li>
               </ul>
            </div><a id="JJDBC28575"></a><div class="props_rev_3"><a id="GUID-76466A35-B189-4A20-B068-578BD0939CD1" name="GUID-76466A35-B189-4A20-B068-578BD0939CD1"></a><h3 id="JJDBC-GUID-76466A35-B189-4A20-B068-578BD0939CD1" class="sect3"><span class="enumeration_section">16.1</span> Oracle集合扩展</h3>
               <div>
                  <p>本节包括以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="Oracle-collections.html#GUID-1EDB1964-71FF-4AB1-BD7D-86F15D609D4D">Oracle集合概述</a></p>
                     </li>
                     <li>
                        <p><a href="Oracle-collections.html#GUID-5015B2F4-54A8-4B55-A02F-E10D66887003">物化集合中的选择</a></p>
                     </li>
                     <li>
                        <p><a href="Oracle-collections.html#GUID-13E05667-1EFB-464F-B91F-32E99543DD3F">创建集合</a></p>
                     </li>
                     <li>
                        <p><a href="Oracle-collections.html#GUID-D2501ACA-FF2D-4973-B700-7A1024404948">创建多级集合类型</a></p>
                     </li>
                  </ul>
               </div>
               <div class="props_rev_3"><a id="GUID-1EDB1964-71FF-4AB1-BD7D-86F15D609D4D" name="GUID-1EDB1964-71FF-4AB1-BD7D-86F15D609D4D"></a><h4 id="JJDBC-GUID-1EDB1964-71FF-4AB1-BD7D-86F15D609D4D" class="sect4"><span class="enumeration_section">16.1.1</span> Oracle集合概述</h4>
                  <div>
                     <p>Oracle协作（数据库中的变量数组（VARRAY）或嵌套表）映射到Java中的数组。JDBC 2.0 arr ays用于在Java中实现Oracle集合。术语集合和数组有时可互换使用。但是，集合更适合数据库端，而数组更适合JDBC应用程序端。
                     </p>
                     <p>Oracle仅支持<a id="d57778e163" class="indexterm-anchor"></a><a id="d57778e165" class="indexterm-anchor"></a>命名集合，您可以在其中指定SQL类型名称以描述集合类型。JDBC使您可以将数组用作以下任何一种：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">SELECT</code>子句中的列</p>
                        </li>
                        <li>
                           <p><code class="codeph">IN</code>或<code class="codeph">OUT</code>绑定变量</p>
                        </li>
                        <li>
                           <p>Oracle对象中的属性</p>
                        </li>
                        <li>
                           <p>其他数组的元素</p>
                        </li>
                     </ul>
                  </div>
               </div><a id="JJDBC28576"></a><div class="props_rev_3"><a id="GUID-5015B2F4-54A8-4B55-A02F-E10D66887003" name="GUID-5015B2F4-54A8-4B55-A02F-E10D66887003"></a><h4 id="JJDBC-GUID-5015B2F4-54A8-4B55-A02F-E10D66887003" class="sect4"><span class="enumeration_section">16.1.2</span>实现集合的选择</h4>
                  <div>
                     <p>在您的应用程序中，您可以选择将集合具体化为<code class="codeph">oracle.sql.的实例<code class="codeph">oracle.sql.ARRAY</code>类，它是弱类型的，或者实现它是您事先创建的自定义Java类的实例，它是强类型的。用于集合的自定义Java类称为cus tom集合类。自定义集合类必须实现Oracle <code class="codeph">oracle.jdbc.OracleData</code>接口。此外，自定义类或伴随类必须实现<code class="codeph">oracle.jdbc.OracleDataFactory</code> 。标准的<code class="codeph">java.sql.SQLData</code>接口仅用于映射SQL对象类型。
                     </p>
                     <p><code class="codeph">oracle.sql.ARRAY</code>类实现标准<code class="codeph">java.sql.Array</code>接口。
                     </p>
                     <p><code class="codeph">ARRAY</code>类包括作为整体检索数组，检索数组元素的子集以及检索数组元素的SQL基类型名称的功能。但是，您无法写入数组，因为没有setter方法。
                     </p>
                     <p>与<code class="codeph">ARRAY</code>类一样，自定义集合类使您可以检索全部或部分数组并获取SQL基本类型名称。它们还具有强类型的优点，可以帮助您在编译期间找到编码错误，这些编码错误可能直到运行时才会被发现。
                     </p>
                     <div class="infoboxnote" id="GUID-5015B2F4-54A8-4B55-A02F-E10D66887003__GUID-784F5C91-A81F-4277-A272-D2FC108607CF">
                        <p class="notep1">注意：</p>
                        <p>访问VARRAY和访问嵌套表之间的代码没有区别。<code class="codeph">ARRAY</code>类方法可以确定它们是应用于VARRAY还是嵌套表，并通过采取适当的操作进行响应。
                        </p>
                     </div>
                  </div>
               </div><a id="JJDBC28577"></a><div class="props_rev_3"><a id="GUID-13E05667-1EFB-464F-B91F-32E99543DD3F" name="GUID-13E05667-1EFB-464F-B91F-32E99543DD3F"></a><h4 id="JJDBC-GUID-13E05667-1EFB-464F-B91F-32E99543DD3F" class="sect4"><span class="enumeration_section">16.1.3</span>创建集合</h4>
                  <div>
                     <div class="section">
                        <p>由于Oracle仅支持命名集合，因此必须声明特定的<code class="codeph">VARRAY</code>类型名称或嵌套的表类型名称。VARRAY和嵌套表本身不是类型，而是类型的类别。
                        </p>
                        <p>使用SQL <code class="codeph">CREATE TYPE</code>语句创建SQL类型名称时，会为其分配SQL类型名称：</p><pre class="oac_no_warn" dir="ltr">CREATE TYPE &lt; <span class="italic">sql_type_name</span> &gt; AS &lt; <span class="italic">datatype</span> &gt;;</pre><p>VARRAY是一个不同大小的数组。它有一组有序的数据元素，所有元素都具有相同的数据类型。每个元素都有一个索引，它是一个与VARRAY中元素位置相对应的数字。 VARRAY中元素的数量是VARRAY的大小。声明<code class="codeph">VARRAY</code>类型时，必须指定最大大小。例如：</p><pre class="oac_no_warn" dir="ltr">CREATE TYPE myNumType AS VARRAY（10）OF NUMBER;</pre><p>此语句将<code class="codeph">myNumType</code>定义为SQL类型名称，该名称描述可包含不超过10个元素的<code class="codeph">myNumType</code>值<code class="codeph">NUMBER</code>值。
                        </p>
                        <p>嵌套表是一组无序的数据元素，所有数据类型都相同。数据库将嵌套表存储在具有单个列的单独表中，该列的类型是内置类型或对象类型。如果表是对象类型，则它也可以被视为多列表，对象类型的每个属性都有一列。您可以按如下方式创建嵌套表：</p><pre class="oac_no_warn" dir="ltr">CREATE TYPE myNumList AS TABLE OF integer;</pre><p>此语句将<code class="codeph">myNumList</code>标识为SQL类型名称，该名称定义用于<code class="codeph">INTEGER</code>类型的嵌套表的表类型。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="JJDBC28578"></a><div class="props_rev_3"><a id="GUID-D2501ACA-FF2D-4973-B700-7A1024404948" name="GUID-D2501ACA-FF2D-4973-B700-7A1024404948"></a><h4 id="JJDBC-GUID-D2501ACA-FF2D-4973-B700-7A1024404948" class="sect4"><span class="enumeration_section">16.1.4</span>创建多级集合类型</h4>
                  <div>
                     <div class="section">
                        <p>在JDBC中创建新的多级集合类型的最常用方法是将SQL <code class="codeph">CREATE TYPE</code>语句传递给<code class="codeph">java.sql.的<code class="codeph">execute</code>方法<code class="codeph">java.sql.Statement</code>课。以下代码创建一个级别的嵌套表<code class="codeph">first_level</code>和一个两级嵌套表<code class="codeph">second_level</code> ：</p><pre class="oac_no_warn" dir="ltr">Connection conn = .... //创建数据库//连接语句stmt = conn.createStatement（）; //打开一个数据库// cursor stmt.execute（“CREATE TYPE first_level AS TABLE OF NUMBER”）; //创建一个数字stmt.execute的嵌套//表（“CREATE TYPE second_level AS TABLE OF first_level”）; //创建一个//两级嵌套表... //这里的其他操作stmt.close（）; //释放// resource conn.close（）; //关闭//数据库连接</pre><p>一旦创建了多级集合类型，它们就可以用作基表的两列以及对象类型的属性。</p>
                        <div class="infoboxnote" id="GUID-D2501ACA-FF2D-4973-B700-7A1024404948__GUID-5D0769DC-78A0-4B80-A442-702A2185F5C7">
                           <p class="notep1">注意：</p>
                           <p>多级集合类型仅适用于Oracle9 <span class="italic">i</span>及更高版本。
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="JJDBC28580"></a><a id="JJDBC28581"></a><a id="JJDBC28579"></a><div class="props_rev_3"><a id="GUID-E57699B6-491C-4430-90EB-8FF1912440DA" name="GUID-E57699B6-491C-4430-90EB-8FF1912440DA"></a><h3 id="JJDBC-GUID-E57699B6-491C-4430-90EB-8FF1912440DA" class="sect3"><span class="enumeration_section">16.2</span>集合功能概述</h3>
               <div>
                  <div class="section">
                     <p>您可以通过结果集或可调用语句在数组实例中获取集合数据，并将其作为绑定变量传递回预准备语句或可调用语句中。</p>
                     <p><code class="codeph">oracle.sql.ARRAY</code>类，它实现标准的<code class="codeph">java.sql.Array</code>接口，提供访问和更新Oracle集合数据的必要功能。
                     </p>
                     <p>本节介绍Array Getter和Setter方法。使用以下结果集，可调用语句和预准备语句方法来检索集合并将其作为Java数组传递。</p>
                     <div class="infoboxnote" id="GUID-E57699B6-491C-4430-90EB-8FF1912440DA__GUID-A1E8F2AA-B5BE-4916-8481-B043026B32CB">
                        <p class="notep1">注意：</p>
                        <p>从Oracle Database 12 <span class="italic">c</span>第1版（12.1）开始， <code class="codeph">oracle.sql.不推荐使用ARRAY</code>类，并将其替换为<code class="codeph">oracle.jdbc.OracleArray</code>接口，它是<code class="codeph">oracle.jdbc</code>包的一部分。Oracle建议您尽可能使用<code class="codeph">java.sql</code>包中提供的方法，以<code class="codeph">java.sql</code> Oracle特定扩展的<code class="codeph">oracle.jdbc</code>包中提供的标准兼容性和方法。有关<code class="codeph">oracle.jdbc.更多信息，请参阅MoS Note 1364193.1 <code class="codeph">oracle.jdbc.OracleArray</code>接口。
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-E57699B6-491C-4430-90EB-8FF1912440DA__GUID-C760E9B9-5EDC-4354-B4CC-A830A3FB886D">结果集和可调用语句Getter方法</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>的<code class="codeph">OracleResultSet</code>和<code class="codeph">OracleCallableStatement</code>接口支持<code class="codeph">getARRAY</code>和<code class="codeph">getArray</code>方法来检索<code class="codeph">ARRAY</code>对象作为输出参数，无论是作为<code class="codeph">oracle.sql.ARRAY</code>实例或<code class="codeph">java.sql.Array</code>实例。您还可以使用<code class="codeph">getObject</code>方法。这些方法将<code class="codeph">String</code>列名或<code class="codeph">int</code>列索引作为输入。
                     </p>
                     <div class="infoboxnote" id="GUID-E57699B6-491C-4430-90EB-8FF1912440DA__GUID-BFEF1A4E-F3E5-4585-89AB-EE6BCA3A05FD">
                        <p class="notep1">注意：</p>
                        <p>Oracle JDBC驱动程序缓存数组和结构描述符。这提供了巨大的性能优势;但是，这意味着如果更改数据库中数组类型的基础类型定义，则该数组类型的高速缓存描述符将变为陈旧，并且您的应用程序将收到<code class="codeph">SQLException</code> 。
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-E57699B6-491C-4430-90EB-8FF1912440DA__GUID-4077765D-C4F8-4A3E-B2CD-13364B0F57F9">准备和可调用语句设置器方法</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>该<code class="codeph">OraclePreparedStatement</code>和<code class="codeph">OracleCallableStatement</code>类支持<code class="codeph">setARRAY</code>和<code class="codeph">setArray</code>方法采取更新的<code class="codeph">ARRAY</code>对象作为绑定变量，并将它们传递到数据库。您还可以使用<code class="codeph">setObject</code>方法。这些方法将<code class="codeph">String</code>参数名称或<code class="codeph">int</code>参数索引以及<code class="codeph">oracle.sql.作为输入<code class="codeph">oracle.sql.ARRAY</code>实例或<code class="codeph">java.sql.Array</code>实例。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDBC28585"></a><div class="props_rev_3"><a id="GUID-00517CE4-DC23-4D01-B878-9C50E19B3B0F" name="GUID-00517CE4-DC23-4D01-B878-9C50E19B3B0F"></a><h3 id="JJDBC-GUID-00517CE4-DC23-4D01-B878-9C50E19B3B0F" class="sect3"><span class="enumeration_section">16.3</span> ARRAY性能扩展方法</h3>
               <div>
                  <div class="section">
                     <p>本节讨论以下主题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="Oracle-collections.html#GUID-C51FE01E-CB73-4BFB-A0A3-3474C5DE5E6A">关于访问oracle.sql。ARRAY元素作为Java原始类型的数组</a></p>
                        </li>
                        <li>
                           <p><a href="Oracle-collections.html#GUID-33CC8F2C-4E73-412B-990E-D4293173E199">ARRAY自动元素缓冲</a></p>
                        </li>
                        <li>
                           <p><a href="Oracle-collections.html#GUID-98DAE89F-6100-4D1F-8E65-546E7943A191">ARRAY自动索引</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="JJDBC28586"></a><div class="props_rev_3"><a id="GUID-C51FE01E-CB73-4BFB-A0A3-3474C5DE5E6A" name="GUID-C51FE01E-CB73-4BFB-A0A3-3474C5DE5E6A"></a><h4 id="JJDBC-GUID-C51FE01E-CB73-4BFB-A0A3-3474C5DE5E6A" class="sect4"><span class="enumeration_section">16.3.1</span>关于访问oracle.sql。ARRAY元素作为Java原始类型的数组</h4>
                  <div>
                     <div class="section">
                        <p><code class="codeph">oracle.sql.ARRAY</code>类包含将数组元素作为Java基元类型返回的方法。这些方法使您能够比作为<code class="codeph">Datum</code>实例访问它们然后转换每个<code class="codeph">Datum</code>更有效地访问集合元素<a id="d57778e592" class="indexterm-anchor"></a>实例到其Java原始值。
                        </p>
                        <div class="infoboxnote" id="GUID-C51FE01E-CB73-4BFB-A0A3-3474C5DE5E6A__GUID-425AD159-0FD8-47BD-B324-5E8129160CDF">
                           <p class="notep1">注意：</p>
                           <p>这些<code class="codeph">oracle.sql.专门方法<code class="codeph">oracle.sql.ARRAY</code>类仅限于数字集合。
                           </p>
                        </div>
                        <p>使用第一个签名的每个方法都将集合元素作为<span class="italic"><code class="codeph">XXX</code></span> <code class="codeph">[]</code>返回，其中<span class="italic"><code class="codeph">XXX</code></span>是Java基元类型。使用第二个签名的每个方法都返回一个集合的片段，其中包含从<code class="codeph">count</code>指定的元素<code class="codeph">count</code> ，从<code class="codeph">index</code>位置开始。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="JJDBC28587"></a><div class="props_rev_3"><a id="GUID-33CC8F2C-4E73-412B-990E-D4293173E199" name="GUID-33CC8F2C-4E73-412B-990E-D4293173E199"></a><h4 id="JJDBC-GUID-33CC8F2C-4E73-412B-990E-D4293173E199" class="sect4"><span class="enumeration_section">16.3.2</span> ARRAY自动元素缓冲</h4>
                  <div>
                     <p>Oracle JDBC驱动程序提供了公共方法来启用和禁用<code class="codeph">ARRAY</code>内容的缓冲。
                     </p>
                     <p><code class="codeph">oracle.sql.包含以下方法<code class="codeph">oracle.sql.ARRAY</code>课程：<code class="codeph"></code></p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">setAutoBuffering</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">getAutoBuffering</code></p>
                        </li>
                     </ul>
                     <p>当<code class="codeph">getAttributes</code>和<code class="codeph">getArray</code>方法多次访问<code class="codeph">ARRAY</code>元素时，建议在JDBC应用程序中启用自动缓冲，假设<code class="codeph">ARRAY</code>数据能够适应Java虚拟机（JVM）内存而不会溢出。
                     </p>
                     <div class="infoboxnote" id="GUID-33CC8F2C-4E73-412B-990E-D4293173E199__GUID-9448147D-D099-471B-A7D9-9EA37BBBAB02">
                        <p class="notep1">注意：</p>
                        <p>缓冲转换后的元素可能会导致JDBC应用程序消耗大量内存。</p>
                     </div>
                     <p>启用自动缓冲时， <code class="codeph">oracle.sql.ARRAY</code>对象保留所有转换元素的本地副本。保留此数据，以便第二次访问此信息不需要通过数据格式转换过程。
                     </p>
                  </div>
               </div><a id="JJDBC28588"></a><div class="props_rev_3"><a id="GUID-98DAE89F-6100-4D1F-8E65-546E7943A191" name="GUID-98DAE89F-6100-4D1F-8E65-546E7943A191"></a><h4 id="JJDBC-GUID-98DAE89F-6100-4D1F-8E65-546E7943A191" class="sect4"><span class="enumeration_section">16.3.3</span> ARRAY自动索引</h4>
                  <div>
                     <div class="section">
                        <p>如果数组处于自动索引模式，则数组对象维护索引表以加速数组元素访问。</p>
                        <p><code class="codeph">oracle.sql.ARRAY</code>类包含以下支持自动数组索引的方法：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">setAutoIndexing（布尔）</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">setAutoIndexing（boolean，int）</code></p>
                           </li>
                        </ul>
                        <p>默认情况下，不启用自动索引。对于JDBC应用程序，如果可以通过<code class="codeph">getArray</code>和<code class="codeph">getResultSet</code>方法对数组元素进行随机访问，则为<code class="codeph">ARRAY</code>对象启用自动索引。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="JJDBC28589"></a><div class="props_rev_3"><a id="GUID-BC05FE69-643F-44AF-8D86-2E181F7E6628" name="GUID-BC05FE69-643F-44AF-8D86-2E181F7E6628"></a><h3 id="JJDBC-GUID-BC05FE69-643F-44AF-8D86-2E181F7E6628" class="sect3"><span class="enumeration_section">16.4</span>创建和使用数组</h3>
               <div>
                  <p>本节讨论如何创建数组对象以及如何检索集合对象并将其作为数组对象传递，包括以下主题。</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="Oracle-collections.html#GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971">创建ARRAY对象</a></p>
                     </li>
                     <li>
                        <p><a href="Oracle-collections.html#GUID-ED588B9D-376A-4037-9C46-62642261E62D">检索数组及其元素</a></p>
                     </li>
                     <li>
                        <p><a href="Oracle-collections.html#GUID-BCCFF59D-D84C-410B-B681-BA5AA6285EC6">将数组传递给语句对象</a></p>
                     </li>
                  </ul>
               </div><a id="JJDBC28591"></a><a id="JJDBC28592"></a><a id="JJDBC28590"></a><div class="props_rev_3"><a id="GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971" name="GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971"></a><h4 id="JJDBC-GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971" class="sect4"><span class="enumeration_section">16.4.1</span>创建ARRAY对象</h4>
                  <div>
                     <div class="section">
                        <div class="infoboxnote" id="GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971__GUID-FA6524BD-94F4-4267-BFEB-79C71B2C0640">
                           <p class="notep1">注意：</p>
                           <p>Oracle JDBC不支持<code class="codeph">java.sql.的JDBC 4.0方法<code class="codeph">createArrayOf</code>方法<code class="codeph">java.sql.Connection</code>界面。此方法仅允许匿名数组类型，而所有Oracle数组类型都已命名。使用Oracle特定方法<code class="codeph">oracle.jdbc.而是OracleConnection.createARRAY</code> 。
                           </p>
                        </div>
                        <p>本节介绍如何创建<code class="codeph">ARRAY</code>对象。本节包括以下主题：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="Oracle-collections.html#GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971__i1056527">创建ARRAY对象的步骤</a></p>
                           </li>
                           <li>
                              <p><a href="Oracle-collections.html#GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971__BABHIJHB">例16-1</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section" id="GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971__i1056527">
                        <p class="subhead3" id="GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971__GUID-63581558-994D-4D2F-9BE4-3E142B8BD9C2">创建ARRAY对象的步骤</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>从Oracle Database <span class="italic">11g</span>第1版开始，您可以使用<code class="codeph">oracle.jdbc.的<code class="codeph">createARRAY</code>工厂方法<code class="codeph">oracle.jdbc.OracleConnection</code>接口创建数组对象。创建数组的工厂方法定义如下：</p><pre class="oac_no_warn" dir="ltr">public ARRAY createARRAY（java.lang。String typeName，java.lang。对象元素）抛出SQLException</pre><p>其中， <code class="codeph">typeName</code>是创建的对象的SQL类型的名称，而<code class="codeph">elements</code>是创建的对象的元素。
                        </p>
                        <p>执行以下操作以创建数组：<a id="d57778e854" class="indexterm-anchor"></a><a id="d57778e856" class="indexterm-anchor"></a></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>使用<code class="codeph">CREATE</code> <code class="codeph">TYPE</code>语句创建一个集合，如下所示：</span><div><pre class="oac_no_warn" dir="ltr">CREATE TYPE元素AS varray（22）OF NUMBER（5,2）;</pre><p><code class="codeph">elements</code>内容的两种可能性是：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>一组Java原语。例如， <code class="codeph">int[]</code> 。
                                    </p>
                                 </li>
                                 <li>
                                    <p>一组Java对象，例如<span class="italic"><code class="codeph">xxx</code></span> <code class="codeph">[]</code> ，其中<span class="italic"><code class="codeph">xxx</code></span>是Java类的名称。例如， <code class="codeph">Integer[]</code> 。
                                    </p>
                                    <div class="infoboxnote" id="GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971__GUID-D9D54940-C7B1-4A46-974F-0CFCED523F53">
                                       <p class="notep1">注意：</p>
                                       <p><code class="codeph">OraclePreparedStatement</code>类的<code class="codeph">setARRAY</code> ， <code class="codeph">setArray</code>和<code class="codeph">setObject</code>方法采用<code class="codeph">oracle.sql.类型的对象<code class="codeph">oracle.sql.ARRAY</code>作为参数，而不是对象数组。
                                       </p>
                                    </div>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>构造<code class="codeph">ARRAY</code>对象<a id="d57778e925" class="indexterm-anchor"></a>通过传递指定数组的用户定义的SQL类型名称的Java字符串和包含您希望数组包含的各个元素的Java对象。</span><div><pre class="oac_no_warn" dir="ltr">ARRAY array = oracle.jdbc。OracleConnection.createARRAY（sql_type_name，elements）;</pre></div>
                        </li>
                     </ol>
                     <div class="example" id="GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971__GUID-C206255F-92D8-485B-AFA2-024913C943C6">
                        <div class="infoboxnote" id="GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971__GUID-05883EBC-F574-41CC-AFA4-EE2C7944C19C">
                           <p class="notep1">注意：</p>
                           <p>集合类型的名称与元素的类型名称不同。例如：</p><pre class="oac_no_warn" dir="ltr"><code class="codeph">CREATE TYPE person AS object</code> <code class="codeph">(c1 NUMBER(5), c2 VARCHAR2(30));</code> <code class="codeph">CREATE TYPE array_of_persons AS varray(10)</code> OF person;</pre><p>在前面的语句中，集合类型的名称是<code class="codeph">ARRAY_OF_PERSON</code> 。集合元素的SQL类型名称是<code class="codeph">PERSON</code> 。</p>
                        </div>
                     </div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-10D24D4A-4A0F-41DE-96CE-B9EED2583971__BABHIJHB">
                        <p class="titleinexample">示例16-1创建多级集合</p>
                        <p>与单级集合一样，JDBC应用程序可以创建<code class="codeph">oracle.sql.ARRAY</code>实例表示多级集合，然后将实例发送到数据库。用于创建单级集合的相同<code class="codeph">createARRAY</code>工厂方法也可用于创建多级集合。要创建单级集合，元素是一维Java数组，而要创建多级集合，元素可以是<code class="codeph">oracle.sql.数组<code class="codeph">oracle.sql.ARRAY[]</code>元素或嵌套的Java数组或组合。
                        </p>
                        <p>以下代码显示了如何使用嵌套Java数组创建集合类型：</p><pre class="oac_no_warn" dir="ltr">//将多级集合元素准备为嵌套的Java数组int [] [] [] elements = {{{1}，{1,2}}，{{2}，{2,3}}，{{3} ，{3,4}}}; //使用工厂方法ARRAY array = oracle.jdbc创建ARRAY。OracleConnection.createARRAY（sql_type_name，elements）;</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="JJDBC28595"></a><div class="props_rev_3"><a id="GUID-ED588B9D-376A-4037-9C46-62642261E62D" name="GUID-ED588B9D-376A-4037-9C46-62642261E62D"></a><h4 id="JJDBC-GUID-ED588B9D-376A-4037-9C46-62642261E62D" class="sect4"><span class="enumeration_section">16.4.2</span>检索数组及其元素</h4>
                  <div>
                     <div class="section">
                        <p>本节首先讨论如何从结果集中检索整个<code class="codeph">ARRAY</code>实例，然后讨论如何从<code class="codeph">ARRAY</code>实例中检索元素。本节包括以下主题：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="Oracle-collections.html#GUID-54680CDD-B176-4E5C-9153-96740C48116E">关于检索数组</a></p>
                           </li>
                           <li>
                              <p><a href="Oracle-collections.html#GUID-3BA98572-FD68-4137-B87E-0DC2AAAC65EE">数据检索方法</a></p>
                           </li>
                           <li>
                              <p><a href="Oracle-collections.html#GUID-E2AE8600-F9A9-458B-83B8-C01BCAD51365">比较数据检索方法</a></p>
                           </li>
                           <li>
                              <p><a href="Oracle-collections.html#GUID-4872A6DE-E029-44CF-AF71-4C70979B8F63">根据类型映射检索结构化对象数组的元素</a></p>
                           </li>
                           <li>
                              <p><a href="Oracle-collections.html#GUID-6D8BD317-1F52-4CF6-8E4A-096989E8D2A6">检索数组元素的子集</a></p>
                           </li>
                           <li>
                              <p><a href="Oracle-collections.html#GUID-BCD2C704-39EA-4B52-B3CB-E192F715ED84">将数组元素检索到oracle.sql中。基准数组</a></p>
                           </li>
                           <li>
                              <p><a href="Oracle-collections.html#GUID-A374A861-2770-418F-9CF6-DBB807CE282C">关于访问多级集合元素</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div><a id="JJDBC28596"></a><div class="props_rev_3"><a id="GUID-54680CDD-B176-4E5C-9153-96740C48116E" name="GUID-54680CDD-B176-4E5C-9153-96740C48116E"></a><h5 id="JJDBC-GUID-54680CDD-B176-4E5C-9153-96740C48116E" class="sect5"><span class="enumeration_section">16.4.2.1</span>关于检索数组</h5>
                     <div>
                        <div class="section">
                           <p>您可以通过将结果集转换为<code class="codeph">OracleResultSet</code>并使用<code class="codeph">getARRAY</code>方法从结果集中检索SQL数组，该方法返回<code class="codeph">oracle.sql.ARRAY</code>对象。如果要避免转换结果集，则可以使用<code class="codeph">java.sql.指定的标准<code class="codeph">getObject</code>方法<code class="codeph">java.sql.ResultSet</code>接口并将输出转换为<code class="codeph">oracle.sql.ARRAY</code> 。</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="JJDBC28598"></a><a id="JJDBC28599"></a><a id="JJDBC28600"></a><a id="JJDBC28597"></a><div class="props_rev_3"><a id="GUID-3BA98572-FD68-4137-B87E-0DC2AAAC65EE" name="GUID-3BA98572-FD68-4137-B87E-0DC2AAAC65EE"></a><h5 id="JJDBC-GUID-3BA98572-FD68-4137-B87E-0DC2AAAC65EE" class="sect5"><span class="enumeration_section">16.4.2.2</span>数据检索方法</h5>
                     <div>
                        <div class="section">
                           <p>一旦有了<code class="codeph">ARRAY</code>对象，就可以使用<code class="codeph">oracle.sql.的这三个重载方法之一来检索数据<code class="codeph">oracle.sql.ARRAY</code>课程：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">的getArray</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">getOracleArray</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">的getResultSet</code></p>
                              </li>
                           </ul>
                           <p>Oracle还提供了一些方法，使您可以检索数组或子集的所有元素。</p>
                           <div class="infoboxnote" id="GUID-3BA98572-FD68-4137-B87E-0DC2AAAC65EE__GUID-2DDFB233-7A77-47C4-91F0-B0761B9DE5E4">
                              <p class="notep1">注意：</p>
                              <p>如果您正在使用一组结构化对象，Oracle会提供这三种方法的版本，使您能够指定类型映射，以便您可以选择如何将对象映射到Java。</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-3BA98572-FD68-4137-B87E-0DC2AAAC65EE__GUID-6E425040-5336-45E5-A6CF-843BA6E0269E">getOracleArray</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p><code class="codeph">getOracleArray</code>方法是特定于Oracle的扩展，未在标准<code class="codeph">Array</code>接口中指定。<code class="codeph">getOracleArray</code>方法将数组的元素值检索到<code class="codeph">Datum[]</code>数组中。元素是<code class="codeph">oracle.sql.*</code>数据类型，对应于原始数组中数据的SQL类型。
                           </p>
                           <p>对于结构化对象数组，此方法将使用<code class="codeph">oracle.jdbc.元素的OracleStruct</code>实例。
                           </p>
                           <p>Oracle还提供了<code class="codeph">getOracleArray(</code> <span class="italic"><code class="codeph">index</code></span> <code class="codeph">,</code> <span class="italic"><code class="codeph">count</code></span> <code class="codeph">)</code> <code class="codeph">method</code>来获取数组元素的子集。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-3BA98572-FD68-4137-B87E-0DC2AAAC65EE__GUID-D1C707D7-533E-4679-A0B2-645E1CB583F3">的getResultSet</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p><code class="codeph">getResultSet</code>方法返回一个结果集，该结果集包含<code class="codeph">ARRAY</code>对象指定的数组元素。结果集为每个数组元素包含一行，每行包含两列。第一列将索引存储到该元素的数组中，第二列存储元素值。在VARRAYs的情况下，索引表示元素在数组中的位置。对于嵌套表（根据定义无序），索引仅反映特定查询中元素的返回顺序。
                           </p>
                           <p>Oracle建议在从嵌套表中获取数据时使用<code class="codeph">getResultSet</code> 。嵌套表可以包含无限数量的元素。该方法返回的<code class="codeph">ResultSet</code>对象最初指向第一行数据。您可以使用<code class="codeph">next</code>方法和相应的<code class="codeph">get</code> <span class="italic"><code class="codeph">XXX</code></span>方法<code class="codeph">get</code>嵌套表的内容。相反， <code class="codeph">getArray</code>返回嵌套表的全部内容。
                           </p>
                           <p><code class="codeph">getResultSet</code>方法使用连接的缺省类型映射来确定Oracle对象的SQL类型与其对应的Java数据类型之间的映射。如果您不想使用连接的默认类型映射，则可以使用该方法的另一个版本<code class="codeph">getResultSet(</code> <span class="italic"><code class="codeph">map</code></span> <code class="codeph">)</code>来指定备用类型映射。
                           </p>
                           <p>Oracle还提供了<code class="codeph">getResultSet(</code> <span class="italic"><code class="codeph">index</code></span> <code class="codeph">,</code> <span class="italic"><code class="codeph">count</code></span> <code class="codeph">)</code>和<code class="codeph">getResultSet(</code> <span class="italic"><code class="codeph">index</code></span> <code class="codeph">,</code> <span class="italic"><code class="codeph">count</code></span> <code class="codeph">,</code> <span class="italic"><code class="codeph">map</code></span> <code class="codeph">)</code>方法来检索数组元素的子集。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-3BA98572-FD68-4137-B87E-0DC2AAAC65EE__GUID-1F2E7FD9-E75B-4390-B855-6511903382F8">的getArray</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p><code class="codeph">getArray</code>方法是一个标准的JDBC方法，它将数组元素作为<code class="codeph">java.lang.返回<code class="codeph">java.lang.Object</code> ，您可以根据需要进行投射。元素将转换为与原始数组中的数据的SQL类型对应的Java类型。
                           </p>
                           <p>Oracle还提供了一个<code class="codeph">getArray(</code> <span class="italic"><code class="codeph">index</code></span> <code class="codeph">,</code> <span class="italic"><code class="codeph">count</code></span> <code class="codeph">)</code>方法来检索数组元素的子集。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="JJDBC28601"></a><div class="props_rev_3"><a id="GUID-E2AE8600-F9A9-458B-83B8-C01BCAD51365" name="GUID-E2AE8600-F9A9-458B-83B8-C01BCAD51365"></a><h5 id="JJDBC-GUID-E2AE8600-F9A9-458B-83B8-C01BCAD51365" class="sect5"><span class="enumeration_section">16.4.2.3</span>比较数据检索方法</h5>
                     <div>
                        <div class="section">
                           <p>如果使用<code class="codeph">getOracleArray</code>返回数组元素，则使用<code class="codeph">oracle.sql.的该方法<code class="codeph">oracle.sql.Datum</code>实例避免了从SQL到Java的数据转换费用。<code class="codeph">Datum</code>类或其任何子类实例中的非字符数据保持原始SQL格式。
                           </p>
                           <p>如果使用<code class="codeph">getResultSet</code>返回原始数据类型的数组，则JDBC驱动程序返回一个<code class="codeph">ResultSet</code>对象，该对象为每个元素包含元素和元素值的数组索引。例如：</p><pre class="oac_no_warn" dir="ltr">ResultSet rset = intArray.getResultSet（）;</pre><p>在这种情况下，结果集为每个数组元素包含一行，每行包含两列。第一列将索引存储到数组中，第二列存储元素值。</p>
                           <p>如果数组的元素是映射到Java类型的SQL类型，则<code class="codeph">getArray</code>返回此Java类型的元素数组。<code class="codeph">getArray</code>方法的返回类型是<code class="codeph">java.lang.Object</code> 。因此，必须先投射结果才能使用它。
                           </p><pre class="oac_no_warn" dir="ltr">BigDecimal [] values =（BigDecimal []）intArray.getArray（）;</pre><p>这里<code class="codeph">intArray</code>是一个<code class="codeph">oracle.sql.ARRAY</code> ，对应于<code class="codeph">NUMBER</code>类型的VARRAY。 <code class="codeph">values</code>数组包含<code class="codeph">java.math.类型的元素数组<code class="codeph">java.math.BigDecimal</code> ，因为默认情况下，根据Oracle JDBC驱动程序，SQL <code class="codeph">NUMBER</code>数据类型映射到Java <code class="codeph">BigDecimal</code> 。
                           </p>
                           <div class="infoboxnote" id="GUID-E2AE8600-F9A9-458B-83B8-C01BCAD51365__GUID-54762DD9-E0C6-4FFD-BCBE-4B016C1CB9F9">
                              <p class="notep1">注意：</p>
                              <p>使用<code class="codeph">BigDecimal</code>是Java中的资源密集型操作。由于Oracle JDBC默认将数字SQL数据映射到<code class="codeph">BigDecimal</code> ，因此使用<code class="codeph">getArray</code>可能会影响性能，因此不建议用于数字集合。
                              </p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="JJDBC28602"></a><div class="props_rev_3"><a id="GUID-4872A6DE-E029-44CF-AF71-4C70979B8F63" name="GUID-4872A6DE-E029-44CF-AF71-4C70979B8F63"></a><h5 id="JJDBC-GUID-4872A6DE-E029-44CF-AF71-4C70979B8F63" class="sect5"><span class="enumeration_section">16.4.2.4</span>根据类型映射检索结构化对象数组的元素</h5>
                     <div>
                        <div class="section">
                           <p>默认情况下，如果您正在使用其元素为结构化对象的数组，并且使用<code class="codeph">getArray</code>或<code class="codeph">getResultSet</code> ，则数组中的Oracle对象将根据默认映射映射到其对应的Java数据类型。这是因为这些方法使用默认值<a id="d57778e1419" class="indexterm-anchor"></a>键入连接的映射以确定映射。
                           </p>
                           <p>但是，如果您不想要默认行为，则可以使用<code class="codeph">getArray(</code> <span class="italic"><code class="codeph">map</code></span> <code class="codeph">)</code>或<code class="codeph">getResultSet(</code> <span class="italic"><code class="codeph">map</code></span> <code class="codeph">)</code>方法指定包含备用映射的类型映射。如果类型映射中的条目对应于数组中的Oracle对象，则数组中的每个对象都映射到类型映射中指定的相应Java类型。例如：</p><pre class="oac_no_warn" dir="ltr">Object [] object =（Object []）objArray.getArray（map）;</pre><p>其中<code class="codeph">objArray</code>是一个<code class="codeph">oracle.sql.ARRAY</code>对象和<code class="codeph">map</code>是<code class="codeph">java.util.Map</code>对象。
                           </p>
                           <p>如果类型映射不包含特定Oracle对象的条目，则该元素将作为<code class="codeph">oracle.jdbc.返回<code class="codeph">oracle.jdbc.OracleStruct</code>对象。
                           </p>
                           <p><code class="codeph">getResultSet(</code> <span class="italic"><code class="codeph">map</code></span> <code class="codeph">)</code>方法的行为与<code class="codeph">getArray(</code> <span class="italic"><code class="codeph">map</code></span> <code class="codeph">)</code>方法类似。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="relinfo">
                           <p><strong>相关话题</strong></p>
                           <ul>
                              <li><a href="Oracle-collections.html#GUID-22D90043-E417-4BC3-A838-0DBA954AF2AA">使用类型映射来映射数组元素</a></li>
                           </ul>
                        </div>
                     </div>
                     
                  </div><a id="JJDBC28603"></a><div class="props_rev_3"><a id="GUID-6D8BD317-1F52-4CF6-8E4A-096989E8D2A6" name="GUID-6D8BD317-1F52-4CF6-8E4A-096989E8D2A6"></a><h5 id="JJDBC-GUID-6D8BD317-1F52-4CF6-8E4A-096989E8D2A6" class="sect5"><span class="enumeration_section">16.4.2.5</span>检索数组元素的子集</h5>
                     <div>
                        <div class="section">
                           <p>如果您不想检索数组的全部内容，则可以使用<code class="codeph">getArray</code> ， <code class="codeph">getResultSet</code>和<code class="codeph">getOracleArray</code>签名来检索子集。检索的子集<a id="d57778e1524" class="indexterm-anchor"></a>数组，传入索引和计数以指示要在数组中启动的位置以及要检索的元素数。如前所述，您可以指定类型映射或使用连接的默认类型映射转换为Java类型。例如：</p><pre class="oac_no_warn" dir="ltr">Object object = arr.getArray（ <span class="italic">index</span> ， <span class="italic">count</span> ， <span class="italic">map</span> ）; Object object = arr.getArray（ <span class="italic">index</span> ， <span class="italic">count</span> ）;</pre><p>使用<code class="codeph">getResultSet</code>类似示例是：</p><pre class="oac_no_warn" dir="ltr">ResultSet rset = arr.getResultSet（ <span class="italic">index</span> ， <span class="italic">count</span> ， <span class="italic">map</span> ）; ResultSet rset = arr.getResultSet（ <span class="italic">index</span> ， <span class="italic">count</span> ）;</pre><p>使用<code class="codeph">getOracleArray</code>的类似示例是：</p><pre class="oac_no_warn" dir="ltr">Datum [] arr = arr.getOracleArray（ <span class="italic">index</span> ， <span class="italic">count</span> ）;</pre><p>其中<span class="italic"><code class="codeph">arr</code></span>是<code class="codeph">oracle.sql.ARRAY</code>对象， <span class="italic"><code class="codeph">index</code></span>是<code class="codeph">long</code>类型， <span class="italic"><code class="codeph">count</code></span>是<code class="codeph">int</code>类型， <span class="italic"><code class="codeph">map</code></span>是<code class="codeph">java.util.Map</code>对象。
                           </p>
                           <div class="infoboxnote" id="GUID-6D8BD317-1F52-4CF6-8E4A-096989E8D2A6__GUID-8CD191CC-F240-4147-A6E4-320C66589320">
                              <p class="notep1">注意：</p>
                              <p>检索数组的子集没有性能优势，而不是整个数组。</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="JJDBC28604"></a><div class="props_rev_3"><a id="GUID-BCD2C704-39EA-4B52-B3CB-E192F715ED84" name="GUID-BCD2C704-39EA-4B52-B3CB-E192F715ED84"></a><h5 id="JJDBC-GUID-BCD2C704-39EA-4B52-B3CB-E192F715ED84" class="sect5"><span class="enumeration_section">16.4.2.6将</span>数组元素检索到oracle.sql中。基准数组</h5>
                     <div>
                        <div class="section">
                           <p>使用<code class="codeph">getOracleArray</code>返回<code class="codeph">oracle.sql.Datum[]</code>数组。返回数组的元素是<code class="codeph">oracle.sql.*</code>类型，对应于原始数组元素的SQL数据类型。例如：</p><pre class="oac_no_warn" dir="ltr">Datum arraydata [] = arr.getOracleArray（）;</pre><p><code class="codeph">arr</code>是一个<code class="codeph">oracle.sql.ARRAY</code>对象。
                           </p>
                           <p>该<a id="d57778e1661" class="indexterm-anchor"></a>以下示例假定已创建连接对象<code class="codeph">conn</code>和语句对象<code class="codeph">stmt</code> 。在该示例中，创建了一个SQL类型名称为<code class="codeph">NUM_ARRAY</code>的数组，用于存储<code class="codeph">NUMBER</code>数据的VARRAY。<code class="codeph">NUM_ARRAY</code>又存储在表<code class="codeph">VARRAY_TABLE</code> 。</p>
                           <p>查询选择<code class="codeph">VARRAY_TABLE</code>的内容。结果集转换为<code class="codeph">OracleResultSet</code> 。应用<code class="codeph">getARRAY</code>方法将数组数据检索到<code class="codeph">my_array</code> ，这是一个<code class="codeph">oracle.sql.ARRAY</code>对象。
                           </p>
                           <p>因为<code class="codeph">my_array</code>的类型是<code class="codeph">oracle.sql.ARRAY</code> ，您可以将方法<code class="codeph">getSQLTypeName</code>和<code class="codeph">getBaseType</code>应用于它，以返回数组中每个元素的SQL类型的名称及其整数代码。
                           </p>
                           <p>然后程序打印阵列的内容。由于<code class="codeph">NUM_ARRAY</code>的内容属于SQL数据类型<code class="codeph">NUMBER</code> ，因此<code class="codeph">my_array</code>的元素属于<code class="codeph">BigDecimal</code>类型。在使用元素之前，必须首先将它们<code class="codeph">BigDecimal</code>为<code class="codeph">BigDecimal</code> 。在<code class="codeph">for</code>循环中，数组的各个值转换为<code class="codeph">BigDecimal</code>并打印到标准输出。
                           </p><pre class="oac_no_warn" dir="ltr">stmt.execute（“CREATE TYPE num_varray AS VARRAY（10）OF NUMBER（12,2）”）; stmt.execute（“CREATE TABLE varray_table（col1 num_varray）”）; stmt.execute（“INSERT INTO varray_table VALUES（num_varray（100,200））”）; ResultSet rs = stmt.executeQuery（“SELECT * FROM varray_table”）; ARRAY my_array =（（OracleResultSet）rs）.getARRAY（1）; //返回SQL类型名称，整数代码，//和System.out.println列的长度（“Array的类型为”+ array.getSQLTypeName（））; System.out.println（“数组元素的类型为代码”+ array.getBaseType（））; System.out.println（“Array is length”+ array.length（））; //获取数组元素BigDecimal [] values =（BigDecimal []）my_array.getArray（）; for（int i = 0; i &lt;values.length; i ++）{BigDecimal out_value =（BigDecimal）values [i]; System.out.println（“&gt;&gt; index”+ i +“=”+ out_value.intValue（））; }</pre><p>请注意，如果使用<code class="codeph">getResultSet</code>来获取数组，则必须先获取结果集对象，然后使用<code class="codeph">next</code>方法迭代它。请注意，在<code class="codeph">getInt</code>方法中使用参数索引来检索元素索引和元素值。
                           </p><pre class="oac_no_warn" dir="ltr">ResultSet rset = my_array.getResultSet（）; while（rset.next（））{//第一列包含元素索引，第二列包含元素值System.out.println（“&gt;&gt; index”+ rset.getInt（1）+“=” + rset.getInt（2））; }</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="JJDBC28605"></a><div class="props_rev_3"><a id="GUID-A374A861-2770-418F-9CF6-DBB807CE282C" name="GUID-A374A861-2770-418F-9CF6-DBB807CE282C"></a><h5 id="JJDBC-GUID-A374A861-2770-418F-9CF6-DBB807CE282C" class="sect5"><span class="enumeration_section">16.4.2.7</span>关于访问多级集合元素</h5>
                     <div>
                        <div class="section">
                           <p><code class="codeph">oracle.sql.ARRAY</code>类提供了三个重载的方法来访问集合元素。JDBC驱动程序扩展了这些方法以支持多级集合。这些方法是：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">getArray</code>方法</p>
                              </li>
                              <li>
                                 <p><code class="codeph">getOracleArray</code>方法</p>
                              </li>
                              <li>
                                 <p><code class="codeph">getResultSet</code>方法</p>
                              </li>
                           </ul>
                           <p><code class="codeph">getArray</code>方法返回一个包含集合元素的Java数组。数组元素类型由集合元素类型和JDBC默认转换矩阵确定。
                           </p>
                           <p>例如， <code class="codeph">getArray</code>方法返回<code class="codeph">java.math.用于收集SQL <code class="codeph">NUMBER</code> BigDecimal</code>数组。 <code class="codeph">getOracleArray</code>方法返回一个<code class="codeph">Datum</code>数组，该数组以<code class="codeph">Datum</code>格式保存集合元素。对于多级集合， <code class="codeph">getArray</code>和<code class="codeph">getOracleArray</code>方法都返回<code class="codeph">oracle.sql.的Java数组<code class="codeph">oracle.sql.ARRAY</code>元素。
                           </p>
                           <p><code class="codeph">getResultSet</code>方法返回一个包装多级集合元素的<code class="codeph">ResultSet</code>对象。对于多级集合，JDBC应用程序使用<code class="codeph">ResultSet</code>类的<code class="codeph">getObject</code> ， <code class="codeph">getARRAY</code>或<code class="codeph">getArray</code>方法将集合元素作为<code class="codeph">oracle.sql.实例进行访问<code class="codeph">oracle.sql.ARRAY</code> 。</p>
                           <p>以下代码显示了如何使用<code class="codeph">getOracleArray</code> ， <code class="codeph">getArray</code>和<code class="codeph">getResultSet</code>方法：</p><pre class="oac_no_warn" dir="ltr">连接conn = ...; //建立JDBC连接语句stmt = conn.createStatement（）; ResultSet rset = stmt.executeQuery（“从tab2选择col2，其中idx = 1”）; while（rset.next（））{ARRAY varray3 =（ARRAY）rset.getObject（1）; Object varrayElems = varray3.getArray（1）; //访问“varray3”的数组元素Datum [] varray3Elems =（Datum []）varrayElems; for（int i = 0; i &lt;varray3Elems.length; i ++）{ARRAY varray2 =（ARRAY）varray3Elems [i]; Datum [] varray2Elems = varray2.getOracleArray（）; //访问“varray2”的数组元素（int j = 0; j &lt;varray2Elems.length; j ++）{ARRAY varray1 =（ARRAY）varray2Elems [j]; ResultSet varray1Elems = varray1.getResultSet（）; //访问“varray1”的数组元素while（varray1Elems.next（））System.out.println（“idx =”+ varray1Elems.getInt（1）+“value =”+ varray1Elems.getInt（2））; rset.close（）; stmt.close（）; conn.close（）;</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="JJDBC28607"></a><a id="JJDBC28608"></a><a id="JJDBC28606"></a><div class="props_rev_3"><a id="GUID-BCCFF59D-D84C-410B-B681-BA5AA6285EC6" name="GUID-BCCFF59D-D84C-410B-B681-BA5AA6285EC6"></a><h4 id="JJDBC-GUID-BCCFF59D-D84C-410B-B681-BA5AA6285EC6" class="sect4"><span class="enumeration_section">16.4.3将</span>数组传递给语句对象</h4>
                  <div>
                     <div class="section">
                        <p>本节讨论如何将数组传递给预准备语句对象或可调用语句对象。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-BCCFF59D-D84C-410B-B681-BA5AA6285EC6__GUID-D37888C2-7F18-4112-8662-53D81AE5D3F4">将数组传递给准备好的语句</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>将数组传递给预准备语句，如下所示。</p>
                        <div class="infoboxnote" id="GUID-BCCFF59D-D84C-410B-B681-BA5AA6285EC6__GUID-277EE1DF-C607-4EB8-B182-7DF81BE4ADAD">
                           <p class="notep1">注意：</p>
                           <p>您可以将数组用作<code class="codeph">IN</code>或<code class="codeph">OUT</code>绑定变量。
                           </p>
                        </div>
                        <ol>
                           <li>
                              <p>将要传递给<code class="codeph">oracle.sql.准备语句的数组定义为<code class="codeph">oracle.sql.ARRAY</code>对象。
                              </p><pre class="oac_no_warn" dir="ltr">ARRAY array = oracle.jdbc。OracleConnection.createARRAY（sql_type_name，elements）;</pre><p><code class="codeph">sql_type_name</code>是一个Java字符串，指定数组的用户定义的SQL类型名称， <span class="italic"><code class="codeph">elements</code></span>是<code class="codeph">java.lang.包含元素的Java数组的Object</code> 。
                              </p>
                           </li>
                           <li>
                              <p>创建一个<code class="codeph">java.sql.包含要运行的SQL语句的PreparedStatement</code>对象。
                              </p>
                           </li>
                           <li>
                              <p>将准备好的语句转换为<code class="codeph">OraclePreparedStatement</code> ，并使用<code class="codeph">setARRAY</code>将数组传递给<code class="codeph">OraclePreparedStatement</code>准备语句。
                              </p><pre class="oac_no_warn" dir="ltr">（OraclePreparedStatement）stmt.setARRAY（ <span class="italic">parameterIndex</span> ， <span class="italic">array</span> ）;</pre><p><span class="italic"><code class="codeph">parameterIndex</code></span>是参数索引， <span class="italic"><code class="codeph">array</code></span>是<code class="codeph">oracle.sql.您之前构建的ARRAY</code>对象。
                              </p>
                           </li>
                           <li>
                              <p>运行准备好的语句。</p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-BCCFF59D-D84C-410B-B681-BA5AA6285EC6__GUID-8C72E0CE-F7A1-4C97-BC1B-FA8FF70E893A">将数组传递给可调用语句</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>检索一个<a id="d57778e1978" class="indexterm-anchor"></a>收集作为PL / SQL块中的<code class="codeph">OUT</code>参数，执行以下操作以注册<code class="codeph">OUT</code>参数的绑定类型。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>将可调用语句转换为<code class="codeph">OracleCallableStatement</code> ，如下所示：</span><div><pre class="oac_no_warn" dir="ltr">OracleCallableStatement ocs =（OracleCallableStatement）conn.prepareCall（“{？= call func（）}“）;</pre></div>
                        </li>
                        <li class="stepexpand"><span>使用<code class="codeph">registerOutParameter</code>方法的以下形式注册<code class="codeph">OUT</code>参数：</span><div><pre class="oac_no_warn" dir="ltr">ocs.registerOutParameter（int <span class="italic">param_index</span> ，int <span class="italic">sql_type</span> ，string <span class="italic">sql_type_name</span> ）;</pre><p><span class="italic"><code class="codeph">param_index</code></span>是参数索引， <span class="italic"><code class="codeph">sql_type</code></span>是SQL类型代码， <span class="italic"><code class="codeph">sql_type_name</code></span>是数组类型的名称。在这种情况下， <span class="italic"><code class="codeph">sql_type</code></span>是<code class="codeph">OracleTypes.ARRAY</code> 。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>运行呼叫，如下所示：</span><div><pre class="oac_no_warn" dir="ltr">ocs.execute（）;</pre></div>
                        </li>
                        <li class="stepexpand"><span>获取值，如下所示：</span><div><pre class="oac_no_warn" dir="ltr">oracle.sql。ARRAY array = ocs.getARRAY（1）;</pre></div>
                        </li>
                     </ol>
                  </div>
               </div>
            </div><a id="JJDBC28609"></a><div class="props_rev_3"><a id="GUID-22D90043-E417-4BC3-A838-0DBA954AF2AA" name="GUID-22D90043-E417-4BC3-A838-0DBA954AF2AA"></a><h3 id="JJDBC-GUID-22D90043-E417-4BC3-A838-0DBA954AF2AA" class="sect3"><span class="enumeration_section">16.5</span>使用类型映射映射数组元素</h3>
               <div>
                  <div class="section">
                     <p>如果你的<a id="d57778e2077" class="indexterm-anchor"></a><a id="d57778e2081" class="indexterm-anchor"></a> array包含Oracle对象，然后您可以使用类型映射将数组中的对象与相应的Java类相关联。如果未指定类型映射，或者类型映射不包含特定Oracle对象的条目，则每个元素都将作为<code class="codeph">oracle.jdbc.返回<code class="codeph">oracle.jdbc.OracleStruct</code>对象。
                     </p>
                     <p>如果希望类型映射确定数组中的Oracle对象与其关联的Java类之间的映射，则必须向映射添加适当的条目。</p>
                     <p>以下示例说明如何使用类型映射将数组元素映射到自定义Java对象类。在这种情况下，数组是嵌套表。该示例首先定义具有name属性和employee number属性的<code class="codeph">EMPLOYEE</code>对象。<code class="codeph">EMPLOYEE_LIST</code>是<code class="codeph">EMPLOYEE</code>对象的嵌套表类型。然后创建<code class="codeph">EMPLOYEE_TABLE</code>以存储公司内部门的名称以及与每个部门相关联的员工。在<code class="codeph">EMPLOYEE_TABLE</code> ，员工以<code class="codeph">EMPLOYEE_LIST</code>表的形式存储。
                     </p><pre class="oac_no_warn" dir="ltr">stmt.execute（“CREATE TYPE EMPLOYEE AS OBJECT（EmpName VARCHAR2（50），EmpNo INTEGER））”）; stmt.execute（“CREATE TYPE EMPLOYEE_LIST ASMP OF EMPLOYEE”）; stmt.execute（“CREATE TABLE EMPLOYEE_TABLE（DeptName VARCHAR2（20），Employees EMPLOYEE_LIST）NESTED TABLE Employees STORE AS ntable1”）; stmt.execute（“INSERT INTO EMPLOYEE_TABLE VALUES（”SALES“，EMPLOYEE_LIST（EMPLOYEE（'Susan Smith'，123），EMPLOYEE（'Lee Brown'，124））））;）;</pre><p>如果要将属于<code class="codeph">SALES</code>部门的所有员工检索到自定义对象类<code class="codeph">EmployeeObj</code>的实例数组中，则必须在类型映射中添加一个条目，以指定<code class="codeph">EMPLOYEE</code> SQL类型和<code class="codeph">EmployeeObj</code>自定义对象类之间的映射。
                     </p>
                     <p>为此，首先创建语句和结果集对象，然后在结果集中选择与<code class="codeph">SALES</code>部门关联的<code class="codeph">EMPLOYEE_LIST</code> 。将结果集转换为<code class="codeph">OracleResultSet</code>以便您可以使用<code class="codeph">getARRAY</code>方法将<code class="codeph">EMPLOYEE_LIST</code>检索到<code class="codeph">ARRAY</code>对象（以下示例中为<code class="codeph">employeeArray</code> ）。
                     </p>
                     <p>此示例中的<code class="codeph">EmployeeObj</code>自定义对象类实现<code class="codeph">SQLData</code>接口。
                     </p><pre class="oac_no_warn" dir="ltr">Statement s = conn.createStatement（）; OracleResultSet rs =（OracleResultSet）s.executeQuery（“SELECT Employees FROM employee_table WHERE DeptName ='SALES'”）; //获取数组对象ARRAY employeeArray =（（OracleResultSet）rs）.getARRAY（1）;</pre><p>现在您已拥有<code class="codeph">EMPLOYEE_LIST</code>对象，获取现有类型映射并添加将<code class="codeph">EMPLOYEE</code> SQL类型映射到<code class="codeph">EmployeeObj</code> Java类型的条目。
                     </p><pre class="oac_no_warn" dir="ltr">//添加类型映射条目以将SQL类型//“EMPLOYEE”映射到Java类型“EmployeeObj”Map map = conn.getTypeMap（）; map.put（“EMPLOYEE”，Class.forName（“EmployeeObj”））;</pre><p>接下来，从<code class="codeph">EMPLOYEE_LIST</code>检索SQL <code class="codeph">EMPLOYEE</code>对象。为此，请调用<code class="codeph">employeeArray</code>数组对象的<code class="codeph">getArray</code>方法。此方法返回一个对象数组。<code class="codeph">getArray</code>方法将<code class="codeph">EMPLOYEE</code>对象返回到<code class="codeph">employees</code>对象数组中。
                     </p><pre class="oac_no_warn" dir="ltr">//检索数组元素Object [] employees =（Object []）employeeArray.getArray（）;</pre><p>最后，创建一个循环，将每个<code class="codeph">EMPLOYEE</code> SQL对象分配给<code class="codeph">EmployeeObj</code> Java对象<code class="codeph">emp</code> 。
                     </p><pre class="oac_no_warn" dir="ltr">//每个数组元素都映射到EmployeeObj对象。for（int i = 0; i &lt;employees.length; i ++）{EmployeeObj emp =（EmployeeObj）employees [i]; ...}</pre></div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>