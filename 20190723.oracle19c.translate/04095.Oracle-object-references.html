<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>使用Oracle对象引用</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="JDBC Developer&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="JDBC Developer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="jdbc-developers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-02-13T13:20:37-08:00"></meta>
      <meta name="dcterms.title" content="JDBC Developer&#39;s Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="1999, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96471-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="LOBs-and-BFiles.html" title="Previous" type="text/html"></link>
      <link rel="next" href="Oracle-collections.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="JJDBC"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="LOBs-and-BFiles.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="Oracle-collections.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">JDBC开发人员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="data-access-and-manipulation.html" property="item" typeof="WebPage"><span property="name">数据访问和操作</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">使用Oracle对象引用</li>
            </ol>
            <a id="GUID-AE74076F-C906-41C6-B8DF-D7056BA0CEA4" name="GUID-AE74076F-C906-41C6-B8DF-D7056BA0CEA4"></a><a id="JJDBC28566"></a>
            
            <h2 id="JJDBC-GUID-AE74076F-C906-41C6-B8DF-D7056BA0CEA4" class="sect2"><span class="enumeration_chapter">15</span>使用Oracle对象引用</h2>
         </header>
         <div class="ind">
            <div>
               <p><a id="d57173e21" class="indexterm-anchor"></a><a id="d57173e25" class="indexterm-anchor"></a>本章介绍允许您访问和操作对象引用的标准Java数据库连接（JDBC）。
               </p>
               <p>本节讨论以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="Oracle-object-references.html#GUID-2911A754-8AB1-4104-95ED-DA7C01E216AE">用于对象引用的Oracle扩展</a></p>
                  </li>
                  <li>
                     <p><a href="Oracle-object-references.html#GUID-F488767E-88FC-4EF3-AD41-072D44F15E0A">检索和传递对象引用</a></p>
                  </li>
                  <li>
                     <p><a href="Oracle-object-references.html#GUID-4B5FAA66-0B3D-47DD-B69B-0FA83806B495">通过对象引用访问和更新对象值</a></p>
                  </li>
               </ul>
            </div><a id="JJDBC28567"></a><div class="props_rev_3"><a id="GUID-2911A754-8AB1-4104-95ED-DA7C01E216AE" name="GUID-2911A754-8AB1-4104-95ED-DA7C01E216AE"></a><h3 id="JJDBC-GUID-2911A754-8AB1-4104-95ED-DA7C01E216AE" class="sect3"><span class="enumeration_section">15.1</span> Oracle扩展的对象引用</h3>
               <div>
                  <p>Oracle支持使用对数据库对象的引用。Oracle JDBC为对象引用提供支持：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><code class="codeph">SELECT</code>子句中的列</p>
                     </li>
                     <li>
                        <p>IN或OUT绑定变量</p>
                     </li>
                     <li>
                        <p>Oracle对象中的属性</p>
                     </li>
                     <li>
                        <p>集合类型对象中的元素</p>
                     </li>
                  </ul>
                  <p>在SQL中，对象引用（ <code class="codeph">REF</code> ）是强类型的。例如，对<code class="codeph">EMPLOYEE</code>对象的引用将被定义为<code class="codeph">EMPLOYEE REF</code> ，而不仅仅是<code class="codeph">REF</code> 。</p>
                  <p>选择对象引用时，请注意您只检索指向对象的指针，而不是对象本身。您可以选择将引用具体化为<code class="codeph">java.sql.Ref</code>实例的可移植性，或将其实现为您事先创建的自定义Java类的实例，这是强类型的。用于对象引用的自定义Java类称为<span class="bold">自定义引用类</span> ，必须实现<code class="codeph">oracle.jdbc.OracleData</code>接口。
                  </p>
                  <p>您可以通过结果集或可调用语句对象检索<code class="codeph">REF</code>实例，并通过<code class="codeph">REF</code>准备语句或可调用语句对象将更新的<code class="codeph">REF</code>实例传递回数据库。<code class="codeph">REF</code>类包括获取和设置基础对象属性值的功能，并获取基础对象的SQL基本类型名称。
                  </p>
                  <p>自定义引用类包括相同的功能，并且具有强类型的优点。这可以帮助您在编译期间找到编码错误，否则可能在运行时才会发现。</p>
                  <div class="infoboxnote" id="GUID-2911A754-8AB1-4104-95ED-DA7C01E216AE__GUID-840F2F3E-F9CF-483F-8107-2726225FCC93">
                     <p class="notep1">注意：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>如果您使用的是<code class="codeph">oracle.jdbc.对于自定义对象类的OracleData</code>接口，您可能会将<code class="codeph">OracleData</code>用于相应的自定义引用类。但是，如果您使用的是标准<code class="codeph">java.sql.用于自定义对象类的SQLData</code>接口，那么您只能使用弱Java类型进行引用。<code class="codeph">SQLData</code>接口仅用于映射SQL对象类型。
                           </p>
                        </li>
                        <li>
                           <p>只能通过运行SQL语句在JDBC应用程序中创建和检索<code class="codeph">REF</code>对象。没有特定于JDBC的功能来创建和检索<code class="codeph">REF</code>对象。
                           </p>
                        </li>
                        <li>
                           <p>即使数组（如对象）是结构化类型，也不能引用数组。</p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div><a id="JJDBC28568"></a><div class="props_rev_3"><a id="GUID-F488767E-88FC-4EF3-AD41-072D44F15E0A" name="GUID-F488767E-88FC-4EF3-AD41-072D44F15E0A"></a><h3 id="JJDBC-GUID-F488767E-88FC-4EF3-AD41-072D44F15E0A" class="sect3"><span class="enumeration_section">15.2</span>检索和传递对象引用</h3>
               <div>
                  <div class="section">
                     <p>本节讨论用于检索和传递对象引用的JDBC功能。它包括以下主题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="Oracle-object-references.html#GUID-D35B2BB6-3D4C-49C9-A0E0-E17F4A8473CF">从结果集中检索对象引用</a></p>
                        </li>
                        <li>
                           <p><a href="Oracle-object-references.html#GUID-7113339D-61CC-414B-9ADA-E5EECA317846">从可调用语句中检索对象引用</a></p>
                        </li>
                        <li>
                           <p><a href="Oracle-object-references.html#GUID-90C1244F-CAD6-4800-8B91-4A73D068F38B">将对象引用传递给准备好的语句</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="JJDBC28569"></a><div class="props_rev_3"><a id="GUID-D35B2BB6-3D4C-49C9-A0E0-E17F4A8473CF" name="GUID-D35B2BB6-3D4C-49C9-A0E0-E17F4A8473CF"></a><h4 id="JJDBC-GUID-D35B2BB6-3D4C-49C9-A0E0-E17F4A8473CF" class="sect4"><span class="enumeration_section">15.2.1</span>从结果集中检索对象引用</h4>
                  <div>
                     <div class="section">
                        <p>为了演示如何检索对象引用，下面的示例首先定义一个Oracle对象类型<code class="codeph">ADDRESS</code> ，然后在<code class="codeph">PEOPLE</code>表中引用它：</p><pre class="oac_no_warn" dir="ltr">创建类型ADDRESS作为对象（street_name VARCHAR2（30），house_no NUMBER）; create table PEOPLE（col1 VARCHAR2（30），col2 NUMBER，col3 REF ADDRESS）;</pre><p><code class="codeph">ADDRESS</code>对象类型有两个属性：街道名称和门牌号码。<code class="codeph">PEOPLE</code>表有三列：字符数据列，数字数据列和包含<code class="codeph">ADDRESS</code>对象引用的列。
                        </p>
                        <p>要检索对象引用，请按照以下常规步骤操作：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li><span>使用标准SQL <code class="codeph">SELECT</code>语句从数据库表<code class="codeph">REF</code>列检索引用。</span></li>
                        <li><span>使用<code class="codeph">getRef</code>将结果集中的地址引用获取到<code class="codeph">OracleRef</code>实例中。</span></li>
                        <li><span>Let <code class="codeph">Address</code>是与SQL对象类型<code class="codeph">ADDRESS</code>对应的Java自定义类。</span></li>
                        <li><span>将Java类<code class="codeph">Address</code>和SQL类型<code class="codeph">ADDRESS</code>之间的对应关系添加到类型映射中。</span></li>
                        <li><span>使用<code class="codeph">getObject</code>方法检索<code class="codeph">Address</code>引用的内容。将输出转换为<code class="codeph">Address</code> 。</span></li>
                     </ol>
                     <div class="section">
                        <p><code class="codeph">PEOPLE</code>数据库表在本节前面定义<a id="d57173e311" class="indexterm-anchor"></a><a id="d57173e315" class="indexterm-anchor"></a> 。除了将<code class="codeph">Address</code>添加到类型映射的步骤之外，上述步骤的代码如下：</p><pre class="oac_no_warn" dir="ltr">ResultSet rs = stmt.executeQuery（“SELECT col3 FROM PEOPLE”）; while（rs.next（））{OracleRef ref = rs.getRef（1）;地址a =（地址）ref.getObject（）; }</pre><div class="infoboxnote" id="GUID-D35B2BB6-3D4C-49C9-A0E0-E17F4A8473CF__GUID-ACCBC8FF-E2C4-4C03-B38B-1856F867E8DB">
                           <p class="notep1">注意：</p>
                           <p>在前面的代码中， <code class="codeph">stmt</code>是先前定义的语句对象。
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="JJDBC28570"></a><div class="props_rev_3"><a id="GUID-7113339D-61CC-414B-9ADA-E5EECA317846" name="GUID-7113339D-61CC-414B-9ADA-E5EECA317846"></a><h4 id="JJDBC-GUID-7113339D-61CC-414B-9ADA-E5EECA317846" class="sect4"><span class="enumeration_section">15.2.2</span>从可调用语句中检索对象引用</h4>
                  <div>
                     <div class="section">
                        <p>要检索<a id="d57173e356" class="indexterm-anchor"></a>对象引用作为PL / SQL块中的<code class="codeph">OUT</code>参数，必须为<code class="codeph">OUT</code>参数注册绑定类型。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>将可调用语句转换为<code class="codeph">OracleCallableStatement</code> ，如下所示：</span><div><pre class="oac_no_warn" dir="ltr">OracleCallableStatement ocs =（OracleCallableStatement）conn.prepareCall（“{？= call func（）}“）;</pre></div>
                        </li>
                        <li class="stepexpand"><span>使用<code class="codeph">registerOutParameter</code>方法的以下形式注册<code class="codeph">OUT</code>参数：</span><div><pre class="oac_no_warn" dir="ltr">ocs.registerOutParameter（int <span class="italic">param_index</span> ，int <span class="italic">sql_type</span> ，String <span class="italic">sql_type_name</span> ）;</pre><p><span class="italic"><code class="codeph">param_index</code></span>是参数索引， <span class="italic"><code class="codeph">sql_type</code></span>是SQL类型代码。<span class="italic"><code class="codeph">sql_type_name</code></span>是此引用所用的结构化对象类型的名称。例如，如果<code class="codeph">OUT</code>参数是对<code class="codeph">ADDRESS</code>对象的引用，则<code class="codeph">ADDRESS</code>是应传入的<span class="italic"><code class="codeph">sql_type_name</code></span> 。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>运行呼叫，如下所示：</span><div><pre class="oac_no_warn" dir="ltr">ocs.execute（）;</pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="JJDBC28571"></a><div class="props_rev_3"><a id="GUID-90C1244F-CAD6-4800-8B91-4A73D068F38B" name="GUID-90C1244F-CAD6-4800-8B91-4A73D068F38B"></a><h4 id="JJDBC-GUID-90C1244F-CAD6-4800-8B91-4A73D068F38B" class="sect4"><span class="enumeration_section">15.2.3</span>将对象引用传递给准备好的语句</h4>
                  <div>
                     <div class="section">
                        <p>通过<a id="d57173e457" class="indexterm-anchor"></a>对象的引用与您传递任何其他SQL类型的方式相同。使用<code class="codeph">setObject</code>方法或<code class="codeph">setREF</code>准备语句对象的<code class="codeph">setREF</code>方法。
                        </p>
                        <p>使用<code class="codeph">ROWID</code>准备语句根据<code class="codeph">ROWID</code>更新地址引用，如下所示：</p><pre class="oac_no_warn" dir="ltr">PreparedStatement pstmt = conn.prepareStatement（“update PEOPLE set ADDR_REF =？哪里ROWID =？“）; pstmt.setRef（1，addr_ref）; pstmt.setRowId（2，rowid）;</pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="JJDBC28572"></a><div class="props_rev_3"><a id="GUID-4B5FAA66-0B3D-47DD-B69B-0FA83806B495" name="GUID-4B5FAA66-0B3D-47DD-B69B-0FA83806B495"></a><h3 id="JJDBC-GUID-4B5FAA66-0B3D-47DD-B69B-0FA83806B495" class="sect3"><span class="enumeration_section">15.3</span>通过对象引用访问和更新对象值</h3>
               <div>
                  <div class="section">
                     <p>您可以使用<code class="codeph">Ref</code>对象<code class="codeph">setObject</code>方法通过对象引用更新数据库中对象的值。为此，必须首先检索对数据库对象的引用，并创建与数据库对象对应的Java对象。
                     </p>
                     <p>例如，您可以使用<span class="q">“检索和传递对象引用”</span>部分中的代码来检索对数据库<code class="codeph">ADDRESS</code>对象的引用，如以下代码段所示：</p><pre class="oac_no_warn" dir="ltr">ResultSet rs = stmt.executeQuery（“SELECT col3 FROM PEOPLE”）; if（rs.next（））{Ref ref = rs.getRef（1）; <a id="d57173e517" class="indexterm-anchor"></a><a id="d57173e521" class="indexterm-anchor"></a>地址a =（地址）ref.getObject（）; }</pre><p>然后， <a id="d57173e528" class="indexterm-anchor"></a><a id="d57173e532" class="indexterm-anchor"></a>您可以创建与数据库<code class="codeph">ADDRESS</code>对象对应的Java <code class="codeph">Address</code>对象。使用<code class="codeph">Ref</code>接口的<code class="codeph">setObject</code>方法设置数据库对象的值，如下所示：</p><pre class="oac_no_warn" dir="ltr">地址addr =新地址（...）; ref.setObject（addr）;将</pre><p>这里， <code class="codeph">setValue</code>方法立即更新数据库<code class="codeph">ADDRESS</code>对象。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="Oracle-object-references.html#GUID-F488767E-88FC-4EF3-AD41-072D44F15E0A">检索和传递对象引用</a></li>
                     </ul>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>