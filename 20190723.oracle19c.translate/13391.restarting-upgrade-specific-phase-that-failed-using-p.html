<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="Use this option to complete an upgrade after fixing errors."></meta>
      <meta name="description" content="Use this option to complete an upgrade after fixing errors."></meta>
      <title>从使用-p失败的特定阶段重新启动升级</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Database Upgrade Guide"></meta>
      <meta property="og:description" content="Use this option to complete an upgrade after fixing errors."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Database Upgrade Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-upgrade-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-04-25T08:26:31-07:00"></meta>
      <meta name="dcterms.title" content="Database Upgrade Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96252-05"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="rerunning-upgrades-oracle-database.html" title="Previous" type="text/html"></link>
      <link rel="next" href="post-upgrade-tasks-oracle-database.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="UPGRD"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="rerunning-upgrades-oracle-database.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="post-upgrade-tasks-oracle-database.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">数据库升级指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="upgrading-oracle-database.html" property="item" typeof="WebPage"><span property="name">升级Oracle数据库</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">从使用-p失败的特定阶段重新启动升级</li>
            </ol>
            <a id="GUID-AA77A1B9-C598-4979-AF3A-12DE713537F4" name="GUID-AA77A1B9-C598-4979-AF3A-12DE713537F4"></a>
            
            <h2 id="UPGRD-GUID-AA77A1B9-C598-4979-AF3A-12DE713537F4" class="sect2">从使用-p失败的特定阶段重新启动升级</h2>
         </header>
         <div class="ind">
            <div>
               <p>修复错误后，使用此选项完成升级。</p>
               <p>您可以使用<code class="codeph">-p</code>选项运行并行升级实用程序（ <code>catctl.pl</code>或shell脚本<code>dbupgrade</code>或<code>dbupgrade.cmd</code> ）以重新运行升级并跳过已成功运行的升级阶段。您还可以在一个阶段重新运行升级，以测试失败阶段的修复。
               </p>
               <p>要确定要重新启动的阶段编号，请检查升级日志以确定第一个错误发生的位置以及阶段。然后，您可以修复错误原因，并测试修复程序或重新运行升级到完成。</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="restarting-upgrade-specific-phase-that-failed-using-p.html#GUID-F9907B67-78C3-4BCB-B830-8A196BC1F0A2">查看CDB日志文件的失败阶段</a><br>确定您的日志文件位置，并查看CDB和PDB日志文件。
                  </li>
                  <li class="ulchildlink"><a href="restarting-upgrade-specific-phase-that-failed-using-p.html#GUID-30AB55D5-2061-419D-8CDA-A78A269C79E6">查看非CDB日志文件的失败阶段</a><br>确定您的日志文件位置，并查看非CDB日志文件。
                  </li>
                  <li class="ulchildlink"><a href="restarting-upgrade-specific-phase-that-failed-using-p.html#GUID-29A9C778-7AE6-4C2C-85E6-4ADDA8466A34">从失败阶段查找和重新启动多租户升级的过程</a><br>要从失败阶段重新启动多租户升级，请首先确定哪个PDB创建了错误，然后在其相应的日志文件中搜索错误。
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="upgrading-oracle-database.html#GUID-CC88F262-3370-4FFA-8604-EDA9F20F56D9" title="Oracle提供了一套全面的工具，用于以最短的停机时间升级Oracle数据库，以及将应用程序迁移到新版本。">升级Oracle数据库</a></p>
                  </div>
               </div>
            </div>
            
            <div class="sect2"><a id="GUID-F9907B67-78C3-4BCB-B830-8A196BC1F0A2" name="GUID-F9907B67-78C3-4BCB-B830-8A196BC1F0A2"></a><h3 id="UPGRD-GUID-F9907B67-78C3-4BCB-B830-8A196BC1F0A2" class="sect3">查看CDB日志文件的失败阶段</h3>
               <div>
                  <p>确定您的日志文件位置，并查看CDB和PDB日志文件。</p>
                  <div class="example" id="GUID-F9907B67-78C3-4BCB-B830-8A196BC1F0A2__GUID-83EDC627-AA98-4FEA-92C9-67008D0BA5BB">
                     <p>自动诊断存储库（ADR）的位置和升级脚本创建的诊断日志文件可能会有所不同，具体取决于您的环境变量和参数设置。</p>
                     <p>通过设置<code class="codeph">-l</code>选项定义日志文件路径，可以在运行并行升级实用程序（ <code>catctl</code> ）时设置日志文件路径。
                     </p>
                     <p></p>
                     <p>CDB $ ROOT（CDB）的日志文件可以从<code class="codeph">catupgrd0...catupgrd7.log</code> 。可插拔数据库（PDB）的日志文件由PDB容器名称（ <code class="codeph"><span class="variable" translate="no">dbname</span></code> ）标识，并且来自<code class="codeph">catupgrdp <span class="variable" translate="no">dbname</span> 0...catupgrdp <span class="variable" translate="no">dbname</span> 7.log</code> 。
                     </p>
                  </div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="restarting-upgrade-specific-phase-that-failed-using-p.html#GUID-AA77A1B9-C598-4979-AF3A-12DE713537F4" title="修复错误后，使用此选项完成升级。">从使用-p失败的特定阶段重新启动升级</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-30AB55D5-2061-419D-8CDA-A78A269C79E6" name="GUID-30AB55D5-2061-419D-8CDA-A78A269C79E6"></a><h3 id="UPGRD-GUID-30AB55D5-2061-419D-8CDA-A78A269C79E6" class="sect3">查看非CDB日志文件的失败阶段</h3>
               <div>
                  <p>确定您的日志文件位置，并查看非CDB日志文件。</p>
                  <div class="section">
                     <p>自动诊断存储库（ADR）的位置和升级脚本创建的诊断日志文件可能会有所不同，具体取决于您的环境变量和参数设置。</p>
                     <p>通过设置-l选项定义日志文件路径，可以在运行并行升级实用程序（ <code>catctl</code> ）时设置日志文件路径。
                     </p>
                     <div class="infoboxnote" id="GUID-30AB55D5-2061-419D-8CDA-A78A269C79E6__GUID-AB81715A-60ED-43F8-AD1D-8572D821BD91">
                        <p class="notep1">注意：</p>
                        <p>从Oracle Database 12 <span class="italic">c</span> （第1版（12.1））开始，不推荐使用非CDB体系结构。它可以在将来的版本中得到支持。
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-30AB55D5-2061-419D-8CDA-A78A269C79E6__GUID-83EDC627-AA98-4FEA-92C9-67008D0BA5BB">
                     <p>日志文件可以从<code class="codeph">catupgrd0...catupgrd7.log</code> 。
                     </p>
                  </div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="restarting-upgrade-specific-phase-that-failed-using-p.html#GUID-AA77A1B9-C598-4979-AF3A-12DE713537F4" title="修复错误后，使用此选项完成升级。">从使用-p失败的特定阶段重新启动升级</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-29A9C778-7AE6-4C2C-85E6-4ADDA8466A34" name="GUID-29A9C778-7AE6-4C2C-85E6-4ADDA8466A34"></a><h3 id="UPGRD-GUID-29A9C778-7AE6-4C2C-85E6-4ADDA8466A34" class="sect3">从失败阶段查找和重新启动多租户升级的过程</h3>
               <div>
                  <p>要从失败阶段重新启动多租户升级，请首先确定哪个PDB创建了错误，然后在其相应的日志文件中搜索错误。</p>
                  <div class="section">要识别导致多租户升级失败的PDB，请查看升级摘要报告，或查看catupgrd0.log;此日志包含文件末尾的升级摘要报告。</div>
                  <!-- class="section" -->
                  <div class="p">使用此过程检查每个日志文件以查找错误。</div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>找到有错误的日志文件。</span><div>
                           <p>例如：</p>
                           <p>Linux和Unix</p><pre class="pre codeblock"><code>行'catupgrd * .log时出现$ grep -i'错误</code></pre><p>视窗</p><pre class="pre codeblock"><code>C：\&gt; find / I“行”错误“catupgrd * .log</code></pre></div>
                        <div><code>grep</code>或<code>find</code>命令显示发现错误的日志文件的文件名。
                        </div>
                     </li>
                     <li class="stepexpand"><span>检查每个有错误的日志文件，并确定第一个错误发生的位置。使用您选择的文本编辑器查看每个日志文件。<samp class="msgph">在第</samp> ' <samp class="msgph">行</samp> '中搜索第一次出现的短语<samp class="msgph">错误</samp> 。当您找到该短语时，然后从错误（反向搜索）向后搜索<code class="codeph">PHASE_TIME___START</code> 。</span><div>
                           <p>例如：</p><pre class="pre codeblock"><code>PHASE_TIME___START 15 15-01-16 08:49:41</code></pre></div>
                        <div>
                           <p><code class="codeph">PHASE_TIME___START</code>之后的<code class="codeph">PHASE_TIME___START</code>是发生错误的阶段号。在此示例中，阶段编号为15。
                           </p>
                           <p>每个日志文件都可能出错。重复检查短语<code class="codeph">PHASE_TIME___START</code> ，并为包含错误的每个日志文件识别包含错误的阶段号，并标识包含最低阶段号的日志文件。
                           </p>
                           <p>包含最低阶段编号的日志文件是重新启动阶段编号，即重新启动升级的阶段编号。</p>
                        </div>
                        <div>
                           <p>例如：</p><pre class="pre codeblock"><code>阶段15中发生catupgrd0.log错误：PHASE_TIME___START 15 15-01-16 08:49:41第19阶段发生catupgrd1.log错误：PHASE_TIME___START 19 15-01-16 08:50:01</code></pre></div>
                        <div>
                           <p>在此示例中，重新启动阶段编号为15。确保您确定在所有日志文件中看到的第一个错误，以便您可以从该阶段重新启动升级。</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>通过将目录切换到正在运行的并行升级实用程序重新启动从失败的阶段升级（ <code>catctl.pl</code> ，您可以使用命令行运行<code>dbupgrade</code>在Linux和Unix和<code>dbupgrade.cmd</code>在Windows上）。使用<code class="codeph">-p</code>标志指示您要从阶段重新启动升级，并提供重新启动阶段号。在多租户数据库中，也可以使用<code class="codeph">-c ' <span class="variable" translate="no">PDBname</span> '</code>语法来使用<code class="codeph">-c</code>标志，其中<code class="codeph"><span class="variable" translate="no">PDBname</span></code>是发生故障的PDB的名称。</span><div>
                           <p>例如：</p>
                           <p>Linux或UNIX系统上的非CDB Oracle数据库：</p><pre class="pre codeblock"><code>cd $ ORACLE_HOME / bin dbupgrade -p 15</code></pre><p>Windows系统上多租户Oracle数据库（CDB）中的PDB：</p><pre class="pre codeblock"><code>cd $ ORACLE_HOME / bin dbupgrade -p 15 -c'PDB1'</code></pre></div>
                        <div>在这两个示例中，升级都从阶段15重新启动，使用<code class="codeph">-p</code>标志进行标识。在多租户示例中，带有错误的PDB使用<code class="codeph">-c</code>标志进行标识。
                        </div>
                        <div>在这些示例中，升级从阶段15开始并一直运行到升级结束。</div>
                     </li>
                     <li class="stepexpand"><span>（可选）您还可以使用<code class="codeph">-P</code>标志指定停止阶段来运行包含错误的阶段。使用停止阶段允许升级仅重新运行发生错误的阶段。您可以通过在出错的阶段运行错误来快速确定错误是否已修复，而无需运行整个升级。</span><div>
                           <p>例如，使用Perl脚本Parallel Upgrade Utility命令选项：</p><pre class="pre codeblock"><code>cd $ ORACLE_HOME / rdbms / admin $ ORACLE_HOME / perl / bin / perl catctl.pl -p 15 -P 15 -c'PDB1'</code></pre></div>
                        <div>在确认错误的阶段中确定错误后，您可以在该阶段之后恢复升级。</div>
                        <div>
                           <p>例如，如果您已确认PDB1多租户数据库升级的第15阶段中的错误已得到修复，那么您可以在Linux和Unix系统上使用以下命令在阶段16继续升级：</p><pre class="pre codeblock"><code>cd $ ORACLE_HOME / bin dbupgrade -p 16 -c'PDB1'</code></pre></div>
                     </li>
                  </ol>
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="restarting-upgrade-specific-phase-that-failed-using-p.html#GUID-AA77A1B9-C598-4979-AF3A-12DE713537F4" title="修复错误后，使用此选项完成升级。">从使用-p失败的特定阶段重新启动升级</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>