<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>用户退出</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Programmer&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Programmer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="c-c-programmers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-11T03:52:01-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96467-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="the-Object-type.html" title="Previous" type="text/html"></link>
      <link rel="next" href="appendixes.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Pro*C/C++ Programmer&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="LNPCC"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="the-Object-type.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="appendixes.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">程序员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="applications.html" property="item" typeof="WebPage"><span property="name">应用</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">用户退出</li>
            </ol>
            <a id="GUID-2EC87842-41F9-4923-80D3-C89201CD39AD" name="GUID-2EC87842-41F9-4923-80D3-C89201CD39AD"></a><a id="LNPCC4492"></a>
            
            <h2 id="LNPCC-GUID-2EC87842-41F9-4923-80D3-C89201CD39AD" class="sect2"><span class="enumeration_chapter">20个</span>用户退出</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章重点介绍如何为Oracle Tools应用程序编写用户出口。您将了解C子例程如何比SQL * Forms和Oracle Forms更快速，更轻松地完成某些工作。本章包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="user-exits.html#GUID-01BF752C-0920-4AB2-97E0-9AEEE3072600">什么是用户退出？</a></p>
                  </li>
                  <li>
                     <p><a href="user-exits.html#GUID-658BCDA9-34A4-456F-BB17-150F505AE7D3">为什么写用户退出？</a></p>
                  </li>
                  <li>
                     <p><a href="user-exits.html#GUID-1ED375CA-206E-4450-9619-7B4DD1A7257C">关于开发用户出口</a></p>
                  </li>
                  <li>
                     <p><a href="user-exits.html#GUID-86EAB22E-A8CE-4791-AE4F-FC348B444BEB">关于编写用户出口</a></p>
                  </li>
                  <li>
                     <p><a href="user-exits.html#GUID-23C28BBA-AC3F-4462-8073-A91B49567CCA">执行工具声明</a> 
                     </p>
                  </li>
                  <li>
                     <p><a href="user-exits.html#GUID-C2458504-6AE7-40A0-AEF9-FF8B4E852CFB">关于呼叫用户退出</a></p>
                  </li>
                  <li>
                     <p><a href="user-exits.html#GUID-C7428D0F-610A-45B9-B6BF-402BB4659A5A">关于将参数传递给用户出口</a></p>
                  </li>
                  <li>
                     <p><a href="user-exits.html#GUID-188EE5CE-C30C-4A9F-9117-7527447C4161">关于将值返回到表单</a></p>
                  </li>
                  <li>
                     <p><a href="user-exits.html#GUID-0B8CC6FE-384B-4272-A0B8-63594E3D0D5D">使用用户退出的示例</a></p>
                  </li>
                  <li>
                     <p><a href="user-exits.html#GUID-2E8FDA40-3EF3-400C-B6CA-E206DDB8C377">关于预编译和编译用户出口</a></p>
                  </li>
                  <li>
                     <p><a href="user-exits.html#GUID-C2AA12E6-ACE0-40BA-A668-620E075A4EA3">示例程序：用户出口</a></p>
                  </li>
                  <li>
                     <p><a href="user-exits.html#GUID-E33F55DB-E663-44DB-A526-B29A3D56746B">关于使用GENXTB Utility</a></p>
                  </li>
                  <li>
                     <p><a href="user-exits.html#GUID-8A1DC311-712E-4181-A3A7-230DB139EFEA">关于将用户出口链接到SQL *表单</a></p>
                  </li>
                  <li>
                     <p><a href="user-exits.html#GUID-6C3CEBC0-BFC0-4AF0-9C08-9DF529FCE5E2">方针</a></p>
                  </li>
               </ul>
               <p>本章是补充的。有关用户出口的更多信息，请参阅<span class="italic">SQL * Forms Designer的参考</span> ， <span class="italic">Oracle Forms参考手册，卷。 2</span> ，以及您系统特定的Oracle文档。<a id="d106100e103" class="indexterm-anchor"></a></p>
            </div><a id="LNPCC4493"></a><div class="props_rev_3"><a id="GUID-01BF752C-0920-4AB2-97E0-9AEEE3072600" name="GUID-01BF752C-0920-4AB2-97E0-9AEEE3072600"></a><h3 id="LNPCC-GUID-01BF752C-0920-4AB2-97E0-9AEEE3072600" class="sect3"><span class="enumeration_section">20.1</span>什么是用户退出？
               </h3>
               <div>
                  <p><span class="italic">用户出口</span>是由您编写的C子例程，由Oracle Forms调用以执行特殊用途处理。您可以在用户出口中嵌入SQL语句和PL / SQL块，然后像宿主程序一样预编译它。
                  </p>
                  <p>当由Oracle Forms V3触发器调用时，用户出口运行，然后将状态代码返回给Oracle Forms。您的退出可以在Oracle Forms状态行上显示消息，获取和设置字段值，执行高速计算和表查找以及操作Oracle数据。</p>
               </div>
            </div><a id="LNPCC4494"></a><div class="props_rev_3"><a id="GUID-658BCDA9-34A4-456F-BB17-150F505AE7D3" name="GUID-658BCDA9-34A4-456F-BB17-150F505AE7D3"></a><h3 id="LNPCC-GUID-658BCDA9-34A4-456F-BB17-150F505AE7D3" class="sect3"><span class="enumeration_section">20.2</span>为什么写用户退出？
               </h3>
               <div>
                  <p>SQL * Forms提供了在触发器中使用PL / SQL块的功能。因此，在大多数情况下，您可以使用PL / SQL的过程功能，而不是调用用户出口。如果需要，您可以使用USER_EXIT函数从PL / SQL块调用用户出口。用户出口比SQL，PL / SQL或SQL * Forms命令更难编写和实现。因此，您可能只会将它们用于超出SQL，PL / SQL和SQL * Forms范围的处理。一些常见用途如下： <a id="d106100e158" class="indexterm-anchor"></a> 
                  </p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>使用C等第三代语言（例如数值积分）更快速或更轻松地完成操作</p>
                     </li>
                     <li>
                        <p>控制实时设备或进程（例如，向打印机或图形设备发出一系列指令）</p>
                     </li>
                     <li>
                        <p>需要扩展程序功能的数据操作（例如，递归排序）</p>
                     </li>
                     <li>
                        <p>特殊文件I / O操作</p>
                     </li>
                  </ul>
               </div>
            </div><a id="LNPCC4495"></a><div class="props_rev_3"><a id="GUID-1ED375CA-206E-4450-9619-7B4DD1A7257C" name="GUID-1ED375CA-206E-4450-9619-7B4DD1A7257C"></a><h3 id="LNPCC-GUID-1ED375CA-206E-4450-9619-7B4DD1A7257C" class="sect3"><span class="enumeration_section">20.3</span>关于开发用户出口</h3>
               <div>
                  <p>本节概述了开发SQL * Forms用户出口的方法;后面的部分将详细介绍。</p>
                  <p>要将用户出口合并到表单中，请执行以下步骤：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>在Pro * C中写入用户出口。</p>
                     </li>
                     <li>
                        <p>预编译源代码。</p>
                     </li>
                     <li>
                        <p>编译。来自第2步的c文件。</p>
                     </li>
                     <li>
                        <p>使用GENXTB实用程序创建数据库表IAPXTB。</p>
                     </li>
                     <li>
                        <p>使用SQL * Forms中的GENXTB表单将用户出口信息插入表中。</p>
                     </li>
                     <li>
                        <p>使用GENXTB实用程序从表中读取信息并创建IAPXIT源代码模块。然后编译源代码模块。</p>
                     </li>
                     <li>
                        <p>通过链接标准SQL * Forms模块，用户出口对象和在步骤6中创建的IAPXIT对象，创建新的SQL * Forms可执行文件。</p>
                     </li>
                     <li>
                        <p>在表单中，定义一个触发器来调用用户出口。</p>
                     </li>
                     <li>
                        <p>指示操作员在运行表单时使用新的IAP。如果新IAP取代标准IAP，则不需要这样做。有关详细信息，请参阅系统的Oracle安装或用户指南。</p>
                     </li>
                  </ul>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="user-exits.html#GUID-23C28BBA-AC3F-4462-8073-A91B49567CCA">执行工具声明</a></li>
                     </ul>
                  </div>
               </div>
               
            </div><a id="LNPCC4496"></a><div class="props_rev_3"><a id="GUID-86EAB22E-A8CE-4791-AE4F-FC348B444BEB" name="GUID-86EAB22E-A8CE-4791-AE4F-FC348B444BEB"></a><h3 id="LNPCC-GUID-86EAB22E-A8CE-4791-AE4F-FC348B444BEB" class="sect3"><span class="enumeration_section">20.4</span>关于编写用户出口</h3>
               <div>
                  <p>您可以使用以下类型的语句来编写SQL * Forms用户出口： <a id="d106100e264" class="indexterm-anchor"></a> 
                  </p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>C代码</p>
                     </li>
                     <li>
                        <p>EXEC SQL</p>
                     </li>
                     <li>
                        <p>EXEC ORACLE</p>
                     </li>
                     <li>
                        <p>执行工具</p>
                     </li>
                  </ul>
                  <p>本节重点介绍EXEC TOOLS语句，它允许您在SQL * Forms和用户出口之间传递值。</p>
               </div><a id="LNPCC4497"></a><div class="props_rev_3"><a id="GUID-2B2F5780-7471-4F69-96D7-17ACC0392216" name="GUID-2B2F5780-7471-4F69-96D7-17ACC0392216"></a><h4 id="LNPCC-GUID-2B2F5780-7471-4F69-96D7-17ACC0392216" class="sect4"><span class="enumeration_section">20.4.1</span>变量要求</h4>
                  <div>
                     <p>EXEC TOOLS语句中使用的变量必须与表单定义中使用的字段名称相对应。<a id="d106100e308" class="indexterm-anchor"></a><a id="d106100e312" class="indexterm-anchor"></a><a id="d106100e316" class="indexterm-anchor"></a></p>
                  </div>
               </div>
            </div><a id="LNPCC4498"></a><div class="props_rev_3"><a id="GUID-23C28BBA-AC3F-4462-8073-A91B49567CCA" name="GUID-23C28BBA-AC3F-4462-8073-A91B49567CCA"></a><h3 id="LNPCC-GUID-23C28BBA-AC3F-4462-8073-A91B49567CCA" class="sect3"><span class="enumeration_section">20.5</span> EXEC工具声明</h3>
               <div>
                  <p>EXEC TOOLS语句通过提供处理来自用户出口的get，set和exception回调的通用方法来支持基本的Oracle Toolset。以下讨论的重点是Oracle Forms，但相同的概念适用于Oracle Report。</p>
               </div><a id="LNPCC4499"></a><div class="props_rev_3"><a id="GUID-770C05B5-2E78-4AC8-9DBD-F8578FFC5B13" name="GUID-770C05B5-2E78-4AC8-9DBD-F8578FFC5B13"></a><h4 id="LNPCC-GUID-770C05B5-2E78-4AC8-9DBD-F8578FFC5B13" class="sect4"><span class="enumeration_section">20.5.1</span>关于编写工具集用户退出</h4>
                  <div>
                     <p>除了EXEC SQL，EXEC ORACLE和宿主语言语句之外，您还可以使用以下EXEC TOOLS语句编写Oracle Forms用户出口：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>组</p>
                        </li>
                        <li>
                           <p>得到</p>
                        </li>
                        <li>
                           <p>设置背景</p>
                        </li>
                        <li>
                           <p>获取上下文</p>
                        </li>
                        <li>
                           <p>信息</p>
                        </li>
                     </ul>
                     <p>EXEC TOOLS GET和SET语句替换了早期版本的Oracle Forms中使用的EXEC IAF GET和PUT语句。然而，与IAF GET和PUT不同，TOOLS GET和SET接受指示符变量。EXEC TOOLS MESSAGE语句取代了消息处理函数<span class="italic">sqliem</span> 。现在，让我们简要介绍一下所有EXEC TOOLS语句。有关更多信息，请参阅<span class="italic">Oracle Forms Reference Manual，第2卷</span> 。
                     </p>
                  </div>
               </div><a id="LNPCC4500"></a><div class="props_rev_3"><a id="GUID-6E8B5604-F836-4D0C-AC72-7FE38384B199" name="GUID-6E8B5604-F836-4D0C-AC72-7FE38384B199"></a><h4 id="LNPCC-GUID-6E8B5604-F836-4D0C-AC72-7FE38384B199" class="sect4"><span class="enumeration_section">20.5.2</span> EXEC工具集</h4>
                  <div>
                     <div class="section">
                        <p>EXEC TOOLS SET语句将值从用户出口传递到Oracle Forms。具体来说，它将主变量和常量的值分配给Oracle Forms变量和项。在用户出口将控制权返回给表单后，传递给表单项的值将显示。要编写EXEC TOOLS SET语句，请使用语法</p><pre class="oac_no_warn" dir="ltr">EXEC TOOLS SET form_variable [，...]VALUES（{：host_variable：indicator | constant} [，...]）;</pre><p>其中<span class="italic">form_variable</span>是Oracle Forms字段，block.field，系统变量或全局变量，或者包含上述项之一的值的主机变量（以冒号为前缀）。在以下示例中，用户出口将员工姓名传递给Oracle Forms：</p><pre class="oac_no_warn" dir="ltr">char ename [20];简短的ename_ind; ...strcpy（ename，“MILLER”）; ename_ind = 0; EXEC TOOLS SET emp.ename VALUES（：ename：ename_ind）;</pre><p>在此示例中， <span class="italic">emp.ename</span>是Oracle Forms block.field。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="LNPCC4501"></a><div class="props_rev_3"><a id="GUID-51F78FF5-AE25-4B3D-9BEA-72F772CE3BD5" name="GUID-51F78FF5-AE25-4B3D-9BEA-72F772CE3BD5"></a><h4 id="LNPCC-GUID-51F78FF5-AE25-4B3D-9BEA-72F772CE3BD5" class="sect4"><span class="enumeration_section">20.5.3</span> EXEC工具获取</h4>
                  <div>
                     <div class="section">
                        <p>EXEC TOOLS GET语句将值从Oracle Forms传递到用户出口。具体来说，它将Oracle Forms变量和项的值分配给主变量。一旦传递了值，用户出口就可以将它们用于任何目的。要编写EXEC TOOLS GET语句的代码，请使用语法</p><pre class="oac_no_warn" dir="ltr">执行工具获取form_variable [，...]INTO：host_variable：指标[，...];</pre><p>其中<span class="italic">form_variable</span>是Oracle Forms字段，block.field，系统变量或全局变量，或者包含上述项之一的值的主机变量（以冒号为前缀）。在以下示例中，Oracle Forms将块中的项名称传递给用户出口：</p><pre class="oac_no_warn" dir="ltr">...char name_buff [20]; VARCHAR name_fld [20]; strcpy（name_fld.arr，“EMP.NAME”）; name_fld.len = strlen（name_fld.arr）; EXEC TOOLS GET：name_fld INTO：name_buff;</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="LNPCC4502"></a><div class="props_rev_3"><a id="GUID-31E04BDE-C256-42C8-8AE1-E36B557C72DC" name="GUID-31E04BDE-C256-42C8-8AE1-E36B557C72DC"></a><h4 id="LNPCC-GUID-31E04BDE-C256-42C8-8AE1-E36B557C72DC" class="sect4"><span class="enumeration_section">20.5.4</span> EXEC工具设置上下文</h4>
                  <div>
                     <div class="section">
                        <p>EXEC TOOLS SET CONTEXT语句从用户出口保存上下文信息，以便以后在另一个用户出口使用。指针变量指向存储上下文信息的存储器块。使用SET CONTEXT，您无需声明全局变量来保存信息。要编写EXEC TOOLS SET CONTEXT语句，请使用语法</p><pre class="oac_no_warn" dir="ltr">EXEC TOOLS SET语境：host_pointer_variable IDENTIFIED BY context_name;</pre><p>其中<span class="italic">context_name</span>是未声明的标识符或用于命名上下文区域的字符宿主变量（以冒号为前缀）。
                        </p><pre class="oac_no_warn" dir="ltr">...char * context_ptr; char context [20]; strcpy（context，“context1”）EXEC TOOLS SET语境：由application1标识的上下文;</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="LNPCC4503"></a><div class="props_rev_3"><a id="GUID-E3AD6E64-0B21-4D77-BE47-877E10F43579" name="GUID-E3AD6E64-0B21-4D77-BE47-877E10F43579"></a><h4 id="LNPCC-GUID-E3AD6E64-0B21-4D77-BE47-877E10F43579" class="sect4"><span class="enumeration_section">20.5.5</span> EXEC工具获取背景</h4>
                  <div>
                     <div class="section">
                        <p>EXEC TOOLS GET CONTEXT语句检索上下文信息（由SET CONTEXT先前保存）到用户出口。主机语言指针变量指向存储上下文信息的存储器块。要编写EXEC TOOLS GET CONTEXT语句，请使用语法</p><pre class="oac_no_warn" dir="ltr">EXEC TOOLS获取语境context_name INTO：host_pointer_variable;</pre><p>其中<span class="italic">context_name</span>是未声明的标识符或用于命名上下文区域的字符宿主变量（以冒号为前缀）。在以下示例中，您的用户出口检索先前保存的上下文信息：</p><pre class="oac_no_warn" dir="ltr">...char * context_ptr; EXEC TOOLS获取上下文application1 INTO：context_ptr;</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="LNPCC4504"></a><div class="props_rev_3"><a id="GUID-A26BBFE5-6C31-4552-82B7-0784D6503530" name="GUID-A26BBFE5-6C31-4552-82B7-0784D6503530"></a><h4 id="LNPCC-GUID-A26BBFE5-6C31-4552-82B7-0784D6503530" class="sect4"><span class="enumeration_section">20.5.6</span>执行工具消息</h4>
                  <div>
                     <div class="section">
                        <p>EXEC TOOLS MESSAGE语句将消息从用户出口传递到Oracle Forms。在用户出口将控制权返回给表单后，该消息将显示在Oracle Forms消息行上。要编写EXEC TOOLS MESSAGE语句，请使用语法</p><pre class="oac_no_warn" dir="ltr">EXEC TOOLS MESSAGE message_text [severity_code];</pre><p>其中<span class="italic">message_text</span>是带引号的字符串或字符宿主变量（以冒号为前缀），可选的<span class="italic">severity_code</span>是整数常量或整数主变量（以冒号为前缀）。MESSAGE语句<span class="italic">不</span>接受指示变量。在以下示例中，您的用户出口将错误消息传递给Oracle Forms：</p><pre class="oac_no_warn" dir="ltr">EXEC TOOLS MESSAGE'糟糕的字段名称！请重新输入。“;</pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="LNPCC4505"></a><div class="props_rev_3"><a id="GUID-C2458504-6AE7-40A0-AEF9-FF8B4E852CFB" name="GUID-C2458504-6AE7-40A0-AEF9-FF8B4E852CFB"></a><h3 id="LNPCC-GUID-C2458504-6AE7-40A0-AEF9-FF8B4E852CFB" class="sect3"><span class="enumeration_section">20.6</span>关于呼叫用户退出</h3>
               <div>
                  <p>使用名为USER_EXIT（随SQL * Forms提供）的打包过程从SQL * Forms触发器调用用户出口。您使用的语法是</p><pre class="oac_no_warn" dir="ltr">USER_EXIT（user_exit_string [，error_string]）; <a id="d106100e648" class="indexterm-anchor"></a> 
</pre><p>其中<span class="italic">user_exit_string</span>包含用户出口的名称加上可选参数， <span class="italic">error_string</span>包含SQL * Forms在用户出口失败时发出的错误消息。例如，以下trigger命令调用名为LOOKUP的用户出口：</p><pre class="oac_no_warn" dir="ltr">USER_EXIT（ 'LOOKUP'）;</pre><p>请注意，用户出口字符串由单引号（非双引号）括起来。 <code class="codeph"> </code></p>
               </div>
            </div><a id="LNPCC4506"></a><div class="props_rev_3"><a id="GUID-C7428D0F-610A-45B9-B6BF-402BB4659A5A" name="GUID-C7428D0F-610A-45B9-B6BF-402BB4659A5A"></a><h3 id="LNPCC-GUID-C7428D0F-610A-45B9-B6BF-402BB4659A5A" class="sect3"><span class="enumeration_section">20.7</span>关于将参数传递给用户出口</h3>
               <div>
                  <p><a id="d106100e690" class="indexterm-anchor"></a>当您调用用户出口时，SQL * Forms会自动向其传递以下参数：</p>
                  <div class="tblformal" id="GUID-C7428D0F-610A-45B9-B6BF-402BB4659A5A__GUID-72B86F3A-A997-4AF6-B642-98E735CDEDAE">
                     <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="Passing Parameters to a User Exit" frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="29%" id="d106100e703">参数</th>
                              <th align="left" valign="bottom" width="71%" id="d106100e706">描述</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d106100e711" headers="d106100e703 ">
                                 <p>命令行</p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d106100e711 d106100e706 ">
                                 <p>是用户退出字符串。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d106100e718" headers="d106100e703 ">
                                 <p>命令行长度</p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d106100e718 d106100e706 ">
                                 <p>是用户出口字符串的长度（以字符为单位）。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d106100e725" headers="d106100e703 ">
                                 <p>错误信息</p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d106100e725 d106100e706 ">
                                 <p>错误字符串（失败消息）是否已定义。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d106100e732" headers="d106100e703 ">
                                 <p>错误消息长度</p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d106100e732 d106100e706 ">
                                 <p>是错误字符串的长度。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d106100e739" headers="d106100e703 ">
                                 <p>在查询</p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d106100e739 d106100e706 ">
                                 <p>是一个布尔值，指示是在正常模式还是查询模式下调用出口。</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <p>但是，用户出口字符串提供了将其他参数传递给用户出口的功能。例如，以下触发器命令将两个参数和一条错误消息传递给用户出口LOOKUP：</p>
                  <p>请注意，用户出口字符串由单引号（非双引号）括起来。</p><pre class="oac_no_warn" dir="ltr">USER_EXIT（'LOOKUP 2025 A'，'Lookup failed'）;</pre><p>您可以使用此功能将字段名称传递给用户出口，如以下示例所示：</p><pre class="oac_no_warn" dir="ltr">USER_EXIT（'CONCAT firstname，lastname，address'）;</pre><p>但是，由用户出口而不是SQL * Forms来解析用户出口字符串。</p>
               </div>
            </div><a id="LNPCC4507"></a><div class="props_rev_3"><a id="GUID-188EE5CE-C30C-4A9F-9117-7527447C4161" name="GUID-188EE5CE-C30C-4A9F-9117-7527447C4161"></a><h3 id="LNPCC-GUID-188EE5CE-C30C-4A9F-9117-7527447C4161" class="sect3"><span class="enumeration_section">20.8</span>关于将值返回到表单</h3>
               <div>
                  <p><a id="d106100e780" class="indexterm-anchor"></a><a id="d106100e784" class="indexterm-anchor"></a><a id="d106100e788" class="indexterm-anchor"></a>当用户出口将控制权返回给SQL * Forms时，它还必须返回一个代码，指示它是成功，失败还是遭遇致命错误。返回码是由SQL * Forms定义的整数常量（请参阅下一节）。这三个结果具有以下含义：</p>
                  <div class="tblformal" id="GUID-188EE5CE-C30C-4A9F-9117-7527447C4161__GUID-73BA651D-EC6B-4C1B-9EDE-D3C678E57D8D">
                     <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="descriptions of possible results" frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="29%" id="d106100e801">结果</th>
                              <th align="left" valign="bottom" width="71%" id="d106100e805">含义</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d106100e810" headers="d106100e801 ">
                                 <p>成功</p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d106100e810 d106100e805 ">
                                 <p>用户出口没有遇到任何错误。除非通过调用触发器步骤设置了反向返回代码开关，否则SQL * Forms将继续执行<span class="italic">成功</span>标签或下一步。 <a id="d106100e819" class="indexterm-anchor"></a>  
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d106100e825" headers="d106100e801 ">
                                 <p>失败</p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d106100e825 d106100e805 ">
                                 <p>用户出口检测到错误，例如字段中的无效值。退出传递的可选消息显示在SQL * Forms屏幕底部的消息行和显示错误屏幕上。SQL * Forms会像对不影响任何行的SQL语句一样响应。 <a id="d106100e831" class="indexterm-anchor"></a> 
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="29%" id="d106100e837" headers="d106100e801 ">
                                 <p>致命错误</p>
                              </td>
                              <td align="left" valign="top" width="71%" headers="d106100e837 d106100e805 ">
                                 <p>用户出口检测到无法进一步处理的条件，例如SQL语句中的执行错误。退出传递的可选错误消息显示在SQL *窗体显示错误屏幕上。SQL * Forms会对致命的SQL错误做出响应。如果用户退出改变字段的值，然后返回一个<span class="italic">失败</span>或<span class="italic">致命错误</span>代码，SQL *窗体<span class="italic">不</span>放弃改变。当设置了反向返回代码开关并返回<span class="italic">成功</span>代码时，SQL * Forms也不会丢弃更改。
                                 </p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
               </div><a id="LNPCC4508"></a><div class="props_rev_3"><a id="GUID-09F0FA91-FEA1-4BDF-A8E6-AE5140B38F0F" name="GUID-09F0FA91-FEA1-4BDF-A8E6-AE5140B38F0F"></a><h4 id="LNPCC-GUID-09F0FA91-FEA1-4BDF-A8E6-AE5140B38F0F" class="sect4"><span class="enumeration_section">20.8.1</span> IAP常量</h4>
                  <div>
                     <p>SQL * Forms定义了三个符号常量，用作返回代码。根据主机语言，它们以IAP或SQL为前缀。例如，它们可能是IAPSUCC，IAPFAIL和IAPFTL。 <a id="d106100e879" class="indexterm-anchor"></a> 
                     </p>
                  </div>
               </div><a id="LNPCC4509"></a><div class="props_rev_3"><a id="GUID-E058067A-7798-44E8-A3FA-A8C9B1589823" name="GUID-E058067A-7798-44E8-A3FA-A8C9B1589823"></a><h4 id="LNPCC-GUID-E058067A-7798-44E8-A3FA-A8C9B1589823" class="sect4"><span class="enumeration_section">20.8.2</span>关于使用WHENEVER</h4>
                  <div>
                     <p>您可以在出口中使用WHENEVER语句来检测无效的数据类型转换（SQLERROR），将截断的值PUT检测到表单字段（SQLWARNING），以及不返回任何行的查询（NOT FOUND）。 <a id="d106100e908" class="indexterm-anchor"></a><a id="d106100e912" class="indexterm-anchor"></a>  
                     </p>
                  </div>
               </div>
            </div><a id="LNPCC4510"></a><div class="props_rev_3"><a id="GUID-0B8CC6FE-384B-4272-A0B8-63594E3D0D5D" name="GUID-0B8CC6FE-384B-4272-A0B8-63594E3D0D5D"></a><h3 id="LNPCC-GUID-0B8CC6FE-384B-4272-A0B8-63594E3D0D5D" class="sect3"><span class="enumeration_section">20.9</span>使用用户退出的示例</h3>
               <div>
                  <div class="section">
                     <p>以下示例显示了如何编写使用EXEC TOOLS GET和PUT例程的用户出口以及<span class="italic">EXEC TOOLS MESSAGE</span>函数。 <a id="d106100e946" class="indexterm-anchor"></a> 
                     </p><pre class="oac_no_warn" dir="ltr">int myexit（）{char field1 [20]，field2 [20]，value1 [20]，value2 [20]; char result_value [20]; char errmsg [80]; int errlen; #include sqlca.h EXEC SQL WHENEVER SQLERROR GOTO sql_error; / *将字段值转换为* / EXEC TOOLS GET：field1，：field2 INTO：value1，：value2; / *操纵值以获得result_val * / .../ *将result_val放入表单字段结果* / EXEC TOOLS PUT结果VALUES（：result_val）;返回IAPSUCC; / *触发步骤成功* / sql_error：strcpy（errmsg，CONCAT（“MYEXIT”，sqlca.sqlerrm.sqlerrmc）; errlen = strlen（errmsg）; EXEC TOOLS消息：errmsg; / *向表单发送错误消息* /返回IAPFAIL ;</pre></div>
                  <!-- class="section" -->
               </div>
            </div><a id="LNPCC4511"></a><div class="props_rev_3"><a id="GUID-2E8FDA40-3EF3-400C-B6CA-E206DDB8C377" name="GUID-2E8FDA40-3EF3-400C-B6CA-E206DDB8C377"></a><h3 id="LNPCC-GUID-2E8FDA40-3EF3-400C-B6CA-E206DDB8C377" class="sect3"><span class="enumeration_section">20.10</span>关于预编译和编译用户出口</h3>
               <div>
                  <p>用户出口预编译为独立主机程序。有关编译用户出口的说明，请参阅系统的Oracle安装或用户指南。</p>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="precompiler-options.html#GUID-43E60380-8B54-4528-A76F-5A78A46F05D4">预编译器选项</a></li>
                     </ul>
                  </div>
               </div>
               
            </div><a id="LNPCC4512"></a><div class="props_rev_3"><a id="GUID-C2AA12E6-ACE0-40BA-A668-620E075A4EA3" name="GUID-C2AA12E6-ACE0-40BA-A668-620E075A4EA3"></a><h3 id="LNPCC-GUID-C2AA12E6-ACE0-40BA-A668-620E075A4EA3" class="sect3"><span class="enumeration_section">20.11</span>示例程序：用户出口</h3>
               <div>
                  <div class="section">
                     <p>以下示例显示了用户出口。</p><pre class="oac_no_warn" dir="ltr">/ ******************* *************示例程序5：SQL * Forms用户退出此用户出口连接表单域。要从SQL * Forms触发器调用用户出口，请使用语法user_exit（'CONCAT field1，field2，...，result_field'）;其中user_exit是随SQL * Forms提供的打包过程，而CONCAT是用户出口的名称。名为CONCAT的示例表单调用用户出口。************************************************** ************ / #define min（a，b）（（a &lt;b）？a：b）#include &lt;stdio.h&gt; #include &lt;string.h&gt; / *包括SQL通信区域，* Oracle通过该结构生成运行时状态信息，例如错误*代码，警告标志和诊断文本该程序。* / #include &lt;sqlca.h&gt; / *本例中嵌入式SQL中使用的所有主变量*都出现在Declare Section中。* / EXEC SQL BEGIN DECLARE SECTION; VARCHAR字段[81]; VARCHAR值[81]; VARCHAR结果[241]; EXEC SQL END DECLARE SECTION; / *定义用户出口，称为“concat”。* / int concat（cmd，cmdlen，msg，msglen，query）char * cmd;触发步骤中的/ *命令行（“CONCAT ...”）* / int * cmdlen; / *命令行长度* / char * msg; / *从* / int * msglen形式触发步骤失败消息; / *失败消息的长度* / int * query; / *如果由查询后触发器调用，则为TRUE，否则为FALSE * / {char * cp = cmd + 7; / *指向cmd字符串中字段列表的指针; “CONCAT”* / char * fp =（char *）＆field.arr [0]需要7个字符; / *指向cmd字符串中字段名称的指针* / char errmsg [81]; / *消息返回SQL * Forms错误* / int errlen; / *返回SQL * Forms * / * *的消息长度如果发生ORACLE错误，则将分支标记为sqlerror。* / EXEC SQL WHENEVER SQLERROR GOTO sqlerror; result.arr [0] ='\ 0'; / *从cmd字符串中解析字段名称。* / for（; * cp！='\ 0'; cp ++）{if（* cp！='，'&amp;&amp; * cp！=''）/ *从cmd将字段名复制到field.arr中。* / {* fp = * cp; FP ++; } else if（* cp ==''）{/ *现在有整个字段名称。* / * fp ='\ 0'; field.len = strlen（（char *）field.arr）; / *从表单中获取字段值。* / EXEC TOOLS GET：字段INTO：value; value.arr [value.len] ='\ 0'; strcat（（char *）result.arr，（char *）value.arr）; fp =（char *）＆field.arr [0]; / *重置字段指针。* /}} / *现在有最后一个字段名称。* / * fp ='\ 0'; field.len = strlen（（char *）field.arr）; result.len = strlen（（char *）result.arr）; / *将结果放入表格中。* / EXEC TOOLS PUT：字段值（：结果）; / *触发步骤成功。* / return（IAPSUCC）; sqlerror：strcpy（errmsg，“CONCAT：”）; strncat（errmsg，sqlca.sqlerrm.sqlerrmc，min（72，sqlca.sqlerrm.sqlerrml））; errlen = strlen（errmsg）; / *将错误消息传递给SQL * Forms状态行。* / EXEC TOOLS MESSAGE：errmsg;返回（IAPFAIL）; / *触发步骤失败。* /}</pre></div>
                  <!-- class="section" -->
               </div>
            </div><a id="LNPCC4513"></a><div class="props_rev_3"><a id="GUID-E33F55DB-E663-44DB-A526-B29A3D56746B" name="GUID-E33F55DB-E663-44DB-A526-B29A3D56746B"></a><h3 id="LNPCC-GUID-E33F55DB-E663-44DB-A526-B29A3D56746B" class="sect3"><span class="enumeration_section">20.12</span>关于使用GENXTB Utility</h3>
               <div>
                  <p>模块IAPXIT中的IAP程序表IAPXTB包含链接到IAP的每个用户出口的条目。 IAPXTB告诉IAP每个用户出口的名称，位置和主机语言。向IAP添加新用户出口时，必须向IAPXTB添加相应的条目。 IAPXTB派生自数据库表，也称为IAPXTB。您可以通过在操作系统命令行上运行GENXTB表单来修改数据库表，如下所示： <a id="d106100e1044" class="indexterm-anchor"></a><a id="d106100e1048" class="indexterm-anchor"></a><a id="d106100e1052" class="indexterm-anchor"></a> 
                  </p><pre class="oac_no_warn" dir="ltr">RUNFORM GENXTB用户名/密码</pre><p>将显示一个表单，您可以为您定义的每个用户出口输入以下信息：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>退出名称</p>
                     </li>
                     <li>
                        <p>C语言代码</p>
                     </li>
                     <li>
                        <p>创建日期</p>
                     </li>
                     <li>
                        <p>上次修改日期</p>
                     </li>
                     <li>
                        <p>评论</p>
                     </li>
                  </ul>
                  <p>修改IAPXTB数据库表后，使用GENXTB实用程序读取表并创建Assembler或C源程序，该程序定义它包含的模块IAPXIT和IAPXTB程序表。使用的源语言取决于您的操作系统。用于运行GENXTB实用程序的语法是</p><pre class="oac_no_warn" dir="ltr">GENXTB用户名/密码输出文件</pre><p>其中<span class="italic">outfile</span>是您为GENXTB创建的汇编程序或C源程序提供的名称。 <a id="d106100e1086" class="indexterm-anchor"></a><a id="d106100e1090" class="indexterm-anchor"></a><a id="d106100e1094" class="indexterm-anchor"></a>  
                  </p>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="user-exits.html#GUID-6C3CEBC0-BFC0-4AF0-9C08-9DF529FCE5E2">方针</a></li>
                     </ul>
                  </div>
               </div>
               
            </div><a id="LNPCC4514"></a><div class="props_rev_3"><a id="GUID-8A1DC311-712E-4181-A3A7-230DB139EFEA" name="GUID-8A1DC311-712E-4181-A3A7-230DB139EFEA"></a><h3 id="LNPCC-GUID-8A1DC311-712E-4181-A3A7-230DB139EFEA" class="sect3"><span class="enumeration_section">20.13</span>关于将用户出口链接到SQL *表单</h3>
               <div>
                  <p>在运行调用用户出口的表单之前，必须将用户出口链接到IAP，即运行表单的SQL * Forms组件。用户出口可以链接到标准版本的IAP，也可以链接到调用出口的表单的特殊版本。<a id="d106100e1132" class="indexterm-anchor"></a><a id="d106100e1136" class="indexterm-anchor"></a></p>
                  <p>要生成IAP的新可执行副本，请链接用户出口对象模块，标准IAP模块，IAPXIT模块以及Oracle和C链接库所需的任何模块。</p>
                  <p>链接的细节是系统相关的。查看系统的Oracle安装或用户指南。</p>
               </div>
            </div><a id="LNPCC4515"></a><div class="props_rev_3"><a id="GUID-6C3CEBC0-BFC0-4AF0-9C08-9DF529FCE5E2" name="GUID-6C3CEBC0-BFC0-4AF0-9C08-9DF529FCE5E2"></a><h3 id="LNPCC-GUID-6C3CEBC0-BFC0-4AF0-9C08-9DF529FCE5E2" class="sect3"><span class="enumeration_section">20.14</span>指南</h3>
               <div>
                  <p>本节中的指南将帮助您避免一些常见问题。</p>
               </div><a id="LNPCC4516"></a><div class="props_rev_3"><a id="GUID-F71C27B1-E23B-4784-AF9A-4F6A9C37BC11" name="GUID-F71C27B1-E23B-4784-AF9A-4F6A9C37BC11"></a><h4 id="LNPCC-GUID-F71C27B1-E23B-4784-AF9A-4F6A9C37BC11" class="sect4"><span class="enumeration_section">20.14.1</span>关于命名退出</h4>
                  <div>
                     <p>用户出口的名称不能是Oracle保留字。还要避免使用与SQL * Forms命令，函数代码和SQL * Forms使用的外部定义名称冲突的名称。源代码中的用户出口入口点的名称将成为用户出口本身的名称。出口名称必须是有效的C函数名称，以及操作系统的有效文件名。</p>
                     <p>在搜索出口之前，SQL * Forms将用户出口的名称转换为大写。因此，源代码中的出口名称必须为大写。 <a id="d106100e1194" class="indexterm-anchor"></a><a id="d106100e1198" class="indexterm-anchor"></a> 
                     </p>
                  </div>
               </div><a id="LNPCC4517"></a><div class="props_rev_3"><a id="GUID-492D68C7-4655-48AC-8577-5BA6DB521087" name="GUID-492D68C7-4655-48AC-8577-5BA6DB521087"></a><h4 id="LNPCC-GUID-492D68C7-4655-48AC-8577-5BA6DB521087" class="sect4"><span class="enumeration_section">20.14.2</span>关于连接Oracle</h4>
                  <div>
                     <p>用户出口使用SQL * Forms建立的连接与Oracle通信。但是，用户出口可以使用Oracle Net Services建立与任何数据库的其他连接。</p>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="database-concepts.html#GUID-AE4C1784-5F16-4DB3-835C-9BEDCAA13414">高级连接选项</a></li>
                        </ul>
                     </div>
                  </div>
                  
               </div><a id="LNPCC4518"></a><div class="props_rev_3"><a id="GUID-63A0EE1D-2DFE-4192-BB1E-A0E9F3949658" name="GUID-63A0EE1D-2DFE-4192-BB1E-A0E9F3949658"></a><h4 id="LNPCC-GUID-63A0EE1D-2DFE-4192-BB1E-A0E9F3949658" class="sect4"><span class="enumeration_section">20.14.3</span>关于发出I / O调用</h4>
                  <div>
                     <p>支持文件I / O但不支持屏幕I / O.</p>
                  </div>
               </div><a id="LNPCC4519"></a><div class="props_rev_3"><a id="GUID-C3FE4B58-0991-46D7-84A0-116AEE52E853" name="GUID-C3FE4B58-0991-46D7-84A0-116AEE52E853"></a><h4 id="LNPCC-GUID-C3FE4B58-0991-46D7-84A0-116AEE52E853" class="sect4"><span class="enumeration_section">20.14.4</span>关于使用主机变量</h4>
                  <div>
                     <p>在独立程序中使用主机变量的限制也适用于用户出口。主机变量必须在EXEC SQL和EXEC TOOLS语句中以冒号为前缀。EXEC TOOLS语句中不允许使用主机数组。</p>
                  </div>
               </div><a id="LNPCC4520"></a><div class="props_rev_3"><a id="GUID-D465CD0E-D612-41F9-87A4-7204C78F6D45" name="GUID-D465CD0E-D612-41F9-87A4-7204C78F6D45"></a><h4 id="LNPCC-GUID-D465CD0E-D612-41F9-87A4-7204C78F6D45" class="sect4"><span class="enumeration_section">20.14.5</span>关于更新表</h4>
                  <div>
                     <p>通常，用户出口不应该更新与表单关联的数据库表。例如，假设操作员更新SQL * Forms工作空间中的记录，然后用户退出UPDATE相关数据库表中的相应行。当事务是COMMITted时，SQL * Forms工作空间中的记录将应用于表，覆盖用户出口UPDATE。</p>
                  </div>
               </div><a id="LNPCC4521"></a><div class="props_rev_3"><a id="GUID-003EAFCF-9DDF-4B4D-A1BD-60CA77797867" name="GUID-003EAFCF-9DDF-4B4D-A1BD-60CA77797867"></a><h4 id="LNPCC-GUID-003EAFCF-9DDF-4B4D-A1BD-60CA77797867" class="sect4"><span class="enumeration_section">20.14.6</span>关于发出命令</h4>
                  <div>
                     <p>避免从用户出口发出COMMIT或ROLLBACK命令，因为Oracle将提交或回滚SQL * Forms运算符开始的工作，而不仅仅是用户出口完成的工作。而是从SQL * Forms触发器发出COMMIT或ROLLBACK。这也适用于数据定义命令（例如ALTER，CREATE和GRANT），因为它们在执行之前和之后发出隐式COMMIT。</p>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>