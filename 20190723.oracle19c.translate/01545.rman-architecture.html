<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>Recovery Manager体系结构</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96241-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="part-starting-configuring-rman.html" title="Previous" type="text/html"></link>
      <link rel="next" href="starting-interacting-with-rman-client.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="BRADV"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="part-starting-configuring-rman.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="starting-interacting-with-rman-client.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">备份和恢复用户指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-starting-configuring-rman.html" property="item" typeof="WebPage"><span property="name">启动和配置RMAN和闪回数据库</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Recovery Manager体系结构</li>
            </ol>
            <a id="GUID-8ECC1FB0-7D25-4883-B9A6-2593FDB35940" name="GUID-8ECC1FB0-7D25-4883-B9A6-2593FDB35940"></a><a id="BRADV001"></a>
            
            <h2 id="BRADV-GUID-8ECC1FB0-7D25-4883-B9A6-2593FDB35940" class="sect2"><span class="enumeration_chapter">3</span> Recovery Manager体系结构</h2>
         </header>
         <div class="ind">
            <div>
               <p><a id="d17011e69" class="indexterm-anchor"></a>本章介绍了Recovery Manager（RMAN）界面和RMAN环境的基本组件。本章包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="rman-architecture.html#GUID-3A2C1C02-880D-4278-9F98-043CF0E7E673" title="Recovery Manager环境包含在备份和恢复策略中发挥作用的各种应用程序和数据库。">关于RMAN环境</a></p>
                  </li>
                  <li>
                     <p><a href="rman-architecture.html#GUID-740E8D5C-CCB4-489D-9253-B44458237B91" title="使用RMAN命令行客户端输入可用于管理备份和恢复操作的所有方面的命令。">关于RMAN命令行客户端</a></p>
                  </li>
                  <li>
                     <p><a href="rman-architecture.html#GUID-282FD0B6-8593-4775-9965-DB47534D349C" title="RMAN信道表示到设备的一个数据流，并且对应于一个数据库服务器会话。在备份或恢复操作期间，通道从输入设备读取数据，对其进行处理，并将其写入输出设备。">关于RMAN频道</a></p>
                  </li>
                  <li>
                     <p><a href="rman-architecture.html#GUID-D5EBBDAF-5392-4D75-B919-A298F6C0881E" title="RMAN存储库是有关RMAN用于备份，恢复和维护的目标数据库的元数据的集合。">关于RMAN存储库</a></p>
                  </li>
                  <li>
                     <p><a href="rman-architecture.html#GUID-12A32971-242E-4C62-AE95-26D58D5C983D" title="Oracle媒体管理层（MML）API允许第三方供应商构建与RMAN配合使用的媒体管理软件，以允许备份到磁带驱动器等顺序媒体设备。">关于使用RMAN的媒体管理</a></p>
                  </li>
                  <li>
                     <p><a href="rman-architecture.html#GUID-06A2CC19-9D45-4360-98D4-79FB32EE6153" title="快速恢复区域是可选的磁盘位置，可用于存储与恢复相关的文件。">关于快速恢复区</a></p>
                  </li>
                  <li>
                     <p><a href="rman-architecture.html#GUID-B18B15EA-1F59-4858-B6E9-9870A564CD62" title="Data Guard将备用数据库维护为生产数据库的事务一致性副本。备用数据库可以是物理备用数据库，也可以是逻辑备用数据库。">关于Data Guard环境中的RMAN</a></p>
                  </li>
                  <li>
                     <p><a href="rman-architecture.html#GUID-370362C4-9F7C-4D23-A9F8-42F0376F1F5A" title="Recovery Appliance提供了一个集中的远程存储库，用于备份企业中的所有目标数据库。所有目标数据库的备份和备份元数据都由恢复设备上的中央恢复目录（恢复设备目录）管理。">关于恢复设备环境中的RMAN</a></p>
                  </li>
               </ul>
            </div><a id="BRADV144"></a><a id="BRADV559"></a><a id="BRADV101"></a><div class="props_rev_3"><a id="GUID-3A2C1C02-880D-4278-9F98-043CF0E7E673" name="GUID-3A2C1C02-880D-4278-9F98-043CF0E7E673"></a><h3 id="BRADV-GUID-3A2C1C02-880D-4278-9F98-043CF0E7E673" class="sect3"><span class="enumeration_section">3.1</span>关于RMAN环境</h3>
               <div>
                  <p>Recovery Manager环境包含在备份和恢复策略中发挥作用的各种应用程序和数据库。</p>
                  <p> <a href="rman-architecture.html#GUID-3A2C1C02-880D-4278-9F98-043CF0E7E673__CHDBEBIE" title="列出RMAN环境的可能组件">表3-1</a>列出了典型RMAN环境中的一些组件。
                  </p>
                  <div class="tblformal" id="GUID-3A2C1C02-880D-4278-9F98-043CF0E7E673__CHDBEBIE">
                     <p class="titleintable">表3-1 RMAN环境的组件</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="RMAN环境的组件" width="100%" border="1" summary="Lists possible components of the RMAN environment" frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="33%" id="d17011e250">零件</th>
                              <th align="left" valign="bottom" width="67%" id="d17011e253">描述</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="33%" id="d17011e258" headers="d17011e250 ">
                                 <p><a href="glossary.html#GUID-BAF6F6F1-D4F1-4F46-B1B6-9F662B7AB35D"><span class="xrefglossterm">RMAN客户端</span></a></p>
                              </td>
                              <td align="left" valign="top" width="67%" headers="d17011e258 d17011e253 ">
                                 <p>管理目标数据库的备份和恢复操作的客户端应用程序。RMAN客户端可以使用Oracle Net连接到目标数据库，因此它可以位于通过Oracle Net连接到目标主机的任何主机上。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="33%" id="d17011e267" headers="d17011e250 ">
                                 <p><a href="glossary.html#GUID-272C4366-303F-4629-9679-1379AAC3FBC1"><span class="xrefglossterm">目标数据库</span></a></p>
                              </td>
                              <td align="left" valign="top" width="67%" headers="d17011e267 d17011e253 ">
                                 <p>包含RMAN备份或还原的控制文件，数据文件和可选归档重做日志的数据库。RMAN使用目标数据库控制文件来收集有关目标数据库的元数据并存储有关其自身操作的信息。备份和恢复的工作由目标数据库上运行的服务器会话执行。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="33%" id="d17011e276" headers="d17011e250 ">
                                 <p><a href="glossary.html#GUID-C54D9858-2461-412B-95FF-80FBACD58AB0"><span class="xrefglossterm">恢复目录数据库</span></a></p>
                              </td>
                              <td align="left" valign="top" width="67%" headers="d17011e276 d17011e253 ">
                                 <p>包含<a href="glossary.html#GUID-CBFA8015-2DFF-42B1-A818-D6C5B92C608F"><span class="xrefglossterm">恢复目录的</span></a>数据库，其中包含RMAN用于执行备份和恢复的元数据。您可以创建一个包含多个目标数据库的RMAN元数据的恢复目录。除非您将RMAN与<a href="glossary.html#GUID-009B3F56-8C1E-4CF6-AF0F-A9D2C2E4B9C2"><span class="xrefglossterm">物理备用数据库</span></a>一起使用，否则在使用RMAN时，恢复目录是可选的，因为RMAN将其元数据存储在每个目标数据库的控制文件中。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="33%" id="d17011e293" headers="d17011e250 ">
                                 <p><a href="glossary.html#GUID-3EF7A531-FA6D-483B-AE34-F87D31DCE572"><span class="xrefglossterm">恢复目录架构</span></a></p>
                              </td>
                              <td align="left" valign="top" width="67%" headers="d17011e293 d17011e253 ">
                                 <p>恢复目录数据库中拥有RMAN维护的元数据表的用户。 RMAN会定期将目标数据库控制文件中的元数据传播到恢复目录中。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="33%" id="d17011e302" headers="d17011e250 ">
                                 <p><a href="glossary.html#GUID-009B3F56-8C1E-4CF6-AF0F-A9D2C2E4B9C2"><span class="xrefglossterm">物理备用数据库</span></a></p>
                              </td>
                              <td align="left" valign="top" width="67%" headers="d17011e302 d17011e253 ">
                                 <p>使用主数据库生成的重做更新的主数据库的副本。如果主数据库变得不可访问，则可以故障转移到备用数据库。</p>
                                 <p>RMAN可以创建，备份或恢复备用数据库。您在物理备用数据库上进行的备份可在主数据库或同一生产数据库的另一个物理备用数据库中使用。使用RMAN备份物理备用数据库时，需要恢复目录。</p>
                                 <p><span class="bold">注意：</span> RMAN将逻辑备用数据库视为单独的数据库，因为它与主数据库具有不同的DBID。
                                 </p>
                                 <p><span class="bold">另请参阅：</span> <a href="../sbydb/using-RMAN-in-oracle-data-guard-configurations.html#SBYDB04700" target="_blank"><span class="italic">Oracle Data Guard概念和管理</span></a> ，了解如何在Data Guard环境中使用RMAN</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="33%" id="d17011e325" headers="d17011e250 ">
                                 <p><a href="glossary.html#GUID-6E3CDD76-A573-4E5C-B12D-59C232C96C19"><span class="xrefglossterm">快恢复区</span></a></p>
                              </td>
                              <td align="left" valign="top" width="67%" headers="d17011e325 d17011e253 ">
                                 <p>可用于存储与恢复相关的文件的磁盘位置，例如控制文件和联机重做日志副本，归档重做日志， <a href="glossary.html#GUID-725ED3D7-5077-4F16-85AA-CDAD5BFCE554"><span class="xrefglossterm">闪回日志</span></a>和RMAN备份。Oracle数据库和RMAN自动管理快速恢复区中的文件。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="33%" id="d17011e338" headers="d17011e250 ">
                                 <p><a href="glossary.html#GUID-26FF62D0-5938-481D-B7B9-929BC971813E"><span class="xrefglossterm">媒体管理软件</span></a></p>
                              </td>
                              <td align="left" valign="top" width="67%" headers="d17011e338 d17011e253 ">
                                 <p>特定于供应商的应用程序，使RMAN能够备份到磁带等存储系统</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="33%" id="d17011e347" headers="d17011e250 ">
                                 <p><a href="glossary.html#GUID-BF263385-102C-44FF-AE86-40FBA05CE30C"><span class="xrefglossterm">媒体管理目录</span></a></p>
                              </td>
                              <td align="left" valign="top" width="67%" headers="d17011e347 d17011e253 ">
                                 <p>有关媒体管理应用程序的特定于供应商的元数据存储库</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="33%" id="d17011e356" headers="d17011e250 ">
                                 <p>Oracle企业管理器</p>
                              </td>
                              <td align="left" valign="top" width="67%" headers="d17011e356 d17011e253 ">
                                 <p>基于浏览器的数据库接口，包括通过RMAN进行备份和恢复</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <p>RMAN环境中唯一需要的组件是目标数据库和RMAN客户端，但大多数实际配置更复杂。例如，您使用连接到多个媒体管理器和多个目标数据库的RMAN客户端，所有这些都通过Enterprise Manager访问。</p>
                  <p><a href="rman-architecture.html#GUID-3A2C1C02-880D-4278-9F98-043CF0E7E673__CHDHICBA">图3-1</a>说明了可能的RMAN环境中的组件。该图显示主数据库，备用数据库和恢复目录数据库都驻留在不同的计算机上。主数据库和备用数据库主机使用本地连接的磁带驱动器。RMAN客户端和企业管理器控制台在单独的计算机上运行。
                  </p>
                  <div class="figure" id="GUID-3A2C1C02-880D-4278-9F98-043CF0E7E673__CHDHICBA">
                     <p class="titleinfigure">图3-1 RMAN环境示例</p><img src="img/bradv038.gif" alt="下面是图3-1的描述" title="下面是图3-1的描述" longdesc="img_text/bradv038.html"><br><a href="img_text/bradv038.html">“图3-1 RMAN环境示例”的说明</a></div>
                  <!-- class="figure" -->
                  <div class="infoboxnotealso" id="GUID-3A2C1C02-880D-4278-9F98-043CF0E7E673__GUID-D2AF0E95-1AFB-4620-931F-35AEEBD21865">
                     <p class="notep1">也可以看看：</p>
                     <p>了解Oracle Net的<a href="../netag/introducing-oracle-net-services.html#NETAG001" target="_blank"><span class="italic">Oracle数据库网络服务管理员指南</span></a></p>
                  </div>
               </div>
            </div><a id="BRADV1002"></a><div class="props_rev_3"><a id="GUID-740E8D5C-CCB4-489D-9253-B44458237B91" name="GUID-740E8D5C-CCB4-489D-9253-B44458237B91"></a><h3 id="BRADV-GUID-740E8D5C-CCB4-489D-9253-B44458237B91" class="sect3"><span class="enumeration_section">3.2</span>关于RMAN命令行客户端</h3>
               <div>
                  <p>使用RMAN命令行客户端输入可用于管理备份和恢复操作的所有方面的命令。</p>
                  <p>RMAN使用命令语言解释器，可以以交互或批处理模式执行命令。</p>
               </div>
            </div><a id="BRADV560"></a><a id="BRADV105"></a><div class="props_rev_3"><a id="GUID-282FD0B6-8593-4775-9965-DB47534D349C" name="GUID-282FD0B6-8593-4775-9965-DB47534D349C"></a><h3 id="BRADV-GUID-282FD0B6-8593-4775-9965-DB47534D349C" class="sect3"><span class="enumeration_section">3.3</span>关于RMAN频道</h3>
               <div>
                  <p>RMAN信道表示到设备的一个数据流，并且对应于一个数据库服务器会话。在备份或恢复操作期间，通道从输入设备读取数据，对其进行处理，并将其写入输出设备。</p>
                  <p>RMAN客户端指示数据库服务器会话执行所有备份和恢复任务。会话的构成取决于操作系统。例如，在Linux上，服务器会话对应于服务器进程，而在Windows上，它对应于数据库服务中的线程。RMAN客户端本身不执行备份，还原或恢复操作。</p>
                  <p>大多数RMAN命令由通道执行，通道必须配置为跨RMAN会话保持，或者在每个<a href="glossary.html#GUID-01D29658-41E1-4D45-9C7F-A761D56885B9"><span class="xrefglossterm">RMAN会话中</span></a>手动分配。<a href="rman-architecture.html#GUID-282FD0B6-8593-4775-9965-DB47534D349C__I1006208">如图3-2所示</a> ，通道通过在实例上启动服务器会话，建立从RMAN客户端到目标或辅助数据库实例的连接。
                  </p>
                  <div class="figure" id="GUID-282FD0B6-8593-4775-9965-DB47534D349C__I1006208">
                     <p class="titleinfigure">图3-2通道分配</p><img src="img/bradv030.gif" alt="下面是图3-2的描述" title="下面是图3-2的描述" longdesc="img_text/bradv030.html"><br><a href="img_text/bradv030.html">“图3-2信道分配”的描述</a></div>
                  <!-- class="figure" -->
                  <div class="infoboxnotealso" id="GUID-282FD0B6-8593-4775-9965-DB47534D349C__GUID-0BFDC164-6D23-4053-A75B-FDE7BF090959">
                     <p class="notep1">也可以看看：</p>
                     <p><span class="q">“ <a href="tuning-rman-performance.html#GUID-55347A64-8DA3-415E-99C7-9F7FB30001A3" title="当RMAN通道从磁盘读取数据时，多个因素会影响性能。在备份期间，RMAN通道将输入文件中的块读入I / O磁盘缓冲区。磁盘子系统上的数据库文件可以由自动存储管理（ASM）或备用卷管理器或文件系统管理。备份调整的注意事项会根据您是否使用ASM管理数据库文件而更改。当通道读取或写入磁盘时，I / O可以是同步I / O或异步I / O.在不支持本机异步I / O的操作系统上，数据库可以使用特殊的I / O从属进程对其进行仿真。这些过程专门用于代表另一个进程执行I / O.您可以使用RATE参数设置读取的字节数的上限，以便RMAN不会消耗过多的磁盘带宽并降低在线性能。从本质上讲，RATE充当备用节流阀。在复制阶段，通道将块从输入缓冲区复制到输出缓冲区并执行其他处理。备份到SBT时，RMAN为媒体管理软件提供字节流，并将唯一名称与此流关联。存储流的方式和位置的所有细节完全由媒体管理器处理。因此，备份到磁带涉及RMAN和媒体管理器的交互。影响SBT写入阶段的RMAN特定因素类似于影响磁盘读取的因素。在这两种情况下，缓冲区分配，从属进程以及同步或异步I / O都会影响性能。多种因素会影响备份到磁带的速度。如果磁带设备是远程的，则介质管理器必须通过网络传输数据。磁带本机传输速率是在没有压缩的情况下写入磁带的速度。此速度表示备份速率的上限。磁带压缩级别对备份性能非常重要。如果磁带具有良好的压缩性，则持续备份速率更快。写入操作期间的磁带流对磁带备份性能有重大影响。物理磁带块大小会影响备份性能。影响磁盘写入阶段的主要因素是缓冲区大小。">RMAN性能调优的基本概念，</a>用于对频道如何工作的低级描述”</span></p>
                  </div>
               </div><a id="BRADV89373"></a><div class="props_rev_3"><a id="GUID-5A4D3F72-3545-4ABC-B663-F4BE064F070A" name="GUID-5A4D3F72-3545-4ABC-B663-F4BE064F070A"></a><h4 id="BRADV-GUID-5A4D3F72-3545-4ABC-B663-F4BE064F070A" class="sect4"><span class="enumeration_section">3.3.1</span>关于RMAN通道和设备</h4>
                  <div>
                     <p>RMAN支持的设备类型是DISK和SBT（系统备份到磁带）。</p>
                     <p><a href="glossary.html#GUID-2E48CE71-9547-4196-B715-5CE59033262E"><span class="xrefglossterm">SBT</span></a>设备由第三方<a href="glossary.html#GUID-26FF62D0-5938-481D-B7B9-929BC971813E"><span class="xrefglossterm">媒体管理软件控制</span></a> 。通常，SBT设备是磁带库和磁带驱动器。
                     </p>
                     <p>如果使用DISK通道进行备份，则通道会在创建备份的目标数据库实例的文件名空间中的磁盘上创建备份。您可以在任何可以存储数据文件的设备上进行备份。进行DISK备份时，RMAN不会调用媒体管理器。</p>
                     <p>要在非磁盘介质上创建备份，必须使用Oracle Secure Backup等介质管理软件并分配此软件支持的通道。只要分配的通道类型不是DISK，RMAN就会联系媒体管理器。 SBT通道如何以及何时导致媒体管理器分配资源是特定于供应商的。一些媒体经理在您发出命令时分配资源;在您打开文件进行读写之前，其他人不会分配资源。</p>
                     <div class="infoboxnotealso" id="GUID-5A4D3F72-3545-4ABC-B663-F4BE064F070A__GUID-2BC6821A-95D2-415A-BAD7-F26E729D1249">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“ <a href="configuring-rman-client-basic.html#GUID-3845B630-DD47-4147-BA6E-8D677CAF1CC2" title="未指定目标设备类型的备份将定向到已配置的默认设备。RMAN已预先配置为使用磁盘作为默认设备类型。无需其他配置。">配置备份的默认设备：磁盘或SBT</a> ”</span></p>
                     </div>
                  </div>
               </div><a id="BRADV89374"></a><div class="props_rev_3"><a id="GUID-973B7CEF-25E2-4829-B24E-020C71E9F35E" name="GUID-973B7CEF-25E2-4829-B24E-020C71E9F35E"></a><h4 id="BRADV-GUID-973B7CEF-25E2-4829-B24E-020C71E9F35E" class="sect4"><span class="enumeration_section">3.3.2</span>关于RMAN自动和手动通道</h4>
                  <div>
                     <p>RMAN可以使用自动通道或手动通道进行备份和恢复操作。</p>
                     <p>您可以使用<a href="../rcmrf/CONFIGURE.html#RCMRF113" target="_blank"><code class="codeph">CONFIGURE CHANNEL</code></a>命令配置跨RMAN会话使用磁盘或磁带的通道。这种技术称为<a href="glossary.html#GUID-8473579D-F533-48AA-B7E7-DB4AB8E812D6"><span class="xrefglossterm">自动信道分配</span></a> 。RMAN预先配置了一个<code class="codeph">DISK</code>通道，可用于备份到磁盘。
                     </p>
                     <p>当您运行可以使用自动通道的命令时，RMAN会自动使用您在<code class="codeph">CONFIGURE</code>命令中指定的选项分配通道。对于<a href="../rcmrf/BACKUP.html#RCMRF107" target="_blank"><code class="codeph">BACKUP</code></a>命令，RMAN仅分配备份到指定媒体所需的通道类型。对于<a href="../rcmrf/RESTORE.html#RCMRF149" target="_blank"><code class="codeph">RESTORE</code></a>命令和<a id="d17011e835" class="indexterm-anchor"></a> <a href="glossary.html#GUID-F89B6EF7-3067-45B0-A45C-DE5247E0C326"><span class="xrefglossterm">RMAN维护命令</span></a> ，RMAN为执行命令所需的设备类型分配所有必需的通道。RMAN确定自动通道的名称。
                     </p>
                     <p>您也可以手动分配频道。每个手动分配的通道使用与数据库的单独连接。手动分配通道时，为其指定用户定义的名称，例如<code class="codeph">dev1</code>或<code class="codeph">ch2</code> 。
                     </p>
                     <p>运行命令时可用于设备的通道数确定RMAN在执行命令时是否并行读取或写入此设备。当工作并行完成时，文件的备份由多个通道完成。每个通道可以备份多个文件，但除非执行<a href="glossary.html#GUID-6D6DDA5E-F1EF-4273-8649-137F1FC89EB6"><span class="xrefglossterm">多节备份</span></a> ，否则不会有多个文件<a href="glossary.html#GUID-6D6DDA5E-F1EF-4273-8649-137F1FC89EB6"><span class="xrefglossterm">备份</span></a>任何文件。
                     </p>
                     <div class="infoboxnotealso" id="GUID-973B7CEF-25E2-4829-B24E-020C71E9F35E__GUID-792C3C0E-012F-4A0C-BB19-26B9565E4276">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>适用于<code class="codeph">ALLOCATE</code> <code class="codeph">CHANNEL</code>语法的<a href="../rcmrf/ALLOCATE-CHANNEL.html#RCMRF102" target="_blank"><span class="italic">Oracle数据库备份和恢复参考</span></a></p>
                           </li>
                           <li>
                              <p><a href="../rcmrf/ALLOCATE-CHANNEL-FOR-MAINTENANCE.html#RCMRF103" target="_blank"><span class="italic">Oracle数据库备份和恢复参考</span></a>上<code class="codeph">ALLOCATE</code> <code class="codeph">CHANNEL</code> <code class="codeph">FOR</code> <code class="codeph">MAINTENANCE</code></p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="configuring-rman-client-basic.html#GUID-FAFF9171-43CF-493A-BA5A-AD9B59B2CFEB" title="默认情况下，RMAN为所有操作分配一个磁盘通道。您可以为此通道指定不同的选项，例如，备份的新默认位置。">配置磁盘通道</a> ”</span>和<span class="q">“ <a href="configuring-rman-client-basic.html#GUID-DB37EEF2-426B-4060-BA36-FEE38C11ADB8" title="配置SBT通道会创建一个持久性设置，该设置是用于使用媒体管理器进行备份和恢复操作的默认设置。">配置SBT通道以用于媒体管理器</a> ”</span></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV103"></a><div class="props_rev_3"><a id="GUID-D5EBBDAF-5392-4D75-B919-A298F6C0881E" name="GUID-D5EBBDAF-5392-4D75-B919-A298F6C0881E"></a><h3 id="BRADV-GUID-D5EBBDAF-5392-4D75-B919-A298F6C0881E" class="sect3"><span class="enumeration_section">3.4</span>关于RMAN存储库</h3>
               <div>
                  <p>RMAN存储库是有关RMAN用于备份，恢复和维护的目标数据库的元数据的集合。</p>
                  <p>RMAN始终将其元数据存储在控制文件中。控制文件中此元数据的版本是数据库的RMAN备份的权威记录。这是保护控制文件是备份策略的重要部分的一个原因。RMAN可以仅使用控制文件执行所有必要的备份和恢复操作，以存储<a href="glossary.html#GUID-F5643EDD-CE1B-4A9F-9E6E-ADDFD6452341"><span class="xrefglossterm">RMAN存储库</span></a>信息，并维护满足配置的保留策略所需的所有记录。
                  </p>
                  <p>您还可以创建<a href="glossary.html#GUID-CBFA8015-2DFF-42B1-A818-D6C5B92C608F"><span class="xrefglossterm">恢复目录</span></a> ，该<a href="glossary.html#GUID-CBFA8015-2DFF-42B1-A818-D6C5B92C608F"><span class="xrefglossterm">目录</span></a>是存储在Oracle数据库模式中的RMAN元数据的存储库。控制文件的备份活动记录空间有限，而恢复目录可以存储更长的历史记录。您可以通过创建包含所有数据库的RMAN元数据的单个恢复目录来简化备份和恢复管理。
                  </p>
                  <p>恢复目录的所有者可以向其他数据库用户授予或撤消对目录的受限访问。每个受限用户都对其自己的元数据具有完全读/写访问权限，称为<a href="glossary.html#GUID-3ACE1C6A-AEA0-4F3A-973B-2308E0A5AD4B"><span class="xrefglossterm">虚拟专用目录</span></a> 。当数据库中存在一个或多个虚拟专用目录时，该数据库仅包含一组目录表。这些表归基本恢复目录所有者所有。基本恢复目录的所有者控制每个虚拟专用目录用户可以访问的数据库。
                  </p>
                  <p>某些RMAN功能仅在您使用恢复目录时才起作用。例如，您可以在恢复目录中创建<a href="glossary.html#GUID-6A46F2BF-D1BF-4993-89BC-52A0AEC9370C"><span class="xrefglossterm">存储的脚本</span></a> ，并使用此脚本执行RMAN作业。其他RMAN命令与管理恢复目录特别相关，因此如果RMAN未连接到恢复目录，则不可用（并且不需要）。
                  </p>
                  <p>恢复目录仅由RMAN维护。目标数据库实例永远不会直接访问目录。在更新存储库的任何操作之后，以及在某些操作之前，RMAN会将有关数据库结构，归档重做日志，备份集和数据文件副本的信息传播到目标数据库控制文件的恢复目录中。</p>
                  <div class="infoboxnotealso" id="GUID-D5EBBDAF-5392-4D75-B919-A298F6C0881E__GUID-BA7B77F6-23BC-4082-8513-DBDE3D0688C9">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="maintaining-rman-backups.html#GUID-F5C3D045-279B-4AB3-8A91-3231A716402C" title="建议的维护策略是配置快速恢复区域，备份保留策略和归档重做日志删除策略。在这种情况下，数据库会根据需要自动维护和删除备份和归档重做日志。但是，有时需要手动维护数据库备份和归档重做日志。RMAN提供多个命令来维护RMAN备份和存储库记录。RMAN始终将其元数据存储在其执行操作的每个目标数据库的控制文件中。如果在恢复目录中注册目标数据库，则RMAN会将此目标数据库的元数据存储在恢复目录中。创建备份或副本的Data Guard环境中的数据库与该文件相关联。例如，如果RMAN连接到目标数据库standby1并备份它，则此备份与standby1关联。对于交叉检查，RMAN只能在连接到与文件关联的数据库时将文件状态从AVAILABLE更新为EXPIRED。RMAN可以在连接到任何数据库时删除文件。如果RMAN未作为TARGET连接到与文件关联的数据库，并且RMAN无法成功删除文件，则RMAN会提示您将TARGET连接到与该文件关联的数据库。然后你必须使用DELETE ...FORCE删除文件元数据。如果维护命令仅更改RMAN元数据，则可以将RMAN作为TARGET连接到Data Guard环境中的任何数据库。除非您明确使用CHANGE，否则备份仍与数据库关联...RESET DB_UNIQUE_NAME将备份与其他数据库关联。RMAN旨在在没有恢复目录的情况下工作。但是，如果选择不使用恢复目录，则每个目标数据库的控制文件都是RMAN元数据的独占存储库。控制文件包含两种类型的记录：循环重用记录和非圆形重用记录。当包含有关在快速恢复区域中创建的文件的信息的控制文件记录即将被重用时，数据库尝试在文件有资格删除时从快速恢复区域中删除该文件。否则，数据库会扩展包含此文件记录的控制文件部分的大小。防止因覆盖控制文件记录而丢失RMAN元数据的最佳方法是使用恢复目录。如果您没有使用恢复目录来存储RMAN元数据，那么保护每个目标数据库控制文件是非常重要的。虽然快速恢复区域主要是自我管理，但某些情况可能需要数据库管理干预。RMAN使用某些规则来确定何时可以从快速恢复区域删除文件。您可以使用V $ RECOVERY_FILE_DEST和V $ RECOVERY_AREA_USAGE视图来确定是否为快速恢复区域分配了足够的空间。除了设置闪回保留目标或使用保证还原点之外，您无法直接管理快速恢复区域中的闪回日志。如果RMAN保留策略要求保留一组大于快速恢复区磁盘配额的备份，或者保留策略设置为NONE，则快速恢复区域可以完全填充，没有可回收空间。使用ALTER SYSTEM命令更改快速恢复区域的位置。ALTER SYSTEM命令可用于禁用快速恢复区域。通常，快速恢复区域是自我维护的。但是，当在快速恢复区域中创建文件期间实例崩溃时，数据库可能会将文件保留在快速恢复区域中。某些情况可能会导致存储库与其记录的文件之间出现差异，包括磁带或磁盘故障以及用户管理的副本或RMAN相关文件的删除。要确保恢复目录或控制文件中的备份数据与磁盘上或介质管理目录中的相应数据同步，请执行交叉检查。CROSSCHECK命令仅对当前记录在RMAN存储库中的文件进行操作。交叉检查更新过期的RMAN存储库信息，该信息与存储库记录与其物理状态不匹配的备份有关。例如，如果用户使用操作系统命令从磁盘中删除存档日志，则存储库仍会指示日志位于磁盘上，而实际上并非如此。连接到目标数据库和恢复目录（如果使用）后，根据需要运行CROSSCHECK命令以验证RMAN已知的备份的状态和可用性。您可以使用LIST命令报告备份，然后使用CROSSCHECK命令检查LIST输出中描述的特定备份是否仍然存在。使用CROSSCHECK命令验证RMAN.RMAN已知的预刷新备份和预刷新归档重做日志文件的状态和可用性，提供了多种更改备份和副本的存储库状态的方法。运行CHANGE ...无法找到备份或已异地迁移时的UNAVAILABLE命令。您可以将备份指定为免除保留策略。此技术对于归档备份以满足业务要求非常有用。将CHANGE命令与GUID选项一起使用可更改与从多租户容器数据库（CDB）中删除的可插拔数据库（PDB）对应的备份的状态。使用CHANGE命令可以修改预存储备份和预存储存档重做日志文件的存储库状态。您可以使用CATALOG命令使RMAN知道存储库中未记录的存档日志的存在，或者通过RMAN以外的方式创建的数据库文件的副本。目标数据库控制文件保留目标数据库和所有RMAN备份生成的所有归档重做日志的记录。CATALOG命令的目的是在没有要管理的RMAN文件记录时将元数据添加到存储库。使用CATALOG命令将有关用户管理的副本的信息传播到RMAN存储库。对文件进行编目后，可以运行LIST命令或查询V $ BACKUP_FILES视图以确认信息包含在RMAN存储库中。您可以在磁盘上编目备份片段。如果使用操作系统实用程序将备份片段从一个位置复制到同一主机上的另一个位置，或从一个主机复制到另一个主机，则此技术非常有用。如果使用自动存储管理（ASM），Oracle托管文件框架或快速恢复区域，则可能需要重新编目磁盘管理系统已知但不再列在RMAN存储库中的文件。当用于跟踪文件名的预期机制因介质故障，软件错误或用户错误而失败时，可能会发生这种情况。使用CATALOG命令将preplugin归档重做日志文件添加到RMAN存储库。您可以从RMAN存储库中删除文件的记录。你可以使用CHANGE ...UNCATALOG命令更新缺少文件的RMAN存储库。您可以使用RMAN DELETE命令删除存档的重做日志和RMAN备份。每个RMAN备份在RMAN存储库中生成相应的记录。该记录存储在控制文件中。如果使用了恢复目录，则在从控制文件重新同步恢复目录后，也可以在恢复目录中找到该记录。您可以删除备份的备份和恢复目录记录。建议的维护策略是配置快速恢复区域，备份保留策略和归档重做日志删除策略。使用RMAN DELETE命令删除备份和映像副本。你可以同时使用DELETE和BACKUP ......删除命令以删除特定备份和副本。你可以使用BACKUP ......删除以备份存档的重做日志，数据文件副本或备份集，然后在成功备份后删除输入文件。如果您运行CROSSCHECK，并且RMAN无法找到文件，则它会将RMAN存储库中的记录更新为EXPIRED状态。然后，您可以使用DELETE EXPIRED命令从RMAN存储库中删除过期备份和副本的记录。RMAN DELETE命令支持OBSOLETE选项，该选项删除不再需要的备份以满足指定的可恢复性要求。使用带有GUID选项的DELETE命令可以删除已从多租户容器数据库（CDB）中删除的可插拔数据库（PDB）的备份。使用DELETE命令删除预制备份备份和prelplugin存档重做日志文件。要从操作系统中删除数据库，可以在RMAN中使用DROP DATABASE命令。 RMAN删除服务器参数文件，所有数据文件，联机重做日志和属于目标数据库的控制文件。">维护RMAN备份和存储库记录</a>以及<a href="managing-recovery-catalog.html#GUID-E836E243-6620-495B-ACFB-AC0001EF4E89" title="本节介绍与管理恢复目录相关的基本概念。恢复目录是RMAN用于存储有关一个或多个Oracle数据库的元数据的数据库模式。通常，您将目录存储在专用数据库中。恢复目录包含有关每个已注册目标数据库的RMAN操作的元数据。当RMAN连接到恢复目录时，RMAN将仅从目录中获取其元数据。在RMAN使用的恢复目录中注册数据库的过程称为注册。集中式恢复目录的所有者（也称为基本恢复目录）可以向其他数据库用户授予或撤消对目录的受限访问。对于RMAN操作（如备份，还原和交叉检查），RMAN始终首先更新控制文件，然后将元数据传播到恢复目录。从挂载的控制文件到恢复目录的此元数据流（称为恢复目录重新同步）确保RMAN从控制文件获取的元数据是最新的。您可以使用存储的脚本替代命令文件来管理常用的RMAN命令序列。该脚本存储在恢复目录中，而不是存储在文件系统中。必须使用恢复目录来管理Data Guard环境中所有物理数据库（主数据库和备用数据库）的RMAN元数据。RMAN使用恢复目录作为Data Guard环境的唯一事实来源。管理恢复目录包括创建目录，然后使用目录注册目标数据库。创建恢复目录包含多个阶段，包括配置恢复目录数据库，创建恢复目录模式所有者，然后创建目录。使用恢复目录时，RMAN要求您维护恢复目录架构。恢复目录存储在架构的默认表空间中。SYS等特权用户不能是恢复目录的所有者。您必须分配目录模式使用的空间。恢复目录模式的大小取决于目录监视的数据库数。如果要在现有数据库中创建恢复目录，请添加足够的空间来保存恢复目录模式的默认表空间。选择恢复目录数据库并创建必要的空间后，即可创建恢复目录的所有者，并为此用户授予必要的权限。创建目录所有者后，使用RMAN CREATE CATALOG命令创建目录表。该命令在目录所有者的默认表空间中创建目录。在恢复目录中注册目标数据库可在恢复目录中维护数据库的记录。在恢复目录中注册目标数据库的过程称为注册。在Data Guard环境中，主数据库和备用数据库共享相同的DBID和数据库名称。要符合在恢复目录中注册的条件，Data Guard环境中的每个数据库都必须具有不同的DB_UNIQUE_NAME值。将恢复目录与目标数据库一起使用的第一步是在恢复目录中注册目标数据库。如果在Data Guard环境中使用目录，则只能以这种方式注册主数据库。如果磁盘上有数据文件副本，备份片或归档日志，则可以使用CATALOG命令在恢复目录中对它们进行编目。使用恢复目录时，对已超出控制文件的旧备份进行编录可使RMAN在还原操作期间使用较旧的备份。RMAN提供了多个命令来创建和管理虚拟专用目录。RMAN使用虚拟专用数据库（VPD）功能来实现虚拟专用目录。创建虚拟专用目录是一个多步骤过程，您首先要创建将拥有虚拟专用目录的数据库用户，然后创建虚拟专用目录。要在虚拟专用目录中存储目标数据库的备份元数据，必须使用虚拟专用目录注册数据库。创建虚拟专用目录后，可以根据需要撤消目录访问权限。本节介绍如何使用UPGRADE CATALOG命令升级虚拟专用目录。在备份和恢复策略中包含恢复目录数据库。如果不备份恢复目录并且发生破坏恢复目录数据库的磁盘故障，则可能会丢失目录中的元数据。如果没有恢复目录内容，则恢复其他数据库可能会更加困难。单个恢复目录可以存储多个目标数据库的元数据。因此，恢复目录的丢失可能是灾难性的。您必须经常备份恢复目录。恢复目录数据库与任何其他数据库一样，也是备份和恢复策略的关键部分。通过备份来保护恢复目录，就像数据库的任何其他部分一样。恢复目录数据库的备份策略是整体备份和恢复策略的一部分。备份恢复目录数据库时，可以使用RMAN进行备份。恢复目录仅在与旨在保护的数据分开时才有效。因此，您绝不能将包含数据库的RMAN存储库的恢复目录存储在与目标数据库相同的数据库中。另外，请勿将目录数据库存储在与目标数据库相同的磁盘上。使用“数据泵导出”实用程序创建的RMAN恢复目录的逻辑备份可以作为物理备份的有用补充。恢复和恢复恢复目录数据库非常类似于使用RMAN恢复和恢复任何其他数据库。您可以在恢复目录中创建和存储脚本。您可以使用存储的脚本替代命令文件来管理常用的RMAN命令序列。该脚本存储在恢复目录中，而不是存储在文件系统中。您可以使用CREATE SCRIPT命令创建存储的脚本。要更新存储的脚本，请使用REPLACE SCRIPT命令。使用EXECUTE SCRIPT命令运行存储的脚本。您可以在CREATE SCRIPT命令中指定替换变量。PRINT SCRIPT命令显示存储的脚本或将其写入文件。使用列表......SCRIPT NAMES命令显示恢复目录中定义的脚本的名称。使用DELETE GLOBAL SCRIPT命令从恢复目录中删除存储的脚本。要在启动时运行RMAN客户端并在恢复目录中启动存储的脚本，请在启动RMAN客户端时使用SCRIPT参数。维护恢复目录包括重新同步，更新和升级恢复目录等任务。创建恢复目录并注册目标数据库后，必须维护此目录。当RMAN执行重新同步时，它会将恢复目录与目标数据库的当前或备份控制文件进行比较，并使用缺少或更改的元数据更新目录。恢复目录的重新同步可确保RMAN从控制文件中获取的元数据保持最新。重新同步可以是完全或部分的。当作为TARGET连接到此数据库时，RMAN仅自动将恢复目录与数据库重新同步。因此，当作为TARGET连接到环境中的一个数据库时，RMAN不会自动重新同步Data Guard环境中的每个数据库。当RMAN连接到目标数据库和恢复目录并且您已执行RMAN命令时，RMAN会自动重新同步恢复目录。如果在发出导致部分重新同步的RMAN命令时恢复目录不可用，则稍后打开目录数据库并使用RESYNC CATALOG命令手动重新同步它。即使未以TARGET身份连接到此数据库，也可以为备用数据库创建或更改RMAN配置。您的目标是确保恢复目录中的元数据是最新的。由于恢复目录从目标控制文件获取其元数据，因此目录中数据的货币取决于控制文件中数据的货币。您必须确保控制文件中的备份元数据在被新记录覆盖之前记录在目录中。使用RESYNC CATALOG强制恢复目录与目标数据库控制文件完全重新同步。您可以决定在Data Guard环境中更改数据库的DB_UNIQUE_NAME。在这种情况下，您可以运行CHANGE DB_UNIQUE_NAME命令，将存储在旧DB_UNIQUE_NAME的恢复目录中的元数据与新的DB_UNIQUE_NAME关联。您可以使用UNREGISTER DATABASE命令从恢复目录中取消注册数据库。使用UNREGISTER DATABASE命令取消注册目标数据库。UNREGISTER命令支持DB_UNIQUE_NAME子句以在Data Guard环境中使用。您可以使用此子句删除特定数据库的元数据。在零数据丢失恢复设备（恢复设备）环境中，UNREGISTER DATABASE命令不能用于从恢复设备目录中注销受保护的数据库。而是使用DBMS_RA.DELETE_DB过程。使用RESETLOGS选项打开数据库时，可以创建数据库的化身。您可以在V $ DATABASE_INCARNATION视图中访问新化身的记录。本节介绍恢复目录升级的内容以及何时必须执行此操作。如果要升级到Oracle Database 12c第1版（12.1.0.2）或更高版本，则恢复目录数据库必须使用Oracle数据库企业版。假设您在Data Guard环境中将恢复目录库架构升级到Oracle Database 11g或更高版本。当RMAN连接到备用数据库时，它会自动注册新的数据库信息并重新同步以从控制文件中获取文件名。恢复目录的模式版本存储在恢复目录本身中。如果在生产系统中维护多个不同版本的数据库，则必须确定信息，并且必须确定目录模式版本是否可用于特定目标数据库版本。此方案假定您要将恢复目录库架构升级到当前版本。您可以使用RMAN中的IMPORT CATALOG命令将一个恢复目录模式合并到另一个模式中。使用IMPORT CATALOG时，源目录模式是要导入到其他模式的目录模式。目标目录模式是要导入源目录模式的目录模式。在恢复设备环境中，所有受保护数据库共享驻留在恢复设备上的单个集中管理的恢复设备目录。所有将备份发送到恢复设备的受保护数据库都必须使用此目录。目标数据库，恢复目录数据库和恢复目录模式可以位于不同的数据库版本中。建议的做法是将所有现有恢复目录导入到最新版本的恢复目录模式的单个恢复目录中。将一个恢复目录导入另一个目录时，不需要与目标数据库建立连接。RMAN只需要连接到源和目标目录。将恢复目录从一个数据库移动到另一个数据库的过程是导入目录的过程的变体。DROP CATALOG命令删除由CREATE CATALOG命令创建的那些对象。如果拥有恢复目录的用户还拥有不是由CREATE CATALOG创建的对象，则DROP CATALOG命令不会删除这些对象。">管理恢复目录</a></p>
                  </div>
               </div>
            </div><a id="BRADV104"></a><div class="props_rev_2"><a id="GUID-12A32971-242E-4C62-AE95-26D58D5C983D" name="GUID-12A32971-242E-4C62-AE95-26D58D5C983D"></a><h3 id="BRADV-GUID-12A32971-242E-4C62-AE95-26D58D5C983D" class="sect3"><span class="enumeration_section">3.5</span>关于使用RMAN进行媒体管理</h3>
               <div>
                  <p>Oracle媒体管理层（MML）API允许第三方供应商构建与RMAN配合使用的媒体管理软件，以允许备份到磁带驱动器等顺序媒体设备。</p>
                  <p>媒体管理软件处理顺序媒体（如磁带）的加载，卸载和标记。您必须安装<a href="glossary.html#GUID-26FF62D0-5938-481D-B7B9-929BC971813E"><span class="xrefglossterm">媒体管理软件</span></a>才能将RMAN与顺序媒体设备配合使用。
                  </p>
                  <p>备份或还原时，RMAN客户端连接到目标数据库实例，并指示实例将请求发送到其媒体管理器。RMAN客户端和媒体管理器之间没有直接通信。</p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="rman-architecture.html#GUID-C437C2D1-FB77-4AD6-9B29-210380FADA92" title="在执行备份或还原到媒体管理器之前，必须分配一个或多个通道来处理与媒体管理器的通信。您还可以为媒体管理器配置默认通道。默认通道用于使用媒体管理器且尚未明确分配通道的所有备份和恢复任务。">关于RMAN与媒体管理器的交互</a></p>
                     </li>
                     <li>
                        <p><a href="rman-architecture.html#GUID-03BC1495-32A8-4249-ADFA-FA07D8757665" title="Oracle Secure Backup是一种媒体管理器，可通过文件系统备份到磁带提供可靠，安全的数据保护。支持SAN，千兆以太网和SCSI环境中的所有主要磁带驱动器和磁带库。">关于RMAN和Oracle Secure Backup</a></p>
                     </li>
                     <li>
                        <p><a href="rman-architecture.html#GUID-8C422DA7-C518-4DF3-9BD4-46CED1CEE7AD" title="Oracle备份解决方案计划（BSP）是Oracle PartnerNetwork的一部分，是一组媒体管理器供应商，其产品符合Oracle的MML规范。媒体管理供应商可能会为您的平台提供多种产品。">关于备份解决方案计划</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89375"></a><div class="props_rev_3"><a id="GUID-C437C2D1-FB77-4AD6-9B29-210380FADA92" name="GUID-C437C2D1-FB77-4AD6-9B29-210380FADA92"></a><h4 id="BRADV-GUID-C437C2D1-FB77-4AD6-9B29-210380FADA92" class="sect4"><span class="enumeration_section">3.5.1</span>关于RMAN与媒体管理器的交互</h4>
                  <div>
                     <p>在执行备份或还原到媒体管理器之前，必须分配一个或多个通道来处理与媒体管理器的通信。您还可以为媒体管理器配置默认通道。默认通道用于使用媒体管理器且尚未明确分配通道的所有备份和恢复任务。</p>
                     <p>RMAN不会发出特定命令来加载，标记或卸载磁带。备份时，RMAN为媒体管理器提供字节流，并将唯一名称与此流关联。当RMAN必须还原备份时，它会要求介质管理器检索字节流。存储流的方式和位置的所有细节完全由媒体管理器处理。例如，媒体管理器标记并跟踪每个磁带上的磁带和文件名，并自动加载和卸载磁带，或向操作员发出信号。</p>
                     <p>某些媒体管理器支持<a href="glossary.html#GUID-C4A7D804-0F77-4FA3-AA77-85D3C7E78E2B"><span class="xrefglossterm">代理复制</span></a>功能，它们处理数据文件和备份设备之间的整个数据移动。这些产品可能使用诸如存储和媒体子系统之间的高速连接之类的技术来减少主数据库服务器上的负载。RMAN提供需要备份或还原到媒体管理器的文件列表，这反过来会做出有关如何以及何时移动数据的所有决策。
                     </p>
                     <div class="infoboxnotealso" id="GUID-C437C2D1-FB77-4AD6-9B29-210380FADA92__GUID-5253D127-6C0F-405A-9889-A013C30DB316">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“ <a href="configuring-rman-client-basic.html#GUID-DB37EEF2-426B-4060-BA36-FEE38C11ADB8" title="配置SBT通道会创建一个持久性设置，该设置是用于使用媒体管理器进行备份和恢复操作的默认设置。">配置SBT频道以与媒体管理器配合使用</a> ”</span></p>
                     </div>
                  </div>
               </div><a id="BRADV89376"></a><div class="props_rev_3"><a id="GUID-03BC1495-32A8-4249-ADFA-FA07D8757665" name="GUID-03BC1495-32A8-4249-ADFA-FA07D8757665"></a><h4 id="BRADV-GUID-03BC1495-32A8-4249-ADFA-FA07D8757665" class="sect4"><span class="enumeration_section">3.5.2</span>关于RMAN和Oracle Secure Backup</h4>
                  <div>
                     <p>Oracle Secure Backup是一种媒体管理器，可通过文件系统备份到磁带提供可靠，安全的数据保护。支持SAN，千兆以太网和SCSI环境中的所有主要磁带驱动器和磁带库。</p>
                     <p>虽然<a href="glossary.html#GUID-8879C26C-4DF5-4040-BC7A-37CF7C482C56"><span class="xrefglossterm">Oracle Secure Backup</span></a>不具备数据库备份和恢复算法的专业知识，但它可以通过SBT接口充当RMAN的媒体管理层。在此功能中，Oracle Secure Backup为RMAN提供与其他受支持的第三方SBT库相同的服务。但是，Oracle Secure Backup具有某些功能，这些功能在其他媒体管理器中不可用。
                     </p>
                     <div class="infoboxnotealso" id="GUID-03BC1495-32A8-4249-ADFA-FA07D8757665__GUID-1B808519-D5B8-4774-A148-61B70A3C624B">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=OBADM183" target="_blank"><span class="italic">Oracle Secure Backup管理员指南</span></a> ，了解如何使用Oracle Secure Backup</p>
                     </div>
                  </div>
               </div><a id="BRADV89377"></a><div class="props_rev_3"><a id="GUID-8C422DA7-C518-4DF3-9BD4-46CED1CEE7AD" name="GUID-8C422DA7-C518-4DF3-9BD4-46CED1CEE7AD"></a><h4 id="BRADV-GUID-8C422DA7-C518-4DF3-9BD4-46CED1CEE7AD" class="sect4"><span class="enumeration_section">3.5.3</span>关于备份解决方案计划</h4>
                  <div>
                     <p>Oracle备份解决方案计划（BSP）是Oracle PartnerNetwork的一部分，是一组媒体管理器供应商，其产品符合Oracle的MML规范。媒体管理供应商可能会为您的平台提供多种产品。</p>
                     <p>有关更多信息，请联系您的Oracle代表以获取可用产品列表，联系各个供应商以询问他们是否参与，或访问备份解决方案计划网站：</p>
                     <p><a href="http://www.oracle.com/technetwork/database/features/availability/bsp-088814.html" target="_blank"><code class="codeph">http://www.oracle.com/technetwork/database/features/availability/bsp-088814.html</code></a></p>
                     <p>Oracle不认证媒体管理器供应商与RMAN的兼容性。有关可用性，版本兼容性和功能的问题只能由媒体管理器供应商来回答，而不是Oracle。</p>
                  </div>
               </div>
            </div><a id="BRADV89378"></a><div class="props_rev_3"><a id="GUID-06A2CC19-9D45-4360-98D4-79FB32EE6153" name="GUID-06A2CC19-9D45-4360-98D4-79FB32EE6153"></a><h3 id="BRADV-GUID-06A2CC19-9D45-4360-98D4-79FB32EE6153" class="sect3"><span class="enumeration_section">3.6</span>关于快速恢复区</h3>
               <div>
                  <p>快速恢复区域是可选的磁盘位置，可用于存储与恢复相关的文件。</p>
                  <p>创建不同备份和恢复相关文件的组件不了解彼此或存储数据的文件系统的大小。通过基于磁盘的自动备份和恢复，您可以创建<a href="glossary.html#GUID-6E3CDD76-A573-4E5C-B12D-59C232C96C19"><span class="xrefglossterm">快速恢复区域</span></a> （也称为<span class="bold">恢复区域</span> ），从而自动管理与备份相关的文件。
                  </p>
                  <p>快速恢复区域最大限度地减少了为备份相关文件手动管理磁盘空间的需要，并平衡了不同类型文件之间的空间使用。通过这种方式，快速恢复区域简化了数据库的持续管理。Oracle建议您启用恢复区域以简化备份管理。</p>
                  <p>创建恢复区域时，在磁盘上选择一个位置并设置存储空间的上限。您还可以设置<a href="glossary.html#GUID-ECF0ADBB-3255-43A2-A425-26850EA598EA"><span class="xrefglossterm">备份保留策略</span></a> ，该<a href="glossary.html#GUID-ECF0ADBB-3255-43A2-A425-26850EA598EA"><span class="xrefglossterm">策略</span></a>控制恢复所需的备份文件的时长。数据库管理用于备份，存档重做日志以及此空间内数据库的其他恢复相关文件的存储。当RMAN必须回收新文件的空间时，不再需要的文件有资格删除。
                  </p>
                  <div class="infoboxnotealso" id="GUID-06A2CC19-9D45-4360-98D4-79FB32EE6153__GUID-238F9E6F-B23F-4ABA-9B3C-7ABDB3F38C39">
                     <p class="notep1">也可以看看：</p>
                     <p><span class="q">“ <a href="configuring-rman-client-basic.html#GUID-302339EC-EE0F-45FB-9862-BB2BA138AA13" title="快速恢复区域功能使您可以设置磁盘区域，数据库可以在该区域中创建和管理与备份和恢复相关的各种文件。强烈建议使用快速恢复区域。考虑将快速恢复区域配置为实施备份策略的第一步。">配置快速恢复区</a> ”</span>以了解快速恢复区以及如何配置它</p>
                  </div>
               </div>
            </div><a id="BRADV89379"></a><div class="props_rev_3"><a id="GUID-B18B15EA-1F59-4858-B6E9-9870A564CD62" name="GUID-B18B15EA-1F59-4858-B6E9-9870A564CD62"></a><h3 id="BRADV-GUID-B18B15EA-1F59-4858-B6E9-9870A564CD62" class="sect3"><span class="enumeration_section">3.7</span>关于Data Guard环境中的RMAN</h3>
               <div>
                  <p>Data Guard将备用数据库维护为生产数据库的事务一致性副本。备用数据库可以是物理备用数据库，也可以是逻辑备用数据库。</p>
                  <p>Data Guard环境中的数据库由初始化参数文件中的<a href="../refrn/DB_UNIQUE_NAME.html#REFRN10242" target="_blank"><code class="codeph">DB_UNIQUE_NAME</code></a>参数唯一标识。要使RMAN在Data Guard环境中正常工作， <code class="codeph">DB_UNIQUE_NAME</code>在具有相同DBID的所有数据库中必须是唯一的。</p>
                  <p>在Data Guard环境中使用RMAN时，需要恢复目录。恢复目录可以存储所有主数据库和备用数据库的元数据。</p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="rman-architecture.html#GUID-D3BD7E4E-30F5-4696-9649-4154BBEC2C62" title="为了简化RMAN的持续使用以进行备份和恢复，您可以在Data Guard环境中为每个主要和物理备用数据库设置一些持久性配置设置。这些设置控制RMAN行为的许多方面。例如，您可以配置备份保留策略，备份到磁带或磁盘的默认目标，或默认备份设备类型。">关于Data Guard环境中的RMAN配置</a></p>
                     </li>
                     <li>
                        <p><a href="rman-architecture.html#GUID-E514F9D2-D96E-4087-B8C5-5A8EB6A44E6B" title="RMAN使用恢复目录来跟踪Data Guard环境中所有数据库文件的文件名。">关于Data Guard环境中的RMAN文件管理</a></p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-B18B15EA-1F59-4858-B6E9-9870A564CD62__GUID-7E5C403C-207C-4089-8EB6-CD370D7187E1">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="../sbydb/using-RMAN-in-oracle-data-guard-configurations.html#SBYDB04700" target="_blank"><span class="italic">Oracle Data Guard概念和管理</span></a> ，了解如何在Data Guard环境中使用RMAN</p>
                  </div>
               </div><a id="BRADV89380"></a><div class="props_rev_3"><a id="GUID-D3BD7E4E-30F5-4696-9649-4154BBEC2C62" name="GUID-D3BD7E4E-30F5-4696-9649-4154BBEC2C62"></a><h4 id="BRADV-GUID-D3BD7E4E-30F5-4696-9649-4154BBEC2C62" class="sect4"><span class="enumeration_section">3.7.1</span>关于Data Guard环境中的RMAN配置</h4>
                  <div>
                     <p>为了简化RMAN的持续使用以进行备份和恢复，您可以在Data Guard环境中为每个主要和物理备用数据库设置一些持久性配置设置。这些设置控制RMAN行为的许多方面。例如，您可以配置备份保留策略，备份到磁带或磁盘的默认目标，或默认备份设备类型。</p>
                     <p>您可以将<a href="../rcmrf/CONFIGURE.html#RCMRF113" target="_blank"><code class="codeph">CONFIGURE</code></a>命令与<code class="codeph">FOR DB_UNIQUE_NAME</code>子句一起使用，以在Data Guard环境中为数据库创建持久性配置，而无需将备用数据库或主数据库连接为<code class="codeph">TARGET</code> 。例如，您将RMAN连接到恢复目录，运行<code class="codeph">SET DBID</code>命令，然后可以在创建物理备用数据库之前为其创建配置，以便在创建数据库时应用RMAN配置。
                     </p>
                     <p>在恢复目录<a href="glossary.html#GUID-390A74EF-CD69-4173-B810-23EE2A5BB0EF"><span class="xrefglossterm">重新同步</span></a>期间，RMAN在连接到<code class="codeph">TARGET</code>时更新数据库的控制文件。但是，如果对数据库使用<code class="codeph">FOR DB_UNIQUE_NAME</code>而未将其作为<code class="codeph">TARGET</code>连接到此数据库，则RMAN仅更改恢复目录中的配置。
                     </p>
                     <div class="infoboxnotealso" id="GUID-D3BD7E4E-30F5-4696-9649-4154BBEC2C62__GUID-5A8317F4-73D8-4840-BF95-D0CBDADA9F58">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“ <a href="configuring-rman-client-basic.html#GUID-FDA66A53-B2AA-4C59-A142-C2F04016FAEF" title="如果在Data Guard环境中使用RMAN，则可以使用CONFIGURE命令在此环境中注册和配置物理数据库的设置。">在Data Guard环境中配置RMAN</a> ”</span></p>
                     </div>
                  </div>
               </div><a id="BRADV89381"></a><div class="props_rev_3"><a id="GUID-E514F9D2-D96E-4087-B8C5-5A8EB6A44E6B" name="GUID-E514F9D2-D96E-4087-B8C5-5A8EB6A44E6B"></a><h4 id="BRADV-GUID-E514F9D2-D96E-4087-B8C5-5A8EB6A44E6B" class="sect4"><span class="enumeration_section">3.7.2</span>关于Data Guard环境中的RMAN文件管理</h4>
                  <div>
                     <p>RMAN使用恢复目录来跟踪Data Guard环境中所有数据库文件的文件名。</p>
                     <p>该目录还记录了创建联机重做日志文件，备用重做日志文件，临时文件，归档重做日志文件，备份集和映像副本的位置。</p>
                  </div><a id="BRADV99957"></a><div class="props_rev_3"><a id="GUID-28654CD9-CC0C-4027-BA34-86D73D0D4873" name="GUID-28654CD9-CC0C-4027-BA34-86D73D0D4873"></a><h5 id="BRADV-GUID-28654CD9-CC0C-4027-BA34-86D73D0D4873" class="sect5"><span class="enumeration_section">3.7.2.1</span>关于Data Guard环境中备份的可互换性</h5>
                     <div>
                        <p>RMAN命令使用恢复目录元数据在Data Guard环境中的不同物理数据库之间透明地运行。例如，您可以备份物理备用数据库上的表空间，并在主数据库上还原和恢复它。同样，您可以备份主数据库上的表空间，并在物理备用数据库上还原和恢复它。</p>
                        <p>备用控制文件和非备用控制文件的备份是可互换的。例如，您可以还原主数据库上的备用控制文件和物理备用数据库上的主控制文件。这种可互换性意味着您可以将控制文件备份卸载到Data Guard环境中的一个数据库。RMAN在数据库的还原和恢复期间自动更新数据库文件的文件名。</p>
                        <div class="infoboxnote" id="GUID-28654CD9-CC0C-4027-BA34-86D73D0D4873__GUID-89A197B1-F892-4022-8F27-0A7D1B1A1363">
                           <p class="notep1">注意：</p>
                           <p>逻辑备用数据库的备份在主数据库中不可用。</p>
                        </div>
                     </div>
                  </div><a id="BRADV99958"></a><div class="props_rev_3"><a id="GUID-3DDC5739-0A55-4F04-BE4C-4705E300C87F" name="GUID-3DDC5739-0A55-4F04-BE4C-4705E300C87F"></a><h5 id="BRADV-GUID-3DDC5739-0A55-4F04-BE4C-4705E300C87F" class="sect5"><span class="enumeration_section">3.7.2.2</span>关于Data Guard环境中备份的关联</h5>
                     <div>
                        <p>恢复目录通过将每个数据库文件或备份文件与<code class="codeph">DB_UNIQUE_NAME</code>相关联来跟踪Data Guard环境中的文件。创建文件的数据库与该文件相关联。
                        </p>
                        <p>例如，如果RMAN使用唯一名称<code class="codeph">standby1</code>备份数据库，则<code class="codeph">standby1</code>与此备份关联。除非您使用<a href="../rcmrf/CHANGE.html#RCMRF110" target="_blank"><code class="codeph">CHANGE</code></a> ，否则备份仍与创建它的数据库相关联<code class="codeph">...RESET DB_UNIQUE_NAME</code>命令将备份与其他数据库关联。
                        </p>
                     </div>
                  </div><a id="BRADV99959"></a><div class="props_rev_3"><a id="GUID-4176237B-67BE-4C87-A4B8-7AF2E0E6035E" name="GUID-4176237B-67BE-4C87-A4B8-7AF2E0E6035E"></a><h5 id="BRADV-GUID-4176237B-67BE-4C87-A4B8-7AF2E0E6035E" class="sect5"><span class="enumeration_section">3.7.2.3</span>关于Data Guard环境中备份的可访问性</h5>
                     <div>
                        <p>备份的可访问性与其关联不同。在Data Guard环境中，恢复目录将磁盘备份视为只能与它们关联的数据库访问，而在一个数据库上创建的磁带备份可供所有数据库访问。</p>
                        <p>如果备份文件未与任何数据库关联，则在恢复目录视图中描述它的行对于<code class="codeph">SITE_KEY</code>列显示为<code class="codeph">null</code> 。默认情况下，RMAN将<code class="codeph">SITE_KEY</code>为<code class="codeph">null</code>的文件与它们所连接的数据库关联为<code class="codeph">TARGET</code> 。</p>
                        <p>RMAN命令（如<code class="codeph">BACKUP</code> ， <code class="codeph">RESTORE</code>和<code class="codeph">CROSSCHECK</code>可用于任何可访问的备份。例如，对于<code class="codeph">RECOVER COPY</code>操作，RMAN仅将与数据库关联的映像副本视为可以恢复。RMAN认为磁盘和磁带上的增量备份有资格恢复映像副本。在数据库恢复中，RMAN仅考虑与数据库关联的磁盘备份以及磁带上的所有文件都有资格恢复。
                        </p>
                        <p>为了说明备份可访问性的差异，假设数据库<code class="codeph">prod</code>和<code class="codeph">standby1</code>驻留在不同的主机上。RMAN将<code class="codeph">prod</code>上的数据文件<code class="codeph">1</code>备份到生产主机上的<code class="codeph">/prmhost/disk1/df1.dbf</code> ，也备份到磁带。RMAN备份数据文件<code class="codeph">1</code>上<code class="codeph">standby1</code>到<code class="codeph">/sbyhost/disk2/df1.dbf</code>备用主机上，并且还到磁带上。如果RMAN连接到数据库<code class="codeph">prod</code> ，则无法使用RMAN命令对备用主机上的<code class="codeph">/sbyhost/disk2/df1.dbf</code>备份执行操作。然而，RMAN会考虑上所做的磁带备份<code class="codeph">standby1</code>有资格得到恢复。
                        </p>
                        <div class="infoboxnote" id="GUID-4176237B-67BE-4C87-A4B8-7AF2E0E6035E__GUID-0BDDBB3E-50DB-41D4-A4E2-7595C94C3792">
                           <p class="notep1">注意：</p>
                           <p>您可以将备份从备用主机传输到主要主机，反之亦然，将<code class="codeph">TARGET</code>连接到此主机上的数据库，然后使用<a href="../rcmrf/CATALOG.html#RCMRF109" target="_blank"><code class="codeph">CATALOG</code></a>命令对备份进行编目。在目标数据库对文件进行编目之后，该文件将与目标数据库关联。
                           </p>
                        </div>
                        <div class="infoboxnotealso" id="GUID-4176237B-67BE-4C87-A4B8-7AF2E0E6035E__GUID-79E047FD-A42A-42FE-906B-C07FB7CED1B5">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="../sbydb/using-RMAN-in-oracle-data-guard-configurations.html#SBYDB04700" target="_blank"><span class="italic">Oracle Data Guard概念和管理</span></a> ，了解如何在Data Guard环境中执行RMAN备份和恢复</p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="maintaining-rman-backups.html#GUID-F0C0A8F9-CBDF-4EDE-BAAF-F93CC37638B1" title="创建备份或副本的Data Guard环境中的数据库与该文件相关联。例如，如果RMAN连接到目标数据库standby1并备份它，则此备份与standby1关联。">关于Data Guard环境中的维护命令</a> ”</span></p>
                              </li>
                              <li>
                                 <p><a href="managing-recovery-catalog.html#GUID-E836E243-6620-495B-ACFB-AC0001EF4E89" title="本节介绍与管理恢复目录相关的基本概念。恢复目录是RMAN用于存储有关一个或多个Oracle数据库的元数据的数据库模式。通常，您将目录存储在专用数据库中。恢复目录包含有关每个已注册目标数据库的RMAN操作的元数据。当RMAN连接到恢复目录时，RMAN将仅从目录中获取其元数据。在RMAN使用的恢复目录中注册数据库的过程称为注册。集中式恢复目录的所有者（也称为基本恢复目录）可以向其他数据库用户授予或撤消对目录的受限访问。对于RMAN操作（如备份，还原和交叉检查），RMAN始终首先更新控制文件，然后将元数据传播到恢复目录。从挂载的控制文件到恢复目录的此元数据流（称为恢复目录重新同步）确保RMAN从控制文件获取的元数据是最新的。您可以使用存储的脚本替代命令文件来管理常用的RMAN命令序列。该脚本存储在恢复目录中，而不是存储在文件系统中。必须使用恢复目录来管理Data Guard环境中所有物理数据库（主数据库和备用数据库）的RMAN元数据。RMAN使用恢复目录作为Data Guard环境的唯一事实来源。管理恢复目录包括创建目录，然后使用目录注册目标数据库。创建恢复目录包含多个阶段，包括配置恢复目录数据库，创建恢复目录模式所有者，然后创建目录。使用恢复目录时，RMAN要求您维护恢复目录架构。恢复目录存储在架构的默认表空间中。SYS等特权用户不能是恢复目录的所有者。您必须分配目录模式使用的空间。恢复目录模式的大小取决于目录监视的数据库数。如果要在现有数据库中创建恢复目录，请添加足够的空间来保存恢复目录模式的默认表空间。选择恢复目录数据库并创建必要的空间后，即可创建恢复目录的所有者，并为此用户授予必要的权限。创建目录所有者后，使用RMAN CREATE CATALOG命令创建目录表。该命令在目录所有者的默认表空间中创建目录。在恢复目录中注册目标数据库可在恢复目录中维护数据库的记录。在恢复目录中注册目标数据库的过程称为注册。在Data Guard环境中，主数据库和备用数据库共享相同的DBID和数据库名称。要符合在恢复目录中注册的条件，Data Guard环境中的每个数据库都必须具有不同的DB_UNIQUE_NAME值。将恢复目录与目标数据库一起使用的第一步是在恢复目录中注册目标数据库。如果在Data Guard环境中使用目录，则只能以这种方式注册主数据库。如果磁盘上有数据文件副本，备份片或归档日志，则可以使用CATALOG命令在恢复目录中对它们进行编目。使用恢复目录时，对已超出控制文件的旧备份进行编录可使RMAN在还原操作期间使用较旧的备份。RMAN提供了多个命令来创建和管理虚拟专用目录。RMAN使用虚拟专用数据库（VPD）功能来实现虚拟专用目录。创建虚拟专用目录是一个多步骤过程，您首先要创建将拥有虚拟专用目录的数据库用户，然后创建虚拟专用目录。要在虚拟专用目录中存储目标数据库的备份元数据，必须使用虚拟专用目录注册数据库。创建虚拟专用目录后，可以根据需要撤消目录访问权限。本节介绍如何使用UPGRADE CATALOG命令升级虚拟专用目录。在备份和恢复策略中包含恢复目录数据库。如果不备份恢复目录并且发生破坏恢复目录数据库的磁盘故障，则可能会丢失目录中的元数据。如果没有恢复目录内容，则恢复其他数据库可能会更加困难。单个恢复目录可以存储多个目标数据库的元数据。因此，恢复目录的丢失可能是灾难性的。您必须经常备份恢复目录。恢复目录数据库与任何其他数据库一样，也是备份和恢复策略的关键部分。通过备份来保护恢复目录，就像数据库的任何其他部分一样。恢复目录数据库的备份策略是整体备份和恢复策略的一部分。备份恢复目录数据库时，可以使用RMAN进行备份。恢复目录仅在与旨在保护的数据分开时才有效。因此，您绝不能将包含数据库的RMAN存储库的恢复目录存储在与目标数据库相同的数据库中。另外，请勿将目录数据库存储在与目标数据库相同的磁盘上。使用“数据泵导出”实用程序创建的RMAN恢复目录的逻辑备份可以作为物理备份的有用补充。恢复和恢复恢复目录数据库非常类似于使用RMAN恢复和恢复任何其他数据库。您可以在恢复目录中创建和存储脚本。您可以使用存储的脚本替代命令文件来管理常用的RMAN命令序列。该脚本存储在恢复目录中，而不是存储在文件系统中。您可以使用CREATE SCRIPT命令创建存储的脚本。要更新存储的脚本，请使用REPLACE SCRIPT命令。使用EXECUTE SCRIPT命令运行存储的脚本。您可以在CREATE SCRIPT命令中指定替换变量。PRINT SCRIPT命令显示存储的脚本或将其写入文件。使用列表......SCRIPT NAMES命令显示恢复目录中定义的脚本的名称。使用DELETE GLOBAL SCRIPT命令从恢复目录中删除存储的脚本。要在启动时运行RMAN客户端并在恢复目录中启动存储的脚本，请在启动RMAN客户端时使用SCRIPT参数。维护恢复目录包括重新同步，更新和升级恢复目录等任务。创建恢复目录并注册目标数据库后，必须维护此目录。当RMAN执行重新同步时，它会将恢复目录与目标数据库的当前或备份控制文件进行比较，并使用缺少或更改的元数据更新目录。恢复目录的重新同步可确保RMAN从控制文件中获取的元数据保持最新。重新同步可以是完全或部分的。当作为TARGET连接到此数据库时，RMAN仅自动将恢复目录与数据库重新同步。因此，当作为TARGET连接到环境中的一个数据库时，RMAN不会自动重新同步Data Guard环境中的每个数据库。当RMAN连接到目标数据库和恢复目录并且您已执行RMAN命令时，RMAN会自动重新同步恢复目录。如果在发出导致部分重新同步的RMAN命令时恢复目录不可用，则稍后打开目录数据库并使用RESYNC CATALOG命令手动重新同步它。即使未以TARGET身份连接到此数据库，也可以为备用数据库创建或更改RMAN配置。您的目标是确保恢复目录中的元数据是最新的。由于恢复目录从目标控制文件获取其元数据，因此目录中数据的货币取决于控制文件中数据的货币。您必须确保控制文件中的备份元数据在被新记录覆盖之前记录在目录中。使用RESYNC CATALOG强制恢复目录与目标数据库控制文件完全重新同步。您可以决定在Data Guard环境中更改数据库的DB_UNIQUE_NAME。在这种情况下，您可以运行CHANGE DB_UNIQUE_NAME命令，将存储在旧DB_UNIQUE_NAME的恢复目录中的元数据与新的DB_UNIQUE_NAME关联。您可以使用UNREGISTER DATABASE命令从恢复目录中取消注册数据库。使用UNREGISTER DATABASE命令取消注册目标数据库。UNREGISTER命令支持DB_UNIQUE_NAME子句以在Data Guard环境中使用。您可以使用此子句删除特定数据库的元数据。在零数据丢失恢复设备（恢复设备）环境中，UNREGISTER DATABASE命令不能用于从恢复设备目录中注销受保护的数据库。而是使用DBMS_RA.DELETE_DB过程。使用RESETLOGS选项打开数据库时，可以创建数据库的化身。您可以在V $ DATABASE_INCARNATION视图中访问新化身的记录。本节介绍恢复目录升级的内容以及何时必须执行此操作。如果要升级到Oracle Database 12c第1版（12.1.0.2）或更高版本，则恢复目录数据库必须使用Oracle数据库企业版。假设您在Data Guard环境中将恢复目录库架构升级到Oracle Database 11g或更高版本。当RMAN连接到备用数据库时，它会自动注册新的数据库信息并重新同步以从控制文件中获取文件名。恢复目录的模式版本存储在恢复目录本身中。如果在生产系统中维护多个不同版本的数据库，则必须确定信息，并且必须确定目录模式版本是否可用于特定目标数据库版本。此方案假定您要将恢复目录库架构升级到当前版本。您可以使用RMAN中的IMPORT CATALOG命令将一个恢复目录模式合并到另一个模式中。使用IMPORT CATALOG时，源目录模式是要导入到其他模式的目录模式。目标目录模式是要导入源目录模式的目录模式。在恢复设备环境中，所有受保护数据库共享驻留在恢复设备上的单个集中管理的恢复设备目录。所有将备份发送到恢复设备的受保护数据库都必须使用此目录。目标数据库，恢复目录数据库和恢复目录模式可以位于不同的数据库版本中。建议的做法是将所有现有恢复目录导入到最新版本的恢复目录模式的单个恢复目录中。将一个恢复目录导入另一个目录时，不需要与目标数据库建立连接。RMAN只需要连接到源和目标目录。将恢复目录从一个数据库移动到另一个数据库的过程是导入目录的过程的变体。DROP CATALOG命令删除由CREATE CATALOG命令创建的那些对象。如果拥有恢复目录的用户还拥有不是由CREATE CATALOG创建的对象，则DROP CATALOG命令不会删除这些对象。">管理恢复目录</a>以了解如何在Data Guard环境中管理恢复目录</p>
                              </li>
                              <li>
                                 <p><code class="codeph">CONFIGURE</code>语法的<a href="../rcmrf/CONFIGURE.html#RCMRF113" target="_blank"><span class="italic">Oracle数据库备份和恢复参考</span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV446"></a><div class="props_rev_3"><a id="GUID-370362C4-9F7C-4D23-A9F8-42F0376F1F5A" name="GUID-370362C4-9F7C-4D23-A9F8-42F0376F1F5A"></a><h3 id="BRADV-GUID-370362C4-9F7C-4D23-A9F8-42F0376F1F5A" class="sect3"><span class="enumeration_section">3.8</span>关于恢复设备环境中的RMAN</h3>
               <div>
                  <div class="p">RMAN与<a href="glossary.html#GUID-238433D1-4ED8-412E-978F-24197B953D94"><span class="xrefglossterm">零数据丢失恢复设备（恢复设备）</span></a>完全集成，RMAN命令可用于将受保护的数据库备份到恢复设备。
                     <div class="infoboxnotealso" id="GUID-370362C4-9F7C-4D23-A9F8-42F0376F1F5A__GUID-5A8317F4-73D8-4840-BF95-D0CBDADA9F58">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="rman-architecture.html#GUID-9F0DA285-4785-4F5F-B185-5452AEF49C78" title="Recovery Appliance提供了一个集中的远程存储库，用于备份企业中的所有目标数据库。所有目标数据库的备份和备份元数据都由恢复设备上的中央恢复目录（恢复设备目录）管理。">创建RMAN备份到恢复设备</a></p>
                     </div>
                  </div>
               </div><a id="BRADV452"></a><a id="BRADV447"></a><div class="props_rev_3"><a id="GUID-9F0DA285-4785-4F5F-B185-5452AEF49C78" name="GUID-9F0DA285-4785-4F5F-B185-5452AEF49C78"></a><h4 id="BRADV-GUID-9F0DA285-4785-4F5F-B185-5452AEF49C78" class="sect4"><span class="enumeration_section">3.8.1</span>创建RMAN备份到恢复设备</h4>
                  <div>
                     <p>Recovery Appliance提供了一个集中的远程存储库，用于备份企业中的所有目标数据库。所有目标数据库的备份和备份元数据都由恢复设备上的中央恢复目录（恢复设备目录）管理。</p>
                     <div class="section">
                        <p></p>
                        <p>在使用Recovery Appliance管理目标数据库的备份之前，必须在恢复设备和目标数据库上执行一些配置步骤。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-9F0DA285-4785-4F5F-B185-5452AEF49C78__GUID-76ACAAC4-C433-4F6A-AAC5-68378F7FF8F5">要将目标数据库备份到恢复设备：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>确保目标数据库满足Recovery Appliance环境中受保护数据库的要求。</span><div>
                              <div class="infoboxnotealso" id="GUID-9F0DA285-4785-4F5F-B185-5452AEF49C78__GUID-31C2871C-4389-481F-9F6F-DE61495A9A6E">
                                 <p class="notep1">也可以看看：</p>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=AMAGD866" target="_blank"><span class="italic">零数据丢失恢复设备管理员指南</span></a> ，了解有关受支持的Oracle数据库版本的信息</p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>在目标数据库上安装Recovery Appliance备份模块。此备份模块是目标数据库用于将备份传输到恢复设备的共享库。</span><div>
                              <div class="infoboxnotealso" id="GUID-9F0DA285-4785-4F5F-B185-5452AEF49C78__GUID-8870F1B4-85D8-40DE-BCC1-464558C977AB">
                                 <p class="notep1">也可以看看：</p>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=AMPDB715" target="_blank"><span class="italic">零数据丢失恢复设备受保护数据库配置指南</span></a> ，了解安装恢复设备备份模块的步骤</p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>使用恢复设备将目标数据库注册为受保护的数据库。</span><div>
                              <p>此步骤包括创建保护策略，配置将由受保护数据库用于使用恢复设备进行身份验证的恢复设备数据库用户，以及使用恢复设备目录注册受保护数据库。</p>
                              <div class="infoboxnotealso" id="GUID-9F0DA285-4785-4F5F-B185-5452AEF49C78__GUID-A000A018-ED96-44B8-BFFD-D3838B1B2BC5">
                                 <p class="notep1">也可以看看：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=AMAGD1085" target="_blank"><span class="italic">零数据丢失恢复设备管理员指南</span></a> ，了解恢复设备上的注册步骤</p>
                                    </li>
                                    <li>
                                       <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=AMPDB713" target="_blank"><span class="italic">“零数据丢失恢复设备受保护数据库配置指南”</span></a> ，了解受保护数据库上的注册步骤</p>
                                    </li>
                                 </ul>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>（可选）配置目标数据库的备份和恢复设置。使用Recovery Appliance执行备份和恢复操作时，将使用这些设置。</span><div>
                              <p><code class="codeph">CONFIGURE</code>命令用于配置受保护数据库的备份和恢复设置。
                              </p>
                              <div class="infoboxnotealso" id="GUID-9F0DA285-4785-4F5F-B185-5452AEF49C78__GUID-52EFFB54-9399-44C9-B586-255AB1CB5113">
                                 <p class="notep1">也可以看看：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><a href="configuring-rman-client-basic.html#GUID-5155F8E6-6E35-4261-9CC1-F12DAA9FAC5B" title="RMAN为执行基本备份和恢复所需的大多数参数提供合理的默认值。您可以修改默认参数的值或覆盖特定会话的这些值。您可以使用SHOW命令显示目标数据库的RMAN配置设置的当前值。您还可以查看这些命令当前是否设置为其默认值。未指定目标设备类型的备份将定向到已配置的默认设备。RMAN已预先配置为使用磁盘作为默认设备类型。无需其他配置。BACKUP命令可以创建备份集或映像副本。对于磁盘，您可以使用CONFIGURE DEVICE TYPE DISK BACKUP TYPE TO命令将RMAN配置为创建备份集或映像副本作为其默认备份类型。RMAN通道是与数据库服务器会话的连接。RMAN使用通道执行大多数任务。使用CONFIGURE CHANNEL命令配置磁盘或SBT通道的选项。您可以为设备类型配置通用通道设置，即用于根据该设备的已配置设置创建的任何通道的模板。默认情况下，RMAN为所有操作分配一个磁盘通道。您可以为此通道指定不同的选项，例如，备份的新默认位置。运行命令时可用于设备类型的通道数确定RMAN是并行读取还是写入。通常，执行命令时使用的通道数应与访问的设备数相匹配。如果在作业期间手动分配通道，则RMAN将忽略任何已配置的通道设置。您可以配置RMAN以自动备份控制文件和服务器参数文件。每当添加备份记录时都会发生自动备份。默认情况下，所有已配置设备的自动备份文件的格式是FORMAT子句中的替换变量％F。SET CONTROLFILE AUTOBACKUP FORMAT命令可以在RUN命令或RMAN提示符下指定，仅在当前会话中覆盖已配置的自动备份格式。在大多数平台上，要备份到磁带等顺序介质并从中恢复，必须将介质管理软件与Oracle数据库集成。您可以将支持数据库和文件系统备份的Oracle Secure Backup用作磁带，作为媒体管理器。在尝试将RMAN与媒体管理器一起使用之前，请确定媒体管理库的位置。安装介质管理软件后，请执行供应商所需的配置，以便软件可以接受RMAN备份。确认数据库服务器可以加载介质管理库之后，请进行测试以确保RMAN可以备份到介质管理器。ALLOCATE CHANNEL命令用于执行与媒体管理器的RMAN通信的基本测试。在媒体管理器上测试通道分配后，创建并恢复测试备份。配置SBT通道会创建一个持久性设置，该设置是用于使用媒体管理器进行备份和恢复操作的默认设置。备份片名由BACKUP命令，CONFIGURE CHANNEL命令或ALLOCATECHANNEL命令中指定的FORMAT字符串确定。备份到媒体管理器的最简单方法是配置自动SBT通道.RMAN命令可用于将目标数据库备份到零数据丢失恢复设备（恢复设备）。将恢复设备用作目标数据库备份的集中存储库需要某些配置步骤。在使用RMAN将目标数据库备份到零数据丢失恢复设备（恢复设备）之前，必须在目标数据库的Oracle主目录中安装恢复设备备份模块。在将Oracle数据库备份到零数据丢失恢复设备（恢复设备）之前，需要进行RMAN配置。在使用RMAN将目标数据库备份到零数据丢失恢复设备（恢复设备）之前，需要确定目标数据库主机上恢复设备备份模块的位置。在为恢复设备配置或分配RMAN通道时使用此位置。存储在受保护数据库中的客户端配置文件包含零数据丢失恢复设备（恢复设备）备份模块用于与恢复设备通信的配置设置。安装Recovery Appliance备份模块时会自动创建此文件。快速恢复区域功能使您可以设置磁盘区域，数据库可以在该区域中创建和管理与备份和恢复相关的各种文件。强烈建议使用快速恢复区域。考虑将快速恢复区域配置为实施备份策略的第一步。快速恢复区域可以包含控制文件，联机重做日志，归档重做日志，闪回日志和RMAN备份。快速恢复区域可以与Oracle托管文件（OMF）一起使用，快速恢复区域中的自动存储管理（ASM）空间在必须根据保留策略保留的备份和归档日志之间进行平衡，以及可能存在的其他文件可能会被删除。通过设置两个初始化参数来启用快速恢复区域。这些参数启用快速恢复区域，无论是否必须关闭并重新启动数据库实例。快速恢复区域越大，它就越有用。理想情况下，快速恢复区域足够大，可以包含控制文件，联机重做日志，归档重做日志和闪回日志。它应该能够包含数据库中所有数据文件的副本以及所选备份策略使用的增量备份。使用数据库初始化参数来设置快速恢复区域的位置和大小。您可以使用ALTER SYSTEM命令禁用快速恢复区域。使用初始化参数配置控制文件和重做日志的默认位置。初始化参数CONTROL_FILES，DB_CREATE_ONLINE_LOG_DEST_n，DB_RECOVERY_FILE_DEST和DB_CREATE_FILE_DEST都相互作用以确定创建数据库控制文件的位置。Oracle建议您将快速恢复区域用作归档位置，因为归档日志由数据库自动管理。某些RMAN命令或隐式操作（例如控制文件自动备份）可以在快速恢复区域中创建文件。备份保留策略指定必须保留哪些备份以满足您的数据恢复要求。CONFIGURE RETENTION POLICY命令的REDUNDANCY参数指定RMAN保留的每个数据文件和控制文件的完整备份数或0级备份数。默认保留策略为REDUNDANCY 1。CONFIGURE命令的RECOVERY WINDOW参数指定当前时间与最早可恢复点之间的天数。禁用保留策略时，RMAN不会将任何备份视为过时。运行RMAN CONFIGURE命令以启用和禁用备份优化。如果备份了相同的文件或相同版本的文件，则备份优化会在某些情况下跳过文件备份。启用备份优化时，BACKUP命令会在将相同文件备份到指定的设备类型时跳过备份文件。备份到SBT设备时，并不总是应用备份优化。默认情况下，备份优化配置为OFF。您可以使用SHOW BACKUP OPTIMIZATION命令查看备份优化的当前设置。您可以使用RMAN创建一个持久性配置，以管理归档重做日志何时有资格从磁盘中删除。您可以使用CONFIGURE ARCHIVELOG DELETION POLICY命令指定归档重做日志何时符合删除条件。默认情况下，没有归档重做日志删除策略，这就是归档重做日志策略设置为NONE子句的原因。您可以使用CONFIGURE ARCHIVELOG DELETION POLICY BACKED UP整数TIMES TO DEVICE TYPE命令启用存档日志删除策略。此配置指定仅当指定设备类型上存在指定数量的归档日志备份时，归档日志才有资格删除。默认情况下，归档重做日志删除策略设置为NONE。如果在Data Guard环境中使用RMAN，则可以使用CONFIGURE命令在此环境中注册和配置物理数据库的设置。">配置RMAN环境</a></p>
                                    </li>
                                    <li>
                                       <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=AMPDB815" target="_blank"><span class="italic">“零数据丢失恢复设备受保护数据库配置指南”</span></a> ，了解有关在恢复设备环境中配置设置的信息</p>
                                    </li>
                                 </ul>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>启动RMAN并作为<code class="codeph">TARGET</code>连接到受保护的数据库，并作为<code class="codeph">CATALOG</code>连接到恢复设备目录。</span><div>
                              <p>与目标数据库的连接必须是具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的用户。与恢复设备的连接与恢复设备用户一样，具有为受保护数据库执行备份和恢复操作所需的权限。
                              </p>
                              <div class="infoboxnotealso" id="GUID-9F0DA285-4785-4F5F-B185-5452AEF49C78__GUID-73DACD1F-3376-44A3-92E8-9D8FD5AA7DB4">
                                 <p class="notep1">也可以看看：</p>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=AMPDB804" target="_blank"><span class="italic">“零数据丢失恢复设备保护数据库配置指南”，</span></a>以获取有关使用RMAN创建连接的信息</p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>分配一个或多个指向恢复设备备份模块的RMAN SBT通道。这些通道用于将数据传输到恢复设备。</span><div>
                              <div class="infoboxnotealso" id="GUID-9F0DA285-4785-4F5F-B185-5452AEF49C78__GUID-F335390A-E4DF-43B3-8F20-3F94E201A38D">
                                 <p class="notep1">也可以看看：</p>
                                 <p><span class="q">“ <a href="configuring-rman-client-basic.html#GUID-6F28089E-6D4E-4D6B-B96E-043C35D029D5" title="RMAN命令可用于将目标数据库备份到零数据丢失恢复设备（恢复设备）。将恢复设备用作目标数据库备份的集中存储库需要某些配置步骤。">配置RMAN以备份到恢复设备</a> ”</span></p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>将目标数据库备份到Recovery Appliance。您可以使用常规RMAN命令将数据库备份到Recovery Appliance。</span><div>
                              <div class="infoboxnotealso" id="GUID-9F0DA285-4785-4F5F-B185-5452AEF49C78__GUID-490C244B-333B-4382-AE72-54F6546ADC8D">
                                 <p class="notep1">也可以看看：</p>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=AMPDB827" target="_blank"><span class="italic">“零数据丢失恢复设备受保护数据库配置指南”</span></a> ，了解备份受保护数据库的步骤</p>
                              </div>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>