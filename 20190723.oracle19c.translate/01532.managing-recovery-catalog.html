<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>管理恢复目录</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96241-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="maintaining-rman-backups.html" title="Previous" type="text/html"></link>
      <link rel="next" href="part-diagnosing-responding-failures.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="BRADV"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="maintaining-rman-backups.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="part-diagnosing-responding-failures.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">备份和恢复用户指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-managing-rman-backups.html" property="item" typeof="WebPage"><span property="name">管理RMAN备份</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">管理恢复目录</li>
            </ol>
            <a id="GUID-E836E243-6620-495B-ACFB-AC0001EF4E89" name="GUID-E836E243-6620-495B-ACFB-AC0001EF4E89"></a><a id="BRADV8015"></a>
            
            <h2 id="BRADV-GUID-E836E243-6620-495B-ACFB-AC0001EF4E89" class="sect2"><span class="enumeration_chapter">13</span>管理恢复目录</h2>
         </header>
         <div class="ind">
            <div>
               <p><a id="d63110e69" class="indexterm-anchor"></a>这个<a id="d63110e74" class="indexterm-anchor"></a>本章介绍了如何管理RMAN恢复目录。目录是一个数据库模式，其中包含一个或多个目标数据库的RMAN存储库数据。本章包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="managing-recovery-catalog.html#GUID-2491887B-D9AC-48BE-914D-CB0341A77057" title="本节介绍与管理恢复目录相关的基本概念。">RMAN恢复目录概述</a></p>
                  </li>
                  <li>
                     <p><a href="managing-recovery-catalog.html#GUID-6BEEEF19-C8B6-43CA-B416-C01720070AC8" title="创建恢复目录包含多个阶段，包括配置恢复目录数据库，创建恢复目录模式所有者，然后创建目录。">创建恢复目录</a></p>
                  </li>
                  <li>
                     <p><a href="managing-recovery-catalog.html#GUID-AD52E63A-F367-46E5-8033-5C56C43BE4DC" title="在恢复目录中注册目标数据库可在恢复目录中维护数据库的记录。">在恢复目录中注册数据库</a></p>
                  </li>
                  <li>
                     <p><a href="managing-recovery-catalog.html#GUID-C2DE2E5D-DCDA-4A85-BA4D-A783180C4F51" title="如果磁盘上有数据文件副本，备份片或归档日志，则可以使用CATALOG命令在恢复目录中对它们进行编目。使用恢复目录时，对已超出控制文件的旧备份进行编录可使RMAN在还原操作期间使用较旧的备份。">编目恢复目录中的备份</a></p>
                  </li>
                  <li>
                     <p><a href="managing-recovery-catalog.html#GUID-B3238BE0-F52D-4773-A277-D3627AE28D57" title="RMAN提供了多个命令来创建和管理虚拟专用目录。">创建和管理虚拟专用目录</a></p>
                  </li>
                  <li>
                     <p><a href="managing-recovery-catalog.html#GUID-6F052177-3BEE-44DD-9136-0A576EF3F010" title="在备份和恢复策略中包含恢复目录数据库。如果不备份恢复目录并且发生破坏恢复目录数据库的磁盘故障，则可能会丢失目录中的元数据。如果没有恢复目录内容，则恢复其他数据库可能会更加困难。">保护恢复目录</a></p>
                  </li>
                  <li>
                     <p><a href="managing-recovery-catalog.html#GUID-14E5B168-8033-4831-A02A-6003212988D7" title="您可以在恢复目录中创建和存储脚本。">管理存储的脚本</a></p>
                  </li>
                  <li>
                     <p><a href="managing-recovery-catalog.html#GUID-5FC1C46A-748D-4DAF-9EF4-62781ACBE319" title="维护恢复目录包括重新同步，更新和升级恢复目录等任务。">维护恢复目录</a></p>
                  </li>
                  <li>
                     <p><a href="managing-recovery-catalog.html#GUID-F9345920-0731-40FA-B44A-CE8F50E09B40" title="DROP CATALOG命令删除由CREATE CATALOG命令创建的那些对象。如果拥有恢复目录的用户还拥有不是由CREATE CATALOG创建的对象，则DROP CATALOG命令不会删除这些对象。">删除恢复目录</a></p>
                     <div class="infoboxnotealso" id="GUID-E836E243-6620-495B-ACFB-AC0001EF4E89__GUID-97E25EA3-B4CA-4E27-B942-3430824DA02B">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="maintaining-rman-backups.html#GUID-F5C3D045-279B-4AB3-8A91-3231A716402C" title="建议的维护策略是配置快速恢复区域，备份保留策略和归档重做日志删除策略。在这种情况下，数据库会根据需要自动维护和删除备份和归档重做日志。但是，有时需要手动维护数据库备份和归档重做日志。RMAN提供多个命令来维护RMAN备份和存储库记录。RMAN始终将其元数据存储在其执行操作的每个目标数据库的控制文件中。如果在恢复目录中注册目标数据库，则RMAN会将此目标数据库的元数据存储在恢复目录中。创建备份或副本的Data Guard环境中的数据库与该文件相关联。例如，如果RMAN连接到目标数据库standby1并备份它，则此备份与standby1关联。对于交叉检查，RMAN只能在连接到与文件关联的数据库时将文件状态从AVAILABLE更新为EXPIRED。RMAN可以在连接到任何数据库时删除文件。如果RMAN未作为TARGET连接到与文件关联的数据库，并且RMAN无法成功删除文件，则RMAN会提示您将TARGET连接到与该文件关联的数据库。然后你必须使用DELETE ...FORCE删除文件元数据。如果维护命令仅更改RMAN元数据，则可以将RMAN作为TARGET连接到Data Guard环境中的任何数据库。除非您明确使用CHANGE，否则备份仍与数据库关联...RESET DB_UNIQUE_NAME将备份与其他数据库关联。RMAN旨在在没有恢复目录的情况下工作。但是，如果选择不使用恢复目录，则每个目标数据库的控制文件都是RMAN元数据的独占存储库。控制文件包含两种类型的记录：循环重用记录和非圆形重用记录。当包含有关在快速恢复区域中创建的文件的信息的控制文件记录即将被重用时，数据库尝试在文件有资格删除时从快速恢复区域中删除该文件。否则，数据库会扩展包含此文件记录的控制文件部分的大小。防止因覆盖控制文件记录而丢失RMAN元数据的最佳方法是使用恢复目录。如果您没有使用恢复目录来存储RMAN元数据，那么保护每个目标数据库控制文件是非常重要的。虽然快速恢复区域主要是自我管理，但某些情况可能需要数据库管理干预。RMAN使用某些规则来确定何时可以从快速恢复区域删除文件。您可以使用V $ RECOVERY_FILE_DEST和V $ RECOVERY_AREA_USAGE视图来确定是否为快速恢复区域分配了足够的空间。除了设置闪回保留目标或使用保证还原点之外，您无法直接管理快速恢复区域中的闪回日志。如果RMAN保留策略要求保留一组大于快速恢复区磁盘配额的备份，或者保留策略设置为NONE，则快速恢复区域可以完全填充，没有可回收空间。使用ALTER SYSTEM命令更改快速恢复区域的位置。ALTER SYSTEM命令可用于禁用快速恢复区域。通常，快速恢复区域是自我维护的。但是，当在快速恢复区域中创建文件期间实例崩溃时，数据库可能会将文件保留在快速恢复区域中。某些情况可能会导致存储库与其记录的文件之间出现差异，包括磁带或磁盘故障以及用户管理的副本或RMAN相关文件的删除。要确保恢复目录或控制文件中的备份数据与磁盘上或介质管理目录中的相应数据同步，请执行交叉检查。CROSSCHECK命令仅对当前记录在RMAN存储库中的文件进行操作。交叉检查更新过期的RMAN存储库信息，该信息与存储库记录与其物理状态不匹配的备份有关。例如，如果用户使用操作系统命令从磁盘中删除存档日志，则存储库仍会指示日志位于磁盘上，而实际上并非如此。连接到目标数据库和恢复目录（如果使用）后，根据需要运行CROSSCHECK命令以验证RMAN已知的备份的状态和可用性。您可以使用LIST命令报告备份，然后使用CROSSCHECK命令检查LIST输出中描述的特定备份是否仍然存在。使用CROSSCHECK命令验证RMAN.RMAN已知的预刷新备份和预刷新归档重做日志文件的状态和可用性，提供了多种更改备份和副本的存储库状态的方法。运行CHANGE ...无法找到备份或已异地迁移时的UNAVAILABLE命令。您可以将备份指定为免除保留策略。此技术对于归档备份以满足业务要求非常有用。将CHANGE命令与GUID选项一起使用可更改与从多租户容器数据库（CDB）中删除的可插拔数据库（PDB）对应的备份的状态。使用CHANGE命令可以修改预存储备份和预存储存档重做日志文件的存储库状态。您可以使用CATALOG命令使RMAN知道存储库中未记录的存档日志的存在，或者通过RMAN以外的方式创建的数据库文件的副本。目标数据库控制文件保留目标数据库和所有RMAN备份生成的所有归档重做日志的记录。CATALOG命令的目的是在没有要管理的RMAN文件记录时将元数据添加到存储库。使用CATALOG命令将有关用户管理的副本的信息传播到RMAN存储库。对文件进行编目后，可以运行LIST命令或查询V $ BACKUP_FILES视图以确认信息包含在RMAN存储库中。您可以在磁盘上编目备份片段。如果使用操作系统实用程序将备份片段从一个位置复制到同一主机上的另一个位置，或从一个主机复制到另一个主机，则此技术非常有用。如果使用自动存储管理（ASM），Oracle托管文件框架或快速恢复区域，则可能需要重新编目磁盘管理系统已知但不再列在RMAN存储库中的文件。当用于跟踪文件名的预期机制因介质故障，软件错误或用户错误而失败时，可能会发生这种情况。使用CATALOG命令将preplugin归档重做日志文件添加到RMAN存储库。您可以从RMAN存储库中删除文件的记录。你可以使用CHANGE ...UNCATALOG命令更新缺少文件的RMAN存储库。您可以使用RMAN DELETE命令删除存档的重做日志和RMAN备份。每个RMAN备份在RMAN存储库中生成相应的记录。该记录存储在控制文件中。如果使用了恢复目录，则在从控制文件重新同步恢复目录后，也可以在恢复目录中找到该记录。您可以删除备份的备份和恢复目录记录。建议的维护策略是配置快速恢复区域，备份保留策略和归档重做日志删除策略。使用RMAN DELETE命令删除备份和映像副本。你可以同时使用DELETE和BACKUP ......删除命令以删除特定备份和副本。你可以使用BACKUP ......删除以备份存档的重做日志，数据文件副本或备份集，然后在成功备份后删除输入文件。如果您运行CROSSCHECK，并且RMAN无法找到文件，则它会将RMAN存储库中的记录更新为EXPIRED状态。然后，您可以使用DELETE EXPIRED命令从RMAN存储库中删除过期备份和副本的记录。RMAN DELETE命令支持OBSOLETE选项，该选项删除不再需要的备份以满足指定的可恢复性要求。使用带有GUID选项的DELETE命令可以删除已从多租户容器数据库（CDB）中删除的可插拔数据库（PDB）的备份。使用DELETE命令删除预制备份备份和prelplugin存档重做日志文件。要从操作系统中删除数据库，可以在RMAN中使用DROP DATABASE命令。 RMAN删除服务器参数文件，所有数据文件，联机重做日志和属于目标数据库的控制文件。">维护RMAN备份和存储库记录，</a>以了解如何管理存储在控制文件中的RMAN存储库，而无需恢复目录</p>
                           </li>
                           <li>
                              <p><a href="../rcmrf/rman-compatibility.html#RCMRF005" target="_blank"><span class="italic">Oracle数据库备份和恢复参考中</span></a>的兼容性矩阵，用于描述支持的互操作性方案</p>
                           </li>
                        </ul>
                     </div>
                  </li>
               </ul>
            </div><a id="BRADV89642"></a><div class="props_rev_3"><a id="GUID-2491887B-D9AC-48BE-914D-CB0341A77057" name="GUID-2491887B-D9AC-48BE-914D-CB0341A77057"></a><h3 id="BRADV-GUID-2491887B-D9AC-48BE-914D-CB0341A77057" class="sect3"><span class="enumeration_section">13.1</span> RMAN恢复目录概述</h3>
               <p>本节介绍与管理恢复目录相关的基本概念。</p><a id="BRADV89643"></a><div class="props_rev_3"><a id="GUID-D3E1D038-8698-4ACD-A58D-5260F271116A" name="GUID-D3E1D038-8698-4ACD-A58D-5260F271116A"></a><h4 id="BRADV-GUID-D3E1D038-8698-4ACD-A58D-5260F271116A" class="sect4"><span class="enumeration_section">13.1.1</span> RMAN恢复目录的用途</h4>
                  <div>
                     <p>恢复目录是RMAN用于存储有关一个或多个Oracle数据库的元数据的数据库模式。通常，您将目录存储在专用数据库中。</p>
                     <p>恢复目录提供以下好处：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>恢复目录为存储在每个<a href="glossary.html#GUID-272C4366-303F-4629-9679-1379AAC3FBC1"><span class="xrefglossterm">目标数据库</span></a>的控制文件中的RMAN存储库创建冗余。恢复目录充当辅助元数据存储库。如果目标控制文件和所有备份都丢失，则RMAN元数据仍存在于恢复目录中。
                           </p>
                        </li>
                        <li>
                           <p>恢复目录集中了所有目标数据库的元数据。将元数据存储在一个位置使得报告和管理任务更容易执行。</p>
                        </li>
                        <li>
                           <p>恢复目录可以比控制文件存储元数据历史记录更长的时间。如果必须执行比控制文件中的历史记录更早的恢复，则此功能非常有用。管理恢复目录数据库的额外复杂性可以通过提供扩展备份历史记录的便利性来抵消。</p>
                        </li>
                     </ul>
                     <p>某些RMAN功能仅在您使用恢复目录时起作用。例如，您可以将RMAN脚本存储在恢复目录中。<a href="glossary.html#GUID-6A46F2BF-D1BF-4993-89BC-52A0AEC9370C"><span class="xrefglossterm">存储脚本</span></a>的主要优点是可以连接到目标数据库和恢复目录的任何RMAN客户端都可以使用它。仅当RMAN客户端可以访问存储它们的文件系统时，命令文件才可用。
                     </p>
                     <p>在Data Guard环境中使用RMAN时，需要恢复目录。通过存储所有主数据库和备用数据库的备份元数据，该目录使您可以将备份任务卸载到一个备用数据库，同时使您能够还原环境中其他数据库的备份。</p>
                  </div>
               </div><a id="BRADV89644"></a><div class="props_rev_3"><a id="GUID-D7962D13-1E91-4945-AF2B-9B0CE9A695F5" name="GUID-D7962D13-1E91-4945-AF2B-9B0CE9A695F5"></a><h4 id="BRADV-GUID-D7962D13-1E91-4945-AF2B-9B0CE9A695F5" class="sect4"><span class="enumeration_section">13.1.2</span> RMAN恢复目录的基本概念</h4>
                  <div>
                     <p>恢复目录包含有关每个已注册目标数据库的RMAN操作的元数据。当RMAN连接到恢复目录时，RMAN将仅从目录中获取其元数据。</p>
                     <p>该目录包括以下类型的元数据：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>数据文件和归档重做日志备份集和备份片</p>
                        </li>
                        <li>
                           <p>数据文件副本</p>
                        </li>
                        <li>
                           <p>存档的重做日志及其副本</p>
                        </li>
                        <li>
                           <p>数据库结构（表空间和数据文件）</p>
                        </li>
                        <li>
                           <p>存储的脚本，命名为用户创建的RMAN命令序列</p>
                        </li>
                        <li>
                           <p>持久性RMAN配置设置</p>
                        </li>
                     </ul>
                  </div><a id="BRADV90081"></a><div class="props_rev_3"><a id="GUID-A61B4DA7-1F25-409B-83E4-003FD1073229" name="GUID-A61B4DA7-1F25-409B-83E4-003FD1073229"></a><h5 id="BRADV-GUID-A61B4DA7-1F25-409B-83E4-003FD1073229" class="sect5"><span class="enumeration_section">13.1.2.1</span>关于RMAN恢复目录中的数据库注册</h5>
                     <div>
                        <p>在RMAN使用的恢复目录中注册数据库的过程称为注册。</p>
                        <p>建议的做法是在单个恢复目录中注册环境中的每个<a href="glossary.html#GUID-272C4366-303F-4629-9679-1379AAC3FBC1"><span class="xrefglossterm">目标数据库</span></a> 。例如，你可以注册数据库<code class="codeph">prod1</code> ， <code class="codeph">prod2</code> ，并<code class="codeph">prod3</code>由拥有一个单一的目录<code class="codeph">rco</code>数据库<code class="codeph">catdb</code> 。
                        </p>
                        <div class="infoboxnotealso" id="GUID-A61B4DA7-1F25-409B-83E4-003FD1073229__GUID-F49C7E7D-EA80-4E94-9718-E9382FC9361A">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="managing-recovery-catalog.html#GUID-AD52E63A-F367-46E5-8033-5C56C43BE4DC" title="在恢复目录中注册目标数据库可在恢复目录中维护数据库的记录。">在恢复目录中注册数据库</a></p>
                        </div>
                     </div>
                  </div><a id="BRADV90082"></a><div class="props_rev_3"><a id="GUID-01A0558C-84E1-47C3-96C0-ADC014577D23" name="GUID-01A0558C-84E1-47C3-96C0-ADC014577D23"></a><h5 id="BRADV-GUID-01A0558C-84E1-47C3-96C0-ADC014577D23" class="sect5"><span class="enumeration_section">13.1.2.2</span>关于基本RMAN恢复目录<span class="enumeration_section">中元</span>数据的集中化</h5>
                     <div>
                        <p>集中式恢复目录的所有者（也称为基本恢复目录）可以向其他数据库用户授予或撤消对目录的受限访问。</p>
                        <p>每个受限用户都对其自己的元数据具有完全读/写访问权限，称为<a href="glossary.html#GUID-3ACE1C6A-AEA0-4F3A-973B-2308E0A5AD4B"><span class="xrefglossterm">虚拟专用目录</span></a> 。RMAN元数据存储在虚拟专用目录所有者的模式中。基本恢复目录的所有者确定每个虚拟专用目录用户可以访问的对象。
                        </p>
                        <p>您可以在使用或使用不同版本的Oracle数据库的环境中使用恢复目录。因此，您的环境可以具有不同版本的RMAN客户端，恢复目录数据库，恢复目录模式和目标数据库。 <span class="q">“ <a href="managing-recovery-catalog.html#GUID-12C01FD0-2CFF-478E-B80C-FF7639EF2F4C" title="您可以使用RMAN中的IMPORT CATALOG命令将一个恢复目录模式合并到另一个模式中。">导入和移动恢复目录</a> ”</span>说明了如何将多个恢复目录模式合并为一个。
                        </p>
                        <div class="infoboxnotealso" id="GUID-01A0558C-84E1-47C3-96C0-ADC014577D23__GUID-5893BF12-6FEA-4B43-A999-587D409AD750">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="managing-recovery-catalog.html#GUID-B3238BE0-F52D-4773-A277-D3627AE28D57" title="RMAN提供了多个命令来创建和管理虚拟专用目录。">创建和管理虚拟专用目录</a></p>
                        </div>
                     </div>
                  </div><a id="BRADV90083"></a><div class="props_rev_3"><a id="GUID-8DD30C7C-6157-407C-A398-0905BBBEB348" name="GUID-8DD30C7C-6157-407C-A398-0905BBBEB348"></a><h5 id="BRADV-GUID-8DD30C7C-6157-407C-A398-0905BBBEB348" class="sect5"><span class="enumeration_section">13.1.2.3</span>关于RMAN恢复目录重新同步</h5>
                     <div>
                        <p>对于RMAN操作（如备份，还原和交叉检查），RMAN始终首先更新控制文件，然后将元数据传播到恢复目录。从挂载的控制文件到恢复目录的此元数据流（称为恢复目录重新同步）确保RMAN从控制文件获取的元数据是最新的。</p>
                        <div class="infoboxnotealso" id="GUID-8DD30C7C-6157-407C-A398-0905BBBEB348__GUID-A3763D9D-4936-4D07-9D7D-40692EA8EBCE">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="managing-recovery-catalog.html#GUID-87642B50-AF67-482E-A93D-291B8D2EED92" title="当RMAN执行重新同步时，它会将恢复目录与目标数据库的当前或备份控制文件进行比较，并使用缺少或更改的元数据更新目录。">重新同步恢复目录</a></p>
                        </div>
                     </div>
                  </div><a id="BRADV90084"></a><div class="props_rev_3"><a id="GUID-EAC1C023-2CD7-4397-81C7-3B5EFAA46128" name="GUID-EAC1C023-2CD7-4397-81C7-3B5EFAA46128"></a><h5 id="BRADV-GUID-EAC1C023-2CD7-4397-81C7-3B5EFAA46128" class="sect5"><span class="enumeration_section">13.1.2.4</span>关于存储的脚本</h5>
                     <div>
                        <p>您可以使用存储的脚本替代命令文件来管理常用的RMAN命令序列。该脚本存储在恢复目录中，而不是存储在文件系统中。</p>
                        <p>本地存储的脚本与创建脚本时RMAN连接的目标数据库相关联，并且只能在连接到此目标数据库时执行。可以对恢复目录中注册的任何数据库运行全局存储的脚本。虚拟专用目录用户具有对全局脚本的只读访问权限。必须在连接到基本恢复目录时创建或更新全局脚本。</p>
                        <div class="infoboxnotealso" id="GUID-EAC1C023-2CD7-4397-81C7-3B5EFAA46128__GUID-F94AFF40-46EA-4F7F-A755-CF5D7C28AE2E">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="managing-recovery-catalog.html#GUID-14E5B168-8033-4831-A02A-6003212988D7" title="您可以在恢复目录中创建和存储脚本。">管理存储的脚本</a></p>
                        </div>
                     </div>
                  </div><a id="BRADV89645"></a><div class="props_rev_3"><a id="GUID-B4B6BA38-6462-420E-A06C-6F908D7469A0" name="GUID-B4B6BA38-6462-420E-A06C-6F908D7469A0"></a><h5 id="BRADV-GUID-B4B6BA38-6462-420E-A06C-6F908D7469A0" class="sect5"><span class="enumeration_section">13.1.2.5</span> Data Guard环境中的恢复目录</h5>
                     <div>
                        <p>必须使用恢复目录来管理Data Guard环境中所有物理数据库（主数据库和备用数据库）的RMAN元数据。RMAN使用恢复目录作为Data Guard环境的唯一事实来源。</p>
                        <p>RMAN可以使用恢复目录在<a href="glossary.html#GUID-52C89ABD-D7C1-4FE1-9825-BCBF1973B156"><span class="xrefglossterm">反向重新同步中</span></a>更新主控制文件或备用控制文件。在这种情况下，元数据从目录流向控制文件，而不是相反。RMAN会在需要它们的大多数情况下自动执行重新同步。因此，您不需要使用<code class="codeph">RESYNC</code>命令来经常手动重新同步。
                        </p>
                        <div class="infoboxnotealso" id="GUID-B4B6BA38-6462-420E-A06C-6F908D7469A0__GUID-C76F946E-810A-47C9-8240-75AEBBCCFE4F">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="rman-architecture.html#GUID-B18B15EA-1F59-4858-B6E9-9870A564CD62" title="Data Guard将备用数据库维护为生产数据库的事务一致性副本。备用数据库可以是物理备用数据库，也可以是逻辑备用数据库。">关于Data Guard环境中的RMAN</a></p>
                              </li>
                              <li>
                                 <p><a href="../sbydb/using-RMAN-in-oracle-data-guard-configurations.html#SBYDB04700" target="_blank"><span><cite>Oracle Data Guard概念和管理</cite></span></a> ，了解如何配置RMAN环境以与备用数据库一起使用</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
               </div><a id="BRADV89646"></a><div class="props_rev_3"><a id="GUID-24324A68-4C0E-45D9-9961-CF82B4CA7C63" name="GUID-24324A68-4C0E-45D9-9961-CF82B4CA7C63"></a><h4 id="BRADV-GUID-24324A68-4C0E-45D9-9961-CF82B4CA7C63" class="sect4"><span class="enumeration_section">13.1.3</span>管理恢复目录的基本步骤</h4>
                  <div>
                     <p>管理恢复目录包括创建目录，然后使用目录注册目标数据库。</p>
                     <div class="section">
                        <p>设置RMAN使用的恢复目录的基本步骤如下：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>创建恢复目录。</span><div>
                              <p><span class="q">“ <a href="managing-recovery-catalog.html#GUID-6BEEEF19-C8B6-43CA-B416-C01720070AC8" title="创建恢复目录包含多个阶段，包括配置恢复目录数据库，创建恢复目录模式所有者，然后创建目录。">创建恢复目录</a> ”</span>介绍了如何执行此任务。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>在恢复目录中注册目标数据库。</span><div>
                              <p>此步骤使RMAN能够在恢复目录中存储目标数据库的元数据。 <span class="q">“ <a href="managing-recovery-catalog.html#GUID-AD52E63A-F367-46E5-8033-5C56C43BE4DC" title="在恢复目录中注册目标数据库可在恢复目录中维护数据库的记录。">在恢复目录中注册数据库</a> ”</span>解释了此任务。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>如果需要，请对其记录不再存储在目标控制文件中的任何旧备份进行编目。</span><div>
                              <p><span class="q">“ <a href="managing-recovery-catalog.html#GUID-C2DE2E5D-DCDA-4A85-BA4D-A783180C4F51" title="如果磁盘上有数据文件副本，备份片或归档日志，则可以使用CATALOG命令在恢复目录中对它们进行编目。使用恢复目录时，对已超出控制文件的旧备份进行编录可使RMAN在还原操作期间使用较旧的备份。">在恢复目录中编目备份</a> ”</span>说明了如何执行此任务。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>如果需要，为特定用户创建虚拟专用目录，并确定允许其访问的元数据。</span><div>
                              <p><span class="q">“ <a href="managing-recovery-catalog.html#GUID-B3238BE0-F52D-4773-A277-D3627AE28D57" title="RMAN提供了多个命令来创建和管理虚拟专用目录。">创建和管理虚拟专用目录</a> ”</span>介绍了如何执行此任务。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>通过将恢复目录包含在备份和恢复策略中来保护它。</span><div>
                              <p><span class="q">“ <a href="managing-recovery-catalog.html#GUID-6F052177-3BEE-44DD-9136-0A576EF3F010" title="在备份和恢复策略中包含恢复目录数据库。如果不备份恢复目录并且发生破坏恢复目录数据库的磁盘故障，则可能会丢失目录中的元数据。如果没有恢复目录内容，则恢复其他数据库可能会更加困难。">保护恢复目录</a> ”</span>解释了如何备份和恢复目录，并提高其可用性。
                              </p>
                           </div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-24324A68-4C0E-45D9-9961-CF82B4CA7C63__GUID-1B31A552-3B53-4937-B51A-9A7B53C6DFBF">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="managing-recovery-catalog.html#GUID-14E5B168-8033-4831-A02A-6003212988D7" title="您可以在恢复目录中创建和存储脚本。">管理存储的脚本</a> ”，</span>以获取有关如何在恢复目录中存储RMAN脚本并对其进行管理的信息</p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="reporting-rman-operations.html#GUID-550638CC-0D16-4B1A-83C7-5D10181DC7C1" title="作为备份和恢复策略的一部分，您应定期运行指示已备份内容的报告。您可以确定哪些数据文件需要备份或哪些文件最近未备份。此外，您还可以预览出现问题时RMAN必须还原的备份。RMAN存储执行操作的每个数据库的元数据。在Data Guard环境中，您可以在不使用Data Guard时使用LIST，REPORT和SHOW命令。您可以使用FOR DB_UNIQUE_NAME子句运行这些命令，以显示与指定数据库关联的备份。LIST命令使用RMAN存储库中的信息来提供备份列表以及与备份和恢复相关的其他对象。LIST命令的主要用途是列出备份和副本。使用listObjList或recordSpec子句指定所需的对象。如果未指定对象，则RMAN将显示所有数据库文件和归档重做日志文件的副本。您可以指定几个不同的条件来缩小LIST输出。使用LIST命令列出预包装备份和预刷新存档的重做日志文件。每次在数据库上执行OPEN RESETLOGS操作时，此操作都会创建数据库的新版本。RMAN REPORT命令分析可用备份和数据库。REPORT命令提供各种RMAN备份报告。使用REPORT NEED BACKUP命令确定在特定保留策略下需要备份的数据库文件。您可以使用REPORT NEED BACKUP命令的选项指定不同的保留策略。REPORT NEED BACKUP命令可以检查整个数据库，跳过指定的表空间，或仅根据不同的保留策略检查特定的表空间或数据文件。您可以将REPORT NEED BACKUP命令测试的备份限制为仅基于磁盘或基于磁带的备份。当通过不可恢复的操作（例如直接加载插入）更改数据文件时，不能使用正常的介质恢复来恢复文件，因为不可恢复的操作不会生成重做。在执行此类操作后，您必须对受影响的数据文件执行完全备份或增量备份，以确保可以使用RMAN恢复受不可恢复操作影响的数据块。您可以报告已过时的备份集，备份片和数据文件副本是，不需要通过指定OBSOLETE关键字来满足指定的保留策略。REPORT SCHEMA命令列出并显示有关数据库文件，表空间等的信息。您可以查看与多租户容器数据库（CDB），仅root用户或一个或多个可插拔数据库（PDB）相关的元数据的报告。使用带有GUID选项的LIST命令列出已从多租户容器数据库（CDB）中删除的可插拔数据库（PDB）的备份。在某些情况下，V $视图通过使用LIST和REPORT命令提供不可用的信息。RMAN作业是在RMAN会话中执行的一组命令。因此，一个RMAN作业可以包含多个命令。V $ BACKUP_PIECE和V $ RMAN_BACKUP_PIECE视图的ENCRYPTED列指示备份片段是加密（YES）还是未加密（NO）。LIST，REPORT和SHOW命令提供了访问控制文件和恢复目录中数据的最简单方法。RMAN从目标数据库控制文件中获取备份和恢复元数据，并将其存储在恢复目录的表中。恢复目录视图是从这些表派生的。恢复目录视图未针对用户查询进行规范化或优化。大多数恢复目录视图包含DB_KEY和DBINC_KEY列。可以通过主键（DB_KEY列值）或DBID（32位唯一数据库标识符）唯一标识在恢复目录中注册的每个数据库。数据库的每个版本都由DBINC_KEY列唯一标识。在Data Guard环境中查询恢复目录时，需要考虑特殊注意事项。DB_KEY值是注册数据库的主键，仅在恢复目录中使用。最简单的方法是获取DB_KEY是使用目标数据库的DBID，每当您将RMAN作为TARGET连接到数据库时，都会显示该DBID。您可以查询视图RC_BACKUP_FILES，以获取有关在恢复目录中注册的任何数据库的所有备份的信息。但是，在查询RC_BACKUP_FILES之前，必须调用DBMS_RCVMAN.SETDATABASE过程。">报告RMAN操作</a> ”</span>解释了如何报告RMAN操作</p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="managing-recovery-catalog.html#GUID-5FC1C46A-748D-4DAF-9EF4-62781ACBE319" title="维护恢复目录包括重新同步，更新和升级恢复目录等任务。">维护恢复目录</a> ”</span>描述了正在进行的恢复目录维护的各种任务，包括如何将一个恢复目录导入另一个恢复目录</p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="managing-recovery-catalog.html#GUID-F9345920-0731-40FA-B44A-CE8F50E09B40" title="DROP CATALOG命令删除由CREATE CATALOG命令创建的那些对象。如果拥有恢复目录的用户还拥有不是由CREATE CATALOG创建的对象，则DROP CATALOG命令不会删除这些对象。">删除恢复目录</a> ”</span>有关删除恢复目录</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV179"></a><div class="props_rev_3"><a id="GUID-6BEEEF19-C8B6-43CA-B416-C01720070AC8" name="GUID-6BEEEF19-C8B6-43CA-B416-C01720070AC8"></a><h3 id="BRADV-GUID-6BEEEF19-C8B6-43CA-B416-C01720070AC8" class="sect3"><span class="enumeration_section">13.2</span>创建恢复目录</h3>
               <div>
                  <p>创建恢复目录包含多个阶段，包括配置恢复目录数据库，创建恢复目录模式所有者，然后创建目录。</p>
                  <div class="p">要创建恢复目录：<ol>
                        <li>
                           <p>配置包含恢复目录的数据库，如<span class="q">“ <a href="managing-recovery-catalog.html#GUID-DE7828C6-B6D7-4C26-A293-C75F9A514430" title="使用恢复目录时，RMAN要求您维护恢复目录架构。恢复目录存储在架构的默认表空间中。SYS等特权用户不能是恢复目录的所有者。">配置恢复目录数据库</a> ”中所述</span> 。
                           </p>
                        </li>
                        <li>
                           <p>创建拥有恢复目录的数据库用户，如<span class="q">“ <a href="managing-recovery-catalog.html#GUID-22EDF703-C0F1-4F19-B59B-0F12ECF9DEA2" title="选择恢复目录数据库并创建必要的空间后，即可创建恢复目录的所有者，并为此用户授予必要的权限。">创建恢复目录架构所有者</a> ”中所述</span> 。
                           </p>
                        </li>
                        <li>
                           <p>创建恢复目录，如<span class="q">“ <a href="managing-recovery-catalog.html#GUID-4F005A28-DF81-47C1-A3E3-C3A9E49EB02B" title="创建目录所有者后，使用RMAN CREATE CATALOG命令创建目录表。该命令在目录所有者的默认表空间中创建目录。">执行CREATE CATALOG命令</a> ”中所述</span> 。
                           </p>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV89647"></a><div class="props_rev_3"><a id="GUID-DE7828C6-B6D7-4C26-A293-C75F9A514430" name="GUID-DE7828C6-B6D7-4C26-A293-C75F9A514430"></a><h4 id="BRADV-GUID-DE7828C6-B6D7-4C26-A293-C75F9A514430" class="sect4"><span class="enumeration_section">13.2.1</span>配置恢复目录数据库</h4>
                  <div>
                     <p>使用恢复目录时，RMAN要求您维护恢复目录架构。恢复目录存储在架构的默认表空间中。<code class="codeph">SYS</code>等特权用户不能是恢复目录的所有者。
                     </p>
                     <p>确定将用于安装恢复目录模式的数据库，以及如何备份此数据库。另外，决定是否以<code class="codeph">ARCHIVELOG</code>模式操作目录数据库，这是推荐的。
                     </p>
                     <div class="infoboxnote" id="GUID-DE7828C6-B6D7-4C26-A293-C75F9A514430__GUID-C082B5A5-02F8-4775-8721-8CA434592A19">
                        <p class="notep1">注意：</p>
                        <p>不要将目标数据库备份为恢复目录的数据库。如果目标数据库丢失，则必须保护恢复目录。</p>
                     </div>
                  </div><a id="BRADV89648"></a><div class="props_rev_3"><a id="GUID-FC223E07-1298-42AC-8D07-36D2BB893B10" name="GUID-FC223E07-1298-42AC-8D07-36D2BB893B10"></a><h5 id="BRADV-GUID-FC223E07-1298-42AC-8D07-36D2BB893B10" class="sect5"><span class="enumeration_section">13.2.1.1</span>规划恢复目录模式的大小</h5>
                     <div>
                        <p>您必须分配目录模式使用的空间。恢复目录模式的大小取决于目录监视的数据库数。</p>
                        <p>随着每个数据库的归档重做日志文件和备份数量的增加，模式也会增长。最后，如果使用存储在目录中的RMAN存储脚本，则必须为这些脚本分配一些空间。</p>
                        <p>例如，假设<code class="codeph">trgt</code>数据库有100个文件，并且每天备份一次数据库，生成50个备份集，每个备份集包含1个备份片。如果假设备份表中的每一行使用最大空间量，则每日备份在恢复目录中消耗的内容少于170 KB。因此，如果您每天备份一年，那么此期间的总存储量大约为62兆字节。假设存档日志的数量大致相同。因此，最糟糕的情况是元数据存储一年大约120兆字节。对于更典型的情况，其中仅使用一部分备用件行空间，每年15 MB是切合实际的。
                        </p>
                        <p>如果计划在恢复目录中注册多个数据库，请记住根据先前的计算添加每个数据库所需的空间，以获得恢复目录模式的默认表空间的总大小。</p>
                     </div>
                  </div><a id="BRADV302"></a><a id="BRADV89649"></a><div class="props_rev_3"><a id="GUID-29C0AAA8-4777-4918-A9BF-9C09E76349E5" name="GUID-29C0AAA8-4777-4918-A9BF-9C09E76349E5"></a><h5 id="BRADV-GUID-29C0AAA8-4777-4918-A9BF-9C09E76349E5" class="sect5"><span class="enumeration_section">13.2.1.2</span>为恢复目录数据库分配磁盘空间</h5>
                     <div>
                        <p>如果要在现有数据库中创建恢复目录，请添加足够的空间来保存恢复目录模式的默认表空间。</p>
                        <p>如果要创建新数据库来保存恢复目录，那么除了恢复目录模式本身的空间之外，还需要为恢复目录数据库中的其他文件留出空间：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">SYSTEM</code>和<code class="codeph">SYSAUX</code>表空间</p>
                           </li>
                           <li>
                              <p>临时表空间</p>
                           </li>
                           <li>
                              <p>撤消表空间</p>
                           </li>
                           <li>
                              <p>在线重做日志文件</p>
                           </li>
                        </ul>
                        <p>恢复目录数据库中使用的大部分空间专用于支持表空间，例如， <code class="codeph">SYSTEM</code> ，临时和撤消表空间。<a href="managing-recovery-catalog.html#GUID-29C0AAA8-4777-4918-A9BF-9C09E76349E5__BGBDIJAJ" title="此表描述了一年的典型恢复目录空间要求。">表13-1</a>描述了典型的空间要求。
                        </p>
                        <div class="tblformal" id="GUID-29C0AAA8-4777-4918-A9BF-9C09E76349E5__BGBDIJAJ">
                           <p class="titleintable">表13-1 1年的典型恢复目录空间要求</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="典型的恢复目录空间要求为1年" width="100%" border="1" summary="This table describes typical recovery catalog space requirements for one year." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="35%" id="d63110e1841">空间类型</th>
                                    <th align="left" valign="bottom" width="65%" id="d63110e1844">空间要求</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="35%" id="d63110e1849" headers="d63110e1841 ">
                                       <p><code class="codeph">SYSTEM</code>表空间</p>
                                    </td>
                                    <td align="left" valign="top" width="65%" headers="d63110e1849 d63110e1844 ">
                                       <p>90 MB</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="35%" id="d63110e1858" headers="d63110e1841 ">
                                       <p>临时表空间</p>
                                    </td>
                                    <td align="left" valign="top" width="65%" headers="d63110e1858 d63110e1844 ">
                                       <p>5 MB</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="35%" id="d63110e1865" headers="d63110e1841 ">
                                       <p>回滚或撤消表空间</p>
                                    </td>
                                    <td align="left" valign="top" width="65%" headers="d63110e1865 d63110e1844 ">
                                       <p>5 MB</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="35%" id="d63110e1872" headers="d63110e1841 ">
                                       <p>恢复目录表空间</p>
                                    </td>
                                    <td align="left" valign="top" width="65%" headers="d63110e1872 d63110e1844 ">
                                       <p>恢复目录中注册的每个数据库15 MB</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="35%" id="d63110e1879" headers="d63110e1841 ">
                                       <p>在线重做日志</p>
                                    </td>
                                    <td align="left" valign="top" width="65%" headers="d63110e1879 d63110e1844 ">
                                       <p>每个1 MB（三组，每组有两名成员）</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <div class="infoboxnote" id="GUID-29C0AAA8-4777-4918-A9BF-9C09E76349E5__GUID-10641058-0774-4263-B71C-8E80071FD5EF">
                           <p class="notep1">警告：</p>
                           <p>确保恢复目录和目标数据库<span class="italic">不</span>驻留在同一磁盘上。如果恢复目录和目标数据库都遇到硬盘故障，则恢复过程要困难得多。如果可能，请采取其他措施来消除恢复目录数据库与要备份的数据库之间的常见故障点。
                           </p>
                        </div>
                     </div>
                  </div>
               </div><a id="BRADV303"></a><a id="BRADV89650"></a><div class="props_rev_3"><a id="GUID-22EDF703-C0F1-4F19-B59B-0F12ECF9DEA2" name="GUID-22EDF703-C0F1-4F19-B59B-0F12ECF9DEA2"></a><h4 id="BRADV-GUID-22EDF703-C0F1-4F19-B59B-0F12ECF9DEA2" class="sect4"><span class="enumeration_section">13.2.2</span>创建恢复目录模式所有者</h4>
                  <div>
                     <p>选择恢复目录数据库并创建必要的空间后，即可创建恢复目录的所有者，并为此用户授予必要的权限。</p>
                     <div class="section">
                        <p>请参考以下部分中的说明的以下背景信息：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>恢复目录数据库<code class="codeph">CATDB</code>名为<code class="codeph">TOOLS</code>的表空间存储恢复目录。如果使用RMAN保留字作为表空间名称，则必须将其括在引号中并将其放在大写中。
                              </p>
                           </li>
                           <li>
                              <p>恢复目录数据库中存在名为<code class="codeph">TEMP</code>的表空间。
                              </p>
                           </li>
                        </ul>
                        <p>要在恢复目录数据库中创建恢复目录模式：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动SQL * Plus并使用管理员权限连接到包含恢复目录的数据库。在此示例中，数据库是<code class="codeph">catdb</code> 。</span></li>
                        <li class="stepexpand"><span>为恢复目录创建用户和架构。例如，您可以输入下面的SQL语句（替换为用户定义的密码， <span class="italic">密码</span> ）：</span><div><pre class="pre codeblock"><code>CREATE USER rco IDENTIFIED BY <span class="italic">密码</span> TEMPORARY TABLESPACE temp DEFAULT TABLESPACE工具QUOTA UNLIMITED ON工具;</code></pre><div class="infoboxnote" id="GUID-22EDF703-C0F1-4F19-B59B-0F12ECF9DEA2__GUID-6DD20102-7F10-4FC8-9A9F-1FB891E698CD">
                                 <p class="notep1">注意：</p>
                                 <p>创建安全的密码。</p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>将<code class="codeph">RECOVERY_CATALOG_OWNER</code>角色授予架构所有者。此角色为用户提供维护和查询恢复目录所需的所有权限。</span><div><pre class="pre codeblock"><code>给予rco GRANT RECOVERY_CATALOG_OWNER;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>（可选）通过使用<code class="codeph">–vpd</code>选项运行<code class="codeph">dbmsrmanvpc.sql</code>脚本，为恢复目录启用VPD模型。</span><div>
                              <div class="p">以下命令为用户<code class="codeph">rco</code>拥有的恢复目录启用VPD模型：<pre class="pre codeblock"><code>SQL&gt; @ / <span class="italic">$ ORACLE_HOME</span> /rdbms/admin/dbmsrmanvpc.sql -vpd rco;</code></pre></div>
                           </div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-22EDF703-C0F1-4F19-B59B-0F12ECF9DEA2__GUID-10A4F440-F5E4-474E-8BD3-A4B963DC467F">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="../rcmrf/about-rman-commands.html#RCMRF909" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a> ，以获取RMAN保留字的列表</p>
                              </li>
                              <li>
                                 <p>有关创建安全密码的信息，请参见<a href="../dbseg/configuring-authentication.html#DBSEG33223" target="_blank"><span><cite>“Oracle数据库安</cite></span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV304"></a><a id="BRADV89651"></a><div class="props_rev_3"><a id="GUID-4F005A28-DF81-47C1-A3E3-C3A9E49EB02B" name="GUID-4F005A28-DF81-47C1-A3E3-C3A9E49EB02B"></a><h4 id="BRADV-GUID-4F005A28-DF81-47C1-A3E3-C3A9E49EB02B" class="sect4"><span class="enumeration_section">13.2.3</span>执行CREATE CATALOG命令</h4>
                  <div>
                     <p>创建目录所有者后，使用RMAN <code class="codeph">CREATE</code> <code class="codeph">CATALOG</code>命令创建目录表。该命令在目录所有者的默认表空间中创建目录。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-4F005A28-DF81-47C1-A3E3-C3A9E49EB02B__GUID-6C1666D4-1E41-4426-A8EA-F49613778E73">要创建恢复目录：</p>
                        <div class="infoboxnote" id="GUID-4F005A28-DF81-47C1-A3E3-C3A9E49EB02B__GUID-AE9BBD77-DB05-4D57-96B5-C24A31D61976">
                           <p class="notep1">注意：</p>从Oracle Database 12 <span class="italic">c</span>第1版（12.1.0.2）开始，恢复目录数据库必须使用Oracle数据库企业版。
                        </div>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>为恢复目录数据库启用Oracle分区。</span></li>
                        <li class="stepexpand"><span>启动RMAN并连接到将包含目录的数据库。作为恢复目录所有者连接到数据库。</span></li>
                        <li class="stepexpand"><span>运行<code class="codeph">CREATE</code> <code class="codeph">CATALOG</code>命令以创建目录。目录的创建可能需要几分钟。如果目录表空间是此用户的默认表空间，则可以运行以下命令：</span><div><pre class="pre codeblock"><code>RMAN&gt;创建目录;</code></pre><p>您可以在<code class="codeph">CREATE</code> <code class="codeph">CATALOG</code>命令中指定目录的表空间名称。例如：</p><pre class="pre codeblock"><code>RMAN&gt; CREATE CATALOG TABLESPACE cat_tbs;</code></pre><div class="infoboxnote" id="GUID-4F005A28-DF81-47C1-A3E3-C3A9E49EB02B__GUID-76BC93A2-87D5-4C11-AB0C-90D9538A4C5F">
                                 <p class="notep1">注意：</p>
                                 <p>如果恢复目录的表空间名称是RMAN保留字，则它<span class="italic">必须</span>为大写并用引号括起来。例如：</p><pre class="pre codeblock"><code>创建CATALOG TABLESPACE'目录';</code></pre></div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>您可以使用SQL * Plus查询恢复目录以查看创建的表来检查结果：</span><div><pre class="pre codeblock"><code>SQL&gt; SELECT TABLE_NAME来自USER_TABLES;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-4F005A28-DF81-47C1-A3E3-C3A9E49EB02B__GUID-1F84D759-266E-4FAF-B47C-FA736E1CAA36">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="../sqlrf/GRANT.html#SQLRF01603" target="_blank"><span><cite>Oracle数据库SQL语言参考中的</cite></span></a> <code class="codeph">GRANT</code>命令语法</p>
                              </li>
                              <li>
                                 <p><code class="codeph">CREATE USER</code> <a href="../sqlrf/CREATE-USER.html#SQLRF01503" target="_blank"><span><cite>Oracle数据库SQL语言参考”中的</cite></span></a> <code class="codeph">CREATE USER</code>命令语法</p>
                              </li>
                              <li>
                                 <p>用于<code class="codeph">CREATE CATALOG</code>命令语法的<a href="../rcmrf/CREATE-CATALOG.html#RCMRF117" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV11001"></a><div class="props_rev_3"><a id="GUID-AD52E63A-F367-46E5-8033-5C56C43BE4DC" name="GUID-AD52E63A-F367-46E5-8033-5C56C43BE4DC"></a><h3 id="BRADV-GUID-AD52E63A-F367-46E5-8033-5C56C43BE4DC" class="sect3"><span class="enumeration_section">13.3</span>在恢复目录中注册数据库</h3>
               <p>在恢复目录中注册目标数据库可在恢复目录中维护数据库的记录。</p><a id="BRADV89652"></a><div class="props_rev_3"><a id="GUID-BAEDBF26-396B-4713-AB52-E056ACBDA6AC" name="GUID-BAEDBF26-396B-4713-AB52-E056ACBDA6AC"></a><h4 id="BRADV-GUID-BAEDBF26-396B-4713-AB52-E056ACBDA6AC" class="sect4"><span class="enumeration_section">13.3.1</span>关于在恢复目录中注册数据库</h4>
                  <div>
                     <p>在恢复目录中注册目标数据库的过程称为注册。</p>
                     <p>如果目标数据库未在恢复目录中注册，则RMAN无法使用该目录存储此数据库上的操作的元数据。您仍然可以在未注册的数据库上执行RMAN操作：RMAN始终将其元数据存储在目标数据库的控制文件中。</p>
                     <p>如果<span class="italic">未</span>在Data Guard环境中使用恢复目录，请使用<code class="codeph">REGISTER</code>命令注册每个数据库。每个数据库必须具有唯一的<a href="glossary.html#GUID-2ABBEADC-F98C-4CF9-AD5B-065337E2733B"><span class="xrefglossterm">DBID</span></a> 。如果在SQL中使用RMAN <code class="codeph">DUPLICATE</code>命令或<code class="codeph">CREATE DATABASE</code>语句，则会自动为数据库分配唯一的DBID。如果通过其他方式创建数据库，则复制的数据库可能与其源数据库具有相同的DBID。您可以使用<code class="codeph">DBNEWID</code>实用程序更改DBID，以便可以在同一目录中注册源和副本数据库。
                     </p>
                     <p>您可以使用<code class="codeph">UNREGISTER</code>命令从恢复目录中取消注册数据库。
                     </p>
                  </div><a id="BRADV89653"></a><div class="props_rev_3"><a id="GUID-73A6A122-D90C-4E5C-8F51-2CE859B8F139" name="GUID-73A6A122-D90C-4E5C-8F51-2CE859B8F139"></a><h5 id="BRADV-GUID-73A6A122-D90C-4E5C-8F51-2CE859B8F139" class="sect5"><span class="enumeration_section">13.3.1.1</span>关于备用数据库注册</h5>
                     <div>
                        <p>在Data Guard环境中，主数据库和备用数据库共享相同的DBID和数据库名称。要符合在恢复目录中注册的条件，Data Guard环境中的每个数据库都必须具有不同的<code class="codeph">DB_UNIQUE_NAME</code>值。
                        </p>
                        <p>数据库的<code class="codeph">DB_UNIQUE_NAME</code>参数在其初始化参数文件中设置。如果在Data Guard环境中使用RMAN，则只能对主数据库使用<code class="codeph">REGISTER DATABASE</code>命令。
                        </p>
                        <p>您可以使用以下技术在恢复目录中注册备用数据库：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>当您以<code class="codeph">TARGET</code>身份连接到备用数据库时，RMAN会自动在恢复目录中注册该数据库。
                              </p>
                           </li>
                           <li>
                              <p>对恢复目录不知道的备用数据库运行<code class="codeph">CONFIGURE DB_UNIQUE_NAME</code>命令时，如果已注册主数据库，RMAN会自动注册此备用数据库。
                              </p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-73A6A122-D90C-4E5C-8F51-2CE859B8F139__GUID-440AF72A-8D22-4F92-819A-04094E27C2C4">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="managing-recovery-catalog.html#GUID-8E35106D-950D-409B-98CA-91E142212D6A" title="您可以使用UNREGISTER DATABASE命令从恢复目录中注销数据库。">从恢复目录中取消注册目标数据库</a></p>
                              </li>
                              <li>
                                 <p>适用于<code class="codeph">DUPLICATE</code>命令语法的<a href="../rcmrf/DUPLICATE.html#RCMRF126" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                              </li>
                              <li>
                                 <p><a href="../sutil/oracle-dbnewid-utility.html#SUTIL014" target="_blank"><span><cite>Oracle数据库实用程序</cite></span></a> ，了解如何使用<code class="codeph">DBNEWID</code>实用程序更改DBID</p>
                              </li>
                              <li>
                                 <p><a href="../sbydb/using-RMAN-in-oracle-data-guard-configurations.html#SBYDB04700" target="_blank"><span><cite>Oracle Data Guard概念和管理</cite></span></a> ，了解如何在Data Guard环境中使用RMAN</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div>
               </div><a id="BRADV89654"></a><div class="props_rev_3"><a id="GUID-1EC61518-B539-4FB0-9005-18ACED2F679A" name="GUID-1EC61518-B539-4FB0-9005-18ACED2F679A"></a><h4 id="BRADV-GUID-1EC61518-B539-4FB0-9005-18ACED2F679A" class="sect4"><span class="enumeration_section">13.3.2</span>使用REGISTER DATABASE命令注册数据库</h4>
                  <div>
                     <p>将恢复目录与目标数据库一起使用的第一步是在恢复目录中注册目标数据库。如果在Data Guard环境中使用目录，则只能以这种方式注册主数据库。</p>
                     <div class="section">
                        <p>使用以下过程：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录。必须打开恢复目录数据库。</span><div>
                              <p>例如，发出以下命令以使用网络服务名称<code class="codeph">catdb</code>作为用户<code class="codeph">rco</code> （谁拥有目录模式）连接到目录数据库：</p><pre class="pre codeblock"><code>％rman TARGET / CATALOG rco @ catdb;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>如果未安装目标数据库，则安装或打开它：</span><div><pre class="pre codeblock"><code>启动安装;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>在连接的恢复目录中注册目标数据库：</span><div><pre class="pre codeblock"><code>注册数据库;</code></pre><p>RMAN在目录表中创建行以包含有关目标数据库的信息，然后将有关目标数据库的所有相关数据从控制文件复制到目录中，从而将目录与控制文件同步。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>通过运行<code class="codeph">REPORT</code> <code class="codeph">SCHEMA</code>验证注册是否成功：</span><div><pre class="pre codeblock"><code>报告计划;使用db_unique_name报告数据库的数据库模式TRGT永久数据文件列表===========================文件大小（MB）表空间RB segs数据文件名---- ---------- ---------------- ------- ------------- ------ 1 307200 SYSTEM NO /oracle/oradata/trgt/system01.dbf 2 20480 UNDOTBS YES /oracle/oradata/trgt/undotbs01.dbf 3 10240 CWMLITE NO /oracle/oradata/trgt/cwmlite01.dbf 4 10240 DRSYS NO /oracle/oradata/trgt/drsys01.dbf 5 10240示例NO /oracle/oradata/trgt/example01.dbf 6 10240 INDX NO /oracle/oradata/trgt/indx01.dbf 7 10240 TOOLS NO / oracle / oradata / trgt /tools01.dbf 8 10240 USERS NO /oracle/oradata/trgt/users01.dbf临时文件列表=======================文件大小（MB）表空间Maxsize（MB）Tempfile Name ---- -------- -------------------- ----------- -------------------- 1 200 TEMP 32767 /oracle/oradata/trgt/tbs_tmp.dbf</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div>
            </div><a id="BRADV89655"></a><div class="props_rev_3"><a id="GUID-C2DE2E5D-DCDA-4A85-BA4D-A783180C4F51" name="GUID-C2DE2E5D-DCDA-4A85-BA4D-A783180C4F51"></a><h3 id="BRADV-GUID-C2DE2E5D-DCDA-4A85-BA4D-A783180C4F51" class="sect3"><span class="enumeration_section">13.4</span>在恢复目录中编目备份</h3>
               <div>
                  <p>如果磁盘上有数据文件副本，备份片或归档日志，则可以使用<code class="codeph">CATALOG</code>命令在恢复目录中对它们进行编目。使用恢复目录时，对已超出控制文件的旧备份进行编录可使RMAN在还原操作期间使用较旧的备份。
                  </p>
                  <div class="section">
                     <p>以下命令说明了这种技术：</p><pre class="pre codeblock"><code>CATALOG DATAFILECOPY'/disk1/old_datafiles/01_01_2003/users01.dbf'; CATALOG ARCHIVELOG'/disk1/arch_logs/archive1_731.dbf'，'/ disk1 / arch_logs / archive1_732.dbf'; CATALOG BACKUPPIECE'/disk1/backups/backup_820.bkp';</code></pre><p>您还可以使用<code class="codeph">CATALOG START WITH</code>命令在目录中编目多个备份文件，如以下示例所示：</p><pre class="pre codeblock"><code>CATALOG START WITH'/ disk1 / backups /';</code></pre><p>RMAN列出要添加到RMAN存储库的文件，并在添加备份之前提示确认。使用<code class="codeph">CATALOG START WITH</code>创建前缀时要小心。 RMAN扫描磁盘上以指定前缀开头的所有文件的所有路径。前缀不仅仅是目录名称。使用错误的前缀可能会导致错误的文件集编目。
                     </p>
                     <p>例如，假设一组目录<code>/disk1/backups</code> ， <code>/disk1/backups-year2003</code> ， <code>/disk1/backupsets</code> ， <code>/disk1/backupsets/test</code>等都包含备份文件。以下命令对所有这些目录中的所有文件进行编目，因为<code>/disk1/backups</code>是所有这些目录的路径的前缀：</p><pre class="pre codeblock"><code>CATALOG START WITH'/ disk1 / backups';</code></pre><p>要仅编目<code class="codeph">/disk1/backups</code>目录中的<code class="codeph">/disk1/backups</code> ，正确的命令如下：</p><pre class="pre codeblock"><code>CATALOG START WITH'/ disk1 / backups /';</code></pre><div class="infoboxnotealso" id="GUID-C2DE2E5D-DCDA-4A85-BA4D-A783180C4F51__GUID-89F35FE2-EEC2-4418-A2F0-708E280C720A">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>用于<code class="codeph">REGISTER</code>语法的<a href="../rcmrf/REGISTER-DATABASE.html#RCMRF141" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                           </li>
                           <li>
                              <p>有关数据库迁移的问题的<a href="../upgrd/troubleshooting-oracle-database-upgrade.html#UPGRD12409" target="_blank"><span><cite>Oracle数据库升级指南</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="BRADV89656"></a><div class="props_rev_3"><a id="GUID-B3238BE0-F52D-4773-A277-D3627AE28D57" name="GUID-B3238BE0-F52D-4773-A277-D3627AE28D57"></a><h3 id="BRADV-GUID-B3238BE0-F52D-4773-A277-D3627AE28D57" class="sect3"><span class="enumeration_section">13.5</span>创建和管理虚拟专用目录</h3>
               <p>RMAN提供了多个命令来创建和管理虚拟专用目录。</p><a id="BRADV89657"></a><div class="props_rev_3"><a id="GUID-3C479673-B351-4801-8EED-A1AC3EA6F6BA" name="GUID-3C479673-B351-4801-8EED-A1AC3EA6F6BA"></a><h4 id="BRADV-GUID-3C479673-B351-4801-8EED-A1AC3EA6F6BA" class="sect4"><span class="enumeration_section">13.5.1</span>虚拟专用目录概述</h4>
                  <div>
                     <p>默认情况下，RMAN恢复目录的所有用户都具有读取，选择，插入，更新和删除目录中任何元数据的完全权限。例如，如果两个不相关的数据库的管理员共享同一个恢复目录，则每个管理员都可以（无论是无意还是恶意）破坏另一个数据库的目录数据。在许多企业中，这种情况是可以容忍的，因为同一个人管理许多不同的数据库并管理恢复目录。但是在其他企业中，各种数据库的管理员之间以及DBA和恢复目录的管理员之间存在明确的职责分离，您可能希望限制每个数据库管理员仅修改属于他们负责的那些数据库的备份元数据。 ，同时仍然保留单一，集中管理的RMAN恢复目录的好处。可以通过实现<a href="glossary.html#GUID-3ACE1C6A-AEA0-4F3A-973B-2308E0A5AD4B"><span class="xrefglossterm">虚拟专用目录</span></a>来实现此目标。
                     </p>
                     <p>每个RMAN恢复目录开始，Oracle数据库<span class="italic">11克</span>支持虚拟专用目录，但它们不使用，除非明确创建。可以在一个恢复目录下创建的虚拟专用目录的数量没有限制。每个虚拟专用目录由数据库模式用户拥有，该用户与拥有恢复目录的用户不同。
                     </p>
                     <p>设置虚拟专用目录用户后，恢复目录的管理员授予每个虚拟专用目录特权，以便将该目录用于当前在恢复目录中注册的一个或多个数据库。恢复目录的管理员还可以授予在使用虚拟专用目录时注册新数据库的权限。</p>
                     <div class="infoboxnote" id="GUID-3C479673-B351-4801-8EED-A1AC3EA6F6BA__GUID-669EBCEC-18D1-4908-8DDC-9C26EC568132">
                        <p class="notep1">注意：</p>
                        <p>每个虚拟专用目录都可以访问所有全局存储的脚本，以及属于此虚拟专用目录具有特权的那些数据库的非全局存储脚本。虚拟专用目录无法访问属于他们没有权限的数据库的非全局存储脚本，并且无法创建全局存储脚本。</p>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-DA362C55-5B94-4AB8-A8A1-163BF08FE594" name="GUID-DA362C55-5B94-4AB8-A8A1-163BF08FE594"></a><h4 id="BRADV-GUID-DA362C55-5B94-4AB8-A8A1-163BF08FE594" class="sect4"><span class="enumeration_section">13.5.2</span>关于将VPD模型用于虚拟专用目录</h4>
                  <div>
                     <p>RMAN使用虚拟专用数据库（VPD）功能来实现虚拟专用目录。</p>
                     <p>创建RMAN基本恢复目录时，默认情况下不启用VPD功能。您需要在升级基本目录模式后运行<code>$</code> <span class="italic"><code>ORACLE_HOME</code></span> <code>/rdbms/admin/dbmsrmanvpc.sql</code>脚本，为基本恢复目录显式启用VPD模型。
                     </p>
                     <div class="p"><code class="codeph">dbmsrmanvpc.sql</code>脚本的格式如下：<pre class="pre codeblock"><code>$ <span class="italic">ORACLE_HOME</span> /rdbms/admin/dbmsrmanvpc.sql [[-vpd | -novpd | <span class="italic">-scan</span> ] <span class="italic">base_catalog_schema_name</span> [...]] | -所有</code></pre></div>
                     <p>运行<code class="codeph">dbmsrmanvpc.sql</code>时，RMAN基本目录模式名称作为命令行参数提供。每次运行脚本时，最多可以指定十个基本目录模式名称。
                     </p>
                     <p><a href="managing-recovery-catalog.html#GUID-DA362C55-5B94-4AB8-A8A1-163BF08FE594__GUID-4D232E2A-DFCE-46E7-8070-7DE63A349E78" title="此表描述dbmsrmanvpc.sql脚本的选项。">表13-2说明</a>了运行<code class="codeph">dbmsrmanvpc.sql</code>脚本时可以使用的选项。您必须使用其中一个命令行选项或提供目录模式名称。
                     </p>
                     <div class="tblformal" id="GUID-DA362C55-5B94-4AB8-A8A1-163BF08FE594__GUID-4D232E2A-DFCE-46E7-8070-7DE63A349E78">
                        <p class="titleintable">表13-2 dbmsrmanvpc.sql选项</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="dbmsrmanvpc.sql选项" border="1" summary="This table describes the options of the dbmsrmanvpc.sql script." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="20%" id="d63110e3117">dbmsrmanvpc.sql选项名称</th>
                                 <th align="left" valign="bottom" width="20%" id="d63110e3119">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d63110e3123" headers="d63110e3117 ">
                                    <p><code class="codeph">-vpd</code></p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d63110e3123 d63110e3119 ">
                                    <p>授予支持受VPD保护的目录所需的权限。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d63110e3131" headers="d63110e3117 ">
                                    <p><code class="codeph">-novpd</code></p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d63110e3131 d63110e3119 ">
                                    <p>通过清除基本恢复目录模式，撤消授权和删除数据库对象来禁用VPD功能。</p>
                                    <p>仅当基本恢复目录中未注册现有VPC用户时，才能使用此选项。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d63110e3141" headers="d63110e3117 ">
                                    <p><code class="codeph">-scan</code></p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d63110e3141 d63110e3119 ">
                                    <p>执行RMAN基本目录所有者模式的扫描，并报告已授予的角色和VPC用户的状态。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d63110e3149" headers="d63110e3117 ">
                                    <p><code class="codeph">-所有</code></p>
                                 </td>
                                 <td align="left" valign="top" width="20%" headers="d63110e3149 d63110e3119 ">
                                    <p>自动检测RMAN基本目录模式和升级。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="example" id="GUID-DA362C55-5B94-4AB8-A8A1-163BF08FE594__GUID-43CF6ED1-3778-4C59-982C-C5805F946A0D">
                        <p class="titleinexample">例13-1为VPC用户模式启用VPD模型</p>
                        <p>连接到SQL * Plus并使用以下命令为RMAN基本目录<code class="codeph">rman_cat</code>所有虚拟专用目录启用VPD模型。
                        </p><pre class="pre codeblock"><code>SQL&gt; @ <span class="italic">$ ORACLE_HOME</span> /rdbms/admin/dbmsrmanvpc.sql -vpd rman_cat</code></pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-A7502D0D-5840-4B13-869D-7259F2D73119" name="GUID-A7502D0D-5840-4B13-869D-7259F2D73119"></a><h4 id="BRADV-GUID-A7502D0D-5840-4B13-869D-7259F2D73119" class="sect4"><span class="enumeration_section">13.5.3</span>创建虚拟专用目录</h4>
                  <div>
                     <p>创建虚拟专用目录是一个多步骤过程，您首先要创建将拥有虚拟专用目录的数据库用户，然后创建虚拟专用目录。</p>
                     <div class="section">
                        <div class="infoboxnote" id="GUID-A7502D0D-5840-4B13-869D-7259F2D73119__GUID-0152186B-2022-4B43-8600-F00A155BCBE5">
                           <p class="notep1">注意：</p>
                           <p>如果恢复目录是虚拟专用目录，则连接到它的RMAN客户端必须处于修补程序级别10.1.0.6或10.2.0.3。Oracle9 <span class="italic">i</span> RMAN客户端无法连接到虚拟专用目录。此版本限制不会影响RMAN客户端与Oracle Database 11 <span class="italic">g</span>基本恢复目录的连接，即使它具有某些虚拟专用目录用户也是如此。
                           </p>
                        </div>
                        <p>假定以下数据库被登记在基地恢复目录： <code class="codeph">prod1</code> ， <code class="codeph">prod2</code> ，和<code class="codeph">prod3</code> 。拥有基本恢复目录的数据库用户是<code class="codeph">rco</code> 。要创建数据库用户<code class="codeph">vpc1</code> ，并授予该用户访问权限只<code class="codeph">prod1</code>和<code class="codeph">prod2</code> 。默认情况下，虚拟专用目录所有者无权访问基本恢复目录。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="p">
                        <p>必须在创建虚拟专用目录之前创建基本RMAN恢复目录。</p>
                        <p><span class="bold">要创建虚拟专用目录：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动SQL * Plus并使用管理员权限连接到恢复目录数据库。</span></li>
                        <li class="stepexpand"><span>创建将拥有虚拟专用目录的用户。</span><div>
                              <p>例如，如果你想数据库用户<code class="codeph">vpc1</code>拥有虚拟专用目录，然后执行以下命令（通过用户定义的密码更换<span class="italic">密码</span> ）：</p><pre class="pre codeblock"><code>SQL&gt; CREATE USER vpc1 IDENTIFIED BY <span class="italic">password</span> 2 DEFAULT TABLESPACE vpcusers 3 QUOTA UNLIMITED on vpcusers;</code></pre><div class="infoboxnote" id="GUID-A7502D0D-5840-4B13-869D-7259F2D73119__GUID-839292B1-640D-42D6-894B-15D2D1508E5D">
                                 <p class="notep1">注意：</p>
                                 <p>创建安全的密码。有关更多信息，请参见<a href="../dbseg/configuring-authentication.html#DBSEG33223" target="_blank"><span><cite>Oracle数据库安全指南</cite></span></a>
                                 </p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>将<code class="codeph">CREATE SESSION</code>权限授予拥有虚拟专用目录的用户，然后退出SQL * Plus。</span><div>
                              <p>以下示例将权限授予用户<code class="codeph">vpc1</code> ：</p><pre class="pre codeblock"><code>SQL&gt; GRANT创建会话到vpc1; SQL&gt; EXIT;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>启动RMAN并作为基本恢复目录所有者（ <span class="italic">而不是</span>虚拟专用目录所有者）连接到恢复目录数据库。</span><div>
                              <p>以下示例以<code class="codeph">rco</code>连接到基本恢复目录：</p><pre class="pre codeblock"><code>％rman RMAN&gt; CONNECT CATALOG rco @ catdb;恢复目录数据库密码：连接到恢复目录数据库的<span class="italic">密码</span></code></pre></div>
                        </li>
                        <li class="stepexpand"><span>为虚拟专用目录所有者授予所需的权限。</span><div>
                              <p>下面的例子给出了用户<code class="codeph">vpc1</code>为元数据访问<code class="codeph">prod1</code>和<code class="codeph">prod2</code> （但不是<code class="codeph">prod3</code> ）：</p><pre class="pre codeblock"><code>RMAN&gt; GRAT CATALOG FOR DATABASE prod1 to vpc1; RMAN&gt; GRAT CATALOG FOR DATABASE prod2 to vpc1;</code></pre><p>您还可以使用DBID而不是数据库名称。虚拟专用目录用户无权访问恢复目录中注册的任何其他数据库的元数据。</p>
                              <p></p>
                              <p>以下示例为用户<code class="codeph">vpc1</code>提供了对PDB <code class="codeph">hr_pdb</code>的元数据的访问权限：</p><pre class="pre codeblock"><code>用于可插入数据库的授权目录hr_pdb至vpc1;</code></pre><p>您还可以授予用户在恢复目录中注册新目标数据库的能力。例如：</p><pre class="pre codeblock"><code>RMAN&gt; GRANT寄存器数据库到vpc1;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-A7502D0D-5840-4B13-869D-7259F2D73119__GUID-4D04CBB9-FB61-41F8-AB6A-B4C36B88BEF3">
                           <p class="notep1">也可以看看：</p>
                           <p>有关RMAN版本兼容性的详细信息，请<a href="../rcmrf/rman-compatibility.html#RCMRF908" target="_blank"><span><cite>参见Oracle Database Backup and Recovery Reference</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-02705BC0-92FA-4616-B6B0-1E71E86010E4" name="GUID-02705BC0-92FA-4616-B6B0-1E71E86010E4"></a><h4 id="BRADV-GUID-02705BC0-92FA-4616-B6B0-1E71E86010E4" class="sect4"><span class="enumeration_section">13.5.4</span>使用虚拟专用目录注册数据库</h4>
                  <div>
                     <p>要在虚拟专用目录中存储目标数据库的备份元数据，必须使用虚拟专用目录注册数据库。</p>
                     <div class="p">
                        <p>在使用它注册目标数据库之前创建虚拟专用目录。</p>
                        <p><span class="bold">要使用虚拟专用目录注册数据库并存储备份元数据：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并以虚拟专用目录所有者（ <span class="italic">而不是</span>基本恢复目录所有者）身份连接到恢复目录数据库。连接到要注册为<code class="codeph">TARGET</code>的数据库。</span><div><pre class="pre codeblock"><code>％rman RMAN&gt; CONNECT TARGET / RMAN&gt; CONNECT CATALOG vpc1 @ catdb;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>注册其元数据必须存储在虚拟专用目录中的数据库。</span><div>
                              <p>以下示例使用虚拟专用目录所有者<code class="codeph">vpc1</code>注册数据库。
                              </p><pre class="pre codeblock"><code>RMAN&gt;注册数据库;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>使用带有required子句的<code class="codeph">BACKUP</code>命令<code class="codeph">BACKUP</code>数据库。</span><div>
                              <p>与备份相关的元数据存储在虚拟专用目录中。</p>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV307"></a><a id="BRADV89660"></a><div class="props_rev_3"><a id="GUID-3910031C-2CEE-4A19-B96B-9281C57D2B5B" name="GUID-3910031C-2CEE-4A19-B96B-9281C57D2B5B"></a><h4 id="BRADV-GUID-3910031C-2CEE-4A19-B96B-9281C57D2B5B" class="sect4"><span class="enumeration_section">13.5.5</span>撤消虚拟专用目录所有者的权限</h4>
                  <div>
                     <p>创建虚拟专用目录后，可以根据需要撤消目录访问权限。</p>
                     <div class="section">
                        <p>假设两个数据库登记在基地恢复目录： <code class="codeph">prod1</code>和<code class="codeph">prod2</code> 。作为基恢复目录的所有者，您已授予<code class="codeph">vpc1</code>用户访问权限<code class="codeph">prod1</code> 。您还授予此用户在其虚拟专用目录中注册数据库的权限。现在要撤消<code class="codeph">vpc1</code>权限。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-3910031C-2CEE-4A19-B96B-9281C57D2B5B__GUID-7D72F6A7-DE67-452B-80BB-E2498080DC78">要撤消虚拟专用目录所有者的权限：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并以恢复目录所有者（ <span class="italic">而非</span>虚拟专用目录所有者）身份连接到恢复目录数据库。</span><div>
                              <p>以下示例以<code class="codeph">rco</code>连接到恢复目录：</p><pre class="pre codeblock"><code>％rman RMAN&gt; CONNECT CATALOG rco @ catdb;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>撤消虚拟专用目录所有者的指定权限。</span><div>
                              <p>以下命令撤销访问的元数据<code class="codeph">prod1</code>从虚拟专用目录所有者<code class="codeph">vpc1</code> ：</p><pre class="pre codeblock"><code>REVOKE CATALOG for DATABASE prod1 FROM vpc1;</code></pre><p>您还可以指定DBID而不是数据库名称。目录<code class="codeph">vpc1</code>保留所有其他已授予的目录权限。
                              </p>
                              <p></p>
                              <p>以下命令撤消从虚拟专用目录所有者<code class="codeph">vpc1</code>访问PDB <code class="codeph">hr_pdb</code>的元数据：</p><pre class="pre codeblock"><code>REVOKE CATALOG for PLUGGABLE DATABASE hr_pdb FROM vpc1;</code></pre><p>您还可以撤消在恢复目录中注册新目标数据库的权限。例如：</p><pre class="pre codeblock"><code>从vpc1撤消寄存器数据库;</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-21CEAA23-327A-4D24-9D88-BBB07F0D4645" name="GUID-21CEAA23-327A-4D24-9D88-BBB07F0D4645"></a><h4 id="BRADV-GUID-21CEAA23-327A-4D24-9D88-BBB07F0D4645" class="sect4"><span class="enumeration_section">13.5.6</span>升级虚拟专用目录</h4>
                  <div>
                     <p>本节介绍如何使用<code class="codeph">UPGRADE CATALOG</code>命令升级虚拟专用目录。
                     </p>
                     <div class="section">
                        <p>RMAN使用虚拟专用数据库（VPD）功能来实现虚拟专用目录。如果使用低于Oracle Database 12 <span class="italic">c</span>第1版（12.1.0.2）的版本创建了恢复目录和虚拟专用目录，或者如果数据库未升级到Oracle Database 12 <span class="italic">c</span>第2版（12.2）或更高版本，则必须升级这些虚拟专用目录。RMAN提供位于<span class="italic"><code class="codeph">$ORACLE_HOME</code></span> <code class="codeph">/rdbms/admin</code>目录中的脚本，用于升级虚拟专用目录。
                        </p>
                        <p><span class="bold">要升级虚拟专用目录：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>使用SQL * Plus以具有<code class="codeph">SYSDBA</code>权限的<code class="codeph">SYS</code>用户身份连接到恢复目录数据库。</span></li>
                        <li class="stepexpand"><span>运行<code class="codeph">dbmsrmansys.sql</code>脚本以授予<code class="codeph">RECOVERY_CATALOG_OWNER</code>角色所需的其他权限。</span><div><pre class="pre codeblock"><code>SQL&gt; @ <span class="italic">$ ORACLE_HOME</span> /rdbms/admin/dbmsrmansys.sql</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>运行<code class="codeph">dbmsmanvpc.sql</code>脚本以将虚拟专用目录模式升级到VPD模型。</span><div>
                              <p>必须提供基本恢复目录模式名称作为此脚本的输入参数。您最多可以指定10个架构名称。或者，您可以使用<code class="codeph">-all</code>选项自动检测基本目录模式并升级所有关联的虚拟专用目录模式。
                              </p>
                              <p>以下命令升级<code class="codeph">rco</code>拥有的基本恢复目录的虚拟专用目录模式：</p><pre class="pre codeblock"><code>SQL&gt; @ <span class="italic">$ ORACLE_HOME</span> /rdbms/admin/dbmsrmanvpc.sql -vpd rco</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>将RMAN连接到基本恢复目录，升级基本恢复目录，然后退出RMAN。</span><div>
                              <p>假设拥有基本恢复目录的数据库用户是<code class="codeph">rco</code> 。以下命令将升级基本恢复目录。必须输入<code class="codeph">UPGRADE CATALOG</code>命令两次才能确认升级。
                              </p><pre class="pre codeblock"><code>$ rman CATALOG rco @ catdb恢复目录数据库密码：RMAN&gt; UPGRADE CATALOG; RMAN&gt; UPGRADE CATALOG; RMAN&gt;退出;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-21CEAA23-327A-4D24-9D88-BBB07F0D4645__GUID-ACF01851-FCFA-4B48-AE20-8CBDFEFEEFFB">
                           <p class="notep1">也可以看看：</p>
                           <p><span class="q">“ <a href="managing-recovery-catalog.html#GUID-DA362C55-5B94-4AB8-A8A1-163BF08FE594" title="RMAN使用虚拟专用数据库（VPD）功能来实现虚拟专用目录。">关于将虚拟专用目录的VPD模型用于</a> ”</span>有关<code class="codeph">dbmsrmanvpc.sql</code>脚本及其选项的信息</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV89662"></a><div class="props_rev_3"><a id="GUID-6F052177-3BEE-44DD-9136-0A576EF3F010" name="GUID-6F052177-3BEE-44DD-9136-0A576EF3F010"></a><h3 id="BRADV-GUID-6F052177-3BEE-44DD-9136-0A576EF3F010" class="sect3"><span class="enumeration_section">13.6</span>保护恢复目录</h3>
               <p>在备份和恢复策略中包含恢复目录数据库。如果不备份恢复目录并且发生破坏恢复目录数据库的磁盘故障，则可能会丢失目录中的元数据。如果没有恢复目录内容，则恢复其他数据库可能会更加困难。</p><a id="BRADV89663"></a><div class="props_rev_3"><a id="GUID-9EC1D7D7-6ECF-44B2-A8C7-869B97B81B29" name="GUID-9EC1D7D7-6ECF-44B2-A8C7-869B97B81B29"></a><h4 id="BRADV-GUID-9EC1D7D7-6ECF-44B2-A8C7-869B97B81B29" class="sect4"><span class="enumeration_section">13.6.1</span>备份恢复目录</h4>
                  <div>
                     <p>单个恢复目录可以存储多个目标数据库的元数据。因此，恢复目录的丢失可能是灾难性的。您必须经常备份恢复目录。</p>
                     <p>本节提供了制定保护恢复目录的策略的一般准则。</p>
                  </div><a id="BRADV89664"></a><div class="props_rev_3"><a id="GUID-D2B27859-AE2D-44A5-A3DA-BF486026B3DE" name="GUID-D2B27859-AE2D-44A5-A3DA-BF486026B3DE"></a><h5 id="BRADV-GUID-D2B27859-AE2D-44A5-A3DA-BF486026B3DE" class="sect5"><span class="enumeration_section">13.6.1.1</span>经常备份恢复目录</h5>
                     <div>
                        <p>恢复目录数据库与任何其他数据库一样，也是备份和恢复策略的关键部分。通过备份来保护恢复目录，就像数据库的任何其他部分一样。恢复目录数据库的备份策略是整体备份和恢复策略的一部分。</p>
                        <p>使用与备份目标数据库相同的频率备份恢复目录。例如，如果您对目标数据库进行每周完整数据库备份，则在备份目标数据库之后备份恢复目录。此备份恢复目录可以帮助您进行灾难恢复方案。即使必须使用控制文件自动备份还原恢复目录数据库，也可以使用还原的恢复目录数据库中的完整备份记录来还原目标数据库。</p>
                     </div>
                  </div><a id="BRADV309"></a><a id="BRADV89665"></a><div class="props_rev_3"><a id="GUID-1E7762AD-7F83-4571-8280-F4B1BEB5415E" name="GUID-1E7762AD-7F83-4571-8280-F4B1BEB5415E"></a><h5 id="BRADV-GUID-1E7762AD-7F83-4571-8280-F4B1BEB5415E" class="sect5"><span class="enumeration_section">13.6.1.2</span>选择适当的物理备份技术</h5>
                     <div>
                        <p>备份恢复目录数据库时，可以使用RMAN进行备份。</p>
                        <p><a href="managing-recovery-catalog.html#GUID-1E7762AD-7F83-4571-8280-F4B1BEB5415E__I1013751">如图13-1所示</a> ，使用<code class="codeph">NOCATALOG</code>选项启动RMAN，以便RMAN的存储库是目录数据库中的控制文件。
                        </p>
                        <div class="figure" id="GUID-1E7762AD-7F83-4571-8280-F4B1BEB5415E__I1013751">
                           <p class="titleinfigure">图13-1使用控制文件作为恢复目录备份的存储库</p><img src="img/bradv009.gif" alt="下面是图13-1的描述" title="下面是图13-1的描述" longdesc="img_text/bradv009.html"><br><a href="img_text/bradv009.html">“图13-1使用控制文件作为恢复目录备份的存储库”的说明</a></div>
                        <!-- class="figure" -->
                        <p>在为恢复目录数据库开发RMAN备份策略时，请遵循以下准则：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>在<code class="codeph">ARCHIVELOG</code>模式下运行恢复目录数据库，以便您可以根据需要进行时间点恢复。
                              </p>
                           </li>
                           <li>
                              <p>将保留策略设置为大于<code class="codeph">1</code>的<code class="codeph">REDUNDANCY</code>值。
                              </p>
                           </li>
                           <li>
                              <p>将数据库备份到两个单独的介质（例如，磁盘和磁带）。</p>
                           </li>
                           <li>
                              <p>定期运行<code class="codeph">BACKUP</code> <code class="codeph">DATABASE</code> <code class="codeph">PLUS</code> <code class="codeph">ARCHIVELOG</code> ，如果可用，则运行到介质管理器，或者仅运行到磁盘。
                              </p>
                           </li>
                           <li>
                              <p>请勿使用其他恢复目录作为备份的存储库。</p>
                           </li>
                           <li>
                              <p>将控制文件自动备份功能配置为<code class="codeph">ON</code> 。</p>
                           </li>
                        </ul>
                        <p>使用此策略，控制文件自动备份功能可确保始终可以恢复恢复目录数据库，只要控制文件自动备份可用即可。</p>
                        <div class="infoboxnotealso" id="GUID-1E7762AD-7F83-4571-8280-F4B1BEB5415E__GUID-50135869-9D77-46F7-B6C2-28787E021F3C">
                           <p class="notep1">也可以看看：</p>
                           <p> <a href="rman-recovery-advanced.html#GUID-195E30B2-6077-446D-A255-089D3341268A" title="Disaster recovery includes the restoration and recovery of the target database after the loss of the entire target database, the recovery catalog database, all current control files, all online redo log files, and all parameter files.">执行灾难恢复</a>以获取有关使用控制文件自动备份<a href="rman-recovery-advanced.html#GUID-195E30B2-6077-446D-A255-089D3341268A" title="灾难恢复包括在丢失整个目标数据库，恢复目录数据库，所有当前控制文件，所有联机重做日志文件和所有参数文件后恢复和恢复目标数据库。">进行恢复</a>的更多信息</p>
                        </div>
                     </div>
                  </div><a id="BRADV89666"></a><div class="props_rev_3"><a id="GUID-FC926F88-2EC6-47B5-A15C-0C548C94388F" name="GUID-FC926F88-2EC6-47B5-A15C-0C548C94388F"></a><h5 id="BRADV-GUID-FC926F88-2EC6-47B5-A15C-0C548C94388F" class="sect5"><span class="enumeration_section">13.6.1.3</span>将恢复目录与目标数据库分离</h5>
                     <div>
                        <p>恢复目录仅在与旨在保护的数据分开时才有效。因此，您绝不能将包含数据库的RMAN存储库的恢复目录存储在与目标数据库相同的数据库中。另外，请勿将目录数据库存储在与目标数据库相同的磁盘上。</p>
                        <p>为了说明建议数据分离的原因，假设您在<code class="codeph">prod1</code>存储数据库<code class="codeph">prod1</code>的目录。如果<code class="codeph">prod1</code>遭受完全介质故障，并且<code class="codeph">prod1</code>的恢复目录也存储在<code class="codeph">prod1</code> ，那么如果丢失数据库，则还会丢失恢复目录。此时，唯一的选择就是要恢复对控制文件的自动备份<code class="codeph">prod1</code>并用它来恢复和存储没有在恢复目录中的任何信息的利益恢复数据库。
                        </p>
                     </div>
                  </div><a id="BRADV89667"></a><div class="props_rev_3"><a id="GUID-3399C205-2AF3-4CB6-AE4A-7FD40AE79699" name="GUID-3399C205-2AF3-4CB6-AE4A-7FD40AE79699"></a><h5 id="BRADV-GUID-3399C205-2AF3-4CB6-AE4A-7FD40AE79699" class="sect5"><span class="enumeration_section">13.6.1.4</span>导出逻辑备份的恢复目录数据</h5>
                     <div>
                        <p>使用“数据泵导出”实用程序创建的RMAN恢复目录的逻辑备份可以作为物理备份的有用补充。</p>
                        <p>对于损坏恢复目录数据库，可以使用“数据泵导入”将导出的恢复目录数据快速重新导入另一个数据库并重建目录。</p>
                     </div>
                  </div>
               </div><a id="BRADV89668"></a><div class="props_rev_3"><a id="GUID-BF2A82C9-BEE6-49D1-8497-C3AE554953E9" name="GUID-BF2A82C9-BEE6-49D1-8497-C3AE554953E9"></a><h4 id="BRADV-GUID-BF2A82C9-BEE6-49D1-8497-C3AE554953E9" class="sect4"><span class="enumeration_section">13.6.2</span>恢复恢复目录</h4>
                  <div>
                     <p>恢复和恢复恢复目录数据库非常类似于使用RMAN恢复和恢复任何其他数据库。</p>
                     <div class="section">
                        <p>您可以从自动备份还原恢复目录数据库的控制文件和服务器参数文件，然后还原并在数据库的其余部分上执行完全恢复。如果您处于使用多个恢复目录的情况，则还可以使用其他恢复目录来记录有关此恢复目录数据库的备份的元数据。</p>
                        <p>如果无法通过正常的Oracle恢复过程恢复恢复目录数据库，则必须重新创建目录。这种最坏情况的例子包括：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>从未备份的恢复目录数据库</p>
                           </li>
                           <li>
                              <p>已备份但由于数据文件备份或归档日志不可用而无法恢复的恢复目录数据库</p>
                           </li>
                        </ul>
                        <p>您可以使用以下选项部分重新创建缺少的恢复目录的内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>使用<code class="codeph">RESYNC CATALOG</code>命令使用目标数据库的控制文件或控制文件副本中的任何RMAN存储库信息更新恢复目录。来自控制文件记录的任何元数据都会丢失。
                              </p>
                           </li>
                           <li>
                              <p>发出<code class="codeph">CATALOG START WITH</code>命令以重新编目任何可用的备份。
                              </p>
                           </li>
                        </ul>
                        <p>为了最大限度地降低这种最坏情况的可能性，您的备份策略必须至少包括备份恢复目录。<span class="q">“ <a href="managing-recovery-catalog.html#GUID-9EC1D7D7-6ECF-44B2-A8C7-869B97B81B29" title="单个恢复目录可以存储多个目标数据库的元数据。因此，恢复目录的丢失可能是灾难性的。您必须经常备份恢复目录。">备份恢复目录</a> ”中</span>描述了此技术。
                        </p>
                        <div class="infoboxnotealso" id="GUID-BF2A82C9-BEE6-49D1-8497-C3AE554953E9__GUID-873B9F00-E217-458F-B8E2-5E19F0F11E14">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关<code class="codeph">CATALOG</code>命令的信息<a href="../rcmrf/CATALOG.html#RCMRF109" target="_blank"><span><cite>，请参见Oracle数据库备份和恢复参考</cite></span></a></p>
                              </li>
                              <li>
                                 <p>有关<code class="codeph">CROSSCHECK</code>命令的信息<a href="../rcmrf/CROSSCHECK.html#RCMRF119" target="_blank"><span><cite>，请参见Oracle数据库备份和恢复参考</cite></span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV182"></a><div class="props_rev_3"><a id="GUID-14E5B168-8033-4831-A02A-6003212988D7" name="GUID-14E5B168-8033-4831-A02A-6003212988D7"></a><h3 id="BRADV-GUID-14E5B168-8033-4831-A02A-6003212988D7" class="sect3"><span class="enumeration_section">13.7</span>管理存储的脚本</h3>
               <div>
                  <p>您可以在恢复目录中创建和存储脚本。</p>
                  <div class="infoboxnotealso" id="GUID-14E5B168-8033-4831-A02A-6003212988D7__GUID-40AECE42-46DA-4D3B-ABC0-23ADAE07FD37">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="managing-recovery-catalog.html#GUID-D9520408-2DEB-4B4A-8E86-2027C173DEB4" title="您可以使用存储的脚本替代命令文件来管理常用的RMAN命令序列。该脚本存储在恢复目录中，而不是存储在文件系统中。">关于存储的脚本</a></p>
                  </div>
               </div><a id="BRADV89669"></a><div class="props_rev_3"><a id="GUID-D9520408-2DEB-4B4A-8E86-2027C173DEB4" name="GUID-D9520408-2DEB-4B4A-8E86-2027C173DEB4"></a><h4 id="BRADV-GUID-D9520408-2DEB-4B4A-8E86-2027C173DEB4" class="sect4"><span class="enumeration_section">13.7.1</span>关于存储的脚本</h4>
                  <div>
                     <p>您可以使用存储的脚本替代命令文件来管理常用的RMAN命令序列。该脚本存储在恢复目录中，而不是存储在文件系统中。</p>
                     <p>存储的脚本可以是本地脚本或全局脚本。本地脚本与创建脚本时RMAN连接的目标数据库相关联，并且只能在连接到该目标数据库时执行。如果RMAN客户端连接到恢复目录和目标数据库，则可以对恢复目录中注册的任何数据库运行全局存储的脚本。</p>
                     <p><code class="codeph">CREATE SCRIPT</code>命令括号内允许的命令与<code class="codeph">RUN</code>块中支持的命令相同。在存储的脚本中允许在<code class="codeph">RUN</code>命令中合法的任何命令。以下命令在存储的脚本中不合法： <code class="codeph">RUN</code> ， <code class="codeph">@</code>和<code class="codeph">@@</code> 。
                     </p>
                     <p>指定脚本名称时，RMAN允许但通常不要求您使用存储脚本名称周围的引号。但是，如果名称以数字开头或是RMAN保留字，则必须在名称周围加上引号，以将其用作存储的脚本名称。请考虑避免以非字母字符开头或与RMAN保留字相同的存储脚本名称。</p>
                     <p>考虑使用命名约定以避免全局和本地存储脚本之间的混淆。对于<code class="codeph">EXECUTE SCRIPT</code> ， <code class="codeph">DELETE SCRIPT</code>和<code class="codeph">PRINT SCRIPT</code>命令，如果作为参数传递的脚本名称不是为连接的目标实例定义的脚本的名称，则RMAN将查找具有相同名称的全局脚本。例如，如果全局脚本<code class="codeph">global_backup</code>位于恢复目录中，但没有为目标数据库定义本地存储脚本<code class="codeph">global_backup</code> ，则以下命令将删除全局脚本：</p><pre class="pre codeblock"><code>DELETE SCRIPT global_backup;</code></pre><p>要使用与存储脚本相关的命令，甚至是全局脚本，您必须同时连接到恢复目录和目标数据库实例。</p>
                  </div>
               </div><a id="BRADV310"></a><a id="BRADV89670"></a><div class="props_rev_3"><a id="GUID-C137DC72-CCB3-4C34-9A32-ABA8B7364C9E" name="GUID-C137DC72-CCB3-4C34-9A32-ABA8B7364C9E"></a><h4 id="BRADV-GUID-C137DC72-CCB3-4C34-9A32-ABA8B7364C9E" class="sect4"><span class="enumeration_section">13.7.2</span>创建存储的脚本</h4>
                  <div>
                     <p>您可以使用<code class="codeph">CREATE SCRIPT</code>命令创建存储的脚本。
                     </p>
                     <div class="section">
                        <p>如果指定了<code class="codeph">GLOBAL</code> ，则恢复目录中不得存在具有此名称的全局脚本。如果未指定<code class="codeph">GLOBAL</code> ，则不能存在具有相同目标数据库相同名称的本地脚本。您还可以使用<code class="codeph">REPLACE SCRIPT</code>创建新脚本或更新现有脚本。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-C137DC72-CCB3-4C34-9A32-ABA8B7364C9E__GUID-7D506E69-B981-4160-BB85-98D30057F570">要创建存储的脚本：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用）。</span><div>
                              <div class="infoboxnotealso" id="GUID-C137DC72-CCB3-4C34-9A32-ABA8B7364C9E__GUID-A3653BF2-031B-4EAE-8CB4-FFCB44D4C79D">
                                 <p class="notep1">也可以看看：</p>
                                 <p><a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a></p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>运行<code class="codeph">CREATE SCRIPT</code>命令。</span><div>
                              <p>以下示例说明了本地脚本的创建：</p><pre class="pre codeblock"><code>CREATE SCRIPT full_backup {BACKUP DATABASE PLUS ARCHIVELOG; DELETE OBSOLETE; }</code></pre><p>对于全局脚本，语法类似：</p><pre class="pre codeblock"><code>CREATE GLOBAL SCRIPT global_full_backup {BACKUP DATABASE PLUS ARCHIVELOG; DELETE OBSOLETE; }</code></pre><p>或者，您可以提供包含描述性信息的<code class="codeph">COMMENT</code> ：</p><pre class="pre codeblock"><code>CREATE GLOBAL SCRIPT global_full_backup COMMENT'仅用于ARCHIVELOG模式数据库'{BACKUP DATABASE PLUS ARCHIVELOG; DELETE OBSOLETE; }</code></pre><p>您还可以通过从文本文件中读取其内容来创建脚本。该文件必须以左大括号（ <code class="codeph">{</code> ）开头，包含一系列在<code class="codeph">RUN</code>块内有效的命令，并以右大括号（ <code class="codeph">}</code> ）结束。否则，将发出语法错误信号，就像在键盘上输入命令一样。
                              </p><pre class="pre codeblock"><code>CREILE SCRIPT full_backup FROM FILE' / tmp / my_script_file.txt';</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>检查输出。</span><div>
                              <p>如果未显示任何错误，则RMAN已成功创建脚本并存储在恢复目录中。</p>
                           </div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-C137DC72-CCB3-4C34-9A32-ABA8B7364C9E__GUID-95D8EB3A-4AB5-43EA-816D-60F0B9F501A5">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../rcmrf/about-rman-commands.html#RCMRF909" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a> ，以获取RMAN保留字列表</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV311"></a><a id="BRADV89671"></a><div class="props_rev_3"><a id="GUID-367CC981-6BFD-45E1-9A78-931003C32DB7" name="GUID-367CC981-6BFD-45E1-9A78-931003C32DB7"></a><h4 id="BRADV-GUID-367CC981-6BFD-45E1-9A78-931003C32DB7" class="sect4"><span class="enumeration_section">13.7.3</span>替换存储的脚本</h4>
                  <div>
                     <p>要更新存储的脚本，请使用<code class="codeph">REPLACE</code> <code class="codeph">SCRIPT</code>命令。
                     </p>
                     <div class="section">
                        <p>如果要替换本地脚本，则必须连接到创建脚本时连接到的目标数据库。如果脚本不存在，则RMAN会创建它。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-367CC981-6BFD-45E1-9A78-931003C32DB7__GUID-396EA47E-2915-49FE-B103-464B67FFF988">要替换存储的脚本：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用）。</span></li>
                        <li class="stepexpand"><span>执行<code class="codeph">REPLACE SCRIPT</code> 。</span><div>
                              <p>以下示例使用新内容更新脚本<code class="codeph">full_backup</code> ：</p><pre class="pre codeblock"><code>REPLACE SCRIPT full_backup {BACKUP DATABASE PLUS ARCHIVELOG; }</code></pre><p>您可以通过指定<code class="codeph">GLOBAL</code>关键字来更新全局脚本，如下所示：</p><pre class="pre codeblock"><code>REPLACE GLOBAL SCRIPT global_full_backup COMMENT'用于任何数据库的完全备份脚本'{BACKUP AS BACKUPSET DATABASE PLUS ARCHIVELOG; }</code></pre><p>与<code class="codeph">CREATE SCRIPT</code> ，您可以使用以下命令形式从文本文件更新本地或全局存储的脚本：</p><pre class="pre codeblock"><code>从FILE'/ tmp / my_script_file.txt'中替换GLOBAL SCRIPT global_full_backup;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-367CC981-6BFD-45E1-9A78-931003C32DB7__GUID-B86CA244-208D-49EA-8FC8-CB79D0EC4D2A">
                           <p class="notep1">也可以看看：</p>
                           <p><code class="codeph">REPLACE SCRIPT</code>命令语法的<a href="../rcmrf/REPLACE-SCRIPT.html#RCMRF145" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV312"></a><a id="BRADV89672"></a><div class="props_rev_3"><a id="GUID-3C3065A6-6099-4DA9-89C3-C0C7EBCEF57E" name="GUID-3C3065A6-6099-4DA9-89C3-C0C7EBCEF57E"></a><h4 id="BRADV-GUID-3C3065A6-6099-4DA9-89C3-C0C7EBCEF57E" class="sect4"><span class="enumeration_section">13.7.4</span>执行存储的脚本</h4>
                  <div>
                     <p>使用<code class="codeph">EXECUTE SCRIPT</code>命令运行存储的脚本。
                     </p>
                     <div class="section">
                        <p>如果指定了<code class="codeph">GLOBAL</code> ，则恢复目录中必须存在具有此名称的全局脚本;否则，RMAN返回错误<code class="codeph">RMAN-06004</code> 。如果未指定<code class="codeph">GLOBAL</code> ，则RMAN将搜索为当前目标数据库定义的本地存储脚本。如果找不到具有此名称的本地脚本，则RMAN将使用相同的名称搜索全局脚本，并在找到该脚本时执行该脚本。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-3C3065A6-6099-4DA9-89C3-C0C7EBCEF57E__GUID-FC520E45-4970-4264-8660-957783135B9B">要执行存储的脚本：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用）。</span></li>
                        <li class="stepexpand"><span>如果需要，请使用<code class="codeph">SHOW</code>检查已配置的频道。</span><div>
                              <p>您的脚本使用执行脚本时配置的自动通道。如果必须覆盖已配置的通道，请在脚本中使用<code class="codeph">ALLOCATE CHANNEL</code>命令。由于<code class="codeph">RUN</code>块，如果脚本中的RMAN命令失败，则脚本中的后续RMAN命令不会执行。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>运行<code class="codeph">EXECUTE SCRIPT</code> 。此命令需要<code class="codeph">RUN</code>块，如以下示例所示：</span><div><pre class="pre codeblock"><code>RUN {EXECUTE SCRIPT full_backup; }</code></pre><p>如果存在具有指定名称的本地脚本，则上述命令将调用本地脚本。如果未找到本地脚本，但是存在指定名称的全局脚本，则RMAN将执行全局脚本。</p>
                              <p>如果本地脚本和全局脚本具有相同的名称，您还可以使用<code class="codeph">EXECUTE GLOBAL SCRIPT</code>来控制调用哪个脚本。如果没有名为<code class="codeph">global_full_backup</code>本地脚本，则以下两个命令具有相同的效果：</p><pre class="pre codeblock"><code>RUN {EXECUTE GLOBAL SCRIPT global_full_backup; }运行{EXECUTE SCRIPT global_full_backup; }</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-3C3065A6-6099-4DA9-89C3-C0C7EBCEF57E__GUID-BEAAFC82-B9EA-4783-A1AE-12C58AB27B83">
                           <p class="notep1">也可以看看：</p>
                           <p>用于<code class="codeph">EXECUTE SCRIPT</code>命令语法的<a href="../rcmrf/EXECUTE-SCRIPT.html#RCMRF127" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV313"></a><a id="BRADV89673"></a><div class="props_rev_3"><a id="GUID-BA0C61D6-BE78-4950-946F-2E83A8E65B2C" name="GUID-BA0C61D6-BE78-4950-946F-2E83A8E65B2C"></a><h4 id="BRADV-GUID-BA0C61D6-BE78-4950-946F-2E83A8E65B2C" class="sect4"><span class="enumeration_section">13.7.5</span>创建和执行动态存储脚本</h4>
                  <div>
                     <p>您可以在<code class="codeph">CREATE SCRIPT</code>命令中指定替换变量。
                     </p>
                     <div class="section">
                        <p>在命令行上启动RMAN时， <code class="codeph">USING</code>子句指定一个或多个值，用于命令文件中的替换变量。与SQL * Plus一样， <code class="codeph">&amp;1</code>表示放置第一个值的位置， <code class="codeph">&amp;2</code>表示放置第二个值的位置，依此类推。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-BA0C61D6-BE78-4950-946F-2E83A8E65B2C__GUID-3E407DD0-B85E-4B26-83B5-FA21EF4C6392">要创建和使用动态存储脚本：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>创建一个包含<code class="codeph">CREATE SCRIPT</code>语句的命令文件，该语句包含必须动态更新的值的替换变量。</span><div>
                              <p>以下示例使用替换变量作为磁带集的名称， <code class="codeph">FORMAT</code>规范中的字符串以及还原点的名称。
                              </p><pre class="pre codeblock"><code>每季度创建脚本{ALLOCATE CHANNEL c1 DEVICE TYPE sbt PARMS'ENV =（OB_MEDIA_FAMILY =＆1）'; BACKUP TAG＆2 FORMAT'/disk2/bck/&amp;1%U.bck'KEEP FOREVER RESTORE POINT＆3 DATABASE; }</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>将RMAN连接到目标数据库（必须装入或打开）和恢复目录，指定恢复目录脚本的初始值。</span><div>
                              <p>例如，输入以下命令：</p><pre class="pre codeblock"><code>％rman TARGET / CATALOG rco @ catdb使用arc_backup bck0906 FY06Q3</code></pre><p><code class="codeph">KEEP FOREVER</code>需要恢复目录，但任何其他<code class="codeph">KEEP</code>选项都不需要。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>运行在第一步中创建的命令文件以创建存储的脚本。</span><div>
                              <p>例如，运行<code class="codeph">/tmp/catscript.rman</code>命令文件，如下所示：</p><pre class="pre codeblock"><code>RMAN&gt; @ / tmp / catscript.rman</code></pre><p>此步骤创建但不执行存储的脚本。</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>每个季度，执行存储的脚本，传递替换变量的值。</span><div>
                              <p>以下示例执行名为<code class="codeph">quarterly</code>的恢复目录脚本。该示例指定<code class="codeph">arc_backup</code>作为媒体家族的名称（磁带集）， <code class="codeph">bck1206</code>作为的一部分<code class="codeph">FORMAT</code>串并<code class="codeph">FY06Q4</code>作为还原点的名字。
                              </p><pre class="pre codeblock"><code>RUN {EXECUTE SCRIPT每季度使用arc_backup bck1206 FY06Q4; }</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-BA0C61D6-BE78-4950-946F-2E83A8E65B2C__GUID-AFD994CA-032C-40BD-8F29-A31564182209">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="backing-up-database.html#GUID-8894680E-8BBA-475D-8815-D789C1A04FD9" title="你可以使用BACKUP ......保持创建既包含所有权又不受备份保留策略限制的备份。通过使用带有BACKUP命令的KEEP选项，可以从保留策略中免除备份。通常，您将归档备份到磁带。由于您的数据保护备份最有可能位于一组仍可访问且可回收的磁带上，因此建议为归档备份保留一组磁带。使用带有KEEP选项的BACKUP命令进行归档备份。归档备份的一个目的是创建测试数据库。">为长期存储进行数据库备份</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV314"></a><a id="BRADV89674"></a><div class="props_rev_3"><a id="GUID-551823D1-881A-424E-86F1-201126B31EC9" name="GUID-551823D1-881A-424E-86F1-201126B31EC9"></a><h4 id="BRADV-GUID-551823D1-881A-424E-86F1-201126B31EC9" class="sect4"><span class="enumeration_section">13.7.6</span>打印存储的脚本</h4>
                  <div>
                     <p><code class="codeph">PRINT SCRIPT</code>命令显示存储的脚本或将其写入文件。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-551823D1-881A-424E-86F1-201126B31EC9__GUID-00089995-84EA-47E5-8EE2-26DF979DD800">要打印存储的脚本：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录。</span></li>
                        <li class="stepexpand"><span>运行<code class="codeph">PRINT SCRIPT</code>命令，如下所示：</span><div><pre class="pre codeblock"><code>PRINT SCRIPT full_backup;</code></pre><p>要将脚本的内容发送到文件，请使用以下命令形式：</p><pre class="pre codeblock"><code>PRINT SCRIPT full_backup TO FILE'/tmp/my_script_file.txt';</code></pre><p>对于全局脚本，类似的语法如下：</p><pre class="pre codeblock"><code>PRINT GLOBAL SCRIPT global_full_backup; PRINT GLOBAL SCRIPT global_full_backup TO FILE' / tmp / my_script_file.txt';</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-551823D1-881A-424E-86F1-201126B31EC9__GUID-18E7ABC4-500E-4086-A2B2-E7A0C8996D18">
                           <p class="notep1">也可以看看：</p>
                           <p><code class="codeph">PRINT SCRIPT</code>命令语法的<a href="../rcmrf/PRINT-SCRIPT.html#RCMRF136" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV315"></a><a id="BRADV89675"></a><div class="props_rev_3"><a id="GUID-D2D677F1-8F81-40A3-BF46-E3EB013255D3" name="GUID-D2D677F1-8F81-40A3-BF46-E3EB013255D3"></a><h4 id="BRADV-GUID-D2D677F1-8F81-40A3-BF46-E3EB013255D3" class="sect4"><span class="enumeration_section">13.7.7</span>列出存储的脚本名称</h4>
                  <div>
                     <p>使用<code class="codeph">LIST ...SCRIPT NAMES</code>命令显示恢复目录中定义的脚本的名称。
                     </p>
                     <div class="section">
                        <p><code class="codeph">LIST GLOBAL SCRIPT NAMES</code>和<code class="codeph">LIST ALL SCRIPT NAMES</code>是RMAN连接到恢复目录而不连接到目标实例时唯一有效的命令;其他形式的<code class="codeph">LIST ...SCRIPT NAMES</code>命令需要恢复目录连接。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-D2D677F1-8F81-40A3-BF46-E3EB013255D3__GUID-5A9ED265-8F35-49B8-9687-5B77B364AF0F">列出存储的脚本名称：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录。</span></li>
                        <li class="stepexpand"><span>运行<code class="codeph">LIST ...SCRIPT NAMES</code>命令。</span><div>
                              <p>例如，运行以下命令以列出可以为当前连接的目标数据库执行的所有全局和本地脚本的名称：</p><pre class="pre codeblock"><code>列表脚本名称;</code></pre><p>以下示例<span class="italic">仅</span>列出全局脚本名称：</p><pre class="pre codeblock"><code>列出全球脚本名称;</code></pre><p>要列出当前恢复目录中存储的所有脚本的名称，包括恢复目录中注册的所有目标数据库的全局脚本和本地脚本，请使用以下命令形式：</p><pre class="pre codeblock"><code>列出所有脚本名称;</code></pre><p>对于列出的每个脚本，输出指示为脚本定义的目标数据库（或脚本是否为全局）。</p>
                           </div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-D2D677F1-8F81-40A3-BF46-E3EB013255D3__GUID-2F853742-AC63-4837-AAEA-F3BA99C25D8C">
                           <p class="notep1">也可以看看：</p>
                           <p>用于<code class="codeph">LIST SCRIPT NAMES</code> <a href="../rcmrf/LIST.html#RCMRF132" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a>命令语法和输出格式</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV316"></a><a id="BRADV89676"></a><div class="props_rev_3"><a id="GUID-57ECAB2D-A9E7-4234-9C44-E662AE228BE3" name="GUID-57ECAB2D-A9E7-4234-9C44-E662AE228BE3"></a><h4 id="BRADV-GUID-57ECAB2D-A9E7-4234-9C44-E662AE228BE3" class="sect4"><span class="enumeration_section">13.7.8</span>删除存储的脚本</h4>
                  <div>
                     <p>使用<code class="codeph">DELETE GLOBAL SCRIPT</code>命令从恢复目录中删除存储的脚本。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-57ECAB2D-A9E7-4234-9C44-E662AE228BE3__GUID-D6EDC6A8-4EA7-4397-9B9A-EAD1D1336DE9">要删除存储的脚本：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录。</span></li>
                        <li class="stepexpand"><span>输入<code class="codeph">DELETE SCRIPT</code>命令。</span><div>
                              <p>如果使用不带<code class="codeph">GLOBAL</code> <code class="codeph">DELETE SCRIPT</code> ，并且没有存储的脚本用于具有指定名称的目标数据库，则RMAN将按指定的名称查找全局存储的脚本，并删除全局脚本（如果存在）。例如，假设您输入以下命令：</p><pre class="pre codeblock"><code>DELETE SCRIPT'global_full_backup';</code></pre><p>在这种情况下，RMAN会查找为连接的目标数据库定义的脚本<code class="codeph">global_full_backup</code> ，如果找不到，则会在全局脚本中搜索名为<code class="codeph">global_full_backup</code>的脚本并删除该脚本。
                              </p>
                              <p>要删除全局存储的脚本，请使用<code class="codeph">DELETE GLOBAL SCRIPT</code> ：</p><pre class="pre codeblock"><code>DELETE GLOBAL SCRIPT'global_full_backup';</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-57ECAB2D-A9E7-4234-9C44-E662AE228BE3__GUID-5BCCE0E5-44FB-4D3F-9976-9D9DBD55FD5C">
                           <p class="notep1">也可以看看：</p>
                           <p><code class="codeph">DELETE SCRIPT</code>命令语法的<a href="../rcmrf/DELETE-SCRIPT.html#RCMRF122" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV89677"></a><div class="props_rev_3"><a id="GUID-DAC2B027-15EB-4FCF-8753-66E517F71C2A" name="GUID-DAC2B027-15EB-4FCF-8753-66E517F71C2A"></a><h4 id="BRADV-GUID-DAC2B027-15EB-4FCF-8753-66E517F71C2A" class="sect4"><span class="enumeration_section">13.7.9</span>在RMAN启动时执行存储的脚本</h4>
                  <div>
                     <p>要在启动时运行RMAN客户端并在恢复目录中启动存储的脚本，请在启动RMAN客户端时使用<code class="codeph">SCRIPT</code>参数。
                     </p>
                     <div class="section">
                        <p>例如，您可以输入以下命令来执行脚本<code>/tmp/fbkp.cmd</code> ：</p><pre class="pre codeblock"><code>％rman TARGET / CATALOG rco @ catdb SCRIPT' / tmp / fbkp.cmd';</code></pre><p>启动RMAN客户端时，必须连接到包含存储脚本的恢复目录和脚本适用的目标数据库。</p>
                        <p>如果使用相同名称定义本地和全局存储脚本，则RMAN始终执行本地脚本。</p>
                        <div class="infoboxnotealso" id="GUID-DAC2B027-15EB-4FCF-8753-66E517F71C2A__GUID-BD862196-8BA4-438C-9857-58E137B87DB4">
                           <p class="notep1">也可以看看：</p>
                           <p>适用于完整RMAN客户端命令行语法的<a href="../rcmrf/RMAN.html#RCMRF111" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV89678"></a><div class="props_rev_3"><a id="GUID-5FC1C46A-748D-4DAF-9EF4-62781ACBE319" name="GUID-5FC1C46A-748D-4DAF-9EF4-62781ACBE319"></a><h3 id="BRADV-GUID-5FC1C46A-748D-4DAF-9EF4-62781ACBE319" class="sect3"><span class="enumeration_section">13.8</span>维护恢复目录</h3>
               <div>
                  <p>维护恢复目录包括重新同步，更新和升级恢复目录等任务。</p>
                  <p>本节介绍各种管理和维护任务。</p>
               </div><a id="BRADV89679"></a><div class="props_rev_3"><a id="GUID-6B077FE7-8E10-4603-8FDB-CAE3357E85C9" name="GUID-6B077FE7-8E10-4603-8FDB-CAE3357E85C9"></a><h4 id="BRADV-GUID-6B077FE7-8E10-4603-8FDB-CAE3357E85C9" class="sect4"><span class="enumeration_section">13.8.1</span>关于恢复目录维护</h4>
                  <div>
                     <p>创建恢复目录并注册目标数据库后，必须维护此目录。</p>
                     <p>例如，您必须运行<a href="glossary.html#GUID-F89B6EF7-3067-45B0-A45C-DE5247E0C326"><span class="xrefglossterm">RMAN维护命令</span></a> ，这些<a href="glossary.html#GUID-F89B6EF7-3067-45B0-A45C-DE5247E0C326"><span class="xrefglossterm">命令</span></a>在<span class="q">“ <a href="maintaining-rman-backups.html#GUID-F5C3D045-279B-4AB3-8A91-3231A716402C" title="建议的维护策略是配置快速恢复区域，备份保留策略和归档重做日志删除策略。在这种情况下，数据库会根据需要自动维护和删除备份和归档重做日志。但是，有时需要手动维护数据库备份和归档重做日志。RMAN提供多个命令来维护RMAN备份和存储库记录。RMAN始终将其元数据存储在其执行操作的每个目标数据库的控制文件中。如果在恢复目录中注册目标数据库，则RMAN会将此目标数据库的元数据存储在恢复目录中。创建备份或副本的Data Guard环境中的数据库与该文件相关联。例如，如果RMAN连接到目标数据库standby1并备份它，则此备份与standby1关联。对于交叉检查，RMAN只能在连接到与文件关联的数据库时将文件状态从AVAILABLE更新为EXPIRED。RMAN可以在连接到任何数据库时删除文件。如果RMAN未作为TARGET连接到与文件关联的数据库，并且RMAN无法成功删除文件，则RMAN会提示您将TARGET连接到与该文件关联的数据库。然后你必须使用DELETE ...FORCE删除文件元数据。如果维护命令仅更改RMAN元数据，则可以将RMAN作为TARGET连接到Data Guard环境中的任何数据库。除非您明确使用CHANGE，否则备份仍与数据库关联...RESET DB_UNIQUE_NAME将备份与其他数据库关联。RMAN旨在在没有恢复目录的情况下工作。但是，如果选择不使用恢复目录，则每个目标数据库的控制文件都是RMAN元数据的独占存储库。控制文件包含两种类型的记录：循环重用记录和非圆形重用记录。当包含有关在快速恢复区域中创建的文件的信息的控制文件记录即将被重用时，数据库尝试在文件有资格删除时从快速恢复区域中删除该文件。否则，数据库会扩展包含此文件记录的控制文件部分的大小。防止因覆盖控制文件记录而丢失RMAN元数据的最佳方法是使用恢复目录。如果您没有使用恢复目录来存储RMAN元数据，那么保护每个目标数据库控制文件是非常重要的。虽然快速恢复区域主要是自我管理，但某些情况可能需要数据库管理干预。RMAN使用某些规则来确定何时可以从快速恢复区域删除文件。您可以使用V $ RECOVERY_FILE_DEST和V $ RECOVERY_AREA_USAGE视图来确定是否为快速恢复区域分配了足够的空间。除了设置闪回保留目标或使用保证还原点之外，您无法直接管理快速恢复区域中的闪回日志。如果RMAN保留策略要求保留一组大于快速恢复区磁盘配额的备份，或者保留策略设置为NONE，则快速恢复区域可以完全填充，没有可回收空间。使用ALTER SYSTEM命令更改快速恢复区域的位置。ALTER SYSTEM命令可用于禁用快速恢复区域。通常，快速恢复区域是自我维护的。但是，当在快速恢复区域中创建文件期间实例崩溃时，数据库可能会将文件保留在快速恢复区域中。某些情况可能会导致存储库与其记录的文件之间出现差异，包括磁带或磁盘故障以及用户管理的副本或RMAN相关文件的删除。要确保恢复目录或控制文件中的备份数据与磁盘上或介质管理目录中的相应数据同步，请执行交叉检查。CROSSCHECK命令仅对当前记录在RMAN存储库中的文件进行操作。交叉检查更新过期的RMAN存储库信息，该信息与存储库记录与其物理状态不匹配的备份有关。例如，如果用户使用操作系统命令从磁盘中删除存档日志，则存储库仍会指示日志位于磁盘上，而实际上并非如此。连接到目标数据库和恢复目录（如果使用）后，根据需要运行CROSSCHECK命令以验证RMAN已知的备份的状态和可用性。您可以使用LIST命令报告备份，然后使用CROSSCHECK命令检查LIST输出中描述的特定备份是否仍然存在。使用CROSSCHECK命令验证RMAN.RMAN已知的预刷新备份和预刷新归档重做日志文件的状态和可用性，提供了多种更改备份和副本的存储库状态的方法。运行CHANGE ...无法找到备份或已异地迁移时的UNAVAILABLE命令。您可以将备份指定为免除保留策略。此技术对于归档备份以满足业务要求非常有用。将CHANGE命令与GUID选项一起使用可更改与从多租户容器数据库（CDB）中删除的可插拔数据库（PDB）对应的备份的状态。使用CHANGE命令可以修改预存储备份和预存储存档重做日志文件的存储库状态。您可以使用CATALOG命令使RMAN知道存储库中未记录的存档日志的存在，或者通过RMAN以外的方式创建的数据库文件的副本。目标数据库控制文件保留目标数据库和所有RMAN备份生成的所有归档重做日志的记录。CATALOG命令的目的是在没有要管理的RMAN文件记录时将元数据添加到存储库。使用CATALOG命令将有关用户管理的副本的信息传播到RMAN存储库。对文件进行编目后，可以运行LIST命令或查询V $ BACKUP_FILES视图以确认信息包含在RMAN存储库中。您可以在磁盘上编目备份片段。如果使用操作系统实用程序将备份片段从一个位置复制到同一主机上的另一个位置，或从一个主机复制到另一个主机，则此技术非常有用。如果使用自动存储管理（ASM），Oracle托管文件框架或快速恢复区域，则可能需要重新编目磁盘管理系统已知但不再列在RMAN存储库中的文件。当用于跟踪文件名的预期机制因介质故障，软件错误或用户错误而失败时，可能会发生这种情况。使用CATALOG命令将preplugin归档重做日志文件添加到RMAN存储库。您可以从RMAN存储库中删除文件的记录。你可以使用CHANGE ...UNCATALOG命令更新缺少文件的RMAN存储库。您可以使用RMAN DELETE命令删除存档的重做日志和RMAN备份。每个RMAN备份在RMAN存储库中生成相应的记录。该记录存储在控制文件中。如果使用了恢复目录，则在从控制文件重新同步恢复目录后，也可以在恢复目录中找到该记录。您可以删除备份的备份和恢复目录记录。建议的维护策略是配置快速恢复区域，备份保留策略和归档重做日志删除策略。使用RMAN DELETE命令删除备份和映像副本。你可以同时使用DELETE和BACKUP ......删除命令以删除特定备份和副本。你可以使用BACKUP ......删除以备份存档的重做日志，数据文件副本或备份集，然后在成功备份后删除输入文件。如果您运行CROSSCHECK，并且RMAN无法找到文件，则它会将RMAN存储库中的记录更新为EXPIRED状态。然后，您可以使用DELETE EXPIRED命令从RMAN存储库中删除过期备份和副本的记录。RMAN DELETE命令支持OBSOLETE选项，该选项删除不再需要的备份以满足指定的可恢复性要求。使用带有GUID选项的DELETE命令可以删除已从多租户容器数据库（CDB）中删除的可插拔数据库（PDB）的备份。使用DELETE命令删除预制备份备份和prelplugin存档重做日志文件。要从操作系统中删除数据库，可以在RMAN中使用DROP DATABASE命令。 RMAN删除服务器参数文件，所有数据文件，联机重做日志和属于目标数据库的控制文件。">维护RMAN备份和存储库记录</a> ”中进行了说明</span> ，以更新备份记录并删除不再需要的备份。无论是否将RMAN与恢复目录一起使用，都必须执行此类维护。其他类型的维护（例如升级恢复目录模式）特定于将RMAN与恢复目录一起使用。
                     </p>
                     <p>如果在Data Guard环境中使用恢复目录，则特殊注意事项适用于目录中记录的备份和数据库文件。有关<span class="q"><a href="rman-architecture.html#GUID-E514F9D2-D96E-4087-B8C5-5A8EB6A44E6B" title="RMAN uses a recovery catalog to track file names for all database files in a Data Guard environment.">RMAN</a></span>何时可以访问备份以及RMAN维护命令如何与可访问备份一起使用的说明，请参阅<span class="q">“ <a href="rman-architecture.html#GUID-E514F9D2-D96E-4087-B8C5-5A8EB6A44E6B" title="RMAN使用恢复目录来跟踪Data Guard环境中所有数据库文件的文件名。">关于Data Guard环境中的RMAN文件管理</a> ”</span> 。
                     </p>
                  </div>
               </div><a id="BRADV181"></a><div class="props_rev_3"><a id="GUID-87642B50-AF67-482E-A93D-291B8D2EED92" name="GUID-87642B50-AF67-482E-A93D-291B8D2EED92"></a><h4 id="BRADV-GUID-87642B50-AF67-482E-A93D-291B8D2EED92" class="sect4"><span class="enumeration_section">13.8.2</span>重新同步恢复目录</h4>
                  <div>
                     <p>当RMAN执行重新同步时，它会将恢复目录与目标数据库的当前或备份控制文件进行比较，并使用缺少或更改的元数据更新目录。</p>
                     <p>当挂载目标控制文件且目录可用时，大多数RMAN命令会自动执行重新同步。在Data Guard环境中，RMAN可以执行<a href="glossary.html#GUID-52C89ABD-D7C1-4FE1-9825-BCBF1973B156"><span class="xrefglossterm">反向重新同步，</span></a>以使用目录中的元数据更新数据库控制文件。
                     </p>
                  </div><a id="BRADV89680"></a><div class="props_rev_3"><a id="GUID-C4EC7335-316B-45D6-A021-2A2B2030439F" name="GUID-C4EC7335-316B-45D6-A021-2A2B2030439F"></a><h5 id="BRADV-GUID-C4EC7335-316B-45D6-A021-2A2B2030439F" class="sect5"><span class="enumeration_section">13.8.2.1</span>关于恢复目录的重新同步</h5>
                     <div>
                        <p>恢复目录的重新同步可确保RMAN从控制文件中获取的元数据保持最新。重新同步可以是完全或部分的。</p>
                        <p>在<a href="glossary.html#GUID-A9DE7F92-35F1-49D7-BF9D-19C2D6A6D24A"><span class="xrefglossterm">部分重新同步中</span></a> ，RMAN读取目标数据库的当前控制文件，以更新有关新备份，新归档重做日志等的已更改元数据。RMAN不会重新同步有关数据库物理架构的元数据。
                        </p>
                        <p>在<a href="glossary.html#GUID-ABC68132-29E7-43AA-A03C-2DAC11B7C91D"><span class="xrefglossterm">完全重新同步中</span></a> ，RMAN会更新所有已更改的记录，包括数据库架构的记录。在对数据库进行结构更改（添加或删除数据库文件，创建新的化身等）或更改RMAN持久性配置之后，RMAN会执行完全重新同步。
                        </p>
                        <p>RMAN在执行完全重新同步时创建<a href="glossary.html#GUID-C49B814B-6834-4CC0-911D-60F7CA87669F"><span class="xrefglossterm">快照控制文件</span></a> ，该<a href="glossary.html#GUID-C49B814B-6834-4CC0-911D-60F7CA87669F"><span class="xrefglossterm">文件</span></a>是临时备份控制文件。数据库确保在任何时间点只有一个RMAN会话访问快照控制文件。RMAN在目标数据库主机上的特定于操作系统的位置创建快照控制文件。您可以指定快照控制文件的名称和位置，如<span class="q">“ <a href="configuring-rman-client-advanced.html#GUID-B7B61600-6DED-413D-B134-1DAE79627A01" title="当RMAN需要控制文件的读取一致版本时，它会创建临时快照控制文件。在与恢复目录重新同步时或在备份当前控制文件时，RMAN需要快照控制文件。">配置快照控制文件位置</a> ”中所述</span> 。
                        </p>
                        <p>此快照控制文件可确保RMAN具有控制文件的一致视图。由于控制文件仅供短期使用，因此未在目录中注册。RMAN在恢复目录中记录控制文件检查点以指示目录的货币。</p>
                        <div class="infoboxnotealso" id="GUID-C4EC7335-316B-45D6-A021-2A2B2030439F__GUID-389FECA5-1097-470F-BEC4-CFAB8AD02B61">
                           <p class="notep1">也可以看看：</p>
                           <p>有关<code class="codeph">RESYNC</code>命令的更多信息，请<a href="../rcmrf/RESYNC-CATALOG.html#RCMRF150" target="_blank"><span><cite>参见Oracle数据库备份和恢复参考</cite></span></a></p>
                        </div>
                     </div><a id="BRADV89681"></a><div class="props_rev_3"><a id="GUID-4394EE9B-2D71-4B44-BD08-217DAAEB94A6" name="GUID-4394EE9B-2D71-4B44-BD08-217DAAEB94A6"></a><h6 id="BRADV-GUID-4394EE9B-2D71-4B44-BD08-217DAAEB94A6" class="sect6"><span class="enumeration_section">13.8.2.1.1</span>关于Data Guard环境中的RMAN恢复目录重新同步</h6>
                        <div>
                           <p>当作为<code class="codeph">TARGET</code>连接到此数据库时，RMAN仅自动将恢复目录与数据库重新同步。因此，当作为<code class="codeph">TARGET</code>连接到环境中的一个数据库时，RMAN不会自动重新同步Data Guard环境中的每个数据库。
                           </p>
                           <p>您可以使用<code class="codeph">RESYNC CATALOG FROM DB_UNIQUE_NAME</code>命令手动将恢复目录与Data Guard环境中的数据库重新同步。
                           </p>
                           <p>有关手动重新同步的示例，假设RMAN已作为<code class="codeph">TARGET</code>连接到生产数据库<code class="codeph">prod</code> ，并且您已使用<code class="codeph">CONFIGURE</code>为<code class="codeph">dgprod3</code>创建配置。如果<code class="codeph">RESYNC CATALOG FROM DB_UNIQUE_NAME dgprod3</code>运行<code class="codeph">RESYNC CATALOG FROM DB_UNIQUE_NAME dgprod3</code> ，则RMAN <code class="codeph">RESYNC CATALOG FROM DB_UNIQUE_NAME dgprod3</code>恢复目录与<code class="codeph">dgprod3</code>控制文件重新同步。在这种情况下，RMAN执行正常的重新同步，其中元数据从<code class="codeph">dgprod3</code>控制文件流向目录，以及<a href="glossary.html#GUID-52C89ABD-D7C1-4FE1-9825-BCBF1973B156"><span class="xrefglossterm">反向重新同步</span></a> 。在反向重新同步中，RMAN使用恢复目录中的持久性配置来更新<code class="codeph">dgprod3</code>控制文件。
                           </p>
                           <div class="infoboxnotealso" id="GUID-4394EE9B-2D71-4B44-BD08-217DAAEB94A6__GUID-644AB6AA-1230-417A-B2F3-F49D90C17C04">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="../sbydb/using-RMAN-in-oracle-data-guard-configurations.html#SBYDB04700" target="_blank"><span><cite>Oracle Data Guard概念和管理</cite></span></a></p>
                           </div>
                        </div>
                     </div>
                  </div><a id="BRADV89682"></a><div class="props_rev_3"><a id="GUID-A7B674BE-0E9C-444D-8517-E7F7D83115D0" name="GUID-A7B674BE-0E9C-444D-8517-E7F7D83115D0"></a><h5 id="BRADV-GUID-A7B674BE-0E9C-444D-8517-E7F7D83115D0" class="sect5"><span class="enumeration_section">13.8.2.2</span>确定何时重新同步恢复目录</h5>
                     <div>
                        <p>当RMAN连接到目标数据库和恢复目录并且您已执行RMAN命令时，RMAN会自动重新同步恢复目录。</p>
                        <p>因此，您不需要经常手动运行<code class="codeph">RESYNC CATALOG</code>命令。以下部分描述了需要手动目录重新同步的情况：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="managing-recovery-catalog.html#GUID-A4BEADEE-60C8-4CA8-9893-793EC799756F" title="如果在发出导致部分重新同步的RMAN命令时恢复目录不可用，则稍后打开目录数据库并使用RESYNC CATALOG命令手动重新同步它。">恢复目录不可用后重新同步</a></p>
                           </li>
                           <li>
                              <p><a href="managing-recovery-catalog.html#GUID-20A5BE48-6303-4215-9E05-144E98733CCC">在不经常备份时在ARCHIVELOG模式下重新同步</a></p>
                           </li>
                           <li>
                              <p><a href="managing-recovery-catalog.html#GUID-1A4258E7-24BE-45F0-9AA1-333A870BF5FF" title="即使未以TARGET身份连接到此数据库，也可以为备用数据库创建或更改RMAN配置。">配置备用数据库后重新同步</a></p>
                           </li>
                           <li>
                              <p><a href="managing-recovery-catalog.html#GUID-3B10BABC-0EFD-4893-9EAB-F7B291D9037D" title="您的目标是确保恢复目录中的元数据是最新的。由于恢复目录从目标控制文件获取其元数据，因此目录中数据的货币取决于控制文件中数据的货币。您必须确保控制文件中的备份元数据在被新记录覆盖之前记录在目录中。">在控制文件记录老化之前重新同步恢复目录</a></p>
                           </li>
                        </ul>
                     </div><a id="BRADV89683"></a><div class="props_rev_3"><a id="GUID-A4BEADEE-60C8-4CA8-9893-793EC799756F" name="GUID-A4BEADEE-60C8-4CA8-9893-793EC799756F"></a><h6 id="BRADV-GUID-A4BEADEE-60C8-4CA8-9893-793EC799756F" class="sect6"><span class="enumeration_section">13.8.2.2.1</span>恢复目录不可用后重新同步</h6>
                        <div>
                           <p>如果在发出导致部分重新同步的RMAN命令时恢复目录不可用，则稍后打开目录数据库并使用<code class="codeph">RESYNC CATALOG</code>命令手动重新同步它。
                           </p>
                           <p>例如，目标数据库可能位于纽约，而恢复目录数据库位于日本。您可能不希望以<code class="codeph">CATALOG</code>模式对目标数据库进行每日备份，以避免取决于地理位置较远的数据库的可用性。在这种情况下，您可以尽可能频繁地连接到目录并运行<code class="codeph">RESYNC CATALOG</code>命令。
                           </p>
                        </div>
                     </div><a id="BRADV89684"></a><div class="props_rev_3"><a id="GUID-20A5BE48-6303-4215-9E05-144E98733CCC" name="GUID-20A5BE48-6303-4215-9E05-144E98733CCC"></a><h6 id="BRADV-GUID-20A5BE48-6303-4215-9E05-144E98733CCC" class="sect6"><span class="enumeration_section">13.8.2.2.2</span>在不经常备份时在ARCHIVELOG模式下重新同步</h6>
                        <div>
                           <p>假设目标数据库以<code class="codeph">ARCHIVELOG</code>模式运行。还假设您执行以下操作：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>不经常备份数据库（例如，数据库备份之间存档数百个重做日志）</p>
                              </li>
                              <li>
                                 <p>每天生成大量日志切换（例如，目录重新同步之间的1000次切换）</p>
                              </li>
                           </ul>
                           <p>在这种情况下，您可能需要定期手动重新同步恢复目录，因为在重做日志切换发生或归档重做日志时，恢复目录<span class="italic">不会</span>自动更新。数据库仅在控制文件中存储有关重做日志切换和归档重做日志的元数据。您必须定期重新同步以将此信息传播到恢复目录中。
                           </p>
                           <p>必须重新同步恢复目录的频率取决于数据库归档重做日志的速率。操作的成本与自上次重新同步以来插入或更改的控制文件中的记录数成比例。如果没有插入或更改记录，则重新同步的成本非常低;如果插入或更改了许多记录，则重新同步会更耗时。</p>
                        </div>
                     </div><a id="BRADV89686"></a><div class="props_rev_3"><a id="GUID-1A4258E7-24BE-45F0-9AA1-333A870BF5FF" name="GUID-1A4258E7-24BE-45F0-9AA1-333A870BF5FF"></a><h6 id="BRADV-GUID-1A4258E7-24BE-45F0-9AA1-333A870BF5FF" class="sect6"><span class="enumeration_section">13.8.2.2.3</span>配置备用数据库后重新同步</h6>
                        <div>
                           <p>即使未以<code class="codeph">TARGET</code>身份连接到此数据库，也可以为备用数据库创建或更改RMAN配置。</p>
                           <p>您可以使用<code class="codeph">CONFIGURE DB_UNIQUE_NAME</code>或<code class="codeph">CONFIGURE ...执行此任务<code class="codeph">CONFIGURE ...FOR DB_UNIQUE_NAME</code>命令。如<span class="q">“ <a href="managing-recovery-catalog.html#GUID-25BDDEC0-9B7D-478D-B3B8-425C88A2CE0C" title="Use RESYNC CATALOG to force a full resynchronization of the recovery catalog with a target database control file.">手动重新同步恢复目录</a> ”中所述</span> ，您可以<span class="q"><a href="managing-recovery-catalog.html#GUID-25BDDEC0-9B7D-478D-B3B8-425C88A2CE0C" title="使用RESYNC CATALOG强制恢复目录与目标数据库控制文件完全重新同步。">手动重新</a></span>同步备用数据库以更新备用数据库的控制文件。
                           </p>
                        </div>
                     </div><a id="BRADV89687"></a><div class="props_rev_3"><a id="GUID-3B10BABC-0EFD-4893-9EAB-F7B291D9037D" name="GUID-3B10BABC-0EFD-4893-9EAB-F7B291D9037D"></a><h6 id="BRADV-GUID-3B10BABC-0EFD-4893-9EAB-F7B291D9037D" class="sect6"><span class="enumeration_section">13.8.2.2.4</span>在控制文件记录<span class="enumeration_section">老化</span>之前重新同步恢复目录</h6>
                        <div>
                           <p>您的目标是确保恢复目录中的元数据是最新的。由于恢复目录从目标控制文件获取其元数据，因此目录中数据的货币取决于控制文件中数据的货币。您必须确保控制文件中的备份元数据在被新记录覆盖之前记录在目录中。</p>
                           <p><code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code>初始化参数确定记录在被覆盖的候选者之前保留在控制文件中的最小天数。因此，在擦除这些记录之前，必须确保将恢复目录与控制文件记录重新同步。
                           </p>
                           <p>以小于<code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code>设置的间隔执行以下任一操作：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>进行备份，从而执行恢复目录的隐式重新同步</p>
                              </li>
                              <li>
                                 <p>使用<code class="codeph">RESYNC CATALOG</code>命令手动重新同步恢复目录</p>
                              </li>
                           </ul>
                           <p>确保<code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code>比备份或重新同步之间的间隔长。否则，控制文件记录可以在传播到恢复目录之前重复使用。在大多数情况下，额外一周是安全的保证金。
                           </p>
                           <div class="infoboxnote" id="GUID-3B10BABC-0EFD-4893-9EAB-F7B291D9037D__GUID-65F32D0C-1AD7-4345-B0E3-DDE15275121F">
                              <p class="notep1">警告：</p>
                              <p>切勿将<code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code>设置为<code class="codeph">0</code> 。如果这样做，则在RMAN将其添加到目录之前，可能会在控制文件中覆盖备份记录。
                              </p>
                           </div>
                           <p>如果控制文件变得太大，则可能出现一个问题。目标数据库控制文件的大小根据以下数量增长：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>您执行的备份</p>
                              </li>
                              <li>
                                 <p>数据库生成的归档重做日志</p>
                              </li>
                              <li>
                                 <p>此信息存储在控制文件中的天数</p>
                              </li>
                           </ul>
                           <p>如果控制文件变得如此之大以至于无法再扩展，因为它已达到最大块数或最大记录数，则数据库可能会覆盖最旧的记录，即使它们的年龄小于<code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code>设置。在这种情况下，数据库会将消息写入警报日志。如果您发现这种情况经常发生，那么减少<code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code>的值并增加重新同步的频率。
                           </p>
                           <div class="infoboxnotealso" id="GUID-3B10BABC-0EFD-4893-9EAB-F7B291D9037D__GUID-0C53A433-7810-4D57-A9E2-756424B75488">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>有关<code class="codeph">CONTROL_FILE_RECORD_KEEP_TIME</code>参数的详细信息，请<a href="../refrn/CONTROL_FILE_RECORD_KEEP_TIME.html#REFRN10020" target="_blank"><span><cite>参见Oracle数据库参考</cite></span></a></p>
                                 </li>
                                 <li>
                                    <p>有关控制文件管理其他方面的更多详细信息，请参见<a href="../admin/managing-control-files.html#ADMIN006" target="_blank"><span><cite>“Oracle数据库管理员指南”</cite></span></a></p>
                                 </li>
                                 <li>
                                    <p><a href="maintaining-rman-backups.html#GUID-1DE96E35-27A3-42DE-BF96-89AE66FD7D2A" title="防止因覆盖控制文件记录而丢失RMAN元数据的最佳方法是使用恢复目录。">防止丢失控制文件记录</a>以了解如何监控控制文件记录的覆盖</p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                     </div>
                  </div><a id="BRADV89688"></a><div class="props_rev_3"><a id="GUID-25BDDEC0-9B7D-478D-B3B8-425C88A2CE0C" name="GUID-25BDDEC0-9B7D-478D-B3B8-425C88A2CE0C"></a><h5 id="BRADV-GUID-25BDDEC0-9B7D-478D-B3B8-425C88A2CE0C" class="sect5"><span class="enumeration_section">13.8.2.3</span>手动重新同步恢复目录</h5>
                     <div>
                        <p>使用<code class="codeph">RESYNC CATALOG</code>强制恢复目录与目标数据库控制文件完全重新同步。
                        </p>
                        <div class="section">
                           <p>您可以使用<code class="codeph">RESYNC CATALOG FROM DB_UNIQUE_NAME</code>或<code class="codeph">ALL</code>指定数据库唯一名称，具体取决于您是要重新同步特定数据库还是Data Guard环境中的所有数据库。要使用<code class="codeph">DB_UNIQUE_NAME ALL</code> ，必须使用密码文件身份验证和<code class="codeph">SYS</code>用户连接到目标数据库。通常，在对备用数据库运行<code class="codeph">CONFIGURE</code>命令但尚未连接到此备用数据库之后执行此操作。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录。</span></li>
                           <li class="stepexpand"><span>挂载或打开目标数据库：</span><div><pre class="pre codeblock"><code>启动安装;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>重新同步恢复目录。</span><div>
                                 <p>在RMAN提示符下运行<code class="codeph">RESYNC</code> <code class="codeph">CATALOG</code>命令，如下所示：</p><pre class="pre codeblock"><code>RESYNC CATALOG;</code></pre><p>以下示例重新同步<code class="codeph">standby1</code>的控制文件：</p><pre class="pre codeblock"><code>来自DB_UNIQUE_NAME standby1的RESYNC CATALOG;</code></pre><p>以下变体，当以<code class="codeph">SYS</code>用户身份连接到目标数据库并使用密码文件身份验证时，重新同步Data Guard环境中所有数据库的控制文件：</p><pre class="pre codeblock"><code>来自DB_UNIQUE_NAME ALL的RESYNC CATALOG;</code></pre><div class="infoboxnotealso" id="GUID-25BDDEC0-9B7D-478D-B3B8-425C88A2CE0C__GUID-9C5925D9-47C3-4EA7-9456-055280482482">
                                    <p class="notep1">也可以看看：</p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p>适用于<code class="codeph">RESYNC</code> <code class="codeph">CATALOG</code>命令语法的<a href="../rcmrf/RESYNC-CATALOG.html#RCMRF150" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                                       </li>
                                       <li>
                                          <p><a href="../sbydb/using-RMAN-in-oracle-data-guard-configurations.html#SBYDB04700" target="_blank"><span><cite>Oracle Data Guard概念和管理</cite></span></a> ，了解如何配置RMAN环境以与备用数据库一起使用</p>
                                       </li>
                                    </ul>
                                 </div>
                              </div>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div><a id="BRADV317"></a><a id="BRADV89690"></a><div class="props_rev_3"><a id="GUID-4608D255-18DE-424A-9FA8-B8CAF49665B8" name="GUID-4608D255-18DE-424A-9FA8-B8CAF49665B8"></a><h4 id="BRADV-GUID-4608D255-18DE-424A-9FA8-B8CAF49665B8" class="sect4"><span class="enumeration_section">13.8.3</span>更改DB_UNIQUE_NAME后更新恢复目录</h4>
                  <div>
                     <p>您可以决定在Data Guard环境中更改数据库的<code class="codeph">DB_UNIQUE_NAME</code> 。在这种情况下，您可以运行<code class="codeph">CHANGE DB_UNIQUE_NAME</code>命令，将存储在旧<code class="codeph">DB_UNIQUE_NAME</code>恢复目录中的元数据与新的<code class="codeph">DB_UNIQUE_NAME</code> 。</p>
                     <div class="section">
                        <p><code class="codeph">CHANGE DB_UNIQUE_NAME</code>命令实际上不会更改数据库本身的<code class="codeph">DB_UNIQUE_NAME</code> 。而是更新已经或将要更改其唯一名称的数据库的目录元数据。
                        </p>
                        <p>以下过程假定主数据库的<code class="codeph">DB_UNIQUE_NAME</code>是<code class="codeph">prodny</code> ，并且您已将备用数据库的<code class="codeph">DB_UNIQUE_NAME</code>从<code class="codeph">prodsf1</code>为<code class="codeph">prodsf2</code> 。更改<span class="italic">主</span>数据库的<code class="codeph">DB_UNIQUE_NAME</code>后，可以使用相同的过程，但步骤<a href="managing-recovery-catalog.html#GUID-4608D255-18DE-424A-9FA8-B8CAF49665B8__CHDCACIA">1</a>将RMAN作为<code class="codeph">TARGET</code>连接到备用数据库而不是主数据库。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-4608D255-18DE-424A-9FA8-B8CAF49665B8__GUID-257FD6AB-B8B3-4B37-B476-AE01AFC2ABC9">更改DB_UNIQUE_NAME后更新恢复目录：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand" id="GUID-4608D255-18DE-424A-9FA8-B8CAF49665B8__CHDCACIA"><span>将RMAN作为<code class="codeph">TARGET</code>连接到<span class="italic">主</span>数据库，也连接到恢复目录。例如，输入以下命令：</span><div><pre class="pre codeblock"><code>％rman RMAN&gt; CONNECT CATALOG rco @ catdb恢复目录数据库密码：连接到恢复目录数据库的<span class="italic">密码</span> RMAN&gt; CONNECT TARGET sbu @ prodny目标数据库密码：连接到目标数据库的<span class="italic">密码</span> ：PRODNY（DBID = 39525561）</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>列出恢复目录已知的<code class="codeph">DB_UNQUE_NAME</code>值。</span><div>
                              <p>运行以下<code class="codeph">LIST</code>命令：</p><pre class="pre codeblock"><code>RMAN&gt; DATABASE的DB_UNIQUE_NAME列表;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>更改RMAN元数据中的<code class="codeph">DB_UNIQUE_NAME</code> 。</span><div>
                              <p>以下示例将数据库唯一名称从备用数据库<code class="codeph">prodsf1</code>为<code class="codeph">prodsf2</code> ：</p><pre class="pre codeblock"><code>RMAN&gt; CHANGE DB_UNIQUE_NAME从prodsf1到prodsf2;</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV89691"></a><div class="props_rev_3"><a id="GUID-8E35106D-950D-409B-98CA-91E142212D6A" name="GUID-8E35106D-950D-409B-98CA-91E142212D6A"></a><h4 id="BRADV-GUID-8E35106D-950D-409B-98CA-91E142212D6A" class="sect4"><span class="enumeration_section">13.8.4</span>从恢复目录中取消注册目标数据库</h4>
                  <div>
                     <p>您可以使用<code class="codeph">UNREGISTER DATABASE</code>命令从恢复目录中注销数据库。
                     </p>
                     <p>从恢复目录中注销数据库时，恢复目录中的所有RMAN存储库记录都将丢失。可以再次注册数据库，但该数据库的恢复目录记录则基于重新注册时控制文件的内容。早于目标数据库控制文件中<code class="codeph">CONTROLFILE_RECORD_KEEP_TIME</code>设置的记录将丢失。存储的脚本（未存储在控制文件中）也会丢失。
                     </p>
                  </div><a id="BRADV318"></a><a id="BRADV89692"></a><div class="props_rev_3"><a id="GUID-7ECC38D1-F425-4C1C-ACDB-6F7078A0A42E" name="GUID-7ECC38D1-F425-4C1C-ACDB-6F7078A0A42E"></a><h5 id="BRADV-GUID-7ECC38D1-F425-4C1C-ACDB-6F7078A0A42E" class="sect5"><span class="enumeration_section">13.8.4.1</span>不在Data Guard环境中时取消注册目标数据库</h5>
                     <div>
                        <p>使用<code class="codeph">UNREGISTER DATABASE</code>命令取消注册目标数据库。
                        </p>
                        <div class="section">
                           <p>此方案假定您没有使用恢复目录来存储主数据库和备用数据库的元数据。</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-7ECC38D1-F425-4C1C-ACDB-6F7078A0A42E__GUID-BF54337C-4356-4734-8858-7DB04E6346AC">要取消注册数据库：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>启动RMAN并以<code class="codeph">TARGET</code>身份连接到数据库以取消注册。还连接到恢复目录。</span><div>
                                 <p>没有必要连接到目标数据库，但如果不连接，则必须在<code class="codeph">UNREGISTER</code>命令中指定目标数据库的名称。如果恢复目录中有多个数据库具有相同的名称，则必须围绕该命令创建<code class="codeph">RUN</code>块，并使用<code class="codeph">SET DBID</code>设置数据库的DBID。
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>记下RMAN在启动时显示的DBID。</span><div>
                                 <p>例如，当RMAN连接到打开的目标数据库时，会输出以下形式的行：</p><pre class="oac_no_warn" dir="ltr">连接到目标数据库：PROD（DBID = 39525561）</pre></div>
                           </li>
                           <li class="stepexpand"><span>作为预防措施，使用<code class="codeph">LIST BACKUP SUMMARY</code>和<code class="codeph">LIST COPY SUMMARY</code>列出恢复目录中记录的所有备份可能很有用。这样，如果您以后决定重新注册数据库，则可以重新编录控制文件未知的备份。</span></li>
                           <li class="stepexpand"><span>如果您打算完全删除数据库的所有备份，则运行<code class="codeph">DELETE</code>语句以删除所有现有备份。如果您的目的只是从恢复目录中删除数据库并依赖控制文件来存储此数据库的RMAN元数据，请不要删除所有备份。</span><div>
                                 <p>以下命令说明了如何删除备份：</p><pre class="pre codeblock"><code>DELETE BACKUP DEVICE TYPE sbt;删除备份设备类型磁盘;删除复制;</code></pre><p>RMAN列出了要删除的备份，并在删除之前提示进行确认。</p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>运行<code class="codeph">UNREGISTER</code> <code class="codeph">DATABASE</code>命令。例如：</span><div><pre class="pre codeblock"><code>UNREGISTER DATABASE;</code></pre><p>RMAN显示数据库名称和DBID，并提示您进行确认：</p><pre class="oac_no_warn" dir="ltr">数据库名称为“RDBMS”，DBID为931696259您是否真的要取消注册数据库（输入YES或NO）？是</pre><p>该过程完成后，RMAN将输出以下消息：</p><pre class="oac_no_warn" dir="ltr">数据库从恢复目录中注销</pre></div>
                           </li>
                        </ol>
                     </div>
                  </div><a id="BRADV319"></a><a id="BRADV89693"></a><div class="props_rev_3"><a id="GUID-051D7B4D-906A-4329-BA0A-7E391F74CF59" name="GUID-051D7B4D-906A-4329-BA0A-7E391F74CF59"></a><h5 id="BRADV-GUID-051D7B4D-906A-4329-BA0A-7E391F74CF59" class="sect5"><span class="enumeration_section">13.8.4.2</span>取消注册备用数据库</h5>
                     <div>
                        <p><code class="codeph">UNREGISTER</code>命令支持<code class="codeph">DB_UNIQUE_NAME</code>子句以在Data Guard环境中使用。您可以使用此子句删除特定数据库的元数据。
                        </p>
                        <div class="section">
                           <p>恢复目录将备份与特定数据库相关联。取消注册数据库时，RMAN会将这些备份文件的数据库名称更新为<code class="codeph">null</code> 。因此，备份仍然被记录但没有所有者。你可以执行<code class="codeph">CHANGE ...RESET DB_UNIQUE_NAME</code>命令将当前无主备份的所有权关联到其他数据库。如果在<code class="codeph">UNREGISTER</code>命令上指定<code class="codeph">INCLUDING BACKUPS</code> ，则RMAN也会删除未注册数据库的备份元数据。
                           </p>
                           <p>在此方案中，假设主数据库<code class="codeph">lnx3</code>具有关联的备用数据库<code class="codeph">standby1</code> 。您想取消注册备用数据库。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-051D7B4D-906A-4329-BA0A-7E391F74CF59__GUID-E1235B72-C436-490F-809A-B6F296564EFA">要取消注册备用数据库：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>启动RMAN并以<code class="codeph">TARGET</code>身份连接到<span class="italic">主</span>数据库。此外，将RMAN连接到恢复目录。</span><div>
                                 <p>例如，输入以下命令：</p><pre class="pre codeblock"><code>％rman RMAN&gt; CONNECT TARGET“sbu @ lnx3 AS SYSBACKUP”;目标数据库密码：连接到目标数据库的<span class="italic">密码</span> ：LNX3（DBID = 781317675）RMAN&gt; CONNECT CATALOG rco @ catdb;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>列出数据库唯一名称。</span><div>
                                 <p>例如，执行<code class="codeph">LIST DB_UNIQUE_NAME</code>命令，如下所示：</p><pre class="pre codeblock"><code>RMAN&gt; <code class="codeph">LIST DB_UNIQUE_NAME OF DATABASE;</code>数据库列表DB密钥DB名称DB ID数据库角色Db_unique_name ------- ------- ----------------- ------- -------- ------------------ 1 LNX3 781317675 STANDBY STANDBY1 1 LNX3 781317675 PRIMARY LNX3</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>运行<code class="codeph">UNREGISTER</code> <code class="codeph">DB_UNIQUE_NAME</code>命令。</span><div>
                                 <p>例如，按如下所示执行<code class="codeph">UNREGISTER</code>命令以取消注册数据库<code class="codeph">standby</code>数据库：</p><pre class="pre codeblock"><code>RMAN&gt; UNREGISTER DB_UNIQUE_NAME standby1;</code></pre><p>RMAN显示数据库名称和DBID，并提示您进行确认：</p><pre class="oac_no_warn" dir="ltr">数据库db_unique_name是“standby1”，db_name是“LNX3”，DBID是781317675您真的要取消注册数据库（输入YES还是NO）？是</pre><p>该过程完成后，RMAN将输出以下消息：</p><pre class="oac_no_warn" dir="ltr">db_unique_name standby1的数据库从恢复目录中取消注册</pre></div>
                           </li>
                        </ol>
                     </div>
                  </div><a id="BRADV769"></a><div class="props_rev_3"><a id="GUID-428A29AA-848B-455E-8B61-87EFE9B9FF8F" name="GUID-428A29AA-848B-455E-8B61-87EFE9B9FF8F"></a><h5 id="BRADV-GUID-428A29AA-848B-455E-8B61-87EFE9B9FF8F" class="sect5"><span class="enumeration_section">13.8.4.3</span>在恢复设备环境中取消注册目标数据库</h5>
                     <div>
                        <p>在零数据丢失恢复设备（恢复设备）环境中， <code class="codeph">UNREGISTER DATABASE</code>命令不能用于从恢复设备目录中注销受保护的数据库。而是使用<code class="codeph">DBMS_RA.DELETE_DB</code>过程。
                        </p>
                        <div class="section">
                           <p><span class="bold">要从恢复设备恢复目录中注销目标数据库，请执行以下操作：</span></p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>获取要取消注册的受保护数据库的<code class="codeph">DB_NAME</code> 。</span></li>
                           <li class="stepexpand"><span>（可选）要删除与此受保护数据库关联的所有备份，请执行以下步骤：</span><div>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>权限的用户身份连接到受保护的数据库。
                                       </p>
                                    </li>
                                    <li>
                                       <p>使用以下命令删除所有备份：</p><pre class="pre codeblock"><code>DELETE BACKUP DEVICE TYPE sbt;删除备份设备类型磁盘;删除复制;</code></pre><p>RMAN列出了要删除的备份，并在删除之前提示进行确认。</p>
                                    </li>
                                 </ul>
                              </div>
                           </li>
                           <li class="stepexpand"><span>启动SQL * Plus并以<code class="codeph">RASYS</code> （恢复设备目录所有者）身份连接到恢复设备元数据数据库。</span></li>
                           <li class="stepexpand"><span>使用<code class="codeph">DBMS_RA.DELETE_DB</code>过程从恢复设备取消注册受保护的数据库。</span><div><pre class="pre codeblock"><code>开始DBMS_RA.DELETE_DB（'TEST_DB'）;结束; /</code></pre><p>RMAN会提示您确认取消注册数据库操作。</p>
                              </div>
                           </li>
                        </ol>
                        <div class="section">
                           <div class="infoboxnotealso" id="GUID-428A29AA-848B-455E-8B61-87EFE9B9FF8F__GUID-FEE4B1D1-B574-48CD-8B3C-5B6FADE0AF5A">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=AMAGD-GUID-A1B5ACBD-1B8B-42F2-B8FE-772F0949481F" target="_blank"><span class="italic">零数据丢失恢复设备管理员指南</span></a> ，了解<code class="codeph">DBMS_RA.DELETE_DB</code>过程的详细信息</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="BRADV320"></a><a id="BRADV89694"></a><div class="props_rev_3"><a id="GUID-304B2237-0921-422F-A084-D83E7B5C8D2B" name="GUID-304B2237-0921-422F-A084-D83E7B5C8D2B"></a><h4 id="BRADV-GUID-304B2237-0921-422F-A084-D83E7B5C8D2B" class="sect4"><span class="enumeration_section">13.8.5</span>重置恢复目录中的数据库化身</h4>
                  <div>
                     <p>使用<code class="codeph">RESETLOGS</code>选项打开数据库时，可以创建数据库的化身。您可以在<code class="codeph">V$DATABASE_INCARNATION</code>视图中访问新化身的记录。
                     </p>
                     <div class="section">
                        <p>如果使用<code class="codeph">RESETLOGS</code>选项打开数据库，则会在恢复目录中自动创建新的数据库化身记录。数据库还隐式并自动发出<code class="codeph">RESET</code> <code class="codeph">DATABASE</code>命令，该命令指定数据库的这个新化身是当前的化身。目标数据库完成的所有后续备份和日志归档都与新的数据库化身相关联。
                        </p>
                        <p>每当RMAN在当前<code class="codeph">RESETLOGS</code> SCN之前将数据库返回到SCN时，无论是使用<code class="codeph">RESTORE</code>还是<code class="codeph">RECOVER</code>还是<code class="codeph">FLASHBACK DATABASE</code> ，都需要<code class="codeph">RESET DATABASE TO INCARNATION</code>命令。但是，在以下方案中，您不需要显式执行<code class="codeph">RESET DATABASE TO INCARNATION</code> ，因为RMAN使用Flashback隐式运行命令。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您使用<code class="codeph">FLASHBACK DATABASE</code>将数据库回滚到<a href="glossary.html#GUID-9FA6E4CA-C9C0-47E8-8FDF-2C2A313F8944"><span class="xrefglossterm">直接祖先路径中</span></a>的SCN。
                              </p>
                           </li>
                           <li>
                              <p>您使用<code class="codeph">FLASHBACK DATABASE</code>将数据库回滚到<a href="glossary.html#GUID-A5A5E7B1-72B6-4F50-8E11-04C03EB5FFAE"><span class="xrefglossterm">还原点</span></a> 。
                              </p>
                           </li>
                        </ul>
                        <p>以下过程说明了在通过<code class="codeph">RESETLOGS</code>恢复时如何重置数据库化身。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-304B2237-0921-422F-A084-D83E7B5C8D2B__GUID-CDF25B8B-CDC4-448E-B2E2-72AF177F379B">要将恢复目录重置为较旧的媒体恢复版本：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>确定所需数据库化身的化身键。通过发出<code class="codeph">LIST</code>命令获取化身键值：</span><div><pre class="pre codeblock"><code>列出数据库trgt;数据库化身列表DB Key Inc密钥DB名称DB ID STATUS复位SCN复位时间------- ------- ------- ------ ------ -  ---------- ---------- 1 2 TRGT 1224038686父母1 02-JUL-12 1 582 TRGT 1224038686 CURRENT 59727 10-JUL-12</code></pre><p>化身键列在<code class="codeph">Inc Key</code>列中。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>将数据库重置为旧版本。例如，输入：</span><div><pre class="pre codeblock"><code>将数据库重置为INCARNATION 2;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>如果先前化身的控制文件可用并已装入，则跳至此过程的步骤6。否则，关闭数据库并在不安装的情况下启动它。例如：</span><div><pre class="pre codeblock"><code>关闭立即启动NOMOUNT</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>从旧版本恢复控制文件。如果您有标记的控制文件，则指定标记。否则，您可以运行<code class="codeph">SET UNTIL</code>命令，如下例所示：</span><div><pre class="pre codeblock"><code>RUN {SET UNTIL'SYSDATE-45'; RESTORE CONTROLFILE; ＃仅当前控制文件不可用时}</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>挂载已还原的控制文件：</span><div><pre class="pre codeblock"><code>ALTER DATABASE MOUNT;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>运行<code class="codeph">RESTORE</code>和<code class="codeph">RECOVER</code>命令以从先前的版本恢复和恢复数据库文件，然后使用<code class="codeph">RESETLOGS</code>选项打开数据库。例如，输入：</span><div><pre class="pre codeblock"><code>RESTORE DATABASE;恢复数据库; ALTER DATABASE OPEN RESETLOGS;</code></pre><div class="infoboxnotealso" id="GUID-304B2237-0921-422F-A084-D83E7B5C8D2B__GUID-F500125B-BEA7-4AD8-AD99-85C9EFA4D783">
                                 <p class="notep1">也可以看看：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><a href="rman-data-repair-concepts.html#GUID-9942AC94-A35D-4A06-9A45-A5A43B82B23D" title="只要使用RESETLOGS选项打开数据库，就会创建数据库化身。">关于数据库化身</a></p>
                                    </li>
                                    <li>
                                       <p>有关<code class="codeph">RESET</code> <code class="codeph">DATABASE</code>语法的<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF148" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                                    </li>
                                    <li>
                                       <p>用于<code class="codeph">LIST</code>语法的<a href="../rcmrf/LIST.html#RCMRF132" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                                    </li>
                                 </ul>
                              </div>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV188"></a><div class="props_rev_3"><a id="GUID-7E4D9DEA-9519-4E6E-9E3B-C721133C05F7" name="GUID-7E4D9DEA-9519-4E6E-9E3B-C721133C05F7"></a><h4 id="BRADV-GUID-7E4D9DEA-9519-4E6E-9E3B-C721133C05F7" class="sect4"><span class="enumeration_section">13.8.6</span>升级恢复目录</h4>
                  <p>本节介绍恢复目录升级的内容以及何时必须执行此操作。</p><a id="BRADV89695"></a><div class="props_rev_3"><a id="GUID-A16CF9F7-822F-46E0-A87D-C9433F49453E" name="GUID-A16CF9F7-822F-46E0-A87D-C9433F49453E"></a><h5 id="BRADV-GUID-A16CF9F7-822F-46E0-A87D-C9433F49453E" class="sect5"><span class="enumeration_section">13.8.6.1</span>关于恢复目录升级</h5>
                     <div>
                        <p>如果要升级到Oracle Database 12 <span class="italic">c</span>第1版（12.1.0.2）或更高版本，则恢复目录数据库必须使用Oracle数据库企业版。
                        </p>
                        <p>如果使用的恢复目录模式版本早于RMAN客户端所需的版本，则必须对其进行升级。<a href="../rcmrf/rman-compatibility.html#RCMRF005" target="_blank"><span><cite>Oracle数据库备份和恢复参考中</cite></span></a>的兼容性矩阵解释了哪些模式版本与哪些版本的RMAN兼容。例如，如果使用具有10.2版恢复目录模式的Oracle Database <span class="italic">11g</span> RMAN客户端，则必须升级目录。
                        </p>
                        <p>Oracle数据库<span class="italic">10g</span>第1版恢复目录模式需要<code class="codeph">CREATE TYPE</code>权限。如果您在10 <span class="italic">g</span> R1之前的版本中创建了恢复目录所有者，并且在未包含<code class="codeph">CREATE TYPE</code>权限时授予了<code class="codeph">RECOVERY_CATALOG_OWNER</code>角色，则必须在升级目录之前明确地向此用户授予<code class="codeph">CREATE TYPE</code> 。
                        </p>
                        <p>如果恢复目录的版本高于RMAN客户端所需的版本，则在发出<code class="codeph">UPGRADE CATALOG</code>时会收到错误。如果恢复目录是最新的并且不需要升级，则RMAN允许运行<code class="codeph">UPGRADE CATALOG</code>命令，以便您可以在必要时随时重新创建程序包。检查消息日志中是否有升级过程中生成的错误消息。
                        </p>
                     </div><a id="BRADV89696"></a><div class="props_rev_3"><a id="GUID-BE7ACDDE-200F-477C-9CA3-C157BE4772AC" name="GUID-BE7ACDDE-200F-477C-9CA3-C157BE4772AC"></a><h6 id="BRADV-GUID-BE7ACDDE-200F-477C-9CA3-C157BE4772AC" class="sect6"><span class="enumeration_section">13.8.6.1.1</span>在Data Guard环境中升级恢复目录的特殊注意事项</h6>
                        <div>
                           <p>假设您在Data Guard环境中将恢复目录库架构升级到Oracle Database <span class="italic">11g</span>或更高版本。当RMAN连接到备用数据库时，它会自动注册新的数据库信息并重新同步以从控制文件中获取文件名。
                           </p>
                           <p>在重新同步期间，RMAN将名称与目标数据库名称相关联。由于恢复目录包含历史元数据，因此控制文件不知道目录中的某些记录。例如， <code class="codeph">standby1</code>控制文件不知道在<code class="codeph">primary1</code>上进行的所有备份。这些旧记录的数据库唯一名称为<code class="codeph">null</code> 。如<span class="q">“ <a href="managing-recovery-catalog.html#GUID-6B077FE7-8E10-4603-8FDB-CAE3357E85C9" title="创建恢复目录并注册目标数据库后，必须维护此目录。">关于恢复目录维护</a> ”中所述</span> ，您可以使用<code class="codeph">CROSSCHECK</code>来修复这些记录。
                           </p>
                        </div>
                     </div>
                  </div><a id="BRADV321"></a><a id="BRADV11032"></a><div class="props_rev_3"><a id="GUID-4618E284-53CD-4BCD-A2BE-E3764B0B4A52" name="GUID-4618E284-53CD-4BCD-A2BE-E3764B0B4A52"></a><h5 id="BRADV-GUID-4618E284-53CD-4BCD-A2BE-E3764B0B4A52" class="sect5"><span class="enumeration_section">13.8.6.2</span>确定恢复目录的模式版本</h5>
                     <div>
                        <p>恢复目录的模式版本存储在恢复目录本身中。如果在生产系统中维护多个不同版本的数据库，则必须确定信息，并且必须确定目录模式版本是否可用于特定目标数据库版本。</p>
                        <div class="section">
                           <p class="subhead3" id="GUID-4618E284-53CD-4BCD-A2BE-E3764B0B4A52__GUID-DAC17F5E-2F6A-4D4A-90AA-C944A670F380">要确定恢复目录的架构版本：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>启动SQL * Plus并以目录所有者身份连接到恢复目录数据库。</span></li>
                           <li class="stepexpand"><span>查询<code class="codeph">RCVER</code>表以获取模式版本，如以下示例所示（包括示例输出）：</span><div><pre class="pre codeblock"><code>SELECT * FROM rcver;版本------------ 12.01.00.01</code></pre></div>
                           </li>
                        </ol>
                        <div class="section">
                           <p>如果表显示多行，则<code class="codeph">RCVER</code>表中的最高版本是当前目录模式版本。该表仅存储主要版本号，而不存储补丁号。例如，假设<code class="codeph">rcver</code>表显示以下行：</p><pre class="pre codeblock"><code>版本------------ 10.02.00 11.02.00 12.01.00.01</code></pre><p>这些行表示目录是使用10.2.0版可执行文件创建的，然后升级到版本11.2.0，最后升级到版本12.1.0.1。目录模式的当前版本是12.1.0.1。</p>
                           <div class="infoboxnotealso" id="GUID-4618E284-53CD-4BCD-A2BE-E3764B0B4A52__GUID-F3DADD67-4CD7-4D56-B277-BB015E895F1E">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF005" target="_blank"><span><cite>Oracle数据库备份和恢复参考，</cite></span></a>用于管理RMAN环境的完整兼容性规则集</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="BRADV322"></a><a id="BRADV89697"></a><div class="props_rev_3"><a id="GUID-55F40A6B-179E-46DF-B460-E7E91CCCA3AC" name="GUID-55F40A6B-179E-46DF-B460-E7E91CCCA3AC"></a><h5 id="BRADV-GUID-55F40A6B-179E-46DF-B460-E7E91CCCA3AC" class="sect5"><span class="enumeration_section">13.8.6.3</span>使用UPGRADE CATALOG命令</h5>
                     <div>
                        <p>此方案假定您要将恢复目录库架构升级到当前版本。</p>
                        <div class="section">
                           <div class="infoboxnote" id="GUID-55F40A6B-179E-46DF-B460-E7E91CCCA3AC__GUID-25E7E38B-95CA-416F-B42F-0D4596FF8847">
                              <p class="notep1">注意：</p>从Oracle Database 12 <span class="italic">c</span>第1版（12.1.0.2）开始，恢复目录数据库必须使用Oracle数据库企业版。
                           </div>
                           <p>要升级恢复目录：</p>
                           <ol>
                              <li>
                                 <p>为恢复目录数据库启用Oracle分区。</p>
                              </li>
                              <li>
                                 <p>如果恢复目录数据库使用标准版，则使用以下技术之一：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>将恢复目录数据库从Standard Edition迁移到Enterprise Edition。</p>
                                    </li>
                                 </ul>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>将恢复目录移动到Oracle Enterprise Edition数据库，然后使用<code class="codeph">IMPORT CATALOG</code>命令将恢复目录导入此数据库。
                                       </p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>使用SQL * Plus以具有<code class="codeph">SYSDBA</code>权限的<code class="codeph">SYS</code>用户身份连接到恢复目录数据库。
                                 </p>
                              </li>
                              <li>
                                 <p>运行<code class="codeph">dbmsrmansys.sql</code>脚本以授予<code class="codeph">RECOVERY_CATALOG_OWNER</code>角色所需的其他权限。
                                 </p><pre class="pre codeblock"><code>SQL&gt; @ $ ORACLE_HOME / rdbms / admin / dbmsrmansys.sql</code></pre></li>
                              <li>
                                 <p>（可选）通过使用<code class="codeph">–vpd</code>选项运行<code class="codeph">dbmsrmanvpc.sql</code>脚本，为恢复目录启用VPD模型。
                                 </p>
                                 <p>以下命令为用户<code class="codeph">rco</code>拥有的恢复目录启用VPD模型：</p><pre class="pre codeblock"><code>SQL&gt; @ / <span class="italic">$ ORACLE_HOME</span> /rdbms/admin/dbmsrmanvpc.sql -vpd rco;</code></pre></li>
                              <li>
                                 <p>退出SQL * Plus。</p>
                              </li>
                              <li>
                                 <p>启动RMAN并将RMAN连接到恢复目录数据库。</p>
                              </li>
                              <li>
                                 <p>运行<code class="codeph">UPGRADE</code> <code class="codeph">CATALOG</code>命令：</p><pre class="oac_no_warn" dir="ltr">RMAN&gt; UPGRADE CATALOG;恢复目录所有者是rman再次输入UPGRADE CATALOG命令以确认目录升级</pre></li>
                              <li>
                                 <p>再次运行<code class="codeph">UPDATE</code> <code class="codeph">CATALOG</code>命令以确认：</p><pre class="oac_no_warn" dir="ltr">RMAN&gt; UPGRADE CATALOG;恢复目录升级到版本12.01.00.01 DBMS_RCVMAN包升级到版本12.01.00.01 DBMS_RCVCAT包升级到版本12.01.00.01</pre><div class="infoboxnote" id="GUID-55F40A6B-179E-46DF-B460-E7E91CCCA3AC__GUID-5F9F1F87-5643-4B1D-A537-648B8F4384D6">
                                    <p class="notep1">注意：</p>
                                    <p>要绕过此步骤，请在步骤7中的<code class="codeph">UPGRADE CATALOG</code>命令之后添加<code class="codeph">NOPROMPT</code>选项。
                                    </p>
                                 </div>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <div class="infoboxnotealso" id="GUID-55F40A6B-179E-46DF-B460-E7E91CCCA3AC__GUID-90701C06-70A1-4C85-812D-5CF7A711AFDA">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>用于<code class="codeph">UPGRADE</code> <code class="codeph">CATALOG</code>命令语法的<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF161" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                                 </li>
                                 <li>
                                    <p>有关恢复目录兼容性的信息<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF908" target="_blank"><span><cite>，请参见Oracle Database Backup and Recovery Reference</cite></span></a></p>
                                 </li>
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=UPGRD005" target="_blank"><span><cite>Oracle数据库升级指南，</cite></span></a>了解完整兼容性和迁移信息</p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="BRADV89698"></a><div class="props_rev_3"><a id="GUID-12C01FD0-2CFF-478E-B80C-FF7639EF2F4C" name="GUID-12C01FD0-2CFF-478E-B80C-FF7639EF2F4C"></a><h4 id="BRADV-GUID-12C01FD0-2CFF-478E-B80C-FF7639EF2F4C" class="sect4"><span class="enumeration_section">13.8.7</span>导入和移动恢复目录</h4>
                  <div>
                     <p>您可以使用RMAN中的<code class="codeph">IMPORT CATALOG</code>命令将一个恢复目录模式合并到另一个模式中。
                     </p>
                     <p>此命令在以下情况下很有用：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>您有不同版本的数据库的多个恢复目录模式。您希望将所有现有架构合并为一个而不会丢失备份元数据。</p>
                        </li>
                        <li>
                           <p>您希望将恢复目录从一个数据库移动到另一个数据库。</p>
                        </li>
                     </ul>
                  </div><a id="BRADV89699"></a><div class="props_rev_3"><a id="GUID-5AF2CC06-52F0-46E3-BA27-38477383672C" name="GUID-5AF2CC06-52F0-46E3-BA27-38477383672C"></a><h5 id="BRADV-GUID-5AF2CC06-52F0-46E3-BA27-38477383672C" class="sect5"><span class="enumeration_section">13.8.7.1</span>关于恢复目录导入</h5>
                     <div>
                        <p>使用<code class="codeph">IMPORT CATALOG</code> ， <strong class="term">源目录模式</strong>是要导入到其他模式的目录模式。<strong class="term">目标目录模式</strong>是要导入源目录模式的目录模式。
                        </p>
                        <p>默认情况下，RMAN从源恢复目录中注册的所有目标数据库导入元数据。（可选）您可以指定要从源目录模式导入的数据库ID列表。</p>
                        <p>默认情况下，RMAN在成功导入后从源目录模式中注销导入的数据库。要指示取消注册是否成功，RMAN会在取消注册合并数据库之前和之后打印消息。您还可以指定<code class="codeph">NO UNREGISTER</code>选项以指定数据库未从源目录中注销。
                        </p>
                        <p><a href="glossary.html#GUID-6A46F2BF-D1BF-4993-89BC-52A0AEC9370C"><span class="xrefglossterm">存储的脚本</span></a>是全局<a href="glossary.html#GUID-6A46F2BF-D1BF-4993-89BC-52A0AEC9370C"><span class="xrefglossterm">脚本</span></a>或本地<a href="glossary.html#GUID-6A46F2BF-D1BF-4993-89BC-52A0AEC9370C"><span class="xrefglossterm">脚本</span></a> 。由于目标模式已包含脚本名称，因此导入期间全局脚本（而非本地脚本）可能会出现名称冲突。在这种情况下，RMAN将全局脚本名称重命名为<code class="codeph">COPY OF</code> <span class="italic"><code class="codeph">script_name</code></span> 。例如，RMAN将<code class="codeph">bp_cmd</code>重命名为<code class="codeph">COPY OF bp_cmd</code> 。
                        </p>
                        <p>如果重命名的全局脚本仍然不唯一，则RMAN将其重命名为<code class="codeph">COPY(2) OF</code> <span class="italic"><code class="codeph">script_name</code></span> 。如果此脚本名称也存在，则RMAN将脚本重命名为<code class="codeph">COPY(3) OF</code> <span class="italic"><code class="codeph">script_name</code></span> 。RMAN继续<code class="codeph">COPY(</code> <span class="italic"><code class="codeph">n</code></span> <code class="codeph">) OF</code>模式，直到脚本具有唯一名称。
                        </p>
                     </div>
                  </div><a id="BRADV770"></a><div class="props_rev_3"><a id="GUID-9C063B1A-CD0B-439D-A9AC-47A70DB51F36" name="GUID-9C063B1A-CD0B-439D-A9AC-47A70DB51F36"></a><h5 id="BRADV-GUID-9C063B1A-CD0B-439D-A9AC-47A70DB51F36" class="sect5"><span class="enumeration_section">13.8.7.2</span>关于在恢复设备环境中导入恢复目录</h5>
                     <div>
                        <p>在恢复设备环境中，所有受保护数据库共享驻留在恢复设备上的单个集中管理的恢复设备目录。所有将备份发送到恢复设备的受保护数据库都必须使用此目录。</p>
                        <p>将受保护的数据库移动到使用恢复设备的数据保护策略时，可以选择将现有备份和备份元数据迁移到恢复设备。要迁移备份元数据，必须将RMAN恢复目录导入Recovery Appliance目录。</p>
                        <div class="infoboxnotealso" id="GUID-9C063B1A-CD0B-439D-A9AC-47A70DB51F36__GUID-014FA197-0449-4F86-9C36-B2C30EA552F3">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=AMAGD231" target="_blank"><span class="italic">零数据丢失恢复设备管理员指南</span></a> ，了解恢复设备目录的概述</p>
                              </li>
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=AMPDB892" target="_blank"><span class="italic">“零数据丢失恢复设备受保护数据库配置指南”</span></a> ，了解迁移备份和备份元数据的步骤</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="BRADV89700"></a><div class="props_rev_3"><a id="GUID-52C875C7-03D3-457A-B9B9-BBAF057D47C3" name="GUID-52C875C7-03D3-457A-B9B9-BBAF057D47C3"></a><h5 id="BRADV-GUID-52C875C7-03D3-457A-B9B9-BBAF057D47C3" class="sect5"><span class="enumeration_section">13.8.7.3</span>导入恢复目录的先决条件</h5>
                     <div>
                        <p>目标数据库，恢复目录数据库和恢复目录模式可以位于不同的数据库版本中。建议的做法是将所有现有恢复目录导入到最新版本的恢复目录模式的单个恢复目录中。</p>
                        <p><span class="q">“ <a href="managing-recovery-catalog.html#GUID-4618E284-53CD-4BCD-A2BE-E3764B0B4A52" title="恢复目录的模式版本存储在恢复目录本身中。如果在生产系统中维护多个不同版本的数据库，则必须确定信息，并且必须确定目录模式版本是否可用于特定目标数据库版本。">确定恢复目录的模式版本</a> ”</span>解释了如何确定目录版本。检查兼容性矩阵以确定您的环境中哪些架构版本兼容。
                        </p>
                        <p>使用<code class="codeph">IMPORT CATALOG</code> ，源恢复目录模式的版本必须等于运行该命令的RMAN可执行文件的当前版本。如果源目录模式是<span class="italic">较低</span>版本，则在导入模式之前将其升级到当前版本。 <span class="q">“ <a href="managing-recovery-catalog.html#GUID-7E4D9DEA-9519-4E6E-9E3B-C721133C05F7" title="本节介绍恢复目录升级的内容以及何时必须执行此操作。">升级恢复目录</a> ”</span>解释了如何升级。如果源恢复目录模式是<span class="italic">更高</span>版本，则使用更高版本的RMAN可执行文件重试导入。
                        </p>
                        <p>无法在源和目标目录模式中注册数据库。如果数据库当前在两个目录模式中都已注册，则在执行导入之前从源目录模式中取消注册数据库。</p>
                        <div class="infoboxnotealso" id="GUID-52C875C7-03D3-457A-B9B9-BBAF057D47C3__GUID-95B66FE9-5B93-43DE-855F-E85C267B9742">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF005" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                        </div>
                     </div>
                  </div><a id="BRADV323"></a><a id="BRADV89701"></a><div class="props_rev_3"><a id="GUID-5E8A8EE5-9DA5-4B5D-AA1B-74A044D7B8F5" name="GUID-5E8A8EE5-9DA5-4B5D-AA1B-74A044D7B8F5"></a><h5 id="BRADV-GUID-5E8A8EE5-9DA5-4B5D-AA1B-74A044D7B8F5" class="sect5"><span class="enumeration_section">13.8.7.4</span>导入恢复目录</h5>
                     <div>
                        <p>将一个恢复目录导入另一个目录时，不需要与目标数据库建立连接。RMAN只需要连接到源和目标目录。</p>
                        <div class="section">
                           <p>在此示例中，数据库<code class="codeph">srcdb</code>包含用户<code class="codeph">102cat</code>拥有的10.2恢复目录模式，而数据库<code class="codeph">destdb</code>包含用户<code class="codeph">111cat</code>拥有的11.1恢复目录模式。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-5E8A8EE5-9DA5-4B5D-AA1B-74A044D7B8F5__GUID-82DEDB7D-8652-40E0-859D-3299E2AD6934">要导入恢复目录：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>启动RMAN并以<code class="codeph">CATALOG</code>身份连接到目标恢复目录架构。例如：</span><div><pre class="pre codeblock"><code>％rman RMAN&gt; CONNECT CATALOG 111cat @ destdb;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>导入源恢复目录模式，指定源目录的连接字符串。</span><div>
                                 <p>例如，输入以下命令以在数据库<code class="codeph">srcdb</code>上导入<code class="codeph">102cat</code>所拥有的目录：</p><pre class="pre codeblock"><code>IMPORT CATALOG 102cat @ srcdb;</code></pre><p>一种变体是导入源目录中注册的目标数据库子集的元数据。您可以按DBID或数据库名称指定数据库，如以下示例所示：</p><pre class="pre codeblock"><code>IMPORT CATALOG 102cat @ srcdb DBID = 1423241,1423242; IMPORT CATALOG 102cat @srcdb DB_NAME = prod3，prod4;</code></pre></div>
                           </li>
                           <li class="stepexpand"><span>（可选）连接到目标数据库以检查是否已成功导入元数据。例如，以下命令以<code class="codeph">TARGET</code>身份连接到数据库<code class="codeph">prod1</code> ，并列出此数据库的所有备份：</span><div><pre class="pre codeblock"><code>CONNECT TARGET“sbu @ prod1 AS SYSBACKUP”;列表备份;</code></pre><p><code class="codeph">sbu</code>是在目标数据库中被授予<code class="codeph">SYSBACKUP</code>权限的用户。
                                 </p>
                              </div>
                           </li>
                        </ol>
                     </div>
                  </div><a id="BRADV89702"></a><div class="props_rev_3"><a id="GUID-E9D1588E-F4F7-4E7D-A8B9-6DB43F175635" name="GUID-E9D1588E-F4F7-4E7D-A8B9-6DB43F175635"></a><h5 id="BRADV-GUID-E9D1588E-F4F7-4E7D-A8B9-6DB43F175635" class="sect5"><span class="enumeration_section">13.8.7.5</span>移动恢复目录</h5>
                     <div>
                        <p>将恢复目录从一个数据库移动到另一个数据库的过程是导入目录的过程的变体。</p>
                        <div class="section">
                           <p>在此方案中，源数据库是包含现有恢复目录的数据库，而目标数据库包含已移动的恢复目录。</p>
                           <p>要将恢复目录从源数据库移动到目标数据库：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>在目标数据库上创建恢复目录，但不要在新目录中注册任何数据库。</span><div>
                                 <p><span class="q">“ <a href="managing-recovery-catalog.html#GUID-6BEEEF19-C8B6-43CA-B416-C01720070AC8" title="创建恢复目录包含多个阶段，包括配置恢复目录数据库，创建恢复目录模式所有者，然后创建目录。">创建恢复目录</a> ”</span>介绍了如何执行此任务。
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>将源目录导入到上一步中创建的目录中。</span><div>
                                 <p><span class="q">“ <a href="managing-recovery-catalog.html#GUID-5E8A8EE5-9DA5-4B5D-AA1B-74A044D7B8F5" title="将一个恢复目录导入另一个目录时，不需要与目标数据库建立连接。RMAN只需要连接到源和目标目录。">导入恢复目录</a> ”</span>说明了如何执行此任务。
                                 </p>
                              </div>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV324"></a><a id="BRADV189"></a><div class="props_rev_3"><a id="GUID-F9345920-0731-40FA-B44A-CE8F50E09B40" name="GUID-F9345920-0731-40FA-B44A-CE8F50E09B40"></a><h3 id="BRADV-GUID-F9345920-0731-40FA-B44A-CE8F50E09B40" class="sect3"><span class="enumeration_section">13.9</span>删除恢复目录</h3>
               <div>
                  <p><code class="codeph">DROP</code> <code class="codeph">CATALOG</code>命令删除由<code class="codeph">CREATE CATALOG</code>命令创建的那些对象。如果拥有恢复目录的用户还拥有<span class="italic">不是</span>由<code class="codeph">CREATE CATALOG</code>创建的对象，则<code class="codeph">DROP CATALOG</code>命令不会删除这些对象。
                  </p>
                  <div class="section">
                     <p>如果删除恢复目录，并且没有恢复目录模式的备份，则此目录中注册的所有目标数据库的备份可能无法使用。但是，每个目标数据库的控制文件仍保留此数据库的最近备份记录。</p>
                     <p><code class="codeph">DROP CATALOG</code>命令不适合从已注册多个目标数据库的恢复目录中取消注册单个数据库。删除恢复目录会删除目录中注册的所有目标数据库的备份的恢复目录记录。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-F9345920-0731-40FA-B44A-CE8F50E09B40__GUID-24405C6E-B3B5-4927-8977-87CDE4C57BBA">要删除恢复目录架构：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录。以要删除的目录模式的所有者身份连接到恢复目录。</span><div>
                           <p>以下示例以用户<code class="codeph">rco</code>身份连接到恢复目录：</p><pre class="pre codeblock"><code>％rman TARGET / CATALOG rco @ catdb</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>运行<code class="codeph">DROP CATALOG</code>命令：</span><div><pre class="pre codeblock"><code>DROP CATALOG;恢复目录所有者是rco再次输入DROP CATALOG命令以确认目录删除</code></pre><div class="infoboxnote" id="GUID-F9345920-0731-40FA-B44A-CE8F50E09B40__GUID-DC68E29B-0C2C-4D8E-9AEB-495AC917E014">
                              <p class="notep1">注意：</p>
                              <p>要绕过下一个确认步骤，请在此步骤中使用<code class="codeph">DROP CATALOG</code>命令添加<code class="codeph">NOPROMPT</code>选项。
                              </p>
                           </div>
                        </div>
                     </li>
                     <li class="stepexpand"><span>再次运行<code class="codeph">DROP CATALOG</code>命令以确认：</span><div><pre class="pre codeblock"><code>DROP CATALOG;</code></pre><div class="infoboxnote" id="GUID-F9345920-0731-40FA-B44A-CE8F50E09B40__GUID-D32523AE-09BF-4A8B-B7F3-E515B275EE54">
                              <p class="notep1">注意：</p>
                              <p>即使在删除恢复目录后，控制文件仍包含有关备份的记录。要从控制文件中清除RMAN存储库记录，请重新创建控制文件。</p>
                           </div>
                           <div class="infoboxnotealso" id="GUID-F9345920-0731-40FA-B44A-CE8F50E09B40__GUID-25E7F61B-02B3-4D5B-BE31-EEE621BE5323">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">DROP CATALOG</code>命令语法的<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF125" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                                 </li>
                                 <li>
                                    <p><a href="managing-recovery-catalog.html#GUID-8E35106D-950D-409B-98CA-91E142212D6A" title="您可以使用UNREGISTER DATABASE命令从恢复目录中注销数据库。">从恢复目录中取消注册目标数据库，</a>以了解如何从目录中取消注册数据库</p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                     </li>
                  </ol>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>