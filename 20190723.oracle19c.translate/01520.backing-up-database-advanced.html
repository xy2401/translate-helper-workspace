<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>备份数据库：高级主题</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96241-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="backing-up-database.html" title="Previous" type="text/html"></link>
      <link rel="next" href="part-managing-rman-backups.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="BRADV"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="backing-up-database.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="part-managing-rman-backups.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">备份和恢复用户指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-backing-up-archiving.html" property="item" typeof="WebPage"><span property="name">备份和存档数据</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">备份数据库：高级主题</li>
            </ol>
            <a id="GUID-A4FABEF4-677C-42ED-9DF8-3731ADA12E5F" name="GUID-A4FABEF4-677C-42ED-9DF8-3731ADA12E5F"></a><a id="BRADV007"></a>
            
            <h2 id="BRADV-GUID-A4FABEF4-677C-42ED-9DF8-3731ADA12E5F" class="sect2"><span class="enumeration_chapter">10</span>备份数据库：高级主题</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍高级RMAN备份过程。本章包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="backing-up-database-advanced.html#GUID-14E97C71-7205-44AD-A711-C5B0053EEA58" title="您可以使用CONFIGURE命令创建管理备份集大小的持久设置。">限制RMAN备份集的大小</a></p>
                  </li>
                  <li>
                     <p><a href="backing-up-database-advanced.html#GUID-BC32C333-F0EB-4F17-AD79-8882E224D2F4" title="您运行CONFIGURE BACKUP OPTIMIZATION命令以启用备份优化。满足特定条件时，RMAN会跳过与已备份文件相同的文件备份。">使用备份优化来跳过文件</a></p>
                  </li>
                  <li>
                     <p><a href="backing-up-database-advanced.html#GUID-CBF7B516-AEBB-433F-A57C-EECAEF153C12" title="默认情况下，BACKUP命令在无法访问数据文件时终止。">跳过脱机，只读和无法访问的文件</a></p>
                  </li>
                  <li>
                     <p><a href="backing-up-database-advanced.html#GUID-4CFE9BA0-E298-42B8-9FB6-D36751C09D54" title="RMAN最多可以同时备份四个备份集，每个副本与其他备份集完全相同。">双工备份集</a></p>
                  </li>
                  <li>
                     <p><a href="backing-up-database-advanced.html#GUID-EEA8D192-E7CD-4457-A0E3-5062EA2E8D0C" title="许多站点保留存储在磁盘上的数据库的备份，以防主数据库发生介质故障或不正确的用户操作需要时间点恢复。磁盘上的数据文件备份简化了恢复的恢复步骤，使恢复更加快速和可靠。">使用RMAN进行分割镜像备份</a></p>
                  </li>
                  <li>
                     <p><a href="backing-up-database-advanced.html#GUID-ECBE4965-57F7-49F0-BECD-734196F417F5" title="您可以使用备份加密保护RMAN备份集。如果未经授权的用户获取加密备份，则无法读取这些备份。">加密RMAN备份</a></p>
                  </li>
                  <li>
                     <p><a href="backing-up-database-advanced.html#GUID-DE4C87D6-4BE4-4B5A-A00F-CA17F301A975" title="使用可重新启动的备份功能，RMAN仅备份在指定日期之后未备份的那些文件。">重新启动RMAN备份</a></p>
                  </li>
                  <li>
                     <p><a href="backing-up-database-advanced.html#GUID-AC3D62EE-FF00-43B9-97CC-3EDF295D2C7D" title="备份窗口是备份必须完成的一段时间。例如，您可能希望将数据库备份限制在系统上的用户活动较少时的时间窗口，例如凌晨2:00到6:00 am之间使用BACKUP命令的DURATION参数指定给定的时间长度允许备份作业运行。指定PARTIAL时，由于备份窗口结束，备份中断时RMAN不会报告错误。相反，RMAN会显示一条消息，显示未备份哪些文件。使用DURATION时，您可以以最大可能性能运行备份，或者在仍然在指定时间内完成的同时尽可能慢地运行备份，以最大限度地降低备份任务对性能的影响。">管理备份Windows</a></p>
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-A4FABEF4-677C-42ED-9DF8-3731ADA12E5F__GUID-632DB451-4ED1-443E-9B9B-4B253757ADCC">
                  <p class="notep1">也可以看看：</p>
                  <p><a href="backing-up-database.html#GUID-93BAB347-063F-439E-BDF3-109AB8D1F8E7" title="使用BACKUP命令创建RMAN备份。RMAN备份的主要目的是保护您的数据。如果发生介质故障或灾难，则可以还原备份并恢复丢失的更改。您可以使用RMAN客户端中的BACKUP命令备份全部或部分数据库。您可以为BACKUP命令提供参数以覆盖默认备份选项。BACKUP命令采用DEVICE TYPE子句，指定是备份到磁盘还是磁带设备。RMAN可以在磁盘上创建备份作为映像副本或备份集。RMAN提供了一系列选项来命名BACKUP命令生成的文件。备份到磁盘时，您可以指定一种格式以将备份分布在多个驱动器上以提高性能。RMAN将一个称为标记的字符串附加到它创建的每个备份上，作为识别备份的一种方式。您可以接受默认标记，也可以使用BACKUP命令的TAG参数指定自己的标记。用户指定的标记是指示不同类别的备份或副本的用途或用法的有用方法。将TAG参数与BACKUP命令一起使用可指定备份集和映像副本的标记。创建备份集时，可以通过在BACKUP命令中包含AS COMPRESSED BACKUPSET选项，使用RMAN支持对备份集进行二进制压缩。通过多节备份，可以将大型数据文件划分为多个部分，这些部分可以跨多个通道并行备份。这提供了更快的备份性能和更好的恢复时间。在创建映像副本时，RMAN使用多个通道写入文件节。但是，此操作的输出是每个数据文件的一个副本。您可以在装入或打开数据库的情况下执行整个数据库备份。您可以使用BACKUP TABLESPACE命令备份一个或多个表空间，或使用BACKUP DATAFILE命令备份一个或多个数据文件。您可以在装入或打开数据库时备份控制文件。RMAN使用快照控制文件来确保读取一致的版本。控制文件的手动备份与控制文件自动备份不同。在备份BACKUP命令中指定的文件后，RMAN会进行控制文件自动备份。要进行手动备份，可以在备份其他文件时指定INCLUDE CURRENT CONTROLFILE或指定BACKUP CURRENT CONTROLFILE。在某些情况下，RMAN会自动备份当前服务器参数文件。BACKUP SPFILE命令显式备份参数文件。备份的服务器参数文件是实例当前使用的文件。只有在数据库关闭且处于一致状态时，才能以NOARCHIVELOG模式备份数据库。预打印备份确保在将非CDB作为PDB插入CDB后可以使用RMAN备份。使用BACKUP命令备份多租户容器数据库（CDB）和可插拔数据库（PDB）。RMAN和Oracle Enterprise Manager Cloud Control为多租户环境中的备份和恢复提供全面支持。备份整个多租户容器数据库（CDB）类似于备份非CDB。备份整个CDB时，RMAN会备份根，所有可插拔数据库（PDB）和归档重做日志。您可以使用RMAN仅备份根。由于根包含整个CDB的关键元数据，因此Oracle建议您定期备份根或备份整个CDB。Oracle Enterprise Manager云控制（云控制）可用于备份根。RMAN允许您使用BACKUP命令备份CDB中的一个或多个PDB。迁移PDB并将其插入到不同的目标CDB后，PDB的预打印备份可用于执行还原和恢复操作.Oracle Enterprise Manager云控制（云控制）可用于执行可插拔数据库（PDB）的备份。由于不同PDB中的表空间可以具有相同的名称，因此为了消除歧义，您必须直接连接到PDB以备份其一个或多个表空间。此示例创建CDB cdb_prod中包含的PDB my_pdb的预包装备份。CDB使用共享撤消，并在读写模式下打开。RMAN使您可以使用BACKUP命令在应用程序根，一个或多个应用程序PDB和应用程序容器上执行备份操作。RMAN可以备份应用程序容器，应用程序PDB和应用程序根目录。使用RMAN BACKUP命令备份应用程序根目录。使用BACKUP命令备份应用程序容器，该容器由应用程序根目录和属于应用程序根目录的所有应用程序PDB组成。BACKUP命令用于备份一个或多个应用程序PDB。使用BACKUP命令备份稀疏数据库。RMAN使您可以使用备份集或映像副本格式中的备份整个数据库的步骤来备份稀疏数据库。您可以使用BACKUP命令备份包含稀疏数据文件或单个稀疏数据文件的一个或多个表空间。RMAN使您可以备份CDB中的一个或多个稀疏PDB。归档重做日志是成功恢复媒体的关键。你应该定期备份它们。RMAN备份的若干功能特定于归档重做日志。例如，您可以使用BACKUP ...删除以将备份到备份集后从磁盘中删除一个或所有归档重做日志副本。即使您的重做日志存档到多个目标并且您使用RMAN备份存档的重做日志，RMAN也只选择一个存档的重做日志文件副本以包含在备份集中。由于具有相同日志序列号的日志相同，因此RMAN不需要包含多个日志副本。自动在线重做日志切换是一项重要的RMAN功能。在CDB中，只有当您以具有SYSDBA或SYSBACKUP权限的普通用户身份连接到根时，才能备份存档的重做日志。要备份存档日志，请使用BACKUP ARCHIVELOG命令。您可以指示RMAN应自动跳过归档重做日志的备份。您可以使用BACKUP ARCHIVELOG命令备份多租户容器数据库（CDB）中的归档重做日志。BACKUP ARCHIVELOG ......DELETE INPUT命令在备份后删除存档的日志文件。此命令消除了手动删除存档重做日志的单独步骤。在CDB中，您可以使用BACKUP ARCHIVELOG备份后删除存档的重做日志...DELETE INPUT命令。增量备份仅复制自指定的先前备份以来已更改的数据文件块。使用BACKUP命令创建增量备份。RMAN增量备份提供多种好处。根据可接受的MTTR（平均恢复时间）选择备份策略。您可以将卷影复制服务（VSS）与Oracle VSS编写器一起使用，以在数据库中制作卷影副本或文件快照。通过逐步更新备份，可以避免对数据文件进行完整映像副本备份的开销，同时还可以最大限度地减少介质恢复数据库所需的时间。例如，如果您运行每日备份脚本，那么您永远不会有超过1天的重做时间来申请媒体恢复。要创建增量备份以用于增量更新的备份策略，请使用BACKUP ...使用TAG形式的BACKUP命令恢复COPY。在实现策略的示例脚本中最好地理解该命令。增量备份的块更改跟踪功能通过记录每个数据文件的更改块来提高备份性能。如果在主数据库或备用数据库上启用了块更改跟踪，则RMAN使用块更改跟踪文件来标识已更改的块以进行增量备份。通过读取这个小位图文件来确定哪些块发生了变化，RMAN避免了必须扫描它备份的数据文件中的每个块。Oracle数据库自动管理更改跟踪文件中的空间，以保留涵盖最近八个备份的块更改数据。达到最多八个位图后，最旧的位图将被跟踪当前更改的位图覆盖。默认情况下，块更改跟踪文件在DB_CREATE_FILE_DEST初始化参数指定的目标中创建为Oracle托管文件。您还可以通过在启用块更改跟踪时指定其名称，将块更改跟踪文件放在您选择的任何位置。块更改跟踪文件的大小与数据库的大小和重做的已启用线程数成比例。您可以在打开或装入数据库时启用块更改跟踪。禁用块更改跟踪时，数据库将从操作系统中删除块更改跟踪文件。您可以查询V $ BLOCK_CHANGE_TRACKING视图以确定是否启用了更改跟踪，如果是，则确定块更改跟踪文件的文件名。要移动更改跟踪文件，请使用ALTER DATABASE RENAME FILE语句。你可以使用BACKUP ......保持创建既包含所有权又不受备份保留策略限制的备份。通过使用带有BACKUP命令的KEEP选项，可以从保留策略中免除备份。通常，您将归档备份到磁带。由于您的数据保护备份最有可能位于一组仍可访问且可回收的磁带上，因此建议为归档备份保留一组磁带。使用带有KEEP选项的BACKUP命令进行归档备份。归档备份的一个目的是创建测试数据库。您可以使用BACKUP BACKUPSET命令备份其他备份作业生成的备份集。您还可以使用BACKUP RECOVERY AREA备份在当前和所有先前快速恢复区域目标中创建的恢复文件。BACKUP BACKUPSET命令在备份集中创建备份片的其他副本，但不创建新的备份集。对于基于冗余的备份保留策略，备份集将计为备份的一个实例。即使存在构成备份集的备份片的多个副本（例如，备份集已从磁盘备份到磁带），此语句也是如此。使用BACKUP BACKUPSET命令将备份集从磁盘复制到磁带。使用BACKUP命令将映像副本备份到磁带。">备份数据库</a>以获取基本备份过程</p>
               </div>
            </div><a id="BRADV89540"></a><div class="props_rev_3"><a id="GUID-14E97C71-7205-44AD-A711-C5B0053EEA58" name="GUID-14E97C71-7205-44AD-A711-C5B0053EEA58"></a><h3 id="BRADV-GUID-14E97C71-7205-44AD-A711-C5B0053EEA58" class="sect3"><span class="enumeration_section">10.1</span>限制RMAN备份集的大小</h3>
               <div>
                  <p>您可以使用<code class="codeph">CONFIGURE</code>命令创建管理备份集大小的持久设置。
                  </p>
                  <p>备份非常大的文件时，此控件很有用。如果您没有持久配置备份集大小，那么您也可以使用<code class="codeph">BACKUP...MAXSETSIZE</code>命令用于限制备份集的大小。
                  </p>
                  <p>您可以使用<code class="codeph">CONFIGURE</code>命令而不是<code class="codeph">BACKUP</code>命令来设置各个备份片段大小的限制。当您使用对文件大小有限制的媒体管理器时，或者必须备份非常大的文件时，此控件特别有用。
                  </p>
                  <div class="infoboxnotealso" id="GUID-14E97C71-7205-44AD-A711-C5B0053EEA58__GUID-AB0F0F87-4202-4D39-89F0-71FD4E7ED8C9">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="configuring-rman-client-advanced.html#GUID-0A131C1F-85F1-4FED-8EFB-D747679A184A" title="CONFIGURE MAXSETSIZE命令限制在通道上创建的备份集的大小。当使用BACKUP命令创建备份集时，此CONFIGURE设置适用于任何通道，无论是手动分配还是已配置。默认值以字节为单位，向下舍入为最低千字节值。">配置备份集的最大大小</a></p>
                        </li>
                        <li>
                           <p><a href="configuring-rman-client-advanced.html#GUID-B5C38414-33DD-4A0F-B0FD-B63F1AC74B33" title="当备份片大小超过文件系统或媒体管理软件允许的最大文件大小时，它是一个问题。您可以使用CONFIGURE CHANNEL或ALLOCATE CHANNEL命令的MAXPIECESIZE参数来限制备份片的大小。">配置备份片的最大大小</a></p>
                        </li>
                     </ul>
                  </div>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="backing-up-database-advanced.html#GUID-04C958FE-A0D3-41A2-B777-73868CDAD4B7" title="BACKUP命令的MAXSETSIZE参数指定备份集的最大大小，以字节（默认），千字节，兆字节或千兆字节为单位。">关于备份集大小</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database-advanced.html#GUID-DD5D76A0-2C93-4847-8E79-8E75ACAF4119" title="在超过文件系统或媒体管理软件的最大文件大小的情况下，备份大小是一个问题。使用CONFIGURE CHANNEL或ALLOCATE CHANNEL命令的MAXSETSIZE参数来限制备份片的大小。">使用BACKUP限制备份集的大小...MAXSETSIZE</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database-advanced.html#GUID-F2D9FF2D-9E1C-4D38-AD8E-88B6B32F02B4" title="如果在BACKUP命令上指定SECTION SIZE参数，则RMAN会创建一个备份集，其中每个备份片段包含来自一个文件节的块。">将大数据文件的备份划分为多个部分</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89541"></a><div class="props_rev_3"><a id="GUID-04C958FE-A0D3-41A2-B777-73868CDAD4B7" name="GUID-04C958FE-A0D3-41A2-B777-73868CDAD4B7"></a><h4 id="BRADV-GUID-04C958FE-A0D3-41A2-B777-73868CDAD4B7" class="sect4"><span class="enumeration_section">10.1.1</span>关于备份集大小</h4>
                  <div>
                     <p><code class="codeph">BACKUP</code>命令的<code class="codeph">MAXSETSIZE</code>参数指定备份集的最大大小，以字节（默认），千字节，兆字节或千兆字节为单位。
                     </p>
                     <p>例如，要将备份集限制为305 MB，请指定<code class="codeph">MAXSETSIZE 305M</code> 。 RMAN尝试将所有备份集限制为此大小。
                     </p>
                     <p>你可以使用<code class="codeph">BACKUP ...MAXSETSIZE</code>限制备份集的大小，以便数据库在多个备份集之间划分。如果备份部分失败，则可以使用可重新启动的备份功能仅备份上一次尝试期间未备份的文件。
                     </p>
                     <p>在某些情况下， <code class="codeph">MAXSETSIZE</code>值可能太小，无法包含要备份的最大文件。在确定<code class="codeph">MAXSETSIZE</code>是否太小时，RMAN使用原始数据文件的大小而不是压缩后的文件大小。RMAN显示错误堆栈，如下所示：</p><pre class="oac_no_warn" dir="ltr">RMAN-00571：============================================== ============= RMAN-00569：===============错误信息堆栈跟踪============== = RMAN-00571：============================================= ============== RMAN-03002：备份命令失败11/03/13 14:40:33 RMAN-06182：归档日志大于MAXSETSIZE：thread 1 seq 1 / oracle / ORADATA / TRGT /拱/ archive1_1.dbf</pre><div class="infoboxnotealso" id="GUID-04C958FE-A0D3-41A2-B777-73868CDAD4B7__GUID-3ADD80EE-82BC-4C6E-9EFF-00936157DD05">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="backing-up-database-advanced.html#GUID-DE4C87D6-4BE4-4B5A-A00F-CA17F301A975" title="使用可重新启动的备份功能，RMAN仅备份在指定日期之后未备份的那些文件。">重新启动RMAN备份</a>以获取有关如何重新启动RMAN备份的信息</p>
                           </li>
                           <li>
                              <p><a href="../rcmrf/CONFIGURE.html#RCMRF113" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a>了解<code class="codeph">CONFIGURE MAXSETSIZE</code>命令</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="BRADV256"></a><a id="BRADV89542"></a><div class="props_rev_3"><a id="GUID-DD5D76A0-2C93-4847-8E79-8E75ACAF4119" name="GUID-DD5D76A0-2C93-4847-8E79-8E75ACAF4119"></a><h4 id="BRADV-GUID-DD5D76A0-2C93-4847-8E79-8E75ACAF4119" class="sect4"><span class="enumeration_section">10.1.2</span>使用BACKUP限制备份集的大小...MAXSETSIZE</h4>
                  <div>
                     <p>在超过文件系统或媒体管理软件的最大文件大小的情况下，备份大小是一个问题。使用<code class="codeph">CONFIGURE</code> <code class="codeph">CHANNEL</code>或<code class="codeph">ALLOCATE</code> <code class="codeph">CHANNEL</code>命令的<code class="codeph">MAXSETSIZE</code>参数来限制备份片的大小。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-DD5D76A0-2C93-4847-8E79-8E75ACAF4119__GUID-FE70E612-DCCF-48D1-9B5B-AFD542DB21D3">要限制备份集的大小：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用）。</span><div>
                              <div class="infoboxnotealso" id="GUID-DD5D76A0-2C93-4847-8E79-8E75ACAF4119__GUID-9FC0EDA5-E2EC-49A4-BA1B-0B7A336C5347">
                                 <p class="notep1">也可以看看：</p>
                                 <p><a href="starting-interacting-with-rman-client.html#GUID-E07231B2-F213-4F8F-8D02-E410A6DAE94C" title="您可以从RMAN客户端或操作系统命令行创建数据库连接。可以使用密码文件或操作系统身份验证对这些数据库连接进行身份验证。">使用RMAN建立数据库连接</a></p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>使用<code class="codeph">MAXSETSIZE</code>参数执行<code class="codeph">BACKUP</code>命令。</span><div>
                              <p>以下示例将归档日志备份到磁带，将每个备份集的大小限制为100 MB：</p><pre class="pre codeblock"><code>备份设备类型sbt MAXSETSIZE 100M ARCHIVELOG ALL;</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV257"></a><a id="BRADV89543"></a><div class="props_rev_3"><a id="GUID-F2D9FF2D-9E1C-4D38-AD8E-88B6B32F02B4" name="GUID-F2D9FF2D-9E1C-4D38-AD8E-88B6B32F02B4"></a><h4 id="BRADV-GUID-F2D9FF2D-9E1C-4D38-AD8E-88B6B32F02B4" class="sect4"><span class="enumeration_section">10.1.3</span>将大数据文件的备份划分为多个部分</h4>
                  <div>
                     <p>如果在<code class="codeph">BACKUP</code>命令上指定<code class="codeph">SECTION SIZE</code>参数，则RMAN会创建一个备份集，其中每个备份片段包含来自一个文件节的块。
                     </p>
                     <div class="section">
                        <p><a href="glossary.html#GUID-FDECFF77-1833-4BD3-A23C-AA4806E28241"><span class="xrefglossterm">文件部分</span></a>是<a href="glossary.html#GUID-FDECFF77-1833-4BD3-A23C-AA4806E28241"><span class="xrefglossterm">文件中</span></a>连续的块范围。这种类型的备份称为<a href="glossary.html#GUID-6D6DDA5E-F1EF-4273-8649-137F1FC89EB6"><span class="xrefglossterm">多节备份</span></a> 。
                        </p>
                        <div class="infoboxnote" id="GUID-F2D9FF2D-9E1C-4D38-AD8E-88B6B32F02B4__GUID-5F174118-D4F3-4E06-A762-309DFB865E83">
                           <p class="notep1">注意：</p>
                           <p>您不能使用<code class="codeph">MAXPIECESIZE</code>指定<code class="codeph">SECTION SIZE</code> 。</p>
                        </div>
                        <p>多节备份的目的是使RMAN通道能够并行备份单个大文件。RMAN在多个通道之间划分工作，每个通道备份文件中的一个文件段。在单独的部分中备份文件可以提高大型数据文件备份的性能。</p>
                        <p>如果多分区备份成功完成，则备份期间生成的备份集不包含部分数据文件。如果多节备份不成功，则RMAN元数据可以包含部分备份集的记录。RMAN不考虑部分备份以进行还原和恢复。必须使用<code class="codeph">DELETE</code>命令删除部分备份集。
                        </p>
                        <p>如果指定的段大小大于文件大小，则RMAN不会对文件使用多段备份。如果指定的小部分大小将产生超过256个部分，则RMAN会将部分大小增加到一个导致恰好256个部分的值。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-F2D9FF2D-9E1C-4D38-AD8E-88B6B32F02B4__GUID-F184DF51-C58A-4B99-80C2-92805F99D486">要进行多节备份：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用）。</span></li>
                        <li class="stepexpand"><span>如有必要，请配置通道并行性，以便RMAN可以使备份并行。</span></li>
                        <li class="stepexpand"><span>使用<code class="codeph">SECTION SIZE</code>参数执行<code class="codeph">BACKUP</code> 。</span><div>
                              <p>例如，假设<code class="codeph">users</code>表空间包含900 MB的单个数据文件。还假设配置了三个SBT通道，SBT设备的并行设置设置为3。您可以将此表空间中的数据文件拆分为文件部分，如以下示例所示：</p><pre class="pre codeblock"><code>备份部分规模为300M TABLESPACE用户;</code></pre><p>在此示例中，三个SBT通道中的每一个备份<code class="codeph">users</code>数据文件的300 MB文件部分。
                              </p>
                           </div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-F2D9FF2D-9E1C-4D38-AD8E-88B6B32F02B4__GUID-05A5DBC1-CDCC-471C-9BFA-3C1D79C0E655">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="validating-database-files-backups.html#GUID-044FA44E-2AEF-4BEB-A73D-EF9EA3253415__CHDDJJAI">并行验证数据文件</a>以了解如何验证大型数据文件的各个部分</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV258"></a><a id="BRADV89546"></a><div class="props_rev_3"><a id="GUID-BC32C333-F0EB-4F17-AD79-8882E224D2F4" name="GUID-BC32C333-F0EB-4F17-AD79-8882E224D2F4"></a><h3 id="BRADV-GUID-BC32C333-F0EB-4F17-AD79-8882E224D2F4" class="sect3"><span class="enumeration_section">10.2</span>使用备份优化来跳过文件</h3>
               <div>
                  <p>您运行<code class="codeph">CONFIGURE BACKUP OPTIMIZATION</code>命令以启用备份优化。满足特定条件时，RMAN会跳过与已备份文件相同的文件备份。
                  </p>
                  <div class="section">
                     <p>对于以下方案，假设您配置备份优化和保留策略，如以下示例所示。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-BC32C333-F0EB-4F17-AD79-8882E224D2F4__CHDFIEBH">
                     <p class="titleinexample">示例10-1配置备份优化</p><pre class="pre codeblock"><code>配置默认设备类型为sbt;配置备份优化;配置保留政策，以恢复4天的窗口;</code></pre><p>如<a href="backing-up-database-advanced.html#GUID-BC32C333-F0EB-4F17-AD79-8882E224D2F4__CHDFIEBH">示例10-1中</a>所示配置RMAN，每晚运行以下命令将数据库备份到磁带：</p><pre class="pre codeblock"><code>备份数据库;</code></pre><p>由于配置了备份优化，因此只有在恢复窗口中最早点或之后进行最新备份时，RMAN才会跳过脱机和只读数据文件的备份。当最新备份早于窗口时，RMAN不会跳过备份。例如，只要在恢复窗口中存在包含此文件的一个备份集，优化就会确保您每晚都不会使用只读数据文件的新备份。</p>
                     <div class="infoboxnotealso" id="GUID-BC32C333-F0EB-4F17-AD79-8882E224D2F4__GUID-A1626397-C2F6-472A-BA27-35C6CDE3E9E2">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="configuring-rman-client-basic.html#GUID-914A65A7-872E-465B-95E5-0FD5ADAF6A9C" title="运行RMAN CONFIGURE命令以启用和禁用备份优化。如果备份了相同的文件或相同版本的文件，则备份优化会在某些情况下跳过文件备份。">备份优化和CONFIGURE命令</a></p>
                           </li>
                           <li>
                              <p><a href="configuring-rman-client-basic.html#GUID-27CE5FE2-DAF0-4E96-B7DF-933616E64C45">关于SBT备份的备份优化与恢复窗口保留策略</a>涉及备份优化和恢复窗口的方案</p>
                           </li>
                           <li>
                              <p><a href="../rcmrf/CONFIGURE.html#RCMRF113" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a> ，以获取<code class="codeph">CONFIGURE BACKUP OPTIMIZATION</code>用于确定文件是否相同且可能被跳过的标准的详细说明</p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="example" -->
               </div><a id="BRADV89548"></a><div class="props_rev_3"><a id="GUID-844430C0-E453-461F-8DDE-2943670D7745" name="GUID-844430C0-E453-461F-8DDE-2943670D7745"></a><h4 id="BRADV-GUID-844430C0-E453-461F-8DDE-2943670D7745" class="sect4"><span class="enumeration_section">10.2.1</span>优化每日存档日志备份到单个磁带：场景</h4>
                  <div>
                     <div class="section">
                        <p>假设您希望每晚备份所有已归档的日志，但您不希望每个日志序列号都有多个副本。如<a href="backing-up-database-advanced.html#GUID-BC32C333-F0EB-4F17-AD79-8882E224D2F4__CHDFIEBH">示例10-1中</a>所示配置RMAN，您每晚在凌晨1点在脚本中运行以下命令：</p><pre class="pre codeblock"><code>备份设备类型sbt ARCHIVELOG ALL;</code></pre><p>RMAN会跳过除过去24小时内生成的所有日志。这样，您只能在磁带上保留每个存档日志的一个副本。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV259"></a><a id="BRADV89549"></a><div class="props_rev_3"><a id="GUID-352C9B7E-FC3C-4B08-92B4-5B506FB09DDC" name="GUID-352C9B7E-FC3C-4B08-92B4-5B506FB09DDC"></a><h4 id="BRADV-GUID-352C9B7E-FC3C-4B08-92B4-5B506FB09DDC" class="sect4"><span class="enumeration_section">10.2.2</span>优化每日存档日志备份到多个媒体系列：场景</h4>
                  <div>
                     <p>在Oracle Secure Backup中，媒体系列是一组命名的卷，具有一组共享的用户定义属性。在此方案中，您将不在磁带上的日志备份到一个媒体系列，然后将相同的日志备份到第二个媒体系列。最后，删除旧日志。</p>
                     <div class="section">
                        <p>如<a href="backing-up-database-advanced.html#GUID-352C9B7E-FC3C-4B08-92B4-5B506FB09DDC__CHDIACHH">示例10-2</a>所示配置RMAN，每晚同时运行以下脚本，将前一天生成的日志备份到两个单独的媒体系列。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-352C9B7E-FC3C-4B08-92B4-5B506FB09DDC__CHDIACHH">
                        <p class="titleinexample">示例10-2将存档的重做日志备份到多个媒体系列</p><pre class="pre codeblock"><code>＃以下命令仅备份不在磁带上的日志。#cirst副本将保存到媒体系列“log_family1”的磁带中。RUN {ALLOCATE CHANNEL c1 DEVICE TYPE sbt PARMS'ENV =（OB_MEDIA_FAMILY = log_family1）';备份ARCHIVELOG ALL; ＃再制作一份存档日志副本并将其保存到＃不同媒体系列的磁带RUN {ALLOCATE CHANNEL c2 DEVICE TYPE sbt PARMS'ENV =（OB_MEDIA_FAMILY = log_family2）'; BACKUP ARCHIVELOG没有备份2次; }</code></pre><p>如果您的目标是从磁盘中删除已备份两次的日志到SBT，那么实现目标的最简单方法是使用<a href="glossary.html#GUID-3492E0C3-F42C-45E6-84E2-63E30A3489A4"><span class="xrefglossterm">归档重做日志删除策略</span></a> 。以下一次性配置指定如果磁带上存在两个归档日志备份，则归档重做日志有资格从磁盘中删除：</p><pre class="pre codeblock"><code>配置ARCHIVELOG删除政策，备份2次到设备类型sbt;</code></pre><p>在<a href="backing-up-database-advanced.html#GUID-352C9B7E-FC3C-4B08-92B4-5B506FB09DDC__CHDIACHH">示例10-2中</a>运行脚本后，您可以通过执行<code class="codeph">DELETE ARCHIVELOG ALL</code>删除不需要的日志。</p>
                     </div>
                     <!-- class="example" -->
                  </div>
               </div><a id="BRADV260"></a><a id="BRADV89550"></a><div class="props_rev_3"><a id="GUID-8EC304D5-40D2-493B-A2CD-D0629347373C" name="GUID-8EC304D5-40D2-493B-A2CD-D0629347373C"></a><h4 id="BRADV-GUID-8EC304D5-40D2-493B-A2CD-D0629347373C" class="sect4"><span class="enumeration_section">10.2.3</span>创建存档日志的每周二次备份：示例</h4>
                  <div>
                     <div class="section">
                        <p>假设一个更复杂的场景，您的目标是每天将存档日志备份到磁带。但是，您担心磁带故障，因此在执行每周从磁盘删除日志之前，您需要确保在单独的磁带上拥有多个每个日志序列号的副本。此方案假定数据库未使用快速恢复区域。</p>
                        <p>首先，执行如下的一次性配置：</p><pre class="pre codeblock"><code>配置备份优化;配置设备类型sbt PARALLELISM 1;配置默认设备类型为sbt; CONFIGURE CHANNEL DEVICE TYPE sbt PARMS'ENV =（OB_MEDIA_FAMILY = first_copy）;</code></pre><p>由于您已启用优化，因此您可以每晚运行以下命令将所有已归档日志备份到尚未备份的<code class="codeph">first_copy</code>媒体系列：</p><pre class="pre codeblock"><code>BACKUP ARCHIVELOG ALL TAG first_copy;</code></pre><p>每个星期五晚上，您都可以在其他媒体系列中创建所有已归档日志的附加备份。备份后，您要删除磁带上至少有两个副本的所有已归档日志。所以你运行以下脚本：</p><pre class="pre codeblock"><code>RUN {＃手动分配一个频道，指定此＃频道运行的备份进入两个媒体系列“first_copy”和“second_copy”ALLOCATE CHANNEL c1设备类型sbt PARMS'ENV =（OB_MEDIA_FAMILY = second_copy）'; ALLOCATE CHANNEL c2 DEVICE TYPE sbt PARMS'ENV =（OB_MEDIA_FAMILY = first_copy）'; BACKUP CHANNEL c1 ARCHIVELOG直到'SYSTATE'没有备份2次＃备份只有磁带上没有2个备份的日志TAG SECOND_COPY; BACKUP CHANNEL c2 ARCHIVELOG直到'SYSTATE'没有备份2次＃备份只有磁带上没有2个备份的日志TAG FIRST_COPY;现在从磁盘中删除已备份到磁带的所有日志至少两次DELETE ARCHIVELOG ALL备份到设备类型sbt;</code></pre><p>下表说明了每日和每周备份脚本的效果。</p>
                        <div class="tblformal" id="GUID-8EC304D5-40D2-493B-A2CD-D0629347373C__GUID-69C35398-F334-40A0-955D-82A4363D1EEA">
                           <p class="titleintable">表10-1每日和每周脚本的影响</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="每日和每周脚本的影响" width="100%" border="1" summary="This table describes daily backup activity under the strategy described in this section." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="14%" id="d50755e1350">脚本</th>
                                    <th align="left" valign="bottom" width="43%" id="d50755e1353">脚本后的磁带内容</th>
                                    <th align="left" valign="bottom" width="43%" id="d50755e1356">脚本后的磁盘内容</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="14%" id="d50755e1361" headers="d50755e1350 ">
                                       <p>日常</p>
                                    </td>
                                    <td align="left" valign="top" width="43%" headers="d50755e1361 d50755e1353 ">
                                       <p>尚未备份的存档日志现在位于媒体系列<code class="codeph">first_copy</code> 。
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="43%" headers="d50755e1361 d50755e1356 ">
                                       <p>自上次<code class="codeph">DELETE</code>命令以来创建的所有已归档日志仍在磁盘上。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="14%" id="d50755e1377" headers="d50755e1350 ">
                                       <p>每周</p>
                                    </td>
                                    <td align="left" valign="top" width="43%" headers="d50755e1377 d50755e1353 ">
                                       <p>磁带上备份少于两个的存档日志现在位于媒体系列<code class="codeph">first_copy</code>和<code class="codeph">second_copy</code> 。
                                       </p>
                                    </td>
                                    <td align="left" valign="top" width="43%" headers="d50755e1377 d50755e1356 ">
                                       <p>已删除至少两次磁带备份的所有已归档日志。</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>每周备份后，您可以将磁带从媒体系列<code class="codeph">second_copy</code>发送到非现场存储。仅当池<code class="codeph">first_copy</code>的主磁带损坏时才使用此磁带备份。由于辅助磁带不在现场，因此您不希望RMAN将其用于恢复，因此您可以将备份标记为不可用：</p><pre class="oac_no_warn" dir="ltr">ARCHIVELOG TAG SECOND_COPY的更改备份不可用;</pre><div class="infoboxnotealso" id="GUID-8EC304D5-40D2-493B-A2CD-D0629347373C__GUID-92E9657D-B095-4AB4-99BA-043F5A0F88C9">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="maintaining-rman-backups.html#GUID-F5C3D045-279B-4AB3-8A91-3231A716402C" title="建议的维护策略是配置快速恢复区域，备份保留策略和归档重做日志删除策略。在这种情况下，数据库会根据需要自动维护和删除备份和归档重做日志。但是，有时需要手动维护数据库备份和归档重做日志。RMAN提供多个命令来维护RMAN备份和存储库记录。RMAN始终将其元数据存储在其执行操作的每个目标数据库的控制文件中。如果在恢复目录中注册目标数据库，则RMAN会将此目标数据库的元数据存储在恢复目录中。创建备份或副本的Data Guard环境中的数据库与该文件相关联。例如，如果RMAN连接到目标数据库standby1并备份它，则此备份与standby1关联。对于交叉检查，RMAN只能在连接到与文件关联的数据库时将文件状态从AVAILABLE更新为EXPIRED。RMAN可以在连接到任何数据库时删除文件。如果RMAN未作为TARGET连接到与文件关联的数据库，并且RMAN无法成功删除文件，则RMAN会提示您将TARGET连接到与该文件关联的数据库。然后你必须使用DELETE ...FORCE删除文件元数据。如果维护命令仅更改RMAN元数据，则可以将RMAN作为TARGET连接到Data Guard环境中的任何数据库。除非您明确使用CHANGE，否则备份仍与数据库关联...RESET DB_UNIQUE_NAME将备份与其他数据库关联。RMAN旨在在没有恢复目录的情况下工作。但是，如果选择不使用恢复目录，则每个目标数据库的控制文件都是RMAN元数据的独占存储库。控制文件包含两种类型的记录：循环重用记录和非圆形重用记录。当包含有关在快速恢复区域中创建的文件的信息的控制文件记录即将被重用时，数据库尝试在文件有资格删除时从快速恢复区域中删除该文件。否则，数据库会扩展包含此文件记录的控制文件部分的大小。防止因覆盖控制文件记录而丢失RMAN元数据的最佳方法是使用恢复目录。如果您没有使用恢复目录来存储RMAN元数据，那么保护每个目标数据库控制文件是非常重要的。虽然快速恢复区域主要是自我管理，但某些情况可能需要数据库管理干预。RMAN使用某些规则来确定何时可以从快速恢复区域删除文件。您可以使用V $ RECOVERY_FILE_DEST和V $ RECOVERY_AREA_USAGE视图来确定是否为快速恢复区域分配了足够的空间。除了设置闪回保留目标或使用保证还原点之外，您无法直接管理快速恢复区域中的闪回日志。如果RMAN保留策略要求保留一组大于快速恢复区磁盘配额的备份，或者保留策略设置为NONE，则快速恢复区域可以完全填充，没有可回收空间。使用ALTER SYSTEM命令更改快速恢复区域的位置。ALTER SYSTEM命令可用于禁用快速恢复区域。通常，快速恢复区域是自我维护的。但是，当在快速恢复区域中创建文件期间实例崩溃时，数据库可能会将文件保留在快速恢复区域中。某些情况可能会导致存储库与其记录的文件之间出现差异，包括磁带或磁盘故障以及用户管理的副本或RMAN相关文件的删除。要确保恢复目录或控制文件中的备份数据与磁盘上或介质管理目录中的相应数据同步，请执行交叉检查。CROSSCHECK命令仅对当前记录在RMAN存储库中的文件进行操作。交叉检查更新过期的RMAN存储库信息，该信息与存储库记录与其物理状态不匹配的备份有关。例如，如果用户使用操作系统命令从磁盘中删除存档日志，则存储库仍会指示日志位于磁盘上，而实际上并非如此。连接到目标数据库和恢复目录（如果使用）后，根据需要运行CROSSCHECK命令以验证RMAN已知的备份的状态和可用性。您可以使用LIST命令报告备份，然后使用CROSSCHECK命令检查LIST输出中描述的特定备份是否仍然存在。使用CROSSCHECK命令验证RMAN.RMAN已知的预刷新备份和预刷新归档重做日志文件的状态和可用性，提供了多种更改备份和副本的存储库状态的方法。运行CHANGE ...无法找到备份或已异地迁移时的UNAVAILABLE命令。您可以将备份指定为免除保留策略。此技术对于归档备份以满足业务要求非常有用。将CHANGE命令与GUID选项一起使用可更改与从多租户容器数据库（CDB）中删除的可插拔数据库（PDB）对应的备份的状态。使用CHANGE命令可以修改预存储备份和预存储存档重做日志文件的存储库状态。您可以使用CATALOG命令使RMAN知道存储库中未记录的存档日志的存在，或者通过RMAN以外的方式创建的数据库文件的副本。目标数据库控制文件保留目标数据库和所有RMAN备份生成的所有归档重做日志的记录。CATALOG命令的目的是在没有要管理的RMAN文件记录时将元数据添加到存储库。使用CATALOG命令将有关用户管理的副本的信息传播到RMAN存储库。对文件进行编目后，可以运行LIST命令或查询V $ BACKUP_FILES视图以确认信息包含在RMAN存储库中。您可以在磁盘上编目备份片段。如果使用操作系统实用程序将备份片段从一个位置复制到同一主机上的另一个位置，或从一个主机复制到另一个主机，则此技术非常有用。如果使用自动存储管理（ASM），Oracle托管文件框架或快速恢复区域，则可能需要重新编目磁盘管理系统已知但不再列在RMAN存储库中的文件。当用于跟踪文件名的预期机制因介质故障，软件错误或用户错误而失败时，可能会发生这种情况。使用CATALOG命令将preplugin归档重做日志文件添加到RMAN存储库。您可以从RMAN存储库中删除文件的记录。你可以使用CHANGE ...UNCATALOG命令更新缺少文件的RMAN存储库。您可以使用RMAN DELETE命令删除存档的重做日志和RMAN备份。每个RMAN备份在RMAN存储库中生成相应的记录。该记录存储在控制文件中。如果使用了恢复目录，则在从控制文件重新同步恢复目录后，也可以在恢复目录中找到该记录。您可以删除备份的备份和恢复目录记录。建议的维护策略是配置快速恢复区域，备份保留策略和归档重做日志删除策略。使用RMAN DELETE命令删除备份和映像副本。你可以同时使用DELETE和BACKUP ......删除命令以删除特定备份和副本。你可以使用BACKUP ......删除以备份存档的重做日志，数据文件副本或备份集，然后在成功备份后删除输入文件。如果您运行CROSSCHECK，并且RMAN无法找到文件，则它会将RMAN存储库中的记录更新为EXPIRED状态。然后，您可以使用DELETE EXPIRED命令从RMAN存储库中删除过期备份和副本的记录。RMAN DELETE命令支持OBSOLETE选项，该选项删除不再需要的备份以满足指定的可恢复性要求。使用带有GUID选项的DELETE命令可以删除已从多租户容器数据库（CDB）中删除的可插拔数据库（PDB）的备份。使用DELETE命令删除预制备份备份和prelplugin存档重做日志文件。要从操作系统中删除数据库，可以在RMAN中使用DROP DATABASE命令。 RMAN删除服务器参数文件，所有数据文件，联机重做日志和属于目标数据库的控制文件。">维护RMAN备份和存储库记录，</a>以了解如何更改备份的状态和删除备份</p>
                              </li>
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF110" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a> ，了解<code class="codeph">CHANGE</code>和<code class="codeph">DELETE</code>命令</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV261"></a><a id="BRADV262"></a><a id="BRADV89569"></a><div class="props_rev_3"><a id="GUID-CBF7B516-AEBB-433F-A57C-EECAEF153C12" name="GUID-CBF7B516-AEBB-433F-A57C-EECAEF153C12"></a><h3 id="BRADV-GUID-CBF7B516-AEBB-433F-A57C-EECAEF153C12" class="sect3"><span class="enumeration_section">10.3</span>跳过脱机，只读和无法访问的文件</h3>
               <div>
                  <p>默认情况下， <code class="codeph">BACKUP</code>命令在无法访问数据文件时终止。
                  </p>
                  <div class="section">
                     <p>您可以指定参数以防止终止，如<a href="backing-up-database-advanced.html#GUID-CBF7B516-AEBB-433F-A57C-EECAEF153C12__CHDBBJBF" title="SKIP INACCESSIBLE，SKIP OFFLINE和SKIP READONLY的描述">表10-2中</a>所列。
                     </p>
                     <div class="tblformal" id="GUID-CBF7B516-AEBB-433F-A57C-EECAEF153C12__CHDBBJBF">
                        <p class="titleintable">表10-2备份...跳过选项</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="备份......跳过选项" width="100%" border="1" summary="Descriptions of SKIP INACCESSIBLE, SKIP OFFLINE, and SKIP READONLY" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="33%" id="d50755e1676">如果你指定......</th>
                                 <th align="left" valign="bottom" width="67%" id="d50755e1679">然后RMAN跳过......</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="33%" id="d50755e1684" headers="d50755e1676 ">
                                    <p><code class="codeph">SKIP</code> <code class="codeph">INACCESSIBLE</code></p>
                                 </td>
                                 <td align="left" valign="top" width="67%" headers="d50755e1684 d50755e1679 ">
                                    <p>RMAN无法读取的数据文件。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="33%" id="d50755e1695" headers="d50755e1676 ">
                                    <p><code class="codeph">SKIP</code> <code class="codeph">OFFLINE</code></p>
                                 </td>
                                 <td align="left" valign="top" width="67%" headers="d50755e1695 d50755e1679 ">
                                    <p>离线数据文件。仍然可以读取某些脱机数据文件，因为它们存在于磁盘上。其他人已被删除或移动，因此无法阅读，使其无法访问。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="33%" id="d50755e1706" headers="d50755e1676 ">
                                    <p><code class="codeph">SKIP</code> <code class="codeph">READONLY</code></p>
                                 </td>
                                 <td align="left" valign="top" width="67%" headers="d50755e1706 d50755e1679 ">
                                    <p>只读表空间中的数据文件。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>以下示例使用自动通道备份数据库，并跳过可能导致备份作业终止的所有数据文件。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-CBF7B516-AEBB-433F-A57C-EECAEF153C12__GUID-CA56E6B3-34A6-4DDD-871E-57D6A92B4301">
                     <p class="titleinexample">示例10-3在RMAN备份期间跳过文件</p><pre class="pre codeblock"><code>BACKUP DATABASE SKIP INACCESSIBLE SKIP READONLY SKIP OFFLINE;</code></pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="BRADV145"></a><div class="props_rev_3"><a id="GUID-4CFE9BA0-E298-42B8-9FB6-D36751C09D54" name="GUID-4CFE9BA0-E298-42B8-9FB6-D36751C09D54"></a><h3 id="BRADV-GUID-4CFE9BA0-E298-42B8-9FB6-D36751C09D54" class="sect3"><span class="enumeration_section">10.4</span>双工备份集</h3>
               <div>
                  <p>RMAN最多可以同时备份四个备份集，每个副本与其他备份集完全相同。</p>
                  <p><a href="glossary.html#GUID-614D6594-1A1A-46EE-A041-312ADAB7E151"><span class="xrefglossterm">双面备份集</span></a>的副本是<a href="glossary.html#GUID-614D6594-1A1A-46EE-A041-312ADAB7E151"><span class="xrefglossterm">备份集中</span></a>每个备份片的副本，每个副本都会获得唯一的副本号（例如， <code class="codeph">0tcm8u2s_1_1</code>和<code class="codeph">0tcm8u2s_1_2</code> ）。无法将备份集双工复制到<a href="glossary.html#GUID-6E3CDD76-A573-4E5C-B12D-59C232C96C19"><span class="xrefglossterm">快速恢复区域</span></a> 。
                  </p>
                  <p>你可以使用<a href="../rcmrf/BACKUP.html#RCMRF107" target="_blank"><code class="codeph">BACKUP</code></a> <code class="codeph">...</code> <code class="codeph">COPIES</code>或<a href="../rcmrf/CONFIGURE.html#RCMRF113" target="_blank"><code class="codeph">CONFIGURE</code></a> <code class="codeph">...</code> <code class="codeph">BACKUP</code> <code class="codeph">COPIES</code>到双工备份集。RMAN可以将备份双工复制到磁盘或磁带，但不能同时将备份复制到磁带和磁盘。对于<code class="codeph">DISK</code>通道，请在<code class="codeph">FORMAT</code>选项中指定多个值，以将多个副本定向到不同的物理磁盘。对于<a href="glossary.html#GUID-2E48CE71-9547-4196-B715-5CE59033262E"><span class="xrefglossterm">SBT</span></a>通道，如果使用支持SBT API第2版的介质管理器，则介质管理器会自动将每个副本写入单独的介质（例如，单独的磁带）。备份到磁带时，请确保副本数量不超过可用磁带设备的数量。
                  </p>
                  <p>双面打印仅适用于备份集，而不适用于映像副本。指定<code class="codeph">BACKUP...是错误的<code class="codeph">BACKUP...COPIES</code>创建映像副本备份，而当<code class="codeph">CONFIGURE...映像副本备份将忽略BACKUP COPIES</code>设置。
                  </p>
                  <div class="infoboxnotealso" id="GUID-4CFE9BA0-E298-42B8-9FB6-D36751C09D54__GUID-90262080-C43E-4359-B388-79853D9798A8">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="rman-backup-concepts.html#GUID-763A9C75-90A5-48FD-9CB6-707D030A00F5" title="RMAN使您可以创建多个相同的备份副本。">关于RMAN备份的多个副本，</a>以获取RMAN备份副本的概念性概述</p>
                  </div>
               </div><a id="BRADV263"></a><a id="BRADV89570"></a><div class="props_rev_3"><a id="GUID-1A6816FF-3E17-443C-B271-9C298CC987FF" name="GUID-1A6816FF-3E17-443C-B271-9C298CC987FF"></a><h4 id="BRADV-GUID-1A6816FF-3E17-443C-B271-9C298CC987FF" class="sect4"><span class="enumeration_section">10.4.1</span>使用配置备份副本双工备份集</h4>
                  <div>
                     <p><code class="codeph">CONFIGURE...BACKUP COPIES</code>命令指定要在指定设备类型上创建的相同备份集的数量。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-1A6816FF-3E17-443C-B271-9C298CC987FF__GUID-D37F02D8-35B9-4438-A997-B36A715E0FA3">使用CONFIGURE双工备份...备份副本：</p>
                        <p>此设置适用于除控制文件自动备份以外的所有备份集（因为控制文件的自动备份始终生成一个副本）和使用<code class="codeph">BACKUP BACKUPSET</code>命令备份时的备份集。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>在所需设备类型上配置所需设备类型的数量，以获取所需设备类型上的数据文件和归档重做日志。</span><div>
                              <p>默认情况下， <code class="codeph">CONFIGURE...对于每种设备类型， BACKUP COPIES</code>设置为<code class="codeph">1</code> 。以下示例为磁带上的数据文件和归档日志配置双工，并为磁盘上的数据文件（但不归档重做日志）进行双工：</p><pre class="pre codeblock"><code>配置设备类型sbt PARALLELISM 1;配置默认设备类型为sbt; CONFIGURE CHANNEL DEVICE TYPE DISK FORMAT'/ disk1 /％U'，'/ disk2 /％U';配置数据文件备份复制设备类型sbt为2;配置ARCHIVELOG备份复制设备类型sbt为2;配置数据文件备份复制设备类型磁盘为2;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>执行<code class="codeph">BACKUP</code>命令。</span><div>
                              <p>以下命令将数据库和归档日志备份到磁带，为每个数据文件和归档日志创建两个副本：</p><pre class="pre codeblock"><code>BACKUP作为BACKUPSET DATABASE PLUS ARCHIVELOG;</code></pre><p>由于磁盘通道的配置格式，以下命令将数据库备份到磁盘，将<code class="codeph">/disk1</code>目录中生成的备份集的一个副本放在<code class="codeph">/disk2</code>目录中：</p><pre class="pre codeblock"><code>备份设备类型磁盘作为BACKUPSET数据库;</code></pre><p>如果未在<code class="codeph">CONFIGURE CHANNNEL</code>上<code class="codeph">CONFIGURE CHANNNEL</code> <code class="codeph">FORMAT</code>子句，则在<code class="codeph">BACKUP</code>命令本身上指定<code class="codeph">FORMAT</code> 。例如，您发出以下命令：</p><pre class="pre codeblock"><code>备份为BACKUPSET数据库格式'/ disk1 /％U'，'/ disk2 /％U';</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>发出<a href="../rcmrf/LIST.html#RCMRF132" target="_blank"><code class="codeph">LIST</code></a> <code class="codeph">BACKUP</code>命令以查看备份集和部分的列表。</span><div>
                              <p>例如，输入以下命令：</p><pre class="pre codeblock"><code>列表备份摘要;</code></pre><p><code class="codeph">#Copies</code>列显示备份集的数量，这些备份集可能是通过双工或多个备份命令生成的。
                              </p>
                           </div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-1A6816FF-3E17-443C-B271-9C298CC987FF__GUID-0F3F7988-4281-46D4-B4E3-DE0D7E294755">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="configuring-rman-client-advanced.html#GUID-2A285F87-552A-4F36-A5B9-F25A69611B4B" title="使用配置...BACKUP COPIES命令指定在指定类型的文件的指定设备类型上创建每个备份片的副本数。此类备份称为双工备份集。">配置备份双工</a></p>
                              </li>
                              <li>
                                 <p><a href="configuring-rman-client-advanced.html#GUID-2A285F87-552A-4F36-A5B9-F25A69611B4B" title="使用配置...BACKUP COPIES命令指定在指定类型的文件的指定设备类型上创建每个备份片的副本数。此类备份称为双工备份集。">配置备份双工</a>以了解<code class="codeph">CONFIGURE BACKUP COPIES</code>命令</p>
                              </li>
                              <li>
                                 <p><a href="configuring-rman-client-basic.html#GUID-AD92E09D-0788-4AB5-8792-5F969C8D237A" title="RMAN为执行基本备份和恢复所需的大多数参数提供合理的默认值。您可以修改默认参数的值或覆盖特定会话的这些值。">关于为RMAN备份配置环境</a>以了解基本备份配置选项</p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV264"></a><a id="BRADV89571"></a><div class="props_rev_3"><a id="GUID-D0F9ADCE-DA22-475B-BDB6-A565E76A26F9" name="GUID-D0F9ADCE-DA22-475B-BDB6-A565E76A26F9"></a><h4 id="BRADV-GUID-D0F9ADCE-DA22-475B-BDB6-A565E76A26F9" class="sect4"><span class="enumeration_section">10.4.2</span>使用BACKUP双工备份集...副本</h4>
                  <div>
                     <p><code class="codeph">BACKUP</code>命令的<code class="codeph">COPIES</code>选项会覆盖所有其他<code class="codeph">COPIES</code>或<code class="codeph">DUPLEX</code>设置，以控制备份集的双工。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-D0F9ADCE-DA22-475B-BDB6-A565E76A26F9__GUID-B53B4CE2-643D-47F3-BB53-B4312F22DBC3">使用BACKUP双工备份...副本：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>使用<code class="codeph">BACKUP</code>命令的<code class="codeph">COPIES</code>选项指定相同副本的数量。例如，运行以下命令以在默认<code class="codeph">DISK</code>位置中为每个备份集创建三个副本：</span><div><pre class="pre codeblock"><code>备份为BACKUPSET设备类型磁盘副本3增量级0数据库;</code></pre><p>由于您在<code class="codeph">BACKUP</code>命令中指定了<code class="codeph">COPIES</code> ，因此无论<code class="codeph">CONFIGURE DATAFILE COPIES</code>设置如何，RMAN都会为每个数据文件生成三个备份集。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>发出<code class="codeph">LIST BACKUP</code>命令以查看备份集和段的列表（ <code class="codeph">#Copies</code>列显示可能通过双工或多次调用<code class="codeph">BACKUP</code>命令生成的副本数）。例如，输入：</span><div><pre class="pre codeblock"><code>列表备份摘要;</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div>
            </div><a id="BRADV265"></a><a id="BRADV146"></a><div class="props_rev_3"><a id="GUID-EEA8D192-E7CD-4457-A0E3-5062EA2E8D0C" name="GUID-EEA8D192-E7CD-4457-A0E3-5062EA2E8D0C"></a><h3 id="BRADV-GUID-EEA8D192-E7CD-4457-A0E3-5062EA2E8D0C" class="sect3"><span class="enumeration_section">10.5</span>使用RMAN进行分割镜像备份</h3>
               <div>
                  <p>许多站点保留存储在磁盘上的数据库的备份，以防主数据库发生介质故障或不正确的用户操作需要时间点恢复。磁盘上的数据文件备份简化了恢复的恢复步骤，使恢复更加快速和可靠。</p>
                  <div class="section">
                     <div class="infoboxnote" id="GUID-EEA8D192-E7CD-4457-A0E3-5062EA2E8D0C__GUID-6CDE9417-57DC-4D23-A64F-AAF9874A4842">
                        <p class="notep1">警告：</p>
                        <p>切勿对联机重做日志进行备份，分割镜像或其他方式。恢复联机重做日志备份可以创建两个具有相同序列号但内容不同的归档日志。此外，最好使用<a href="../rcmrf/BACKUP.html#RCMRF107" target="_blank"><code class="codeph">BACKUP</code></a> <code class="codeph">CONTROLFILE</code>命令而不是分割镜像来进行控制文件备份。
                        </p>
                     </div>
                     <p>在磁盘上创建数据文件备份的一种方法是使用磁盘<a href="glossary.html#GUID-305BF676-5718-47C7-9902-A6E3A200A0DF"><span class="xrefglossterm">镜像</span></a> 。例如，操作系统可以在数据库中维护每个文件的三个相同副本。在此配置中，您可以拆分数据库的镜像副本以用作备份。
                     </p>
                     <p>RMAN不会自动拆分镜像，但可以在备份和恢复中使用分割镜像。例如，RMAN可以将数据文件的分割镜像视为数据文件副本，也可以将此副本备份到磁盘或磁带。本节中的过程说明如何使用<code class="codeph">ALTER SYSTEM SUSPEND</code> / <code class="codeph">RESUME</code>功能进行<a href="glossary.html#GUID-ECF69578-264C-4BFD-80BA-18135E703AF1"><span class="xrefglossterm">分割镜像备份</span></a> 。
                     </p>
                     <p>某些镜像技术不需要Oracle数据库在镜像可以分离并用作备份之前挂起所有I / O.有关是否必须从数据库实例挂起I / O的信息，请参阅存储管理器，卷管理器或文件系统文档。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-EEA8D192-E7CD-4457-A0E3-5062EA2E8D0C__GUID-234AD39A-DB9F-4850-99B3-E46EF5B03149">使用SUSPEND / RESUME创建表空间的分割镜像备份：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>启动RMAN，然后使用<a href="../sqlrf/ALTER-TABLESPACE.html#SQLRF01002" target="_blank"><code class="codeph">ALTER TABLESPACE ...将表空间放回备份模式<a href="../sqlrf/ALTER-TABLESPACE.html#SQLRF01002" target="_blank"><code class="codeph">ALTER TABLESPACE ...BEGIN BACKUP</code></a>声明。（要将所有表空间置于备份模式，您可以使用<a href="../sqlrf/ALTER-DATABASE.html#SQLRF00802" target="_blank"><code class="codeph">ALTER DATABASE BEGIN BACKUP</code></a> 。）</span><div>
                           <p>例如，要将表空间<code class="codeph">users</code>置于备份模式，请将RMAN连接到目标数据库并运行以下<code class="codeph">SQL</code>命令：</p><pre class="pre codeblock"><code>ALTER TABLESPACE用户BEGIN BACKUP;</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>如果您的镜像软件或硬件需要I / O，请暂停I / O.例如，在RMAN中输入以下命令：</span><div><pre class="pre codeblock"><code>ALTER SYSTEM SUSPEND;</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>拆分镜像以查找这些表空间中包含的基础数据文件。</span></li>
                     <li class="stepexpand"><span>将数据库从暂停状态中取出。例如，在RMAN中输入以下命令：</span><div><pre class="pre codeblock"><code>ALTER SYSTEM RESUME;</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>将表空间从备份模式中删除。例如，输入：</span><div><pre class="pre codeblock"><code>ALTER TABLESPACE用户END BACKUP;</code></pre><p>您还可以使用<code class="codeph">ALTER DATABASE END BACKUP</code>将所有表空间从备份模式中删除。
                           </p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>使用<a href="../rcmrf/CATALOG.html#RCMRF109" target="_blank"><code class="codeph">CATALOG</code></a>命令将用户管理的镜像副本编目为数据文件副本。例如，输入：</span><div><pre class="pre codeblock"><code>CATALOG DATAFILECOPY'/dk2/oradata/trgt/users01.dbf'; ＃catalog split mirror</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>备份数据文件副本。例如，在提示符处运行<code class="codeph">BACKUP</code> <code class="codeph">DATAFILECOPY</code>命令：</span><div><pre class="pre codeblock"><code>BACKUP DATAFILECOPY'/dk2/oradata/trgt/users01.dbf';</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>当您准备好<a href="glossary.html#GUID-108043D5-E36A-426F-B124-EB49460C2473"><span class="xrefglossterm">重新分割镜像时</span></a> ，首先使用<a href="../rcmrf/CHANGE.html#RCMRF110" target="_blank"><code class="codeph">CHANGE</code></a> <code class="codeph">...</code> <code class="codeph">UNCATALOG</code>命令用于取消您在步骤6中编目的数据文件副本的编目。例如，输入：</span><div><pre class="pre codeblock"><code>CHANGE DATAFILECOPY'/dk2/oradata/trgt/users01.dbf'UNCATALOG;</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>为受影响的数据文件重新分配镜像。</span><div>
                           <div class="infoboxnotealso" id="GUID-EEA8D192-E7CD-4457-A0E3-5062EA2E8D0C__GUID-F3946A3B-C46D-4013-A64F-685C169E0C5C">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><a href="user-managed-database-backups.html#GUID-F41318F6-A2F2-4518-9DB5-9EBB904EFB47">在SUSPEND模式下进行用户管理备份</a></p>
                                 </li>
                                 <li>
                                    <p>有关<code class="codeph">SUSPEND</code> / <code class="codeph">RESUME</code>功能的详细信息，请<code class="codeph">SUSPEND</code> <a href="../admin/starting-up-and-shutting-down.html#ADMIN004" target="_blank"><span><cite>“Oracle数据库管理员指南”</cite></span></a></p>
                                 </li>
                                 <li>
                                    <p><a href="../sqlrf/ALTER-SYSTEM.html#SQLRF00902" target="_blank"><code class="codeph">ALTER SYSTEM</code></a> <code class="codeph">SUSPEND</code>语法的<a href="../sqlrf/SQL-Statements-ALTER-LIBRARY-to-ALTER-SESSION.html#SQLRF009" target="_blank"><span><cite>Oracle数据库SQL语言参考</cite></span></a></p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                     </li>
                  </ol>
               </div>
            </div><a id="BRADV72450"></a><div class="props_rev_3"><a id="GUID-ECBE4965-57F7-49F0-BECD-734196F417F5" name="GUID-ECBE4965-57F7-49F0-BECD-734196F417F5"></a><h3 id="BRADV-GUID-ECBE4965-57F7-49F0-BECD-734196F417F5" class="sect3"><span class="enumeration_section">10.6</span>加密RMAN备份</h3>
               <div>
                  <p>您可以使用备份加密保护RMAN备份集。如果未经授权的用户获取加密备份，则无法读取这些备份。</p>
                  <p>RMAN备份加密功能需要数据库的企业版。</p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="backing-up-database-advanced.html#GUID-4637E7A1-DD0A-41DB-A242-41A6A8850122" title="备份加密基于指定的加密设置执行。">关于RMAN备份加密设置</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database-advanced.html#GUID-66452E9B-2DB5-4337-AE46-12DCDB4AC712">制作透明模式加密备份</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database-advanced.html#GUID-D36B54F4-5BFF-4FCE-9EDE-82CFF02B92A2" title="您可以通过执行SET ENCRYPTION BY PASSWORD命令在RMAN会话中设置加密密码。如果配置了透明加密，则指定ONLY关键字以指示备份受密码保护，而不是使用配置的透明加密。">制作密码模式加密备份</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database-advanced.html#GUID-DACE2E21-536D-4272-925F-1418F68B8A24" title="在RMAN提示符下使用SET ENCRYPTION BY PASSWORD命令进行受密码保护的备份。如果配置了透明加密，则省略ONLY关键字以指示备份受密码和配置的透明加密保护。">进行双模加密备份</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89573"></a><div class="props_rev_3"><a id="GUID-4637E7A1-DD0A-41DB-A242-41A6A8850122" name="GUID-4637E7A1-DD0A-41DB-A242-41A6A8850122"></a><h4 id="BRADV-GUID-4637E7A1-DD0A-41DB-A242-41A6A8850122" class="sect4"><span class="enumeration_section">10.6.1</span>关于RMAN备份加密设置</h4>
                  <div>
                     <p>备份加密基于指定的加密设置执行。</p>
                     <p>可以使用以下命令设置加密：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">配置加密</code> 
                           </p>
                           <p>您可以使用此命令持久配置透明加密。您无法持久配置双模式或密码模式加密。</p>
                        </li>
                        <li>
                           <p><code class="codeph">设置加密</code> 
                           </p>
                           <p>您可以使用此命令在<a href="glossary.html#GUID-01D29658-41E1-4D45-9C7F-A761D56885B9"><span class="xrefglossterm">RMAN会话</span></a>级别配置双模式或密码模式加密。
                           </p>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-4637E7A1-DD0A-41DB-A242-41A6A8850122__GUID-FD6FE073-3A41-4F20-BCB9-2EE1C0544FF8">
                        <p class="notep1">注意：</p>
                        <p>基于密钥库的加密比基于密码的加密更安全，因为不涉及密码。仅在绝对必要时才使用基于密码的加密，因为备份必须是可传输的。</p>
                     </div>
                     <p>数据库为每个加密备份使用新的加密密钥。然后，使用密码，数据库主密钥或两者对加密密钥进行加密，具体取决于所选的加密模式。单个备份加密密钥或密码永远不会以明文形式存储。</p>
                     <p>单个还原操作可以处理以不同模式加密的备份。对于要还原的每个备份片段，RMAN会检查它是否已加密。如果Oracle密钥库已打开且可用，则透明加密的备份无需干预。</p>
                     <p>如果检测到密码加密，则RMAN将在<code class="codeph">SET DECRYPTION</code>命令中输入的密码列表中搜索匹配的密钥。如果RMAN找到可用密钥，则恢复操作继续。否则，RMAN将在Oracle密钥库中搜索密钥。如果RMAN找到可用密钥，则恢复操作继续进行;否则，RMAN发出无法解密备份片段的错误信号。
                     </p>
                     <div class="infoboxnote" id="GUID-4637E7A1-DD0A-41DB-A242-41A6A8850122__GUID-4D82942B-F33A-4C59-A04D-50186D8CB558">
                        <p class="notep1">注意：</p>
                        <p>如果RMAN恢复使用不同密码创建的一组备份，则必须在<code class="codeph">SET DECRYPTION</code>包含所有必需的密码。
                        </p>
                     </div>
                     <p>RMAN加密是一项CPU密集型操作，可能会影响备份性能。加密期间的实际CPU利用率取决于磁盘和SBT的输入和输出设备是否比CPU可以加密数据更快地生成和使用数据。以下是管理和尝试最大化CPU性能的一些准则：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>由于加密备份比未加密备份消耗更多CPU资源，因此可以使用更多RMAN通道提高加密备份到磁盘的性能。一般规则是使用与系统中CPU核心数相同的通道数。例如，对于双核处理器使用两个通道。</p>
                        </li>
                        <li>
                           <p>如果磁盘子系统和SBT子系统都很快，则可以预期CPU利用率非常高。您可能需要考虑通过设置RMAN <code class="codeph">READRATE</code>参数来降低备份速率。例如，您可以设置块读取的上限，以便RMAN不会消耗过多的磁盘带宽，从而降低在线性能。
                           </p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-4637E7A1-DD0A-41DB-A242-41A6A8850122__GUID-9D3AFCB8-C121-4770-B248-D227A6977802">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="rman-complete-database-recovery.html#GUID-5E09344A-76D0-4188-A39D-CBA07F0B5C25" title="在完全恢复期间，RMAN将还原一个或多个数据文件，然后应用还原备份后生成的所有重做。">执行完整数据库恢复</a>以了解如何恢复密码加密的备份</p>
                           </li>
                           <li>
                              <p><a href="reporting-rman-operations.html#GUID-323B8278-BD20-4278-9770-53E1CF6AC986" title="V $ BACKUP_PIECE和V $ RMAN_BACKUP_PIECE视图的ENCRYPTED列指示备份片段是加密（YES）还是未加密（NO）。">确定备份片的加密状态</a></p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF153" target="_blank"><span><cite>Oracle数据库备份和恢复参考，</cite></span></a>以了解<code class="codeph">SET</code>命令的<code class="codeph">ENCRYPTION</code>和<code class="codeph">DECRYPTION</code>选项</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="BRADV89574"></a><div class="props_rev_3"><a id="GUID-66452E9B-2DB5-4337-AE46-12DCDB4AC712" name="GUID-66452E9B-2DB5-4337-AE46-12DCDB4AC712"></a><h4 id="BRADV-GUID-66452E9B-2DB5-4337-AE46-12DCDB4AC712" class="sect4"><span class="enumeration_section">10.6.2进行</span>透明模式加密备份</h4>
                  <div>
                     <div class="section">
                        <p>如果使用<code class="codeph">CONFIGURE</code>命令配置透明加密，如<span class="q">“ <a href="configuring-rman-client-advanced.html#GUID-BAA3CFF0-C95C-4AF2-90DD-764754325D73" title="您可以使用CONFIGURE命令持久配置备份的透明加密。">配置RMAN备份加密模式</a> ”中所述</span> ，则无需其他命令即可创建加密备份。正常进行RMAN备份。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV266"></a><a id="BRADV89575"></a><div class="props_rev_3"><a id="GUID-D36B54F4-5BFF-4FCE-9EDE-82CFF02B92A2" name="GUID-D36B54F4-5BFF-4FCE-9EDE-82CFF02B92A2"></a><h4 id="BRADV-GUID-D36B54F4-5BFF-4FCE-9EDE-82CFF02B92A2" class="sect4"><span class="enumeration_section">10.6.3进行</span>密码模式加密备份</h4>
                  <div>
                     <p>您可以通过执行<code class="codeph">SET ENCRYPTION BY PASSWORD</code>命令在RMAN会话中<code class="codeph">SET ENCRYPTION BY PASSWORD</code> 。如果配置了透明加密，则指定<code class="codeph">ONLY</code>关键字以指示备份受密码保护，而不是使用配置的透明加密。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-D36B54F4-5BFF-4FCE-9EDE-82CFF02B92A2__GUID-C6BE3E3D-B9C8-497C-905F-C4BFBE6529F8">要进行密码模式加密备份：</p>
                        <div class="infoboxnote" id="GUID-D36B54F4-5BFF-4FCE-9EDE-82CFF02B92A2__GUID-D95A7DBB-3EFE-4352-8BE0-A25C80BD23CD">
                           <p class="notep1">注意：</p>
                           <p>创建安全的密码。有关更多信息，请参见<a href="../dbseg/configuring-authentication.html#DBSEG33223" target="_blank"><span><cite>Oracle数据库安全指南</cite></span></a>
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用）。</span></li>
                        <li class="stepexpand"><span>执行<code class="codeph">SET ENCRYPTION ON IDENTIFIED BY</code> <span class="italic"><code class="codeph">password</code></span> <code class="codeph">ONLY</code>命令。</span><div>
                              <p>以下示例为备份中的所有表空间（其中<span class="italic">password</span>是您输入的实际密码的占位符）设置加密密码，并<code class="codeph">ONLY</code>指定加密<code class="codeph">ONLY</code>用于密码：</p><pre class="pre codeblock"><code>仅为所有表格<span class="italic">密码</span>设置<span class="italic">密码</span>设置加密;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>备份数据库。</span><div>
                              <p>例如，输入以下命令：</p><pre class="pre codeblock"><code>BACKUP DATABASE PLUS ARCHIVELOG;</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV267"></a><a id="BRADV89576"></a><div class="props_rev_3"><a id="GUID-DACE2E21-536D-4272-925F-1418F68B8A24" name="GUID-DACE2E21-536D-4272-925F-1418F68B8A24"></a><h4 id="BRADV-GUID-DACE2E21-536D-4272-925F-1418F68B8A24" class="sect4"><span class="enumeration_section">10.6.4进行</span>双模加密备份</h4>
                  <div>
                     <p>在RMAN提示符下使用<code class="codeph">SET ENCRYPTION BY PASSWORD</code>命令进行受密码保护的备份。如果配置了透明加密，则<span class="italic">省略</span> <code class="codeph">ONLY</code>关键字以指示备份受密码和配置的透明加密保护。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-DACE2E21-536D-4272-925F-1418F68B8A24__GUID-0D175ABE-580E-4728-9BD6-A9810E77BFF7">要进行双模加密备份：</p>
                        <div class="infoboxnote" id="GUID-DACE2E21-536D-4272-925F-1418F68B8A24__GUID-56A52898-79F9-4747-962D-6EFF50F8A8C9">
                           <p class="notep1">注意：</p>
                           <p>创建安全的密码。有关更多信息，请参见<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=DBSEG33223" target="_blank"><span><cite>Oracle数据库安全指南</cite></span></a>
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用）。</span></li>
                        <li class="stepexpand"><span>执行<code class="codeph">SET ENCRYPTION BY PASSWORD</code>命令，确保省略<code class="codeph">ONLY</code>关键字。</span><div>
                              <p>以下示例为备份中的所有表空间（其中<span class="italic">password</span>是您输入的实际密码的占位符）设置加密密码，并且<code class="codeph">ONLY</code>忽略以指示双模加密：</p><pre class="pre codeblock"><code>所有表格的<span class="italic">密码都</span>设置了加密标识;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>备份数据库。</span><div>
                              <p>例如，输入以下命令：</p><pre class="pre codeblock"><code>BACKUP DATABASE PLUS ARCHIVELOG;</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div>
            </div><a id="BRADV148"></a><div class="props_rev_3"><a id="GUID-DE4C87D6-4BE4-4B5A-A00F-CA17F301A975" name="GUID-DE4C87D6-4BE4-4B5A-A00F-CA17F301A975"></a><h3 id="BRADV-GUID-DE4C87D6-4BE4-4B5A-A00F-CA17F301A975" class="sect3"><span class="enumeration_section">10.7</span>重启RMAN备份</h3>
               <div>
                  <p>使用可重新启动的备份功能，RMAN仅备份在指定日期之后未备份的那些文件。</p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="backing-up-database-advanced.html#GUID-BBF25920-4071-4126-80BB-212F2B80C29B" title="可重启性的最小单位是数据文件。但是，如果备份集包含一个备份片，并且如果该片包含来自多个数据文件的块，则可重新启动单元是备份片。图像副本的可重启性单位是数据文件。">关于可重新启动的备份</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database-advanced.html#GUID-AE002ED5-2B57-4878-A759-E8F565F2610E" title="使用BACKUP命令的SINCE TIME参数指定需要新备份的日期。">部分完成后重新启动备份</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV114"></a><div class="props_rev_3"><a id="GUID-BBF25920-4071-4126-80BB-212F2B80C29B" name="GUID-BBF25920-4071-4126-80BB-212F2B80C29B"></a><h4 id="BRADV-GUID-BBF25920-4071-4126-80BB-212F2B80C29B" class="sect4"><span class="enumeration_section">10.7.1</span>关于可重新启动的备份</h4>
                  <div>
                     <p>可重启性的最小单位是数据文件。但是，如果备份集包含一个备份片，并且如果该片包含来自多个数据文件的块，则可重新启动单元是备份片。图像副本的可重启性单位是数据文件。</p>
                     <p>可重新启动备份的好处是，如果备份生成多个备份集，则无需重新运行成功完成的备份集。但是，如果将整个数据库写入一个备份集，并且如果备份中途失败，则必须重新启动整个备份。</p>
                     <p>RMAN在读取文件或写入备份片或映像副本时遇到的任何I / O错误都会导致RMAN终止正在进行的备份作业。例如，如果RMAN尝试备份数据文件但数据文件不在磁盘上，则RMAN会终止备份。但是，如果正在使用多个通道或正在创建备份的冗余副本，则RMAN可以在没有用户干预的情况下继续备份。</p>
                     <p>RMAN只能备份自指定日期以来尚未备份的文件。备份无法备份失败备份错过的数据库部分后使用此功能。</p>
                     <p>您可以通过在<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF107" target="_blank"><code class="codeph">BACKUP</code></a>命令上指定<code class="codeph">SINCE TIME</code>子句来重新启动备份。如果<code class="codeph">SINCE</code> <code class="codeph">TIME</code>晚于完成时间，则RMAN备份文件。如果在没有<code class="codeph">SINCE</code> <code class="codeph">TIME</code>参数的<code class="codeph">SINCE</code>下使用<code class="codeph">BACKUP DATABASE NOT BACKED UP</code> ，则RMAN仅备份从未备份过的文件。
                     </p>
                     <div class="infoboxnotealso" id="GUID-BBF25920-4071-4126-80BB-212F2B80C29B__GUID-37553B13-8202-4F1C-849D-373D61663740">
                        <p class="notep1">也可以看看：</p>
                        <p>用于<code class="codeph">BACKUP ... <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF107" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a> <code class="codeph">BACKUP ...NOT BACKED UP</code>语法</p>
                     </div>
                  </div>
               </div><a id="BRADV268"></a><a id="BRADV89577"></a><div class="props_rev_3"><a id="GUID-AE002ED5-2B57-4878-A759-E8F565F2610E" name="GUID-AE002ED5-2B57-4878-A759-E8F565F2610E"></a><h4 id="BRADV-GUID-AE002ED5-2B57-4878-A759-E8F565F2610E" class="sect4"><span class="enumeration_section">10.7.2</span>部分完成后重新启动备份</h4>
                  <div>
                     <p>使用<code class="codeph">BACKUP</code>命令的<code class="codeph">SINCE</code> <code class="codeph">TIME</code>参数指定需要新备份的日期。
                     </p>
                     <div class="section">
                        <p>如果<code class="codeph">SINCE</code> <code class="codeph">TIME</code>晚于完成时间，则RMAN备份文件。如果在没有<code class="codeph">SINCE</code> <code class="codeph">TIME</code>参数的<code class="codeph">SINCE</code>下使用<code class="codeph">BACKUP DATABASE NOT BACKED UP</code> ，则RMAN仅备份从未备份过的文件。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-AE002ED5-2B57-4878-A759-E8F565F2610E__GUID-8B960CAE-1074-4F24-AE3E-D6CD50727C6A">仅备份指定日期之后未备份的文件：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用）。</span></li>
                        <li class="stepexpand"><span>执行<code class="codeph">BACKUP ...NOT BACKED UP SINCE TIME</code>命令后NOT BACKED UP SINCE TIME</code> 。</span><div>
                              <p>在<code class="codeph">SINCE</code> <code class="codeph">TIME</code>参数中指定有效日期。以下示例使用默认配置的通道备份过去两周内尚未备份的所有数据库文件和归档重做日志：</p><pre class="pre codeblock"><code>备份没有备份，因为'SYSDATE-14'数据库加上ARCHIVELOG;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-AE002ED5-2B57-4878-A759-E8F565F2610E__GUID-4FBE8C43-D1D7-453A-8587-41248F910200">
                           <p class="notep1">也可以看看：</p>
                           <p>有关如何使用<code class="codeph">BACKUP</code>命令重新启动未完成的备份的示例，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF107" target="_blank"><span><cite>参见Oracle数据库备份和恢复参考</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV301"></a><div class="props_rev_3"><a id="GUID-AC3D62EE-FF00-43B9-97CC-3EDF295D2C7D" name="GUID-AC3D62EE-FF00-43B9-97CC-3EDF295D2C7D"></a><h3 id="BRADV-GUID-AC3D62EE-FF00-43B9-97CC-3EDF295D2C7D" class="sect3"><span class="enumeration_section">10.8</span>管理备份Windows</h3>
               <div>
                  <p>本节介绍如何使用备份窗口设置备份作业完成时间范围的限制。</p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="backing-up-database-advanced.html#GUID-C506BFE1-E4DB-40FD-AB66-D4E00323E029" title="备份窗口是备份必须完成的一段时间。例如，您可能希望将数据库备份限制在系统上的用户活动较少时的时间窗口，例如凌晨2:00到6:00之间">关于备份Windows</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database-advanced.html#GUID-83D2ABBB-192C-4475-88AF-7A4B9F13C234" title="使用BACKUP命令的DURATION参数指定允许运行给定备份作业的时间。">指定备份持续时间</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database-advanced.html#GUID-B01BBEBF-2286-4DAE-A48B-7A695123B3D9" title="指定PARTIAL时，由于备份窗口结束，备份中断时RMAN不会报告错误。相反，RMAN会显示一条消息，显示未备份哪些文件。">允许在备份窗口中进行部分备份</a></p>
                     </li>
                     <li>
                        <p><a href="backing-up-database-advanced.html#GUID-87D29BAC-CD55-4DEB-8F80-056A600CF196" title="使用DURATION时，您可以以最大可能性能运行备份，或者在仍然在指定时间内完成的同时尽可能慢地运行备份，以最大限度地降低备份任务对性能的影响。">最小化备份负载和持续时间</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV89578"></a><div class="props_rev_3"><a id="GUID-C506BFE1-E4DB-40FD-AB66-D4E00323E029" name="GUID-C506BFE1-E4DB-40FD-AB66-D4E00323E029"></a><h4 id="BRADV-GUID-C506BFE1-E4DB-40FD-AB66-D4E00323E029" class="sect4"><span class="enumeration_section">10.8.1</span>关于备份Windows</h4>
                  <div>
                     <p>备份窗口是备份必须完成的一段时间。例如，您可能希望将数据库备份限制在系统上的用户活动较少时的时间窗口，例如凌晨2:00到6:00之间</p>
                     <p>RMAN首先备份最近最少备份的文件。默认情况下，RMAN以最大可能的速度备份文件。指定窗口并不意味着RMAN比正常情况更快地备份数据，以确保备份在窗口结束之前完成。</p>
                     <p>默认情况下，如果备份未在<code class="codeph">DURATION</code>时间内完成，则RMAN会中断备份并报告错误。如果<code class="codeph">BACKUP</code>命令在<a href="../rcmrf/RUN.html#RCMRF151" target="_blank"><code class="codeph">RUN</code></a>命令中，则<code class="codeph">RUN</code>命令终止。即使整个备份未完成，也会保留任何已完成的备份集并可用于还原操作。因此，如果重试在可用持续时间到期时中断的作业，则每次连续尝试都会覆盖更多需要备份的文件。丢弃任何不完整的备份集。
                     </p>
                  </div>
               </div><a id="BRADV269"></a><a id="BRADV89579"></a><div class="props_rev_3"><a id="GUID-83D2ABBB-192C-4475-88AF-7A4B9F13C234" name="GUID-83D2ABBB-192C-4475-88AF-7A4B9F13C234"></a><h4 id="BRADV-GUID-83D2ABBB-192C-4475-88AF-7A4B9F13C234" class="sect4"><span class="enumeration_section">10.8.2</span>指定备份持续时间</h4>
                  <div>
                     <p>使用<code class="codeph">BACKUP</code>命令的<code class="codeph">DURATION</code>参数指定允许运行给定备份作业的时间。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-83D2ABBB-192C-4475-88AF-7A4B9F13C234__GUID-DB1A2E53-BC28-4B39-A3DF-52DE004EF963">要指定备份持续时间：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用）。</span></li>
                        <li class="stepexpand"><span>执行<code class="codeph">BACKUP DURATION</code>命令。</span><div>
                              <p>例如，在凌晨2:00运行以下命令以指定备份运行到早上6:00：</p><pre class="pre codeblock"><code>BACKUP DURATION 4:00 TABLESPACE用户;</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-83D2ABBB-192C-4475-88AF-7A4B9F13C234__GUID-C6D6487C-CB73-410C-B3F5-3E7711A0D3B8">
                           <p class="notep1">也可以看看：</p>
                           <p>有关<code class="codeph">BACKUP</code>命令语法的<a href="../rcmrf/BACKUP.html#RCMRF107" target="_blank"><span><cite>Oracle数据库备份和恢复参考</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="BRADV270"></a><a id="BRADV89580"></a><div class="props_rev_3"><a id="GUID-B01BBEBF-2286-4DAE-A48B-7A695123B3D9" name="GUID-B01BBEBF-2286-4DAE-A48B-7A695123B3D9"></a><h4 id="BRADV-GUID-B01BBEBF-2286-4DAE-A48B-7A695123B3D9" class="sect4"><span class="enumeration_section">10.8.3</span>在备份窗口中允许部分备份</h4>
                  <div>
                     <p>指定<code class="codeph">PARTIAL</code> ，由于备份窗口结束，备份中断时RMAN不会报告错误。相反，RMAN会显示一条消息，显示未备份哪些文件。
                     </p>
                     <div class="section">
                        <p>如果<code class="codeph">BACKUP</code>命令是一个的一部分<code class="codeph">RUN</code>块，然后在其余的命令<code class="codeph">RUN</code>块继续执行。
                        </p>
                        <p>如果指定<code class="codeph">FILESPERSET 1</code> ，则RMAN会将每个文件放入其自己的备份集中。备份在备份窗口结束时中断时，只会丢失当前正在备份的文件的备份。保存窗口期间完成的所有备份集，最大限度地减少因备份窗口结束而导致的丢失工作。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-B01BBEBF-2286-4DAE-A48B-7A695123B3D9__GUID-333629C9-0D5B-4A36-8EC0-1F562E6455FD">防止RMAN在备份部分完成时发出错误：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动RMAN并连接到目标数据库和恢复目录（如果使用）。</span></li>
                        <li class="stepexpand"><span>使用<code class="codeph">PARTIAL</code>选项执行<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=RCMRF107" target="_blank"><code class="codeph">BACKUP DURATION</code></a>命令。</span><div>
                              <p>例如，您在凌晨2:00运行以下命令，以指定备份运行到上午6:00，并且每个数据文件位于单独的备份集中：</p><pre class="pre codeblock"><code>BACKUP DURATION 4:00 PARTIAL TABLESPACE用户FILESPERSET 1;</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV271"></a><a id="BRADV272"></a><a id="BRADV89581"></a><div class="props_rev_3"><a id="GUID-87D29BAC-CD55-4DEB-8F80-056A600CF196" name="GUID-87D29BAC-CD55-4DEB-8F80-056A600CF196"></a><h4 id="BRADV-GUID-87D29BAC-CD55-4DEB-8F80-056A600CF196" class="sect4"><span class="enumeration_section">10.8.4</span>最小化备份负载和持续时间</h4>
                  <div>
                     <p>使用<code class="codeph">DURATION</code>您可以以最大可能性能运行备份，或者在仍然在指定时间内完成的同时尽可能慢地运行备份，以最大限度地降低备份任务对性能的影响。
                     </p>
                     <div class="section">
                        <p>要最大限度地提高性能，请使用<code class="codeph">DURATION</code>的<code class="codeph">MINIMIZE TIME</code>选项，如<a href="backing-up-database-advanced.html#GUID-87D29BAC-CD55-4DEB-8F80-056A600CF196__CIHIHEHB">例10-4</a>所示。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-87D29BAC-CD55-4DEB-8F80-056A600CF196__CIHIHEHB">
                        <p class="titleinexample">示例10-4使用MINIMIZE TIME和BACKUP DURATION</p><pre class="pre codeblock"><code>备份持续时间4:00部分最小时间数据库文件1;</code></pre><p>要将备份扩展为使用可用的全部时间，请使用<code class="codeph">MINIMIZE LOAD</code>选项，如<a href="backing-up-database-advanced.html#GUID-87D29BAC-CD55-4DEB-8F80-056A600CF196__CHDBGBHG">例10-5所示</a> 。
                        </p>
                     </div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-87D29BAC-CD55-4DEB-8F80-056A600CF196__CHDBGBHG">
                        <p class="titleinexample">示例10-5使用MINIMIZE LOAD和BACKUP DURATION</p>
                        <p>在此示例中，RMAN监视正在运行的备份的进度，并定期估计备份以其当前速率完成的时间。如果RMAN估计备份将在备份窗口结束之前完成，则会降低备份速率，以便使用完整的可用持续时间。这减少了与备份关联的数据库的开销。</p><pre class="pre codeblock"><code>备份持续时间4:00最小负载数据库FILESPERSET 1;</code></pre><p>将<code class="codeph">DURATION</code>和<code class="codeph">MINIMIZE LOAD</code>与磁带备份一起使用时请注意以下问题：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>高效备份到磁带需要磁带流。如果使用<code class="codeph">MINIMIZE LOAD</code> ，则RMAN可能会将备份速率降低到磁带流不是最佳的点。
                              </p>
                           </li>
                           <li>
                              <p>RMAN在整个备份窗口期间保留磁带资源。这可以防止在备份窗口期间将磁带资源用于任何其他目的。</p>
                           </li>
                        </ul>
                        <p>由于这些问题，建议您在备份到磁带时使用<code class="codeph">MINIMIZE LOAD</code> 。
                        </p>
                        <div class="infoboxnotealso" id="GUID-87D29BAC-CD55-4DEB-8F80-056A600CF196__GUID-3E2F2D69-ED89-4D18-B550-04DB8200C9D2">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="tuning-rman-performance.html#GUID-AD7E0880-DEDB-4339-80E6-125F40591F8F" title="多种因素会影响备份到磁带的速度。">SBT写入阶段的介质管理器组件，</a>了解有效磁带处理的更多详细信息</p>
                        </div>
                     </div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>