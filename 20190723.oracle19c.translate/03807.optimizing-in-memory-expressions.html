<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="In the context of the IM column store, an expression is a combination of one or more values, operators, and SQL or PL/SQL functions (DETERMINISTIC only) that resolve to a value."></meta>
      <meta name="description" content="In the context of the IM column store, an expression is a combination of one or more values, operators, and SQL or PL/SQL functions (DETERMINISTIC only) that resolve to a value."></meta>
      <title>使用内存表达式优化查询</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Database In-Memory Guide"></meta>
      <meta property="og:description" content="In the context of the IM column store, an expression is a combination of one or more values, operators, and SQL or PL/SQL functions (DETERMINISTIC only) that resolve to a value."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Database In-Memory Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-memory-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-04-22T09:02:38-07:00"></meta>
      <meta name="dcterms.title" content="Database In-Memory Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="2016, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96137-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="advanced-optimizations-for-in-memory-queries.html" title="Previous" type="text/html"></link>
      <link rel="next" href="optimizing-queries-with-join-groups.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="INMEM"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="advanced-optimizations-for-in-memory-queries.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="optimizing-queries-with-join-groups.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">数据库内存指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="advanced-optimizations-for-in-memory-queries.html" property="item" typeof="WebPage"><span property="name">优化内存中查询</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">使用内存表达式优化查询</li>
            </ol>
            <a id="GUID-5F82168D-A024-4F96-B3AF-7DA4C52908B8" name="GUID-5F82168D-A024-4F96-B3AF-7DA4C52908B8"></a>
            
            <h2 id="INMEM-GUID-5F82168D-A024-4F96-B3AF-7DA4C52908B8" class="sect2"><span class="enumeration_chapter">7</span>使用内存表达式优化查询</h2>
         </header>
         <div class="ind">
            <div>
               <p>在IM列存储的上下文中， <span class="bold">表达式</span>是一个或多个值，运算符以及解析为值的SQL或PL / SQL函数（仅限<code class="codeph">DETERMINISTIC</code> ）的组合。
               </p>
               <p><a href="glossary.html#GUID-B960FD8D-DE6F-44DD-BA36-43A72EB5611A"><span class="xrefglossterm">表达式统计信息存储（ESS）</span></a>自动跟踪经常评估（“热”）表达式的结果。您可以使用<code class="codeph">DBMS_INMEMORY_ADMIN</code>包捕获热表达式并将它们填充为隐藏的虚拟列，或删除其中的部分或全部。
               </p>
               <p>本节包含以下主题：</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="optimizing-in-memory-expressions.html#GUID-1B849DAF-277E-4B09-8275-367592115B06">关于IM表达式</a><br>默认情况下， <code class="codeph">DBMS_INMEMORY_ADMIN.IME_CAPTURE_EXPRESSIONS</code>过程标识并填充“热”表达式，称为<strong class="term">内存中表达式（IM表达式）</strong> 。
                  </li>
                  <li class="ulchildlink"><a href="optimizing-in-memory-expressions.html#GUID-B2342B74-D67D-4B16-9CC7-C31CA69903CC">配置IM表达式用法</a><br>（可选）使用<code class="codeph">INMEMORY_EXPRESSIONS_USAGE</code>选择哪些类型的IM表达式符合填充条件，或禁用所有IM表达式的填充。
                  </li>
                  <li class="ulchildlink"><a href="optimizing-in-memory-expressions.html#GUID-DE164F9A-64E9-4A28-B906-A8CDEC0C1974">捕获和填充IM表达式</a><br><code class="codeph">IME_CAPTURE_EXPRESSIONS</code>过程<span>在指定的时间间隔内捕获数据库中20个最常访问（“最热”）的表达式。</span> <code class="codeph">IME_POPULATE_EXPRESSIONS</code>过程<span>强制在最新的<code class="codeph">DBMS_INMEMORY_ADMIN.IME_CAPTURE_EXPRESSIONS</code>调用中捕获表达式。</span></li>
                  <li class="ulchildlink"><a href="optimizing-in-memory-expressions.html#GUID-581C803B-56F2-4FD6-95DB-40B6B85DE857">删除IM表达式</a><br><code class="codeph">DBMS_INMEMORY_ADMIN.IME_DROP_ALL_EXPRESSIONS</code>过程<span>删除数据库中的所有<code class="codeph">SYS_IME</code>表达式虚拟列。</span> <code class="codeph">DBMS_INMEMORY.IME_DROP_EXPRESSIONS</code>过程<span>从表中删除指定的一组<code class="codeph">SYS_IME</code>虚拟列。</span></li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="advanced-optimizations-for-in-memory-queries.html#GUID-33034151-7BD7-4186-B336-C693FBB27634" title="本部分介绍如何使用内存表达式，连接组和内存中聚合来优化查询。它还解释了IM列存储如何重新填充已修改的数据。">优化内存中查询</a></p>
                  </div>
               </div>
            </div>
            
            <div class="sect2"><a id="GUID-1B849DAF-277E-4B09-8275-367592115B06" name="GUID-1B849DAF-277E-4B09-8275-367592115B06"></a><h3 id="INMEM-GUID-1B849DAF-277E-4B09-8275-367592115B06" class="sect3"><span class="enumeration_section">7.1</span>关于IM表达式</h3>
               <div>
                  <p>默认情况下， <code class="codeph">DBMS_INMEMORY_ADMIN.IME_CAPTURE_EXPRESSIONS</code>过程标识并填充“热”表达式，称为<strong class="term">内存中表达式（IM表达式）</strong> 。
                  </p>
                  <p>IM表达式在堆组织表中实现为隐藏<a href="glossary.html#GUID-DB2ADC54-6222-48C2-90EF-E191CF63FD2D"><span class="xrefglossterm">虚拟列</span></a> ，但是以与非虚拟列相同的方式访问。为了存储物化表达式，IM列存储使用特殊的压缩格式，例如固定宽度向量和带有固定宽度代码的字典编码。
                  </p>
                  <div class="infoboxnote" id="GUID-1B849DAF-277E-4B09-8275-367592115B06__GUID-C9B769FF-163E-413D-9DE6-1D7B89C6AD62">
                     <p class="notep1">注意：</p>
                     <p>外部表不支持IM表达式。</p>
                  </div>
                  <p>Oracle数据库自动识别IM列存储中填充的候选表达式。在<code class="codeph">DBA_IM_EXPRESSIONS.COLUMN_NAME</code> ，IM表达式列具有前缀<code class="codeph">SYS_IME</code> 。您无法直接创建<code class="codeph">SYS_IME</code>列。例如，考虑以下查询，该查询指定两个表达式，别名为<code class="codeph">weekly_sal</code>和<code class="codeph">ann_comp</code> ：</p><pre class="pre codeblock"><code>选择employee_id，last_name，salary，commission_pct，ROUND（薪水* 12 / 52,2）为“weekly_sal”，12 *（薪水* NVL（commission_pct，0）+薪水）为“ann_comp”FROM employees ORDER BY ann_comp;</code></pre><p>算术表达式<code class="codeph">ROUND(salary*12/52,2)</code>和<code class="codeph">12*(salary*NVL(commission_pct,0)+salary)</code>是计算密集型并且经常被访问，这使得它们成为隐藏IM表达列的候选者。
                  </p>
                  <p><code class="codeph">DBMS_INMEMORY_ADMIN</code>包是管理IM表达式的主要接口：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>要诱导数据库识别IM表达式并在下一次<a href="glossary.html#GUID-9168517C-C8A2-4433-946A-037631B840E2"><span class="xrefglossterm">重新填充</span></a>期间将它们添加到各自的表中，请使用<code class="codeph">IME_CAPTURE_EXPRESSIONS</code> 。</p>
                     </li>
                     <li>
                        <p>要强制立即填充IM表达式，请使用<code class="codeph">IME_POPULATE_EXPRESSIONS</code> 。</p>
                     </li>
                     <li>
                        <p>要删除<code class="codeph">SYS_IME</code>列，请使用<code class="codeph">DBMS_INMEMORY_ADMIN.IME_DROP_ALL_EXPRESSIONS</code>或<code class="codeph">DBMS_INMEMORY.IME_DROP_EXPRESSIONS</code> 。</p>
                     </li>
                  </ul>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="optimizing-in-memory-expressions.html#GUID-C241A1F0-2DC7-46F9-8CB8-F72ABE2C4081">IM表达式的目的</a><br>IM表达式通过预先计算计算密集型表达式来加速大型数据集的查询。
                     </li>
                     <li class="ulchildlink"><a href="optimizing-in-memory-expressions.html#GUID-0F5B137B-A900-4946-ADDF-75AD3055802F">IM表达式如何工作</a><br>要将表达式标识为IM表达式的候选者，数据库将查询ESS。优化程序使用ESS维护有关堆组织表的表达式评估的统计信息。
                     </li>
                     <li class="ulchildlink"><a href="optimizing-in-memory-expressions.html#GUID-F823DF2B-2FD0-4E81-AB55-B06A52B098B7">IM表达式的用户界面</a><br><code class="codeph">DBMS_INMEMORY_ADMIN</code>包， <code class="codeph">DBMS_INMEMORY</code>包和<code class="codeph">INMEMORY_EXPRESSIONS_USAGE</code>初始化参数控制IM表达式的行为。
                     </li>
                     <li class="ulchildlink"><a href="optimizing-in-memory-expressions.html#GUID-5D07375B-1F63-49BD-80E0-28B5363607A2">IM表达式的基本任务</a><br><code class="codeph">INMEMORY_EXPRESSIONS_USAGE</code>的默认设置使数据库可以使用动态和静态IM表达式。必须使用<code class="codeph">DBMS_INMEMORY_ADMIN</code>填充IM列存储中的表达式。
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-1B849DAF-277E-4B09-8275-367592115B06__ORACLEDATABASEREFERENCETOLEARNABOUT-FA093721">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="q">“ <a href="populating-objects-in-memory.html#GUID-37E2E218-33A2-490E-891D-B627906DE16B" title="要使外部表格符合人口，请指定外部表格...CREATE TABLE或ALTER TABLE中的INMEMORY子句。">内存外部表</a> ”</span></p>
                        </li>
                        <li>
                           <p><a href="../sqlrf/Expressions.html#SQLRF004" target="_blank"><span><cite>Oracle Database SQL语言参考</cite></span></a>以了解有关表达式的更多信息</p>
                        </li>
                        <li>
                           <p><a href="../arpls/DBMS_INMEMORY_ADMIN.html#ARPLS-GUID-94B7C99C-BB9D-46E4-9E16-5E466D99FAA6" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以了解有关<code class="codeph">DBMS_INMEMORY_ADMIN</code>更多信息</p>
                        </li>
                        <li>
                           <p><a href="../refrn/DBA_IM_EXPRESSIONS.html#GUID-44900E64-09C8-40AD-BC7A-A59DC70E0EDA" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解有关<code class="codeph">DBA_IM_EXPRESSIONS</code>视图的更多信息</p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="optimizing-in-memory-expressions.html#GUID-5F82168D-A024-4F96-B3AF-7DA4C52908B8" title="在IM列存储的上下文中，表达式是一个或多个值，运算符以及解析为值的SQL或PL / SQL函数（仅限DETERMINISTIC）的组合。">使用内存表达式优化查询</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-C241A1F0-2DC7-46F9-8CB8-F72ABE2C4081" name="GUID-C241A1F0-2DC7-46F9-8CB8-F72ABE2C4081"></a><h4 id="INMEM-GUID-C241A1F0-2DC7-46F9-8CB8-F72ABE2C4081" class="sect4"><span class="enumeration_section">7.1.1</span> IM表达式的用途</h4>
                  <div>
                     <p>IM表达式通过预先计算计算密集型表达式来加速大型数据集的查询。</p>
                     <p>IM表达式特别有益于经常执行的表连接，投影和谓词评估。IM表达式的主要优点如下：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>查询不需要每次都重新计算表达式。如果IM列存储未填充表达式结果，则数据库必须为每行计算它们，这可能是资源密集型的。数据库在填充期间产生CPU开销。</p>
                        </li>
                        <li>
                           <p>IM表达式的具体化使数据库能够利用性能增强功能，如SIMD矢量处理和<a href="glossary.html#GUID-824EDD0E-2FF3-411E-A2B2-C7B542EADFDC"><span class="xrefglossterm">IMCU修剪</span></a> 。
                           </p>
                        </li>
                        <li>
                           <p>数据库而不是用户跟踪在用户指定的<span>表达式捕获窗口中</span>哪些表达式最活跃。
                           </p>
                        </li>
                     </ul>
                     <p>IM表达式和物化视图解决了同样的问题：如何避免重复计算表达式。但是，IM表达式优于物化视图：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>IM表达式可以捕获未持久存储的数据。</p>
                           <p>例如，IM列存储可以根据查询中的表达式自动缓存内部计算。</p>
                        </li>
                        <li>
                           <p>要有效使用，物化视图必须包含查询中列出的所有列，否则查询必须加入视图和基表。相反，任何包含IM表达式的查询都会受益。</p>
                        </li>
                        <li>
                           <p>与物化视图（用户创建的对象）不同，数据库自动识别和创建IM表达式。</p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-C241A1F0-2DC7-46F9-8CB8-F72ABE2C4081__GUID-BFE8EBEC-3555-4FBF-84C1-68B64FAC2FD9">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="in-memory-column-store-architecture.html#GUID-A38FF2B6-506E-412A-9FE5-1CE709556379" title="每个IMCU标头都会自动为其CU创建和管理内存存储索引（IM存储索引）。IM存储索引存储IMCU中所有列的最小值和最大值。">内存存储索引</a> ”</span></p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="in-memory-column-store-architecture.html#GUID-BF90E4D7-DA7B-4B2B-A0BB-AE88E0C39757" title="表达式统计信息存储（ESS）是由优化程序维护的存储库，用于存储有关表达式评估的统计信息。ESS驻留在SGA中并保留在磁盘上。">表达式统计存储（ESS）</a> ”</span></p>
                           </li>
                           <li>
                              <p><a href="../dwhsg/basic-materialized-views.html#GUID-A7AE8E5D-68A5-4519-81EB-252EAAF0ADFF" target="_blank"><span><cite>Oracle数据库数据仓库指南</cite></span></a> ，了解有关物化视图的更多信息</p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizing-in-memory-expressions.html#GUID-1B849DAF-277E-4B09-8275-367592115B06" title="默认情况下，DBMS_INMEMORY_ADMIN.IME_CAPTURE_EXPRESSIONS过程标识并填充“热”表达式，称为内存中表达式（IM表达式）。">关于IM表达式</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-0F5B137B-A900-4946-ADDF-75AD3055802F" name="GUID-0F5B137B-A900-4946-ADDF-75AD3055802F"></a><h4 id="INMEM-GUID-0F5B137B-A900-4946-ADDF-75AD3055802F" class="sect4"><span class="enumeration_section">7.1.2</span> IM表达式的工作原理</h4>
                  <div>
                     <p>要将表达式标识为IM表达式的候选者，数据库将查询ESS。优化程序使用ESS维护有关堆组织表的表达式评估的统计信息。</p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="optimizing-in-memory-expressions.html#GUID-FDA8B0D3-6339-4E19-8D2D-EEA0A7529B46">IM表达基础设施</a><br>IM表达式基础结构负责计算和填充IM表达式，IM虚拟列以及IM列存储中的任何其他有用内部计算的结果。这些优化主要有利于分析查询。
                        </li>
                        <li class="ulchildlink"><a href="optimizing-in-memory-expressions.html#GUID-B9E46C0C-F076-4651-A476-4B137A0E8A71">捕获IM表达式</a><br>当您调用<code class="codeph">IME_CAPTURE_EXPRESSIONS</code>过程时，数据库将查询ESS，并识别指定时间范围内最常访问的20个（“最热”）表达式。
                        </li>
                        <li class="ulchildlink"><a href="optimizing-in-memory-expressions.html#GUID-3E1BF45A-7BB3-4B7E-A4FE-819FE22D232B">ESS如何运作</a><br>ESS是由优化程序维护的存储库，用于存储有关表达式评估的统计信息。
                        </li>
                        <li class="ulchildlink"><a href="optimizing-in-memory-expressions.html#GUID-5ECB1746-6616-48D2-899C-55338628A871">数据库如何填充IM表达式</a><br>在内存协调器进程（IMCO）的指导下，空间管理工作进程（W <span class="italic">nnn</span> ）自动将IM表达式加载到IMEU中。
                        </li>
                        <li class="ulchildlink"><a href="optimizing-in-memory-expressions.html#GUID-576D47DF-3B3C-4162-B193-65DC01AC797B">IMEU与IMCU的关系</a><br>对于任何行，物理列驻留在IMCU中，虚拟列驻留在关联的IMEU中。 IMEU是只读和柱状的，就像IMCU一样。</li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizing-in-memory-expressions.html#GUID-1B849DAF-277E-4B09-8275-367592115B06" title="默认情况下，DBMS_INMEMORY_ADMIN.IME_CAPTURE_EXPRESSIONS过程标识并填充“热”表达式，称为内存中表达式（IM表达式）。">关于IM表达式</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="sect4"><a id="GUID-FDA8B0D3-6339-4E19-8D2D-EEA0A7529B46" name="GUID-FDA8B0D3-6339-4E19-8D2D-EEA0A7529B46"></a><h5 id="INMEM-GUID-FDA8B0D3-6339-4E19-8D2D-EEA0A7529B46" class="sect5"><span class="enumeration_section">7.1.2.1</span> IM表达式基础结构</h5>
                     <div>
                        <p>IM表达式基础结构负责计算和填充IM表达式，IM虚拟列以及IM列存储中的任何其他有用内部计算的结果。这些优化主要有利于分析查询。</p>
                        <p>填充结果可以包括对项目，扫描或连接表达式中使用的列的函数评估。IM列存储可以在查询评估期间根据SQL运行时引擎评估的表达式自动缓存内部计算。</p>
                        <div class="section">
                           <p class="subhead3" id="GUID-FDA8B0D3-6339-4E19-8D2D-EEA0A7529B46__GUID-F9864E8C-F2EE-49F1-83C6-337A28DBD204">虚拟列</p>
                           <p>除了填充IM表达式之外，IM列存储还可以填充<a href="glossary.html#GUID-14ED4E9B-C17D-46B4-9E03-538CA90448CC"><span class="xrefglossterm">In-Memory虚拟列</span></a> 。底层机制是相同的：IM表达式是一个虚拟列。但是，IM虚拟列是用户创建和公开的，而IM表达式是数据库创建和隐藏的。
                           </p>
                           <div class="infoboxnotealso" id="GUID-FDA8B0D3-6339-4E19-8D2D-EEA0A7529B46__GUID-487D9DD4-6835-41C7-8DB8-2E0A1CC8CE4A">
                              <p class="notep1">也可以看看：</p>
                              <p><span class="q">“ <a href="populating-objects-in-memory.html#GUID-452D19AE-EB5F-44AC-A1AD-70CF10D2D347" title="您可以为内部表中的各个列指定INMEMORY子句。外部表不支持在列级别指定INMEMORY。">为内存中的表启用和禁用列</a> ”</span></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-FDA8B0D3-6339-4E19-8D2D-EEA0A7529B46__GUID-3677A454-08F3-4ADF-B349-14A27600BDA3">静态表达式：二进制JSON列</p>
                           <p>IM表达式基础结构支持动态表达式（IM表达式和虚拟列）和静态表达式。</p>
                           <p>从<span>Oracle Database 12c</span>第2版（12.2）开始，IM列存储支持<a href="glossary.html#GUID-96C1EFE2-69DD-4E78-97DA-25253A51E3A5"><span class="xrefglossterm">OSON</span></a> ，这是一种二进制JSON格式，其性能优于面向行的JSON文本存储。查询访问实际的JSON数据，但使用优化的虚拟列来加快访问速度。
                           </p>
                           <p>数据库使用IM表达式基础结构将JSON文本列的有效二进制表示形式加载为虚拟列。如果为<code class="codeph">VARCHAR2</code>数据类型将<code class="codeph">MAX_STRING_SIZE</code>初始化参数设置为<code class="codeph">EXTENDED</code> ，则IM列存储可以存储最多32 KB的OSON虚拟列。</p>
                           <p>Oracle数据库支持多种JSON函数： <code class="codeph">JSON_TABLE</code> ， <code class="codeph">JSON_VALUE</code>和<code class="codeph">JSON_EXISTS</code> 。 <code class="codeph">INMEMORY_EXPRESSIONS_USAGE</code>初始化参数控制动态表达式和静态表达式的行为。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-FDA8B0D3-6339-4E19-8D2D-EEA0A7529B46__GUID-99E22AAA-823C-45EB-86EE-F9A35BB93788">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="../adjsn/in-memory-json-data.html#ADJSN-GUID-857A2E95-28AB-4314-B654-4CB05C50D9CF" target="_blank"><span><cite>Oracle Database JSON开发人员指南</cite></span></a> ，了解有关将JSON与数据库内存中一起使用的更多信息</p>
                              </li>
                              <li>
                                 <p><span><cite>Oracle数据库参考</cite></span> ，了解<a href="../refrn/INMEMORY_EXPRESSIONS_USAGE.html#REFRN-GUID-9B926459-CA8A-4843-B9A1-4DE6F630EB45" target="_blank"><code class="codeph">INMEMORY_EXPRESSIONS_USAGE</code></a> ， <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/inmem&amp;id=GUID-0FEC03C4-8F07-47C0-8FC0-A771EBF5D057" target="_blank"><code class="codeph">ALL_JSON_COLUMNS</code></a>和<a href="../refrn/MAX_STRING_SIZE.html#GUID-D424D23B-0933-425F-BC69-9C0E6724693C" target="_blank"><code class="codeph">MAX_STRING_SIZE</code></a></p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizing-in-memory-expressions.html#GUID-0F5B137B-A900-4946-ADDF-75AD3055802F" title="要将表达式标识为IM表达式的候选者，数据库将查询ESS。优化程序使用ESS维护有关堆组织表的表达式评估的统计信息。">IM表达式的工作原理</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-B9E46C0C-F076-4651-A476-4B137A0E8A71" name="GUID-B9E46C0C-F076-4651-A476-4B137A0E8A71"></a><h5 id="INMEM-GUID-B9E46C0C-F076-4651-A476-4B137A0E8A71" class="sect5"><span class="enumeration_section">7.1.2.2</span>捕获IM表达式</h5>
                     <div>
                        <p>当您调用<code class="codeph">IME_CAPTURE_EXPRESSIONS</code>过程时，数据库将查询ESS，并识别指定时间范围内最常访问的20个（“最热”）表达式。
                        </p>
                        <p>时间范围是用户指定的时间窗口，过去24小时或自数据库创建以来。数据库仅考虑在IM列存储中至少部分填充的表上的表达式。</p>
                        <p>本节包含以下主题：</p>
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="optimizing-in-memory-expressions.html#GUID-8A7D3942-774D-4143-A087-81DBCD2C176B">表达式捕获间隔</a><br><strong class="term">表达式捕获间隔</strong>是数据库评估表达式以进行可能捕获的时间段。
                           </li>
                           <li class="ulchildlink"><a href="optimizing-in-memory-expressions.html#GUID-05B20684-447D-40A0-974D-665893F00695">隐藏的SYS_IME虚拟列</a><br>在捕获期间，数据库将20个最热门的表达式作为隐藏的<code class="codeph">SYS_IME</code>虚拟列添加到其各自的表中，并应用默认的<code class="codeph">INMEMORY</code>列压缩子句。
                           </li>
                        </ul>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizing-in-memory-expressions.html#GUID-0F5B137B-A900-4946-ADDF-75AD3055802F" title="要将表达式标识为IM表达式的候选者，数据库将查询ESS。优化程序使用ESS维护有关堆组织表的表达式评估的统计信息。">IM表达式的工作原理</a></p>
                           </div>
                        </div>
                     </div>
                     
                     <div class="sect5"><a id="GUID-8A7D3942-774D-4143-A087-81DBCD2C176B" name="GUID-8A7D3942-774D-4143-A087-81DBCD2C176B"></a><h6 id="INMEM-GUID-8A7D3942-774D-4143-A087-81DBCD2C176B" class="sect6"><span class="enumeration_section">7.1.2.2.1</span>表达式捕获间隔</h6>
                        <div>
                           <p><strong class="term">表达式捕获间隔</strong>是数据库评估表达式以进行可能捕获的时间段。
                           </p>
                           <p>从<span>Oracle Database 18c</span>开始， <code class="codeph">DBMS_INMEMORY_ADMIN.IME_CAPTURE_EXPRESSIONS</code>过程的<code class="codeph">snapshot</code>参数接受以下定义表达式捕获间隔的值：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">累积</code></p>
                                 <p>数据库会考虑自创建数据库以来的所有表达式统计信息。</p>
                              </li>
                              <li>
                                 <p><code class="codeph">当前</code></p>
                                 <p>数据库仅考虑过去24小时内的表达式统计信息。</p>
                              </li>
                              <li>
                                 <p><code class="codeph">窗口</code></p>
                                 <p>数据库为在最近的用户指定的<span>表达式捕获窗口中</span>跟踪的表达式添加隐藏的虚拟列。打开此窗口，手动调用<code class="codeph">IME_OPEN_CAPTURE_WINDOW</code>过程，然后通过手动调用<code class="codeph">IME_CLOSE_CAPTURE_WINDOW</code>过程关闭。
                                 </p>
                                 <p>如果捕获窗口当前处于打开状态，则数据库将考虑当前窗口中跟踪的所有表达式，直到此时为止，然后实现最热门的表达式。要列出在当前窗口中跟踪的表达式， <code class="codeph">DBA_EXPRESSION_STATISTICS</code>使用<code class="codeph">SNAPSHOT = 'WINDOW'</code>查询<code class="codeph">DBA_EXPRESSION_STATISTICS</code> 。
                                 </p>
                              </li>
                           </ul>
                           <p>用户定义的时间间隔（ <code class="codeph">snapshot='WINDOW'</code> ）对于确保仅考虑在此窗口中出现的表达式进行实现非常有用。当短间隔代表整个工作负载时，此机制特别有用。例如，在交易窗口期间，经纪公司可以收集表达式集，并在IM列存储中实现它们，以加速整个工作负载的未来查询处理。
                           </p>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-8A7D3942-774D-4143-A087-81DBCD2C176B__GUID-6BC08ACB-70EA-4DA4-A6CA-2D4023CEA439">
                              <p class="notep1">也可以看看：</p>
                              <p><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span>以了解有关<a href="../arpls/DBMS_INMEMORY_ADMIN.html#ARPLS-GUID-C75097B2-961E-4824-A6F3-319AB0CC513B" target="_blank"><code class="codeph">IME_OPEN_CAPTURE_WINDOW</code></a> ， <a href="../arpls/DBMS_INMEMORY_ADMIN.html#ARPLS-GUID-2809E03B-5367-4C18-97E4-16C62F77C343" target="_blank"><code class="codeph">IME_CLOSE_CAPTURE_WINDOW</code></a>和<a href="../arpls/DBMS_INMEMORY_ADMIN.html#ARPLS-GUID-70CDDB1F-A928-4AD5-9632-5F1C5DEF5DC9" target="_blank"><code class="codeph">IME_CAPTURE_EXPRESSIONS</code></a>更多信息</p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="optimizing-in-memory-expressions.html#GUID-B9E46C0C-F076-4651-A476-4B137A0E8A71" title="当您调用IME_CAPTURE_EXPRESSIONS过程时，数据库将查询ESS，并识别指定时间范围内最常访问的20个（“最热”）表达式。">捕获IM表达式</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-05B20684-447D-40A0-974D-665893F00695" name="GUID-05B20684-447D-40A0-974D-665893F00695"></a><h6 id="INMEM-GUID-05B20684-447D-40A0-974D-665893F00695" class="sect6"><span class="enumeration_section">7.1.2.2.2</span>隐藏的SYS_IME虚拟列</h6>
                        <div>
                           <p>在捕获期间，数据库将20个最热门的表达式作为隐藏的<code class="codeph">SYS_IME</code>虚拟列添加到其各自的表中，并应用默认的<code class="codeph">INMEMORY</code>列压缩子句。
                           </p>
                           <p>如果在上一次调用期间添加的<code class="codeph">SYS_IME</code>列不再出现在最新的表达式列表中，则其属性将更改为<code class="codeph">NO INMEMORY</code> 。</p>
                           <div class="figure" id="GUID-05B20684-447D-40A0-974D-665893F00695__GUID-7E513557-3F84-4D51-B688-411A830AD122">
                              <p class="titleinfigure">图7-1定义隐藏的SYS_IME虚拟列</p><img src="img/inmem_3v_031.png" alt="下面是图7-1的描述" title="下面是图7-1的描述" longdesc="img_text/inmem_3v_031.html"><br><a href="img_text/inmem_3v_031.html">“图7-1定义隐藏的SYS_IME虚拟列”的说明</a></div>
                           <!-- class="figure" -->
                           <p>无论属性是否为<code class="codeph">INMEMORY</code> ，表的最大<code class="codeph">SYS_IME</code>列数为50。在表达到50表达式限制后，数据库不会添加新的<code class="codeph">SYS_IME</code>列。要允许新表达式，必须使用<code class="codeph">DBMS_INMEMORY.IME_DROP_EXPRESSIONS</code>或<code class="codeph">DBMS_INMEMORY_ADMIN.IME_DROP_ALL_EXPRESSIONS</code>过程删除<code class="codeph">SYS_IME</code>列。
                           </p>
                           <p><code class="codeph">SYS_IME</code>虚拟列和用户定义的虚拟列都计入表的1000列限制。例如，如果表包含980个非虚拟（磁盘上）列，则只能添加20个虚拟列。
                           </p>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-05B20684-447D-40A0-974D-665893F00695__GUID-375CF065-97BA-478F-8AE9-AFC098BEF298">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/inmem&amp;id=ARPLS-GUID-70CDDB1F-A928-4AD5-9632-5F1C5DEF5DC9" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以了解有关<code class="codeph">DBMS_INMEMORY_ADMIN</code>更多信息</p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="optimizing-in-memory-expressions.html#GUID-B9E46C0C-F076-4651-A476-4B137A0E8A71" title="当您调用IME_CAPTURE_EXPRESSIONS过程时，数据库将查询ESS，并识别指定时间范围内最常访问的20个（“最热”）表达式。">捕获IM表达式</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-3E1BF45A-7BB3-4B7E-A4FE-819FE22D232B" name="GUID-3E1BF45A-7BB3-4B7E-A4FE-819FE22D232B"></a><h5 id="INMEM-GUID-3E1BF45A-7BB3-4B7E-A4FE-819FE22D232B" class="sect5"><span class="enumeration_section">7.1.2.3</span> ESS的工作<span class="enumeration_section">原理</span></h5>
                     <div>
                        <p>ESS是由优化程序维护的存储库，用于存储有关表达式评估的统计信息。</p>
                        <p>对于每个表，ESS维护表达式统计信息，例如执行频率和评估成本。在评估谓词时，Oracle数据库会跟踪并提供有关评估计数和表达式动态成本的运行时反馈。根据ESS统计信息，如果特定表达式是IM表达式，数据库可以决定查询的性能会更好。</p>
                        <div class="infoboxnote" id="GUID-3E1BF45A-7BB3-4B7E-A4FE-819FE22D232B__GUID-07679A2D-C373-44E6-9A40-2687A094C57A">
                           <p class="notep1">注意：</p>
                           <p>在ESS中为特定表缓存的表达式仅涉及此表的列。当Oracle数据库将确定性PL / SQL函数识别为IM表达式的候选者时，此规则尤为重要。</p>
                        </div>
                        <div class="figure" id="GUID-3E1BF45A-7BB3-4B7E-A4FE-819FE22D232B__GUID-36A4A20C-B391-417E-BB98-3685B7DFEA1E">
                           <p class="titleinfigure">图7-2 ESS和IM表达式</p>
                           <p>在此图中，ESS确定了<code class="codeph">employees</code>表中两个常用的表达式： <code class="codeph">ROUND(salary*12/52,2)</code>和<code class="codeph">12*(salary*NVL(commission_pct,0)+salary)</code> 。当数据库填充IM列存储中的<code class="codeph">employees</code>时，两个IMCU存储列数据。每个IMCU都与其唯一的IMEU相关联，其中包含该IMCU中行的两个常用表达式的派生值。</p><img src="img/cncpt_vm_381.png" alt="下面是图7-2的描述" title="下面是图7-2的描述" longdesc="img_text/cncpt_vm_381.html"><br><a href="img_text/cncpt_vm_381.html">“图7-2 ESS和IM表达式”的描述</a></div>
                        <!-- class="figure" -->
                        <p>并非每个表达式都是IM表达式的候选者。数据库仅考虑将经常访问的表达式。由于IM表达式是作为隐藏虚拟列实现的，因此它们还必须满足虚拟列的限制。</p>
                        <p>虽然IM列存储是ESS的客户端，但ESS独立于Database In-Memory功能。其他客户端也可以使用ESS统计信息，包括优化程序本身。</p>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-3E1BF45A-7BB3-4B7E-A4FE-819FE22D232B__GUID-BBCE7467-15C4-4420-B60E-6CF6B7BAE549">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="in-memory-column-store-architecture.html#GUID-BF90E4D7-DA7B-4B2B-A0BB-AE88E0C39757" title="表达式统计信息存储（ESS）是由优化程序维护的存储库，用于存储有关表达式评估的统计信息。ESS驻留在SGA中并保留在磁盘上。">表达式统计存储（ESS）</a> ”</span></p>
                              </li>
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/inmem&amp;id=GUID-38DBFC2E-FC6C-46E2-A7A1-6FA703F9DC01" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a> ，了解有关虚拟列的更多信息</p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizing-in-memory-expressions.html#GUID-0F5B137B-A900-4946-ADDF-75AD3055802F" title="要将表达式标识为IM表达式的候选者，数据库将查询ESS。优化程序使用ESS维护有关堆组织表的表达式评估的统计信息。">IM表达式的工作原理</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-5ECB1746-6616-48D2-899C-55338628A871" name="GUID-5ECB1746-6616-48D2-899C-55338628A871"></a><h5 id="INMEM-GUID-5ECB1746-6616-48D2-899C-55338628A871" class="sect5"><span class="enumeration_section">7.1.2.4</span>数据库如何填充IM表达式</h5>
                     <div>
                        <p>在内存协调器进程（IMCO）的指导下，空间管理工作进程（W <span class="italic">nnn</span> ）自动将IM表达式加载到IMEU中。
                        </p>
                        <p>数据库使用有关要填充哪些虚拟列（用户定义的或IM表达式）的信息来增加每个<a href="glossary.html#GUID-7AEF93DF-0F39-4B5D-BFEE-DD3FDBD86398"><span class="xrefglossterm">内存中压缩单元（IMCU）</span></a>填充或重新填充任务。决定取决于<code class="codeph">INMEMORY_EXPRESSION_USAGE</code>和<code class="codeph">INMEMORY_VIRTUAL_COLUMNS</code>初始化参数的设置。
                        </p>
                        <div class="infoboxnote" id="GUID-5ECB1746-6616-48D2-899C-55338628A871__GUID-164C823E-52C8-4FED-98AF-CBB4A3DF9980">
                           <p class="notep1">注意：</p>
                           <p><code class="codeph">DBMS_INMEMORY.IME_CAPTURE_EXPRESSIONS</code>过程将自动检测到的表达式添加为隐藏虚拟列。
                           </p>
                        </div>
                        <p>W <span class="italic">nnn</span>进程创建IMCU。要创建IMEU，进程将执行以下附加步骤：</p>
                        <ol>
                           <li>
                              <p>创建表达式值</p>
                           </li>
                           <li>
                              <p>将值转换为柱状格式，并将其压缩为内存表达式单元（IMEU）</p>
                           </li>
                           <li>
                              <p>将每个IMEU链接到其关联的IMCU</p>
                           </li>
                        </ol>
                        <div class="infoboxnote" id="GUID-5ECB1746-6616-48D2-899C-55338628A871__GUID-DA830FF2-0B6A-4391-A38B-76E4AF38F0E9">
                           <p class="notep1">注意：</p>
                           <p>随着要存储在IMEU中的表达式数量的增加，工作进程可能会消耗更多的CPU来计算表达式值。这种开销可能会增加人口时间。</p>
                        </div>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-5ECB1746-6616-48D2-899C-55338628A871__GUID-767295ED-5DFD-403E-A108-D99E9DE91C0A">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="in-memory-column-store-architecture.html#GUID-BF90E4D7-DA7B-4B2B-A0BB-AE88E0C39757" title="表达式统计信息存储（ESS）是由优化程序维护的存储库，用于存储有关表达式评估的统计信息。ESS驻留在SGA中并保留在磁盘上。">表达式统计存储（ESS）</a> ”</span></p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="in-memory-column-store-architecture.html#GUID-C91A11F9-CFB7-4919-A8D7-8572ED1CAEF3" title="空间管理工作者流程（Wnnn）代表IMCO填充或重新填充数据。">空间管理工作者流程（Wnnn）</a> ”</span></p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="in-memory-column-store-architecture.html#GUID-E1A74436-E719-4FC3-A141-41B160792E51" title="内存中表达单元（IMEU）是物化内存表达式（IM表达式）和用户定义虚拟列的存储容器。">内存表达单元（IMEUs）</a> ”</span></p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_INMEMORY_ADMIN.html#GUID-70CDDB1F-A928-4AD5-9632-5F1C5DEF5DC9" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a>以了解有关<code class="codeph">DBMS_INMEMORY.IME_CAPTURE_EXPRESSIONS</code>过程的更多信息</p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizing-in-memory-expressions.html#GUID-0F5B137B-A900-4946-ADDF-75AD3055802F" title="要将表达式标识为IM表达式的候选者，数据库将查询ESS。优化程序使用ESS维护有关堆组织表的表达式评估的统计信息。">IM表达式的工作原理</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-576D47DF-3B3C-4162-B193-65DC01AC797B" name="GUID-576D47DF-3B3C-4162-B193-65DC01AC797B"></a><h5 id="INMEM-GUID-576D47DF-3B3C-4162-B193-65DC01AC797B" class="sect5"><span class="enumeration_section">7.1.2.5</span> IMEU与IMCU的关系</h5>
                     <div>
                        <p>对于任何行，物理列驻留在IMCU中，虚拟列驻留在关联的IMEU中。 IMEU是只读和柱状的，就像IMCU一样。</p>
                        <p>由于IMEU是为特定<code class="codeph">INMEMORY</code>段创建的IMCU的逻辑扩展，因此默认情况下它们继承<code class="codeph">INMEMORY</code>子句和Oracle Real Applications Cluster（Oracle RAC）属性，例如<code class="codeph">DISTRIBUTE</code>和<code class="codeph">DUPLICATE</code> 。 IMEU与一个且仅一个IMCU相关联。数据库将IMEU作为单独的结构进行管理，使其更易于添加和删除。
                        </p>
                        <div class="infoboxnote" id="GUID-576D47DF-3B3C-4162-B193-65DC01AC797B__GUID-0572EB70-DCD8-4FDF-8AD4-77BFB53061B8">
                           <p class="notep1">注意：</p>
                           <p>IMEU还包含用户创建的IM虚拟列。</p>
                        </div>
                        <p>如果源数据发生更改，则数据库会在<a href="glossary.html#GUID-9168517C-C8A2-4433-946A-037631B840E2"><span class="xrefglossterm">重新填充</span></a>期间更改IM表达式中的派生数据。例如，如果事务更新表中的100个工资值，则空间管理工作进程（W <span class="italic">nnn</span> ）会自动更新从这100个更改的值派生的所有IM表达式值。数据库一起重新填充IMCU及其相关的IMEU，而不是首先重新填充所有IMCU，然后重新填充所有IMEU。在IMCU重新填充期间，IMEE仍可用于查询。
                        </p>
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizing-in-memory-expressions.html#GUID-0F5B137B-A900-4946-ADDF-75AD3055802F" title="要将表达式标识为IM表达式的候选者，数据库将查询ESS。优化程序使用ESS维护有关堆组织表的表达式评估的统计信息。">IM表达式的工作原理</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
               <div class="sect3"><a id="GUID-F823DF2B-2FD0-4E81-AB55-B06A52B098B7" name="GUID-F823DF2B-2FD0-4E81-AB55-B06A52B098B7"></a><h4 id="INMEM-GUID-F823DF2B-2FD0-4E81-AB55-B06A52B098B7" class="sect4"><span class="enumeration_section">7.1.3</span> IM表达式的用户界面</h4>
                  <div>
                     <p><code class="codeph">DBMS_INMEMORY_ADMIN</code>包， <code class="codeph">DBMS_INMEMORY</code>包和<code class="codeph">INMEMORY_EXPRESSIONS_USAGE</code>初始化参数控制IM表达式的行为。
                     </p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="optimizing-in-memory-expressions.html#GUID-F74CB689-DE3A-4A5B-AD34-816002DD6408">INMEMORY_EXPRESSIONS_USAGE</a><br><code class="codeph">INMEMORY_EXPRESSIONS_USAGE</code>初始化参数确定填充哪种类型的IM表达式。<code class="codeph">INMEMORY_VIRTUAL_COLUMNS</code>初始化参数控制正常（非隐藏）虚拟列的填充。
                        </li>
                        <li class="ulchildlink"><a href="optimizing-in-memory-expressions.html#GUID-7D9F419F-A787-4BE7-A277-EF0EDCADE49C">DBMS_INMEMORY_ADMIN和DBMS_INMEMORY</a><br>要管理IM表达式，请使用<code class="codeph">DBMS_INMEMORY_ADMIN</code>和<code class="codeph">DBMS_INMEMORY</code>包。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizing-in-memory-expressions.html#GUID-1B849DAF-277E-4B09-8275-367592115B06" title="默认情况下，DBMS_INMEMORY_ADMIN.IME_CAPTURE_EXPRESSIONS过程标识并填充“热”表达式，称为内存中表达式（IM表达式）。">关于IM表达式</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="sect4"><a id="GUID-F74CB689-DE3A-4A5B-AD34-816002DD6408" name="GUID-F74CB689-DE3A-4A5B-AD34-816002DD6408"></a><h5 id="INMEM-GUID-F74CB689-DE3A-4A5B-AD34-816002DD6408" class="sect5"><span class="enumeration_section">7.1.3.1</span> INMEMORY_EXPRESSIONS_USAGE</h5>
                     <div>
                        <p><code class="codeph">INMEMORY_EXPRESSIONS_USAGE</code>初始化参数确定填充哪种类型的IM表达式。<code class="codeph">INMEMORY_VIRTUAL_COLUMNS</code>初始化参数控制正常（非隐藏）虚拟列的填充。
                        </p>
                        <div class="section">
                           <p>启用IM列存储（ <code class="codeph">INMEMORY_SIZE</code>非零）时， <code class="codeph">INMEMORY_EXPRESSIONS_USAGE</code>控制数据库填充的IM表达式的类型。<code class="codeph">INMEMORY_EXPRESSIONS_USAGE</code>初始化参数具有以下选项：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">ENABLE</code></p>
                                 <p id="GUID-F74CB689-DE3A-4A5B-AD34-816002DD6408__d5e292">数据库将静态和动态IM表达式填充到IM列存储中。设置此值会增加某些表的内存占用量。这是默认值。</p>
                              </li>
                              <li>
                                 <p><code class="codeph">STATIC_ONLY</code></p>
                                 <p id="GUID-F74CB689-DE3A-4A5B-AD34-816002DD6408__d5e298">静态配置使IM列存储能够缓存OSON（二进制JSON）列，这些列标记有<code class="codeph">IS_JSON</code>检查约束。在内部，OSON列是名为<code class="codeph">SYS_IME_OSON</code>的隐藏虚拟列。</p>
                              </li>
                              <li>
                                 <p><code class="codeph">DYNAMIC_ONLY</code></p>
                                 <p id="GUID-F74CB689-DE3A-4A5B-AD34-816002DD6408__d5e310">数据库仅填充已作为<code class="codeph">SYS_IME</code>隐藏虚拟列添加到表中的常用或“热”表达式。设置此值会增加某些表的内存占用量。
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">DISABLE</code></p>
                                 <p id="GUID-F74CB689-DE3A-4A5B-AD34-816002DD6408__d5e319">数据库不会将任何IM表达式（无论是静态还是动态）填充到IM列存储中。</p>
                              </li>
                           </ul>
                           <p>更改<code class="codeph">INMEMORY_EXPRESSIONS_USAGE</code>的值不会立即影响当前在IM列存储中填充的IM表达式。例如，如果将<code class="codeph">INMEMORY_EXPRESSIONS_USAGE</code>从<code class="codeph">DYNAMIC_ONLY</code>更改为<code class="codeph">DISABLE</code> ，则数据库不会立即删除存储的IM表达式。相反，下一个重新填充会排除禁用的IM表达式，从而有效地删除它们。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-F74CB689-DE3A-4A5B-AD34-816002DD6408__GUID-99E22AAA-823C-45EB-86EE-F9A35BB93788">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/inmem&amp;id=ADJSN-GUID-857A2E95-28AB-4314-B654-4CB05C50D9CF" target="_blank"><span class="italic">Oracle Database JSON开发人员指南</span></a> ，了解有关将JSON与数据库内存中一起使用的更多信息</p>
                              </li>
                              <li>
                                 <p><span><cite>Oracle Database Reference</cite></span>了解<a href="../refrn/INMEMORY_EXPRESSIONS_USAGE.html#REFRN-GUID-9B926459-CA8A-4843-B9A1-4DE6F630EB45" target="_blank"><code class="codeph">INMEMORY_EXPRESSIONS_USAGE</code></a>和<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/inmem&amp;id=GUID-0FEC03C4-8F07-47C0-8FC0-A771EBF5D057" target="_blank"><code class="codeph">ALL_JSON_COLUMNS</code></a></p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizing-in-memory-expressions.html#GUID-F823DF2B-2FD0-4E81-AB55-B06A52B098B7" title="DBMS_INMEMORY_ADMIN包，DBMS_INMEMORY包和INMEMORY_EXPRESSIONS_USAGE初始化参数控制IM表达式的行为。">IM表达式的用户界面</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-7D9F419F-A787-4BE7-A277-EF0EDCADE49C" name="GUID-7D9F419F-A787-4BE7-A277-EF0EDCADE49C"></a><h5 id="INMEM-GUID-7D9F419F-A787-4BE7-A277-EF0EDCADE49C" class="sect5"><span class="enumeration_section">7.1.3.2</span> DBMS_INMEMORY_ADMIN和DBMS_INMEMORY</h5>
                     <div>
                        <p>要管理IM表达式，请使用<code class="codeph">DBMS_INMEMORY_ADMIN</code>和<code class="codeph">DBMS_INMEMORY</code>包。
                        </p>
                        <div class="section">
                           <p class="subhead3" id="GUID-7D9F419F-A787-4BE7-A277-EF0EDCADE49C__GUID-5D2A4069-017B-4D77-A340-AA5DF7993D83">用于管理IM表达式的PL / SQL过程</p>
                           <div class="tblformal" id="GUID-7D9F419F-A787-4BE7-A277-EF0EDCADE49C__GUID-C1FDB104-9B32-47C0-B4AC-D263D7288856">
                              <table cellpadding="4" cellspacing="0" class="Formal" title="" border="1" summary="This table describes procedures in the DBMS_INMEMORY_ADMIN and DBMS_INMEMORY packages that relate to IM expressions." frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="20%" id="d21514e2590">包</th>
                                       <th align="left" valign="bottom" width="20%" id="d21514e2593">程序</th>
                                       <th align="left" valign="bottom" width="20%" id="d21514e2596">描述</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d21514e2601" headers="d21514e2590 ">
                                          <p><code class="codeph">DBMS_INMEMORY_ADMIN</code></p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d21514e2601 d21514e2593 ">
                                          <p><code class="codeph">IME_OPEN_CAPTURE_WINDOW</code></p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d21514e2601 d21514e2596 ">
                                          <p><span>此过程表示表达式捕获窗口的开始。</span></p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d21514e2614" headers="d21514e2590 ">
                                          <p><code class="codeph">DBMS_INMEMORY_ADMIN</code></p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d21514e2614 d21514e2593 ">
                                          <p><code class="codeph">IME_CLOSE_CAPTURE_WINDOW</code></p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d21514e2614 d21514e2596 ">
                                          <p><span>此过程表示当前表达式捕获窗口的结束。</span></p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d21514e2627" headers="d21514e2590 ">
                                          <p><code class="codeph">DBMS_INMEMORY_ADMIN</code></p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d21514e2627 d21514e2593 ">
                                          <p><code class="codeph">IME_GET_CAPTURE_STATE</code></p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d21514e2627 d21514e2596 ">
                                          <p><span>此过程返回表达式捕获窗口的当前捕获状态和最近修改的时间戳。</span></p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d21514e2640" headers="d21514e2590 ">
                                          <p><code class="codeph">DBMS_INMEMORY_ADMIN</code></p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d21514e2640 d21514e2593 ">
                                          <p><code class="codeph">IME_CAPTURE_EXPRESSIONS</code></p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d21514e2640 d21514e2596 ">
                                          <p>此过程捕获指定时间范围内数据库中20个最常访问（“最热”）的表达式。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d21514e2652" headers="d21514e2590 ">
                                          <p><code class="codeph">DBMS_INMEMORY_ADMIN</code></p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d21514e2652 d21514e2593 ">
                                          <p><code class="codeph">IME_POPULATE_EXPRESSIONS</code></p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d21514e2652 d21514e2596 ">
                                          <p>此过程强制在<code class="codeph">IME_CAPTURE_EXPRESSIONS</code>过程的最新调用中捕获的IM表达式的<code class="codeph">IME_CAPTURE_EXPRESSIONS</code> 。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d21514e2667" headers="d21514e2590 ">
                                          <p><code class="codeph">DBMS_INMEMORY_ADMIN</code></p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d21514e2667 d21514e2593 ">
                                          <p><code class="codeph">IME_DROP_ALL_EXPRESSIONS</code></p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d21514e2667 d21514e2596 ">
                                          <p>此过程将删除数据库中的所有<code class="codeph">SYS_IME</code>虚拟列。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d21514e2682" headers="d21514e2590 ">
                                          <p><code class="codeph">DBMS_INMEMORY</code></p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d21514e2682 d21514e2593 ">
                                          <p><code class="codeph">IME_DROP_EXPRESSIONS</code></p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d21514e2682 d21514e2596 ">
                                          <p>此过程从表中删除指定的一组<code class="codeph">SYS_IME</code>虚拟列。
                                          </p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-7D9F419F-A787-4BE7-A277-EF0EDCADE49C__GUID-4A6A7977-B430-4484-9EE2-5D16C90BAFF7">
                           <p class="notep1">也可以看看：</p>
                           <p><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span>以了解有关<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/inmem&amp;id=ARPLS-GUID-2333DC40-794B-434B-9B1F-9A0AF8356515" target="_blank"><code class="codeph">DBMS_INMEMORY</code></a>和<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/inmem&amp;id=ARPLS-GUID-398720DF-7D8D-4418-B395-5F7C5FC85BC5" target="_blank"><code class="codeph">DBMS_INMEMORY_ADMIN</code></a>包的更多信息</p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizing-in-memory-expressions.html#GUID-F823DF2B-2FD0-4E81-AB55-B06A52B098B7" title="DBMS_INMEMORY_ADMIN包，DBMS_INMEMORY包和INMEMORY_EXPRESSIONS_USAGE初始化参数控制IM表达式的行为。">IM表达式的用户界面</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div>
               <div class="sect3"><a id="GUID-5D07375B-1F63-49BD-80E0-28B5363607A2" name="GUID-5D07375B-1F63-49BD-80E0-28B5363607A2"></a><h4 id="INMEM-GUID-5D07375B-1F63-49BD-80E0-28B5363607A2" class="sect4"><span class="enumeration_section">7.1.4</span> IM表达式的基本任务</h4>
                  <div>
                     <p><code class="codeph">INMEMORY_EXPRESSIONS_USAGE</code>的默认设置使数据库可以使用动态和静态IM表达式。必须使用<code class="codeph">DBMS_INMEMORY_ADMIN</code>填充IM列存储中的表达式。
                     </p>
                     <p>通常，您按以下顺序执行IM表达式任务：</p>
                     <ol>
                        <li>
                           <p>（可选）更改数据库可以使用的IM表达式的类型。</p>
                           <p>请参阅<span class="q">“ <a href="optimizing-in-memory-expressions.html#GUID-B2342B74-D67D-4B16-9CC7-C31CA69903CC" title="（可选）使用INMEMORY_EXPRESSIONS_USAGE选择哪些类型的IM表达式符合填充条件，或禁用所有IM表达式的填充。">配置IM表达式用法</a> ”</span> 。
                           </p>
                        </li>
                        <li>
                           <p>捕获并填充IM表达式。</p>
                           <p>请参阅<span class="q">“ <a href="optimizing-in-memory-expressions.html#GUID-DE164F9A-64E9-4A28-B906-A8CDEC0C1974" title="IME_CAPTURE_EXPRESSIONS过程在指定的时间间隔内捕获数据库中20个最常访问（“最热”）的表达式。IME_POPULATE_EXPRESSIONS过程强制在最新的DBMS_INMEMORY_ADMIN.IME_CAPTURE_EXPRESSIONS调用中捕获表达式。">捕获和填充IM表达式</a> ”</span> 。
                           </p>
                        </li>
                        <li>
                           <p>（可选）删除部分或全部IM表达式。</p>
                           <p>请参阅<span class="q">“ <a href="optimizing-in-memory-expressions.html#GUID-581C803B-56F2-4FD6-95DB-40B6B85DE857" title="DBMS_INMEMORY_ADMIN.IME_DROP_ALL_EXPRESSIONS过程删除数据库中的所有SYS_IME表达式虚拟列。DBMS_INMEMORY.IME_DROP_EXPRESSIONS过程从表中删除指定的一组SYS_IME虚拟列。">删除IM表达式</a> ”</span> 。
                           </p>
                        </li>
                     </ol>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizing-in-memory-expressions.html#GUID-1B849DAF-277E-4B09-8275-367592115B06" title="默认情况下，DBMS_INMEMORY_ADMIN.IME_CAPTURE_EXPRESSIONS过程标识并填充“热”表达式，称为内存中表达式（IM表达式）。">关于IM表达式</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
            <div class="sect2"><a id="GUID-B2342B74-D67D-4B16-9CC7-C31CA69903CC" name="GUID-B2342B74-D67D-4B16-9CC7-C31CA69903CC"></a><h3 id="INMEM-GUID-B2342B74-D67D-4B16-9CC7-C31CA69903CC" class="sect3"><span class="enumeration_section">7.2</span>配置IM表达式使用</h3>
               <div>
                  <p>（可选）使用<code class="codeph">INMEMORY_EXPRESSIONS_USAGE</code>选择哪些类型的IM表达式符合填充条件，或禁用所有IM表达式的填充。
                  </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-B2342B74-D67D-4B16-9CC7-C31CA69903CC__GUID-7635209B-AEDE-4D20-9AA0-5E378E596C6E">先决条件</p>
                     <p>要使数据库能够使用IM表达式，必须满足以下条件：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">INMEMORY_SIZE</code>初始化参数设置为非零值。
                           </p>
                        </li>
                        <li>
                           <p>初始化参数<code class="codeph">COMPATIBLE</code>值设置为12.2.0或更高。
                           </p>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-B2342B74-D67D-4B16-9CC7-C31CA69903CC__GUID-26692CA0-5664-44C1-87D4-729659C739A4">
                        <p class="notep1">注意：</p>
                        <p>在Oracle Real Applications Cluster（RAC）数据库中， <code class="codeph">INMEMORY_EXPRESSIONS_USAGE</code>初始化参数在每个数据库实例上不需要相同的值。每个IMCU独立列出虚拟列。每个IMCU都可以根据初始化参数值和填充或重新填充IMCU时存在的虚拟列来实现不同的表达式。
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-B2342B74-D67D-4B16-9CC7-C31CA69903CC__GUID-78AAF319-F973-4BAB-BFF2-49C295CBAB34">配置IM表达式用法：</p>
                     <ol>
                        <li>
                           <p>以具有相应权限的用户身份登录数据库。</p>
                        </li>
                        <li>
                           <p>要配置IM表达式用法，请使用<code class="codeph">ALTER SYSTEM</code>语句将<code class="codeph">INMEMORY_EXPRESSIONS_USAGE</code>设置为以下任何值：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">ENABLE</code> （默认） - 启用动态和静态IM表达式</p>
                              </li>
                              <li>
                                 <p><code class="codeph">STATIC_ONLY</code> - 仅启用静态IM表达式</p>
                              </li>
                              <li>
                                 <p><code class="codeph">DYNAMIC_ONLY</code> - 仅启用动态IM表达式</p>
                              </li>
                              <li>
                                 <p><code class="codeph">DISABLE</code> - 禁用所有IM表达式</p>
                              </li>
                           </ul>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-B2342B74-D67D-4B16-9CC7-C31CA69903CC__GUID-01D0598F-5BA4-488F-8681-CD0425A4C2ED">
                     <p class="titleinexample">示例7-1禁用IM表达式</p>
                     <p>以下语句禁用IM列存储中IM表达式的存储：</p><pre class="pre codeblock"><code>ALTER SYSTEM SET INMEMORY_EXPRESSIONS_USAGE ='禁用';</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-B2342B74-D67D-4B16-9CC7-C31CA69903CC__GUID-CE107926-9332-4F2C-A5DD-639E146A756D">
                     <p class="notep1">也可以看看：</p>
                     <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/inmem&amp;id=GUID-9B926459-CA8A-4843-B9A1-4DE6F630EB45" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解有关<code class="codeph">INMEMORY_EXPRESSIONS_USAGE</code>更多信息 
                     </p>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="optimizing-in-memory-expressions.html#GUID-5F82168D-A024-4F96-B3AF-7DA4C52908B8" title="在IM列存储的上下文中，表达式是一个或多个值，运算符以及解析为值的SQL或PL / SQL函数（仅限DETERMINISTIC）的组合。">使用内存表达式优化查询</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-DE164F9A-64E9-4A28-B906-A8CDEC0C1974" name="GUID-DE164F9A-64E9-4A28-B906-A8CDEC0C1974"></a><h3 id="INMEM-GUID-DE164F9A-64E9-4A28-B906-A8CDEC0C1974" class="sect3"><span class="enumeration_section">7.3</span>捕获和填充IM表达式</h3>
               <div>
                  <p><code class="codeph">IME_CAPTURE_EXPRESSIONS</code>过程<span>在指定的时间间隔内捕获数据库中20个最常访问（“最热”）的表达式。</span> <code class="codeph">IME_POPULATE_EXPRESSIONS</code>过程<span>强制在最新的<code class="codeph">DBMS_INMEMORY_ADMIN.IME_CAPTURE_EXPRESSIONS</code>调用中捕获表达式。</span></p>
                  <div class="section">
                     <p>每当您调用<code class="codeph">IME_CAPTURE_EXPRESSIONS</code>过程时，数据库都会查询表达式统计信息存储（ESS），并仅考虑至少部分填充在IM列存储中的堆组织表上的表达式。数据库将20个最热门的表达式作为隐藏的虚拟列添加到其各自的表中，前缀为字符串<code class="codeph">SYS_IME</code> ，并应用默认的<code class="codeph">INMEMORY</code>列压缩子句。如果在上一次调用期间添加的<code class="codeph">SYS_IME</code>列不再位于最新的前20个列表中，则其属性将更改为<code class="codeph">NO INMEMORY</code> 。</p>
                     <p>如果未调用<code class="codeph">IME_POPULATE_EXPRESSIONS</code> ，则数据库会在重新填充其父IMCU时逐渐重新填充<code class="codeph">SYS_IME</code>列。如果未重新填充表，则数据库不会重新填充<code class="codeph">IME_CAPTURE_EXPRESSIONS</code>过程捕获的新<code class="codeph">SYS_IME</code>列。<code class="codeph">IME_POPULATE_EXPRESSIONS</code>通过强制重新填充来解决这个问题。
                     </p>
                     <p>在内部， <code class="codeph">IME_POPULATE_EXPRESSIONS</code>过程为具有<code class="codeph">INMEMORY</code>属性的<code class="codeph">SYS_IME</code>列的所有表调用<code class="codeph">DBMS_INMEMORY.REPOPULATE</code> 。要在指定的表子集中填充<code class="codeph">SYS_IME</code>列，请使用<code class="codeph">DBMS_INMEMORY.REPOPULATE</code>而不是<code class="codeph">DBMS_INMEMORY_ADMIN.IME_POPULATE_EXPRESSIONS</code> 。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-DE164F9A-64E9-4A28-B906-A8CDEC0C1974__GUID-F1F326B7-FD24-4ABA-BCF4-0A8B3234071B">先决条件</p>
                     <p>要使数据库能够捕获IM表达式，必须满足以下条件：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>必须将<code class="codeph">INMEMORY_EXPRESSIONS_USAGE</code>初始化参数设置为<code class="codeph">DISABLE</code>以外的值。</p>
                        </li>
                        <li>
                           <p><code class="codeph">INMEMORY_SIZE</code>初始化参数设置为非零值。
                           </p>
                        </li>
                        <li>
                           <p>初始化参数<code class="codeph">COMPATIBLE</code>的值必须设置为12.2.0或更高。
                           </p>
                        </li>
                        <li>
                           <p>要指定任意长度的<span>表达式捕获窗口</span> （而不是24小时或永久的预定时间跨度），必须使用<code class="codeph">DBMS_INMEMORY_ADMIN.IME_OPEN_CAPTURE_WINDOW</code>打开窗口并使用<code class="codeph">DBMS_INMEMORY_ADMIN.IME_OPEN_CAPTURE_WINDOW</code>将其<code class="codeph">IME_CLOSE_CAPTURE_WINDOW</code> 。该窗口是Oracle RAC数据库中所有实例的全局窗口。
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-DE164F9A-64E9-4A28-B906-A8CDEC0C1974__GUID-311480FE-47D3-4430-AB93-3E8B8DF65BD2">捕获和填充IM表达式：</p>
                     <ol>
                        <li>
                           <p>在SQL * Plus或SQL Developer中，以具有必要权限的用户身份登录数据库。</p>
                        </li>
                        <li>
                           <p>如果要指定窗口的长度（而不是预定的时间跨度），则执行<code class="codeph">DBMS_INMEMORY_ADMIN.IME_OPEN_CAPTURE_WINDOW</code> ，如下所示：</p><pre class="pre codeblock"><code>EXEC DBMS_INMEMORY_ADMIN.IME_OPEN_CAPTURE_WINDOW（）;</code></pre><div class="infoboxnote" id="GUID-DE164F9A-64E9-4A28-B906-A8CDEC0C1974__GUID-4990F32E-3D07-47C6-9414-5FF2BDF52AF6">
                              <p class="notep1">注意：</p>
                              <p>要检查当前是否有任何表达式捕获窗口打开，请执行<code class="codeph">DBMS_INMEMORY_ADMIN.IME_GET_CAPTURE_STATE</code> 。</p>
                           </div>
                        </li>
                        <li>
                           <p>如果在上一步中打开了一个带有<code class="codeph">IME_OPEN_CAPTURE_WINDOW</code>的窗口，则使用<code class="codeph">IME_CLOSE_CAPTURE_WINDOW</code>将其关闭，如下所示：</p><pre class="pre codeblock"><code>EXEC DBMS_INMEMORY_ADMIN.IME_CLOSE_CAPTURE_WINDOW（）;</code></pre></li>
                        <li>
                           <p>执行<code class="codeph">DBMS_INMEMORY_ADMIN.IME_CAPTURE_EXPRESSIONS</code> ，将<code class="codeph">interval</code>参数设置为以下任何值：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">累积</code></p>
                                 <p>数据库会考虑自创建数据库以来的所有表达式统计信息。</p>
                              </li>
                              <li>
                                 <p><code class="codeph">当前</code></p>
                                 <p>数据库仅考虑过去24小时内的表达式统计信息。</p>
                              </li>
                              <li>
                                 <p><code class="codeph">窗口</code></p>
                                 <p>数据库为在最近的用户指定的<span>表达式捕获窗口中</span>跟踪的表达式添加隐藏的虚拟列。打开此窗口，手动调用<code class="codeph">IME_OPEN_CAPTURE_WINDOW</code>过程，然后通过手动调用<code class="codeph">IME_CLOSE_CAPTURE_WINDOW</code>过程关闭。
                                 </p>
                                 <p>如果捕获窗口当前处于打开状态，则数据库将考虑当前窗口中跟踪的所有表达式，直到此时为止，然后实现最热门的表达式。要列出在当前窗口中跟踪的表达式， <code class="codeph">DBA_EXPRESSION_STATISTICS</code>使用<code class="codeph">SNAPSHOT = 'WINDOW'</code>查询<code class="codeph">DBA_EXPRESSION_STATISTICS</code> 。
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>（可选）要强制立即填充所有捕获的IM表达式，请执行<code class="codeph">DBMS_INMEMORY_ADMIN.IME_POPULATE_EXPRESSIONS</code> ，如下所示：</p><pre class="pre codeblock"><code>EXEC DBMS_INMEMORY_ADMIN.IME_POPULATE_EXPRESSIONS（）;</code></pre></li>
                     </ol>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-DE164F9A-64E9-4A28-B906-A8CDEC0C1974__GUID-10AD4194-6DD7-456B-8B20-B754FF0253FF">
                     <p class="titleinexample">例7-2在用户定义的窗口中捕获表达式</p>
                     <p>此示例演示了<code class="codeph">WINDOW</code>捕获模式的使用。您的目标是打开和关闭表达式捕获窗口，然后捕获数据库在此窗口期间跟踪的所有表达式。您执行以下步骤：</p>
                     <ol>
                        <li>
                           <p>打开<span>表达式捕获窗口</span> ，生成表达式，然后关闭窗口：</p><pre class="pre codeblock"><code>EXEC DBMS_INMEMORY_ADMIN.IME_OPEN_CAPTURE_WINDOW（）; - 为数据库生成表达式以跟踪EXEC DBMS_INMEMORY_ADMIN.IME_CLOSE_CAPTURE_WINDOW（）;</code></pre></li>
                        <li>
                           <p>查询<code class="codeph">DBA_EXPRESSION_STATICS</code> （包括示例输出）：</p><pre class="pre codeblock"><code>COL OWNER FORMAT A6 COL TABLE_NAME FORMAT A9 COL COUNT FORMAT 99999 COL CREATED FORMAT A10 COL EXPRESSION_TEXT FORMAT A29 SELECT OWNER，TABLE_NAME，EVALUATION_COUNT作为COUNT，CREATED，EXPRESSION_TEXT来自DBA_EXPRESSION_STATISTICS SNAPSHOT ='WINDOW'和OWNER ='SH'; OWNER TABLE_NAM COUNT CREATED EXPRESSION_TEXT ------ --------- ------ ---------- -------------- ----------- SH SALES 4702 09-OCT-17“QUANTITY_SOLD”SH SALES 4702 09-OCT-17“QUANTITY_SOLD”*“AMOUNT_SOLD”SH SALES 4702 09-OCT-17“PROD_ID”SH SALES 4702 09-OCT-17“CUST_ID”SH SALES 4702 09-OCT-17“CHANNEL_ID”SH SALES 4702 09-OCT-17“AMOUNT_SOLD”</code></pre><p>前面的查询显示了ESS中跟踪的列以及在<code class="codeph">sh</code>模式中用于查询的窗口期间捕获的表达式。在最近的窗口中，数据库捕获了一个表达式： <code class="codeph">QUANTITY_SOLD*AMOUNT_SOLD</code> 。</p>
                        </li>
                        <li>
                           <p>使用<code class="codeph">IME_CAPTURE_EXPRESSIONS</code>使数据库考虑当前窗口中的所有表达式以实现：</p><pre class="pre codeblock"><code>EXEC DBMS_INMEMORY_ADMIN.IME_CAPTURE_EXPRESSIONS（'WINDOW'）;</code></pre></li>
                        <li>
                           <p>查询<code class="codeph">DBA_IM_EXPRESSIONS</code> （包括示例输出）：</p><pre class="pre codeblock"><code>COL OWNER FORMAT a6 COL TABLE_NAME FORMAT a9 COL COLUMN_NAME FORMAT a25 SET LONG 50 SET LINESIZE 150 SELECT OWNER，TABLE_NAME，COLUMN_NAME，SQL_EXPRESSION FROM DBA_IM_EXPRESSIONS; OWNER TABLE_NAM COLUMN_NAME SQL_EXPRESSION ------ --------- ------------------------- ------ ----------------------- SH SALES SYS_IME000100000025201B“QUANTITY_SOLD”*“AMOUNT_SOLD”</code></pre><p>前面的输出显示添加到表中的所有虚拟列，并将<code class="codeph">INMEMORY</code>标记为最新<code class="codeph">IME_CAPTURE_EXPRESSIONS</code>调用的一部分。当数据库重新填充表的不同IMCU时，数据库会逐渐将捕获的表达式填充到IM列存储中。
                           </p>
                        </li>
                        <li>
                           <p>执行以下过程以显式强制所有捕获的IM表达式的填充：</p><pre class="pre codeblock"><code>EXEC DBMS_INMEMORY_ADMIN.IME_POPULATE_EXPRESSIONS（）;</code></pre><p>请注意，您可以通过在<code class="codeph">force</code>参数设置为<code class="codeph">TRUE</code>下执行<code class="codeph">DBMS_INMEMORY.REPOPULATE</code>过程来填充特定表中的IM表达式。</p>
                        </li>
                     </ol>
                  </div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-DE164F9A-64E9-4A28-B906-A8CDEC0C1974__GUID-BF872C60-D950-4159-AC34-66BACABB49A0">
                     <p class="titleinexample">例7-3确定表达式捕获窗口的状态</p>
                     <p>此示例打开<span>表达式捕获窗口</span> ，然后确定其捕获状态。
                     </p><pre class="pre codeblock"><code>EXEC DBMS_INMEMORY_ADMIN.IME_OPEN_CAPTURE_WINDOW（）; VARIABLE b_state VARCHAR2（25）VARIABLE b_time VARCHAR2（10）EXECUTE DBMS_INMEMORY_ADMIN.IME_GET_CAPTURE_STATE（：b_state，：b_time）PRINT b_state b_time</code></pre><p>以下示例输出表明<span>表达式捕获窗口</span>当前处于打开状态：</p><pre class="pre codeblock"><code>B_STATE ------------------------------------------------- -  OPEN B_TIME ----------------------------------------------- --- 09-OCT-17</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-DE164F9A-64E9-4A28-B906-A8CDEC0C1974__GUID-AE693889-DE28-48C7-BB51-3FA5B86349C0">
                     <p class="titleinexample">例7-4在过去24小时内捕获前20个IM表达式</p>
                     <p>此示例仅使用在最后一天收集的统计信息捕获IM表达式，然后强制立即填充：</p><pre class="pre codeblock"><code>EXEC DBMS_INMEMORY_ADMIN.IME_CAPTURE_EXPRESSIONS（'CURRENT'）; EXEC DBMS_INMEMORY_ADMIN.IME_POPULATE_EXPRESSIONS（）;</code></pre><p>以下<code class="codeph">DBA_IM_EXPRESSIONS</code>查询显示标记为<code class="codeph">INMEMORY</code>所有IME虚拟列（提供的示例输出）：</p><pre class="pre codeblock"><code>COL OWNER FORMAT a6 COL TABLE_NAME FORMAT a9 COL COLUMN_NAME FORMAT a25 SET LONG 50 SET LINESIZE 150 SELECT OWNER，TABLE_NAME，COLUMN_NAME，SQL_EXPRESSION FROM DBA_IM_EXPRESSIONS; OWNER TABLE_NAM COLUMN_NAME SQL_EXPRESSION ------ --------- ------------------------- ------ --------------------------------------- HR EMPLOYEES SYS_IME00010000001746FD 12 *（“SALARY”* NVL （“COMMISSION_PCT”，0）+“SALARY”）人力资源员工SYS_IME00010000001746FE ROUND（“SALARY”* 12 / 52,2）</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-DE164F9A-64E9-4A28-B906-A8CDEC0C1974__GUID-DD77FE84-B8D6-4D9B-8F64-6ACD13C6DD33">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span><cite>Oracle Database PL / SQL包和类型参考</cite></span>以了解有关<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/inmem&amp;id=ARPLS-GUID-70CDDB1F-A928-4AD5-9632-5F1C5DEF5DC9" target="_blank"><code class="codeph">IME_CAPTURE_EXPRESSIONS</code></a>和<a href="../arpls/DBMS_INMEMORY_ADMIN.html#GUID-ED6D684C-39B3-449F-ADE3-4D6FA4294A28" target="_blank"><code class="codeph">IME_POPULATE_EXPRESSIONS</code></a>更多信息</p>
                        </li>
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/inmem&amp;id=GUID-44900E64-09C8-40AD-BC7A-A59DC70E0EDA" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解有关<code class="codeph">DBA_IM_EXPRESSIONS</code>视图的更多信息</p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="optimizing-in-memory-expressions.html#GUID-5F82168D-A024-4F96-B3AF-7DA4C52908B8" title="在IM列存储的上下文中，表达式是一个或多个值，运算符以及解析为值的SQL或PL / SQL函数（仅限DETERMINISTIC）的组合。">使用内存表达式优化查询</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-581C803B-56F2-4FD6-95DB-40B6B85DE857" name="GUID-581C803B-56F2-4FD6-95DB-40B6B85DE857"></a><h3 id="INMEM-GUID-581C803B-56F2-4FD6-95DB-40B6B85DE857" class="sect3"><span class="enumeration_section">7.4</span>删除IM表达式</h3>
               <div>
                  <p><code class="codeph">DBMS_INMEMORY_ADMIN.IME_DROP_ALL_EXPRESSIONS</code>过程<span>删除数据库中的所有<code class="codeph">SYS_IME</code>表达式虚拟列。</span> <code class="codeph">DBMS_INMEMORY.IME_DROP_EXPRESSIONS</code>过程<span>从表中删除指定的一组<code class="codeph">SYS_IME</code>虚拟列。</span></p>
                  <div class="section">
                     <p>删除<code class="codeph">SYS_IME</code>列的典型原因是空间和性能。无论属性是<code class="codeph">INMEMORY</code>还是<code class="codeph">NO INMEMORY</code> ，表的最大<code class="codeph">SYS_IME</code>列数为50。在达到表的50表达式限制后，数据库将不会添加新的<code class="codeph">SYS_IME</code>列。要为新表达式腾出空间，必须使用<code class="codeph">DBMS_INMEMORY.IME_DROP_EXPRESSIONS</code>或<code class="codeph">DBMS_INMEMORY_ADMIN.IME_DROP_ALL_EXPRESSIONS</code>过程手动删除<code class="codeph">SYS_IME</code>列。
                     </p>
                     <p><code class="codeph">IME_DROP_ALL_EXPRESSIONS</code>过程会删除所有表中的所有<code class="codeph">SYS_IME</code>列，无论它们是否具有<code class="codeph">INMEMORY</code>属性。实际上，该过程充当数据库范围的重置按钮。
                     </p>
                     <p>对于具有<code class="codeph">SYS_IME</code>列的段，使用<code class="codeph">IME_DROP_ALL_EXPRESSIONS</code>会触发所有IMEU <span class="italic">和</span> IMCU的<code class="codeph">SYS_IME</code> 。例如，如果50个填充表各有一个<code class="codeph">SYS_IME</code>列，则<code class="codeph">IME_DROP_ALL_EXPRESSIONS</code>将从IM列存储中删除所有50个表。要再次填充这些段，必须使用<code class="codeph">DBMS_INMEMORY.POPULATE</code>过程或执行全表扫描。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-581C803B-56F2-4FD6-95DB-40B6B85DE857__GUID-7DB405C1-5EE8-4601-9AAF-399F807F31DD">先决条件</p>
                     <p>要删除IM表达式，必须满足以下条件：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">INMEMORY_EXPRESSIONS_USAGE</code>初始化参数设置为<code class="codeph">DISABLE</code>以外的值。</p>
                        </li>
                        <li>
                           <p><code class="codeph">INMEMORY_SIZE</code>初始化参数设置为非零值。
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">COMPATIBLE</code>初始化参数设置为12.2.0或更高。
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-581C803B-56F2-4FD6-95DB-40B6B85DE857__GUID-57DA7CD0-9610-4F7C-AC0C-4F0792667860">要删除IM表达式：</p>
                     <ol>
                        <li>
                           <p>在SQL * Plus或SQL Developer中，以具有必要权限的用户身份登录数据库。</p>
                        </li>
                        <li>
                           <p>执行<code class="codeph">DBMS_INMEMORY_ADMIN.IME_DROP_ALL_EXPRESSIONS</code>或<code class="codeph">DBMS_INMEMORY.IME_DROP_EXPRESSIONS</code> 。</p>
                           <p>如果执行<code class="codeph">IME_DROP_EXPRESSIONS</code> ，则指定以下参数：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">schema_name</code> - 包含In-Memory表的模式的名称</p>
                              </li>
                              <li>
                                 <p><code class="codeph">table_name</code> -  In-Memory表的名称</p>
                              </li>
                              <li>
                                 <p><code class="codeph">column_name</code> - <code class="codeph">SYS_IME</code>列的名称。默认情况下，此值为null，它指定此表中的所有<code class="codeph">SYS_IME</code>列。
                                 </p>
                              </li>
                           </ul>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-581C803B-56F2-4FD6-95DB-40B6B85DE857__GUID-A715D936-76A0-4FDE-B6B0-71BC54D3ECE1">
                     <p class="titleinexample">例7-5删除表中的所有IM表达式</p>
                     <p>此示例删除<code class="codeph">hr.employees</code>表中的所有IM表达式：</p><pre class="pre codeblock"><code>EXEC DBMS_INMEMORY.IME_DROP_EXPRESSIONS（'hr'，'employees'）;</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-581C803B-56F2-4FD6-95DB-40B6B85DE857__GUID-CCB265C9-F817-4B83-8D2B-DF63A39C0C34">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="../refrn/INMEMORY_EXPRESSIONS_USAGE.html#GUID-9B926459-CA8A-4843-B9A1-4DE6F630EB45" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解有关<code class="codeph">INMEMORY_EXPRESSIONS_USAGE</code>初始化参数的更多信息</p>
                        </li>
                        <li>
                           <p><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span>以了解有关<a href="../arpls/DBMS_INMEMORY.html#ARPLS-GUID-F6699783-90CD-4411-AD54-1DADBD8E2BFD" target="_blank"><code class="codeph">DBMS_INMEMORY.IME_DROP_EXPRESSIONS</code></a>和<a href="../arpls/DBMS_INMEMORY_ADMIN.html#ARPLS-GUID-68438F17-9806-418A-B92A-E029284D3D73" target="_blank"><code class="codeph">DBMS_INMEMORY_ADMIN.IME_DROP_ALL_EXPRESSIONS</code></a>更多信息</p>
                        </li>
                        <li>
                           <p><a href="../refrn/DBA_IM_EXPRESSIONS.html#GUID-44900E64-09C8-40AD-BC7A-A59DC70E0EDA" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解有关<code class="codeph">DBA_IM_EXPRESSIONS</code>数据字典视图的更多信息</p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="optimizing-in-memory-expressions.html#GUID-5F82168D-A024-4F96-B3AF-7DA4C52908B8" title="在IM列存储的上下文中，表达式是一个或多个值，运算符以及解析为值的SQL或PL / SQL函数（仅限DETERMINISTIC）的组合。">使用内存表达式优化查询</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>