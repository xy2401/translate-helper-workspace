<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="You can use a logical standby database to perform a rolling upgrade of Oracle Database software."></meta>
      <meta name="description" content="You can use a logical standby database to perform a rolling upgrade of Oracle Database software."></meta>
      <title>使用SQL Apply升级Oracle数据库</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Concepts and Administration "></meta>
      <meta property="og:description" content="You can use a logical standby database to perform a rolling upgrade of Oracle Database software."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Concepts and Administration"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="data-guard-concepts-and-administration.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-02-12T10:50:21-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1999, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96244-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="using-RMAN-in-oracle-data-guard-configurations.html" title="Previous" type="text/html"></link>
      <link rel="next" href="using-DBMS_ROLLING-to-perform-rolling-upgrade.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Data Guard Concepts and Administration"></meta>
    <meta name="dcterms.isVersionOf" content="SBYDB"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="using-RMAN-in-oracle-data-guard-configurations.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="using-DBMS_ROLLING-to-perform-rolling-upgrade.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">概念和管理</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="oracle-data-guard-concepts.html" property="item" typeof="WebPage"><span property="name">概念和管理</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">使用SQL Apply升级Oracle数据库</li>
            </ol>
            <a id="GUID-290F632F-5295-47F3-AEF1-2D37C69C00D7" name="GUID-290F632F-5295-47F3-AEF1-2D37C69C00D7"></a><a id="SBYDB00830"></a>
            
            <h2 id="SBYDB-GUID-290F632F-5295-47F3-AEF1-2D37C69C00D7" class="sect2"><span class="enumeration_chapter">13</span>使用SQL Apply升级Oracle数据库</h2>
         </header>
         <div class="ind">
            <div>
               <p>您可以使用逻辑备用数据库执行Oracle数据库软件的<span class="italic">滚动升级</span> 。
               </p>
               <p>在滚动升级期间，您可以在主数据库和逻辑备用数据库上运行不同版本的Oracle数据库，同时逐个升级它们，从而最大限度地减少主数据库的停机时间。</p>
               <p>对于源自Oracle Database 12 <span class="italic">c</span>第1版（12.1）的第一个补丁集的数据库，使用现有物理备用数据库执行滚动升级的首选方法是使用<code class="codeph">DBMS_ROLLING</code> PL / SQL程序包，如<a href="using-DBMS_ROLLING-to-perform-rolling-upgrade.html#GUID-70C09F5B-90BE-4C8C-96A5-45A52E05D380" title="滚动升级使用Oracle Active Data Guard功能提供了一种简化的滚动升级方法。">使用DBMS_ROLLING执行中所述滚动升级</a> 。
               </p>
               <p>以下主题描述了在升级Oracle数据库时如何最大限度地减少停机时间：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-701A35C5-B545-43DD-8854-F6948E0BB32A" title="这些是使用SQL Apply执行滚动升级的优点。">使用SQL Apply进行滚动升级的好处</a></p>
                  </li>
                  <li>
                     <p><a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-2CF3E283-2EC3-4B55-A71B-9D25DDF52156" title="这些是使用SQL Apply执行滚动升级的要求。">使用SQL Apply执行滚动升级的要求</a></p>
                  </li>
                  <li>
                     <p><a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-9DE40A97-7AB4-4444-B762-2238AB298BF0" title="此背景信息将帮助您更好地理解执行升级的说明。">升级说明中使用的数字和约定</a></p>
                  </li>
                  <li>
                     <p><a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-5D2CD1E2-7A24-46EA-BA16-8854BFFE501E" title="此方案假定您没有现有的Oracle Data Guard配置，但您将创建一个逻辑备用数据库，仅用于执行Oracle数据库的滚动升级。">通过创建新的逻辑备用数据库执行滚动升级</a></p>
                  </li>
                  <li>
                     <p><a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC" title="这些步骤说明如何在逻辑备用数据库和主数据库上执行Oracle数据库的滚动升级。">使用现有逻辑备用数据库执行滚动升级</a></p>
                  </li>
                  <li>
                     <p><a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-C5DF6148-C1E9-4ADF-A975-AC95FC64E0C4" title="这些步骤说明如何执行Oracle数据库软件的滚动升级，然后返回原始配置，其中A是主数据库，B是物理备用数据库，并且它们都运行升级的Oracle软件。">使用现有物理备用数据库执行滚动升级</a></p>
                  </li>
               </ul>
               <div class="infoboxnote" id="GUID-290F632F-5295-47F3-AEF1-2D37C69C00D7__GUID-D20221A6-38BD-4AD9-90AD-BBC14D413B6C">
                  <p class="notep1">注意：</p>
                  <p>这些主题描述了通常的升级过程的替代方案，涉及更长的停机时间，如<a href="upgrading-patching-downgrading-oracle-data-guard-configuration.html#GUID-A4FBE490-7E7E-4998-B80E-01C93C77AE2F" title="These topics address how to upgrade and downgrade an Oracle database when a physical or logical standby database is present in the Oracle Data Guard configuration.">Oracle Data Guard配置</a>中的<a href="upgrading-patching-downgrading-oracle-data-guard-configuration.html#GUID-A4FBE490-7E7E-4998-B80E-01C93C77AE2F" title="这些主题介绍了在Oracle Data Guard配置中存在物理或逻辑备用数据库时如何升级和降级Oracle数据库。">升级和降级数据库中所述</a> 。不要尝试组合这两个过程中的步骤。
                  </p>
               </div>
            </div><a id="SBYDB4879"></a><div class="props_rev_3"><a id="GUID-701A35C5-B545-43DD-8854-F6948E0BB32A" name="GUID-701A35C5-B545-43DD-8854-F6948E0BB32A"></a><h3 id="SBYDB-GUID-701A35C5-B545-43DD-8854-F6948E0BB32A" class="sect3"><span class="enumeration_section">13.1</span>使用SQL Apply进行滚动升级的好处</h3>
               <div>
                  <p>这些是使用SQL Apply执行滚动升级的优点。</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>您的生产数据库导致停机时间非常短。整体停机时间可以与执行切换所需的时间一样短。</p>
                     </li>
                     <li>
                        <p>您可以消除因PL / SQL重新编译而导致的应用程序停机时间。</p>
                     </li>
                     <li>
                        <p>您可以在不影响主数据库的情况下验证升级的数据库版本。</p>
                     </li>
                     <li>
                        <p>逻辑备用数据库在升级过程中接受存档日志，这提供了额外级别的灾难保护。</p>
                     </li>
                  </ul>
                  <div class="infoboxnote" id="GUID-701A35C5-B545-43DD-8854-F6948E0BB32A__GUID-4AA33818-1090-4137-BDFB-BBDFF84BA161">
                     <p class="notep1">注意：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>从Oracle Database <span class="italic">12c</span>第1版（12.1）开始，Oracle XML DB Repository支持Oracle Data Guard滚动升级。有关此支持需要注意的注意事项和限制的详细信息，请参阅<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=ADXDB5703" target="_blank"><span class="italic">Oracle XML DB Developer's Guide</span></a> 。
                           </p>
                        </li>
                        <li>
                           <p>从Oracle Database <span class="italic">12c</span>第1版（12.1）开始，您可以使用Oracle Data Guard数据库滚动升级以及临时逻辑备用数据库和PL / SQL包<code class="codeph">DBMS_ROLLING</code> ，将使用Oracle Database Vault的数据库升级到新的Oracle数据库版本和补丁集。</p>
                        </li>
                        <li>
                           <p>从Oracle Database <span class="italic">12c</span>第1版（12.1）开始，您可以使用临时逻辑备用数据库和PL /使用Oracle Data Guard数据库滚动升级将使用Oracle Label Security（OLS）的数据库升级到新的Oracle数据库版本和补丁集。 SQL包， <code class="codeph">DBMS_ROLLING</code> 。</p> 
                        </li>
                     </ul>
                  </div>
               </div>
            </div><a id="SBYDB4880"></a><div class="props_rev_3"><a id="GUID-2CF3E283-2EC3-4B55-A71B-9D25DDF52156" name="GUID-2CF3E283-2EC3-4B55-A71B-9D25DDF52156"></a><h3 id="SBYDB-GUID-2CF3E283-2EC3-4B55-A71B-9D25DDF52156" class="sect3"><span class="enumeration_section">13.2</span>使用SQL Apply执行滚动升级的要求</h3>
               <div>
                  <p>这些是使用SQL Apply执行滚动升级的要求。</p>
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>如果数据库是Oracle Data Guard代理配置的一部分，则在滚动升级之前禁用代理配置。有关禁用代理配置的信息，请参阅<a href="../dgbkr/oracle-data-guard-broker-commands.html#DGBKR630" target="_blank"><span class="italic">Oracle Data Guard Broker</span></a> 。
                           </p>
                        </li>
                        <li>
                           <p>必须将Oracle Data Guard保护模式设置为最大可用性或最高性能。查询<code class="codeph">V$DATABASE</code>视图中的<code class="codeph">PROTECTION_LEVEL</code>列以找出当前保护模式设置。
                           </p>
                        </li>
                        <li>
                           <p>为了确保主数据库可以继续而逻辑备用数据库正在升级，所述<code class="codeph">LOG_ARCHIVE_DEST_</code> <span class="italic"><code class="codeph">n</code></span>为逻辑备用数据库目的地初始化参数<span class="italic">不能</span>被设置为<code class="codeph">MANDATORY</code> 。</p>
                        </li>
                        <li>
                           <p>主数据库上设置的<code class="codeph">COMPATIBLE</code>初始化参数必须与升级前的软件版本匹配。因此，从版本<span class="italic">x</span>到版本<span class="italic">y</span>的滚动升级要求将<code class="codeph">COMPATIBLE</code>初始化参数设置为在主数据库上释放<span class="italic">x</span> 。滚动升级备用数据库必须将其<code class="codeph">COMPATIBLE</code>初始化参数设置为<span class="italic">x</span>或更高。
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="SBYDB5064"></a><a id="SBYDB4881"></a><div class="props_rev_3"><a id="GUID-9DE40A97-7AB4-4444-B762-2238AB298BF0" name="GUID-9DE40A97-7AB4-4444-B762-2238AB298BF0"></a><h3 id="SBYDB-GUID-9DE40A97-7AB4-4444-B762-2238AB298BF0" class="sect3"><span class="enumeration_section">13.3</span>升级说明中使用的数字和惯例</h3>
               <div>
                  <p>此背景信息将帮助您更好地理解执行升级的说明。</p>
                  <p><a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-9DE40A97-7AB4-4444-B762-2238AB298BF0__I1029537">图13-1</a>显示了升级开始之前的Oracle Data Guard配置，主数据库和逻辑备用数据库都运行相同的Oracle数据库软件版本。
                  </p>
                  <div class="figure" id="GUID-9DE40A97-7AB4-4444-B762-2238AB298BF0__I1029537">
                     <p class="titleinfigure">图13-1升级前的Oracle Data Guard配置</p><img src="img/sbydb023.gif" alt="下面是图13-1的描述" title="下面是图13-1的描述" longdesc="img_text/sbydb023.html"><br><a href="img_text/sbydb023.html">“图13-1升级前的Oracle Data Guard配置”的说明</a></div>
                  <!-- class="figure" -->
                  <p>在升级过程中，Oracle Data Guard配置在此过程中的多个点上运行混合数据库版本。跨版本不提供数据保护。在这些步骤中，请考虑在Oracle Data Guard配置中使用第二个备用数据库来提供数据保护。</p>
                  <p>描述升级过程的步骤和图形将数据库称为数据库A和数据库B，而不是主数据库和备用数据库。这是因为数据库在升级过程中切换角色。最初，Database A是主数据库，Database B是逻辑备用数据库， <a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-9DE40A97-7AB4-4444-B762-2238AB298BF0__I1029537">如图13-1</a>所示。
                  </p>
                  <p>以下部分描述了可以使用SQL Apply滚动升级过程的方案：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-5D2CD1E2-7A24-46EA-BA16-8854BFFE501E" title="此方案假定您没有现有的Oracle Data Guard配置，但您将创建一个逻辑备用数据库，仅用于执行Oracle数据库的滚动升级。">通过创建新的逻辑备用数据库执行滚动升级</a></p>
                     </li>
                     <li>
                        <p><a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC" title="这些步骤说明如何在逻辑备用数据库和主数据库上执行Oracle数据库的滚动升级。">使用现有逻辑备用数据库执行滚动升级</a></p>
                     </li>
                     <li>
                        <p><a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-C5DF6148-C1E9-4ADF-A975-AC95FC64E0C4" title="这些步骤说明如何执行Oracle数据库软件的滚动升级，然后返回原始配置，其中A是主数据库，B是物理备用数据库，并且它们都运行升级的Oracle软件。">使用现有物理备用数据库执行滚动升级</a></p>
                     </li>
                  </ul>
               </div>
            </div><a id="SBYDB5065"></a><a id="SBYDB4882"></a><div class="props_rev_3"><a id="GUID-5D2CD1E2-7A24-46EA-BA16-8854BFFE501E" name="GUID-5D2CD1E2-7A24-46EA-BA16-8854BFFE501E"></a><h3 id="SBYDB-GUID-5D2CD1E2-7A24-46EA-BA16-8854BFFE501E" class="sect3"><span class="enumeration_section">13.4</span>通过创建新的逻辑备用数据库执行滚动升级</h3>
               <div>
                  <p>此方案假定您没有现有的Oracle Data Guard配置，但您将创建一个逻辑备用数据库，仅用于执行Oracle数据库的滚动升级。</p>
                  <div class="section">
                     <p><a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-5D2CD1E2-7A24-46EA-BA16-8854BFFE501E__BABBFDIG" title="此2列表列出了通过创建新逻辑备用数据库来执行滚动升级的步骤。第1列是步骤。第2列是步骤说明。">表13-1</a>列出了准备主数据库和备用数据库以进行升级的步骤。
                     </p>
                     <div class="tblformal" id="GUID-5D2CD1E2-7A24-46EA-BA16-8854BFFE501E__BABBFDIG">
                        <p class="titleintable">表13-1通过创建新的逻辑备用数据库执行滚动升级的步骤</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="通过创建新的逻辑备用数据库来执行滚动升级的步骤" width="100%" border="1" summary="This 2 column tables lists the steps to perform a rolling upgrade by creating a new logical standby. Column 1 is the step. Column 2 is the step description. " frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="19%" id="d33938e652">步</th>
                                 <th align="left" valign="bottom" width="81%" id="d33938e655">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="19%" id="d33938e660" headers="d33938e652 ">
                                    <p>步骤1</p>
                                 </td>
                                 <td align="left" valign="top" width="81%" headers="d33938e660 d33938e655 ">
                                    <p>识别不支持的数据类型和存储属性</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="19%" id="d33938e667" headers="d33938e652 ">
                                    <p>第2步</p>
                                 </td>
                                 <td align="left" valign="top" width="81%" headers="d33938e667 d33938e655 ">
                                    <p>创建逻辑备用数据库</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="19%" id="d33938e674" headers="d33938e652 ">
                                    <p>第3步</p>
                                 </td>
                                 <td align="left" valign="top" width="81%" headers="d33938e674 d33938e655 ">
                                    <p>执行滚动升级</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>识别主数据库上不受支持的数据库对象，并通过执行以下操作确定如何处理它们：</span><div>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>查看<a href="data-type-ddl-support-on-logical-standby-databases.html#GUID-340BA6D6-74D5-4684-AF39-08890D5CD9D4" title="设置逻辑备用数据库时，必须确保逻辑备用数据库可以维护主数据库中的数据类型和表。">逻辑备用数据库上的数据类型和DDL支持中</a>提供的受支持数据类型和存储属性的列表。
                                 </p>
                              </li>
                              <li>
                                 <p>查询主数据库上的<code class="codeph">DBA_LOGSTDBY_UNSUPPORTED</code>和<code class="codeph">DBA_LOGSTDBY_SKIP</code>视图。对主数据库中列出的表和模式所做的更改不会应用于逻辑备用数据库。使用以下查询查看不受支持的表的列表：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT DISTINCT OWNER，TABLE_NAME FROM DBA_LOGSTDBY_UNSUPPORTED;</pre><p>使用以下查询查看不受支持的内部架构的列表：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT OWNER FROM DBA_LOGSTDBY_SKIP  - &gt; WHERE STATEMENT_OPT ='INTERNAL SCHEMA';</pre></li>
                           </ul>
                        </div>
                     </li>
                     <li class="stepexpand"><span>按照创建逻辑备用数据库中的说明<a href="creating-oracle-data-guard-logical-standby.html#GUID-3666CA35-D993-44B6-8D70-A2B8B9EC8B2E" title="创建逻辑备用数据库涉及许多步骤，包括先决条件和创建后任务。">创建逻辑备用数据库</a> 。</span><div>
                           <div class="infoboxnote" id="GUID-5D2CD1E2-7A24-46EA-BA16-8854BFFE501E__GUID-7C861C01-890E-4C30-BD9F-229CBA3BC3F0">
                              <p class="notep1">注意：</p>
                              <p>在首次启动SQL Apply之前，请确保捕获有关逻辑备用数据库不支持的主数据库上运行的事务的信息。运行以下过程以捕获信息并将其记录为<code class="codeph">DBA_LOGSTDBY_EVENTS</code>视图中的事件：</p><pre class="oac_no_warn" dir="ltr">EXECUTE DBMS_LOGSTDBY.APPLY_SET（'MAX_EVENTS_RECORDED'，DBMS_LOGSTDBY.MAX_EVENTS）; EXECUTE DBMS_LOGSTDBY.APPLY_SET（'RECORD_UNSUPPORTED_OPERATIONS'，'TRUE'）;</pre></div>
                           <p>Oracle建议在逻辑备用数据库上配置备用重做日志，以最大限度地减少停机时间。</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>现在，您已创建逻辑备用数据库，从而执行滚动升级。按照<a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC" title="这些步骤说明如何在逻辑备用数据库和主数据库上执行Oracle数据库的滚动升级。">使用现有逻辑备用数据库执行滚动升级中</a>所述的过程，该过程假定您具有运行相同Oracle软件的逻辑备用数据库。</span></li>
                  </ol>
               </div>
            </div><a id="SBYDB5066"></a><a id="SBYDB5114"></a><a id="SBYDB5068"></a><a id="SBYDB5070"></a><a id="SBYDB5071"></a><a id="SBYDB4883"></a><div class="props_rev_3"><a id="GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC" name="GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC"></a><h3 id="SBYDB-GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC" class="sect3"><span class="enumeration_section">13.5</span>使用现有逻辑备用数据库执行滚动升级</h3>
               <div>
                  <p>这些步骤说明如何在逻辑备用数据库和主数据库上执行Oracle数据库的滚动升级。</p>
                  <div class="section">
                     <p><a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC__CHDDGEEF" title="此2列表列出了执行Oracle数据库软件滚动升级所执行的步骤。">表13-2</a>列出了这些步骤。
                     </p>
                     <div class="tblformal" id="GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC__CHDDGEEF">
                        <p class="titleintable">表13-2使用现有逻辑备用数据库执行滚动升级的步骤</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="使用现有逻辑备用执行滚动升级的步骤" width="100%" border="1" summary="This 2 column table lists the steps you perform to do a rolling upgrade of the Oracle Database software." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="23%" id="d33938e834">步</th>
                                 <th align="left" valign="bottom" width="77%" id="d33938e837">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d33938e842" headers="d33938e834 ">
                                    <p>步骤1</p>
                                 </td>
                                 <td align="left" valign="top" width="77%" headers="d33938e842 d33938e837 ">
                                    <p>准备滚动升级</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d33938e849" headers="d33938e834 ">
                                    <p>第2步</p>
                                 </td>
                                 <td align="left" valign="top" width="77%" headers="d33938e849 d33938e837 ">
                                    <p>升级逻辑备用数据库</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d33938e856" headers="d33938e834 ">
                                    <p>第3步</p>
                                 </td>
                                 <td align="left" valign="top" width="77%" headers="d33938e856 d33938e837 ">
                                    <p>在已升级的逻辑备用数据库上重新启动SQL Apply</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d33938e863" headers="d33938e834 ">
                                    <p>第4步</p>
                                 </td>
                                 <td align="left" valign="top" width="77%" headers="d33938e863 d33938e837 ">
                                    <p>监视已升级的备用数据库上的事件</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d33938e870" headers="d33938e834 ">
                                    <p>第5步</p>
                                 </td>
                                 <td align="left" valign="top" width="77%" headers="d33938e870 d33938e837 ">
                                    <p>开始切换</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d33938e877" headers="d33938e834 ">
                                    <p>第6步</p>
                                 </td>
                                 <td align="left" valign="top" width="77%" headers="d33938e877 d33938e837 ">
                                    <p>导入在升级期间修改的所有表</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d33938e884" headers="d33938e834 ">
                                    <p>第7步</p>
                                 </td>
                                 <td align="left" valign="top" width="77%" headers="d33938e884 d33938e837 ">
                                    <p>完成切换并激活用户应用程序</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d33938e891" headers="d33938e834 ">
                                    <p>第8步</p>
                                 </td>
                                 <td align="left" valign="top" width="77%" headers="d33938e891 d33938e837 ">
                                    <p>升级旧的主数据库</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d33938e898" headers="d33938e834 ">
                                    <p>第9步</p>
                                 </td>
                                 <td align="left" valign="top" width="77%" headers="d33938e898 d33938e837 ">
                                    <p>在旧的主数据库上启动SQL Apply</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d33938e905" headers="d33938e834 ">
                                    <p>第10步</p>
                                 </td>
                                 <td align="left" valign="top" width="77%" headers="d33938e905 d33938e837 ">
                                    <p>（可选）提高两个数据库的兼容级别</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d33938e912" headers="d33938e834 ">
                                    <p>第11步</p>
                                 </td>
                                 <td align="left" valign="top" width="77%" headers="d33938e912 d33938e837 ">
                                    <p>监视新逻辑备用数据库上的事件</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d33938e920" headers="d33938e834 ">
                                    <p>第12步</p>
                                 </td>
                                 <td align="left" valign="top" width="77%" headers="d33938e920 d33938e837 ">
                                    <p>（可选）执行其他切换</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <ol>
                        <li>
                           <p>请按照以下步骤准备执行Oracle软件的滚动升级：</p>
                           <ol type="a">
                              <li>
                                 <p>通过在逻辑备用数据库（数据库B）上发出以下语句来停止SQL Apply：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE STOP LOGICAL STANDBY APPLY;</pre></li>
                              <li>
                                 <p>如果需要，将兼容性设置为最高值。</p>
                                 <p>确保<code class="codeph">COMPATIBLE</code>初始化参数指定升级之前在主数据库上运行的Oracle数据库软件的版本号。
                                 </p>
                                 <p>例如，如果主数据库正在运行版本11.1，则在两个数据库上将<code class="codeph">COMPATIBLE</code>初始化参数设置为11.1。在主数据库上设置<span class="italic">之前，</span>请务必先在备用数据库上设置<code class="codeph">COMPATIBLE</code>初始化参数。
                                 </p>
                              </li>
                           </ol>
                        </li>
                        <li>
                           <p>升级逻辑备用数据库（数据库B）上的Oracle数据库软件以释放<span class="italic">y</span> 。在升级逻辑备用数据库时，它不接受来自主数据库的重做数据。
                           </p>
                           <p>要升级Oracle数据库软件，请参阅适用的Oracle数据库发行版的<span class="italic">Oracle数据库升级指南</span> 。
                           </p>
                           <p><a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC__BABDHEFA">图13-2</a>显示了运行版本<span class="italic">x的</span>数据库A和运行版本<span class="italic">y的</span>数据库B.在升级期间，重做数据会累积在主系统上。
                           </p>
                           <div class="figure" id="GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC__BABDHEFA">
                              <p class="titleinfigure">图13-2升级逻辑备用数据库版本</p><img src="img/sbydb026.gif" alt="下面是图13-2的描述" title="下面是图13-2的描述" longdesc="img_text/sbydb026.html"><br><a href="img_text/sbydb026.html">“图13-2升级逻辑备用数据库版本”的说明</a></div>
                           <!-- class="figure" -->
                        </li>
                        <li>
                           <p>重新启动SQL Apply并在数据库A上使用版本<span class="italic">x</span>运行并在数据库B上释放<span class="italic">y</span> 。要启动SQL Apply，请在数据库B上发出以下语句：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; <a id="d33938e991" class="indexterm-anchor"></a><a id="d33938e995" class="indexterm-anchor"></a> ALTER DATABASE START LOGICAL STANDBY立即申请;</pre><p>在主系统上累积的重做数据会自动传输并应用于新升级的逻辑备用数据库。当您验证升级后的Oracle数据库软件版本是否在生产环境中正常运行时，Oracle Data Guard配置可以在任意时间段内运行<a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC__I1036424">图13-3</a>中<a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC__I1036424">所示</a>的混合版本。
                           </p>
                           <div class="figure" id="GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC__I1036424">
                              <p class="titleinfigure">图13-3运行混合版本</p><img src="img/sbydb024.gif" alt="下面是图13-3的描述" title="下面是图13-3的描述" longdesc="img_text/sbydb024.html"><br><a href="img_text/sbydb024.html">“图13-3运行混合版本”的说明</a></div>
                           <!-- class="figure" -->
                           <p>要监视数据库B赶上数据库A的速度，请查询数据库B上的<code class="codeph">V$LOGSTDBY_PROGRESS</code>视图。例如：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER SESSION SET NLS_DATE_FORMAT ='DD-MON-YY HH24：MI：SS';会话改变了。SQL&gt; SELECT SYSDATE，APPLIED_TIME FROM V $ LOGSTDBY_PROGRESS; SYSDATE APPLIED_TIME ------------------ ------------------ 27-JUN-05 17:07:06 27- JUN-05 17:06:50</pre></li>
                        <li>
                           <p>建议您经常查询<code class="codeph">DBA_LOGSTDBY_EVENTS</code>视图，以了解是否有任何未在数据库B上应用的DDL和DML语句。</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SET LONG 1000 SQL&gt; SET PAGESIZE 180 SQL&gt; SET LINESIZE 79 SQL&gt; SELECT EVENT_TIMESTAMP，EVENT，STATUS FROM DBA_LOGSTDBY_EVENTS  - &gt; ORDER BY EVENT_TIMESTAMP; EVENT_TIMESTAMP ------------------------------------------------- -------------------------- EVENT ----------------------- -------------------------------------------------- -  -  - - 状态  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  - -------------------------------------- ... 24-MAY-05 05.18.29.318912 PM CREATE TABLE SYSTEM.TST（一个号码）ORA-16226：由于缺乏支持而跳过DDL 24-MAY-05 05.18.29.379990 PM“SYSTEM”。“TST”ORA-16129：遇到不支持的dml</pre><p>在前面的示例中：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">ORA-16226</code>错误显示无法支持的DDL语句。在这种情况下，它不能被支持，因为它属于内部模式。
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">ORA-16129</code>错误显示未应用DML语句。
                                 </p>
                              </li>
                           </ul>
                           <p>这些类型的错误表明并非数据库A上发生的所有更改都已应用于数据库B.此时，您必须决定是否继续升级过程。如果您确定逻辑备用数据库和主数据库之间的这种差异是可接受的，那么继续升级过程。如果没有，请停止并重新实例化数据库B并在其他时间执行升级过程。</p>
                        </li>
                        <li>
                           <p>如果您对升级的数据库软件正常运行感到满意，请通过在数据库A上发出以下语句来执行切换以反转数据库角色：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE COMMIT to SWITCHOVER to LOGICAL STANDBY;</pre><p>此语句必须等待现有事务完成。为了最大限度地缩短完成切换所需的时间，仍然连接到数据库A的用户应立即注销并重新连接到数据库B.</p>
                           <div class="infoboxnote" id="GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC__GUID-212130BB-C420-4F07-9002-76A0D97F46F8">
                              <p class="notep1">注意：</p>
                              <p>无法使用<a href="managing-oracle-data-guard-role-transitions.html#GUID-42B8B448-90E0-4D7D-82A3-AAA273E6E49B" title="执行切换以更改主数据库和逻辑备用数据库之间的角色时，请始终在主数据库上启动切换并在逻辑备用数据库上完成切换。">执行切换到逻辑备用数据库中</a>描述的通常的两阶段准备切换，因为它要求主数据库和备用数据库都运行相同版本的Oracle软件，此时主数据库运行较低Oracle软件的版本。相反，使用上面记录的单阶段无准备切换过程。未准备的切换只应在使用逻辑备用数据库进行滚动升级的上下文中使用。
                              </p>
                           </div>
                           <div class="infoboxnote" id="GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC__GUID-E90FE16C-2ABD-4650-82BA-601AA7704EAD">
                              <p class="notep1">注意：</p>
                              <p>如果您在数据库A作为主数据库时暂停对不受支持的表或包的活动，则如果您最终计划切换回数据库A，则必须在数据库B作为主数据库时继续挂起相同的活动。</p>
                           </div>
                        </li>
                        <li>
                           <p>第4步描述了如何列出正在修改的不支持的表。如果在主数据库上发布了不受支持的DML语句，则使用导入实用程序（如Oracle Data Pump）导入这些表的最新版本。</p>
                           <p>例如，以下import命令会截断<code class="codeph">scott.emp</code>表，并使用与以前的主数据库（A）匹配的数据填充它：</p><pre class="oac_no_warn" dir="ltr">impdp SYSTEM NETWORK_LINK = databasea TABLES = scott.emp TABLE_EXISTS_ACTION = TRUNCATE</pre><p>执行前，此命令会提示您输入<code class="codeph">impdp</code>密码。
                           </p>
                        </li>
                        <li>
                           <p>如果您对升级的数据库软件运行正常感到满意，请完成切换以反转数据库角色：</p>
                           <ol type="a">
                              <li>
                                 <p>在数据库B上，查询<code class="codeph">V$DATABASE</code>视图的<code class="codeph">SWITCHOVER_STATUS</code>列，如下所示：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT SWITCHOVER_STATUS FROM V $ DATABASE; SWITCHOVER_STATUS -------------------- to PRIMARY</pre></li>
                              <li>
                                 <p>当<code class="codeph">SWITCHOVER_STATUS</code>列显示<code class="codeph">TO PRIMARY</code> ，通过在数据库B上发出以下语句来完成切换：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE COMMIT to SWITCHOVER to PRIMARY;</pre><div class="infoboxnote" id="GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC__GUID-E9F69D28-F57A-412C-B269-A8C4D423B1AB">
                                    <p class="notep1">注意：</p>
                                    <p>无法使用<a href="managing-oracle-data-guard-role-transitions.html#GUID-42B8B448-90E0-4D7D-82A3-AAA273E6E49B" title="执行切换以更改主数据库和逻辑备用数据库之间的角色时，请始终在主数据库上启动切换并在逻辑备用数据库上完成切换。">执行切换到逻辑备用数据库中</a>描述的通常的两阶段准备切换，因为它要求主数据库和备用数据库都运行相同版本的Oracle软件，此时主数据库运行较低Oracle软件的版本。相反，使用上面记录的单阶段无准备切换过程。未准备的切换只应在使用逻辑备用数据库进行滚动升级的上下文中使用。
                                    </p>
                                 </div>
                              </li>
                              <li>
                                 <p>激活数据库B上的用户应用程序和服务，数据库B现在以主数据库角色运行。</p>
                              </li>
                           </ol>
                           <p>切换后，您无法将运行新数据库软件版本的新主数据库（B）中的重做数据发送到运行较旧软件版本的新备用数据库（A）。这意味着以下内容：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>重做数据正在新的主数据库上累积。</p>
                              </li>
                              <li>
                                 <p>新的主数据库目前尚未受到保护。</p>
                              </li>
                           </ul>
                           <p><a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC__CHDDIJEB">图13-4</a>显示了数据库B，前备用数据库（运行版本<span class="italic">y</span> ）现在是主数据库，而数据库A（前主数据库（运行版本<span class="variable" translate="no">x</span> ））现在是备用数据库。用户连接到数据库B.</p>
                           <p>如果数据库B可以充当主数据库，并且您的企业不需要逻辑备用数据库来支持主数据库，那么您已完成滚动升级过程。允许用户登录数据库B并开始在那里工作，并在方便时丢弃数据库A.否则，继续步骤8。</p>
                           <div class="figure" id="GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC__CHDDIJEB">
                              <p class="titleinfigure">图13-4切换后</p><img src="img/sbydb027.gif" alt="下面是图13-4的描述" title="下面是图13-4的描述" longdesc="img_text/sbydb027.html"><br><a href="img_text/sbydb027.html">“图13-4切换后”的描述</a></div>
                           <!-- class="figure" -->
                        </li>
                        <li>
                           <p>数据库A仍在运行版本<span class="italic">x，</span>并且在升级它并启动SQL Apply之前无法应用数据库B中的重做数据。
                           </p>
                           <p>有关升级Oracle数据库软件的更多信息，请参阅“ <a href="../upgrd/upgrading-oracle-database.html#UPGRD003" target="_blank"><span class="italic">Oracle数据库升级指南”</span></a> 。
                           </p>
                           <p><a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC__I1037856">图13-5</a>显示了两个数据库升级后的系统。
                           </p>
                           <div class="figure" id="GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC__I1037856">
                              <p class="titleinfigure">图13-5两个数据库升级</p><img src="img/sbydb025.gif" alt="下面是图13-5的描述" title="下面是图13-5的描述" longdesc="img_text/sbydb025.html"><br><a href="img_text/sbydb025.html">“图13-5两个数据库升级”的描述</a></div>
                           <!-- class="figure" -->
                        </li>
                        <li>
                           <p>发出以下语句以在数据库A上启动SQL Apply，并在必要时创建指向数据库B的数据库链接：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE START LOGICAL STANDBY立即应用新的主要<span class="variable" translate="no">db_link_to_b</span> ;</pre><div class="infoboxnote" id="GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC__GUID-FCBF7EF4-8605-45F2-A512-2504CCC7B54D">
                              <p class="notep1">注意：</p>
                              <p>您必须创建数据库链接（如果尚未设置）并使用<code class="codeph">NEW PRIMARY</code>子句，因为在步骤4中，使用单阶段未准备切换将数据库A转换为备用数据库。
                              </p>
                              <p>您必须以用户<code class="codeph">SYSTEM</code>或具有类似级别权限的帐户进行连接。
                              </p>
                           </div>
                           <p>在数据库A上启动SQL应用时，主数据库（B）上累积的重做数据将发送到逻辑备用数据库（A）。一旦备用数据库上的所有重做数据都可用，主数据库就会受到数据丢失的保护。</p>
                        </li>
                        <li>
                           <p>通过设置<code class="codeph">COMPATIBLE</code>提高两个数据库的兼容级别<a id="d33938e1187" class="indexterm-anchor"></a><a id="d33938e1191" class="indexterm-anchor"></a>初始化参数。在主数据库中引发逻辑备用数据库之前，必须提高其逻辑备用数据库的兼容级别。在主数据库上设置<code class="codeph">COMPATIBLE</code>参数之前，请在备用数据库上设置<code class="codeph">COMPATIBLE</code>参数。有关<code class="codeph">COMPATIBLE</code>初始化参数的详细信息，请参阅<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=REFRN10019" target="_blank"><span class="italic">Oracle数据库参考</span></a> 。
                           </p>
                        </li>
                        <li>
                           <p>要确保对数据库B执行的所有更改都正确应用于逻辑备用数据库（A），您应该经常查询<code class="codeph">DBA_LOGSTDBY_EVENTS</code>视图，就像在步骤4中对数据库A所做的那样。
                           </p>
                           <p>如果进行了更改以使数据库A无效为现有主数据库的副本，则可以丢弃数据库A并在其位置创建新的逻辑备用数据库。有关完整信息，请参阅<a href="creating-oracle-data-guard-logical-standby.html#GUID-3666CA35-D993-44B6-8D70-A2B8B9EC8B2E" title="创建逻辑备用数据库涉及许多步骤，包括先决条件和创建后任务。">创建逻辑备用数据库</a> 。
                           </p>
                        </li>
                        <li>
                           <p>（可选）执行数据库的另一次切换，以便数据库A再次以主数据库角色运行（ <a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-9DE40A97-7AB4-4444-B762-2238AB298BF0__I1029537">如图13-1</a>所示）。
                           </p>
                           <div class="infoboxnote" id="GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC__GUID-98B77601-1F7E-4F0C-BF3C-5D95E36DE4CB">
                              <p class="notep1">注意：</p>
                              <p>您使用<a href="managing-oracle-data-guard-role-transitions.html#GUID-42B8B448-90E0-4D7D-82A3-AAA273E6E49B" title="执行切换以更改主数据库和逻辑备用数据库之间的角色时，请始终在主数据库上启动切换并在逻辑备用数据库上完成切换。">执行切换到逻辑备用数据库中</a>描述的两阶段准备切换，因为此时，数据库A和数据库B都运行相同版本的Oracle软件。
                              </p>
                           </div>
                        </li>
                     </ol>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="SBYDB5072"></a><a id="SBYDB4884"></a><div class="props_rev_3"><a id="GUID-C5DF6148-C1E9-4ADF-A975-AC95FC64E0C4" name="GUID-C5DF6148-C1E9-4ADF-A975-AC95FC64E0C4"></a><h3 id="SBYDB-GUID-C5DF6148-C1E9-4ADF-A975-AC95FC64E0C4" class="sect3"><span class="enumeration_section">13.6</span>使用现有物理备用数据库执行滚动升级</h3>
               <div>
                  <p>这些步骤说明如何执行Oracle数据库软件的滚动升级，然后返回原始配置，其中A是主数据库，B是物理备用数据库，并且它们都运行升级的Oracle软件。</p>
                  <div class="section">
                     <div class="infoboxnote" id="GUID-C5DF6148-C1E9-4ADF-A975-AC95FC64E0C4__GUID-6C2B0D3B-D3D1-484B-9C2E-01E089399D41">
                        <p class="notep1">注意：</p>
                        <p>这些步骤假定您已经设置了主数据库（A）和物理备用数据库（B）并使用了Oracle Database 11.1或更高版本。</p>
                     </div>
                     <p><a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-C5DF6148-C1E9-4ADF-A975-AC95FC64E0C4__BABEIDGI" title="此2列表总结了使用物理备用数据库执行滚动升级的步骤。第1列是步骤编号。第2列描述了该步骤。">表13-3</a>总结了所涉及的步骤。
                     </p>
                     <div class="tblformal" id="GUID-C5DF6148-C1E9-4ADF-A975-AC95FC64E0C4__BABEIDGI">
                        <p class="titleintable">表13-3使用现有物理备用站执行滚动升级的步骤</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="使用现有物理备用站执行滚动升级的步骤" width="100%" border="1" summary="This 2 column table summarizes the steps to perform rolling upgrade with physical standby database. Column 1 is the step number. Column 2 describes the step. " frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="14%" id="d33938e1331">步</th>
                                 <th align="left" valign="bottom" width="86%" id="d33938e1334">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="14%" id="d33938e1339" headers="d33938e1331 ">
                                    <p>步骤1</p>
                                 </td>
                                 <td align="left" valign="top" width="86%" headers="d33938e1339 d33938e1334 ">
                                    <p>准备主数据库以进行滚动升级（在数据库A上执行这些步骤）</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="14%" id="d33938e1346" headers="d33938e1331 ">
                                    <p>第2步</p>
                                 </td>
                                 <td align="left" valign="top" width="86%" headers="d33938e1346 d33938e1334 ">
                                    <p>将物理备用数据库转换为逻辑备用数据库（在数据库B上执行这些步骤）</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="14%" id="d33938e1353" headers="d33938e1331 ">
                                    <p>第3步</p>
                                 </td>
                                 <td align="left" valign="top" width="86%" headers="d33938e1353 d33938e1334 ">
                                    <p>升级逻辑备用数据库并赶上主数据库（在数据库B上执行这些步骤）</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="14%" id="d33938e1360" headers="d33938e1331 ">
                                    <p>第4步</p>
                                 </td>
                                 <td align="left" valign="top" width="86%" headers="d33938e1360 d33938e1334 ">
                                    <p>闪回数据库A到保证还原点（在数据库A上执行这些步骤）</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="14%" id="d33938e1367" headers="d33938e1331 ">
                                    <p>第5步</p>
                                 </td>
                                 <td align="left" valign="top" width="86%" headers="d33938e1367 d33938e1334 ">
                                    <p>使用新版本的Oracle软件挂载数据库A.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="14%" id="d33938e1374" headers="d33938e1331 ">
                                    <p>第6步</p>
                                 </td>
                                 <td align="left" valign="top" width="86%" headers="d33938e1374 d33938e1334 ">
                                    <p>将数据库A转换为物理备用数据库</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="14%" id="d33938e1381" headers="d33938e1331 ">
                                    <p>第7步</p>
                                 </td>
                                 <td align="left" valign="top" width="86%" headers="d33938e1381 d33938e1334 ">
                                    <p>在数据库A上启动托管恢复</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="14%" id="d33938e1388" headers="d33938e1331 ">
                                    <p>第8步</p>
                                 </td>
                                 <td align="left" valign="top" width="86%" headers="d33938e1388 d33938e1334 ">
                                    <p>执行切换以使数据库A成为主数据库</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="14%" id="d33938e1395" headers="d33938e1331 ">
                                    <p>第9步</p>
                                 </td>
                                 <td align="left" valign="top" width="86%" headers="d33938e1395 d33938e1334 ">
                                    <p>清理在数据库A中创建的保证还原点</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <ol>
                        <li>
                           <p>准备主数据库以进行滚动升级（在数据库A上执行这些步骤）</p>
                           <ol type="a">
                              <li>
                                 <p>启用闪回数据库（如果尚未启用）：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SHUTDOWN IMMEDIATE; SQL&gt; STARTUP MOUNT; SQL&gt; ALTER DATABASE FLASHBACK ON; SQL&gt; ALTER DATABASE OPEN;</pre></li>
                              <li>
                                 <p>创建保证还原点：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; CREATE RESTORE POINT pre_upgrade GUARANTEE FLASHBACK DATABASE;</pre></li>
                           </ol>
                        </li>
                        <li>
                           <p>将物理备用数据库转换为逻辑备用数据库（在数据库B上执行这些步骤）。</p>
                           <ol type="a">
                              <li>
                                 <p>按照<a href="creating-oracle-data-guard-logical-standby.html#GUID-3666CA35-D993-44B6-8D70-A2B8B9EC8B2E" title="创建逻辑备用数据库涉及许多步骤，包括先决条件和创建后任务。">创建逻辑备用数据库中</a>概述的步骤进行操作，但以下区别除外。在<a href="creating-oracle-data-guard-logical-standby.html#GUID-715EBEC1-21B9-4DA9-80A5-ED58033F94C8" title="重做日志包含将物理备用数据库转换为逻辑备用数据库所需的信息。">转换为逻辑备用数据库时</a> ，必须使用其他命令转换逻辑备用数据库。而不是<code class="codeph">ALTER DATABASE RECOVER TO LOGICAL STANDBY db_name</code> ，发出以下命令：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE RECOVER TO LOGICAL STANDBY KEEP IDENTITY; SQL&gt; ALTER DATABASE OPEN;</pre></li>
                              <li>
                                 <p>首次启动SQL Apply之前，必须执行以下操作：</p>
                                 <ol type="i">
                                    <li>
                                       <p>禁用在逻辑备用数据库上自动删除外部存档日志，如下所示：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; EXECUTE DBMS_LOGSTDBY.APPLY_SET（'LOG_AUTO_DELETE'，'FALSE'）;</pre><div class="infoboxnote" id="GUID-C5DF6148-C1E9-4ADF-A975-AC95FC64E0C4__GUID-C9A8391C-A4B9-4526-885E-30E99238FA81">
                                          <p class="notep1">注意：</p>
                                          <p>不要删除逻辑备用数据库（数据库B）处理的任何远程存档日志。稍后在滚动升级过程中需要这些远程归档日志。如果使用恢复区来存储远程存档日志，则必须确保它具有足够的空间来容纳这些日志，而不会干扰逻辑备用数据库的正常操作。</p>
                                       </div>
                                    </li>
                                    <li>
                                       <p>确保捕获有关逻辑备用数据库不支持的主数据库上运行的事务的信息。运行以下过程以捕获信息并将其记录为<code class="codeph">DBA_LOGSTDBY_EVENTS</code>表中的事件：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; EXECUTE DBMS_LOGSTDBY.APPLY_SET（'MAX_EVENTS_RECORDED'， - &gt; DBMS_LOGSTDBY.MAX_EVENTS）; SQL&gt; EXECUTE DBMS_LOGSTDBY.APPLY_SET（'RECORD_UNSUPPORTED_OPERATIONS'，'TRUE'）;</pre></li>
                                    <li>
                                       <p>首次启动SQL Apply，如下所示：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE START LOGICAL STANDBY立即申请;</pre></li>
                                 </ol>
                                 <div class="infoboxnotealso" id="GUID-C5DF6148-C1E9-4ADF-A975-AC95FC64E0C4__GUID-F343AF1C-F77B-4A50-B8A4-56501F52B0A5">
                                    <p class="notep1">也可以看看：</p>
                                    <p></p>
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><a href="managing-oracle-data-guard-logical-standby-databases.html#GUID-D6EEF87A-211C-476C-9CBC-126858F7026A" title="可以将DBA_LOGSTDBY_EVENTS视图视为包含SQL Apply上下文中发生的最新有趣事件的循环日志。">自定义在DBA_LOGSTDBY_EVENTS查看记录事件</a>有关详细信息， <code class="codeph">DBA_LOGSTDBY_EVENTS</code>视图</p>
                                       </li>
                                       <li>
                                          <p>有关<code class="codeph">DBMS_LOGSTDBY</code>包的完整信息，请参阅<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=ARPLS363" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考</span></a></p>
                                       </li>
                                    </ul>
                                 </div>
                              </li>
                           </ol>
                        </li>
                        <li>
                           <p>您现在可以按照<a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC" title="These steps show how to perform a rolling upgrade of Oracle Database on the logical standby database and the primary database.">使用现有逻辑备用数据库执行滚动升级中</a>所述的步骤1到7 <a href="using-sql-apply-to-perform-rolling-upgrade.html#GUID-5995DF99-5268-43BE-BD63-D0DEAA8241EC" title="这些步骤说明如何在逻辑备用数据库和主数据库上执行Oracle数据库的滚动升级。">进行操作</a> 。在这些步骤结束时，数据库B是运行Oracle软件升级版本的主数据库，数据库A成为您的逻辑备用数据库。
                           </p>
                           <p>转到下一步，将数据库A转换为数据库B的物理备用数据库。</p>
                        </li>
                        <li>
                           <p>闪回数据库A到保证还原点（在数据库A上执行这些步骤）。</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SHUTDOWN IMMEDIATE; SQL&gt; STARTUP MOUNT; SQL&gt; FLASHBACK DATABASE恢复点pre_upgrade; SQL&gt; SHUTDOWN IMMEDIATE;</pre></li>
                        <li>
                           <p>此时，切换数据库A以使用更高版本的Oracle软件。您不运行升级脚本，因为数据库A已转换为物理备用数据库，并在应用数据库B生成的重做数据时自动升级。</p>
                           <p>挂载数据库A，如下：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; STARTUP MOUNT;</pre></li>
                        <li>
                           <p>将数据库A转换为物理备用数据库。</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE CONVERT TO PHYSICAL STANDBY; SQL&gt; SHUTDOWN IMMEDIATE;</pre></li>
                        <li>
                           <p>在数据库A上启动托管恢复</p>
                           <p>数据库A在应用数据库B生成的重做数据时会自动升级。在开始应用重做之前，托管恢复会一直等到主要的新化身分支进行注册。</p><pre class="oac_no_warn" dir="ltr">SQL&gt; STARTUP MOUNT; SQL&gt; ALTER DATABASE RECOVER MANAGED STANDBY DATABASE  - &gt;断开会话;</pre><div class="infoboxnote" id="GUID-C5DF6148-C1E9-4ADF-A975-AC95FC64E0C4__GUID-57BAD25D-DDD8-4574-9868-59006A87C841">
                              <p class="notep1">注意：</p>
                              <p>当重做应用重新启动时，它等待从当前主数据库（数据库B）注册新的化身。</p>
                           </div>
                        </li>
                        <li>
                           <p>此时，数据库B是您的主数据库，数据库A是您的物理备用数据库，它们都运行更高版本的Oracle软件。要使数据库A成为主数据库，请按照<span class="q">“ <a href="managing-oracle-data-guard-role-transitions.html#GUID-AAD70601-D248-4309-B8DD-F461EE31A5FF" title="These steps describe how to perform a switchover to a physical standby database.">执行切换到物理备用数据库</a> ”中</span>所述的步骤<span class="q"><a href="managing-oracle-data-guard-role-transitions.html#GUID-AAD70601-D248-4309-B8DD-F461EE31A5FF" title="这些步骤描述了如何切换到物理备用数据库。">进行操作</a></span> 。
                           </p>
                        </li>
                        <li>
                           <p>要保留磁盘空间，请删除在数据库A中创建的现有保证还原点：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; DROP RESTORE POINT PRE_UPGRADE;</pre></li>
                     </ol>
                     <div class="infoboxnotealso" id="GUID-C5DF6148-C1E9-4ADF-A975-AC95FC64E0C4__GUID-0D1597E4-D902-4E8A-8FB2-718254BA81C7">
                        <p class="notep1">也可以看看：</p>
                        <p>Oracle最高可用性体系结构（MAA）主页上提供的“使用瞬态逻辑备用数据库滚动升级：Oracle Data Guard 11 <span class="italic">g</span> ”最佳实践白皮书：</p>
                        <p><a href="http://www.oracle.com/goto/maa" target="_blank"><code class="codeph">http://www.oracle.com/goto/maa</code></a></p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>