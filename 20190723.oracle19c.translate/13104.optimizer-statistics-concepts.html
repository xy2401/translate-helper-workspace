<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="Oracle Database optimizer statistics describe details about the database and its objects."></meta>
      <meta name="description" content="Oracle Database optimizer statistics describe details about the database and its objects."></meta>
      <title>优化器统计概念</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="SQL Tuning Guide"></meta>
      <meta property="og:description" content="Oracle Database optimizer statistics describe details about the database and its objects."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="SQL Tuning Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="sql-tuning-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-31T14:57:08-08:00"></meta>
      <meta name="dcterms.title" content="SQL Tuning Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="2013, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96095-03"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="optimizer-statistics.html" title="Previous" type="text/html"></link>
      <link rel="next" href="histograms.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TGSQL"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="optimizer-statistics.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="histograms.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">SQL调优指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="optimizer-statistics.html" property="item" typeof="WebPage"><span property="name">优化器统计</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">优化器统计概念</li>
            </ol>
            <a id="GUID-C0E74ACE-2706-48A1-97A2-33F52207166A" name="GUID-C0E74ACE-2706-48A1-97A2-33F52207166A"></a><a id="TGSQL336"></a>
            
            <h2 id="TGSQL-GUID-C0E74ACE-2706-48A1-97A2-33F52207166A" class="sect2"><span class="enumeration_chapter">10</span>优化器统计概念</h2>
         </header>
         <div class="ind">
            <div>
               <p>Oracle数据库<strong class="term">优化器统计信息</strong>描述有关数据库及其对象的详细信息。
               </p>
               <p>本章包括以下主题：</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-AEE74FB8-98BD-416B-8EA0-32CD605DF64E">优化程序统计简介</a><br>优化程序<span class="bold">成本模型</span>依赖于收集的有关查询中涉及的对象的统计信息，以及运行查询的数据库和主机。
                  </li>
                  <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-BE4DF838-0E65-40AE-B69A-94669F30BE7C">关于优化程序统计类型</a><br>优化器收集有关不同类型的数据库对象和数据库环境特征的统计信息。
                  </li>
                  <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-3ED2DA31-F61B-4E8F-9166-79FB01392B1D">数据库如何收集优化程序统计信息</a><br>Oracle Database提供了几种收集统计信息的机制。
                  </li>
                  <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-13E8BD68-B8A1-4937-8774-3EF82FB8FB47">当数据库收集优化程序统计信息时</a><br>数据库会在不同时间从各种来源收集优化程序统计信息。
                  </li>
               </ul>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="optimizer-statistics.html#GUID-0A2F3D52-A135-43E1-9CAB-55BFE068A297" title="执行计划的准确性取决于优化程序统计信息的质量。">优化程序统计信息</a></p>
                  </div>
               </div>
            </div>
            <a id="TGSQL338"></a><a id="TGSQL337"></a><div class="props_rev_3"><a id="GUID-AEE74FB8-98BD-416B-8EA0-32CD605DF64E" name="GUID-AEE74FB8-98BD-416B-8EA0-32CD605DF64E"></a><h3 id="TGSQL-GUID-AEE74FB8-98BD-416B-8EA0-32CD605DF64E" class="sect3"><span class="enumeration_section">10.1</span>优化器统计简介</h3>
               <div>
                  <p>优化程序<span class="bold">成本模型</span>依赖于收集的有关查询中涉及的对象的统计信息，以及运行查询的数据库和主机。
                  </p>
                  <p>优化程序使用统计信息来估计从表，分区或索引中检索的行数（和字节数）。优化程序估计访问成本，确定可能计划的成本，然后以最低成本选择<a href="glossary.html#GUID-800F2BE7-A383-4FF3-A9A6-FCE786AABA3B"><span class="xrefglossterm">执行计划</span></a> 。
                  </p>
                  <p>优化器统计信息包括以下内容：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>表统计</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>行数</p>
                           </li>
                           <li>
                              <p>块数</p>
                           </li>
                           <li>
                              <p>平均行长度</p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>列统计</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>列中的不同值（NDV）的数量</p>
                           </li>
                           <li>
                              <p>列中的空值数</p>
                           </li>
                           <li>
                              <p>数据分布（直方图）</p>
                           </li>
                           <li>
                              <p>扩展统计</p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>指数统计</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>叶块数量</p>
                           </li>
                           <li>
                              <p>级别数</p>
                           </li>
                           <li>
                              <p>指数聚类因子</p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>系统统计</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>I / O性能和利用率</p>
                           </li>
                           <li>
                              <p>CPU性能和利用率</p>
                           </li>
                        </ul>
                     </li>
                  </ul>
                  <p><a href="optimizer-statistics-concepts.html#GUID-AEE74FB8-98BD-416B-8EA0-32CD605DF64E__CHDCACBD">如图10-1</a>所示，数据库存储数据字典中表，列，索引和系统的优化程序统计信息。您可以使用数据字典视图访问这些统计信息。
                  </p>
                  <div class="infoboxnote" id="GUID-AEE74FB8-98BD-416B-8EA0-32CD605DF64E__GUID-3402AAA7-FBB3-4CFA-ACF6-CC7C7BCF7504">
                     <p class="notep1">注意：</p>
                     <p>优化程序统计信息与通过<code class="codeph">V$</code>视图可见的性能统计信息不同。
                     </p>
                  </div>
                  <div class="figure" id="GUID-AEE74FB8-98BD-416B-8EA0-32CD605DF64E__CHDCACBD">
                     <p class="titleinfigure">图10-1优化器统计信息</p><img src="img/tgsql_vm_009.png" alt="下面是图10-1的描述" title="下面是图10-1的描述" longdesc="img_text/tgsql_vm_009.html"><br><a href="img_text/tgsql_vm_009.html">“图10-1优化器统计”的描述</a></div>
                  <!-- class="figure" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-C0E74ACE-2706-48A1-97A2-33F52207166A" title="Oracle数据库优化器统计信息描述有关数据库及其对象的详细信息。">优化程序统计信息概念</a></p>
                     </div>
                  </div>
               </div>
               
            </div><a id="TGSQL351"></a><div class="props_rev_3"><a id="GUID-BE4DF838-0E65-40AE-B69A-94669F30BE7C" name="GUID-BE4DF838-0E65-40AE-B69A-94669F30BE7C"></a><h3 id="TGSQL-GUID-BE4DF838-0E65-40AE-B69A-94669F30BE7C" class="sect3"><span class="enumeration_section">10.2</span>关于优化程序统计类型</h3>
               <div>
                  <p>优化器收集有关不同类型的数据库对象和数据库环境特征的统计信息。</p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-60281E3A-8A64-4072-A7F6-719BF9D51260">表统计</a><br>表统计信息包含优化程序在开发执行计划时使用的元数据。
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-CAD8B1D9-9732-44C2-BF84-ABD82AB1ABC3">列统计</a><br>列统计信息跟踪有关列值和数据分布的信息。
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-5D96E789-9297-49F1-B304-FFEA335CF678">指数统计</a><br><strong class="term">索引统计信息</strong>包括有关索引级别数，索引块数以及索引和数据块之间关系的信息。优化程序使用这些统计信息来确定索引扫描的成本。
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-FE339C05-E7A4-4953-89C4-D5C69F0C08BA">系统统计</a><br><span class="bold">系统统计信息</span>描述了硬件特性，例如I / O和CPU性能和利用率。
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-184A744A-2F2F-4C4C-88E6-107EAD1D517E">用户定义的优化程序统计信息</a><br><strong class="term">可扩展优化</strong>器使用户定义函数和索引的作者能够创建统计信息收集，选择性和成本函数。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-C0E74ACE-2706-48A1-97A2-33F52207166A" title="Oracle数据库优化器统计信息描述有关数据库及其对象的详细信息。">优化程序统计信息概念</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="sect3"><a id="GUID-60281E3A-8A64-4072-A7F6-719BF9D51260" name="GUID-60281E3A-8A64-4072-A7F6-719BF9D51260"></a><h4 id="TGSQL-GUID-60281E3A-8A64-4072-A7F6-719BF9D51260" class="sect4"><span class="enumeration_section">10.2.1</span>表统计</h4>
                  <div>
                     <p>表统计信息包含优化程序在开发执行计划时使用的元数据。</p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-BCFD6363-8860-41AE-9920-60EB695C7374">永久表统计</a><br>在Oracle数据库中， <span class="bold">表统计信息</span>包括有关行和块的信息。
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-094E2608-A1CB-46B6-A329-99C6B497A106">临时表统计</a><br><code class="codeph">DBMS_STATS</code>可以收集永久和临时表的统计信息，但其他注意事项适用于后者。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-BE4DF838-0E65-40AE-B69A-94669F30BE7C" title="优化器收集有关不同类型的数据库对象和数据库环境特征的统计信息。">关于优化程序统计信息类型</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL354"></a><a id="TGSQL352"></a><div class="props_rev_3"><a id="GUID-BCFD6363-8860-41AE-9920-60EB695C7374" name="GUID-BCFD6363-8860-41AE-9920-60EB695C7374"></a><h5 id="TGSQL-GUID-BCFD6363-8860-41AE-9920-60EB695C7374" class="sect5"><span class="enumeration_section">10.2.1.1</span>永久表统计</h5>
                     <div>
                        <p>在Oracle数据库中， <span class="bold">表统计信息</span>包括有关行和块的信息。
                        </p>
                        <p>优化程序使用这些统计信息来确定表扫描和表连接的开销。数据库跟踪有关永久表的所有相关统计信息。例如，存储在<code class="codeph">DBA_TAB_STATISTICS</code>表统计信息跟踪以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>行数</p>
                              <p>在确定<a href="glossary.html#GUID-FE541AF8-DCAB-4B00-8015-04BDCB295A85"><span class="xrefglossterm">基数</span></a>时，数据库使用存储在<code class="codeph">DBA_TAB_STATISTICS</code>的行计数。
                              </p>
                           </li>
                           <li>平均行长度</li>
                           <li>
                              <p>数据块数</p>
                              <p>优化程序使用带有<code class="codeph">DB_FILE_MULTIBLOCK_READ_COUNT</code>初始化参数的数据块数来确定基表访问开销。
                              </p>
                           </li>
                           <li>
                              <p>空数据块的数量</p>
                           </li>
                        </ul>
                        <p> <code class="codeph">DBMS_STATS.GATHER_TABLE_STATS</code>在收集永久表的统计信息之前提交。
                        </p>
                        <div class="example" id="GUID-BCFD6363-8860-41AE-9920-60EB695C7374__GUID-C96C12AE-3199-4028-A208-52F90E56C4EE">
                           <p class="titleinexample">例10-1表统计</p>
                           <p>此示例查询<code class="codeph">sh.customers</code>表的表统计信息。
                           </p><pre class="pre codeblock"><code>SELECT NUM_ROWS，AVG_ROW_LEN，BLOCKS，EMPTY_BLOCKS，LAST_ANALYZED FROM DBA_TAB_STATISTICS OWNER ='SH'和TABLE_NAME ='CUSTOMERS';</code></pre><p>示例输出显示如下：</p><pre class="pre codeblock"><code>NUM_ROWS AVG_ROW_LEN BLOCKS EMPTY_BLOCKS LAST_ANAL ---------- ----------- ---------- -------------- ------- 55500 189 1517 0 25-MAY-17</code></pre></div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-BCFD6363-8860-41AE-9920-60EB695C7374__GUID-8710CA0D-00B0-48DA-857F-38BE63C5EAA2">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="influencing-the-optimizer.html#GUID-C1C85DEA-3583-40FE-B5BB-6AC8F76FFE34" title="Oracle数据库提供初始化参数以影响优化器行为的各个方面，包括游标共享，自适应优化和优化器模式。">关于优化器初始化参数</a> ”</span></p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D" title="使用GATHER_TABLE_STATS收集表统计信息，使用GATHER_SCHEMA_STATS收集模式中所有对象的统计信息。">收集架构和表统计信息</a> ”</span></p>
                              </li>
                              <li>
                                 <p> 有关<code class="codeph">DBA_TAB_STATISTICS</code>视图和<code class="codeph">DB_FILE_MULTIBLOCK_READ_COUNT</code>初始化参数的说明，请<code class="codeph">DBA_TAB_STATISTICS</code> <a href="../refrn/DBA_TAB_STATISTICS.html#REFRN23376" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-60281E3A-8A64-4072-A7F6-719BF9D51260" title="表统计信息包含优化程序在开发执行计划时使用的元数据。">表统计信息</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL355"></a><div class="props_rev_3"><a id="GUID-094E2608-A1CB-46B6-A329-99C6B497A106" name="GUID-094E2608-A1CB-46B6-A329-99C6B497A106"></a><h5 id="TGSQL-GUID-094E2608-A1CB-46B6-A329-99C6B497A106" class="sect5"><span class="enumeration_section">10.2.1.2</span>临时表统计</h5>
                     <div>
                        <p><code class="codeph">DBMS_STATS</code>可以收集永久和临时表的统计信息，但其他注意事项适用于后者。
                        </p>
                        <p>本节包含以下主题：</p>
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-C0F7F290-8430-442F-8E7D-0371834E9917">临时表的类型</a><br>临时表分为全局，私有或游标持续时间。
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-630486FC-9175-48BA-9649-E35D377F816F">全球临时表的统计数据</a><br><code class="codeph">DBMS_STATS</code>为永久表收集全局临时表的相同类型的统计信息。
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-1355E1A8-DB82-4C6F-943F-3028ECEA4333">全局临时表的共享和特定于会话的统计信息</a><br>从<span>Oracle Database 12c开始</span> ，您可以设置表级首选项<code class="codeph">GLOBAL_TEMP_TABLE_STATS</code> ，以对共享（ <code class="codeph">SHARED</code> ）或特定于会话（ <code class="codeph">SESSION</code> ）的全局临时表进行统计。
                           </li>
                        </ul>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-60281E3A-8A64-4072-A7F6-719BF9D51260" title="表统计信息包含优化程序在开发执行计划时使用的元数据。">表统计信息</a></p>
                           </div>
                        </div>
                     </div>
                     
                     <div class="sect5"><a id="GUID-C0F7F290-8430-442F-8E7D-0371834E9917" name="GUID-C0F7F290-8430-442F-8E7D-0371834E9917"></a><h6 id="TGSQL-GUID-C0F7F290-8430-442F-8E7D-0371834E9917" class="sect6"><span class="enumeration_section">10.2.1.2.1</span>临时表的类型</h6>
                        <div>
                           <p>临时表分为全局，私有或游标持续时间。</p>
                           <p>在所有类型的临时表中，数据仅对插入它的会话可见。表格如下：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><strong class="term">全局临时表</strong>是显式创建的持久对象，用于存储特定持续时间的中间会话私有数据。
                                 </p>
                                 <p>该表是全局的，因为所有会话都可以看到该定义。<code class="codeph">CREATE GLOBAL TEMPORARY TABLE</code>的<code class="codeph">ON COMMIT</code>子句指示表是特定于事务（ <code class="codeph">DELETE ROWS</code> ）还是特定于会话（ <code class="codeph">PRESERVE ROWS</code> ）。全局临时表的优化程序统计信息可以共享或特定于会话。
                                 </p>
                              </li>
                              <li>
                                 <p><strong class="term">私有临时表</strong>是显式创建的对象，由私有内存元数据定义，用于存储特定持续时间的中间会话私有数据。
                                 </p>
                                 <p>该表是私有的，因为该定义仅对创建表的会话可见。<code class="codeph">CREATE PRIVATE TEMPORARY TABLE</code>的<code class="codeph">ON COMMIT</code>子句指示表是特定于事务（ <code class="codeph">DROP DEFINITION</code> ）还是特定于会话（ <code class="codeph">PRESERVE DEFINITION</code> ）。
                                 </p>
                              </li>
                              <li>
                                 <p><strong class="term">游标持续时间临时表</strong>是与游标关联的隐式创建的仅内存对象。
                                 </p>
                                 <p>与全局和专用临时表不同， <code class="codeph">DBMS_STATS</code>无法收集游标持续时间临时表的统计信息。
                                 </p>
                              </li>
                           </ul>
                           <p>这些表的不同之处在于它们存储数据的位置，创建和删除数据的方式以及元数据的持续时间和可见性。请注意，当会话首次将数据插入全局临时表时，数据库会分配存储空间，而不是在创建表时。</p>
                           <div class="tblformal" id="GUID-C0F7F290-8430-442F-8E7D-0371834E9917__GUID-4250B181-AA2C-4D43-8ADC-DB295FE21D86">
                              <p class="titleintable">表10-1临时表的重要特征</p>
                              <table cellpadding="4" cellspacing="0" class="Formal" title="临时表的重要特征" border="1" summary="This table describes the characteristics of global temporary tables, private temporary tables, and cursor-duration temporary tables" frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="20%" id="d60325e1212">特性</th>
                                       <th align="left" valign="bottom" width="20%" id="d60325e1214">全球临时表</th>
                                       <th align="left" valign="bottom" width="20%" id="d60325e1216">私人临时表</th>
                                       <th align="left" valign="bottom" width="20%" id="d60325e1218">游标持续时间临时表</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d60325e1222" headers="d60325e1212 ">数据的可见性</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1222 d60325e1214 ">会话插入数据</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1222 d60325e1216 ">会话插入数据</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1222 d60325e1218 ">会话插入数据</td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d60325e1231" headers="d60325e1212 ">存储数据</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1231 d60325e1214 ">一贯</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1231 d60325e1216 ">内存或临时文件，但仅限于会话或事务的持续时间</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1231 d60325e1218 ">只在记忆中</td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d60325e1240" headers="d60325e1212 ">元数据的可见性</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1240 d60325e1214 ">所有会议</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1240 d60325e1216 ">创建表的会话（在<code class="codeph">USER_PRIVATE_TEMP_TABLES</code>视图中，基于<code class="codeph">V$</code>视图）</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1240 d60325e1218 ">会话执行游标</td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d60325e1255" headers="d60325e1212 ">元数据的持续时间</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1255 d60325e1214 ">直到明确删除表</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1255 d60325e1216 ">直到表被明确删除，或会话结束（ <code class="codeph">PRESERVE DEFINITION</code> ）或事务（ <code class="codeph">DROP DEFINITION</code> ）</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1255 d60325e1218 ">直到游标超出共享池</td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d60325e1270" headers="d60325e1212 ">创建表</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1270 d60325e1214 "><code class="codeph">CREATE GLOBAL TEMPORARY TABLE</code> （支持<code class="codeph">AS SELECT</code> ）</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1270 d60325e1216 "><code class="codeph">CREATE PRIVATE TEMPORARY TABLE</code> （支持<code class="codeph">AS SELECT</code> ）</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1270 d60325e1218 ">当优化器认为它有用时隐式创建</td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d60325e1289" headers="d60325e1212 ">创作对现有交易的影响</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1289 d60325e1214 ">没有隐式提交</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1289 d60325e1216 ">没有隐式提交</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1289 d60325e1218 ">没有隐式提交</td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d60325e1298" headers="d60325e1212 ">命名规则</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1298 d60325e1214 ">与永久表相同</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1298 d60325e1216 ">必须以<code class="codeph">ORA$PTT_</code></td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1298 d60325e1218 ">内部生成的唯一名称</td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d60325e1309" headers="d60325e1212 ">滴表</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1309 d60325e1214 "><code class="codeph">DROP GLOBAL TEMPORARY TABLE</code></td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1309 d60325e1216 "><code class="codeph">DROP PRIVATE TEMPORARY TABLE</code> ，或在会话结束时隐式删除（ <code class="codeph">PRESERVE DEFINITION</code> ）或事务（ <code class="codeph">DROP DEFINITION</code> ）</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1309 d60325e1218 ">在会话结束时隐式掉线</td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-C0F7F290-8430-442F-8E7D-0371834E9917__GUID-A9B4EC93-5BFD-4125-AF8E-B30E149C57E9">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><span class="q">“ <a href="query-transformations.html#GUID-C1AE164B-E99F-418A-9B2A-1ADB036048DF" title="为了实现查询的中间结果，Oracle数据库可以在查询编译期间在内存中隐式创建游标持续时间临时表。">光标持续时间临时表</a> ”</span></p>
                                 </li>
                                 <li>
                                    <p><a href="../admin/managing-tables.html#ADMIN-GUID-A48CB362-FC15-4A26-8386-906A55F6788E" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a> ，了解如何管理临时表</p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-094E2608-A1CB-46B6-A329-99C6B497A106" title="DBMS_STATS可以收集永久和临时表的统计信息，但其他注意事项适用于后者。">临时表统计信息</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL95329"></a><div class="props_rev_3"><a id="GUID-630486FC-9175-48BA-9649-E35D377F816F" name="GUID-630486FC-9175-48BA-9649-E35D377F816F"></a><h6 id="TGSQL-GUID-630486FC-9175-48BA-9649-E35D377F816F" class="sect6"><span class="enumeration_section">10.2.1.2.2</span>全球临时表的统计</h6>
                        <div>
                           <p><code class="codeph">DBMS_STATS</code>为永久表收集全局临时表的相同类型的统计信息。
                           </p>
                           <div class="infoboxnote" id="GUID-630486FC-9175-48BA-9649-E35D377F816F__GUID-64080EBB-877A-4DAE-8A7B-584551E3014C">
                              <p class="notep1">注意：</p>
                              <p>您无法收集私有临时表的统计信息。</p>
                           </div>
                           <p>下表显示了全局临时表如何收集和存储优化程序统计信息的方式不同，具体取决于表是否作用于事务或会话。</p>
                           <div class="tblformal" id="GUID-630486FC-9175-48BA-9649-E35D377F816F__GUID-3F667E8A-91B7-4905-81B9-D80BEA63E193">
                              <p class="titleintable">表10-2全局临时表的优化程序统计信息</p>
                              <table cellpadding="4" cellspacing="0" class="Formal" title="全局临时表的优化程序统计信息" border="1" summary="This table describes the characteristics of global temporary tables." frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="20%" id="d60325e1480">特性</th>
                                       <th align="left" valign="bottom" width="20%" id="d60325e1482">特定交易</th>
                                       <th align="left" valign="bottom" width="20%" id="d60325e1484">会话特定</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d60325e1488" headers="d60325e1480 "><code class="codeph">DBMS_STATS</code>集合的影响</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1488 d60325e1482 ">不承诺</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1488 d60325e1484 ">提交</td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d60325e1498" headers="d60325e1480 ">存储统计数据</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1498 d60325e1482 ">只有记忆</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1498 d60325e1484 ">字典表</td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="20%" id="d60325e1505" headers="d60325e1480 ">直方图创建</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1505 d60325e1482 ">不支持</td>
                                       <td align="left" valign="top" width="20%" headers="d60325e1505 d60325e1484 ">支持的</td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <p>以下过程不提交特定于事务的临时表，因此不会删除这些表中的行：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">GATHER_TABLE_STATS</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">DELETE_ <span class="codeinlineitalic">obj</span> _STATS</code> ，其中<span class="italic"><code class="codeph">obj</code></span>是<code class="codeph">TABLE</code> ， <code class="codeph">COLUMN</code>或<code class="codeph">INDEX</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">SET_ <span class="codeinlineitalic">obj</span> _STATS</code> ，其中<span class="italic"><code class="codeph">obj</code></span>是<code class="codeph">TABLE</code> ， <code class="codeph">COLUMN</code>或<code class="codeph">INDEX</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">GET_ <span class="codeinlineitalic">obj</span> _STATS</code> ，其中<span class="italic"><code class="codeph">obj</code></span>是<code class="codeph">TABLE</code> ， <code class="codeph">COLUMN</code>或<code class="codeph">INDEX</code></p>
                              </li>
                           </ul>
                           <p>前面的程序单元<code class="codeph">GLOBAL_TEMP_TABLE_STATS</code>统计信息首选项。例如，如果表首选项设置为<code class="codeph">SESSION</code> ，则<code class="codeph">SET_TABLE_STATS</code>设置会话统计信息， <code class="codeph">GATHER_TABLE_STATS</code> <span class="italic">保留</span>特定于事务的临时表中的所有行。但是，如果表首选项设置为<code class="codeph">SHARED</code> ，则<code class="codeph">SET_TABLE_STATS</code>设置共享统计信息， <code class="codeph">GATHER_TABLE_STATS</code>从特定于事务的临时表中<span class="italic">删除</span>所有行。
                           </p>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-630486FC-9175-48BA-9649-E35D377F816F__GUID-9F5EFD7E-069E-4032-B1DC-B98F7A3FE99A">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D" title="使用GATHER_TABLE_STATS收集表统计信息，使用GATHER_SCHEMA_STATS收集模式中所有对象的统计信息。">收集架构和表统计信息</a> ”</span></p>
                                 </li>
                                 <li>
                                    <p><a href="../cncpt/tables-and-table-clusters.html#CNCPT88820" target="_blank"><span><cite>Oracle Database Concepts</cite></span></a> ，了解全局临时表</p>
                                 </li>
                                 <li>
                                    <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-CA6A56B9-0540-45E9-B1D7-D78769B7714C" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_STATS.GATHER_TABLE_STATS</code>过程</p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-094E2608-A1CB-46B6-A329-99C6B497A106" title="DBMS_STATS可以收集永久和临时表的统计信息，但其他注意事项适用于后者。">临时表统计信息</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL95328"></a><div class="props_rev_3"><a id="GUID-1355E1A8-DB82-4C6F-943F-3028ECEA4333" name="GUID-1355E1A8-DB82-4C6F-943F-3028ECEA4333"></a><h6 id="TGSQL-GUID-1355E1A8-DB82-4C6F-943F-3028ECEA4333" class="sect6"><span class="enumeration_section">10.2.1.2.3</span>全局临时表的共享和特定于会话的统计信息</h6>
                        <div>
                           <p>从<span>Oracle Database 12c开始</span> ，您可以设置表级首选项<code class="codeph">GLOBAL_TEMP_TABLE_STATS</code> ，以对共享（ <code class="codeph">SHARED</code> ）或特定于会话（ <code class="codeph">SESSION</code> ）的全局临时表进行统计。
                           </p>
                           <p>当<code class="codeph">GLOBAL_TEMP_TABLE_STATS</code>为<code class="codeph">SESSION</code> ，您可以在一个会话中收集全局临时表的优化程序统计信息，然后仅使用此会话的统计信息。同时，用户可以继续维护统计信息的共享版本。在优化期间，优化程序首先检查全局临时表是否具有特定于会话的统计信息。如果是，则优化器使用它们。否则，优化程序使用共享统计信息（如果存在）。
                           </p>
                           <div class="infoboxnote" id="GUID-1355E1A8-DB82-4C6F-943F-3028ECEA4333__GUID-4EF16686-D410-48D5-AF08-1E3F5D7E721D">
                              <p class="notep1">注意：</p>
                              <p>在<span>Oracle Database 12c</span>之前的版本中，数据库不会以不同方式维护全局临时表和非全局临时表的优化程序统计信息。数据库维护了所有会话共享的统计信息的一个版本，即使不同会话中的数据可能不同。
                              </p>
                           </div>
                           <p>特定于会话的优化程序统计信息具有以下特征：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>跟踪统计信息的字典视图显示当前会话中的共享统计信息和特定于会话的统计信息。</p>
                                 <p>视图是<code class="codeph">DBA_TAB_STATISTICS</code> ， <code class="codeph">DBA_IND_STATISTICS</code> ， <code class="codeph">DBA_TAB_HISTOGRAMS</code>和<code class="codeph">DBA_TAB_COL_STATISTICS</code> （每个视图都有相应的<code class="codeph">USER_</code>和<code class="codeph">ALL_</code>版本）。<code class="codeph">SCOPE</code>列显示统计信息是特定于会话还是共享。特定于会话的统计信息必须存储在数据字典中，以便多个进程可以在Oracle RAC中访问它们。</p>
                              </li>
                              <li>
                                 <p></p>
                                 <p><code class="codeph">创建 ...AS SELECT</code>自动收集优化程序统计信息。但是，当<code class="codeph">GLOBAL_TEMP_TABLE_STATS</code>设置为<code class="codeph">SHARED</code>时，您必须使用<code class="codeph">DBMS_STATS</code>手动收集统计信息。</p>
                              </li>
                              <li>
                                 <p>不支持待定统计信息。</p>
                              </li>
                              <li>
                                 <p>其他会话不共享使用特定于会话的统计信息的游标。</p>
                                 <p>不同的会话可以共享使用<span class="italic">共享</span>统计信息的游标，如早于<span>Oracle Database 12c的版本</span> 。同一会话可以共享使用特定于会话的统计信息的游标。
                                 </p>
                              </li>
                              <li>
                                 <p>默认情况下，临时表的<code class="codeph">GATHER_TABLE_STATS</code>立即使先前在同一会话中编译的游标无效。但是，此过程不会使在其他会话中编译的游标无效。
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-1355E1A8-DB82-4C6F-943F-3028ECEA4333__GUID-A5678D7A-5DFE-4154-AB9C-DC9744E401FB">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><a href="../arpls/DBMS_STATS.html#ARPLS-GUID-CDAA4742-5398-4A64-B871-E39F38D0021F" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">GLOBAL_TEMP_TABLE_STATS</code>首选项</p>
                                 </li>
                                 <li>
                                    <p><a href="../refrn/DBA_TAB_STATISTICS.html#REFRN-GUID-03D846F8-5906-42FE-983B-E3434F5545A7" target="_blank"><span><cite>Oracle Database Reference，</cite></span></a>用于描述<code class="codeph">DBA_TAB_STATISTICS</code>视图</p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-094E2608-A1CB-46B6-A329-99C6B497A106" title="DBMS_STATS可以收集永久和临时表的统计信息，但其他注意事项适用于后者。">临时表统计信息</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div>
               </div><a id="TGSQL356"></a><div class="props_rev_3"><a id="GUID-CAD8B1D9-9732-44C2-BF84-ABD82AB1ABC3" name="GUID-CAD8B1D9-9732-44C2-BF84-ABD82AB1ABC3"></a><h4 id="TGSQL-GUID-CAD8B1D9-9732-44C2-BF84-ABD82AB1ABC3" class="sect4"><span class="enumeration_section">10.2.2</span>列统计</h4>
                  <div>
                     <p>列统计信息跟踪有关列值和数据分布的信息。</p>
                     <p>优化程序使用列统计信息生成准确的<span class="bold">基数</span>估计值，并对索引使用，连接顺序，连接方法等做出更好的决策。例如， <code class="codeph">DBA_TAB_COL_STATISTICS</code>统计信息跟踪以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>不同值的数量</p>
                        </li>
                        <li>
                           <p>空值数</p>
                        </li>
                        <li>
                           <p>高值和低值</p>
                        </li>
                        <li>
                           <p>直方图相关信息</p>
                        </li>
                     </ul>
                     <p>优化器可以使用<a href="glossary.html#GUID-0171CA72-03D5-4A7E-9EA1-1C08455799C2"><span class="xrefglossterm">扩展统计信息</span></a> ，这是一种特殊类型的列统计信息。这些统计信息对于通知优化器列之间的逻辑关系非常有用。
                     </p>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-CAD8B1D9-9732-44C2-BF84-ABD82AB1ABC3__GUID-3C267BA8-99F3-4C5A-B6CB-C852BB073605">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="histograms.html#GUID-BE10EBFC-FEFC-4530-90DF-1443D9AD9B64" title="直方图是一种特殊类型的列统计信息，它提供有关表列中数据分布的更多详细信息。直方图将值排序为" buckets="=" ="">直方图</a> ”</span></p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="managing-extended-statistics.html#GUID-858E0BDA-06C6-471F-B9E8-888C3AD29673" title="单个列统计信息对于确定WHERE子句中单个谓词的选择性非常有用。">关于列组的统计信息</a> ”</span></p>
                           </li>
                           <li>
                              <p>有关<code class="codeph">DBA_TAB_COL_STATISTICS</code>视图的说明，请<code class="codeph">DBA_TAB_COL_STATISTICS</code> <a href="../refrn/DBA_TAB_STATISTICS.html#REFRN23376" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-BE4DF838-0E65-40AE-B69A-94669F30BE7C" title="优化器收集有关不同类型的数据库对象和数据库环境特征的统计信息。">关于优化程序统计信息类型</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL357"></a><div class="props_rev_3"><a id="GUID-5D96E789-9297-49F1-B304-FFEA335CF678" name="GUID-5D96E789-9297-49F1-B304-FFEA335CF678"></a><h4 id="TGSQL-GUID-5D96E789-9297-49F1-B304-FFEA335CF678" class="sect4"><span class="enumeration_section">10.2.3</span>指数统计</h4>
                  <div>
                     <p><strong class="term">索引统计信息</strong>包括有关索引级别数，索引块数以及索引和数据块之间关系的信息。优化程序使用这些统计信息来确定索引扫描的成本。
                     </p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-CE899A61-1922-48E6-88DE-A7278C247E8C">指数统计的类型</a><br><code class="codeph">DBA_IND_STATISTICS</code>视图跟踪索引统计信息。
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-84A4914F-10C5-49BE-92AF-F26DEC5D060F">指数聚类因子</a><br>对于B树索引， <strong class="term">索引聚类因子</strong>测量与索引值（例如姓氏）相关的行的物理分组。
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-5677EA51-E2DD-4562-B44C-336E329D5288">指数聚类因子对成本的影响：实例</a><br>此示例说明了索引聚类因子如何影响表访问的成本。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-BE4DF838-0E65-40AE-B69A-94669F30BE7C" title="优化器收集有关不同类型的数据库对象和数据库环境特征的统计信息。">关于优化程序统计信息类型</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL358"></a><div class="props_rev_3"><a id="GUID-CE899A61-1922-48E6-88DE-A7278C247E8C" name="GUID-CE899A61-1922-48E6-88DE-A7278C247E8C"></a><h5 id="TGSQL-GUID-CE899A61-1922-48E6-88DE-A7278C247E8C" class="sect5"><span class="enumeration_section">10.2.3.1</span>索引统计的类型</h5>
                     <div>
                        <p><code class="codeph">DBA_IND_STATISTICS</code>视图跟踪索引统计信息。
                        </p>
                        <p>统计数据包括：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>水平</p>
                              <p><code class="codeph">BLEVEL</code>列显示从根块到叶块所需的块数。B树索引有两种类型的块：用于搜索的分支块和用于存储值的叶块。有关B树索引的概念性概述，请参阅<a href="../cncpt/indexes-and-index-organized-tables.html#CNCPT1170" target="_blank"><span><cite>Oracle数据库概念</cite></span></a> 。
                              </p>
                           </li>
                           <li>
                              <p>不同的钥匙</p>
                              <p>此列跟踪不同索引值的数量。如果定义了唯一约束，并且未定义<code class="codeph">NOT NULL</code>约束，则此值等于非空值的数量。
                              </p>
                           </li>
                           <li>
                              <p>每个不同索引键的平均叶块数</p>
                           </li>
                           <li>
                              <p>每个不同的索引键指向的平均数据块数</p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-CE899A61-1922-48E6-88DE-A7278C247E8C__GUID-6405DE23-9762-4FEC-86DE-FE143BA48FA4">
                           <p class="notep1">也可以看看：</p>
                           <p> <a href="../refrn/DBA_TAB_STATISTICS.html#REFRN23376" target="_blank"><span><cite>Oracle Database Reference，</cite></span></a>用于描述<code class="codeph">DBA_IND_STATISTICS</code>视图</p>
                        </div>
                        <div class="example" id="GUID-CE899A61-1922-48E6-88DE-A7278C247E8C__GUID-A8636D14-18A5-46EF-8962-B849995E509E">
                           <p class="titleinexample">例10-2索引统计</p>
                           <p>此示例查询的一些索引统计<code class="codeph">cust_lname_ix</code>和<code class="codeph">customers_pk</code>上索引<code class="codeph">sh.customers</code>表（包含的样本输出）：</p><pre class="pre codeblock"><code>选择INDEX_NAME，BLEVEL，LEAF_BLOCKS作为“LEAFBLK”，DISTINCT_KEYS作为“DIST_KEY”，AVG_LEAF_BLOCKS_PER_KEY作为“LEAFBLK_PER_KEY”，AVG_DATA_BLOCKS_PER_KEY作为“DATABLK_PER_KEY”来自DBA_IND_STATISTICS，其中OWNER ='SH'和INDEX_NAME IN（'CUST_LNAME_IX'，'CUSTOMERS_PK'）; INDEX_NAME BLEVEL LEAFBLK DIST_KEY LEAFBLK_PER_KEY DATABLK_PER_KEY -------------- ------ ------- -------- --------- ------ --------------- CUSTOMERS_PK 1 115 55500 1 1 CUST_LNAME_IX 1 141 908 1 10</code></pre></div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-5D96E789-9297-49F1-B304-FFEA335CF678" title="索引统计信息包括有关索引级别数，索引块数以及索引和数据块之间关系的信息。优化程序使用这些统计信息来确定索引扫描的成本。">索引统计</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL94859"></a><a id="TGSQL359"></a><div class="props_rev_3"><a id="GUID-84A4914F-10C5-49BE-92AF-F26DEC5D060F" name="GUID-84A4914F-10C5-49BE-92AF-F26DEC5D060F"></a><h5 id="TGSQL-GUID-84A4914F-10C5-49BE-92AF-F26DEC5D060F" class="sect5"><span class="enumeration_section">10.2.3.2</span>索引聚类因子</h5>
                     <div>
                        <p>对于B树索引， <strong class="term">索引聚类因子</strong>测量与索引值（例如姓氏）相关的行的物理分组。
                        </p>
                        <p>索引聚类因子有助于优化器确定索引扫描或全表扫描对于某些查询是否更有效。低聚类因子表示有效的索引扫描。</p>
                        <p>与表中的<span class="italic">块</span>数接近的聚类因子表示通过索引键在表块中对这些行进行物理排序。如果数据库执行<a href="glossary.html#GUID-DCAD1CDB-8714-4900-9CB3-8C26802D3B63"><span class="xrefglossterm">全表扫描</span></a> ，则数据库倾向于检索行，因为它们存储在按索引键排序的磁盘上。接近<span class="italic">行</span>数的聚类因子表示行相对于索引键在数据库块中随机分散。如果数据库执行全表扫描，则数据库不会通过此索引键以任何排序顺序检索行。
                        </p>
                        <p>聚类因子是特定索引的属性，而不是表。如果表上存在多个索引，则一个索引的聚类因子可能较小，而另一个索引的因子较大。尝试重新组织表以改善一个索引的聚类因子可能会降低另一个索引的聚类因子。</p>
                        <div class="example" id="GUID-84A4914F-10C5-49BE-92AF-F26DEC5D060F__GUID-65782998-E754-4EEC-B1B2-0D271145218D">
                           <p class="titleinexample">例10-3索引聚类因子</p>
                           <p>此示例显示优化程序如何使用索引聚类因子来确定使用索引是否比完整表扫描更有效。</p>
                           <ol>
                              <li>
                                 <p>启动SQL * Plus并以<code class="codeph">sh</code>身份连接到数据库，然后查询<code class="codeph">sh.customers</code>表中的行数和块数（包括示例输出）：</p><pre class="pre codeblock"><code>SELECT table_name，num_rows，blocks FROM user_tables WHERE table_name ='CUSTOMERS'; TABLE_NAME NUM_ROWS BLOCKS ------------------------------ ---------- ------- ---客户55500 1486</code></pre></li>
                              <li>
                                 <p>在<code class="codeph">customers.cust_last_name</code>列上创建索引。
                                 </p>
                                 <p>例如，执行以下语句：</p><pre class="pre codeblock"><code>CREATE INDEX CUSTOMERS_LAST_NAME_IDX ON客户（cust_last_name）;</code></pre></li>
                              <li>
                                 <p>查询新创建的索引的索引聚类因子。</p>
                                 <p>以下查询显示<code class="codeph">customers_last_name_idx</code>索引具有较高的聚类因子，因为聚类因子远远大于表中的块数：</p><pre class="pre codeblock"><code>SELECT index_name，blevel，leaf_blocks，clustering_factor FROM user_indexes WHERE table_name ='CUSTOMERS'AND index_name ='CUSTOMERS_LAST_NAME_IDX'; INDEX_NAME BLEVEL LEAF_BLOCKS CLUSTERING_FACTOR ------------------------------ ---------- ------ ----- ----------------- CUSTOMERS_LAST_NAME_IDX 1 141 <span class="bold">9859</span>
</code></pre></li>
                              <li>
                                 <p>创建<code class="codeph">customers</code>表的新副本，其行由<code class="codeph">cust_last_name</code> 。
                                 </p>
                                 <p>例如，执行以下语句：</p><pre class="pre codeblock"><code>DROP TABLE customers3 PURGE; CREATE TABLE customers3 AS SELECT * FROM customers ORDER BY cust_last_name;</code></pre></li>
                              <li>
                                 <p>收集<code class="codeph">customers3</code>表的统计信息。
                                 </p>
                                 <p>例如，执行<code class="codeph">GATHER_TABLE_STATS</code>过程，如下所示：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_STATS.GATHER_TABLE_STATS（null，'CUSTOMERS3'）;</pre></li>
                              <li>
                                 <p>查询<code class="codeph">customers3</code>表中的行数和块数。
                                 </p>
                                 <p>例如，输入以下查询（包括示例输出）：</p><pre class="pre codeblock"><code>SELECT TABLE_NAME，NUM_ROWS，BLOCKS FROM USER_TABLES WHERE TABLE_NAME ='CUSTOMERS3'; TABLE_NAME NUM_ROWS BLOCKS ------------------------------ ---------- ------- --- CUSTOMERS3 55500 1485</code></pre></li>
                              <li>
                                 <p>创建的索引<code class="codeph">cust_last_name</code>列<code class="codeph">customers3</code> 。
                                 </p>
                                 <p>例如，执行以下语句：</p><pre class="pre codeblock"><code>CREATE INDEX CUSTOMERS3_LAST_NAME_IDX ON customers3（cust_last_name）;</code></pre></li>
                              <li>
                                 <p>查询<code class="codeph">customers3_last_name_idx</code>索引的索引聚类因子。
                                 </p>
                                 <p>以下查询显示<code class="codeph">customers3_last_name_idx</code>索引具有较低的聚类因子：</p><pre class="pre codeblock"><code>SELECT INDEX_NAME，BLEVEL，LEAF_BLOCKS，CLUSTERING_FACTOR来自USER_INDEXES，其中TABLE_NAME ='CUSTOMERS3'和INDEX_NAME ='CUSTOMERS3_LAST_NAME_IDX'; INDEX_NAME BLEVEL LEAF_BLOCKS CLUSTERING_FACTOR ------------------------------ ---------- ------ ----- ----------------- CUSTOMERS3_LAST_NAME_IDX 1 141 <span class="bold">1455</span>
</code></pre><p>表<code class="codeph">customers3</code>具有相同的数据与原始<code class="codeph">customers</code>表，但对指数<code class="codeph">customers3</code>具有低得多的集群因素，因为在表中的数据是通过有序<code class="codeph">cust_last_name</code> 。现在聚类因子大约是块数的10倍而不是70倍。
                                 </p>
                              </li>
                              <li>
                                 <p>查询<code class="codeph">customers</code>表。
                                 </p>
                                 <p>例如，执行以下查询（包括示例输出）：</p><pre class="pre codeblock"><code>SELECT cust_first_name，cust_last_name FROM customers WHERE cust_last_name BETWEEN'Puleo'AND'Quinn'; CUST_FIRST_NAME CUST_LAST_NAME -------------------- ---------------------------- ------------ Vida Puleo Harriett Quinlan Madeleine Quinn Caresse Puleo</code></pre></li>
                              <li>
                                 <p>显示查询的光标。</p>
                                 <p>例如，执行以下查询（包括部分示例输出）：</p><pre class="pre codeblock"><code>SELECT * FROM TABLE（DBMS_XPLAN.DISPLAY_CURSOR（））; -------------------------------------------------- ----------------------------- | Id |操作|名称|行|字节|成本（％CPU）|时间| -------------------------------------------------- ----------------------------- | 0 |选择声明| | | | 405（100）| | | * 1 |表访问存储完整|客户| 2335 | 35025 | 405（1）| 00:00:01 | -------------------------------------------------- -----------------------------</code></pre><p>上述计划显示优化程序未在原始<code class="codeph">customers</code>表上使用索引。
                                 </p>
                              </li>
                              <li>
                                 <p>查询<code class="codeph">customers3</code>表。
                                 </p>
                                 <p>例如，执行以下查询（包括示例输出）：</p><pre class="pre codeblock"><code>SELECT cust_first_name，cust_last_name FROM customers3 WHERE cust_last_name BETWEEN'Puleo'AND'Quinn'; CUST_FIRST_NAME CUST_LAST_NAME -------------------- ---------------------------- ------------ Vida Puleo Harriett Quinlan Madeleine Quinn Caresse Puleo</code></pre></li>
                              <li>
                                 <p>显示查询的光标。</p>
                                 <p>例如，执行以下查询（包括部分示例输出）：</p><pre class="pre codeblock"><code>SELECT * FROM TABLE（DBMS_XPLAN.DISPLAY_CURSOR（））; -------------------------------------------------- ------------------------------------- | Id |操作|名称|行|字节|成本（％CPU）|时间| -------------------------------------------------- ------------------------------------- | 0 |选择声明| | | | 69（100）| | | 1 |按行索引表访问权限|客户3 | 2335 | 35025 | 69（0）| 00:00:01 | | * 2 | INDEX RANGE SCAN | CUSTOMERS3_LAST_NAME_IDX | 2335 | | 7（0）| 00:00:01 | -------------------------------------------------- -------------------------------------</code></pre><p>结果集相同，但优化程序选择索引。计划成本远低于原始<code class="codeph">customers</code>表中使用的计划成本。
                                 </p>
                              </li>
                              <li>
                                 <p>使用提示强制优化程序使用索引的查询来查询<code class="codeph">customers</code> 。
                                 </p>
                                 <p>例如，执行以下查询（包括部分示例输出）：</p><pre class="pre codeblock"><code>SELECT / * + index（Customers CUSTOMERS_LAST_NAME_IDX）* / cust_first_name，cust_last_name FROM customers WHERE cust_last_name BETWEEN'Puleo'和'Quinn'; CUST_FIRST_NAME CUST_LAST_NAME -------------------- ---------------------------- ------------ Vida Puleo Caresse Puleo Harriett Quinlan Madeleine Quinn</code></pre></li>
                              <li>
                                 <p>显示查询的光标。</p>
                                 <p>例如，执行以下查询（包括部分示例输出）：</p><pre class="pre codeblock"><code>SELECT * FROM TABLE（DBMS_XPLAN.DISPLAY_CURSOR（））; -------------------------------------------------- --------------------------------------- | Id |操作|名称|行|字节|成本（％CPU）|时间| -------------------------------------------------- --------------------------------------- | 0 |选择声明| | | | 422（100）| | | 1 |按行索引表访问权限|客户| 335 | 35025 | 422（0）| 00:00:01 | | * 2 | INDEX RANGE SCAN | CUSTOMERS_LAST_NAME_IDX | 2335 | | 7（0）| 00:00:01 | -------------------------------------------------- ---------------------------------------</code></pre><p>上述计划表明，在<code class="codeph">customers</code>上使用索引的成本高于全表扫描的成本。因此，使用索引不一定会提高性能。索引聚类因子是索引扫描是否比全表扫描更有效的度量。
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-5D96E789-9297-49F1-B304-FFEA335CF678" title="索引统计信息包括有关索引级别数，索引块数以及索引和数据块之间关系的信息。优化程序使用这些统计信息来确定索引扫描的成本。">索引统计</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL363"></a><a id="TGSQL364"></a><a id="TGSQL362"></a><div class="props_rev_3"><a id="GUID-5677EA51-E2DD-4562-B44C-336E329D5288" name="GUID-5677EA51-E2DD-4562-B44C-336E329D5288"></a><h5 id="TGSQL-GUID-5677EA51-E2DD-4562-B44C-336E329D5288" class="sect5"><span class="enumeration_section">10.2.3.3</span>指数聚类因子对成本的影响：例子</h5>
                     <div>
                        <p>此示例说明了索引聚类因子如何影响表访问的成本。</p>
                        <p>请考虑以下情形：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>一个表包含9行，存储在3个数据块中。</p>
                           </li>
                           <li>
                              <p><code class="codeph">col1</code>列当前存储值<code class="codeph">A</code> ， <code class="codeph">B</code>和<code class="codeph">C</code></p>
                           </li>
                           <li>
                              <p>此表的<code class="codeph">col1</code>存在名为<code class="codeph">col1_idx</code>的非唯一索引。
                              </p>
                           </li>
                        </ul>
                        <div class="example" id="GUID-5677EA51-E2DD-4562-B44C-336E329D5288__CHDHIBIF">
                           <p class="titleinexample">例10-4并置数据</p>
                           <p>假设行存储在数据块中，如下所示：</p><pre class="pre codeblock"><code>Block 1 Block 2 Block 3 ------- ------- ------- AAABBBCCC</code></pre><p>在此示例中， <code class="codeph">col1_idx</code>的索引聚类因子较低。具有相同的<code class="codeph">col1</code>索引列值的行位于表中的相同数据块中。因此，使用索引范围扫描返回值为<code class="codeph">A</code>所有行的成本很低，因为必须只读取表中的一个块。
                           </p>
                        </div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-5677EA51-E2DD-4562-B44C-336E329D5288__CHDJIHFC">
                           <p class="titleinexample">例10-5分散数据</p>
                           <p>假设相同的行分散在数据块中，如下所示：</p><pre class="pre codeblock"><code>Block 1 Block 2 Block 3 ------- ------- ------- ABCACBBAC</code></pre><p>在此示例中， <code class="codeph">col1_idx</code>的索引聚类因子更高。数据库必须读取表中的所有三个块，以检索<code class="codeph">col1</code>值为<code class="codeph">A</code>所有行。
                           </p>
                        </div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-5677EA51-E2DD-4562-B44C-336E329D5288__GUID-DF04940D-0FF7-46B8-9F08-ACF75863FF00">
                           <p class="notep1">也可以看看：</p>
                           <p> <a href="../refrn/DBA_TAB_STATISTICS.html#REFRN23376" target="_blank"><span><cite>Oracle Database Reference，</cite></span></a>用于描述<code class="codeph">DBA_INDEXES</code>视图</p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-5D96E789-9297-49F1-B304-FFEA335CF678" title="索引统计信息包括有关索引级别数，索引块数以及索引和数据块之间关系的信息。优化程序使用这些统计信息来确定索引扫描的成本。">索引统计</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="TGSQL365"></a><div class="props_rev_3"><a id="GUID-FE339C05-E7A4-4953-89C4-D5C69F0C08BA" name="GUID-FE339C05-E7A4-4953-89C4-D5C69F0C08BA"></a><h4 id="TGSQL-GUID-FE339C05-E7A4-4953-89C4-D5C69F0C08BA" class="sect4"><span class="enumeration_section">10.2.4</span>系统统计</h4>
                  <div>
                     <p><span class="bold">系统统计信息</span>描述了硬件特性，例如I / O和CPU性能和利用率。
                     </p>
                     <p>系统统计信息使查询优化器能够在选择执行计划时更准确地估计I / O和CPU成本。更新系统统计信息时，数据库不会使先前解析的SQL语句无效。数据库使用新统计信息解析所有新SQL语句。</p>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-FE339C05-E7A4-4953-89C4-D5C69F0C08BA__GUID-3569065F-3476-45CB-9653-3E17BE692E35">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-AC23D691-5C54-4EF9-BF9F-65121F2AFC31" title="系统统计信息描述优化程序的硬件特征，例如I / O和CPU性能和利用率。">手动收集系统统计信息</a> ”</span></p>
                           </li>
                           <li>
                              <p><a href="../tgdba/measuring-database-performance.html#TGDBA-GUID-3FEB7C53-D5B3-4540-BD67-8FCBB2917695" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-BE4DF838-0E65-40AE-B69A-94669F30BE7C" title="优化器收集有关不同类型的数据库对象和数据库环境特征的统计信息。">关于优化程序统计信息类型</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL94581"></a><div class="props_rev_3"><a id="GUID-184A744A-2F2F-4C4C-88E6-107EAD1D517E" name="GUID-184A744A-2F2F-4C4C-88E6-107EAD1D517E"></a><h4 id="TGSQL-GUID-184A744A-2F2F-4C4C-88E6-107EAD1D517E" class="sect4"><span class="enumeration_section">10.2.5</span>用户定义的优化器统计信息</h4>
                  <div>
                     <p><strong class="term">可扩展优化</strong>器使用户定义函数和索引的作者能够创建统计信息收集，选择性和成本函数。
                     </p>
                     <p>优化器成本模型扩展为集成用户提供的信息，以评估CPU和I / O成本。统计类型充当影响执行计划选择的用户定义函数的接口。但是，要使用统计类型，优化程序需要一种机制将类型绑定到数据库对象，例如列，独立函数，对象类型，索引，索引类型或包。SQL语句<a href="../sqlrf/ASSOCIATE-STATISTICS.html#SQLRF01106" target="_blank"><code class="codeph">ASSOCIATE STATISTICS</code></a>允许发生此绑定。
                     </p>
                     <p>用户定义统计信息的函数与使用标准SQL数据类型和对象类型以及域索引的列相关。将统计信息类型与列索引或域索引相关联时，只要<code class="codeph">DBMS_STATS</code>收集统计信息，数据库就会在统计信息类型中调用统计信息收集方法。
                     </p>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-184A744A-2F2F-4C4C-88E6-107EAD1D517E__GUID-E44808AE-F2D8-41BA-8517-E099A823ED92">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D" title="使用GATHER_TABLE_STATS收集表统计信息，使用GATHER_SCHEMA_STATS收集模式中所有对象的统计信息。">收集架构和表统计信息</a> ”</span></p>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-BE4DF838-0E65-40AE-B69A-94669F30BE7C" title="优化器收集有关不同类型的数据库对象和数据库环境特征的统计信息。">关于优化程序统计信息类型</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div><a id="TGSQL339"></a><div class="props_rev_3"><a id="GUID-3ED2DA31-F61B-4E8F-9166-79FB01392B1D" name="GUID-3ED2DA31-F61B-4E8F-9166-79FB01392B1D"></a><h3 id="TGSQL-GUID-3ED2DA31-F61B-4E8F-9166-79FB01392B1D" class="sect3"><span class="enumeration_section">10.3</span>数据库如何收集优化程序统计信息</h3>
               <div>
                  <p>Oracle Database提供了几种收集统计信息的机制。</p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-CA59EF6A-66D2-4BF8-B1F9-85EC5CA3C81F">DBMS_STATS包</a><br><code class="codeph">DBMS_STATS</code> PL / SQL包收集并管理优化程序统计信息。
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-620CB826-10A2-4937-8DAD-2B41475AE47F">补充动态统计</a><br>默认情况下，当优化程序统计信息丢失，失效或不足时，数据库会在解析期间自动收集<span class="bold">动态统计信息</span> 。数据库使用<span class="bold">递归SQL</span>扫描表块的一小部分随机样本。
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-FEEF0915-FE19-4C10-BED0-EB8ED90529A4">在线统计数据收集</a><br>在某些情况下，DDL和DML操作会自动触发在线统计信息收集。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-C0E74ACE-2706-48A1-97A2-33F52207166A" title="Oracle数据库优化器统计信息描述有关数据库及其对象的详细信息。">优化程序统计信息概念</a></p>
                     </div>
                  </div>
               </div>
               <a id="TGSQL340"></a><div class="props_rev_3"><a id="GUID-CA59EF6A-66D2-4BF8-B1F9-85EC5CA3C81F" name="GUID-CA59EF6A-66D2-4BF8-B1F9-85EC5CA3C81F"></a><h4 id="TGSQL-GUID-CA59EF6A-66D2-4BF8-B1F9-85EC5CA3C81F" class="sect4"><span class="enumeration_section">10.3.1</span> DBMS_STATS包</h4>
                  <div>
                     <p><code class="codeph">DBMS_STATS</code> PL / SQL包收集并管理优化程序统计信息。
                     </p>
                     <p>通过此程序包，您可以控制收集统计信息的内容和方式，包括并行度，抽样方法和分区表中统计信息收集的粒度。</p>
                     <div class="infoboxnote" id="GUID-CA59EF6A-66D2-4BF8-B1F9-85EC5CA3C81F__GUID-A89BD918-23C1-401B-849F-F3E65F9CBBB1">
                        <p class="notep1">注意：</p>
                        <p>不要使用<code class="codeph">ANALYZE</code>语句的<code class="codeph">COMPUTE</code>和<code class="codeph">ESTIMATE</code>子句来收集优化程序统计信息。这些条款已被弃用。而是使用<code class="codeph">DBMS_STATS</code> 。</p>
                     </div>
                     <p>使用<code class="codeph">DBMS_STATS</code>包收集的统计信息是创建准确执行计划所必需的。例如， <code class="codeph">DBMS_STATS</code>收集的表统计信息包括行数，块数和平均行长度。
                     </p>
                     <p>默认情况下，Oracle数据库使用<a href="glossary.html#GUID-0F3149AF-5916-4674-8ED4-FE473C7252CC"><span class="xrefglossterm">自动优化器统计信息收集</span></a> 。在这种情况下，数据库会自动运行<code class="codeph">DBMS_STATS</code>以收集缺少统计信息或过时统计信息的所有模式对象的优化程序统计信息。该过程消除了许多与管理优化器相关的手动任务，并显着降低了由于缺少或过时的统计信息而导致生成次优执行计划的风险。您还可以通过手动执行<code class="codeph">DBMS_STATS</code>来更新和管理优化程序统计信息。</p>
                     <p><span><span>Oracle Database 19c</span>引入了<span>高频自动优化器统计信息收集</span> 。此轻量级任务定期收集陈旧对象的统计信息。默认时间间隔为15分钟。与自动统计信息收集作业相反，高频任务不执行诸如清除不存在的对象的统计信息或调用Optimizer Statistics Advisor等操作。</span> 您可以使用<code class="codeph">DBMS_STATS.SET_GLOBAL_PREFS</code>过程为高频任务设置首选项，并使用<code class="codeph">DBA_AUTO_STAT_EXECUTIONS</code>查看元数据。</p>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-CA59EF6A-66D2-4BF8-B1F9-85EC5CA3C81F__GUID-EF6075AA-0C63-4C9A-B83E-9CA8D3EA75BE">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-F007E78A-9967-4921-8046-D8F59A9272B4" title="Oracle数据库可以自动收集优化器统计信息。">配置自动优化程序统计信息收集</a> ”</span></p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-A91DCC46-394D-47F6-8D8E-A9E6F56E432B" title="作为自动统计信息收集的替代或补充，您可以使用DBMS_STATS包手动收集优化程序统计信息。">手动收集优化程序统计信息</a> ”</span></p>
                           </li>
                           <li>
                              <p><a href="../admin/managing-automated-database-maintenance-tasks.html#ADMIN12331" target="_blank"><span><cite>Oracle数据库管理员指南</cite></span></a> ，了解有关自动维护任务的更多信息</p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS059" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_STATS</code></p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-3ED2DA31-F61B-4E8F-9166-79FB01392B1D" title="Oracle Database提供了几种收集统计信息的机制。">数据库如何收集优化程序统计信息</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL341"></a><div class="props_rev_3"><a id="GUID-620CB826-10A2-4937-8DAD-2B41475AE47F" name="GUID-620CB826-10A2-4937-8DAD-2B41475AE47F"></a><h4 id="TGSQL-GUID-620CB826-10A2-4937-8DAD-2B41475AE47F" class="sect4"><span class="enumeration_section">10.3.2</span>补充动态统计</h4>
                  <div>
                     <p>默认情况下，当优化程序统计信息丢失，失效或不足时，数据库会在解析期间自动收集<span class="bold">动态统计信息</span> 。数据库使用<span class="bold">递归SQL</span>扫描表块的一小部分随机样本。
                     </p>
                     <div class="infoboxnote" id="GUID-620CB826-10A2-4937-8DAD-2B41475AE47F__GUID-249594F8-2FD5-4A0A-9B7A-6333620E3FE1">
                        <p class="notep1">注意：</p>
                        <p>动态统计信息可以<span class="italic">增加</span>统计数据，而不是提供替代方案。
                        </p>
                     </div>
                     <p>动态统计信息补充优化程序统计信息，例如表和索引块计数，表和连接基数（估计的行数），连接列统计信息和<code class="codeph">GROUP BY</code>统计信息。此信息可帮助优化程序通过更好地估计谓词基数来改进计划。
                     </p>
                     <p>动态统计在以下情况下是有益的：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>由于复杂的谓词，执行计划不是最理想的。</p>
                        </li>
                        <li>
                           <p>采样时间只是查询总执行时间的一小部分。</p>
                        </li>
                        <li>
                           <p>查询执行多次，以便采样时间分摊。</p>
                        </li>
                     </ul>
                  </div>
                  <div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-3ED2DA31-F61B-4E8F-9166-79FB01392B1D" title="Oracle Database提供了几种收集统计信息的机制。">数据库如何收集优化程序统计信息</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
               <div class="sect3"><a id="GUID-FEEF0915-FE19-4C10-BED0-EB8ED90529A4" name="GUID-FEEF0915-FE19-4C10-BED0-EB8ED90529A4"></a><h4 id="TGSQL-GUID-FEEF0915-FE19-4C10-BED0-EB8ED90529A4" class="sect4"><span class="enumeration_section">10.3.3</span>在线统计数据收集</h4>
                  <div>
                     <p>在某些情况下，DDL和DML操作会自动触发在线统计信息收集。</p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B">在线统计数据收集批量负载</a><br>在以下类型的批量加载期间，数据库可以自动收集表和索引统计信息： <code class="codeph">INSERT INTO ...SELECT</code>使用直接路径插入，以及<code class="codeph">CREATE TABLE AS SELECT</code> 。</li>
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-EBE36EE3-21E3-4189-ADF9-E4C235AF4234">在线统计数据收集分区维护操作</a><br>Oracle数据库在特定分区维护操作期间为在线统计提供类似支持。
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-769E609D-0312-43A7-9581-3F3EACF10BA9">实时统计</a><br>从<span>Oracle Database 19c</span>开始， <span>数据库会</span>在传统DML操作期间自动收集<span>实时统计信息</span> 。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-3ED2DA31-F61B-4E8F-9166-79FB01392B1D" title="Oracle Database提供了几种收集统计信息的机制。">数据库如何收集优化程序统计信息</a></p>
                        </div>
                     </div>
                  </div>
                  <a id="TGSQL344"></a><div class="props_rev_3"><a id="GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B" name="GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B"></a><h5 id="TGSQL-GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B" class="sect5"><span class="enumeration_section">10.3.3.1</span>批量装载的在线统计数据收集</h5>
                     <div>
                        <p>在以下类型的批量加载期间，数据库可以自动收集表和索引统计信息： <code class="codeph">INSERT INTO ...SELECT</code>使用直接路径插入，以及<code class="codeph">CREATE TABLE AS SELECT</code> 。</p>
                        <p>默认情况下，并行插入使用直接路径插入。您可以使用<code class="codeph">/*+APPEND*/</code>提示强制插入直接路径。
                        </p>
                        <div class="infoboxnote" id="GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B__GUID-A55B97ED-06D2-4DAA-898C-AFD8806A5DC7">
                           <p class="notep1">注意：</p>
                           <p>在<span>Oracle Database 19c</span>之前的版本中，仅收集了表统计信息 - 而不是索引统计信息或直方图。在<span>Oracle Database 19c中</span> ，数据库维护现有的直方图，但不创建新的直方图。
                           </p>
                           <p>在<span>Oracle Database 19c</span>之前的版本中，批量加载仅在表为空时收集在线统计信息。从<span>Oracle Database 19c开始</span> ，如果表不为空，则在满足以下条件时批量加载收集统计信息：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>表首选项<code class="codeph">INCREMENTAL</code>设置为<code class="codeph">TRUE</code> 。如果表为空，则不需要此条件。
                                 </p>
                              </li>
                              <li>
                                 <p>对于非分区表， <code class="codeph">INCREMENTAL_LEVEL</code>必须设置为<code class="codeph">TABLE</code> 。</p>
                              </li>
                           </ul>
                        </div>
                        <p>本节包含以下主题：</p>
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-2712B321-9BC2-4B64-93BA-C93F23907033">在线统计收集散装货物的目的</a><br>数据仓库应用程序通常会将大量数据加载到数据库中。例如，销售数据仓库可能每天，每周或每月加载数据。
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-0B027A47-087D-4D7B-ABD4-2210D4C37ECB">插入分区表期间的全局统计信息</a><br>将行插入分区表时，数据库会在插入期间收集全局统计信息。
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-2DB44BD0-345A-40C7-8787-9FB4F80C6DC8">批量加载后的直方图创建</a><br>收集在线统计数据后，数据库不会自动创建直方图。
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-CDDB5A54-0991-4E68-A9D7-2305777B608B">在线统计数据收集批量负载的限制</a><br>有时，批量加载不会自动进行优化程序统计信息收集。
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-76103CD0-5566-4E4A-836D-F9D9DECFF36E">用于批量加载的在线统计信息收集的用户界面</a><br>默认情况下，数据库在批量加载期间收集统计信息。
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B__GUID-9F28BECD-BCF2-468C-8886-F5A1BFAEC21F">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=DWHSG8382" target="_blank"><span><cite>Oracle数据库数据仓库指南</cite></span></a> ，了解有关批量加载的更多信息</p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-FEEF0915-FE19-4C10-BED0-EB8ED90529A4" title="在某些情况下，DDL和DML操作会自动触发在线统计信息收集。">在线统计信息收集</a></p>
                           </div>
                        </div>
                     </div>
                     <a id="TGSQL95244"></a><div class="props_rev_3"><a id="GUID-2712B321-9BC2-4B64-93BA-C93F23907033" name="GUID-2712B321-9BC2-4B64-93BA-C93F23907033"></a><h6 id="TGSQL-GUID-2712B321-9BC2-4B64-93BA-C93F23907033" class="sect6"><span class="enumeration_section">10.3.3.1.1</span>批量装载在线统计收集的目的</h6>
                        <div>
                           <p>数据仓库应用程序通常会将大量数据加载到数据库中。例如，销售数据仓库可能每天，每周或每月加载数据。</p>
                           <p>在<span>Oracle Database 12c</span>之前的版本中，最佳做法是在批量加载后手动收集统计信息。但是，许多应用程序由于疏忽或者因为等待维护窗口启动收集而在加载后没有收集统计信息。缺少统计数据是次优执行计划的主要原因。
                           </p>
                           <p>批量加载期间自动统计信息收集具有以下好处：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>改善了性能</p>
                                 <p>在加载期间收集统计信息可避免额外的表扫描以收集表统计信息。</p>
                              </li>
                              <li>
                                 <p>改善了可管理性</p>
                                 <p>批量加载后，无需用户干预即可收集统计信息。</p>
                              </li>
                           </ul>
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B" title="在以下类型的批量加载期间，数据库可以自动收集表和索引统计信息：INSERT INTO ...SELECT使用直接路径插入，以及CREATE TABLE AS SELECT。">批量加载的在线统计信息收集</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL95245"></a><div class="props_rev_3"><a id="GUID-0B027A47-087D-4D7B-ABD4-2210D4C37ECB" name="GUID-0B027A47-087D-4D7B-ABD4-2210D4C37ECB"></a><h6 id="TGSQL-GUID-0B027A47-087D-4D7B-ABD4-2210D4C37ECB" class="sect6"><span class="enumeration_section">10.3.3.1.2</span>插入分区表期间的全局统计信息</h6>
                        <div>
                           <p>将行插入分区表时，数据库会在插入期间收集全局统计信息。</p>
                           <p>例如，如果<code class="codeph">sales</code>是分区表，并且运行<code class="codeph">INSERT INTO sales SELECT</code> ，则数据库将收集全局统计信息。但是，数据库不会收集分区级统计信息。
                           </p>
                           <p>假设您使用分区扩展语法将行插入特定分区或子分区的不同情况。数据库在插入期间收集有关分区的统计信息。但是，数据库不会收集全局统计信息。</p>
                           <p>假设您运行<code class="codeph">INSERT INTO sales PARTITION (sales_q4_2000) SELECT</code> 。数据库在插入期间收集统计信息。如果为<code class="codeph">sales</code>启用了<code class="codeph">INCREMENTAL</code>首选项，则数据库还会收集<code class="codeph">sales_q4_2000</code>的<a href="glossary.html#GUID-8F1BBA0D-2424-4D78-8DC7-1D8C19FA7C1F"><span class="xrefglossterm">概要</span></a> 。插入后立即可以获得统计数据。但是，如果回滚事务，则数据库会自动删除批量加载期间收集的统计信息。
                           </p>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-0B027A47-087D-4D7B-ABD4-2210D4C37ECB__GUID-B88A1428-AAB9-4F71-B5DD-39F327F3E2D6">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-C4BFFEEB-28D2-420C-A864-305C4334183B" title="启用增量统计维护会产生一些后果。">增量统计维护的注意事项</a> ”</span></p>
                                 </li>
                                 <li>
                                    <p>用于<code class="codeph">INSERT</code>语法和语义的<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=SQLRF01604" target="_blank"><span><cite>Oracle数据库SQL语言参考</cite></span></a></p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B" title="在以下类型的批量加载期间，数据库可以自动收集表和索引统计信息：INSERT INTO ...SELECT使用直接路径插入，以及CREATE TABLE AS SELECT。">批量加载的在线统计信息收集</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL95246"></a><div class="props_rev_3"><a id="GUID-2DB44BD0-345A-40C7-8787-9FB4F80C6DC8" name="GUID-2DB44BD0-345A-40C7-8787-9FB4F80C6DC8"></a><h6 id="TGSQL-GUID-2DB44BD0-345A-40C7-8787-9FB4F80C6DC8" class="sect6"><span class="enumeration_section">10.3.3.1.3</span>批量加载后的直方图创建</h6>
                        <div>
                           <p>收集在线统计数据后，数据库不会自动创建直方图。</p>
                           <p>如果需要直方图，则在批量加载后，Oracle建议使用<code class="codeph">options=&gt;GATHER AUTO</code>运行<code class="codeph">DBMS_STATS.GATHER_TABLE_STATS</code> 。例如，以下程序收集<code class="codeph">myt</code>表的统计信息：</p><pre class="pre codeblock"><code>EXEC DBMS_STATS.GATHER_TABLE_STATS（用户，'MYT'，选项=&gt;'GATHER AUTO'）;</code></pre><p>前面的PL / SQL程序仅收集缺失或过时的统计信息。数据库不收集批量加载期间收集的表和基本列统计信息。</p>
                           <div class="infoboxnote" id="GUID-2DB44BD0-345A-40C7-8787-9FB4F80C6DC8__GUID-4E200DE3-1046-48C0-9532-3E051D11ADFD">
                              <p class="notep1">注意：</p>
                              <p>您可以在计划批量加载的表上将表首<code class="codeph">options</code>设置为<code class="codeph">GATHER AUTO</code> 。这样，运行<code class="codeph">GATHER_TABLE_STATS</code>时无需显式设置<code class="codeph">options</code>参数。</p>
                           </div>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-2DB44BD0-345A-40C7-8787-9FB4F80C6DC8__GUID-E44EDC1D-6D37-4B3F-8C6E-B17C6848CAEE">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D" title="使用GATHER_TABLE_STATS收集表统计信息，使用GATHER_SCHEMA_STATS收集模式中所有对象的统计信息。">收集架构和表统计信息</a> ”</span></p>
                                 </li>
                                 <li>
                                    <p><a href="../dwhsg/loading-transformation-date-warehouses.html#DWHSG-GUID-0C48B004-54C8-48A3-BBF8-6C69BB19F15E" target="_blank"><span><cite>Oracle数据库数据仓库指南</cite></span></a> ，了解有关批量加载的更多信息</p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B" title="在以下类型的批量加载期间，数据库可以自动收集表和索引统计信息：INSERT INTO ...SELECT使用直接路径插入，以及CREATE TABLE AS SELECT。">批量加载的在线统计信息收集</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL95247"></a><div class="props_rev_3"><a id="GUID-CDDB5A54-0991-4E68-A9D7-2305777B608B" name="GUID-CDDB5A54-0991-4E68-A9D7-2305777B608B"></a><h6 id="TGSQL-GUID-CDDB5A54-0991-4E68-A9D7-2305777B608B" class="sect6"><span class="enumeration_section">10.3.3.1.4</span>批量负载在线统计数据收集的限制</h6>
                        <div>
                           <p>有时，批量加载不会自动进行优化程序统计信息收集。</p>
                           <p>具体而言，当以下任何条件适用于目标表，分区或子分区时，批量加载<span class="italic">不会</span>自动收集统计信息：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>它位于Oracle拥有的架构中，例如<code class="codeph">SYS</code> 。</p>
                              </li>
                              <li>
                                 <p>它是以下类型的表之一：嵌套表，索引组织表（IOT），外部表或定义为<code class="codeph">ON COMMIT DELETE ROWS</code>全局临时表。</p>
                                 <div class="infoboxnote" id="GUID-CDDB5A54-0991-4E68-A9D7-2305777B608B__GUID-B6243B61-6426-4B4D-9B59-7B28ED3501BB">
                                    <p class="notep1">注意：</p>
                                    <p>数据库<span class="italic">会</span>自动为<a href="glossary.html#GUID-9BAA7917-D479-4DCF-85B2-5B4BE0F891EE"><span class="xrefglossterm">混合分区表</span></a>的<span class="italic">内部</span>分区收集联机统计信息。
                                    </p>
                                 </div>
                              </li>
                              <li>
                                 <p>它的<code class="codeph">PUBLISH</code>首选项设置为<code class="codeph">FALSE</code> 。</p>
                              </li>
                              <li>
                                 <p>其统计数据已锁定。</p>
                              </li>
                              <li>
                                 <p>它使用多表<code class="codeph">INSERT</code>语句加载。
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-CDDB5A54-0991-4E68-A9D7-2305777B608B__GUID-570CBCFA-87F1-4F28-BA9F-3DC0C3B092A0">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><span class="q">“ <a href="gathering-optimizer-statistics.html#GUID-5AC92747-F6AA-4149-80B6-FD6E966CDC8D" title="使用GATHER_TABLE_STATS收集表统计信息，使用GATHER_SCHEMA_STATS收集模式中所有对象的统计信息。">收集架构和表统计信息</a> ”</span></p>
                                 </li>
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS-GUID-CDAA4742-5398-4A64-B871-E39F38D0021F" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解有关<code class="codeph">DBMS_STATS.SET_TABLE_PREFS</code>更多信息</p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B" title="在以下类型的批量加载期间，数据库可以自动收集表和索引统计信息：INSERT INTO ...SELECT使用直接路径插入，以及CREATE TABLE AS SELECT。">批量加载的在线统计信息收集</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div><a id="TGSQL95248"></a><div class="props_rev_3"><a id="GUID-76103CD0-5566-4E4A-836D-F9D9DECFF36E" name="GUID-76103CD0-5566-4E4A-836D-F9D9DECFF36E"></a><h6 id="TGSQL-GUID-76103CD0-5566-4E4A-836D-F9D9DECFF36E" class="sect6"><span class="enumeration_section">10.3.3.1.5</span>用于批量加载的在线统计信息收集的用户界面</h6>
                        <div>
                           <p>默认情况下，数据库在批量加载期间收集统计信息。</p>
                           <p>您可以使用<code class="codeph">GATHER_OPTIMIZER_STATISTICS</code>提示在语句级别启用该功能。您可以使用<code class="codeph">NO_GATHER_OPTIMIZER_STATISTICS</code>提示在语句级别禁用该功能。例如，以下语句禁用批量加载的在线统计信息收集：</p><pre class="pre codeblock"><code>CREATE TABLE employees2 AS SELECT / * + NO_GATHER_OPTIMIZER_STATISTICS * / * FROM employees</code></pre></div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-76103CD0-5566-4E4A-836D-F9D9DECFF36E__GUID-FC92718C-28FE-4881-B519-BD4310966BE7">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=SQLRF56406" target="_blank"><span><cite>Oracle数据库SQL语言参考</cite></span></a> ，了解<code class="codeph">GATHER_OPTIMIZER_STATISTICS</code>和<code class="codeph">NO_GATHER_OPTIMIZER_STATISTICS</code>提示</p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-E920301F-FFC4-4AB7-8DEB-11BA56088E0B" title="在以下类型的批量加载期间，数据库可以自动收集表和索引统计信息：INSERT INTO ...SELECT使用直接路径插入，以及CREATE TABLE AS SELECT。">批量加载的在线统计信息收集</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-EBE36EE3-21E3-4189-ADF9-E4C235AF4234" name="GUID-EBE36EE3-21E3-4189-ADF9-E4C235AF4234"></a><h5 id="TGSQL-GUID-EBE36EE3-21E3-4189-ADF9-E4C235AF4234" class="sect5"><span class="enumeration_section">10.3.3.2</span>分区维护操作的在线统计信息收集</h5>
                     <div>
                        <p>Oracle数据库在特定分区维护操作期间为在线统计提供类似支持。</p>
                        <p>具体来说，数据库维护以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>分区交换操作的全局统计信息。这些统计数据包括基本统计数据，概要和直方图。交换后，全局统计信息是传入表的统计信息和目标表的统计信息的集合。</p>
                           </li>
                           <li>
                              <p>以下分区操作的全局和分区级统计信息，包括增量统计信息：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">移动</code></p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">合并</code></p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">合并</code></p>
                                 </li>
                              </ul>
                              <p>数据库不维护具有多个目标段的维护操作的分区级统计信息。</p>
                           </li>
                        </ul>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-EBE36EE3-21E3-4189-ADF9-E4C235AF4234__GUID-C490987D-65D8-47D3-9755-FAD7D3C45D8E">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=GUID-A226B597-BCF1-49E2-8284-739A99D3F9ED" target="_blank"><span><cite>Oracle Database VLDB和分区指南</cite></span></a>了解有关分区维护操作的更多信息</p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-FEEF0915-FE19-4C10-BED0-EB8ED90529A4" title="在某些情况下，DDL和DML操作会自动触发在线统计信息收集。">在线统计信息收集</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="sect4"><a id="GUID-769E609D-0312-43A7-9581-3F3EACF10BA9" name="GUID-769E609D-0312-43A7-9581-3F3EACF10BA9"></a><h5 id="TGSQL-GUID-769E609D-0312-43A7-9581-3F3EACF10BA9" class="sect5"><span class="enumeration_section">10.3.3.3</span> <span>实时统计</span></h5>
                     <div>
                        <p>从<span>Oracle Database 19c</span>开始， <span>数据库会</span>在传统DML操作期间自动收集<span>实时统计信息</span> 。
                        </p>
                        <p>本节包含以下主题：</p>
                     </div>
                     <div>
                        <ul class="ullinks">
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-D98D891C-0D07-4902-BA1B-8231447ADA22">实时统计的目的</a><br>在线统计数据，无论是批量加载还是传统DML，都旨在降低优化程序被陈旧统计数据误导的可能性。
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-972CC658-D615-4071-86BB-371D43D9CF95">实时统计如何工作</a><br>当DML操作当前正在修改表时，Oracle数据库会动态计算最基本统计信息的值。
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-5AD8A9CF-36FB-4756-B7CE-9B8320FB860C">实时统计用户界面</a><br>您可以通过PL / SQL包，数据字典视图和提示来使用管理和访问<span>实时统计信息</span> 。
                           </li>
                           <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-D55D673B-1FD9-45C9-A109-F440B7E96E62">实时统计：示例</a><br>在此示例中，传统的<code class="codeph">INSERT</code>语句触发<span>实时统计信息</span>的收集。
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-769E609D-0312-43A7-9581-3F3EACF10BA9__GUID-2884B0A5-E1BA-4B9A-925F-0201A77A6BEE">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id= DBLIC-GUID-0F9EB85D-4610-4EDF-89C2-4916A0E7AC87" target="_blank"><span><cite>“Oracle数据库许可信息用户手册”</cite></span></a> ，了解不同版本和服务支持哪些功能的详细信息</p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-FEEF0915-FE19-4C10-BED0-EB8ED90529A4" title="在某些情况下，DDL和DML操作会自动触发在线统计信息收集。">在线统计信息收集</a></p>
                           </div>
                        </div>
                     </div>
                     
                     <div class="sect5"><a id="GUID-D98D891C-0D07-4902-BA1B-8231447ADA22" name="GUID-D98D891C-0D07-4902-BA1B-8231447ADA22"></a><h6 id="TGSQL-GUID-D98D891C-0D07-4902-BA1B-8231447ADA22" class="sect6"><span class="enumeration_section">10.3.3.3.1</span> <span>实时统计的</span>目的</h6>
                        <div>
                           <p>在线统计数据，无论是批量加载还是传统DML，都旨在降低优化程序被陈旧统计数据误导的可能性。</p>
                           <p><span>Oracle Database 12c</span>引入了<code class="codeph">CREATE TABLE AS SELECT</code>语句和直接路径插入的在线统计信息收集。<span>Oracle Database 19c</span>引入了<span>实时统计数据</span> ，可将在线支持扩展到传统的DML语句。由于统计信息可能在<code class="codeph">DBMS_STATS</code>作业之间过时，因此<span>实时统计信息</span>可帮助优化程序生成更优化的计划。
                           </p>
                           <p>批量加载操作收集所有必要的统计信息，而<span>实时统计信息则</span> <span class="italic">增加</span>而不是替换传统统计信息。因此，您必须使用<code class="codeph">DBMS_STATS</code>继续定期收集统计信息，最好使用AutoTask作业。
                           </p>
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-769E609D-0312-43A7-9581-3F3EACF10BA9" title="从Oracle Database 19c开始，数据库会在传统DML操作期间自动收集实时统计信息。">实时统计</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-972CC658-D615-4071-86BB-371D43D9CF95" name="GUID-972CC658-D615-4071-86BB-371D43D9CF95"></a><h6 id="TGSQL-GUID-972CC658-D615-4071-86BB-371D43D9CF95" class="sect6"><span class="enumeration_section">10.3.3.3.2</span> <span>实时统计</span>如何工作</h6>
                        <div>
                           <p>当DML操作当前正在修改表时，Oracle数据库会动态计算最基本统计信息的值。</p>
                           <p>考虑一种情况，其中事务当前正在向<code class="codeph">oe.orders</code>表添加数万行。在插入行时， <span>实时统计信息会</span>跟踪增加的行数。如果优化程序执行新查询的硬解析，则优化程序可以使用<span>实时统计信息</span>来获得更准确的成本估算。
                           </p>
                        </div>
                        <div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-769E609D-0312-43A7-9581-3F3EACF10BA9" title="从Oracle Database 19c开始，数据库会在传统DML操作期间自动收集实时统计信息。">实时统计</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-5AD8A9CF-36FB-4756-B7CE-9B8320FB860C" name="GUID-5AD8A9CF-36FB-4756-B7CE-9B8320FB860C"></a><h6 id="TGSQL-GUID-5AD8A9CF-36FB-4756-B7CE-9B8320FB860C" class="sect6"><span class="enumeration_section">10.3.3.3.3</span> <span>实时统计</span>用户界面</h6>
                        <div>
                           <p>您可以通过PL / SQL包，数据字典视图和提示来使用管理和访问<span>实时统计信息</span> 。
                           </p>
                           <div class="section">
                              <p class="subhead3" id="GUID-5AD8A9CF-36FB-4756-B7CE-9B8320FB860C__GUID-6BBEE65F-D022-4612-93E1-D11EC103D9A3">DBMS_STATS</p>
                              <p>默认情况下， <code class="codeph">DBMS_STATS</code>子程序包括<span>实时统计信息</span> 。您还可以指定参数以仅包含这些统计信息。
                              </p>
                              <div class="tblformal" id="GUID-5AD8A9CF-36FB-4756-B7CE-9B8320FB860C__GUID-0697CB5B-F10B-4BDC-9E88-3A3D6F4C1A83">
                                 <p class="titleintable">表10-3 <span>实时统计的</span>子程序</p>
                                 <table cellpadding="4" cellspacing="0" class="Formal" title="实时统计的子程序" border="1" summary="These subprograms enables you to manage real-time statistics." frame="hsides" rules="rows">
                                    <thead>
                                       <tr align="left" valign="top">
                                          <th align="left" valign="bottom" id="d60325e5695">子程序</th>
                                          <th align="left" valign="bottom" id="d60325e5697">描述</th>
                                       </tr>
                                    </thead>
                                    <tbody>
                                       <tr align="left" valign="top">
                                          <td align="left" valign="top" id="d60325e5701" headers="d60325e5695 ">
                                             <p><code class="codeph">EXPORT_TABLE_STATS</code>和<code class="codeph">EXPORT_SCHEMA_STATS</code></p>
                                          </td>
                                          <td align="left" valign="top" headers="d60325e5701 d60325e5697 ">
                                             <p>这些子程序使您可以导出统计信息。默认情况下， <code class="codeph">stat_category</code>参数包括<span>实时统计信息</span> 。<code class="codeph">REALTIME_STATS</code>值仅指定<span>实时统计信息</span> 。
                                             </p>
                                          </td>
                                       </tr>
                                       <tr align="left" valign="top">
                                          <td align="left" valign="top" id="d60325e5724" headers="d60325e5695 ">
                                             <p><code class="codeph">IMPORT_TABLE_STATS</code>和<code class="codeph">IMPORT_SCHEMA_STATS</code></p>
                                          </td>
                                          <td align="left" valign="top" headers="d60325e5724 d60325e5697 ">
                                             <p>这些子程序使您可以导入统计信息。默认情况下， <code class="codeph">stat_category</code>参数包括<span>实时统计信息</span> 。<code class="codeph">REALTIME_STATS</code>值仅指定<span>实时统计信息</span> 。
                                             </p>
                                          </td>
                                       </tr>
                                       <tr align="left" valign="top">
                                          <td align="left" valign="top" id="d60325e5747" headers="d60325e5695 ">
                                             <p><code class="codeph">DELETE_TABLE_STATS</code>和<code class="codeph">DELETE_SCHEMA_STATS</code></p>
                                          </td>
                                          <td align="left" valign="top" headers="d60325e5747 d60325e5697 ">
                                             <p>这些子程序使您可以删除统计信息。默认情况下， <code class="codeph">stat_category</code>参数包括<span>实时统计信息</span> 。<code class="codeph">REALTIME_STATS</code>值仅指定<span>实时统计信息</span> 。
                                             </p>
                                          </td>
                                       </tr>
                                       <tr align="left" valign="top">
                                          <td align="left" valign="top" id="d60325e5770" headers="d60325e5695 ">
                                             <p><code class="codeph">DIFF_TABLE_STATS_IN_STATTAB</code></p>
                                          </td>
                                          <td align="left" valign="top" headers="d60325e5770 d60325e5697 ">
                                             <p>此函数比较两个来源的表统计信息。统计数据始终包括<span>实时统计信息</span> 。
                                             </p>
                                          </td>
                                       </tr>
                                       <tr align="left" valign="top">
                                          <td align="left" valign="top" id="d60325e5781" headers="d60325e5695 ">
                                             <p><code class="codeph">DIFF_TABLE_STATS_IN_HISTORY</code></p>
                                          </td>
                                          <td align="left" valign="top" headers="d60325e5781 d60325e5697 ">
                                             <p>此函数比较两个指定时间戳的表的统计信息。统计数据始终包括<span>实时统计信息</span> 。
                                             </p>
                                          </td>
                                       </tr>
                                    </tbody>
                                 </table>
                              </div>
                              <!-- class="inftblhruleinformal" -->
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3" id="GUID-5AD8A9CF-36FB-4756-B7CE-9B8320FB860C__GUID-A788416F-D1D5-44B4-B4C8-7D0344B133A5">查看</p>
                              <p>如果有可用<span>的实时统计</span>信息，则可以使用下表中的视图访问它们。请注意，不支持分区级统计信息，因此唯一的表级视图显示<span>实时统计信息</span> 。<code class="codeph">DBA_*</code>视图具有<code class="codeph">ALL_*</code>和<code class="codeph">USER_*</code>版本。
                              </p>
                              <div class="tblformal" id="GUID-5AD8A9CF-36FB-4756-B7CE-9B8320FB860C__GUID-944611C3-9BF5-42D2-BC5A-84E4164C11B1">
                                 <p class="titleintable">表10-4 <span>实时统计</span>视图</p>
                                 <table cellpadding="4" cellspacing="0" class="Formal" title="实时统计视图" border="1" summary="Describes the views that show real-time statistics: DBA_TAB_COL_STATISTICS and DBA_TAB_STATISTICS." frame="hsides" rules="rows">
                                    <thead>
                                       <tr align="left" valign="top">
                                          <th align="left" valign="bottom" width="20%" id="d60325e5826">视图</th>
                                          <th align="left" valign="bottom" width="20%" id="d60325e5828">描述</th>
                                       </tr>
                                    </thead>
                                    <tbody>
                                       <tr align="left" valign="top">
                                          <td align="left" valign="top" width="20%" id="d60325e5832" headers="d60325e5826 ">
                                             <p><code class="codeph">DBA_TAB_COL_STATISTICS</code></p>
                                          </td>
                                          <td align="left" valign="top" width="20%" headers="d60325e5832 d60325e5828 ">
                                             <p>此视图显示从<code class="codeph">DBA_TAB_COLUMNS</code>提取的列统计信息和直方图信息。 <span>实时统计信息由<code class="codeph">NOTES</code>列中的<code class="codeph">STATS_ON_CONVENTIONAL_DML</code>和<code class="codeph">SCOPE</code>列中的<code class="codeph">SHARED</code>指示。</span></p>
                                          </td>
                                       </tr>
                                       <tr align="left" valign="top">
                                          <td align="left" valign="top" width="20%" id="d60325e5857" headers="d60325e5826 ">
                                             <p><code class="codeph">DBA_TAB_STATISTICS</code></p>
                                          </td>
                                          <td align="left" valign="top" width="20%" headers="d60325e5857 d60325e5828 ">
                                             <p>此视图显示当前用户可访问的表的优化程序统计信息。<span>实时统计信息由<code class="codeph">NOTES</code>列中的<code class="codeph">STATS_ON_CONVENTIONAL_DML</code>和<code class="codeph">SCOPE</code>列中的<code class="codeph">SHARED</code>指示。</span></p>
                                          </td>
                                       </tr>
                                    </tbody>
                                 </table>
                              </div>
                              <!-- class="inftblhruleinformal" -->
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3" id="GUID-5AD8A9CF-36FB-4756-B7CE-9B8320FB860C__GUID-01FE48B3-22B3-4578-9F52-99B59BAA47DB">提示</p>
                              <p><code class="codeph">NO_GATHER_OPTIMIZER_STATISTICS</code>提示可防止收集<span>实时统计信息</span> 。
                              </p>
                           </div>
                           <!-- class="section" -->
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-5AD8A9CF-36FB-4756-B7CE-9B8320FB860C__GUID-9CE830AD-4605-4C9D-A475-593BAFBFD71E">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><span class="q">“ <a href="transporting-optimizer-statistics.html#GUID-7F8EE1CC-A173-4B87-AA2E-CD22198EF4F8" title="您可以将优化程序统计信息从数据字典导出并导入到用户定义的统计信息表。您还可以将统计信息从一个数据库复制到另一个数">导入和导出优化程序统计信息</a> ”</span></p>
                                 </li>
                                 <li>
                                    <p><a href="../arpls/DBMS_STATS.html#GUID-B930CE9B-7461-4691-8AA9-7E424C3C2C8C" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_STATS</code>子程序</p>
                                 </li>
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=GUID-40AC6263-089D-4471-B2E2-EBCA15BC4C65" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">ALL_TAB_COL_STATISTICS</code>视图</p>
                                 </li>
                              </ul>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-769E609D-0312-43A7-9581-3F3EACF10BA9" title="从Oracle Database 19c开始，数据库会在传统DML操作期间自动收集实时统计信息。">实时统计</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                     <div class="sect5"><a id="GUID-D55D673B-1FD9-45C9-A109-F440B7E96E62" name="GUID-D55D673B-1FD9-45C9-A109-F440B7E96E62"></a><h6 id="TGSQL-GUID-D55D673B-1FD9-45C9-A109-F440B7E96E62" class="sect6"><span class="enumeration_section">10.3.3.3.4</span> <span>实时统计</span> ：示例</h6>
                        <div>
                           <p>在此示例中，传统的<code class="codeph">INSERT</code>语句触发<span>实时统计信息</span>的收集。
                           </p>
                           <div class="example" id="GUID-D55D673B-1FD9-45C9-A109-F440B7E96E62__GUID-4C57FD9A-1D78-4C52-9207-7CD3C8272212">
                              <p>此示例假定<code class="codeph">sh</code>用户已被授予DBA角色，并且您已以<code class="codeph">sh</code>身份登录到数据库。您执行以下步骤：</p>
                              <ol>
                                 <li>
                                    <p>收集<code class="codeph">sales</code>表的统计信息：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.GATHER_TABLE_STATS（'SH'，'SALES'，METHOD_OPT =&gt;'FOR ALL COLUMNS SIZE 2'）;结束; /</code></pre></li>
                                 <li>
                                    <p>查询<code class="codeph">sales</code>的列级统计信息：</p><pre class="pre codeblock"><code>SET PAGESIZE 5000 SET LINESIZE 200 COL COLUMN_NAME FORMAT a13 COL LOW_VALUE FORMAT a14 COL HIGH_VALUE FORMAT a14 COL NOTES FORMAT a5 COL PARTITION_NAME FORMAT a13 SELECT COLUMN_NAME，LOW_VALUE，HIGH_VALUE，SAMPLE_SIZE，NOTET FROM USER_TAB_COL_STATISTICS TABLE_NAME ='SALES'ORDER BY 1,5;</code></pre><p><code class="codeph">Notes</code>字段为空白，表示尚未收集<span>实时统计信息</span> ：</p><pre class="pre codeblock"><code>COLUMN_NAME LOW_VALUE HIGH_VALUE SAMPLE_SIZE NOTES ------------- -------------- -------------- ---- ------- ----- AMOUNT_SOLD C10729 C2125349 5594 CHANNEL_ID C103 C10A 918843 CUST_ID C103 C30B0B 5595 PROD_ID C10E C20231 5593 PROMO_ID C122 C20A64 918843 QUANTITY_SOLD C102 C102 5593 TIME_ID 77C60101010101 78650C1F010101 5593选择了7行。
</code></pre></li>
                                 <li>
                                    <p>查询<code class="codeph">sales</code>的表级统计信息：</p><pre class="pre codeblock"><code>SELECT NVL（PARTITION_NAME，'GLOBAL'）PARTITION_NAME，NUM_ROWS，BLOCKS，NOTET FROM USER_TAB_STATISTICS TABLE_NAME ='SALES'ORDER BY 1,4;</code></pre><p><code class="codeph">Notes</code>字段为空白，表示尚未收集<span>实时统计信息</span> ：</p><pre class="pre codeblock"><code>PARTITION_NAM NUM_ROWS块注释------------- ---------- ---------- ----- GLOBAL 918843 3315 SALES_1995 0 0 SALES_1996 0 0 SALES_H1_1997 0 0 SALES_H2_1997 0 0 SALES_Q1_1998 43687 162 SALES_Q1_1999 64186 227 SALES_Q1_2000 62197 222 SALES_Q1_2001 60608 222 SALES_Q1_2002 0 0 SALES_Q1_2003 0 0 SALES_Q2_1998 35758 132 SALES_Q2_1999 54233 187 SALES_Q2_2000 55515 197 SALES_Q2_2001 63292 227 SALES_Q2_2002 0 0 SALES_Q2_2003 0 0 SALES_Q3_1998 50515 182 SALES_Q3_1999 67138 232 SALES_Q3_2000 58950 212 SALES_Q3_2001 65769 242 SALES_Q3_2003 0 0 SALES_Q3_2003 0 0 SALES_Q4_1998 48874 192 SALES_Q4_1999 62388 217 SALES_Q4_2000 55984 202 SALES_Q4_2001 69749 260 SALES_Q4_2002 0 0 SALES_Q4_2003 0 0 29选择的行。
</code></pre></li>
                                 <li>
                                    <p>使用传统的<code class="codeph">INSERT</code>语句将918,843行加载到<code class="codeph">sales</code> ：</p><pre class="pre codeblock"><code>INSERT INTO sales（prod_id，cust_id，time_id，channel_id，promo_id，quantity_sold，amount_sold）SELECT prod_id，cust_id，time_id，channel_id，promo_id，quantity_sold * 2，amount_sold * 2 FROM sales;承诺;</code></pre></li>
                                 <li>
                                    <p>从光标获取执行计划：</p><pre class="pre codeblock"><code>SELECT * FROM TABLE（DBMS_XPLAN.DISPLAY_CURSOR（format =&gt;'TYPICAL'））;</code></pre><p>以下计划显示了步骤1中的<code class="codeph">LOAD TABLE CONVENTIONAL</code> ，这意味着数据库在执行插入<span>时</span>收集了<span>实时统计信息</span> ：</p><pre class="pre codeblock"><code>-------------------------------------------------- ------------------------------------- | Id |操作|名称|行|字节|成本（％CPU）|时间| Pstart时| PSTOP | -------------------------------------------------- ------------------------------------- | 0 |插入声明| | | | 910（100）| | | | | 1 | <span class="bold">LOAD TABLE CONVENTIONAL</span> | SALES | | | | | | | | 2 |优化统计收集| | 918K | 25M | 910（2）| 00:00:01 | | | | 3 | PARTITION RANGE ALL | | 918K | 25M | 910（2）| 00:00:01 | 1 | 28 | | 4 |表访问全部|销售| 918K | 25M | 910（2）| 00:00:01 | 1 | 28 | -------------------------------------------------- -------------------------------------</code></pre></li>
                                 <li>
                                    <p>查询<code class="codeph">sales</code>的列级统计信息。
                                    </p><pre class="pre codeblock"><code>SET PAGESIZE 5000 SET LINESIZE 200 COL COLUMN_NAME FORMAT a13 COL LOW_VALUE FORMAT a14 COL HIGH_VALUE FORMAT a14 COL NOTES FORMAT a25 COL PARTITION_NAME FORMAT a13 SELECT COLUMN_NAME，LOW_VALUE，HIGH_VALUE，SAMPLE_SIZE，NOTET FROM USER_TAB_COL_STATISTICS TABLE_NAME ='SALES'ORDER by 1,5;</code></pre><p>现在<code class="codeph">Notes</code>字段显示<code class="codeph">STATS_ON_CONVENTIONAL_DML</code> ，这意味着数据库在插入期间收集了<span>实时统计信息</span> ：</p><pre class="pre codeblock"><code>COLUMN_NAME LOW_VALUE HIGH_VALUE SAMPLE_SIZE NOTES ------------- -------------- -------------- ---- ------- ------------------------- AMOUNT_SOLD C10729 C224422D 9073 STATS_ON_CONVENTIONAL_DML AMOUNT_SOLD C10729 C2125349 5702 CHANNEL_ID C103 C10A 9073 STATS_ON_CONVENTIONAL_DML CHANNEL_ID C103 C10A 918843 CUST_ID C103 C30B0B 9073 STATS_ON_CONVENTIONAL_DML CUST_ID C103 C30B0B 5702 PROD_ID C10E C20231 9073 STATS_ON_CONVENTIONAL_DML PROD_ID C10E C20231 5701 PROMO_ID C122 C20A64 9073 STATS_ON_CONVENTIONAL_DML PROMO_ID C122 C20A64 918843 QUANTITY_SOLD C102 C103 9073 STATS_ON_CONVENTIONAL_DML QUANTITY_SOLD C102 C102 5701 TIME_ID 77C60101010101 78650C1F010101 9073 STATS_ON_CONVENTIONAL_DML TIME_ID 77C60101010101 78650C1F010101 5701</code></pre><p>样本大小为9073，大约是插入的918,843行的1％。在<code class="codeph">QUANTITY_SOLD</code>和<code class="codeph">AMOUNT_SOLD</code> ，高值和低值组合了手动收集的统计信息和<span>实时统计信息</span> 。
                                    </p>
                                 </li>
                                 <li>
                                    <p>强制数据库将优化程序统计信息写入数据字典。</p><pre class="pre codeblock"><code>EXEC DBMS_STATS.FLUSH_DATABASE_MONITORING_INFO;</code></pre></li>
                                 <li>
                                    <p>查询<code class="codeph">sales</code>的表级统计信息。
                                    </p><pre class="pre codeblock"><code>SELECT NVL（PARTITION_NAME，'GLOBAL'）PARTITION_NAME，NUM_ROWS，BLOCKS，NOTET FROM USER_TAB_STATISTICS TABLE_NAME ='SALES'ORDER BY 1,4;</code></pre><p><code class="codeph">Notes</code>字段显示已在全局级别收集<span>实时统计信息</span> ，显示行数为1,837,686：</p><pre class="pre codeblock"><code>PARTITION_NAM NUM_ROWS块注释------------- ---------- ---------- ------------- ------------ GLOBAL 1837686 3315 STATS_ON_CONVENTIONAL_DML GLOBAL 918843 3315 SALES_1995 0 0 SALES_1996 0 0 SALES_H1_1997 0 0 SALES_H1_1997 0 0 SALES_Q1_1998 43687 162 SALES_Q1_1999 64186 227 SALES_Q1_2000 62197 222 SALES_Q1_2001 60608 222 SALES_Q1_2002 0 0 SALES_Q1_2003 0 0 SALES_Q2_1998 35758 132 SALES_Q2_1999 54233 187 SALES_Q2_2000 55515 197 SALES_Q2_2001 63292 227 SALES_Q2_2002 0 0 SALES_Q2_2003 0 0 SALES_Q3_1998 50515 182 SALES_Q3_1999 67138 232 SALES_Q3_2000 58950 212 SALES_Q3_2001 65769 242 SALES_Q3_2002 0 0 SALES_Q3_2003 0 0 SALES_Q4_1998 48874 192 SALES_Q4_1999 62388 217 SALES_Q4_2000 55984 202 SALES_Q4_2001 69749 260 SALES_Q4_2002 0 0 SALES_Q4_2003 0 0</code></pre></li>
                                 <li>
                                    <p>查询<code class="codeph">quantity_sold</code>列：</p><pre class="pre codeblock"><code>SELECT COUNT（*）FROM sales WHERE quantity_sold&gt; 50;</code></pre></li>
                                 <li>
                                    <p>从光标获取执行计划：</p><pre class="pre codeblock"><code>SELECT * FROM TABLE（DBMS_XPLAN.DISPLAY_CURSOR（format =&gt;'TYPICAL'））;</code></pre><p><code class="codeph">Note</code>字段显示查询使用<span>实时统计信息</span> 。
                                    </p><pre class="pre codeblock"><code>计划哈希值：3519235612 --------------------------------------------- --------------------------- | Id |操作|名称|行|字节|成本（％CPU）|时间| Pstart | Pstop | -------------------------------------------------- ---------------------- | 0 |选择声明| | | | 921（100）| | | | | 1 | SORT AGGREGATE | | 1 | 3 | | | | | | 2 | PARTITION RANGE ALL | | 1 | 3 | 921（3）| 00:00:01 | 1 | 28 | | * 3 |表访问完全|销售| 1 | 3 | 921（3）| 00:00:01 | 1 | 28 | -------------------------------------------------- ----------------------谓词信息（由操作ID标识）：------------------- -------------------------------- 3  - 过滤器（“QUANTITY_SOLD”&gt; 50）注意----- <span class="bold">- 动态使用的统计数据：传统DML的统计数据</span></code></pre></li>
                              </ol>
                           </div>
                           <!-- class="example" -->
                        </div>
                        <div>
                           <div class="infoboxnotealso" id="GUID-D55D673B-1FD9-45C9-A109-F440B7E96E62__GUID-5D75B9C2-07BC-4FEF-8B60-EE7ECB73CF66">
                              <p class="notep1">也可以看看：</p>
                              <p><span><cite>Oracle Database Reference</cite></span>了解<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=GUID-4FF4364B-29D0-4365-AA0F-ABD17CE298EC" target="_blank"><code class="codeph">USER_TAB_COL_STATISTICS</code></a>和<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=GUID-736A4F76-14F0-4CDD-93A0-33B59B103A0B" target="_blank"><code class="codeph">USER_TAB_STATISTICS</code></a> 。</p>
                           </div>
                           <div class="familylinks">
                              <div class="parentlink">
                                 <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-769E609D-0312-43A7-9581-3F3EACF10BA9" title="从Oracle Database 19c开始，数据库会在传统DML操作期间自动收集实时统计信息。">实时统计</a></p>
                              </div>
                           </div>
                        </div>
                        
                     </div>
                  </div>
               </div>
            </div><a id="TGSQL345"></a><div class="props_rev_3"><a id="GUID-13E8BD68-B8A1-4937-8774-3EF82FB8FB47" name="GUID-13E8BD68-B8A1-4937-8774-3EF82FB8FB47"></a><h3 id="TGSQL-GUID-13E8BD68-B8A1-4937-8774-3EF82FB8FB47" class="sect3"><span class="enumeration_section">10.4</span>数据库收集优化程序统计信息时</h3>
               <div>
                  <p>数据库会在不同时间从各种来源收集优化程序统计信息。</p>
                  <p>本节包含以下主题：</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-16C4B770-1783-493D-A0F6-3F8A9E075766">优化器统计信息的来源</a><br>优化程序使用多个不同的源来进行优化程序统计。
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-F8F25E31-7113-4B91-BD81-BE6082983192">SQL计划指令</a><br><strong class="term">SQL计划指令</strong>是优化程序可用于生成更优计划的附加信息和指令。
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-E932F5B4-9BDB-4EE4-934C-7F1979CC62A9">当数据库样本数据时</a><br>从<span>Oracle Database 12c开始</span> ，优化程序会自动确定动态统计信息是否有用以及用于所有SQL语句的样本大小。
                     </li>
                     <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-3A50D0D5-5494-43EE-B03D-10569B4D8BF8">数据库如何样本数据</a><br>在优化开始时，在确定表是否是动态统计信息的候选者时，优化程序会检查表上是否存在持久性SQL计划指令。
                     </li>
                  </ul>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-C0E74ACE-2706-48A1-97A2-33F52207166A" title="Oracle数据库优化器统计信息描述有关数据库及其对象的详细信息。">优化程序统计信息概念</a></p>
                     </div>
                  </div>
               </div>
               
               <div class="props_rev_3"><a id="GUID-16C4B770-1783-493D-A0F6-3F8A9E075766" name="GUID-16C4B770-1783-493D-A0F6-3F8A9E075766"></a><h4 id="TGSQL-GUID-16C4B770-1783-493D-A0F6-3F8A9E075766" class="sect4"><span class="enumeration_section">10.4.1</span>优化程序统计信息的来源</h4>
                  <div>
                     <p>优化程序使用多个不同的源来进行优化程序统计。</p>
                     <p>来源如下：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">DBMS_STATS</code>执行，自动或手动</p>
                           <p>此PL / SQL包是收集优化程序统计信息的主要方法。</p>
                        </li>
                        <li>
                           <p>SQL编译</p>
                           <p>在<a href="glossary.html#GUID-F9233BE0-9CB9-4673-A705-174924AE3B18"><span class="xrefglossterm">SQL编译</span></a>期间，数据库可以扩充以前由<code class="codeph">DBMS_STATS</code>收集的统计信息。在此阶段，数据库运行其他查询以获取有关表中有多少行满足SQL语句中<code class="codeph">WHERE</code>子句谓词的更准确信息。
                           </p>
                        </li>
                        <li>
                           <p>SQL执行</p>
                           <p>在执行期间，数据库可以进一步增加先前收集的统计信息。在此阶段，Oracle数据库会收集执行SQL语句期间每个行源生成的行数。在执行结束时，优化器确定估计的行数是否不准确，以保证在下一个语句执行时进行重新分析。如果光标标记为重新分析，则优化程序使用先前执行的实际行计数而不是估计值。</p>
                        </li>
                        <li>
                           <p>SQL配置文件</p>
                           <p><a href="glossary.html#GUID-79F91289-6DD0-49BC-AEA2-3427F5D52F41"><span class="xrefglossterm">SQL配置文件</span></a>是查询的辅助统计信息的集合。配置文件将这些补充统计信息存储在数据字典中。优化程序在优化期间使用SQL配置文件来确定最佳计划。
                           </p>
                        </li>
                     </ul>
                     <p>数据库将优化程序统计信息存储在数据字典中，并根据需要更新或替换它们。您可以在数据字典视图中查询统计信息。</p>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-16C4B770-1783-493D-A0F6-3F8A9E075766__GUID-0824D866-91FE-4A5B-816A-A345BA4D9336">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p> <span class="q">“ <a href="optimizer-statistics-concepts.html#GUID-E932F5B4-9BDB-4EE4-934C-7F1979CC62A9" title="从Oracle Database 12c开始，优化程序会自动确定动态统计信息是否有用以及用于所有SQL语句的样本大小。">当数据库样本数据时</a> ”</span></p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="managing-sql-profiles.html#GUID-1AC3C45E-331A-4016-8FE8-7FEFFD8D7220" title="SQL配置文件是一个数据库对象，其中包含特定于SQL语句的辅助统计信息。">关于SQL配置文件</a> ”</span></p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS-GUID-CA6A56B9-0540-45E9-B1D7-D78769B7714C" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_STATS.GATHER_TABLE_STATS</code>过程</p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-13E8BD68-B8A1-4937-8774-3EF82FB8FB47" title="数据库会在不同时间从各种来源收集优化程序统计信息。">数据库收集优化程序统计信息时</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL347"></a><div class="props_rev_3"><a id="GUID-F8F25E31-7113-4B91-BD81-BE6082983192" name="GUID-F8F25E31-7113-4B91-BD81-BE6082983192"></a><h4 id="TGSQL-GUID-F8F25E31-7113-4B91-BD81-BE6082983192" class="sect4"><span class="enumeration_section">10.4.2</span> SQL计划指令</h4>
                  <div>
                     <p><strong class="term">SQL计划指令</strong>是优化程序可用于生成更优计划的附加信息和指令。
                     </p>
                     <p>该指令是优化器的“自我注释”，它错误地估计某些类型谓词的基数，并提醒<code class="codeph">DBMS_STATS</code>收集纠正未来错误估计所需的统计数据。例如，当连接两个在其连接列中具有数据倾斜的表时，SQL计划指令可以指示优化程序使用动态统计信息来获得更准确的连接基数估计。
                     </p>
                     <p>本节包含以下主题：</p>
                  </div>
                  <div>
                     <ul class="ullinks">
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-5A4B57DE-A005-4D57-BB29-9A87B902D034">数据库创建SQL计划指令时</a><br>数据库根据自动重新优化期间获取的信息自动创建SQL计划指令。如果在SQL执行期间发生基数错误，则数据库会创建SQL计划指令。
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-C336BE11-6785-45AC-BBD0-2BA3D766E641">数据库如何使用SQL计划指令</a><br>编译SQL语句时，如果优化器看到指令，则它通过收集其他信息来服从该指令。
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-5587E29D-6B1D-4886-8DD9-5D4CFABC4526">SQL计划指令维护</a><br>数据库自动创建SQL计划指令。您无法手动创建它们。
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-C8E00C0A-2DC3-4331-9319-696A6DECE716">优化程序如何使用SQL计划指令：示例</a><br>此示例显示数据库如何自动为SQL语句创建和使用SQL计划指令。
                        </li>
                        <li class="ulchildlink"><a href="optimizer-statistics-concepts.html#GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA">优化程序如何使用扩展和SQL计划指令：示例</a><br>该示例显示数据库如何使用SQL计划指令，直到优化程序验证扩展存在且统计信息适用为止。
                        </li>
                     </ul>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-13E8BD68-B8A1-4937-8774-3EF82FB8FB47" title="数据库会在不同时间从各种来源收集优化程序统计信息。">数据库收集优化程序统计信息时</a></p>
                        </div>
                     </div>
                  </div>
                  
                  <div class="props_rev_3"><a id="GUID-5A4B57DE-A005-4D57-BB29-9A87B902D034" name="GUID-5A4B57DE-A005-4D57-BB29-9A87B902D034"></a><h5 id="TGSQL-GUID-5A4B57DE-A005-4D57-BB29-9A87B902D034" class="sect5"><span class="enumeration_section">10.4.2.1</span>数据库创建SQL计划指令时</h5>
                     <div>
                        <p>数据库根据自动重新优化期间获取的信息自动创建SQL计划指令。如果在SQL执行期间发生基数错误，则数据库会创建SQL计划指令。</p>
                        <p>对于每个新指令， <code class="codeph">DBA_SQL_PLAN_DIRECTIVES.STATE</code>列显示值<code class="codeph">USABLE</code> 。此值表示数据库可以使用该指令来纠正错误估计。
                        </p>
                        <p>优化程序在查询表达式上定义SQL计划指令，例如，对两个列一起使用的筛选谓词。指令不依赖于特定的SQL语句或SQL ID。因此，优化器可以对不相同的语句使用指令。例如，指令可以帮助优化器使用类似模式的查询，例如除选择列表项之外相同的查询。</p>
                        <p>执行计划的Notes部分指示用于语句的SQL计划指令的数量。通过查询<code class="codeph">DBA_SQL_PLAN_DIRECTIVES</code>和<code class="codeph">DBA_SQL_PLAN_DIR_OBJECTS</code>视图获取有关指令的更多信息。
                        </p>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-5A4B57DE-A005-4D57-BB29-9A87B902D034__GUID-CA18210C-906E-4F11-97BA-8B666813BA23">
                           <p class="notep1">也可以看看：</p>
                           <p>有关<code class="codeph">DBA_SQL_PLAN_DIRECTIVES</code>更多信息，请<code class="codeph">DBA_SQL_PLAN_DIRECTIVES</code> <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=REFRN-GUID-70035A22-E031-4975-A51C-871AE1F2F260" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-F8F25E31-7113-4B91-BD81-BE6082983192" title="SQL计划指令是优化程序可用于生成更优计划的附加信息和指令。">SQL计划指令</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL95089"></a><div class="props_rev_3"><a id="GUID-C336BE11-6785-45AC-BBD0-2BA3D766E641" name="GUID-C336BE11-6785-45AC-BBD0-2BA3D766E641"></a><h5 id="TGSQL-GUID-C336BE11-6785-45AC-BBD0-2BA3D766E641" class="sect5"><span class="enumeration_section">10.4.2.2</span>数据库如何使用SQL计划指令</h5>
                     <div>
                        <p>编译SQL语句时，如果优化器看到指令，则它通过收集其他信息来服从该指令。</p>
                        <p>优化器以下列方式使用指令：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>动态统计</p>
                              <p>只要没有足够的统计信息对应于指令，优化程序就会使用动态统计信息。例如，其谓词包含特定列对的查询的基数估计可能是非常错误的。SQL计划指令指示无论何时解析包含这些列的查询，优化程序都需要使用动态采样来避免严重的基数错误。</p>
                              <p>动态统计有一些性能开销。每次优化器硬解析应用动态统计指令的查询时，数据库都必须执行额外采样。</p>
                              <p>从<span>Oracle Database 12c</span>第2版（12.2）开始，数据库将<a href="glossary.html#GUID-75E99BE4-8426-4D61-A52E-9C301121CA42"><span class="xrefglossterm">自适应动态采样的</span></a>统计信息写入SQL计划指令存储区，使其可供其他查询使用。
                              </p>
                           </li>
                           <li>
                              <p>列组</p>
                              <p>优化器检查与指令对应的查询。如果缺少<a href="glossary.html#GUID-0179FA30-A218-4642-9CB7-566ABEEA8128"><span class="xrefglossterm">列组</span></a> ，并且受影响的表的<code class="codeph">DBMS_STATS</code>首选项<code class="codeph">AUTO_STAT_EXTENSIONS</code>设置为<code class="codeph">ON</code> （缺省值为<code class="codeph">OFF</code> ），则优化器会在下次<code class="codeph">DBMS_STATS</code>收集表的统计信息时自动创建此列组。否则，优化程序不会自动创建列组。
                              </p>
                              <p>如果存在列组，则下次执行此语句时，优化程序会尽可能使用<a href="glossary.html#GUID-FB763B43-B5C7-47D0-8B0D-47CED4922501"><span class="xrefglossterm">列组统计信息</span></a>代替SQL计划指令（等式谓词， <code class="codeph">GROUP BY</code>等）。在后续执行中，优化器可以创建其他SQL计划指令来解决计划中的其他问题，例如join或<code class="codeph">GROUP BY</code>基数misestimates。
                              </p>
                              <div class="infoboxnote" id="GUID-C336BE11-6785-45AC-BBD0-2BA3D766E641__GUID-D742CA39-2872-4DAA-AD16-55DA70666555">
                                 <p class="notep1">注意：</p>目前，优化程序仅监视列组。优化器不会在表达式上创建扩展。
                              </div>
                           </li>
                        </ul>
                        <p>当引发指令的问题得到解决时，无论是因为存在更好的指令还是存在直方图或扩展， <code class="codeph">DBA_SQL_PLAN_DIRECTIVES.STATE</code>值都会从<code class="codeph">USABLE</code>变为<code class="codeph">SUPERSEDED</code> 。有关指令状态的更多信息在<code class="codeph">DBA_SQL_PLAN_DIRECTIVES.NOTES</code>列中公开。
                        </p>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-C336BE11-6785-45AC-BBD0-2BA3D766E641__GUID-6D00E503-A5A4-42CB-BF43-BA14E2CB24A4">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><span class="q">“ <a href="managing-extended-statistics.html#GUID-BD0F0B71-DD8B-44A0-888E-495830FC09A4" title="DBMS_STATS使您可以收集扩展统计信息，这些统计信息可以在表的不同列上存在多个谓词时或在谓词使用表达式时提高基数估计值。">管理扩展统计</a> ”</span></p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="managing-extended-statistics.html#GUID-858E0BDA-06C6-471F-B9E8-888C3AD29673" title="单个列统计信息对于确定WHERE子句中单个谓词的选择性非常有用。">关于列组的统计信息</a> ”</span></p>
                              </li>
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS-GUID-F993ADFE-85A9-4939-84D1-CC7A6E5C56D2" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解有关<code class="codeph">DBMS_STATS.SET_TABLE_STATS</code>的<code class="codeph">AUTO_STAT_EXTENSIONS</code>首选项的更多信息</p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-F8F25E31-7113-4B91-BD81-BE6082983192" title="SQL计划指令是优化程序可用于生成更优计划的附加信息和指令。">SQL计划指令</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
                  <div class="props_rev_3"><a id="GUID-5587E29D-6B1D-4886-8DD9-5D4CFABC4526" name="GUID-5587E29D-6B1D-4886-8DD9-5D4CFABC4526"></a><h5 id="TGSQL-GUID-5587E29D-6B1D-4886-8DD9-5D4CFABC4526" class="sect5"><span class="enumeration_section">10.4.2.3</span> SQL计划指令维护</h5>
                     <div>
                        <p>数据库自动创建SQL计划指令。您无法手动创建它们。</p>
                        <p>数据库最初在共享池中创建指令。数据库会定期将指令写入<code class="codeph">SYSAUX</code>表空间。数据库会自动清除指定周数后未使用的任何SQL计划指令（ <code class="codeph">SPD_RETENTION_WEEKS</code> ），默认情况下为53。
                        </p>
                        <p>您可以使用<code class="codeph">DBMS_SPD</code>包管理指令。例如，您可以：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>启用和禁用SQL计划指令（ <code class="codeph">ALTER_SQL_PLAN_DIRECTIVE</code> ）</p>
                           </li>
                           <li>
                              <p>更改SQL计划指令的保留期（ <code class="codeph">SET_PREFS</code> ）</p>
                           </li>
                           <li>
                              <p>将指令导出到临时表（ <code class="codeph">PACK_STGTAB_DIRECTIVE</code> ）</p>
                           </li>
                           <li>
                              <p>删除指令（ <code class="codeph">DROP_SQL_PLAN_DIRECTIVE</code> ）</p>
                           </li>
                           <li>
                              <p>强制数据库将指令写入磁盘（ <code class="codeph">FLUSH_SQL_PLAN_DIRECTIVE</code> ）</p>
                           </li>
                        </ul>
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-5587E29D-6B1D-4886-8DD9-5D4CFABC4526__GUID-6D00E503-A5A4-42CB-BF43-BA14E2CB24A4">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS73856" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考，</cite></span></a>以了解<code class="codeph">DBMS_SPD</code>包</p>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-F8F25E31-7113-4B91-BD81-BE6082983192" title="SQL计划指令是优化程序可用于生成更优计划的附加信息和指令。">SQL计划指令</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL95091"></a><a id="TGSQL95092"></a><a id="TGSQL95093"></a><a id="TGSQL95094"></a><a id="TGSQL95090"></a><div class="props_rev_3"><a id="GUID-C8E00C0A-2DC3-4331-9319-696A6DECE716" name="GUID-C8E00C0A-2DC3-4331-9319-696A6DECE716"></a><h5 id="TGSQL-GUID-C8E00C0A-2DC3-4331-9319-696A6DECE716" class="sect5"><span class="enumeration_section">10.4.2.4</span>优化器如何使用SQL计划指令：示例</h5>
                     <div>
                        <p>此示例显示数据库如何自动为SQL语句创建和使用SQL计划指令。</p>
                        <div class="section">
                           <p class="subhead3" id="GUID-C8E00C0A-2DC3-4331-9319-696A6DECE716__GUID-B9FD851F-B222-46A6-B909-8DC60F66F094">假设</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>您计划针对<code class="codeph">sh</code>架构运行查询，并且您拥有此架构以及数据字典和<code class="codeph">V$</code>视图的权限。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-C8E00C0A-2DC3-4331-9319-696A6DECE716__GUID-E2D6DD2D-3371-43A3-AE97-B972CF4654A9">要查看数据库如何使用SQL计划指令：</p>
                           <ol>
                              <li>
                                 <p>查询<code class="codeph">sh.customers</code>表。
                                 </p><pre class="pre codeblock"><code>SELECT / * + gather_plan_statistics * / * FROM customers WHERE cust_state_province ='CA'和country_id ='US';</code></pre><p><code class="codeph">gather_plan_statistics</code>提示显示计划中每个操作返回的实际行数。因此，您可以将优化程序估计值与返回的实际行数进行比较。
                                 </p>
                              </li>
                              <li>
                                 <p>查询前一个查询的计划。</p>
                                 <p>以下示例显示了执行计划（包括示例输出）：</p><pre class="pre codeblock"><code>SELECT * FROM TABLE（DBMS_XPLAN.DISPLAY_CURSOR（FORMAT =&gt;'ALLSTATS LAST'））; PLAN_TABLE_OUTPUT ------------------------------------- SQL_ID b74nw722wjvy3，子号0 ------ -------------------------------从CUST_STATE_PROVINCE ='CA'和country_id =的客户中选择/ * + gather_plan_statistics * / * 'US'计划哈希值：1683234692 ------------------------------------------ -------------------------------------------------- | ID |操作|名称|开始| E-Rows | A-Rows | A-Time |缓冲区|读| -------------------------------------------------- ------------------------------------------ | 0 |选择声明| | 1 | | 29 | 00：00：00.01 | 17 | 14 | | * 1 |表访问完全|客户| 1 | 8 | 29 | 00：00：00.01 | 17 | 14 | -------------------------------------------------- ------------------------------------------谓词信息（由操作ID标识） ：------------------------------------------------- -  1  -  filter（（“CUST_STATE_PROVINCE”='CA'和“COUNTRY_ID”='US'））</code></pre><p>计划中每个操作返回的实际行数（ <code class="codeph">A-Rows</code> ）与估计值（ <code class="codeph">E-Rows</code> ）差异很大。该声明是<a href="glossary.html#GUID-70FBCF66-F29E-4ADE-BEA8-F328917A2986"><span class="xrefglossterm">自动重新优化</span></a>的候选者。
                                 </p>
                              </li>
                              <li>
                                 <p>检查<code class="codeph">customers</code>查询是否可以重新优化。
                                 </p>
                                 <p>以下语句查询<code class="codeph">V$SQL.IS_REOPTIMIZABLE</code>值（包括示例输出）：</p><pre class="pre codeblock"><code>SELECT SQL_ID，CHILD_NUMBER，SQL_TEXT，IS_REOPTIMIZABLE FROM V $ SQL WHERE SQL_TEXT LIKE'SELECT / * + gather_plan_statistics * /％'; SQL_ID CHILD_NUMBER SQL_TEXT I ------------- ------------ -----------  -  b74nw722wjvy3 0选择/ * + g Y ather_plan_ cust_STA TE_PROVINCE ='CA'和c ountry_id ='US'的统计数据* / *</code></pre><p><code class="codeph">IS_REOPTIMIZABLE</code>列标记为<code class="codeph">Y</code> ，因此数据库将在下次执行时对<code class="codeph">customers</code>查询执行硬解析。优化程序使用此初始执行的执行统计信息来确定计划。数据库将从重新优化中学到的信息保留为SQL计划指令。
                                 </p>
                              </li>
                              <li>
                                 <p>显示<code class="codeph">sh</code>模式的指令。
                                 </p>
                                 <p>以下示例使用<code class="codeph">DBMS_SPD</code>将SQL计划指令写入磁盘，然后仅显示<code class="codeph">sh</code>模式的指令：</p><pre class="pre codeblock"><code>EXEC DBMS_SPD.FLUSH_SQL_PLAN_DIRECTIVE; SELECT TO_CHAR（d。DIRECTIVE_ID）dir_id，o。所有者为“自己”，o。OBJECT_NAME AS“OBJECT”，o。SUBOBJECT_NAME col_name，o。OBJECT_TYPE，d。TYPE，d。国家，d。来自DBA_SQL_PLAN_DIRECTIVES的原因d，DBA_SQL_PLAN_DIR_OBJECTS o d。DIRECTIVE_ID = O。DIRECTIVE_ID和o。所有者（'SH'）订购1,2,3,4,5; DIR_ID自己对象COL_NAME对象类型状态原因------------------- --- --------- ----------- ------ ---------------- ------ ------------ 1484026771529551585 SH CUSTOMERS COUNTRY_ID COLUMN DYNAMIC_SAMPLING USABLE SINGAL TABLE CARDINALITY MISESTIMATE 1484026771529551585 SH客户CUST_STATE_ COLUMN DYNAMIC_SAMPLING USABLE SINGLE TABLE PROCECE CARDINALITY MISESTIMATE 1484026771529551585 SH客户表DYNAMIC_SAMPLING USABLE SINGLE TABLE CARDINALITY MISESTIMATE</code></pre><p>最初，数据库将SQL计划指令存储在内存中，然后每15分钟将它们写入磁盘。因此，前面的示例调用<code class="codeph">DBMS_SPD.FLUSH_SQL_PLAN_DIRECTIVE</code>来强制数据库将指令写入<code class="codeph">SYSAUX</code>表空间。
                                 </p>
                                 <p>使用视图<code class="codeph">DBA_SQL_PLAN_DIRECTIVES</code>和<code class="codeph">DBA_SQL_PLAN_DIR_OBJECTS</code>监视指令。视图中显示三个条目，一个用于<code class="codeph">customers</code>表本身，另一个用于每个相关列。由于<code class="codeph">customers</code>查询的<code class="codeph">IS_REOPTIMIZABLE</code>值为<code class="codeph">Y</code> ，因此如果重新执行该语句，则数据库将再次对其进行硬解析，然后根据先前的执行统计信息生成计划。
                                 </p>
                              </li>
                              <li>
                                 <p>再次查询<code class="codeph">customers</code>表。
                                 </p>
                                 <p>例如，输入以下语句：</p><pre class="pre codeblock"><code>SELECT / * + gather_plan_statistics * / * FROM customers WHERE cust_state_province ='CA'和country_id ='US';</code></pre></li>
                              <li>
                                 <p>查询光标中的计划。</p>
                                 <p>以下示例显示了执行计划（包括示例输出）：</p><pre class="pre codeblock"><code>SELECT * FROM TABLE（DBMS_XPLAN.DISPLAY_CURSOR（FORMAT =&gt;'ALLSTATS LAST'））; PLAN_TABLE_OUTPUT ------------------------------------- SQL_ID b74nw722wjvy3，孩子1号------ -------------------------------从CUST_STATE_PROVINCE ='CA'和country_id =的客户中选择/ * + gather_plan_statistics * / * 'US'计划哈希值：1683234692 ------------------------------------------ --------------------------------- | Id |操作|名称|开始|电子行| A行| A-Time |缓冲区| -------------------------------------------------- ------------------------- | 0 |选择声明| | 1 | | 29 | 00：00：00.01 | 17 | | * 1 |表访问完整|客户| 1 | 29 | 29 | 00：00：00.01 | 17 | -------------------------------------------------- -------------------------谓词信息（由操作ID标识）：---------------- ----------------------------------- 1  -  filter（（“CUST_STATE_PROVINCE”='CA'和“COUNTRY_ID” “='US'））注意-----  - <span class="bold">用于本声明的基数反馈</span>
</code></pre><p><code class="codeph">Note</code>部分表示数据库对此语句使用了重新优化。估计的行数（ <code class="codeph">E-Rows</code> ）现在是正确的。SQL计划指令尚未使用。
                                 </p>
                              </li>
                              <li>
                                 <p>查询<code class="codeph">customers</code>查询的游标。
                                 </p>
                                 <p>例如，运行以下查询（包括示例输出）：</p><pre class="pre codeblock"><code>SELECT SQL_ID，CHILD_NUMBER，SQL_TEXT，IS_REOPTIMIZABLE FROM V $ SQL WHERE SQL_TEXT LIKE'SELECT / * + gather_plan_statistics * /％'; SQL_ID CHILD_NUMBER SQL_TEXT I ------------- ------------ -----------  -  b74nw722wjvy3 0选择/ * + g Y ather_plan_ cust_STA TE_PROVINCE ='CA'和c ountry_id ='US'b74nw722wjvy3 1选择/ * + g N ather_plan_ statistics * / *来自库存的统计信息* / * * CUST_STA TE_PROVINCE ='CA'和c ountry_id = '美国'</code></pre><p>存在<code class="codeph">customers</code>查询的新计划，以及新的子游标。
                                 </p>
                              </li>
                              <li>
                                 <p>确认SQL计划指令存在且可用于其他语句。</p>
                                 <p>例如，运行以下查询，该查询与原始<code class="codeph">customers</code>查询类似但不相同（状态为<code class="codeph">MA</code>而不是<code class="codeph">CA</code> ）：</p><pre class="pre codeblock"><code>SELECT / * + gather_plan_statistics * / CUST_EMAIL来自CUSTOMERS CUST_STATE_PROVINCE ='MA'和COUNTRY_ID ='US';</code></pre></li>
                              <li>
                                 <p>查询光标中的计划。</p>
                                 <p>以下语句查询游标（包括示例输出）：</p><pre class="pre codeblock"><code>SELECT * FROM TABLE（DBMS_XPLAN.DISPLAY_CURSOR（FORMAT =&gt;'ALLSTATS LAST'））; PLAN_TABLE_OUTPUT ------------------------------------- SQL_ID 3tk6hj3nkcs2u，子编号0 ------ -------------------------------选择/ * + gather_plan_statistics * / cust_email来自客户where cust_state_province ='MA'和country_id = 'US'计划哈希值：1683234692 ------------------------------------------ --------------------------------- | Id |操作|名称|开始| E-Rows | A-Rows | A-Time |缓冲区| -------------------------------------------------- ------------------------- | 0 |选择声明| | 1 | | 2 | 00：00：00.01 | 16 | | * 1 |表访问完全|客户| 1 | 2 | 2 | 00：00：00.01 | 16 | -------------------------------------------------- -------------------------谓词信息（由操作ID标识）：---------------- ----------------------------------- 1  -  filter（（“CUST_STATE_PROVINCE”='MA'和“COUNTRY_ID” “='US'））注意-----  - 用于此语句的动态采样（level = 2） -  1用于此语句的Sql Plan指令</code></pre><p>计划的<code class="codeph">Note</code>部分显示优化程序对此语句使用了SQL指令，并且还使用了动态统计信息。
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                     <div>
                        <div class="infoboxnotealso" id="GUID-C8E00C0A-2DC3-4331-9319-696A6DECE716__GUID-6B1FEAA5-D35B-4BA3-92E4-B3BCCED418A9">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p> <span class="q">“ <a href="query-optimizer-concepts.html#GUID-D23F8328-A4CF-4211-8C9B-79B826F34A32" title="在自动重新优化中，优化程序在初始执行后更改后续执行的计划。">自动重新优化</a> ”</span></p>
                              </li>
                              <li>
                                 <p><span class="q">“ <a href="options-for-optimizer-statistics-gathering.html#GUID-67E635AA-F168-47D7-9DC9-CE8803464B6E" title="SQL计划指令是优化程序可用于生成更优计划的附加信息和指令。">管理SQL计划指令</a> ”</span></p>
                              </li>
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=REFRN23823" target="_blank"><span><cite>Oracle数据库参考</cite></span></a> ，了解<code class="codeph">DBA_SQL_PLAN_DIRECTIVES</code> ， <code class="codeph">V$SQL</code>和其他数据库视图</p>
                              </li>
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS73856" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">DBMS_SPD</code></p>
                              </li>
                           </ul>
                        </div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-F8F25E31-7113-4B91-BD81-BE6082983192" title="SQL计划指令是优化程序可用于生成更优计划的附加信息和指令。">SQL计划指令</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div><a id="TGSQL95097"></a><a id="TGSQL95098"></a><a id="TGSQL95099"></a><a id="TGSQL95100"></a><a id="TGSQL95101"></a><a id="TGSQL95096"></a><div class="props_rev_3"><a id="GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA" name="GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA"></a><h5 id="TGSQL-GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA" class="sect5"><span class="enumeration_section">10.4.2.5</span>优化器如何使用扩展和SQL计划指令：示例</h5>
                     <div>
                        <p>该示例显示数据库如何使用SQL计划指令，直到优化程序验证扩展存在且统计信息适用为止。</p>
                        <p>此时，指令将其状态更改为<code class="codeph">SUPERSEDED</code> 。后续编译使用统计信息而不是指令。
                        </p>
                        <div class="section">
                           <p class="subhead3" id="GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA__GUID-A64A2645-5FA0-4BAD-8753-338BEFA08937">假设</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>此示例假定您已按照<span class="q">“ <a href="optimizer-statistics-concepts.html#GUID-C8E00C0A-2DC3-4331-9319-696A6DECE716" title="此示例显示数据库如何自动为SQL语句创建和使用SQL计划指令。">优化程序如何使用SQL计划指令：示例</a> ”中的步骤进行操作</span> 。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA__GUID-8230F8EB-96F6-4733-90B4-1D3855AF7341">要查看优化程序如何使用扩展和SQL计划指令：</p>
                           <ol>
                              <li>
                                 <p>收集<code class="codeph">sh.customers</code>表的统计信息。
                                 </p>
                                 <p>例如，执行以下PL / SQL程序：</p><pre class="pre codeblock"><code>BEGIN DBMS_STATS.GATHER_TABLE_STATS（'SH'，'CUSTOMERS'）;结束; /</code></pre></li>
                              <li>
                                 <p>检查<code class="codeph">customers</code>表中是否存在扩展名。
                                 </p>
                                 <p>例如，执行以下查询（包括示例输出）：</p><pre class="pre codeblock"><code>SELECT TABLE_NAME，EXTENSION_NAME，EXTENSION FROM DBA_STAT_EXTENSIONS，其中OWNER ='SH'和TABLE_NAME ='CUSTOMERS'; TABLE_NAM EXTENSION_NAME EXTENSION --------- ------------------------------ -------- ---------------客户SYS_STU＃S＃WF25Z＃QAHIHE＃MOFFMM_（“CUST_STATE_PROVINCE”，“COUNTRY_ID”）</code></pre><p>前面的输出表明<code class="codeph">cust_state_province</code>和<code class="codeph">country_id</code>列上存在列组扩展。
                                 </p>
                              </li>
                              <li>
                                 <p>查询SQL计划指令的状态。</p>
                                 <p><a href="optimizer-statistics-concepts.html#GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA__BABDHAAE">例10-6</a>查询数据字典以获取有关该指令的信息。
                                 </p>
                                 <p>虽然存在列组统计信息，但该指令的状态为<code class="codeph">USABLE</code>因为数据库尚未重新编译该语句。在下一次编译期间，优化程序会验证统计信息是否适用。如果它们适用，则指令的状态将更改为<code class="codeph">SUPERSEDED</code> 。后续编译使用统计信息而不是指令。
                                 </p>
                              </li>
                              <li>
                                 <p>查询<code class="codeph">sh.customers</code>表。
                                 </p><pre class="pre codeblock"><code>SELECT / * + gather_plan_statistics * / * FROM customers WHERE cust_state_province ='CA'和country_id ='US';</code></pre></li>
                              <li>
                                 <p>查询光标中的计划。</p>
                                 <p><a href="optimizer-statistics-concepts.html#GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA__BABFEBDD">例10-7</a>显示了执行计划（包括样本输出）。
                                 </p>
                                 <p><code class="codeph">Note</code>部分显示优化器使用了指令而不是扩展统计信息。在编译期间，数据库验证了扩展统计信息。
                                 </p>
                              </li>
                              <li>
                                 <p>查询SQL计划指令的状态。</p>
                                 <p><a href="optimizer-statistics-concepts.html#GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA__BABGCHFF">例10-8</a>查询数据字典以获取有关该指令的信息。
                                 </p>
                                 <p>指令的状态已更改为<code class="codeph">SUPERSEDED</code> ，表示相应的一个或多个列具有扩展名或直方图，或者存在可用于该指令的另一个SQL计划指令。
                                 </p>
                              </li>
                              <li>
                                 <p>使用略微不同的语句形式再次查询<code class="codeph">sh.customers</code>表。
                                 </p>
                                 <p>例如，运行以下查询：</p><pre class="pre codeblock"><code>SELECT / * + gather_plan_statistics * / /强制重新分析* / * FROM customers WHERE cust_state_province ='CA'和country_id ='US';</code></pre><p>如果光标位于共享SQL区域中，则数据库通常共享游标。要强制重新分析，此步骤通过添加注释稍微更改SQL文本。</p>
                              </li>
                              <li>
                                 <p>查询光标中的计划。</p>
                                 <p><a href="optimizer-statistics-concepts.html#GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA__BABFBDEF">例10-9</a>显示了执行计划（包括样本输出）。
                                 </p>
                                 <p>没有<code class="codeph">Note</code>表明优化器使用扩展统计信息而不是SQL计划指令。如果指令未使用53周，则数据库会自动清除它。
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <div class="infoboxnotealso" id="GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA__GUID-6F1D7ACC-8143-41D2-B6B1-B9FC2BA40C14">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><span class="q">“ <a href="options-for-optimizer-statistics-gathering.html#GUID-67E635AA-F168-47D7-9DC9-CE8803464B6E" title="SQL计划指令是优化程序可用于生成更优计划的附加信息和指令。">管理SQL计划指令</a> ”</span></p>
                                 </li>
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=REFRN23823" target="_blank"><span><cite>Oracle数据库参考</cite></span></a> ，了解<code class="codeph">DBA_SQL_PLAN_DIRECTIVES</code> ， <code class="codeph">V$SQL</code>和其他数据库视图</p>
                                 </li>
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/tgsql&amp;id=ARPLS73856" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">DBMS_SPD</code></p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA__BABDHAAE">
                           <p class="titleinexample">例10-6显示sh Schema的指令</p><pre class="pre codeblock"><code>EXEC DBMS_SPD.FLUSH_SQL_PLAN_DIRECTIVE; SELECT TO_CHAR（d。DIRECTIVE_ID）dir_id，o。所有者，o。OBJECT_NAME，o。SUBOBJECT_NAME col_name，o。OBJECT_TYPE，d。TYPE，d。国家，d。来自DBA_SQL_PLAN_DIRECTIVES的原因d，DBA_SQL_PLAN_DIR_OBJECTS o d。DIRECTIVE_ID = O。DIRECTIVE_ID和o。所有者（'SH'）订购1,2,3,4,5; DIR_ID自己OBJECT_NA COL_NAME对象类型状态原因------------------- --- --------- ----------  - ------ ---------------- ------ ------------ 1484026771529551585 SH CUSTOMERS COUNTRY_ID COLUMN DYNAMIC_SAMPLING USABLE SINGAL TABLE CARDINALITY MISESTIMATE 1484026771529551585 SH客户CUST_STATE_ COLUMN DYNAMIC_SAMPLING USABLE SINGLE TABLE PROCECE CARDINALITY MISESTIMATE 1484026771529551585 SH客户表DYNAMIC_SAMPLING USABLE SINGLE TABLE CARDINALITY MISESTIMATE</code></pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA__BABFEBDD">
                           <p class="titleinexample">例10-7执行计划</p><pre class="pre codeblock"><code>SQL&gt; SELECT * FROM TABLE（DBMS_XPLAN.DISPLAY_CURSOR（FORMAT =&gt;'ALLSTATS LAST'））; PLAN_TABLE_OUTPUT ------------------------------------- SQL_ID b74nw722wjvy3，子号0 ------ -------------------------------从CUST_STATE_PROVINCE ='CA'和country_id =的客户中选择/ * + gather_plan_statistics * / * 'US'计划哈希值：1683234692 ------------------------------------------ ----------------------------------------------- | Id |操作|名称|开始|电子行| A-Rows | A-Time |缓冲区| -------------------------------------------------- --------------------------------------- | 0 |选择声明| | 1 | | 29 | 00：00：00.01 | 16 | | * 1 |表访问完全|客户| 1 | 29 | 29 | 00：00：00.01 | 16 | -------------------------------------------------- ---------------------------------------谓词信息（由操作ID标识）： - ------------------------------------------------- 1 -  filter（（“CUST_STATE_PROVINCE”='CA'和“COUNTRY_ID”='US'））注意-----  - 用于此语句的动态采样（level = 2） - <span class="bold">1用于此语句的Sql Plan指令</span></code></pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA__BABGCHFF">
                           <p class="titleinexample">例10-8显示sh Schema的指令</p><pre class="pre codeblock"><code>EXEC DBMS_SPD.FLUSH_SQL_PLAN_DIRECTIVE; SELECT TO_CHAR（d。DIRECTIVE_ID）dir_id，o。所有者，o。OBJECT_NAME，o。SUBOBJECT_NAME col_name，o。OBJECT_TYPE，d。TYPE，d。国家，d。来自DBA_SQL_PLAN_DIRECTIVES的原因d，DBA_SQL_PLAN_DIR_OBJECTS o d。DIRECTIVE_ID = O。DIRECTIVE_ID和o。所有者（'SH'）订购1,2,3,4,5; DIR_ID自己OBJECT_NA COL_NAME对象类型状态原因------------------- --- --------- ----------  - ----- -------- --------- ------------ 1484026771529551585 SH CUSTOMERS COUNTRY_ID COLUMN DYNAMIC_ SUPERSEDED SINGLE TABLE SAMPLING CARDINALITY MISESTIMATE 1484026771529551585 SH CUSTOMERS CUST_STATE_ COLUMN DYNAMIC_ SUPERSEDED SINGLE TABLE PROVINCE SAMPLING CARDINALITY MISESTIMATE 1484026771529551585 SH客户表DYNAMIC_ SUPERSEDED SINGLE TABLE SAMPLING CARDINALITY MISESTIMATE</code></pre><pre class="oac_no_warn" dir="ltr"></pre></div>
                        <!-- class="example" -->
                        <div class="example" id="GUID-9A158A8E-AEA0-4B40-9C76-32555FF654BA__BABFBDEF">
                           <p class="titleinexample">例10-9执行计划</p><pre class="pre codeblock"><code>SQL&gt; SELECT * FROM TABLE（DBMS_XPLAN.DISPLAY_CURSOR（FORMAT =&gt;'ALLSTATS LAST'））; PLAN_TABLE_OUTPUT ------------------------------------- SQL_ID b74nw722wjvy3，子号0 ------ -------------------------------从CUST_STATE_PROVINCE ='CA'和country_id =的客户中选择/ * + gather_plan_statistics * / * 'US'计划哈希值：1683234692 ------------------------------------------ ----------------------------------------------- | Id |操作|名称|开始|电子行| A-Rows | A-Time |缓冲区| -------------------------------------------------- --------------------------------------- | 0 |选择声明| | 1 | | 29 | 00：00：00.01 | 17 | | * 1 |表访问完全|客户| 1 | 29 | 29 | 00：00：00.01 | 17 | -------------------------------------------------- ---------------------------------------谓词信息（由操作ID标识）： - ------------------------------------------------- 1 -  filter（（“CUST_STATE_PROVINCE”='CA'和“COUNTRY_ID”='US'））选择19行。
</code></pre></div>
                        <!-- class="example" -->
                     </div>
                     <div>
                        <div class="familylinks">
                           <div class="parentlink">
                              <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-F8F25E31-7113-4B91-BD81-BE6082983192" title="SQL计划指令是优化程序可用于生成更优计划的附加信息和指令。">SQL计划指令</a></p>
                           </div>
                        </div>
                     </div>
                     
                  </div>
               </div><a id="TGSQL349"></a><a id="TGSQL348"></a><div class="props_rev_3"><a id="GUID-E932F5B4-9BDB-4EE4-934C-7F1979CC62A9" name="GUID-E932F5B4-9BDB-4EE4-934C-7F1979CC62A9"></a><h4 id="TGSQL-GUID-E932F5B4-9BDB-4EE4-934C-7F1979CC62A9" class="sect4"><span class="enumeration_section">10.4.3</span>数据库样本数据时</h4>
                  <div>
                     <p>从<span>Oracle Database 12c开始</span> ，优化程序会自动确定动态统计信息是否有用以及用于所有SQL语句的样本大小。
                     </p>
                     <div class="infoboxnote" id="GUID-E932F5B4-9BDB-4EE4-934C-7F1979CC62A9__GUID-05453854-B6F5-4DC4-B7DA-27154509AB27">
                        <p class="notep1">注意：</p>
                        <p>在早期版本中，动态统计称为<span class="italic">动态采样</span> 。
                        </p>
                     </div>
                     <p>决定使用动态统计数据的主要因素是可用的统计数据是否足以生成最佳计划。如果统计信息不足，则优化程序将使用动态统计信息。</p>
                     <p>当<code class="codeph">OPTIMIZER_DYNAMIC_SAMPLING</code>初始化参数未设置为<code class="codeph">0</code>时，将启用自动动态统计。默认情况下， <a href="glossary.html#GUID-AD21414C-F385-4CA1-A1A5-79707D747D42"><span class="xrefglossterm">动态统计级别</span></a>设置为<code class="codeph">2</code> 。
                     </p>
                     <p>通常，优化程序使用缺省统计信息而不是动态统计信息来计算对表，索引和列进行优化时所需的统计信息。优化程序根据多种因素决定是否使用动态统计信息，包括：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>SQL语句使用并行执行。</p>
                        </li>
                        <li>
                           <p>存在SQL计划指令。</p>
                           <p></p>
                        </li>
                     </ul>
                     <p>下图说明了收集动态统计信息的过程。</p>
                     <div class="figure" id="GUID-E932F5B4-9BDB-4EE4-934C-7F1979CC62A9__BABCEJAH">
                        <p class="titleinfigure">图10-2动态统计</p><img src="img/tgsql_vm_018.png" alt="下面是图10-2的描述" title="下面是图10-2的描述" longdesc="img_text/tgsql_vm_018.html"><br><a href="img_text/tgsql_vm_018.html">“图10-2动态统计”的描述</a></div>
                     <!-- class="figure" -->
                     <p><a href="optimizer-statistics-concepts.html#GUID-E932F5B4-9BDB-4EE4-934C-7F1979CC62A9__BABCEJAH">如图10-2</a>所示，优化器在以下情况下自动收集动态统计信息：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>缺少统计数据</p>
                           <p>当查询中的表没有统计信息时，优化程序会在优化之前收集有关这些表的基本统计信息。统计信息可能会丢失，因为应用程序创建新对象而不对<code class="codeph">DBMS_STATS</code>进行后续调用以收集统计信息，或者因为统计信息在收集统计信息之前锁定在对象上。
                           </p>
                           <p>在这种情况下，统计信息不像使用<code class="codeph">DBMS_STATS</code>软件包收集的统计信息那样高质量或完整。这种权衡是为了限制对声明编译时间的影响。
                           </p>
                        </li>
                        <li>
                           <p>统计数据不足</p>
                           <p>只要优化程序估计谓词（过滤器或连接）或<code class="codeph">GROUP BY</code>子句的选择性而不考虑列之间的相关性，列数据分布中的偏差，表达式的统计信息等，统计信息就不够充分。
                           </p>
                           <p>扩展统计信息有助于优化器获得复杂谓词表达式的准确质量基数估计。优化程序可以使用动态统计信息来补偿缺少扩展统计信息或何时无法使用扩展统计信息（例如，非等式谓词）。</p>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-E932F5B4-9BDB-4EE4-934C-7F1979CC62A9__GUID-B7DFBE78-ED18-418E-AA20-9DEE43FFB60F">
                        <p class="notep1">注意：</p>
                        <p>对于包含<code class="codeph">AS OF</code>子句的查询，数据库不使用动态统计信息。
                        </p>
                     </div>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-E932F5B4-9BDB-4EE4-934C-7F1979CC62A9__GUID-502D5190-38EF-478F-A681-30748DA1E009">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="options-for-optimizer-statistics-gathering.html#GUID-F1C666DC-5450-4F92-83AA-607327DB5FD8" title="动态统计是一种优化技术，其中数据库使用递归SQL扫描表中块的小随机样本。">配置动态统计选项</a> ”</span></p>
                           </li>
                           <li>
                              <p><span class="q">“ <a href="managing-extended-statistics.html#GUID-858E0BDA-06C6-471F-B9E8-888C3AD29673" title="单个列统计信息对于确定WHERE子句中单个谓词的选择性非常有用。">关于列组的统计信息</a> ”</span></p>
                           </li>
                           <li>
                              <p><a href="../refrn/OPTIMIZER_DYNAMIC_SAMPLING.html#REFRN10140" target="_blank"><span><cite>Oracle Database Reference</cite></span></a>了解<code class="codeph">OPTIMIZER_DYNAMIC_SAMPLING</code>初始化参数</p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-13E8BD68-B8A1-4937-8774-3EF82FB8FB47" title="数据库会在不同时间从各种来源收集优化程序统计信息。">数据库收集优化程序统计信息时</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div><a id="TGSQL350"></a><div class="props_rev_3"><a id="GUID-3A50D0D5-5494-43EE-B03D-10569B4D8BF8" name="GUID-3A50D0D5-5494-43EE-B03D-10569B4D8BF8"></a><h4 id="TGSQL-GUID-3A50D0D5-5494-43EE-B03D-10569B4D8BF8" class="sect4"><span class="enumeration_section">10.4.4</span>数据库如何对数据进行采样</h4>
                  <div>
                     <p>在优化开始时，在确定表是否是动态统计信息的候选者时，优化程序会检查表上是否存在持久性SQL计划指令。</p>
                     <p>对于每个指令，优化程序会在确定涉及表的谓词的基数时注册优化程序计算的统计表达式。在<a href="optimizer-statistics-concepts.html#GUID-E932F5B4-9BDB-4EE4-934C-7F1979CC62A9__BABCEJAH">图10-2中</a> ，数据库发出<a href="glossary.html#GUID-4BBB2EED-7E8C-4BAF-A3B3-B1CEF98342AC"><span class="xrefglossterm">递归SQL</span></a>语句来扫描表块的一小部分随机样本。数据库应用相关的单表谓词和连接来估计谓词基数。
                     </p>
                     <p>数据库将动态统计信息的结果保留为可共享统计信息。数据库可以在<a href="glossary.html#GUID-F9233BE0-9CB9-4673-A705-174924AE3B18"><span class="xrefglossterm">SQL编译</span></a>一个查询期间与同一查询的重新编译共享结果。数据库还可以将结果重用于具有相同模式的查询。
                     </p>
                  </div>
                  <div>
                     <div class="infoboxnotealso" id="GUID-3A50D0D5-5494-43EE-B03D-10569B4D8BF8__GUID-79EB0E26-32DE-42BD-B837-5BFC0AE7B2C6">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><span class="q">“ <a href="options-for-optimizer-statistics-gathering.html#GUID-F1C666DC-5450-4F92-83AA-607327DB5FD8" title="动态统计是一种优化技术，其中数据库使用递归SQL扫描表中块的小随机样本。">配置动态统计选项</a> ”</span>以了解如何设置动态统计级别</p>
                           </li>
                           <li>
                              <p>有关<code class="codeph">OPTIMIZER_DYNAMIC_SAMPLING</code>初始化参数的详细信息，请<a href="../refrn/OPTIMIZER_DYNAMIC_SAMPLING.html#REFRN10140" target="_blank"><span><cite>参见Oracle数据库参考</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                     <div class="familylinks">
                        <div class="parentlink">
                           <p><strong>父主题：</strong> <a href="optimizer-statistics-concepts.html#GUID-13E8BD68-B8A1-4937-8774-3EF82FB8FB47" title="数据库会在不同时间从各种来源收集优化程序统计信息。">数据库收集优化程序统计信息时</a></p>
                        </div>
                     </div>
                  </div>
                  
               </div>
            </div>
         </div>
      </article>
   </body>
</html>