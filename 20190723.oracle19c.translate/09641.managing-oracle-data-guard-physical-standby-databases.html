<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="This chapter discusses the various ways that physical and snapshot standby databases need to be managed."></meta>
      <meta name="description" content="This chapter discusses the various ways that physical and snapshot standby databases need to be managed."></meta>
      <title>管理物理和快照备用数据库</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Concepts and Administration "></meta>
      <meta property="og:description" content="This chapter discusses the various ways that physical and snapshot standby databases need to be managed."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Concepts and Administration"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="data-guard-concepts-and-administration.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-02-12T10:50:21-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="1999, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96244-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="managing-oracle-data-guard-role-transitions.html" title="Previous" type="text/html"></link>
      <link rel="next" href="managing-oracle-data-guard-logical-standby-databases.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Data Guard Concepts and Administration"></meta>
    <meta name="dcterms.isVersionOf" content="SBYDB"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="managing-oracle-data-guard-role-transitions.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="managing-oracle-data-guard-logical-standby-databases.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">概念和管理</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="oracle-data-guard-concepts.html" property="item" typeof="WebPage"><span property="name">概念和管理</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">管理物理和快照备用数据库</li>
            </ol>
            <a id="GUID-B140C38B-DE01-4252-8422-7154018DDFEC" name="GUID-B140C38B-DE01-4252-8422-7154018DDFEC"></a><a id="SBYDB00700"></a>
            
            <h2 id="SBYDB-GUID-B140C38B-DE01-4252-8422-7154018DDFEC" class="sect2"><span class="enumeration_chapter">10</span>管理物理和快照备用数据库</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章讨论了需要管理物理和快照备用数据库的各种方法。</p>
               <p>请参阅以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-D7026A24-78EF-4C0D-84E5-41D767516565" title="本节介绍如何启动和关闭物理备用数据库。">启动和关闭物理备用数据库</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-D5FB88EC-799D-40E7-80E1-19474E3167E4" title="可以打开物理备用数据库以进行只读访问，并用于从主数据库卸载查询。">打开物理备用数据库</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-62007456-DD41-431D-B0E7-56C99FEB2277" title="对主数据库进行的大多数结构更改都会自动通过重做数据传播到物理备用数据库，但是有一些更改需要手动干预。">在物理待机中需要手动干预的主要数据库更改</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-02218512-31A6-461E-96B4-0B9997DCFC4A" title="在使用RESETLOGS选项打开主数据库之后，Oracle Data Guard允许在物理备用数据库上进行恢复。">通过OPEN RESETLOGS声明恢复</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-0682EE24-B495-48E8-9E1F-52AC0E6FE486" title="此表汇总了常见的主数据库管理操作以及在何处查找与这些操作相关的信息。">监控主要，物理备用和快照备用数据库</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-45D7D60E-ED0F-4B3E-9D32-EB5394196CAF" title="在主数据库上创建的还原点会自动复制到备用数据库。在备用数据库上创建的还原点称为复制还原点。无论主数据库上的还原点是保证还原点还是正常还原点，相应的复制还原点始终是正常还原点。">将还原点从主节点复制到备用节点</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-EEDAC95A-828F-4117-AF57-D8ABA702D42D" title="Oracle白皮书可用于描述如何优化Redo Apply和介质恢复性能。">调整重做应用</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-2FF52A94-828C-4BF1-A5D0-C70A05A8198A" title="在Active Data Guard环境中，SQL Tuning Advisor可以调整主数据库上的备用工作负载。">使用SQL Tuning Advisor在Active Data Guard环境中调整数据库</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-1E2A26E3-B0E2-4ED1-A50D-891505C86E7D" title="Oracle Diagnostic Pack可与以只读模式打开的Oracle Active Data Guard备用数据库一起使用。">使用Oracle Diagnostic Pack调整Oracle Active Data Guard Standbys</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-CE30E2D6-5B53-4389-8B02-FC0F341C8C1A" title="快照备用数据库是完全可更新的备用数据库。它从主数据库接收和归档重做数据，但不应用它。">管理快照备用数据库</a></p>
                  </li>
               </ul>
               <p>请参阅<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=DGBKR001" target="_blank"><span class="italic">Oracle Data Guard Broker</span></a>以了解Oracle Data Guard代理如何简化物理和快照备用数据库的管理。
               </p>
            </div><a id="SBYDB00705"></a><div class="props_rev_3"><a id="GUID-D7026A24-78EF-4C0D-84E5-41D767516565" name="GUID-D7026A24-78EF-4C0D-84E5-41D767516565"></a><h3 id="SBYDB-GUID-D7026A24-78EF-4C0D-84E5-41D767516565" class="sect3"><span class="enumeration_section">10.1</span>启动和关闭物理备用数据库</h3>
               <div>
                  <p>本节介绍如何启动和关闭物理备用数据库。</p>
                  <p></p>
               </div><a id="SBYDB4776"></a><div class="props_rev_3"><a id="GUID-76930886-6460-45AE-86CA-84DCB41E5BE5" name="GUID-76930886-6460-45AE-86CA-84DCB41E5BE5"></a><h4 id="SBYDB-GUID-76930886-6460-45AE-86CA-84DCB41E5BE5" class="sect4"><span class="enumeration_section">10.1.1</span>启动物理备用数据库</h4>
                  <div>
                     <p>使用SQL * Plus <code class="codeph">STARTUP</code>命令启动物理备用数据库。
                     </p>
                     <div class="section">
                        <p>在没有任何参数的情况下调用时，SQL * Plus <code class="codeph">STARTUP</code>命令以只读模式启动，装入和打开物理备用数据库。
                        </p>
                        <p>安装或打开后，物理备用数据库可以从主数据库接收重做数据。</p>
                        <p>有关重做应用和<a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-D5FB88EC-799D-40E7-80E1-19474E3167E4" title="A physical standby database can be opened for read-only access and used to offload queries from a primary database.">打开物理备用数据库</a>的信息，请参阅<a href="oracle-data-guard-redo-apply-services.html#GUID-2B839172-947E-48A4-9FFD-33CC6907809F" title="执行重做应用时，物理备用数据库可以使用实时应用功能直接从备用重做日志文件应用重做，因为它们是由远程文件服务器（RFS）进程写入的。">将重做数据应用于物理备用数据库，</a>以获取有关以只读模式<a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-D5FB88EC-799D-40E7-80E1-19474E3167E4" title="可以打开物理备用数据库以进行只读访问，并用于从主数据库卸载查询。">打开物理备用数据库</a>的信息。
                        </p>
                        <div class="infoboxnote" id="GUID-76930886-6460-45AE-86CA-84DCB41E5BE5__GUID-E95C72E7-083B-4FA4-8FE5-E6C437931071">
                           <p class="notep1">注意：</p>
                           <p>在尚未从主数据库接收重做数据的物理备用数据库上启动重做应用时，可能会返回<code class="codeph">ORA-01112</code>消息。这表示重做应用无法确定介质恢复的起始序列号。如果发生这种情况，请从主数据库中手动检索存档的重做日志文件并将其注册到备用数据库，或者在启动重做应用之前等待重做传输开始。
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="SBYDB4777"></a><div class="props_rev_3"><a id="GUID-B51873F4-F50C-4757-9DF9-D43635BFAD7F" name="GUID-B51873F4-F50C-4757-9DF9-D43635BFAD7F"></a><h4 id="SBYDB-GUID-B51873F4-F50C-4757-9DF9-D43635BFAD7F" class="sect4"><span class="enumeration_section">10.1.2</span>关闭物理备用数据库</h4>
                  <div>
                     <p>使用SQL * Plus <code class="codeph">SHUTDOWN</code>命令停止Redo Apply并关闭物理备用数据库。
                     </p>
                     <div class="section">
                        <p>在关闭完成之前，控制不会返回到启动数据库关闭的会话。</p>
                        <p>如果主数据库已启动并正在运行，请在关闭物理备用数据库之前，将主数据库上的备用目标推迟并执行日志切换。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="SBYDB00706"></a><div class="props_rev_3"><a id="GUID-D5FB88EC-799D-40E7-80E1-19474E3167E4" name="GUID-D5FB88EC-799D-40E7-80E1-19474E3167E4"></a><h3 id="SBYDB-GUID-D5FB88EC-799D-40E7-80E1-19474E3167E4" class="sect3"><span class="enumeration_section">10.2</span>打开物理备用数据库</h3>
               <div>
                  <p>可以打开物理备用数据库以进行只读访问，并用于从主数据库卸载查询。</p>
                  <div class="infoboxnote" id="GUID-D5FB88EC-799D-40E7-80E1-19474E3167E4__GUID-E5C2C62C-70A8-4E75-A692-8E904A25EB63">
                     <p class="notep1">注意：</p>
                     <p>以只读模式打开的物理备用数据库受限于与以只读模式打开的任何其他Oracle数据库相同的限制。有关更多信息，请参见“ <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=ADMIN11154" target="_blank"><span class="italic">Oracle数据库管理员指南”</span></a> 。
                     </p>
                  </div>
                  <p>如果是Oracle Active Data Guard的许可证<a id="d21041e550" class="indexterm-anchor"></a>已购买选项，在物理备用数据库打开时，Redo Apply可以处于活动状态，从而允许查询返回与从主数据库返回的结果相同的结果。此功能称为实时查询<a id="d21041e555" class="indexterm-anchor"></a>特征。 <a id="d21041e558" class="indexterm-anchor"></a> 有关更多详细信息，请参阅<a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-07CB190C-C248-4FF5-AB64-EAA9C6D42677" title="必须将COMPATIBLE数据库初始化参数设置为11.0或更高才能使用Oracle Active Data Guard选项的实时查询功能。">实时查询</a> 。
                  </p>
                  <p>如果尚未购买Oracle Active Data Guard选项的许可证，则在重做应用处于活动状态时无法打开物理备用数据库，因此在打开物理备用数据库实例或启动重做应用时必须遵循以下规则：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>必须在打开任何物理备用数据库实例之前停止重做应用。</p>
                     </li>
                     <li>
                        <p>如果打开了一个或多个物理备用实例，则必须在启动重做应用之前在挂载状态下停止或重新启动这些实例。</p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-D5FB88EC-799D-40E7-80E1-19474E3167E4__GUID-9E51DA30-348A-4DF3-ACB6-03447C2541ED">
                     <p class="notep1">也可以看看：</p>
                     <p></p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>有关Oracle Active Data Guard的更多信息，请参见<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=DBLIC-GUID-AB56CEE3-955E-4E56-8B44-6075E889C283" target="_blank"><span class="italic">Oracle数据库许可信息</span></a></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="SBYDB5039"></a><a id="SBYDB00707"></a><div class="props_rev_3"><a id="GUID-07CB190C-C248-4FF5-AB64-EAA9C6D42677" name="GUID-07CB190C-C248-4FF5-AB64-EAA9C6D42677"></a><h4 id="SBYDB-GUID-07CB190C-C248-4FF5-AB64-EAA9C6D42677" class="sect4"><span class="enumeration_section">10.2.1</span>实时查询</h4>
                  <div>
                     <p>必须将<code class="codeph">COMPATIBLE</code>数据库初始化参数设置为11.0或更高才能使用Oracle Active Data Guard选项的实时查询功能。
                     </p>
                     <div class="section">
                        <p>如果Redo Apply在该数据库的已装载实例上处于活动状态，则无法打开物理备用数据库实例。使用以下SQL语句停止重做应用，以只读方式打开备用实例，然后重新启动重做应用：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE RECOVER MANAGED STANDBY DATABASE CANCEL; SQL&gt; ALTER DATABASE OPEN; SQL&gt; ALTER DATABASE RECOVER MANAGED STANDBY DATABASE DISCONNECT;</pre><div class="infoboxnote" id="GUID-07CB190C-C248-4FF5-AB64-EAA9C6D42677__GUID-D6192E36-A702-488C-9501-E869F2DEEA6E">
                           <p class="notep1">注意：</p>
                           <p>如果重做应用在打开的实例上处于活动状态，则可以打开其他实例而无需停止重做应用。</p>
                        </div>
                        <p>如果已打开该数据库的任何实例，则无法在已装入的物理备用实例上启动重做应用。必须先打开实例，然后再启动Redo Apply。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-07CB190C-C248-4FF5-AB64-EAA9C6D42677__GUID-D2019BDB-8414-471D-88BB-506786F06C6D">示例：查询V $ DATABASE以检查待机的打开模式</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>此示例显示在实时查询模式下打开物理备用<code class="codeph">V$DATABASE.OPEN_MODE</code>时<code class="codeph">V$DATABASE.OPEN_MODE</code>列的值如何更改。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动并打开物理备用实例，并执行以下SQL查询以显示数据库以只读模式打开：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT open_mode FROM V $ DATABASE; OPEN_MODE --------------------只读</pre></div>
                        </li>
                        <li class="stepexpand"><span>发出以下SQL语句以启动Redo Apply：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE RECOVER MANAGED STANDBY DATABASE DISCONNECT;数据库改变了
</pre></div>
                        </li>
                        <li class="stepexpand"><span>既然备用数据库处于实时查询模式（备用数据库以只读模式打开并且重做应用处于活动状态），则<code class="codeph">V$DATABASE.OPEN_MODE</code>列将更改为指示以下内容：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT open_mode FROM V $ DATABASE; OPEN_MODE --------------------只读应用</pre></div>
                        </li>
                     </ol>
                  </div><a id="SBYDB4778"></a><div class="props_rev_3"><a id="GUID-C225DCBC-E9FB-4E86-9D19-A5D20C3A8AA5" name="GUID-C225DCBC-E9FB-4E86-9D19-A5D20C3A8AA5"></a><h5 id="SBYDB-GUID-C225DCBC-E9FB-4E86-9D19-A5D20C3A8AA5" class="sect5"><span class="enumeration_section">10.2.1.1</span>在实时查询环境中监控应用延迟</h5>
                     <div>
                        <p>如果使用实时查询将查询从主数据库卸载到物理备用数据库，则可以监视应用延迟以确保它在可接受的限制范围内。</p>
                        <div class="section">
                           <p>当前应用延迟是在最后一次应用的更改在备用数据库上变为可见时以及在主数据库上首次显示相同更改之间的经过时间之间的差异。此度量标准计算为最接近的秒。</p>
                           <p>要获取应用延迟，请查询<code class="codeph">V$DATAGUARD_STATS</code>视图。例如：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT name，value，datum_time，time_computed FROM V $ DATAGUARD_STATS  - &gt; WHERE名称如'apply lag'; NAME VALUE DATUM_TIME TIME_COMPUTED --------- ------------- ------------------- ----- -------------- apply lag +00 00:00:00 05/27/2009 08:54:16 05/27/2009 08:54:17</pre><p><code class="codeph">apply</code> <code class="codeph">lag</code>度量使用从主数据库定期接收的数据计算。<code class="codeph">DATUM_TIME</code>列包含备用数据库上次接收此数据的时间戳。<code class="codeph">TIME_COMPUTED</code>列包含计算<code class="codeph">apply</code> <code class="codeph">lag</code>指标时的时间戳。这些列中的值之间的差异应小于30秒。如果差异大于此值，则<code class="codeph">apply</code> <code class="codeph">lag</code>度量可能不准确。
                           </p>
                           <p>要获取显示自上次启动备用实例以来应用延迟值历史记录的直方图，请查询<code class="codeph">V$STANDBY_EVENT_HISTOGRAM</code>视图。例如：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT * FROM V $ STANDBY_EVENT_HISTOGRAM WHERE NAME ='apply lag' - &gt; AND COUNT&gt; 0;名称时间单位COUNT LAST_TIME_UPDATED --------- --------- -------- ----------- -------- ---------------- apply lag 0秒79681 06/18/2009 10:05:00 apply lag 1秒1006 06/18/2009 10:03:56 apply lag 2秒96 06/18/2009 09:51:06应用延迟3秒4 06/18/2009 04:12:32应用延迟4秒1 06/17/2009 11:43:51应用延迟5秒1 06/17 / 2009 11:43:52选择了6行</pre><p>要评估一段时间内的应用延迟，请在该时间段开始时拍摄<code class="codeph">V$STANDBY_EVENT_HISTOGRAM</code>的快照，并将该快照与该时间段结束时拍摄的快照进行比较。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="SBYDB4779"></a><div class="props_rev_3"><a id="GUID-622B6596-54F7-4736-8A8B-0C5E308AC3F5" name="GUID-622B6596-54F7-4736-8A8B-0C5E308AC3F5"></a><h5 id="SBYDB-GUID-622B6596-54F7-4736-8A8B-0C5E308AC3F5" class="sect5"><span class="enumeration_section">10.2.1.2</span>在实时查询环境中配置应用滞后容差</h5>
                     <div>
                        <p><code class="codeph">STANDBY_MAX_DATA_DELAY</code>会话参数可用于为非管理用户向处于实时查询模式的物理备用数据库发出的查询指定特定于会话的应用延迟容差（以秒为单位）。
                        </p>
                        <p>此功能允许将查询从主数据库安全地卸载到物理备用数据库，因为可以检测备用数据库是否已变得无法接受。</p>
                        <p>如果<code class="codeph">STANDBY_MAX_DATA_DELAY</code>设置为默认值<code class="codeph">NONE</code> ，则执行发出到物理备用数据库的查询，而不管该数据库的应用延迟如何。
                        </p>
                        <p>如果<code class="codeph">STANDBY_MAX_DATA_DELAY</code>设置为非零值，则仅当应用延迟小于或等于<code class="codeph">STANDBY_MAX_DATA_DELAY</code>才会执行发送到物理备用数据库的查询。否则，将返回<code class="codeph">ORA-3172</code>错误以警告客户端应用延迟太大。
                        </p>
                        <p>如果<code class="codeph">STANDBY_MAX_DATA_DELAY</code>设置为0，则发送到物理备用数据库的查询将保证返回与在主数据库上发出查询完全相同的结果，除非备用数据库滞后于主数据库，在这种情况下是<code class="codeph">ORA-3172</code>返回<code class="codeph">ORA-3172</code>错误。
                        </p>
                        <p>使用<code class="codeph">ALTER SESSION</code> SQL语句设置<code class="codeph">STANDBY_MAX_DATA_DELAY</code> 。例如：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER SESSION SET STANDBY_MAX_DATA_DELAY = 2</pre></div>
                  </div><a id="SBYDB4780"></a><div class="props_rev_3"><a id="GUID-194B1448-84FB-4357-A6AD-72A77701F918" name="GUID-194B1448-84FB-4357-A6AD-72A77701F918"></a><h5 id="SBYDB-GUID-194B1448-84FB-4357-A6AD-72A77701F918" class="sect5"><span class="enumeration_section">10.2.1.3</span>在实时查询环境中强制重做应用同步</h5>
                     <div>
                        <p>要确保从主数据库接收的所有重做数据都已应用于物理备用数据库，可以使用SQL <code class="codeph">ALTER SESSION</code>语句。
                        </p>
                        <div class="section">
                           <p>发出以下SQL语句：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER SESSION SYNC with PRIMARY;</pre><p>此语句将阻塞，直到发出此命令时备用数据库收到的所有重做数据都已应用于物理备用数据库。如果备用数据库中的重做传输状态不是<code class="codeph">SYNCHRONIZED</code>或重做应用未激活，则会立即返回<code class="codeph">ORA-3173</code>错误，并且不会发生<code class="codeph">SYNCHRONIZED</code> 。
                           </p>
                           <p>要确保在特定情况下发生重做应用同步，请使用<code class="codeph">SYS_CONTEXT('USERENV','DATABASE_ROLE')</code>函数创建仅备用触发器（在主服务器上启用但仅在备用服务器上运行时才执行某些操作） 。例如，您可以创建以下触发器，该触发器将在登录时为特定用户连接执行<code class="codeph">ALTER SESSION SYNC WITH PRIMARY</code>语句：</p><pre class="oac_no_warn" dir="ltr">创建触发器adg_logon_sync_trigger登录后，user.schema开始if（SYS_CONTEXT（'USERENV'，'DATABASE_ROLE'）IN（'PHYSICAL STANDBY'））然后立即执行'alter session sync with primary';万一;结束;</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="SBYDB4781"></a><div class="props_rev_3"><a id="GUID-25EF4F01-3DF0-4F21-99B8-95178CA003BE" name="GUID-25EF4F01-3DF0-4F21-99B8-95178CA003BE"></a><h5 id="SBYDB-GUID-25EF4F01-3DF0-4F21-99B8-95178CA003BE" class="sect5"><span class="enumeration_section">10.2.1.4</span>实时查询限制</h5>
                     <div>
                        <p>此列表讨论与实时查询模式相关的限制。</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>上述应用延迟控制和重做应用同步机制要求连接客户端并向处于实时查询模式的物理备用数据库发出查询。</p>
                           </li>
                           <li>
                              <p>如果<code class="codeph">STANDBY_MAX_DATA_DELAY</code>设置为0或者使用<code class="codeph">ALTER SESSION SYNC WITH PRIMARY</code> SQL语句，则以下附加限制适用：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>备用数据库必须通过SYNC传输接收重做数据。</p>
                                 </li>
                                 <li>
                                    <p>备用数据库的重做传输状态必须为SYNCHRONIZED，并且主数据库必须以最大保护模式或最大可用性模式运行。</p>
                                 </li>
                                 <li>
                                    <p>必须启用实时应用。</p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>Oracle Active Data Guard通过使用缓存融合在Oracle RAC环境中实现了高性能的实时查询。这允许Oracle Data Guard应用实例和查询在缓存之外工作，而不会因磁盘I / O限制而减慢速度。这样做的结果是，应用实例的意外故障会使缓冲区在所有打开的Oracle RAC实例中处于不一致状态。为确保数据一致性和完整性，Oracle Data Guard将关闭Oracle RAC配置中的所有其他打开实例，并将其置于已装入状态。您必须手动重新打开实例 - 此时数据会自动保持一致，然后在其中一个实例上重新启动重做应用。在Oracle Data Guard代理配置中，将自动重新打开实例，并在其中一个实例上自动重新启动重做应用。</p>
                              <div class="infoboxnotealso" id="GUID-25EF4F01-3DF0-4F21-99B8-95178CA003BE__GUID-D6506452-9378-4275-B7D3-F3F93BD6D220">
                                 <p class="notep1">也可以看看：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>有关代理如何处理应用实例故障的更多信息，请参阅<a href="../dgbkr/managing-oracle-data-guard-broker-configuration-members.html#DGBKR260" target="_blank"><span class="italic">Oracle Data Guard Broker</span></a></p>
                                    </li>
                                    <li>
                                       <p>有关在Oracle Active Data Guard Oracle RAC备用数据库中应用实例故障的其他信息，请访问<a href="http://support.oracle.com" target="_blank"><code class="codeph">http://support.oracle.com</code></a>的My Oracle Support说明1357597.1</p>
                                    </li>
                                 </ul>
                              </div>
                           </li>
                        </ul>
                     </div>
                  </div><a id="SBYDB5255"></a><a id="SBYDB5256"></a><a id="SBYDB5257"></a><a id="SBYDB4782"></a><div class="props_rev_3"><a id="GUID-67B644A3-161B-4A83-A0B2-923BF51AD932" name="GUID-67B644A3-161B-4A83-A0B2-923BF51AD932"></a><h5 id="SBYDB-GUID-67B644A3-161B-4A83-A0B2-923BF51AD932" class="sect5"><span class="enumeration_section">10.2.1.5</span>自动块介质恢复</h5>
                     <div>
                        <p>如果在访问数据库时遇到损坏的数据块，则可以使用这些块的未损坏副本自动替换它们。</p>
                        <p>这需要以下条件：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>物理备用数据库必须以实时查询模式运行，这需要Oracle Active Data Guard许可证。</p>
                           </li>
                           <li>
                              <p>物理备用数据库必须运行实时应用。</p>
                           </li>
                        </ul>
                        <p>自动块介质恢复在两个方向上工作，具体取决于在主数据库还是备用数据库上遇到损坏的块。</p>
                        <div class="section">
                           <p class="subhead3" id="GUID-67B644A3-161B-4A83-A0B2-923BF51AD932__GUID-7F4A0316-2277-4EAC-943A-960BB5FF84E2">主要损坏的块</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>如果在主数据库中遇到损坏的数据块，则主数据库会自动在备用数据库上搜索这些块的正确副本，如果找到它们，则将它们运回主数据库。</p>
                           <p>主数据库仅需要<code class="codeph">LOG_ARCHIVE_DEST_</code> <span class="italic"><code class="codeph">n</code></span>到备用数据库（物理备用数据库，级联物理备用数据库或远程同步实例）。主数据库不需要<code class="codeph">LOG_ARCHIVE_DEST_</code> <span class="italic"><code class="codeph">n</code></span>到任何终端目的地;它能够自动确定他们的服务名称。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-67B644A3-161B-4A83-A0B2-923BF51AD932__GUID-6EEE6907-6330-46D4-98F4-08A75BD88516">在待机状态下损坏的块</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>如果在备用数据库中遇到损坏的数据块，则备用数据库会自动启动与主数据库的通信，并请求这些数据块的未损坏副本。要使主数据库能够将未损坏的块传送到备用数据库，必须在备用数据库上配置以下数据库初始化参数。即使主服务器不直接为备用服务器提供服务（例如，在级联配置中），也是如此。</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">LOG_ARCHIVE_CONFIG</code>参数配置了<code class="codeph">DG_CONFIG</code>列表，并为主数据库配置了<code class="codeph">LOG_ARCHIVE_DEST_</code> <span class="italic"><code class="codeph">n</code></span>参数。
                                 </p>
                                 <p><span class="bold">要么</span></p>
                              </li>
                              <li>
                                 <p>已配置<code class="codeph">FAL_SERVER</code>参数，其值包含主数据库的Oracle Net服务名称。
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-67B644A3-161B-4A83-A0B2-923BF51AD932__GUID-CE4B5D92-2CEF-499F-B348-FEE58E79C148">其他自动块介质修复注意事项</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>任何Oracle Data Guard保护模式都支持自动修复。但是，使用来自备用数据库的块的非损坏版本修复主数据库中的损坏块的有效性取决于备用数据库与主数据库生成的重做同步的程度。</p>
                              </li>
                              <li>
                                 <p>执行自动块修复后，会将消息写入数据库警报日志。</p>
                              </li>
                              <li>
                                 <p>如果无法进行自动块修复，则会返回<code class="codeph">ORA-1578</code>错误。
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="SBYDB4783"></a><div class="props_rev_3"><a id="GUID-B2A61261-304D-4C14-AEF3-DA6E1B4368B3" name="GUID-B2A61261-304D-4C14-AEF3-DA6E1B4368B3"></a><h5 id="SBYDB-GUID-B2A61261-304D-4C14-AEF3-DA6E1B4368B3" class="sect5"><span class="enumeration_section">10.2.1.6</span>手动阻止介质恢复</h5>
                     <div>
                        <p>RMAN <code class="codeph">RECOVER BLOCK</code>命令用于手动修复损坏的数据块。
                        </p>
                        <p>此命令在多个位置搜索数据块的未损坏副本。默认情况下，其中一个位置是以实时查询模式运行的任何可用物理备用数据库。RMAN <code class="codeph">RECOVER BLOCK</code>命令的<code class="codeph">EXCLUDE STANDBY</code>选项可用于将物理备用数据库排除为替换块的源。
                        </p>
                        <div class="infoboxnotealso" id="GUID-B2A61261-304D-4C14-AEF3-DA6E1B4368B3__GUID-090667F6-3ABD-4DAE-8931-CF344DD71EDB">
                           <p class="notep1">也可以看看：</p>
                           <p>有关RMAN <code class="codeph">RECOVER BLOCK</code>命令的更多信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=RCMRF140" target="_blank"><span class="italic">参见Oracle数据库备份和恢复参考</span></a></p>
                        </div>
                     </div>
                  </div><a id="SBYDB5463"></a><a id="SBYDB5130"></a><div class="props_rev_3"><a id="GUID-12950D5A-FE9F-4444-A6DE-26FCC5653225" name="GUID-12950D5A-FE9F-4444-A6DE-26FCC5653225"></a><h5 id="SBYDB-GUID-12950D5A-FE9F-4444-A6DE-26FCC5653225" class="sect5"><span class="enumeration_section">10.2.1.7</span>在物理备用数据库<span class="enumeration_section">上调</span>优查询</h5>
                     <div>
                        <p>可以调整物理备用数据库上的查询以获得最佳性能。</p>
                        <p>有关调优查询的详细信息，请参阅Oracle最高可用性体系结构（MAA）主页上提供的<span class="italic">Active Data Guard最佳实践</span>白皮书：</p>
                        <p><a href="http://www.oracle.com/goto/maa" target="_blank"><code class="codeph">http://www.oracle.com/goto/maa</code></a></p>
                        <div class="section">
                           <p class="subhead3" id="GUID-12950D5A-FE9F-4444-A6DE-26FCC5653225__GUID-53657E7D-DAAE-4E23-BC98-BC89657BE300">强制完全数据库缓存模式</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>使用强制完全数据库缓存模式可以潜在地提高性能，因为查询执行得更快。</p>
                           <p>启用和禁用强制完全数据库缓存模式<a id="d21041e1549" class="indexterm-anchor"></a><a id="d21041e1553" class="indexterm-anchor"></a>不以重做方式记录，因此内存缓存的状态在Data Guard配置的所有成员上不一定相同。
                           </p>
                           <p>有关Force Full Database In-Memory Caching功能的详细信息，包括有关如何以及何时启用和禁用它的<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=TGDBA95384" target="_blank"><span class="italic">指南</span></a> ，请参阅<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=TGDBA95384" target="_blank"><span class="italic">Oracle Database Performance Tuning Guide</span></a> 。
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="SBYDB5446"></a><div class="props_rev_3"><a id="GUID-40A7D7C1-72B8-4397-B61B-446028102E2D" name="GUID-40A7D7C1-72B8-4397-B61B-446028102E2D"></a><h5 id="SBYDB-GUID-40A7D7C1-72B8-4397-B61B-446028102E2D" class="sect5"><span class="enumeration_section">10.2.1.8</span>将Temp文件添加到物理备用</h5>
                     <div>
                        <p>如果使用备用数据库从主数据库卸载查询，则必须使用至少一个临时数据文件的最小临时表空间配置备用数据库。</p>
                        <div class="section">
                           <p>如果工作负载的性质需要比首次创建备用数据库时自动创建的更多临时表空间，则可能需要手动添加其他空间。</p>
                           <p>要将临时文件添加到物理备用数据库，请执行以下任务：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>标识包含临时文件的表空间。通过在备用数据库上输入以下命令来执行此操作：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT TABLESPACE_NAME FROM DBA_TABLESPACES 2&gt; WHERE CONTENTS ='TEMPORARY'; TABLESPACE_NAME -------------------------------- TEMP1 TEMP2</pre></div>
                           </li>
                           <li class="stepexpand"><span>对于上一个查询中标识的每个表空间，将新的临时文件添加到备用数据库。以下示例添加一个名为<code class="codeph">TEMP1</code>的新临时文件，其大小和重用特性与主数据库临时文件匹配：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER TABLESPACE TEMP1 ADD TEMPFILE 2&gt;'/ arch1 / Boston / temp01.dbf'3&gt; SIZE 40M REUSE;</pre></div>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-B1C66720-3EA6-45A3-986E-6E510381EC79" name="GUID-B1C66720-3EA6-45A3-986E-6E510381EC79"></a><h4 id="SBYDB-GUID-B1C66720-3EA6-45A3-986E-6E510381EC79" class="sect4"><span class="enumeration_section">10.2.2</span>在Active Data Guard Standbys上使用SQL和PL / SQL</h4>
                  <p>从Oracle Database Release 19c开始，您可以在Active Data Guard备用数据库中执行SQL和PL / SQL操作。</p>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-8AAD002C-ED06-4349-8BB5-EC8DB30B2628" title="您可以在Active Data Guard备用数据库上运行DML操作。这使您可以在备用数据库上运行读取主要应用程序，这些应用程序偶尔会执行DML。">在Active Data Guard备用数据库上执行DML操作</a></li>
                           <li><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-143121BA-3F4C-4953-B0E7-68BE9EE700C9" title="如果主数据库中不包含绑定变量，则可以将在Active Data Guard备用数据库上运行的PL / SQL块重定向到主数据库并在主数据库上运行。">在Active Data Guard备用数据库上运行顶级PL / SQL操作</a></li>
                           <li><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-21156FB5-6BBF-4D0B-B914-D69DC3C61A2C" title="如果它们无效，则可以重新编译在备用实例上运行的PL / SQL对象。">修改后的PL / SQL对象的自动重新编译</a></li>
                        </ul>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-8AAD002C-ED06-4349-8BB5-EC8DB30B2628" name="GUID-8AAD002C-ED06-4349-8BB5-EC8DB30B2628"></a><h5 id="SBYDB-GUID-8AAD002C-ED06-4349-8BB5-EC8DB30B2628" class="sect5"><span class="enumeration_section">10.2.2.1</span>在Active Data Guard备用数据库上执行DML操作</h5>
                     <div>
                        <p>您可以在Active Data Guard备用数据库上运行DML操作。这使您可以在备用数据库上运行读取主要应用程序，这些应用程序偶尔会执行DML。</p>
                        <div class="section">
                           <p></p>
                           <p>备用数据库上的DML操作可以透明地重定向到主数据库并在主数据库上运行。这包括作为PL / SQL块一部分的DML语句。Active Data Guard会话将等待，直到相应的更改发送到Active Data Guard备用数据库并应用于Active Data Guard备用数据库。在DML操作期间保持读取一致性，运行DML的备用数据库可以查看其未提交的更改。但是，所有其他备用数据库实例只能在提交事务后才能查看这些更改。</p>
                           <div class="infoboxnote" id="GUID-8AAD002C-ED06-4349-8BB5-EC8DB30B2628__GUID-D1283418-DE83-43DC-982E-6CF146559B32">
                              <p class="notep1">注意：</p>
                              <p>避免在Active Data Guard备用数据库上运行DML操作。由于操作实际上是在主数据库上执行的，因此过多的DML可能会影响主数据库的性能。</p>
                           </div>
                           <p>可以在系统级别或会话级别配置DML操作到主服务器的自动重定向。会话级别设置将覆盖系统级别设置。</p>
                           <p>要为Active Data Guard环境中的所有备用会话配置DML操作的自动重定向，请执行以下操作：</p>
                           <ul id="GUID-8AAD002C-ED06-4349-8BB5-EC8DB30B2628__UL_A3D_RPG_QFB" style="list-style-type:disc">
                              <li>将<code class="codeph">ADG_REDIRECT_DML</code>初始化参数设置为<code class="codeph">TRUE</code> 。</li>
                           </ul>
                           <p>要为当前会话配置DML操作的自动重定向，请使用以下命令：</p>
                        </div>
                        <!-- class="section" -->
                        <ul id="GUID-8AAD002C-ED06-4349-8BB5-EC8DB30B2628__STEPS-UNORDERED_LLN_HLG_QFB">
                           <li><span><code class="codeph">ALTER SESSION ENABLE ADG_REDIRECT_DML;</code></span></li>
                        </ul>
                        <div class="example" id="GUID-8AAD002C-ED06-4349-8BB5-EC8DB30B2628__GUID-BB2CBC75-84E5-4D7F-A7BF-00BB61BC4CA8">
                           <p class="titleinexample">示例10-1在物理备用数据库上执行DML操作</p>
                           <p>Active Data Guard安装程序中的物理备用数据库包含名为<code class="codeph">employees</code>的表。您可以通过在Active Data Guard环境中的物理备用数据库上运行DML来将行插入此表。
                           </p>
                           <p>在备用数据库上，为当前会话启用DML重定向：</p><pre class="pre codeblock"><code>SQL&gt; ALTER SESSION ENABLE ADG_REDIRECT_DML;</code></pre><p>使用以下命令在<code class="codeph">employees</code>表中添加一行：</p><pre class="pre codeblock"><code>SQL&gt; INSERT INTO员工VALUES（.......）;</code></pre><p>此时，更改的数据仅对运行该命令的备用数据库可见。在主数据库上提交插入操作后，更改将重新发送并应用于所有备用数据库。</p>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-143121BA-3F4C-4953-B0E7-68BE9EE700C9" name="GUID-143121BA-3F4C-4953-B0E7-68BE9EE700C9"></a><h5 id="SBYDB-GUID-143121BA-3F4C-4953-B0E7-68BE9EE700C9" class="sect5"><span class="enumeration_section">10.2.2.2</span>在Active Data Guard备用数据库上运行顶级PL / SQL操作</h5>
                     <div>
                        <p>如果主数据库中不包含绑定变量，则可以将在Active Data Guard备用数据库上运行的PL / SQL块重定向到主数据库并在主数据库上运行。</p>
                        <div class="section">
                           <p></p>
                           <p>要将在备用数据库上运行的PL / SQL操作重定向到主数据库，请在备用数据库上使用以下命令配置自动重定向：</p>
                        </div>
                        <!-- class="section" -->
                        <ul id="GUID-143121BA-3F4C-4953-B0E7-68BE9EE700C9__STEPS-UNORDERED_DK5_23G_QFB">
                           <li><span><code class="codeph">ALTER SESSION ENABLE ADG_REDIRECT_PLSQL;</code></span></li>
                        </ul>
                        <div class="section">
                           <p>您只能在会话级别为PL / SQL操作配置自动重定向。</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-21156FB5-6BBF-4D0B-B914-D69DC3C61A2C" name="GUID-21156FB5-6BBF-4D0B-B914-D69DC3C61A2C"></a><h5 id="SBYDB-GUID-21156FB5-6BBF-4D0B-B914-D69DC3C61A2C" class="sect5"><span class="enumeration_section">10.2.2.3</span>修改的PL / SQL对象的自动重新编译</h5>
                     <div>
                        <p>如果它们无效，则可以重新编译在备用实例上运行的PL / SQL对象。</p>
                        <p></p>
                        <p>PL / SQL对象在修改或删除其依赖对象时变为无效。从Oracle Database Release 19c开始，可以通过将<code class="codeph">ADG_REDIRECT_DML</code>初始化参数设置为<code class="codeph">TRUE</code>来自动重新编译在备用数据库上运行的无效PL / SQL对象。与这些PL / SQL对象相对应的DDL被重定向到主数据库并在主数据库上执行。备用会话等待操作完成。
                        </p>
                        <div class="example" id="GUID-21156FB5-6BBF-4D0B-B914-D69DC3C61A2C__GUID-00B02E09-1008-4DE2-8C06-CEC3E8E4B831">
                           <p class="titleinexample">示例10-2自动重新编译已修改的PL / SQL对象</p>
                           <p>在Active DataGuard环境中的主数据库上，将创建名为<code class="codeph">insert_empl</code>的过程。此过程用于更新<code class="codeph">employees</code>表。
                           </p><pre class="pre codeblock"><code>创建或替换程序update_sal（emp_id IN NUMBER，sal IN NUMBER）AS BEGIN UPDATE employees SET salary = sal WHERE employee_id = emp_id）;结束;</code></pre><p>随后使用<code class="codeph">ALTER TABLE</code>命令修改<code class="codeph">employees</code>表的结构。这使<code class="codeph">update_sal</code>过程无效。
                           </p>
                           <p>在Active DataGuard环境中的备用数据库上，您希望使用<code class="codeph">update_sal</code>过程来更新员工的薪水。在物理备用服务器上运行以下命令：</p><pre class="pre codeblock"><code>SQL&gt; ALTER SESSION ENABLE ADG_REDIRECT_DML; SQL&gt; exec update_sal（105,6000）;</code></pre><p>运行这些命令的用户已被授予执行<code class="codeph">update_sal</code>过程的权限。
                           </p>
                        </div>
                        <!-- class="example" -->
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-A182664E-59F7-4C96-953F-406D0FB6573D" name="GUID-A182664E-59F7-4C96-953F-406D0FB6573D"></a><h4 id="SBYDB-GUID-A182664E-59F7-4C96-953F-406D0FB6573D" class="sect4"><span class="enumeration_section">10.2.3</span>在Active Data Guard实例上使用临时表</h4>
                  <div>
                     <p>您可以在Active Data Guard实例上创建全局临时表和专用临时表。</p>
                     <p>临时表包含仅在事务或会话期间存在的数据。临时表中的数据对会话是私有的。每个会话只能查看和修改自己的数据。</p>
                     <div class="infoboxnotealso" id="GUID-A182664E-59F7-4C96-953F-406D0FB6573D__GUID-BE3A3838-AF27-4C53-8B3E-6EBA5EE9F382">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="../cncpt/tables-and-table-clusters.html#CNCPT-GUID-23B23DCF-7482-4585-9C63-AC073C5DE224" target="_blank"><span><cite>Oracle数据库概念，</cite></span></a>用于描述全局临时表，私有临时表以及它们之间的差异</p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="SBYDB5426"></a><a id="SBYDB5163"></a><div class="props_rev_3"><a id="GUID-DAF341CA-69C9-497D-A50C-FDC89ED9C1D8" name="GUID-DAF341CA-69C9-497D-A50C-FDC89ED9C1D8"></a><h5 id="SBYDB-GUID-DAF341CA-69C9-497D-A50C-FDC89ED9C1D8" class="sect5"><span class="enumeration_section">10.2.3.1</span> Active Data Guard实例上的全局临时表</h5>
                     <div>
                        <p>Oracle Active Data Guard实例上的临时表允许DML和DDL操作。</p>
                        <div class="section">
                           <p class="subhead3" id="GUID-DAF341CA-69C9-497D-A50C-FDC89ED9C1D8__GUID-58E7CC53-3BAE-45BC-B72B-2B4D119DB96B">DML操作</p>
                           <p>当DML操作更改全局临时表时，更改本身不会生成重做，因为它只是一个临时表。但是为更改生成的撤消反过来会生成重做。不允许在只读数据库（例如Active Data Guard备用数据库）上生成重做。但是，Oracle Active Data Guard备用数据库上允许对全局临时表执行DML操作，因为临时撤消功能允许将撤消对全局临时表的更改存储在临时表空间中而不是撤消表空间。并且存储在临时表空间中的undo不会生成重做。</p>
                           <p>此功能通过以下方式使Oracle Data Guard受益：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>使用全局临时表存储临时数据的大多数报告应用程序可以卸载到Oracle Active Data Guard实例。</p>
                              </li>
                              <li>
                                 <p>在主数据库上启用临时撤消时，重做中不会记录撤消对全局临时表的更改，因此主数据库生成的重做次数较少。因此，Oracle Data Guard必须向备用数据库发送的重做次数也会减少，从而减少网络带宽消耗和存储消耗。</p>
                              </li>
                           </ul>
                           <p>要在主数据库上启用临时撤消，请使用<code class="codeph">TEMP_UNDO_ENABLED</code>初始化参数。在Oracle Active Data Guard备用数据库上，默认情况下始终启用临时撤消，因此<code class="codeph">TEMP_UNDO_ENABLED</code>参数无效。
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-DAF341CA-69C9-497D-A50C-FDC89ED9C1D8__GUID-D2F33C5A-30B5-4B21-9836-A0203FC2A238">限制</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>临时撤消功能要求将数据库初始化参数<code class="codeph">COMPATIBLE</code>设置为12.0.0或更高。
                                 </p>
                              </li>
                              <li>
                                 <p>Oracle Active Data Guard实例上的临时撤消功能不支持临时<code class="codeph">BLOB</code>或临时<code class="codeph">CLOB</code> 。
                                 </p>
                              </li>
                              <li>
                                 <p>如果Oracle Active Data Guard实例涉及对本地对象的更改，则不允许这些事务在Oracle Active Data Guard实例上进行。例如，您不能提交修改Oracle Active Data Guard实例上的全局临时表的事务，也不能使用数据库链接更新另一个数据库上的远程表。在发出远程DML操作之前，必须将任何未完成的DML操作提交或回滚到Active Data Guard实例上的全局临时表，反之亦然。这还包括对诸如<code class="codeph">EXPLAIN PLAN</code>语句之类的操作所做的全局临时表的隐式写入。
                                 </p>
                              </li>
                           </ul>
                           <div class="infoboxnotealso" id="GUID-DAF341CA-69C9-497D-A50C-FDC89ED9C1D8__GUID-C350D6EB-2ABB-4570-B776-39050B90966A">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=ADMIN13740" target="_blank"><span class="italic">“Oracle数据库管理员指南”</span></a> ，了解有关临时撤消的更多信息</p>
                                 </li>
                                 <li>
                                    <p>有关<code class="codeph">TEMP_UNDO_ENABLED</code>初始化参数的详细信息，请<code class="codeph">TEMP_UNDO_ENABLED</code> <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=REFRN10326" target="_blank"><span class="italic">Oracle数据库参考</span></a></p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-DAF341CA-69C9-497D-A50C-FDC89ED9C1D8__GUID-9FE9963A-4B8C-4ECA-9B85-11F6BA1BB3E4">DDL操作</p>
                           <p>可以在Active Data Guard备用数据库上创建全局临时表，也可以从中删除全局临时表。这些操作的DDL透明地重定向到主数据库。然后，Active Data Guard会话将等待，直到相应的更改发送并应用于Active Data Guard备用数据库。以下是创建全局临时表的示例：</p><pre class="pre codeblock"><code>SQL&gt; CREATE GLOBAL TEMPORARY TABLE tab2（c1 number，c2 varchar（10））ON COMMIT PRESERVE ROWS;表创建。SQL&gt;</code></pre><div class="infoboxnote" id="GUID-DAF341CA-69C9-497D-A50C-FDC89ED9C1D8__GUID-1B188DD7-8D61-40CE-871C-C02E58A7442E">
                              <p class="notep1">注意：</p>
                              <p>要使DDL重定向成功，必须使用实时应用选项启动Active Data Guard备用数据库上的受管备份恢复，并且Active Data Guard备用数据库必须与主数据库同步。</p>
                           </div>
                           <div class="infoboxnote" id="GUID-DAF341CA-69C9-497D-A50C-FDC89ED9C1D8__GUID-00B568A5-6D36-4154-813B-761B500997A7">
                              <p class="notep1">注意：</p>
                              <p>仍然可以从主数据库发出对全局临时表（例如， <code class="codeph">CREATE</code>和<code class="codeph">DROP</code> ）的数据定义语言（DDL）操作。当备份数据库赶上主数据库时，备用数据库上的DDL更改可见。
                              </p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-92A71AA4-BEEB-4C2B-B663-FC6641059E39" name="GUID-92A71AA4-BEEB-4C2B-B663-FC6641059E39"></a><h5 id="SBYDB-GUID-92A71AA4-BEEB-4C2B-B663-FC6641059E39" class="sect5"><span class="enumeration_section">10.2.3.2</span> Active Data Guard实例上的专用临时表</h5>
                     <div>
                        <p>您可以在Oracle Active Data Guard实例上创建专用临时表，即使它们是只读的。</p>
                        <p>可以在只读数据库中创建私有临时表的原因是它们的元数据存储在内存中，而不是存储在磁盘上。私有临时表的生存期仅在创建它的会话期间，并在会话结束时自动删除。此功能允许报告应用程序在Active Data Guard备用数据库上运行。</p>
                        <div class="infoboxnote" id="GUID-92A71AA4-BEEB-4C2B-B663-FC6641059E39__GUID-DB6EECEA-F094-4A91-9F0B-122F7477CFD7">
                           <p class="notep1">注意：</p>
                           <ul style="list-style-type:disc">
                              <li>有关创建专用临时表的信息，请参见<a href="../admin/managing-tables.html#ADMIN-GUID-9B373086-0760-4B18-9688-BACFF07EC74B" target="_blank"><span><cite>“Oracle数据库管理员指南”</cite></span></a></li>
                           </ul>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-9796284E-DF94-4F88-8CF6-7F966830D3AA" name="GUID-9796284E-DF94-4F88-8CF6-7F966830D3AA"></a><h4 id="SBYDB-GUID-9796284E-DF94-4F88-8CF6-7F966830D3AA" class="sect4"><span class="enumeration_section">10.2.4</span> IM列存储在Active Data Guard环境中</h4>
                  <div>
                     <p>如Oracle数据库12的<span class="italic">c</span>解除2（12.2.0.1），Oracle数据库内存中的列存储（IM列存储）被支撑在活动数据卫士（ADG）环境中的备用数据库上。
                     </p>
                     <p>在Active Data Guard备用数据库上执行的报告工作负载可以使用IM列存储。使用IM列存储可以提高工作负载的执行性能，因为它可以充分利用内存中压缩列式格式的数据访问。此外，可以在主数据库和备用数据库上的IM列存储中填充完全不同的数据集，从而有效地使应用程序可用的IM列存储的大小加倍。要使用多实例重做应用启用IM列存储支持，请将初始化参数<code class="codeph">enable_imc_with_mira</code>设置为TRUE。</p>
                     <p>请注意以下限制：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>仅基于在主数据库上执行的查询捕获内存中表达式。</p>
                        </li>
                        <li>
                           <p>基于访问标准的内存中信息生命周期管理（ILM）策略仅基于主数据库上记录的访问来触发。</p>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-9796284E-DF94-4F88-8CF6-7F966830D3AA__GUID-B2C9D607-EEEC-40A1-8461-1B4C7377BC16">
                        <p class="notep1">注意：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>ADG环境中的备用数据库不支持In-Memory FastStart。</p>
                           </li>
                           <li>
                              <p>ADG环境中的备用数据库不支持内存中的加入组。</p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>相关话题</strong></p>
                        <ul>
                           <li><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=INMEM-GUID-1B891BD1-66E8-40CD-BCE0-C3532FC36222" target="_blank"><span><cite>Oracle数据库内存指南</cite></span></a></li>
                           <li><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=REFRN-GUID-124E6841-C552-4DA8-96D4-83CE16B6B6AB" target="_blank"><span><cite>Oracle数据库参考</cite></span></a></li>
                        </ul>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-37A7C87D-61C3-4C8C-A592-1C5B42BE021A" name="GUID-37A7C87D-61C3-4C8C-A592-1C5B42BE021A"></a><h4 id="SBYDB-GUID-37A7C87D-61C3-4C8C-A592-1C5B42BE021A" class="sect4"><span class="enumeration_section">10.2.5</span> Active Data Guard环境中的内存外部表</h4>
                  <div>
                     <p>Oracle Active Data Guard支持内存外部表。</p>
                     <p></p>
                     <p>主数据库和备用数据库中的内存外部表是并行加载的。在Active Data Guard环境中运行的查询使用具有并行查询的内存中外部表段。使用<code class="codeph">INMEMORY</code>或<code class="codeph">NO INMEMORY</code>导致释放活动备用数据库上的内存中外部表段。
                     </p>
                     <div class="infoboxnote" id="GUID-37A7C87D-61C3-4C8C-A592-1C5B42BE021A__GUID-35086871-B4F6-4831-924D-29C80EF5577E">
                        <p class="notep1">注意：</p>
                        <p>使用<code class="codeph">INMEMORY...的<code class="codeph">FOR SERVICE</code>子条款<code class="codeph">INMEMORY...在主数据库，备用数据库或两者中不支持在IM列存储中填充<code class="codeph">INMEMORY</code>对象时的DISTRIBUTE</code>子句。
                        </p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-37A7C87D-61C3-4C8C-A592-1C5B42BE021A__GUID-2434019F-8802-4495-BB82-21AAF3BC9321">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=INMEM-GUID-37E2E218-33A2-490E-891D-B627906DE16B#GUID-37E2E218-33A2-490E-891D-B627906DE16B" target="_blank"><span><cite>Oracle数据库内存指南</cite></span></a></p>
                     </div>
                  </div>
               </div><a id="SBYDB5427"></a><a id="SBYDB5166"></a><a id="SBYDB5164"></a><div class="props_rev_3"><a id="GUID-DFDC929C-7446-413B-A25B-7F11284D900F" name="GUID-DFDC929C-7446-413B-A25B-7F11284D900F"></a><h4 id="SBYDB-GUID-DFDC929C-7446-413B-A25B-7F11284D900F" class="sect4"><span class="enumeration_section">10.2.6</span>在Oracle Active Data Guard中使用序列</h4>
                  <div>
                     <p>在Oracle Active Data Guard环境中，也可以从备用数据库访问由主数据库创建的具有默认<code class="codeph">CACHE</code>和<code class="codeph">NOORDER</code>选项的序列。
                     </p>
                     <div class="section">
                        <p>当备用数据库第一次访问这样的序列时，它请求主数据库分配一系列序列号。范围基于创建序列时指定的高速缓存大小和其他序列属性。然后，主数据库通过调整数据字典中的相应序列条目，将这些序列号分配给请求备用数据库。当备用数据库使用了该范围内的所有数字时，它会请求另一个数字范围。</p>
                        <p>主数据库确保来自备用数据库的每个范围请求都获得一系列序列号，这些序列号与先前为主数据库和备用数据库分配的序列号不重叠。这会在整个Oracle Data Guard配置中生成唯一的序列号流。</p>
                        <p>由于备用数据库对一系列序列的请求涉及到主数据包的往返，因此在创建要在Oracle Active Data Guard备用数据库上使用的序列时，请确保为<code class="codeph">CACHE</code>关键字指定足够大的值。否则，性能可能会受到影响
                        </p>
                        <p>此外，请确保终端备用数据库已定义<code class="codeph">LOG_ARCHIVE_DEST_</code> <span class="italic"><code class="codeph">n</code></span>参数，该参数指向主数据库。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-DFDC929C-7446-413B-A25B-7F11284D900F__GUID-0950CBDF-EA36-442A-B27E-DA085114D354">示例：在多备用配置中分配一系列序列值</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>此示例显示了如何在第一次引用序列上的<code class="codeph">NEXTVAL</code>时或在它用完所有先前分配的序列值后，可以将一系列序列值分配给数据库。在此示例中，有两个备用数据库。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>在主数据库上，发出以下SQL语句以创建名为<code class="codeph">gtt</code>的全局临时表，以及名为<code class="codeph">g</code>且缓存大小为10的序列：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; CREATE GLOBAL TEMPORARY TABLE gtt（一个int）;表创建。SQL&gt; CREATE SEQUENCE g CACHE 10;顺序创建。
</pre></div>
                        </li>
                        <li class="stepexpand"><span>在第一个备用数据库上，发出以下SQL语句：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; INSERT INTO gtt VALUES（g。NEXTVAL）;已创建1行。SQL&gt; INSERT INTO gtt VALUES（g。NEXTVAL）;已创建1行。SQL&gt; SELECT * FROM gtt; A ---------- 1 2</pre><p>因为序列高速缓存大小设置为10（在步骤1中）并且因为这是第一次访问序列，所以<code class="codeph">SELECT</code>语句的结果显示第一个备用数据库被分配了序列号1到10。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>在主数据库上，发出以下SQL语句：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT g。NEXTVAL来自双重; NEXTVAL ---------- 11 SQL&gt; SELECT g。NEXTVAL来自双重; NEXTVAL ---------- 12</pre><p><code class="codeph">SELECT</code>语句的结果显示主数据库被分配了下一个序列值范围11-20。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>在第二个备用数据库上，发出以下SQL语句：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; INSERT INTO gtt VALUES（g。NEXTVAL）;已创建1行。SQL&gt; INSERT INTO gtt VALUES（g。NEXTVAL）;已创建1行。SQL&gt; SELECT * FROM gtt; A ---------- 21 22</pre><p><code class="codeph">SELECT</code>语句的结果显示第二个备用数据库被分配了下一个序列值范围21-30。
                              </p>
                              <div class="infoboxnote" id="GUID-DFDC929C-7446-413B-A25B-7F11284D900F__GUID-F133EE4A-28A9-4E00-9A1C-293F1396C0EA">
                                 <p class="notep1">注意：</p>在Oracle Active Data Guard备用数据库上无法访问使用<code class="codeph">ORDER</code>或<code class="codeph">NOCACHE</code>选项创建的序列。
                              </div>
                           </div>
                        </li>
                     </ol>
                  </div><a id="SBYDB5169"></a><a id="SBYDB5428"></a><a id="SBYDB5168"></a><div class="props_rev_3"><a id="GUID-8A73B0A3-D77D-4CF6-ABCB-6293BB26B6D1" name="GUID-8A73B0A3-D77D-4CF6-ABCB-6293BB26B6D1"></a><h5 id="SBYDB-GUID-8A73B0A3-D77D-4CF6-ABCB-6293BB26B6D1" class="sect5"><span class="enumeration_section">10.2.6.1</span>会话序列</h5>
                     <div>
                        <p>会话序列是一种特殊类型的序列，专门设计用于具有会话可见性的全局临时表。</p>
                        <div class="section">
                           <p>与现有的常规序列（为了进行比较而称为“全局”序列）不同，会话序列仅在会话内返回唯一的序列号范围，而不是跨会话。另一个区别是会话序列不是持久的。如果会话消失，则会话期间访问的会话序列的状态也会消失。</p>
                           <p>会话序列支持定义序列时指定的大多数序列属性。但是， <code class="codeph">CACHE</code> / <code class="codeph">NOCACHE</code>和<code class="codeph">ORDER</code> / <code class="codeph">NOORDER</code>选项与会话序列无关并被忽略。
                           </p>
                           <p>会话序列必须由读/写数据库创建，但可以在任何读/写或只读数据库（常规数据库临时打开只读或备用数据库）上访问。</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-8A73B0A3-D77D-4CF6-ABCB-6293BB26B6D1__GUID-95A4E004-A2E4-4452-A5A2-93184EC5D6D6">创建和更改会话序列</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>要创建会话序列，请发出以下SQL语句：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; CREATE SEQUENCE ... SESSION;</pre><p>要将现有会话序列更改为常规（“全局”）序列，请发出以下SQL语句：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER SEQUENCE ... GLOBAL;</pre><p>要将常规序列更改为会话序列，请发出以下SQL语句：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER SEQUENCE ... SESSION;</pre></div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-8A73B0A3-D77D-4CF6-ABCB-6293BB26B6D1__GUID-DC57A256-8345-470C-A435-06792CE0C803">示例：使用会话序列</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p>此示例显示会话序列值对每个数据库会话的唯一性。</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>在主数据库上，发出以下SQL语句以创建名为<code class="codeph">gtt</code>的全局临时表和名为<code class="codeph">s</code>的会话序列：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; CREATE GLOBAL TEMPORARY TABLE gtt（一个int）;表创建。SQL&gt; CREATE SEQUENCE s SESSION;顺序创建。
</pre></div>
                           </li>
                           <li class="stepexpand"><span>在备用数据库上，发出以下SQL语句：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; INSERT INTO gtt VALUES（s。NEXTVAL）;已创建1行。SQL&gt; INSERT INTO gtt VALUES（s。NEXTVAL）;已创建1行。SQL&gt; SELECT * FROM gtt; A ---------- 1 2</pre></div>
                           </li>
                           <li class="stepexpand"><span>从同一备用数据库的另一个会话中，发出以下SQL语句：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; INSERT INTO gtt VALUES（s。NEXTVAL）;已创建1行。SQL&gt; INSERT INTO gtt VALUES（s。NEXTVAL）;已创建1行。SQL&gt; SELECT * FROM gtt; A ---------- 1 2</pre><p><code class="codeph">SELECT</code>语句的结果显示分配的序列值与上一步中为第一个会话分配的序列值相同。这是因为序列值对于每个数据库会话都是唯一的。
                                 </p>
                              </div>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div>
            </div><a id="SBYDB5040"></a><a id="SBYDB4784"></a><div class="props_rev_3"><a id="GUID-62007456-DD41-431D-B0E7-56C99FEB2277" name="GUID-62007456-DD41-431D-B0E7-56C99FEB2277"></a><h3 id="SBYDB-GUID-62007456-DD41-431D-B0E7-56C99FEB2277" class="sect3"><span class="enumeration_section">10.3</span>需要在物理备用时手动干预的主要数据库更改</h3>
               <div>
                  <p>对主数据库进行的大多数结构更改都会自动通过重做数据传播到物理备用数据库，但是有一些更改需要手动干预。</p>
                  <div class="section">
                     <p>下表列出了需要在物理备用数据库上进行手动干预的主数据库结构和配置更改。</p>
                     <div class="tblformalwide" id="GUID-62007456-DD41-431D-B0E7-56C99FEB2277__G1041883">
                        <p class="titleintable">表10-1需要在物理备用时手动干预的主要数据库更改</p>
                        <table cellpadding="4" cellspacing="0" class="FormalWide" title="在物理待机中需要手动干预的主要数据库更改" width="100%" border="1" summary="When you change the primary database, it often requires that you take a similar action on the standby database. This 2 column table lists the administrative tasks that require you perform some action on the standby database." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="47%" id="d21041e3051">主数据库更改</th>
                                 <th align="left" valign="bottom" width="53%" id="d21041e3054">物理备用数据库所需的操作</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="47%" id="d21041e3059" headers="d21041e3051 ">
                                    <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-C60E4DB4-F424-454D-B4DF-7A97B2F09540" title="STANDBY_FILE_MANAGEMENT数据库初始化参数控制是否将数据文件添加到主数据库自动传播到物理备用数据库。">添加数据文件或创建表空间</a></p>
                                 </td>
                                 <td align="left" valign="top" width="53%" headers="d21041e3059 d21041e3054 ">
                                    <p>如果<code class="codeph">STANDBY_FILE_MANAGEMENT</code>数据库初始化参数设置为<code class="codeph">AUTO</code>则无需任何操作。如果此参数设置为<code class="codeph">MANUAL</code> ，则必须将新数据文件复制到物理备用数据库。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="47%" id="d21041e3083" headers="d21041e3051 ">
                                    <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-76C5E1AD-2A05-4BC8-AB26-5C68E2AB991D" title="删除表空间或从主数据库中删除数据文件时，必须从物理备用数据库中删除相应的数据文件。">删除表空间和删除数据文件</a></p>
                                 </td>
                                 <td align="left" valign="top" width="53%" headers="d21041e3083 d21041e3054 ">
                                    <p>将包含<code class="codeph">DROP</code>或<code class="codeph">DELETE</code>命令的重做数据应用于物理备用数据库后，从主数据库和物理备用数据库中删除数据文件。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="47%" id="d21041e3101" headers="d21041e3051 ">
                                    <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-88158C9B-51FB-4F13-93FC-97D737C86BF0" title="您可以使用Oracle可传输表空间功能移动Oracle数据库的子集并将其插入另一个Oracle数据库，从而在数据库之间移动表空间。">将可传输表空间与物理备用数据库一起使用</a></p>
                                 </td>
                                 <td align="left" valign="top" width="53%" headers="d21041e3101 d21041e3054 ">
                                    <p>在主数据库和物理备用数据库之间移动表空间。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="47%" id="d21041e3113" headers="d21041e3051 ">
                                    <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-2D3E5488-237C-467A-AB8B-7C09B6E43CE0" title="重命名主数据库中的一个或多个数据文件时，更改不会传播到备用数据库。必须手动完成。">重命名主数据库中的数据文件</a></p>
                                 </td>
                                 <td align="left" valign="top" width="53%" headers="d21041e3113 d21041e3054 ">
                                    <p>重命名物理备用数据库上的数据文件。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="47%" id="d21041e3125" headers="d21041e3051 ">
                                    <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-64E46731-490D-4228-AC87-A07CDE3C75FE" title="在主数据库上添加或删除日志文件组后，应重新评估和调整物理备用数据库上的重做日志和备用重做日志的配置。">添加或删除重做日志文件组</a></p>
                                 </td>
                                 <td align="left" valign="top" width="53%" headers="d21041e3125 d21041e3054 ">
                                    <p>评估物理备用数据库上的重做日志和备用重做日志的配置，并根据需要进行调整。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="47%" id="d21041e3137" headers="d21041e3051 ">
                                    <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-3A0E6CB4-EE5B-4D16-BCFE-40236BC312D7" title="使用NOLOGGING或UNRECOVERABLE子句执行DML或DDL操作时，备用数据库上的块可能会被标记为无效（也称为非打印块）。">NOLOGGING或不可恢复的操作</a></p>
                                 </td>
                                 <td align="left" valign="top" width="53%" headers="d21041e3137 d21041e3054 ">
                                    <p>使用RMAN命令<code class="codeph">RECOVER ...NONLOGGED BLOCK</code>用来NONLOGGED BLOCK</code>的已更改块替换备用服务器上的无效块。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="47%" id="d21041e3158" headers="d21041e3051 ">
                                    <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-FB7AFCB2-8CB3-4F43-B664-261BAFD5B07B" title="如果REMOTE_LOGIN_PASSWORDFILE数据库初始化参数设置为SHARED或EXCLUSIVE，则物理备用数据库上的密码文件将自动替换为主数据库中的新副本。">刷新密码文件</a></p>
                                 </td>
                                 <td align="left" valign="top" width="53%" headers="d21041e3158 d21041e3054 ">
                                    <p>如Oracle数据库12的<span class="italic">c</span>解除2（12.2.0.1），在主数据库上进行密码文件的变化将自动传播到备用数据库。唯一的例外是远同步实例。更新的密码文件仍必须手动复制到远程同步实例，因为远程同步实例会接收重做，但不会应用它。在远程同步实例的密码文件是最新的后，主服务器上包含密码更新的重做会自动传播到任何备用数据库，这些数据库设置为从该远程同步实例接收重做。应用重做时，备用数据库上的密码文件会更新。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="47%" id="d21041e3182" headers="d21041e3051 ">
                                    <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-B9B956BC-885F-49AF-A4FF-E900998109ED" title="每当在主数据库上重置TDE主加密密钥时，必须使用主数据库中的数据库加密钱包的新副本替换物理备用数据库上的数据库加密钱包。">重置TDE主加密密钥</a></p>
                                 </td>
                                 <td align="left" valign="top" width="53%" headers="d21041e3182 d21041e3054 ">
                                    <p>使用主数据库中的数据库加密钱包的新副本替换物理备用数据库上的数据库加密钱包。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="47%" id="d21041e3194" headers="d21041e3051 ">
                                    <p><a href="oracle-initialization-parameters-used-by-oracle-data-guard.html#GUID-A1CF9B00-F0F5-4F3B-A0E0-9D6ABF775EC9" title="这是您为Data Guard环境设置的初始化参数的字母顺序列表。它指示参数是为主角色还是备用角色设置的，还提供了设置每个参数的提示。">初始化参数</a></p>
                                 </td>
                                 <td align="left" valign="top" width="53%" headers="d21041e3194 d21041e3054 ">
                                    <p>评估是否必须对物理备用数据库上的初始化参数进行相应的更改。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
                  <!-- class="section" -->
               </div><a id="SBYDB4785"></a><div class="props_rev_3"><a id="GUID-C60E4DB4-F424-454D-B4DF-7A97B2F09540" name="GUID-C60E4DB4-F424-454D-B4DF-7A97B2F09540"></a><h4 id="SBYDB-GUID-C60E4DB4-F424-454D-B4DF-7A97B2F09540" class="sect4"><span class="enumeration_section">10.3.1</span>添加数据文件或创建表空间</h4>
                  <div>
                     <p><code class="codeph">STANDBY_FILE_MANAGEMENT</code>数据库初始化参数控制是否将数据文件添加到主数据库自动传播到物理备用数据库。
                     </p>
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>如果物理备用数据库上的<code class="codeph">STANDBY_FILE_MANAGEMENT</code>数据库参数设置为<code class="codeph">AUTO</code> ，则会在物理备用数据库上自动创建在主数据库上创建的所有新数据文件。
                              </p>
                           </li>
                           <li>
                              <p>如果物理备用数据库上的<code class="codeph">STANDBY_FILE_MANAGEMENT</code>数据库参数设置为<code class="codeph">MANUAL</code> ，则必须在将新数据文件添加到主数据库后将其从主数据库手动复制到物理备用数据库。
                              </p>
                              <div class="infoboxnote" id="GUID-C60E4DB4-F424-454D-B4DF-7A97B2F09540__GUID-DB48701A-D02D-411B-ADE6-12D6B95010D8">
                                 <p class="notep1">注意：</p>
                                 <p>在已启用Oracle Active Data Guard选项的物理备用数据库上，您无法使用手动复制方法。相反，您必须在备用数据库上执行以下SQL语句以创建空数据文件：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE CREATE DATAFILE [filename | filenumber]  -  AS [NEW | <span class="italic">new_filename</span> ];</pre><p>您必须指定要重命名的<code class="codeph">filename</code> ： <code class="codeph">filename</code>或<code class="codeph">filename</code> <code class="codeph">filenumber</code> 。
                                 </p>
                                 <p>同时指定新文件名或<code class="codeph">NEW</code> 。如果启用了Oracle Managed Files（OMF），则<code class="codeph">NEW</code>关键字允许Oracle自动选择名称。
                                 </p>
                              </div>
                           </li>
                        </ul>
                        <p>如果将来自其他数据库的现有数据文件复制到主数据库，则还必须将其复制到备用数据库，并且必须重新创建备用控制文件，而不管<code class="codeph">STANDBY_FILE_MANAGEMENT</code>参数的设置如何。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="SBYDB4788"></a><div class="props_rev_3"><a id="GUID-76C5E1AD-2A05-4BC8-AB26-5C68E2AB991D" name="GUID-76C5E1AD-2A05-4BC8-AB26-5C68E2AB991D"></a><h4 id="SBYDB-GUID-76C5E1AD-2A05-4BC8-AB26-5C68E2AB991D" class="sect4"><span class="enumeration_section">10.3.2</span>删除表空间和删除数据文件</h4>
                  <div>
                     <p>删除表空间或从主数据库中删除数据文件时，必须从物理备用数据库中删除相应的数据文件。</p>
                     <div class="section">
                        <p>以下示例显示如何删除表空间：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; DROP TABLESPACE tbs_4; SQL&gt; ALTER SYSTEM SWITCH LOGFILE;</pre><p>要验证已删除的数据文件不再是数据库的一部分，请查询<code class="codeph">V$DATAFILE</code>视图。
                        </p>
                        <p>将包含先前更改的重做数据应用于备用数据库后，删除备用系统上的相应数据文件。例如：</p><pre class="oac_no_warn" dir="ltr">％rm /disk1/oracle/oradata/payroll/s2tbs_4.dbf</pre><p>在主数据库上，确保备用数据库应用已删除表空间的重做信息后，可以删除表空间的数据文件。例如：</p><pre class="oac_no_warn" dir="ltr">％rm /disk1/oracle/oradata/payroll/tbs_4.dbf</pre></div>
                     <!-- class="section" -->
                  </div><a id="SBYDB4789"></a><div class="props_rev_3"><a id="GUID-10EE6961-A52F-4101-A911-B8692636CC37" name="GUID-10EE6961-A52F-4101-A911-B8692636CC37"></a><h5 id="SBYDB-GUID-10EE6961-A52F-4101-A911-B8692636CC37" class="sect5"><span class="enumeration_section">10.3.2.1</span>使用DROP TABLESPACE包括内容和数据文件</h5>
                     <div>
                        <p>您可以在主数据库上发出SQL <code class="codeph">DROP TABLESPACE INCLUDING CONTENTS AND DATAFILES</code>语句，以删除主数据库和备用数据库上的数据文件。
                        </p>
                        <div class="section">
                           <p>要使用此语句，必须将<code class="codeph">STANDBY_FILE_MANAGEMENT</code>初始化参数设置为<code class="codeph">AUTO</code> 。例如，要删除主站点上的表空间：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; DROP TABLESPACE tbs_4包括内容和数据文件; SQL&gt; ALTER SYSTEM SWITCH LOGFILE;</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="SBYDB4790"></a><div class="props_rev_3"><a id="GUID-88158C9B-51FB-4F13-93FC-97D737C86BF0" name="GUID-88158C9B-51FB-4F13-93FC-97D737C86BF0"></a><h4 id="SBYDB-GUID-88158C9B-51FB-4F13-93FC-97D737C86BF0" class="sect4"><span class="enumeration_section">10.3.3</span>将可传输表空间与物理备用数据库一起使用</h4>
                  <div>
                     <p>您可以使用Oracle可传输表空间功能移动Oracle数据库的子集并将其插入另一个Oracle数据库，从而在数据库之间移动表空间。</p>
                     <div class="section">
                        <p>要在使用物理备用数据库时将一组表空间移动或复制到主数据库，请执行以下步骤：</p>
                        <ol>
                           <li>
                              <p>生成可传输的表空间集，该表集空间集由正在传输的表空间集的数据文件和包含该表空间集的结构信息的导出文件组成。</p>
                           </li>
                           <li>
                              <p>传输表空间集：</p>
                              <ol type="a">
                                 <li>
                                    <p>将数据文件和导出文件复制到主数据库。</p>
                                 </li>
                                 <li>
                                    <p>将数据文件复制到备用数据库。</p>
                                 </li>
                              </ol>
                              <p>除非已配置<code class="codeph">DB_FILE_NAME_CONVERT</code>数据库初始化参数，否则数据文件在主数据库和备用数据库上必须具有相同的路径名。如果<code class="codeph">DB_FILE_NAME_CONVERT</code> <span class="italic">尚未</span>配置和数据文件的路径名不是在主数据库和备用数据库一样，发出<code class="codeph">ALTER DATABASE RENAME FILE</code>语句来重命名数据文件。在Redo Apply无法应用通过将表空间插入主数据库生成的重做之后执行此操作。在重命名数据文件之前，必须将<code class="codeph">STANDBY_FILE_MANAGEMENT</code>初始化参数设置为<code class="codeph">MANUAL</code>然后在重命名数据文件后重置为先前的值。
                              </p>
                           </li>
                           <li>
                              <p>插入表空间。</p>
                              <p>调用<a id="d21041e3667" class="indexterm-anchor"></a> Data Pump实用程序将表空间集插入主数据库。生成重做数据并在备用站点应用，以将表空间插入备用数据库。
                              </p>
                           </li>
                        </ol>
                        <p>有关可传输表空间的更多信息，请参见“ <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=ADMIN11394" target="_blank"><span class="italic">Oracle数据库管理员指南”。</span></a></p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="SBYDB4791"></a><div class="props_rev_3"><a id="GUID-2D3E5488-237C-467A-AB8B-7C09B6E43CE0" name="GUID-2D3E5488-237C-467A-AB8B-7C09B6E43CE0"></a><h4 id="SBYDB-GUID-2D3E5488-237C-467A-AB8B-7C09B6E43CE0" class="sect4"><span class="enumeration_section">10.3.4</span>重命名主数据库中的数据文件</h4>
                  <div>
                     <p>重命名主数据库中的一个或多个数据文件时，更改不会传播到备用数据库。必须手动完成。</p>
                     <div class="section">
                        <p>要在备用数据库上重命名相同的数据文件，必须在备用数据库上手动进行等效修改，因为即使<code class="codeph">STANDBY_FILE_MANAGEMENT</code>初始化参数设置为<code class="codeph">AUTO</code> ，也不会自动执行修改。</p>
                        <p>以下步骤描述如何在主数据库中重命名数据文件并手动将更改传播到备用数据库。</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>至<a id="d21041e3777" class="indexterm-anchor"></a><a id="d21041e3779" class="indexterm-anchor"></a><a id="d21041e3785" class="indexterm-anchor"></a>重命名主数据库中的数据文件，使表空间脱机：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER TABLESPACE tbs_4 OFFLINE;</pre></div>
                        </li>
                        <li class="stepexpand"><span>退出SQL提示符并发出操作系统命令（例如以下UNIX <code class="codeph">mv</code>命令）以重命名主系统上的数据文件：</span><div><pre class="oac_no_warn" dir="ltr">％mv /disk1/oracle/oradata/payroll/tbs_4.dbf /disk1/oracle/oradata/payroll/tbs_x.dbf</pre></div>
                        </li>
                        <li class="stepexpand"><span>重命名主数据库中的数据文件并使表空间重新联机：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER TABLESPACE tbs_4 RENAME DATAFILE  - &gt;'/disk1/oracle/oradata/payroll/tbs_4.dbf' - &gt; TO'/disk1/oracle/oradata/payroll/tbs_x.dbf'; SQL&gt; ALTER TABLESPACE tbs_4 ONLINE;</pre><div class="infoboxnote" id="GUID-2D3E5488-237C-467A-AB8B-7C09B6E43CE0__GUID-26370FC4-39E3-48F0-B680-D2AC913C2739">
                                 <p class="notep1">注意：</p>
                                 <p>前三个步骤的替代方法是使用<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">MOVE</code> <code class="codeph">DATAFILE</code>命令重命名数据文件。此命令允许您重命名数据文件，同时允许对数据文件进行读/写访问。足够的存储区域是移动数据文件的先决条件，因为在执行<code class="codeph">MOVE</code> <code class="codeph">DATAFILE</code>命令期间，数据库将原始数据文件和重命名的数据文件维护为两个单独的文件。有关更多信息，请参阅<a href="getting-started-with-oracle-data-guard.html#GUID-8DA7295A-53C7-4B52-9E0A-8A513640D265" title="在数据库主动访问文件时，您可以将在线数据文件的位置从一个物理文件移动到另一个物理文件。">移动在线数据文件的位置</a> 。
                                 </p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>连接到备用数据库并停止重做应用：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE RECOVER MANAGED STANDBY DATABASE CANCEL;</pre></div>
                        </li>
                        <li class="stepexpand"><span>关闭备用数据库：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; SHUTDOWN;</pre></div>
                        </li>
                        <li class="stepexpand"><span>使用操作系统命令（例如UNIX <code class="codeph">mv</code>命令）在备用站点重命名数据文件：</span><div><pre class="oac_no_warn" dir="ltr">％mv /disk1/oracle/oradata/payroll/tbs_4.dbf /disk1/oracle/oradata/payroll/tbs_x.dbf</pre></div>
                        </li>
                        <li class="stepexpand"><span>启动并挂载备用数据库：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; STARTUP MOUNT;</pre></div>
                        </li>
                        <li class="stepexpand"><span>重命名备用控制文件中的数据文件。要重命名数据文件，必须将<code class="codeph">STANDBY_FILE_MANAGEMENT</code>数据库初始化参数设置为<code class="codeph">MANUAL</code> 。然后，您可以在重命名数据文件后将参数重置为其先前的值。</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE RENAME FILE'/disk1/oracle/oradata/payroll/tbs_4.dbf' - &gt; TO'/disk1/oracle/oradata/payroll/tbs_x.dbf';</pre></div>
                        </li>
                        <li class="stepexpand"><span>在备用数据库上，重新启动重做应用：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE RECOVER MANAGED STANDBY DATABASE  - &gt;从会话断开连接;</pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <p>如果不在备用系统上重命名相应的数据文件，然后尝试刷新备用数据库控制文件，则备用数据库会尝试使用重命名的数据文件，但不会找到它。类似于以下内容的错误消息将写入警报日志：</p><pre class="oac_no_warn" dir="ltr">ORA-00283：由于错误而取消恢复会话ORA-01157：无法识别/锁定数据文件4  - 请参阅DBWR跟踪文件ORA-01110：datafile 4：'/ Disk1 / oracle /oradata / payroll / tbs_x.dbf'</pre><div class="infoboxnote" id="GUID-2D3E5488-237C-467A-AB8B-7C09B6E43CE0__GUID-A068D73D-D9CD-4007-A233-AA593CD21798">
                           <p class="notep1">注意：</p>
                           <p>步骤4-9的替代方法是使用<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">MOVE</code> <code class="codeph">DATAFILE</code>命令在备用<code class="codeph">DATABASE</code>中重命名数据文件。有关更多信息，请参阅<a href="getting-started-with-oracle-data-guard.html#GUID-8DA7295A-53C7-4B52-9E0A-8A513640D265" title="在数据库主动访问文件时，您可以将在线数据文件的位置从一个物理文件移动到另一个物理文件。">移动在线数据文件的位置</a> 。
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="SBYDB4792"></a><div class="props_rev_3"><a id="GUID-64E46731-490D-4228-AC87-A07CDE3C75FE" name="GUID-64E46731-490D-4228-AC87-A07CDE3C75FE"></a><h4 id="SBYDB-GUID-64E46731-490D-4228-AC87-A07CDE3C75FE" class="sect4"><span class="enumeration_section">10.3.5</span>添加或删除重做日志文件组</h4>
                  <div>
                     <p>在主数据库上添加或删除日志文件组后，应重新评估和调整物理备用数据库上的重做日志和备用重做日志的配置。</p>
                     <div class="section">
                        <p>执行以下步骤以在物理备用数据库上添加或删除日志文件组或备用日志文件组：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>停止重做申请。</span></li>
                        <li class="stepexpand"><span>如果<code class="codeph">STANDBY_FILE_MANAGEMENT</code>初始化参数设置为<code class="codeph">AUTO</code> ，则将值更改为<code class="codeph">MANUAL</code> 。</span></li>
                        <li class="stepexpand"><span>添加或删除日志文件组。</span><div>
                              <div class="infoboxnote" id="GUID-64E46731-490D-4228-AC87-A07CDE3C75FE__GUID-E53A3CB4-2637-495D-9674-BDC1B6BC6259">
                                 <p class="notep1">注意：</p>
                                 <p>必须始终手动清除联机日志文件组，然后才能从物理备用数据库中删除该组。例如：</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE CLEAR LOGFILE GROUP 3;</pre><p>无法从物理备用数据库中删除状态为<code class="codeph">CURRENT</code>或<code class="codeph">CLEARING_CURRENT</code>的联机日志文件组。在角色转换后，可以删除具有此状态的联机日志文件组。
                                 </p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>将<code class="codeph">STANDBY_FILE_MANAGEMENT</code>初始化参数和重做应用选项恢复为其原始状态。</span></li>
                        <li class="stepexpand"><span>重新启动重做应用。</span></li>
                     </ol>
                     <div class="section">
                        <p>在Oracle RAC环境中，请记住以下几点：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>将联机重做日志组添加到主数据库时，必须手动将联机重做日志组添加到备用数据库。它不是自动完成的。</p>
                           </li>
                           <li>
                              <p>将新的重做线程添加到主数据库时，会自动将新的重做线程添加到备用数据库。默认情况下，新线程配置有2个日志组，每个日志组100 MB。这不能更改或覆盖。</p>
                           </li>
                           <li>
                              <p>将新日志组添加到现有重做线程时，新日志组不会自动添加到其现有线程中。</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="SBYDB00206"></a><div class="props_rev_3"><a id="GUID-3A0E6CB4-EE5B-4D16-BCFE-40236BC312D7" name="GUID-3A0E6CB4-EE5B-4D16-BCFE-40236BC312D7"></a><h4 id="SBYDB-GUID-3A0E6CB4-EE5B-4D16-BCFE-40236BC312D7" class="sect4"><span class="enumeration_section">10.3.6</span>纳入或不可恢复的操作</h4>
                  <div>
                     <p>使用<code class="codeph">NOLOGGING</code>或<code class="codeph">UNRECOVERABLE</code>子句执行DML或DDL操作时，备用数据库上的块可能会被标记为无效（也称为非打印块）。
                     </p>
                     <p>有关何时以非记录方式实际执行操作的详细信息，请参阅<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=ADMIN-GUID-27E9B63B-03E4-43E5-BA59-AB0EDDDE5CE6" target="_blank">FORCE LOGGING设置的优先顺序</a> 。
                     </p>
                     <p>有关<a href="examples-of-using-oracle-data-guard.html#GUID-BD9E85AB-D812-4659-9C85-26CDFF115A8A" title="Some SQL statements allow you to specify a NOLOGGING clause so that the operation is not logged in the online redo log file.">在使用NOLOGGING子句后恢复的</a>信息，请参阅<a href="examples-of-using-oracle-data-guard.html#GUID-BD9E85AB-D812-4659-9C85-26CDFF115A8A" title="某些SQL语句允许您指定NOLOGGING子句，以便在联机重做日志文件中不记录该操作。">指定</a> <code class="codeph">NOLOGGING</code>子句后的恢复。
                     </p>
                     <p>请参见“ <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=ADMIN11096" target="_blank"><span class="italic">Oracle数据库管理员指南”。</span></a>有关指定<code class="codeph">FORCE LOGGING</code>模式的信息。
                     </p>
                  </div>
               </div><a id="SBYDB4793"></a><div class="props_rev_3"><a id="GUID-FB7AFCB2-8CB3-4F43-B664-261BAFD5B07B" name="GUID-FB7AFCB2-8CB3-4F43-B664-261BAFD5B07B"></a><h4 id="SBYDB-GUID-FB7AFCB2-8CB3-4F43-B664-261BAFD5B07B" class="sect4"><span class="enumeration_section">10.3.7</span>刷新密码文件</h4>
                  <div>
                     <p>如果<code class="codeph">REMOTE_LOGIN_PASSWORDFILE</code>数据库初始化参数设置为<code class="codeph">SHARED</code>或<code class="codeph">EXCLUSIVE</code> ，则物理备用数据库上的密码文件将自动替换为主数据库中的新副本。
                     </p>
                     <p>授予或撤消管理权限后，将替换该文件，或者更改具有管理权限的用户的密码。唯一的例外是远同步实例。更新的密码文件仍必须手动复制到远程同步实例，因为远程同步实例会接收重做，但不会应用它。在远程同步实例上手动更新密码文件时，包含来自主数据库的相同密码更改的重做会自动传播到设置为从该远程同步实例接收重做的任何备用数据库。应用重做时，备用数据库上的密码文件会更新。</p>
                  </div>
               </div><a id="SBYDB4794"></a><div class="props_rev_3"><a id="GUID-B9B956BC-885F-49AF-A4FF-E900998109ED" name="GUID-B9B956BC-885F-49AF-A4FF-E900998109ED"></a><h4 id="SBYDB-GUID-B9B956BC-885F-49AF-A4FF-E900998109ED" class="sect4"><span class="enumeration_section">10.3.8</span>重置TDE主加密密钥</h4>
                  <div>
                     <p>每当在主数据库上重置TDE主加密密钥时，必须使用主数据库中的数据库加密钱包的新副本替换物理备用数据库上的数据库加密钱包。</p>
                     <p>如果无法刷新物理备用数据库上的数据库加密钱包，则会阻止访问在主数据库上重置主加密密钥后修改的物理备用数据库上的加密列。</p>
                     <p>对于联机表空间和数据库，从Oracle Database 12 <span class="italic">c</span>第2版（12.2.0.1）开始，您可以在Oracle Data Guard环境中加密，解密和重新键入新的和现有的表空间以及现有的数据库。
                     </p>
                     <p>对于脱机表空间和数据库，从Oracle Database 12 <span class="italic">c</span>第2版（12.2.0.1）开始，您可以加密和解密新的和现有的表空间以及Oracle Data Guard环境中的现有数据库。
                     </p>
                     <p>在在线转换中，在主服务器上执行加密，解密或重新键入后，将自动执行加密，解密或重新键入。无法在备用数据库上直接执行在线加密，解密或重新键入。</p>
                     <p>在脱机转换中，必须在主数据库和备用数据库上手动执行加密或解密。脱机转换仅影响特定主数据库或备用数据库上的数据文件。主数据库和物理备用数据库都应保持相同的状态。您可以通过首先加密（或解密）备用数据库上的表空间，切换到主数据库，然后加密（或解密）主数据库上的表空间来最大限度地减少停机时间。</p>
                     <div class="infoboxnotealso" id="GUID-B9B956BC-885F-49AF-A4FF-E900998109ED__GUID-57CF9A15-CE74-449E-905D-5B351939FAA0">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=ASOAG-GUID-79072DFC-4DC6-4920-9B2A-D649123D15C7" target="_blank"><span><cite>Oracle数据库高级安全性指南</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div><a id="SBYDB4795"></a><div class="props_rev_3"><a id="GUID-02218512-31A6-461E-96B4-0B9997DCFC4A" name="GUID-02218512-31A6-461E-96B4-0B9997DCFC4A"></a><h3 id="SBYDB-GUID-02218512-31A6-461E-96B4-0B9997DCFC4A" class="sect3"><span class="enumeration_section">10.4</span>通过OPEN RESETLOGS声明恢复</h3>
               <div>
                  <p>在使用<code class="codeph">RESETLOGS</code>选项打开主数据库之后，Oracle Data Guard允许在物理备用数据库上进行恢复。
                  </p>
                  <p>在主数据库上发出<code class="codeph">ALTER DATABASE OPEN RESETLOGS</code>语句时，数据库的变化会发生变化，从而创建重做数据的新分支。
                  </p>
                  <p>当物理备用数据库收到重做数据的新分支时，Redo Apply会自动获取重做数据的新分支。对于物理备用数据库，如果备用数据库未通过新的重置日志SCN（超过重做数据的新分支的开始）应用重做数据，则不需要手动干预。下表描述了如何将备用数据库与主数据库分支重新同步。</p>
                  <div class="tblformalwide" id="GUID-02218512-31A6-461E-96B4-0B9997DCFC4A__GUID-27F52F1F-0D19-408D-AB18-716276A768A9">
                     <table cellpadding="4" cellspacing="0" class="FormalWide" title="" width="100%" border="1" summary="This 3 column table describes how to resynchronize the standby database with the primary database branch. Each row of the table provides a solution that is dependent upon how much redo data the standby database has applied and whether or not Flashback Database is enabled." frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="34%" id="d21041e4514">如果是备用数据库。 。 。</th>
                              <th align="left" valign="bottom" width="32%" id="d21041e4517">然后。 。 。</th>
                              <th align="left" valign="bottom" width="34%" id="d21041e4520">执行这些步骤。 。 。</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="34%" id="d21041e4525" headers="d21041e4514 ">
                                 <p>尚未将重做数据应用于新的重置日志SCN（超过重做数据的新分支的开始），并且<code class="codeph">OPEN RESETLOGS</code>的新重做分支已在备用数据库中注册</p>
                              </td>
                              <td align="left" valign="top" width="32%" headers="d21041e4525 d21041e4517 ">
                                 <p>重做应用自动采用重做的新分支。</p>
                              </td>
                              <td align="left" valign="top" width="34%" headers="d21041e4525 d21041e4520 ">
                                 <p>无需人工干预。托管重做进程（MRP）自动将备用数据库与重做数据的新分支重新同步。</p>
                                 <p>注意：要检查新的重做分支是否已在备用数据库中注册，请在主服务器和备用服务器上执行以下查询，并验证结果是否匹配：</p><pre class="oac_no_warn" dir="ltr">SELECT resetlogs_id，resetlogs_change＃FROM V $ DATABASE_INCARNATION WHERE status ='CURRENT'</pre></td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="34%" id="d21041e4542" headers="d21041e4514 ">
                                 <p>已经将重做数据应用于新的重置日志SCN（通过重做数据的新分支的开始）并且在备用数据库上启用了闪回数据库</p>
                              </td>
                              <td align="left" valign="top" width="32%" headers="d21041e4542 d21041e4517 ">
                                 <p>备用数据库将<span class="italic">在</span>重做数据的新分支<span class="italic">的未来</span>中恢复。
                                 </p>
                              </td>
                              <td align="left" valign="top" width="34%" headers="d21041e4542 d21041e4520 ">
                                 <ol>
                                    <li>
                                       <p>按照将<a href="examples-of-using-oracle-data-guard.html#GUID-09129494-CD98-44B6-821F-A4C2CB5AEE08" title="这些步骤描述了在主数据库上发出OPEN RESETLOGS语句后如何避免重新创建物理备用数据库。">物理备用数据库闪回到特定时间点的过程，</a>以闪回物理备用数据库。
                                       </p>
                                    </li>
                                    <li>
                                       <p>重新启动重做应用以继续将重做数据应用到新的重置日志分支。</p>
                                    </li>
                                 </ol>
                                 <p>托管重做进程（MRP）自动将备用数据库与新分支重新同步。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="34%" id="d21041e4572" headers="d21041e4514 ">
                                 <p>已将重做数据应用于新的重置日志SCN（通过重做数据的新分支的开始）并且备用数据库上未启用闪回数据库</p>
                              </td>
                              <td align="left" valign="top" width="32%" headers="d21041e4572 d21041e4517 ">
                                 <p>主数据库已在指定的主数据库分支上与备用数据库分离。</p>
                              </td>
                              <td align="left" valign="top" width="34%" headers="d21041e4572 d21041e4520 ">
                                 <p>按照创建物理备用数据库中的过程重新<a href="creating-oracle-data-guard-physical-standby.html#GUID-B511FB6E-E3E7-436D-94B5-071C37550170" title="您可以使用异步重做传输和实时应用（默认的Oracle Data Guard配置）以最高性能模式手动创建物理备用数据库。">创建物理备用数据库</a> 。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="34%" id="d21041e4589" headers="d21041e4514 ">
                                 <p>缺少重做数据的新分支中介入的归档重做日志文件</p>
                              </td>
                              <td align="left" valign="top" width="32%" headers="d21041e4589 d21041e4517 ">
                                 <p>在检索到丢失的日志文件之前，MRP无法继续。</p>
                              </td>
                              <td align="left" valign="top" width="34%" headers="d21041e4589 d21041e4520 ">
                                 <p>从每个分支中找到并注册缺少的归档重做日志文件。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="34%" id="d21041e4599" headers="d21041e4514 ">
                                 <p>缺少从上一个重做数据分支末尾的归档重做日志文件。</p>
                              </td>
                              <td align="left" valign="top" width="32%" headers="d21041e4599 d21041e4517 ">
                                 <p>在检索到丢失的日志文件之前，MRP无法继续。</p>
                              </td>
                              <td align="left" valign="top" width="34%" headers="d21041e4599 d21041e4520 ">
                                 <p>从上一个分支中找到并注册缺少的归档重做日志文件。</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <p>有关数据库化身，通过<code class="codeph">OPEN RESETLOGS</code>操作进行恢复以及闪回数据库的详细信息，请参阅“ <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=BRADV89752" target="_blank"><span class="italic">Oracle数据库备份和恢复用户指南”</span></a> 。
                  </p>
               </div>
            </div>
            <div class="sect2"><a id="GUID-252097AC-3070-43B6-88D8-919AE27F97AD" name="GUID-252097AC-3070-43B6-88D8-919AE27F97AD"></a><h3 id="SBYDB-GUID-252097AC-3070-43B6-88D8-919AE27F97AD" class="sect3"><span class="enumeration_section">10.5</span>主RESETLOGS操作后自动闪回备用备用</h3>
               <div>
                  <p>处于挂载状态的备用数据库可以在主数据库上执行<code class="codeph">RESETLOGS</code>操作后自动跟随主数据库。这在主服务器上执行<code class="codeph">RESETLOGS</code>操作后简化了备用管理。
                  </p>
                  <p></p>
                  <p>在主数据库或主数据库中的PDB上执行闪回或时间点恢复时，主数据库或PDB将移至先前的时间点，然后使用<code class="codeph">RESETLOGS</code>选项打开主数据库。创建主要的初始化身或初级PDB。要使备用数据库自动跟随主数据库，MRP将执行以下操作：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>检测新的化身</p>
                     </li>
                     <li>
                        <p>将备用数据库或备用数据库上的PDB闪回到与主数据库或主数据库上的PDB相同的时间点</p>
                     </li>
                     <li>
                        <p>重新启动备用恢复并将备用数据库移动到重做的新分支</p>
                     </li>
                  </ul>
                  <p>仅当备用数据库具有足够的闪回数据时，闪回操作才会成功。</p>
                  <p>如果您不希望备用数据库自动跟随主数据库，请将备用数据库保持在<code class="codeph">OPEN</code>模式或停止备用数据库上的MRP进程。
                  </p>
                  <p>如果备用数据库以只读模式打开，则相应的错误消息将记录在警报日志中。关闭物理备用数据库后重新启动MRP时，恢复过程会自动闪回备用数据库并继续应用重做的新分支。</p>
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>相关话题</strong></p>
                     <ul>
                        <li><a href="examples-of-using-oracle-data-guard.html#GUID-8D948A24-A3B7-4E4F-917A-00B047CF3CAF" title="在主服务器上执行PDB PITR或PDB闪回后，您可以还原PDB或闪回备用服务器上的PDB以使备用服务器跟随主服务器。">主PDB上的PDB PITR或PDB闪回后待机所需的操作</a></li>
                        <li><a href="examples-of-using-oracle-data-guard.html#GUID-09129494-CD98-44B6-821F-A4C2CB5AEE08" title="这些步骤描述了在主数据库上发出OPEN RESETLOGS语句后如何避免重新创建物理备用数据库。">将物理备用数据库闪回到特定时间点</a></li>
                     </ul>
                  </div>
               </div>
            </div><a id="SBYDB5041"></a><a id="SBYDB00710"></a><div class="props_rev_3"><a id="GUID-0682EE24-B495-48E8-9E1F-52AC0E6FE486" name="GUID-0682EE24-B495-48E8-9E1F-52AC0E6FE486"></a><h3 id="SBYDB-GUID-0682EE24-B495-48E8-9E1F-52AC0E6FE486" class="sect3"><span class="enumeration_section">10.6</span>监控主备用，物理备用和快照备用数据库</h3>
               <div>
                  <p>此表汇总了常见的主数据库管理操作以及在何处查找与这些操作相关的信息。</p>
                  <div class="tblformalwide" id="GUID-0682EE24-B495-48E8-9E1F-52AC0E6FE486__G1041815">
                     <p class="titleintable">表10-2有关公共主数据库管理操作的信息源</p>
                     <table cellpadding="4" cellspacing="0" class="FormalWide" title="有关常见主数据库管理操作的信息来源" width="100%" border="1" summary="This 3 column table summarizes the common events that occur on the primary database and pointers to the files and view where you can monitor these events on the primary and standby sites." frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="35%" id="d21041e4835">主要数据库操作</th>
                              <th align="left" valign="bottom" width="32%" id="d21041e4838">主要站点信息</th>
                              <th align="left" valign="bottom" width="33%" id="d21041e4841">备用站点信息</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="35%" id="d21041e4846" headers="d21041e4835 ">
                                 <p>启用或禁用重做线程</p>
                              </td>
                              <td align="left" valign="top" width="32%" headers="d21041e4846 d21041e4838 ">
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>警报日志</p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">V $ THREAD</code></p>
                                    </li>
                                 </ul>
                              </td>
                              <td align="left" valign="top" width="33%" headers="d21041e4846 d21041e4841 ">
                                 <p>警报日志</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="35%" id="d21041e4862" headers="d21041e4835 ">
                                 <p>显示数据库角色，保护模式，保护级别，切换状态，快速启动故障切换<a id="d21041e4865" class="indexterm-anchor"></a><a id="d21041e4869" class="indexterm-anchor"></a><a id="d21041e4873" class="indexterm-anchor"></a><a id="d21041e4877" class="indexterm-anchor"></a><a id="d21041e4881" class="indexterm-anchor"></a>信息，等等</p>
                              </td>
                              <td align="left" valign="top" width="32%" headers="d21041e4862 d21041e4838 ">
                                 <p><code class="codeph">V $ DATABASE</code></p>
                              </td>
                              <td align="left" valign="top" width="33%" headers="d21041e4862 d21041e4841 ">
                                 <p><code class="codeph">V $ DATABASE</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="35%" id="d21041e4895" headers="d21041e4835 ">
                                 <p>添加或删除重做日志文件组</p>
                              </td>
                              <td align="left" valign="top" width="32%" headers="d21041e4895 d21041e4838 ">
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>警报日志</p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">V $ LOG</code> 
                                       </p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">V$LOGFILE</code> <code class="codeph">STATUS</code>列</p>
                                    </li>
                                 </ul>
                              </td>
                              <td align="left" valign="top" width="33%" headers="d21041e4895 d21041e4841 ">
                                 <p>警报日志</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="35%" id="d21041e4919" headers="d21041e4835 ">
                                 <p><code class="codeph">创建CONTROLFILE</code></p>
                              </td>
                              <td align="left" valign="top" width="32%" headers="d21041e4919 d21041e4838 ">
                                 <p>警报日志</p>
                              </td>
                              <td align="left" valign="top" width="33%" headers="d21041e4919 d21041e4841 ">
                                 <p>警报日志</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="35%" id="d21041e4930" headers="d21041e4835 ">
                                 <p>监控重做申请</p>
                              </td>
                              <td align="left" valign="top" width="32%" headers="d21041e4930 d21041e4838 ">
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>警报日志</p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">V $ ARCHIVE_DEST_STATUS</code></p>
                                    </li>
                                 </ul>
                              </td>
                              <td align="left" valign="top" width="33%" headers="d21041e4930 d21041e4841 ">
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>警报日志</p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">V $ ARCHIVED_LOG</code></p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">V $ LOG_HISTORY</code></p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">V $ MANAGED_STANDBY</code></p>
                                    </li>
                                 </ul>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="35%" id="d21041e4960" headers="d21041e4835 ">
                                 <p><a id="d21041e4962" class="indexterm-anchor"></a><a id="d21041e4966" class="indexterm-anchor"></a><a id="d21041e4970" class="indexterm-anchor"></a>更改表空间状态</p>
                              </td>
                              <td align="left" valign="top" width="32%" headers="d21041e4960 d21041e4838 ">
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><code class="codeph">V $ RECOVER_FILE</code></p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">DBA_TABLESPACES</code></p>
                                    </li>
                                    <li>
                                       <p>警报日志</p>
                                    </li>
                                 </ul>
                              </td>
                              <td align="left" valign="top" width="33%" headers="d21041e4960 d21041e4841 ">
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><code class="codeph">V $ RECOVER_FILE</code></p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">DBA_TABLESPACES</code></p>
                                    </li>
                                 </ul>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="35%" id="d21041e4997" headers="d21041e4835 ">
                                 <p><a id="d21041e4999" class="indexterm-anchor"></a>添加或删除数据文件或表空间</p>
                              </td>
                              <td align="left" valign="top" width="32%" headers="d21041e4997 d21041e4838 ">
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><code class="codeph">DBA_DATA_FILES</code> 
                                       </p>
                                    </li>
                                    <li>
                                       <p>警报日志</p>
                                    </li>
                                 </ul>
                              </td>
                              <td align="left" valign="top" width="33%" headers="d21041e4997 d21041e4841 ">
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><code class="codeph">V $ DATAFILE</code></p>
                                    </li>
                                    <li>
                                       <p>警报日志</p>
                                    </li>
                                 </ul>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="35%" id="d21041e5024" headers="d21041e4835 ">
                                 <p>重命名数据文件</p>
                              </td>
                              <td align="left" valign="top" width="32%" headers="d21041e5024 d21041e4838 ">
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><code class="codeph">V $ DATAFILE</code></p>
                                    </li>
                                    <li>
                                       <p>警报日志</p>
                                    </li>
                                 </ul>
                              </td>
                              <td align="left" valign="top" width="33%" headers="d21041e5024 d21041e4841 ">
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><code class="codeph">V $ DATAFILE</code></p>
                                    </li>
                                    <li>
                                       <p>警报日志</p>
                                    </li>
                                 </ul>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="35%" id="d21041e5046" headers="d21041e4835 ">
                                 <p>未记录或不可恢复的操作</p>
                              </td>
                              <td align="left" valign="top" width="32%" headers="d21041e5046 d21041e4838 ">
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><code class="codeph">V $ DATAFILE</code></p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">V $ DATABASE</code> 
                                       </p>
                                    </li>
                                 </ul>
                              </td>
                              <td align="left" valign="top" width="33%" headers="d21041e5046 d21041e4841 ">
                                 <p>警报日志</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="35%" id="d21041e5064" headers="d21041e4835 ">
                                 <p>监控重做传输</p>
                              </td>
                              <td align="left" valign="top" width="32%" headers="d21041e5064 d21041e4838 ">
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><code class="codeph">V $ ARCHIVE_DEST_STATUS</code> 
                                       </p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">V $ ARCHIVED_LOG</code></p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">V $ ARCHIVE_DEST</code></p>
                                    </li>
                                    <li>
                                       <p>警报日志</p>
                                    </li>
                                 </ul>
                              </td>
                              <td align="left" valign="top" width="33%" headers="d21041e5064 d21041e4841 ">
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><code class="codeph">V $ ARCHIVED_LOG</code></p>
                                    </li>
                                    <li>
                                       <p>警报日志</p>
                                    </li>
                                 </ul>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="35%" id="d21041e5095" headers="d21041e4835 ">
                                 <p>发出<code class="codeph">OPEN RESETLOGS</code>或<code class="codeph">CLEAR UNARCHIVED LOGFILES</code>语句</p>
                              </td>
                              <td align="left" valign="top" width="32%" headers="d21041e5095 d21041e4838 ">
                                 <p>警报日志</p>
                              </td>
                              <td align="left" valign="top" width="33%" headers="d21041e5095 d21041e4841 ">
                                 <p>警报日志</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="35%" id="d21041e5112" headers="d21041e4835 ">
                                 <p>更改初始化参数</p>
                              </td>
                              <td align="left" valign="top" width="32%" headers="d21041e5112 d21041e4838 ">
                                 <p>警报日志</p>
                              </td>
                              <td align="left" valign="top" width="33%" headers="d21041e5112 d21041e4841 ">
                                 <p>警报日志</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
               </div><a id="SBYDB00555"></a><div class="props_rev_3"><a id="GUID-567E9883-B1BE-431D-86E9-872BAB6A899F" name="GUID-567E9883-B1BE-431D-86E9-872BAB6A899F"></a><h4 id="SBYDB-GUID-567E9883-B1BE-431D-86E9-872BAB6A899F" class="sect4"><span class="enumeration_section">10.6.1</span>使用视图监控主，物理和快照备用数据库</h4>
                  <div>
                     <p>您可以使用动态性能视图来监视主数据库，物理备用数据库和快照备用数据库。</p>
                     <p></p>
                     <p>讨论了以下动态性能视图：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-BCAA4A5D-8A26-434D-B2E9-291BF7FC147D" title="您可以使用V $ DATABASE视图显示有关数据保护，切换状态和快速启动故障切换状态的信息。">V $ DATABASE</a></p>
                        </li>
                        <li>
                           <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-31B49D22-414F-4802-9A48-8D8C55CD8CB6" title="您可以使用V $ MANAGED_STANDBY视图查询物理备用数据库上的重做应用和重做传输状态。">V $ MANAGED_STANDBY</a></p>
                        </li>
                        <li>
                           <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-E97EB4D8-48E0-4355-A878-9CA3E80C0AE8" title="您可以使用V $ ARCHIVED_LOG视图查询有关物理或快照备用数据库从主数据库接收的归档重做日志文件的信息。">V $ ARCHIVED_LOG</a></p>
                        </li>
                        <li>
                           <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-6FF2CE1A-C0D8-4821-BF75-B219F9AA283A" title="您可以使用V $ LOG_HISTORY视图查询存档的日志历史信息。">V $ LOG_HISTORY</a></p>
                        </li>
                        <li>
                           <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-F60AAF04-10FE-4568-BA5E-792D150FEA28" title="您可以使用V $ DATAGUARD_STATUS视图显示由Oracle Data Guard事件生成的消息，这些消息会将消息写入警报日志或服务器进程跟踪文件。">V $ DATAGUARD_STATUS</a> 
                           </p>
                        </li>
                        <li>
                           <p><a href="managing-oracle-data-guard-physical-standby-databases.html#GUID-0DA8663E-65C4-47EB-8D47-4712F8201646" title="您可以查询V $ ARCHIVE_DEST视图以显示每个重做传输目标的状态，以及作为备用数据库的重做传输目标，查询在该备用数据库上应用的最后一个主数据库重做的SCN。">V $ ARCHIVE_DEST</a></p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-567E9883-B1BE-431D-86E9-872BAB6A899F__GUID-3E3D74E6-09CE-4E23-A3F6-E79BD9A8CB73">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=REFRN003" target="_blank"><span class="italic">Oracle数据库参考</span></a>有关视图的完整参考信息</p>
                     </div>
                  </div><a id="SBYDB4796"></a><div class="props_rev_3"><a id="GUID-BCAA4A5D-8A26-434D-B2E9-291BF7FC147D" name="GUID-BCAA4A5D-8A26-434D-B2E9-291BF7FC147D"></a><h5 id="SBYDB-GUID-BCAA4A5D-8A26-434D-B2E9-291BF7FC147D" class="sect5"><span class="enumeration_section">10.6.1.1</span> V $ DATABASE</h5>
                     <div>
                        <p>您可以使用<code class="codeph">V$DATABASE</code>视图显示有关数据保护，切换状态和快速启动故障切换状态的信息。
                        </p>
                        <div class="section">
                           <p>以下查询显示主，物理备用数据库或快照备用数据库的数据保护模式，数据保护级别，数据库角色和切换状态：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT PROTECTION_MODE，PROTECTION_LEVEL， - &gt; DATABASE_ROLE ROLE，SWITCHOVER_STATUS  - &gt; FROM V $ DATABASE;</pre><p>以下查询显示快速启动故障转移状态：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT FS_FAILOVER_STATUS“FSFO STATUS”， - &gt; FS_FAILOVER_CURRENT_TARGET TARGET， - &gt; FS_FAILOVER_THRESHOLD THRESHOLD， - &gt; FS_FAILOVER_OBSERVER_PRESENT“OBSERVER PRESENT” - &gt; FROM V $ DATABASE;</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-3B82374E-5646-4029-8AD3-94BAE5FCB17D" name="GUID-3B82374E-5646-4029-8AD3-94BAE5FCB17D"></a><h5 id="SBYDB-GUID-3B82374E-5646-4029-8AD3-94BAE5FCB17D" class="sect5"><span class="enumeration_section">10.6.1.2</span> V $ DATAGUARD_PROCESS</h5>
                     <div>
                        <p><code class="codeph">V$DATAGUARD_PROCESS</code>视图为当前正在运行的每个Oracle Data Guard进程显示一行。
                        </p>
                        <div class="section">
                           <p><code class="codeph">V$DATAGUARD_PROCESS</code>视图替换了自Oracle Database 12 <span class="italic">c</span>第2版（12.2.0.1）以来不推荐使用的<code class="codeph">V$MANAGED_STANDBY</code>视图，并且可能在将来的版本中被取消支持。
                           </p>
                           <p>以下是此视图的示例查询：</p><pre class="pre codeblock"><code>SQL&gt; SELECT ROLE，THREAD＃，SEQUENCE＃，来自V $ DATAGUARD_PROCESS的行动;角色＃SEQUENCE＃ACTION ------------------------ ---------- ---------- ------------ RFS ping 1 9 IDLE恢复应用slave 0 0 IDLE恢复应用slave 0 0 IDLE managed recovery 0 0 IDLE recovery logmerger 1 9 APPLYING_LOG RFS archive 0 0 IDLE RFS async 1 9 IDLE</code></pre></div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="SBYDB4797"></a><div class="props_rev_3"><a id="GUID-31B49D22-414F-4802-9A48-8D8C55CD8CB6" name="GUID-31B49D22-414F-4802-9A48-8D8C55CD8CB6"></a><h5 id="SBYDB-GUID-31B49D22-414F-4802-9A48-8D8C55CD8CB6" class="sect5"><span class="enumeration_section">10.6.1.3</span> V $ MANAGED_STANDBY</h5>
                     <div>
                        <p>您可以使用<code class="codeph">V$MANAGED_STANDBY</code>视图查询物理备用数据库上的重做应用和重做传输状态。
                        </p>
                        <div class="section">
                           <div class="infoboxnote" id="GUID-31B49D22-414F-4802-9A48-8D8C55CD8CB6__GUID-B0B998B8-1652-41E3-A45D-8694F2AE5279">
                              <p class="notep1">注意：</p>从Oracle Database 12 <span class="italic">c</span>第2版（12.2.0.1）开始，不推荐使用此视图，并且可能在将来的版本中不支持该视图。应该使用<code class="codeph">V$DATAGUARD_PROCESS</code>视图。
                           </div>
                           <p>以下是<code class="codeph">V$MANAGED_STANDBY</code>视图的示例查询：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT PROCESS，STATUS，THREAD＃，SEQUENCE＃， - &gt; BLOCK＃，BLOCKS FROM V $ MANAGED_STANDBY; PROCESS STATUS THREAD＃SEQUENCE＃BLOCK＃BLOCKS ------- ------------ ---------- ----------- -------- ---------- RFS ATTACHED 1 947 72 72 MRP0 APPLYING_LOG 1 946 10 72</pre><p>示例输出显示远程文件服务器（RFS）进程已完成归档序列号为947的重做日志文件，并且Redo Apply正在主动应用序列号为946的归档重做日志文件。Redo Apply当前正在恢复72块存档重做日志文件的第10块。</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="SBYDB4798"></a><div class="props_rev_3"><a id="GUID-E97EB4D8-48E0-4355-A878-9CA3E80C0AE8" name="GUID-E97EB4D8-48E0-4355-A878-9CA3E80C0AE8"></a><h5 id="SBYDB-GUID-E97EB4D8-48E0-4355-A878-9CA3E80C0AE8" class="sect5"><span class="enumeration_section">10.6.1.4</span> V $ ARCHIVED_LOG</h5>
                     <div>
                        <p>您可以使用<code class="codeph">V$ARCHIVED_LOG</code>视图查询有关物理或快照备用数据库从主数据库接收的归档重做日志文件的信息。
                        </p>
                        <div class="section">
                           <p>例如，发出以下查询：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT THREAD＃，SEQUENCE＃，FIRST_CHANGE＃， - &gt; NEXT_CHANGE＃FROM V $ ARCHIVED_LOG; THREAD＃SEQUENCE＃FIRST_CHANGE＃NEXT_CHANGE＃---------- ---------- ------------- --------- --- 1 945 74651 74739 1 946 74739 74772 1 947 74772 74795</pre><p>示例输出显示已从主数据库接收到三个归档重做日志文件。</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="SBYDB4799"></a><div class="props_rev_3"><a id="GUID-6FF2CE1A-C0D8-4821-BF75-B219F9AA283A" name="GUID-6FF2CE1A-C0D8-4821-BF75-B219F9AA283A"></a><h5 id="SBYDB-GUID-6FF2CE1A-C0D8-4821-BF75-B219F9AA283A" class="sect5"><span class="enumeration_section">10.6.1.5</span> V $ LOG_HISTORY</h5>
                     <div>
                        <p>您可以使用<code class="codeph">V$LOG_HISTORY</code>视图查询存档的日志历史信息。
                        </p>
                        <div class="section">
                           <p>例如，发出以下查询：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT THREAD＃，SEQUENCE＃，FIRST_CHANGE＃， - &gt; NEXT_CHANGE＃FROM V $ LOG_HISTORY;</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="SBYDB4800"></a><div class="props_rev_3"><a id="GUID-F60AAF04-10FE-4568-BA5E-792D150FEA28" name="GUID-F60AAF04-10FE-4568-BA5E-792D150FEA28"></a><h5 id="SBYDB-GUID-F60AAF04-10FE-4568-BA5E-792D150FEA28" class="sect5"><span class="enumeration_section">10.6.1.6</span> V $ DATAGUARD_STATUS</h5>
                     <div>
                        <p>您可以使用<code class="codeph">V$DATAGUARD_STATUS</code>视图显示由Oracle Data Guard事件生成的消息，这些消息会将消息写入警报日志或服务器进程跟踪文件。
                        </p>
                        <div class="section">
                           <p>例如，发出以下查询：</p><pre class="oac_no_warn" dir="ltr">SQL&gt;从V $ DATAGUARD_STATUS中选择消息;</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="SBYDB5131"></a><div class="props_rev_3"><a id="GUID-0DA8663E-65C4-47EB-8D47-4712F8201646" name="GUID-0DA8663E-65C4-47EB-8D47-4712F8201646"></a><h5 id="SBYDB-GUID-0DA8663E-65C4-47EB-8D47-4712F8201646" class="sect5"><span class="enumeration_section">10.6.1.7</span> V $ ARCHIVE_DEST</h5>
                     <div>
                        <p>您可以查询<code class="codeph">V$ARCHIVE_DEST</code>视图以显示每个重做传输目标的状态，以及作为备用数据库的重做传输目标，查询在该备用数据库上应用的最后一个主数据库重做的SCN。
                        </p>
                        <div class="section">
                           <p>例如，发出以下查询：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT DEST_ID，STATUS，APPLIED_SCN来自V $ ARCHIVE_DEST WHERE TARGET ='STANDBY'; DEST_ID状态APPLIED_SCN ---------- --------- ----------- 2有效439054 3有效439054</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-45D7D60E-ED0F-4B3E-9D32-EB5394196CAF" name="GUID-45D7D60E-ED0F-4B3E-9D32-EB5394196CAF"></a><h3 id="SBYDB-GUID-45D7D60E-ED0F-4B3E-9D32-EB5394196CAF" class="sect3"><span class="enumeration_section">10.7</span>将还原点从主节点复制到备用节点</h3>
               <div>
                  <p>在主数据库上创建的还原点会自动复制到备用数据库。在备用数据库上创建的还原点称为<span class="italic">复制还原点</span> 。无论主数据库上的还原点是保证还原点还是正常还原点，相应的复制还原点始终是正常还原点。
                  </p>
                  <div class="section">
                     <p></p>
                     <p>满足以下条件时，Oracle数据库会自动将还原点从主数据库复制到备用数据库：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>主数据库和备用数据库的<code class="codeph">COMPATIBLE</code>初始化参数设置为19.0.0或更高</p>
                        </li>
                        <li>
                           <p>主数据库已打开</p>
                           <p>不复制主数据库处于装载模式时在主数据库上创建的还原点。此限制是因为通过重做复制还原点信息。</p>
                        </li>
                     </ul>
                     <p>复制还原点的命名约定使用后缀为<code class="codeph">_PRIMARY</code>的主数据库上的还原点的名称。如果备用数据库上存在具有相同名称的复制还原点，则不会创建复制还原点。例如，在主数据库上创建名为<code class="codeph">PRE_MYTBS</code>的还原点时，复制的还原点名为<code class="codeph">PRE_MYTBS_PRIMARY</code> 。删除主服务器上的还原点时，也会删除备用服务器上相应的复制还原点。
                     </p>
                     <p>托管重做进程（MRP）管理复制还原点的创建和维护。如果在MRP未运行时在主数据库上创建还原点，则在MRP启动后，这些还原点将复制到备用数据库。</p>
                     <p>要确定是否自动复制还原点，请查询<code class="codeph">V$RESTORE_POINT</code>视图。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="SBYDB00580"></a><div class="props_rev_3"><a id="GUID-EEDAC95A-828F-4117-AF57-D8ABA702D42D" name="GUID-EEDAC95A-828F-4117-AF57-D8ABA702D42D"></a><h3 id="SBYDB-GUID-EEDAC95A-828F-4117-AF57-D8ABA702D42D" class="sect3"><span class="enumeration_section">10.8</span>调整重做应用</h3>
               <div>
                  <p>Oracle白皮书可用于描述如何优化Redo Apply和介质恢复性能。</p>
                  <div class="section">
                     <p>特别是，请参阅<span class="italic">Active Data Guard 11g最佳实践（包括重做应用的最佳实践</span> ）。本文可在Oracle最高可用性架构（MAA）主页上找到：</p>
                     <p><a href="http://www.oracle.com/goto/maa" target="_blank"><code class="codeph">http://www.oracle.com/goto/maa</code></a></p>
                     <div class="infoboxnotealso" id="GUID-EEDAC95A-828F-4117-AF57-D8ABA702D42D__GUID-2E8E7259-7176-41AE-BE0D-634D21CF95F9">
                        <p class="notep1">也可以看看：</p>
                        <p>有关安装和使用备用Statspack的信息，请访问<a href="http://support.oracle.com" target="_blank"><code class="codeph">http://support.oracle.com</code></a> My Oracle Support说明454848.1，该备用Statspack可用于从物理备用数据库收集重做应用性能数据</p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-2FF52A94-828C-4BF1-A5D0-C70A05A8198A" name="GUID-2FF52A94-828C-4BF1-A5D0-C70A05A8198A"></a><h3 id="SBYDB-GUID-2FF52A94-828C-4BF1-A5D0-C70A05A8198A" class="sect3"><span class="enumeration_section">10.9</span>使用SQL Tuning Advisor在Active Data Guard环境中调整数据库</h3>
               <div>
                  <p>在Active Data Guard环境中，SQL Tuning Advisor可以调整主数据库上的备用工作负载。</p>
                  <p>使用数据库链接，您可以在一个数据库上发出SQL Tuning Advisor语句，但在不同的数据库上执行这些语句。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-2FF52A94-828C-4BF1-A5D0-C70A05A8198A__GUID-4B558346-AB4D-443C-BDC3-CA745378A8CE">调整主数据库上的备用数据库工作负载</p>
                     <p>在某些情况下，备用数据库除了具有数据保护角色外，还可以承担报告角色。备用数据库可以有自己的查询工作负载，其中一些可能需要调优。在此方案中，您通过在备用数据库上发出每个调优语句来调整备用数据库工作负载，但SQL Tuning Advisor通过使用备用数据库到主数据库链接在主数据库上执行其分析。</p>
                     <p>以下是调整主数据库上的备用数据库工作负载必须执行的任务。必须使用<code class="codeph">DBMS_SQLTUNE</code> PL / SQL包以给定的顺序在备用数据库中执行任务：</p>
                     <ol>
                        <li>
                           <p>执行<code class="codeph">DBMS_SQLTUNE.CREATE_TUNING_TASK</code>语句以从创建任务所需的主数据库中获取数据。由于备用数据库是只读数据库，因此有关该任务的数据将远程写入主数据库。此步骤中需要数据库链接参数才能写入主数据库。（数据库链接参数在后续步骤中是可选的，因为它与此步骤中创建的任务相关联。）
                           </p>
                        </li>
                        <li>
                           <p>执行<code class="codeph">DBMS_SQLTUNE.EXECUTE_TUNING_TASK</code>语句。最初，从远程主数据库获取执行任务所需的数据。执行调整分析过程以找到可能的建议。由于备用数据库是只读数据库，因此当结果可用时，它们将远程存储在主数据库中。
                           </p>
                        </li>
                        <li>
                           <p>执行<code class="codeph">DBMS_SQLTUNE.REPORT_TUNING_TASK</code>语句。构建报告所需的数据远程存储在主数据库中。数据从主数据库远程获取，并在备用数据库本地构建。
                           </p>
                        </li>
                        <li>
                           <p>执行<code class="codeph">DBMS_SQLTUNE.ACCEPT_SQL_PROFILE</code>语句。配置文件数据将写入远程主数据库，因为备用数据库是只读的。
                           </p>
                        </li>
                        <li>
                           <p>使用重做应用可在备用数据库中使用SQL配置文件。</p>
                        </li>
                     </ol>
                     <div class="infoboxnotealso" id="GUID-2FF52A94-828C-4BF1-A5D0-C70A05A8198A__ORACLEDATABASEPLSQLPACKAGESANDTYPES-306A7537">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>有关<code class="codeph">DBMS_SQLTUNE</code>包的更多信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=ARPLS-GUID-421606DC-588B-4BCD-8ED8-192F8B93C070" target="_blank"><span><cite>参见Oracle Database PL / SQL包和类型参考</cite></span></a></p>
                           </li>
                           <li>
                              <p>有关本地和远程SQL调优的详细信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/sbydb&amp;id=TGSQL-GUID-642877C5-40BE-4736-8302-17F849933038" target="_blank"><span><cite>参见“Oracle数据库SQL调优指南”</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-1E2A26E3-B0E2-4ED1-A50D-891505C86E7D" name="GUID-1E2A26E3-B0E2-4ED1-A50D-891505C86E7D"></a><h3 id="SBYDB-GUID-1E2A26E3-B0E2-4ED1-A50D-891505C86E7D" class="sect3"><span class="enumeration_section">10.10</span>使用Oracle Diagnostic Pack调整Oracle Active Data Guard Standbys</h3>
               <div>
                  <p>Oracle Diagnostic Pack可与以只读模式打开的Oracle Active Data Guard备用数据库一起使用。</p>
                  <p>这使您可以将性能数据捕获到Oracle Active Data Guard备用数据库的自动工作负载存储库（AWR），并对AWR数据运行自动数据库诊断监视器（ADDM）分析。有关如何执行这些操作的详细信息，请参见“ <a href="../tgdba/gathering-database-statistics.html#TGDBA-GUID-309C107F-DC42-4119-9904-9504E9748B84" target="_blank"><span><cite>Oracle数据库性能调整指南”</cite></span></a> 。
                  </p>
               </div>
            </div><a id="SBYDB4801"></a><div class="props_rev_3"><a id="GUID-CE30E2D6-5B53-4389-8B02-FC0F341C8C1A" name="GUID-CE30E2D6-5B53-4389-8B02-FC0F341C8C1A"></a><h3 id="SBYDB-GUID-CE30E2D6-5B53-4389-8B02-FC0F341C8C1A" class="sect3"><span class="enumeration_section">10.11</span>管理快照备用数据库</h3>
               <div>
                  <p>快照备用数据库是完全可更新的备用数据库。它从主数据库接收和归档重做数据，但不应用它。</p>
                  <p>在丢弃对快照备用数据库的所有本地更新之后，将快照备用数据库转换回物理备用数据库时，将应用从主数据库接收的重做数据。</p>
                  <p>快照备用数据库通常会随着时间的推移而偏离其主数据库，因为主数据库中的重做数据在接收时未应用。快照备用数据库的本地更新会导致其他分歧。但是，主数据库中的数据受到完全保护，因为可以随时将快照备用数据库转换回物理备用数据库，然后应用从主数据库接收的重做数据。</p>
                  <p>快照备用数据库提供与物理备用数据库类似的灾难恢复和数据保护优势。快照备用数据库最适用于具有主数据库的临时可更新快照的好处证明增加从主数据库故障中恢复的时间的情况。</p>
               </div><a id="SBYDB00708"></a><div class="props_rev_3"><a id="GUID-63245504-B67C-4DF2-B8E5-752C0A67FEE7" name="GUID-63245504-B67C-4DF2-B8E5-752C0A67FEE7"></a><h4 id="SBYDB-GUID-63245504-B67C-4DF2-B8E5-752C0A67FEE7" class="sect4"><span class="enumeration_section">10.11.1</span>将物理备用数据库转换为快照备用数据库</h4>
                  <div>
                     <p>这些步骤描述了如何将物理备用数据库转换为快照备用数据库。</p>
                     <ol>
                        <li class="stepexpand"><span>停止重做应用，如果它处于活动状态。</span></li>
                        <li class="stepexpand"><span>确保已装入数据库，但未打开。</span></li>
                        <li class="stepexpand"><span>确保已配置快速恢复区域。闪回数据库不必启用。</span></li>
                        <li class="stepexpand"><span>发出以下SQL语句以执行转换：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE CONVERT TO SNAPSHOT STANDBY;</pre></div>
                        </li>
                        <li class="stepexpand"><span>通过发出以下SQL语句以读/写模式打开快照备用数据库：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE OPEN READ WRITE;</pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnote" id="GUID-63245504-B67C-4DF2-B8E5-752C0A67FEE7__GUID-FF284DA9-3522-4C06-B43A-BC3DAEC9D610">
                           <p class="notep1">注意：</p>
                           <p>可以使用DGMGRL或Oracle Enterprise Manager云控制将Oracle Data Guard代理管理的物理备用数据库转换为快照备用数据库。有关更多详细信息，请参阅<a href="../dgbkr/examples-using-data-guard-broker-DGMGRL-utility.html#DGBKR3432" target="_blank"><span class="italic">Oracle Data Guard Broker</span></a> 。
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="SBYDB4802"></a><div class="props_rev_3"><a id="GUID-C1C48B71-88F5-4006-9CAE-0FD040888FAE" name="GUID-C1C48B71-88F5-4006-9CAE-0FD040888FAE"></a><h4 id="SBYDB-GUID-C1C48B71-88F5-4006-9CAE-0FD040888FAE" class="sect4"><span class="enumeration_section">10.11.2</span>使用快照备用数据库</h4>
                  <div>
                     <p>快照备用数据库可以在读写模式下打开，并且可以完全更新。</p>
                     <p>快照备用数据库具有以下特征：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>快照备用数据库不能成为切换或故障转移的目标。在执行角色转换之前，必须首先将快照备用数据库转换回物理备用数据库。</p>
                        </li>
                        <li>
                           <p>快照备用数据库不能是Maximum Protection Oracle Data Guard配置中的唯一备用数据库。</p>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-C1C48B71-88F5-4006-9CAE-0FD040888FAE__GUID-F3C6A814-7DDC-483D-A89D-D14D70BC5C37">
                        <p class="notep1">注意：</p>
                        <p>闪回数据库用于将快照备用数据库转换回物理备用数据库。使用闪回数据库技术无法撤消的任何操作都会阻止快照备用数据库转换回物理备用数据库。</p>
                        <p>有关闪回数据库的某些限制的信息，请参阅“ <a href="../bradv/using-flasback-database-restore-points.html#BRADV543" target="_blank"><span class="italic">Oracle数据库备份和恢复用户指南”</span></a> 。
                        </p>
                     </div>
                  </div>
               </div><a id="SBYDB4803"></a><div class="props_rev_3"><a id="GUID-36B87563-A971-43B4-8320-52BBA27EE749" name="GUID-36B87563-A971-43B4-8320-52BBA27EE749"></a><h4 id="SBYDB-GUID-36B87563-A971-43B4-8320-52BBA27EE749" class="sect4"><span class="enumeration_section">10.11.3</span>将快照备用数据库转换为物理备用数据库</h4>
                  <div>
                     <p>这些步骤描述了如何将快照备用数据库转换为物理备用数据库。</p>
                     <ol>
                        <li class="stepexpand"><span>在Oracle Real Applications Cluster（Oracle RAC）数据库上，关闭除一个实例之外的所有实例。</span></li>
                        <li class="stepexpand"><span>确保已装入数据库，但未打开。</span></li>
                        <li class="stepexpand"><span>发出以下SQL语句以执行转换：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE CONVERT TO PHYSICAL STANDBY;</pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <p>启动Redo Apply时，将自动应用数据库为快照备用数据库时收到的重做数据。</p>
                        <div class="infoboxnote" id="GUID-36B87563-A971-43B4-8320-52BBA27EE749__GUID-5BA3A087-383B-437B-8A12-B8FE1DD9CAE1">
                           <p class="notep1">注意：</p>
                           <p>快照备用数据库必须至少以读写模式打开一次，然后才能转换为物理备用数据库。</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>