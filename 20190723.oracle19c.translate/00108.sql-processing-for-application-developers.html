<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>应用程序开发人员的SQL处理</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Database Development Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Database Development Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-development-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-31T23:23:15-08:00"></meta>
      <meta name="dcterms.title" content="Database Development Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96334-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="sql-for-application-developers.html" title="Previous" type="text/html"></link>
      <link rel="next" href="sql-data-types.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="ADFNS"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="sql-for-application-developers.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="sql-data-types.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">数据库开发指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="sql-for-application-developers.html" property="item" typeof="WebPage"><span property="name">应用程序开发人员的SQL</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">应用程序开发人员的SQL处理</li>
            </ol>
            <a id="GUID-912124B7-0F39-47BD-863C-320ED61014E9" name="GUID-912124B7-0F39-47BD-863C-320ED61014E9"></a><a id="ADFNS959"></a><a id="ADFNS007"></a>
            
            <h2 id="ADFNS-GUID-912124B7-0F39-47BD-863C-320ED61014E9" class="sect2"><span class="enumeration_chapter">8</span>应用程序开发人员的SQL处理</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章解释了应用程序开发人员必须了解Oracle数据库如何处理SQL语句。</p>
               <div class="section">
                  <p class="subhead1" id="GUID-912124B7-0F39-47BD-863C-320ED61014E9__GUID-A0EB436B-091D-4B6F-B20C-06854F6059E5">话题：</p>
               </div>
               <!-- class="section" -->
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="sql-processing-for-application-developers.html#GUID-76B6885C-488A-4CF8-98CE-B6C5EEEA2AE6">SQL语句处理的描述</a></p>
                  </li>
                  <li>
                     <p><a href="sql-processing-for-application-developers.html#GUID-5C8249A4-D870-4FBA-A3F7-DCEC42DF86F8">将操作分组到事务中</a></p>
                  </li>
                  <li>
                     <p><a href="sql-processing-for-application-developers.html#GUID-78285196-33AF-45E9-BDB6-8AE38648C838">使用只读事务确保可重复读取</a></p>
                  </li>
                  <li>
                     <p><a href="sql-processing-for-application-developers.html#GUID-23991569-1E18-47E5-8549-42925C82A25A">明确锁定表</a></p>
                  </li>
                  <li>
                     <p><a href="sql-processing-for-application-developers.html#GUID-57365E45-5F85-471B-81D9-F52EA16F1E85">使用Oracle锁管理服务（用户锁）</a></p>
                  </li>
                  <li>
                     <p><a href="sql-processing-for-application-developers.html#GUID-8280E670-B337-4D6D-8BF4-861B8B3947AA">使用Serializable Transactions进行并发控制</a></p>
                  </li>
                  <li>
                     <p><a href="sql-processing-for-application-developers.html#GUID-42F52650-84EC-4D7C-B5A8-FBEFE73366C2">非阻塞和阻止DDL语句</a></p>
                  </li>
                  <li>
                     <p><a href="sql-processing-for-application-developers.html#GUID-BA46A896-4998-4E3C-ACAE-334B8716BC26">自治交易</a></p>
                  </li>
                  <li>
                     <p><a href="sql-processing-for-application-developers.html#GUID-A6585190-E64C-4799-B554-26A2B8433E26">存储分配错误后恢复执行</a></p>
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-912124B7-0F39-47BD-863C-320ED61014E9__GUID-13DE77AC-D5CC-4FA2-BAA2-22C402ABCAAE">
                  <p class="notep1">也可以看看：</p>
                  <p><a href="../cncpt/sql.html#CNCPT015" target="_blank"><span class="italic">Oracle数据库概念</span></a></p>
               </div>
            </div><a id="ADFNS1343"></a><a id="ADFNS99995"></a><div class="props_rev_3"><a id="GUID-76B6885C-488A-4CF8-98CE-B6C5EEEA2AE6" name="GUID-76B6885C-488A-4CF8-98CE-B6C5EEEA2AE6"></a><h3 id="ADFNS-GUID-76B6885C-488A-4CF8-98CE-B6C5EEEA2AE6" class="sect3">SQL语句处理的描述</h3>
               <div>
                  <p>本主题以数据操作语言（DML）语句为例，说明在处理SQL语句执行的每个阶段中发生的情况。</p>
                  <p>假设您正在使用Pro * C程序来增加部门中所有员工的工资。该程序已连接到Oracle数据库，您已连接到HR模式，该模式拥有<code class="codeph">employees</code>表。您可以在程序中嵌入此SQL语句：</p><pre class="oac_no_warn" dir="ltr">EXEC SQL UPDATE员工SET薪水= 1.10 *薪水WHERE department_id =：department_id;</pre><p>该程序为绑定变量占位符<code class="codeph">:department_id</code>提供值，SQL语句在运行时使用该值。
                  </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-76B6885C-488A-4CF8-98CE-B6C5EEEA2AE6__GUID-6E034F55-FDC9-46A6-BAF2-944BFC66DDCB">话题：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="sql-processing-for-application-developers.html#GUID-87581760-8AEF-4F72-B5F6-7584BD9AA086">SQL语句处理的阶段</a></p>
                        </li>
                        <li>
                           <p><a href="sql-processing-for-application-developers.html#GUID-CAAFBF05-4718-4096-A2BC-A98541F5DEBA">共享SQL区域</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS134"></a><div class="props_rev_3"><a id="GUID-87581760-8AEF-4F72-B5F6-7584BD9AA086" name="GUID-87581760-8AEF-4F72-B5F6-7584BD9AA086"></a><h4 id="ADFNS-GUID-87581760-8AEF-4F72-B5F6-7584BD9AA086" class="sect4">SQL语句处理的阶段</h4>
                  <div>
                     <div class="infoboxnote" id="GUID-87581760-8AEF-4F72-B5F6-7584BD9AA086__GUID-95CC19E7-A050-44C8-8640-E0864B5E6C6F">
                        <p class="notep1">注意：</p>
                        <p>DML语句使用所有阶段。事务管理，会话管理和系统管理SQL语句仅使用<code class="codeph">stage 2</code>和<code class="codeph">stage 8</code> 。
                        </p>
                     </div>
                     <ol>
                        <li>
                           <p><span class="bold">打开或创建游标。</span></p>
                           <p>程序接口调用打开或创建游标，期望SQL语句。大多数应用程序隐式（自动）创建游标。预编译器程序可以隐式或显式创建游标。</p>
                        </li>
                        <li id="GUID-87581760-8AEF-4F72-B5F6-7584BD9AA086__BEJFIGBJ">
                           <p><span class="bold">解析声明。</span></p>
                           <p>用户进程将SQL语句传递给Oracle数据库，Oracle数据库将解析后的语句表示加载到共享SQL区域。Oracle数据库可以在解析过程中捕获许多错误。</p>
                           <div class="infoboxnote" id="GUID-87581760-8AEF-4F72-B5F6-7584BD9AA086__GUID-88B2D436-B19B-4BE2-BCF5-0BF63B99DD56">
                              <p class="notep1">注意：</p>
                              <p>对于数据定义语言（DDL）语句，解析包括数据字典查找和执行。</p>
                           </div>
                        </li>
                        <li>
                           <p><span class="bold">确定该语句是否是查询。</span></p>
                        </li>
                        <li>
                           <p><span class="bold">如果该语句是查询，请描述其结果。</span></p>
                           <div class="infoboxnote" id="GUID-87581760-8AEF-4F72-B5F6-7584BD9AA086__GUID-29C7EA1F-A9E5-48E0-A7E1-B49C52408910">
                              <p class="notep1">注意：</p>
                              <p>只有当结果的特征未知时，才需要这个阶段;例如，当用户以交互方式输入查询时。</p>
                           </div>
                           <p>Oracle数据库确定结果的特征（数据类型，长度和名称）。</p>
                        </li>
                        <li>
                           <p><span class="bold">如果语句是查询，请定义其输出。</span></p>
                           <p>您可以指定为接收每个获取的值而定义的变量的位置，大小和数据类型。这些变量称为<strong class="term">定义变量</strong> 。如有必要，Oracle Database会执行数据类型转换。
                           </p>
                        </li>
                        <li>
                           <p><span class="bold">绑定任何变量。</span></p>
                           <p>Oracle数据库已确定SQL语句的含义，但没有足够的信息来运行它。Oracle数据库需要语句中任何绑定变量占位符的值。在该示例中，Oracle数据库需要以下值<code class="codeph">:department_id</code> 。获取这些值的过程称为<span class="bold">绑定变量</span> 。
                           </p>
                           <p>程序必须指定值的位置（内存地址）。应用程序的最终用户可能不知道他们正在为绑定变量占位符指定值，因为Oracle数据库实用程序可以提示他们输入值。</p>
                           <p>由于程序指定了值的位置（即，通过引用绑定），因此在重新运行语句之前不需要重新绑定变量，即使值发生更改也是如此。每次Oracle数据库运行该语句时，它都会从其地址获取变量的值。</p>
                           <p>如果Oracle数据库必须执行数据类型转换，则还必须为每个值指定数据类型和长度（除非它们是隐含或默认的）。</p>
                        </li>
                        <li>
                           <p><span class="bold">（可选）并行化语句。</span></p>
                           <p>Oracle数据库可以并行化查询和一些数据定义语言（DDL）操作（例如，创建索引，创建带子查询的表和分区上的操作）。并行化导致多个服务器进程执行SQL语句的工作，以便它可以更快地完成。</p>
                        </li>
                        <li id="GUID-87581760-8AEF-4F72-B5F6-7584BD9AA086__BEJCJIBH">
                           <p><span class="bold">运行语句。</span></p>
                           <p>Oracle数据库运行该语句。如果语句是查询或<code class="codeph">INSERT</code>语句，则数据库不会锁定任何行，因为没有数据正在更改。如果语句是<code class="codeph">UPDATE</code>或<code class="codeph">DELETE</code>语句，则数据库将锁定语句影响的所有行，直到事务的下一个<code class="codeph">COMMIT</code> ， <code class="codeph">ROLLBACK</code>或<code class="codeph">SAVEPOINT</code> ，从而确保数据完整性。
                           </p>
                           <p>对于某些语句，您可以指定要执行的多个执行。这称为<span class="bold">阵列处理</span> 。给定<span class="italic">n</span>次执行，假定绑定和定义位置是大小为<span class="italic">n</span>的数组的开头。
                           </p>
                        </li>
                        <li>
                           <p><span class="bold">如果该语句是查询，则获取其行。</span></p>
                           <p>Oracle数据库选择行，如果查询具有<code class="codeph">ORDER</code> <code class="codeph">BY</code>子句，则对行进行排序。每次连续提取都会检索结果集的另一行，直到获取最后一行。
                           </p>
                        </li>
                        <li>
                           <p><span class="bold">关闭光标。</span></p>
                           <p>Oracle数据库关闭游标。</p>
                        </li>
                     </ol>
                     <div class="infoboxnote" id="GUID-87581760-8AEF-4F72-B5F6-7584BD9AA086__GUID-61452D85-F1F1-479F-B014-231FA61E170D">
                        <p class="notep1">注意：</p>
                        <p>要重新运行事务管理，会话管理或系统管理SQL语句，请使用另一个<code class="codeph">EXECUTE</code>语句。
                        </p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-87581760-8AEF-4F72-B5F6-7584BD9AA086__GUID-9AF97C9D-4BA2-4C3D-A5D0-DCFBF7565E87">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>有关解析的信息，请参阅<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=CNCPT1740" target="_blank"><span class="italic">Oracle数据库概念</span></a></p>
                           </li>
                           <li>
                              <p><a href="sql-processing-for-application-developers.html#GUID-CAAFBF05-4718-4096-A2BC-A98541F5DEBA">共享SQL区域</a></p>
                           </li>
                           <li>
                              <p>有关<code class="codeph">DEFINE</code>阶段的信息，请<code class="codeph">DEFINE</code> <a href="../cncpt/sql.html#CNCPT1741" target="_blank"><span class="italic">Oracle数据库概念</span></a></p>
                           </li>
                           <li>
                              <p><a href="../lnoci/introduction.html#LNOCI-GUID-27645179-6957-4004-8BB8-38775266B038" target="_blank"><span><cite>Oracle调用接口程序员指南</cite></span></a> 
                              </p>
                           </li>
                           <li>
                              <p><a href="../lnpcc/Oracle-dynamic-SQL-method-4.html#LNPCC015" target="_blank"><span class="italic">Pro * C / C ++程序员指南</span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="ADFNS99965"></a><div class="props_rev_3"><a id="GUID-CAAFBF05-4718-4096-A2BC-A98541F5DEBA" name="GUID-CAAFBF05-4718-4096-A2BC-A98541F5DEBA"></a><h4 id="ADFNS-GUID-CAAFBF05-4718-4096-A2BC-A98541F5DEBA" class="sect4">共享SQL区域</h4>
                  <div>
                     <p>Oracle数据库会自动检测应用程序何时向数据库发送类似的SQL语句。用于处理语句第一次出现的SQL区域是<span class="italic">共享的</span> - 即用于处理同一语句的后续出现。因此，唯一语句只存在一个共享SQL区域。由于共享SQL区域是共享内存区域，因此任何Oracle数据库进程都可以使用共享SQL区域。SQL区域的共享减少了数据库服务器上的内存使用，从而提高了系统吞吐量。
                     </p>
                     <p>在确定语句是否相似或相同时，Oracle数据库会比较用户和应用程序直接发出的SQL语句以及DDL语句在内部发出的递归SQL语句。</p>
                     <div class="infoboxnotealso" id="GUID-CAAFBF05-4718-4096-A2BC-A98541F5DEBA__GUID-F762DB74-FDDB-4EF1-A4E3-6AB2A4422F0B">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>有关共享SQL区域的更多信息，请<a href="../cncpt/memory-architecture.html#CNCPT1226" target="_blank"><span class="italic">参见Oracle数据库概念</span></a></p>
                           </li>
                           <li>
                              <p>有关共享SQL的详细信息，请<a href="../tgsql/introduction-to-sql-tuning.html#TGSQL-GUID-B653E5F3-F078-4BBC-9516-B892960046A2" target="_blank"><span><cite>参见“Oracle数据库SQL调优指南”</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div><a id="ADFNS960"></a><a id="ADFNS00201"></a><div class="props_rev_3"><a id="GUID-5C8249A4-D870-4FBA-A3F7-DCEC42DF86F8" name="GUID-5C8249A4-D870-4FBA-A3F7-DCEC42DF86F8"></a><h3 id="ADFNS-GUID-5C8249A4-D870-4FBA-A3F7-DCEC42DF86F8" class="sect3">将操作分组到事务中</h3>
               <div>
                  <div class="section">
                     <p class="subhead2" id="GUID-5C8249A4-D870-4FBA-A3F7-DCEC42DF86F8__GUID-0A848C51-149A-4601-A2A5-9B6F42361F0B">话题：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="sql-processing-for-application-developers.html#GUID-4DD5AD3D-E5E2-4EBB-997D-46CD68ED71A3">决定如何在事务中组合操作</a></p>
                        </li>
                        <li>
                           <p><a href="sql-processing-for-application-developers.html#GUID-8C63D793-6F54-40E2-8A0E-52C11689AEF1">提高交易绩效</a></p>
                        </li>
                        <li>
                           <p><a href="sql-processing-for-application-developers.html#GUID-035F187D-844C-4014-84C1-F44F02DDF42C">管理提交重做操作</a></p>
                        </li>
                        <li>
                           <p><a href="sql-processing-for-application-developers.html#GUID-0D79C66F-A106-412F-9EE6-7D43CBFE2AB5">确定可恢复中断后的交易结果</a></p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-5C8249A4-D870-4FBA-A3F7-DCEC42DF86F8__GUID-13B9D0EA-3A97-4EEF-B3A0-DB0D2EB9FF01">
                        <p class="notep1">也可以看看：</p>
                        <p> <a href="../cncpt/introduction-to-oracle-database.html#CNCPT016" target="_blank"><span class="italic">Oracle Database Concepts</span></a>获取有关事务的基本信息</p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS99953"></a><div class="props_rev_3"><a id="GUID-4DD5AD3D-E5E2-4EBB-997D-46CD68ED71A3" name="GUID-4DD5AD3D-E5E2-4EBB-997D-46CD68ED71A3"></a><h4 id="ADFNS-GUID-4DD5AD3D-E5E2-4EBB-997D-46CD68ED71A3" class="sect4">决定如何在事务中组合操作</h4>
                  <div>
                     <div class="section">
                        <p>通常，决定如何在事务中对操作进行分组是使用Oracle数据库编程接口的应用程序开发人员所关注的问题。在决定如何分组交易时：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>定义事务，以便以逻辑单位完成工作，数据保持一致。</p>
                           </li>
                           <li>
                              <p>确保所有引用表中的数据在事务开始之前和结束之后处于一致状态。</p>
                           </li>
                           <li>
                              <p>确保每个事务仅包含对数据进行一次一致更改的SQL语句或PL / SQL块。</p>
                           </li>
                        </ul>
                        <p>例如，假设您编写的Web应用程序允许用户在帐户之间转移资金。该事务必须包括借记到一个帐户，由一个SQL语句执行，以及由另一个SQL语句执行的另一个帐户的贷记。这两项陈述必须以失败或成功为单位;没有另一个声明，一个声明不得发表。不要在交易中包含不相关的操作，例如存款到一个帐户。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS99952"></a><div class="props_rev_3"><a id="GUID-8C63D793-6F54-40E2-8A0E-52C11689AEF1" name="GUID-8C63D793-6F54-40E2-8A0E-52C11689AEF1"></a><h4 id="ADFNS-GUID-8C63D793-6F54-40E2-8A0E-52C11689AEF1" class="sect4">提高交易绩效</h4>
                  <div>
                     <div class="section">
                        <p>作为应用程序开发人员，您必须尝试提高性能。在设计和编写应用程序时，请考虑使用这些性能增强技术：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>对于每笔交易：</p>
                              <ol>
                                 <li>
                                    <p>如果可以使用单个SQL语句，则执行此操作。</p>
                                 </li>
                                 <li>
                                    <p>如果您不能使用单个SQL语句但可以使用PL / SQL，那么请使用尽可能少的PL / SQL。</p>
                                 </li>
                                 <li>
                                    <p>如果你不能使用PL / SQL（因为它不能做你必须做的事情;例如，读取目录），那么使用Java。</p>
                                 </li>
                                 <li>
                                    <p>如果您不能使用Java（例如，如果它太慢）或您有现有的第三代语言（3GL）代码，那么使用外部C子程序。</p>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>建立编写SQL语句的标准，以便您可以利用共享的SQL区域。</p>
                              <p>Oracle数据库识别相同的SQL语句，并允许它们共享内存区域，从而减少数据库服务器上的内存使用量并提高系统吞吐量</p>
                           </li>
                           <li>
                              <p>收集Oracle数据库可用于实现基于成本的SQL语句优化方法的统计信息，并根据需要对优化程序使用其他提示。</p>
                              <p>要收集大多数统计信息，请使用<code class="codeph">DBMS_STATS</code>程序包，该程序包允许您并行收集统计信息，收集分区对象的全局统计信息，以及以其他方式调整统计信息收集。
                              </p>
                              <p>要收集与基于开销的优化程序无关的统计信息（例如有关空闲列表块的信息），请使用SQL语句<code class="codeph">ANALYZE</code> 。</p>
                           </li>
                           <li>
                              <p>在开始事务之前，调用<code class="codeph">DBMS_APPLICATION_INFO</code>过程以在数据库中记录事务的名称，以便以后使用Oracle Trace和SQL跟踪工具跟踪其性能时使用。
                              </p>
                           </li>
                           <li>
                              <p>通过在SQL表达式中包含用户编写的PL / SQL函数，提高用户工作效率和查询效率。有关详情，请参阅。</p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-8C63D793-6F54-40E2-8A0E-52C11689AEF1__GUID-0B5EA645-6FE5-4536-B830-1B2BE0EBEFAD">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关事务管理的更多信息，请参阅<a href="../cncpt/introduction-to-oracle-database.html#CNCPT016" target="_blank"><span class="italic">Oracle Database Concepts</span></a></p>
                              </li>
                              <li>
                                 <p><a href="plsql-for-application-developers.html#GUID-1B947FC8-DFE9-4490-8655-1F0CA6EAD6B5">应用程序开发人员的PL / SQL</a></p>
                              </li>
                              <li>
                                 <p><a href="external-procedures.html#GUID-230B2B41-2A6F-4756-AEC0-DBC99DCA8A37">用多种编程语言开发应用程序</a></p>
                              </li>
                              <li>
                                 <p>有关提示和<code class="codeph">ANALYZE</code>语句的详细信息，请<a href="../sqlrf/ANALYZE.html#SQLRF01105" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                              </li>
                              <li>
                                 <p>有关<code class="codeph">DBMS_STATS</code>包和<code class="codeph">DBMS_APPLICATION_INFO</code>包的更多信息，请<a href="../arpls/introduction-to-oracle-supplied-plsql-packages-and-types.html#ARPLS-GUID-4AA6AA30-CAEE-4DCD-B214-9AD51D0229B4" target="_blank"><span class="italic">参见Oracle Database PL / SQL包和类型参考</span></a></p>
                              </li>
                              <li>
                                 <p> <a href="coding-subprograms-and-packages.html#GUID-C35B709B-EE78-4DB4-9B63-54EB8B4D639F" title="您可以在创建PL / SQL包时使用PRAGMA RESTRICT_REFERENCES子句。">从SQL语句调用存储的PL / SQL函数</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS135"></a><a id="ADFNS99951"></a><div class="props_rev_3"><a id="GUID-035F187D-844C-4014-84C1-F44F02DDF42C" name="GUID-035F187D-844C-4014-84C1-F44F02DDF42C"></a><h4 id="ADFNS-GUID-035F187D-844C-4014-84C1-F44F02DDF42C" class="sect4">管理提交重做操作</h4>
                  <div>
                     <div class="section">
                        <p>当事务更新Oracle数据库时，它会生成相应的重做条目。Oracle数据库将重做条目缓冲到重做日志，直到事务完成。当事务提交时，日志写入器进程（LGWR）将重做记录写入磁盘，以获取事务中所有更改的缓冲重做条目。默认情况下，Oracle数据库会在调用返回到客户端之前将重做条目写入磁盘。此操作会导致提交延迟，因为应用程序必须等待重做条目在磁盘上持久化。</p>
                        <p>Oracle数据库允许您更改提交重做的处理以满足应用程序的需要。如果您的应用程序需要非常高的事务吞吐量并且您愿意交换提交持久性以降低提交延迟，那么您可以更改默认的<code class="codeph">COMMIT</code>选项，以便应用程序无需等待数据库将数据写入联机重做日志。
                        </p>
                        <p><a href="sql-processing-for-application-developers.html#GUID-035F187D-844C-4014-84C1-F44F02DDF42C__CIHGDFJC" title="此表列出并描述了可用于COMMIT语句和COMMIT_WRITE初始化参数的选项。">表8-1</a>介绍了<code class="codeph">COMMIT</code>选项。
                        </p>
                        <div class="infoboxnote" id="GUID-035F187D-844C-4014-84C1-F44F02DDF42C__GUID-FA4F3AD7-C468-4037-AA70-B7B112280DC9">
                           <p class="notep1">警告：</p>
                           <p>使用<code class="codeph">NOWAIT</code>选项，在收到提交消息之后但在写入重做日志记录之前发生的故障可能会错误地向事务指示其更改是持久的。
                           </p>
                        </div>
                        <div class="tblformal" id="GUID-035F187D-844C-4014-84C1-F44F02DDF42C__CIHGDFJC">
                           <p class="titleintable">表8-1 COMMIT语句选项</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="COMMIT语句选项" width="100%" border="1" summary="This table lists and describes the options that you can use for both the COMMIT statement and the COMMIT_WRITE initialization parameter." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="14%" id="d22101e1321">选项</th>
                                    <th align="left" valign="bottom" width="86%" id="d22101e1324">影响</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="14%" id="d22101e1329" headers="d22101e1321 ">
                                       <p><code class="codeph">WAIT</code> （默认）</p>
                                    </td>
                                    <td align="left" valign="top" width="86%" headers="d22101e1329 d22101e1324 ">
                                       <p>确保只有在联机重做日志中相应的重做信息持久化后， <code class="codeph">COMMIT</code>语句才会返回。当客户端从此<code class="codeph">COMMIT</code>语句收到成功返回时，该事务已提交到持久介质。
                                       </p>
                                       <p>成功写入日志后发生的故障可能会阻止成功消息返回到客户端，在这种情况下，客户端无法判断事务是否已提交。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="14%" id="d22101e1347" headers="d22101e1321 ">
                                       <p><code class="codeph">NOWAIT</code> （ <code class="codeph">WAIT</code>替代品）</p>
                                    </td>
                                    <td align="left" valign="top" width="86%" headers="d22101e1347 d22101e1324 ">
                                       <p>无论对重做日志的写入是否已完成， <code class="codeph">COMMIT</code>语句都将返回到客户端。此行为可以增加事务吞吐量。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="14%" id="d22101e1365" headers="d22101e1321 ">
                                       <p><code class="codeph">BATCH</code> （替代<code class="codeph">IMMEDIATE</code> ）</p>
                                    </td>
                                    <td align="left" valign="top" width="86%" headers="d22101e1365 d22101e1324 ">
                                       <p>使用并发运行的事务将重做信息缓冲到重做日志。收集到足够的重做信息后，启动磁盘写入重做日志。此行为称为<span class="bold">组提交</span> ，因为它在单个I / O操作中将多个事务的重做信息写入日志。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="14%" id="d22101e1383" headers="d22101e1321 ">
                                       <p><code class="codeph">IMMEDIATE</code> （默认）</p>
                                    </td>
                                    <td align="left" valign="top" width="86%" headers="d22101e1383 d22101e1324 ">
                                       <p>LGWR将事务重做信息写入日志。由于此操作选项会强制执行磁盘I / O，因此可以降低事务吞吐量。</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>要更改<code class="codeph">COMMIT</code>选项，请使用<code class="codeph">COMMIT</code>语句或相应的初始化参数。
                        </p>
                        <div class="infoboxnote" id="GUID-035F187D-844C-4014-84C1-F44F02DDF42C__GUID-17859322-263B-4D99-8733-298C8350E1F8">
                           <p class="notep1">注意：</p>
                           <p>您无法更改分布式事务的默认<code class="codeph">IMMEDIATE</code>和<code class="codeph">WAIT</code>操作。
                           </p>
                        </div>
                        <p>如果您的应用程序使用Oracle调用接口（OCI），则可以通过在应用程序的<code class="codeph">OCITransCommit</code>函数中设置这些标志来修改重做操作：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">OCI_TRANS_WRITEWAIT</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">OCI_TRANS_WRITENOWAIT</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">OCI_TRANS_WRITEBATCH</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">OCI_TRANS_WRITEIMMED</code></p>
                           </li>
                        </ul>
                        <div class="infoboxnote" id="GUID-035F187D-844C-4014-84C1-F44F02DDF42C__GUID-F56F0714-BEE8-42B3-9E78-D8E1F69121E9">
                           <p class="notep1">警告：</p>
                           <p><code class="codeph">OCI_TRANS_WRITENOWAIT</code>可能会导致静默事务丢失，包括关闭终止，启动强制以及任何实例或节点故障。在Oracle RAC系统上，异步提交的更改可能无法立即在其他实例上读取。
                           </p>
                        </div>
                        <p><code class="codeph">NOWAIT</code>和<code class="codeph">BATCH</code>选项的规范有一个小漏洞窗口，Oracle Database可以在其中回滚应用程序视图为已提交的事务。您的应用程序必须能够容忍这些情况：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>数据库主机失败，导致数据库丢失已缓冲但尚未写入联机重做日志的重做条目。</p>
                           </li>
                           <li>
                              <p>文件I / O问题阻止LGWR将缓冲的重做条目写入磁盘。如果重做日志未复用，则提交将丢失。</p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-035F187D-844C-4014-84C1-F44F02DDF42C__GUID-EF7C1C5C-1FBF-4D64-8CDB-6E5F0DC02098">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关<code class="codeph">OCITransCommit</code>函数的信息，请<code class="codeph">OCITransCommit</code> <a href="../lnoci/transaction-functions.html#LNOCI13112" target="_blank"><span class="italic">Oracle调用接口程序员指南</span></a></p>
                              </li>
                              <li>
                                 <p><a href="../sqlrf/COMMIT.html#SQLRF01110" target="_blank"><span class="italic">Oracle数据库SQL语言参考</span></a></p>
                              </li>
                              <li>
                                 <p>有关初始化参数的信息，请参阅<a href="../refrn/changing-parameter-values-in-a-parameter-file.html#REFRN00102" target="_blank"><span class="italic">Oracle Database Reference</span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS962"></a><a id="ADFNS961"></a><div class="props_rev_3"><a id="GUID-0D79C66F-A106-412F-9EE6-7D43CBFE2AB5" name="GUID-0D79C66F-A106-412F-9EE6-7D43CBFE2AB5"></a><h4 id="ADFNS-GUID-0D79C66F-A106-412F-9EE6-7D43CBFE2AB5" class="sect4">确定可恢复中断后的交易结果</h4>
                  <div>
                     <div class="section">
                        <p><span class="bold">可恢复的中断</span>是系统，硬件，通信或存储故障，它会破坏应用程序（客户端）与Oracle数据库（服务器）之间的连接。中断后，您的应用程序会收到断开连接错误消息。连接中断时运行的事务是正在进行的<span class="bold">事务</span> ，可能已提交也可能未提交或运行完成。
                        </p>
                        <p>要从中断中恢复，您的应用程序必须确定正在进行的事务的结果 - 是否已提交以及是否已使其预期的会话状态更改。如果未提交事务，则应用程序可以重新提交事务或将未提交的状态返回给最终用户。如果事务已提交，则应用程序可以将提交的状态而不是断开连接错误返回给最终用户。如果事务既已提交又已完成，则应用程序可以通过采用新会话并重新建立会话状态来继续。</p>
                        <p>Oracle数据库功能为您的应用程序提供正在进行的事务的结果，并且可用于确保它不重复是Transaction Guard，其应用程序接口（API）是PL / SQL过程<code class="codeph">DBMS_APP_CONT.GET_LTXID_OUTCOME</code> 。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-0D79C66F-A106-412F-9EE6-7D43CBFE2AB5__GUID-2E0C1683-2A51-4173-83F9-5EA3FC6BC91C">话题：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="sql-processing-for-application-developers.html#GUID-09E66BB5-DF82-4183-876A-DA10187EE637">了解交易保护</a></p>
                           </li>
                           <li>
                              <p><a href="sql-processing-for-application-developers.html#GUID-76315E18-AEB8-4978-AC9E-A4535A883616">了解DBMS_APP_CONT.GET_LTXID_OUTCOME</a></p>
                           </li>
                           <li>
                              <p><a href="sql-processing-for-application-developers.html#GUID-CD278F30-E49B-4F55-89E2-CB2DCF5DEEE6">使用Transaction Guard</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div><a id="ADFNS963"></a><div class="props_rev_3"><a id="GUID-09E66BB5-DF82-4183-876A-DA10187EE637" name="GUID-09E66BB5-DF82-4183-876A-DA10187EE637"></a><h5 id="ADFNS-GUID-09E66BB5-DF82-4183-876A-DA10187EE637" class="sect5">了解交易保护</h5>
                     <div>
                        <p><span class="bold">Transaction Guard</span>是一个Oracle数据库工具，可用于在停机后为应用程序提供正在进行的事务的结果。应用程序可以使用事务防护在最终用户提交停机或未提交之后提供已知结果，并且可选地，如果事务未提交且状态正确，则重播事务。
                        </p>
                        <p>Transaction Guard通过其API，PL / SQL过程<code class="codeph">DBMS_APP_CONT.GET_LTXID_OUTCOME</code>提供事务结果。</p>
                        <p>Transaction Guard依赖于<span class="bold">逻辑事务标识符（LTXID）</span> ，这是一个全局唯一标识符，用于标识失败会话中的最后一个<span class="bold">正在进行的</span>事务。事务提交时，数据库记录LTXID，并使用提交消息向客户端返回新的LTXID（对于每个客户端往返）。客户端驱动程序始终保存将在下一个<code class="codeph">COMMIT</code>使用的LTXID。</p>
                        <div class="infoboxnote" id="GUID-09E66BB5-DF82-4183-876A-DA10187EE637__GUID-089975E1-795B-4AC5-934C-3C82B941DB6B">
                           <p class="notep1">注意：</p>
                           <p></p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>仅使用Transaction Guard查找由于可恢复错误而失败的会话的结果，以使用实际结果替换通信错误。</p>
                              </li>
                              <li>
                                 <p>不要在自己的会话中使用Transaction Guard。</p>
                              </li>
                              <li>
                                 <p>不要在实时会话中使用Transaction Guard。</p>
                                 <p>要停止实时会话，请在本地或远程实例上使用<code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">KILL</code> <code class="codeph">SESSION</code> <code class="codeph">IMMEDIATE</code> 。
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <div class="infoboxnotealso" id="GUID-09E66BB5-DF82-4183-876A-DA10187EE637__GUID-8E39FAA8-59ED-453F-BADE-90EE7E418EFC">
                           <p class="notep1">也可以看看：</p><a href="sql-processing-for-application-developers.html#GUID-76315E18-AEB8-4978-AC9E-A4535A883616">了解DBMS_APP_CONT.GET_LTXID_OUTCOME</a></div>
                     </div><a id="ADFNS965"></a><div class="props_rev_3"><a id="GUID-2C8B1E1B-6388-4059-8D49-2A8D21CAFA64" name="GUID-2C8B1E1B-6388-4059-8D49-2A8D21CAFA64"></a><h6 id="ADFNS-GUID-2C8B1E1B-6388-4059-8D49-2A8D21CAFA64" class="sect6">Transaction Guard如何使用LTXID</h6>
                        <div>
                           <p>Transaction Guard使用LTXID如下：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>当事务正在运行时，Oracle数据库（服务器）和您的应用程序（客户端）都会保存要在下一个<code class="codeph">COMMIT</code>使用的LTXID。</p>
                              </li>
                              <li>
                                 <p>提交事务时，Oracle数据库会记录事务中的LTXID。如果LTXID已提交或已被阻止，则数据库会引发错误，从而防止重复事务。</p>
                              </li>
                              <li>
                                 <p>LTXID在<code class="codeph">RETENTION_TIMEOUT</code>参数指定的时间内持续存在于Oracle数据库中。默认值为24小时。要更改此值：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>运行Real Application Clusters时，请使用Server Control Utility（SRVCTL）。</p>
                                    </li>
                                    <li>
                                       <p>不使用Real Application Clusters时，请使用<code class="codeph">DBMS_SERVICE</code>包。
                                       </p>
                                    </li>
                                 </ul>
                                 <p>如果事务是远程事务或分布式事务，则其LTXID将保留在本地数据库中。</p>
                                 <p>LTXID在标准重做应用中传输到Data Guard和Active Data Guard。</p>
                              </li>
                              <li>
                                 <p>发生可恢复的错误后：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>如果事务尚未提交，则Oracle数据库会阻止其LTXID，以确保无法提交具有相同LTXID的早期正在进行的事务。</p>
                                       <p>此行为允许应用程序将未提交的结果返回给用户，然后用户可以决定要执行的操作，并允许应用程序在需要时安全地重播应用程序。</p>
                                    </li>
                                    <li>
                                       <p>如果事务已提交，则应用程序可以将此结果返回给最终用户，如果状态正确，则应用程序可能能够继续。</p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>如果事务被回滚，则Oracle数据库将重用其LTXID。</p>
                              </li>
                           </ul>
                           <div class="infoboxnotealso" id="GUID-2C8B1E1B-6388-4059-8D49-2A8D21CAFA64__GUID-B0D40280-B8DC-47D4-A1BF-C8C91F6658E1">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><a href="transaction-guard.html#GUID-2EA7BC0E-FA8B-43D6-89D5-45AFA040CCC4">Transaction Guard Coverage</a> ，用于Transaction Guard支持的提交源列表</p>
                                 </li>
                                 <li>
                                    <p><a href="transaction-guard.html#GUID-25E7E67C-49F6-4C1C-8227-075C2450ED85">Transaction Guard Exclusions</a> ，用于Transaction Guard不支持的提交的源列表</p>
                                 </li>
                                 <li>
                                    <p>有关SRVCTL的详细信息，请参见<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=RACAD005" target="_blank"><span class="italic">“Oracle Real Application Clusters管理和部署指南”</span></a></p>
                                 </li>
                                 <li>
                                    <p>有关<code class="codeph">DBMS_SERVICE</code>包的更多信息，请<code class="codeph">DBMS_SERVICE</code> <a href="../arpls/DBMS_SERVICE.html#ARPLS092" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考</span></a></p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                     </div>
                  </div><a id="ADFNS969"></a><a id="ADFNS968"></a><div class="props_rev_3"><a id="GUID-76315E18-AEB8-4978-AC9E-A4535A883616" name="GUID-76315E18-AEB8-4978-AC9E-A4535A883616"></a><h5 id="ADFNS-GUID-76315E18-AEB8-4978-AC9E-A4535A883616" class="sect5">了解DBMS_APP_CONT.GET_LTXID_OUTCOME</h5>
                     <div>
                        <p>PL / SQL过程<code class="codeph">DBMS_APP_CONT.GET_LTXID_OUTCOME</code>是Transaction Guard的API。中断后，您的应用程序可以重新连接到Oracle数据库，然后调用此过程以确定正在进行的事务的结果。
                        </p>
                        <p><code class="codeph">DBMS_APP_CONT.GET_LTXID_OUTCOME</code>具有以下参数：</p>
                        <div class="tblformal" id="GUID-76315E18-AEB8-4978-AC9E-A4535A883616__GUID-C1B34416-3EE0-43AC-9050-E14D289345D4">
                           <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="Gives the name, data type, mode, and value of each parameter of the DBMS_APP_CONT.GET_LTXID_OUTCOME procedure." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="22%" id="d22101e2070">参数名称</th>
                                    <th align="left" valign="bottom" width="11%" id="d22101e2073">数据类型</th>
                                    <th align="left" valign="bottom" width="11%" id="d22101e2076">参数模式</th>
                                    <th align="left" valign="bottom" width="56%" id="d22101e2079">值</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="22%" id="d22101e2084" headers="d22101e2070 ">
                                       <p><code class="codeph">CLIENT_LTXID</code></p>
                                    </td>
                                    <td align="left" valign="top" width="11%" headers="d22101e2084 d22101e2073 ">
                                       <p><code class="codeph">生的</code></p>
                                    </td>
                                    <td align="left" valign="top" width="11%" headers="d22101e2084 d22101e2076 ">
                                       <p><code class="codeph">在</code></p>
                                    </td>
                                    <td align="left" valign="top" width="56%" headers="d22101e2084 d22101e2079 ">
                                       <p>机上交易的LTXID</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="22%" id="d22101e2100" headers="d22101e2070 ">
                                       <p><code class="codeph">COMMITTED</code></p>
                                    </td>
                                    <td align="left" valign="top" width="11%" headers="d22101e2100 d22101e2073 ">
                                       <p><code class="codeph">布尔</code></p>
                                    </td>
                                    <td align="left" valign="top" width="11%" headers="d22101e2100 d22101e2076 ">
                                       <p><code class="codeph">OUT</code></p>
                                    </td>
                                    <td align="left" valign="top" width="56%" headers="d22101e2100 d22101e2079 ">
                                       <p>如果正在进行的事务已提交，则为<code class="codeph">TRUE</code> ，否则为<code class="codeph">FALSE</code></p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="22%" id="d22101e2121" headers="d22101e2070 ">
                                       <p><code class="codeph">USER_CALL_COMPLETED</code></p>
                                    </td>
                                    <td align="left" valign="top" width="11%" headers="d22101e2121 d22101e2073 ">
                                       <p><code class="codeph">布尔</code></p>
                                    </td>
                                    <td align="left" valign="top" width="11%" headers="d22101e2121 d22101e2076 ">
                                       <p><code class="codeph">OUT</code></p>
                                    </td>
                                    <td align="left" valign="top" width="56%" headers="d22101e2121 d22101e2079 ">
                                       <p>如果飞行中的交易完成则为<code class="codeph">TRUE</code> ，否则为<code class="codeph">FALSE</code></p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-76315E18-AEB8-4978-AC9E-A4535A883616__GUID-8A6EA4E3-6D43-4DE5-BE08-A9FAA0C5D5CC">话题：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="sql-processing-for-application-developers.html#GUID-6497F766-86A4-4B76-95D5-582060E5475D">CLIENT_LTXID参数</a></p>
                              </li>
                              <li>
                                 <p><a href="sql-processing-for-application-developers.html#GUID-8A9FC096-4DF2-4725-B52C-51B66FD666C7">委托参数</a></p>
                              </li>
                              <li>
                                 <p><a href="sql-processing-for-application-developers.html#GUID-21B51362-CABE-4E31-AB8B-25D428C632B0">USER_CALL_COMPLETED参数</a></p>
                              </li>
                              <li>
                                 <p><a href="sql-processing-for-application-developers.html#GUID-6D3590B6-C02F-456B-8076-7DB81E792A62">例外</a></p>
                              </li>
                           </ul>
                           <div class="infoboxnotealso" id="GUID-76315E18-AEB8-4978-AC9E-A4535A883616__GUID-8283E7B2-7A9C-4E41-848D-F79021954341">
                              <p class="notep1">也可以看看：</p>
                              <p>有关<code class="codeph">DBMS_APP_CONT.GET_LTXID_OUTCOME</code>详细信息，请参阅<a href="../arpls/DBMS_APP_CONT.html#ARPLS73456" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考</span></a></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div><a id="ADFNS970"></a><div class="props_rev_3"><a id="GUID-6497F766-86A4-4B76-95D5-582060E5475D" name="GUID-6497F766-86A4-4B76-95D5-582060E5475D"></a><h6 id="ADFNS-GUID-6497F766-86A4-4B76-95D5-582060E5475D" class="sect6">CLIENT_LTXID参数</h6>
                        <div>
                           <p>在您的应用程序（客户端）可以使用正在进行的事务的LTXID调用<code class="codeph">DBMS_APP_CONT.GET_LTXID_OUTCOME</code>之前，它必须使用客户端驱动程序在客户端驱动程序中获取正在使用的最后一个LTXID。客户端驱动程序保存接下来要提交的事务的LTXID。在这种情况下，LTXID用于中断时的飞行中交易。使用<code class="codeph">getLTXID</code>用于JDBC-Thin驱动程序， <code class="codeph">LogicalTransactionId</code>用于ODP.NET， <code class="codeph">OCI_ATTR_GET</code>用于LTXID用于OCI和OCCI。</p>
                           <p>JDBC-Thin驱动程序还提供每次客户端驱动程序的LTXID更改时触发的回调。回调可用于维护要使用的当前LTXID。回调对于必须阻止重复执行的应用程序服务器和应用程序特别有用。</p>
                           <div class="infoboxnote" id="GUID-6497F766-86A4-4B76-95D5-582060E5475D__GUID-88CC7CE8-A19A-4547-AEEC-169EFAA08A7C">
                              <p class="notep1">注意：</p>
                              <p>您的应用程序必须立即获取LTXID，然后再将其传递给<code class="codeph">DBMS_APP_CONT.GET_LTXID_OUTCOME</code> 。提前获取LTXID可能会导致将早期的LTXID传递给<code class="codeph">DBMS_APP_CONT.GET_LTXID_OUTCOME</code> ，从而导致请求被拒绝。
                              </p>
                           </div>
                           <div class="infoboxnotealso" id="GUID-6497F766-86A4-4B76-95D5-582060E5475D__GUID-6F94EFFE-0E65-4FA2-94FB-789B1310A339">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><a href="../jjdbc/introducing-JDBC.html#JJDBC28026" target="_blank"><span><cite>Oracle数据库JDBC开发人员指南</cite></span></a></p>
                                 </li>
                                 <li>
                                    <p><a href="../lnoci/index.html" target="_blank"><span><cite>Oracle调用接口程序员指南</cite></span></a></p>
                                 </li>
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ODPNT-GUID-635BAE6C-7D0B-4CF2-ADD8-8DB531B9C52E" target="_blank"><span><cite>适用于Microsoft Windows的Oracle数据提供程序开发人员指南</cite></span></a></p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                     </div><a id="ADFNS971"></a><div class="props_rev_3"><a id="GUID-8A9FC096-4DF2-4725-B52C-51B66FD666C7" name="GUID-8A9FC096-4DF2-4725-B52C-51B66FD666C7"></a><h6 id="ADFNS-GUID-8A9FC096-4DF2-4725-B52C-51B66FD666C7" class="sect6">委托参数</h6>
                        <div>
                           <p>在<code class="codeph">DBMS_APP_CONT.GET_LTXID_OUTCOME</code>将控制权返回给您的应用程序之后，您的应用程序可以检查与形式参数<code class="codeph">COMMITTED</code>相对应的实际参数的值，以确定是否已提交正在进行的事务。
                           </p>
                           <p>如果实际参数的值为<code class="codeph">TRUE</code> ，则提交事务。
                           </p>
                           <p>如果实际参数的值为<code class="codeph">FALSE</code> ，则表示未提交事务。因此，应用程序将代码<code class="codeph">UNCOMMITTED</code>返回给最终用户或使用它来重放事务是安全的。
                           </p>
                           <p>为确保在应用程序返回<code class="codeph">UNCOMMITTED</code>之后，先前的会话未提交事务， <code class="codeph">DBMS_APP_CONT.GET_LTXID_OUTCOME</code>阻止LTXID。阻止LTXID允许最终用户根据未提交状态或重放事务的应用程序做出决策，并防止重复事务。
                           </p>
                        </div>
                     </div><a id="ADFNS972"></a><div class="props_rev_3"><a id="GUID-21B51362-CABE-4E31-AB8B-25D428C632B0" name="GUID-21B51362-CABE-4E31-AB8B-25D428C632B0"></a><h6 id="ADFNS-GUID-21B51362-CABE-4E31-AB8B-25D428C632B0" class="sect6">USER_CALL_COMPLETED参数</h6>
                        <div>
                           <p>有些交易在完成后返回信息。例如：使用成功提交（自动提交）的事务可能返回受影响的行数，或者对于<code class="codeph">SELECT</code>语句，返回行本身;调用具有<code class="codeph">OUT</code>参数的PL / SQL子程序的事务返回这些参数的值;并且调用PL / SQL函数的事务返回函数值。此外，调用PL / SQL子程序的事务可能会执行<code class="codeph">COMMIT</code>语句，然后执行更多工作。
                           </p>
                           <p>如果您的应用程序需要在完成时返回正在进行的事务的信息，或者在提交数据库更改后事务所执行的会话状态更改，那么您的应用程序必须确定是否已完成正在进行的事务，这可以通过检查值来完成对应于形式参数<code class="codeph">USER_CALL_COMPLETED</code>的实际参数。</p>
                           <p>如果实际参数的值为<code class="codeph">TRUE</code> ，则事务已完成，并且您的应用程序具有必须继续的信息和工作。
                           </p>
                           <p>如果实际参数的值为<code class="codeph">FALSE</code> ，则客户端的调用可能尚未完成。因此，您的应用程序可能没有必须继续的信息和工作。
                           </p>
                        </div>
                     </div><a id="ADFNS973"></a><div class="props_rev_3"><a id="GUID-6D3590B6-C02F-456B-8076-7DB81E792A62" name="GUID-6D3590B6-C02F-456B-8076-7DB81E792A62"></a><h6 id="ADFNS-GUID-6D3590B6-C02F-456B-8076-7DB81E792A62" class="sect6">例外</h6>
                        <div>
                           <p>如果您的应用程序（客户端）和Oracle数据库（服务器）不再同步，则<code class="codeph">DBMS_APP_CONT.GET_LTXID_OUTCOME</code>过程会引发以下异常之一：</p>
                           <div class="tblformal" id="GUID-6D3590B6-C02F-456B-8076-7DB81E792A62__GUID-A7ACF666-0D85-442C-B1F3-885052BD159C">
                              <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="This table lists and explains the exceptions that the DBMS_APP_CONT.GET_LTXID_OUTCOME procedure can raise." frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="21%" id="d22101e2672">例外</th>
                                       <th align="left" valign="bottom" width="79%" id="d22101e2675">说明</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="21%" id="d22101e2680" headers="d22101e2672 ">
                                          <p><code class="codeph">ORA-14950  -  SERVER_AHEAD</code></p>
                                       </td>
                                       <td align="left" valign="top" width="79%" headers="d22101e2680 d22101e2675 ">
                                          <p>服务器领先于客户端;也就是说，应用程序传递给<code class="codeph">DBMS_APP_CONT.GET_LTXID_OUTCOME</code>的LTXID标识的是比正在进行的事务更早的事务。
                                          </p>
                                          <p>您的应用程序必须立即获取LTXID，然后再将其传递给<code class="codeph">DBMS_APP_CONT.GET_LTXID_OUTCOME</code> 。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="21%" id="d22101e2696" headers="d22101e2672 ">
                                          <p><code class="codeph">ORA-14951  -  CLIENT_AHEAD</code></p>
                                       </td>
                                       <td align="left" valign="top" width="79%" headers="d22101e2696 d22101e2675 ">
                                          <p>客户端位于服务器之前。服务器“闪回”到早期状态，使用介质恢复恢复，或者是先前打开并丢失数据的备用数据库。</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="21%" id="d22101e2704" headers="d22101e2672 ">
                                          <p><code class="codeph">ORA-14906  -  SAME_SESSION</code></p>
                                       </td>
                                       <td align="left" valign="top" width="79%" headers="d22101e2704 d22101e2675 ">
                                          <p>拥有LTXID的会话不支持执行<code class="codeph">GET_LTXID_OUTCOME</code> ，因为执行会阻止对该会话的进一步处理。
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="21%" id="d22101e2715" headers="d22101e2672 ">
                                          <p><code class="codeph">ORA-14909  -  COMMIT_BLOCKED</code></p>
                                       </td>
                                       <td align="left" valign="top" width="79%" headers="d22101e2715 d22101e2675 ">
                                          <p>您的会话已使用<code class="codeph">GET_LTXID_OUTCOME</code>阻止其他用户使用相同的用户名<code class="codeph">GET_LTXID_OUTCOME</code> 。应该只在死会话时调用<code class="codeph">GET_LTXID_OUTCOME</code> 。使用<code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">KILL</code> <code class="codeph">SESSION</code> <code class="codeph">IMMEDIATE</code>可以更好地阻止实时会话。如需帮助，请联系您的应用程序管
                                          </p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="21%" id="d22101e2745" headers="d22101e2672 ">
                                          <p><code class="codeph">ORA-14952一般错误</code></p>
                                       </td>
                                       <td align="left" valign="top" width="79%" headers="d22101e2745 d22101e2675 ">
                                          <p><code class="codeph">DBMS_APP_CONT.GET_LTXID_OUTCOME</code>无法确定<code class="codeph">DBMS_APP_CONT.GET_LTXID_OUTCOME</code>事务的结果。事务处理期间发生错误，错误堆栈显示错误详细信息。
                                          </p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <div class="infoboxnotealso" id="GUID-6D3590B6-C02F-456B-8076-7DB81E792A62__GUID-6AB078AC-49B3-4573-BBC5-DC41EEF94326">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><a href="flashback.html#GUID-03D1CAAE-D940-444A-8771-B1BC636D105D">使用Oracle闪回技术</a></p>
                                 </li>
                                 <li>
                                    <p>有关介质恢复和备用数据库的信息，请参阅<a href="../sbydb/introduction-to-oracle-data-guard-concepts.html#SBYDB-GUID-5E73667D-4A56-445E-911F-1E99092DD8D7" target="_blank"><span><cite>Oracle Data Guard概念和管理</cite></span></a></p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                     </div>
                  </div><a id="ADFNS974"></a><div class="props_rev_3"><a id="GUID-CD278F30-E49B-4F55-89E2-CB2DCF5DEEE6" name="GUID-CD278F30-E49B-4F55-89E2-CB2DCF5DEEE6"></a><h5 id="ADFNS-GUID-CD278F30-E49B-4F55-89E2-CB2DCF5DEEE6" class="sect5">使用Transaction Guard</h5>
                     <div>
                        <div class="section">
                           <p>在您的应用程序（客户端）收到错误消息后，它必须按照以下步骤使用Transaction Guard：</p>
                           <ol>
                              <li>
                                 <p>确定错误是否是由于中断（ <span class="bold">可恢复</span> ）引起的。
                                 </p>
                                 <p>有关说明，请参阅客户端驱动<code class="codeph">OCI_ATTRIBUTE</code>的文档 -  OCI，OCCI和ODP.NET的<code class="codeph">OCI_ATTRIBUTE</code> ;是JDBC可以<code class="codeph">isRecoverable</code>的。</p>
                              </li>
                              <li id="GUID-CD278F30-E49B-4F55-89E2-CB2DCF5DEEE6__BEJGHDBC">
                                 <p>如果错误是可恢复的，则使用客户端驱动程序的API来获取正在进行的事务的逻辑事务标识符（LTXID）。</p>
                                 <p>有关说明，请参阅客户端驱动程序的文档。</p>
                              </li>
                              <li>
                                 <p>重新连接到数据库。</p>
                                 <p>您的应用程序获取的会话可以是新的，也可以是池。</p>
                              </li>
                              <li>
                                 <p>使用步骤<a href="sql-processing-for-application-developers.html#GUID-CD278F30-E49B-4F55-89E2-CB2DCF5DEEE6__BEJGHDBC">2中</a>的LTXID调用<code class="codeph">DBMS_APP_CONT.GET_LTXID_OUTCOME</code> 。
                                 </p>
                              </li>
                              <li>
                                 <p>检查与形式参数<code class="codeph">COMMITTED</code>对应的实际参数的值。</p>
                                 <p>如果值为<code class="codeph">TRUE</code> ，则告诉应用程序正在进行的事务处理已提交。应用程序可以将此结果返回给用户，或者如果状态正确则继续。
                                 </p>
                                 <p>如果值为<code class="codeph">FALSE</code> ，则应用程序可以向用户返回<code class="codeph">UNCOMMITTED</code>或类似消息，以便用户可以选择下一步。可选地，应用程序可以为用户重放事务。例如：</p>
                                 <ol type="a">
                                    <li>
                                       <p>如有必要，请清除客户端的状态更改。</p>
                                    </li>
                                    <li>
                                       <p>重新提交正在进行的交易。</p>
                                    </li>
                                 </ol>
                                 <p>如果您不重新提交正在进行的事务，并且应用程序既不需要正在进行的事务在完成时返回的信息，也不需要在提交数据库更改后该事务执行的工作，则继续。否则，请检查与形式参数<code class="codeph">USER_CALL_COMPLETED</code>对应的实际参数的值。</p>
                                 <p>如果值为<code class="codeph">TRUE</code> ，则继续。
                                 </p>
                                 <p>如果值为<code class="codeph">FALSE</code> ，则告诉应用程序用户该应用程序无法继续。
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div><a id="ADFNS00202"></a><div class="props_rev_3"><a id="GUID-78285196-33AF-45E9-BDB6-8AE38648C838" name="GUID-78285196-33AF-45E9-BDB6-8AE38648C838"></a><h3 id="ADFNS-GUID-78285196-33AF-45E9-BDB6-8AE38648C838" class="sect3">使用只读事务确保可重复读取</h3>
               <div>
                  <div class="section">
                     <p>默认情况下，Oracle数据库保证语句级读取一致性，但不保证事务级读取一致性。通过<span class="bold">语句级读取一致性</span> ，语句中的查询会在语句的持续时间内生成一致的数据，而不会反映其他语句的更改。通过<span class="bold">事务级读取一致性</span> （ <span class="bold">可重复读取</span> ），事务中的查询在事务持续时间内生成一致的数据，而不反映其他事务的更改。
                     </p>
                     <p>要确保不包含DML语句的事务的事务级读取一致性，请指定事务是只读的。只读事务中的查询仅查看事务开始之前提交的更改，因此查询结果在事务持续时间内保持一致。</p>
                     <p>只读事务提供事务级读取一致性，而无需获取其他数据锁。因此，当只读事务查询数据时，其他事务可以查询和更新相同的数据。</p>
                     <p>只读事务以此语句开头：</p><pre class="oac_no_warn" dir="ltr">SET TRANSACTION READ ONLY [NAME <span class="italic">string</span> ];</pre><p>只有DDL语句才能出现在<code class="codeph">SET</code> <code class="codeph">TRANSACTION</code> <code class="codeph">READ</code> <code class="codeph">ONLY</code>语句之前。成功运行<code class="codeph">SET</code> <code class="codeph">TRANSACTION</code> <code class="codeph">READ</code> <code class="codeph">ONLY</code>语句后，事务只能包括<code class="codeph">SELECT</code> （不带<code class="codeph">FOR</code> <code class="codeph">UPDATE</code> ）， <code class="codeph">COMMIT</code> ， <code class="codeph">ROLLBACK</code>或非DML语句（例如<code class="codeph">SET</code> <code class="codeph">ROLE</code> ， <code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code>和<code class="codeph">LOCK</code> <code class="codeph">TABLE</code> ）。<code class="codeph">COMMIT</code> ， <code class="codeph">ROLLBACK</code>或DDL语句结束只读事务。
                     </p>
                     <div class="infoboxnotealso" id="GUID-78285196-33AF-45E9-BDB6-8AE38648C838__GUID-7350E0BC-45BA-40C9-940A-A0CE7B622EE9">
                        <p class="notep1">也可以看看：</p>
                        <p>有关<code class="codeph">SET</code> <code class="codeph">TRANSACTION</code>语句的更多信息，请<a href="../sqlrf/SET-TRANSACTION.html#SQLRF01705" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                     </div>
                     <p>长时间运行的查询有时会失败，因为一致读取（CR）操作所需的撤消信息不再可用。当活动事务覆盖已提交的撤消块时，会发生这种情况。</p>
                     <p>自动撤消管理允许数据库管理员（DBA）使用参数<code class="codeph">UNDO_RETENTION</code>显式控制数据库保留撤消信息的时间。例如，如果<code class="codeph">UNDO_RETENTION</code>为30分钟，则数据库会保留所有已提交的撤消信息至少30分钟，从而确保所有运行30分钟或更短时间的查询都不会遇到OER错误“快照太旧”。</p>
                     <div class="infoboxnotealso" id="GUID-78285196-33AF-45E9-BDB6-8AE38648C838__GUID-E4683961-5C45-4F96-8BA7-9CDA3655A31A">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>有关读一致性的更多信息，请<a href="../cncpt/data-concurrency-and-consistency.html#CNCPT221" target="_blank"><span class="italic">参见Oracle数据库概</span></a></p>
                           </li>
                           <li>
                              <p>有关长时间运行的查询和可恢复空间分配的信息，请参见<a href="../admin/managing-space-for-schema-objects.html#ADMIN014" target="_blank"><span class="italic">“Oracle数据库管理员指南”</span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="ADFNS976"></a><a id="ADFNS00203"></a><div class="props_rev_3"><a id="GUID-23991569-1E18-47E5-8549-42925C82A25A" name="GUID-23991569-1E18-47E5-8549-42925C82A25A"></a><h3 id="ADFNS-GUID-23991569-1E18-47E5-8549-42925C82A25A" class="sect3">明确锁定表</h3>
               <div>
                  <div class="section">
                     <p>Oracle数据库具有默认锁定机制，可确保数据并发性，数据完整性和语句级读取一致性。但是，您可以通过显式锁定表来覆盖这些机制。显式锁定表在以下情况下非常有用：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>应用程序中的事务需要对资源的独占访问权限，以便事务不必等待其他事务完成。</p>
                        </li>
                        <li>
                           <p>您的应用程序需要事务级读取一致性（可重复读取）。</p>
                        </li>
                     </ul>
                     <p>要覆盖事务级别的默认锁定，请使用以下任何SQL语句：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">LOCK</code> <code class="codeph">TABLE</code></p>
                        </li>
                        <li>
                           <p>使用<code class="codeph">FOR</code> <code class="codeph">UPDATE</code>子句进行<code class="codeph">SELECT</code></p>
                        </li>
                        <li>
                           <p>使用<code class="codeph">READ</code> <code class="codeph">ONLY</code>或<code class="codeph">ISOLATION</code> <code class="codeph">LEVEL</code> <code class="codeph">SERIALIZABLE</code>选项进行<code class="codeph">SET</code> <code class="codeph">TRANSACTION</code></p>
                        </li>
                     </ul>
                     <p>在提交或回滚事务后，将释放由这些语句获取的锁。</p>
                     <p>初始化参数<code class="codeph">DML_LOCKS</code>确定DML锁的最大数量。虽然它的默认值通常已足够，但如果使用显式锁定，则可能需要增加它。
                     </p>
                     <div class="infoboxnote" id="GUID-23991569-1E18-47E5-8549-42925C82A25A__GUID-14DC57C1-C79B-4F20-88E9-64CED310725B">
                        <p class="notep1">注意：</p>
                        <p>如果在任何级别覆盖Oracle数据库的默认锁定，请确保数据完整性得到保证，数据并发性是可接受的，并且死锁是不可能的或处理不当。</p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-23991569-1E18-47E5-8549-42925C82A25A__GUID-70A85590-2F8D-4FA8-B3F1-4DE481762FCB">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="../cncpt/data-concurrency-and-consistency.html#CNCPT1331" target="_blank"><span><cite>Oracle数据库概念</cite></span></a></p>
                           </li>
                           <li>
                              <p><a href="sql-processing-for-application-developers.html#GUID-78285196-33AF-45E9-BDB6-8AE38648C838">使用只读事务确保可重复读取</a></p>
                           </li>
                           <li>
                              <p><a href="sql-processing-for-application-developers.html#GUID-8280E670-B337-4D6D-8BF4-861B8B3947AA">使用Serializable Transactions进行并发控制</a></p>
                           </li>
                           <li>
                              <p><a href="../sqlrf/Introduction-to-Oracle-SQL.html#SQLRF-GUID-049B7AE8-11E1-4110-B3E4-D117907D77AC" target="_blank"><span><cite>Oracle数据库SQL语言参考</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-23991569-1E18-47E5-8549-42925C82A25A__GUID-30D08EF0-FA67-4F93-9012-F57C262B9C7E">话题：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="sql-processing-for-application-developers.html#GUID-F68DF91E-76FB-4D5D-849B-BB4D6CC757DB">获取表锁所需的权限</a></p>
                        </li>
                        <li>
                           <p><a href="sql-processing-for-application-developers.html#GUID-13B1103C-3E0E-4877-9CAF-A8D6337EDC68">选择锁定策略</a></p>
                        </li>
                        <li>
                           <p><a href="sql-processing-for-application-developers.html#GUID-D75EFDA7-DBE5-4E35-A856-75859CAAECDE">让Oracle数据库控制表锁定</a></p>
                        </li>
                        <li>
                           <p><a href="sql-processing-for-application-developers.html#GUID-F91A26B7-2C41-4CC5-BB07-AA7E9ED58CAF">明确获取行锁</a></p>
                        </li>
                        <li>
                           <p><a href="sql-processing-for-application-developers.html#GUID-545CF5D2-1C85-470D-8D8A-CBF86EE95DA6">显式锁定下的并发示例</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS99944"></a><div class="props_rev_3"><a id="GUID-F68DF91E-76FB-4D5D-849B-BB4D6CC757DB" name="GUID-F68DF91E-76FB-4D5D-849B-BB4D6CC757DB"></a><h4 id="ADFNS-GUID-F68DF91E-76FB-4D5D-849B-BB4D6CC757DB" class="sect4">获取表锁所需的权限</h4>
                  <div>
                     <p>在您自己的架构中的表上获取任何类型的表锁都不需要特殊权限。要在另一个模式中的表上获取表锁，您必须具有<code class="codeph">LOCK</code> <code class="codeph">ANY</code> <code class="codeph">TABLE</code>系统特权或该<code class="codeph">TABLE</code>任何对象特权（例如， <code class="codeph">SELECT</code>或<code class="codeph">UPDATE</code> ）。
                     </p>
                  </div>
               </div><a id="ADFNS977"></a><a id="ADFNS99943"></a><div class="props_rev_3"><a id="GUID-13B1103C-3E0E-4877-9CAF-A8D6337EDC68" name="GUID-13B1103C-3E0E-4877-9CAF-A8D6337EDC68"></a><h4 id="ADFNS-GUID-13B1103C-3E0E-4877-9CAF-A8D6337EDC68" class="sect4">选择锁定策略</h4>
                  <div>
                     <div class="section">
                        <p>执行<code class="codeph">LOCK</code> <code class="codeph">TABLE</code>语句时，事务显式获取指定的表锁。<code class="codeph">LOCK</code> <code class="codeph">TABLE</code>语句显式覆盖默认锁定。在视图上发出<code class="codeph">LOCK</code> <code class="codeph">TABLE</code>语句时，将锁定基础基表。此语句代表包含事务获取<code class="codeph">employees</code>和<code class="codeph">departments</code>表的独占表锁：</p><pre class="oac_no_warn" dir="ltr">LOCK TABLE员工，部门IN EXCLUSIVE MODE NOWAIT;</pre><p>您可以指定多个表或视图以同一模式锁定;但是，只能为每个<code class="codeph">LOCK</code> <code class="codeph">TABLE</code>语句指定一个锁定模式。
                        </p>
                        <div class="infoboxnote" id="GUID-13B1103C-3E0E-4877-9CAF-A8D6337EDC68__GUID-8456BA88-5520-46B1-BDD3-9ED5D5228848">
                           <p class="notep1">注意：</p>
                           <p>当表被锁定时，表的所有行都被锁定。没有其他用户可以修改表。</p>
                        </div>
                        <p>在<code class="codeph">LOCK</code> <code class="codeph">TABLE</code>语句中，您还可以指示要等待表锁的时间：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>如果您不想等待，请指定<code class="codeph">NOWAIT</code>或<code class="codeph">WAIT 0</code> 。
                              </p>
                              <p>只有在立即可用时才获取表锁;否则，错误会通知您锁定现在不可用。</p>
                           </li>
                           <li>
                              <p>要等待<span class="italic">n</span>秒钟以获取表锁定，请指定<code class="codeph">WAIT</code> <span class="italic"><code class="codeph">n</code></span> ，其中<span class="italic">n</span>大于0且小于或等于100000。
                              </p>
                              <p>如果表锁在<span class="italic">n</span>秒后仍然不可用，则错误会通知您锁定现在不可用。
                              </p>
                           </li>
                           <li>
                              <p>要无限期地等待获取锁定，既不指定<code class="codeph">NOWAIT</code>也不指定<code class="codeph">WAIT</code> 。</p>
                              <p>数据库无限期等待，直到表可用，锁定它，并将控制返回给您。当数据库与DML语句同时运行DDL语句时，有时会导致超时或死锁。数据库检测到此类超时和死锁并返回错误。</p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-13B1103C-3E0E-4877-9CAF-A8D6337EDC68__EXPLICITLYACQUIRINGROWLOCKSORACLEDA-C873CAA2">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="sql-processing-for-application-developers.html#GUID-F91A26B7-2C41-4CC5-BB07-AA7E9ED58CAF">明确获取行锁</a></p>
                              </li>
                              <li>
                                 <p><a href="../sqlrf/LOCK-TABLE.html#SQLRF01605" target="_blank"><span class="italic">Oracle数据库SQL语言参考</span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-13B1103C-3E0E-4877-9CAF-A8D6337EDC68__GUID-660417FF-871B-4FCE-8C24-2B33BEA3C09E">话题：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="sql-processing-for-application-developers.html#GUID-A8754599-DD11-426D-B25A-F751D15DCC89">何时使用ROW SHARE MODE和ROW EXCLUSIVE MODE锁定</a></p>
                           </li>
                           <li>
                              <p><a href="sql-processing-for-application-developers.html#GUID-FE946AE2-5663-4DB2-94A7-10B9D8E9690B">何时使用SHARE MODE锁定</a></p>
                           </li>
                           <li>
                              <p><a href="sql-processing-for-application-developers.html#GUID-D6A96082-F790-499A-B1E8-5DA7392B741F">何时以SHARE ROW EXCLUSIVE MODE锁定</a></p>
                           </li>
                           <li>
                              <p><a href="sql-processing-for-application-developers.html#GUID-39749020-AE59-41BA-B42D-FB6A2242F9CA">何时使用EXCLUSIVE MODE锁定</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div><a id="ADFNS99942"></a><div class="props_rev_3"><a id="GUID-A8754599-DD11-426D-B25A-F751D15DCC89" name="GUID-A8754599-DD11-426D-B25A-F751D15DCC89"></a><h5 id="ADFNS-GUID-A8754599-DD11-426D-B25A-F751D15DCC89" class="sect5">何时使用ROW SHARE MODE和ROW EXCLUSIVE MODE锁定</h5>
                     <div>
                        <p><code class="codeph">ROW</code> <code class="codeph">SHARE</code> <code class="codeph">MODE</code>和<code class="codeph">ROW</code> <code class="codeph">EXCLUSIVE</code> <code class="codeph">MODE</code>表锁提供最高程度的并发性。如果出现以下情况，您可以使</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>在事务可以更新该表之前，您的事务必须阻止另一个事务获取表的中间共享，共享行或独占表锁。</p>
                              <p>如果另一个事务获取介入共享，共享行或独占表锁，则在锁定事务提交或回滚之前，其他任何事务都不能更新该表。</p>
                           </li>
                           <li>
                              <p>在事务可以修改该表之前，您的事务必须防止更改或删除表。</p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="ADFNS137"></a><a id="ADFNS99941"></a><div class="props_rev_3"><a id="GUID-FE946AE2-5663-4DB2-94A7-10B9D8E9690B" name="GUID-FE946AE2-5663-4DB2-94A7-10B9D8E9690B"></a><h5 id="ADFNS-GUID-FE946AE2-5663-4DB2-94A7-10B9D8E9690B" class="sect5">何时使用SHARE MODE锁定</h5>
                     <div>
                        <p><code class="codeph">SHARE</code> <code class="codeph">MODE</code>表锁是相当严格的数据锁。如果出现以下情况，您可以使</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您的事务仅查询表，并且在事务持续期间需要一致的表数据集。</p>
                           </li>
                           <li>
                              <p>您可以阻止尝试更新锁定表的其他事务，直到在表上保存<code class="codeph">SHARE</code> <code class="codeph">MODE</code>锁的所有事务都提交或回滚。
                              </p>
                           </li>
                           <li>
                              <p>其他事务可能在同一个表上获取并发<code class="codeph">SHARE</code> <code class="codeph">MODE</code>表锁，还为它们提供了事务级读取一致性的选项。
                              </p>
                              <div class="infoboxnote" id="GUID-FE946AE2-5663-4DB2-94A7-10B9D8E9690B__GUID-D5F3DACA-C334-4FA7-9098-8EADFE2F5944">
                                 <p class="notep1">警告：</p>
                                 <p>您的事务可能不会在稍后的同一事务中更新该表。但是，如果多个事务同时持有同一个表的共享表锁，则没有事务可以更新该表（即使由于<code class="codeph">SELECT</code> <code class="codeph">FOR</code> <code class="codeph">UPDATE</code>语句而保留行锁）。因此，如果同一个表上的并发共享表锁是常见的，则更新无法继续，并且死锁很常见。在这种情况下，请改用共享行独占或独占表锁。
                                 </p>
                              </div>
                           </li>
                        </ul>
                        <p><span class="bold">情景：</span>桌子<code class="codeph">employees</code>和<code class="codeph">budget_tab</code>需要一个一致的数据集在第三个表， <code class="codeph">departments</code> 。对于给定的部门编号，您希望更新<code class="codeph">employees</code>和<code class="codeph">budget_tab</code>的信息，并确保在这两个事务之间没有成员添加到部门。
                        </p>
                        <p><span class="bold">解决方案：</span>在<code class="codeph">SHARE</code> <code class="codeph">MODE</code>锁定<code class="codeph">departments</code>表，如<a href="sql-processing-for-application-developers.html#GUID-FE946AE2-5663-4DB2-94A7-10B9D8E9690B__CHDBHJJD">例8-1</a>所示。由于<code class="codeph">departments</code>表很少更新，因此锁定它可能不会导致许多其他事务等待很长时间。
                        </p>
                        <div class="example" id="GUID-FE946AE2-5663-4DB2-94A7-10B9D8E9690B__CHDBHJJD">
                           <p class="titleinexample">例8-1带共享模式的锁表</p><pre class="oac_no_warn" dir="ltr">- 创建并填充表：DROP TABLE budget_tab; CREATE TABLE budget_tab（sal NUMBER（8,2），deptno NUMBER（4））; INSERT INTO budget_tab（sal，deptno）SELECT salary，department_id FROM employees; - 锁定部门并更新员工和budget_tab： <span class="bold">LOCK TABLE部门IN SHARE MODE;</span> <span class="bold">UPDATE员工</span> SET薪水=工资* 1.1 WHERE department_id IN（SELECT department_id FROM departments WHERE location_id = 1700）; <span class="bold">UPDATE budget_tab</span> SET sal = sal * 1.1 WHERE deptno IN（SELECT department_id FROM departments WHERE location_id = 1700）; <span class="bold">承诺;</span> -  COMMIT释放锁定</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="ADFNS99940"></a><div class="props_rev_3"><a id="GUID-D6A96082-F790-499A-B1E8-5DA7392B741F" name="GUID-D6A96082-F790-499A-B1E8-5DA7392B741F"></a><h5 id="ADFNS-GUID-D6A96082-F790-499A-B1E8-5DA7392B741F" class="sect5">何时以SHARE ROW EXCLUSIVE MODE锁定</h5>
                     <div>
                        <p>如果出现以下情况，您可以使用<code class="codeph">SHARE</code> <code class="codeph">ROW</code> <code class="codeph">EXCLUSIVE</code> <code class="codeph">MODE</code>表锁：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您的事务需要指定表的事务级读取一致性以及更新锁定表的能力。</p>
                           </li>
                           <li>
                              <p>您不关心其他事务是否获得显式行锁（使用<code class="codeph">SELECT</code> <code class="codeph">FOR</code> <code class="codeph">UPDATE</code> ），这可能使锁定事务中的<code class="codeph">UPDATE</code>和<code class="codeph">INSERT</code>语句等待并可能导致死锁。
                              </p>
                           </li>
                           <li>
                              <p>您只需要一个事务就可以执行此操作。</p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="ADFNS99939"></a><div class="props_rev_3"><a id="GUID-39749020-AE59-41BA-B42D-FB6A2242F9CA" name="GUID-39749020-AE59-41BA-B42D-FB6A2242F9CA"></a><h5 id="ADFNS-GUID-39749020-AE59-41BA-B42D-FB6A2242F9CA" class="sect5">何时使用EXCLUSIVE MODE锁定</h5>
                     <div>
                        <p>如果出现以下情况，您可以使用<code class="codeph">EXCLUSIVE</code> <code class="codeph">MODE</code>表：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您的事务需要立即更新对锁定表的访问权限。当您的事务持有独占表锁时，其他事务无法锁定锁定表中的特定行。</p>
                           </li>
                           <li>
                              <p>在事务提交或回滚之前，您的事务还可确保锁定表的事务级读取一致性。</p>
                           </li>
                           <li>
                              <p>您并不关心数据并发性水平低，使得请求排它表锁的事务排队等待以顺序更新表。</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="ADFNS99938"></a><div class="props_rev_3"><a id="GUID-D75EFDA7-DBE5-4E35-A856-75859CAAECDE" name="GUID-D75EFDA7-DBE5-4E35-A856-75859CAAECDE"></a><h4 id="ADFNS-GUID-D75EFDA7-DBE5-4E35-A856-75859CAAECDE" class="sect4">让Oracle数据库控制表锁定</h4>
                  <div>
                     <div class="section">
                        <p>如果您让Oracle数据库控制表锁定，您的应用程序需要较少的编程逻辑，但与您自己管理表锁相比，其控制也较少。</p>
                        <p>发出语句<code class="codeph">SET</code> <code class="codeph">TRANSACTION</code> <code class="codeph">ISOLATION</code> <code class="codeph">LEVEL</code> <code class="codeph">SERIALIZABLE</code>或<code class="codeph">ALTER</code> <code class="codeph">SESSION</code> <code class="codeph">ISOLATION</code> <code class="codeph">LEVEL</code> <code class="codeph">SERIALIZABLE</code>保留ANSI可串行化而不改变底层锁定协议。此技术提供对表的并发访问，同时提供ANSI可序列化。获取表锁大大降低了并发性。
                        </p>
                        <div class="infoboxnotealso" id="GUID-D75EFDA7-DBE5-4E35-A856-75859CAAECDE__GUID-2CDA16A1-84CD-412E-94EA-6F2E63FA2929">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关<code class="codeph">SET</code> <code class="codeph">TRANSACTION</code>语句的信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=SQLRF01705" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                              </li>
                              <li>
                                 <p>有关<code class="codeph">ALTER</code> <code class="codeph">SESSION</code>语句的信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=SQLRF00901" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                              </li>
                           </ul>
                        </div>
                        <p>仅在关闭实例时更改这些参数的设置。如果多个实例正在访问单个数据库，则所有实例必须对这些参数使用相同的设置。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS99937"></a><div class="props_rev_3"><a id="GUID-F91A26B7-2C41-4CC5-BB07-AA7E9ED58CAF" name="GUID-F91A26B7-2C41-4CC5-BB07-AA7E9ED58CAF"></a><h4 id="ADFNS-GUID-F91A26B7-2C41-4CC5-BB07-AA7E9ED58CAF" class="sect4">明确获取行锁</h4>
                  <div>
                     <div class="section">
                        <p>您可以使用包含<code class="codeph">FOR</code> <code class="codeph">UPDATE</code>子句的<code class="codeph">SELECT</code>语句覆盖默认锁定。此语句获取所选行的独占行锁（如<code class="codeph">UPDATE</code>语句所做的那样），以期更新后续语句中的选定行。
                        </p>
                        <p>您可以使用<code class="codeph">SELECT</code> <code class="codeph">FOR</code> <code class="codeph">UPDATE</code>语句锁定行而不更改它。例如， <span>Oracle Database PL / SQL语言参考中的</span>几个触发器显示了如何实现参照完整性。在<code class="codeph">EMP_DEPT_CHECK</code>触发器中，包含引用的父键值的行被锁定，以保证它在事务持续期间保持不变;如果更新或删除父键，则违反参照完整性。
                        </p>
                        <p><code class="codeph">SELECT</code> <code class="codeph">FOR</code> <code class="codeph">UPDATE</code>语句通常由交互式程序使用，允许用户修改一个或多个特定行的字段（可能需要一些时间）;获取行锁，以便在任何给定时间只有一个交互式程序用户更新行。
                        </p>
                        <p>如果在定义游标时使用<code class="codeph">SELECT</code> <code class="codeph">FOR</code> <code class="codeph">UPDATE</code>语句，则在打开游标（第一次获取之前）时将锁定返回集中的行，而不是在从游标获取它们时将其锁定。只有在提交或回滚打开游标的事务时才会释放锁，而不是在游标关闭时释放。
                        </p>
                        <p><code class="codeph">SELECT</code> <code class="codeph">FOR</code> <code class="codeph">UPDATE</code>语句的返回集中的每一行都是单独锁定的; <code class="codeph">SELECT</code> <code class="codeph">FOR</code> <code class="codeph">UPDATE</code>语句一直等到另一个事务释放冲突的行锁。如果<code class="codeph">SELECT</code> <code class="codeph">FOR</code> <code class="codeph">UPDATE</code>语句锁定表中的许多行，并且如果表经历了很多更新活动，则获取<code class="codeph">EXCLUSIVE</code>表锁可能会更快。
                        </p>
                        <div class="infoboxnote" id="GUID-F91A26B7-2C41-4CC5-BB07-AA7E9ED58CAF__GUID-F39EDFD4-3745-4D92-96AD-BE26242B5799">
                           <p class="notep1">注意：</p>
                           <p>在查询运行时， <code class="codeph">SELECT</code> <code class="codeph">FOR</code> <code class="codeph">UPDATE</code>的返回集可能会更改;例如，如果查询选择的列已更新，或者在查询开始后删除了行。发生这种情况时， <code class="codeph">SELECT</code> <code class="codeph">FOR</code> <code class="codeph">UPDATE</code>获取未更改的行上的锁，使用这些锁获取表的读一致性快照，然后重新启动查询以获取剩余的锁。
                           </p>
                           <p>如果您的应用程序使用<code class="codeph">SELECT</code> <code class="codeph">FOR</code> <code class="codeph">UPDATE</code>语句，并且无法保证冲突的锁定请求不会导致用户导致的死锁 - 例如，通过确保表上的并发DML语句永远不会影响<code class="codeph">SELECT</code> <code class="codeph">FOR</code>查询的返回集<code class="codeph">UPDATE</code>语句 - 然后编写应用程序始终以适当的方式处理此类死锁（ORA-00060）。
                           </p>
                        </div>
                        <p>默认情况下， <code class="codeph">SELECT</code> <code class="codeph">FOR</code> <code class="codeph">UPDATE</code>语句将一直等到获取请求的行锁定。若要更改此行为，请使用<code class="codeph">SELECT</code> <code class="codeph">FOR</code> <code class="codeph">UPDATE</code>语句的<code class="codeph">NOWAIT</code> ， <code class="codeph">WAIT</code>或<code class="codeph">SKIP</code> <code class="codeph">LOCKED</code>子句。有关这些子句的信息，请参阅<span>Oracle数据库SQL语言参考</span> 。
                        </p>
                        <div class="infoboxnotealso" id="GUID-F91A26B7-2C41-4CC5-BB07-AA7E9ED58CAF__ORACLEDATABASEPLSQLLANGUAGEREFERENC-C874A80F">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=LNPLS020" target="_blank"><span class="italic">Oracle数据库PL / SQL语言参考</span></a></p>
                              </li>
                              <li>
                                 <p><a href="../sqlrf/SELECT.html#SQLRF01702" target="_blank"><span class="italic">Oracle数据库SQL语言参考</span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS138"></a><a id="ADFNS99936"></a><div class="props_rev_3"><a id="GUID-545CF5D2-1C85-470D-8D8A-CBF86EE95DA6" name="GUID-545CF5D2-1C85-470D-8D8A-CBF86EE95DA6"></a><h4 id="ADFNS-GUID-545CF5D2-1C85-470D-8D8A-CBF86EE95DA6" class="sect4">显式锁定下的并发示例</h4>
                  <div>
                     <p><a href="sql-processing-for-application-developers.html#GUID-545CF5D2-1C85-470D-8D8A-CBF86EE95DA6__BEJHACAH" title="此表显示了当使用LOCK TABLE语句和带有FOR UPDATE子句的SELECT语句时，Oracle数据库如何维护数据的并发性，完整性和一致性。为简洁起见，ORA-00054的消息文本（" resource="" busy="" and="" acquire="" with="" nowait="" specifie=")=" ="">表8-2</a>显示了当使用<code class="codeph">LOCK</code> <code class="codeph">TABLE</code>语句和带有<code class="codeph">FOR</code> <code class="codeph">UPDATE</code>子句的<code class="codeph">SELECT</code>语句时，Oracle数据库如何维护数据的并发性，完整性和一致性。为简洁起见，不包括ORA-00054的消息文本（“资源繁忙并且使用<code class="codeph">NOWAIT</code>指定获取”）。用户输入的文本为<span class="bold">粗体</span> 。
                     </p>
                     <div class="infoboxnote" id="GUID-545CF5D2-1C85-470D-8D8A-CBF86EE95DA6__GUID-D1038ABD-8AFB-49D9-A97D-C171A7720A6A">
                        <p class="notep1">注意：</p>
                        <p>在使用混合列压缩（HCC）压缩的表中，DML语句锁定压缩单元而不是行。</p>
                     </div>
                     <div class="tblformal" id="GUID-545CF5D2-1C85-470D-8D8A-CBF86EE95DA6__BEJHACAH">
                        <p class="titleintable">表8-2显式锁定下的并发示例</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="显式锁定下的并发示例" width="100%" border="1" summary="This table shows how Oracle Database maintains data concurrency, integrity, and consistency when the LOCK TABLE statement and the SELECT statement with the FOR UPDATE clause are used. For brevity, the message text for ORA-00054 (" resource="" busy="" and="" acquire="" with="" nowait="" specifie=")=" ="" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="26%" id="d22101e5024">时间点</th>
                                 <th align="left" valign="bottom" width="37%" id="d22101e5027">交易1</th>
                                 <th align="left" valign="bottom" width="38%" id="d22101e5030">交易2</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5035" headers="d22101e5024 ">
                                    <p>1</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5035 d22101e5027 "><pre class="oac_no_warn" dir="ltr"><span class="bold">LOCK TABLE hr.departments</span> <span class="bold">在ROW SHARE MODE中;</span>声明已处理。</pre></td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5035 d22101e5030 ">
                                    <p></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5049" headers="d22101e5024 ">
                                    <p>2</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5049 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5049 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">DROP TABLE hr.departments;</span> DROP TABLE hr.departments * ORA-00054</pre><p>（由于事务1已锁定表，因此无法进行独占DDL锁定。）</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5062" headers="d22101e5024 ">
                                    <p>3</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5062 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5062 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">LOCK TABLE hr.departments</span> <span class="bold">在EXCLUSIVE MODE</span> <span class="bold">NOWAIT;</span> ORA-00054</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5079" headers="d22101e5024 ">
                                    <p>4</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5079 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5079 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">SELECT location_id</span> <span class="bold">FROM hr.departments</span> <span class="bold">WHERE department_id = 20</span> <span class="bold">FOR更新location_id;</span> LOCATION_ID -----------选择DALLAS 1行。</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5099" headers="d22101e5024 ">
                                    <p>五</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5099 d22101e5027 "><pre class="oac_no_warn" dir="ltr"><span class="bold">UPDATE hr.departments</span> <span class="bold">SET location_id ='NEW</span> <span class="bold">YORK'WHERE</span> <span class="bold">department_id = 20;</span>
</pre><p>（等待，因为事务2锁定了相同的行。）</p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5099 d22101e5030 ">
                                    <p></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5118" headers="d22101e5024 ">
                                    <p>6</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5118 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5118 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">ROLLBACK;</span>
</pre><p>（释放行锁。）</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5131" headers="d22101e5024 ">
                                    <p>7</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5131 d22101e5027 "><pre class="oac_no_warn" dir="ltr">已完成1行处理。

<span class="bold">ROLLBACK;</span></pre></td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5131 d22101e5030 ">
                                    <p></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5142" headers="d22101e5024 ">
                                    <p>8</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5142 d22101e5027 "><pre class="oac_no_warn" dir="ltr"><span class="bold">LOCK TABLE hr.departments</span> <span class="bold">在ROW EXCLUSIVE MODE中;</span>声明已处理。</pre></td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5142 d22101e5030 ">
                                    <p></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5156" headers="d22101e5024 ">
                                    <p>9</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5156 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5156 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">LOCK TABLE hr.departments</span> <span class="bold">在EXCLUSIVE MODE</span> <span class="bold">NOWAIT;</span> ORA-00054</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5173" headers="d22101e5024 ">
                                    <p>10</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5173 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5173 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">LOCK TABLE hr.departments</span> <span class="bold">分享</span> <span class="bold">排行</span> <span class="bold">模式</span> <span class="bold">NOWAIT;</span> ORA-00054</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5190" headers="d22101e5024 ">
                                    <p>11</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5190 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5190 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">LOCK TABLE hr.departments</span> <span class="bold">分享</span> <span class="bold">排行</span> <span class="bold">模式</span> <span class="bold">NOWAIT;</span> ORA-00054</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5208" headers="d22101e5024 ">
                                    <p>12</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5208 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5208 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">UPDATE hr.departments</span> <span class="bold">SET location_id ='NEW</span> <span class="bold">YORK'WHERE</span> <span class="bold">department_id = 20;</span>已完成1行处理。</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5225" headers="d22101e5024 ">
                                    <p>13</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5225 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5225 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">ROLLBACK;</span></pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5235" headers="d22101e5024 ">
                                    <p>14</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5235 d22101e5027 "><pre class="oac_no_warn" dir="ltr"><span class="bold">SELECT location_id</span> <span class="bold">FROM hr.departments</span> <span class="bold">WHERE department_id = 20</span> <span class="bold">FOR更新location_id;</span> LOCATION_ID -----------选择DALLAS 1行。</pre></td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5235 d22101e5030 ">
                                    <p></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5255" headers="d22101e5024 ">
                                    <p>15</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5255 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5255 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">UPDATE hr.departments</span> <span class="bold">SET location_id ='NEW</span> <span class="bold">YORK'WHERE</span> <span class="bold">department_id = 20;</span>已完成1行处理。
</pre><p>（等待，因为事务1锁定了相同的行。）</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5274" headers="d22101e5024 ">
                                    <p>16</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5274 d22101e5027 "><pre class="oac_no_warn" dir="ltr"><span class="bold">ROLLBACK;</span></pre></td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5274 d22101e5030 ">
                                    <p></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5284" headers="d22101e5024 ">
                                    <p>17</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5284 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5284 d22101e5030 "><pre class="oac_no_warn" dir="ltr">已完成1行处理。
</pre><p>（已发布冲突锁定。）</p><pre class="oac_no_warn" dir="ltr"><span class="bold">ROLLBACK;</span></pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5298" headers="d22101e5024 ">
                                    <p>18</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5298 d22101e5027 "><pre class="oac_no_warn" dir="ltr"><span class="bold">LOCK TABLE hr.departments</span> <span class="bold">在ROW SHARE MODE</span>语句已处理。</pre></td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5298 d22101e5030 ">
                                    <p></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5312" headers="d22101e5024 ">
                                    <p>19</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5312 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5312 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">LOCK TABLE hr.departments</span> <span class="bold">在EXCLUSIVE MODE</span> <span class="bold">NOWAIT;</span> ORA-00054</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5329" headers="d22101e5024 ">
                                    <p>20</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5329 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5329 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">LOCK TABLE hr.departments</span> <span class="bold">分享</span> <span class="bold">排行</span> <span class="bold">模式</span> <span class="bold">NOWAIT;</span> ORA-00054</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5346" headers="d22101e5024 ">
                                    <p>21</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5346 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5346 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">LOCK TABLE hr.departments</span> <span class="bold">在SHARE MODE中;</span>声明已处理。</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5360" headers="d22101e5024 ">
                                    <p>22</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5360 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5360 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">SELECT location_id</span> <span class="bold">FROM hr.departments</span> <span class="bold">WHERE department_id = 20;</span> LOCATION_ID -----------选择DALLAS 1行。</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5378" headers="d22101e5024 ">
                                    <p>23</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5378 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5378 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">SELECT location_id</span> <span class="bold">FROM hr.departments</span> <span class="bold">WHERE department_id = 20</span> <span class="bold">FOR更新location_id;</span> LOCATION_ID -----------选择DALLAS 1行。</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5398" headers="d22101e5024 ">
                                    <p>24</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5398 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5398 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">UPDATE hr.departments</span> <span class="bold">SET location_id ='NEW</span> <span class="bold">YORK'WHERE</span> <span class="bold">department_id = 20;</span>
</pre><p>（等待因为事务1具有冲突的表锁定。）</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5417" headers="d22101e5024 ">
                                    <p>25</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5417 d22101e5027 "><pre class="oac_no_warn" dir="ltr"><span class="bold">ROLLBACK;</span></pre></td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5417 d22101e5030 ">
                                    <p></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5427" headers="d22101e5024 ">
                                    <p>26</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5427 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5427 d22101e5030 "><pre class="oac_no_warn" dir="ltr">已完成1行处理。
</pre><p>（发布冲突表锁。）</p><pre class="oac_no_warn" dir="ltr"><span class="bold">ROLLBACK;</span></pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5441" headers="d22101e5024 ">
                                    <p>27</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5441 d22101e5027 "><pre class="oac_no_warn" dir="ltr"><span class="bold">LOCK TABLE hr.departments</span> <span class="bold">分享行独家模式;</span>声明已处理。</pre></td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5441 d22101e5030 ">
                                    <p></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5455" headers="d22101e5024 ">
                                    <p>28</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5455 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5455 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">LOCK TABLE hr.departments</span> <span class="bold">在EXCLUSIVE MODE</span> <span class="bold">NOWAIT;</span> ORA-00054</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5472" headers="d22101e5024 ">
                                    <p>29</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5472 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5472 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">LOCK TABLE hr.departments</span> <span class="bold">分享</span> <span class="bold">排行</span> <span class="bold">模式</span> <span class="bold">NOWAIT;</span> ORA-00054</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5489" headers="d22101e5024 ">
                                    <p>三十</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5489 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5489 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">LOCK TABLE hr.departments</span> <span class="bold">分享模式</span> <span class="bold">NOWAIT;</span> ORA-00054</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5506" headers="d22101e5024 ">
                                    <p>31</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5506 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5506 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">LOCK TABLE hr.departments</span> <span class="bold">在ROW EXCLUSIVE MODE</span> <span class="bold">NOWAIT;</span> ORA-00054</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5523" headers="d22101e5024 ">
                                    <p>32</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5523 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5523 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">LOCK TABLE hr.departments</span> <span class="bold">分享模式</span> <span class="bold">NOWAIT;</span> ORA-00054</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5540" headers="d22101e5024 ">
                                    <p>33</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5540 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5540 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">SELECT location_id</span> <span class="bold">FROM hr.departments</span> <span class="bold">WHERE department_id = 20;</span> LOCATION_ID -----------选择DALLAS 1行。</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5558" headers="d22101e5024 ">
                                    <p>34</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5558 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5558 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">SELECT location_id</span> <span class="bold">FROM hr.departments</span> <span class="bold">WHERE department_id = 20</span> <span class="bold">FOR更新location_id;</span> LOCATION_ID -----------选择DALLAS 1行。</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5578" headers="d22101e5024 ">
                                    <p>35</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5578 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5578 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">UPDATE hr.departments</span> <span class="bold">SET location_id ='NEW</span> <span class="bold">YORK'WHERE</span> <span class="bold">department_id = 20;</span>
</pre><p>（等待因为事务1具有冲突的表锁定。）</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5597" headers="d22101e5024 ">
                                    <p>36</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5597 d22101e5027 "><pre class="oac_no_warn" dir="ltr"><span class="bold">UPDATE hr.departments</span> <span class="bold">SET location_id ='NEW</span> <span class="bold">YORK'WHERE</span> <span class="bold">department_id = 20;</span>
</pre><p>（等待，因为事务2锁定了相同的行。）</p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5597 d22101e5030 ">
                                    <p>（僵局。）</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5617" headers="d22101e5024 ">
                                    <p>37</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5617 d22101e5027 "><pre class="oac_no_warn" dir="ltr">取消操作。

<span class="bold">ROLLBACK;</span></pre></td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5617 d22101e5030 ">
                                    <p></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5628" headers="d22101e5024 ">
                                    <p>38</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5628 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5628 d22101e5030 "><pre class="oac_no_warn" dir="ltr">已完成1行处理。</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5637" headers="d22101e5024 ">
                                    <p>39</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5637 d22101e5027 "><pre class="oac_no_warn" dir="ltr"><span class="bold">LOCK TABLE hr.departments独占</span> <span class="bold">模式;</span></pre></td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5637 d22101e5030 ">
                                    <p></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5650" headers="d22101e5024 ">
                                    <p>40</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5650 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5650 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">LOCK TABLE hr.departments独占</span> <span class="bold">模式;</span> ORA-00054</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5664" headers="d22101e5024 ">
                                    <p>41</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5664 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5664 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">LOCK TABLE hr.departments</span> <span class="bold">在ROW EXCLUSIVE MODE</span> <span class="bold">NOWAIT;</span> ORA-00054</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5681" headers="d22101e5024 ">
                                    <p>42</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5681 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5681 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">LOCK TABLE hr.departments</span> <span class="bold">在SHARE MODE中;</span> ORA-00054</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5695" headers="d22101e5024 ">
                                    <p>43</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5695 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5695 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">LOCK TABLE hr.departments</span> <span class="bold">在ROW EXCLUSIVE MODE</span> <span class="bold">NOWAIT;</span> ORA-00054</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5712" headers="d22101e5024 ">
                                    <p>44</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5712 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5712 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">LOCK TABLE hr.departments</span> <span class="bold">在ROW SHARE MODE</span> <span class="bold">NOWAIT;</span> ORA-00054</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5730" headers="d22101e5024 ">
                                    <p>45</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5730 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5730 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">SELECT location_id</span> <span class="bold">FROM hr.departments</span> <span class="bold">WHERE department_id = 20;</span> LOCATION_ID -----------选择DALLAS 1行。</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5747" headers="d22101e5024 ">
                                    <p>46</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5747 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5747 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">SELECT location_id</span> <span class="bold">FROM hr.departments</span> <span class="bold">WHERE department_id = 20</span> <span class="bold">FOR更新location_id;</span>
</pre><p>（等待因为事务1具有冲突的表锁定。）</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5769" headers="d22101e5024 ">
                                    <p>47</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5769 d22101e5027 "><pre class="oac_no_warn" dir="ltr"><span class="bold">UPDATE hr.departments</span> <span class="bold">SET department_id = 30</span> <span class="bold">WHERE department_id = 20;</span>已完成1行处理。</pre></td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5769 d22101e5030 ">
                                    <p></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5786" headers="d22101e5024 ">
                                    <p>48</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5786 d22101e5027 "><pre class="oac_no_warn" dir="ltr"><span class="bold">承诺;</span></pre></td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5786 d22101e5030 ">
                                    <p></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5796" headers="d22101e5024 ">
                                    <p>49</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5796 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5796 d22101e5030 "><pre class="oac_no_warn" dir="ltr">选择了0行。
</pre><p>（交易1发布冲突锁定。）</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5807" headers="d22101e5024 ">
                                    <p>50</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5807 d22101e5027 "><pre class="oac_no_warn" dir="ltr"><span class="bold">SET TRANSACTION READ ONLY;</span></pre></td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5807 d22101e5030 ">
                                    <p></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5817" headers="d22101e5024 ">
                                    <p>51</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5817 d22101e5027 "><pre class="oac_no_warn" dir="ltr"><span class="bold">SELECT location_id</span> <span class="bold">FROM hr.departments</span> <span class="bold">WHERE department_id = 10;</span> LOCATION_ID -----------波士顿</pre></td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5817 d22101e5030 ">
                                    <p></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5834" headers="d22101e5024 ">
                                    <p>52</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5834 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5834 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">UPDATE hr.departments</span> <span class="bold">SET location_id ='NEW</span> <span class="bold">YORK'WHERE</span> <span class="bold">department_id = 10</span> ;已完成1行处理。</pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5851" headers="d22101e5024 ">
                                    <p>53</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5851 d22101e5027 "><pre class="oac_no_warn" dir="ltr"><span class="bold">SELECT location_id</span> <span class="bold">FROM hr.departments</span> <span class="bold">WHERE department_id = 10;</span> LOCATION_ID -----------波士顿</pre><p>（事务1没有看到未提交的数据。）</p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5851 d22101e5030 ">
                                    <p></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5870" headers="d22101e5024 ">
                                    <p>54</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5870 d22101e5027 ">
                                    <p></p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5870 d22101e5030 "><pre class="oac_no_warn" dir="ltr"><span class="bold">承诺;</span></pre></td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5880" headers="d22101e5024 ">
                                    <p>55</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5880 d22101e5027 "><pre class="oac_no_warn" dir="ltr"><span class="bold">SELECT location_id</span> <span class="bold">FROM hr.departments</span> <span class="bold">WHERE department_id = 10;</span> LOCATION_ID -----------波士顿</pre><p>（即使在事务2提交后，结果也相同。）</p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5880 d22101e5030 ">
                                    <p></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5900" headers="d22101e5024 ">
                                    <p>56</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5900 d22101e5027 "><pre class="oac_no_warn" dir="ltr"><span class="bold">承诺;</span></pre></td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5900 d22101e5030 ">
                                    <p></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d22101e5910" headers="d22101e5024 ">
                                    <p>57</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e5910 d22101e5027 "><pre class="oac_no_warn" dir="ltr"><span class="bold">SELECT location_id</span> <span class="bold">FROM hr.departments</span> <span class="bold">WHERE department_id = 10;</span> LOCATION_ID -----------纽约</pre><p>（查看已提交的数据。）</p>
                                 </td>
                                 <td align="left" valign="top" width="38%" headers="d22101e5910 d22101e5030 ">
                                    <p></p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="infoboxnotealso" id="GUID-545CF5D2-1C85-470D-8D8A-CBF86EE95DA6__GUID-C2AB77C0-C192-469A-A3B5-A5B7D01AF17B">
                        <p class="notep1">也可以看看：</p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=CNCPT89198" target="_blank"><span><cite>Oracle数据库概念</cite></span></a></div>
                  </div>
               </div>
            </div><a id="ADFNS978"></a><a id="ADFNS1002"></a><div class="props_rev_3"><a id="GUID-57365E45-5F85-471B-81D9-F52EA16F1E85" name="GUID-57365E45-5F85-471B-81D9-F52EA16F1E85"></a><h3 id="ADFNS-GUID-57365E45-5F85-471B-81D9-F52EA16F1E85" class="sect3">使用Oracle锁管理服务（用户锁）</h3>
               <div>
                  <div class="section">
                     <p>您的应用程序可以通过调用<code class="codeph">DBMS_LOCK</code>程序包的子程序来使用Oracle Lock Management服务（用户锁定）。应用程序可以请求锁定特定模式，为其指定唯一名称（在同一个或另一个实例中的另一个子程序中可识别），更改锁定模式并释放它。由于保留的用户锁是Oracle数据库锁，因此它具有数据库锁的所有功能，例如死锁检测。确保在<code class="codeph">COMMIT</code>上释放分布式事务中使用的任何用户锁，否则可能发生未检测到的死锁。
                     </p>
                     <div class="infoboxnotealso" id="GUID-57365E45-5F85-471B-81D9-F52EA16F1E85__GUID-8B91392F-3A40-47E7-9294-F53C6FDDC1FB">
                        <p class="notep1">也可以看看：</p>
                        <p>有关<code class="codeph">DBMS_LOCK</code>程序包的详细信息，请<code class="codeph">DBMS_LOCK</code> <a href="../arpls/DBMS_LOCK.html#ARPLS021" target="_blank"><span class="italic">Oracle Database PL / SQL程序包和类型参考</span></a></p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-57365E45-5F85-471B-81D9-F52EA16F1E85__GUID-5BA4D1BC-C515-4D8B-AA34-3FA75A02843A">话题：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="sql-processing-for-application-developers.html#GUID-11942D2D-9C1B-478C-BDD6-11FC1533CB3A">何时使用用户锁</a></p>
                        </li>
                        <li>
                           <p><a href="sql-processing-for-application-developers.html#GUID-7970D35C-4236-4CBD-8440-63A52FDA08A6">查看和监控锁</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS139"></a><a id="ADFNS99935"></a><div class="props_rev_3"><a id="GUID-11942D2D-9C1B-478C-BDD6-11FC1533CB3A" name="GUID-11942D2D-9C1B-478C-BDD6-11FC1533CB3A"></a><h4 id="ADFNS-GUID-11942D2D-9C1B-478C-BDD6-11FC1533CB3A" class="sect4">何时使用用户锁</h4>
                  <div>
                     <p>用户锁可以帮助：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>提供对设备（例如终端）的独占访问</p>
                        </li>
                        <li>
                           <p>提供读锁的应用程序级实施</p>
                        </li>
                        <li>
                           <p>检测锁定何时释放并在应用程序后进行清理</p>
                        </li>
                        <li>
                           <p>同步应用程序并强制执行顺序处理</p>
                        </li>
                     </ul>
                     <p><a href="sql-processing-for-application-developers.html#GUID-11942D2D-9C1B-478C-BDD6-11FC1533CB3A__BEJFEIIH">例8-2</a>显示了Pro * COBOL预编译器如何使用锁来确保当多人必须访问单个设备时没有冲突。
                     </p>
                     <div class="example" id="GUID-11942D2D-9C1B-478C-BDD6-11FC1533CB3A__BEJFEIIH">
                        <p class="titleinexample">示例8-2 Pro * COBOL预编译器如何使用锁定</p><pre class="oac_no_warn" dir="ltr">************************************************** **************** *打印支票* *任何收银员都可以向退货的客户退款。* * 50美元以下的退款以现金支付，超过50美元的支票。* *此代码打印支票。所有* *收银员都打开一台打印机，以避免每次检查打开和关闭* *的开销，这意味着如果您不确保独占* *访问打印机，多个* *收银员的输出行可能会交错。DBMS_LOCK包用于* *确保独占访问。* ************************************************* ***************** CHECK-PRINT *获取打印机锁的“手柄”锁。将“CHECKPRINT”移至LOCKNAME-ARR。移动10到LOCKNAME-LEN。 EXEC SQL EXECUTE BEGIN DBMS_LOCK.ALLOCATE_UNIQUE（：LOCKNAME，：LOCKHANDLE）;结束; END-EXEC。 *以独占模式锁定打印机（默认模式）。EXEC SQL EXECUTE BEGIN DBMS_LOCK.REQUEST（：LOCKHANDLE）;结束; END-EXEC。 *您现在独家使用打印机，打印支票。...*解锁打印机，以便其他人可以使用它EXEC SQL EXECUTE BEGIN DBMS_LOCK.RELEASE（：LOCKHANDLE）;结束; END-EXEC。</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="ADFNS140"></a><a id="ADFNS99934"></a><div class="props_rev_3"><a id="GUID-7970D35C-4236-4CBD-8440-63A52FDA08A6" name="GUID-7970D35C-4236-4CBD-8440-63A52FDA08A6"></a><h4 id="ADFNS-GUID-7970D35C-4236-4CBD-8440-63A52FDA08A6" class="sect4">查看和监控锁</h4>
                  <div>
                     <div class="section">
                        <p><a href="sql-processing-for-application-developers.html#GUID-7970D35C-4236-4CBD-8440-63A52FDA08A6__BEJFHIIJ" title="此表描述了显示实例中正在进行的事务的锁定信息的Oracle数据库工具。">表8-3</a>描述了显示实例中正在进行的事务的锁定信息的Oracle数据库工具。
                        </p>
                        <div class="tblformal" id="GUID-7970D35C-4236-4CBD-8440-63A52FDA08A6__BEJFHIIJ">
                           <p class="titleintable">表8-3显示锁定信息的方法</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="显示锁定信息的方法" width="100%" border="1" summary="This table describes the Oracle Database facilities that display locking information for on-going transactions within an instance." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="26%" id="d22101e6312">工具</th>
                                    <th align="left" valign="bottom" width="74%" id="d22101e6315">描述</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="26%" id="d22101e6320" headers="d22101e6312 ">
                                       <p>性能监控数据字典视图</p>
                                    </td>
                                    <td align="left" valign="top" width="74%" headers="d22101e6320 d22101e6315 ">
                                       <p>请参见“ <a href="../admin/monitoring-the-database.html#ADMIN11256" target="_blank"><span class="italic">Oracle数据库管理员指南”</span></a> 。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="26%" id="d22101e6332" headers="d22101e6312 ">
                                       <p><code class="codeph">UTLLOCKT</code> 。 <code class="codeph">SQL</code></p>
                                    </td>
                                    <td align="left" valign="top" width="74%" headers="d22101e6332 d22101e6315 ">
                                       <p><code class="codeph">UTLLOCKT</code> 。 <code class="codeph">SQL</code>脚本以树形结构的方式显示简单的字符锁等待图。使用任何SQL工具（例如SQL * Plus）来运行脚本，它会打印系统中等待锁定的会话和相应的阻塞锁定。此脚本文件的位置取决于操作系统。（您必须运行<code class="codeph">CATBLOCK</code> 。 <code class="codeph">SQL</code>使用前脚本<code class="codeph">UTLLOCKT</code> 。 <code class="codeph">SQL</code> 。）
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="ADFNS979"></a><a id="ADFNS00204"></a><div class="props_rev_3"><a id="GUID-8280E670-B337-4D6D-8BF4-861B8B3947AA" name="GUID-8280E670-B337-4D6D-8BF4-861B8B3947AA"></a><h3 id="ADFNS-GUID-8280E670-B337-4D6D-8BF4-861B8B3947AA" class="sect3">使用Serializable Transactions进行并发控制</h3>
               <div>
                  <div class="section">
                     <p>默认情况下，Oracle数据库允许同时运行事务来修改，添加或删除同一表中和同一数据块中的行。当事务A更改表时，对于并发运行的事务，更改是不可见的，直到事务A提交它们为止。如果事务A尝试更新或删除事务B已锁定的行（通过发出DML或<code class="codeph">SELECT</code> <code class="codeph">FOR</code> <code class="codeph">UPDATE</code>语句），则A发出的DML语句将等待，直到B提交或回滚事务。这种并发模型可提供更高的并发性，从而提高性能，适用于大多数应用程序。
                     </p>
                     <p>但是，一些罕见的应用需要可序列化的事务。<span class="bold">可序列化事务</span>以序列化模式并发运行。在<span class="bold">序列化模式下</span> ，并发事务只能进行数据库更改，如果它们以串行方式运行（即一次一个）。如果序列化事务尝试更改序列化事务开始后另一个事务更改的数据，则会发生错误ORA-08177。
                     </p>
                     <p>当可序列化事务因ORA-08177而失败时，应用程序可以执行以下任何操作：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>将执行的工作提交到那一点。</p>
                        </li>
                        <li>
                           <p>可能在回滚到事务中的先前保存点之后运行其他不同的语句。</p>
                        </li>
                        <li>
                           <p>回滚事务，然后重新运行它。</p>
                           <p>事务获取事务快照，操作可能成功。</p>
                           <div class="infobox-tip" id="GUID-8280E670-B337-4D6D-8BF4-861B8B3947AA__GUID-6C6B6B51-9534-47C7-8872-034DF06FAF8D">
                              <p class="notep1">小费：</p>
                              <p>要最小化回滚和重新运行事务的性能开销，请在事务开始附近放置可能与并发事务冲突的DML语句。</p>
                           </div>
                        </li>
                     </ul>
                     <div class="infoboxnote" id="GUID-8280E670-B337-4D6D-8BF4-861B8B3947AA__GUID-CAF0D3BF-9466-4A6B-B7A6-1D08CA48AAFD">
                        <p class="notep1">注意：</p>
                        <p>可序列化事务不适用于延迟段创建或间隔分区。尝试将数据插入到没有创建段的空表中，或者插入到没有段的间隔分区表的分区中会导致错误。</p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-8280E670-B337-4D6D-8BF4-861B8B3947AA__GUID-6C6AC8BF-EA07-4CCA-A148-AC425B694C50">话题：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="sql-processing-for-application-developers.html#GUID-6F888B25-FB84-456F-BF6E-675C955D3E52">事务交互和隔离级别</a></p>
                        </li>
                        <li>
                           <p><a href="sql-processing-for-application-developers.html#GUID-E79D04D4-6543-49B3-BAEB-D6585EE67AD7">设置隔离级别</a></p>
                        </li>
                        <li>
                           <p><a href="sql-processing-for-application-developers.html#GUID-0D8BC3FD-832F-4CF2-B6E0-75DD1D3D5A4C">可序列化事务和参照完整性</a></p>
                        </li>
                        <li>
                           <p><a href="sql-processing-for-application-developers.html#GUID-A64426E3-1A1E-48CF-BF6B-1452BA76E179">读取COMMTIONED和SERIALIZABLE隔离级别</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS141"></a><a id="ADFNS142"></a><a id="ADFNS143"></a><a id="ADFNS99871"></a><div class="props_rev_3"><a id="GUID-6F888B25-FB84-456F-BF6E-675C955D3E52" name="GUID-6F888B25-FB84-456F-BF6E-675C955D3E52"></a><h4 id="ADFNS-GUID-6F888B25-FB84-456F-BF6E-675C955D3E52" class="sect4">事务交互和隔离级别</h4>
                  <div>
                     <p>ANSI / ISO SQL标准定义了三种事务交互：</p>
                     <div class="tblformal" id="GUID-6F888B25-FB84-456F-BF6E-675C955D3E52__GUID-FF7D9FCC-FF29-487C-8CA1-90D9479E7DE4">
                        <table cellpadding="4" cellspacing="0" class="Formal" title="" width="100%" border="1" summary="This table lists and defines the three kinds of transaction interactions that the ANSI/ISO SQL standard defines." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="30%" id="d22101e6727">交易互动</th>
                                 <th align="left" valign="bottom" width="70%" id="d22101e6730">定义</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="30%" id="d22101e6735" headers="d22101e6727 ">
                                    <p>脏读</p>
                                 </td>
                                 <td align="left" valign="top" width="70%" headers="d22101e6735 d22101e6730 ">
                                    <p>事务A读取事务B所做的未提交的更改。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="30%" id="d22101e6742" headers="d22101e6727 ">
                                    <p>不可重复的阅读</p>
                                 </td>
                                 <td align="left" valign="top" width="70%" headers="d22101e6742 d22101e6730 ">
                                    <p>事务A读取数据，事务B更改数据并提交更改，事务A重新读取数据并查看更改。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="30%" id="d22101e6749" headers="d22101e6727 ">
                                    <p>幻影阅读</p>
                                 </td>
                                 <td align="left" valign="top" width="70%" headers="d22101e6749 d22101e6730 ">
                                    <p>事务A运行查询，事务B插入新行并提交更改，事务A重复查询并查看新行。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>事务可以具有的交互类型由其隔离级别决定。ANSI / ISO SQL标准定义了四个事务隔离级别。<a href="sql-processing-for-application-developers.html#GUID-6F888B25-FB84-456F-BF6E-675C955D3E52__G1026777" title="此表列出了ANSI / ISO SQL标准定义的四个事务隔离级别，并显示了每个级别可能的事务交互类型。">表8-4</a>显示了每个隔离级别可能的交互类型。
                     </p>
                     <div class="tblformal" id="GUID-6F888B25-FB84-456F-BF6E-675C955D3E52__G1026777">
                        <p class="titleintable">表8-4 ANSI / ISO SQL隔离级别和可能的事务交互</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="ANSI / ISO SQL隔离级别和可能的事务交互" width="100%" border="1" summary="This table lists the four transaction isolation levels that the ANSI/ISO SQL standard defines and shows the kinds of transaction interactions possible at each level." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="24%" id="d22101e6774">隔离级别</th>
                                 <th align="left" valign="bottom" width="15%" id="d22101e6777">脏读</th>
                                 <th align="left" valign="bottom" width="24%" id="d22101e6780">不可重复阅读</th>
                                 <th align="left" valign="bottom" width="37%" id="d22101e6783">幻影阅读</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d22101e6788" headers="d22101e6774 ">
                                    <p><code class="codeph">READ</code> <code class="codeph">UNCOMMITTED</code></p>
                                 </td>
                                 <td align="left" valign="top" width="15%" headers="d22101e6788 d22101e6777 ">
                                    <p>可能</p>
                                 </td>
                                 <td align="left" valign="top" width="24%" headers="d22101e6788 d22101e6780 ">
                                    <p>可能</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e6788 d22101e6783 ">
                                    <p>可能</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d22101e6805" headers="d22101e6774 ">
                                    <p><code class="codeph">READ</code> <code class="codeph">COMMITTED</code></p>
                                 </td>
                                 <td align="left" valign="top" width="15%" headers="d22101e6805 d22101e6777 ">
                                    <p>不可能</p>
                                 </td>
                                 <td align="left" valign="top" width="24%" headers="d22101e6805 d22101e6780 ">
                                    <p>可能</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e6805 d22101e6783 ">
                                    <p>可能</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d22101e6822" headers="d22101e6774 ">
                                    <p><code class="codeph">REPEATABLE</code> <code class="codeph">READ</code></p>
                                 </td>
                                 <td align="left" valign="top" width="15%" headers="d22101e6822 d22101e6777 ">
                                    <p>不可能</p>
                                 </td>
                                 <td align="left" valign="top" width="24%" headers="d22101e6822 d22101e6780 ">
                                    <p>不可能</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e6822 d22101e6783 ">
                                    <p>可能</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d22101e6839" headers="d22101e6774 ">
                                    <p><code class="codeph">SERIALIZABLE</code></p>
                                 </td>
                                 <td align="left" valign="top" width="15%" headers="d22101e6839 d22101e6777 ">
                                    <p>不可能</p>
                                 </td>
                                 <td align="left" valign="top" width="24%" headers="d22101e6839 d22101e6780 ">
                                    <p>不可能</p>
                                 </td>
                                 <td align="left" valign="top" width="37%" headers="d22101e6839 d22101e6783 ">
                                    <p>不可能</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p><a href="sql-processing-for-application-developers.html#GUID-6F888B25-FB84-456F-BF6E-675C955D3E52__G1026806" title="此表描述了Oracle数据库关于ANSI / ISO SQL标准SQL92定义的隔离级别的操作。">表8-5</a>显示了Oracle数据库提供的ANSI / ISO SQL事务隔离级别。
                     </p>
                     <div class="tblformal" id="GUID-6F888B25-FB84-456F-BF6E-675C955D3E52__G1026806">
                        <p class="titleintable">表8-5 Oracle数据库提供的ANSI / ISO SQL隔离级别</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="Oracle数据库提供的ANSI / ISO SQL隔离级别" width="100%" border="1" summary="This table describes the action of Oracle Database with respect to the isolation levels that the ANSI/ISO SQL standard SQL92 defines." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="24%" id="d22101e6868">隔离级别</th>
                                 <th align="left" valign="bottom" width="76%" id="d22101e6871">由Oracle数据库提供</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d22101e6876" headers="d22101e6868 ">
                                    <p><code class="codeph">READ</code> <code class="codeph">UNCOMMITTED</code></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d22101e6876 d22101e6871 ">
                                    <p>不，Oracle数据库永远不会允许“脏读”。其他一些数据库产品使用这种不受欢迎的技术来提高吞吐量，但Oracle数据库的高吞吐量并不需要它。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d22101e6887" headers="d22101e6868 ">
                                    <p><code class="codeph">READ</code> <code class="codeph">COMMITTED</code></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d22101e6887 d22101e6871 ">
                                    <p>是的，默认情况下。事实上，由于Oracle数据库的查询只能看到在该查询（快照时间）开始时提交的数据，Oracle数据库比ANSI / ISO SQL标准提供了更多的一致性<code class="codeph">READ</code> <code class="codeph">COMMITTED</code>隔离需要。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d22101e6904" headers="d22101e6868 ">
                                    <p><code class="codeph">REPEATABLE</code> <code class="codeph">READ</code></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d22101e6904 d22101e6871 ">
                                    <p>是的，如果将事务隔离级别设置为<code class="codeph">SERIALIZABLE</code> 。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d22101e6918" headers="d22101e6868 ">
                                    <p><code class="codeph">SERIALIZABLE</code></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d22101e6918 d22101e6871 ">
                                    <p>是的，如果将事务隔离级别设置为<code class="codeph">SERIALIZABLE</code> 。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p><a href="sql-processing-for-application-developers.html#GUID-6F888B25-FB84-456F-BF6E-675C955D3E52__I1025588">图8-1</a>显示了任意事务（即<code class="codeph">SERIALIZABLE</code>或<code class="codeph">READ</code> <code class="codeph">COMMITTED</code> ）如何与可序列化事务交互。
                     </p>
                     <div class="figure" id="GUID-6F888B25-FB84-456F-BF6E-675C955D3E52__I1025588">
                        <p class="titleinfigure">图8-1可序列化事务与另一个事务之间的交互</p><img src="img/adfns053.gif" alt="下面是图8-1的描述" title="下面是图8-1的描述" longdesc="img_text/adfns053.html"><br><a href="img_text/adfns053.html">“图8-1可序列化事务与另一个事务之间的交互”的描述</a></div>
                     <!-- class="figure" -->
                  </div>
               </div><a id="ADFNS99932"></a><div class="props_rev_3"><a id="GUID-E79D04D4-6543-49B3-BAEB-D6585EE67AD7" name="GUID-E79D04D4-6543-49B3-BAEB-D6585EE67AD7"></a><h4 id="ADFNS-GUID-E79D04D4-6543-49B3-BAEB-D6585EE67AD7" class="sect4">设置隔离级别</h4>
                  <div>
                     <div class="section">
                        <p>要为会话中的每个事务设置事务隔离级别，请使用<code class="codeph">ALTER</code> <code class="codeph">SESSION</code>语句。
                        </p>
                        <p>要为特定事务设置事务隔离级别，请使用<code class="codeph">SET</code> <code class="codeph">TRANSACTION</code>语句的<code class="codeph">ISOLATION</code> <code class="codeph">LEVEL</code>子句。<code class="codeph">SET</code> <code class="codeph">TRANSACTION</code>语句必须是事务中的第一个语句。
                        </p>
                        <div class="infoboxnote" id="GUID-E79D04D4-6543-49B3-BAEB-D6585EE67AD7__GUID-1933FF5D-C495-4C7F-86D1-1171209840D6">
                           <p class="notep1">注意：</p>
                           <p>如果将事务隔离级别设置为<code class="codeph">SERIALIZABLE</code> ，则必须使用<code class="codeph">ALTER</code> <code class="codeph">TABLE</code>语句将<code class="codeph">INITRANS</code>参数设置为至少3。对于许多事务更新相同块的表使用更高的值。有关<code class="codeph">INITRANS</code>更多信息。</p>
                        </div>
                        <div class="infoboxnotealso" id="GUID-E79D04D4-6543-49B3-BAEB-D6585EE67AD7__GUID-56ABCF23-EAEC-428A-978C-E3DA47DC62B2">
                           <p class="notep1">也可以看看：</p><a href="../sqlrf/Introduction-to-Oracle-SQL.html#SQLRF-GUID-049B7AE8-11E1-4110-B3E4-D117907D77AC" target="_blank"><span class="italic">Oracle数据库SQL语言参考</span></a></div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS144"></a><a id="ADFNS99996"></a><div class="props_rev_3"><a id="GUID-0D8BC3FD-832F-4CF2-B6E0-75DD1D3D5A4C" name="GUID-0D8BC3FD-832F-4CF2-B6E0-75DD1D3D5A4C"></a><h4 id="ADFNS-GUID-0D8BC3FD-832F-4CF2-B6E0-75DD1D3D5A4C" class="sect4">可序列化事务和参照完整性</h4>
                  <div>
                     <p>由于Oracle数据库不使用读锁，即使在<code class="codeph">SERIALIZABLE</code>事务中，一个事务读取的数据也可以被另一个事务覆盖。因此，在应用程序级别执行数据库一致性检查的事务不得假定它们读取的数据在事务期间不会更改（即使此类更改对事务不可见）。即使使用<code class="codeph">SERIALIZABLE</code>事务，也要仔细<code class="codeph">SERIALIZABLE</code>应用程序级别的一致性检查。
                     </p>
                     <p>在<a href="sql-processing-for-application-developers.html#GUID-0D8BC3FD-832F-4CF2-B6E0-75DD1D3D5A4C__I1020116">图8-2中</a> ，事务A和B（ <code class="codeph">READ</code> <code class="codeph">COMMITTED</code>或<code class="codeph">SERIALIZABLE</code> ）执行应用程序级别检查以维护两个表之间的父/子关系的引用完整性。在将相应的子行插入子表之前，事务A查询父表以检查它是否具有具有特定主键值的行。在从父表中删除相应的父行之前，事务B查询子表以检查特定主键值是否存在子行。两个事务都假定（但不确保）它们读取的数据在事务完成之前不会更改。
                     </p>
                     <div class="figure" id="GUID-0D8BC3FD-832F-4CF2-B6E0-75DD1D3D5A4C__I1020116">
                        <p class="titleinfigure">图8-2参照完整性检查</p><img src="img/adfns054.gif" alt="下面是图8-2的描述" title="下面是图8-2的描述" longdesc="img_text/adfns054.html"><br><a href="img_text/adfns054.html">“图8-2参照完整性检查”的说明</a></div>
                     <!-- class="figure" -->
                     <p>事务A的查询不会阻止事务B删除父行，而事务B的查询也不会阻止事务A插入子行。因此，这可能发生：</p>
                     <ol>
                        <li>
                           <p>事务A查询父表并查找指定的父行。</p>
                        </li>
                        <li>
                           <p>事务B查询子表，并且找不到指定父行的子行。</p>
                        </li>
                        <li id="GUID-0D8BC3FD-832F-4CF2-B6E0-75DD1D3D5A4C__BEJDJJFC">
                           <p>找到指定的父行后，事务A将相应的子行插入子表。</p>
                        </li>
                        <li>
                           <p>找不到指定父行的子行，事务B从父表中删除指定的父行。</p>
                           <p>现在，在步骤<a href="sql-processing-for-application-developers.html#GUID-0D8BC3FD-832F-4CF2-B6E0-75DD1D3D5A4C__BEJDJJFC">3中</a>插入的事务A的子行没有父行。
                           </p>
                        </li>
                     </ol>
                     <p>即使A和B都是<code class="codeph">SERIALIZABLE</code>事务，也可能发生上述结果，因为两个事务都不会阻止另一个事务更改它读取的数据以检查一致性。
                     </p>
                     <p>确保一个事务查询的数据不会被另一个事务同时更改或删除，这需要比ANSI / ISO SQL标准<code class="codeph">SERIALIZABLE</code>隔离级别提供的事务隔离更多。但是，在Oracle数据库中：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>事务A可以使用<code class="codeph">SELECT</code> <code class="codeph">FOR</code> <code class="codeph">UPDATE</code>语句来查询和锁定父行，从而防止事务B删除它。
                           </p>
                        </li>
                        <li>
                           <p>事务B可以通过颠倒其处理步骤的顺序来防止事务A找到父行（从而防止A插入子行）。也就是说，交易B可以：</p>
                           <ol>
                              <li>
                                 <p>删除父行。</p>
                              </li>
                              <li>
                                 <p>查询子表。</p>
                              </li>
                              <li>
                                 <p>如果已删除的父行在子表中具有子行，则回滚删除父行。</p>
                              </li>
                           </ol>
                        </li>
                     </ul>
                     <p>或者，您可以使用触发器强制引用完整性。而不是让事务A查询父表，而是在子表上定义执行此操作的行级<code class="codeph">BEFORE</code> <code class="codeph">INSERT</code>触发器：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>使用<code class="codeph">SELECT</code> <code class="codeph">FOR</code> <code class="codeph">UPDATE</code>语句查询父表，从而确保如果父行存在，那么它将在插入子行的事务期间保留在数据库中。
                           </p>
                        </li>
                        <li>
                           <p>如果父行不存在，则拒绝插入子行。</p>
                        </li>
                     </ul>
                     <p>触发器在触发语句的上下文中运行SQL语句（即，触发和触发语句在相同状态下查看数据库）。因此，如果<code class="codeph">READ</code> <code class="codeph">COMMITTED</code>事务运行触发语句，则触发语句会在触发语句开始执行时看到数据库。如果<code class="codeph">SERIALIZABLE</code>事务运行触发语句，则触发的语句将查看事务开始时的数据库。在任何一种情况下，在触发器中使用<code class="codeph">SELECT</code> <code class="codeph">FOR</code> <code class="codeph">UPDATE</code>正确地强制执行参照完整性。
                     </p>
                     <div class="infoboxnotealso" id="GUID-0D8BC3FD-832F-4CF2-B6E0-75DD1D3D5A4C__GUID-46889C84-5771-48D2-A18E-9B8117411FA8">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>有关<code class="codeph">SELECT</code>语句的<code class="codeph">FOR</code> <code class="codeph">UPDATE</code>子句的信息，请<a href="../sqlrf/SELECT.html#SQLRF55370" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                           </li>
                           <li>
                              <p>有关使用触发器维护父表和子表之间的引用完整性的更多信息，请参阅<a href="../lnpls/plsql-triggers.html#LNPLS770" target="_blank"><span class="italic">Oracle数据库PL / SQL语言参考</span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="ADFNS980"></a><a id="ADFNS99999"></a><div class="props_rev_3"><a id="GUID-A64426E3-1A1E-48CF-BF6B-1452BA76E179" name="GUID-A64426E3-1A1E-48CF-BF6B-1452BA76E179"></a><h4 id="ADFNS-GUID-A64426E3-1A1E-48CF-BF6B-1452BA76E179" class="sect4">读取COMMTIONED和SERIALIZABLE隔离级别</h4>
                  <div>
                     <p>Oracle数据库提供两个事务隔离级别， <code class="codeph">READ</code> <code class="codeph">COMMITTED</code>和<code class="codeph">SERIALIZABLE</code> 。这两个级别都提供高度一致性和并发性，减少争用，并且专为实际应用程序而设计。本主题对它们进行了比较，并说明了如何在它们之间进
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-A64426E3-1A1E-48CF-BF6B-1452BA76E179__GUID-EA46ACB1-5941-4C98-9AC8-367113BF17ED">话题：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="sql-processing-for-application-developers.html#GUID-AA59261B-EAA7-40F1-AAF4-D38A921B4AC7">交易集合一致性差异</a></p>
                           </li>
                           <li>
                              <p><a href="sql-processing-for-application-developers.html#GUID-AFD88739-88E5-446F-8FAA-0B56473A43E1">选择事务隔离级别</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div><a id="ADFNS981"></a><a id="ADFNS99997"></a><div class="props_rev_3"><a id="GUID-AA59261B-EAA7-40F1-AAF4-D38A921B4AC7" name="GUID-AA59261B-EAA7-40F1-AAF4-D38A921B4AC7"></a><h5 id="ADFNS-GUID-AA59261B-EAA7-40F1-AAF4-D38A921B4AC7" class="sect5">交易集合一致性差异</h5>
                     <div>
                        <p>如果所有读取操作都返回由同一组已提交事务写入的数据，则操作（查询或事务）是<strong class="term">事务集一致的</strong> 。当操作不是事务集一致时，它的一些读操作反映了一组事务的变化，而其他操作反映了其他事务集的变化;也就是说，操作将数据库视为不反映任何一组已提交事务的状态。
                        </p>
                        <div class="section">
                           <p class="subhead3" id="GUID-AA59261B-EAA7-40F1-AAF4-D38A921B4AC7__GUID-1DBF254E-F7CB-42B5-B87A-BDC8483338ED">话题：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="sql-processing-for-application-developers.html#GUID-1293D396-CE63-46E7-BAAB-B140709C15B1">Oracle数据库</a></p>
                              </li>
                              <li>
                                 <p><a href="sql-processing-for-application-developers.html#GUID-90BB830A-DC7E-49DD-B778-5FEEE7FDF00F">其他数据库系统</a></p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                     </div><a id="ADFNS982"></a><div class="props_rev_3"><a id="GUID-1293D396-CE63-46E7-BAAB-B140709C15B1" name="GUID-1293D396-CE63-46E7-BAAB-B140709C15B1"></a><h6 id="ADFNS-GUID-1293D396-CE63-46E7-BAAB-B140709C15B1" class="sect6">Oracle数据库</h6>
                        <div>
                           <p>具有<code class="codeph">READ</code> <code class="codeph">COMMITTED</code>隔离级别的Oracle数据库事务在单个语句的基础上是事务集一致，因为查询读取的所有行必须在查询开始之前提交。
                           </p>
                           <p>具有<code class="codeph">SERIALIZABLE</code>隔离级别的Oracle数据库事务在单个事务的基础上是事务集一致的，因为<code class="codeph">SERIALIZABLE</code>事务中的所有语句都在数据库的映像上运行，就像在事务开始时一样。
                           </p>
                        </div>
                     </div><a id="ADFNS983"></a><div class="props_rev_3"><a id="GUID-90BB830A-DC7E-49DD-B778-5FEEE7FDF00F" name="GUID-90BB830A-DC7E-49DD-B778-5FEEE7FDF00F"></a><h6 id="ADFNS-GUID-90BB830A-DC7E-49DD-B778-5FEEE7FDF00F" class="sect6">其他数据库系统</h6>
                        <div>
                           <p>在其他数据库系统中，具有<code class="codeph">READ</code> <code class="codeph">UNCOMMITTED</code>隔离级别的单个查询不是事务集一致，因为它可能只看到另一个事务所做的更改的子集。例如，主表与详细信息表的连接可以看到由另一个事务插入的主记录，但不能看到该事务插入的相应详细信息（或反向）。<code class="codeph">READ</code> <code class="codeph">COMMITTED</code>隔离级别避免了这个问题，提供了比读锁定系统更多的一致性。
                           </p>
                           <p>在读锁定系统中，以防止并发更新为代价， <code class="codeph">REPEATABLE</code> <code class="codeph">READ</code>隔离级别在语句级别提供事务集一致性，但不在事务级别提供。由于没有幻像读保护，同一事务中的两个查询可以看到由不同事务集提交的数据。在这些系统中，只有吞吐量限制和死锁敏感的<code class="codeph">SERIALIZABLE</code>隔离级别在事务级别提供事务集一致性。
                           </p>
                        </div>
                     </div>
                  </div><a id="ADFNS145"></a><a id="ADFNS99998"></a><div class="props_rev_3"><a id="GUID-AFD88739-88E5-446F-8FAA-0B56473A43E1" name="GUID-AFD88739-88E5-446F-8FAA-0B56473A43E1"></a><h5 id="ADFNS-GUID-AFD88739-88E5-446F-8FAA-0B56473A43E1" class="sect5">选择事务隔离级别</h5>
                     <div>
                        <div class="section">
                           <p>事务隔离级别的选择取决于性能和一致性需求以及应用程序编码要求。在并发（事务吞吐量）和一致性之间存在权衡。在为其事务选择隔离级别时，请考虑应用程序和工作负载。不同的事务可以有不同的隔离级别。</p>
                           <p>对于具有许多并发用户快速提交事务的环境，请考虑预期的事务到达率，响应时间要求和所需的一致性程度。</p>
                           <p><code class="codeph">READ</code> <code class="codeph">COMMITTED</code>隔离可以提供更多的并发性，并且某些事务的结果不一致（来自不可重复和幻像读取）的风险会有所增加。
                           </p>
                           <p><code class="codeph">SERIALIZABLE</code>隔离提供了更多的一致性（通过防止幻像和不可重复的读取），这在读/写事务多次运行查询时可能很重要。但是， <code class="codeph">SERIALIZABLE</code>隔离要求应用程序检查“无法序列化访问”错误，并且此检查可以显着降低具有许多并发事务访问相同数据以进行更新的环境中的吞吐量。
                           </p>
                           <p>如可<span>序列化事务和参照完整性</span>读取中所述，不要在<code class="codeph">READ</code> <code class="codeph">COMMITTED</code>或<code class="codeph">SERIALIZABLE</code>事务中阻止写入。
                           </p>
                           <p><a href="sql-processing-for-application-developers.html#GUID-AFD88739-88E5-446F-8FAA-0B56473A43E1__G1026829" title="此表总结了READ COMMITTED和SERIALIZABLE事务之间的主要相似点和不同点。">表8-6</a>总结了<code class="codeph">READ</code> <code class="codeph">COMMITTED</code>和<code class="codeph">SERIALIZABLE</code>事务之间的相同点和不同点。
                           </p>
                           <div class="tblformal" id="GUID-AFD88739-88E5-446F-8FAA-0B56473A43E1__G1026829">
                              <p class="titleintable">表8-6 READ COMMITTED和SERIALIZABLE事务的比较</p>
                              <table cellpadding="4" cellspacing="0" class="Formal" title="READ COMMITTED和SERIALIZABLE事务的比较" width="100%" border="1" summary="This table summarizes the key similarities and differences between READ COMMITTED and SERIALIZABLE transactions." frame="hsides" rules="rows">
                                 <thead>
                                    <tr align="left" valign="top">
                                       <th align="left" valign="bottom" width="47%" id="d22101e8027">手术</th>
                                       <th align="left" valign="bottom" width="20%" id="d22101e8030">阅读提交</th>
                                       <th align="left" valign="bottom" width="33%" id="d22101e8033">SERIALIZABLE</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="47%" id="d22101e8038" headers="d22101e8027 ">
                                          <p>脏写</p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d22101e8038 d22101e8030 ">
                                          <p>不可能</p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d22101e8038 d22101e8033 ">
                                          <p>不可能</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="47%" id="d22101e8048" headers="d22101e8027 ">
                                          <p>脏读</p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d22101e8048 d22101e8030 ">
                                          <p>不可能</p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d22101e8048 d22101e8033 ">
                                          <p>不可能</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="47%" id="d22101e8058" headers="d22101e8027 ">
                                          <p>不可重复的阅读</p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d22101e8058 d22101e8030 ">
                                          <p>可能</p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d22101e8058 d22101e8033 ">
                                          <p>不可能</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="47%" id="d22101e8068" headers="d22101e8027 ">
                                          <p>幻影阅读</p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d22101e8068 d22101e8030 ">
                                          <p>可能</p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d22101e8068 d22101e8033 ">
                                          <p>不可能</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="47%" id="d22101e8078" headers="d22101e8027 ">
                                          <p>符合ANSI / ISO SQL 92</p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d22101e8078 d22101e8030 ">
                                          <p>是</p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d22101e8078 d22101e8033 ">
                                          <p>是</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="47%" id="d22101e8088" headers="d22101e8027 ">
                                          <p>读取快照时间</p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d22101e8088 d22101e8030 ">
                                          <p>声明</p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d22101e8088 d22101e8033 ">
                                          <p>交易</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="47%" id="d22101e8098" headers="d22101e8027 ">
                                          <p>事务集一致性</p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d22101e8098 d22101e8030 ">
                                          <p>声明级别</p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d22101e8098 d22101e8033 ">
                                          <p>交易级别</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="47%" id="d22101e8108" headers="d22101e8027 ">
                                          <p>行级锁定</p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d22101e8108 d22101e8030 ">
                                          <p>是</p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d22101e8108 d22101e8033 ">
                                          <p>是</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="47%" id="d22101e8118" headers="d22101e8027 ">
                                          <p>读者阻止作家</p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d22101e8118 d22101e8030 ">
                                          <p>没有</p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d22101e8118 d22101e8033 ">
                                          <p>没有</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="47%" id="d22101e8128" headers="d22101e8027 ">
                                          <p>作家阻止读者</p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d22101e8128 d22101e8030 ">
                                          <p>没有</p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d22101e8128 d22101e8033 ">
                                          <p>没有</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="47%" id="d22101e8138" headers="d22101e8027 ">
                                          <p>不同行编写器阻止编写器</p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d22101e8138 d22101e8030 ">
                                          <p>没有</p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d22101e8138 d22101e8033 ">
                                          <p>没有</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="47%" id="d22101e8149" headers="d22101e8027 ">
                                          <p>同一行编写器阻止编写器</p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d22101e8149 d22101e8030 ">
                                          <p>是</p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d22101e8149 d22101e8033 ">
                                          <p>是</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="47%" id="d22101e8159" headers="d22101e8027 ">
                                          <p>等待阻止交易</p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d22101e8159 d22101e8030 ">
                                          <p>是</p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d22101e8159 d22101e8033 ">
                                          <p>是</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="47%" id="d22101e8169" headers="d22101e8027 ">
                                          <p>受“无法序列化访问”错误的影响</p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d22101e8169 d22101e8030 ">
                                          <p>没有</p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d22101e8169 d22101e8033 ">
                                          <p>是</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="47%" id="d22101e8179" headers="d22101e8027 ">
                                          <p>阻止事务终止后出错</p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d22101e8179 d22101e8030 ">
                                          <p>没有</p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d22101e8179 d22101e8033 ">
                                          <p>没有</p>
                                       </td>
                                    </tr>
                                    <tr align="left" valign="top">
                                       <td align="left" valign="top" width="47%" id="d22101e8189" headers="d22101e8027 ">
                                          <p>阻止事务提交后出错</p>
                                       </td>
                                       <td align="left" valign="top" width="20%" headers="d22101e8189 d22101e8030 ">
                                          <p>没有</p>
                                       </td>
                                       <td align="left" valign="top" width="33%" headers="d22101e8189 d22101e8033 ">
                                          <p>是</p>
                                       </td>
                                    </tr>
                                 </tbody>
                              </table>
                           </div>
                           <!-- class="inftblhruleinformal" -->
                           <div class="infoboxnotealso" id="GUID-AFD88739-88E5-446F-8FAA-0B56473A43E1__NOTE-1318-C87A91D3">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="sql-processing-for-application-developers.html#GUID-0D8BC3FD-832F-4CF2-B6E0-75DD1D3D5A4C">可序列化事务和参照完整性</a></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div><a id="ADFNS187"></a><div class="props_rev_3"><a id="GUID-42F52650-84EC-4D7C-B5A8-FBEFE73366C2" name="GUID-42F52650-84EC-4D7C-B5A8-FBEFE73366C2"></a><h3 id="ADFNS-GUID-42F52650-84EC-4D7C-B5A8-FBEFE73366C2" class="sect3">非阻塞和阻止DDL语句</h3>
               <div>
                  <p>非阻塞和阻塞DDL语句之间的区别仅对于更改表或索引（依赖于表）的DDL语句很重要。</p>
                  <p>当会话发出影响对象X的DDL语句时，会话将等待，直到引用或回滚引用X的每个并发DML语句。</p>
                  <p>会话等待时，并发会话可能会发出新的DML语句。如果DDL语句是非阻塞的，则新的DML语句立即执行。如果DDL语句是阻塞的，则新的DML语句在DDL语句完成后执行，成功或出错。</p>
                  <p><code class="codeph">DDL_LOCK_TIMEOUT</code>参数影响阻塞DDL语句（但不阻止非阻塞DDL语句）。因此，阻塞DDL语句可以完成错误<code class="codeph">ORA-00054</code> （资源繁忙并且在指定<code class="codeph">NOWAIT</code>或超时到期时获取）。
                  </p>
                  <p>应用于表分区的DDL语句阻止该分区，但对同一表的其他分区不阻塞。</p>
                  <div class="infoboxnote" id="GUID-42F52650-84EC-4D7C-B5A8-FBEFE73366C2__GUID-88A6F615-73C3-4E1B-8D26-BD8BC51FE434">
                     <p class="notep1">注意：</p>
                     <p>如果在数据库级别（对于多租户容器数据库或可插入数据库）启用了补充日志记录，则数据库会处理非阻塞DDL语句，例如阻止DDL语句。</p>
                  </div>
                  <div class="infoboxnote" id="GUID-42F52650-84EC-4D7C-B5A8-FBEFE73366C2__GUID-370DBF89-9963-4EF8-ABE6-9824AD65EC79">
                     <p class="notep1">警告：</p>
                     <p>不要在自治事务中发出非阻塞DDL语句。有关<a href="sql-processing-for-application-developers.html#GUID-BA46A896-4998-4E3C-ACAE-334B8716BC26">自治事务</a>的信息，请参阅自治事务</p>
                  </div>
                  <div class="infoboxnotealso" id="GUID-42F52650-84EC-4D7C-B5A8-FBEFE73366C2__NOTE-139-C8AC6E69">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>有关<code class="codeph">DDL_LOCK_TIMEOUT</code>参数的信息，请<code class="codeph">DDL_LOCK_TIMEOUT</code> <a href="../refrn/DDL_LOCK_TIMEOUT.html#REFRN10267" target="_blank"><span class="italic">Oracle数据库参考</span></a></p>
                        </li>
                        <li>
                           <p><a href="../sqlrf/Automatic-and-Manual-Locking-Mechanisms-During-SQL-Operations.html#SQLRF55501" target="_blank">B自动和手动锁定机制在SQL操作期间</a>获取非阻塞DDL语句列表</p>
                        </li>
                        <li>
                           <p>有关启用和禁用补充日志记录的信息，请参阅<a href="../sqlrf/ALTER-DATABASE.html#SQLRF52506" target="_blank">ALTER DATABASE</a></p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div><a id="ADFNS146"></a><a id="ADFNS147"></a><a id="ADFNS984"></a><a id="ADFNS00205"></a><div class="props_rev_3"><a id="GUID-BA46A896-4998-4E3C-ACAE-334B8716BC26" name="GUID-BA46A896-4998-4E3C-ACAE-334B8716BC26"></a><h3 id="ADFNS-GUID-BA46A896-4998-4E3C-ACAE-334B8716BC26" class="sect3">自治交易</h3>
               <div>
                  <div class="infoboxnote" id="GUID-BA46A896-4998-4E3C-ACAE-334B8716BC26__GUID-C34247C5-19EA-4935-B7A5-83B57261809C">
                     <p class="notep1">警告：</p>
                     <p>不要在自治事务中发出非阻塞DDL语句。</p>
                  </div>
                  <p><strong class="term">自治事务</strong> （AT）是由另一个事务（ <strong class="term">主要事务</strong> （MT））启动的独立事务。自治事务允许您挂起主事务，执行SQL操作，提交或回滚这些操作，然后恢复主事务。
                  </p>
                  <p>例如，在股票购买交易中，无论购买是否成功，您都可能希望提交客户信息。或者，即使事务回滚，您也可能希望将错误消息记录到调试表中。自治事务允许您执行此类任务。</p>
                  <p>自治事务在<strong class="term">自治范围内</strong>运行;也就是说，在<span class="bold">自治例程</span>的范围内 - 您使用<code class="codeph">AUTONOMOUS_TRANSACTION</code>编译指示标记的例程。在这种情况下， <span class="bold">例程</span>就是以下之一：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>模式级（非嵌套）匿名PL / SQL块</p>
                     </li>
                     <li>
                        <p>独立，包或嵌套子程序</p>
                     </li>
                     <li>
                        <p>ADT的方法</p>
                     </li>
                     <li>
                        <p>非复合触发器</p>
                     </li>
                  </ul>
                  <p>自治例程可以提交多个自治事务。</p>
                  <p><a href="sql-processing-for-application-developers.html#GUID-BA46A896-4998-4E3C-ACAE-334B8716BC26__I1025816">图8-3</a>显示了控制如何从主事务（ <code class="codeph">proc1</code> ）流向自治例程（ <code class="codeph">proc2</code> ）并再次返回。在控制返回主事务之前，自治例程提交两个事务（AT1和AT2）。
                  </p>
                  <div class="figure" id="GUID-BA46A896-4998-4E3C-ACAE-334B8716BC26__I1025816">
                     <p class="titleinfigure">图8-3事务控制流程</p><img src="img/adfns055.gif" alt="下面是图8-3的描述" title="下面是图8-3的描述" longdesc="img_text/adfns055.html"><br><a href="img_text/adfns055.html">“图8-3交易控制流程”的描述</a></div>
                  <!-- class="figure" -->
                  <p>当您输入自治事务的可执行部分时，主事务将暂停。退出事务时，主事务将恢复。<code class="codeph">COMMIT</code>和<code class="codeph">ROLLBACK</code>结束活动的自治事务，但不退出自治事务。<a href="sql-processing-for-application-developers.html#GUID-BA46A896-4998-4E3C-ACAE-334B8716BC26__I1025816">如图8-3</a>所示，当一个事务结束时，下一个SQL语句开始另一个事务。
                  </p>
                  <p>自治交易的更多特征：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>自主交易效果的变化不依赖于主要交易的状态或最终处置。例如：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>自治事务不会看到主事务所做的更改。</p>
                           </li>
                           <li>
                              <p>当自治事务提交或回滚时，它不会影响主事务的结果。</p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>一旦自治事务提交，自动事务处理效果的更改对其他事务是可见的。因此，用户可以访问更新的信息，而无需等待主事务提交。</p>
                     </li>
                     <li>
                        <p>自治事务可以启动其他自治事务。</p>
                     </li>
                  </ul>
                  <p><a href="sql-processing-for-application-developers.html#GUID-BA46A896-4998-4E3C-ACAE-334B8716BC26__I1020443">图8-4</a>显示了自治事务可以遵循的一些可能序列。
                  </p>
                  <div class="figure" id="GUID-BA46A896-4998-4E3C-ACAE-334B8716BC26__I1020443">
                     <p class="titleinfigure">图8-4自治事务的可能序列</p><img src="img/adfns056.gif" alt="下面是图8-4的描述" title="下面是图8-4的描述" longdesc="img_text/adfns056.html"><br><a href="img_text/adfns056.html">“图8-4自治事务的可能序列”的描述</a></div>
                  <!-- class="figure" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-BA46A896-4998-4E3C-ACAE-334B8716BC26__GUID-B5261063-6B28-468C-B649-F0B150D5209A">话题：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="sql-processing-for-application-developers.html#GUID-1B7FC7F4-DD72-43C1-B93A-BD6DBF450A36">自治交易的例子</a></p>
                        </li>
                        <li>
                           <p><a href="sql-processing-for-application-developers.html#GUID-E39BBE66-50F9-4F5F-925F-19EFD2E3CFFE">宣布自治例程</a></p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-BA46A896-4998-4E3C-ACAE-334B8716BC26__GUID-B723A11B-F002-4A69-B150-B502E23CB826">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>有关自治事务的详细信息，请<a href="../lnpls/static-sql.html#LNPLS00609" target="_blank"><span class="italic">参见Oracle Database PL / SQL语言参考</span></a></p>
                           </li>
                           <li>
                              <p><a href="sql-processing-for-application-developers.html#GUID-42F52650-84EC-4D7C-B5A8-FBEFE73366C2">非阻塞和阻止DDL语句</a>以获取有关非阻塞DDL语句的信息</p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS1053"></a><a id="ADFNS148"></a><a id="ADFNS99929"></a><div class="props_rev_3"><a id="GUID-1B7FC7F4-DD72-43C1-B93A-BD6DBF450A36" name="GUID-1B7FC7F4-DD72-43C1-B93A-BD6DBF450A36"></a><h4 id="ADFNS-GUID-1B7FC7F4-DD72-43C1-B93A-BD6DBF450A36" class="sect4">自治交易的例子</h4>
                  <div>
                     <p>本节显示自治事务的示例。</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-1B7FC7F4-DD72-43C1-B93A-BD6DBF450A36__GUID-E5A59F9D-F2A3-4939-8650-A26E68E96B4A">话题：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="sql-processing-for-application-developers.html#GUID-02B23DF5-14DD-4960-89D2-FE573E20CE30">订购产品</a></p>
                           </li>
                           <li>
                              <p><a href="sql-processing-for-application-developers.html#GUID-515E6E30-6FAB-4C45-AB6F-85614EB6BC05">从银行账户中提取资金</a></p>
                           </li>
                        </ul>
                        <p>如这些示例所示，当您使用自治和主要事务时，有四种可能的结果（ <a href="sql-processing-for-application-developers.html#GUID-1B7FC7F4-DD72-43C1-B93A-BD6DBF450A36__g1026901" title="该表总结了自主交易和主要交易的四种可能结果。">参见表8-7</a> ）。自主交易的结果与主交易的结果之间没有依赖关系。
                        </p>
                        <div class="tblformal" id="GUID-1B7FC7F4-DD72-43C1-B93A-BD6DBF450A36__g1026901">
                           <p class="titleintable">表8-7可能的交易结果</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="可能的交易结果" width="100%" border="1" summary="This table summarizes the four possible outcomes of autonomous and main transactions." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="30%" id="d22101e8756">自治交易</th>
                                    <th align="left" valign="bottom" width="70%" id="d22101e8759">主要交易</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="30%" id="d22101e8764" headers="d22101e8756 ">
                                       <p>提交</p>
                                    </td>
                                    <td align="left" valign="top" width="70%" headers="d22101e8764 d22101e8759 ">
                                       <p>提交</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="30%" id="d22101e8771" headers="d22101e8756 ">
                                       <p>提交</p>
                                    </td>
                                    <td align="left" valign="top" width="70%" headers="d22101e8771 d22101e8759 ">
                                       <p>回滚</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="30%" id="d22101e8778" headers="d22101e8756 ">
                                       <p>回滚</p>
                                    </td>
                                    <td align="left" valign="top" width="70%" headers="d22101e8778 d22101e8759 ">
                                       <p>提交</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="30%" id="d22101e8785" headers="d22101e8756 ">
                                       <p>回滚</p>
                                    </td>
                                    <td align="left" valign="top" width="70%" headers="d22101e8785 d22101e8759 ">
                                       <p>回滚</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                  </div><a id="ADFNS149"></a><a id="ADFNS99928"></a><div class="props_rev_3"><a id="GUID-02B23DF5-14DD-4960-89D2-FE573E20CE30" name="GUID-02B23DF5-14DD-4960-89D2-FE573E20CE30"></a><h5 id="ADFNS-GUID-02B23DF5-14DD-4960-89D2-FE573E20CE30" class="sect5">订购产品</h5>
                     <div>
                        <div class="section">
                           <p><a href="sql-processing-for-application-developers.html#GUID-02B23DF5-14DD-4960-89D2-FE573E20CE30__I1019975">图8-5</a>显示了订购产品的客户示例。客户信息（例如姓名，地址，电话）将被提交到客户信息表 - 即使销售没有通过。
                           </p>
                           <div class="figure" id="GUID-02B23DF5-14DD-4960-89D2-FE573E20CE30__I1019975">
                              <p class="titleinfigure">图8-5示例：购买订单</p><img src="img/adfns057.gif" alt="下面是图8-5的描述" title="下面是图8-5的描述" longdesc="img_text/adfns057.html"><br><a href="img_text/adfns057.html">“图8-5示例：购买订单”的说明</a></div>
                           <!-- class="figure" -->
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="ADFNS99927"></a><div class="props_rev_3"><a id="GUID-515E6E30-6FAB-4C45-AB6F-85614EB6BC05" name="GUID-515E6E30-6FAB-4C45-AB6F-85614EB6BC05"></a><h5 id="ADFNS-GUID-515E6E30-6FAB-4C45-AB6F-85614EB6BC05" class="sect5">从银行账户中提取资金</h5>
                     <div>
                        <p>在此示例中，客户尝试从银行帐户中提取资金。在此过程中，主事务调用两个自治事务范围之一（AT范围1或AT范围2）。</p>
                        <p>此交易的可能方案是：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="sql-processing-for-application-developers.html#GUID-7F0751EF-2319-4A2E-A0C7-2BABC22FA11A">情景1：足够的资金</a></p>
                           </li>
                           <li>
                              <p><a href="sql-processing-for-application-developers.html#GUID-944437AA-49F7-4D45-804A-B6D73EFC9B5C">情景2：透支保护资金不足</a></p>
                           </li>
                           <li>
                              <p><a href="sql-processing-for-application-developers.html#GUID-079D9D3B-5C15-4240-9718-75E009CC9B82">情景3：没有透支保护的资金不足</a></p>
                           </li>
                        </ul>
                     </div><a id="ADFNS151"></a><a id="ADFNS150"></a><div class="props_rev_3"><a id="GUID-7F0751EF-2319-4A2E-A0C7-2BABC22FA11A" name="GUID-7F0751EF-2319-4A2E-A0C7-2BABC22FA11A"></a><h6 id="ADFNS-GUID-7F0751EF-2319-4A2E-A0C7-2BABC22FA11A" class="sect6">情景1：足够的资金</h6>
                        <div>
                           <p>有足够的资金来支付提款，因此银行会释放资金（ <a href="sql-processing-for-application-developers.html#GUID-7F0751EF-2319-4A2E-A0C7-2BABC22FA11A__I1007457">见图8-6</a> ）。
                           </p>
                           <div class="figure" id="GUID-7F0751EF-2319-4A2E-A0C7-2BABC22FA11A__I1007457">
                              <p class="titleinfigure">图8-6银行取款充足资金</p><img src="img/adfns058.gif" alt="下面是图8-6的描述" title="下面是图8-6的描述" longdesc="img_text/adfns058.html"><br><a href="img_text/adfns058.html">“图8-6银行取款充足资金”的说明</a></div>
                           <!-- class="figure" -->
                        </div>
                     </div><a id="ADFNS153"></a><a id="ADFNS152"></a><div class="props_rev_3"><a id="GUID-944437AA-49F7-4D45-804A-B6D73EFC9B5C" name="GUID-944437AA-49F7-4D45-804A-B6D73EFC9B5C"></a><h6 id="ADFNS-GUID-944437AA-49F7-4D45-804A-B6D73EFC9B5C" class="sect6">情景2：透支保护资金不足</h6>
                        <div>
                           <p>没有足够的资金来支付提款，但客户有透支保护，因此银行会释放资金（ <a href="sql-processing-for-application-developers.html#GUID-944437AA-49F7-4D45-804A-B6D73EFC9B5C__I1007467">见图8-7</a> ）。
                           </p>
                           <div class="figure" id="GUID-944437AA-49F7-4D45-804A-B6D73EFC9B5C__I1007467">
                              <p class="titleinfigure">图8-7银行提款 - 透支保护资金不足</p><img src="img/adfns059.gif" alt="下面是图8-7的描述" title="下面是图8-7的描述" longdesc="img_text/adfns059.html"><br><a href="img_text/adfns059.html">“图8-7银行提款 - 透支保障资金不足”的描述</a></div>
                           <!-- class="figure" -->
                        </div>
                     </div><a id="ADFNS155"></a><a id="ADFNS154"></a><div class="props_rev_3"><a id="GUID-079D9D3B-5C15-4240-9718-75E009CC9B82" name="GUID-079D9D3B-5C15-4240-9718-75E009CC9B82"></a><h6 id="ADFNS-GUID-079D9D3B-5C15-4240-9718-75E009CC9B82" class="sect6">情景3：没有透支保护的资金不足</h6>
                        <div>
                           <p>没有足够的资金来支付提款，而且客户没有透支保护，因此银行会扣留所要求的资金（ <a href="sql-processing-for-application-developers.html#GUID-079D9D3B-5C15-4240-9718-75E009CC9B82__I1007477">见图8-8</a> ）。
                           </p>
                           <div class="figure" id="GUID-079D9D3B-5C15-4240-9718-75E009CC9B82__I1007477">
                              <p class="titleinfigure">图8-8银行提款 - 没有透支保护的资金不足</p><img src="img/adfns060.gif" alt="下面是图8-8的描述" title="下面是图8-8的描述" longdesc="img_text/adfns060.html"><br><a href="img_text/adfns060.html">“图8-8银行取款 - 没有透支保护的资金不足”的描述</a></div>
                           <!-- class="figure" -->
                        </div>
                     </div>
                  </div>
               </div><a id="ADFNS156"></a><a id="ADFNS99926"></a><div class="props_rev_3"><a id="GUID-E39BBE66-50F9-4F5F-925F-19EFD2E3CFFE" name="GUID-E39BBE66-50F9-4F5F-925F-19EFD2E3CFFE"></a><h4 id="ADFNS-GUID-E39BBE66-50F9-4F5F-925F-19EFD2E3CFFE" class="sect4">宣布自治例程</h4>
                  <div>
                     <div class="section">
                        <p>要声明自治例程，请使用<code class="codeph">PRAGMA</code> <code class="codeph">AUTONOMOUS_TRANSACTION</code> ，它指示PL / SQL编译器将例程标记为自治。
                        </p>
                        <div class="infoboxnotealso" id="GUID-E39BBE66-50F9-4F5F-925F-19EFD2E3CFFE__GUID-5EE6C366-F574-499A-AC60-22425DB9743A">
                           <p class="notep1">也可以看看：</p>
                           <p>有关<code class="codeph">PRAGMA</code> <code class="codeph">AUTONOMOUS_TRANSACTION</code>更多信息，请<a href="../lnpls/AUTONOMOUS_TRANSACTION-pragma.html#LNPLS01302" target="_blank"><span class="italic">参见Oracle Database PL / SQL语言参考</span></a></p>
                        </div>
                        <p>在<a href="sql-processing-for-application-developers.html#GUID-E39BBE66-50F9-4F5F-925F-19EFD2E3CFFE__BEJHCBDJ">例8-3中</a> ，功能<code class="codeph">balance</code>是自治的。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-E39BBE66-50F9-4F5F-925F-19EFD2E3CFFE__BEJHCBDJ">
                        <p class="titleinexample">例8-3将包子程序标记为自治</p><pre class="oac_no_warn" dir="ltr">- 为要使用的包创建表：DROP TABLE帐户; CREATE TABLE帐户（帐户INTEGER，余额REAL）; - 创建包：CREATE OR REPLACE PACKAGE banking AS功能平衡（acct_id INTEGER）RETURN REAL; - 附加功能和包裹END银行; /创建或更换包裹体作为功能平衡（acct_id INTEGER）返回实际是<span class="bold">PRAGMA AUTONOMOUS_TRANSACTION</span> ; my_bal REAL; BEGIN SELECT balance INTO my_bal FROM accounts WHERE account = acct_id;返回my_bal;结束; - 附加功能和包裹END银行; /</pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div><a id="ADFNS985"></a><a id="ADFNS00206"></a><div class="props_rev_3"><a id="GUID-A6585190-E64C-4799-B554-26A2B8433E26" name="GUID-A6585190-E64C-4799-B554-26A2B8433E26"></a><h3 id="ADFNS-GUID-A6585190-E64C-4799-B554-26A2B8433E26" class="sect3">存储分配错误后恢复执行</h3>
               <div>
                  <div class="section">
                     <p>当长时间运行的事务被存储分配错误中断时，应用程序可以挂起遇到问题的语句，更正问题，然后继续执行该语句。此功能称为<strong class="term">可恢复存储分配</strong> ，可避免耗时的回滚。它还使得不必将操作分成更小的部分并编写代码来跟踪其进度。
                     </p>
                     <div class="infoboxnotealso" id="GUID-A6585190-E64C-4799-B554-26A2B8433E26__GUID-5B12AE77-19F2-44AD-95E4-22C04431AB4A">
                        <p class="notep1">也可以看看：</p>
                        <p>有关可恢复存储分配的详细信息，请参见<a href="../admin/managing-space-for-schema-objects.html#ADMIN014" target="_blank"><span class="italic">“Oracle数据库管理员指南”</span></a></p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-A6585190-E64C-4799-B554-26A2B8433E26__GUID-5A98C511-CDDB-4221-9573-494AB01C0B56">话题：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="sql-processing-for-application-developers.html#GUID-F8271F52-9D89-45A4-895D-39737A47D342">哪些操作具有可恢复的存储分配？</a></p>
                        </li>
                        <li>
                           <p><a href="sql-processing-for-application-developers.html#GUID-B2D2C768-DE44-4DF1-8E2F-EB9B453B1524">处理暂停的存储分配</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS99925"></a><div class="props_rev_3"><a id="GUID-F8271F52-9D89-45A4-895D-39737A47D342" name="GUID-F8271F52-9D89-45A4-895D-39737A47D342"></a><h4 id="ADFNS-GUID-F8271F52-9D89-45A4-895D-39737A47D342" class="sect4">哪些操作具有可恢复的存储分配？</h4>
                  <div>
                     <p>在这些类型的错误之后，查询，DML语句和一些DDL语句具有可恢复的存储分配：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>空间不足错误，例如ORA-01653。</p>
                        </li>
                        <li>
                           <p>空格限制错误，例如ORA-01628。</p>
                        </li>
                        <li>
                           <p>空间配额错误，例如ORA-01536。</p>
                        </li>
                     </ul>
                     <p>无论操作是由SQL语句直接执行，还是在SQL * Loader，存储的子程序，匿名PL / SQL块或OCI调用（如<code class="codeph">OCIStmtExecute</code> ）中执行，都可以进行可恢复的存储分配。
                     </p>
                     <p>在字典管理的表空间中，您无法恢复遇到回滚段限制或最大扩展区数的索引或表创建操作。您必须结合可恢复的存储分配使用本地管理的表空间和自动撤消管理。</p>
                  </div>
               </div><a id="ADFNS986"></a><a id="ADFNS99924"></a><div class="props_rev_3"><a id="GUID-B2D2C768-DE44-4DF1-8E2F-EB9B453B1524" name="GUID-B2D2C768-DE44-4DF1-8E2F-EB9B453B1524"></a><h4 id="ADFNS-GUID-B2D2C768-DE44-4DF1-8E2F-EB9B453B1524" class="sect4">处理暂停的存储分配</h4>
                  <div>
                     <div class="section">
                        <p>当应用程序中的语句因存储分配错误而暂停时，应用程序不会收到错误代码。因此，应用程序必须使用<code class="codeph">AFTER</code> <code class="codeph">SUSPEND</code>触发器，否则DBA必须定期检查挂起的语句。
                        </p>
                        <p>问题得到纠正后（通常由DBA），暂停的语句会自动恢复执行。如果超时期限在问题得到纠正之前到期，则该语句会引发<code class="codeph">SERVERERROR</code>异常。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-B2D2C768-DE44-4DF1-8E2F-EB9B453B1524__GUID-D04E97B6-9BFB-4CA6-AC1C-04E7B5394E87">话题：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="sql-processing-for-application-developers.html#GUID-40B6AD12-05C0-4B61-811E-244B186A94A3">在应用程序中使用AFTER SUSPEND触发器</a></p>
                           </li>
                           <li>
                              <p><a href="sql-processing-for-application-developers.html#GUID-805211A4-BD67-4BEE-B6B2-29165C42EFCC">检查暂停的声明</a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div><a id="ADFNS157"></a><a id="ADFNS99870"></a><div class="props_rev_3"><a id="GUID-40B6AD12-05C0-4B61-811E-244B186A94A3" name="GUID-40B6AD12-05C0-4B61-811E-244B186A94A3"></a><h5 id="ADFNS-GUID-40B6AD12-05C0-4B61-811E-244B186A94A3" class="sect5">在应用程序中使用AFTER SUSPEND触发器</h5>
                     <div>
                        <div class="section">
                           <p>在应用程序中， <code class="codeph">AFTER</code> <code class="codeph">SUSPEND</code>触发器可以通过调用<code class="codeph">DBMS_RESUMABLE</code>包中的子程序来获取有关该问题的信息。然后触发器可以使用电子邮件（例如）将信息发送给操作员。
                           </p>
                           <p>要减少触发器本身内的空间不足错误的可能性，请将触发器声明为自治事务。作为自治事务，触发器在<code class="codeph">SYSTEM</code>表空间中使用回滚段。如果触发器由于挂起语句持有的锁而遇到死锁条件，则触发器终止并且应用程序接收原始错误代码，就好像该语句从未被挂起一样。如果触发器遇到空间不足的情况，则会回滚触发器和挂起的语句。要防止回滚，请在触发器中使用异常处理程序等待语句恢复。
                           </p>
                           <p><a href="sql-processing-for-application-developers.html#GUID-40B6AD12-05C0-4B61-811E-244B186A94A3__CHDFBBJE">例8-4中</a>的触发器处理数据库中的存储错误。对于某些类型的错误，触发器会终止语句并使用电子邮件向DBA发出警报。对于可能是临时的其他错误，触发器指定语句在恢复之前等待八个小时，期望当时存储问题得到修复。要运行此示例，您必须以<code class="codeph">SYSDBA</code>身份连接到数据库。</p>
                           <div class="infoboxnotealso" id="GUID-40B6AD12-05C0-4B61-811E-244B186A94A3__GUID-CF7B9B89-D434-4D69-8098-94F499D3AF3C">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><a href="../arpls/DBMS_RESUMABLE.html#ARPLS143" target="_blank"><span class="italic">Oracle数据库PL / SQL包和类型参考</span></a></p>
                                 </li>
                                 <li>
                                    <p><a href="../lnpls/plsql-triggers.html#LNPLS020" target="_blank"><span class="italic">Oracle数据库PL / SQL语言参考</span></a></p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="example" id="GUID-40B6AD12-05C0-4B61-811E-244B186A94A3__CHDFBBJE">
                           <p class="titleinexample">示例8-4暂停后触发器处理暂停的存储分配</p><pre class="oac_no_warn" dir="ltr">- 创建触发器体DROP TABLE rbs_error使用的表; CREATE TABLE rbs_error（SQL_TEXT VARCHAR2（64），ERROR_MSG VARCHAR2（64），SUSPEND_TIME VARCHAR2（64））; -可恢复存储分配CREATE OR REPLACE TRIGGER suspend_example <span class="bold">AFTER SUSPEND</span> <span class="bold">数据库</span> DECLARE cur_sid NUMBER; cur_inst NUMBER; err_type VARCHAR2（64）; object_owner VARCHAR2（64）; object_type VARCHAR2（64）; table_space_name VARCHAR2（64）; object_name VARCHAR2（64）; sub_object_name VARCHAR2（64）; msg_body VARCHAR2（64）; ret_value BOOLEAN; error_txt VARCHAR2（64）; mail_conn UTL_SMTP.CONNECTION;从V $ MYSTAT开始选择DISTINCT（SID）进入cur_sid; cur_inst：= USERENV（'instance'）; ret_value：= <span class="bold">DBMS_RESUMABLE.SPACE_ERROR_INFO</span> <span class="bold">（err_type，</span> <span class="bold">object_owner，</span> <span class="bold">object_type，</span> <span class="bold">table_space_name，</span> <span class="bold">object_name，</span> <span class="bold">sub_object_name）;</span> IF object_type ='ROLLBACK SEGMENT'然后插入rbs_error（SELECT SQL_TEXT，ERROR_MSG，SUSPEND_TIME FROM DBA_RESUMABLE WHERE SESSION_ID = cur_sid AND INSTANCE_ID = cur_inst）; SELECT ERROR_MSG INTO error_txt FROM DBA_RESUMABLE WHERE SESSION_ID = cur_sid AND INSTANCE_ID = cur_inst; msg_body：='发生空间错误：回滚段达到空间限制'|| object_name || 'on'|| to_char（SYSDATE，'月dd，YYYY，HH：MIam'）|| ”。错误消息是：'|| error_txt的; mail_conn：= UTL_SMTP.OPEN_CONNECTION（'localhost'，25）; UTL_SMTP.HELO（mail_conn，'localhost'）; UTL_SMTP.MAIL（mail_conn，'sender @ localhost'）; UTL_SMTP.RCPT（mail_conn，'recipient @ localhost'）; UTL_SMTP.DATA（mail_conn，msg_body）; UTL_SMTP.QUIT（mail_conn）; <span class="bold">DBMS_RESUMABLE.ABORT（cur_sid）;</span> ELSE <span class="bold">DBMS_RESUMABLE.SET_TIMEOUT（3600 * 8）;</span>万一;承诺;结束; /</pre></div>
                        <!-- class="example" -->
                     </div>
                  </div><a id="ADFNS99869"></a><div class="props_rev_3"><a id="GUID-805211A4-BD67-4BEE-B6B2-29165C42EFCC" name="GUID-805211A4-BD67-4BEE-B6B2-29165C42EFCC"></a><h5 id="ADFNS-GUID-805211A4-BD67-4BEE-B6B2-29165C42EFCC" class="sect5">检查暂停的声明</h5>
                     <div>
                        <div class="section">
                           <p>如果应用程序不使用<code class="codeph">AFTER</code> <code class="codeph">SUSPEND</code>触发器，则DBA必须使用静态数据字典视图<code class="codeph">DBA_RESUMABLE</code>定期检查挂起的语句。
                           </p>
                           <p>DBA可以从动态性能视图<code class="codeph">V$_SESSION_WAIT</code>获取其他信息。</p>
                           <div class="infoboxnotealso" id="GUID-805211A4-BD67-4BEE-B6B2-29165C42EFCC__DBA_RESUMABLEV_SESSION_WAIT-C8B4C07A">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph"><a href="../refrn/DBA_RESUMABLE.html#REFRN23228" target="_blank">DBA_RESUMABLE</a></code></p>
                                 </li>
                                 <li>
                                    <p><code class="codeph"><a href="../refrn/V-SESSION_WAIT.html#REFRN30229" target="_blank">V $ _SESSION_WAIT</a></code></p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>