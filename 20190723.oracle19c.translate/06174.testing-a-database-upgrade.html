<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="SQL Performance Analyzer supports testing database upgrades from Oracle9i and later releases to Oracle Database 10g Release 2 or newer releases."></meta>
      <meta name="description" content="SQL Performance Analyzer supports testing database upgrades from Oracle9i and later releases to Oracle Database 10g Release 2 or newer releases."></meta>
      <title>测试数据库升级</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Testing Guide "></meta>
      <meta property="og:description" content="SQL Performance Analyzer supports testing database upgrades from Oracle9i and later releases to Oracle Database 10g Release 2 or newer releases."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Testing Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="testing-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-07T01:43:11-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2008, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96279-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="using-spa-quick-check.html" title="Previous" type="text/html"></link>
      <link rel="next" href="database-replay.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Testing Guide"></meta>
    <meta name="dcterms.isVersionOf" content="RATUG"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="using-spa-quick-check.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="database-replay.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">测试指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="sql-performance-analyzer.html" property="item" typeof="WebPage"><span property="name">SQL性能分析器</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">测试数据库升级</li>
            </ol>
            <a id="GUID-41A30909-3D5B-4A53-A757-B3497498D36B" name="GUID-41A30909-3D5B-4A53-A757-B3497498D36B"></a><a id="RATUG210"></a>
            
            <h2 id="RATUG-GUID-41A30909-3D5B-4A53-A757-B3497498D36B" class="sect2"><span class="enumeration_chapter">8</span>测试数据库升级</h2>
         </header>
         <div class="ind">
            <div>
               <div><span>SQL Performance Analyzer支持测试从Oracle9 <span class="italic">i</span>及更高版本到Oracle Database <span class="italic">10g</span>第2版或更新版本的数据库升级。</span> 用于测试Oracle9 <span class="italic">i</span>数据库和Oracle数据库<span class="italic">10g</span>第1版的数据库升级的方法与用于测试Oracle数据库<span class="italic">10g</span>第2版及更高版本的数据库升级的方法略有不同，因此这里介绍了两种方法。
               </div>
               <p>本章介绍如何在数据库升级中使用SQL Performance Analyzer，并包含以下部分：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="testing-a-database-upgrade.html#GUID-54F449B7-987E-496E-AD15-97F0B6A70C66" title="SQL Performance Analyzer支持测试Oracle9i数据库和Oracle数据库10g第1版到Oracle Database 11g第2版或更高版本的数据库升级。">从Oracle9i数据库和Oracle数据库10g第1版升级</a></p>
                  </li>
                  <li>
                     <p><a href="testing-a-database-upgrade.html#GUID-AD6C3094-99C3-4F3D-A387-C7C70ACC43C4" title="您可以使用SQL性能分析器通过捕获生产系统上的SQL调整集，然后通过a远程执行两次来测试从Oracle数据库10g第2版或更新版本到任何更高版本的数据库升级对SQL响应时间的影响。测试系统上的数据库链接 - 首先创建一个更改前的SQL试用版，然后再创建一个更改后的SQL试用版。">从Oracle数据库10g第2版和更新版本升级</a></p>
                  </li>
                  <li>
                     <p><a href="testing-a-database-upgrade.html#GUID-DAF2B96B-20A0-408D-BDD7-364AC1113614" title="在某些情况下，SQL Performance Analyzer可能会识别在升级测试系统上的数据库后性能下降的SQL语句。">测试数据库升级后调整回归的SQL语句</a></p>
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-41A30909-3D5B-4A53-A757-B3497498D36B__GUID-93AF8955-8816-4CF0-A6C0-2C1AD9DD91B0">
                  <p class="notep1">也可以看看：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><span class="q">“ <a href="introduction-to-oracle-database-testing.html#GUID-F2920E05-3680-4699-B074-92DBEF682B70" title="系统更改（例如升级数据库或添加索引）可能会导致更改SQL语句的执行计划，从而对SQL性能产生重大影响。">SQL性能分析器</a> ”</span> ，了解有关在其他情况下使用SQL Performance Analyzer的信息</p>
                     </li>
                     <li>
                        <p><a href="../upgrd/oracle-database-releases-that-support-direct-upgrade.html#UPGRD-GUID-7AA90913-D8AB-4EBA-944F-31FA01D6BE5D" target="_blank"><span><cite>Oracle数据库升级指南</cite></span></a>对Oracle数据库<span class="italic">12c的</span>升级路径信息</p>
                     </li>
                  </ul>
               </div>
            </div><a id="RATUG249"></a><a id="RATUG211"></a><div class="props_rev_3"><a id="GUID-54F449B7-987E-496E-AD15-97F0B6A70C66" name="GUID-54F449B7-987E-496E-AD15-97F0B6A70C66"></a><h3 id="RATUG-GUID-54F449B7-987E-496E-AD15-97F0B6A70C66" class="sect3"><span class="enumeration_section">8.1</span>从Oracle9 <span class="italic">i</span>数据库和Oracle数据库<span class="italic">10g</span>第1版升级</h3>
               <div>
                  <div><span>SQL Performance Analyzer支持测试Oracle9 <span class="italic">i</span>数据库和Oracle数据库<span class="italic">10g</span>第1版到Oracle Database 11g第2版或更高版本的数据库升级。</span> 使用以下步骤，请参<a href="testing-a-database-upgrade.html#GUID-54F449B7-987E-496E-AD15-97F0B6A70C66__CIAHCDCE">见图8-1</a> ：</div>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>从生产系统上捕获的SQL跟踪文件构建SQL调优集</p>
                     </li>
                     <li>
                        <p>通过数据库链接远程执行已升级数据库上的SQL调优集</p>
                     </li>
                     <li>
                        <p>将结果与生产系统中捕获的结果进行比较</p>
                     </li>
                  </ul>
                  <p>因为SQL Performance Analyzer仅接受存储在SQL调优集中的一组SQL语句作为其<a id="d14012e260" class="indexterm-anchor"></a> Oracle9 <span class="italic">i</span>数据库不支持输入源和SQL调优集，必须构造SQL调优集，以便在从Oracle9 <span class="italic">i</span>数据库升级时可以将其用作SQL Performance Analyzer的输入源。
                  </p>
                  <div class="figure" id="GUID-54F449B7-987E-496E-AD15-97F0B6A70C66__CIAHCDCE">
                     <p class="titleinfigure">图8-1从Oracle9i或10g第1版到Oracle Database 11g第2版或更高版本的数据库升级的SQL性能分析器工作流程</p><img src="img/ratug003b.png" width="511" alt="下面是图8-1的描述" title="下面是图8-1的描述" longdesc="img_text/ratug003b.html"><br><a href="img_text/ratug003b.html">“图8-1从Oracle9i或10g第1版到Oracle Database 11g第2版或更高版本的数据库升级的SQL性能分析器工作流”</a></div>
                  <!-- class="figure" -->
                  <p>在测试数据库升级之前，请确保满足以下条件：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a id="d14012e281" class="indexterm-anchor"></a>该<a id="d14012e284" class="indexterm-anchor"></a>您要升级的生产系统是运行Oracle9 <span class="italic">i</span> （9.2.0.8）或Oracle Database <span class="italic">10g</span>第1版（10.1.0.5）。
                        </p>
                     </li>
                     <li>
                        <p>该<a id="d14012e298" class="indexterm-anchor"></a>要升级到的测试系统正在运行Oracle Database <span class="italic">11g</span>第2版或更高版本。
                        </p>
                        <p>数据库版本可以是11.2.0.3或更高版本。</p>
                     </li>
                     <li>
                        <p>测试系统必须尽可能接近生产系统，因为两个系统的性能将相互比较。</p>
                     </li>
                     <li>
                        <p>两个系统上的硬件配置也必须尽可能相似。</p>
                     </li>
                  </ul>
                  <p>您还需要设置单独的SQL Performance Analyzer <a id="d14012e316" class="indexterm-anchor"></a>系统运行Oracle Database 12 <span class="italic">c</span>第2版。您将使用此系统构建SQL调优集并运行SQL Performance Analyzer。您的生产数据或模式都不需要在此系统上可用，因为SQL调优集将使用存储在生产系统的SQL跟踪文件中的统计信息构建。SQL Performance Analyzer任务将在测试系统上远程执行，以通过您指定的数据库链接生成SQL试验的执行计划和统计信息。数据库链接必须是公共数据库链接，该链接连接到具有<code class="codeph">DBMS_SQLPA</code>包的<code class="codeph">EXECUTE</code>特权和测试系统的<code class="codeph">ADVISOR</code>特权的用户。您还应该从测试系统上的用户架构中删除任何现有的<code class="codeph">PLAN_TABLE</code> 。
                  </p>
                  <p>按照所述配置升级环境后，执行以下过程中所述的步骤，以便在从Oracle9 <span class="italic">i</span>或Oracle Database <span class="italic">10g</span>第1版到较新版本的数据库升级中使用SQL Performance Analyzer。
                  </p>
                  <ol>
                     <li>
                        <p>启用<a id="d14012e349" class="indexterm-anchor"></a>生产系统上的SQL跟踪工具，如<span class="q">“ <a href="testing-a-database-upgrade.html#GUID-216BB723-4FC6-4AD6-A641-79BE9AD9F819" title="Oracle9i使用SQL Trace工具来收集各个SQL语句的性能数据。">在生产系统上启用SQL跟踪</a> ”中所述</span> 。
                        </p>
                        <p>为了最大限度地降低对生产系统的性能影响，并且仍然能够完全捕获一组有代表性的SQL语句，请考虑仅在需要时为一部分会话启用SQL跟踪，以便至少捕获一次所有重要的SQL语句。</p>
                     </li>
                     <li>
                        <p>在生产系统上，创建一个<a id="d14012e369" class="indexterm-anchor"></a>映射表，如<span class="q">“ <a href="testing-a-database-upgrade.html#GUID-EB1B032E-CFF2-4057-B9BE-02AF45383316" title="要将存储在SQL跟踪文件中的用户和对象标识符编号转换为各自的名称，需要提供一个指定每个映射的表。">创建映射表</a> ”中所述</span> 。
                        </p>
                        <p>此映射表将用于将SQL跟踪文件中的用户和对象标识符编号转换为其等效字符串。</p>
                     </li>
                     <li>
                        <p>移动<a id="d14012e386" class="indexterm-anchor"></a> SQL跟踪文件和<a id="d14012e391" class="indexterm-anchor"></a>映射表从生产系统到SQL Performance Analyzer系统，如<span class="q">“ <a href="testing-a-database-upgrade.html#GUID-EB1B032E-CFF2-4057-B9BE-02AF45383316" title="要将存储在SQL跟踪文件中的用户和对象标识符编号转换为各自的名称，需要提供一个指定每个映射的表。">创建映射表</a> ”中所述</span> 。
                        </p>
                     </li>
                     <li>
                        <p>在SQL Performance Analyzer系统上，构造一个<a id="d14012e406" class="indexterm-anchor"></a>使用SQL跟踪文件设置SQL调优，如<span class="q">“ <a href="testing-a-database-upgrade.html#GUID-E6298851-9BF4-4B96-8F93-D5483278F8DA" title="将SQL跟踪文件和映射表移动到SQL Performance Analyzer系统后，可以使用DBMS_SQLTUNE包构建SQL调优集。">构建SQL调整集</a> ”中所述</span> 。
                        </p>
                        <p>SQL调优集将包含SQL跟踪文件中捕获的SQL语句及其相关的执行上下文和统计信息。</p>
                     </li>
                     <li>
                        <p>在SQL Performance Analyzer系统上，使用SQL Performance Analyzer创建<a id="d14012e426" class="indexterm-anchor"></a> SQL Performance Analyzer任务并转换内容<a id="d14012e433" class="indexterm-anchor"></a> SQL调优设置为预升级<a id="d14012e438" class="indexterm-anchor"></a>将用作比较基准的SQL试验，然后通过数据库链接远程测试在测试系统上执行SQL语句以构建升级后<a id="d14012e445" class="indexterm-anchor"></a> SQL试用版，如<span class="q">“ <a href="testing-a-database-upgrade.html#GUID-5B437942-8CF6-4F6C-864B-996BB61B4C26" title="构建SQL调优集后，可以使用SQL Performance Analyzer根据SQL调优集中的执行计划和运行时统计信息构建升级前的SQL试用版。在构建预升级SQL试验之后，在测试系统上的SQL调优集中执行测试执行或生成SQL语句计划，以构建升级后的SQL试用版。">从Oracle9i数据库和Oracle数据库10g第1版测试数据库升级</a> ”中所述</span> 。
                        </p>
                     </li>
                     <li>
                        <p>相比<a id="d14012e462" class="indexterm-anchor"></a> SQL性能和修复<a id="d14012e467" class="indexterm-anchor"></a>退步的SQL。</p>
                        <p>SQL Performance Analyzer将在升级前SQL试用期间从SQL调优集读取的SQL语句的性能与在升级后SQL试验期间从远程测试执行中捕获的SQL语句的性能进行比较。生成报告以识别执行计划或SQL语句性能的任何更改。</p>
                        <p>如果报告显示任何已回归的SQL语句，则可以进行进一步更改以修复已回归的SQL，如<span class="q">“ <a href="testing-a-database-upgrade.html#GUID-DAF2B96B-20A0-408D-BDD7-364AC1113614" title="In some cases, SQL Performance Analyzer may identify SQL statements whose performance regressed after you upgrade the database on the test system.">在测试数据库升级后调整</a></span>回归的<span class="q"><a href="testing-a-database-upgrade.html#GUID-DAF2B96B-20A0-408D-BDD7-364AC1113614" title="在某些情况下，SQL Performance Analyzer可能会识别在升级测试系统上的数据库后性能下降的SQL语句。">SQL语句</a> ”中所述</span> 。
                        </p>
                        <p>重复执行SQL调优集的过程，并将其性能与先前的执行进行比较，以测试所做的任何更改，直到您对分析结果满意为止。</p>
                     </li>
                  </ol>
               </div><a id="RATUG212"></a><div class="props_rev_3"><a id="GUID-216BB723-4FC6-4AD6-A641-79BE9AD9F819" name="GUID-216BB723-4FC6-4AD6-A641-79BE9AD9F819"></a><h4 id="RATUG-GUID-216BB723-4FC6-4AD6-A641-79BE9AD9F819" class="sect4"><span class="enumeration_section">8.1.1</span>在生产系统上启用SQL跟踪</h4>
                  <div>
                     <div><span>Oracle9 <span class="italic">i</span>使用SQL Trace工具来收集各个SQL语句的性能数据。</span> SQL Trace生成的信息存储在SQL跟踪文件中。SQL Performance Analyzer从这些文件中使用以下信息：</div>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>发生解析的SQL文本和用户名</p>
                        </li>
                        <li>
                           <p>绑定每次执行的值</p>
                        </li>
                        <li>
                           <p>CPU和经过的时间</p>
                        </li>
                        <li>
                           <p>物理读取和逻辑读取</p>
                        </li>
                        <li>
                           <p>处理的行数</p>
                        </li>
                        <li>
                           <p>每个SQL语句的执行计划（仅在SQL语句的游标关闭时捕获）</p>
                        </li>
                     </ul>
                     <p>虽然有可能启用<a id="d14012e599" class="indexterm-anchor"></a>对于实例的SQL跟踪，建议您为会话子集启用SQL跟踪。为实例启用SQL跟踪工具后，实例中执行的所有SQL语句的性能统计信息将存储到SQL跟踪文件中。以这种方式使用SQL Trace会对性能产生严重影响，并可能导致系统开销增加，CPU使用率过高以及磁盘空间不足。这是必需的<a id="d14012e604" class="indexterm-anchor"></a>跟踪级别设置为4以捕获绑定值以及执行计划。
                     </p>
                     <p>对于运行Oracle Database <span class="italic">10g</span>第1版的生产系统，请使用<code class="codeph">DBMS_MONITOR</code> 。 <code class="codeph">SESSION_TRACE_ENABLE</code>过程在另一个会话中透明地启用SQL跟踪。您还应通过将<code class="codeph">binds</code> procedure参数设置为<code class="codeph">TRUE</code> （其默认值为<code class="codeph">FALSE</code> ）来显式启用绑定。
                     </p>
                     <p>启用SQL跟踪后，标识包含要与SQL Performance Analyzer一起使用的一组有代表性的SQL语句的统计信息的SQL跟踪文件。然后你可以复制<a id="d14012e632" class="indexterm-anchor"></a> SQL跟踪文件到SQL Performance Analyzer系统。在SQL跟踪文件中捕获SQL工作负载后，在生产系统上禁用SQL跟踪。
                     </p>
                     <div class="infoboxnotealso" id="GUID-216BB723-4FC6-4AD6-A641-79BE9AD9F819__GUID-04CB243D-C80C-44C9-8BD4-8CB977623260">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="../tgsql/performing-application-tracing.html#TGSQL791" target="_blank"><span><cite>“Oracle数据库SQL调优指南”，</cite></span></a>了解使用SQL跟踪时的其他注意事项，例如设置初始化参数以管理SQL跟踪文件</p>
                           </li>
                           <li>
                              <p>有关<code class="codeph">DBMS_MONITOR</code>程序包的信息，请参阅<a href="../arpls/DBMS_MONITOR.html#ARPLS091" target="_blank"><span><cite>Oracle Database PL / SQL程序包和类型参考</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="RATUG213"></a><div class="props_rev_3"><a id="GUID-EB1B032E-CFF2-4057-B9BE-02AF45383316" name="GUID-EB1B032E-CFF2-4057-B9BE-02AF45383316"></a><h4 id="RATUG-GUID-EB1B032E-CFF2-4057-B9BE-02AF45383316" class="sect4"><span class="enumeration_section">8.1.2</span>创建映射表</h4>
                  <div>
                     <div><span>要将存储在SQL跟踪文件中的用户和对象标识符编号转换为各自的名称，需要提供一个指定每个映射的表。</span> 将跟踪文件转换为SQL调优集时，SQL Performance Analyzer系统将读取此映射表。
                     </div>
                     <div class="section">
                        <p class="subhead3" id="GUID-EB1B032E-CFF2-4057-B9BE-02AF45383316__GUID-6A560705-8951-46AF-8404-509EAC4C34EE">要创建映射表：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>在生产数据库上运行以下SQL语句：</p><pre class="oac_no_warn" dir="ltr">CREATE TABLE映射AS SELECT object_id id，owner，SUBSTR（object_name，1,30）name FROM dba_objects WHERE object_type NOT IN（'CONSUMER GROUP'，'EVALUATION CONTEXT'，'FUNCTION'，'INDEXTYPE'，'JAVA CLASS'，' JAVA DATA'，'JAVA RESOURCE'，'LIBRARY'，'LOB'，'OPERATOR'，'PACKAGE'，'PACKAGE BODY'，'PROCEDURE'，'QUEUE'，'RESOURCE PLAN'，'SYNONYM'，'TRIGGER' ，'TYPE'，'TYPE BODY'）UNION ALL SELECT user_id id，username owner，null name FROM dba_users;</pre><p>一旦<a id="d14012e760" class="indexterm-anchor"></a>创建映射表后，可以使用Data Pump将其传输到SQL Performance Analyzer系统。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-EB1B032E-CFF2-4057-B9BE-02AF45383316__GUID-44377AC2-8BF6-4E6E-901F-2A6251A477A1">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关使用Data Pump的信息，请<a href="../sutil/oracle-data-pump-overview.html#SUTIL100" target="_blank"><span><cite>参见Oracle数据库实用程序</cite></span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="RATUG250"></a><a id="RATUG214"></a><div class="props_rev_3"><a id="GUID-E6298851-9BF4-4B96-8F93-D5483278F8DA" name="GUID-E6298851-9BF4-4B96-8F93-D5483278F8DA"></a><h4 id="RATUG-GUID-E6298851-9BF4-4B96-8F93-D5483278F8DA" class="sect4"><span class="enumeration_section">8.1.3</span>构建SQL调优集</h4>
                  <div>
                     <p>将SQL跟踪文件和映射表移动到SQL Performance Analyzer系统后，可以使用<code class="codeph">DBMS_SQLTUNE</code>包构建SQL调优集。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-E6298851-9BF4-4B96-8F93-D5483278F8DA__GUID-BE4F4F1C-8061-40E3-9B40-FC6091830082">要构建SQL调优集：</p>
                        <ol>
                           <li>
                              <p>将SQL跟踪文件复制到SQL Performance Analyzer系统上的目录。</p>
                           </li>
                           <li>
                              <p>为此目录创建目录对象。</p>
                           </li>
                           <li>
                              <p>使用<code class="codeph">DBMS_SQLTUNE</code> 。 <a id="d14012e880" class="indexterm-anchor"></a> <code class="codeph">SELECT_SQL_TRACE</code>函数从SQL跟踪文件中读取SQL语句。
                              </p>
                              <p>对于每个SQL语句，仅收集单个执行的信息。不捕获每个SQL语句的执行频率。因此，在对运行Oracle数据库<span class="italic">10g</span>第1版及更早版本的生产系统执行比较分析时，应忽略SQL Performance Analyzer报告中的工作负载级统计信息，并仅评估执行级别的性能更改。
                              </p>
                              <p>以下示例读取存储在<code class="codeph">sql_trace_prod</code>目录对象中的SQL跟踪文件的内容，并将它们加载到SQL调优集中。
                              </p><pre class="oac_no_warn" dir="ltr">DECLARE cur sys_refcursor; BEGIN DBMS_SQLTUNE.CREATE_SQLSET（'my_sts_9i'）; OPEN cur FOR SELECT VALUE（P）FROM table（DBMS_SQLTUNE.SELECT_SQL_TRACE（'sql_trace_prod'，'％ora％'））P; DBMS_SQLTUNE.LOAD_SQLSET（'my_sts_9i'，cur）;关闭cur;结束; /</pre></li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><code class="codeph">SELECT_SQL_TRACE</code>函数的语法如下：</p><pre class="oac_no_warn" dir="ltr">DBMS_SQLTUNE.SELECT_SQL_TRACE（目录IN VARCHAR2，file_name IN VARCHAR2：= NULL，mapping_table_name IN VARCHAR2：= NULL，mapping_table_owner IN VARCHAR2：= NULL，select_mode IN POSITIVE：= SINGLE_EXECUTION，options IN BINARY_INTEGER：= LIMITED_COMMAND_TYPE，pattern_start IN VARCHAR2：= NULL， parttern_end IN VARCHAR2：= NULL，result_limit IN POSITIVE：= NULL）RETURN sys.sqlset PIPELINED;</pre><p><a href="testing-a-database-upgrade.html#GUID-E6298851-9BF4-4B96-8F93-D5483278F8DA__CIAHBDDF" title="此表列出了DBMS_SQLTUNE.SELECT_SQL_TRACE函数的每个参数的参数和说明">表8-1</a>介绍了<code class="codeph">SELECT_SQL_TRACE</code>函数的可用参数。
                        </p>
                        <div class="tblformal" id="GUID-E6298851-9BF4-4B96-8F93-D5483278F8DA__CIAHBDDF">
                           <p class="titleintable">表8-1 DBMS_SQLTUNE.SELECT_SQL_TRACE函数参数</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="DBMS_SQLTUNE.SELECT_SQL_TRACE函数参数" width="100%" border="1" summary="This table lists the parameters and descriptions of each parameter for the DBMS_SQLTUNE.SELECT_SQL_TRACE function" frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="31%" id="d14012e926">参数</th>
                                    <th align="left" valign="bottom" width="69%" id="d14012e929">描述</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d14012e934" headers="d14012e926 ">
                                       <p><code class="codeph">目录</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d14012e934 d14012e929 ">
                                       <p>指定指向存储SQL跟踪文件的目录的目录对象。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d14012e942" headers="d14012e926 ">
                                       <p><code class="codeph">文件名</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d14012e942 d14012e929 ">
                                       <p>指定要处理的SQL跟踪文件的全部或部分名称。如果未指定，将使用指定目录中的当前或最新跟踪文件。支持匹配跟踪文件名的％通配符。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d14012e950" headers="d14012e926 ">
                                       <p><code class="codeph">mapping_table_name</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d14012e950 d14012e929 ">
                                       <p>指定映射表的名称。如果设置为<code class="codeph">NULL</code>的默认值，则将使用当前数据库的映射。请注意，映射表名称不区分大小写。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d14012e961" headers="d14012e926 ">
                                       <p><code class="codeph">mapping_table_owner</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d14012e961 d14012e929 ">
                                       <p>指定映射表所在的模式。如果设置为<code class="codeph">NULL</code> ，则将使用当前架构。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d14012e972" headers="d14012e926 ">
                                       <p><code class="codeph">选择模式</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d14012e972 d14012e929 ">
                                       <p>指定从跟踪文件中选择SQL语句的模式。默认值为<code class="codeph">SINGLE_EXECUTION</code> 。在此模式下，只有每个SQL语句执行一次的统计信息才会加载到SQL调优集中。与其他SQL调优集数据源表函数的情况一样，统计信息不是累积的。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d14012e983" headers="d14012e926 ">
                                       <p><code class="codeph">选项</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d14012e983 d14012e929 ">
                                       <p>指定操作的选项。默认值为<code class="codeph">LIMITED_COMMAND_TYPE</code> ，仅从SQL跟踪文件返回对SQL Performance Analyzer有意义的SQL类型（如<code class="codeph">SELECT</code> ， <code class="codeph">INSERT</code> ， <code class="codeph">UPDATE</code>和<code class="codeph">DELETE</code> ）。
                                       </p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d14012e1006" headers="d14012e926 ">
                                       <p><code class="codeph">pattern_start</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d14012e1006 d14012e929 ">
                                       <p>指定要考虑的跟踪文件节的开始分隔模式。目前未使用此参数。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d14012e1014" headers="d14012e926 ">
                                       <p><code class="codeph">pattern_end</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d14012e1014 d14012e929 ">
                                       <p>指定要处理的跟踪文件节的结束分隔模式。目前未使用此参数。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="31%" id="d14012e1022" headers="d14012e926 ">
                                       <p><code class="codeph">RESULT_LIMIT</code></p>
                                    </td>
                                    <td align="left" valign="top" width="69%" headers="d14012e1022 d14012e929 ">
                                       <p>指定（已过滤）源中的顶级SQL。默认值为2 <sup>31</sup> ，表示无限制。
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <div class="infoboxnotealso" id="GUID-E6298851-9BF4-4B96-8F93-D5483278F8DA__GUID-159E47A0-CA66-4876-815D-E3734504CC0C">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关<code class="codeph">DBMS_SQLTUNE</code>包的信息<a href="../arpls/DBMS_SQLTUNE.html#ARPLS220" target="_blank"><span><cite>，请参见Oracle Database PL / SQL包和类型参考</cite></span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="RATUG296"></a><div class="props_rev_3"><a id="GUID-5B437942-8CF6-4F6C-864B-996BB61B4C26" name="GUID-5B437942-8CF6-4F6C-864B-996BB61B4C26"></a><h4 id="RATUG-GUID-5B437942-8CF6-4F6C-864B-996BB61B4C26" class="sect4"><span class="enumeration_section">8.1.4</span>从Oracle9 <span class="italic">i</span>数据库和Oracle数据库<span class="italic">10g</span>第1版测试数据库升级</h4>
                  <div>
                     <div><span>构建SQL调优集后，可以使用SQL Performance Analyzer根据SQL调优集中的执行计划和运行时统计信息构建升级前的SQL试用版。在构建预升级SQL试验之后，在测试系统上的SQL调优集中执行测试执行或生成SQL语句计划，以构建升级后的SQL试用版。</span> SQL Performance Analyzer测试使用您通过远程连接到测试系统并生成SQL试验的执行计划和统计信息指定的公共数据库链接来执行SQL语句。数据库链接应存在于SQL Performance Analyzer系统上，并连接到具有在测试系统上执行SQL调整集的权限的远程用户。
                     </div>
                     <p>您可以使用Oracle Enterprise Manager或API运行SQL Performance Analyzer来测试Oracle9 <span class="italic">i</span>数据库或Oracle数据库<span class="italic">10g</span>第1版的数据库升级，如以下部分所述：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="testing-a-database-upgrade.html#GUID-83C485F8-C27E-44F9-A74C-2B3AF3DE75C1" title="使用SQL Performance Analyzer测试Oracle9i数据库或Oracle数据库10g第1版的数据库升级：">使用云控制从版本9.x和10.1测试数据库升级</a></p>
                        </li>
                        <li>
                           <p><a href="testing-a-database-upgrade.html#GUID-C0CE4A85-70A6-40F7-A6EB-83612EBA8916" title="本节介绍如何使用API测试Oracle数据库9.x和10.1版本的数据库升级。">使用API从版本9.x和10.1测试数据库升级</a></p>
                        </li>
                     </ul>
                  </div><a id="RATUG297"></a><div class="props_rev_3"><a id="GUID-83C485F8-C27E-44F9-A74C-2B3AF3DE75C1" name="GUID-83C485F8-C27E-44F9-A74C-2B3AF3DE75C1"></a><h5 id="RATUG-GUID-83C485F8-C27E-44F9-A74C-2B3AF3DE75C1" class="sect5"><span class="enumeration_section">8.1.4.1</span>使用云控制从版本9.x和10.1测试数据库升级</h5>
                     <div>
                        <p>使用SQL Performance Analyzer测试Oracle9 <span class="italic">i</span>数据库或Oracle数据库<span class="italic">10g</span>第1版的数据库升级：</p>
                        <div class="section">
                           <ol>
                              <li>
                                 <p>从<span class="bold">Performance</span>菜单中，选择<span class="bold">SQL</span> ，然后选择<span class="bold">SQL Performance Analyzer</span> 。
                                 </p>
                                 <p>如果出现“数据库登录”页面，则以具有管理员权限的用户身份登录。</p>
                                 <p>将出现SQL Performance Analyzer主页。</p>
                              </li>
                              <li>
                                 <p>在“SQL性能分析器工作流”下，单击“ <span class="bold">从9i或10.1升级”</span> 。
                                 </p>
                                 <p>将显示从9i或更高版本升级页面。</p>
                                 <div class="figure" id="GUID-83C485F8-C27E-44F9-A74C-2B3AF3DE75C1__GUID-36F0628A-F82D-4E5D-8540-4DEAFD178701"><img src="img/spa_upgrade_9i_101.gif" width="363" alt="下面是spa_upgrade_9i_101.gif的说明" title="下面是spa_upgrade_9i_101.gif的说明" longdesc="img_text/spa_upgrade_9i_101.html"><br><a href="img_text/spa_upgrade_9i_101.html">插图描述spa_upgrade_9i_101.gif</a></div>
                                 <!-- class="figure" -->
                              </li>
                              <li>
                                 <p>在任务信息下：</p>
                                 <ol type="a">
                                    <li>
                                       <p>在“任务名称”字段中，输入任务的名称。</p>
                                    </li>
                                    <li>
                                       <p>在“SQL调整集”字段中，输入已构建的SQL调整集的名称。</p>
                                       <p>或者，单击搜索图标以使用“搜索并选择：SQL调整集”窗口搜索SQL调整集。</p>
                                       <p>选定的SQL调优集现在出现在SQL调整集字段中。</p>
                                    </li>
                                    <li>
                                       <p>在“描述”字段中，可以选择输入任务的描述。</p>
                                    </li>
                                 </ol>
                              </li>
                              <li>
                                 <p>在“创建方法”字段中，选择：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>通过公共数据库链接在测试系统上远程实际运行SQL语句， <span class="bold">执行SQL</span>以生成SQL调优集中每个SQL语句的执行计划和统计信息。
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="bold">生成计划</span>以通过公共数据库链接在测试系统上远程创建执行计划，而无需实际运行SQL语句。
                                       </p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>在“每SQL时间限制”列表中，通过执行以下操作之一来确定试用期间SQL执行的时间限制：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>选择<span class="bold">5分钟</span> 。
                                       </p>
                                       <p>执行将在SQL调优设置中运行每个SQL语句最多5分钟并收集性能数据。</p>
                                    </li>
                                    <li>
                                       <p>选择<span class="bold">无限制</span> 。
                                       </p>
                                       <p>执行将运行SQL调优集中的每个SQL语句以完成并收集性能数据。收集执行统计信息可以提高性能分析的准确性，但需要更长的时间。建议不要使用此设置，因为任务可能会被一个SQL语句在较长时间内停止。</p>
                                    </li>
                                    <li>
                                       <p>选择“ <span class="bold">自定义”</span>并输入指定的秒数，分钟数或小时数。
                                       </p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>在Database Link字段中，输入连接到具有<code class="codeph">DBMS_SQLPA</code>包的<code class="codeph">EXECUTE</code>特权和测试系统的<code class="codeph">ADVISOR</code>特权的用户的公共数据库链接的全局名称。
                                 </p>
                                 <p>或者，单击搜索图标以搜索并选择数据库链接，或单击“ <span class="bold">创建数据库链接”</span>以使用“创建数据库链接”页面创建数据库链接。
                                 </p>
                              </li>
                              <li>
                                 <p>在“比较度量标准”列表中，选择要用于比较分析的比较度量标准：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><span class="bold">经过的时间</span></p>
                                    </li>
                                    <li>
                                       <p><span class="bold">CPU时间</span></p>
                                    </li>
                                    <li>
                                       <p><span class="bold">用户I / O时间</span></p>
                                    </li>
                                    <li>
                                       <p><span class="bold">缓冲区获取</span></p>
                                    </li>
                                    <li>
                                       <p><span class="bold">物理I / O.</span></p>
                                    </li>
                                    <li>
                                       <p><span class="bold">优化成本</span></p>
                                    </li>
                                    <li>
                                       <p><span class="bold">I / O互连字节</span></p>
                                    </li>
                                 </ul>
                                 <p>如果仅在SQL试验中生成执行计划，则优化程序成本是唯一可用的比较指标。</p>
                                 <p>要使用多个比较指标执行比较分析，请通过使用不同的指标重复此过程来执行单独的比较分析。</p>
                              </li>
                              <li>
                                 <p>根据时间表：</p>
                                 <ol type="a">
                                    <li>
                                       <p>在时区列表中，选择您的时区代码。</p>
                                    </li>
                                    <li>
                                       <p>选择<span class="bold">立即立即</span>启动任务，或<span class="bold">稍后</span>选择安排任务在使用日期和时间字段指定的时间启动。
                                       </p>
                                    </li>
                                 </ol>
                              </li>
                              <li>
                                 <p>单击“ <span class="bold">提交”</span>
                                 </p>
                                 <p>将出现SQL Performance Analyzer主页。</p>
                                 <p>在“SQL性能分析器任务”部分中，将显示此任务的状态。要刷新状态图标，请单击“ <span class="bold">刷新”</span> 。任务完成后，“状态”字段将更改为“已完成”。
                                 </p>
                              </li>
                              <li>
                                 <p>在“SQL性能分析器任务”下，选择任务，然后单击“名称”列中的链接。</p>
                                 <p>将出现“SQL性能分析器任务”页面。</p>
                                 <p>此页面包含以下部分：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>SQL调优集</p>
                                       <p>本节总结了有关SQL调优集的信息，包括其名称，所有者，描述以及它包含的SQL语句数。</p>
                                    </li>
                                    <li>
                                       <p>SQL试验</p>
                                       <p>本节包括一个表，其中列出了SQL Performance Analyzer任务中使用的SQL试验。</p>
                                    </li>
                                    <li>
                                       <p>SQL试用比较</p>
                                       <p>本节包含一个列出SQL试验比较结果的表</p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>单击“比较报告”列中的图标。</p>
                                 <p>将出现“SQL性能分析器任务结果”页面。</p>
                              </li>
                              <li>
                                 <p>查看性能分析的结果，如<span class="q">“ <a href="comparing-sql-trials.html#GUID-98608C0D-8BA8-4F10-94D8-3AE987087CBF" title="完成SQL性能分析器任务后，生成的数据将生成到SQL性能分析器报告中，该报告将比较更改前和更改后的SQL性能。">使用Oracle Enterprise Manager查看SQL Performance Analyzer报告</a> ”中所述</span> 。
                                 </p>
                                 <p>如果在数据库升级后找到了回归的SQL语句，请按照<span class="q">“ <a href="testing-a-database-upgrade.html#GUID-DAF2B96B-20A0-408D-BDD7-364AC1113614" title="In some cases, SQL Performance Analyzer may identify SQL statements whose performance regressed after you upgrade the database on the test system.">在测试数据库升级后调整</a></span>回归的SQL语句<span class="q">”中的说明进行<a href="testing-a-database-upgrade.html#GUID-DAF2B96B-20A0-408D-BDD7-364AC1113614" title="在某些情况下，SQL Performance Analyzer可能会识别在升级测试系统上的数据库后性能下降的SQL语句。">调整</a></span> 。
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="RATUG298"></a><div class="props_rev_3"><a id="GUID-C0CE4A85-70A6-40F7-A6EB-83612EBA8916" name="GUID-C0CE4A85-70A6-40F7-A6EB-83612EBA8916"></a><h5 id="RATUG-GUID-C0CE4A85-70A6-40F7-A6EB-83612EBA8916" class="sect5"><span class="enumeration_section">8.1.4.2</span>使用API从版本9.x和10.1测试数据库升级</h5>
                     <div>
                        <p>本节介绍如何使用API测试Oracle数据库9.x和10.1版本的数据库升级。</p>
                        <div class="section">
                           <p class="subhead3" id="GUID-C0CE4A85-70A6-40F7-A6EB-83612EBA8916__GUID-55072CAE-4DF0-4306-892A-7E0A291186C8">要测试9.x和10.1版本的数据库升级，请执行以下操作：</p>
                           <ol>
                              <li>
                                 <p>在运行SQL Performance Analyzer的系统上，创建分析任务。</p>
                              </li>
                              <li>
                                 <p>构建预升级<a id="d14012e1561" class="indexterm-anchor"></a> SQL调试通过调用SQL调优集中的执行计划和运行时统计信息<a id="d14012e1568" class="indexterm-anchor"></a>使用以下参数执行<code class="codeph">EXECUTE_ANALYSIS_TASK</code>过程：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>将<code class="codeph">task_name</code>参数设置为要执行的SQL Performance Analyzer任务的名称。
                                       </p>
                                    </li>
                                    <li>
                                       <p>将<code class="codeph">execution_type</code>参数设置为<code class="codeph">CONVERT SQLSET</code>以指示SQL Performance Analyzer将SQL调优集中的统计信息视为试验执行。
                                       </p>
                                    </li>
                                    <li>
                                       <p>使用<code class="codeph">execution_name</code>参数指定名称以标识<code class="codeph">execution_name</code> 。如果未指定，则SQL Performance Analyzer会自动为任务执行生成名称。
                                       </p>
                                    </li>
                                 </ul>
                                 <p>以下示例将名为<code class="codeph">my_spa_task</code>的SQL Performance Analyzer任务作为试验执行执行：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_SQLPA.EXECUTE_ANALYSIS_TASK（task_name =&gt;'my_spa_task'， -  execution_type =&gt;'CONVERT SQLSET'， -  execution_name =&gt;'my_trial_9i'）;</pre></li>
                              <li>
                                 <p>通过执行解释计划或使用<code class="codeph">EXECUTE_ANALYSIS_TASK</code>过程测试执行来构建升级后的SQL试用版：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>将<code class="codeph">execution_type</code>参数设置为<code class="codeph">EXPLAIN PLAN</code>或<code class="codeph">TEST EXECUTE</code> ：</p>
                                       <ul style="list-style-type:disc">
                                          <li>
                                             <p>如果您选择使用<code class="codeph">EXPLAIN PLAN</code> ，则只会生成执行计划。后续比较只能生成已更改计划的列表，而不会对性能变化做出任何结论。
                                             </p>
                                          </li>
                                          <li>
                                             <p>如果选择使用<code class="codeph">TEST EXECUTE</code> ，则SQL工作负载将执行完成。这有效地使用从测试系统生成的统计和执行计划来构建升级后的SQL试验。建议使用<code class="codeph">TEST EXECUTE</code>在源处捕获SQL执行计划和性能数据，从而实现更准确的分析。
                                             </p>
                                          </li>
                                       </ul>
                                    </li>
                                    <li>
                                       <p>将<code class="codeph">DATABASE_LINK</code>任务参数设置为连接到具有<code class="codeph">DBMS_SQLPA</code>程序包的<code class="codeph">EXECUTE</code>特权和测试系统的<code class="codeph">ADVISOR</code>特权的用户的公共数据库链接的全局名称。
                                       </p>
                                    </li>
                                 </ul>
                                 <p>以下示例通过数据库链接远程执行SQL语句的测试执行：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_SQLPA.EXECUTE_ANALYSIS_TASK（task_name =&gt;'my_spa_task'， -  execution_type =&gt;'TEST EXECUTE'， -  execution_name =&gt;'my_remote_trial_10g'， -  execution_params =&gt; dbms_advisor.arglist（'database_link'，'LINK.ABCBIZ.COM'）） ;</pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <div class="infoboxnotealso" id="GUID-C0CE4A85-70A6-40F7-A6EB-83612EBA8916__GUID-19AC2B2A-59AB-483A-A126-C5D8E869CB3F">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><span class="q">“ <a href="creating-an-analysis-task.html#GUID-A00000CF-F2DA-4138-BBFB-6FA03D889EBA" title="本节介绍如何使用DBMS_SQLPA.CREATE_ANALYSIS_TASK函数创建SQL Performance Analyzer任务。任务是SQL Performance Analyzer执行输入和结果的数据库容器。">使用API创建分析任务</a> ”</span></p>
                                 </li>
                                 <li>
                                    <p><span class="q">“ <a href="creating-a-pre-change-sql-trial.html#GUID-93D5C8A9-7E85-4467-B3E4-323B1732BA5D" title="本节介绍如何使用DBMS_SQLPA包构建更改前的性能数据。">使用API创建预更改SQL试用版</a> ”</span></p>
                                 </li>
                                 <li>
                                    <p><span class="q">“ <a href="creating-a-post-change-sql-trial.html#GUID-0C96536D-8129-4794-8527-1AA9FD240E2C" title="本节介绍如何使用DBMS_SQLPA包收集更改后的SQL性能数据。">使用API创建更改后的SQL试用版</a> ”</span></p>
                                 </li>
                                 <li>
                                    <p><a href="../arpls/DBMS_SQLPA.html#ARPLS229" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a> ，了解<code class="codeph">DBMS_SQLPA.EXECUTE_ANALYSIS_TASK</code>函数</p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div><a id="RATUG221"></a><div class="props_rev_3"><a id="GUID-AD6C3094-99C3-4F3D-A387-C7C70ACC43C4" name="GUID-AD6C3094-99C3-4F3D-A387-C7C70ACC43C4"></a><h3 id="RATUG-GUID-AD6C3094-99C3-4F3D-A387-C7C70ACC43C4" class="sect3"><span class="enumeration_section">8.2</span>从Oracle数据库<span class="italic">10g</span>第2版和更新版本升级</h3>
               <div>
                  <p>您可以使用SQL性能分析器通过捕获生产系统上的SQL调整集，然后通过远程执行两次来测试数据库从Oracle数据库<span class="italic">10g</span>第2版或更新版本升级到任何更高版本的SQL响应时间的影响测试系统上的数据库链接 - 首先创建一个更改前的SQL试验，然后再创建一个更改后的SQL试用版。
                  </p>
                  <div class="section">
                     <p>在测试数据库升级之前，请确保满足以下条件：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a id="d14012e1797" class="indexterm-anchor"></a>该<a id="d14012e1800" class="indexterm-anchor"></a>您正在升级的生产系统正在运行Oracle数据库<span class="italic">10g</span>第2版或更新版本。
                           </p>
                        </li>
                        <li>
                           <p>最初， <a id="d14012e1811" class="indexterm-anchor"></a>测试系统也应该运行相同版本的Oracle数据库。
                           </p>
                        </li>
                        <li>
                           <p>测试系统必须包含生产系统上的生产数据的精确副本。</p>
                        </li>
                        <li>
                           <p>硬件配置必须与生产系统尽可能相似。</p>
                        </li>
                     </ul>
                     <p>您还需要设置单独的SQL Performance Analyzer <a id="d14012e1824" class="indexterm-anchor"></a>运行Oracle Database <span class="italic">11g</span>第2版的系统。您将使用此系统运行SQL Performance Analyzer。您的生产数据或模式都不需要在此系统上可用，因为SQL调优集将使用存储在生产系统的SQL跟踪文件中的统计信息构建。SQL Performance Analyzer任务将在测试系统上远程执行，以通过您指定的数据库链接生成SQL试验的执行计划和统计信息。数据库链接必须是公共数据库链接，该链接连接到具有<code class="codeph">DBMS_SQLPA</code>包的<code class="codeph">EXECUTE</code>特权和测试系统的<code class="codeph">ADVISOR</code>特权的用户。您还应该从测试系统上的用户架构中删除任何现有的<code class="codeph">PLAN_TABLE</code> 。
                     </p>
                     <p>按照所述配置升级环境后，执行以下过程中所述的步骤，以便在从Oracle数据库<span class="italic">10g</span>第2版或更高版本到任何更高版本的数据库升级中使用SQL Performance Analyzer。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>在生产系统上，捕获要分析的SQL工作负载并将其存储在SQL调优集中，如<span class="q">“ <a href="introduction-to-sql-performance-analyzer.html#GUID-3828F92F-62BC-4A5E-8303-9720DCCB64B4" title="在运行SQL Performance Analyzer之前，在生产系统上捕获一组SQL语句，这些语句表示您要分析的SQL工作负载。">捕获SQL工作负载</a> ”中所述</span> 。</span></li>
                     <li class="stepexpand"><span>设置测试系统，使其尽可能与生产环境相匹配，如<span class="q">“ <a href="introduction-to-sql-performance-analyzer.html#GUID-15E99CE8-282C-4A7E-BD3B-B7C2B93DE0C1" title="将SQL工作负载捕获到生产系统上的SQL调优集后，可以在捕获工作负载的同一数据库上或在其他数据库上执行SQL Performance Analyzer分析。">设置测试系统</a> ”中所述</span> 。</span></li>
                     <li class="stepexpand"><span>将SQL调优集传输到SQL Performance Analyzer系统。</span><div>
                           <p>有关使用以下方法传输SQL调优集的信息：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>Oracle Enterprise Manager，请参阅<a href="../tdppt/tuning-sql-statements.html#TDPPT159" target="_blank"><span><cite>Oracle Database 2 Day +性能调整指南</cite></span></a></p>
                              </li>
                              <li>
                                 <p>API，请参阅<a href="../tgsql/managing-sql-tuning-sets.html#TGSQL516" target="_blank"><span><cite>Oracle Database SQL Tuning Guide</cite></span></a></p>
                              </li>
                           </ul>
                        </div>
                     </li>
                     <li class="stepexpand"><span>在SQL Performance Analyzer系统上，创建一个<a id="d14012e1897" class="indexterm-anchor"></a> SQL性能分析器任务使用SQL调整集作为其输入源。</span><div>
                           <p>远程测试通过数据库链接在测试系统上的SQL调优集中执行SQL语句，以构建预升级<a id="d14012e1907" class="indexterm-anchor"></a>将用作比较基线的SQL试用版，如<span class="q">“ <a href="testing-a-database-upgrade.html#GUID-8C91E358-5D93-4B6C-861F-50D506B621AE" title="将SQL调优集传输到SQL Performance Analyzer系统后，您可以使用SQL Performance Analyzer通过在测试系统上的SQL调优集中执行或生成SQL语句计划来构建升级前的SQL试用版。">从Oracle数据库10g第2版和更新版本测试数据库升级</a> ”中所述</span> 。
                           </p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>升级测试系统。</span></li>
                     <li class="stepexpand"><span>通过数据库链接远程测试在升级的测试系统上第二次执行SQL语句，以构建升级后的版本<a id="d14012e1927" class="indexterm-anchor"></a> SQL试用版，如<span class="q">“ <a href="testing-a-database-upgrade.html#GUID-8C91E358-5D93-4B6C-861F-50D506B621AE" title="将SQL调优集传输到SQL Performance Analyzer系统后，您可以使用SQL Performance Analyzer通过在测试系统上的SQL调优集中执行或生成SQL语句计划来构建升级前的SQL试用版。">测试Oracle数据库10g第2版及更新版本的数据库升级</a> ”中所述</span> 。</span></li>
                     <li class="stepexpand"><span>相比<a id="d14012e1944" class="indexterm-anchor"></a> SQL性能和修复<a id="d14012e1949" class="indexterm-anchor"></a>退步的SQL。</span><div>
                           <p>SQL Performance Analyzer将在升级前SQL试用期间从SQL调优集读取的SQL语句的性能与在升级后SQL试验期间从远程测试执行中捕获的SQL语句的性能进行比较。生成报告以识别执行计划或SQL语句性能的任何更改。</p>
                           <p>如果报告显示任何已回归的SQL语句，则可以进行进一步更改以修复已回归的SQL，如<span class="q">“ <a href="testing-a-database-upgrade.html#GUID-DAF2B96B-20A0-408D-BDD7-364AC1113614" title="In some cases, SQL Performance Analyzer may identify SQL statements whose performance regressed after you upgrade the database on the test system.">在测试数据库升级后调整</a></span>回归的<span class="q"><a href="testing-a-database-upgrade.html#GUID-DAF2B96B-20A0-408D-BDD7-364AC1113614" title="在某些情况下，SQL Performance Analyzer可能会识别在升级测试系统上的数据库后性能下降的SQL语句。">SQL语句</a> ”中所述</span> 。
                           </p>
                           <p>重复执行SQL调优集的过程，并将其性能与先前的执行进行比较，以测试所做的任何更改，直到您对分析结果满意为止。</p>
                        </div>
                     </li>
                  </ol>
               </div><a id="RATUG299"></a><div class="props_rev_3"><a id="GUID-8C91E358-5D93-4B6C-861F-50D506B621AE" name="GUID-8C91E358-5D93-4B6C-861F-50D506B621AE"></a><h4 id="RATUG-GUID-8C91E358-5D93-4B6C-861F-50D506B621AE" class="sect4"><span class="enumeration_section">8.2.1</span>从Oracle数据库<span class="italic">10g</span>第2版和更新版本测试数据库升级</h4>
                  <div>
                     <div><span>将SQL调优集传输到SQL Performance Analyzer系统后，您可以使用SQL Performance Analyzer通过在测试系统上的SQL调优集中执行或生成SQL语句计划来构建升级前的SQL试用版。</span> SQL Performance Analyzer测试使用您通过远程连接到测试系统并生成SQL试验的执行计划和统计信息指定的数据库链接来执行SQL语句。数据库链接应存在于SQL Performance Analyzer系统上，并连接到具有在测试系统上执行SQL调整集的权限的远程用户。
                     </div>
                     <p><a id="d14012e2058" class="indexterm-anchor"></a>在构建预升级SQL试用版之后，您需要升级测试系统。数据库升级后，SQL Performance Analyzer将需要在升级的测试系统上第二次在SQL调优集中执行或生成SQL语句计划，以构建升级后的SQL试用版。或者，如果硬件资源可用，您可以使用另一个升级的测试系统来执行第二个远程SQL试用。此方法可用于帮助您调查SQL Performance Analyzer识别的问题。
                     </p>
                     <p>您可以运行SQL Performance Analyzer来测试Oracle数据库<span class="italic">10g</span>第2版中的数据库升级或使用Oracle Enterprise Manager或API的较新版本，如以下部分所述：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="testing-a-database-upgrade.html#GUID-9C3A484E-2D3F-4BFA-AB7E-6ED088838FDE" title="要使用SQL Performance Analyzer测试Oracle Database 10g第2版或更高版本的数据库升级，请执行以下操作：">使用云控制从10.2及更高版本测试数据库升级</a></p>
                        </li>
                        <li>
                           <p><a href="testing-a-database-upgrade.html#GUID-37F2F22F-2303-4CF6-BC29-74B8C5D80431" title="本节介绍如何使用API测试Oracle Database 10.2及更高版本的数据库升级。">使用API测试10.2及更高版本的数据库升级</a></p>
                        </li>
                     </ul>
                  </div><a id="RATUG300"></a><div class="props_rev_3"><a id="GUID-9C3A484E-2D3F-4BFA-AB7E-6ED088838FDE" name="GUID-9C3A484E-2D3F-4BFA-AB7E-6ED088838FDE"></a><h5 id="RATUG-GUID-9C3A484E-2D3F-4BFA-AB7E-6ED088838FDE" class="sect5"><span class="enumeration_section">8.2.1.1</span>使用云控制从10.2及更高版本测试数据库升级</h5>
                     <div>
                        <p>要使用SQL Performance Analyzer测试Oracle数据库<span class="italic">10g</span>第2版或更高版本的数据库升级：</p>
                        <div class="section">
                           <ol>
                              <li>
                                 <p>从<span class="bold">Performance</span>菜单中，选择<span class="bold">SQL</span> ，然后选择<span class="bold">SQL Performance Analyzer</span> 。
                                 </p>
                                 <p>如果出现“数据库登录”页面，则以具有管理员权限的用户身份登录。</p>
                                 <p>将出现SQL Performance Analyzer主页。</p>
                              </li>
                              <li>
                                 <p>在“SQL性能分析器工作流”下，单击“ <span class="bold">从10.2或11g升级”</span> 。
                                 </p>
                                 <p>将显示从10.2或更高版本升级页面。</p>
                                 <div class="figure" id="GUID-9C3A484E-2D3F-4BFA-AB7E-6ED088838FDE__GUID-E666360B-31A9-4AEB-B997-B5B2E16F30B7"><img src="img/spa_upgrade_102_11g.gif" width="360" alt="下面是spa_upgrade_102_11g.gif的说明" title="下面是spa_upgrade_102_11g.gif的说明" longdesc="img_text/spa_upgrade_102_11g.html"><br><a href="img_text/spa_upgrade_102_11g.html">插图描述spa_upgrade_102_11g.gif</a></div>
                                 <!-- class="figure" -->
                              </li>
                              <li>
                                 <p>在任务信息下：</p>
                                 <ol type="a">
                                    <li>
                                       <p>在“任务名称”字段中，输入任务的名称。</p>
                                    </li>
                                    <li>
                                       <p>在“SQL调整集”字段中，输入已构建的SQL调整集的名称。</p>
                                       <p>或者，单击搜索图标以使用“搜索并选择：SQL调整集”窗口搜索SQL调整集。</p>
                                       <p>选定的SQL调优集现在出现在SQL调整集字段中。</p>
                                    </li>
                                    <li>
                                       <p>在“描述”字段中，可以选择输入任务的描述。</p>
                                    </li>
                                 </ol>
                              </li>
                              <li>
                                 <p>在“创建方法”字段中，选择：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>通过公共数据库链接在测试系统上远程实际运行SQL语句， <span class="bold">执行SQL</span>以生成SQL调优集中每个SQL语句的执行计划和统计信息。
                                       </p>
                                    </li>
                                    <li>
                                       <p><span class="bold">生成计划</span>以通过公共数据库链接在测试系统上远程创建执行计划，而无需实际运行SQL语句。
                                       </p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>在“每SQL时间限制”列表中，通过执行以下操作之一来确定试用期间SQL执行的时间限制：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>选择<span class="bold">5分钟</span> 。
                                       </p>
                                       <p>执行将在SQL调优设置中运行每个SQL语句最多5分钟并收集性能数据。</p>
                                    </li>
                                    <li>
                                       <p>选择<span class="bold">无限制</span> 。
                                       </p>
                                       <p>执行将运行SQL调优集中的每个SQL语句以完成并收集性能数据。收集执行统计信息可以提高性能分析的准确性，但需要更长的时间。建议不要使用此设置，因为任务可能会被一个SQL语句在较长时间内停止。</p>
                                    </li>
                                    <li>
                                       <p>选择“ <span class="bold">自定义”</span>并输入指定的秒数，分钟数或小时数。
                                       </p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>在“数据库链接”字段中，输入连接到具有<code class="codeph">DBMS_SQLPA</code>程序包的<code class="codeph">EXECUTE</code>特权和升级前系统的<code class="codeph">ADVISOR</code>特权的用户的公共数据库链接的全局名称。
                                 </p>
                                 <p>或者，单击搜索图标以搜索并选择数据库链接，或单击“ <span class="bold">创建数据库链接”</span>以使用“创建数据库链接”页面创建数据库链接。
                                 </p>
                              </li>
                              <li>
                                 <p>在升级后试用版中：</p>
                                 <ol type="a">
                                    <li>
                                       <p>选择<span class="bold">使用与升级前试用版</span>相同的系统，以使用相同的系统执行升级前和升级后试验。
                                       </p>
                                       <p>Oracle建议使用此选项以避免由于不同的系统配置而可能出现的错误。使用此选项时，您需要在执行升级后试用版之前将测试数据库升级到更高的数据库版本。</p>
                                    </li>
                                    <li>
                                       <p>在“数据库链接”字段中，输入连接到具有<code class="codeph">DBMS_SQLPA</code>程序包的<code class="codeph">EXECUTE</code>特权和升级后系统的<code class="codeph">ADVISOR</code>特权的用户的公共数据库链接的全局名称。
                                       </p>
                                    </li>
                                 </ol>
                              </li>
                              <li>
                                 <p>在“比较度量标准”列表中，选择要用于比较分析的比较度量标准：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><span class="bold">经过的时间</span></p>
                                    </li>
                                    <li>
                                       <p><span class="bold">CPU时间</span></p>
                                    </li>
                                    <li>
                                       <p><span class="bold">用户I / O时间</span></p>
                                    </li>
                                    <li>
                                       <p><span class="bold">缓冲区获取</span></p>
                                    </li>
                                    <li>
                                       <p><span class="bold">物理I / O.</span></p>
                                    </li>
                                    <li>
                                       <p><span class="bold">优化成本</span></p>
                                    </li>
                                    <li>
                                       <p><span class="bold">I / O互连字节</span></p>
                                    </li>
                                 </ul>
                                 <p>如果仅在SQL试验中生成执行计划，则优化程序成本是唯一可用的比较指标。</p>
                                 <p>要使用多个比较指标执行比较分析，请通过使用不同的指标重复此过程来执行单独的比较分析。</p>
                              </li>
                              <li>
                                 <p>根据时间表：</p>
                                 <ol type="a">
                                    <li>
                                       <p>在时区列表中，选择您的时区代码。</p>
                                    </li>
                                    <li>
                                       <p>选择<span class="bold">立即立即</span>启动任务，或<span class="bold">稍后</span>选择安排任务在使用日期和时间字段指定的时间启动。
                                       </p>
                                    </li>
                                 </ol>
                              </li>
                              <li>
                                 <p>单击“ <span class="bold">提交”</span>
                                 </p>
                                 <p>将出现SQL Performance Analyzer主页。</p>
                                 <p>在“SQL性能分析器任务”部分中，将显示此任务的状态。要刷新状态图标，请单击“ <span class="bold">刷新”</span> 。
                                 </p>
                                 <p>如果使用同一系统执行升级前和升级后试验，则需要在升级前试用步骤完成后升级数据库。升级数据库后，可以执行升级后试用版。任务完成后，“状态”字段将更改为“已完成”。</p>
                              </li>
                              <li>
                                 <p>在“SQL性能分析器任务”下，选择任务，然后单击“名称”列中的链接。</p>
                                 <p>将出现“SQL性能分析器任务”页面。</p>
                                 <p>此页面包含以下部分：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>SQL调优集</p>
                                       <p>本节总结了有关SQL调优集的信息，包括其名称，所有者，描述以及它包含的SQL语句数。</p>
                                    </li>
                                    <li>
                                       <p>SQL试验</p>
                                       <p>本节包括一个表，其中列出了SQL Performance Analyzer任务中使用的SQL试验。</p>
                                    </li>
                                    <li>
                                       <p>SQL试用比较</p>
                                       <p>本节包含一个列出SQL试验比较结果的表</p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>单击“比较报告”列中的图标。</p>
                                 <p>将出现“SQL性能分析器任务结果”页面。</p>
                              </li>
                              <li>
                                 <p>查看性能分析的结果，如<span class="q">“ <a href="comparing-sql-trials.html#GUID-98608C0D-8BA8-4F10-94D8-3AE987087CBF" title="完成SQL性能分析器任务后，生成的数据将生成到SQL性能分析器报告中，该报告将比较更改前和更改后的SQL性能。">使用Oracle Enterprise Manager查看SQL Performance Analyzer报告</a> ”中所述</span> 。
                                 </p>
                                 <p>如果在数据库升级后找到了回归的SQL语句，请按照<span class="q">“ <a href="testing-a-database-upgrade.html#GUID-DAF2B96B-20A0-408D-BDD7-364AC1113614" title="In some cases, SQL Performance Analyzer may identify SQL statements whose performance regressed after you upgrade the database on the test system.">在测试数据库升级后调整</a></span>回归的SQL语句<span class="q">”中的说明进行<a href="testing-a-database-upgrade.html#GUID-DAF2B96B-20A0-408D-BDD7-364AC1113614" title="在某些情况下，SQL Performance Analyzer可能会识别在升级测试系统上的数据库后性能下降的SQL语句。">调整</a></span> 。
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="RATUG301"></a><div class="props_rev_3"><a id="GUID-37F2F22F-2303-4CF6-BC29-74B8C5D80431" name="GUID-37F2F22F-2303-4CF6-BC29-74B8C5D80431"></a><h5 id="RATUG-GUID-37F2F22F-2303-4CF6-BC29-74B8C5D80431" class="sect5"><span class="enumeration_section">8.2.1.2</span>使用API测试10.2及更高版本的数据库升级</h5>
                     <div>
                        <p>本节介绍如何使用API测试Oracle Database 10.2及更高版本的数据库升级。</p>
                        <div class="section">
                           <p class="subhead3" id="GUID-37F2F22F-2303-4CF6-BC29-74B8C5D80431__GUID-AC7D234F-7D14-4EED-A228-B3A0DE3BC1A7">要测试10.2及更高版本的数据库升级：</p>
                           <ol>
                              <li>
                                 <p>在运行SQL Performance Analyzer的系统上，创建分析任务。</p>
                              </li>
                              <li>
                                 <p>构建预升级<a id="d14012e2498" class="indexterm-anchor"></a>通过在SQL调优集中执行解释计划或测试SQL语句的执行来进行SQL试验。
                                 </p>
                                 <p>打电话给<a id="d14012e2507" class="indexterm-anchor"></a>使用以下参数执行<code class="codeph">EXECUTE_ANALYSIS_TASK</code>过程：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>将<code class="codeph">task_name</code>参数设置为要执行的SQL Performance Analyzer任务的名称。
                                       </p>
                                    </li>
                                    <li>
                                       <p>将<code class="codeph">execution_type</code>参数设置为<code class="codeph">EXPLAIN PLAN</code>或<code class="codeph">TEST EXECUTE</code> ：</p>
                                       <ul style="list-style-type:disc">
                                          <li>
                                             <p>如果您选择使用<code class="codeph">EXPLAIN PLAN</code> ，则只会生成执行计划。后续比较只能生成已更改计划的列表，而不会对性能变化做出任何结论。
                                             </p>
                                          </li>
                                          <li>
                                             <p>如果选择使用<code class="codeph">TEST EXECUTE</code> ，则SQL工作负载将执行完成。这有效地使用从测试系统生成的统计和执行计划来构建升级前的SQL试验。建议使用<code class="codeph">TEST EXECUTE</code>在源处捕获SQL执行计划和性能数据，从而实现更准确的分析。
                                             </p>
                                          </li>
                                       </ul>
                                    </li>
                                    <li>
                                       <p>使用<code class="codeph">execution_name</code>参数指定名称以标识<code class="codeph">execution_name</code> 。如果未指定，则SQL Performance Analyzer会自动为任务执行生成名称。
                                       </p>
                                    </li>
                                    <li>
                                       <p>将<code class="codeph">DATABASE_LINK</code>任务参数设置为连接到具有<code class="codeph">DBMS_SQLPA</code>程序包的<code class="codeph">EXECUTE</code>特权和测试系统的<code class="codeph">ADVISOR</code>特权的用户的公共数据库链接的全局名称。
                                       </p>
                                    </li>
                                 </ul>
                                 <p>以下示例执行名为<code class="codeph">my_spa_task</code>的SQL Performance Analyzer任务，并通过数据库链接远程执行SQL语句的测试执行：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_SQLPA.EXECUTE_ANALYSIS_TASK（task_name =&gt;'my_spa_task'， -  execution_type =&gt;'TEST EXECUTE'， -  execution_name =&gt;'my_remote_trial_10g'， -  execution_params =&gt; dbms_advisor.arglist（'database_link'，'LINK.ABCBIZ.COM'）） ;</pre></li>
                              <li>
                                 <p>通过执行解释计划或使用<code class="codeph">EXECUTE_ANALYSIS_TASK</code>过程测试执行来构建升级后的SQL试用版：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p>将<code class="codeph">execution_type</code>参数设置为<code class="codeph">EXPLAIN PLAN</code>或<code class="codeph">TEST EXECUTE</code> ：</p>
                                       <ul style="list-style-type:disc">
                                          <li>
                                             <p>如果您选择使用<code class="codeph">EXPLAIN PLAN</code> ，则只会生成执行计划。后续比较只能生成已更改计划的列表，而不会对性能变化做出任何结论。
                                             </p>
                                          </li>
                                          <li>
                                             <p>如果选择使用<code class="codeph">TEST EXECUTE</code> ，则SQL工作负载将执行完成。这有效地使用从测试系统生成的统计和执行计划来构建升级后的SQL试验。建议使用<code class="codeph">TEST EXECUTE</code>在源处捕获SQL执行计划和性能数据，从而实现更准确的分析。
                                             </p>
                                          </li>
                                       </ul>
                                    </li>
                                    <li>
                                       <p>将<code class="codeph">DATABASE_LINK</code>任务参数设置为连接到具有<code class="codeph">DBMS_SQLPA</code>程序包的<code class="codeph">EXECUTE</code>特权和测试系统的<code class="codeph">ADVISOR</code>特权的用户的公共数据库链接的全局名称。
                                       </p>
                                    </li>
                                 </ul>
                                 <p>以下示例通过数据库链接远程执行SQL语句的测试执行：</p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_SQLPA.EXECUTE_ANALYSIS_TASK（task_name =&gt;'my_spa_task'， -  execution_type =&gt;'TEST EXECUTE'， -  execution_name =&gt;'my_remote_trial_12c'， -  execution_params =&gt; dbms_advisor.arglist（'database_link'，'LINK.ABCBIZ.COM'）） ;</pre></li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <div class="infoboxnotealso" id="GUID-37F2F22F-2303-4CF6-BC29-74B8C5D80431__GUID-B8B76035-B369-4BC6-AF5B-05432664D260">
                              <p class="notep1">也可以看看：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><span class="q">“ <a href="creating-an-analysis-task.html#GUID-A00000CF-F2DA-4138-BBFB-6FA03D889EBA" title="本节介绍如何使用DBMS_SQLPA.CREATE_ANALYSIS_TASK函数创建SQL Performance Analyzer任务。任务是SQL Performance Analyzer执行输入和结果的数据库容器。">使用API创建分析任务</a> ”</span></p>
                                 </li>
                                 <li>
                                    <p><span class="q">“ <a href="creating-a-pre-change-sql-trial.html#GUID-93D5C8A9-7E85-4467-B3E4-323B1732BA5D" title="本节介绍如何使用DBMS_SQLPA包构建更改前的性能数据。">使用API创建预更改SQL试用版</a> ”</span></p>
                                 </li>
                                 <li>
                                    <p><span class="q">“ <a href="creating-a-post-change-sql-trial.html#GUID-0C96536D-8129-4794-8527-1AA9FD240E2C" title="本节介绍如何使用DBMS_SQLPA包收集更改后的SQL性能数据。">使用API创建更改后的SQL试用版</a> ”</span></p>
                                 </li>
                                 <li>
                                    <p><a href="../arpls/DBMS_SQLPA.html#ARPLS229" target="_blank"><span><cite>Oracle Database PL / SQL包和类型参考</cite></span></a> ，了解<code class="codeph">DBMS_SQLPA.EXECUTE_ANALYSIS_TASK</code>函数</p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div><a id="RATUG228"></a><div class="sect2"><a id="GUID-DAF2B96B-20A0-408D-BDD7-364AC1113614" name="GUID-DAF2B96B-20A0-408D-BDD7-364AC1113614"></a><h3 id="RATUG-GUID-DAF2B96B-20A0-408D-BDD7-364AC1113614" class="sect3"><span class="enumeration_section">8.3</span>测试数据库升级后调整回归的SQL语句</h3>
               <div>
                  <p>在某些情况下，SQL Performance Analyzer可能会识别在升级测试系统上的数据库后性能下降的SQL语句。</p>
                  <p>你可以调整回归<a id="d14012e2758" class="indexterm-anchor"></a>使用SQL Tuning Advisor或SQL计划基准的SQL语句，如<a href="comparing-sql-trials.html#GUID-848B84A7-CB08-4728-9E3A-CBDD70E89E63" title="在构建更改后的SQL性能数据之后，您可以通过使用SQL Performance Analyzer运行比较分析，将在更改前的SQL试验中收集的性能数据与更改后的SQL试验进行比较。">比较SQL试验中所述</a> 。这涉及使用API构建仅包含回归SQL语句的SQL调优集的子集，将此回归SQL语句子集传输到远程数据库，以及在远程数据库上运行SQL Tuning Advisor。
                  </p>
                  <p>在运行涉及一个或多个远程SQL试验的SQL Performance Analyzer之后，Oracle Enterprise Manager不支持修复回归。</p>
                  <p>如果要从Oracle数据库<span class="italic">10g</span>第2版及更高版本升级，还可以创建SQL计划基准，以指示优化程序将来选择现有的执行计划。
                  </p>
                  <div class="infoboxnotealso" id="GUID-DAF2B96B-20A0-408D-BDD7-364AC1113614__GUID-ADE891DF-A4A9-4127-AAB0-AF3FDBE8FA97">
                     <p class="notep1">也可以看看：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="q">“ <a href="comparing-sql-trials.html#GUID-0B629FA1-FF45-44D0-BB2D-28FF762BC102">使用API调整远程SQL试验中的回归SQL语句</a> ”</span></p>
                        </li>
                        <li>
                           <p><span class="q">“ <a href="comparing-sql-trials.html#GUID-48F67DD6-70B6-49CC-B4B3-72F2D80E6DDD">使用API创建SQL计划基准</a> ”</span></p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>