<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>诊断和应对失败</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96241-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="managing-recovery-catalog.html" title="Previous" type="text/html"></link>
      <link rel="next" href="rman-data-repair-concepts.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="BRADV"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="managing-recovery-catalog.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="rman-data-repair-concepts.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">备份和恢复用户指南</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">诊断和应对失败</li>
            </ol>
            <a id="GUID-ED89DC53-A816-450B-BFF4-A712D2694EEC" name="GUID-ED89DC53-A816-450B-BFF4-A712D2694EEC"></a><a id="BRADV325"></a>
            
            <h2 id="BRADV-GUID-ED89DC53-A816-450B-BFF4-A712D2694EEC" class="sect2"><span class="enumeration_part">第五部分</span>诊断和应对故障</h2>
         </header>
         <div class="ind">
            <div>
               <p>以下章节介绍如何诊断和响应介质故障和数据损坏。本书的这一部分包含以下章节：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="rman-data-repair-concepts.html#GUID-1805CCF7-4AF2-482D-B65A-998192F89C2B" title="虽然有几个问题可以阻止Oracle数据库的正常运行或影响数据库I / O操作，但只有以下内容通常需要DBA干预和数据修复：用户错误，应用程序错误和介质故障。当由于应用程序逻辑错误或手动错误导致数据库中的数据被错误地更改或删除时，会发生用户错误。有时，软件故障可能会破坏数据块。在物理损坏（也称为介质损坏）中，数据库无法识别该块。当数据库外部的问题阻止其在正常操作期间读取或写入文件时，会发生介质故障。RMAN提供多种数据修复方法。在RMAN还原操作中，选择要还原的文件，然后运行RESTORE命令。通常，您还原文件以准备介质恢复。RMAN使用RMAN存储库中可用备份集或映像副本的记录来选择用于还原操作的最佳可用备份。RMAN自动使用还原故障转移来跳过损坏或无法访问的备份并查找可用的备份。如果未找到备份或包含损坏的数据，RMAN会自动查找从中还原所需文件的另一个备份。RMAN会在还原其内容时自动解密受备份加密保护的备份集。其他步骤（如果有）取决于用于加密备份的技术。使用自动存储管理（ASM）磁盘组时，仅当数据文件的全名（包括化身）与现有数据文件的名称不匹配时，RMAN还原操作才会创建数据文件的新副本。RMAN使用还原优化来避免在可能的情况下从备份还原数据文件。如果数据文件存在于正确的位置且其标头包含预期信息，则RMAN不会从备份还原数据文件。在介质恢复中，RMAN会对已还原的数据应用更改，以便及时前滚此数据。RMAN自动化媒体恢复。RMAN自动恢复并应用增量备份和归档重做日志，无论哪种组合最有效。只要使用RESETLOGS选项打开数据库，就会创建数据库化身。使用RESETLOGS选项打开数据库时，RMAN会执行某些操作。可插拔数据库（PDB）版本是多租户容器数据库（CDB）的子实现，表示为（database_incarnation，pdb_incarnation）。当数据库经历多个化身时，某些备份可能成为孤立备份。孤立备份是在数据库的化身期间创建的备份，这些备份不在直接祖先路径中。当您在可插拔数据库（PDB）上执行时间点恢复，然后使用RESETLOGS选项打开PDB时，可能会导致孤立PDB备份。">RMAN数据修复概念</a></p>
                  </li>
                  <li>
                     <p><a href="diagnosing-repairing-failures-dra.html#GUID-8C219B50-1F7F-4F7A-95EE-5F029AE7EB2A" title="Data Recovery Advisor是一种通过确定数据库故障的最佳自动修复选项来帮助减少数据库恢复时间的工具。Data Recovery Advisor是一个Oracle数据库工具，可自动诊断数据故障，确定并提供适当的修复选项，并根据用户的请求执行修复。在使用Data Recovery Advisor之前，您必须熟悉一些概念。Data Recovery Advisor具有命令行和GUI界面。Oracle企业管理器云控制中提供了GUI界面。检查器是在Health Monitor中注册的诊断操作或过程，用于评估数据库或其组件的运行状况。失败是由数据完整性检查检测到的持久性数据损坏。每个故障都有故障状态：OPEN或CLOSED。每个故障都有一个失败优先级：CRITICAL，HIGH或LOW。 Data Recovery Advisor仅为诊断出的故障分配CRITICAL或HIGH优先级。为清楚起见，Data Recovery Advisor将相关故障组合在一起。ADVISE FAILURE命令可以显示手动和自动修复选项。Data Recovery Advisor将手动操作分类为必需或可选。如果可能，Data Recovery Advisor会整合修复以将多个故障修复为单个修复。合并修复可能包含多个步骤。每当Data Recovery Advisor生成自动修复选项时，它都会创建一个脚本，说明RMAN打算使用哪些命令来修复故障。Data Recovery Advisor打印此脚本的位置，该脚本是驻留在操作系统上的文本文件。仅在某些数据库配置上支持Data Recovery Advisor。Data Recovery Advisor仅支持单实例数据库。不支持Oracle Real Application Clusters（Oracle RAC）数据库。Oracle Data Guard环境中的Data Recovery Advisor存在一些限制。Data Recovery Advisor只能用于诊断和修复非CDB中的数据损坏以及多租户容器数据库（CDB）的根目录。可插拔数据库（PDB）不支持Data Recovery Advisor。当您怀疑或发现故障时，Data Recovery Advisor工作流程就会开始。您可以通过多种方式发现故障，包括错误消息，警报，跟踪文件和失败的数据完整性检查。您可以使用Data Recovery Advisor自动诊断数据故障，确定适当的修复选项以及在CDB中执行修复。如果您怀疑或知道发生了一个或多个数据库故障，请使用LIST FAILURE获取有关它们的信息。确定数据库遇到问题的最简单方法是使用LIST FAILURE命令。除了提供更详细的输出外，LIST FAILURE还可以限制输出。当用户事务试图访问损坏的数据时，数据库会被动地调用数据完整性检查。在某些情况下，潜在的故障可能无法检测到。在RMAN会话中运行LIST FAILURE后，使用ADVISE FAILURE命令显示修复选项。此命令打印故障摘要，并隐式关闭所有已修复的打开故障。如果存在一个或多个故障，则通常使用LIST FAILURE显示有关故障的信息，然后在同一个RMAN会话中显示ADVISE FAILURE以获取修复选项的报告。您还可以请求特定故障的修复选项。您可以按状态（CRITICAL，HIGH或LOW）或故障编号指定故障。您还可以使用EXCLUDE FAILURE从报告中排除一个或多个故障。您可以使用Data Recovery Advisor自动修复故障。如果ADVISE FAILURE建议手动修理，请先尝试这些。如果无法进行手动修复，或者无法修复所有故障，则可以使用REPAIR FAILURE自动修复当前RMAN会话中最新ADVISE FAILURE命令中建议的故障。默认情况下，脚本显示为标准输出。您可以使用SPOOL命令将脚本写入可编辑文件。在某些情况下，您可能希望使用CHANGE FAILURE命令来更改故障的状态或优先级。">使用Data Recovery Advisor诊断和修复故障</a></p>
                  </li>
                  <li>
                     <p><a href="validating-database-files-backups.html#GUID-CC967929-9610-410D-B881-66E71353D84C" title="验证使您可以检查备份的完整性。RMAN验证的主要目的是检查损坏的块和丢失的文件。您还可以使用RMAN确定是否可以还原备份。数据库可防止导致无法使用的备份文件或损坏的已还原数据文件的操作。损坏的块是一个已更改的块，因此它与Oracle数据库期望找到的块不同。在物理损坏（也称为媒体损坏）中，数据库根本无法识别块：校验和无效，块包含全零，或块的页眉和页脚不匹配。您可以使用SET MAXCORRUPT命令设置RMAN备份文件中允许的未标记损坏总数。默认值为零，这意味着RMAN不会容忍任何类型的未标记的损坏块。Oracle数据库支持用于检测，修复和监视块损坏的不同技术。您可以使用VALIDATE命令手动检查数据库文件中的物理和逻辑损坏。您还可以使用BACKUP VALIDATE命令执行验证。你可以运行RESTORE ...VALIDATE以测试RMAN是否可以从备份还原特定文件或文件集。RMAN选择要使用的备份。RMAN使您可以使用VALIDATE命令验证多租户容器数据库（CDB）和可插拔数据库（PDB）。验证CDB的步骤与用于验证非CDB的步骤类似。有多种方法可以验证PDB。">验证数据库文件和备份</a></p>
                  </li>
                  <li>
                     <p><a href="rman-complete-database-recovery.html#GUID-D908719C-9D46-4084-850C-0F81C25094EB" title="丢失一个或多个数据库文件后，完全恢复会使数据库恢复正常运行。完全恢复正在将数据库恢复到最近的某个时间点，而不会丢失任何已提交的事务。本章中描述的完整恢复操作受特定条件的限制。零数据丢失恢复设备（恢复设备）大大减少了连续归档重做日志备份之间存在的潜在数据丢失窗口。您可以在数据库故障的几个亚之内恢复目标数据库。您必须根据恢复目标以及丢失的数据库文件来规划数据库还原和恢复策略。用于确定哪些文件需要还原或恢复的技术取决于丢失的文件类型。当任何多路复用控制文件变得不可访问时，数据库立即关闭。关于何时以及如何恢复的决定取决于数据库的状态和数据文件的位置。确定缺少哪些数据文件的简单方法是运行VALIDATE DATABASE命令。尽管VALIDATE DATABASE是确定文件是否不可访问的好方法，但您可能希望使用SQL查询来获取更详细的信息。建议您记录数据库的DBID。预览备份可帮助您确保还原和恢复操作所需的所有备份都可用。异地备份存储在远程位置，例如安全存储设施，除非媒体管理器检索媒体，否则无法恢复。验证备份可确定备份是否可用。RMAN会根据需要自动从备份还原存档的重做日志文件以执行恢复。RMAN使您可以覆盖已还原的归档重做日志文件的默认位置。要管理用于包含已还原日志的磁盘空间，可以在一个RUN块中多次指定已归档日志的还原目标，以在多个目标之间分配已还原的日志。对于使用某些技术加密的备份，您必须提供用于解密这些备份的密码。在完全恢复期间，RMAN将还原一个或多个数据文件，然后应用还原备份后生成的所有重做。您使用RESTORE和RECOVER命令来还原和恢复数据库。如果无法将数据文件还原到其默认位置，则必须更新控制文件以反映数据文件的新位置。此方案假定数据库trgt已丢失其大部分或全部数据文件。它还假定数据库使用快速恢复区域。使用带有TABLESPACE选项的RESTORE和RECOVER命令执行表空间的完全恢复您可以通过切换到无法访问的数据文件的映像副本来恢复数据库。这种技术比传统的恢复和恢复花费的时间更少，因为不需要恢复备份。当一个或多个数据文件损坏时，您可以通过切换到损坏的数据文件的现有映像副本来执行恢复。您可以通过切换到损坏的数据文件的映像副本而不是还原这些数据文件来执行完整的数据库恢复。RMAN和Oracle Enterprise Manager云控制（云控制）为多租户环境中的备份和恢复提供全面支持。恢复整个CDB时，可以在单个操作中恢复根和所有PDB。如果发生仅影响根的数据损坏或用户错误，您可以考虑仅恢复根。您可以执行一个或多个PDB的完全恢复，而不会影响其他打开的PDB的操作。企业管理器云控制（云控制）提供了恢复PDB的界面。使用RECOVER命令使用预包装备份执行完全恢复。预打印备份用于在PDB插入当前CDB之前的某个时间将PDB恢复并恢复到其状态。 RMAN使用预包装备份执行PDB的完全恢复。在将PDB迁移到当前目标CDB之前，在源非CDB或源CDB上创建了这些预制备份备份。此示例使用预刷新备份执行目标CDB prod_cdb中PDB my_pdb的完全恢复。由于不同PDB中的表空间可以具有相同的名称，以消除歧义，因此必须直接连接到PDB以恢复其一个或多个表空间。相反，由于数据文件编号和路径在整个CDB中是唯一的，因此您可以在恢复PDB数据文件时连接到根或PDB。Oracle企业管理器云控制（云控制）提供了一个用于恢复PDB中的表空间的界面。通过切换到副本来恢复CDB比传统的恢复和恢复更快。RMAN使您可以使用RESTORE和RECOVER命令执行应用程序容器的完全恢复，而不会影响CDB中的其他容器。使用RESTORE和RECOVER命令执行应用程序根目录的完全恢复。您可以执行应用程序容器的完全恢复，其中包括应用程序根目录及其所有应用程序PDB，而不会影响CDB中的其他PDB。使用RESTORE和RECOVER命令执行一个或多个应用程序PDB的完全恢复。您可以使用RESTORE和RECOVER命令将稀疏数据库恢复到最近的时间点。执行包含稀疏数据文件的数据库的恢复与执行整个数据库的恢复非常相似。执行稀疏CDB的恢复与执行稀疏数据库的完全恢复非常相似。在根级别或CDB级别连接时，可以恢复稀疏PDB。">执行完整的数据库恢复</a></p>
                  </li>
                  <li>
                     <p><a href="rman-performing-flashback-dbpitr.html#GUID-5463669A-DC89-4FF4-ACCE-136A72DF687B" title="此概述描述了Oracle闪回技术和数据库时间点恢复的目的和基本概念。某些情况适合使用时间点恢复或闪回功能，以便在之前的某个时间点将数据库或数据库对象返回到其状态。数据库时间点恢复（DBPITR）和闪回功能使您可以将数据库恢复到先前的某个时间点。DBPITR在物理级别工作，以在过去的目标时间将数据文件返回到其状态。RMAN为一个或多个PDB的时间点恢复提供支持。要恢复PDB，必须以具有SYSDBA或SYSBACKUP权限的用户身份连接到root。恢复后，PDB的旧备份仍然有效，并且可以在发生介质故障时使用。在大多数可用的情况下，Oracle数据库的闪回功能比介质恢复更有效。您可以使用它们来调查数据库的过去状态。Oracle闪回数据库是DBPITR最有效的替代方法。逻辑闪回功能用于将表及其内容恢复到过去的时间。您可以对整个多租户容器数据库（CDB）或特定可插拔数据库（PDB）执行闪回数据库操作。多租户容器数据库（CDB）可以使用共享撤消或本地撤消。RMAN用于执行闪回数据库操作的技术取决于CDB的撤消配置类型.RMAN提供了管理PDB中数据块的重做损坏的方法。闪回表使用撤消表空间中的信息而不是恢复的备份来检索表。发生闪回表操作时，将删除新行并重新插入旧行。在执行表的闪回时，数据库的其余部分仍然可用。要执行闪回表操作，该表必须符合闪回的条件，执行操作的用户必须具有所需的权限。要在一个或多个表上使用闪回表功能，请使用带有目标时间或SCN的FLASHBACK TABLE SQL语句。默认情况下，数据库在执行FLASHBACK TABLE操作之前禁用受影响表上的触发器。在操作之后，数据库将触发器返回到操作之前的状态（启用或禁用）。您可以使用FLASHBACK TABLE从回收站中检索对象...在DROP声明之前。Flashback Drop可以反转DROP TABLE操作的效果。闪回丢弃比在这种情况下可以使用的其他恢复机制（如时间点恢复）更快，并且不会导致停机或丢失最近的事务。在执行闪回删除操作之前，必须满足先决条件。使用FLASHBACK TABLE ...在DROP语句之前要从回收站中恢复对象。您可以指定回收站中表的名称或原始表名。您可以使用相同的原始名称创建，然后删除多个对象。所有丢弃的对象都存储在回收站中。闪回数据库通过将数据库返回到先前某个时间点的状态来反转不需要的更改。闪回数据库通过撤消对运行命令时存在的数据文件的更改来工作。必须满足先决条件才能执行闪回数据库操作。闪回数据库操作使用FLASHBACK DATABASE命令将数据库回滚到过去的某个时间点。您可以使用FLASHBACK DATABASE命令为整个多租户容器数据库（CDB）执行闪回数据库操作。您可以使用FLASHBACK DATABASE命令对多租户容器数据库（CDB）中的单个可插拔数据库（PDB）执行闪回数据库操作。数据字典视图包含用于监视闪回数据库的信息。RMAN DBPITR在目标恢复时间之前从备份还原数据库，然后使用增量备份和重做将数据库前滚到目标时间。您可以恢复到SCN，时间，日志序列号或还原点。Oracle建议您在重要时间创建还原点，以便在必要时使时间点恢复更易于管理。必须满足某些先决条件才能执行数据库时间点恢复（DBPITR）。使用RESTORE和RECOVER命令执行DBPITR。使用RECOVER命令执行容器数据库（CDB）和可插拔数据库（PDB）的时间点恢复（PITR）。PDB的PITR只能使用RMAN执行。使用RESTORE和RECOVER命令为整个CDB执行时间点恢复。当您将一个或多个PDB恢复到指定的时间点时，剩余的PDB将在国家开发银行不受影响，可以开放和运作。使用RESTORE和RECOVER命令执行应用程序PDB的时间点恢复。执行稀疏数据库的时间点恢复类似于执行正常数据库的时间点恢复。本节介绍基本闪回数据库和DBPITR方案的变体。闪回数据库可用于撤消OPEN RESETLOGS操作。跨OPEN RESETLOGS的闪回数据库可用于在Data Guard环境中执行多个功能。您可以使用闪回数据库将数据库回滚到废弃的数据库化身。要将DPITR执行到非当前数据库化身，必须显式执行RESET DATABASE以将数据库重置为目标SCN上当前的化身。您还必须从包含目标SCN的数据库化身中还原控制文件。">执行闪回和数据库时间点恢复</a></p>
                  </li>
                  <li>
                     <p><a href="rman-block-media-recovery.html#GUID-1E226393-17D0-4AB0-A05D-91210255D8FF" title="阻止介质恢复恢复通过恢复损坏的数据块提供较低的平均恢复时间（MTTR）。使用块介质恢复来恢复数据文件中的一个或多个损坏的数据块。通常，数据库将块标记为介质损坏，然后在首次遇到损坏时将其写入磁盘。在块恢复之前，块的后续读取不会成功。您只能对标记为损坏或未通过损坏检查的块执行块恢复。阻止恢复行为取决于是在主数据库还是物理备用数据库上发现数据块损坏。V $ DATABASE_BLOCK_CORRUPTION视图显示由数据库组件（如RMAN，ANALYZE和SQL查询）标记为已损坏的块。阻止介质恢复仅需要对要恢复的块进行不间断的重做更改。这与数据文件恢复不同，它需要从恢复开始到结束时不间断的一系列重做更改。在使用RECOVER执行块介质恢复之前，必须满足某些先决条件...BLOCK命令。使用RECOVER ......BLOCK命令用于恢复数据文件中的各个损坏块。您确定需要恢复的块，然后使用任何可用的备份来还原和恢复这些块。您可以使用Data Recovery Advisor诊断和修复数据块损坏导致的故障。在此示例中，VALIDATE DATABASE命令时发现了损坏的数据块。RMAN可以自动恢复V $ DATABASE_BLOCK_CORRUPTION视图中列出的所有块。">执行块介质恢复</a></p>
                  </li>
                  <li>
                     <p><a href="rman-recovery-advanced.html#GUID-EA9DB3ED-2481-47DD-908B-A314D5C3F730" title="您可以通过应用增量备份对在NOARCHIVELOG模式下运行的数据库执行有限的恢复恢复。增量备份必须一致，就像在NOARCHIVELOG模式下运行的数据库的所有备份一样，因此在打开数据库时无法对数据库进行备份。RMAN可以将丢失的服务器参数文件还原到其默认位置或您选择的位置。与丢失控制文件不同，丢失服务器参数文件不会导致实例立即停止。实例可能会继续运行，但您必须将其关闭并在还原服务器参数文件后重新启动它。如果已配置控制文件自动备份，则只要执行自动备份，就会使用控制文件备份服务器参数文件。您还可以使用TO PFILE&#39;filename&#39;子句将服务器参数文件还原为客户端初始化参数文件。当所有当前控制文件都丢失时，您必须还原备份控制文件。如果当前控制文件的所有副本都丢失或损坏，则必须还原并装入备份控制文件。然后，您必须运行RECOVER命令，即使没有还原数据文件，也可以使用RESETLOGS选项打开数据库。还原控制文件时，默认目标是CONTROL_FILES初始化参数中定义的所有位置。如果未设置CONTROL_FILES初始化参数，则数据库使用相同的规则来确定在未设置CONTROL_FILES参数时创建控制文件时它使用的还原控制文件的目标。恢复控制文件的过程取决于是否使用了恢复目录。无论数据库是否使用快速恢复区域，恢复控制文件的命令都是相同的。使用备份控制文件恢复数据库，如果未使用恢复目录，则需要从自动备份还原控制文件。灾难恢复包括在丢失整个目标数据库，恢复目录数据库，所有当前控制文件，所有联机重做日志文件和所有参数文件后恢复和恢复目标数据库。在使用RMAN执行灾难恢复之前，必须满足某些先决条件。假设运行数据库的Linux服务器已损坏，无法修复。幸运的是，您将数据库备份到Oracle Secure Backup并使磁带可用。您可以使用这些备份来恢复数据库。使用RESTORE和RECOVER命令还原新主机上的数据库。当您要执行灾难恢复过程的测试运行或将数据库永久移动到新主机时，在新主机上还原数据库非常有用。必须执行某些步骤以准备在新主机上恢复数据库。要使用磁盘上的数据文件副本或备份集将数据库移动到新主机，必须手动将文件传输到新主机。此过程假定RMAN正在使用恢复目录。建议您测试是否可以将数据库还原到新主机。您可以还原使用旧版RMAN创建的备份，直至Oracle Database 9i第2版（9.2.0.8）。RMAN使您可以通过网络连接到包含所需文件的物理备用数据库来还原或恢复文件。您可以还原整个数据库，数据文件，控制文件，服务器参数文件或表空间。在需要同步主数据库和备用数据库的情况下，通过网络还原文件非常有用。RMAN使用RESTORE命令的FROM SERVICE子句从物理备用数据库通过网络还原数据库文件。您可以通过网络从主数据库获取增量备份，然后将此增量备份应用于物理备用数据库来执行恢复。在某些情况下，通过网络连接到物理备用数据库来恢复文件非常有用。使用RESTORE命令通过网络连接到主数据库或物理备用数据库来还原丢失或损坏的数据文件。RMAN通过创建增量备份来转发物理备用数据库，该增量备份包含对主数据库的更改，通过网络将增量备份传输到物理备用数据库，然后将增量备份应用于物理备用数据库。主数据库上的数据文件的所有更改（从备用数据文件头中的SCN开始）都包含在增量备份中。将RECOVER STANDBY DATABASE命令与FROM SERVICE子句一起使用，以使用对主数据库所做的更改来刷新物理备用数据库。">执行RMAN恢复：高级方案</a></p>
                  </li>
                  <li>
                     <p><a href="performing-rman-tspitr.html#GUID-CAACDB53-7C3A-45B4-8249-C5D855D47571" title="要有效地使用RMAN表空间时间点恢复（TSPITR），了解它可以解决的问题类型，组件，RMAN在TSPITR期间所执行的操作以及对何时以及如何进行的各种限制和限制很有帮助。跑。本节介绍运行RMAN的基本概念，准备任务和运行模式TSPITR。恢复管理器（RMAN）TSPITR可以将数据库中的一个或多个表空间快速恢复到较早的时间，而不会影响数据库中的其余表空间和对象。了解RMAN TSPITR的概念，例如使用的术语和模式。本节定义了RMAN TSPITR使用的一些常见实体。有几种运行RMAN TSPITR的模式。各种操作模式之间的差异对应于您的环境中需要多少自动化与自定义。在执行完全自动化的RMAN TSPITR（默认）之前，从恢复集，辅助目标和目标时间中选择表空间。由于某些限制和限制，TSPITR无法解决某些数据库问题。在执行TSPITR时需要考虑一些限制。在TSPITR期间不使用恢复目录时要注意某些预防措施。准备执行TSPITR时必须完成某些步骤。为您选择正确的目标时间或SCN非常重要。 TSPITR。请注意，在TSPITR之后将表空间联机后，您不能在使表空间联机的时间之前使用任何备份。最初，恢复集包括要恢复的表空间的数据文件。但是，如果表空间中的对象需要与其他表空间中的对象建立关系（例如约束），则必须先考虑这些关系才能执行TSPITRRMAN TSPITR要求正在恢复的表空间是自包含的，并且没有SYS拥有的对象驻留在表空间中。在表空间上执行RMAN TSPITR时，在目标恢复时间之后创建的对象将丢失。您可以通过在TSPITR之前使用数据泵导出实用程序导出这些对象并在之后使用数据泵导入重新导入这些对象来保留这些对象。在默认模式下，RMAN在目标数据库上尽可能多地使用TSPITR的配置。您可以自定义RMAN TSPITR的某些方面，同时仍然主要执行完全自动化的RMAN TSPITR的过程。您可能不希望恢复集数据文件在其原始位置恢复和恢复。SET NEWNAME命令可用于指定新目标。为恢复集指定新目标时，RMAN不会删除表空间的原始数据文件。与通常存储在其原始位置的恢复集数据文件不同，辅助集数据文件不得覆盖目标数据库中的相应原始文件。如果未指定与其原始位置不同的辅助集文件位置，则TSPITR将失败。当RMAN尝试覆盖原始数据库中的相应文件并发现正在使用的文件时，会发生故障。辅助集数据文件可以在目标中具有Oracle管理文件（OMF），并且可以使用自动存储管理（ASM）或非ASM存储。当设置了DB_FILE_NAME_CONVERT初始化参数且OMF文件位于ASM或非ASM存储中时，TSPITR以不同方式执行名称转换。您可以使用辅助数据库的DB_FILE_NAME_CONVERT和LOG_FILE_NAME_CONVERT初始化参数来指定磁盘组的转换。RMAN使用该模式转换ASM磁盘组名称，并在转换后的磁盘组中生成有效的OMF文件名。有多种方法可用于重命名辅助数据库的OMF（非ASM）文件名。要为辅助集数据文件指定新名称，可以将RECOVER TABLESPACE包含在RUN命令中，并使用RUN块中的SET NEWNAME命令重命名该文件。如果您不想为所有辅助集数据文件使用辅助目标，但又不想单独命名每个文件，则可以在辅助数据库使用的初始化参数文件中包含DB_FILE_NAME_CONVERT初始化参数。临时文件被视为数据库辅助集的一部分。在实例化辅助数据库时，RMAN将重新创建目标数据库的临时表空间，并使用辅助数据文件名的常规规则生成其名称。通过重定向RMAN以使用恢复集和辅助集数据文件的现有映像副本，可以增强TSPITR性能。在这种情况下，RMAN不需要从备份还原数据文件。使用SET NEWNAME命令可以在使用映像副本执行TSPITR时指定映像副本的位置。CONFIGURE AUXNAME命令为辅助集数据文件映像副本设置持久备用位置，而SET NEWNAME命令为RUN命令的持续时间设置备用位置。使用映像副本执行TSPITR时，此过程使用CONFIGURE AUXNAME。自动辅助数据库使用一组默认初始化参数。如果需要，您可以添加其他参数。如果使用初始化参数文件，则可以使用CONTROL_FILES初始化参数为辅助数据库的控制文件指定自己的位置要在辅助数据库上恢复它们后对辅助和恢复集执行恢复，RMAN可能需要还原存档日志。使用辅助目标时，存档日志将还原到该位置。如果在辅助数据库参数文件中指定LOG_FILE_NAME_CONVERT初始化参数，并且参数成功转换目标的联机重做日志的名称，则此参数将确定联机重做日志位置。虽然Oracle建议您让RMAN管理辅助数据库的所有方面，但有时您可能必须创建和管理自己的辅助数据库。如果选择此模式，则负责设置，启动，停止和清理TSPITR中使用的辅助数据库。创建适合用作辅助数据库的Oracle实例需要执行一组步骤。有多种方法可以为辅助数据库创建密码文件。使用文本编辑器为目标数据库主机上的辅助数据库创建初始化参数文件。辅助数据库必须具有有效的网络服务名称。在继续之前，请使用SQL * Plus确保您可以与辅助数据库建立SYSBACKUP或SYSDBA连接。使用您自己的辅助实例执行TSPITR时，请记住某些准则。可以覆盖使用自己的辅助数据库进行TSPITR时通道的默认行为。您可能希望使用SET NEWNAME命令来引用辅助集文件的现有映像副本以提高TSPITR性能，或者为TSPITR之后的恢复集文件分配新名称。如有必要，请计划这些命令，并将它们添加到为TSPITR运行的命令序列中。完成先决条件，然后按照本节中的步骤使用您自己的辅助数据库执行TSPITR。在开始RMAN TSPITR之前，必须启动辅助数据库。由于辅助数据库还没有控制文件，因此只能以NOMOUNT模式启动实例。启动RMAN并连接到目标数据库和手动创建的辅助数据库。使用RECOVER TABLESPACE命令使用您自己的辅助实例执行TSPITR。此过程使用RECOVER TABLESPACE ...UNTIL命令执行TSPITR。各种问题都可能导致RMAN TSPITR失败。必须确定并修复问题。目标数据库中的文件，SET NEWNAME或CONFIGURE AUXNAME命令分配的文件名以及DB_FILE_NAME_CONVERT参数的效果生成的文件名之间可能会发生名称冲突。在TSPITR期间，RMAN需要有关哪些表空间在TSPITR目标时间具有还原段的信息。如果使用此信息，通常可在恢复目录中使用此信息。如果您正在管理自己的辅助数据库并且TSPITR失败，请不要尝试在不解决错误的情况下重新运行TSPITR。">执行RMAN表空间时间点恢复（TSPITR）</a></p>
                  </li>
                  <li>
                     <p><a href="rman-recovering-tables-partitions.html#GUID-87B7F772-335F-4179-81C9-91678D026D01" title="RMAN RECOVER命令使您可以从RMAN备份恢复表和表分区。RMAN使您可以将一个或多个表或表分区恢复到指定的时间点，而不会影响其余的数据库对象。您可以使用以前创建的RMAN备份将表和表分区恢复到指定的时间点。要恢复表或表分区，需要完全备份undo，SYSTEM，SYSAUX以及包含表或表分区的表空间。RMAN使用RECOVER命令将表或表分区恢复到指定的时间点。RMAN执行一系列步骤，同时自动执行从RMAN备份恢复表或表分区的过程。RMAN创建一个辅助数据库，它在恢复指定的表或表分区的过程中使用它。有多种技术可用于指定辅助数据库文件的位置。在将表或表分区恢复到辅助数据库上的指定时间点之后，RMAN会创建一个包含已恢复对象的数据泵导出转储文件。您可以指定此转储文件的名称和位置，也可以允许RMAN使用默认名称和位置。默认情况下，RMAN将存储在导出转储文件中的已恢复表或表分区导入目标数据库。但是，您可以使用RESTORE命令的NOTABLEIMPORT子句选择不导入已恢复的表或表分区。使用REMAP TABLE子句重命名目标数据库中已恢复的表或表分区。将表或表分区恢复到不同的模式使您可以避免可能由源模式中已存在的约束，索引或触发器名称引起的名称冲突。使用RECOVER命令从RMAN备份恢复表和表分区受到某些限制。在准备恢复表或表分区之前，必须执行一些初步任务。从RMAN备份恢复表或表分区之前，必须满足某些先决条件。确定要恢复表或表分区的确切时间点非常重要。有多种方法可以指定必须恢复对象的时间点。使用RESTORE和RECOVER命令恢复表或表分区。RMAN使您可以使用RECOVER命令将可插拔数据库（PDB）中的一个或多个表或表分区恢复到指定的时间点，而不会影响PDB中的其他对象。本节包含的示例涵盖了恢复表和表分区的多种方案。此示例将多个表恢复到使用SYSDATE表示的指定时间点。此示例使用RMAN备份来恢复多个表分区。此示例将多个表恢复为与源架构不同的新架构。">从RMAN备份恢复表和表分区</a></p>
                  </li>
               </ul>
            </div>
         </div>
      </article>
   </body>
</html>