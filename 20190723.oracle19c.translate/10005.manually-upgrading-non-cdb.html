<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <meta name="abstract" content="This procedure provides steps for upgrading non-CDB architecture Oracle Databases."></meta>
      <meta name="description" content="This procedure provides steps for upgrading non-CDB architecture Oracle Databases."></meta>
      <title>手动升级非CDB架构Oracle数据库</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Migrating Non-CDBs to New Hardware with the Same Operating System and for a New Release"></meta>
      <meta property="og:description" content="This procedure provides steps for upgrading non-CDB architecture Oracle Databases."></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Migrating Non-CDBs to New Hardware with the Same Operating System and for a New Release"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="migrating-non-cdbs-new-hardware-same-operating-system-and-new-release.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-08T17:30:30-08:00"></meta>
      <meta name="dcterms.title" content="Migrating Non-CDBs to New Hardware with the Same Operating System and for a New Release"></meta>
      <meta name="dcterms.dateCopyrighted" content="2018, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="F10898-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="using-dbua-to-upgrade-the-database.html" title="Previous" type="text/html"></link>
      <link rel="next" href="post-upgrde-tasks.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="SPMSU"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="using-dbua-to-upgrade-the-database.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="post-upgrde-tasks.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">使用相同的操作系统和新版本将非CDB迁移到新硬件</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="upgrading-db.html" property="item" typeof="WebPage"><span property="name">升级Oracle数据库</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">手动升级非CDB架构Oracle数据库</li>
            </ol>
            <a id="GUID-D6F6D375-B021-47E0-B0C8-B2C0B191AC0D" name="GUID-D6F6D375-B021-47E0-B0C8-B2C0B191AC0D"></a>
            
            <h2 id="SPMSU-GUID-D6F6D375-B021-47E0-B0C8-B2C0B191AC0D" class="sect2">手动升级非CDB架构Oracle数据库</h2>
         </header>
         <div class="ind">
            <div>
               <p>此过程提供了升级非CDB体系结构Oracle数据库的步骤。</p>
               <div class="infoboxnote" id="GUID-D6F6D375-B021-47E0-B0C8-B2C0B191AC0D__GUID-D5B93270-2FC7-49B6-8D0D-3781B096AB7D">
                  <p class="notep1">注意：</p>
                  <p>从Oracle Database 12c第1版（12.1）开始，不推荐使用非CDB体系结构。它可以在将来的版本中得到支持。</p>
               </div>
               <p>在使用此过程之前，请完成以下步骤：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p>安装Oracle数据库软件</p>
                  </li>
                  <li>
                     <p>准备新的Oracle主页</p>
                  </li>
                  <li>
                     <p>运行升级前信息工具</p>
                  </li>
               </ul>
               <p>脚步：</p>
               <ol>
                  <li>
                     <p>如果尚未执行此操作，请运行升级前信息工具。在继续之前，请查看升级前信息工具输出并更正输出中记录的所有问题。</p>
                     <p>例如，在Linux或Unix系统上：</p><pre class="pre codeblock"><code>$ ORACLE_HOME / jdk / bin / java -jar /opt/oracle/product/19.0.0/rdbms/admin/preupgrade.jar文件文本</code></pre></li>
                  <li>
                     <p>确保您有适当的备份策略。</p>
                  </li>
                  <li>
                     <p>如果您还没有这样做，请准备新的Oracle主目录。</p>
                  </li>
                  <li>
                     <p>（视情况而定）仅对于Oracle RAC环境，输入以下命令将CLUSTER_DATABASE的初始化参数值设置为FALSE：</p><pre class="pre codeblock"><code>ALTER SYSTEM SET CLUSTER_DATABASE = FALSE SCOPE = SPFILE;</code></pre></li>
                  <li>
                     <div class="p">关闭数据库。例如：<pre class="pre codeblock"><code>SQL&gt; SHUTDOWN IMMEDIATE</code></pre></div>
                  </li>
                  <li>
                     <p>如果您的操作系统是Windows，请完成以下步骤：</p>
                     <ol type="a">
                        <li>
                           <p>停止要升级的数据库的<code class="codeph">OracleService <span class="variable" translate="no">SID</span></code> Oracle服务，其中<code class="codeph"><span class="variable" translate="no">SID</span></code>是实例名称。例如，如果您的<code class="codeph"><span class="variable" translate="no">SID</span></code>是<code class="codeph">ORCL</code> ，则在命令提示符处输入以下内容：</p><pre class="pre codeblock"><code>C：\&gt; NET STOP OracleServiceORCL</code></pre></li>
                        <li>
                           <p>使用<code class="codeph">ORADIM</code>在命令提示符处删除Oracle服务。有关<code class="codeph">ORADIM</code>语法和命令的完整列表，请参阅平台指南。
                           </p>
                           <p>例如，如果您的<code class="codeph"><span class="variable" translate="no">SID</span></code>是<code class="codeph">ORCL</code> ，则输入以下命令。
                           </p><pre class="pre codeblock"><code>C：\&gt; ORADIM -DELETE -SID ORCL</code></pre></li>
                        <li>
                           <p>使用新Oracle Database发行版的<code>ORADIM</code>命令在命令提示符处为新版本Oracle Database创建服务。
                           </p>
                           <p>使用以下语法，其中<code class="codeph"><span class="variable" translate="no">SID</span></code>是您的数据库SID， <code class="codeph"><span class="variable" translate="no">PASSWORD</span></code>是您的系统密码， <code class="codeph"><span class="variable" translate="no">USERS</span></code>是您要为最大用户数设置的值， <code class="codeph"><span class="variable" translate="no">ORACLE_HOME</span></code>是您的Oracle主目录：</p><pre class="pre codeblock"><code>C：\&gt; ORADIM -NEW -SID <span class="variable" translate="no">SID</span> -SYSPWD <span class="variable" translate="no">PASSWORD</span> -MAXUSERS <span class="variable" translate="no">USERS</span> -STARTMODE AUTO -PILE <span class="variable" translate="no">ORACLE_HOME</span> \ DATABASE \ INIT <span class="variable" translate="no">SID</span> .ORA</code></pre><p>大多数Oracle数据库服务使用Oracle软件安装所有者的权限登录系统。该服务以该用户的权限运行。<code>ORADIM</code>命令会提示您为此用户帐户提供密码。您可以使用<code>ORADIM</code>指定其他选项。</p>
                           <p>在以下示例中，如果您的<code class="codeph"><span class="variable" translate="no">SID</span></code>是<code class="codeph">ORCL</code> ，则您的<code class="codeph"><span class="variable" translate="no">password</span></code> （ <code class="codeph">SYSPWD</code> ）是<code class="codeph">TWxy5791</code> ，最大用户数（ <code class="codeph">MAXUSERS</code> ）是10，Oracle主路径是<code>C:\ORACLE\PRODUCT\19.0.0\DB</code> ，然后输入以下命令：</p><pre class="pre codeblock"><code>C：\&gt; ORADIM -NEW -SID ORCL -SYSPWD TWxy5791 -MAXUSERS 10 -STARTMODE AUTO -PFILE C：\ ORACLE \ PRODUCT \ 19.0.0 \ DB \ DATABASE \ INITORCL.ORA</code></pre><p><code>ORADIM</code>将日志文件写入<code>ORACLE_HOME\database</code>目录。
                           </p>
                           <div class="infoboxnote" id="GUID-D6F6D375-B021-47E0-B0C8-B2C0B191AC0D__GUID-E08A3EC2-BA3E-407A-B3CD-0261C8F6DAEA">
                              <p class="notep1">注意：</p>如果您使用Oracle Home User帐户拥有Oracle主目录，则ORADIM命令会提示您输入该用户名和密码。
                           </div>
                        </li>
                     </ol>
                  </li>
                  <li>
                     <p>如果您的操作系统是Linux或UNIX，请执行以下检查：</p>
                     <ol type="a">
                        <li>
                           <p>您的<code class="codeph">ORACLE_SID</code>设置正确</p>
                        </li>
                        <li>
                           <p><code class="codeph">oratab</code>文件指向新的Oracle主目录</p>
                        </li>
                        <li>
                           <p>以下环境变量指向新的Oracle数据库目录：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">ORACLE_HOME</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">路径</code></p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>客户端用于设置<code class="codeph">$ORACLE_HOME</code>环境变量的任何脚本都必须指向新的Oracle主目录。
                           </p>
                        </li>
                     </ol>
                     <div class="infoboxnote" id="GUID-D6F6D375-B021-47E0-B0C8-B2C0B191AC0D__GUID-53B6CC78-A7E6-4D97-8EB4-570FEFA1CECD">
                        <p class="notep1">注意：</p>
                        <p>如果要升级Oracle Real Application Clusters数据库，请在Oracle Real Application Clusters数据库配置了实例的所有Oracle Grid Infrastructure节点上执行这些检查。</p>
                     </div>
                  </li>
                  <li>
                     <p>以新Oracle Database版本的Oracle安装所有者身份登录系统。</p>
                  </li>
                  <li>
                     <p>从新Oracle主目录中的admin目录启动新Oracle主目录中的SQL * Plus。</p>
                     <p>例如：</p><pre class="pre codeblock"><code>$ cd $ ORACLE_HOME / rdbms / admin $ pwd /u01/app/oracle/product/19.0.0/dbhome_1/rdbms/admin $ sqlplus</code></pre></li>
                  <li>
                     <p>将SPFILE.ORA或INIT.ORA文件从旧的Oracle主目录复制到新的Oracle主目录。</p>
                  </li>
                  <li>
                     <div class="p">使用具有SYSDBA权限的帐户连接到要升级的数据库：<pre class="pre codeblock"><code>SQL&gt; connect / as sysdba</code></pre></div>
                  </li>
                  <li>
                     <p>以升级模式启动非CDB Oracle数据库：</p><pre class="pre codeblock"><code>SQL&gt;启动升级</code></pre><p>如果出现列出不支持的初始化参数的错误，请记下不支持的初始化参数并继续升级。下次关闭数据库时删除不支持的初始化参数。</p>
                     <div class="infoboxnote" id="GUID-D6F6D375-B021-47E0-B0C8-B2C0B191AC0D__GUID-789184BA-E5B6-4888-9D32-EB9460C2B3E5">
                        <p class="notep1">注意：</p>
                        <p>以<code class="codeph">UPGRADE</code>模式启动数据库使您可以基于早期的Oracle数据库版本打开数据库。它还将登录限制为<code class="codeph">AS SYSDBA</code>会话，禁用系统触发器，并执行其他操作以准备升级环境。
                        </p>
                     </div>
                  </li>
                  <li>
                     <p>退出SQL * Plus。</p>
                     <p>例如：</p><pre class="pre codeblock"><code>SQL&gt; EXIT</code></pre></li>
                  <li>
                     <p>使用升级所需的升级选项运行并行升级实用程序（ <code>catctl.pl</code> ）脚本。
                     </p>
                     <p>您可以使用<code class="codeph">dbupgrade</code> shell命令将并行升级实用程序作为命令行shell命令运行，该命令位于<code class="codeph"><span class="variable" translate="no">Oracle_home</span> /bin</code> 。如果将PATH环境变量设置为包含<code class="codeph">Oracle_home/bin</code> ，则可以直接从命令行运行该命令。例如：</p><pre class="pre codeblock"><code>$ dbupgrade -d /u01/app/oracle/12.2.0/dbhome_1</code></pre><div class="infoboxnote" id="GUID-D6F6D375-B021-47E0-B0C8-B2C0B191AC0D__GUID-477CE03E-EE8B-41BE-9BE5-695D23ED54F9">
                        <p class="notep1">注意：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>运行Parallel Upgrade Utility命令时，请使用<code class="codeph">-d</code>选项指定目标Oracle主目录的文件路径。使用<code class="codeph">-l</code>选项指定要用于假脱机日志文件的目录。
                              </p>
                           </li>
                        </ul>
                     </div>
                  </li>
                  <li>
                     <p>成功升级后，数据库将关闭。重新启动实例，以便重新初始化系统参数以进行正常操作。例如：</p><pre class="pre codeblock"><code>SQL&gt; STARTUP</code></pre><p>在数据库关闭后重新启动，刷新所有缓存，清除缓冲区并执行其他内务处理活动。这些措施是确保升级的Oracle数据库软件的完整性和一致性的重要最后一步。</p>
                     <div class="infoboxnote" id="GUID-D6F6D375-B021-47E0-B0C8-B2C0B191AC0D__GUID-818FA355-75BB-4CCD-8A90-D3DF53A44330">
                        <p class="notep1">注意：</p>
                        <p>如果在启动数据库时遇到列出不支持的初始化参数的消息，则在重新启动之前从参数文件中删除不支持的初始化参数。如有必要，将<code class="codeph">SPFILE</code>转换为<code class="codeph">PFILE</code> ，以便您可以编辑该文件以删除参数。
                        </p>
                     </div>
                  </li>
                  <li>
                     <p>运行<code>catcon.pl</code>以启动<code>utlrp.sql</code> ，并重新编译任何剩余的无效对象。
                     </p>
                     <p>例如：</p><pre class="pre codeblock"><code>$ ORACLE_HOME / perl / bin / perl catcon.pl -n 1 -e -b utlrp -d'''。'''utlrp.sql</code></pre><p>因为使用<code class="codeph">-b utlrp</code>运行命令，所以在脚本运行时会生成日志文件<code class="codeph">utlrp0.log</code> 。日志文件提供重新编译的结果。
                     </p>
                  </li>
                  <li>
                     <p>运行<code>postupgrade_fixups.sql</code> 。例如：</p><pre class="pre codeblock"><code>SQL&gt; @ postupgrade_fixups.sql</code></pre><div class="infoboxnote" id="GUID-D6F6D375-B021-47E0-B0C8-B2C0B191AC0D__GUID-65C5046E-A9C9-4E07-95D1-2D27D0968BCF">
                        <p class="notep1">注意：</p>
                        <p>如果您未指定将脚本放在其他位置，则它位于默认路径<code class="codeph"><span class="variable" translate="no">Oracle_base</span> /cfgtoollogs/ <span class="variable" translate="no">SID</span> /preupgrade</code> ，其中<code class="codeph"><span class="variable" translate="no">Oracle_base</span></code>是您的Oracle基本主路径， <code class="codeph"><span class="variable" translate="no">SID</span></code>是您唯一的数据库名称。
                        </p>
                     </div>
                  </li>
                  <li>
                     <p>运行<code>utlusts.sql</code> 。该脚本验证所有问题是否已修复。
                     </p>
                     <p>例如：</p><pre class="pre codeblock"><code>SQL&gt; @ $ ORACLE_HOME / rdbms / admin / utllu122s.sql</code></pre><p>运行脚本时会生成日志文件<code class="codeph">utlu122s0.log</code> ，该文件提供升级结果。您还可以在<code class="codeph">upg_summary.log</code>查看升级报告。
                     </p>
                     <p>要查看有关数据库状态的信息，请在升级完成后随时多次运行<code>utlusts.sql</code> 。如果<code>utlusts.sql</code>脚本返回错误，或显示状态为<code class="codeph">VALID</code>的组件，或者为该组件列出的版本不是最新版本，请参阅本指南中的故障排除部分。
                     </p>
                  </li>
                  <li>
                     <p>使用<code class="codeph">DBMS_DST PL/SQL</code>程序包升级时区文件，确保时区数据文件是最新的。您还可以在升级后调整时区数据文件。
                     </p>
                  </li>
                  <li>
                     <p>退出SQL * Plus</p>
                     <p>例如：</p><pre class="pre codeblock"><code>SQL&gt; EXIT</code></pre></li>
                  <li>
                     <p>（视情况而定）如果要升级Oracle Real Application Clusters数据库，请使用以下命令语法升级Oracle Clusterware中的数据库配置：</p><pre class="pre codeblock"><code>srvctl升级数据库-db <span class="variable" translate="no">db-unique-name</span> -oraclehome <span class="variable" translate="no">oraclehome</span></code></pre><p>在此语法示例中， <code class="codeph"><span class="variable" translate="no">db-unique-name</span></code>是数据库名称（而不是实例名称）， <code class="codeph"><span class="variable" translate="no">oraclehome</span></code>是升级数据库的Oracle主目录位置。除了早期版本中使用的简短命令行界面（CLI）选项之外， <code>SRVCTL</code>实用程序还支持长GNU样式选项。
                     </p>
                  </li>
                  <li>
                     <p>（视情况而定）仅对于Oracle RAC环境，在升级所有节点后，输入以下命令将CLUSTER_DATABASE的初始化参数值设置为TRUE，并启动数据库，其中<code class="codeph"><span class="variable" translate="no">db_unique_name</span></code>是Oracle RAC数据库的名称：</p><pre class="pre codeblock"><code>ALTER SYSTEM SET CLUSTER_DATABASE = TRUE SCOPE = SPFILE; srvctl start database -db <span class="variable" translate="no">db_unique_name</span></code></pre></li>
               </ol>
               <p>您的数据库现已升级。您已准备好完成升级后的过程。</p>
               <div class="infoboxnote" id="GUID-D6F6D375-B021-47E0-B0C8-B2C0B191AC0D__GUID-ACC577D0-471E-4AF2-8EBC-B6FAD500DAF1">
                  <p class="notep1">警告：</p>
                  <p>如果您保留旧的Oracle软件，则永远不要使用旧软件启动升级的数据库。仅使用新Oracle Database主目录中的start命令启动Oracle数据库。</p>
                  <p>在删除旧的Oracle环境之前，请将该环境中的所有数据文件重定位到新的Oracle数据库环境。</p>
               </div>
               <div class="infoboxnotealso" id="GUID-D6F6D375-B021-47E0-B0C8-B2C0B191AC0D__GUID-4FD7BF4A-F3A5-4914-9645-22387E206000">
                  <p class="notep1">也可以看看：</p>
                  <p>有关重定位数据文件的信息，请参见<a href="../admin/managing-data-files-and-temp-files.html#ADMIN012" target="_blank"><span><cite>“Oracle数据库管理员指南”</cite></span></a></p>
               </div>
               <p></p>
            </div>
            <div>
               <div class="familylinks">
                  <div class="parentlink">
                     <p><strong>父主题：</strong> <a href="upgrading-db.html#GUID-A5C44D47-D082-4284-A370-C3DA100BEADB" title="Oracle提供了几种升级数据库的方法，这些方法支持企业的复杂性。">升级Oracle数据库</a></p>
                  </div>
               </div>
            </div>
            
         </div>
      </article>
   </body>
</html>