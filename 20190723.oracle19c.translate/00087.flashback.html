<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>使用Oracle闪回技术</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Database Development Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Database Development Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-development-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-31T23:23:15-08:00"></meta>
      <meta name="dcterms.title" content="Database Development Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="1996, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96334-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="advanced-part.html" title="Previous" type="text/html"></link>
      <link rel="next" href="application-architecture.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="ADFNS"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="advanced-part.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="application-architecture.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">数据库开发指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="advanced-part.html" property="item" typeof="WebPage"><span property="name">应用程序开发人员的高级主题</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">使用Oracle闪回技术</li>
            </ol>
            <a id="GUID-03D1CAAE-D940-444A-8771-B1BC636D105D" name="GUID-03D1CAAE-D940-444A-8771-B1BC636D105D"></a><a id="ADFNS1069"></a><a id="ADFNS1008"></a>
            
            <h2 id="ADFNS-GUID-03D1CAAE-D940-444A-8771-B1BC636D105D" class="sect2"><span class="enumeration_chapter">19</span>使用Oracle闪回技术</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍如何在数据库应用程序中使用Oracle闪回技术。</p>
               <div class="section">
                  <p class="subhead1" id="GUID-03D1CAAE-D940-444A-8771-B1BC636D105D__GUID-FCFE9B61-1D9A-4A0A-9483-D7F6945E940E">话题：</p>
               </div>
               <!-- class="section" -->
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="flashback.html#GUID-CAC23AAE-AD5A-47FA-B446-B4DE00B2B876">Oracle闪回技术概述</a></p>
                  </li>
                  <li>
                     <p><a href="flashback.html#GUID-779FB434-F3EA-4334-8B2A-A328555B5AFF">为Oracle闪回技术配置数据库</a></p>
                  </li>
                  <li>
                     <p><a href="flashback.html#GUID-0BD1F4BD-894B-47BA-A44B-74BCA4CFD60E">使用Oracle闪回查询（SELECT AS OF）</a></p>
                  </li>
                  <li>
                     <p><a href="flashback.html#GUID-544C00A0-D4F5-4B32-BE2F-5332EDCDD039">使用Oracle闪回版本查询</a></p>
                  </li>
                  <li>
                     <p><a href="flashback.html#GUID-212A4073-ABE2-4053-A852-3A41DEF6A24D">使用Oracle闪回事务查询</a></p>
                  </li>
                  <li>
                     <p><a href="flashback.html#GUID-115952E6-DB02-48D5-A2D3-B5C04AB68063">将Oracle闪回事务查询与Oracle闪回版本查询一起使用</a></p>
                  </li>
                  <li>
                     <p><a href="flashback.html#GUID-AE6515D5-F5F5-46BF-85D8-EB9349737691">使用DBMS_FLASHBACK包</a></p>
                  </li>
                  <li>
                     <p><a href="flashback.html#GUID-43425A2F-5932-4310-B387-C08D5331A74F">使用闪回事务</a></p>
                  </li>
                  <li>
                     <p><a href="flashback.html#GUID-06AA782A-3F79-4235-86D5-2D136485F093">使用闪回数据存档</a></p>
                  </li>
                  <li>
                     <p><a href="flashback.html#GUID-0DAA9454-D91A-46AC-A8E0-510670672F19">Oracle闪回技术的一般指南</a></p>
                  </li>
                  <li>
                     <p><a href="flashback.html#GUID-B681D62C-E66C-4C77-A03B-2C2CE8FA49CA">Oracle闪回技术的性能指南</a></p>
                  </li>
                  <li>
                     <p><a href="flashback.html#GUID-DECBC705-B421-4861-A341-E07EBB883AC9">Oracle闪回技术的多租户容器数据库限制</a></p>
                  </li>
               </ul>
            </div><a id="ADFNS1070"></a><a id="ADFNS01001"></a><div class="props_rev_3"><a id="GUID-CAC23AAE-AD5A-47FA-B446-B4DE00B2B876" name="GUID-CAC23AAE-AD5A-47FA-B446-B4DE00B2B876"></a><h3 id="ADFNS-GUID-CAC23AAE-AD5A-47FA-B446-B4DE00B2B876" class="sect3">Oracle闪回技术概述</h3>
               <div>
                  <p>Oracle闪回技术是一组Oracle数据库功能，可让您查看数据库对象的过去状态或将数据库对象返回到先前状态，而无需使用时间点介质恢复。</p>
                  <p>使用闪回功能，您可以：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>执行返回过去数据的查询</p>
                     </li>
                     <li>
                        <p>执行返回元数据的查询，这些元数据显示数据库更改的详细历史记录</p>
                     </li>
                     <li>
                        <p>将表或行恢复到以前的某个时间点</p>
                     </li>
                     <li>
                        <p>自动跟踪和归档事务数据更改</p>
                     </li>
                     <li>
                        <p>在数据库保持联机状态时回滚事务及其相关事务</p>
                     </li>
                  </ul>
                  <p>Oracle闪回功能使用自动撤消管理（AUM）系统来获取事务的元数据和历史数据。它们依赖于<strong class="term">撤销数据</strong> ，这些<strong class="term">数据</strong>是各个交易影响的记录。例如，如果用户运行<code class="codeph">UPDATE</code>语句将薪水从1000更改为1100，则Oracle数据库会将值1000存储在撤消数据中。
                  </p>
                  <p>撤消数据是持久的，并在数据库关闭后继续存在。它在<code class="codeph">undo_retention</code>指定的时间内保留，或者在自动撤消管理（AUM）存在的情况下保留调整的撤消保留。通过使用闪回功能，您可以使用撤消数据查询过去的数据或从逻辑损坏中恢复。除了在闪回功能中使用它之外，Oracle数据库还使用撤消数据来执行以下操作：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>回滚活动交易</p>
                     </li>
                     <li>
                        <p>使用数据库或进程恢复来恢复已终止的事务</p>
                     </li>
                     <li>
                        <p>为SQL查询提供读一致性</p>
                     </li>
                  </ul>
                  <div class="infoboxnote" id="GUID-CAC23AAE-AD5A-47FA-B446-B4DE00B2B876__GUID-D68E454A-8FAC-4CFB-B827-6C344C2D38C9">
                     <p class="notep1">注意：</p>
                     <p>执行<code class="codeph">CREATE</code> <code class="codeph">TABLE</code>语句后，请至少等待15秒以提交任何事务，以确保Oracle闪回功能（尤其是Oracle闪回版本查询）反映这些事务。
                     </p>
                  </div>
                  <div class="infoboxnote" id="GUID-CAC23AAE-AD5A-47FA-B446-B4DE00B2B876__GUID-FBD3ADC9-C9A4-4DCA-8C61-419C57426AD4">
                     <p class="notep1">注意：</p>
                     <p>Oracle数据库建议避免使用<code class="codeph">versions_starttime</code> ， <code class="codeph">versions_endtime</code>或<code class="codeph">scn_to_timestamp</code>列</p>
                     <p><code class="codeph">VERSIONS</code>查询（包括<code class="codeph">CTAS</code>查询）以提高性能。
                     </p>
                  </div>
                  <div class="section">
                     <p class="subhead2" id="GUID-CAC23AAE-AD5A-47FA-B446-B4DE00B2B876__GUID-085A8492-72A8-43AB-847F-43819862187A">话题：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="flashback.html#GUID-EFCF3C98-C700-4578-A4E1-1F57A0FBEC55">应用开发功能</a></p>
                        </li>
                        <li>
                           <p><a href="flashback.html#GUID-603A2020-1F8E-4C2C-BAE6-73454C4CFD7E">数据库管理功能</a></p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-CAC23AAE-AD5A-47FA-B446-B4DE00B2B876__FORADDITIONALGENERALINFORMATIONABOU-CADB9C11">
                        <p class="notep1">也可以看看：</p>
                        <p>有关闪回功能的更多信息，请参阅<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=CNCPT1439" target="_blank"><span class="italic">Oracle数据库概念</span></a></p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS599"></a><a id="ADFNS364"></a><a id="ADFNS604"></a><a id="ADFNS623"></a><a id="ADFNS624"></a><a id="ADFNS625"></a><a id="ADFNS598"></a><div class="props_rev_3"><a id="GUID-EFCF3C98-C700-4578-A4E1-1F57A0FBEC55" name="GUID-EFCF3C98-C700-4578-A4E1-1F57A0FBEC55"></a><h4 id="ADFNS-GUID-EFCF3C98-C700-4578-A4E1-1F57A0FBEC55" class="sect4">应用开发功能</h4>
                  <div>
                     <p>在应用程序开发中，您可以使用这些闪回功能来报告历史数据或撤消错误更改。（您还可以以数据库用户或管理员的身份交互使用这些功能。）</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-EFCF3C98-C700-4578-A4E1-1F57A0FBEC55__GUID-CA81BED0-3487-4A9F-ABE5-8EE3947F1508">Oracle闪回查询</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>使用此功能可以检索使用<code class="codeph">SELECT</code>语句的<code class="codeph">AS</code> <code class="codeph">OF</code>子句指定的较早时间的数据。
                        </p>
                        <div class="infoboxnotealso" id="GUID-EFCF3C98-C700-4578-A4E1-1F57A0FBEC55__FORMOREINFORMATIONSEEUSINGORACLEFLA-CADBF787">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="flashback.html#GUID-0BD1F4BD-894B-47BA-A44B-74BCA4CFD60E">使用Oracle闪回查询（SELECT AS OF）</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-EFCF3C98-C700-4578-A4E1-1F57A0FBEC55__GUID-9F42FBD8-3B4D-4468-94E2-C37882F3CB99">Oracle闪回版本查询</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>使用此功能可检索特定时间间隔的元数据和历史数据（例如，查看在给定时间间隔内存在的表的所有行）。每个行版本的元数据包括开始和结束时间，更改操作类型以及创建行版本的事务的标识。要创建Oracle闪回版本查询，请使用<code class="codeph">SELECT</code>语句的<code class="codeph">VERSIONS</code> <code class="codeph">BETWEEN</code>子句。
                        </p>
                        <div class="infoboxnotealso" id="GUID-EFCF3C98-C700-4578-A4E1-1F57A0FBEC55__FORMOREINFORMATIONSEEUSINGORACLEFLA-CADC0449">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="flashback.html#GUID-544C00A0-D4F5-4B32-BE2F-5332EDCDD039">使用Oracle闪回版本查询</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-EFCF3C98-C700-4578-A4E1-1F57A0FBEC55__GUID-851E5C4F-8CCF-4B21-A34B-E2E968DB4724">Oracle闪回事务查询</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>使用此功能可检索给定事务或给定时间间隔内所有事务的元数据和历史数据。要执行Oracle闪回事务查询，请从静态数据字典视图<code class="codeph">FLASHBACK_TRANSACTION_QUERY</code> 。</p>
                        <div class="infoboxnotealso" id="GUID-EFCF3C98-C700-4578-A4E1-1F57A0FBEC55__USINGORACLEFLASHBACKTRANSACTIONQUER-CADC0F8A">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="flashback.html#GUID-212A4073-ABE2-4053-A852-3A41DEF6A24D">使用Oracle闪回事务查询</a> 。
                           </p>
                        </div>
                        <p>通常，您将Oracle闪回事务查询与Oracle闪回版本查询一起使用，该查询为感兴趣的行提供事务ID。</p>
                        <div class="infoboxnotealso" id="GUID-EFCF3C98-C700-4578-A4E1-1F57A0FBEC55__USINGORACLEFLASHBACKTRANSACTIONQUER-CADC1987">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="flashback.html#GUID-115952E6-DB02-48D5-A2D3-B5C04AB68063">将Oracle闪回事务查询与Oracle闪回版本查询一起使用</a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-EFCF3C98-C700-4578-A4E1-1F57A0FBEC55__GUID-69A9D99E-F677-4433-ACDD-36F7D625EC81">DBMS_FLASHBACK包</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>使用此功能可将内部Oracle数据库时钟设置为较早的时间，以便您可以检查当时的当前数据，或在数据库保持联机时回滚事务及其相关事务。</p>
                        <div class="infoboxnotealso" id="GUID-EFCF3C98-C700-4578-A4E1-1F57A0FBEC55__USINGDBMS_FLASHBACKPACKAGE-CADC2A94">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><a href="flashback.html#GUID-EFCF3C98-C700-4578-A4E1-1F57A0FBEC55__BJFIIEAA">闪回事务</a></p>
                              </li>
                              <li>
                                 <p><a href="flashback.html#GUID-AE6515D5-F5F5-46BF-85D8-EB9349737691">使用DBMS_FLASHBACK包</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section" id="GUID-EFCF3C98-C700-4578-A4E1-1F57A0FBEC55__BJFIIEAA">
                        <p class="subhead3" id="GUID-EFCF3C98-C700-4578-A4E1-1F57A0FBEC55__GUID-1F735DFA-C42D-4848-A9C0-1314FFB4A349">闪回事务</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>使用闪回事务在数据库保持联机时回滚事务及其相关事务。此恢复操作使用撤消数据来创建和运行相应的补偿事务，该事务将受影响的数据返回到其原始状态。（闪回事务是<code class="codeph">DBMS_FLASHBACK</code>包的一部分）。
                        </p>
                        <div class="infoboxnotealso" id="GUID-EFCF3C98-C700-4578-A4E1-1F57A0FBEC55__USINGDBMS_FLASHBACKPACKAGE.-CADC4377">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="flashback.html#GUID-AE6515D5-F5F5-46BF-85D8-EB9349737691">使用DBMS_FLASHBACK包</a> 。
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-EFCF3C98-C700-4578-A4E1-1F57A0FBEC55__GUID-9D48BD97-77F7-455E-8826-A17C155101D6">闪回数据存档</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>使用闪回数据存档自动跟踪和存档为闪回存档启用的表的更改的历史版本，确保对数据库对象的SQL版本访问，而不会出现快照太旧的错误。</p>
                        <div class="infoboxnotealso" id="GUID-EFCF3C98-C700-4578-A4E1-1F57A0FBEC55__USINGFLASHBACKDATAARCHIVE.-CADC496E">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="flashback.html#GUID-06AA782A-3F79-4235-86D5-2D136485F093">使用闪回数据存档</a> 。
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS606"></a><a id="ADFNS607"></a><a id="ADFNS608"></a><a id="ADFNS605"></a><div class="props_rev_3"><a id="GUID-603A2020-1F8E-4C2C-BAE6-73454C4CFD7E" name="GUID-603A2020-1F8E-4C2C-BAE6-73454C4CFD7E"></a><h4 id="ADFNS-GUID-603A2020-1F8E-4C2C-BAE6-73454C4CFD7E" class="sect4">数据库管理功能</h4>
                  <div>
                     <p>这些闪回功能主要用于数据恢复。通常，您仅将这些功能用作数据库管理员。</p>
                     <p>本章重点介绍<a href="flashback.html#GUID-EFCF3C98-C700-4578-A4E1-1F57A0FBEC55">应用程序开发功能</a> 。
                     </p>
                     <div class="infoboxnotealso" id="GUID-603A2020-1F8E-4C2C-BAE6-73454C4CFD7E__ORACLEDATABASEADMINISTRATORSGUIDEOR-CADCC0D6">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ADMIN015" target="_blank"><span class="italic">Oracle数据库管理员指南</span></a></p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=BRADV80055" target="_blank"><span class="italic">Oracle数据库备份和恢复用户指南</span></a></p>
                           </li>
                        </ul>
                     </div>
                     <div class="section">
                        <p class="subhead3" id="GUID-603A2020-1F8E-4C2C-BAE6-73454C4CFD7E__GUID-B42F260A-A693-4D82-957A-4972B6D1B71B">Oracle闪回表</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>使用此功能可将表还原到以前某个时间点的状态。您可以在数据库联机时还原表，从而撤消对指定表的更改。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-603A2020-1F8E-4C2C-BAE6-73454C4CFD7E__GUID-8857E1F7-DC17-4615-8BF0-4B30FD57907D">Oracle Flashback Drop</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>使用此功能可恢复已删除的表。此功能可以反转<code class="codeph">DROP</code> <code class="codeph">TABLE</code>语句的效果。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-603A2020-1F8E-4C2C-BAE6-73454C4CFD7E__GUID-4CE51EEE-B818-4DE1-84FC-6834501DD702">Oracle闪回数据库</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>使用此功能可以使用恢复区域将数据库快速返回到较早的时间点。这很快，因为您不必还原数据库备份。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="ADFNS01002"></a><div class="props_rev_3"><a id="GUID-779FB434-F3EA-4334-8B2A-A328555B5AFF" name="GUID-779FB434-F3EA-4334-8B2A-A328555B5AFF"></a><h3 id="ADFNS-GUID-779FB434-F3EA-4334-8B2A-A328555B5AFF" class="sect3">为Oracle闪回技术配置数据库</h3>
               <div>
                  <div class="section">
                     <p>在应用程序中使用闪回功能之前，您或您的数据库管理员必须执行以下主题中描述的配置任务：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>话题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="flashback.html#GUID-D1F53BB8-8E1B-4171-857F-72B33447BFC3">配置数据库以进行自动撤消管理</a></p>
                        </li>
                        <li>
                           <p><a href="flashback.html#GUID-EBC8258B-03D9-4037-8B31-1A2EE4C73FCF">为Oracle闪回事务查询配置数据库</a></p>
                        </li>
                        <li>
                           <p><a href="flashback.html#GUID-AFDC64F5-915A-4B72-BB80-AEBA445C8000">为闪回事务配置数据库</a></p>
                        </li>
                        <li>
                           <p><a href="flashback.html#GUID-9FEB8DBB-7763-49C2-A1D2-97B4DFF85AC1">在特定LOB列上启用Oracle闪回操作</a></p>
                        </li>
                        <li>
                           <p><a href="flashback.html#GUID-BA59D897-C98B-4418-8CAE-42C35AC5B08C">授予必要的特权</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS609"></a><div class="props_rev_3"><a id="GUID-D1F53BB8-8E1B-4171-857F-72B33447BFC3" name="GUID-D1F53BB8-8E1B-4171-857F-72B33447BFC3"></a><h4 id="ADFNS-GUID-D1F53BB8-8E1B-4171-857F-72B33447BFC3" class="sect4">配置数据库以进行自动撤消管理</h4>
                  <div>
                     <div class="section">
                        <p>要为自动撤消管理（AUM）配置数据库，您或您的数据库管理员必须：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>创建具有足够空间的撤消表空间，以保留闪回操作所需的数据。</p>
                              <p>用户更新数据的频率越高，所需的空间就越大。数据库管理员通常会计算空间要求。</p>
                           </li>
                           <li>
                              <p>启用AUM，如“ <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ADMIN013" target="_blank"><span class="italic">Oracle数据库管理员指南”中所述</span></a> 。设置这些数据库初始化参数</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">UNDO_MANAGEMENT</code></p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">UNDO_TABLESPACE</code></p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">UNDO_RETENTION</code></p>
                                 </li>
                              </ul>
                              <p>对于固定大小的撤消表空间，Oracle数据库会自动调整系统以使撤消表空间具有最佳的撤消保留。</p>
                              <p>对于可自动扩展的撤消表空间，Oracle数据库保留的撤消数据的长度超过<code class="codeph">UNDO_RETENTION</code>参数指定的最长查询持续时间和撤消保留的低阈值。
                              </p>
                              <div class="infoboxnote" id="GUID-D1F53BB8-8E1B-4171-857F-72B33447BFC3__GUID-45DE2398-98F5-419C-8364-B37B7D35FA7C">
                                 <p class="notep1">注意：</p>
                                 <p>您可以查询<code class="codeph">V$UNDOSTAT</code> 。 <code class="codeph">TUNED_UNDORETENTION</code>用于确定为当前还原表空间保留还原的时间。
                                 </p>
                              </div>
                              <p>设置<code class="codeph">UNDO_RETENTION</code>并不保证不会丢弃未到期的撤消数据。如果系统需要更多空间，Oracle数据库可以使用最近生成的撤消数据覆盖未过期的撤消。
                              </p>
                           </li>
                           <li>
                              <p>为撤消表空间指定<code class="codeph">RETENTION</code> <code class="codeph">GUARANTEE</code>子句，以确保不会丢弃未到期的撤消数据。
                              </p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-D1F53BB8-8E1B-4171-857F-72B33447BFC3__GUID-B8514A50-E871-4484-A63B-427DCA491228">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关创建撤消表空间和启用AUM的详细信息，请参见<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ADMIN013" target="_blank"><span class="italic">“Oracle数据库管理员指南”</span></a></p>
                              </li>
                              <li>
                                 <p>有关<code class="codeph">V$UNDOSTAT</code>更多信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=REFRN30295" target="_blank"><span class="italic">参见Oracle数据库参考</span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS610"></a><div class="props_rev_3"><a id="GUID-EBC8258B-03D9-4037-8B31-1A2EE4C73FCF" name="GUID-EBC8258B-03D9-4037-8B31-1A2EE4C73FCF"></a><h4 id="ADFNS-GUID-EBC8258B-03D9-4037-8B31-1A2EE4C73FCF" class="sect4">为Oracle闪回事务查询配置数据库</h4>
                  <div>
                     <div class="section">
                        <p>要为Oracle闪回事务查询功能配置数据库，您或您的数据库管理员必须：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>确保Oracle Database与10.0版兼容性运行。</p>
                           </li>
                           <li>
                              <p>启用补充日志记录：</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE添加补充日志数据;</pre></li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS611"></a><div class="props_rev_3"><a id="GUID-AFDC64F5-915A-4B72-BB80-AEBA445C8000" name="GUID-AFDC64F5-915A-4B72-BB80-AEBA445C8000"></a><h4 id="ADFNS-GUID-AFDC64F5-915A-4B72-BB80-AEBA445C8000" class="sect4">为闪回事务配置数据库</h4>
                  <div>
                     <div class="section">
                        <p>要为闪回事务功能配置数据库，您或您的数据库管理员必须：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>安装数据库但未打开，启用<code class="codeph">ARCHIVELOG</code> ：</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE ARCHIVELOG;</pre></li>
                           <li>
                              <p>至少打开一个存档日志：</p><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM ARCHIVE LOG CURRENT;</pre></li>
                           <li>
                              <p>如果没有完成，请启用最小和主键补充日志记录：</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE添加补充日志数据; ALTER DATABASE添加补充日志数据（PRIMARY KEY）列;</pre></li>
                           <li>
                              <p>如果要跟踪外键依赖关系，请启用外键补充日志记录：</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE添加补充日志数据（外键）列;</pre></li>
                        </ul>
                        <div class="infoboxnote" id="GUID-AFDC64F5-915A-4B72-BB80-AEBA445C8000__GUID-C0F0D2F1-A657-4466-B6F4-B57FC8C2933A">
                           <p class="notep1">注意：</p>
                           <p>如果您有很多外键约束，启用外键补充日志记录可能不值得性能损失。</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS612"></a><div class="props_rev_3"><a id="GUID-9FEB8DBB-7763-49C2-A1D2-97B4DFF85AC1" name="GUID-9FEB8DBB-7763-49C2-A1D2-97B4DFF85AC1"></a><h4 id="ADFNS-GUID-9FEB8DBB-7763-49C2-A1D2-97B4DFF85AC1" class="sect4">在特定LOB列上启用Oracle闪回操作</h4>
                  <div>
                     <div class="section">
                        <p>要在表的特定LOB列上启用闪回操作，请使用带有<code class="codeph">RETENTION</code>选项的<code class="codeph">ALTER</code> <code class="codeph">TABLE</code>语句。
                        </p>
                        <p>由于LOB列的撤消数据可能很大，因此必须定义要用于闪回操作的LOB列。</p>
                        <div class="infoboxnotealso" id="GUID-9FEB8DBB-7763-49C2-A1D2-97B4DFF85AC1__GUID-6ACA95C8-A69B-4CF1-8B34-C4FE392E3DFC">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ADLOB101" target="_blank"><span class="italic">Oracle Database SecureFiles和Large Objects Developer's Guide</span></a> ，了解LOB存储和<code class="codeph">RETENTION</code>参数</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS614"></a><a id="ADFNS615"></a><a id="ADFNS616"></a><a id="ADFNS617"></a><a id="ADFNS613"></a><div class="props_rev_3"><a id="GUID-BA59D897-C98B-4418-8CAE-42C35AC5B08C" name="GUID-BA59D897-C98B-4418-8CAE-42C35AC5B08C"></a><h4 id="ADFNS-GUID-BA59D897-C98B-4418-8CAE-42C35AC5B08C" class="sect4">授予必要的特权</h4>
                  <div>
                     <div class="section">
                        <p>您或您的数据库管理员必须向必须使用这些闪回功能的用户，角色或应用程序授予权限。</p>
                        <div class="infoboxnotealso" id="GUID-BA59D897-C98B-4418-8CAE-42C35AC5B08C__FORINFORMATIONABOUTTHEGRANTSTATEMEN-CADD3A45">
                           <p class="notep1">也可以看看：</p>
                           <p>有关<code class="codeph">GRANT</code>语句的信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=SQLRF01603" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-BA59D897-C98B-4418-8CAE-42C35AC5B08C__GUID-C4D6BF66-E34F-44EF-9D17-CFB68139801D">对于Oracle闪回查询和Oracle闪回版本查询</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>要在查询期间允许访问特定对象，请为这些对象授予<code class="codeph">FLASHBACK</code>以及<code class="codeph">READ</code>或<code class="codeph">SELECT</code>权限。
                        </p>
                        <p>要允许对所有表进行查询，请授予<code class="codeph">FLASHBACK</code> <code class="codeph">ANY</code> <code class="codeph">TABLE</code>权限。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-BA59D897-C98B-4418-8CAE-42C35AC5B08C__GUID-A54C42FA-15A0-4AA1-8D8E-CD6B2AA88507">对于Oracle闪回事务查询</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>授予<code class="codeph">SELECT</code> <code class="codeph">ANY</code> <code class="codeph">TRANSACTION</code>权限。
                        </p>
                        <p>要允许执行Oracle闪回事务查询检索的撤消SQL代码，请为特定表授予<code class="codeph">SELECT</code> ， <code class="codeph">UPDATE</code> ， <code class="codeph">DELETE</code>和<code class="codeph">INSERT</code>权限。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-BA59D897-C98B-4418-8CAE-42C35AC5B08C__GUID-56BB5AAB-C32E-4C18-B6F4-00398387AAC1">对于DBMS_FLASHBACK包</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>要允许访问的功能<code class="codeph">DBMS_FLASHBACK</code>包，授予<code class="codeph">EXECUTE</code>的特权<code class="codeph">DBMS_FLASHBACK</code> 。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-BA59D897-C98B-4418-8CAE-42C35AC5B08C__GUID-C8B20D79-DC3F-48E3-AADD-FF36BBCC916C">对于闪回数据存档</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>要允许特定用户使用特定的闪回数据存档在表上启用闪回数据存档，请将该闪回数据存档的<code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code>对象权限授予该用户。要授予<code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code>对象权限，您必须以<code class="codeph">SYSDBA</code>身份登录或具有<code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code> <code class="codeph">ADMINISTER</code>系统特权。
                        </p>
                        <p>要允许执行这些语句，请授予<code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code> <code class="codeph">ADMINISTER</code>系统特权：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">CREATE</code> <code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">ALTER</code> <code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">DROP</code> <code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code></p>
                           </li>
                        </ul>
                        <p>要授予<code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code> <code class="codeph">ADMINISTER</code>系统特权，您必须以<code class="codeph">SYSDBA</code>身份登录。</p>
                        <p>要使用<code class="codeph">CREATE</code> <code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code>或<code class="codeph">ALTER</code> <code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code>语句创建默认闪回数据存档，您必须以<code class="codeph">SYSDBA</code>身份登录。</p>
                        <p>要为已为闪回数据存档启用的表禁用闪回数据存档，您必须以<code class="codeph">SYSDBA</code>身份登录或具有<code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code> <code class="codeph">ADMINISTER</code>系统特权。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="ADFNS1071"></a><a id="ADFNS01003"></a><div class="props_rev_3"><a id="GUID-0BD1F4BD-894B-47BA-A44B-74BCA4CFD60E" name="GUID-0BD1F4BD-894B-47BA-A44B-74BCA4CFD60E"></a><h3 id="ADFNS-GUID-0BD1F4BD-894B-47BA-A44B-74BCA4CFD60E" class="sect3">使用Oracle闪回查询（SELECT AS OF）</h3>
               <div>
                  <div class="section">
                     <p>要使用Oracle闪回查询，请使用带有<code class="codeph">AS</code> <code class="codeph">OF</code>子句的<code class="codeph">SELECT</code>语句。Oracle闪回查询检索较早时存在的数据。查询通过时间戳或系统变更号（SCN）显式引用过去时间。它返回在该时间点当前的已提交数据。
                     </p>
                     <p>Oracle闪回查询的使用包括：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>恢复丢失的数据或撤消不正确的已提交更改。</p>
                           <p>例如，如果您错误地删除或更新行，然后提交它们，则可以立即撤消该错误。</p>
                        </li>
                        <li>
                           <p>在较早时间将当前数据与相应数据进行比较。</p>
                           <p>例如，您可以运行每日报告，显示昨天数据的变化。您可以比较表数据的各行或查找行集的交集或联合。</p>
                        </li>
                        <li>
                           <p>检查特定时间的事务数据的状态。</p>
                           <p>例如，您可以验证某一天的帐户余额。</p>
                        </li>
                        <li>
                           <p>选择在特定时间或在用户定义的有效时间段内的任何时间有效的数据。</p>
                           <p>例如，您可以在指定的有效时间段内找到具有有效员工信息的员工，该员工信息具有特定时间戳或指定的开始和结束时间。（有关更多信息，请参阅<a href="design_basics.html#GUID-53F19441-81F3-4A4D-923C-464CAE0964D3">时间有效性支持</a> 。）
                           </p>
                        </li>
                        <li>
                           <p>通过消除存储某些时态数据的需要简化应用程序设计。</p>
                           <p>Oracle闪回查询允许您直接从数据库中检索过去的数据。</p>
                        </li>
                        <li>
                           <p>将打包的应用程序（如报告生成工具）应用于过去的数据。</p>
                        </li>
                        <li>
                           <p>为应用程序提供自助服务纠错，从而使用户能够撤消和纠正他们的错误。</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-0BD1F4BD-894B-47BA-A44B-74BCA4CFD60E__GUID-EF0D44C4-4969-4AB5-8230-A1540466408A">话题：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="flashback.html#GUID-19914A94-FAE3-41CF-925E-22294CAFCBF8">示例：检查和恢复过去的数据</a></p>
                        </li>
                        <li>
                           <p><a href="flashback.html#GUID-32B9B091-2BE6-486D-B7E6-3A1BAF37BCCE">Oracle闪回查询指南</a></p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-0BD1F4BD-894B-47BA-A44B-74BCA4CFD60E__FORMOREINFORMATIONABOUTTHESELECTASO-CADD8969">
                        <p class="notep1">也可以看看：</p>
                        <p>有关<code class="codeph">SELECT</code> <code class="codeph">AS</code> <code class="codeph">OF</code>语句的更多信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=SQLRF01702" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS619"></a><a id="ADFNS620"></a><a id="ADFNS618"></a><div class="props_rev_3"><a id="GUID-19914A94-FAE3-41CF-925E-22294CAFCBF8" name="GUID-19914A94-FAE3-41CF-925E-22294CAFCBF8"></a><h4 id="ADFNS-GUID-19914A94-FAE3-41CF-925E-22294CAFCBF8" class="sect4">示例：检查和恢复过去的数据</h4>
                  <div>
                     <p>假设您在下午12:30发现员工Chung的行已从<code class="codeph">employees</code>表中删除，并且您知道在上午9:30，Chung的数据已正确存储在数据库中。您可以使用Oracle闪回查询在上午9:30检查表的内容，以找出丢失的数据。如果适用，您可以恢复丢失的数据。
                     </p>
                     <p><a href="flashback.html#GUID-19914A94-FAE3-41CF-925E-22294CAFCBF8__BABHIHFF">例19-1</a>在2004年4月4日上午9:30检索<code class="codeph">Chung</code>的记录状态：</p>
                     <div class="example" id="GUID-19914A94-FAE3-41CF-925E-22294CAFCBF8__BABHIHFF">
                        <p class="titleinexample">示例19-1使用Oracle闪回查询检索丢失的行</p><pre class="oac_no_warn" dir="ltr">SELECT * FROM employees OF TIMESTAMP TO_TIMESTAMP（'2004-04-04 09:30:00'，'YYYY-MM-DD HH：MI：SS'）WHERE last_name ='Chung';</pre><p><a href="flashback.html#GUID-19914A94-FAE3-41CF-925E-22294CAFCBF8__BABJJCFE">例19-2</a>将Chung的信息恢复到<code class="codeph">employees</code>表：</p>
                     </div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-19914A94-FAE3-41CF-925E-22294CAFCBF8__BABJJCFE">
                        <p class="titleinexample">示例19-2 Oracle闪回查询后恢复丢失的行</p><pre class="oac_no_warn" dir="ltr">INSERT INTO员工（SELECT * FROM员工AS OF TIMESTAMP TO_TIMESTAMP（'2004-04-04 09:30:00'，'YYYY-MM-DD HH：MI：SS'）WHERE last_name ='Chung'）;</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="ADFNS621"></a><div class="props_rev_3"><a id="GUID-32B9B091-2BE6-486D-B7E6-3A1BAF37BCCE" name="GUID-32B9B091-2BE6-486D-B7E6-3A1BAF37BCCE"></a><h4 id="ADFNS-GUID-32B9B091-2BE6-486D-B7E6-3A1BAF37BCCE" class="sect4">Oracle闪回查询指南</h4>
                  <div>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>您可以为每个表指定或省略<code class="codeph">AS</code> <code class="codeph">OF</code>子句，并为不同的表指定不同的时间。
                           </p>
                           <div class="infoboxnote" id="GUID-32B9B091-2BE6-486D-B7E6-3A1BAF37BCCE__GUID-E43E43D9-13F9-4F95-8E60-EB2D935660E6">
                              <p class="notep1">注意：</p>
                              <p>如果表是闪回数据存档，并且您为其指定的时间早于其创建时间，则查询将返回该表的零行，而不是导致错误。</p>
                           </div>
                        </li>
                        <li>
                           <p>您可以在查询中使用<code class="codeph">AS</code> <code class="codeph">OF</code>子句在与Oracle闪回查询相同的会话中执行数据定义语言（DDL）操作（如创建和截断表）或数据操作语言（DML）语句（如<code class="codeph">INSERT</code>和<code class="codeph">DELETE</code> ）。
                           </p>
                        </li>
                        <li>
                           <p>要在影响数据库当前状态的DDL或DML语句中使用Oracle闪回查询的结果，请在<code class="codeph">INSERT</code>或<code class="codeph">CREATE</code> <code class="codeph">TABLE</code> <code class="codeph">AS</code> <code class="codeph">SELECT</code>语句中使用<code class="codeph">AS</code> <code class="codeph">OF</code>子句。
                           </p>
                        </li>
                        <li>
                           <p>如果可能的3秒错误（最大值）对应用程序中的Oracle闪回查询很重要，请使用SCN而不是时间戳。请参阅<a href="flashback.html#GUID-0DAA9454-D91A-46AC-A8E0-510670672F19">Oracle闪回技术的一般准则</a> 。
                           </p>
                        </li>
                        <li>
                           <p>您可以使用定义视图的<code class="codeph">SELECT</code>语句中的<code class="codeph">AS</code> <code class="codeph">OF</code>子句创建引用过去数据的视图。
                           </p>
                           <p>如果通过从数据库主机上的当前时间减去指定相对时间，则会为每个查询重新计算过去时间。例如：</p><pre class="oac_no_warn" dir="ltr">创建视图hour_ago AS SELECT *来自员工AS OF TIMESTAMP（SYSTIMESTAMP  -  INTERVAL'60'MECUTE）;</pre><p><code class="codeph">SYSTIMESTAMP</code>是指数据库主机环境的时区。
                           </p>
                        </li>
                        <li>
                           <p>您可以在自联接中使用<code class="codeph">AS</code> <code class="codeph">OF</code>子句，也可以在诸如<code class="codeph">INTERSECT</code>和<code class="codeph">MINUS</code>类的集合操作中使用<code class="codeph">AS</code> <code class="codeph">OF</code>子句来提取或比较来自两个不同时间的数据。
                           </p>
                           <p>您可以通过前面的Oracle闪回查询与<code class="codeph">CREATE</code> <code class="codeph">TABLE</code> <code class="codeph">AS</code> <code class="codeph">SELECT</code>或<code class="codeph">INSERT</code> <code class="codeph">INTO</code> <code class="codeph">TABLE</code> <code class="codeph">SELECT</code>语句存储结果。例如，此查询将一小时前存在的行重新插入表<code class="codeph">employees</code> ：</p><pre class="oac_no_warn" dir="ltr">INSERT INTO员工（SELECT * FROM员工AS OF TIMESTAMP（SYSTIMESTAMP  -  INTERVAL'60'MINUTE）MINUS SELECT * FROM employees;</pre><p><code class="codeph">SYSTIMESTAMP</code>是指数据库主机环境的时区。
                           </p>
                        </li>
                        <li>
                           <p>您可以在查询中使用<code class="codeph">AS</code> <code class="codeph">OF</code>子句来检查在特定时间有效的数据。
                           </p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-32B9B091-2BE6-486D-B7E6-3A1BAF37BCCE__GUID-6989D7BA-FF19-4781-86BB-5CD26A6B975F">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="design_basics.html#GUID-53F19441-81F3-4A4D-923C-464CAE0964D3">时间有效性支持</a></p>
                           </li>
                           <li>
                              <p><a href="flashback.html#GUID-06AA782A-3F79-4235-86D5-2D136485F093">使用闪回数据存档</a>获取有关闪<a href="flashback.html#GUID-06AA782A-3F79-4235-86D5-2D136485F093">回数据存档</a>的信息</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div><a id="ADFNS622"></a><a id="ADFNS01004"></a><div class="props_rev_3"><a id="GUID-544C00A0-D4F5-4B32-BE2F-5332EDCDD039" name="GUID-544C00A0-D4F5-4B32-BE2F-5332EDCDD039"></a><h3 id="ADFNS-GUID-544C00A0-D4F5-4B32-BE2F-5332EDCDD039" class="sect3">使用Oracle闪回版本查询</h3>
               <div>
                  <div class="section">
                     <p>使用Oracle闪回版本查询检索给定时间间隔内存在的特定行的不同版本。每当执行<code class="codeph">COMMIT</code>语句时，都会创建行版本。
                     </p>
                     <div class="infoboxnote" id="GUID-544C00A0-D4F5-4B32-BE2F-5332EDCDD039__GUID-5F6D784C-46C6-4B26-8D9B-D7862B2E072D">
                        <p class="notep1">注意：</p>
                        <p>执行<code class="codeph">CREATE</code> <code class="codeph">TABLE</code>语句后，请至少等待15秒以提交任何事务，以确保Oracle闪回版本查询反映这些事务。
                        </p>
                     </div>
                     <p>使用<code class="codeph">SELECT</code>语句的<code class="codeph">VERSIONS</code> <code class="codeph">BETWEEN</code>子句指定Oracle闪回版本查询。语法是：</p><pre class="oac_no_warn" dir="ltr">{SCN |之间的版本TIMESTAMP} <span class="italic"><code class="codeph">start</code></span>和<span class="italic"><code class="codeph">end</code></span>
</pre><p>其中<span class="italic"><code class="codeph">start</code></span>和<span class="italic"><code class="codeph">end</code></span>分别表示要查询的时间间隔的<span class="italic"><code class="codeph">start</code></span>和<span class="italic"><code class="codeph">end</code></span>的表达式。时间间隔包括（ <span class="italic"><code class="codeph">start</code></span>和<span class="italic"><code class="codeph">end</code></span> ）。
                     </p>
                     <p>要么：</p><pre class="oac_no_warn" dir="ltr"><span class="italic">user_valid_time</span> [BETWEEN TIMESTAMP <span class="italic"><code class="codeph">start</code></span>和<span class="italic"><code class="codeph">end</code></span> ]的版本周期</pre><p>其中<span class="italic"><code class="codeph">user_valid_time</code></span>指用户指定的有效时间段，如<a href="design_basics.html#GUID-53F19441-81F3-4A4D-923C-464CAE0964D3">时间有效性支持中所述</a> 。
                     </p>
                     <p>Oracle闪回版本查询返回一个表，该表在指定的时间间隔内随时存在的每行版本都有一行。表中的每一行都包含有关行版本的元数据的伪列，可以显示数据库发生特定更改（可能是错误的）的时间和方式。</p>
                     <p><a href="flashback.html#GUID-544C00A0-D4F5-4B32-BE2F-5332EDCDD039__G1020732" title="此表汇总了闪回版本查询行的伪列。">表19-1</a>描述了有关行版本的元数据的伪列。<code class="codeph">VERSIONS_*</code>伪列仅具有事务时闪回版本查询的值（即具有<code class="codeph">BETWEEN</code> <code class="codeph">TIMESTAMP</code>子句<span class="italic"><code class="codeph">start</code></span> <code class="codeph">AND</code> <span class="italic"><code class="codeph">end</code></span> ）。
                     </p>
                     <div class="tblformal" id="GUID-544C00A0-D4F5-4B32-BE2F-5332EDCDD039__G1020732">
                        <p class="titleintable">表19-1 Oracle闪回版本查询行数据伪列</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="Oracle闪回版本查询行数据伪列" width="100%" border="1" summary="This table summarizes the pseudocolumns of Flashback Version Query rows." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="21%" id="d111972e2489">伪列名称</th>
                                 <th align="left" valign="bottom" width="79%" id="d111972e2492">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="21%" id="d111972e2497" headers="d111972e2489 ">
                                    <p><code class="codeph">VERSIONS_STARTSCN</code></p>
                                    <p><code class="codeph">VERSIONS_STARTTIME</code></p>
                                 </td>
                                 <td align="left" valign="top" width="79%" headers="d111972e2497 d111972e2492 ">
                                    <p>创建行版本时启动系统更改编号（SCN）或<code class="codeph">TIMESTAMP</code> 。此伪列标识数据首次具有行版本中反映的值的时间。使用此伪列来标识Oracle闪回表或Oracle闪回查询的过去目标时间。
                                    </p>
                                    <p>如果此伪列为<code class="codeph">NULL</code> ，则在<span class="italic"><code class="codeph">start</code></span>之前创建行版本。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="21%" id="d111972e2520" headers="d111972e2489 ">
                                    <p><code class="codeph">VERSIONS_ENDSCN</code></p>
                                    <p><code class="codeph">VERSIONS_ENDTIME</code></p>
                                 </td>
                                 <td align="left" valign="top" width="79%" headers="d111972e2520 d111972e2492 ">
                                    <p>行版本过期时的SCN或<code class="codeph">TIMESTAMP</code> 。
                                    </p>
                                    <p>如果此伪列为<code class="codeph">NULL</code> ，则行版本在查询时是当前的，或者行对应于<code class="codeph">DELETE</code>操作。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="21%" id="d111972e2542" headers="d111972e2489 ">
                                    <p><code class="codeph">VERSIONS_XID</code></p>
                                 </td>
                                 <td align="left" valign="top" width="79%" headers="d111972e2542 d111972e2492 ">
                                    <p>创建行版本的事务的标识符。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="21%" id="d111972e2550" headers="d111972e2489 ">
                                    <p><code class="codeph">VERSIONS_OPERATION</code></p>
                                 </td>
                                 <td align="left" valign="top" width="79%" headers="d111972e2550 d111972e2492 ">
                                    <p>事务执行的操作： <code class="codeph">I</code>表示插入， <code class="codeph">D</code>表示删除， <code class="codeph">U</code>表示更新。版本是插入，删除或更新的行的版本;即， <code class="codeph">INSERT</code>操作之后的行， <code class="codeph">DELETE</code>操作之前的行或受<code class="codeph">UPDATE</code>操作影响的行。
                                    </p>
                                    <p>对于索引键的用户更新，Oracle闪回版本查询可能将<code class="codeph">UPDATE</code>操作视为两个操作， <code class="codeph">DELETE</code>加<code class="codeph">INSERT</code> ，表示为两个版本行，其中<code class="codeph">D</code>后跟<code class="codeph">I</code> <code class="codeph">VERSIONS_OPERATION</code> 。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>给定的行版本在其时间<code class="codeph">VERSIONS_START*</code>开始有效，但不包括其时间<code class="codeph">VERSIONS_END*</code> 。也就是说，它在任何时间<span class="italic">t</span>都有效，使得<code class="codeph">VERSIONS_START*</code> <span class="bold">&lt;=</span> <span class="italic">t</span> <span class="bold">&lt;</span> <code class="codeph">VERSIONS_END*</code> 。例如，此输出表明从2002年9月9日起包括的截止日期为2003年11月25日的工资为10243。
                     </p><pre class="oac_no_warn" dir="ltr">VERSIONS_START_TIME VERSIONS_END_TIME SALARY ------------------- ----------------- ------ 09-SEP-2003 25-NOV-2003 10243</pre><p>以下是Oracle闪回版本查询的典型用法：</p><pre class="oac_no_warn" dir="ltr">SELECT versions_startscn，versions_starttime，versions_endscn，versions_endtime，versions_xid，versions_operation，last_name，salary FROM员工在TIMESTAMP TO_TIMESTAMP之间的版本（'2008-12-18 14:00:00'，'YYYY-MM-DD HH24：MI：SS'）和TO_TIMESTAMP（'2008-12-18 17:00:00'，'YYYY-MM-DD HH24：MI：SS'）WHERE first_name ='John';</pre><p>您可以将<code class="codeph">VERSIONS_XID</code>与Oracle闪回事务查询一起使用来查找此事务的元数据，包括撤消行更改所需的SQL以及负责更改的用户。
                     </p>
                     <p>闪回版本查询仅允许使用IOT（索引组织表）进行仅索引访问，但不允许使用索引快速完全扫描。</p>
                     <div class="infoboxnotealso" id="GUID-544C00A0-D4F5-4B32-BE2F-5332EDCDD039__GUID-EFC77F2C-E339-4E16-B1ED-5A9B437C0FEE">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>有关Oracle闪回版本查询伪列的信息以及<code class="codeph">VERSIONS</code>子句的语法，请参阅<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=SQLRF01702" target="_blank"><span class="italic">Oracle数据库SQL语言参考</span></a></p>
                           </li>
                           <li>
                              <p><a href="flashback.html#GUID-212A4073-ABE2-4053-A852-3A41DEF6A24D">使用Oracle闪回事务查询</a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="ADFNS01005"></a><div class="props_rev_3"><a id="GUID-212A4073-ABE2-4053-A852-3A41DEF6A24D" name="GUID-212A4073-ABE2-4053-A852-3A41DEF6A24D"></a><h3 id="ADFNS-GUID-212A4073-ABE2-4053-A852-3A41DEF6A24D" class="sect3">使用Oracle闪回事务查询</h3>
               <div>
                  <div class="section">
                     <p>使用Oracle闪回事务查询检索给定事务或给定时间间隔内所有事务的元数据和历史数据。Oracle闪回事务查询查询静态数据字典视图<code class="codeph">FLASHBACK_TRANSACTION_QUERY</code> ，其列在<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=REFRN29086" target="_blank"><span class="italic">Oracle数据库参考</span></a>中描述。
                     </p>
                     <p><code class="codeph">UNDO_SQL</code>列显示的SQL代码与事务执行的DML操作逻辑相反。您通常可以使用此代码来反转事务期间采取的逻辑步骤。但是，有些情况下<code class="codeph">UNDO_SQL</code>代码与原始事务不完全相反。例如， <code class="codeph">UNDO_SQL</code> <code class="codeph">INSERT</code>操作可能不会在与删除它的<code class="codeph">ROWID</code>相同的表中插入一行。
                     </p>
                     <p>此语句在<code class="codeph">FLASHBACK_TRANSACTION_QUERY</code>视图中查询事务信息，包括事务ID，操作，操作开始和结束SCN，负责操作的用户以及显示操作逻辑相反的SQL代码：</p><pre class="oac_no_warn" dir="ltr">SELECT xid，operation，start_scn，commit_scn，logon_user，undo_sql FROM flashback_transaction_query WHERE xid = HEXTORAW（'000200030000002D'）;</pre><p>此语句使用Oracle闪回版本查询作为子查询，将每个行版本与负责行数据更改的<code class="codeph">LOGON_USER</code>相关联：</p><pre class="oac_no_warn" dir="ltr">SELECT xid，logon_user FROM flashback_transaction_query WHERE xid IN（SELECT versions_xid FROM employees VERSIONS BETWEEN TIMESTAMP TO_TIMESTAMP（'2003-07-18 14:00:00'，'YYYY-MM-DD HH24：MI：SS'）和TO_TIMESTAMP（'2003 -07-18 17:00:00'，'YYYY-MM-DD HH24：MI：SS'））;</pre><div class="infoboxnote" id="GUID-212A4073-ABE2-4053-A852-3A41DEF6A24D__GUID-70943774-9713-4087-9B22-53D0508CC0A8">
                        <p class="notep1">注意：</p>
                        <p>如果在<code class="codeph">WHERE</code>子句中未指定<code class="codeph">XID</code>情况下查询<code class="codeph">FLASHBACK_TRANSACTION_QUERY</code> ，则查询会扫描许多不相关的行，从而降低性能。
                        </p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-212A4073-ABE2-4053-A852-3A41DEF6A24D__GUID-A4F63316-8FD0-4C60-ACB2-2DB6F07D8B10">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=BRADV81517" target="_blank"><span class="italic">Oracle数据库备份和恢复用户指南。</span></a>有关数据库管理员如何使用闪回表来还原整个表而不是单个行的信息</p>
                           </li>
                           <li>
                              <p>有关数据库管理员如何使用闪回表来还原整个表而不是单个行的信息，请参见<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ADMIN01512" target="_blank"><span class="italic">“Oracle数据库管理员指南”</span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="ADFNS1006"></a><div class="props_rev_3"><a id="GUID-115952E6-DB02-48D5-A2D3-B5C04AB68063" name="GUID-115952E6-DB02-48D5-A2D3-B5C04AB68063"></a><h3 id="ADFNS-GUID-115952E6-DB02-48D5-A2D3-B5C04AB68063" class="sect3">将Oracle闪回事务查询与Oracle闪回版本查询一起使用</h3>
               <div>
                  <div class="section">
                     <p>在此示例中，数据库管理员执行此操作：</p><pre class="oac_no_warn" dir="ltr">DROP TABLE emp; CREATE TABLE emp（empno NUMBER PRIMARY KEY，empname VARCHAR2（16），薪水NUMBER）; INSERT INTO emp（empno，empname，salary）VALUES（111，'Mike'，555）;承诺; DROP TABLE dept; CREATE TABLE dept（deptno NUMBER，deptname VARCHAR2（32））; INSERT INTO dept（deptno，deptname）VALUES（10，'Accounting'）;承诺;</pre><p>现在<code class="codeph">emp</code>和<code class="codeph">dept</code>各有一行。就行版本而言，每个表都有一行的一个版本。假设一个错误的事务从表<code class="codeph">emp</code>删除了<code class="codeph">empno</code> <code class="codeph">111</code> ：</p><pre class="oac_no_warn" dir="ltr">UPDATE emp SET salary = salary + 100 WHERE empno = 111; INSERT INTO dept（deptno，deptname）VALUES（20，'Finance'）; DELETE FROM emp WHERE empno = 111;承诺;</pre><p>接下来，事务将<code class="codeph">empno</code> <code class="codeph">111</code>重新插入到具有新员工姓名的<code class="codeph">emp</code>表中：</p><pre class="oac_no_warn" dir="ltr">INSERT INTO emp（empno，empname，salary）VALUES（111，'Tom'，777）; UPDATE emp SET salary = salary + 100 WHERE empno = 111; UPDATE emp SET salary = salary + 50 WHERE empno = 111;承诺;</pre><p>数据库管理员检测到应用程序错误，并且必须诊断问题。数据库管理员发出此查询以检索<code class="codeph">emp</code>表中与empno <code class="codeph">111</code>对应的行的版本。该查询使用Oracle闪回版本查询伪列：</p><pre class="oac_no_warn" dir="ltr">SELECT versions_xid XID，versions_startscn START_SCN，versions_endscn END_SCN，versions_operation OPERATION，empname，salary FROM emp VERSIONS BETWEEN SCN MINVALUE AND MAXVALUE WHERE empno = 111;</pre><p>结果类似于：</p><pre class="oac_no_warn" dir="ltr">XID START_SCN END_SCN O EMPNAME SALARY ---------------- ---------- ----------  -  ------- ---------- ---------- 09001100B2200000 10093466 I Tom 927 030002002B210000 10093459 D Mike 555 0800120096200000 10093375 10093459 I Mike 555 3行被选中。
</pre><p>结果表行按时间顺序递减。第三行对应于表<code class="codeph">emp</code>中创建表时插入表中的行的版本。第二行对应于删除错误事务的<code class="codeph">emp</code>中的行。第一行对应于<code class="codeph">emp</code>中使用新员工名称重新插入的行的版本。
                     </p>
                     <p>数据库管理员将事务<code class="codeph">030002002B210000</code>识别为错误事务，并使用Oracle闪回事务查询来审计此事务所做的所有更改：</p><pre class="oac_no_warn" dir="ltr">SELECT xid，start_scn，commit_scn，operation，logon_user，undo_sql FROM flashback_transaction_query WHERE xid = HEXTORAW（' <span class="bold">000200030000002D</span> '）;</pre><p>结果类似于：</p><pre class="oac_no_warn" dir="ltr">XID START_SCN COMMIT_SCN操作LOGON_USER ---------------- ---------- ---------- --------- ------------------------------ UNDO_SQL ------------------- -------------------------------------------------- ----------- 030002002B210000 10093452 10093459删除HR插入“HR”。“EMP”（“EMPNO”，“EMPNAME”，“SALARY”）值（'111'，'Mike'，'655 “）; 030002002B210000 10093452 10093459 INSERT HR从“HR”删除。“DEPT”其中ROWID ='AAATjuAAEAAAAJrAAB'; 030002002B210000 10093452 10093459 UPDATE HR更新“HR”。“EMP”设置“SALARY”='555'，其中ROWID ='AAATjsAAEAAAAJ7AAA'; 030002002B210000 10093452 10093459 BEGIN HR选择4行。
</pre><p>为了使下一个查询的结果更易于阅读，数据库管理员使用以下SQL * Plus命令：</p><pre class="oac_no_warn" dir="ltr">COLUMN操作FORMAT A9 COLUMN table_name FORMAT A10 COLUMN table_owner FORMAT A11</pre><p>要查看错误事务和所有后续事务的详细信息，数据库管理员将执行以下查询：</p><pre class="oac_no_warn" dir="ltr">SELECT xid，start_scn，commit_scn，operation，table_name，table_owner FROM flashback_transaction_query WHERE table_owner ='HR'AND start_timestamp&gt; = TO_TIMESTAMP（'2002-04-16 11:00:00'，'YYYY-MM-DD HH：MI：SS “）;</pre><p>结果类似于：</p><pre class="oac_no_warn" dir="ltr">XID START_SCN COMMIT_SCN操作TABLE_NAME TABLE_OWNER ---------------- ---------- ---------- -------- -  ---------- ----------- 02000E0074200000 10093435 10093446 INSERT DEPT HR 030002002B210000 10093452 10093459 DELETE EMP HR 030002002B210000 10093452 10093459 INSERT DEPT HR 030002002B210000 10093452 10093459 UPDATE EMP HR 0800120096200000 10093374 10093375 INSERT EMP HR 09001100B2200000 10093462 10093466 UPDATE EMP HR 09001100B2200000 10093462 10093466 UPDATE EMP HR 09001100B2200000 10093462 10093466 INSERT EMP HR 8行已选择。
</pre><div class="infoboxnote" id="GUID-115952E6-DB02-48D5-A2D3-B5C04AB68063__GUID-A85FE82C-1F7E-4349-AACE-6A9A377A9F41">
                        <p class="notep1">注意：</p>
                        <p>由于前面的查询未在<code class="codeph">WHERE</code>子句中指定<code class="codeph">XID</code> ，因此它会扫描许多不相关的行，从而降低性能。
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="ADFNS01009"></a><div class="props_rev_3"><a id="GUID-AE6515D5-F5F5-46BF-85D8-EB9349737691" name="GUID-AE6515D5-F5F5-46BF-85D8-EB9349737691"></a><h3 id="ADFNS-GUID-AE6515D5-F5F5-46BF-85D8-EB9349737691" class="sect3">使用DBMS_FLASHBACK包</h3>
               <div>
                  <div class="section">
                     <p><code class="codeph">DBMS_FLASHBACK</code>包提供与Oracle闪回查询相同的功能，但Oracle闪回查询有时更方便。
                     </p>
                     <p><code class="codeph">DBMS_FLASHBACK</code>包充当时间机器：您可以转回时钟，执行正常查询，就像您在较早时间一样，然后返回到当前。因为您可以使用<code class="codeph">DBMS_FLASHBACK</code>包来执行对过去数据的查询而不需要<code class="codeph">AS</code> <code class="codeph">OF</code>或<code class="codeph">VERSIONS</code> <code class="codeph">BETWEEN</code>类的特殊子句，所以您可以重用现有的PL / SQL代码来提前查询数据库。
                     </p>
                     <p>您必须具有<code class="codeph">DBMS_FLASHBACK</code>包的<code class="codeph">EXECUTE</code>特权。
                     </p>
                     <p>要在PL / SQL代码中使用<code class="codeph">DBMS_FLASHBACK</code>包：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>通过调用<code class="codeph">DBMS_FLASHBACK</code>指定过去时间。 <code class="codeph">ENABLE_AT_TIME</code>或<code class="codeph">DBMS_FLASHBACK</code> 。 <code class="codeph">ENABLE_AT_SYSTEM_CHANGE_NUMBER</code> 。</span></li>
                     <li class="stepexpand"><span>执行常规查询（即没有特殊闪回功能语法的查询，例如<code class="codeph">AS</code> <code class="codeph">OF</code> ）。不要执行DDL或DML操作。</span><div>
                           <p>在指定的过去时间查询数据库。</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>通过调用<code class="codeph">DBMS_FLASHBACK.DISABLE</code>返回到当前。</span><div>
                           <p>您必须调用<code class="codeph">DBMS_FLASHBACK</code> 。在调用<code class="codeph">DBMS_FLASHBACK</code>之前<code class="codeph">DISABLE</code> 。 <code class="codeph">ENABLE_AT_TIME</code>或<code class="codeph">DBMS_FLASHBACK</code> 。再次<code class="codeph">ENABLE_AT_SYSTEM_CHANGE_NUMBER</code> 。您无法嵌套启用/禁用对。
                           </p>
                        </div>
                     </li>
                  </ol>
                  <div class="section">
                     <p>要使用游标存储查询结果，请在调用<code class="codeph">DBMS_FLASHBACK</code>之前打开游标。 <code class="codeph">DISABLE</code> 。存储结果并调用<code class="codeph">DBMS_FLASHBACK</code> 。 <code class="codeph">DISABLE</code> ，你可以：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>执行<code class="codeph">INSERT</code>或<code class="codeph">UPDATE</code>操作以使用过去存储的结果修改当前数据库状态。
                           </p>
                        </li>
                        <li>
                           <p>将当前数据与过去的数据进行比较。在调用<code class="codeph">DBMS_FLASHBACK</code> 。 <code class="codeph">DISABLE</code> ，打开第二个光标。从第一个光标获取以检索过去的数据;从第二个光标获取以检索当前数据。您可以将过去的数据存储在临时表中，然后使用集合运算符（如<code class="codeph">MINUS</code>或<code class="codeph">UNION</code>来对比或组合过去和当前数据。
                           </p>
                        </li>
                     </ul>
                     <p>您可以调用<code class="codeph">DBMS_FLASHBACK</code> 。 <code class="codeph">GET_SYSTEM_CHANGE_NUMBER</code>随时可以获取当前的系统变更编号（SCN）。<code class="codeph">DBMS_FLASHBACK</code> 。无论先前的<code class="codeph">DBMS_FLASHBACK</code>调用如何， <code class="codeph">GET_SYSTEM_CHANGE_NUMBER</code>返回当前的SCN。 <code class="codeph">ENABLE</code> 。</p>
                     <div class="infoboxnotealso" id="GUID-AE6515D5-F5F5-46BF-85D8-EB9349737691__GUID-EDCCFEAF-536C-4139-B996-1BBDBB891FE4">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>有关<code class="codeph">DBMS_FLASHBACK</code>包的详细信息，请<code class="codeph">DBMS_FLASHBACK</code> <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ARPLS142" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考</span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="ADFNS1073"></a><a id="ADFNS1010"></a><div class="props_rev_3"><a id="GUID-43425A2F-5932-4310-B387-C08D5331A74F" name="GUID-43425A2F-5932-4310-B387-C08D5331A74F"></a><h3 id="ADFNS-GUID-43425A2F-5932-4310-B387-C08D5331A74F" class="sect3">使用闪回事务</h3>
               <div>
                  <div class="section">
                     <p><code class="codeph">DBMS_FLASHBACK</code> 。 <code class="codeph">TRANSACTION_BACKOUT</code>过程在数据库保持联机时回滚事务及其相关事务。此恢复操作使用撤消数据来创建和运行将受影响的数据恢复到其原始状态的<span class="bold">补偿事务</span> 。
                     </p>
                     <p>正在回滚的交易受以下限制：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>他们不能执行改变数据库表逻辑结构的DDL操作。</p>
                        </li>
                        <li>
                           <p>他们不能使用大对象（LOB）数据类型：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">BFILE</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">BLOB</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">CLOB</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">NCLOB</code></p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>他们无法使用LogMiner不支持的功能。</p>
                           <p>LogMiner支持的功能取决于回滚事务的数据库的<code class="codeph">COMPATIBLE</code>初始化参数的值。默认值是最新主要版本的版本号。
                           </p>
                           <p>闪回事务从LogMiner继承SQL数据类型支持。因此，如果LogMiner因事务中的SQL数据类型不受支持而失败，则Flashback Transaction也会失败。</p>
                           <p>虽然LogMiner支持某些数据类型，但不会生成撤消信息，作为修改此类类型列的操作的一部分。因此，闪回事务不支持包含这些数据类型的表。这些包括具有BLOB，CLOB和XML类型的表。</p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-43425A2F-5932-4310-B387-C08D5331A74F__GUID-A08AFCA6-0CAF-49E3-A9B6-946A8C5780D3">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>有关逻辑备用数据库上的数据类型和DDL支持的信息，请参阅<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=SBYDB00305" target="_blank"><span class="italic">Oracle Data Guard概念和管理</span></a></p>
                           </li>
                           <li>
                              <p>有关LOB数据类型的信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=SQLRF50994" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                           </li>
                           <li>
                              <p>有关LogMiner的信息，请参见<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=SUTIL019" target="_blank"><span class="italic">Oracle数据库实用程序</span></a></p>
                           </li>
                           <li>
                              <p>有关<code class="codeph">COMPATIBLE</code>初始化参数的信息，请<code class="codeph">COMPATIBLE</code> <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ADMIN11112" target="_blank"><span class="italic">“Oracle数据库管理员指南”</span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-43425A2F-5932-4310-B387-C08D5331A74F__GUID-16F4E208-C19E-475E-998B-65D41E225B80">话题：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="flashback.html#GUID-94AF779C-E12E-4953-B25A-5370EFE3A279">依赖交易</a></p>
                        </li>
                        <li>
                           <p><a href="flashback.html#GUID-E7E19FDE-2F69-4F9E-95A7-69BE906DC648">TRANSACTION_BACKOUT参数</a></p>
                        </li>
                        <li>
                           <p><a href="flashback.html#GUID-B1449BF8-678C-4AB5-96EB-884AE428BD46">TRANSACTION_BACKOUT报告</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS1074"></a><div class="props_rev_3"><a id="GUID-94AF779C-E12E-4953-B25A-5370EFE3A279" name="GUID-94AF779C-E12E-4953-B25A-5370EFE3A279"></a><h4 id="ADFNS-GUID-94AF779C-E12E-4953-B25A-5370EFE3A279" class="sect4">依赖交易</h4>
                  <div>
                     <p>在闪回事务的上下文中，事务2可以通过以下任何方式依赖于事务1：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="bold">写后写依赖性</span></p>
                           <p>事务1更改表的一行，稍后事务2更改同一行。</p>
                        </li>
                        <li>
                           <p><span class="bold">主键依赖</span></p>
                           <p>表在列c上具有主键约束。在表的一行中，列c具有值v。事务1删除该行，稍后事务2将行插入同一表中，将值v分配给列c。</p>
                        </li>
                        <li>
                           <p><span class="bold">外键依赖</span></p>
                           <p>在表b中，列b1对表a的列a1具有外键约束。事务1更改a1中的值，稍后事务2更改b1中的值。</p>
                        </li>
                     </ul>
                  </div>
               </div><a id="ADFNS627"></a><a id="ADFNS626"></a><div class="props_rev_3"><a id="GUID-E7E19FDE-2F69-4F9E-95A7-69BE906DC648" name="GUID-E7E19FDE-2F69-4F9E-95A7-69BE906DC648"></a><h4 id="ADFNS-GUID-E7E19FDE-2F69-4F9E-95A7-69BE906DC648" class="sect4">TRANSACTION_BACKOUT参数</h4>
                  <div>
                     <div class="section">
                        <p><code class="codeph">TRANSACTION_BACKOUT</code>过程的参数是：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>要撤消的事务数</p>
                           </li>
                           <li>
                              <p>要撤消的事务列表，按名称或XID标识</p>
                           </li>
                           <li>
                              <p>时间提示，如果您按名称识别交易</p>
                              <p>指定早于任何已启动事务的时间。</p>
                           </li>
                           <li>
                              <p><a href="flashback.html#GUID-E7E19FDE-2F69-4F9E-95A7-69BE906DC648__G4913725" title="此表总结了Flashback TRANSACTION_BACKOUT选项。">表19-2中的</a>退出选项</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="tblformal" id="GUID-E7E19FDE-2F69-4F9E-95A7-69BE906DC648__G4913725">
                        <p class="titleintable">表19-2闪回TRANSACTION_BACKOUT选项</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="闪回TRANSACTION_BACKOUT选项" width="100%" border="1" summary="This table summarizes the Flashback TRANSACTION_BACKOUT options." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="26%" id="d111972e3761">选项</th>
                                 <th align="left" valign="bottom" width="74%" id="d111972e3764">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d111972e3769" headers="d111972e3761 ">
                                    <p><code class="codeph">级联</code></p>
                                 </td>
                                 <td align="left" valign="top" width="74%" headers="d111972e3769 d111972e3764 ">
                                    <p>以后序方式退回指定的事务和所有相关事务（即，在父项退出之前退出子项）。</p>
                                    <p>如果没有<code class="codeph">CASCADE</code> ，如果未指定任何相关事务，则会发生错误。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d111972e3782" headers="d111972e3761 ">
                                    <p><code class="codeph">NOCASCADE</code></p>
                                 </td>
                                 <td align="left" valign="top" width="74%" headers="d111972e3782 d111972e3764 ">
                                    <p>默认。退出指定的事务，这些事务预计没有依赖事务。第一个从属事务导致错误并出现在<code class="codeph">*_FLASHBACK_TXN_REPORT</code> 。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d111972e3793" headers="d111972e3761 ">
                                    <p><code class="codeph">NOCASCADE_FORCE</code></p>
                                 </td>
                                 <td align="left" valign="top" width="74%" headers="d111972e3793 d111972e3764 ">
                                    <p>退出指定的事务，忽略从属事务。服务器以提交时间的相反顺序运行指定事务的撤消SQL语句。</p>
                                    <p>如果没有约束中断并且您对结果感到满意，则可以提交更改;否则，你可以回滚它们。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="26%" id="d111972e3803" headers="d111972e3761 ">
                                    <p><code class="codeph">NONCONFLICT_ONLY</code></p>
                                 </td>
                                 <td align="left" valign="top" width="74%" headers="d111972e3803 d111972e3764 ">
                                    <p>回退对指定事务的非冲突行的更改。数据库保持一致，但事务原子性丢失。</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="section">
                        <p><code class="codeph">TRANSACTION_BACKOUT</code>分析事务依赖关系，执行DML操作并生成报告。<code class="codeph">TRANSACTION_BACKOUT</code>不提交它作为事务回退的一部分执行的DML操作，但它以正确的形式保存行和表上的所有必需锁，防止其他依赖项进入系统。要使事务撤销永久，您必须显式提交事务。
                        </p>
                        <div class="infoboxnotealso" id="GUID-E7E19FDE-2F69-4F9E-95A7-69BE906DC648__FORTHESYNTAXOFTHETRANSACTION_BACKOU-CAF3EA82">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ARPLS66407" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考</span></a>了解<code class="codeph">TRANSACTION_BACKOUT</code>过程的语法和详细参数说明</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS628"></a><div class="props_rev_3"><a id="GUID-B1449BF8-678C-4AB5-96EB-884AE428BD46" name="GUID-B1449BF8-678C-4AB5-96EB-884AE428BD46"></a><h4 id="ADFNS-GUID-B1449BF8-678C-4AB5-96EB-884AE428BD46" class="sect4">TRANSACTION_BACKOUT报告</h4>
                  <div>
                     <div class="section">
                        <p>要查看<code class="codeph">TRANSACTION_BACKOUT</code>生成的报告，请查询静态数据字典视图<code class="codeph">*_FLASHBACK_TXN_STATE</code>和<code class="codeph">*_FLASHBACK_TXN_REPORT</code> 。</p>
                     </div>
                     <!-- class="section" -->
                  </div><a id="ADFNS629"></a><div class="props_rev_3"><a id="GUID-86D7C7BA-0542-45B6-9D43-3BD13C975113" name="GUID-86D7C7BA-0542-45B6-9D43-3BD13C975113"></a><h5 id="ADFNS-GUID-86D7C7BA-0542-45B6-9D43-3BD13C975113" class="sect5">* _FLASHBACK_TXN_STATE</h5>
                     <div>
                        <div class="section">
                           <p>静态数据字典视图<code class="codeph">*_FLASHBACK_TXN_STATE</code>显示事务是处于活动状态还是已退出。如果此视图中显示某个事务，则会将其撤消。
                           </p>
                           <p><code class="codeph">*_FLASHBACK_TXN_STATE</code>以原子方式维护以补偿交易。如果<code class="codeph">*_FLASHBACK_TXN_STATE</code>补偿事务，则还会<code class="codeph">*_FLASHBACK_TXN_STATE</code>所做的所有更改，并且<code class="codeph">*_FLASHBACK_TXN_STATE</code>反映此情况。例如，如果补偿交易<code class="codeph">ct</code>支持交易<code class="codeph">t1</code>和<code class="codeph">t2</code> ，则<code class="codeph">t1</code>和<code class="codeph">t2</code>出现在<code class="codeph">*_FLASHBACK_TXN_STATE</code> 。如果稍后退出<code class="codeph">ct</code>本身，则恢复<code class="codeph">t1</code>和<code class="codeph">t2</code>的效果，并且<code class="codeph">t1</code>和<code class="codeph">t2</code>从<code class="codeph">*_FLASHBACK_TXN_STATE</code>消失。</p>
                           <div class="infoboxnotealso" id="GUID-86D7C7BA-0542-45B6-9D43-3BD13C975113__GUID-09C7540E-7068-46E7-9AB5-27851262264A">
                              <p class="notep1">也可以看看：</p>
                              <p>有关<code class="codeph">*_FLASHBACK_TXN_STATE</code>更多信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=REFRN23588" target="_blank"><span class="italic">参见Oracle数据库参考</span></a></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="ADFNS630"></a><div class="props_rev_3"><a id="GUID-789658E2-21E6-4301-97CF-FC722F3445D5" name="GUID-789658E2-21E6-4301-97CF-FC722F3445D5"></a><h5 id="ADFNS-GUID-789658E2-21E6-4301-97CF-FC722F3445D5" class="sect5">* _FLASHBACK_TXN_REPORT</h5>
                     <div>
                        <div class="section">
                           <p>静态数据字典视图<code class="codeph">*_FLASHBACK_TXN_REPORT</code>为每个退出的事务提供详细的报告。
                           </p>
                           <div class="infoboxnotealso" id="GUID-789658E2-21E6-4301-97CF-FC722F3445D5__GUID-F4399864-CFBB-4391-8166-BA1FFCD4399A">
                              <p class="notep1">也可以看看：</p>
                              <p>有关<code class="codeph">*_FLASHBACK_TXN_REPORT</code>更多信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=REFRN23587" target="_blank"><span class="italic">参见Oracle数据库参考</span></a></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div><a id="ADFNS1075"></a><a id="ADFNS01011"></a><div class="props_rev_3"><a id="GUID-06AA782A-3F79-4235-86D5-2D136485F093" name="GUID-06AA782A-3F79-4235-86D5-2D136485F093"></a><h3 id="ADFNS-GUID-06AA782A-3F79-4235-86D5-2D136485F093" class="sect3">使用闪回数据存档</h3>
               <div>
                  <div class="section">
                     <p>闪回数据存档提供了在表的生命周期内跟踪和存储表的事务更改的功能。闪回数据存档对于遵守记录阶段策略和审计报告非常有用。</p>
                     <p>闪回数据存档由一个或多个表空间或其部分组成。您可以拥有多个闪回数据存档。如果以<code class="codeph">SYSDBA</code>身份登录，则可以为系统指定默认的闪回数据存档。闪回数据存档配置了保留时间。在闪回数据存档中存档的数据将保留创建闪回数据存档时指定的保留时间。
                     </p>
                     <p>默认情况下，不为任何表启用闪回数据存档。如果满足所有这些条件，则可以为表启用闪回数据存档：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>您具有闪回数据存档的<code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code>对象权限，可用于该表。
                           </p>
                        </li>
                        <li>
                           <p>该表不是嵌套的，临时的，远程的或外部的。</p>
                        </li>
                        <li>
                           <p>该表既不包含<code class="codeph">LONG</code>也不包含嵌套列。
                           </p>
                        </li>
                        <li>
                           <p>该表不使用任何这些闪回数据存档保留字作为列名：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">STARTSCN</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">ENDSCN</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">RID</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">XID</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">OP</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">操作</code></p>
                              </li>
                           </ul>
                        </li>
                     </ul>
                     <p>您无法在嵌套表，临时表，外部表，物化视图，高级查询（AQ）表或非表对象上启用闪回数据存档。</p>
                     <p>为表启用闪回数据存档后，只有具有<code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code> <code class="codeph">ADMINISTER</code>系统特权或以<code class="codeph">SYSDBA</code>身份登录时才能禁用它。</p>
                     <p>为特定表选择闪回数据存档时，请考虑表的数据保留要求以及具有<code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code>对象权限的闪回数据存档的保留时间。
                     </p>
                     <p>从Oracle Database 12 <span class="italic">c</span>第1版（12.1.0.1）开始，闪回数据存档已得到增强，包括以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="bold">用户上下文跟踪</span> 。用于跟踪事务的元数据信息可以包括（如果该特征被启用）用户上下文，这使得更容易确定哪个用户对表进行了哪些更改。
                           </p>
                           <p>要设置用户上下文级别（确定要保存多少用户上下文），请使用<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ARPLS74566" target="_blank"><code class="codeph">DBMS_FLASHBACK_ARCHIVE.SET_CONTEXT_LEVEL</code></a>过程。要访问上下文信息，请使用<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ARPLS74555" target="_blank"><code class="codeph">DBMS_FLASHBACK_ARCHIVE.GET_SYS_CONTEXT</code></a>函数。
                           </p>
                        </li>
                        <li>
                           <p><span class="bold">数据库强化</span> 。此功能使您可以在“应用程序”中将一组表关联在一起，然后使用单个命令在所有这些表上启用闪回数据存档。此外，数据库强化使您可以使用单个命令锁定所有表，从而防止这些表上的任何DML，直到它们随后被解锁。数据库强化旨在使闪回数据存档更容易使用，以跟踪和保护应用程序的安全敏感表。
                           </p>
                           <p>要注册数据库强化的应用程序，请使用<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ARPLS74562" target="_blank"><code class="codeph">DBMS_FLASHBACK_ARCHIVE.REGISTER_APPLICATION</code></a>过程，该过程在<span class="italic">Oracle Database PL / SQL包和类型参考中进行了描述</span> 。
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-06AA782A-3F79-4235-86D5-2D136485F093__GUID-FD8940DD-95FA-407F-AF49-EC8E4A5566B7">话题：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="flashback.html#GUID-28F62D88-B5DF-4A09-9D72-6605F9A56308">创建闪回数据存档</a></p>
                        </li>
                        <li>
                           <p><a href="flashback.html#GUID-FC792CEF-8F8C-4FC4-91A4-ED5CD4321037">改变闪回数据档案</a></p>
                        </li>
                        <li>
                           <p><a href="flashback.html#GUID-5E8447E3-3122-47C8-A791-125D784C51FC">删除闪回数据存档</a></p>
                        </li>
                        <li>
                           <p><a href="flashback.html#GUID-51570960-CB42-4A13-BE80-00EB84E765B0">指定默认闪回数据存档</a></p>
                        </li>
                        <li>
                           <p><a href="flashback.html#GUID-8CF548A0-FA45-45B2-87CE-9F6F17ED1A41">启用和禁用闪回数据存档</a></p>
                        </li>
                        <li>
                           <p><a href="flashback.html#GUID-D01864A9-C642-4EDF-9EB0-796020A26F2D">表格上的DDL语句为闪回数据存档启用</a></p>
                        </li>
                        <li>
                           <p><a href="flashback.html#GUID-CDD50508-CCFA-4A15-8512-63DB2AA1984F">查看闪回数据存档数据</a></p>
                        </li>
                        <li>
                           <p><a href="flashback.html#GUID-3386EBA7-91D8-432A-B92F-F1546700FE08">闪回数据存档方案</a></p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-06AA782A-3F79-4235-86D5-2D136485F093__NOTE-1342-CAF66260">
                        <p class="notep1">也可以看看：</p>
                        <p>有关<code class="codeph">DBMS_FLASHBACK_ARCHIVE</code>包的更多信息，请<code class="codeph">DBMS_FLASHBACK_ARCHIVE</code> <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ARPLS72463" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考</span></a></p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div><a id="ADFNS632"></a><a id="ADFNS631"></a><div class="props_rev_3"><a id="GUID-28F62D88-B5DF-4A09-9D72-6605F9A56308" name="GUID-28F62D88-B5DF-4A09-9D72-6605F9A56308"></a><h4 id="ADFNS-GUID-28F62D88-B5DF-4A09-9D72-6605F9A56308" class="sect4">创建闪回数据存档</h4>
                  <div>
                     <div class="section">
                        <p>使用<code class="codeph">CREATE</code> <code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code>语句创建闪回数据存档，指定：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>闪回数据存档的名称</p>
                           </li>
                           <li>
                              <p>闪回数据存档的第一个表空间的名称</p>
                           </li>
                           <li>
                              <p>（可选）闪回数据存档可在第一个表空间中使用的最大空间量</p>
                              <p>默认值是无限制的。除非第一个表空间的空间配额也是无限制的，否则必须指定此值;否则，出现错误ORA-55621。</p>
                           </li>
                           <li>
                              <p>保留时间（保证存储表的闪回数据存档数据的天数）</p>
                           </li>
                           <li>
                              <p>（可选）是否使用<code class="codeph">[NO]</code> <code class="codeph">OPTIMIZE</code> <code class="codeph">DATA</code> <code class="codeph">OPTIMIZE</code>闪回数据存档中维护的历史表中的<code class="codeph">DATA</code> 。</p>
                              <p>默认值为<code class="codeph">NO</code> <code class="codeph">OPTIMIZE</code> <code class="codeph">DATA</code> 。</p>
                           </li>
                        </ul>
                        <p>如果以<code class="codeph">SYSDBA</code>身份登录，则还可以指定这是系统的默认闪回数据存档。如果省略此选项，您仍可以在以后将此闪回数据存档设为默认值。
                        </p>
                        <p>Oracle建议所有必须使用闪回数据存档的用户在闪回数据存档表空间上具有无限制的配额;但是，如果不是这种情况，则必须在该表空间上为这些用户授予足够的配额。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-28F62D88-B5DF-4A09-9D72-6605F9A56308__GUID-4773BC71-C8BC-4CFB-B0F1-077FB00B6C66">例子</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>创建一个名为<code class="codeph">fla1</code>的默认闪回数据存档，它使用最多10 G的表空间<code class="codeph">tbs1</code> ，其数据保留一年：</p><pre class="oac_no_warn" dir="ltr">创建FLASHBACK ARCHIVE DEFAULT fla1 TABLESPACE tbs1 QUOTA 10G保留1年;</pre></li>
                           <li>
                              <p>创建一个名为<code class="codeph">fla2</code>的闪回数据存档，它使用表空间<code class="codeph">tbs2</code> ，其数据保留两年：</p><pre class="oac_no_warn" dir="ltr">创建FLASHBACK ARCHIVE fla2 TABLESPACE tbs2保留2年;</pre></li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-28F62D88-B5DF-4A09-9D72-6605F9A56308__NOTE-1243-CAF81924">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关<code class="codeph">CREATE</code> <code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code>语句的更多信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=SQLRF20008" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                              </li>
                              <li>
                                 <p><a href="flashback.html#GUID-51570960-CB42-4A13-BE80-00EB84E765B0">指定默认闪回数据存档</a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS634"></a><a id="ADFNS633"></a><div class="props_rev_3"><a id="GUID-FC792CEF-8F8C-4FC4-91A4-ED5CD4321037" name="GUID-FC792CEF-8F8C-4FC4-91A4-ED5CD4321037"></a><h4 id="ADFNS-GUID-FC792CEF-8F8C-4FC4-91A4-ED5CD4321037" class="sect4">改变闪回数据档案</h4>
                  <div>
                     <div class="section">
                        <p>使用<code class="codeph">ALTER</code> <code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code>语句，您可以：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>更改闪回数据存档的保留时间</p>
                           </li>
                           <li>
                              <p>清除部分或全部数据</p>
                           </li>
                           <li>
                              <p>添加，修改和删除表空间</p>
                              <div class="infoboxnote" id="GUID-FC792CEF-8F8C-4FC4-91A4-ED5CD4321037__GUID-38D3C1BE-8AB8-4FA4-8E72-AFB53201CE20">
                                 <p class="notep1">注意：</p>
                                 <p>删除闪回数据存档的所有表空间会导致错误。</p>
                              </div>
                           </li>
                        </ul>
                        <p>如果以<code class="codeph">SYSDBA</code>身份登录，还可以使用<code class="codeph">ALTER</code> <code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code>语句将特定文件作为系统的默认闪回数据存档。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-FC792CEF-8F8C-4FC4-91A4-ED5CD4321037__GUID-25121B22-97F7-4AA9-B7E3-882F0DD13112">例子</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>使闪回数据存档<code class="codeph">fla1</code>成为默认的闪回数据存档：</p><pre class="oac_no_warn" dir="ltr">ALTER FLASHBACK ARCHIVE fla1 SET DEFAULT;</pre></li>
                           <li>
                              <p>要闪回数据存档<code class="codeph">fla1</code> ，最多可添加5 G表空间<code class="codeph">tbs3</code> ：</p><pre class="oac_no_warn" dir="ltr">ALTER FLASHBACK ARCHIVE fla1添加TABLESPACE tbs3 QUOTA 5G;</pre></li>
                           <li>
                              <p>要闪回数据存档<code class="codeph">fla1</code> ，根据需要添加尽可能多的表空间<code class="codeph">tbs4</code> ：</p><pre class="oac_no_warn" dir="ltr">ALTER FLASHBACK ARCHIVE fla1 ADD TABLESPACE tbs4;</pre></li>
                           <li>
                              <p>将闪回数据存档<code class="codeph">fla1</code>在表空间<code class="codeph">tbs3</code>可以使用的最大空间更改为20 G：</p><pre class="oac_no_warn" dir="ltr">ALTER FLASHBACK ARCHIVE fla1 MODIFY TABLESPACE tbs3 QUOTA 20G;</pre></li>
                           <li>
                              <p>允许闪回数据存档<code class="codeph">fla1</code>根据需要使用尽可能多的表空间<code class="codeph">tbs1</code> ：</p><pre class="oac_no_warn" dir="ltr">ALTER FLASHBACK ARCHIVE fla1 MODIFY TABLESPACE tbs1;</pre></li>
                           <li>
                              <p>将闪回数据存档<code class="codeph">fla1</code>的保留时间更改为两年：</p><pre class="oac_no_warn" dir="ltr">ALTER FLASHBACK ARCHIVE fla1 MODIFY RETENTION 2年;</pre></li>
                           <li>
                              <p>从闪回数据存档<code class="codeph">fla1</code>删除表空间<code class="codeph">tbs2</code> ：</p><pre class="oac_no_warn" dir="ltr">ALTER FLASHBACK ARCHIVE fla1删除TABLESPACE tbs2;</pre><p>（表空间<code class="codeph">tbs2</code>不会被删除。）
                              </p>
                           </li>
                           <li>
                              <p>清除闪回数据存档<code class="codeph">fla1</code>所有历史数据：</p><pre class="oac_no_warn" dir="ltr">ALTER FLASHBACK ARCHIVE fla1 PURGE ALL;</pre></li>
                           <li>
                              <p>清除闪回数据存档<code class="codeph">fla1</code>超过一天的所有历史数据：</p><pre class="oac_no_warn" dir="ltr">在TIMESTAMP之前清洗FLASHBACK ARCHIVE fla1（SYSTIMESTAMP  -  INTERVAL'1'天）;</pre></li>
                           <li>
                              <p>从闪回数据存档<code class="codeph">fla1</code>清除所有早于SCN 728969的历史数据：</p><pre class="oac_no_warn" dir="ltr">ALTER FLASHBACK ARCHIVE fla1在SCN 728969之前清除;</pre></li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-FC792CEF-8F8C-4FC4-91A4-ED5CD4321037__FORMOREINFORMATIONABOUTTHEALTERFLAS-CAF873C3">
                           <p class="notep1">也可以看看：</p>
                           <p>有关<code class="codeph">ALTER</code> <code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code>语句的更多信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=SQLRF20009" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS636"></a><a id="ADFNS635"></a><div class="props_rev_3"><a id="GUID-5E8447E3-3122-47C8-A791-125D784C51FC" name="GUID-5E8447E3-3122-47C8-A791-125D784C51FC"></a><h4 id="ADFNS-GUID-5E8447E3-3122-47C8-A791-125D784C51FC" class="sect4">删除闪回数据存档</h4>
                  <div>
                     <div class="section">
                        <p>使用<code class="codeph">DROP</code> <code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code>语句删除闪回数据存档。删除闪回数据存档会删除其历史数据，但不会删除其表空间。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-5E8447E3-3122-47C8-A791-125D784C51FC__GUID-0635D20D-C12E-4FA7-9EE6-F2BA23CD3014">例</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>删除闪回数据存档<code class="codeph">fla1</code>及其所有历史数据，但不删除其表空间：</p><pre class="oac_no_warn" dir="ltr">DROP FLASHBACK ARCHIVE fla1;</pre><p>有关<code class="codeph">DROP</code> <code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code>语句的详细信息，请<a href="../sqlrf/DROP-FLASHBACK-ARCHIVE.html#SQLRF20010" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS637"></a><div class="props_rev_3"><a id="GUID-51570960-CB42-4A13-BE80-00EB84E765B0" name="GUID-51570960-CB42-4A13-BE80-00EB84E765B0"></a><h4 id="ADFNS-GUID-51570960-CB42-4A13-BE80-00EB84E765B0" class="sect4">指定默认闪回数据存档</h4>
                  <div>
                     <div class="section">
                        <p>默认情况下，系统没有默认的闪回数据存档。如果以<code class="codeph">SYSDBA</code>身份登录，则可以通过以下任一方式指定默认闪回数据存档：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>在<code class="codeph">ALTER</code> <code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code>语句的<code class="codeph">SET</code> <code class="codeph">DEFAULT</code>子句中指定现有闪回数据存档的名称。例如：</p><pre class="oac_no_warn" dir="ltr">ALTER FLASHBACK ARCHIVE fla1 SET DEFAULT;</pre><p>如果<code class="codeph">fla1</code>不存在，则会发生错误。
                              </p>
                           </li>
                           <li>
                              <p>创建闪回数据存档时，在<code class="codeph">CREATE</code> <code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code>语句中包含<code class="codeph">DEFAULT</code> 。例如：</p><pre class="oac_no_warn" dir="ltr">创建FLASHBACK ARCHIVE DEFAULT fla2 TABLESPACE tbs1 QUOTA 10G保留1年;</pre></li>
                        </ul>
                        <p>对于没有自己的默认闪回数据存档的每个用户，系统的默认闪回数据存档是默认的闪回数据存档。</p>
                        <div class="infoboxnotealso" id="GUID-51570960-CB42-4A13-BE80-00EB84E765B0__GUID-3AD582E6-8D71-474C-9FD9-4E9380847AEF">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关<code class="codeph">CREATE</code> <code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code>语句的更多信息，请<a href="../sqlrf/CREATE-FLASHBACK-ARCHIVE.html#SQLRF20008" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                              </li>
                              <li>
                                 <p>有关<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code>语句的更多信息，请<a href="../sqlrf/ALTER-DATABASE.html#SQLRF00802" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS639"></a><a id="ADFNS638"></a><div class="props_rev_3"><a id="GUID-8CF548A0-FA45-45B2-87CE-9F6F17ED1A41" name="GUID-8CF548A0-FA45-45B2-87CE-9F6F17ED1A41"></a><h4 id="ADFNS-GUID-8CF548A0-FA45-45B2-87CE-9F6F17ED1A41" class="sect4">启用和禁用闪回数据存档</h4>
                  <div>
                     <div class="section">
                        <p>默认情况下，对任何表禁用闪回数据存档。如果您具有要用于该表的闪回数据存档的<code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code>对象权限，则可以为表启用闪回数据存档。
                        </p>
                        <p>要为表启用闪回数据存档，请在<code class="codeph">CREATE</code> <code class="codeph">TABLE</code>或<code class="codeph">ALTER</code> <code class="codeph">TABLE</code>语句中包含<code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code>子句。在<code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code>子句中，您可以指定存储表的历史数据的闪回数据存档。默认值是系统的默认闪回数据存档。如果指定不存在的闪回数据存档，则会发生错误。
                        </p>
                        <p>如果为表启用闪回数据存档，但禁用了AUM，则在尝试修改表时会出现错误ORA-55614。</p>
                        <p>如果某个表启用了闪回数据存档，并且您尝试使用其他闪回数据存档再次启用它，则会发生错误。</p>
                        <p>为表启用闪回数据存档后，只有具有<code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code> <code class="codeph">ADMINISTER</code>系统特权或以<code class="codeph">SYSDBA</code>身份登录时才能禁用它。要为表禁用闪回数据存档，请在<code class="codeph">ALTER</code> <code class="codeph">TABLE</code>语句中指定<code class="codeph">NO</code> <code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code> 。（没有必要在<code class="codeph">CREATE</code> <code class="codeph">TABLE</code>语句中指定<code class="codeph">NO</code> <code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code> ，因为这是默认值。）
                        </p>
                        <p>在表上启用闪回数据存档后，Oracle建议在将数据插入表之前等待至少20秒，并等待最多5分钟后再使用表上的闪回查询。</p>
                        <div class="infoboxnotealso" id="GUID-8CF548A0-FA45-45B2-87CE-9F6F17ED1A41__GUID-358FA1FA-3A42-48CE-B66B-31F757CDCD10">
                           <p class="notep1">也可以看看：</p>
                           <p>有关<code class="codeph">CREATE</code> <code class="codeph">TABLE</code>语句的<code class="codeph">FLASHBACK</code> <code class="codeph">ARCHIVE</code>子句的更多信息，请参阅<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=SQLRF30014" target="_blank"><span class="italic">Oracle数据库SQL语言参考</span></a> ，包括对其使用的限制</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-8CF548A0-FA45-45B2-87CE-9F6F17ED1A41__GUID-56D00A7D-1967-4633-9AD3-9BAE3B7D7514">例子</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>创建表<code class="codeph">employee</code>并将历史数据存储在默认的闪回数据存档中：</p><pre class="oac_no_warn" dir="ltr">CREATE TABLE employee（EMPNO NUMBER（4）NOT NULL，ENAME VARCHAR2（10），JOB VARCHAR2（9），MGR NUMBER（4））FLASHBACK ARCHIVE;</pre></li>
                           <li>
                              <p>创建表<code class="codeph">employee</code>并将历史数据存储在闪回数据存档<code class="codeph">fla1</code> ：</p><pre class="oac_no_warn" dir="ltr">CREATE TABLE employee（EMPNO NUMBER（4）NOT NULL，ENAME VARCHAR2（10），JOB VARCHAR2（9），MGR NUMBER（4））FLASHBACK ARCHIVE fla1;</pre></li>
                           <li>
                              <p>为表<code class="codeph">employee</code>启用闪回数据存档，并将历史数据存储在默认的闪回数据存档中：</p><pre class="oac_no_warn" dir="ltr">ALTER TABLE员工FLASHBACK ARCHIVE;</pre></li>
                           <li>
                              <p>为表<code class="codeph">employee</code>启用闪回数据存档并将历史数据存储在闪回数据存档<code class="codeph">fla1</code> ：</p><pre class="oac_no_warn" dir="ltr">ALTER TABLE员工FLASHBACK ARCHIVE fla1;</pre></li>
                           <li>
                              <p>禁用表<code class="codeph">employee</code>闪回数据存档：</p><pre class="oac_no_warn" dir="ltr">ALTER TABLE员工没有FLASHBACK ARCHIVE;</pre></li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS640"></a><div class="props_rev_3"><a id="GUID-D01864A9-C642-4EDF-9EB0-796020A26F2D" name="GUID-D01864A9-C642-4EDF-9EB0-796020A26F2D"></a><h4 id="ADFNS-GUID-D01864A9-C642-4EDF-9EB0-796020A26F2D" class="sect4">表格上的DDL语句为闪回数据存档启用</h4>
                  <div>
                     <p>闪回数据存档仅支持以下DDL语句：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>执行以下任何操作的<code class="codeph">ALTER</code> <code class="codeph">TABLE</code>语句：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>添加，删除，重命名或修改列</p>
                              </li>
                              <li>
                                 <p>添加，删除或重命名约束</p>
                              </li>
                              <li>
                                 <p>删除或截断分区或子分区操作</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p><code class="codeph">TRUNCATE</code> <code class="codeph">TABLE</code>语句</p>
                        </li>
                        <li>
                           <p>重命名表的<code class="codeph">RENAME</code>语句</p>
                        </li>
                     </ul>
                     <p>闪回数据存档不支持移动，拆分，合并或合并分区或子分区，移动表或将<code class="codeph">LONG</code>列转换为<code class="codeph">LOB</code>列的DDL语句。
                     </p>
                     <p>例如，以下DDL语句在为闪回数据存档启用的表上使用时会导致错误ORA-55610：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">ALTER</code> <code class="codeph">TABLE</code>语句，包含<code class="codeph">UPGRADE</code> <code class="codeph">TABLE</code>子句，包含或不包含<code class="codeph">INCLUDING</code> <code class="codeph">DATA</code>子句</p>
                        </li>
                        <li>
                           <p>移动或交换分区或子分区操作的<code class="codeph">ALTER</code> <code class="codeph">TABLE</code>语句</p>
                        </li>
                        <li>
                           <p><code class="codeph">DROP</code> <code class="codeph">TABLE</code>语句</p>
                        </li>
                     </ul>
                     <p>如果必须在为闪回数据存档启用的表上使用不受支持的DDL语句，请使用<code class="codeph">DBMS_FLASHBACK_ARCHIVE</code> 。 <code class="codeph">DISASSOCIATE_FBA</code>过程将基表与其闪回数据存档解除关联。要在之后将闪回数据存档与基表重新关联，请使用<code class="codeph">DBMS_FLASHBACK_ARCHIVE</code> 。 <code class="codeph">REASSOCIATE_FBA</code>程序。另外，要删除为闪回数据存档启用的表，必须首先使用<code class="codeph">ALTER TABLE ...禁用表上的闪回数据存档<code class="codeph">ALTER TABLE ...NO FLASHBACK ARCHIVE</code>子句。
                     </p>
                     <div class="infoboxnotealso" id="GUID-D01864A9-C642-4EDF-9EB0-796020A26F2D__GUID-8E5FB68C-F9B0-40E1-876F-430760618AE3">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>有关<code class="codeph">ALTER</code> <code class="codeph">TABLE</code>语句的信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=SQLRF01001" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                           </li>
                           <li>
                              <p>有关<code class="codeph">TRUNCATE</code> <code class="codeph">TABLE</code>语句的信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=SQLRF01707" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                           </li>
                           <li>
                              <p>有关<code class="codeph">RENAME</code>语句的信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=SQLRF01608" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                           </li>
                           <li>
                              <p>有关<code class="codeph">DROP</code> <code class="codeph">TABLE</code>语句的信息，请<a href="../sqlrf/DROP-TABLE.html#SQLRF01806" target="_blank"><span class="italic">参见Oracle数据库SQL语言参考</span></a></p>
                           </li>
                           <li>
                              <p>有关<code class="codeph">DBMS_FLASHBACK_ARCHIVE</code>包的信息，请<code class="codeph">DBMS_FLASHBACK_ARCHIVE</code> <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=ARPLS72463" target="_blank"><span class="italic">Oracle Database PL / SQL包和类型参考</span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="ADFNS642"></a><a id="ADFNS641"></a><div class="props_rev_3"><a id="GUID-CDD50508-CCFA-4A15-8512-63DB2AA1984F" name="GUID-CDD50508-CCFA-4A15-8512-63DB2AA1984F"></a><h4 id="ADFNS-GUID-CDD50508-CCFA-4A15-8512-63DB2AA1984F" class="sect4">查看闪回数据存档数据</h4>
                  <div>
                     <div class="section">
                        <p><a href="flashback.html#GUID-CDD50508-CCFA-4A15-8512-63DB2AA1984F__BJFJFFJD" title="此表汇总了显示有关闪回数据存档的信息的静态数据字典视图。">表19-3</a>列出并简要描述了可以查询有关闪回数据存档文件的静态数据字典视图。
                        </p>
                        <div class="tblformal" id="GUID-CDD50508-CCFA-4A15-8512-63DB2AA1984F__BJFJFFJD">
                           <p class="titleintable">表19-3闪回数据存档文件的静态数据字典视图</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="闪回数据存档文件的静态数据字典视图" width="100%" border="1" summary="This table summarizes the static data dictionary views that display information about Flashback Data Archives." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="39%" id="d111972e5893">视图</th>
                                    <th align="left" valign="bottom" width="61%" id="d111972e5896">描述</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="39%" id="d111972e5901" headers="d111972e5893 ">
                                       <p><code class="codeph">* _FLASHBACK_ARCHIVE</code></p>
                                    </td>
                                    <td align="left" valign="top" width="61%" headers="d111972e5901 d111972e5896 ">
                                       <p>显示有关闪回数据存档文件的信息。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="39%" id="d111972e5909" headers="d111972e5893 ">
                                       <p><code class="codeph">* _FLASHBACK_ARCHIVE_TS</code></p>
                                    </td>
                                    <td align="left" valign="top" width="61%" headers="d111972e5909 d111972e5896 ">
                                       <p>显示闪回数据存档文件的表空间。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="39%" id="d111972e5917" headers="d111972e5893 ">
                                       <p><code class="codeph">* _FLASHBACK_ARCHIVE_TABLES</code></p>
                                    </td>
                                    <td align="left" valign="top" width="61%" headers="d111972e5917 d111972e5896 ">
                                       <p>显示有关为数据闪回存档文件启用的表的信息。</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <div class="infoboxnotealso" id="GUID-CDD50508-CCFA-4A15-8512-63DB2AA1984F__GUID-8F1FC4B2-CE16-471C-BDB4-3F8ACF434625">
                           <p class="notep1">也可以看看：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>有关<code class="codeph">*_FLASHBACK_ARCHIVE</code>详细信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=REFRN26719" target="_blank"><span class="italic">参见Oracle数据库参考</span></a></p>
                              </li>
                              <li>
                                 <p>有关<code class="codeph">*_FLASHBACK_ARCHIVE_TS</code>详细信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=REFRN23720" target="_blank"><span class="italic">参见Oracle数据库参考</span></a></p>
                              </li>
                              <li>
                                 <p>有关<code class="codeph">*_FLASHBACK_ARCHIVE_TABLES</code>详细信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=REFRN26715" target="_blank"><span class="italic">参见Oracle数据库参考</span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ADFNS643"></a><div class="props_rev_3"><a id="GUID-3386EBA7-91D8-432A-B92F-F1546700FE08" name="GUID-3386EBA7-91D8-432A-B92F-F1546700FE08"></a><h4 id="ADFNS-GUID-3386EBA7-91D8-432A-B92F-F1546700FE08" class="sect4">闪回数据存档方案</h4>
                  <div>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="flashback.html#GUID-4BB5C910-ADEC-4975-9D87-F8003EC9C687">场景：使用闪回数据存档实施数字碎化</a></p>
                        </li>
                        <li>
                           <p><a href="flashback.html#GUID-ED0F756B-99FA-4B2F-94B5-744687EDB0F3">场景：使用闪回数据存档访问历史数据</a></p>
                        </li>
                        <li>
                           <p><a href="flashback.html#GUID-74B7EA4F-CF41-4633-A24E-66F7B89C6443">场景：使用闪回数据存档生成报告</a></p>
                        </li>
                        <li>
                           <p><a href="flashback.html#GUID-AEB6257D-3277-4740-A576-08F275A75C42">场景：使用闪回数据存档进行审计</a></p>
                        </li>
                        <li>
                           <p><a href="flashback.html#GUID-E7372F07-2795-42CA-A1BC-8799CE8659AA">场景：使用闪回数据存档来恢复数据</a></p>
                        </li>
                     </ul>
                  </div><a id="ADFNS644"></a><div class="props_rev_3"><a id="GUID-4BB5C910-ADEC-4975-9D87-F8003EC9C687" name="GUID-4BB5C910-ADEC-4975-9D87-F8003EC9C687"></a><h5 id="ADFNS-GUID-4BB5C910-ADEC-4975-9D87-F8003EC9C687" class="sect5">场景：使用闪回数据存档实施数字碎化</h5>
                     <div>
                        <p>您的公司希望在十年后将历史数据更改“粉碎”（删除）到“ <code class="codeph">Taxes</code>表中。在为<code class="codeph">Taxes</code>创建闪回数据存档时，您指定的保留时间为十年：</p><pre class="oac_no_warn" dir="ltr">创建FLASHBACK ARCHIVE tax_archive TABLESPACE tbs1保留10年;</pre><p>当<code class="codeph">Taxes</code>交易的历史数据超过十年时，它被清除。（ <code class="codeph">Taxes</code>表本身以及来自不到十年的交易的历史数据不会被清除。）
                        </p>
                     </div>
                  </div><a id="ADFNS645"></a><div class="props_rev_3"><a id="GUID-ED0F756B-99FA-4B2F-94B5-744687EDB0F3" name="GUID-ED0F756B-99FA-4B2F-94B5-744687EDB0F3"></a><h5 id="ADFNS-GUID-ED0F756B-99FA-4B2F-94B5-744687EDB0F3" class="sect5">场景：使用闪回数据存档访问历史数据</h5>
                     <div>
                        <p>您希望能够从表格<code class="codeph">inventory</code>中检索年初所有项目的<code class="codeph">inventory</code> ，并且能够在一年中任何指定日期的业务结束时检索投资组合中每个符号的股票价格。从表<code class="codeph">stock_data</code> 。
                        </p>
                        <p>创建一个名为<code class="codeph">fla1</code>的默认闪回数据存档，它使用最多10 G的表空间<code class="codeph">tbs1</code> ，其数据保留五年（您必须以<code class="codeph">SYSDBA</code>身份登录）：</p><pre class="oac_no_warn" dir="ltr">创建FLASHBACK存档默认fla1 TABLESPACE tbs1 QUOTA 10G保留5年;</pre><p>为表<code class="codeph">inventory</code>和<code class="codeph">stock_data</code>启用闪回数据存档，并将历史数据存储在默认的闪回数据存档中：</p><pre class="oac_no_warn" dir="ltr">ALTER TABLE库存FLASHBACK ARCHIVE; ALTER TABLE stock_data FLASHBACK ARCHIVE;</pre><p>要检索2007年年初所有项目的清单，请使用以下查询：</p><pre class="oac_no_warn" dir="ltr">SELECT product_number，product_name，count FROM Inventory OF TIMESTAMP TO_TIMESTAMP（'2007-01-01 00:00:00'，'YYYY-MM-DD HH24：MI：SS'）;</pre><p>要在2007年7月23日营业结束时检索投资组合中每个符号的股票价格，请使用以下查询：</p><pre class="oac_no_warn" dir="ltr">SELECT符号，stock_price FROM stock_data AS OF TIMESTAMP TO_TIMESTAMP（'2007-07-23 16:00:00'，'YYYY-MM-DD HH24：MI：SS'）WHERE symbol in my_portfolio;</pre></div>
                  </div><a id="ADFNS646"></a><div class="props_rev_3"><a id="GUID-74B7EA4F-CF41-4633-A24E-66F7B89C6443" name="GUID-74B7EA4F-CF41-4633-A24E-66F7B89C6443"></a><h5 id="ADFNS-GUID-74B7EA4F-CF41-4633-A24E-66F7B89C6443" class="sect5">场景：使用闪回数据存档生成报告</h5>
                     <div>
                        <p>您希望用户能够从表<code class="codeph">investments</code>生成报告，以获取过去五年中存储的数据。
                        </p>
                        <p>创建一个名为<code class="codeph">fla2</code>的默认闪回数据存档，它使用最多20 G的表空间<code class="codeph">tbs1</code> ，其数据保留五年（您必须以<code class="codeph">SYSDBA</code>身份登录）：</p><pre class="oac_no_warn" dir="ltr">创建FLASHBACK存档默认fla2 TABLESPACE tbs1 QUOTA 20G保留5年;</pre><p>为表<code class="codeph">investments</code>启用闪回数据存档，并将历史数据存储在默认闪回数据存档中：</p><pre class="oac_no_warn" dir="ltr">ALTER TABLE投资FLASHBACK ARCHIVE;</pre><p>Lisa希望在2006年12月31日收盘时报告她的投资表现。她使用这个查询：</p><pre class="oac_no_warn" dir="ltr">SELECT * FROM投资AS TIMESTAMP TO_TIMESTAMP（'2006-12-31 16:00:00'，'YYYY-MM-DD HH24：MI：SS'）姓名='LISA';</pre></div>
                  </div><a id="ADFNS648"></a><div class="props_rev_3"><a id="GUID-AEB6257D-3277-4740-A576-08F275A75C42" name="GUID-AEB6257D-3277-4740-A576-08F275A75C42"></a><h5 id="ADFNS-GUID-AEB6257D-3277-4740-A576-08F275A75C42" class="sect5">场景：使用闪回数据存档进行审计</h5>
                     <div>
                        <p>医疗保险公司必须审核医疗诊所。这家医疗保险公司在<code class="codeph">Billings</code>表中提出了索赔，并创建了一个名为<code class="codeph">fla4</code>的默认闪回数据存档，它使用了多达100 G的表空间<code class="codeph">tbs1</code> ，其数据保留了10年：</p><pre class="oac_no_warn" dir="ltr">创建FLASHBACK存档默认fla4 TABLESPACE tbs1 QUOTA 100G保留10年;</pre><p>该公司为<code class="codeph">Billings</code>表启用闪回数据存档，并将历史数据存储在默认的闪回数据存档中：</p><pre class="oac_no_warn" dir="ltr">ALTER TABLE Billings FLASHBACK ARCHIVE;</pre><p>2007年5月1日，客户被收取了错误的金额用于某些诊断和测试。要查看截至2007年5月1日的记录，公司使用此查询：</p><pre class="oac_no_warn" dir="ltr">SELECT date_billed，amount_billed，patient_name，claim_Id，test_costs，诊断FROM Billings AS OF TIMESTAMP TO_TIMESTAMP（'2007-05-01 00:00:00'，'YYYY-MM-DD HH24：MI：SS'）;</pre></div>
                  </div><a id="ADFNS649"></a><div class="props_rev_3"><a id="GUID-E7372F07-2795-42CA-A1BC-8799CE8659AA" name="GUID-E7372F07-2795-42CA-A1BC-8799CE8659AA"></a><h5 id="ADFNS-GUID-E7372F07-2795-42CA-A1BC-8799CE8659AA" class="sect5">场景：使用闪回数据存档来恢复数据</h5>
                     <div>
                        <p>最终用户从先前在数据库中提交的错误事务中恢复。错误事务的撤消数据不再可用，但由于闪回数据存档中提供了所需的历史信息，因此闪回查询可以无缝地工作。</p>
                        <p>Lisa管理着一个软件开发团队，其产品销售情况良好。2007年11月3日，她决定给所有三年级员工，他们有超过两年的工作经验，加薪10％，晋升到四级。丽莎要求她的人力资源代表鲍勃做出改变。</p>
                        <p>使用HR Web应用程序，Bob更新<code class="codeph">employee</code>表，为Lisa的三级员工提高10％，将提升提升到四级。然后鲍勃完成了当天的工作并离开了家，没有意识到他在他的交易中省略了两年的经验要求。几天后，Lisa检查Bob是否已完成更新并发现该组中的每个人都获得加薪！她立即打电话给鲍勃并要求他纠正错误。
                        </p>
                        <p>起初，Bob认为他无法在不进行备份的情况下将employee表恢复到先前的状态。然后他记得<code class="codeph">employee</code>表启用了闪回数据存档。
                        </p>
                        <p>首先，他验证没有其他事务在他的后面修改了<code class="codeph">employee</code>表：两天前，来自事务查询的提交时间戳对应于Bob的事务。
                        </p>
                        <p>接下来，Bob使用这些语句将<code class="codeph">employee</code>表恢复为错误更改之前的状态：</p><pre class="oac_no_warn" dir="ltr">DELERE EMPLOYEE WHERE MANAGER ='LISA JOHNSON';插入员工选择*来自雇员的TIMESTAMP（SYSTIMESTAMP  -  INTERVAL'2'天），在那里经理='LISA JOHNSON';</pre><p>然后Bob重新执行Lisa请求的更新。</p>
                     </div>
                  </div>
               </div>
            </div><a id="ADFNS01012"></a><div class="props_rev_3"><a id="GUID-0DAA9454-D91A-46AC-A8E0-510670672F19" name="GUID-0DAA9454-D91A-46AC-A8E0-510670672F19"></a><h3 id="ADFNS-GUID-0DAA9454-D91A-46AC-A8E0-510670672F19" class="sect3">Oracle闪回技术的一般指南</h3>
               <div>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>使用<code class="codeph">DBMS_FLASHBACK</code> 。 <code class="codeph">ENABLE</code>和<code class="codeph">DBMS_FLASHBACK</code> 。围绕您无法控制的SQL代码的<code class="codeph">DISABLE</code>过程，或者您希望在几个连续查询中使用相同的过去时间。
                        </p>
                     </li>
                     <li>
                        <p>为方便起见，请对您编写的SQL代码使用Oracle闪回查询，Oracle闪回版本查询或Oracle闪回事务查询。例如，Oracle闪回查询足够灵活，可以在单个查询中进行比较和存储结果。</p>
                     </li>
                     <li>
                        <p>要获得稍后使用闪回功能的SCN，请使用<code class="codeph">DBMS_FLASHBACK</code> 。 <code class="codeph">GET_SYSTEM_CHANGE_NUMBER</code> 。</p>
                     </li>
                     <li>
                        <p>要计算或检索要在查询中使用的过去时间，请使用函数返回值作为时间戳或SCN参数。例如，将<code class="codeph">INTERVAL</code>值添加或减去<code class="codeph">SYSTIMESTAMP</code>函数的值。
                        </p>
                     </li>
                     <li>
                        <p>在本地或远程使用Oracle闪回查询，Oracle闪回版本查询和Oracle闪回事务查询。远程Oracle闪回查询的示例是：</p><pre class="oac_no_warn" dir="ltr">SELECT * FROM employees @ some_remote_host AS OF TIMESTAMP（SYSTIMESTAMP  -  INTERVAL'60'MECUTE）;</pre></li>
                     <li>
                        <p>要确保数据库一致性，请在查询过去的数据之前执行<code class="codeph">COMMIT</code>或<code class="codeph">ROLLBACK</code>操作。
                        </p>
                     </li>
                     <li>
                        <p>请记住，所有闪回处理都使用当前会话设置，例如国家语言和字符集，而不是当前查询时生效的设置。</p>
                     </li>
                     <li>
                        <p>请记住，更改表结构的DDL（例如，删除/修改列，移动表，删除分区，截断表/分区和添加约束）会使表的任何现有撤消数据无效。如果您尝试从执行此DDL之前的时间检索数据，则会发生错误ORA-01466。更改表的存储属性（例如<code class="codeph">PCTFREE</code> ， <code class="codeph">INITRANS</code>和<code class="codeph">MAXTRANS</code> ）的DDL操作不会使撤消数据无效。
                        </p>
                     </li>
                     <li>
                        <p>要在精确时间查询过去的数据，请使用SCN。如果使用时间戳，则查询的实际时间可能比指定的时间早3秒。Oracle数据库在内部使用SCN，并以3秒的粒度将它们映射到时间戳。</p>
                        <p>例如，假设SCN值1000和1005分别映射到时间戳8:41 AM和8:46 AM。对8:41:00到8:45:59 AM之间的时间的查询映射到SCN 1000;上午8:46的Oracle闪回查询映射到SCN 1005。因此，如果指定DDL操作稍后的时间（例如创建表），Oracle数据库可能会使用紧接在DDL操作之前的SCN，从而导致错误ORA-01466。</p>
                     </li>
                     <li>
                        <p>您无法从动态性能（ <code class="codeph">V$</code> ）视图中检索过去的数据。对此类视图的查询将返回当前数据。
                        </p>
                     </li>
                     <li>
                        <p>您可以对静态数据字典视图中的过去数据执行查询，例如<code class="codeph">*_TABLES</code> 。</p>
                     </li>
                     <li>
                        <p>通过在创建或更改闪回数据存档时指定<code class="codeph">OPTIMIZE</code> <code class="codeph">DATA</code> ，可以为闪回数据存档维护的历史表启用数据存储优化。
                        </p>
                        <p><code class="codeph">OPTIMIZE</code> <code class="codeph">DATA</code>使用以下任何功能优化历史记录表中的数据存储：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>高级行压缩</p>
                           </li>
                           <li>
                              <p>高级LOB压缩</p>
                           </li>
                           <li>
                              <p>高级LOB重复数据删除</p>
                           </li>
                           <li>
                              <p>段级压缩分层</p>
                           </li>
                           <li>
                              <p>行级压缩分层</p>
                           </li>
                        </ul>
                        <p>默认情况下不是优化历史表中的数据存储。</p>
                     </li>
                  </ul>
                  <div class="infoboxnote" id="GUID-0DAA9454-D91A-46AC-A8E0-510670672F19__IMPORTINGUSER-GENERATEDHISTORYCANLE-09803154">
                     <p class="notep1">警告：</p>
                     <p>导入用户生成的历史记录可能会导致结果不准确或不可靠。只有在咨询Oracle支持后才能使用此过程。</p>
                  </div>
               </div>
            </div><a id="ADFNS01013"></a><div class="props_rev_3"><a id="GUID-B681D62C-E66C-4C77-A03B-2C2CE8FA49CA" name="GUID-B681D62C-E66C-4C77-A03B-2C2CE8FA49CA"></a><h3 id="ADFNS-GUID-B681D62C-E66C-4C77-A03B-2C2CE8FA49CA" class="sect3">Oracle闪回技术的性能指南</h3>
               <div>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>使用<code class="codeph">DBMS_STATS</code>包为Oracle闪回查询中涉及的所有表生成统计信息。保持统计数据最新。Oracle闪回查询使用基于成本的优化器，该优化器依赖于这些统计信息。
                        </p>
                     </li>
                     <li>
                        <p>最小化必须访问的撤消数据量。使用查询使用索引选择过去数据的小组，而不是扫描整个表。如果必须扫描完整表，请在查询中添加并行提示。</p>
                        <p>I / O中的性能成本是数据中的分页成本和不在缓冲区高速缓存中的撤消块。CPU使用中的性能成本是将撤消信息应用于受影响的数据块的成本。在对最近的更改进行操作时，闪回操作受CPU限制。</p>
                        <p>Oracle建议您有足够的缓冲区缓存，以便归档程序的版本查询在缓冲区缓存中查找撤消数据。缓冲区缓存访问速度明显快于磁盘访问速度。</p>
                     </li>
                     <li>
                        <p>如果在跟踪表上执行非常大的事务（例如影响超过100万行），则将并行查询的大池大小设置得足够高（至少1 GB），而不必从SGA中分配新的块。</p>
                     </li>
                     <li>
                        <p>对于Oracle闪回版本查询，请使用索引结构。Oracle数据库保留用于索引更改和数据更改的撤消数据。基于索引查找的Oracle闪回版本查询的性能比其他需要的全表扫描快一个数量级。</p>
                     </li>
                     <li>
                        <p>在Oracle闪回事务查询中， <code class="codeph">xid</code>列的类型为<code class="codeph">RAW(8)</code> 。要利用<code class="codeph">xid</code>列上构建的索引，请使用<code class="codeph">HEXTORAW</code>转换函数： <code class="codeph">HEXTORAW(xid)</code> 。
                        </p>
                     </li>
                     <li>
                        <p>针对实例化视图的Oracle闪回查询不利用查询重写优化。</p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-B681D62C-E66C-4C77-A03B-2C2CE8FA49CA__NOTE-132-CAFE29F4">
                     <p class="notep1">也可以看看：</p>
                     <p>有关设置大池大小的信息，请<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/adfns&amp;id=TGDBA558" target="_blank"><span class="italic">参见“Oracle数据库性能调整指南”</span></a></p>
                  </div>
               </div>
            </div><a id="ADFNS98765"></a><div class="props_rev_3"><a id="GUID-DECBC705-B421-4861-A341-E07EBB883AC9" name="GUID-DECBC705-B421-4861-A341-E07EBB883AC9"></a><h3 id="ADFNS-GUID-DECBC705-B421-4861-A341-E07EBB883AC9" class="sect3">Oracle闪回技术的多租户容器数据库限制</h3>
               <div>
                  <p>这些Oracle闪回技术功能不适用于多租户容器数据库（CDB）：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>对于Oracle Database 12 <span class="italic">c</span>第1版（12.1.0.1），CDB不支持闪回数据存档（FDA）。</p>
                        <p>对于Oracle Database 12 <span class="italic">c</span>第1版（12.1.0.2），此限制已删除。
                        </p>
                     </li>
                     <li>
                        <p>CDB不支持闪回事务查询。</p>
                     </li>
                     <li>
                        <p>CDB不支持闪回事务回退。</p>
                     </li>
                  </ul>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>