<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>在Linux上管理Oracle数据库</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Database Administrator&#39;s Reference"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Database Administrator&#39;s Reference for Linux and UNIX System-Based Operating Systems"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="administrators-reference-linux-and-unix-system-based-operating-systems.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-07T05:04:28-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2006, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96356-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="tuning-oracle-database.html" title="Previous" type="text/html"></link>
      <link rel="next" href="administering-oracle-database-on-oracle-solaris.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Administrator&#39;s Reference for Linux and UNIX System-Based Operating Systems"></meta>
    <meta name="dcterms.isVersionOf" content="UNXAR"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="tuning-oracle-database.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="administering-oracle-database-on-oracle-solaris.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">数据库管理员参考</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">在Linux上管理Oracle数据库</li>
            </ol>
            <a id="GUID-340D998F-832C-4797-9C3B-5B55534DBA2B" name="GUID-340D998F-832C-4797-9C3B-5B55534DBA2B"></a><a id="UNXAR011"></a>
            
            <h2 id="UNXAR-GUID-340D998F-832C-4797-9C3B-5B55534DBA2B" class="sect2">在Linux <span class="enumeration_chapter">上</span>管理Oracle数据库</h2>
         </header>
         <div class="ind">
            <div>
               <p>本附录包含有关在Linux上管理Oracle数据库的信息。</p>
               <p>它包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="administering-oracle-database-on-linux.html#GUID-DD84F46F-4EBD-4D4C-A2C3-22EF994699CF">支持异步输入输出</a></p>
                  </li>
                  <li>
                     <p><a href="administering-oracle-database-on-linux.html#GUID-A46C0E76-770E-4C0B-B522-B004C756D0F1">异步输入输出支持</a></p>
                  </li>
                  <li>
                     <p><a href="administering-oracle-database-on-linux.html#GUID-D64FDD08-56F3-46C5-8845-66D5BB62E694">启用直接输入输出支持</a></p>
                  </li>
                  <li>
                     <p><a href="administering-oracle-database-on-linux.html#GUID-3A268E58-0D3F-4C82-B8DA-99298292327A">启用同时多线程</a></p>
                  </li>
                  <li>
                     <p><a href="administering-oracle-database-on-linux.html#GUID-5FBCEDFE-6548-44B5-9A96-9F89D7FEC5AF">分配共享资源</a></p>
                  </li>
                  <li>
                     <p><a href="administering-oracle-database-on-linux.html#GUID-00ABFA51-266B-422A-A730-A30FF37AAF09" title="Cgroup或控制组通过将一组专用CPU与数据库实例相关联来提高数据库性能。每个数据库实例只能使用其cgroup中的资源。">关于在Linux系统上创建cgroup</a></p>
                  </li>
                  <li>
                     <p><a href="administering-oracle-database-on-linux.html#GUID-CC72CEDC-58AA-4065-AC7D-FD4735E14416" title="如果您的操作系统启用了HugePages，请查看此信息。Oracle建议您在开始安装之前禁用Transparent HugePages。">HugePages概述</a></p>
                  </li>
               </ul>
               <div class="infoboxnote" id="GUID-340D998F-832C-4797-9C3B-5B55534DBA2B__GUID-DE0BDEB5-CFA8-4B5C-80AB-112C5A590120">
                  <p class="notep1">注意：</p>
                  <p>从Oracle Database <span class="italic">11g</span>第2版（11.2），Linux x86-64和IBM：Linux on System z介质开始，不包含Linux x86二进制文件。
                  </p>
               </div>
            </div><a id="UNXAR334"></a><div class="props_rev_3"><a id="GUID-DD84F46F-4EBD-4D4C-A2C3-22EF994699CF" name="GUID-DD84F46F-4EBD-4D4C-A2C3-22EF994699CF"></a><h3 id="UNXAR-GUID-DD84F46F-4EBD-4D4C-A2C3-22EF994699CF" class="sect3"><span class="enumeration_section">A.1</span>支持异步输入输出</h3>
               <div>
                  <div class="section">
                     <div class="infoboxnote" id="GUID-DD84F46F-4EBD-4D4C-A2C3-22EF994699CF__GUID-3062A27B-1DAE-4BAD-9E6C-8A9F84448F48">
                        <p class="notep1">注意：</p>
                        <p>在Linux上，默认情况下，自动存储管理使用异步输入输出。存储在网络文件系统上的数据库文件不支持异步输入输出。</p>
                     </div>
                     <p>Oracle数据库支持内核异步输入输出。默认情况下，在原始卷上启用异步输入输出。默认情况下，自动存储管理使用异步输入输出。</p>
                     <p>默认情况下，参数文件中的<code class="codeph">DISK_ASYNCH_IO</code>初始化参数设置为TRUE。要在文件系统文件上启用异步输入输出：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>确保所有Oracle数据库文件都位于支持异步输入输出的文件系统上。</span></li>
                     <li class="stepexpand"><span>将参数文件中的<code class="codeph">FILESYSTEMIO_OPTIONS</code>初始化参数设置为<code class="codeph">ASYNCH</code>或<code class="codeph">SETALL</code> 。</span><div>
                           <div class="infoboxnote" id="GUID-DD84F46F-4EBD-4D4C-A2C3-22EF994699CF__GUID-252BBFA6-0E23-4D72-B293-278678BE1A01">
                              <p class="notep1">注意：</p>
                              <p>如果通过ODM库接口或Direct NFS客户端管理文件系统文件，则默认情况下启用异步输入输出。无需在这些环境中设置<code class="codeph">FILESYSTEMIO_OPTIONS</code>以启用异步输入输出。
                              </p>
                           </div>
                        </div>
                     </li>
                  </ol>
               </div>
            </div><a id="UNXAR335"></a><div class="props_rev_3"><a id="GUID-A46C0E76-770E-4C0B-B522-B004C756D0F1" name="GUID-A46C0E76-770E-4C0B-B522-B004C756D0F1"></a><h3 id="UNXAR-GUID-A46C0E76-770E-4C0B-B522-B004C756D0F1" class="sect3"><span class="enumeration_section">A.2</span>异步输入输出支持</h3>
               <div>
                  <div class="section">
                     <div class="infoboxnote" id="GUID-A46C0E76-770E-4C0B-B522-B004C756D0F1__GUID-CA85F418-7CDF-45FB-ADA0-6C48401A86BB">
                        <p class="notep1">注意：</p>
                        <p>在Linux上，默认情况下，自动存储管理使用异步输入输出。存储在网络文件系统上的数据库文件不支持异步输入输出。</p>
                     </div>
                     <p>Oracle数据库支持内核异步输入输出。默认情况下禁用此功能。</p>
                     <p>默认情况下，参数文件中的<code class="codeph">DISK_ASYNCH_IO</code>初始化参数设置为TRUE <span>以在原始设备上启用异步I / O.</span>要在文件系统文件上启用异步输入输出：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li><span>确保所有Oracle数据库文件都位于支持异步输入输出的文件系统上。</span></li>
                     <li><span>将参数文件中的<code class="codeph">FILESYSTEMIO_OPTIONS</code>初始化参数设置为<code class="codeph">ASYNCH</code>以启用异步输入输出。如果要同时启用异步输入输出和直接输入输出，请将参数文件中的<code class="codeph">FILESYSTEMIO_OPTIONS</code>初始化参数设置为<code class="codeph">SETALL.</code> </span></li>
                  </ol>
                  <div class="section"></div>
                  <!-- class="section" -->
               </div>
            </div><a id="UNXAR336"></a><div class="props_rev_3"><a id="GUID-D64FDD08-56F3-46C5-8845-66D5BB62E694" name="GUID-D64FDD08-56F3-46C5-8845-66D5BB62E694"></a><h3 id="UNXAR-GUID-D64FDD08-56F3-46C5-8845-66D5BB62E694" class="sect3"><span class="enumeration_section">A.3</span>启用直接输入输出支持</h3>
               <div>
                  <div class="section">
                     <p>Linux上提供并支持直接输入输出支持。</p>
                     <p>要启用直接输入输出支持：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>将<code class="codeph">FILESYSTEMIO_OPTIONS</code>初始化参数设置为<code class="codeph">DIRECTIO</code> 。</p>
                        </li>
                        <li>
                           <p>将参数文件中的<code class="codeph">FILESYSTEMIO_OPTIONS</code>初始化参数设置为<code class="codeph">SETALL</code> ，这将启用异步输入输出和直接输入输出。
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="UNXAR339"></a><div class="props_rev_3"><a id="GUID-3A268E58-0D3F-4C82-B8DA-99298292327A" name="GUID-3A268E58-0D3F-4C82-B8DA-99298292327A"></a><h3 id="UNXAR-GUID-3A268E58-0D3F-4C82-B8DA-99298292327A" class="sect3"><span class="enumeration_section">A.4</span>启用同时多线程</h3>
               <div>
                  <p>如果启用了Simultaneous Multithreading，则<code class="codeph">v$osstat</code>视图将报告对应于联机逻辑（ <code class="codeph">NUM_LCPUS</code> ）和虚拟CPU（ <code class="codeph">NUM_VCPUS</code> ）的另外两行。
                  </p>
               </div>
            </div><a id="UNXAR340"></a><div class="props_rev_3"><a id="GUID-5FBCEDFE-6548-44B5-9A96-9F89D7FEC5AF" name="GUID-5FBCEDFE-6548-44B5-9A96-9F89D7FEC5AF"></a><h3 id="UNXAR-GUID-5FBCEDFE-6548-44B5-9A96-9F89D7FEC5AF" class="sect3"><span class="enumeration_section">A.5</span>分配共享资源</h3>
               <div>
                  <div class="section">
                     <p>要使用<code class="codeph">MEMORY_TARGET</code>或<code class="codeph">MEMORY_MAX_TARGET</code>功能，下面的内核参数必须进行修改。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">/dev/shm</code>安装点在尺寸上应等于或大于的值大<code class="codeph">SGA_MAX_SIZE</code> ，如果设置，或应该被设置为至少<code class="codeph">MEMORY_TARGET</code>或<code class="codeph">MEMORY_MAX_TARGET</code> ，任一较大。例如，仅设置<code class="codeph">MEMORY_MAX_TARGET=4GB</code> ，在<code class="codeph">/dev/shm</code>挂载点上创建一个4 GB的系统：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>以<code class="codeph">root</code>用户身份运行以下命令：</p><pre class="oac_no_warn" dir="ltr">#mount -t tmpfs shmfs -o size = 4g / dev / shm</pre></li>
                              <li>
                                 <p>确保在系统重新启动时装入内存中文件系统，在<code class="codeph">/etc/fstab</code>文件中添加类似于以下内容的条目：</p><pre class="oac_no_warn" dir="ltr">tmpfs / dev / shm tmpfs size = 4g 0</pre></li>
                           </ul>
                        </li>
                        <li>
                           <p>每个Oracle实例的文件描述符数量增加了512 * <code class="codeph">PROCESSES</code> 。因此，文件描述符的最大数量应至少为此值，再加上操作系统要求的更多值。例如，如果<code class="codeph">cat /proc/sys/fs/file-max</code>命令返回<span>32768</span> <code class="codeph">PROCESSES</code>是100，你可以将其设置为6815744或更高的<code class="codeph">root</code> ，有51200可用于Oracle。使用以下选项之一设置<code class="codeph">file-max</code>描述符的值。
                           </p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>运行以下命令：</p><pre class="oac_no_warn" dir="ltr">echo 6815744&gt; / proc / sys / fs / file-max</pre><p>要么</p>
                              </li>
                              <li>
                                 <p>修改<code class="codeph">/etc/sysctl.conf</code>文件中的以下条目，并以<code class="codeph">root</code>身份重新启动系统。
                                 </p><pre class="oac_no_warn" dir="ltr">fs.file-max = 6815744</pre></li>
                           </ul>
                        </li>
                        <li>
                           <p>每进程文件描述符数必须至少为512。例如，以<code class="codeph">root</code>身份运行以下命令。
                           </p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>在bash和sh：</p><pre class="oac_no_warn" dir="ltr">#ulimit -n</pre></li>
                              <li>
                                 <p>在csh上：</p><pre class="oac_no_warn" dir="ltr">#limit descriptors</pre></li>
                           </ul>
                           <p>如果上述命令返回200，则运行以下命令以设置每处理器文件描述符限制的值，例如设置为1000：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>在bash和sh：</p><pre class="oac_no_warn" dir="ltr">#sudo sh＃ulimit -n 1000</pre></li>
                              <li>
                                 <p>在csh上：</p><pre class="oac_no_warn" dir="ltr">#sudo sh #limit descriptors 1000</pre></li>
                           </ul>
                        </li>
                        <li>
                           <p><code class="codeph">MEMORY_TARGET</code>和<code class="codeph">MEMORY_MAX_TARGET</code>时不能使用<code class="codeph">LOCK_SGA</code>启用。<code class="codeph">MEMORY_TARGET</code>和<code class="codeph">MEMORY_MAX_TARGET</code>也不能在Linux上庞大的页面中使用。
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-00ABFA51-266B-422A-A730-A30FF37AAF09" name="GUID-00ABFA51-266B-422A-A730-A30FF37AAF09"></a><h3 id="UNXAR-GUID-00ABFA51-266B-422A-A730-A30FF37AAF09" class="sect3"><span class="enumeration_section">A.6</span>关于在Linux系统上创建Cgroup</h3>
               <div>
                  <p>Cgroup或控制组通过将一组专用CPU与数据库实例相关联来提高数据库性能。每个数据库实例只能使用其cgroup中的资源。</p>
                  <p>在大型服务器上进行整合时，您可能希望将数据库限制为CPU和内存的特定子集。此功能可以轻松为Oracle数据库实例启用CPU和内存限制。</p>
                  <p>使用<code class="codeph">setup_processor_group.sh</code>脚本创建cgroup。从My Oracle Support网站上的注释1585184.1下载此脚本：</p>
                  <p><a href="https://support.oracle.com/CSP/main/article?cmd=show&amp;type=NOT&amp;id=1585184.1" target="_blank">https://support.oracle.com/CSP/main/article?cmd=show&amp;type=NOT&amp;id=1585184.1</a></p>
               </div>
            </div><a id="UNXAR400"></a><div class="props_rev_3"><a id="GUID-CC72CEDC-58AA-4065-AC7D-FD4735E14416" name="GUID-CC72CEDC-58AA-4065-AC7D-FD4735E14416"></a><h3 id="UNXAR-GUID-CC72CEDC-58AA-4065-AC7D-FD4735E14416" class="sect3"><span class="enumeration_section">A.7</span> HugePages概述</h3>
               <div>
                  <p>HugePages是集成到Linux内核2.6中的一项功能。启用HugePages使操作系统可以支持大于默认值的内存页（通常为4 KB）。使用非常大的页面大小可以通过减少访问页表条目所需的系统资源量来提高系统性能。HugePages对32位和64位配置都很有用。HugePage大小从2 MB到256 MB不等，具体取决于内核版本和硬件架构。对于Oracle数据库，使用HugePages可以减少页面状态的操作系统维护，并提高转换后备缓冲区（TLB）命中率。</p>
                  <div class="infoboxnote" id="GUID-CC72CEDC-58AA-4065-AC7D-FD4735E14416__GUID-2DB721A0-2095-4EC1-A255-5475EC591852">
                     <p class="notep1">注意：</p>
                     <p>透明Hugepages目前不是手动配置HugePages的替代方法。</p>
                  </div>
                  <p>本节包括以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="administering-oracle-database-on-linux.html#GUID-C042125D-9BE1-48D0-8C70-74251A0AF60C" title="如果您的操作系统启用了HugePages，请查看此信息。">回顾HugePages内存分配</a></p>
                     </li>
                     <li>
                        <p><a href="administering-oracle-database-on-linux.html#GUID-76C03D99-6025-41F2-8BE3-F6DCDB1DCEE0">在Linux上使用HugePages</a></p>
                     </li>
                     <li>
                        <p><a href="administering-oracle-database-on-linux.html#GUID-ECABF30C-136B-4D12-A371-6AC8980BB46E">使用HugePages调整SGA</a></p>
                     </li>
                     <li>
                        <p><a href="administering-oracle-database-on-linux.html#GUID-19BFCC60-BA4C-4750-85EB-7432282A9556">在Linux上配置HugePages</a></p>
                     </li>
                     <li>
                        <p><a href="administering-oracle-database-on-linux.html#GUID-95CAEFDE-489B-453A-B5D5-4461DABBEEAD">HugePages配置的限制</a></p>
                     </li>
                     <li>
                        <p><a href="administering-oracle-database-on-linux.html#GUID-02E9147D-D565-4AF8-B12A-8E6E9F74BEEA" title="Oracle建议您在开始安装之前禁用Transparent HugePages。">禁用透明HugePages</a></p>
                     </li>
                  </ul>
               </div>
               <div class="sect3"><a id="GUID-C042125D-9BE1-48D0-8C70-74251A0AF60C" name="GUID-C042125D-9BE1-48D0-8C70-74251A0AF60C"></a><h4 id="UNXAR-GUID-C042125D-9BE1-48D0-8C70-74251A0AF60C" class="sect4"><span class="enumeration_section">A.7.1</span>查看HugePages内存分配</h4>
                  <div>
                     <p>如果您的操作系统启用了HugePages，请查看此信息。</p>
                     <p>在Linux平台安装中，Oracle建议您使用HugePages获取Oracle数据库的最佳性能。在启用了HugePages的服务器上升级Oracle Grid Infrastructure和Oracle数据库时，Oracle建议您查看HugePages内存分配要求。</p>
                     <div class="section">
                        <p class="subhead3" id="GUID-C042125D-9BE1-48D0-8C70-74251A0AF60C__GUID-F4F6A32B-F349-4C63-A36E-3D2B7C0DF3A2">GIMR和HugePages记忆</p>
                        <p>Oracle Grid Infrastructure安装包括Grid Infrastructure Management Repository（GIMR）。在群集成员节点上配置HugePages时，GIMR系统全局区域（SGA）将安装到HugePages内存中。GIMR SGA占用高达1 GB的HugePages内存。Oracle Grid Infrastructure在群集上安装Oracle数据库之前启动。</p>
                        <p>如果群集成员节点操作系统内存分配到HugePages不足以满足群集上所有Oracle数据库实例的SGA大小，那么您可能会发现一个或多个Oracle数据库SGA映射到常规页面，而不是的巨大页面，降低了预期的性能。为避免此问题，在计划升级时，请确保为HugePages保留的内存足够大，以满足您的内存要求。</p>
                        <p>将内存分配给HugePages足够大，以便计划在群集上运行SGA的所有数据库，并为Grid Infrastructure Management Repository提供SGA。</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="UNXAR330"></a><div class="props_rev_3"><a id="GUID-76C03D99-6025-41F2-8BE3-F6DCDB1DCEE0" name="GUID-76C03D99-6025-41F2-8BE3-F6DCDB1DCEE0"></a><h4 id="UNXAR-GUID-76C03D99-6025-41F2-8BE3-F6DCDB1DCEE0" class="sect4"><span class="enumeration_section">A.7.2</span>在Linux上使用HugePages</h4>
                  <div>
                     <p>要使Oracle数据库在Linux上使用大页面（有时称为HugePages），请设置<code class="codeph">vm.nr_hugepages</code>内核参数的值以指定要保留的大页面数。您必须指定足够的大页面来保存数据库实例的整个SGA。要确定所需的参数值，请将实例的SGA大小除以大页面的大小，然后将结果向上舍入为最接近的整数。
                     </p>
                     <p>要确定默认的大页面大小，请运行以下命令：</p><pre class="oac_no_warn" dir="ltr">#grep Hugepagesize / proc / meminfo</pre><p>例如，如果<code class="codeph">/proc/meminfo</code>将大页面大小列为2 MB，并且实例的总SGA大小为1.6 GB，则将<code class="codeph">vm.nr_hugepages</code>内核参数的值设置为820（1.6 GB / 2 MB = 819.2 ）。
                     </p>
                  </div>
               </div><a id="UNXAR401"></a><div class="props_rev_3"><a id="GUID-ECABF30C-136B-4D12-A371-6AC8980BB46E" name="GUID-ECABF30C-136B-4D12-A371-6AC8980BB46E"></a><h4 id="UNXAR-GUID-ECABF30C-136B-4D12-A371-6AC8980BB46E" class="sect4"><span class="enumeration_section">A.7.3</span>使用HugePages调整SGA</h4>
                  <div>
                     <p>如果没有HugePages，操作系统会将每个4 KB的内存保留为页面。当它将页面分配给数据库系统全局区域（SGA）时，操作系统内核必须为分配给该数据库的每个4 KB页面不断更新其页表生命周期（脏，空，映射到进程等）的页表。 SGA。</p>
                     <p>使用HugePages，操作系统页表（虚拟内存到物理内存映射）较小，因为每个页表条目指向2 MB到256 MB的页面。</p>
                     <p>此外，内核具有较少的页面，其生命周期必须受到监视。例如，如果将HugePages与64位硬件一起使用，并且要映射256 MB内存，则可能需要一个页表条目（PTE）。如果您不使用HugePages，并且想要映射256 MB内存，则必须具有256 MB * 1024 KB / 4 KB = 65536个PTE。</p>
                     <p>HugePages具有以下优势：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>通过增加TLB命中率提高性能</p>
                        </li>
                        <li>
                           <p>页面被锁定在内存中，永远不会被换出，这为共享内存结构（如SGA）提供了RAM</p>
                        </li>
                        <li>
                           <p>连续页面是预分配的，不能用于除System V共享内存之外的任何其他内容（例如，SGA）</p>
                        </li>
                        <li>
                           <p>由于页面大小较大，内核对于该部分虚拟内存的簿记工作较少</p>
                        </li>
                     </ul>
                  </div>
               </div><a id="UNXAR402"></a><div class="props_rev_3"><a id="GUID-19BFCC60-BA4C-4750-85EB-7432282A9556" name="GUID-19BFCC60-BA4C-4750-85EB-7432282A9556"></a><h4 id="UNXAR-GUID-19BFCC60-BA4C-4750-85EB-7432282A9556" class="sect4"><span class="enumeration_section">A.7.4</span>在Linux上配置HugePages</h4>
                  <div>
                     <div class="section">
                        <p>完成以下步骤以在计算机上配置HugePages：</p>
                        <ol>
                           <li>
                              <p>运行以下命令以确定内核是否支持HugePages：</p><pre class="oac_no_warn" dir="ltr">$ grep Huge / proc / meminfo</pre></li>
                           <li>
                              <p>某些Linux系统默认不支持HugePages。对于此类系统，请使用<code class="codeph">CONFIG_HUGETLBFS</code>和<code class="codeph">CONFIG_HUGETLB_PAGE</code>配置选项构建Linux内核。<code class="codeph">CONFIG_HUGETLBFS</code>位于下文件系统和<code class="codeph">CONFIG_HUGETLB_PAGE</code>当您选择选择<code class="codeph">CONFIG_HUGETLBFS</code> 。</p>
                           </li>
                           <li>
                              <p>编辑<code class="codeph">/etc/security/limits.conf</code>文件中的<code class="codeph">memlock</code>设置。<code class="codeph">memlock</code>设置以KB为单位指定，当启用HugePages内存时，最大锁定内存限制应设置为当前RAM的至少90％，并且当禁用HugePages内存时，应设置至少3145728 KB（3 GB）。例如，如果安装了64 GB RAM，则添加以下条目以增加最大锁定内存地址空间：</p><pre class="oac_no_warn" dir="ltr">*软memlock 60397977 * hard memlock 60397977</pre><p>您还可以将<code class="codeph">memlock</code>值设置为高于SGA要求。
                              </p>
                           </li>
                           <li>
                              <p>再次以<code class="codeph">oracle</code>用户身份登录并运行<code class="codeph">ulimit -l</code>命令以验证新的<code class="codeph">memlock</code>设置：</p><pre class="oac_no_warn" dir="ltr">$ ulimit -l 60397977</pre></li>
                           <li>
                              <p>运行以下命令以显示<code class="codeph">Hugepagesize</code>变量的值：</p><pre class="oac_no_warn" dir="ltr">$ grep Hugepagesize / proc / meminfo</pre></li>
                           <li>
                              <p>完成以下过程以创建一个脚本，该脚本计算当前共享内存段的<code class="codeph">hugepages</code>配置的建议值：</p>
                              <ol type="a">
                                 <li>
                                    <p>创建名为<code class="codeph">hugepages_settings.sh</code>的文本文件。
                                    </p>
                                 </li>
                                 <li>
                                    <p>在文件中添加以下内容：</p><pre class="oac_no_warn" dir="ltr">＃！/ bin / bash ## hugepages_settings.sh ## Linux bash脚本计算＃recommended HugePages / HugeTLB配置的值##注意：此脚本会对脚本运行时可用的所有共享内存＃段进行计算，无论它是什么＃是否是Oracle RDBMS共享内存段。＃检查内核版本KERN =`uname -r | awk -F。 '{printf（“％d。％d \ n”，$ 1，$ 2）; }'`＃找出HugePage大小HPG_SZ =`grep Hugepagesize / proc / meminfo | awk {'print $ 2'}`＃从1页开始是安全的，保证1个免费的HugePage NUM_PG = 1＃在`ipcs -m |中处理SEG_BYTES的运行共享内存段所需的累积页数awk {'print $ 5'} | grep“[0-9] [0-9] *”`做MIN_PG =`echo“$ SEG_BYTES /（$ HPG_SZ * 1024）”| bc -q` if [$ MIN_PG -gt 0];然后NUM_PG =`echo'$ NUM_PG + $ MIN_PG + 1“| bc -q` fi done＃完成结果案例$ KERN in'2.4'）HUGETLB_POOL =`echo“$ NUM_PG * $ HPG_SZ / 1024”| bc -q`; echo“推荐设置：vm.hugetlb_pool = $ HUGETLB_POOL”;; '2.6'|'3.8'）echo“推荐设置：vm.nr_hugepages = $ NUM_PG”;; *）echo“无法识别的内核版本$ KERN。正在退出。” ;; esac #End</pre></li>
                                 <li>
                                    <p>运行以下命令以更改文件的权限：</p><pre class="oac_no_warn" dir="ltr">$ chmod + x hugepages_settings.sh</pre></li>
                              </ol>
                           </li>
                           <li id="GUID-19BFCC60-BA4C-4750-85EB-7432282A9556__CACJDEDA">
                              <p>运行<code class="codeph">hugepages_settings.sh</code>脚本来计算<code class="codeph">hugepages</code>配置的值：</p><pre class="oac_no_warn" dir="ltr">$ ./hugepages_settings.sh</pre><div class="infoboxnote" id="GUID-19BFCC60-BA4C-4750-85EB-7432282A9556__GUID-3002140C-16FA-4FDB-80E1-4FA16945C4E2">
                                 <p class="notep1">注意：</p>
                                 <p>在运行此脚本之前，请确保运行使用<code class="codeph">hugepages</code>所有应用程序。
                                 </p>
                              </div>
                           </li>
                           <li>
                              <p>设置以下内核参数，其中<span class="italic">value</span>是您在步骤<a href="administering-oracle-database-on-linux.html#GUID-19BFCC60-BA4C-4750-85EB-7432282A9556__CACJDEDA">7中</a>确定的HugePages值：</p><pre class="oac_no_warn" dir="ltr">#sysctl -w vm.nr_hugepages = <span class="italic">value</span>
</pre></li>
                           <li>
                              <p>要确保在系统重新启动后分配HugePages，请将以下条目添加到<code class="codeph">/etc/sysctl.conf</code>文件中，其中<span class="italic">value</span>是您在步骤<a href="administering-oracle-database-on-linux.html#GUID-19BFCC60-BA4C-4750-85EB-7432282A9556__CACJDEDA">7中</a>确定的HugePages值：</p><pre class="oac_no_warn" dir="ltr">vm.nr_hugepages = <span class="italic">value</span>
</pre></li>
                           <li>
                              <p>运行以下命令以检查可用的大<code class="codeph">hugepages</code> ：</p><pre class="oac_no_warn" dir="ltr">$ grep Huge / proc / meminfo</pre></li>
                           <li>
                              <p>重启实例。</p>
                           </li>
                           <li>
                              <p>运行以下命令检查可用的<code class="codeph">hugepages</code> （1或2页免费）：</p><pre class="oac_no_warn" dir="ltr">$ grep Huge / proc / meminfo</pre><div class="infoboxnote" id="GUID-19BFCC60-BA4C-4750-85EB-7432282A9556__GUID-6DBCB1EC-3A2C-4840-98F4-B86F30815D87">
                                 <p class="notep1">注意：</p>
                                 <p>如果您无法使用<code class="codeph">nr_hugepages</code>设置HugePages分配，则可用内存可能会碎片化。重新启动服务器以使Hugepages分配生效。
                                 </p>
                              </div>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="UNXAR403"></a><div class="props_rev_3"><a id="GUID-95CAEFDE-489B-453A-B5D5-4461DABBEEAD" name="GUID-95CAEFDE-489B-453A-B5D5-4461DABBEEAD"></a><h4 id="UNXAR-GUID-95CAEFDE-489B-453A-B5D5-4461DABBEEAD" class="sect4"><span class="enumeration_section">A.7.5</span> HugePages配置的限制</h4>
                  <div>
                     <div class="section">
                        <p>HugePages具有以下限制：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您必须撤消两个<code class="codeph">MEMORY_TARGET</code>和<code class="codeph">MEMORY_MAX_TARGET</code>初始化参数。例如，要取消设置数据库实例的参数，请使用命令<code class="codeph">ALTER SYSTEM RESET</code> 。</p>
                           </li>
                           <li>
                              <p>自动内存管理（AMM）和HugePages不兼容。使用AMM时，通过在<code class="codeph">/dev/shm</code>下创建文件来分配整个SGA内存。当Oracle数据库使用AMM分配SGA时，不保留HugePages。要在Oracle Database 19c上使用HugePages，您必须禁用AMM。</p>
                           </li>
                           <li>
                              <p>如果在32位环境中使用VLM，则不能将HugePages用于数据库缓冲区高速缓存。您可以将HugePages用于SGA的其他部分，例如<code class="codeph">shared_pool</code> ， <code class="codeph">large_pool</code>等。VLM（缓冲区缓存）的内存分配使用共享内存文件系统（ <code class="codeph">ramfs/tmpfs/shmfs</code> ）完成。内存文件系统不保留或使用HugePages。
                              </p>
                           </li>
                           <li>
                              <p>除非系统管理员通过修改可用页数或修改池大小来更改HugePages配置，否则HugePages不会在系统启动后进行分配或释放。如果在系统启动期间未在内存中保留所需的空间，则HugePages分配失败。</p>
                           </li>
                           <li>
                              <p>确保正确配置HugePages，因为如果应用程序未使用多余的HugePages，系统可能会耗尽内存。</p>
                           </li>
                           <li>
                              <p>如果实例启动时没有足够的HugePages且初始化参数<code class="codeph">use_large_pages</code>设置为<code class="codeph">only</code> ，则数据库无法启动，并且警报日志消息提供有关Hugepages的必要信息。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-02E9147D-D565-4AF8-B12A-8E6E9F74BEEA" name="GUID-02E9147D-D565-4AF8-B12A-8E6E9F74BEEA"></a><h4 id="UNXAR-GUID-02E9147D-D565-4AF8-B12A-8E6E9F74BEEA" class="sect4"><span class="enumeration_section">A.7.6</span>禁用透明HugePages</h4>
                  <div>
                     <p>Oracle建议您在开始安装之前禁用Transparent HugePages。</p>
                     <div class="section" id="GUID-02E9147D-D565-4AF8-B12A-8E6E9F74BEEA__GUID-BD757063-779C-4411-9A30-B475FFC39EBD">
                        <p>透明HugePages内存与标准HugePages内存不同，因为内核<code class="codeph">khugepaged</code>线程在运行时动态分配内存。标准HugePages内存在启动时预先分配，并且在运行时不会更改。
                        </p>
                        <div class="infoboxnote" id="GUID-02E9147D-D565-4AF8-B12A-8E6E9F74BEEA__GUID-9010427C-CB6F-4769-B82E-94E826D3FB8A">
                           <p class="notep1">注意：</p>虽然在UEK2和更高版本的UEK内核上禁用了透明HugePages，但默认情况下可以在Linux系统上启用Transparent HugePages。
                        </div>
                        <p>Red Hat Enterprise Linux 6，Red Hat Enterprise Linux 7，SUSE 11，Oracle Linux 6和Oracle Linux 7默认启用透明HugePages内存，早期版本的Oracle Linux具有Unbreakable Enterprise Kernel 2（UEK2）内核。</p>
                        <p>透明HugePages可能会在运行时导致内存分配延迟。为避免性能问题，Oracle建议您在所有Oracle数据库服务器上禁用透明HugePages。Oracle建议您使用标准HugePages来提高性能。</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>要检查是否已启用Transparent HugePages，请以root用户身份运行以下命令之一：</p>
                        <p>红帽企业Linux内核：</p><pre class="pre codeblock"><code>#cat / sys / kernel / mm / redhat_transparent_hugepage / enabled</code></pre><p>其他内核：</p><pre class="pre codeblock"><code>#cat / sys / kernel / mm / transparent_hugepage / enabled</code></pre><p>以下是一个示例输出，显示正在使用透明HugePages，因为[always]标志已启用。</p><pre class="pre codeblock"><code>[始终不曾</code></pre><div class="infoboxnote" id="GUID-02E9147D-D565-4AF8-B12A-8E6E9F74BEEA__GUID-BA4B2D75-86E0-4052-8760-108D7BEA2E4B">
                           <p class="notep1">注意：</p>
                           <p>如果从内核中删除Transparent HugePages，则既不存在<code>/sys/kernel/mm/transparent_hugepage</code>也不存在<code>/sys/kernel/mm/redhat_transparent_hugepage files</code> 。
                           </p>
                        </div>
                        <p>要禁用透明HugePages：</p>
                        <ol>
                           <li>
                              <p>对于Oracle Linux 6或更早版本，请将以下条目添加到<code class="codeph">/etc/grub.conf</code>文件中的内核引导行：</p><pre class="pre codeblock"><code>transparent_hugepage =从不</code></pre><div class="p">例如：<pre class="pre codeblock"><code>标题Oracle Linux Server（2.6.32-300.25.1.el6uek.x86_64）root（hd0,0）kernel /vmlinuz-2.6.32-300.25.1.el6uek.x86_64 ro root = LABEL = / transparent_hugepage = never initrd / initramfs -2.6.32-300.25.1.el6uek.x86_64.img</code></pre></div>
                              <p>对于Oracle Linux 7或更高版本的操作系统，文件名可能有所不同。检查操作系统文档以获取确切的文件名和禁用透明HugePages的步骤。</p>
                              <p>例如，对于Oracle Linux 7.3，禁用透明HugePages的过程包括编辑<code class="codeph">/etc/default/grub</code>文件，然后运行命令<code class="codeph">grub2-mkconfig</code> 。
                              </p>
                           </li>
                           <li>
                              <p>重新启动系统以使更改成为永久更改。</p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>