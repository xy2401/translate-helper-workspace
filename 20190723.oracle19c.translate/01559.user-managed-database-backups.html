<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>进行用户管理的数据库备份</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="Backup and Recovery User&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="database-backup-and-recovery-users-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-01-09T05:20:45-08:00"></meta>
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96241-01"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="part-user-managed-backup-recovery.html" title="Previous" type="text/html"></link>
      <link rel="next" href="user-managed-flashback-dbpitr.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Backup and Recovery User&#39;s Guide"></meta>
    <meta name="dcterms.isVersionOf" content="BRADV"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="part-user-managed-backup-recovery.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="user-managed-flashback-dbpitr.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">备份和恢复用户指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-user-managed-backup-recovery.html" property="item" typeof="WebPage"><span property="name">执行用户管理的备份和恢复</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">进行用户管理的数据库备份</li>
            </ol>
            <a id="GUID-2193FAD0-F62C-4671-9272-55E8BD7367DC" name="GUID-2193FAD0-F62C-4671-9272-55E8BD7367DC"></a><a id="BRADV016"></a>
            
            <h2 id="BRADV-GUID-2193FAD0-F62C-4671-9272-55E8BD7367DC" class="sect2"><span class="enumeration_chapter">29进行</span>用户管理的数据库备份</h2>
         </header>
         <div class="ind">
            <div>
               <p><a id="d135532e69" class="indexterm-anchor"></a><a id="d135532e73" class="indexterm-anchor"></a>本章介绍在用户管理的备份和恢复策略中备份Oracle数据库的方法，即不依赖于使用Recovery Manager（RMAN）的策略。
               </p>
               <p>本章包含以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="user-managed-database-backups.html#GUID-B1342AE5-9632-459C-BC21-F0EEED53FC92">查询V $视图以获取备份信息</a></p>
                  </li>
                  <li>
                     <p><a href="user-managed-database-backups.html#GUID-65C5E03A-E906-47EB-92AF-6DC273DBD0A8">进行整个数据库的用户管理备份</a></p>
                  </li>
                  <li>
                     <p><a href="user-managed-database-backups.html#GUID-2E2AF00A-BF0B-497B-8E5F-1DBF2C7FEEA5">制作用户管理的CDB和PDB备份</a></p>
                  </li>
                  <li>
                     <p><a href="user-managed-database-backups.html#GUID-D1582062-FF0C-462B-8468-4052914FA7B3">进行用户管理的表空间和数据文件备份</a></p>
                  </li>
                  <li>
                     <p><a href="user-managed-database-backups.html#GUID-B4948C50-74CA-40DE-9CD8-11455F14B6AD">在CDB中进行用户管理的表空间备份</a></p>
                  </li>
                  <li>
                     <p><a href="user-managed-database-backups.html#GUID-D8ECFDCB-74ED-4AD4-8032-43D2155AB628">进行用户管理的控制文件备份</a></p>
                  </li>
                  <li>
                     <p><a href="user-managed-database-backups.html#GUID-EFAB81C0-554D-4B09-A29F-ADADF6451D88">进行用户管理的归档重做日志备份</a></p>
                  </li>
                  <li>
                     <p><a href="user-managed-database-backups.html#GUID-F41318F6-A2F2-4518-9DB5-9EBB904EFB47">在SUSPEND模式下进行用户管理备份</a></p>
                  </li>
                  <li>
                     <p><a href="user-managed-database-backups.html#GUID-3E0AAB48-7D0B-4012-BB41-E33DD11189C0">使用户管理的备份到原始设备</a></p>
                  </li>
                  <li>
                     <p><a href="user-managed-database-backups.html#GUID-A1112F2C-D0ED-4C2F-BA24-A614F99F0FCA">使用第三方快照技术进行备份</a></p>
                  </li>
                  <li>
                     <p><a href="user-managed-database-backups.html#GUID-F47FE2CE-EEE0-42E5-AE8E-0A9D5D1BB42C">验证用户管理的数据文件备份</a></p>
                  </li>
               </ul>
            </div><a id="BRADV198"></a><div class="props_rev_3"><a id="GUID-B1342AE5-9632-459C-BC21-F0EEED53FC92" name="GUID-B1342AE5-9632-459C-BC21-F0EEED53FC92"></a><h3 id="BRADV-GUID-B1342AE5-9632-459C-BC21-F0EEED53FC92" class="sect3"><span class="enumeration_section">29.1</span>查询V $视图获取备份信息</h3>
               <div>
                  <p><a id="d135532e205" class="indexterm-anchor"></a><a id="d135532e209" class="indexterm-anchor"></a><a id="d135532e213" class="indexterm-anchor"></a><a id="d135532e217" class="indexterm-anchor"></a><a id="d135532e221" class="indexterm-anchor"></a><a id="d135532e223" class="indexterm-anchor"></a>在进行备份之前，您必须识别数据库中的所有文件并确定要备份的内容。您可以使用V $视图来获取此信息。
                  </p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="user-managed-database-backups.html#GUID-1B9C4075-9131-48C9-A4D4-9D9CC36297C0">在备份之前列出数据库文件</a></p>
                     </li>
                     <li>
                        <p><a href="user-managed-database-backups.html#GUID-C76503E4-81E4-418E-BAEF-E3B3ECF1CCD9">确定联机表空间备份的数据文件状态</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV485"></a><a id="BRADV89998"></a><div class="props_rev_3"><a id="GUID-1B9C4075-9131-48C9-A4D4-9D9CC36297C0" name="GUID-1B9C4075-9131-48C9-A4D4-9D9CC36297C0"></a><h4 id="BRADV-GUID-1B9C4075-9131-48C9-A4D4-9D9CC36297C0" class="sect4"><span class="enumeration_section">29.1.1</span>在备份之前列出数据库文件</h4>
                  <div>
                     <div class="section">
                        <p>使用<code class="codeph">V$DATAFILE</code>和<code class="codeph">V$CONTROLFILE</code>视图来标识数据库的数据文件和控制文件。无论您是手动命名这些文件还是允许Oracle Managed Files命名它们，这个过程都会有效。
                        </p>
                        <div class="infoboxnote" id="GUID-1B9C4075-9131-48C9-A4D4-9D9CC36297C0__GUID-1FFD10B6-BB40-4AAC-AE8D-16E3A659320B">
                           <p class="notep1">警告：</p>
                           <p>永远不要备份联机重做日志文件。</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-1B9C4075-9131-48C9-A4D4-9D9CC36297C0__GUID-89CBDA7B-AF62-4570-BBCA-F961F52895E1">列出数据文件和控制文件：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>启动SQL * Plus并查询<code class="codeph">V$DATAFILE</code>以获取数据文件列表。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">从V $ DATAFILE中选择名称;</pre><p>你也可以加入<a id="d135532e339" class="indexterm-anchor"></a><a id="d135532e341" class="indexterm-anchor"></a> <code class="codeph">V$TABLESPACE</code>和<code class="codeph">V$DATAFILE</code>视图获取数据文件列表及其关联的表空间：</p><pre class="oac_no_warn" dir="ltr">选择t。名称“表空间”，f。名称“数据文件”FROM V $ TABLESPACE t，V $ DATAFILE f WHERE t。TS＃= f。TS＃ORDER BY t。名称;</pre></div>
                        </li>
                        <li class="stepexpand"><span><a id="d135532e353" class="indexterm-anchor"></a>通过查询<code class="codeph">V$CONTROLFILE</code>视图获取当前控制文件的文件名。例如，发出以下查询：</span><div><pre class="oac_no_warn" dir="ltr">从V $ CONTROLFILE中选择名称;</pre><p>您只需要备份一份副本<a id="d135532e366" class="indexterm-anchor"></a><a id="d135532e370" class="indexterm-anchor"></a>多路复用控制文件。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span><a id="d135532e375" class="indexterm-anchor"></a><a id="d135532e379" class="indexterm-anchor"></a><a id="d135532e383" class="indexterm-anchor"></a>如果您计划与执行控制文件的备份<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code> <code class="codeph">TO</code> <code class="codeph">'</code> <span class="italic"><code class="codeph">filename</code></span> <code class="codeph">'</code>的语句，然后保存所有数据文件的列表和联机重做日志文件与控制文件的备份。由于当前数据库结构可能与创建给定控制文件备份时的数据库结构不匹配，因此保存备份控制文件中记录的文件列表可以帮助恢复过程。</span></li>
                     </ol>
                  </div>
               </div><a id="BRADV89999"></a><div class="props_rev_3"><a id="GUID-C76503E4-81E4-418E-BAEF-E3B3ECF1CCD9" name="GUID-C76503E4-81E4-418E-BAEF-E3B3ECF1CCD9"></a><h4 id="BRADV-GUID-C76503E4-81E4-418E-BAEF-E3B3ECF1CCD9" class="sect4"><span class="enumeration_section">29.1.2</span>确定联机表空间备份的数据文件状态</h4>
                  <div>
                     <div class="section">
                        <p><a id="d135532e484" class="indexterm-anchor"></a><a id="d135532e488" class="indexterm-anchor"></a><a id="d135532e492" class="indexterm-anchor"></a>要检查数据文件是否是当前联机表空间备份的一部分，请查询<a id="d135532e497" class="indexterm-anchor"></a> <code class="codeph">V$BACKUP</code>视图。
                        </p>
                        <p>此视图仅对用户管理的联机表空间备份有用，因为RMAN备份和脱机表空间备份都不要求表空间的数据文件处于<a href="glossary.html#GUID-BD2A12D3-A995-49B8-AE99-B8DDDF4FE7E7"><span class="xrefglossterm">备份模式</span></a> 。某些用户管理的备份过程要求您将表空间置于备份模式，以防止出现断块的可能性。但是，对数据库的更新会在备份模式下创建超过通常的重做次数。
                        </p>
                        <p>数据库打开时， <code class="codeph">V$BACKUP</code>视图最有用。它在实例失败后立即生效，因为它显示失败时文件的备份状态。使用此信息可确定是否已将任何表空间保留在备份模式下。
                        </p>
                        <p>如果当前使用的控制文件是还原备份或在发生介质故障后创建的新控制文件，则<code class="codeph">V$BACKUP</code>无效。还原或重新创建的控制文件不包含数据库准确填充<code class="codeph">V$BACKUP</code>所需的信息。此外，如果您已恢复文件的备份，则此文件在<code class="codeph">V$BACKUP</code>的<code class="codeph">STATUS</code>反映了该文件的旧版本的备份状态，而不是最新版本。因此，此视图可能包含有关已还原文件的误导性数据。
                        </p>
                        <p>例如，以下查询显示当前包含在已置于备份模式的表空间中的数据文件：</p><pre class="oac_no_warn" dir="ltr">SELECT t.name AS“TB_NAME”，d.file＃as“DF＃”，d.name AS“DF_NAME”，b.status FROM V $ DATAFILE d，V $ TABLESPACE t，V $ BACKUP b WHERE d。TS＃= T。TS＃和b。FILE＃= d。文件＃和b。STATUS = 'ACTIVE';</pre><p>以下示例输出显示<code class="codeph">tools</code>和<code class="codeph">users</code>表空间当前具有<code class="codeph">ACTIVE</code>状态：</p><pre class="oac_no_warn" dir="ltr">TB_NAME DF＃DF_NAME状态---------------------- ---------- ------------- ------------------- ------ TOOLS 7 /oracle/oradata/trgt/tools01.dbf活动用户8 /oracle/oradata/trgt/users01.dbf活性</pre><p>在<code class="codeph">STATUS</code>列中， <code class="codeph">NOT</code> <code class="codeph">ACTIVE</code>表示该文件当前未处于备份模式（即，您尚未执行<code class="codeph">ALTER</code> <code class="codeph">TABLESPACE</code> <code class="codeph">...</code> <code class="codeph">BEGIN</code> <code class="codeph">BACKUP</code>或<code class="codeph">ALTER DATABASE BEGIN BACKUP</code>语句），而<code class="codeph">ACTIVE</code>表示该文件当前处于备份模式。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV618"></a><a id="BRADV486"></a><a id="BRADV199"></a><div class="props_rev_3"><a id="GUID-65C5E03A-E906-47EB-92AF-6DC273DBD0A8" name="GUID-65C5E03A-E906-47EB-92AF-6DC273DBD0A8"></a><h3 id="BRADV-GUID-65C5E03A-E906-47EB-92AF-6DC273DBD0A8" class="sect3"><span class="enumeration_section">29.2</span>进行整个数据库的用户管理备份</h3>
               <div>
                  <div class="section">
                     <p>使用<code class="codeph">NORMAL</code> ， <code class="codeph">IMMEDIATE</code>或<code class="codeph">TRANSACTIONAL</code>选项关闭数据库后，可以对数据库中的所有文件进行一致的整数据库备份。<a id="d135532e660" class="indexterm-anchor"></a><a id="d135532e662" class="indexterm-anchor"></a><a id="d135532e666" class="indexterm-anchor"></a><a id="d135532e670" class="indexterm-anchor"></a>数据库打开时或实例失败或<code class="codeph">SHUTDOWN</code> <code class="codeph">ABORT</code>命令不一致时进行的整个数据库备份。在这种情况下，文件与<a href="glossary.html#GUID-60BB5B47-F889-4E54-9368-6AFF572B71B5"><span class="xrefglossterm">数据库检查点</span></a> SCN不一致。</p>
                     <p>您<a id="d135532e688" class="indexterm-anchor"></a><a id="d135532e692" class="indexterm-anchor"></a>如果数据库在<code class="codeph">ARCHIVELOG</code>或<code class="codeph">NOARCHIVELOG</code>模式下运行，则可以进行整个数据库备份。但是，如果以<code class="codeph">NOARCHIVELOG</code>模式运行数据库，则备份必须一致;也就是说，您必须在备份之前干净地关闭数据库。
                     </p>
                     <p><a id="d135532e707" class="indexterm-anchor"></a><a id="d135532e711" class="indexterm-anchor"></a>由一致的整个数据库备份产生的备份文件集是一致的，因为所有文件都被检查点到同一个SCN。您可以还原一致的数据库备份而无需进一步恢复。还原备份文件后，如果数据库在<code class="codeph">ARCHIVELOG</code>模式下运行，则可以执行其他恢复步骤以将数据库恢复到更新的时间。此外，如果数据库处于<code class="codeph">ARCHIVELOG</code>模式，则可以采用不一致的整个数据库备份。
                     </p>
                     <p>控制文件在数据库恢复和恢复中起着至关重要的作用。对于在运行的数据库<code class="codeph">ARCHIVELOG</code>模式下，Oracle建议您备份控制文件与<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">BACKUP</code> <code class="codeph">CONTROLFILE</code> <code class="codeph">TO</code> <code class="codeph">'</code> <span class="italic"><code class="codeph">filename</code></span> <code class="codeph">'</code>的语句。
                     </p>
                     <div class="infoboxnotealso" id="GUID-65C5E03A-E906-47EB-92AF-6DC273DBD0A8__GUID-B7123461-A215-410C-ABC0-1093EE6E6845">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“ <a href="user-managed-database-backups.html#GUID-D8ECFDCB-74ED-4AD4-8032-43D2155AB628">制作用户管理的控制文件备份</a> ”</span> ，以获取有关备份控制文件的更多信息</p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-65C5E03A-E906-47EB-92AF-6DC273DBD0A8__GUID-9E517AC5-BEF0-400E-AD98-4CDE86945316"><span>进行一致的整个数据库备份</span></p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p><a id="d135532e764" class="indexterm-anchor"></a><a id="d135532e768" class="indexterm-anchor"></a><a id="d135532e772" class="indexterm-anchor"></a><a id="d135532e776" class="indexterm-anchor"></a>本节介绍如何使用操作系统实用程序备份数据库。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-65C5E03A-E906-47EB-92AF-6DC273DBD0A8__GUID-9FA76F5B-E59C-4C8D-B2F3-4DE596B793BA"><span>要进行一致的整个数据库备份：</span></p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>如果数据库已打开，则使用SQL * Plus以<code class="codeph">NORMAL</code> ， <code class="codeph">IMMEDIATE</code>或<code class="codeph">TRANSACTIONAL</code>选项关闭数据库。</span></li>
                     <li class="stepexpand"><span>使用操作系统实用程序备份由初始化参数文件的<code class="codeph">CONTROL_FILES</code>参数指定的所有数据文件和所有控制文件。另外，备份初始化参数文件和其他Oracle产品初始化文件。要查找这些文件，请从Oracle主目录开始搜索<code class="codeph">*.ora</code> ，并递归搜索其所有子目录。</span><div>
                           <p>例如，您可以将数据文件，控制文件和存档日志<code class="codeph">/disk2/backup</code>到<code class="codeph">/disk2/backup</code> ，如下所示：</p><pre class="oac_no_warn" dir="ltr">％cp $ ORACLE_HOME / oradata / trgt / * .dbf / disk2 / backup％cp $ ORACLE_HOME / oradata / trgt / arch / * / disk2 / backup / arch</pre></div>
                     </li>
                     <li class="stepexpand"><span>使用SQL * Plus中的<code class="codeph">STARTUP</code>命令重新启动数据库。</span><div>
                           <div class="infoboxnotealso" id="GUID-65C5E03A-E906-47EB-92AF-6DC273DBD0A8__GUID-EEA8C77E-FEF8-4E07-99E6-DE8616A2D4E3">
                              <p class="notep1">也可以看看：</p>
                              <p>有关启动和关闭数据库的详细信息，请参见<a href="../admin/starting-up-and-shutting-down.html#ADMIN004" target="_blank"><span class="italic">“Oracle数据库管理员指南”</span></a></p>
                           </div>
                        </div>
                     </li>
                  </ol>
               </div>
            </div><a id="BRADV652"></a><a id="BRADV653"></a><a id="BRADV651"></a><div class="props_rev_3"><a id="GUID-2E2AF00A-BF0B-497B-8E5F-1DBF2C7FEEA5" name="GUID-2E2AF00A-BF0B-497B-8E5F-1DBF2C7FEEA5"></a><h3 id="BRADV-GUID-2E2AF00A-BF0B-497B-8E5F-1DBF2C7FEEA5" class="sect3"><span class="enumeration_section">29.3进行</span>用户管理的CDB和PDB备份</h3>
               <div>
                  <div class="section">
                     <p>本章中的信息适用于多租户容器数据库（ <a href="glossary.html#GUID-3D253996-C2C0-449A-AFA2-85A9DA323FD3"><span class="xrefglossterm">CDB</span></a> ）和可插拔数据库（ <a href="glossary.html#GUID-993BFB3F-3305-481C-999D-26132095DEC9"><span class="xrefglossterm">PDB</span></a> ），只有轻微的更改，如以下部分所述。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-2E2AF00A-BF0B-497B-8E5F-1DBF2C7FEEA5__GUID-C7F8F969-DB8F-4575-95F7-101C2C0D79AE">为CDB创建一致的整个数据库备份：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ol>
                        <li>
                           <p>打开SQL * Plus。</p>
                        </li>
                        <li>
                           <p>以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>系统特权的用户身份连接到<a href="glossary.html#GUID-EA3DB8F4-F68E-4FC5-A599-32A4886FFF8A"><span class="xrefglossterm">root，</span></a>如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-43239E2D-0AFD-455D-89AB-87EDBC0E497D" title="有几种方法可以将目标连接到根目录。">将目标连接到根目录</a> ”中所述</span> 。
                           </p>
                        </li>
                        <li>
                           <p>如果数据库已打开，则使用SQL * Plus以<code class="codeph">NORMAL</code> ， <code class="codeph">IMMEDIATE</code>或<code class="codeph">TRANSACTIONAL</code>选项关闭数据库。
                           </p>
                        </li>
                        <li>
                           <p>使用操作系统实用程序备份由初始化参数文件的<code class="codeph">CONTROL_FILES</code>参数指定的所有数据文件和所有控制文件。另外，备份初始化参数文件和其他Oracle产品初始化文件。要查找这些文件，请从Oracle主目录开始搜索<code class="codeph">*.ora</code> ，并递归搜索其所有子目录。
                           </p>
                           <p>例如，您可以将数据文件，控制文件和存档日志<code class="codeph">/disk3/backup</code>到<code class="codeph">/disk3/backup</code> ，如下所示：</p><pre class="oac_no_warn" dir="ltr">％cp $ ORACLE_HOME / oradata / cdb1 / *。dbf / disk3 / backup％cp $ ORACLE_HOME / oradata / cdb1 / arch / * / disk3 / backup / arch</pre></li>
                        <li>
                           <p>使用SQL * Plus中的<code class="codeph">STARTUP</code>命令重新启动数据库。
                           </p>
                        </li>
                     </ol>
                     <div class="infoboxnotealso" id="GUID-2E2AF00A-BF0B-497B-8E5F-1DBF2C7FEEA5__GUID-4321F8DA-D8FB-4037-A3E1-8961407E3129">
                        <p class="notep1">也可以看看：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>有关对CDB使用<code class="codeph">ALTER DATABASE</code>命令的更多信息，请<a href="../sqlrf/ALTER-DATABASE.html#SQLRF00802" target="_blank"><span><cite>参见Oracle数据库SQL语言参考</cite></span></a></p>
                           </li>
                           <li>
                              <p>有关启动和关闭数据库的详细信息，请参见<a href="../admin/starting-up-and-shutting-down.html#ADMIN004" target="_blank"><span><cite>“Oracle数据库管理员指南”</cite></span></a></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-2E2AF00A-BF0B-497B-8E5F-1DBF2C7FEEA5__GUID-64D5879A-9736-47C0-986D-41663C6B9957">要对PDB进行一致的备份：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>打开SQL * Plus。</span></li>
                     <li class="stepexpand"><span>以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>系统特权的用户身份连接到PDB，如<span class="q">“ <a href="starting-interacting-with-rman-client.html#GUID-E95C5C27-C036-4773-B77C-E4120526F422" title="您可以从RMAN提示符或操作系统命令行连接到PDB。">将目标连接到PDB</a> ”中所述</span> 。</span></li>
                     <li class="stepexpand"><span>使用SQL <code class="codeph">ALTER DATABASE</code>命令开始备份。</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE BEGIN BACKUP;</pre></div>
                     </li>
                     <li class="stepexpand"><span>使用操作系统实用程序将属于PDB的数据文件复制到备份设备。</span></li>
                     <li class="stepexpand"><span>使用SQL <code class="codeph">ALTER DATABASE</code>命令结束备份。</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE END BACKUP;</pre></div>
                     </li>
                  </ol>
               </div>
            </div><a id="BRADV90001"></a><div class="props_rev_3"><a id="GUID-D1582062-FF0C-462B-8468-4052914FA7B3" name="GUID-D1582062-FF0C-462B-8468-4052914FA7B3"></a><h3 id="BRADV-GUID-D1582062-FF0C-462B-8468-4052914FA7B3" class="sect3"><span class="enumeration_section">29.4进行</span>用户管理的表空间和数据文件备份</h3>
               <div>
                  <p>用于表空间和数据文件的用户管理备份的技术取决于文件是脱机还是联机。</p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="user-managed-database-backups.html#GUID-4D76FC3A-D33D-41A7-90C3-D220F7B0FFA8">进行用户管理的脱机表空间和数据文件备份</a></p>
                     </li>
                     <li>
                        <p><a href="user-managed-database-backups.html#GUID-57387AB6-1204-44F0-826A-F9B638453935">制作用户管理的在线表空间和数据文件备份</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV487"></a><a id="BRADV20033"></a><div class="props_rev_3"><a id="GUID-4D76FC3A-D33D-41A7-90C3-D220F7B0FFA8" name="GUID-4D76FC3A-D33D-41A7-90C3-D220F7B0FFA8"></a><h4 id="BRADV-GUID-4D76FC3A-D33D-41A7-90C3-D220F7B0FFA8" class="sect4"><span class="enumeration_section">29.4.1</span>进行脱机表空间和数据文件的用户管理备份</h4>
                  <div>
                     <div class="section">
                        <p><a id="d135532e1215" class="indexterm-anchor"></a><a id="d135532e1219" class="indexterm-anchor"></a><a id="d135532e1225" class="indexterm-anchor"></a><a id="d135532e1229" class="indexterm-anchor"></a><a id="d135532e1233" class="indexterm-anchor"></a><a id="d135532e1237" class="indexterm-anchor"></a><a id="d135532e1241" class="indexterm-anchor"></a>备份脱机表空间时请注意以下准则：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您不能使<code class="codeph">SYSTEM</code>表空间或具有活动还原段的表空间脱机。以下技术不能用于此类表空间。
                              </p>
                           </li>
                           <li>
                              <p>假设表在表空间<code class="codeph">Primary</code> ，其索引在表空间<code class="codeph">Index</code> 。将表空间<code class="codeph">Index</code>脱机而离开表空间<code class="codeph">Primary</code>联机可能会在针对位于<code class="codeph">Primary</code>节点中的索引表发出数据操作语言（DML）时导致错误。仅当优化程序选择的访问方法必须访问<code class="codeph">Index</code>表空间中的<code class="codeph">Index</code>时，才会出现此问题。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-4D76FC3A-D33D-41A7-90C3-D220F7B0FFA8__GUID-29DC17E4-1000-4D79-94EE-0EBF8ED34469"><span>要备份脱机表空间：</span></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span><a id="d135532e1283" class="indexterm-anchor"></a><a id="d135532e1285" class="indexterm-anchor"></a>在开始备份表空间之前，通过查询<code class="codeph">DBA_DATA_FILES</code>视图来标识表空间的数据文件。例如，假设您要备份<code class="codeph">users</code>表空间。在SQL * Plus中输入以下语句：</span><div><pre class="oac_no_warn" dir="ltr">SELECT TABLESPACE_NAME，FILE_NAME FROM SYS.DBA_DATA_FILES WHERE TABLESPACE_NAME ='USERS'; TABLESPACE_NAME FILE_NAME ------------------------------- ----------------- --------------- USERS /oracle/oradata/trgt/users01.dbf</pre><p>在此示例中，/ <code class="codeph">/oracle/oradata/trgt/users01.dbf</code>是与<code class="codeph">users</code>表空间中的数据文件对应的完全指定的文件名。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>如果可能，请使用普通优先级使表空间脱机，因为它可以保证您可以随后将表空间联机而无需恢复。例如：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER TABLESPACE用户OFFLINE NORMAL;</pre></div>
                        </li>
                        <li class="stepexpand"><span>备份脱机数据文件。例如：</span><div><pre class="oac_no_warn" dir="ltr">％cp /oracle/oradata/trgt/users01.dbf / d2 / users01_'date“+％m_％d_％y”'。dbf</pre></div>
                        </li>
                        <li class="stepexpand"><span>使表空间在线。例如：</span><div><pre class="oac_no_warn" dir="ltr">ALTER TABLESPACE用户在线;</pre><div class="infoboxnote" id="GUID-4D76FC3A-D33D-41A7-90C3-D220F7B0FFA8__GUID-E3F2EDC0-CA83-4AF6-B7FD-0E3C88FCAC53">
                                 <p class="notep1">注意：</p>
                                 <p>如果使用临时或立即优先级使表空间脱机，则除非执行表空间恢复，否则无法使表空间联机。</p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>归档未归档的重做日志，以便归档恢复表空间备份所需的重做。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM ARCHIVE LOG CURRENT;</pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV201"></a><div class="props_rev_3"><a id="GUID-57387AB6-1204-44F0-826A-F9B638453935" name="GUID-57387AB6-1204-44F0-826A-F9B638453935"></a><h4 id="BRADV-GUID-57387AB6-1204-44F0-826A-F9B638453935" class="sect4"><span class="enumeration_section">29.4.2</span>进行在线表空间和数据文件的用户管理备份</h4>
                  <div>
                     <p>在数据库打开时，您可以备份在线表空间的所有或仅特定数据文件。根据联机表空间是读/写还是只读，该过程会有所不同。</p>
                     <div class="infoboxnote" id="GUID-57387AB6-1204-44F0-826A-F9B638453935__GUID-0AD81931-AC0B-41CB-86D0-6B2AB29F73AD">
                        <p class="notep1">注意：</p>
                        <p>不要备份临时表空间。</p>
                     </div>
                     <p>本节包含以下主题：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="user-managed-database-backups.html#GUID-73283C54-4C12-4FDB-9CC5-515BFEB44CE8">进行用户管理的在线读/写表空间备份</a></p>
                        </li>
                        <li>
                           <p><a href="user-managed-database-backups.html#GUID-EDE86BA1-4CF1-454D-8E07-D601BAE1F98E">进行多个用户管理的在线读/写表空间备份</a></p>
                        </li>
                        <li>
                           <p><a href="user-managed-database-backups.html#GUID-8774B936-E0C4-4F1E-9146-2C2E2A20664C">在实例失败或关机中止后结束备份</a></p>
                        </li>
                        <li>
                           <p><a href="user-managed-database-backups.html#GUID-BB096DF9-D46E-4E17-8C76-E7568100611A">使用用户管理的只读表空间备份</a></p>
                        </li>
                     </ul>
                  </div><a id="BRADV488"></a><a id="BRADV90002"></a><div class="props_rev_3"><a id="GUID-73283C54-4C12-4FDB-9CC5-515BFEB44CE8" name="GUID-73283C54-4C12-4FDB-9CC5-515BFEB44CE8"></a><h5 id="BRADV-GUID-73283C54-4C12-4FDB-9CC5-515BFEB44CE8" class="sect5"><span class="enumeration_section">29.4.2.1进行</span>用户管理的在线读/写表空间备份</h5>
                     <div>
                        <div class="section">
                           <p>当表空间处于联机状态且数据库处于打开状态时，必须将读/写表空间置于备份模式以进行用户管理的数据文件备份。<a id="d135532e1504" class="indexterm-anchor"></a><a id="d135532e1508" class="indexterm-anchor"></a> <code class="codeph">ALTER</code> <code class="codeph">TABLESPACE</code> <code class="codeph">...</code> <code class="codeph">BEGIN</code> <code class="codeph">BACKUP</code>语句将表空间置于备份模式。在备份模式下，数据库将整个已更改的数据块复制到重做流中。使用<code class="codeph">ALTER</code> <code class="codeph">TABLESPACE</code>将表空间从备份模式中取出后<code class="codeph">...</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code>或<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code>语句，数据库将<a href="glossary.html#GUID-22212AAE-6F3C-4E84-B940-5AB2261A7EDA"><span class="xrefglossterm">数据文件检查点</span></a> SCN前进到当前<a href="glossary.html#GUID-60BB5B47-F889-4E54-9368-6AFF572B71B5"><span class="xrefglossterm">数据库检查点</span></a> SCN。</p>
                           <p>还原以这种方式备份的数据文件时，如果需要恢复，数据库会要求应用适当的重做日志文件集。重做日志包含恢复数据文件并使其保持一致所需的所有更改。</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-73283C54-4C12-4FDB-9CC5-515BFEB44CE8__GUID-07F1FA63-8812-4529-82BF-A838C39C2340"><span>要在打开的数据库中备份在线读/写表空间：</span></p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span><a id="d135532e1574" class="indexterm-anchor"></a><a id="d135532e1580" class="indexterm-anchor"></a><a id="d135532e1582" class="indexterm-anchor"></a>在开始备份表空间之前，请使用<code class="codeph">DBA_DATA_FILES</code>数据字典视图来标识表空间中的所有数据文件。例如，假设您要备份<code class="codeph">users</code>表空间。输入以下内容：</span><div><pre class="oac_no_warn" dir="ltr">SELECT TABLESPACE_NAME，FILE_NAME FROM SYS.DBA_DATA_FILES WHERE TABLESPACE_NAME ='USERS'; TABLESPACE_NAME FILE_NAME ------------------------------- ----------------- --- USERS /oracle/oradata/trgt/users01.dbf USERS /oracle/oradata/trgt/users02.dbf</pre></div>
                           </li>
                           <li class="stepexpand"><span>标记在线表空间备份的开头。例如，以下语句标记表空间<code class="codeph">users</code>的联机备份的开始：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER TABLESPACE用户BEGIN BACKUP;</pre><div class="infoboxnote" id="GUID-73283C54-4C12-4FDB-9CC5-515BFEB44CE8__GUID-FA726CAF-8CC2-4BEB-8205-E5AD8ED76091">
                                    <p class="notep1">警告：</p>
                                    <p><a id="d135532e1605" class="indexterm-anchor"></a><a id="d135532e1609" class="indexterm-anchor"></a>如果不使用<code class="codeph">BEGIN</code> <code class="codeph">BACKUP</code>标记联机表空间备份的开头并等待此语句在启动联机表空间副本之前完成，则生成的数据文件副本不可用于后续恢复操作。尝试恢复此类备份存在风险，并且可能返回导致数据不一致的错误。例如，尝试的恢复操作可能会发出<a href="glossary.html#GUID-B0F459C6-F2F5-48AD-97D3-B84C875FF723"><span class="xrefglossterm">模糊文件</span></a>警告，并可能导致无法打开的数据库不一致。
                                    </p>
                                 </div>
                              </div>
                           </li>
                           <li class="stepexpand"><span>使用操作系统命令备份联机表空间的联机数据文件。例如，Linux和UNIX用户可能会输入：</span><div><pre class="oac_no_warn" dir="ltr">％cp /oracle/oradata/trgt/users01.dbf / d2 / users01_'date“+％m_％d_％y”'。dbf％cp /oracle/oradata/trgt/users02.dbf / d2 / users02_'date“+ ％M_％D_％Y“”。DBF</pre></div>
                           </li>
                           <li class="stepexpand"><span>备份联机表空间的数据文件后，使用<code class="codeph">END</code> <code class="codeph">BACKUP</code>选项运行SQL语句<code class="codeph">ALTER</code> <code class="codeph">TABLESPACE</code> 。例如，以下语句结束表空间<code class="codeph">users</code>的在线备份：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER TABLESPACE用户END BACKUP;</pre></div>
                           </li>
                           <li class="stepexpand"><span>归档未归档的重做日志，以便归档恢复表空间备份所需的重做。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER SYSTEM ARCHIVE LOG CURRENT;</pre><div class="infoboxnote" id="GUID-73283C54-4C12-4FDB-9CC5-515BFEB44CE8__GUID-3B076AF3-56C5-415B-A11B-67339E359ECC">
                                    <p class="notep1">警告：</p>
                                    <p><a id="d135532e1659" class="indexterm-anchor"></a>如果您未能将表空间从备份模式中删除，则Oracle数据库会继续将此表空间中的数据块副本写入联机重做日志，从而导致性能问题。此外，如果您尝试在表空间仍处于备份模式的情况下关闭数据库，则会收到<code class="codeph">ORA-01149</code>错误。
                                    </p>
                                 </div>
                              </div>
                           </li>
                        </ol>
                     </div>
                  </div><a id="BRADV90003"></a><div class="props_rev_3"><a id="GUID-EDE86BA1-4CF1-454D-8E07-D601BAE1F98E" name="GUID-EDE86BA1-4CF1-454D-8E07-D601BAE1F98E"></a><h5 id="BRADV-GUID-EDE86BA1-4CF1-454D-8E07-D601BAE1F98E" class="sect5"><span class="enumeration_section">29.4.2.2进行</span>多个用户管理的在线读/写表空间备份</h5>
                     <div>
                        <p>备份多个在线表空间时，可以串行或并行备份它们。根据您的需要，使用以下任一过程：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="user-managed-database-backups.html#GUID-9E89C219-D109-4435-BDE3-402C345F84C2">并行备份在线表空间</a></p>
                           </li>
                           <li>
                              <p><a href="user-managed-database-backups.html#GUID-CBD6C49F-A1B2-4FF2-B7DD-66C94240BE2D">备份在线表空间</a></p>
                           </li>
                        </ul>
                     </div><a id="BRADV489"></a><a id="BRADV90004"></a><div class="props_rev_3"><a id="GUID-9E89C219-D109-4435-BDE3-402C345F84C2" name="GUID-9E89C219-D109-4435-BDE3-402C345F84C2"></a><h6 id="BRADV-GUID-9E89C219-D109-4435-BDE3-402C345F84C2" class="sect6"><span class="enumeration_section">29.4.2.2.1</span>并行备份在线表空间</h6>
                        <div>
                           <div class="section">
                              <p>您可以同时创建需要在备份模式下进行备份的多个表空间的数据文件副本。但请注意，通过将所有表空间放在联机模式中，如果受影响的表空间上存在大量更新活动，则可以生成大型重做日志，因为重做必须包含每个已更改数据文件中每个已更改数据块的副本。在使用此处概述的过程之前，请务必考虑可能重做的大小。</p>
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3" id="GUID-9E89C219-D109-4435-BDE3-402C345F84C2__GUID-A7C20C55-A00F-4402-B23E-4EE25AC2A810">要并行备份联机表空间：</p>
                           </div>
                           <!-- class="section" -->
                           <ol>
                              <li class="stepexpand"><span>通过一起发出所有必需的<code class="codeph">ALTER</code> <code class="codeph">TABLESPACE</code>语句来准备联机表空间以进行备份。例如，将表空间<code class="codeph">users</code> ， <code class="codeph">tools</code>和<code class="codeph">indx</code>置于备份模式，如下所示：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER TABLESPACE用户BEGIN BACKUP; SQL&gt; ALTER TABLESPACE工具BEGIN BACKUP; SQL&gt; ALTER TABLESPACE indx BEGIN BACKUP;</pre><p>如果要备份所有表空间，可以使用以下命令：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE BEGIN BACKUP;</pre></div>
                              </li>
                              <li class="stepexpand"><span>备份联机表空间的所有文件。例如，Linux或UNIX用户可能使用<code class="codeph">*.dbf</code>后缀备份数据文件，如下所示：</span><div><pre class="oac_no_warn" dir="ltr">％cp $ ORACLE_HOME / oradata / trgt / *。dbf / disk2 / backup /</pre></div>
                              </li>
                              <li class="stepexpand"><span>将表空间从备份模式中取出，如以下示例所示：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER TABLESPACE用户END BACKUP; SQL&gt; ALTER TABLESPACE工具END BACKUP; SQL&gt; ALTER TABLESPACE indx END BACKUP;</pre><p>同样，如果要同时处理所有数据文件，则可以使用<code class="codeph">ALTER DATABASE</code>命令而不是<code class="codeph">ALTER TABLESPACE</code> ：</p><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE END BACKUP;</pre></div>
                              </li>
                              <li class="stepexpand"><span>归档联机重做日志，以便恢复表空间备份所需的重做可用于以后的介质恢复。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER SYSTEM ARCHIVE LOG CURRENT;</pre></div>
                              </li>
                           </ol>
                        </div>
                     </div><a id="BRADV490"></a><a id="BRADV90005"></a><div class="props_rev_3"><a id="GUID-CBD6C49F-A1B2-4FF2-B7DD-66C94240BE2D" name="GUID-CBD6C49F-A1B2-4FF2-B7DD-66C94240BE2D"></a><h6 id="BRADV-GUID-CBD6C49F-A1B2-4FF2-B7DD-66C94240BE2D" class="sect6"><span class="enumeration_section">29.4.2.2.2</span>备份在线表空间</h6>
                        <div>
                           <div class="section">
                              <p>您可以将所有需要联机备份的表空间放在备份模式中，一次一个。<a id="d135532e1978" class="indexterm-anchor"></a><a id="d135532e1982" class="indexterm-anchor"></a> Oracle建议使用串行备份选项，因为它可以最小化<code class="codeph">ALTER</code> <code class="codeph">TABLESPACE</code>之间的时间<code class="codeph">...</code> <code class="codeph">BEGIN/END</code> <code class="codeph">BACKUP</code>语句。在线备份期间，会为表空间生成更多重做信息，因为整个数据块都会复制到重做日志中。
                              </p>
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3" id="GUID-CBD6C49F-A1B2-4FF2-B7DD-66C94240BE2D__GUID-0C537686-A287-4C16-A9B8-F017F4F5CE05">要连续备份在线表空间：</p>
                           </div>
                           <!-- class="section" -->
                           <ol>
                              <li class="stepexpand"><span>准备用于在线备份的表空间。例如，要将表空间<code class="codeph">users</code>置于备份模式，请输入以下内容：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER TABLESPACE用户BEGIN BACKUP;</pre><p>在这种情况下，您可能不希望使用<code class="codeph">ALTER DATABASE BEGIN BACKUP</code>将所有表空间同时置于备份模式，因为在线模式下为表空间生成了不必要的重做日志信息量。
                                    </p>
                                 </div>
                              </li>
                              <li class="stepexpand"><span>备份表空间中的数据文件。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">％cp /oracle/oradata/trgt/users01.dbf / d2 / users01_'date“+％m_％d_％y”'。dbf</pre></div>
                              </li>
                              <li class="stepexpand"><span>使表空间退出备份模式。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER TABLESPACE用户END BACKUP;</pre></div>
                              </li>
                              <li class="stepexpand"><span>对每个剩余的表空间重复此过程。</span></li>
                              <li class="stepexpand"><span>归档未归档的重做日志，以便归档恢复表空间备份所需的重做。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER SYSTEM ARCHIVE LOG CURRENT;</pre></div>
                              </li>
                           </ol>
                        </div>
                     </div>
                  </div><a id="BRADV90006"></a><div class="props_rev_3"><a id="GUID-8774B936-E0C4-4F1E-9146-2C2E2A20664C" name="GUID-8774B936-E0C4-4F1E-9146-2C2E2A20664C"></a><h5 id="BRADV-GUID-8774B936-E0C4-4F1E-9146-2C2E2A20664C" class="sect5"><span class="enumeration_section">29.4.2.3</span>在实例失败或关机<span class="enumeration_section">中止后</span>结束备份</h5>
                     <div>
                        <div class="section">
                           <p><a id="d135532e2115" class="indexterm-anchor"></a><a id="d135532e2119" class="indexterm-anchor"></a><a id="d135532e2123" class="indexterm-anchor"></a><a id="d135532e2127" class="indexterm-anchor"></a>以下情况可能导致表空间备份失败并且不完整：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>备份完成，但你没有运行<code class="codeph">ALTER</code> <code class="codeph">TABLESPACE</code> <code class="codeph">...</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code>声明。
                                 </p>
                              </li>
                              <li>
                                 <p>实例故障或<code class="codeph">SHUTDOWN</code> <code class="codeph">ABORT</code>中断备份。
                                 </p>
                              </li>
                           </ul>
                           <p>每当需要从故障中恢复时，如果数据文件在尝试打开时处于备份模式，则数据库不会打开数据文件，直到发出恢复命令或数据文件被取出为止。备份模式。</p>
                           <p>例如，数据库可能会在启动时显示以下消息：</p><pre class="oac_no_warn" dir="ltr">ORA-01113：文件12需要介质恢复ORA-01110：数据文件12：'/ oracle / dbs / tbs_41.f'</pre><p>如果数据库指示多个表空间的数据文件需要介质恢复，因为您忘记结束这些表空间的联机备份，则只要安装了数据库，运行<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code>语句就会将所有数据文件从备份中删除同时模式。
                           </p>
                           <p>在高可用性情况下，以及在没有数据库管理员（DBA）监视数据库的情况下，用户干预的要求是不可容忍的。因此，您可以编写执行以下操作的故障恢复脚本：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li><span>安装数据库</span></li>
                           <li><span>运行<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code>语句</span></li>
                           <li><span>运行<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">OPEN</code> ，使系统自动启动</span></li>
                        </ol>
                        <div class="section">
                           <p>包含<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code>的自动崩溃恢复脚本在以下情况下特别有用：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>Oracle Real Application Clusters（Oracle RAC）配置中的所有节点都将失败。</p>
                              </li>
                              <li>
                                 <p>一个节点在a中失败<a id="d135532e2236" class="indexterm-anchor"></a> <strong class="term">冷故障转移群集</strong> （即， <span class="italic">不是</span> Oracle RAC配置的群集，其中辅助节点必须在第一个节点发生故障时装入并恢复数据库）。
                                 </p>
                              </li>
                           </ul>
                           <p>或者，您可以在系统因备份模式下的表空间失败后采取以下手动措施：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>恢复数据库并避免完全发出<code class="codeph">END</code> <code class="codeph">BACKUP</code>语句。
                                 </p>
                              </li>
                              <li>
                                 <p>挂载数据库，然后运行<code class="codeph">ALTER</code> <code class="codeph">TABLESPACE</code> <code class="codeph">...</code> 每个表空间的<code class="codeph">END</code> <code class="codeph">BACKUP</code>语句仍处于备份模式。
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                     </div><a id="BRADV491"></a><a id="BRADV90007"></a><div class="props_rev_3"><a id="GUID-DCA7816F-F4F5-4FFD-B5BC-F26955AF8888" name="GUID-DCA7816F-F4F5-4FFD-B5BC-F26955AF8888"></a><h6 id="BRADV-GUID-DCA7816F-F4F5-4FFD-B5BC-F26955AF8888" class="sect6"><span class="enumeration_section">29.4.2.3.1</span>使用ALTER DATABASE END BACKUP语句结束备份模式</h6>
                        <div>
                           <div class="section">
                              <p><a id="d135532e2349" class="indexterm-anchor"></a><a id="d135532e2353" class="indexterm-anchor"></a><a id="d135532e2357" class="indexterm-anchor"></a><a id="d135532e2361" class="indexterm-anchor"></a>当多个表空间仍处于备份模式时，可以运行<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code>语句。此命令的主要目的是允许崩溃恢复脚本在没有DBA干预的情况下重新启动故障系统。您也可以手动执行以下步骤。
                              </p>
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3" id="GUID-DCA7816F-F4F5-4FFD-B5BC-F26955AF8888__GUID-C191A926-D210-4DDF-9095-9E18B13C5E0A">要使表空间同时退出备份模式：</p>
                           </div>
                           <!-- class="section" -->
                           <ol>
                              <li class="stepexpand"><span>挂载但不要打开数据库。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; STARTUP MOUNT</pre></div>
                              </li>
                              <li class="stepexpand"><span>如果您手动执行此过程（即，不是故障恢复脚本的一部分），请查询<code class="codeph">V$BACKUP</code>视图以列出在重新启动数据库之前正在备份的表空间的数据文件：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT * FROM V $ BACKUP WHERE STATUS ='ACTIVE';文件#STATUS CHANGE #TIME CON_ID ---------- ------------------ ---------- ----- ---- ------- 12 ACTIVE 20863 25-NOV-02 0 13 ACTIVE 20863 25-NOV-02 0 20 ACTIVE 20863 25-NOV-02 0 3行选择。
</pre></div>
                              </li>
                              <li class="stepexpand"><span>发出<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code>语句，使当前处于备份模式的所有数据文件退出备份模式。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER DATABASE END BACKUP;</pre><p>只有在装入但未打开数据库时才能使用此语句。如果数据库已打开，则使用<code class="codeph">ALTER</code> <code class="codeph">TABLESPACE</code> <code class="codeph">...</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code>或<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">DATAFILE</code> <code class="codeph">...</code> 每个受影响的表空间或数据文件的<code class="codeph">END</code> <code class="codeph">BACKUP</code> 。
                                    </p>
                                    <div class="infoboxnote" id="GUID-DCA7816F-F4F5-4FFD-B5BC-F26955AF8888__GUID-061EE957-EEC0-40B8-B7F5-65D6C0C56D15">
                                       <p class="notep1">警告：</p>
                                       <p>如果已从备份还原任何受影响的文件，请不要使用<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code> 。
                                       </p>
                                    </div>
                                 </div>
                              </li>
                           </ol>
                        </div>
                     </div><a id="BRADV492"></a><a id="BRADV90008"></a><div class="props_rev_3"><a id="GUID-D714477F-3A6E-4F66-A7E8-CC29244972FA" name="GUID-D714477F-3A6E-4F66-A7E8-CC29244972FA"></a><h6 id="BRADV-GUID-D714477F-3A6E-4F66-A7E8-CC29244972FA" class="sect6"><span class="enumeration_section">29.4.2.3.2</span>使用SQL * Plus RECOVER命令结束备份模式</h6>
                        <div>
                           <div class="section">
                              <p><code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code>语句不是响应失败的在线备份的唯一方法;您还可以运行SQL * Plus <code class="codeph">RECOVER</code>命令。当您不确定某人是否已恢复备份时，此方法很有用，因为如果某人确实已恢复备份，则<code class="codeph">RECOVER</code>命令会使备份保持最新状态。只运行<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code>或<code class="codeph">ALTER</code> <code class="codeph">TABLESPACE</code> <code class="codeph">...</code> <code class="codeph">END</code> <code class="codeph">BACKUP</code>语句，如果您确定文件是最新的。
                              </p>
                              <div class="infoboxnote" id="GUID-D714477F-3A6E-4F66-A7E8-CC29244972FA__GUID-2C8AD5E2-8958-4CC3-B6E2-0F72B9ECD5EE">
                                 <p class="notep1">注意：</p>
                                 <p><code class="codeph">RECOVER</code>命令方法很慢，因为数据库必须扫描从联机备份开始生成的重做。
                                 </p>
                              </div>
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3" id="GUID-D714477F-3A6E-4F66-A7E8-CC29244972FA__GUID-FF496E32-878E-4B53-9988-630B67E10EE6">使用RECOVER命令将表空间从备份模式中取出：</p>
                           </div>
                           <!-- class="section" -->
                           <ol>
                              <li class="stepexpand"><span>装入数据库。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; STARTUP MOUNT</pre></div>
                              </li>
                              <li class="stepexpand"><span>像往常一样恢复数据库。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; RECOVER DATABASE</pre></div>
                              </li>
                              <li class="stepexpand"><span>使用<code class="codeph">V$BACKUP</code>视图确认没有活动数据文件：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT * FROM V $ BACKUP WHERE STATUS ='ACTIVE';没有选择任何行。
</pre></div>
                              </li>
                           </ol>
                           <div class="section">
                              <div class="infoboxnotealso" id="GUID-D714477F-3A6E-4F66-A7E8-CC29244972FA__GUID-268E9F58-E2BD-4F28-BCA7-559EFA3D285E">
                                 <p class="notep1">也可以看看：</p>
                                 <p>有关恢复数据库的信息，请<a href="user-managed-flashback-dbpitr.html#GUID-704F6AB0-04C4-4345-913B-B316DD06D05E" title="您可以使用SQL * Plus在非CDB，多租户容器数据库（CDB）和可插拔数据库（PDB）上执行闪回数据库操作。Oracle闪回数据库将整个数据库或整个PDB返回到先前的状态，而无需从备份中还原文件。SQL * Plus FLASHBACK DATABASE命令执行与RMAN FLASHBACK DATABASE命令相同的功能：它将数据库返回到先前状态。使用SQL * Plus FLASHBACK DATABASE命令将整个多租户容器数据库（CDB）返回到先前状态。SQL * Plus FLASHBACK DATABASE命令执行与RMAN FLASHBACK DATABASE命令相同的功能。使用SQL * Plus FLASHBACK DATABASE命令将特定可插拔数据库（PDB）返回到先前状态。多租户容器数据库（CDB）中的其余PDB不受单个PDB上的闪回操作的影响。当归档重做日志文件存在于默认位置时，无需其他设置即可执行恢复。要在归档重做日志文件存储在非缺省位置时执行介质恢复，必须指定归档重做日志文件的位置。通常，当介质故障导致一个或多个数据文件不可访问时，您将执行数据库的完全恢复。在完整数据库恢复期间，您使用所有可用的重做将数据库恢复到当前SCN。在数据库未打开时执行完全恢复时，您可以在一次操作中恢复所有损坏的数据文件，或者在单独的操作中执行每个损坏的数据文件的单独恢复。在数据库打开时，您可以在数据库中执行非SYSTEM数据文件的完全恢复。Oracle数据库为整个多租户容器数据库（CDB）执行崩溃和实例恢复。您无法恢复单个可插拔数据库（PDB）。不完全恢复也称为数据库时间点恢复。在基于取消的恢复中，通过提示您使用归档重做日志文件的建议文件名来进行恢复。指定CANCEL而不是文件名或将所有重做应用于数据文件时，恢复将停止。您可以为不完全恢复的终点指定SCN或时间。">执行用户管理的数据库闪回和恢复</a></p>
                              </div>
                           </div>
                           <!-- class="section" -->
                        </div>
                     </div>
                  </div><a id="BRADV493"></a><a id="BRADV90009"></a><div class="props_rev_3"><a id="GUID-BB096DF9-D46E-4E17-8C76-E7568100611A" name="GUID-BB096DF9-D46E-4E17-8C76-E7568100611A"></a><h5 id="BRADV-GUID-BB096DF9-D46E-4E17-8C76-E7568100611A" class="sect5"><span class="enumeration_section">29.4.2.4</span>进行只读表空间的用户管理备份</h5>
                     <div>
                        <div class="section">
                           <p><a id="d135532e2733" class="indexterm-anchor"></a><a id="d135532e2737" class="indexterm-anchor"></a><a id="d135532e2741" class="indexterm-anchor"></a>备份在线只读表空间时，您只需备份在线数据文件即可。您不必将表空间置于备份模式，因为数据库不允许更改数据文件。
                           </p>
                           <p>如果只读表空间集是自包含的，那么除了使用操作系统命令备份表空间外，还可以使用可传输表空间功能导出表空间元数据。如果发生介质错误或用户错误（例如意外删除只读表空间中的表），则可以将表空间传输回数据库。</p>
                           <div class="infoboxnotealso" id="GUID-BB096DF9-D46E-4E17-8C76-E7568100611A__GUID-E0E40A8D-CC58-442A-9A2D-FAF05E3EF0AF">
                              <p class="notep1">也可以看看：</p>
                              <p><a href="../admin/transporting-data.html#ADMIN11394" target="_blank"><span class="italic">Oracle数据库管理员指南</span></a> ，了解如何传输表空间</p>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <p class="subhead3" id="GUID-BB096DF9-D46E-4E17-8C76-E7568100611A__GUID-132651E8-0F17-412D-B2EC-7910D2DDE29C">要在打开的数据库中备份联机只读表空间，请执行以下操作：</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span><a id="d135532e2761" class="indexterm-anchor"></a><a id="d135532e2767" class="indexterm-anchor"></a><a id="d135532e2769" class="indexterm-anchor"></a>查询<code class="codeph">DBA_TABLESPACES</code>视图以确定哪些表空间是只读的。例如，运行此查询：</span><div><pre class="oac_no_warn" dir="ltr">SELECT TABLESPACE_NAME，来自DBA_TABLESPACES的状态，其中STATUS ='READ ONLY';</pre></div>
                           </li>
                           <li class="stepexpand"><span>在开始备份只读表空间之前，通过查询<code class="codeph">DBA_DATA_FILES</code>数据字典视图来标识所有表空间的数据文件。例如，假设您要备份<code class="codeph">history</code>表空间：</span><div><pre class="oac_no_warn" dir="ltr">SELECT TABLESPACE_NAME，FILE_NAME FROM SYS.DBA_DATA_FILES WHERE TABLESPACE_NAME ='HISTORY'; TABLESPACE_NAME FILE_NAME ------------------------------- ----------------- ---历史/oracle/oradata/trgt/history01.dbf历史/oracle/oradata/trgt/history02.dbf</pre></div>
                           </li>
                           <li class="stepexpand"><span>使用操作系统命令备份只读表空间的联机数据文件。您不必使表空间脱机或将表空间置于备份模式，因为会自动阻止用户更改只读表空间。例如：</span><div><pre class="oac_no_warn" dir="ltr">％cp $ ORACLE_HOME / oradata / trgt / history * .dbf / disk2 / backup /</pre><div class="infoboxnote" id="GUID-BB096DF9-D46E-4E17-8C76-E7568100611A__GUID-515C6BD6-5F52-4C06-BB73-CE1FA9765712">
                                    <p class="notep1">注意：</p>
                                    <p>还原只读表空间的备份时，请使表空间脱机，还原数据文件，然后使表空间联机。如果在备份后对只读表空间进行读/写，则仍然可以使用只读表空间的备份，但还原的备份需要恢复。</p>
                                 </div>
                              </div>
                           </li>
                           <li class="stepexpand"><span>（可选）在只读表空间中导出元数据。通过使用可传输表空间功能，您可以快速还原数据文件并在媒体发生故障或用户错误时导入元数据。例如，导出表空间<code class="codeph">history</code>的元数据，如下所示：</span><div><pre class="oac_no_warn" dir="ltr">％expdp DIRECTORY = dpump_dir1 DUMPFILE = hs.dmp TRANSPORT_TABLESPACES = history LOGFILE = tts.log</pre><div class="infoboxnotealso" id="GUID-BB096DF9-D46E-4E17-8C76-E7568100611A__GUID-2F7FCA03-95D3-4112-94B6-576CB9556695">
                                    <p class="notep1">也可以看看：</p>
                                    <p><a href="../refrn/about-static-data-dictionary-views.html#REFRN002" target="_blank"><span class="italic">Oracle数据库参考</span></a>有关更多信息<code class="codeph">DBA_DATA_FILES</code>和<code class="codeph">DBA_TABLESPACES</code>意见</p>
                                 </div>
                              </div>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div>
            </div><a id="BRADV787"></a><div class="props_rev_3"><a id="GUID-B4948C50-74CA-40DE-9CD8-11455F14B6AD" name="GUID-B4948C50-74CA-40DE-9CD8-11455F14B6AD"></a><h3 id="BRADV-GUID-B4948C50-74CA-40DE-9CD8-11455F14B6AD" class="sect3"><span class="enumeration_section">29.5</span>在CDB中进行用户管理的表空间备份</h3>
               <div>
                  <p><span class="q">“ <a href="user-managed-database-backups.html#GUID-D1582062-FF0C-462B-8468-4052914FA7B3">使用户管理的表空间和数据文件备份</a> ”</span>部分中的过程适用于CDB和PDB，并具有以下各节中描述的修改：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="user-managed-database-backups.html#GUID-27A2F8B6-D860-4DCE-AA4D-61903C8E4350">在CDB中进行用户管理的脱机表空间和数据文件备份</a></p>
                     </li>
                     <li>
                        <p><a href="user-managed-database-backups.html#GUID-9F30E7C8-16EE-4CAC-AB8A-90400A5FA22A">在CDB和PDB中进行用户管理的联机表空间备份</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV789"></a><a id="BRADV790"></a><a id="BRADV788"></a><div class="props_rev_3"><a id="GUID-27A2F8B6-D860-4DCE-AA4D-61903C8E4350" name="GUID-27A2F8B6-D860-4DCE-AA4D-61903C8E4350"></a><h4 id="BRADV-GUID-27A2F8B6-D860-4DCE-AA4D-61903C8E4350" class="sect4"><span class="enumeration_section">29.5.1</span>在CDB中进行用户管理的脱机表空间和数据文件备份</h4>
                  <div>
                     <div class="section">
                        <p><span class="q">“ <a href="user-managed-database-backups.html#GUID-4D76FC3A-D33D-41A7-90C3-D220F7B0FFA8">使用户管理的脱机表空间和数据文件备份</a> ”中</span>描述的准则也适用于CDB和PDB中的表空间和数据文件。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-27A2F8B6-D860-4DCE-AA4D-61903C8E4350__GUID-ED0ECF94-0CDF-4AF6-89B6-28F8624BA462">要在多租户环境中备份脱机表空间，请执行以下操作：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>打开SQL * Plus。</span></li>
                        <li class="stepexpand"><span>执行以下操作之一：</span><div>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>要备份根中的脱机表空间，请以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>系统特权的公共用户身份连接到根。
                                    </p>
                                 </li>
                                 <li>
                                    <p>要备份PDB中的脱机表空间，请以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>系统特权的公共用户或本地用户身份连接到PDB。
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>在开始备份表空间之前，通过查询<code class="codeph">DBA_DATA_FILES</code>视图来标识表空间的数据文件。例如，假设您要备份<code class="codeph">users</code>表空间。在SQL * Plus中输入以下语句：</span><div><pre class="oac_no_warn" dir="ltr">SELECT TABLESPACE_NAME，FILE_NAME FROM SYS.DBA_DATA_FILES WHERE TABLESPACE_NAME ='USERS'; TABLESPACE_NAME FILE_NAME ------------------------------- ----------------- --------------- USERS /oracle/oradata/trgt/users01.dbf</pre><p>在此示例中，/ <code class="codeph">/oracle/oradata/trgt/users01.dbf</code>是与<code class="codeph">users</code>表空间中的数据文件对应的完全指定的文件名。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>如果可能，请使用普通优先级使表空间脱机，因为它可以保证您可以随后将表空间联机而无需恢复。例如：</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER TABLESPACE用户OFFLINE NORMAL;</pre></div>
                        </li>
                        <li class="stepexpand"><span>备份脱机数据文件。例如：</span><div><pre class="oac_no_warn" dir="ltr">％cp /oracle/oradata/trgt/users01.dbf / d2 / users01_'date“+％m_％d_％y”'。dbf</pre></div>
                        </li>
                        <li class="stepexpand"><span>使表空间在线。例如：</span><div><pre class="oac_no_warn" dir="ltr">ALTER TABLESPACE用户在线;</pre><div class="infoboxnote" id="GUID-27A2F8B6-D860-4DCE-AA4D-61903C8E4350__GUID-CAC6FB25-7830-4468-822A-2A4B86FD0B88">
                                 <p class="notep1">注意：</p>
                                 <p>如果使用临时或立即优先级使表空间脱机，则除非执行表空间恢复，否则无法使表空间联机。</p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>归档未归档的重做日志，以便归档恢复表空间备份所需的重做。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM ARCHIVE LOG CURRENT;</pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV792"></a><a id="BRADV793"></a><a id="BRADV791"></a><div class="props_rev_3"><a id="GUID-9F30E7C8-16EE-4CAC-AB8A-90400A5FA22A" name="GUID-9F30E7C8-16EE-4CAC-AB8A-90400A5FA22A"></a><h4 id="BRADV-GUID-9F30E7C8-16EE-4CAC-AB8A-90400A5FA22A" class="sect4"><span class="enumeration_section">29.5.2</span>在CDB和PDB中进行用户管理的联机表空间备份</h4>
                  <div>
                     <div class="section">
                        <p><span class="q">“ <a href="user-managed-database-backups.html#GUID-57387AB6-1204-44F0-826A-F9B638453935">制作用户管理的在线表空间和数据文件备份</a> ”中</span>描述的准则也适用于CDB和PDB中的表空间和数据文件。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-9F30E7C8-16EE-4CAC-AB8A-90400A5FA22A__GUID-B083DC88-7CB3-4643-BCF2-5ACC28E74DA2">要备份根容器中的联机表空间：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ol>
                           <li>
                              <p>打开SQL * Plus。</p>
                           </li>
                           <li>
                              <p>以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>系统特权的用户身份连接到root。
                              </p>
                           </li>
                           <li>
                              <p>按照<span class="q">“进行<a href="user-managed-database-backups.html#GUID-57387AB6-1204-44F0-826A-F9B638453935">用户管理的联机表空间和数据文件备份</a> ”中</span>的说明进行操作。
                              </p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-9F30E7C8-16EE-4CAC-AB8A-90400A5FA22A__GUID-6AD31DD5-BA1A-4565-BB9C-F0B383EEF1C2">要备份PDB中的联机表空间：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li><span>打开SQL * Plus。</span></li>
                        <li><span>以具有<code class="codeph">SYSDBA</code>或<code class="codeph">SYSBACKUP</code>系统特权的用户身份连接到PDB。</span></li>
                        <li><span>按照<span class="q">“进行<a href="user-managed-database-backups.html#GUID-57387AB6-1204-44F0-826A-F9B638453935">用户管理的联机表空间和数据文件备份</a> ”中</span>的说明进行操作。</span></li>
                     </ol>
                  </div>
               </div>
            </div><a id="BRADV202"></a><div class="props_rev_3"><a id="GUID-D8ECFDCB-74ED-4AD4-8032-43D2155AB628" name="GUID-D8ECFDCB-74ED-4AD4-8032-43D2155AB628"></a><h3 id="BRADV-GUID-D8ECFDCB-74ED-4AD4-8032-43D2155AB628" class="sect3"><span class="enumeration_section">29.6进行</span>用户管理的控制文件备份</h3>
               <div>
                  <p>在对以<code class="codeph">ARCHIVELOG</code>模式运行的数据库进行结构修改后，B启动数据库的控制文件。要备份数据库的控制文件，您必须具有<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code>系统特权。
                  </p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="user-managed-database-backups.html#GUID-EC6BD785-0E3B-4EBD-B2A4-9398A781D4CC">将控制文件备份到二进制文件</a></p>
                     </li>
                     <li>
                        <p><a href="user-managed-database-backups.html#GUID-BB09FC55-6D5A-4B8E-BA6A-65F4B28759FD">将控制文件备份到跟踪文件</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV494"></a><a id="BRADV90010"></a><div class="props_rev_3"><a id="GUID-EC6BD785-0E3B-4EBD-B2A4-9398A781D4CC" name="GUID-EC6BD785-0E3B-4EBD-B2A4-9398A781D4CC"></a><h4 id="BRADV-GUID-EC6BD785-0E3B-4EBD-B2A4-9398A781D4CC" class="sect4"><span class="enumeration_section">29.6.1</span>将控制文件备份到二进制文件</h4>
                  <div>
                     <div class="section">
                        <p><a id="d135532e3405" class="indexterm-anchor"></a><a id="d135532e3411" class="indexterm-anchor"></a>备份控制文件的主要方法是使用SQL语句生成二进制文件。二进制备份比跟踪文件备份更可取，因为它包含其他信息，如存档日志历史记录，只读和脱机表空间的脱机范围，以及备份集和副本（如果使用RMAN）。如果<code class="codeph">COMPATIBLE</code>为10.2或更高，则二进制控制文件备份包括临时文件条目。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-EC6BD785-0E3B-4EBD-B2A4-9398A781D4CC__GUID-939DF9D8-7C81-45BB-92C8-24991D15AFD5">要在结构更改后备份控制文件：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>对数据库进行所需的更改。例如，您可以创建一个表空间：</span><div><pre class="oac_no_warn" dir="ltr">CREATE TABLESPACE tbs_1 DATAFILE'file_1.f'SIZE 10M;</pre></div>
                        </li>
                        <li class="stepexpand"><span>备份数据库的控制文件，指定输出二进制文件的文件名。以下示例将控制文件备份到<code class="codeph">/disk1/backup/cf.bak</code> ：</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE BACKUP CONTROLFILE to'/disk1/backup/cf.bak'REUSE;</pre><p>指定<code class="codeph">REUSE</code>以使新控制文件覆盖当前存在的控制文件。
                              </p>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div><a id="BRADV495"></a><a id="BRADV90011"></a><div class="props_rev_3"><a id="GUID-BB09FC55-6D5A-4B8E-BA6A-65F4B28759FD" name="GUID-BB09FC55-6D5A-4B8E-BA6A-65F4B28759FD"></a><h4 id="BRADV-GUID-BB09FC55-6D5A-4B8E-BA6A-65F4B28759FD" class="sect4"><span class="enumeration_section">29.6.2</span>将控制文件备份到跟踪文件</h4>
                  <div>
                     <div class="section">
                        <p>您可以将控制文件备份到包含<code class="codeph">CREATE CONTROLFILE</code>语句的文本文件。您可以编辑跟踪文件以创建脚本，该脚本基于创建跟踪文件时当前的控制文件创建新控制文件。
                        </p>
                        <p>如果在SQL语句中既未指定<code class="codeph">RESETLOGS</code>也未指定<code class="codeph">NORESETLOGS</code>选项，则生成的跟踪文件包含<code class="codeph">RESETLOGS</code>和<code class="codeph">NORESETLOGS</code>选项的控制文件版本。使用<code class="codeph">ALTER TABLESPACE ...将Temp文件条目包含在输出中<code class="codeph">ALTER TABLESPACE ...ADD TEMPFILE</code>语句。
                        </p>
                        <p>要避免恢复脱机正常或只读表空间，请从<code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code>语句中编辑它们。使用重新创建的控制文件打开数据库时，数据库会将这些省略的文件标记为<code class="codeph">MISSING</code> 。您可以运行<code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">RENAME</code> <code class="codeph">FILE</code>语句将它们重命名为其原始文件名。
                        </p>
                        <p>包含<code class="codeph">CREATE CONTROLFILE</code>语句的跟踪文件存储在由<code class="codeph">DIAGNOSTIC_DEST</code>初始化参数确定的子目录中。您可以在数据库警报日志中查找已写入<code class="codeph">CREATE CONTROLFILE</code>语句的跟踪文件的名称和位置。请参阅<a href="../admin/diagnosing-and-resolving-problems.html#ADMIN11267" target="_blank"><span class="italic">Oracle数据库管理员指南</span></a>以了解如何查找警报日志。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-BB09FC55-6D5A-4B8E-BA6A-65F4B28759FD__GUID-FA5D8307-998D-46D2-BE4B-AABE2C934773">要将控制文件备份到跟踪文件：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>装载或打开数据库。</span></li>
                        <li class="stepexpand"><span>执行以下SQL语句：</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE BACKUP CONTROLFILE to TRACE;</pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-BB09FC55-6D5A-4B8E-BA6A-65F4B28759FD__GUID-FD03E766-6013-450B-83B9-721D59D1BA96">
                           <p class="notep1">也可以看看：</p>
                           <p><span class="q">“ <a href="user-managed-recovery-advanced.html#GUID-6FEEA424-52E9-49C6-8E35-DD3AC9B8CBE6">恢复具有重新创建的控制文件的</a></span>只读<span class="q"><a href="user-managed-recovery-advanced.html#GUID-6FEEA424-52E9-49C6-8E35-DD3AC9B8CBE6">文件</a> ”，</span>用于与<code class="codeph">CREATE</code> <code class="codeph">CONTROLFILE</code>语句中包含的只读，脱机正常和临时文件相关的特殊问题</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="BRADV496"></a><a id="BRADV20333"></a><div class="props_rev_3"><a id="GUID-EFAB81C0-554D-4B09-A29F-ADADF6451D88" name="GUID-EFAB81C0-554D-4B09-A29F-ADADF6451D88"></a><h3 id="BRADV-GUID-EFAB81C0-554D-4B09-A29F-ADADF6451D88" class="sect3"><span class="enumeration_section">29.7</span>进行归档重做日志的用户管理备份</h3>
               <div>
                  <div class="section">
                     <p>要节省主存档位置中的磁盘空间，您可能需要将存档日志备份到磁带或备用磁盘位置。如果归档到多个位置，则只备份每个日志序列号的一个副本。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-EFAB81C0-554D-4B09-A29F-ADADF6451D88__GUID-F55F920E-5239-413F-8B20-43159B59188F">要备份存档的重做日志：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span><a id="d135532e3686" class="indexterm-anchor"></a>要确定数据库生成的归档重做日志文件，请查询<code class="codeph">V$ARCHIVED_LOG</code> 。例如，运行以下查询：</span><div><pre class="oac_no_warn" dir="ltr">SELECT THREAD＃，SEQUENCE＃，NAME FROM V $ ARCHIVED_LOG;</pre></div>
                     </li>
                     <li class="stepexpand"><span>使用操作系统实用程序备份每个日志序列号的一个副本。此示例将主存档位置中的所有日志备份到专用于日志备份的磁盘：</span><div><pre class="oac_no_warn" dir="ltr">％cp $ ORACLE_HOME / oracle / trgt / arch / * / disk2 / backup / arch</pre><div class="infoboxnotealso" id="GUID-EFAB81C0-554D-4B09-A29F-ADADF6451D88__GUID-064F4054-9800-4B47-90A9-B0B0F4F9004F">
                              <p class="notep1">也可以看看：</p>
                              <p>有关数据字典视图的更多信息，请<a href="../refrn/about-static-data-dictionary-views.html#REFRN002" target="_blank"><span class="italic">参见Oracle数据库参考</span></a></p>
                           </div>
                        </div>
                     </li>
                  </ol>
               </div>
            </div><a id="BRADV204"></a><div class="props_rev_3"><a id="GUID-F41318F6-A2F2-4518-9DB5-9EBB904EFB47" name="GUID-F41318F6-A2F2-4518-9DB5-9EBB904EFB47"></a><h3 id="BRADV-GUID-F41318F6-A2F2-4518-9DB5-9EBB904EFB47" class="sect3"><span class="enumeration_section">29.8</span>在SUSPEND模式下进行用户管理的备份</h3>
               <div>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="user-managed-database-backups.html#GUID-79BD132A-31C6-4C37-93D9-6EDA1E187993">关于暂停/恢复功能</a></p>
                     </li>
                     <li>
                        <p><a href="user-managed-database-backups.html#GUID-D465EBBB-8BB4-48BB-AB94-031A25D4DBC6">在挂起的数据库中进行备份</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV90012"></a><div class="props_rev_3"><a id="GUID-79BD132A-31C6-4C37-93D9-6EDA1E187993" name="GUID-79BD132A-31C6-4C37-93D9-6EDA1E187993"></a><h4 id="BRADV-GUID-79BD132A-31C6-4C37-93D9-6EDA1E187993" class="sect4"><span class="enumeration_section">29.8.1</span>关于暂停/恢复功能</h4>
                  <div>
                     <p><a id="d135532e3864" class="indexterm-anchor"></a><a id="d135532e3870" class="indexterm-anchor"></a><a id="d135532e3874" class="indexterm-anchor"></a><a id="d135532e3876" class="indexterm-anchor"></a><a id="d135532e3880" class="indexterm-anchor"></a><a id="d135532e3884" class="indexterm-anchor"></a>某些第三方工具允许您镜像一组磁盘或逻辑设备，即在另一个位置维护主数据的精确副本，然后<span class="italic">拆分镜像</span> 。拆分镜像涉及分离副本，以便您可以单独使用它们。
                     </p>
                     <p>使用<code class="codeph">SUSPEND</code> / <code class="codeph">RESUME</code>功能，您可以暂停数据库的I / O，然后拆分镜像并备份分割镜像。通过使用此功能补充备份模式功能，您可以挂起数据库I / O，以便不会执行新的I / O.然后，您可以访问已挂起的数据库以进行备份，而不会受到I / O干扰。
                     </p>
                     <p>通常，您不需要使用<code class="codeph">SUSPEND</code> / <code class="codeph">RESUME</code>来进行分割镜像备份，但是如果您的系统要求数据库缓存在分割卷之前没有<span class="italic">脏缓冲区</span> ，则必须使用它。在拆分操作发生时，某些RAID设备可以从暂停写入中受益;您的RAID供应商可以建议您的系统是否会受益于此功能。
                     </p>
                     <p><code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">SUSPEND</code>语句通过暂停数据文件头，数据文件和控制文件的I / O来挂起数据库。当数据库挂起时，所有预先存在的I / O操作都可以完成;但是，任何新的数据库I / O访问尝试都会排队。
                     </p>
                     <p><code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">SUSPEND</code>和<code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">RESUME</code>语句在数据库上运行，而不仅仅是实例。如果在Oracle RAC配置中的一个系统上输入<code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">SUSPEND</code>语句，则内部锁定机制会跨实例传播暂停请求，从而暂停给定群集中所有活动实例的I / O操作。
                     </p>
                  </div>
               </div><a id="BRADV497"></a><a id="BRADV90013"></a><div class="props_rev_3"><a id="GUID-D465EBBB-8BB4-48BB-AB94-031A25D4DBC6" name="GUID-D465EBBB-8BB4-48BB-AB94-031A25D4DBC6"></a><h4 id="BRADV-GUID-D465EBBB-8BB4-48BB-AB94-031A25D4DBC6" class="sect4"><span class="enumeration_section">29.8.2</span>在挂起的数据库中进行备份</h4>
                  <div>
                     <div class="section">
                        <p>成功暂停数据库后，您可以将数据库备份到磁盘或中断镜像。由于挂起数据库并不能保证立即终止I / O，因此Oracle建议您在<code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">SUSPEND</code>语句之前加上<code class="codeph">BEGIN</code> <code class="codeph">BACKUP</code>语句，以便将表空间置于备份模式。
                        </p>
                        <p>您必须使用传统的用户管理备份方法来备份分割镜像。RMAN无法进行数据库备份或复制，因为这些操作需要读取数据文件头。数据库备份完成或镜像重新启动后，您可以使用<code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">RESUME</code>语句恢复正常的数据库操作。
                        </p>
                        <p>在不拆分镜像的情况下备份挂起的数据库可能会导致数据库中断，因为在此期间数据库无法访问。但是，如果通过拆分镜像进行备份，则中断是名义上的。中断时间取决于要刷新的缓存大小，数据文件的数量以及中断镜像所需的时间。</p>
                        <p>请注意<code class="codeph">SUSPEND/RESUME</code>功能的以下限制：</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>在Oracle RAC配置中，请勿在原始节点挂起时启动新实例。</p>
                           </li>
                           <li>
                              <p><code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">SUSPEND</code>或<code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">RESUME</code>语句不启动检查点。
                              </p>
                           </li>
                           <li>
                              <p>在数据库挂起时，您不能使用<code class="codeph">IMMEDIATE</code> ， <code class="codeph">NORMAL</code>或<code class="codeph">TRANSACTIONAL</code>选项发出<code class="codeph">SHUTDOWN</code> 。
                              </p>
                           </li>
                           <li>
                              <p>在挂起的数据库上发出<code class="codeph">SHUTDOWN</code> <code class="codeph">ABORT</code>会重新激活数据库。这可以防止介质恢复或故障恢复进入无响应状态。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3" id="GUID-D465EBBB-8BB4-48BB-AB94-031A25D4DBC6__GUID-35B9B8CD-EC08-4021-954A-54AECBF50079">要在SUSPEND模式下进行分割镜像备份：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>将数据库表空间置于备份模式。例如，要将表空间<code class="codeph">users</code>置于备份模式，请输入：</span><div><pre class="oac_no_warn" dir="ltr">ALTER TABLESPACE用户BEGIN BACKUP;</pre><p>如果要备份数据库的所有表空间，则可以使用：</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE BEGIN BACKUP;</pre><div class="infoboxnote" id="GUID-D465EBBB-8BB4-48BB-AB94-031A25D4DBC6__GUID-714BD8DE-F478-4426-A8B4-F3554442A581">
                                 <p class="notep1">警告：</p>
                                 <p>不要使用<code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">SUSPEND</code>语句替代将表空间置于备份模式。
                                 </p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span><a id="d135532e4139" class="indexterm-anchor"></a><a id="d135532e4143" class="indexterm-anchor"></a>如果镜像系统在发生磁盘写入时分割镜像时出现问题，则挂起数据库。例如，发出以下语句：</span><div><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM SUSPEND;</pre></div>
                        </li>
                        <li class="stepexpand"><span><a id="d135532e4153" class="indexterm-anchor"></a><a id="d135532e4157" class="indexterm-anchor"></a>通过查询<code class="codeph">V$INSTANCE</code>视图验证数据库是否已挂起。例如：</span><div><pre class="oac_no_warn" dir="ltr">从V $ INSTANCE中选择DATABASE_STATUS; DATABASE_STATUS -----------------暂停</pre></div>
                        </li>
                        <li class="stepexpand"><span>在操作系统或硬件级别拆分镜像。</span></li>
                        <li class="stepexpand"><span><a id="d135532e4173" class="indexterm-anchor"></a><a id="d135532e4177" class="indexterm-anchor"></a>结束数据库暂停。例如，发出以下语句：</span><div><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM RESUME;</pre></div>
                        </li>
                        <li class="stepexpand"><span>通过查询<code class="codeph">V$INSTANCE</code>视图确定数据库处于活动状态。例如，输入：</span><div><pre class="oac_no_warn" dir="ltr">从V $ INSTANCE中选择DATABASE_STATUS; DATABASE_STATUS ----------------- ACTIVE</pre></div>
                        </li>
                        <li class="stepexpand"><span>使指定的表空间退出备份模式。例如，输入以下语句以使表空间<code class="codeph">users</code>退出备份模式：</span><div><pre class="oac_no_warn" dir="ltr">ALTER TABLESPACE用户END BACKUP;</pre></div>
                        </li>
                        <li class="stepexpand"><span>复制控制文件并像往常一样存档联机重做日志以进行备份。</span><div>
                              <div class="infoboxnotealso" id="GUID-D465EBBB-8BB4-48BB-AB94-031A25D4DBC6__GUID-9A0956F3-C2E8-427F-A156-AF96997D6877">
                                 <p class="notep1">也可以看看：</p>
                                 <ul style="list-style-type:disc">
                                    <li>
                                       <p><span class="q">“ <a href="backing-up-database-advanced.html#GUID-EEA8D192-E7CD-4457-A0E3-5062EA2E8D0C" title="许多站点保留存储在磁盘上的数据库的备份，以防主数据库发生介质故障或不正确的用户操作需要时间点恢复。磁盘上的数据文件备份简化了恢复的恢复步骤，使恢复更加快速和可靠。">使用RMAN进行分割镜像备份</a> ”</span></p>
                                    </li>
                                    <li>
                                       <p>有关<code class="codeph">SUSPEND</code> / <code class="codeph">RESUME</code>功能的详细信息，请<code class="codeph">SUSPEND</code> <a href="../admin/starting-up-and-shutting-down.html#ADMIN11165" target="_blank"><span class="italic">“Oracle数据库管理员指南”</span></a></p>
                                    </li>
                                    <li>
                                       <p><a href="../sqlrf/ALTER-SYSTEM.html#SQLRF00902" target="_blank"><code class="codeph">ALTER SYSTEM</code></a> <code class="codeph">SUSPEND</code>语法的<a href="../sqlrf/ALTER-SYSTEM.html#SQLRF00902" target="_blank"><span class="italic">Oracle数据库SQL语言参考</span></a></p>
                                    </li>
                                 </ul>
                              </div>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div>
            </div><a id="BRADV205"></a><div class="props_rev_3"><a id="GUID-3E0AAB48-7D0B-4012-BB41-E33DD11189C0" name="GUID-3E0AAB48-7D0B-4012-BB41-E33DD11189C0"></a><h3 id="BRADV-GUID-3E0AAB48-7D0B-4012-BB41-E33DD11189C0" class="sect3"><span class="enumeration_section">29.9</span>对原始设备进行用户管理备份</h3>
               <div>
                  <p><a id="d135532e4318" class="indexterm-anchor"></a> <a href="glossary.html#GUID-D6545038-B176-4D0E-9B4B-E4187A063984"><span class="xrefglossterm">原始设备</span></a>是没有文件系统的磁盘或分区。原始设备只能包含一个文件。备份原始设备上的文件会导致特定于操作系统的问题。以下部分讨论UNIX，Linux和Windows上的一些问题。
                  </p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="user-managed-database-backups.html#GUID-AE360086-A112-481C-9295-9DF46D20F1CC">在Linux和UNIX上备份到原始设备</a></p>
                     </li>
                     <li>
                        <p><a href="user-managed-database-backups.html#GUID-009E2DD5-047B-4D25-A1EA-8742F6A5F53B">备份到Windows上的原始设备</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV498"></a><a id="BRADV499"></a><a id="BRADV500"></a><a id="BRADV90014"></a><div class="props_rev_3"><a id="GUID-AE360086-A112-481C-9295-9DF46D20F1CC" name="GUID-AE360086-A112-481C-9295-9DF46D20F1CC"></a><h4 id="BRADV-GUID-AE360086-A112-481C-9295-9DF46D20F1CC" class="sect4"><span class="enumeration_section">29.9.1</span>在Linux和UNIX上备份到原始设备</h4>
                  <div>
                     <p><a id="d135532e4414" class="indexterm-anchor"></a> Linux和UNIX上的<code class="codeph">dd</code>命令是用于备份到原始设备或从原始设备备份的最常用备份实用程序。有关此实用程序的完整详细信息，请参阅操作系统特定的文档。
                     </p>
                     <p>有效地使用<code class="codeph">dd</code>需要您根据数据库指定正确的选项。<a href="user-managed-database-backups.html#GUID-AE360086-A112-481C-9295-9DF46D20F1CC__CHDFJAAE" title="dd对不同类型数据的影响">表29-1</a>列出了有关影响用于<code class="codeph">dd</code>的选项的数据库的详细信息。
                     </p>
                     <div class="tblformal" id="GUID-AE360086-A112-481C-9295-9DF46D20F1CC__CHDFJAAE">
                        <p class="titleintable">表29-1数据库的各个方面对于dd用法很重要</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="dd用法对数据库的重要性" width="100%" border="1" summary="Effect of dd on different types of data" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="20%" id="d135532e4445">数据</th>
                                 <th align="left" valign="bottom" width="80%" id="d135532e4448">说明</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d135532e4453" headers="d135532e4445 ">
                                    <p>块大小</p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d135532e4453 d135532e4448 ">
                                    <p>您可以指定<code class="codeph">dd</code>用于复制数据的缓冲区大小。例如，您可以指定<code class="codeph">dd</code>以8 KB或64 KB为单位复制数据。 <code class="codeph">dd</code>的块大小不一定与Oracle块大小或操作系统块大小相对应：它只是<code class="codeph">dd</code>在进行复制时使用的缓冲区大小。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d135532e4472" headers="d135532e4445 ">
                                    <p>原始抵消</p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d135532e4472 d135532e4448 ">
                                    <p>在某些系统上，原始设备上文件的开头保留供操作系统使用。此存储空间称为<strong class="term">原始偏移量</strong> 。Oracle数据库不备份或还原这些字节。
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d135532e4482" headers="d135532e4445 ">
                                    <p>Oracle数据库块<code class="codeph">0</code>大小</p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d135532e4482 d135532e4448 ">
                                    <p>在每个Oracle数据库文件的开头，特定于操作系统的代码都会放置一个名为<strong class="term">block 0</strong>的Oracle块。通用Oracle代码无法识别此块，但该块包含在操作系统上的文件大小中。通常，此块与文件中的其他Oracle块大小相同。
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p><a href="user-managed-database-backups.html#GUID-AE360086-A112-481C-9295-9DF46D20F1CC__CHDFJAAE" title="dd对不同类型数据的影响">表29-1中</a>的信息使您可以设置<a href="user-managed-database-backups.html#GUID-AE360086-A112-481C-9295-9DF46D20F1CC__g1012027" title="此表描述了dd命令的选项。">表29-2中</a>指定的<code class="codeph">dd</code>选项。
                     </p>
                     <div class="tblformal" id="GUID-AE360086-A112-481C-9295-9DF46D20F1CC__g1012027">
                        <p class="titleintable">表29-2 dd命令的选项</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="dd命令的选项" width="100%" border="1" summary="This table describes options to the dd command." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="20%" id="d135532e4518">这个选项......</th>
                                 <th align="left" valign="bottom" width="80%" id="d135532e4521">指定......</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d135532e4526" headers="d135532e4518 ">
                                    <p><code class="codeph">如果</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d135532e4526 d135532e4521 ">
                                    <p>输入文件的名称，即您正在阅读的文件</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d135532e4534" headers="d135532e4518 ">
                                    <p><code class="codeph">的</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d135532e4534 d135532e4521 ">
                                    <p>输出文件的名称，即您要写入的文件</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d135532e4542" headers="d135532e4518 ">
                                    <p><code class="codeph">BS</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d135532e4542 d135532e4521 ">
                                    <p><code class="codeph">dd</code>用于复制数据的缓冲区大小</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d135532e4553" headers="d135532e4518 ">
                                    <p><code class="codeph">跳跃</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d135532e4553 d135532e4521 ">
                                    <p>如果存在原始偏移量，则在输入原始设备上跳过的<code class="codeph">dd</code>缓冲区数。例如，如果要在原始设备上备份具有64 KB原始偏移量的文件，并且<code class="codeph">dd</code>缓冲区大小为8 KB，则可以指定<code class="codeph">skip=8</code>以便副本以偏移64 KB开始。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d135532e4570" headers="d135532e4518 ">
                                    <p><code class="codeph">寻求</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d135532e4570 d135532e4521 ">
                                    <p>如果存在原始偏移量，则在输出原始设备上跳过的<code class="codeph">dd</code>缓冲区数。例如，如果要将文件备份到具有64 KB原始偏移量的原始设备上，并且<code class="codeph">dd</code>缓冲区大小为8 KB，则可以指定<code class="codeph">skip=8</code>以便副本以偏移64 KB开始。</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="20%" id="d135532e4587" headers="d135532e4518 ">
                                    <p><code class="codeph">计数</code></p>
                                 </td>
                                 <td align="left" valign="top" width="80%" headers="d135532e4587 d135532e4521 ">
                                    <p><code class="codeph">dd</code>要复制的输入原始设备上的块数。从原始设备复制到文件系统时，最好指定要复制的确切块数;否则，Oracle数据文件未使用的原始卷末尾的额外空间将复制到文件系统。
                                    </p>
                                    <p>请记住在输入文件的总大小中包含块<code class="codeph">0</code> 。例如，如果<code class="codeph">dd</code>块大小为8 KB，并且您要备份30720 KB数据文件，则可以设置<code class="codeph">count=3841</code> 。<code class="codeph">count</code>这个值实际上备份了30728 KB：额外的8 KB用于Oracle块<code class="codeph">0</code> 。
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>由于原始设备可以是备份的输入或输出设备，因此备份有四种可能的方案。<code class="codeph">dd</code>的可能选项取决于您选择的方案，如<a href="user-managed-database-backups.html#GUID-AE360086-A112-481C-9295-9DF46D20F1CC__g1012052" title="此表根据备份的源和目标类型列出了dd命令所需的选项。">表29-3所示</a> 。
                     </p>
                     <div class="tblformal" id="GUID-AE360086-A112-481C-9295-9DF46D20F1CC__g1012052">
                        <p class="titleintable">表29-3涉及dd备份的场景</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="涉及dd备份的场景" width="100%" border="1" summary="This table lists the options needed for the dd command based on the source and destination types for a backup." frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="33%" id="d135532e4635">从...备份</th>
                                 <th align="left" valign="bottom" width="33%" id="d135532e4638">备份到......</th>
                                 <th align="left" valign="bottom" width="33%" id="d135532e4641">为dd命令指定的选项</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="33%" id="d135532e4646" headers="d135532e4635 ">
                                    <p>原始设备</p>
                                 </td>
                                 <td align="left" valign="top" width="33%" headers="d135532e4646 d135532e4638 ">
                                    <p>原始设备</p>
                                 </td>
                                 <td align="left" valign="top" width="33%" headers="d135532e4646 d135532e4641 ">
                                    <p><code class="codeph">if,</code> <code class="codeph">of,</code> <code class="codeph">bs,</code> <code class="codeph">skip</code> ， <code class="codeph">seek</code> ， <code class="codeph">count</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="33%" id="d135532e4672" headers="d135532e4635 ">
                                    <p>原始设备</p>
                                 </td>
                                 <td align="left" valign="top" width="33%" headers="d135532e4672 d135532e4638 ">
                                    <p>文件系统</p>
                                 </td>
                                 <td align="left" valign="top" width="33%" headers="d135532e4672 d135532e4641 ">
                                    <p><code class="codeph">if,</code> <code class="codeph">of,</code> <code class="codeph">bs,</code> <code class="codeph">skip</code> ， <code class="codeph">count</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="33%" id="d135532e4695" headers="d135532e4635 ">
                                    <p>文件系统</p>
                                 </td>
                                 <td align="left" valign="top" width="33%" headers="d135532e4695 d135532e4638 ">
                                    <p>原始设备</p>
                                 </td>
                                 <td align="left" valign="top" width="33%" headers="d135532e4695 d135532e4641 ">
                                    <p><code class="codeph">if,</code> <code class="codeph">of,</code> <code class="codeph">bs,</code> <code class="codeph">seek</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="33%" id="d135532e4715" headers="d135532e4635 ">
                                    <p>文件系统</p>
                                 </td>
                                 <td align="left" valign="top" width="33%" headers="d135532e4715 d135532e4638 ">
                                    <p>文件系统</p>
                                 </td>
                                 <td align="left" valign="top" width="33%" headers="d135532e4715 d135532e4641 ">
                                    <p><code class="codeph">if,</code> <code class="codeph">of,</code> <code class="codeph">bs</code></p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div><a id="BRADV90015"></a><div class="props_rev_3"><a id="GUID-8D75A1AC-463C-486B-BE73-2F227A6D71B1" name="GUID-8D75A1AC-463C-486B-BE73-2F227A6D71B1"></a><h5 id="BRADV-GUID-8D75A1AC-463C-486B-BE73-2F227A6D71B1" class="sect5"><span class="enumeration_section">29.9.1.1</span>在Linux和UNIX上使用dd实用程序进行备份：示例</h5>
                     <div>
                        <p>有关<code class="codeph">dd</code>实用程序用法的这些示例，请假设以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>您正在备份30720 KB数据文件。</p>
                           </li>
                           <li>
                              <p>数据文件的开头具有8 KB的块0。</p>
                           </li>
                           <li>
                              <p>原始偏移量为64 KB。</p>
                           </li>
                           <li>
                              <p>当原始设备涉及副本时，您将<code class="codeph">dd</code>块大小设置为8 KB。
                              </p>
                           </li>
                        </ul>
                        <p>在以下示例中，您将从一个原始设备备份到另一个原始设备：</p><pre class="oac_no_warn" dir="ltr">％dd if = / dev / rsd1b = / dev / rsd2b bs = 8k skip = 8 seek = 8 count = 3841</pre><p>在以下示例中，您将从原始设备备份到文件系统：</p><pre class="oac_no_warn" dir="ltr">％dd if = / dev / rsd1b = / backup / df1.dbf bs = 8k skip = 8 count = 3841</pre><p>在以下示例中，您将从文件系统备份到原始设备：</p><pre class="oac_no_warn" dir="ltr">％dd if = / dev / df1.dbf = / dev / rsd2b bs = 8k seek = 8</pre><p>在以下示例中，您将从文件系统备份到文件系统，并将块大小设置为较高值以提高I / O性能：</p><pre class="oac_no_warn" dir="ltr">％dd if = / oracle / dbs / df1.dbf = / backup / df1.dbf bs = 1024k</pre></div>
                  </div>
               </div><a id="BRADV501"></a><a id="BRADV90016"></a><div class="props_rev_3"><a id="GUID-009E2DD5-047B-4D25-A1EA-8742F6A5F53B" name="GUID-009E2DD5-047B-4D25-A1EA-8742F6A5F53B"></a><h4 id="BRADV-GUID-009E2DD5-047B-4D25-A1EA-8742F6A5F53B" class="sect4"><span class="enumeration_section">29.9.2</span>在Windows上备份到原始设备</h4>
                  <div>
                     <div class="section">
                        <p><a id="d135532e4911" class="indexterm-anchor"></a>与Linux和UNIX一样，Windows支持原始磁盘分区，数据库可以在其中存储数据文件，联机日志和控制文件。每个原始分区都分配了一个驱动器号或物理驱动器号，并且不包含文件系统。与在Linux和UNIX中一样，Windows上的每个原始分区都映射到单个文件。
                        </p>
                        <p>Windows在Oracle文件的命名约定中与Linux和UNIX不同。在Windows上，原始数据文件名的格式如下：</p><pre class="oac_no_warn" dir="ltr">\\。\ <span class="italic">drive_letter</span> ：\\。\ PHYSICALDRIVE <span class="italic">drive_number</span>
</pre><p>例如，以下是可能的原始文件名：</p><pre class="oac_no_warn" dir="ltr">\\。\G： \\。\ PHYSICALDRIVE3</pre><p>对用户管理的原始数据文件备份的过程与在Windows文件系统上复制文件的过程基本相同，只是使用Oracle <code class="codeph">OCOPY</code>实用程序而不是Windows提供的<code class="codeph">copy.exe</code>或<code class="codeph">ntbackup.exe</code>实用程序。<code class="codeph">OCOPY</code>支持64位文件I / O，物理原始驱动器和原始文件。<code class="codeph">OCOPY</code>实用程序无法直接备份到磁带。
                        </p>
                        <p>要显示<code class="codeph">OCOPY</code>在线文档， <code class="codeph">OCOPY</code>在Windows提示符下<code class="codeph">OCOPY</code>输入<code class="codeph">OCOPY</code> 。示例输出如下：</p><pre class="oac_no_warn" dir="ltr">OCOPY的用法：ocopy from_file [to_file [a | size_1 [size_n]]] ocopy -b from_file to_drive ocopy -r from_drive to_dir</pre><p>请注意<a href="user-managed-database-backups.html#GUID-009E2DD5-047B-4D25-A1EA-8742F6A5F53B__CEGIEACH" title="此表列出了ocopy命令的重要选项。">表29-4中</a>描述的重要<code class="codeph">OCOPY</code>选项。
                        </p>
                        <div class="tblformal" id="GUID-009E2DD5-047B-4D25-A1EA-8742F6A5F53B__CEGIEACH">
                           <p class="titleintable">表29-4 OCOPY选项</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="OCOPY选项" width="100%" border="1" summary="This table lists important options to the ocopy command." frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="20%" id="d135532e4977">选项</th>
                                    <th align="left" valign="bottom" width="80%" id="d135532e4980">行动</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d135532e4985" headers="d135532e4977 ">
                                       <p><code class="codeph">b</code></p>
                                    </td>
                                    <td align="left" valign="top" width="80%" headers="d135532e4985 d135532e4980 ">
                                       <p>将输入文件拆分为多个输出文件。此选项对于备份到小于输入文件的设备很有用。</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="20%" id="d135532e4993" headers="d135532e4977 ">
                                       <p><code class="codeph">[R</code></p>
                                    </td>
                                    <td align="left" valign="top" width="80%" headers="d135532e4993 d135532e4980 ">
                                       <p>合并多个输入文件并写入单个输出文件。此选项对于还原使用<code class="codeph">-b</code>选项创建的备份很有用。
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                  </div><a id="BRADV90017"></a><div class="props_rev_3"><a id="GUID-81561179-3309-47C5-B139-11B3DD978025" name="GUID-81561179-3309-47C5-B139-11B3DD978025"></a><h5 id="BRADV-GUID-81561179-3309-47C5-B139-11B3DD978025" class="sect5"><span class="enumeration_section">29.9.2.1使用OCOPY</span>备份：示例</h5>
                     <div>
                        <div class="section">
                           <p>在此示例中，假设以下内容：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>数据文件<code class="codeph">12</code>安装在<code class="codeph">\\.\G:</code>原始分区。
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">C:</code>驱动器安装文件系统。
                                 </p>
                              </li>
                              <li>
                                 <p>数据库已打开。</p>
                              </li>
                           </ul>
                           <p>要备份原始分区上的数据文件\\。\ <code class="codeph">G:</code>对于本地文件系统，在将数据文件<code class="codeph">12</code>置于备份模式后，可以在提示符下运行以下命令：</p><pre class="oac_no_warn" dir="ltr">OCOPY“\\。G：“C：\ backup \ datafile12.bak</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="BRADV90018"></a><div class="props_rev_3"><a id="GUID-C6327EEE-779B-491D-BDD0-453D5C154AA3" name="GUID-C6327EEE-779B-491D-BDD0-453D5C154AA3"></a><h5 id="BRADV-GUID-C6327EEE-779B-491D-BDD0-453D5C154AA3" class="sect5"><span class="enumeration_section">29.9.2.2为OCOPY</span>指定-b和-r选项：示例</h5>
                     <div>
                        <div class="section">
                           <p>在此示例中，假设以下内容：</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">\\。\G:</code>是包含数据文件<code class="codeph">7</code>的原始分区</p>
                              </li>
                              <li>
                                 <p><code class="codeph">E:</code>驱动器是可移动磁盘驱动器。
                                 </p>
                              </li>
                              <li>
                                 <p>数据库已打开。</p>
                              </li>
                           </ul>
                           <p>要将数据文件备份到驱动器<code class="codeph">E:</code> ：，在将数据文件<code class="codeph">7</code>置于备份模式后，可以在Windows提示符下执行以下命令：</p><pre class="oac_no_warn" dir="ltr">#stirst name是文件名，第二个参数是drive OCOPY -b“\\。\ G：“E：\</pre><p>当驱动器<code class="codeph">E:</code>填满时，您可以使用另一个磁盘。这样，您可以将数据文件<code class="codeph">7</code>的备份划分为多个文件。
                           </p>
                           <p>同样，要恢复备份，请将包含数据文件<code class="codeph">7</code>的表空间脱机并运行以下命令：</p><pre class="oac_no_warn" dir="ltr">#stirst是drive，第二个参数是目录OCOPY -r E：\“\\。\G：”</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div><a id="BRADV90019"></a><div class="props_rev_3"><a id="GUID-A1112F2C-D0ED-4C2F-BA24-A614F99F0FCA" name="GUID-A1112F2C-D0ED-4C2F-BA24-A614F99F0FCA"></a><h3 id="BRADV-GUID-A1112F2C-D0ED-4C2F-BA24-A614F99F0FCA" class="sect3"><span class="enumeration_section">29.10</span>使用第三方快照技术进行备份</h3>
               <div>
                  <div class="section">
                     <p>您可以使用存储快照优化来获取数据库的第三方快照，而无需将数据库置于备份模式。快照必须符合本节中描述的要求。</p>
                     <p>存储快照优化具有以下优势：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>消除了将数据库置于备份模式所带来的复杂性和开销。</p>
                        </li>
                        <li>
                           <p>使用<code class="codeph">RECOVER ...在一个步骤中执行恢复<code class="codeph">RECOVER ...SNAPSHOT TIME</code>命令。您可以恢复到当前时间或拍摄快照后的某个时间点。
                           </p>
                        </li>
                     </ul>
                     <p>要使用快照存储优化，第三方快照技术必须符合以下要求：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>快照期间数据库崩溃一致。</p>
                        </li>
                        <li>
                           <p>快照保留每个文件的写入顺序。</p>
                        </li>
                        <li>
                           <p>快照技术存储快照完成的时间。</p>
                        </li>
                     </ul>
                     <p>如果供应商无法保证符合这些要求，则必须将数据文件放入<a id="d135532e5340" class="indexterm-anchor"></a>使用带有<code class="codeph">BEGIN BACKUP</code>子句的<a href="../sqlrf/ALTER-DATABASE.html#SQLRF00802" target="_blank"><code class="codeph">ALTER DATABASE</code></a>或<a href="../sqlrf/ALTER-TABLESPACE.html#SQLRF01002" target="_blank"><code class="codeph">ALTER TABLESPACE</code></a>语句的<a href="glossary.html#GUID-BD2A12D3-A995-49B8-AE99-B8DDDF4FE7E7"><span class="xrefglossterm">备份模式</span></a> 。在创建快照之前，将数据文件置于备份模式。当表空间处于备份模式时，数据库会在修改块之前将整个块的前映像写入重做流。数据库还记录联机重做日志中块的更改。备份模式也冻结<a href="glossary.html#GUID-22212AAE-6F3C-4E84-B940-5AB2261A7EDA"><span class="xrefglossterm">数据文件检查点，</span></a>直到文件从备份模式中删除。Oracle数据库执行此安全措施，因为它无法保证第三方备份工具在复制数据块之前复制文件头。创建快照后，立即使用带有<code class="codeph">END BACKUP</code>子句的<code class="codeph">ALTER DATABASE</code>或<code class="codeph">ALTER TABLESPACE</code>命令将数据文件从备份模式中取出。您无需等到快照实际复制到备份媒体以结束备份模式。
                     </p>
                     <div class="infoboxnote" id="GUID-A1112F2C-D0ED-4C2F-BA24-A614F99F0FCA__GUID-9DB57462-2DA0-4644-8C22-85E199F92D2B">
                        <p class="notep1">注意：</p>
                        <p>当备份的数据库驻留在Oracle自动存储管理（Oracle ASM）上时，RMAN不支持基于存储的复制技术。</p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-A1112F2C-D0ED-4C2F-BA24-A614F99F0FCA__GUID-70096045-0DF1-4E79-B264-C0EEAE0F52F6">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“ <a href="user-managed-flashback-dbpitr.html#GUID-5A3BB8EE-291F-41C6-976C-1F304069FF0B">使用存储快照优化进行恢复</a> ”</span></p>
                     </div>
                     <p><a href="glossary.html#GUID-105781E5-32FB-4702-9248-9041B0EFBED4"><span class="xrefglossterm">卷影复制服务（VSS）</span></a>是一组Windows API，使应用程序能够创建称为卷<strong class="term">影副本的</strong>一致快照。<a href="glossary.html#GUID-CB860FA8-E039-4EC5-BAAC-F59091EA8F18"><span class="xrefglossterm">Oracle VSS编写器</span></a>在Windows系统上作为服务运行，并与支持VSS的应用程序集成。您可以使用这些应用程序创建由Oracle实例管理的数据库文件的快照。例如，您可以在打开读/写时创建Oracle数据库的卷影副本。
                     </p>
                     <div class="infoboxnotealso" id="GUID-A1112F2C-D0ED-4C2F-BA24-A614F99F0FCA__GUID-ABF77C79-6193-464F-8472-407D5CAF68F3">
                        <p class="notep1">也可以看看：</p>
                        <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/19/bradv&amp;id=NTQRF280" target="_blank"><span class="italic">适用于Microsoft Windows的Oracle数据库平台指南，</span></a>了解如何使用支持VSS的应用程序备份和恢复数据库</p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="BRADV206"></a><div class="props_rev_3"><a id="GUID-F47FE2CE-EEE0-42E5-AE8E-0A9D5D1BB42C" name="GUID-F47FE2CE-EEE0-42E5-AE8E-0A9D5D1BB42C"></a><h3 id="BRADV-GUID-F47FE2CE-EEE0-42E5-AE8E-0A9D5D1BB42C" class="sect3"><span class="enumeration_section">29.11</span>验证用户管理的数据文件备份</h3>
               <div>
                  <p><a id="d135532e5474" class="indexterm-anchor"></a><a id="d135532e5478" class="indexterm-anchor"></a><a id="d135532e5482" class="indexterm-anchor"></a><a id="d135532e5484" class="indexterm-anchor"></a>您必须定期验证备份，以确保它们可用于恢复。
                  </p>
                  <p>本节包含以下主题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="user-managed-database-backups.html#GUID-64F9446B-3C77-49E6-BA8D-44395A6F1EF5">测试数据文件备份的恢复</a></p>
                     </li>
                     <li>
                        <p><a href="user-managed-database-backups.html#GUID-F8F10F74-107C-4D8F-86A8-18140FE8484D">运行DBVERIFY实用程序</a></p>
                     </li>
                  </ul>
               </div><a id="BRADV90020"></a><div class="props_rev_3"><a id="GUID-64F9446B-3C77-49E6-BA8D-44395A6F1EF5" name="GUID-64F9446B-3C77-49E6-BA8D-44395A6F1EF5"></a><h4 id="BRADV-GUID-64F9446B-3C77-49E6-BA8D-44395A6F1EF5" class="sect4"><span class="enumeration_section">29.11.1</span>测试数据文件备份的恢复</h4>
                  <div>
                     <p>测试数据文件备份可用性的最佳方法是将它们还原到单独的主机并尝试打开数据库，并在必要时执行介质恢复。此选项要求您具有可用于还原过程的单独主机。</p>
                     <div class="infoboxnotealso" id="GUID-64F9446B-3C77-49E6-BA8D-44395A6F1EF5__GUID-27ABC0ED-6AE8-4B8D-A706-9C92D080B261">
                        <p class="notep1">也可以看看：</p>
                        <p><span class="q">“ <a href="user-managed-flashback-dbpitr.html#GUID-66D07694-533F-4E3A-BA83-DD461B68DB56" title="通常，当介质故障导致一个或多个数据文件不可访问时，您将执行数据库的完全恢复。在完整数据库恢复期间，您使用所有可用的重做将数据库恢复到当前SCN。">执行完整数据库恢复</a> ”</span>以了解如何使用SQL * Plus恢复文件</p>
                     </div>
                  </div>
               </div><a id="BRADV90021"></a><div class="props_rev_3"><a id="GUID-F8F10F74-107C-4D8F-86A8-18140FE8484D" name="GUID-F8F10F74-107C-4D8F-86A8-18140FE8484D"></a><h4 id="BRADV-GUID-F8F10F74-107C-4D8F-86A8-18140FE8484D" class="sect4"><span class="enumeration_section">29.11.2</span>运行DBVERIFY实用程序</h4>
                  <div>
                     <div class="section">
                        <p><code class="codeph">DBVERIFY</code>程序是一个外部命令行实用程序，它对脱机数据文件执行物理数据结构完整性检查。使用<code class="codeph">DBVERIFY</code>可确保数据文件的用户管理备份在还原之前有效，或在遇到数据损坏问题时用作诊断帮助。
                        </p>
                        <p><code class="codeph">DBVERIFY</code>的名称和位置取决于您的操作系统。例如，要在Linux或UNIX上对数据文件<code class="codeph">users01.dbf</code>执行完整性检查，请运行<code class="codeph">dbv</code>命令，如下所示：</p><pre class="oac_no_warn" dir="ltr">％dbv file = users01.dbf</pre><p>示例<code class="codeph">dbv</code>输出如下：</p><pre class="oac_no_warn" dir="ltr">DBVERIFY  - 验证开始：FILE = users01.dbf DBVERIFY  - 验证完成检查的总页数：250处理的总页数（数据）：1总页数失败（数据）：0处理的总页数（索引）：0总页面失败（索引）： 0处理的总页数（其他）：2处理的总页数（Seg）：0总页数失败（Seg）：0总页数空：247总页数标记已损坏：0总页数流入：0</pre><div class="infoboxnotealso" id="GUID-F8F10F74-107C-4D8F-86A8-18140FE8484D__GUID-1120334F-66DE-460A-8C68-36B37A1FD211">
                           <p class="notep1">也可以看看：</p>
                           <p><a href="../sutil/oracle-dbverify-utility.html#SUTIL013" target="_blank"><span class="italic">Oracle数据库实用程序</span></a>可以了解<code class="codeph">DBVERIFY</code></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>