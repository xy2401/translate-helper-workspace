<html lang="en-us" dir="ltr" xml:lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
      <title>Oracle高级队列</title>
      <meta property="og:site_name" content="Oracle Help Center"></meta>
      <meta property="og:title" content="JDBC Developer&#39;s Guide"></meta>
      <meta property="og:description" content=""></meta>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css"></link>
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico"></link>
      <meta name="application-name" content="JDBC Developer&#39;s Guide"></meta>
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)"></meta>
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2"></meta>
      <link rel="alternate" href="jdbc-developers-guide.pdf" title="PDF File" type="application/pdf"></link>
      <meta name="robots" content="all"></meta>
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/"></link>
      <meta name="dcterms.created" content="2019-02-13T13:20:37-08:00"></meta>
      <meta name="dcterms.title" content="JDBC Developer&#39;s Guide"></meta>
      <meta name="dcterms.dateCopyrighted" content="1999, 2019"></meta>
      <meta name="dcterms.category" content="database"></meta>
      <meta name="dcterms.identifier" content="E96471-02"></meta>
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/19"></meta>
      
      <link rel="prev" href="database-sharding.html" title="Previous" type="text/html"></link>
      <link rel="next" href="continuos-query-notification.html" title="Next" type="text/html"></link>
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script src="/sp_common/book-template/requirejs/require.js" data-main="/sp_common/book-template/ohc-book-template/js/book-config"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"19","element_name":"Release 19","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="JJDBC"></meta>
    <meta name="dcterms.release" content="Release 19"></meta>
  </head>
   <body dir="ltr">
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="database-sharding.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一页</a> <a href="continuos-query-notification.html" class="pull-right">下一页<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">JDBC开发人员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="performance-and-scalability.html" property="item" typeof="WebPage"><span property="name">性能和可伸缩性</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Oracle高级队列</li>
            </ol>
            <a id="GUID-2031547B-6E72-4C75-A75A-AD0D3A31AE76" name="GUID-2031547B-6E72-4C75-A75A-AD0D3A31AE76"></a><a id="JJDBC28801"></a>
            
            <h2 id="JJDBC-GUID-2031547B-6E72-4C75-A75A-AD0D3A31AE76" class="sect2"><span class="enumeration_chapter">26</span> Oracle高级队列</h2>
         </header>
         <div class="ind">
            <div>
               <p>Oracle Advanced Queuing（AQ）提供了数据库集成的消息队列功能。它构建于Oracle Streams之上，并优化Oracle数据库的功能，以便可以持久存储消息，在不同计算机和数据库的队列之间传播，并使用Oracle Net Services，HTTP和HTTPS进行传输。由于Oracle AQ是在数据库表中实现的，因此高可用性，可伸缩性和可靠性的所有操作优势也适用于队列数据。本章提供有关Oracle AQ的Java接口的信息。</p>
               <div class="infoboxnote" id="GUID-2031547B-6E72-4C75-A75A-AD0D3A31AE76__GUID-34BB8418-B244-4E82-808D-CEBFCFEF70F9">
                  <p class="notep1">注意：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>Oracle Advanced Queuing（AQ）是Oracle JDBC Thin驱动程序的一项功能，JDBC OCI驱动程序不支持该功能。</p>
                     </li>
                     <li>
                        <p>在Oracle Database <span class="italic">12c</span>第1版（12.1）中，添加了对<code class="codeph">XMLType</code>队列的支持。直到Oracle Database <span class="italic">11g</span>第1版，支持的队列类型是<code class="codeph">RAW</code> ， <code class="codeph">ADT</code>和<code class="codeph">ANYDATA</code>队列类型。
                        </p>
                     </li>
                  </ul>
               </div>
               <div class="infoboxnotealso" id="GUID-2031547B-6E72-4C75-A75A-AD0D3A31AE76__GUID-2305924F-E1C2-4EAA-B769-17FF66E86CD1">
                  <p class="notep1">也可以看看：</p>
                  <p><a href="../adque/aq-introduction.html#ADQUE-GUID-9714FE10-9721-4C78-93C6-0A3C4D9F5CBD" target="_blank"><span><cite>Oracle数据库高级队列用户指南</cite></span></a></p>
               </div>
               <p>本章包括以下主题：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="advanced-queuing.html#GUID-270EF1FE-F9C1-4767-86C9-DC798B7DA213">Oracle Advanced Queuing的功能和框架</a></p>
                  </li>
                  <li>
                     <p><a href="advanced-queuing.html#GUID-F97B8E25-C394-468B-97BF-41ECE8C42AC5">对数据库进行更改</a></p>
                  </li>
                  <li>
                     <p><a href="advanced-queuing.html#GUID-54F01AE4-0C8E-4A94-8C26-93F60B9C1B71">AQ异步事件通知</a></p>
                  </li>
                  <li>
                     <p><a href="advanced-queuing.html#GUID-CCEF5E83-7338-4EF5-B9DE-27E468AC59B5">关于创建消息</a></p>
                  </li>
                  <li>
                     <p><a href="advanced-queuing.html#GUID-CF24AC0C-FC14-4062-A9C0-CAB96F1C8D3E">排队邮件</a></p>
                  </li>
                  <li>
                     <p><a href="advanced-queuing.html#GUID-163B54F8-B3CF-41EE-9910-47D06F3A7D7A">出列消息</a></p>
                  </li>
                  <li>
                     <p><a href="advanced-queuing.html#GUID-A74A1FDD-8984-411C-9706-19A0A6FF0429">示例：入队和出队</a></p>
                  </li>
               </ul>
            </div><a id="JJDBC28802"></a><div class="props_rev_3"><a id="GUID-270EF1FE-F9C1-4767-86C9-DC798B7DA213" name="GUID-270EF1FE-F9C1-4767-86C9-DC798B7DA213"></a><h3 id="JJDBC-GUID-270EF1FE-F9C1-4767-86C9-DC798B7DA213" class="sect3"><span class="enumeration_section">26.1</span> Oracle高级队列的功能和框架</h3>
               <div>
                  <div class="section">
                     <p>Oracle JDBC包<code class="codeph">oracle.jdbc.aq</code>为AQ提供了一个快速的Java接口。该软件包包含以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>类</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">AQDequeueOptions</code></p>
                                 <p>指定可用于出列操作的选项</p>
                              </li>
                              <li>
                                 <p><code class="codeph">AQEnqueueOptions</code></p>
                                 <p>指定可用于排队操作的选项</p>
                              </li>
                              <li>
                                 <p><code class="codeph">AQFactory</code></p>
                                 <p>是AQ的工厂类</p>
                              </li>
                              <li>
                                 <p><code class="codeph">AQNotificationEvent</code></p>
                                 <p>每当新邮件在您注册了您感兴趣的队列中排队时创建</p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>接口</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">AQAgent</code></p>
                                 <p>用于表示和标识队列的用户或消息的生产者或使用者</p>
                              </li>
                              <li>
                                 <p><code class="codeph">AQMessage</code></p>
                                 <p>表示已入队或出列的消息</p>
                              </li>
                              <li>
                                 <p><code class="codeph">AQMessageProperties</code></p>
                                 <p>包含消息属性，如“关联”，“发件人”，“延迟”和“到期”，“收件人”以及“优先级和排序”</p>
                              </li>
                              <li>
                                 <p><code class="codeph">AQNotificationListener</code></p>
                                 <p>是用于接收AQ通知事件的侦听器接口</p>
                              </li>
                              <li>
                                 <p><code class="codeph">AQNotificationRegistration</code></p>
                                 <p>表示您希望在新消息在特定队列中入队时收到通知</p>
                              </li>
                           </ul>
                        </li>
                     </ul>
                     <p>通过这些类和接口，您可以访问现有队列，创建消息以及使消息入队和出列。</p>
                     <div class="infoboxnote" id="GUID-270EF1FE-F9C1-4767-86C9-DC798B7DA213__GUID-C77741C2-0650-440F-A2E6-9846C859C01C">
                        <p class="notep1">注意：</p>
                        <p>Oracle JDBC驱动程序<span class="italic">不</span>提供任何API来创建队列。必须通过<code class="codeph">DBMS_AQADM</code> PL / SQL包创建队列。
                        </p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-270EF1FE-F9C1-4767-86C9-DC798B7DA213__GUID-5BEAB762-C001-4C2C-A288-DAB61E1549E1">
                        <p class="notep1">也可以看看：</p>
                        <p>有关API的更多信息，请参阅<a href="../jajdb/index.html" target="_blank"><span class="italic">Oracle Database JDBC Java API Reference</span></a> 。
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDBC28803"></a><div class="props_rev_3"><a id="GUID-F97B8E25-C394-468B-97BF-41ECE8C42AC5" name="GUID-F97B8E25-C394-468B-97BF-41ECE8C42AC5"></a><h3 id="JJDBC-GUID-F97B8E25-C394-468B-97BF-41ECE8C42AC5" class="sect3"><span class="enumeration_section">26.2</span>对数据库进行更改</h3>
               <div>
                  <div class="section">
                     <p>本章中使用的代码片段假定用户<code class="codeph">HR</code>正在连接到数据库。因此，在数据库中，您必须向<code class="codeph">HR</code>授予以下权限：</p><pre class="oac_no_warn" dir="ltr">DBMS_AQ到HR的GRANT EXECUTE; DBMS_AQADM到HR的GRANT EXECUTE;向人力资源部门授予AQ_ADMINISTRATOR_ROLE; GRANT ADMINISTER DATABASE TRIGGER TO HR;</pre><p>在开始对消息进行入队和出列之前，必须在数据库中具有队列。为此，您必须执行以下操作：</p>
                     <ol>
                        <li>
                           <p>以下列方式创建队列表：</p><pre class="oac_no_warn" dir="ltr">BEGIN DBMS_AQADM.CREATE_QUEUE_TABLE（QUEUE_TABLE =&gt;'HR.RAW_SINGLE_QUEUE_TABLE'，QUEUE_PAYLOAD_TYPE =&gt;'RAW'，COMPATIBLE =&gt; '10 .0'）;结束;</pre></li>
                        <li>
                           <p>通过以下方式创建队列：</p><pre class="oac_no_warn" dir="ltr">BEGIN DBMS_AQADM.CREATE_QUEUE（QUEUE_NAME =&gt;'HR.RAW_SINGLE_QUEUE'，QUEUE_TABLE =&gt;'HR.RAW_SINGLE_QUEUE_TABLE'，END;</pre></li>
                        <li>
                           <p>以下列方式启动队列：</p><pre class="oac_no_warn" dir="ltr">BEGIN DBMS_AQADM.START_QUEUE（'HR.RAW_SINGLE_QUEUE'，END;</pre></li>
                     </ol>
                     <p>停止队列并从数据库中删除队列表是一种很好的做法。您可以通过以下方式执行此操作：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>以下列方式停止队列：</span><div><pre class="oac_no_warn" dir="ltr">BEGIN DBMS_AQADM.STOP_QUEUE（HR.RAW_SINGLE_QUEUE'，END;</pre></div>
                     </li>
                     <li class="stepexpand"><span>通过以下方式从数据库中删除队列表：</span><div><pre class="oac_no_warn" dir="ltr">BEGIN DBMS_AQADM.DROP_QUEUE_TABLE（QUEUE_TABLE =&gt;'HR.RAW_SINGLE_QUEUE_TABLE'，FORCE =&gt; TRUE END;</pre></div>
                     </li>
                  </ol>
               </div>
            </div><a id="JJDBC28804"></a><div class="props_rev_3"><a id="GUID-54F01AE4-0C8E-4A94-8C26-93F60B9C1B71" name="GUID-54F01AE4-0C8E-4A94-8C26-93F60B9C1B71"></a><h3 id="JJDBC-GUID-54F01AE4-0C8E-4A94-8C26-93F60B9C1B71" class="sect3"><span class="enumeration_section">26.3</span> AQ异步事件通知</h3>
               <div>
                  <p>JDBC应用程序可以执行以下操作：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>注册到AQ名称空间并在发生入队时接收通知。这可以通过以下方式执行：</p><pre class="oac_no_warn" dir="ltr">public AQNotificationRegistration registerForAQEvents（OracleConnection conn，String queueName）抛出SQLException {Properties globalOptions = new Properties（）; String [] queueNameArr = new String [1]; queueNameArr [0] = queueName;属性[] opt = new Properties [1]; opt [0] = new Properties（）;选择[0] .setProperty（的OracleConnection。NTF_AQ_PAYLOAD， “真”）; AQNotificationRegistration [] regArr = conn.registerAQNotification（queueNameArr，opt，globalOptions）; AQNotificationRegistration reg = regArr [0];返回reg; }</pre></li>
                     <li>
                        <p>注册数据库事件的订阅并在触发事件时接收通知</p>
                        <p>在触发事件时或在显式AQ队列中（或者在您注册了您感兴趣的队列中将新消息排入队列），将异步通知已注册的客户端。客户端不需要连接到数据库。</p>
                        <p>以下代码段显示了如何订阅数据库事件并在触发事件时接收通知：</p><pre class="oac_no_warn" dir="ltr">class DemoAQRawQueueListener实现AQNotificationListener {OracleConnection conn; String queueName; String typeName; int eventsCount = 0; public DemoAQRawQueueListener（String _queueName，String _typeName）抛出SQLException {queueName = _queueName; typeName = _typeName; conn =（OracleConnection）DriverManager.getConnection（DemoAQRawQueue。URL，DemoAQRawQueue。USERNAME，DemoAQRawQueue。密码）; public void onAQNotification（AQNotificationEvent e）{try {AQDequeueOptions deqopt = new AQDequeueOptions（）; deqopt.setRetrieveMessageId（真）; if（e.getConsumerName（）！= null）deqopt.setConsumerName（e.getConsumerName（））; if（（e.getMessageProperties（））。getDeliveryMode（）== AQMessageProperties。DeliveryMode。BUFFERED）{deqopt.setDeliveryMode（AQDequeueOptions。DEQUEUE_BUFFERED）; deqopt.setVisibility（AQDequeueOptions。DEQUEUE_IMMEDIATE）; } AQMessage msg = conn.dequeue（queueName，deqopt，typeName）; byte [] msgId = msg.getMessageId（）; if（msgId！= null）{String mesgIdStr = DemoAQRawQueue.byteBufferToHexString（msgId，20）; System.out.println（“dequeued的消息ID =”+ mesgIdStr）; System.out.println（msg.getMessageProperties（）。toString（））; byte [] payload = msg.getPayload（）; if（typeName.equals（“RAW”））{String payloadStr = new String（payload，0,10）; System.out.println（“payload.length =”+ payload.length +“，value =”+ payloadStr）; catch（SQLException sqlex）{System.out.println（sqlex.getMessage（））; } eventsCount ++; public int getEventsCount（）{return eventsCount; public void closeConnection（）抛出SQLException {conn.close（）; }}</pre></li>
                     <li>
                        <p>通过以下方式注册到监听器：</p><pre class="oac_no_warn" dir="ltr">AQNotificationRegistration reg = registerForAQEvents（conn，queueName +“：BLUE”）; DemoAQRawQueueListener demo_li = new DemoAQRawQueueListener（queueName，queueType）; reg.addListener（demo_li）;</pre></li>
                  </ul>
               </div>
            </div><a id="JJDBC28805"></a><div class="props_rev_3"><a id="GUID-CCEF5E83-7338-4EF5-B9DE-27E468AC59B5" name="GUID-CCEF5E83-7338-4EF5-B9DE-27E468AC59B5"></a><h3 id="JJDBC-GUID-CCEF5E83-7338-4EF5-B9DE-27E468AC59B5" class="sect3"><span class="enumeration_section">26.4</span>关于创建消息</h3>
               <div>
                  <p>本节介绍以下概念：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="advanced-queuing.html#GUID-0A322480-9372-4B14-A4C0-16883BBCAC26">创建消息</a></p>
                     </li>
                     <li>
                        <p><a href="advanced-queuing.html#GUID-1BEFE9AF-BC7F-4A22-A1F9-1E3225B113DC">AQ消息属性</a></p>
                     </li>
                     <li>
                        <p><a href="advanced-queuing.html#GUID-44FE0646-6E73-475C-BCD3-0DF199E1A130">AQ消息有效负载</a></p>
                     </li>
                  </ul>
               </div>
               <div class="props_rev_3"><a id="GUID-0A322480-9372-4B14-A4C0-16883BBCAC26" name="GUID-0A322480-9372-4B14-A4C0-16883BBCAC26"></a><h4 id="JJDBC-GUID-0A322480-9372-4B14-A4C0-16883BBCAC26" class="sect4"><span class="enumeration_section">26.4.1</span>创建消息</h4>
                  <div>
                     <div class="section">
                        <p>在排队邮件之前，您必须创建邮件。实现<code class="codeph">AQMessage</code>接口的类的实例表示AQ消息。AQ消息包含属性（元数据）和有效负载（数据）。执行以下操作以创建AQ消息：</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>以下列方式创建<code class="codeph">AQMessageProperties</code>的实例：</span><div><pre class="oac_no_warn" dir="ltr">AQMessageProperties msgprop = AQFactory.createAQMessageProperties（）;</pre></div>
                        </li>
                        <li class="stepexpand"><span>按以下方式设置属性属性：</span><div><pre class="oac_no_warn" dir="ltr">msgprop.setCorrelation（ “mycorrelation”）; msgprop.setExceptionQueue（ “MY_EXCEPTION_QUEUE”）; msgprop.setExpiration（0）; msgprop.setPriority（1）;</pre></div>
                        </li>
                        <li class="stepexpand"><span>使用<code class="codeph">AQMessageProperties</code>对象以下列方式创建AQ消息：</span><div><pre class="oac_no_warn" dir="ltr">AQMessage mesg = AQFactory.createAQMessage（msgprop）;</pre></div>
                        </li>
                        <li class="stepexpand"><span>按以下方式设置有效负载：</span><div><pre class="oac_no_warn" dir="ltr">byte [] rawPayload =“Example_Payload”.getBytes（）; mesg.setPayload（new oracle.sql。RAW（rawPayload））;</pre></div>
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-1BEFE9AF-BC7F-4A22-A1F9-1E3225B113DC" name="GUID-1BEFE9AF-BC7F-4A22-A1F9-1E3225B113DC"></a><h4 id="JJDBC-GUID-1BEFE9AF-BC7F-4A22-A1F9-1E3225B113DC" class="sect4"><span class="enumeration_section">26.4.2</span> AQ消息属性</h4>
                  <div>
                     <div class="section">
                        <p>AQ消息的属性由<code class="codeph">AQMessageProperties</code>接口的实例表示。您可以设置或获取以下消息属性：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>Dequeue Attempts Count：指定使消息出列的尝试次数。无法设置此属性。</p>
                           </li>
                           <li>
                              <p>相关性：是在将消息排入队列时由消息的生产者提供的标识符。</p>
                           </li>
                           <li>
                              <p>延迟：消息处于<code class="codeph">WAITING</code>状态的秒数。在指定的延迟之后，消息处于<code class="codeph">READY</code>状态并可用于出列。使用消息ID（msgid）使消息出列会覆盖延迟规范。
                              </p>
                              <div class="infoboxnote" id="GUID-1BEFE9AF-BC7F-4A22-A1F9-1E3225B113DC__GUID-4FB3C6C8-6E62-4C12-99F6-8922EC59F765">
                                 <p class="notep1">注意：</p>
                                 <p>缓冲消息传递不支持延迟。</p>
                              </div>
                           </li>
                           <li>
                              <p>传递模式：指定消息是缓冲消息还是持久消息。无法设置此属性。</p>
                           </li>
                           <li>
                              <p>入队时间：指定消息入队的时间。该值由系统确定，不能由用户设置。</p>
                           </li>
                           <li>
                              <p>异常队列：指定无法成功处理消息时移动到的队列的名称。消息在两种情况下移动：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p>不成功的出队尝试次数已超过<code class="codeph">max_retries</code> 。
                                    </p>
                                 </li>
                                 <li>
                                    <p>邮件已过期。</p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>到期时间：从消息达到<code class="codeph">READY</code>状态开始，消息可用于出队的秒数。如果消息在到期之前未出列，则将其移至<code class="codeph">EXPIRED</code>状态的异常队列。
                              </p>
                           </li>
                           <li>
                              <p>消息状态：指定消息出列时的消息状态。无法设置此属性。</p>
                           </li>
                           <li>
                              <p>上一个队列消息ID：是生成当前消息的最后一个队列中的消息的ID。当消息从一个队列传播到另一个队列时，此属性标识上次传播它的队列的ID。无法设置此属性。</p>
                           </li>
                           <li>
                              <p>优先级：指定消息的优先级。它可以是任何整数，包括负整数;值越小，优先级越高。</p>
                           </li>
                           <li>
                              <p>收件人列表：是表示收件人的<code class="codeph">AQAgent</code>对象列表。默认收件人是队列订户。此参数仅对多个使用者队列有效。
                              </p>
                           </li>
                           <li>
                              <p>发件人：是生成器在排队邮件时指定的标识符。它是<code class="codeph">AQAgent</code>一个实例。
                              </p>
                           </li>
                           <li>
                              <p>事务组：指定事务分组队列的消息的事务组。它是在成功调用<code class="codeph">dequeueArray</code>方法之后设置的。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="props_rev_3"><a id="GUID-44FE0646-6E73-475C-BCD3-0DF199E1A130" name="GUID-44FE0646-6E73-475C-BCD3-0DF199E1A130"></a><h4 id="JJDBC-GUID-44FE0646-6E73-475C-BCD3-0DF199E1A130" class="sect4"><span class="enumeration_section">26.4.3</span> AQ消息有效负载</h4>
                  <div>
                     <div class="section">
                        <p>根据队列的类型，可以使用<code class="codeph">AQMessage</code>接口的<code class="codeph">setPayload</code>方法指定AQ消息的有效负载。以下代码段说明了如何设置有效内容：</p><pre class="oac_no_warn" dir="ltr">...byte [] rawPayload =“Example_Payload”.getBytes（）; mesg.setPayload（new oracle.sql。RAW（rawPayload））; ...</pre><p>您可以使用<code class="codeph">getPayload</code>方法或适当的<code class="codeph">get</code> <span class="italic"><code class="codeph">XXX</code></span> <code class="codeph">Payload</code>方法以下列方式检索AQ消息的<code class="codeph">Payload</code> ：</p><pre class="oac_no_warn" dir="ltr">byte [] payload = mesg.getPayload（）;</pre><p>这些方法在<code class="codeph">AQMessage</code>接口中定义。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="JJDBC28809"></a><a id="JJDBC28808"></a><div class="props_rev_3"><a id="GUID-67510B08-91FB-4132-8138-68A6ED0DD21F" name="GUID-67510B08-91FB-4132-8138-68A6ED0DD21F"></a><h3 id="JJDBC-GUID-67510B08-91FB-4132-8138-68A6ED0DD21F" class="sect3"><span class="enumeration_section">26.5</span>示例：创建消息并设置有效负载</h3>
               <div>
                  <div class="section">
                     <p>本节提供了一个示例，说明如何创建消息和设置有效负载。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-67510B08-91FB-4132-8138-68A6ED0DD21F__GUID-12D6619B-EEF5-4D4E-9330-56C91939F887">
                     <p class="titleinexample">示例26-1创建消息并设置有效负载</p>
                     <p>此示例显示如何创建<code class="codeph">AQMessageProperties</code>的实例，设置属性属性，创建AQ消息以及设置有效内容。
                     </p><pre class="oac_no_warn" dir="ltr">AQMessageProperties msgprop = AQFactory.createAQMessageProperties（）; msgprop.setCorrelation（ “mycorrelation”）; msgprop.setExceptionQueue（ “MY_EXCEPTION_QUEUE”）; AQAgent ag = AQFactory.createAQAgent（）; ag.setName（ “MY_SENDER_AGENT_NAME”）; ag.setAddress（ “MY_SENDER_AGENT_ADDRESS”）; msgprop.setSender（AG）; <span class="bold">//处理多个消费者案例：</span> if（收件人！= null）msgprop.setRecipientList（recipients）;的System.out.println（msgprop.toString（））; AQMessage mesg = AQFactory.createAQMessage（msgprop）; byte [] rawPayload =“Example_Payload”.getBytes（）; mesg.setPayload（new oracle.sql。RAW（rawPayload））;</pre></div>
                  <!-- class="example" -->
               </div>
            </div><a id="JJDBC28810"></a><div class="props_rev_3"><a id="GUID-CF24AC0C-FC14-4062-A9C0-CAB96F1C8D3E" name="GUID-CF24AC0C-FC14-4062-A9C0-CAB96F1C8D3E"></a><h3 id="JJDBC-GUID-CF24AC0C-FC14-4062-A9C0-CAB96F1C8D3E" class="sect3"><span class="enumeration_section">26.6</span>排队消息</h3>
               <div>
                  <div class="section">
                     <p>创建消息并设置消息属性和有效内容后，可以使用<code class="codeph">OracleConnection</code>接口的<code class="codeph">enqueue</code>方法将消息<code class="codeph">enqueue</code> <code class="codeph">OracleConnection</code> 。在排队邮件之前，您可以指定一些排队选项。使用<code class="codeph">AQEnqueueOptions</code>类可以指定以下入队选项：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>交货方式：指定交货方式。传递模式可以设置为持久（ <code class="codeph">ENQUEUE_PERSISTENT</code> ）或缓冲（ <code class="codeph">ENQUEUE_BUFFERED</code> ）。
                           </p>
                        </li>
                        <li>
                           <p>检索消息ID：指定在消息排队时是否必须从服务器检索消息ID。默认情况下，不会检索消息ID。</p>
                        </li>
                        <li>
                           <p>转换：指定在排队消息之前应用的转换。转换函数的返回类型必须与队列的类型匹配。</p>
                           <div class="infoboxnote" id="GUID-CF24AC0C-FC14-4062-A9C0-CAB96F1C8D3E__GUID-F832569C-0F4D-4F4A-A6A0-AB6538308468">
                              <p class="notep1">注意：</p>
                              <p>必须使用<code class="codeph">DBMS_TRANSFORM.CREATE_TRANSFORMATION(...)</code>在PL / SQL中创建转换。
                              </p>
                           </div>
                        </li>
                        <li>
                           <p>可见性：指定入队请求的事务行为。此选项的默认值为<code class="codeph">ENQUEUE_ON_COMMIT</code> 。它表示排队操作是当前事务的一部分。<code class="codeph">ENQUEUE_IMMEDIATE</code>表示入队操作是自治事务，它在操作结束时提交。对于缓冲消息传递，您必须使用<code class="codeph">ENQUEUE_IMMEDIATE</code> 。</p>
                        </li>
                     </ul>
                     <p>以下代码段说明了如何设置enqueue选项并将消息排入队列：</p><pre class="oac_no_warn" dir="ltr">...AQEnqueueOptions opt = new AQEnqueueOptions（）; opt.setRetrieveMessageId（true）; conn.enqueue（queueName，opt，mesg）; ...
</pre></div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDBC28811"></a><div class="props_rev_3"><a id="GUID-163B54F8-B3CF-41EE-9910-47D06F3A7D7A" name="GUID-163B54F8-B3CF-41EE-9910-47D06F3A7D7A"></a><h3 id="JJDBC-GUID-163B54F8-B3CF-41EE-9910-47D06F3A7D7A" class="sect3"><span class="enumeration_section">26.7出</span>列消息</h3>
               <div>
                  <div class="section">
                     <p>排队的消息可以使用<code class="codeph">OracleConnection</code>接口的<code class="codeph">dequeue</code>方法出列。在出列消息之前，必须设置出队选项。<code class="codeph">AQDequeueOptions</code>类使您可以指定以下出列选项：</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type:disc">
                        <li>
                           <p>条件：根据消息属性，消息数据属性和PL / SQL函数指定条件表达式。使用类似于SQL查询的<code class="codeph">WHERE</code>子句的语法将出列条件指定为<code class="codeph">Boolean</code>表达式。
                           </p>
                        </li>
                        <li>
                           <p>使用者名称：如果指定，则仅访问与使用者名称匹配的消息。</p>
                           <div class="infoboxnote" id="GUID-163B54F8-B3CF-41EE-9910-47D06F3A7D7A__GUID-F7FD005C-5C5F-49F4-9979-6F8F5BD5C062">
                              <p class="notep1">注意：</p>
                              <p>如果队列是单用户队列，请<span class="italic">不要</span>设置此选项。
                              </p>
                           </div>
                        </li>
                        <li>
                           <p>相关性：指定出列操作的相关标准（或搜索条件）。</p>
                        </li>
                        <li>
                           <p>传递过滤器：指定要出列的邮件类型。您只将缓冲消息（ <code class="codeph">DEQUEUE_BUFFERED</code> ）或仅持久消息（ <code class="codeph">DEQUEUE_PERSISTENT</code> ）（默认值）或两者（ <code class="codeph">DEQUEUE_PERSISTENT_OR_BUFFERED</code> ）出列。
                           </p>
                        </li>
                        <li>
                           <p>出队消息ID：指定要出列的消息的消息标识符。这可用于使ID已知的唯一消息出列。</p>
                        </li>
                        <li>
                           <p>出队模式：指定与出队操作关联的锁定行为。它可以采用以下值之一：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">DequeueMode。BROWSE</code> ：消息在没有获取任何锁定的情况下出列。
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">DequeueMode。LOCKED</code> ：消息通过写入锁定进行，该写入锁定持续到事务的持续时间。
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">DequeueMode。REMOVE</code> :(默认）消息已出列并删除。可以根据保留属性将消息保留在队列中。
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">DequeueMode。REMOVE_NO_DATA</code> ：消息被标记为已更新或已删除。
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>最大缓冲区长度：指定从<code class="codeph">RAW</code>队列中出列消息时将分配的最大字节数。默认最大值为<code class="codeph">DEFAULT_MAX_PAYLOAD_LENGTH</code>但可以更改为任何其他非零值。如果缓冲区的大小不足以包含整个消息，则将忽略超出的字节数。
                           </p>
                        </li>
                        <li>
                           <p>导航：指定要检索的消息的位置。它可以采用以下值之一：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">NavigationOption。FIRST_MESSAGE</code> ：匹配搜索条件的第一个可用消息已出列。
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">NavigationOption。NEXT_MESSAGE</code> :(默认）与搜索条件匹配的下一个可用消息已出列。如果先前的消息属于消息组，则与消息组中的搜索条件匹配的下一个可用消息将出列。
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">NavigationOption。NEXT_TRANSACTION</code> ：跳过当前事务组中的消息，并将下一个事务组的第一条消息出列。<span class="italic">仅</span>当为队列启用了邮件分组时，才能使用此设置。
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>检索消息ID：指定是否需要检索出列消息的消息标识符。默认情况下，不会检索它。</p>
                        </li>
                        <li>
                           <p>转换：指定在将消息出列后将应用的转换。转换的源类型必须与队列的类型匹配。</p>
                           <div class="infoboxnote" id="GUID-163B54F8-B3CF-41EE-9910-47D06F3A7D7A__GUID-32168A0A-F921-4E2F-9D85-38BDCFAD2EC5">
                              <p class="notep1">注意：</p>
                              <p>必须使用<code class="codeph">DBMS_TRANSFORM.CREATE_TRANSFORMATION(...)</code>在PL / SQL中创建转换。
                              </p>
                           </div>
                        </li>
                        <li>
                           <p>可见性：指定消息是否作为当前事务的一部分出列。它可以采用以下值之一：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">VisibilityOption。ON_COMMIT</code> :(默认）dequeue操作是当前事务的一部分。
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">VisibilityOption。IMMEDIATE</code> ：dequeue操作是一个在操作结束时提交的自治事务。
                                 </p>
                              </li>
                           </ul>
                           <div class="infoboxnote" id="GUID-163B54F8-B3CF-41EE-9910-47D06F3A7D7A__GUID-1BCB28F5-A177-4F04-9CE1-7A66F948B2F4">
                              <p class="notep1">注意：</p>
                              <p><code class="codeph">DequeueMode.忽略Visibility选项<code class="codeph">DequeueMode.BROWSE</code>出队模式。如果传递过滤器为<code class="codeph">DEQUEUE_BUFFERED</code>或<code class="codeph">DEQUEUE_PERSISTENT_OR_BUFFERED</code> ，则<span class="italic">必须</span>将此选项设置为<code class="codeph">VisibilityOption.IMMEDIATE</code> 。</p>
                           </div>
                        </li>
                        <li>
                           <p>等待：如果没有消息与搜索条件匹配，则指定出列操作的等待时间。默认值为<code class="codeph">DEQUEUE_WAIT_FOREVER</code>表示操作永远等待。如果设置为<code class="codeph">DEQUEUE_NO_WAIT</code> ，则操作不会等待。如果指定了数字，则出列操作将等待指定的秒数。
                           </p>
                           <div class="infoboxnote" id="GUID-163B54F8-B3CF-41EE-9910-47D06F3A7D7A__GUID-F1072B0E-37BD-4348-A620-5A002EFCFD93">
                              <p class="notep1">注意：</p>
                              <p>如果使用<code class="codeph">DEQUEUE_WAIT_FOREVER</code> ，则在队列中出现与搜索条件匹配的消息之前，将不会返回出列操作。但是，您可以通过调用<code class="codeph">OracleConnection</code>对象上的<code class="codeph">cancel</code>方法来中断出列操作。
                              </p>
                           </div>
                        </li>
                     </ul>
                     <p>以下代码段说明了如何设置出队选项并使消息出列：</p><pre class="oac_no_warn" dir="ltr">...AQDequeueOptions deqopt = new AQDequeueOptions（）; deqopt.setRetrieveMessageId（真）; deqopt.setConsumerName（consumerName）; AQMessage msg = conn.dequeue（queueName，deqopt，queueType）;</pre></div>
                  <!-- class="section" -->
               </div>
            </div><a id="JJDBC28813"></a><a id="JJDBC28814"></a><a id="JJDBC28812"></a><div class="props_rev_3"><a id="GUID-A74A1FDD-8984-411C-9706-19A0A6FF0429" name="GUID-A74A1FDD-8984-411C-9706-19A0A6FF0429"></a><h3 id="JJDBC-GUID-A74A1FDD-8984-411C-9706-19A0A6FF0429" class="sect3"><span class="enumeration_section">26.8</span>示例：入队和出队</h3>
               <div>
                  <div class="section">
                     <p>本节提供了一些示例，说明如何使消息入队和出列。</p>
                     <p><a href="advanced-queuing.html#GUID-A74A1FDD-8984-411C-9706-19A0A6FF0429__BABJCHGG">例26-2</a>说明了如何排队消息， <a href="advanced-queuing.html#GUID-A74A1FDD-8984-411C-9706-19A0A6FF0429__BABGEEGE">例26-3</a>说明了如何使消息出列。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-A74A1FDD-8984-411C-9706-19A0A6FF0429__BABJCHGG">
                     <p class="titleinexample">例26-2排队单个消息</p>
                     <p>此示例说明如何获取对队列的访问权限，创建消息并将其排入队列。</p><pre class="oac_no_warn" dir="ltr">AQMessageProperties msgprop = AQFactory.createAQMessageProperties（）; msgprop.setPriority（1）; msgprop.setExceptionQueue（ “EXCEPTION_QUEUE”）; msgprop.setExpiration（0）; AQAgent agent = AQFactory.createAQAgent（）; agent.setName（ “AGENTNAME”）; agent.setAddress（ “AGENTADDRESS”）; msgprop.setSender（剂）; AQMessage mesg = AQFactory.createAQMessage（msgprop）; mesg.setPayload（缓冲液）; //其中buffer是一个字节数组（对于RAW队列）AQEnqueueOptions options = new AQEnqueueOptions（）; conn.enqueue（“HR.MY_QUEUE”，options，mesg）;</pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-A74A1FDD-8984-411C-9706-19A0A6FF0429__BABGEEGE">
                     <p class="titleinexample">例26-3使单个消息出列</p>
                     <p>此示例说明如何获取对队列的访问权限，设置出列选项以及使消息出列。</p><pre class="oac_no_warn" dir="ltr">AQDequeueOptions options = new AQDequeueOptions（）; options.setDeliveryFilter（AQDequeueOptions。DeliveryFilter。缓冲的）; AQMessage mesg = conn.dequeue（“HR.MY_QUEUE”，options，“RAW”）;</pre></div>
                  <!-- class="example" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>